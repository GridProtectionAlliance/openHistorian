(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8747],{35931:(oe,V,p)=>{"use strict";p.d(V,{H:()=>e});var F=p(32196),d=p(96540),P=p(40845);function e(A){const{description:z,suffix:U,feature:q}=A,ee=`Learn more about ${q}`,M=(0,P.of)(I);return d.createElement("span",{className:M.container},z,d.createElement("a",{"aria-label":ee,href:`https://grafana.com/docs/grafana/next/datasources/${U}`,rel:"noreferrer",target:"_blank"},ee))}const I=A=>({container:(0,F.css)({color:A.colors.text.secondary,a:(0,F.css)({color:A.colors.text.link,textDecoration:"underline",marginLeft:"5px","&:hover":{textDecoration:"none"}})})})},18747:(oe,V,p)=>{"use strict";p.r(V),p.d(V,{plugin:()=>wr});var F=p(40187),d=p(69129),P=p(3591),e=p(74848),I=p(32196),A=p(96540),z=p(43127),U=p(42418),q=p(40845),ee=p(20084),M=p(76892),j=p(14186),S=p(10354);const te=t=>(i,r)=>{const n={};for(const o in t)n[o]=t[o](i[o],r);return n},ce=(t,i,r)=>(0,A.useCallback)(o=>{t(r(i,o))},[t,i,r]),ve=(0,A.createContext)(void 0),B=()=>{const t=(0,A.useContext)(ve);if(!t)throw new Error("Use DispatchContext first.");return t},fe=t=>({name:t,pipelineAgg:""}),It=t=>`var${Math.max(0,...t.map(i=>parseInt(i.name.match("^var(\\d+)$")?.[1]||"0",10)))+1}`,At=t=>t.settings?.model==="ewma",tt=t=>t.settings?.model==="holt",Ve=t=>t.settings?.model==="holt_winters",ds=t=>["holt","ewma","holt_winters"].includes(t.settings?.model||""),ge=t=>Q[t.type].requiresField,Ie=t=>Q[t.type].isPipelineAgg,Ne=t=>Q[t.type].supportsMultipleBucketPaths,fs=t=>Q[t.type].supportsMissing,ae=t=>Q[t.type].hasSettings,pe=t=>Q[t.type].hasMeta,Ae=t=>Q[t.type].supportsInlineScript,Ct=["count","avg","sum","min","max","extended_stats","percentiles","cardinality","raw_document","raw_data","logs","moving_avg","moving_fn","derivative","serial_diff","cumulative_sum","bucket_script","rate","top_metrics"],wt=t=>Ct.includes(t),Q={count:{label:"Count",impliedQueryType:"metrics",requiresField:!1,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!1,hasMeta:!1,supportsInlineScript:!1,defaults:{}},avg:{label:"Average",impliedQueryType:"metrics",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},sum:{label:"Sum",impliedQueryType:"metrics",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},max:{label:"Max",impliedQueryType:"metrics",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},min:{label:"Min",impliedQueryType:"metrics",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},extended_stats:{label:"Extended Stats",impliedQueryType:"metrics",requiresField:!0,supportsMissing:!0,supportsInlineScript:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!0,defaults:{meta:{std_deviation_bounds_lower:!0,std_deviation_bounds_upper:!0}}},percentiles:{label:"Percentiles",impliedQueryType:"metrics",requiresField:!0,supportsMissing:!0,supportsInlineScript:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{settings:{percents:["25","50","75","95","99"]}}},cardinality:{label:"Unique Count",impliedQueryType:"metrics",requiresField:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{}},moving_avg:{label:"Moving Average",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,versionRange:"<8.0.0",supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{model:"simple",window:"5"}}},moving_fn:{label:"Moving Function",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,supportsMultipleBucketPaths:!1,supportsInlineScript:!1,supportsMissing:!1,hasMeta:!1,hasSettings:!0,defaults:{}},derivative:{label:"Derivative",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{}},serial_diff:{label:"Serial Difference",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{lag:"1"}}},cumulative_sum:{label:"Cumulative Sum",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{}},bucket_script:{label:"Bucket Script",impliedQueryType:"metrics",requiresField:!1,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!0,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{pipelineVariables:[fe(It([]))]}},raw_document:{label:"Raw Document (deprecated)",requiresField:!1,impliedQueryType:"raw_document",isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{size:"500"}}},raw_data:{label:"Raw Data",requiresField:!1,impliedQueryType:"raw_data",isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{size:"500"}}},logs:{label:"Logs",requiresField:!1,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,impliedQueryType:"logs",supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{limit:"500"}}},top_metrics:{label:"Top Metrics",impliedQueryType:"metrics",requiresField:!1,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{order:"desc"}}},rate:{label:"Rate",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!0,hasMeta:!1,defaults:{}}},Gs={moving_avg:[{label:"window",default:5},{label:"model",default:"simple"},{label:"predict"},{label:"minimize",default:!1}],moving_fn:[{label:"window",default:5},{label:"script"}],derivative:[{label:"unit"}],serial_diff:[{label:"lag"}],cumulative_sum:[{label:"format"}],bucket_script:[]},Mt=(t,i)=>{const r=i.filter(n=>Ne(n)?n.pipelineVariables?.some(o=>o.pipelineAgg===t.id):ge(n)&&t.id===n.field);return[...r,...r.flatMap(n=>Mt(n,i))]},Et=[{label:"Avg",value:"avg"},{label:"Min",value:"min"},{label:"Max",value:"max"},{label:"Sum",value:"sum"},{label:"Count",value:"count"},{label:"Std Dev",value:"std_deviation"},{label:"Std Dev Upper",value:"std_deviation_bounds_upper"},{label:"Std Dev Lower",value:"std_deviation_bounds_lower"}],gs=[{label:"Simple",value:"simple"},{label:"Linear",value:"linear"},{label:"Exponentially Weighted",value:"ewma"},{label:"Holt Linear",value:"holt"},{label:"Holt Winters",value:"holt_winters"}],Dt={pre:"@HIGHLIGHT@",post:"@/HIGHLIGHT@"},xe="3";function he(t="1"){return{type:"count",id:t}}function st(t="1"){return{type:"date_histogram",id:t,settings:{interval:"auto"}}}const Ce=(t,i)=>t.find(r=>r.id===i);function it(t,i){return!!t?.metrics?.some(r=>r.type===i)}function Ys(t){return t in pipelineOptions}function Tt(t){return!!metricAggregationConfig[t].supportsMultipleBucketPaths}var Be=p(99589);const be=t=>ge(t)?`${Q[t.type].label} ${t.field}`:Q[t.type].label,Qe=t=>Object.entries(t).reduce((i,[r,n])=>{if(n==null)return{...i};if(Array.isArray(n)&&n.length===0)return{...i};if(typeof n=="string"&&n.length===0)return{...i};if(!Array.isArray(n)&&typeof n=="object"){const o=Qe(n);return Object.keys(o).length===0?{...i}:{...i,[r]:o}}return{...i,[r]:n}},{}),rt=t=>{const i=t.match(/^(\d+)/);return i?i[1]:void 0},We=t=>(typeof t.settings?.script=="object"?t.settings?.script?.inline:t.settings?.script)||"",nt=t=>!!(0,Be.gte)(t,"7.16.0"),at="Support for Elasticsearch versions after their end-of-life (currently versions < 7.16) was removed. Using unsupported version of Elasticsearch may lead to unexpected and incorrect results.",qe=t=>t?.bucketAggs?.slice(-1)[0]?.type==="date_histogram",lt=/\$(\w+)|\[\[(\w+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::([^\}]+))?}/g;function Pt(t,i){i=i||{};const r=i.delimiter||".";let n=i.maxDepth||3,o=1;const u={};function f(v,$){Object.keys(v).forEach(m=>{const b=v[m],T=i?.safe&&Array.isArray(b),O=Object.prototype.toString.call(b)==="[object Object]",Z=$?$+r+m:m;if(i?.maxDepth||(n=o+1),!T&&O&&b&&Object.keys(b).length&&o<n)return++o,f({...b},Z);u[Z]=b})}return f(t,null),u}var R=p(65307);const ke=(0,R.VP)("@metrics/add"),ze=(0,R.VP)("@metrics/remove"),He=(0,R.VP)("@metrics/toggle_visibility"),we=(0,R.VP)("@metrics/change_field"),Me=(0,R.VP)("@metrics/change_type"),ot=(0,R.VP)("@metrics/change_attr"),k=(0,R.VP)("@metrics/change_setting"),_t=(0,R.VP)("@metrics/change_meta"),Ee=(0,R.VP)("init"),Ot=(0,R.VP)("change_query"),Rt=(0,R.VP)("change_alias_pattern"),ps=(t,i)=>Ot.match(i)?i.payload:Ee.match(i)?t||"":t,hs=(t,i)=>Rt.match(i)?i.payload:Ee.match(i)?t||"":t;var ct=p(91410);const Lt=()=>({label:"",query:"*"}),W={terms:{label:"Terms",requiresField:!0,defaultSettings:{min_doc_count:"1",size:"10",order:"desc",orderBy:"_term"}},filters:{label:"Filters",requiresField:!1,defaultSettings:{filters:[Lt()]}},geohash_grid:{label:"Geo Hash Grid",requiresField:!0,defaultSettings:{precision:xe}},date_histogram:{label:"Date Histogram",requiresField:!0,defaultSettings:{interval:"auto",min_doc_count:"0",trimEdges:"0",timeZone:ct.g$.utc}},histogram:{label:"Histogram",requiresField:!0,defaultSettings:{interval:"1000",min_doc_count:"0"}},nested:{label:"Nested (experimental)",requiresField:!0,defaultSettings:{}}},Ue=[{label:"Term value",value:"_term"},{label:"Doc Count",value:"_count"}],De=[{label:"Top",value:"desc"},{label:"Bottom",value:"asc"}],ms=[{label:"No limit",value:"0"},{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"5",value:"5"},{label:"10",value:"10"},{label:"15",value:"15"},{label:"20",value:"20"}],Vt=(0,R.VP)("@bucketAggs/add"),Nt=(0,R.VP)("@bucketAggs/remove"),Bt=(0,R.VP)("@bucketAggs/change_type"),Qt=(0,R.VP)("@bucketAggs/change_field"),H=(0,R.VP)("@bucketAggs/change_setting"),ys=t=>(i,r)=>{if(Vt.match(r)){const n={id:r.payload,type:"terms",settings:W.terms.defaultSettings},o=i[i.length-1];return o?.type==="date_histogram"?[...i.slice(0,i.length-1),n,o]:[...i,n]}return Nt.match(r)?i.filter(n=>n.id!==r.payload):Bt.match(r)?i.map(n=>n.id!==r.payload.id?n:{id:n.id,type:r.payload.newType,settings:W[r.payload.newType].defaultSettings}):Qt.match(r)?i.map(n=>n.id!==r.payload.id?n:{...n,field:r.payload.newField}):Me.match(r)?Q[r.payload.type].impliedQueryType!=="metrics"?[]:i.length===0?[{...st("2"),field:t}]:i:H.match(r)?i.map(n=>{if(n.id!==r.payload.bucketAgg.id)return n;const o=Qe({...n.settings,[r.payload.settingName]:r.payload.newValue});return{...n,settings:{...o}}}):Ee.match(r)?i&&i.length>0?i:[{...st("2"),field:t}]:i},Wt=(t,i)=>{if(ke.match(i))return[...t,he(i.payload)];if(ze.match(i)){const r=t.find(u=>u.id===i.payload),n=[r,...Mt(r,t)],o=t.filter(u=>!n.some(f=>f.id===u.id));return o.length===0?[he("1")]:o}return Me.match(i)?t.filter(r=>Q[i.payload.type].impliedQueryType==="metrics"?!0:r.id===i.payload.id).map(r=>r.id!==i.payload.id?r:{id:r.id,type:i.payload.type,...Q[i.payload.type].defaults}):we.match(i)?t.map(r=>{if(r.id!==i.payload.id)return r;const n={...r,field:i.payload.field};return Ie(r)?{...n,pipelineAgg:i.payload.field}:n}):He.match(i)?t.map(r=>r.id!==i.payload?r:{...r,hide:!r.hide}):k.match(i)?t.map(r=>{if(r.id!==i.payload.metric.id)return r;if(ae(r)){const n=Qe({...r.settings,[i.payload.settingName]:i.payload.newValue});return{...r,settings:{...n}}}return r}):_t.match(i)?t.map(r=>r.id!==i.payload.metric.id?r:pe(r)?{...r,meta:{...r.meta,[i.payload.meta]:i.payload.newValue}}:r):ot.match(i)?t.map(r=>r.id!==i.payload.metric.id?r:{...r,[i.payload.attribute]:i.payload.newValue}):Ee.match(i)?t&&t.length>0?t:[he("1")]:t},qt=(0,A.createContext)(void 0),Te=(0,A.createContext)(void 0),Pe=(0,A.createContext)(void 0),vs=({children:t,onChange:i,onRunQuery:r,query:n,datasource:o,range:u})=>{const f=(0,A.useCallback)((L,O)=>{i(L),(L.query===O.query||O.query===void 0)&&r()},[i,r]),v=te({query:ps,alias:hs,metrics:Wt,bucketAggs:ys(o.timeField)}),$=ce(L=>f({...n,...L,timeField:o.timeField},n),n,v),m=!n.metrics||!n.bucketAggs||n.query===void 0,[b,T]=(0,A.useState)(m);return(0,A.useEffect)(()=>{b&&m&&($(Ee()),T(!1))},[b,$,m]),m?null:(0,e.jsx)(qt.Provider,{value:o,children:(0,e.jsx)(Te.Provider,{value:n,children:(0,e.jsx)(Pe.Provider,{value:u,children:(0,e.jsx)(ve.Provider,{value:$,children:t})})})})},ut=t=>()=>{const i=(0,A.useContext)(t);if(!i)throw new Error("use ElasticsearchProvider first.");return i},K=ut(Te),_e=ut(qt),xs=ut(Pe),kt=t=>t.id,bs=t=>parseInt(t,10),js=()=>{const{metrics:t,bucketAggs:i}=K();return(0,A.useMemo)(()=>(Math.max(...[...t?.map(kt)||["0"],...i?.map(kt)||["0"]].map(bs))+1).toString(),[t,i])};var ue=p(55852),N=p(2543),dt=p(39268),je=p(63056),zt=p(29158);const ft=({children:t,label:i,onRemoveClick:r,onHideClick:n,hidden:o=!1})=>{const u=(0,q.of)($s);return(0,e.jsxs)(dt.C,{children:[(0,e.jsx)(je.e,{children:(0,e.jsxs)(M.c,{width:17,as:"div",children:[(0,e.jsx)("span",{children:i}),(0,e.jsxs)("span",{className:u.iconWrapper,children:[n&&(0,e.jsx)(zt.K,{name:o?"eye-slash":"eye",onClick:n,size:"sm","aria-pressed":o,className:u.icon,tooltip:"Hide row"}),(0,e.jsx)(zt.K,{name:"trash-alt",size:"sm",className:u.icon,onClick:r||N.noop,disabled:!r,tooltip:"Remove row"})]})]})}),t]})},$s=t=>({iconWrapper:(0,I.css)`
      display: flex;
    `,icon:(0,I.css)`
      color: ${t.colors.text.secondary};
      margin-left: ${t.spacing(.25)};
    `});var gt=p(38401),Ke=p(83684),re=p(75505);const pt=t=>W[t.type].requiresField,Ht=["date_histogram","histogram","terms","filters","geohash_grid","nested"],Fs=t=>Ht.includes(t),Ut=t=>{if(wt(t))switch(t){case"cardinality":return[];case"top_metrics":return["number"];default:return["number"]}if(Fs(t))switch(t){case"date_histogram":return["date"];case"geohash_grid":return["geo_point"];case"histogram":return["number"];default:return[]}return[]},Ss=({text:t})=>({label:t,value:t}),Ge=t=>{const i=_e(),r=xs(),n=Array.isArray(t)?t:Ut(t);let o;return async u=>(o||(o=await(0,re.s)(i.getFields(n,r))),o.filter(({text:f})=>u===void 0||f.includes(u)).map(Ss))},me=(0,I.css)`
  min-width: 150px;
`;var Kt=p(14578);const a=(t,i)=>({wrapper:(0,I.css)`
      max-width: 500px;
      display: flex;
      flex-direction: column;
    `,settingsWrapper:(0,I.css)`
      padding-top: ${t.spacing(.5)};
    `,icon:(0,I.css)`
      margin-right: ${t.spacing(.5)};
    `,button:(0,I.css)`
      justify-content: start;
      ${i&&(0,I.css)`
        color: ${t.colors.text.disabled};
      `}
    `}),w=({label:t,children:i,hidden:r=!1})=>{const[n,o]=(0,A.useState)(!1),u=(0,q.$j)(),f=a(u,r);return(0,e.jsx)(je.e,{children:(0,e.jsxs)("div",{className:(0,I.cx)(f.wrapper),children:[(0,e.jsxs)("button",{className:(0,I.cx)("gf-form-label query-part",f.button,me),onClick:()=>o(!n),"aria-expanded":n,type:"button",children:[(0,e.jsx)(Kt.I,{name:n?"angle-down":"angle-right","aria-hidden":"true",className:f.icon}),t]}),n&&(0,e.jsx)("div",{className:f.settingsWrapper,children:i})]})})};var J=p(90182),ne=p(20333);const Ye=["1w","1M","1q","1y"];class y{constructor(i){this.timeField=i.timeField}getRangeFilter(){return{[this.timeField]:{gte:"$timeFrom",lte:"$timeTo",format:"epoch_millis"}}}buildTermsAgg(i,r,n){if(r.terms={field:i.field},!i.settings)return r;const o=i.settings?.size?parseInt(i.settings.size,10):500;if(r.terms.size=o===0?500:o,i.settings.orderBy!==void 0){r.terms.order={},i.settings.orderBy==="_term"?r.terms.order._key=i.settings.order:r.terms.order[i.settings.orderBy]=i.settings.order;const u=rt(i.settings.orderBy);if(u){for(let f of n.metrics||[])if(f.id===u){f.type==="count"?r.terms.order={_count:i.settings.order}:ge(f)&&(r.aggs={},r.aggs[f.id]={[f.type]:{field:f.field}});break}}}return i.settings.min_doc_count!==void 0&&(r.terms.min_doc_count=parseInt(i.settings.min_doc_count,10),isNaN(r.terms.min_doc_count)&&(r.terms.min_doc_count=i.settings.min_doc_count)),i.settings.missing&&(r.terms.missing=i.settings.missing),r}getDateHistogramAgg(i){const r={},n=i.settings||{};r.field=i.field||this.timeField,r.min_doc_count=n.min_doc_count||0,r.extended_bounds={min:"$timeFrom",max:"$timeTo"},r.format="epoch_millis",n.timeZone&&n.timeZone!==ct.g$.utc&&(r.time_zone=n.timeZone),n.offset!==""&&(r.offset=n.offset);const o=n.interval==="auto"?"${__interval_ms}ms":n.interval;return o!==void 0&&Ye.includes(o)?r.calendar_interval=o:r.fixed_interval=o,r}getHistogramAgg(i){return{interval:i.settings?.interval,field:i.field,min_doc_count:i.settings?.min_doc_count||0}}getFiltersAgg(i){const r={};for(let{query:n,label:o}of i.settings?.filters||[])r[o||n]={query_string:{query:n,analyze_wildcard:!0}};return r}documentQuery(i,r){return i.size=r,i.sort=[{[this.timeField]:{order:"desc",unmapped_type:"boolean"}},{_doc:{order:"desc"}}],i.script_fields={},i}build(i){i.metrics=i.metrics||[he()],i.bucketAggs=i.bucketAggs||[st()],i.timeField=this.timeField;let r,n,o,u,f;const v={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};if(i.query&&i.query!==""&&(v.query.bool.filter=[...v.query.bool.filter,{query_string:{analyze_wildcard:!0,query:i.query}}]),i.bucketAggs.length===0&&(r=i.metrics[0],!r||!(r.type==="raw_document"||r.type==="raw_data")))throw{message:"Invalid query"};if(i.metrics?.[0]?.type==="raw_document"||i.metrics?.[0]?.type==="raw_data"){r=i.metrics[0];const $=r.settings?.size?parseInt(r.settings.size,10):500;return this.documentQuery(v,$||500)}for(f=v,n=0;n<i.bucketAggs.length;n++){const $=i.bucketAggs[n],m={};switch($.type){case"date_histogram":{m.date_histogram=this.getDateHistogramAgg($);break}case"histogram":{m.histogram=this.getHistogramAgg($);break}case"filters":{m.filters={filters:this.getFiltersAgg($)};break}case"terms":{this.buildTermsAgg($,m,i);break}case"geohash_grid":{m.geohash_grid={field:$.field,precision:$.settings?.precision||xe};break}case"nested":{m.nested={path:$.field};break}}f.aggs=f.aggs||{},f.aggs[$.id]=m,f=m}for(f.aggs={},n=0;n<i.metrics.length;n++){if(r=i.metrics[n],r.type==="count")continue;const $={};let m={};if(Ie(r))if(Ne(r))if(r.pipelineVariables){for(m={buckets_path:{}},o=0;o<r.pipelineVariables.length;o++)if(u=r.pipelineVariables[o],u.name&&u.pipelineAgg&&/^\d*$/.test(u.pipelineAgg)){const b=Ce(i.metrics,u.pipelineAgg);b&&(b.type==="count"?m.buckets_path[u.name]="_count":m.buckets_path[u.name]=u.pipelineAgg)}}else continue;else if(r.field&&/^\d*$/.test(r.field)){const b=Ce(i.metrics,r.field);b&&(b.type==="count"?m={buckets_path:"_count"}:m={buckets_path:r.field})}else continue;else ge(r)&&(m={field:r.field});if(ae(r))switch(Object.entries(r.settings||{}).filter(([b,T])=>T!==null).forEach(([b,T])=>{m[b]=b==="script"?this.buildScript(We(r)):T}),r.type){case"moving_avg":m={...m,...m?.window!==void 0&&{window:this.toNumber(m.window)},...m?.predict!==void 0&&{predict:this.toNumber(m.predict)},...ds(r)&&{settings:{...m.settings,...Object.fromEntries(Object.entries(m.settings||{}).filter(([b])=>["alpha","beta","gamma","period"].includes(b)).filter(([b,T])=>T!==void 0).map(([b,T])=>[b,this.toNumber(T)]))}}};break;case"serial_diff":m={...m,...m.lag!==void 0&&{lag:this.toNumber(m.lag)}};break;case"top_metrics":m={metrics:r.settings?.metrics?.map(b=>({field:b})),size:1},r.settings?.orderBy&&(m.sort=[{[r.settings?.orderBy]:r.settings?.order}]);break}$[r.type]=m,f.aggs[r.id]=$}return v}buildScript(i){return i}toNumber(i){const r=parseFloat(`${i}`);return isNaN(r)?i:r}getTermsQuery(i){const r={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};i.query&&r.query.bool.filter.push({query_string:{analyze_wildcard:!0,query:i.query}});let n=500;i.size&&(n=i.size),r.aggs={1:{terms:{field:i.field,size:n,order:{}}}};const{orderBy:o="key",order:u=o==="doc_count"?"desc":"asc"}=i;if(["asc","desc"].indexOf(u)<0)throw{message:`Invalid query sort order ${u}`};switch(o){case"key":case"term":const f="_key";r.aggs[1].terms.order[f]=u;break;case"doc_count":r.aggs[1].terms.order._count=u;break;default:throw{message:`Invalid query sort type ${o}`}}return r}getLogsQuery(i,r){let n={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};return i.query&&n.query.bool.filter.push({query_string:{analyze_wildcard:!0,query:i.query}}),n=this.documentQuery(n,r),{...n,aggs:this.build(i).aggs,highlight:{fields:{"*":{}},pre_tags:[Dt.pre],post_tags:[Dt.post],fragment_size:2147483647}}}}const Ze=t=>({value:i})=>i===t,Zs=(t,i)=>i===void 0||t.some(Ze(i))?t:[...t,{value:i,label:i}],Oe=({options:t,value:i,onChange:r})=>{const[n,o]=(0,A.useState)(Zs(t,i)),u=f=>o([...n,{value:f,label:f}]);return{onCreateOption:f=>{u(f),r({value:f})},onChange:r,allowCustomValue:!0,options:n,value:i}},Js=[{label:"auto",value:"auto"},{label:"10s",value:"10s"},{label:"1m",value:"1m"},{label:"5m",value:"5m"},{label:"10m",value:"10m"},{label:"20m",value:"20m"},{label:"1h",value:"1h"},{label:"1d",value:"1d"},{label:"1w",value:"1w"},{label:"1M",value:"1M"},{label:"1q",value:"1q"},{label:"1y",value:"1y"}],Xs=t=>({value:i})=>i===t,_=(t,i,r)=>!r.some(Xs(t))&&t.trim().length>0,Re=(t,i)=>t.value?.startsWith(i)||!1,Is=t=>t&&Ye.includes(t)?"calendar":"fixed",As=({bucketAgg:t})=>{const i=B(),{current:r}=(0,A.useRef)((0,N.uniqueId)("es-date_histogram-")),n=(0,A.useCallback)(({value:u})=>i(H({bucketAgg:t,settingName:"interval",newValue:u})),[t,i]),o=Is(t.settings?.interval||W.date_histogram.defaultSettings?.interval);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(j.I,{label:o==="calendar"?"Calendar interval":"Fixed interval",tooltip:o==="calendar"?"Calendar-aware intervals adapt to varying day lengths, month durations, and leap seconds, considering the calendar context.":"Fixed intervals remain constant, always being multiples of SI units, independent of calendar changes.",...G,children:(0,e.jsx)(J.l6,{inputId:(0,N.uniqueId)("es-date_histogram-interval"),isValidNewOption:_,filterOption:Re,...Oe({options:Js,value:t.settings?.interval||W.date_histogram.defaultSettings?.interval,onChange:n})})}),(0,e.jsx)(j.I,{label:"Min Doc Count",...G,children:(0,e.jsx)(S.p,{id:`${r}-min_doc_count`,onBlur:u=>i(H({bucketAgg:t,settingName:"min_doc_count",newValue:u.target.value})),defaultValue:t.settings?.min_doc_count||W.date_histogram.defaultSettings?.min_doc_count})}),(0,e.jsx)(j.I,{label:"Trim Edges",...G,tooltip:"Trim the edges on the timeseries datapoints",children:(0,e.jsx)(S.p,{id:`${r}-trime_edges`,onBlur:u=>i(H({bucketAgg:t,settingName:"trimEdges",newValue:u.target.value})),defaultValue:t.settings?.trimEdges||W.date_histogram.defaultSettings?.trimEdges})}),(0,e.jsx)(j.I,{label:"Offset",...G,tooltip:"Change the start value of each bucket by the specified positive (+) or negative offset (-) duration, such as 1h for an hour, or 1d for a day",children:(0,e.jsx)(S.p,{id:`${r}-offset`,onBlur:u=>i(H({bucketAgg:t,settingName:"offset",newValue:u.target.value})),defaultValue:t.settings?.offset||W.date_histogram.defaultSettings?.offset})}),(0,e.jsx)(j.I,{label:"Timezone",...G,children:(0,e.jsx)(ne.U,{value:t.settings?.timeZone||W.date_histogram.defaultSettings?.timeZone,includeInternal:[ct.g$.utc],onChange:u=>{i(H({bucketAgg:t,settingName:"timeZone",newValue:u}))}})})]})},ht=({index:t,onAdd:i,onRemove:r,elements:n})=>(0,e.jsxs)("div",{className:(0,I.css)`
        display: flex;
      `,children:[t===0&&(0,e.jsx)(ue.$n,{variant:"secondary",fill:"text",icon:"plus",onClick:i,tooltip:"Add","aria-label":"Add"}),n.length>=2&&(0,e.jsx)(ue.$n,{variant:"secondary",fill:"text",icon:"minus",onClick:r,tooltip:"Remove","aria-label":"Remove"})]}),Je=(0,R.VP)("@bucketAggregations/filter/add"),$e=(0,R.VP)("@bucketAggregations/filter/remove"),x=(0,R.VP)("@bucketAggregations/filter/change"),Cs=(t=[],i)=>Je.match(i)?[...t,Lt()]:$e.match(i)?t.slice(0,i.payload).concat(t.slice(i.payload+1)):x.match(i)?t.map((r,n)=>n!==i.payload.index?r:i.payload.filter):t,Gt=({bucketAgg:t})=>{const{current:i}=(0,A.useRef)((0,N.uniqueId)("es-filters-")),r=B(),n=ce(o=>r(H({bucketAgg:t,settingName:"filters",newValue:o})),t.settings?.filters,Cs);return(0,A.useEffect)(()=>{t.settings?.filters?.length||n(Je())},[n,t.settings?.filters?.length]),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("div",{className:(0,I.css)`
          display: flex;
          flex-direction: column;
        `,children:t.settings?.filters.map((o,u)=>(0,e.jsxs)("div",{className:(0,I.css)`
              display: flex;
            `,children:[(0,e.jsx)(j.I,{label:"Query",labelWidth:8,children:(0,e.jsx)("div",{className:(0,I.css)`
                  width: 150px;
                `,children:(0,e.jsx)(ee.X,{placeholder:"Lucene Query",portalOrigin:"elasticsearch",onChange:f=>n(x({index:u,filter:{...o,query:f}})),query:o.query})})}),(0,e.jsx)(j.I,{label:"Label",labelWidth:8,children:(0,e.jsx)(S.p,{width:16,id:`${i}-label-${u}`,placeholder:"Label",onBlur:f=>n(x({index:u,filter:{...o,label:f.target.value}})),defaultValue:o.label})}),(0,e.jsx)(ht,{index:u,elements:t.settings?.filters||[],onAdd:()=>n(Je()),onRemove:()=>n($e(u))})]},u))})})},Yt=({bucketAgg:t})=>{const{metrics:i}=K(),r=ws(i),{current:n}=(0,A.useRef)((0,N.uniqueId)("es-terms-")),o=B();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(j.I,{label:"Order",...G,children:(0,e.jsx)(J.l6,{inputId:`${n}-order`,onChange:u=>o(H({bucketAgg:t,settingName:"order",newValue:u.value})),options:De,value:t.settings?.order||W.terms.defaultSettings?.order})}),(0,e.jsx)(j.I,{label:"Size",...G,children:(0,e.jsx)(J.l6,{inputId:`${n}-size`,...Oe({options:ms,value:t.settings?.size||W.terms.defaultSettings?.size,onChange({value:u}){o(H({bucketAgg:t,settingName:"size",newValue:u}))}})})}),(0,e.jsx)(j.I,{label:"Min Doc Count",...G,children:(0,e.jsx)(S.p,{id:`${n}-min_doc_count`,onBlur:u=>o(H({bucketAgg:t,settingName:"min_doc_count",newValue:u.target.value})),defaultValue:t.settings?.min_doc_count||W.terms.defaultSettings?.min_doc_count})}),(0,e.jsx)(j.I,{label:"Order By",...G,children:(0,e.jsx)(J.l6,{inputId:`${n}-order_by`,onChange:u=>o(H({bucketAgg:t,settingName:"orderBy",newValue:u.value})),options:r,value:t.settings?.orderBy||W.terms.defaultSettings?.orderBy})}),(0,e.jsx)(j.I,{label:"Missing",...G,children:(0,e.jsx)(S.p,{id:`${n}-missing`,onBlur:u=>o(H({bucketAgg:t,settingName:"missing",newValue:u.target.value})),defaultValue:t.settings?.missing||W.terms.defaultSettings?.missing})})]})};function le(t){return t.meta?Object.keys(t.meta).filter(r=>t.meta?.[r]).map(r=>{let n=r;return r==="std_deviation_bounds_lower"&&(n="std_lower"),r==="std_deviation_bounds_upper"&&(n="std_upper"),{label:`${be(t)} (${n})`,value:`${t.id}[${n}]`}}):[]}function Zt(t){return t.settings?.percents?t.settings.percents.map(i=>{const r=/^\d+\.\d+/.test(`${i}`)?i:`${i}.0`;return{label:`${be(t)} (${i})`,value:`${t.id}[${r}]`}}):[]}function Jt(t){return t.type!=="top_metrics"&&!Ie(t)}const ws=(t=[])=>{const i=t.filter(Jt).flatMap(r=>r.type==="extended_stats"?le(r):r.type==="percentiles"?Zt(r):{label:be(r),value:r.id});return[...Ue,...i]},Xe=t=>i=>i.value===t,Ms=t=>{const{metrics:i}=K();switch(t.type){case"terms":{const r=t.settings?.order||"desc",n=t.settings?.size||"10",o=parseInt(t.settings?.min_doc_count||"0",10),u=t.settings?.orderBy||"_term";let f="";n!=="0"&&(f=`${De.find(Xe(r))?.label} ${n}, `),o>0&&(f+=`Min Doc Count: ${o}, `),f+="Order by: ";const v=Ue.find(Xe(u));if(v)f+=v.label;else{const $=i?.find(m=>m.id===rt(u));$?f+=be($):f+="metric not found"}return n==="0"&&(f+=` (${r})`),f}case"histogram":{const r=t.settings?.interval||"1000",n=parseInt(t.settings?.min_doc_count||"1",10);return`Interval: ${r}${n>0?`, Min Doc Count: ${n}`:""}`}case"filters":return`Filter Queries (${(t.settings?.filters||W.filters.defaultSettings?.filters).length})`;case"geohash_grid":return`Precision: ${parseInt(t.settings?.precision||xe,10)}`;case"date_histogram":{const r=t.settings?.interval||"auto",n=parseInt(t.settings?.min_doc_count||"0",10),o=parseInt(t.settings?.trimEdges||"0",10);let u=`Interval: ${r}`;return n>0&&(u+=`, Min Doc Count: ${n}`),o>0&&(u+=`, Trim edges: ${o}`),u}default:return"Settings"}},G={labelWidth:18},de=({bucketAgg:t})=>{const{current:i}=(0,A.useRef)((0,N.uniqueId)("es-setting-")),r=B(),n=Ms(t);return(0,e.jsxs)(w,{label:n,children:[t.type==="terms"&&(0,e.jsx)(Yt,{bucketAgg:t}),t.type==="date_histogram"&&(0,e.jsx)(As,{bucketAgg:t}),t.type==="filters"&&(0,e.jsx)(Gt,{bucketAgg:t}),t.type==="geohash_grid"&&(0,e.jsx)(j.I,{label:"Precision",...G,children:(0,e.jsx)(S.p,{id:`${i}-geohash_grid-precision`,onBlur:o=>r(H({bucketAgg:t,settingName:"precision",newValue:o.target.value})),defaultValue:t.settings?.precision||W[t.type].defaultSettings?.precision})}),t.type==="histogram"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(j.I,{label:"Interval",...G,children:(0,e.jsx)(S.p,{id:`${i}-histogram-interval`,onBlur:o=>r(H({bucketAgg:t,settingName:"interval",newValue:o.target.value})),defaultValue:t.settings?.interval||W[t.type].defaultSettings?.interval})}),(0,e.jsx)(j.I,{label:"Min Doc Count",...G,children:(0,e.jsx)(S.p,{id:`${i}-histogram-min_doc_count`,onBlur:o=>r(H({bucketAgg:t,settingName:"min_doc_count",newValue:o.target.value})),defaultValue:t.settings?.min_doc_count||W[t.type].defaultSettings?.min_doc_count})})]})]})},Xt=Object.entries(W).map(([t,{label:i}])=>({label:i,value:t})),es=t=>({label:W[t.type].label,value:t.type}),Es=({value:t})=>{const i=B(),r=Ge(t.type);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(je.e,{children:[(0,e.jsx)(gt.Y,{className:me,options:Xt,onChange:n=>i(Bt({id:t.id,newType:n.value})),value:es(t)}),pt(t)&&(0,e.jsx)(Ke.s,{className:me,loadOptions:r,onChange:n=>i(Qt({id:t.id,newField:n.value})),placeholder:"Select Field",value:t.field})]}),(0,e.jsx)(de,{bucketAgg:t})]})},Ds=({nextId:t})=>{const i=B(),{bucketAggs:r}=K(),n=r?.length||0;return(0,e.jsx)(e.Fragment,{children:r.map((o,u)=>(0,e.jsxs)(ft,{label:u===0?"Group By":"Then By",onRemoveClick:n>1&&(()=>i(Nt(o.id))),children:[(0,e.jsx)(Es,{value:o}),u===0&&(0,e.jsx)(ue.$n,{variant:"secondary",fill:"text",icon:"plus",onClick:()=>i(Vt(t)),tooltip:"Add grouping condition","aria-label":"Add grouping condition"})]},`${o.type}-${o.id}`))})};var Fe=p(15292);const ts=(0,I.css)`
  white-space: nowrap;
`,Le=t=>({label:be(t),value:t}),Ts=t=>t.map(Le),mt=({options:t,onChange:i,className:r,value:n})=>{const o=t.find(u=>u.id===n);return(0,e.jsx)(gt.Y,{className:(0,I.cx)(r,ts),options:Ts(t),onChange:i,placeholder:"Select Metric",value:o?Le(o):void 0})};function Y({label:t,settingName:i,metric:r,placeholder:n,tooltip:o}){const u=B(),[f]=(0,A.useState)((0,N.uniqueId)("es-field-id-"));let $=r.settings?.[i]||"";return i==="script"&&($=We(r)),(0,e.jsx)(j.I,{label:t,labelWidth:16,tooltip:o,children:(0,e.jsx)(S.p,{id:f,placeholder:n,onBlur:m=>u(k({metric:r,settingName:i,newValue:m.target.value})),defaultValue:$})})}const yt=(0,R.VP)("@pipelineVariables/add"),vt=(0,R.VP)("@pipelineVariables/remove"),xt=(0,R.VP)("@pipelineVariables/rename"),ss=(0,R.VP)("@pipelineVariables/change_metric"),ye=(t=[],i)=>yt.match(i)?[...t,fe(It(t))]:vt.match(i)?t.slice(0,i.payload).concat(t.slice(i.payload+1)):xt.match(i)?t.map((r,n)=>n!==i.payload.index?r:{...r,name:i.payload.newName}):ss.match(i)?t.map((r,n)=>n!==i.payload.index?r:{...r,pipelineAgg:i.payload.newMetric}):t,is=({value:t,previousMetrics:i})=>{const r=B(),n=ce(o=>r(ot({metric:t,attribute:"pipelineVariables",newValue:o})),t.pipelineVariables,ye);return(0,A.useEffect)(()=>{t.pipelineVariables?.length||n(yt())},[n,t.pipelineVariables?.length]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:(0,I.css)`
          display: flex;
        `,children:[(0,e.jsx)(M.c,{width:16,children:"Variables"}),(0,e.jsx)("div",{className:(0,I.css)`
            display: grid;
            grid-template-columns: 1fr auto;
            row-gap: 4px;
            margin-bottom: 4px;
          `,children:t.pipelineVariables.map((o,u)=>(0,e.jsxs)(A.Fragment,{children:[(0,e.jsxs)("div",{className:(0,I.css)`
                  display: grid;
                  column-gap: 4px;
                  grid-template-columns: auto auto;
                `,children:[(0,e.jsx)(S.p,{"aria-label":"Variable name",defaultValue:o.name,placeholder:"Variable Name",onBlur:f=>n(xt({newName:f.target.value,index:u}))}),(0,e.jsx)(mt,{onChange:f=>n(ss({newMetric:f.value.id,index:u})),options:i,value:o.pipelineAgg})]}),(0,e.jsx)(ht,{index:u,elements:t.pipelineVariables||[],onAdd:()=>n(yt()),onRemove:()=>n(vt(u))})]},(0,N.uniqueId)("es-bs-")))})]}),(0,e.jsx)(Y,{label:"Script",metric:t,settingName:"script",tooltip:"Elasticsearch v5.0 and above: Scripting language is Painless. Use params.<var> to reference a variable. Elasticsearch pre-v5.0: Scripting language is per default Groovy if not changed. For Groovy use <var> to reference a variable.",placeholder:"params.var1 / params.var2"})]})},bt=({metric:t})=>{const i=B(),{current:r}=(0,A.useRef)((0,N.uniqueId)("es-moving-avg-"));return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(j.I,{label:"Model",labelWidth:16,children:(0,e.jsx)(J.l6,{inputId:`${r}-model`,onChange:n=>i(k({metric:t,settingName:"model",newValue:n.value})),options:gs,value:t.settings?.model})}),(0,e.jsx)(Y,{label:"Window",settingName:"window",metric:t,placeholder:"5"}),(0,e.jsx)(Y,{label:"Predict",settingName:"predict",metric:t}),(At(t)||tt(t)||Ve(t))&&(0,e.jsx)(j.I,{label:"Alpha",labelWidth:16,children:(0,e.jsx)(S.p,{id:`${r}-alpha`,onBlur:n=>i(k({metric:t,settingName:"settings",newValue:{...t.settings?.settings,alpha:n.target.value}})),defaultValue:t.settings?.settings?.alpha})}),(tt(t)||Ve(t))&&(0,e.jsx)(j.I,{label:"Beta",labelWidth:16,children:(0,e.jsx)(S.p,{id:`${r}-beta`,onBlur:n=>i(k({metric:t,settingName:"settings",newValue:{...t.settings?.settings,beta:n.target.value}})),defaultValue:t.settings?.settings?.beta})}),Ve(t)&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(j.I,{label:"Gamma",labelWidth:16,children:(0,e.jsx)(S.p,{id:`${r}-gamma`,onBlur:n=>i(k({metric:t,settingName:"settings",newValue:{...t.settings?.settings,gamma:n.target.value}})),defaultValue:t.settings?.settings?.gamma})}),(0,e.jsx)(j.I,{label:"Period",labelWidth:16,children:(0,e.jsx)(S.p,{id:`${r}-period`,onBlur:n=>i(k({metric:t,settingName:"settings",newValue:{...t.settings?.settings,period:n.target.value}})),defaultValue:t.settings?.settings?.period})}),(0,e.jsx)(j.I,{label:"Pad",labelWidth:16,children:(0,e.jsx)(Fe.K,{id:`${r}-pad`,onChange:n=>i(k({metric:t,settingName:"settings",newValue:{...t.settings?.settings,pad:n.target.checked}})),checked:!!t.settings?.settings?.pad})})]}),(At(t)||tt(t)||Ve(t))&&(0,e.jsx)(j.I,{label:"Minimize",labelWidth:16,children:(0,e.jsx)(Fe.K,{id:`${r}-minimize`,onChange:n=>i(k({metric:t,settingName:"minimize",newValue:n.target.checked})),checked:!!t.settings?.minimize})})]})},Ps=t=>({value:t,label:t}),E=({metric:t})=>{const i=B(),r=Ge(["number","date"]),n=Ge(t.type);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(j.I,{label:"Metrics",labelWidth:16,children:(0,e.jsx)(J.Iv,{onChange:o=>i(k({metric:t,settingName:"metrics",newValue:o.map(u=>u.value)})),loadOptions:n,value:t.settings?.metrics?.map(Ps),closeMenuOnSelect:!1,defaultOptions:!0})}),(0,e.jsx)(j.I,{label:"Order",labelWidth:16,children:(0,e.jsx)(J.l6,{onChange:o=>i(k({metric:t,settingName:"order",newValue:o.value})),options:De,value:t.settings?.order})}),(0,e.jsx)(j.I,{label:"Order By",labelWidth:16,className:(0,I.css)`
          & > div {
            width: 100%;
          }
        `,children:(0,e.jsx)(Ke.s,{className:(0,I.css)`
            margin-right: 0;
          `,loadOptions:r,onChange:o=>i(k({metric:t,settingName:"orderBy",newValue:o.value})),placeholder:"Select Field",value:t.settings?.orderBy})})]})},jt=t=>i=>i.value===t,s=t=>{switch(t.type){case"cardinality":return`Precision threshold: ${t.settings?.precision_threshold||""}`;case"percentiles":return t.settings?.percents&&t.settings?.percents?.length>=1?`Values: ${t.settings?.percents}`:"Percents: Default";case"extended_stats":{const i=Object.entries(t.meta||{}).map(([r,n])=>n&&Et.find(jt(r))?.label).filter(Boolean);return`Stats: ${i.length>0?i.join(", "):"None selected"}`}case"raw_document":case"raw_data":return`Size: ${t.settings?.size||500}`;default:return"Options"}},l={labelWidth:16},c=({metric:t,previousMetrics:i})=>{const{current:r}=(0,A.useRef)((0,N.uniqueId)("es-setting-")),n=B(),o=s(t),u=(0,A.useId)(),f=(0,A.useId)(),v=(0,A.useId)(),$=[{value:"second",label:"Second"},{value:"minute",label:"Minute"},{value:"hour",label:"Hour"},{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"},{value:"quarter",label:"Quarter"},{value:"Year",label:"Year"}],m=[{value:"sum",label:"Sum"},{value:"value_count",label:"Value count"}];return(0,e.jsxs)(w,{label:o,hidden:t.hide,children:[t.type==="derivative"&&(0,e.jsx)(Y,{label:"Unit",metric:t,settingName:"unit"}),t.type==="serial_diff"&&(0,e.jsx)(Y,{label:"Lag",metric:t,settingName:"lag",placeholder:"1"}),t.type==="cumulative_sum"&&(0,e.jsx)(Y,{label:"Format",metric:t,settingName:"format"}),t.type==="moving_avg"&&(0,e.jsx)(bt,{metric:t}),t.type==="moving_fn"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Y,{label:"Window",metric:t,settingName:"window"}),(0,e.jsx)(Y,{label:"Script",metric:t,settingName:"script"}),(0,e.jsx)(Y,{label:"Shift",metric:t,settingName:"shift"})]}),t.type==="top_metrics"&&(0,e.jsx)(E,{metric:t}),t.type==="bucket_script"&&(0,e.jsx)(is,{value:t,previousMetrics:i}),(t.type==="raw_data"||t.type==="raw_document")&&(0,e.jsx)(j.I,{label:"Size",...l,htmlFor:u,children:(0,e.jsx)(S.p,{id:u,onBlur:b=>n(k({metric:t,settingName:"size",newValue:b.target.value})),defaultValue:t.settings?.size??Q.raw_data.defaults.settings?.size})}),t.type==="logs"&&(0,e.jsx)(Y,{label:"Limit",metric:t,settingName:"limit",placeholder:"500"}),t.type==="cardinality"&&(0,e.jsx)(Y,{label:"Precision Threshold",metric:t,settingName:"precision_threshold"}),t.type==="extended_stats"&&(0,e.jsxs)(e.Fragment,{children:[Et.map(b=>(0,e.jsx)(g,{stat:b,onChange:T=>n(_t({metric:t,meta:b.value,newValue:T})),value:t.meta?.[b.value]!==void 0?!!t.meta?.[b.value]:!!Q.extended_stats.defaults.meta?.[b.value]},b.value)),(0,e.jsx)(Y,{label:"Sigma",metric:t,settingName:"sigma",placeholder:"3"})]}),t.type==="percentiles"&&(0,e.jsx)(j.I,{label:"Percentiles",...l,children:(0,e.jsx)(S.p,{id:`${r}-percentiles-percents`,onBlur:b=>n(k({metric:t,settingName:"percents",newValue:b.target.value.split(",").filter(Boolean)})),defaultValue:t.settings?.percents||Q.percentiles.defaults.settings?.percents,placeholder:"1,5,25,50,75,95,99"})}),t.type==="rate"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(j.I,{label:"Unit",...l,"data-testid":"unit-select",htmlFor:f,children:(0,e.jsx)(J.l6,{id:f,onChange:b=>n(k({metric:t,settingName:"unit",newValue:b.value})),options:$,value:t.settings?.unit})}),(0,e.jsx)(j.I,{label:"Mode",...l,"data-testid":"mode-select",htmlFor:v,children:(0,e.jsx)(J.l6,{id:v,onChange:b=>n(k({metric:t,settingName:"mode",newValue:b.value})),options:m,value:t.settings?.unit})})]}),Ae(t)&&(0,e.jsx)(Y,{label:"Script",metric:t,settingName:"script",placeholder:"_value * 1"}),fs(t)&&(0,e.jsx)(Y,{label:"Missing",metric:t,settingName:"missing",tooltip:`The missing parameter defines how documents that are missing a value should be treated. By default
            they will be ignored but it is also possible to treat them as if they had a value`})]})},g=({stat:t,onChange:i,value:r})=>{const[n]=(0,A.useState)((0,N.uniqueId)("es-field-id-"));return(0,A.createElement)(j.I,{label:t.label,...l,key:t.value},(0,e.jsx)(Fe.K,{id:n,onChange:o=>i(o.target.checked),value:r}))},h=({name:t,metric:i})=>{const r=[];return(0,e.jsxs)(dt.C,{children:[(0,e.jsx)(je.e,{children:(0,e.jsx)(M.c,{width:17,as:"div",children:(0,e.jsx)("span",{children:t})})}),(0,e.jsx)(c,{metric:i,previousMetrics:r})]})},D=(t,i)=>({color:i&&(0,I.css)`
        &,
        &:hover,
        label,
        a {
          color: ${i?t.colors.text.disabled:t.colors.text.primary};
        }
      `}),C=t=>({label:Q[t.type].label,value:t.type}),se=t=>!Q[t.type].isPipelineAgg,hi=(t,i)=>{const r=t.some(se);return Object.entries(Q).filter(([n,o])=>o.impliedQueryType==="metrics").filter(([n,{versionRange:o="*"}])=>i!=null?(0,Be.satisfies)(i,o):!0).filter(([n,o])=>r||!o.isPipelineAgg).map(([n,{label:o}])=>({label:o,value:n}))},mi=({value:t})=>{const i=D((0,q.$j)(),!!t.hide),r=_e(),n=K(),o=B(),u=Ge(t.type),f=async m=>{const b=await r.getDatabaseVersion();return hi(m,b)},v=(0,A.useCallback)(async()=>{const m=await u();return Ae(t)?[{label:"None"},...m]:m},[u,t]),$=n.metrics.slice(0,n.metrics.findIndex(m=>m.id===t.id));return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(je.e,{children:[(0,e.jsx)(Ke.s,{className:(0,I.cx)(i.color,me),loadOptions:()=>f($),onChange:m=>o(Me({id:t.id,type:m.value})),value:C(t)}),ge(t)&&!Ie(t)&&(0,e.jsx)(Ke.s,{className:(0,I.cx)(i.color,me),loadOptions:v,onChange:m=>o(we({id:t.id,field:m.value})),placeholder:"Select Field",value:t.field}),Ie(t)&&!Ne(t)&&(0,e.jsx)(mt,{className:(0,I.cx)(i.color,me),onChange:m=>o(we({id:t.id,field:m.value?.id})),options:$,value:t.field})]}),ae(t)&&(0,e.jsx)(c,{metric:t,previousMetrics:$})]})},yi=({nextId:t})=>{const i=B(),{metrics:r}=K(),n=r?.length||0;return(0,e.jsx)(e.Fragment,{children:r?.map((o,u)=>{switch(o.type){case"logs":return(0,e.jsx)(h,{name:"Logs",metric:o},`${o.type}-${o.id}`);case"raw_data":return(0,e.jsx)(h,{name:"Raw Data",metric:o},`${o.type}-${o.id}`);case"raw_document":return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(h,{name:"Raw Document",metric:o},`${o.type}-${o.id}`),(0,e.jsx)(U.F,{severity:"warning",title:"The 'Raw Document' query type is deprecated."})]});default:return(0,e.jsxs)(ft,{label:`Metric (${o.id})`,hidden:o.hide,onHideClick:()=>i(He(o.id)),onRemoveClick:n>1&&(()=>i(ze(o.id))),children:[(0,e.jsx)(mi,{value:o}),Q[o.type].impliedQueryType==="metrics"&&u===0&&(0,e.jsx)(ue.$n,{variant:"secondary",fill:"text",icon:"plus",onClick:()=>i(ke(t)),tooltip:"Add metric","aria-label":"Add metric"})]},`${o.type}-${o.id}`)}})})};var vi=p(94354);const xi=[{value:"metrics",label:"Metrics"},{value:"logs",label:"Logs"},{value:"raw_data",label:"Raw Data"},{value:"raw_document",label:"Raw Document"}];function bi(t){switch(t){case"logs":case"raw_data":case"raw_document":return t;case"metrics":return"count";default:throw new Error(`invalid query type: ${t}`)}}const ji=()=>{const t=K(),i=B(),r=t.metrics?.[0];if(r==null)return null;const n=Q[r.type].impliedQueryType,o=u=>{i(Me({id:r.id,type:bi(u)}))};return(0,e.jsx)(vi.z,{fullWidth:!1,options:xi,value:n,onChange:o})};function $i(t){const[i,r]=(0,A.useState)(null);return(0,A.useEffect)(()=>{let n=!1;return t.getDatabaseVersion().then(o=>{n||r(o)},o=>{console.log(o)}),()=>{n=!0}},[t]),i}const Fi=({query:t,onChange:i,onRunQuery:r,datasource:n,range:o})=>{const u=$i(n),f=u!=null&&!nt(u);return(0,e.jsxs)(vs,{datasource:n,onChange:i,onRunQuery:r,query:t,range:o||(0,z.E2)(),children:[f&&(0,e.jsx)(U.F,{title:at}),(0,e.jsx)(Si,{value:t})]})},ei=t=>({root:(0,I.css)`
    display: flex;
  `,queryItem:(0,I.css)`
    flex-grow: 1;
    margin: 0 ${t.spacing(.5)} ${t.spacing(.5)} 0;
  `}),ti=({value:t,onChange:i})=>{const r=(0,q.of)(ei);return(0,e.jsx)("div",{className:r.queryItem,children:(0,e.jsx)(ee.X,{query:t,onChange:i,placeholder:"Enter a lucene query",portalOrigin:"elasticsearch"})})},Si=({value:t})=>{const i=B(),r=js(),n=(0,A.useId)(),o=(0,q.of)(ei),u=qe(t),f=t.metrics?.every(v=>Q[v.type].impliedQueryType==="metrics");return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:o.root,children:[(0,e.jsx)(M.c,{width:17,children:"Query type"}),(0,e.jsx)("div",{className:o.queryItem,children:(0,e.jsx)(ji,{})})]}),(0,e.jsxs)("div",{className:o.root,children:[(0,e.jsx)(M.c,{width:17,children:"Lucene Query"}),(0,e.jsx)(ti,{onChange:v=>i(Ot(v)),value:t?.query}),u&&(0,e.jsx)(j.I,{label:"Alias",labelWidth:15,tooltip:"Aliasing only works for timeseries queries (when the last group is 'Date Histogram'). For all other query types this field is ignored.",htmlFor:n,children:(0,e.jsx)(S.p,{id:n,placeholder:"Alias Pattern",onBlur:v=>i(Rt(v.currentTarget.value)),defaultValue:t.alias})})]}),(0,e.jsx)(yi,{nextId:r}),f&&(0,e.jsx)(Ds,{nextId:r})]})};var Ii=p(13346),Ai=p(66025),Ci=p(68704),wi=p(77657),Mi=p(39748),_s=p(67861),Ei=p(91062),Di=p(32346),rs=p(32264),Os=p(25994),si=p(67061),Ti=p(17081),Pi=p(6709),_i=p(91890),Rs=p(29020),Ls=p(35931),Oi=p(84596),Ri=p(55882),Li=p(64078);const Vi=t=>{const{value:i,onChange:r,onDelete:n,suggestions:o,className:u}=t,f=(0,q.of)(Bi),[v,$]=Ni(i.datasourceUid),m=b=>T=>{r({...i,[b]:T.currentTarget.value})};return(0,e.jsxs)("div",{className:u,children:[(0,e.jsxs)("div",{className:f.firstRow,children:[(0,e.jsx)(j.I,{label:"Field",htmlFor:"elasticsearch-datasource-config-field",labelWidth:12,tooltip:"Can be exact field name or a regex pattern that will match on the field name.",children:(0,e.jsx)(S.p,{type:"text",id:"elasticsearch-datasource-config-field",value:i.field,onChange:m("field"),width:100})}),(0,e.jsx)(ue.$n,{variant:"destructive",title:"Remove field",icon:"times",onClick:b=>{b.preventDefault(),n()}})]}),(0,e.jsxs)(dt.C,{children:[(0,e.jsxs)("div",{className:f.urlField,children:[(0,e.jsx)(M.c,{htmlFor:"elasticsearch-datasource-internal-link",width:12,children:v?"Query":"URL"}),(0,e.jsx)(Li.l,{placeholder:v?"${__value.raw}":"http://example.com/${__value.raw}",value:i.url||"",onChange:b=>r({...i,url:b}),suggestions:o})]}),(0,e.jsx)("div",{className:f.urlDisplayLabelField,children:(0,e.jsx)(j.I,{label:"URL Label",htmlFor:"elasticsearch-datasource-url-label",labelWidth:14,tooltip:"Use to override the button label.",children:(0,e.jsx)(S.p,{type:"text",id:"elasticsearch-datasource-url-label",value:i.urlDisplayLabel,onChange:m("urlDisplayLabel")})})})]}),(0,e.jsxs)("div",{className:f.row,children:[(0,e.jsx)(j.I,{label:"Internal link",labelWidth:12,children:(0,e.jsx)(Fe.K,{label:"Internal link",value:v||!1,onChange:()=>{v&&r({...i,datasourceUid:void 0}),$(!v)}})}),v&&(0,e.jsx)(Ri.s,{tracing:!0,onChange:b=>{r({...i,datasourceUid:b.uid})},current:i.datasourceUid})]})]})};function Ni(t){const[i,r]=(0,A.useState)(!!t),n=(0,Oi.A)(t);return(0,A.useEffect)(()=>{!n&&t&&!i&&r(!0),n&&!t&&i&&r(!1)},[n,t,i]),[i,r]}const Bi=()=>({firstRow:(0,I.css)`
    display: flex;
  `,nameField:(0,I.css)`
    flex: 2;
  `,regexField:(0,I.css)`
    flex: 3;
  `,row:(0,I.css)`
    display: flex;
    align-items: baseline;
  `,urlField:(0,I.css)`
    display: flex;
    flex: 1;
  `,urlDisplayLabelField:(0,I.css)`
    flex: 1;
  `}),Qi=t=>({addButton:(0,I.css)`
      margin-right: 10px;
    `,container:(0,I.css)`
      margin-bottom: ${t.spacing(2)};
    `,dataLink:(0,I.css)`
      margin-bottom: ${t.spacing(1)};
    `}),Wi=t=>{const{value:i,onChange:r}=t,n=(0,q.of)(Qi);return(0,e.jsx)(Rs.I,{title:"Data links",description:(0,e.jsx)(Ls.H,{description:"Add links to existing fields. Links will be shown in log row details next to the field value.",suffix:"elasticsearch/#data-links",feature:"Elasticsearch data links"}),children:(0,e.jsxs)("div",{className:n.container,children:[i&&i.length>0&&(0,e.jsx)("div",{className:"gf-form-group",children:i.map((o,u)=>(0,e.jsx)(Vi,{className:n.dataLink,value:o,onChange:f=>{const v=[...i];v.splice(u,1,f),r(v)},onDelete:()=>{const f=[...i];f.splice(u,1),r(f)},suggestions:[{value:Pi.c.valueRaw,label:"Raw value",documentation:"Raw value of the field",origin:_i.$0.Value}]},u))}),(0,e.jsx)(ue.$n,{type:"button",variant:"secondary",className:n.addButton,icon:"plus",onClick:o=>{o.preventDefault();const u=[...i||[],{field:"",url:""}];r(u)},children:"Add"})]})})},Vs=[{label:"No pattern",value:"none"},{label:"Hourly",value:"Hourly",example:"[logstash-]YYYY.MM.DD.HH"},{label:"Daily",value:"Daily",example:"[logstash-]YYYY.MM.DD"},{label:"Weekly",value:"Weekly",example:"[logstash-]GGGG.WW"},{label:"Monthly",value:"Monthly",example:"[logstash-]YYYY.MM"},{label:"Yearly",value:"Yearly",example:"[logstash-]YYYY"}],qi=({value:t,onChange:i})=>(0,e.jsxs)(Rs.I,{title:"Elasticsearch details",description:(0,e.jsx)(Ls.H,{description:"Specific settings for the Elasticsearch data source.",suffix:"elasticsearch/#index-settings",feature:"Elasticsearch details"}),children:[(0,e.jsx)(j.I,{label:"Index name",htmlFor:"es_config_indexName",labelWidth:29,tooltip:"Name of your Elasticsearch index. You can use a time pattern, such as YYYY.MM.DD, or a wildcard for the index name.",children:(0,e.jsx)(S.p,{id:"es_config_indexName",value:t.jsonData.index??(t.database||""),onChange:ki(t,i),width:24,placeholder:"es-index-name",required:!0})}),(0,e.jsx)(j.I,{label:"Pattern",htmlFor:"es_config_indexPattern",labelWidth:29,tooltip:"If you're using a pattern for your index, select the type, or no pattern.",children:(0,e.jsx)(J.l6,{inputId:"es_config_indexPattern",value:Vs.find(r=>r.value===(t.jsonData.interval===void 0?"none":t.jsonData.interval)),options:Vs,onChange:Hi(t,i),width:24})}),(0,e.jsx)(j.I,{label:"Time field name",htmlFor:"es_config_timeField",labelWidth:29,tooltip:"Name of your time field. Defaults to @timestamp.",children:(0,e.jsx)(S.p,{id:"es_config_timeField",value:t.jsonData.timeField||"",onChange:Ns("timeField",t,i),width:24,placeholder:"@timestamp",required:!0})}),(0,e.jsx)(j.I,{label:"Max concurrent Shard Requests",htmlFor:"es_config_shardRequests",labelWidth:29,tooltip:"Maximum number of concurrent shards a search request can hit per node. Defaults to 5.",children:(0,e.jsx)(S.p,{id:"es_config_shardRequests",value:t.jsonData.maxConcurrentShardRequests||"",onChange:Ns("maxConcurrentShardRequests",t,i),width:24})}),(0,e.jsx)(j.I,{label:"Min time interval",htmlFor:"es_config_minTimeInterval",labelWidth:29,tooltip:(0,e.jsxs)(e.Fragment,{children:["A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example"," ",(0,e.jsx)("code",{children:"1m"})," if your data is written every minute."]}),error:"Value is not valid, you can use number with time unit specifier: y, M, w, d, h, m, s",invalid:!!t.jsonData.timeInterval&&!/^\d+(ms|[Mwdhmsy])$/.test(t.jsonData.timeInterval),children:(0,e.jsx)(S.p,{id:"es_config_minTimeInterval",value:t.jsonData.timeInterval||"",onChange:Ns("timeInterval",t,i),width:24,placeholder:"10s"})}),(0,e.jsx)(j.I,{label:"Include Frozen Indices",htmlFor:"es_config_frozenIndices",labelWidth:29,tooltip:"Include frozen indices in searches.",children:(0,e.jsx)(Fe.K,{id:"es_config_frozenIndices",value:t.jsonData.includeFrozen??!1,onChange:zi("includeFrozen",t,i)})})]}),ki=(t,i)=>r=>{i({...t,database:"",jsonData:{...t.jsonData,index:r.currentTarget.value}})},Ns=(t,i,r)=>n=>{r({...i,jsonData:{...i.jsonData,[t]:n.currentTarget.value}})},zi=(t,i,r)=>n=>{r({...i,jsonData:{...i.jsonData,[t]:n.currentTarget.checked}})},Hi=(t,i)=>r=>{const n=r.value==="none"?void 0:r.value,o=t.jsonData.index??t.database;if(!o||o.length===0||o.startsWith("[logstash-]")){let u="";if(n!==void 0){const f=Vs.find(v=>v.value===n);f&&(u=f.example??"")}i({...t,database:"",jsonData:{...t.jsonData,index:u,interval:n}})}else i({...t,jsonData:{...t.jsonData,interval:n}})};function Ui(){return 5}const Ki=t=>{const{value:i,onChange:r}=t,n=o=>u=>{r({...i,[o]:u.currentTarget.value})};return(0,e.jsxs)(Rs.I,{title:"Logs",description:(0,e.jsx)(Ls.H,{description:"Configure which fields the data source uses for log messages and log levels.",suffix:"elasticsearch/#logs",feature:"Elasticsearch log fields"}),children:[(0,e.jsx)(j.I,{label:"Message field name",labelWidth:22,tooltip:"Configure the field to be used for log messages.",children:(0,e.jsx)(S.p,{id:"es_logs-config_logMessageField",value:i.logMessageField,onChange:n("logMessageField"),placeholder:"_source",width:24})}),(0,e.jsx)(j.I,{label:"Level field name",labelWidth:22,tooltip:"Configure the field that determines the level of each log message.",children:(0,e.jsx)(S.p,{id:"es_logs-config_logLevelField",value:i.logLevelField,onChange:n("logLevelField"),width:24})})]})},Gi=t=>({...t,jsonData:{...t.jsonData,timeField:t.jsonData.timeField||"@timestamp",maxConcurrentShardRequests:t.jsonData.maxConcurrentShardRequests||Ui(),logMessageField:t.jsonData.logMessageField||"",logLevelField:t.jsonData.logLevelField||"",includeFrozen:t.jsonData.includeFrozen??!1}}),Yi=t=>!!t.jsonData.timeField&&!!t.jsonData.maxConcurrentShardRequests&&t.jsonData.logMessageField!==void 0&&t.jsonData.logLevelField!==void 0,Zi=t=>{const{options:i,onOptionsChange:r}=t;(0,A.useEffect)(()=>{Yi(i)||r(Gi(i))},[r,i]);const n=(0,Ai.pe)({config:i,onChange:r});return rs.$.sigV4AuthEnabled&&(n.customMethods=[{id:"custom-sigv4",label:"SigV4 auth",description:"AWS Signature Version 4 authentication",component:(0,e.jsx)(Ii._r,{inExperimentalAuthComponent:!0,...t})}],n.selectedMethod=i.jsonData.sigV4Auth?"custom-sigv4":n.selectedMethod),(0,e.jsxs)(e.Fragment,{children:[i.access==="direct"&&(0,e.jsx)(U.F,{title:"Error",severity:"error",children:"Browser access mode in the Elasticsearch datasource is no longer available. Switch to server access mode."}),(0,e.jsx)(Ci.I,{dataSourceName:"Elasticsearch",docsLink:"https://grafana.com/docs/grafana/latest/datasources/elasticsearch",hasRequiredFields:!1}),(0,e.jsx)(Os.c,{spacing:4}),(0,e.jsx)(wi.u,{config:i,onChange:r,urlPlaceholder:"http://localhost:9200"}),(0,e.jsx)(Os.c,{spacing:4}),(0,e.jsx)(Mi.N,{...n,onAuthMethodSelect:o=>{r({...i,basicAuth:o===_s.q.BasicAuth,withCredentials:o===_s.q.CrossSiteCredentials,jsonData:{...i.jsonData,sigV4Auth:o==="custom-sigv4",oauthPassThru:o===_s.q.OAuthForward}})}}),(0,e.jsx)(Os.c,{spacing:4}),(0,e.jsx)(Ei.A,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source.",isCollapsible:!0,isInitiallyOpen:!0,children:(0,e.jsxs)(si.B,{gap:5,direction:"column",children:[(0,e.jsx)(Di.g,{config:i,onChange:r}),rs.$.secureSocksDSProxyEnabled&&(0,e.jsx)(Ti.Y,{options:i,onOptionsChange:r}),(0,e.jsx)(qi,{value:i,onChange:r}),(0,e.jsx)(Ki,{value:i.jsonData,onChange:o=>r({...i,jsonData:o})}),(0,e.jsx)(Wi,{value:i.jsonData.dataLinks,onChange:o=>{r({...i,jsonData:{...i.jsonData,dataLinks:o}})}})]})})]})};var Ji=p(51553),ns=p(65474),as=p(62467),Bs=p(66847),ii=p(69862),Xi=p(2174),er=p(41560),tr=p(57532),$t=p(81160),sr=p(59099),ie=p(9557),ir=p(65879),Qs=p(41987),X=p(47232),rr=p(26657),nr=p(72574),ar=p(19347);const ri={Hourly:{startOf:"hour",amount:"hours"},Daily:{startOf:"day",amount:"days"},Weekly:{startOf:"isoWeek",amount:"weeks"},Monthly:{startOf:"month",amount:"months"},Yearly:{startOf:"year",amount:"years"}};class lr{constructor(i,r){this.pattern=i,this.interval=r,this.dateLocale="en"}getIndexForToday(){return this.interval?(0,X.yT)().locale(this.dateLocale).format(this.pattern):this.pattern}getIndexList(i,r){if(!this.interval)return this.pattern;const o=ri[this.interval],u=(0,X.KQ)(i||(0,X.KQ)(r).add(-7,o.amount)).utc().startOf(o.startOf),f=(0,X.KQ)(r||(0,X.KQ)(i).add(7,o.amount)).utc().startOf(o.startOf).valueOf(),v=[];for(;u.valueOf()<=f;)v.push(u.locale(this.dateLocale).format(this.pattern)),u.add(1,o.amount);return v}}var ls=p(73372);class or extends F.Is{constructor(i,r){super(),this.datasource=i,Object.assign(this,r)}importFromAbstractQuery(i){return{metrics:[{id:"1",type:"logs"}],query:this.getElasticsearchQuery(i.labelMatchers),refId:i.refId}}getElasticsearchQuery(i){return i.map(r=>{switch(r.operator){case ls.D_.Equal:return r.name+':"'+r.value+'"';case ls.D_.NotEqual:return"-"+r.name+':"'+r.value+'"';case ls.D_.EqualRegEx:return r.name+":/"+r.value+"/";case ls.D_.NotEqualRegEx:return"-"+r.name+":/"+r.value+"/"}}).join(" AND ")}}var cr=p(9e4),os=p(81580);function ur(t){const i=t.annotation,r=t.onAnnotationChange;return(0,e.jsxs)(si.B,{direction:"column",gap:5,children:[(0,e.jsx)("div",{children:(0,e.jsx)(ti,{value:i.target?.query,onChange:n=>{const u={...i.target??{refId:"annotation_query"},query:n};r({...i,target:u})}})}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h6",{children:"Field mappings"}),(0,e.jsxs)(cr.U,{children:[(0,e.jsx)(os.c,{label:"Time",children:(0,e.jsx)(S.p,{type:"text",placeholder:"@timestamp",value:i.timeField,onChange:n=>{r({...i,timeField:n.currentTarget.value})}})}),(0,e.jsx)(os.c,{label:"Time End",children:(0,e.jsx)(S.p,{type:"text",value:i.timeEndField,onChange:n=>{r({...i,timeEndField:n.currentTarget.value})}})}),(0,e.jsx)(os.c,{label:"Text",children:(0,e.jsx)(S.p,{type:"text",value:i.textField,onChange:n=>{r({...i,textField:n.currentTarget.value})}})}),(0,e.jsx)(os.c,{label:"Tags",children:(0,e.jsx)(S.p,{type:"text",placeholder:"tags",value:i.tagsField,onChange:n=>{r({...i,tagsField:n.currentTarget.value})}})})]})]}),(0,e.jsx)("div",{})]})}function dr(t){return!t||typeof t!="object"?!1:"meta"in t}var et=p(94601);function cs(t,i,r,n=""){return ni(t,i,r,n)!==null}function ni(t,i,r,n=""){const o=`${n}${et.term.escape(i)}`;r=et.phrase.escape(r);let u=ui(t);return u?Ws(u,o,r):null}function Ws(t,i,r){return Object.keys(t).length===0?null:ci(t.left)?Ws(t.left,i,r):us(t.left)&&t.left.field===i&&t.left.term===r?t.left:zs(t)?null:us(t.right)&&t.right.field===i&&t.right.term===r?t.right:Hs(t.right)?Ws(t.right,i,r):null}function Ft(t,i,r,n=""){if(cs(t,i,r,n))return t;i=oi(i),r=ks(r);const o=`${n}${i}:"${r}"`;return ai(t,o)}function ai(t,i,r="AND"){return i?t.trim()===""?i:`${t} ${r} ${i}`:t}function fr(t,i){if(!i.key||!i.value)return t;if(i={...i,value:i.value.toString()},["=","!="].includes(i.operator))return Ft(t,i.key,i.value,i.operator==="="?"":"-");const n=oi(i.key),o=ks(i.value);let u="";switch(i.operator){case"=~":u=`${n}:/${o}/`;break;case"!~":u=`-${n}:/${o}/`;break;case">":u=`${n}:>${o}`;break;case"<":u=`${n}:<${o}`;break}return ai(t,u)}function li(t,i,r,n=""){const o=ni(t,i,r,n),u=ui(t);return!o||!u?t:et.toString(qs(u,o))}function qs(t,i){return Object.keys(t).length===0?t:ci(t.left)?(t.left=qs(t.left,i),t):us(t.left)&&(0,N.isEqual)(t.left,i)?(Object.assign(t,{left:void 0,operator:void 0,right:void 0},"right"in t?t.right:{}),t):zs(t)?t:us(t.right)&&(0,N.isEqual)(t.right,i)?(Object.assign(t,{right:void 0,operator:void 0}),t):(Hs(t.right)&&(t.right=qs(t.right,i)),t)}function oi(t){return et.term.escape(t)}function ks(t){return t=t.replace(/\\/g,"\\\\"),et.phrase.escape(t)}function gr(t){return t.replace(/(\w+)\s(:)/gi,"$1$2")}function zs(t){return!t||typeof t!="object"?!1:"left"in t&&!("right"in t)}function Hs(t){return!t||typeof t!="object"?!1:"left"in t&&"right"in t}function ci(t){return zs(t)||Hs(t)}function us(t){return!!(t&&typeof t=="object"&&"term"in t)}function ui(t){try{return et.parse(gr(t))}catch{return null}}function di(t,i,r=!0){const n=`"${ks(i)}"`;return t.trim()?`${t} ${r?"AND":"NOT"} ${n}`:`${r?"":"NOT "}${n}`}var Us=p(14110),pr=p(45622);const hr=({payload:{dashboardId:t,orgId:i,grafanaVersion:r,queries:n}})=>{try{const o=n[pr.id]?.filter(O=>!O.hide);if(!o?.length)return;const u=o.filter(yr),f=o.filter(O=>!!O.query),v=o.filter(O=>St(O)==="logs"),$=o.filter(O=>St(O)==="metric"),m=o.filter(O=>St(O)==="raw_data"),b=o.filter(O=>St(O)==="raw_document"),T=o.filter(mr),L={grafana_version:r,dashboard_id:t,org_id:i,queries_count:o.length,logs_queries_count:v.length,metric_queries_count:$.length,raw_data_queries_count:m.length,raw_document_queries_count:b.length,queries_with_template_variables_count:u.length,queries_with_changed_line_limit_count:T.length,queries_with_lucene_query_count:f.length};(0,Us.rR)("grafana_elasticsearch_dashboard_loaded",L)}catch(o){console.error("error in elasticsearch tracking handler",o)}},St=t=>!t.metrics||!t.metrics.length?void 0:["logs","raw_data","raw_document"].includes(t.metrics[0].type)?t.metrics[0].type:"metric",fi=t=>{if(t.metrics?.[0]?.type!=="logs")return;const i=t.metrics?.[0].settings?.limit;return i?parseInt(i,10):void 0},mr=t=>{const i=fi(t);return i!==void 0&&i!==500},yr=t=>lt.test(t.query??""),vr=t=>!!t.startsWith(gi);function xr(t,i,r){const{targets:n,app:o}=i;if(!(o===Qs.Jk.Dashboard||o===Qs.Jk.PanelViewer))for(const u of n){if(vr(u.refId))return;(0,Us.rR)("grafana_elasticsearch_query_executed",{app:o,grafana_version:rs.$.buildInfo.version,with_lucene_query:!!u.query,query_type:St(u),line_limit:fi(u),alias:u.alias,has_error:t.error!==void 0,has_data:t.data.some(f=>f.length>0),simultaneously_sent_query_count:n.length,time_range_from:i?.range?.from?.toISOString(),time_range_to:i?.range?.to?.toISOString(),time_taken:Date.now()-r.getTime()})}}function br(t){(0,Us.rR)("grafana_elasticsearch_annotation_query_executed",{grafana_version:rs.$.buildInfo.version,has_target_query:!!t.target?.query,has_query:!!t.query,has_time_field:!!t.timeField,has_time_end_field:!!t.timeEndField,has_tags_field:!!t.tagsField,has_text_field:!!t.textField,has_index:!!t.index})}const Er={filters:[]},Dr={pipelineVariables:[]},Tr={bucketAggs:[],metrics:[]},jr=t=>t&&typeof t=="object"&&"responses"in t&&Array.isArray(t.responses)&&t.responses.find(i=>typeof i=="object"&&i!==null&&"hits"in i&&typeof i.hits=="object"&&i.hits!==null&&"hits"in i.hits&&Array.isArray(i.hits.hits)),$r=t=>t&&typeof t=="object"&&"responses"in t&&Array.isArray(t.responses)&&t.responses.find(i=>typeof i=="object"&&i!==null&&"aggregations"in i&&typeof i.aggregations=="object"&&i.aggregations!==null&&Object.keys(i.aggregations).length>0),gi="log-volume-",pi="log-sample-",Fr=["_index","_type","_id","_source","_size","_field_names","_ignored","_routing","_meta"];class Sr extends rr.iy{constructor(i,r=(0,nr.w)()){super(i),this.templateSrv=r,this.getLogRowContext=async(o,u)=>{const f=this.makeLogContextDataRequest(o,u);return(0,re.s)(this.query(f).pipe((0,Bs.W)(v=>{throw{message:"Error during context query. Please check JS console logs.",status:v.status,statusText:v.statusText}})))},this.makeLogContextDataRequest=(o,u)=>{const f=u?.direction||ie.ZF.Backward,v={type:"logs",id:"1",settings:{limit:u?.limit?u?.limit.toString():"10",sortDirection:f===ie.ZF.Backward?"desc":"asc",searchAfter:o.dataFrame.fields.find(O=>O.name==="sort")?.values[o.rowIndex]??[o.timeEpochMs]}},$={refId:`log-context-${o.dataFrame.refId}-${f}`,metrics:[v],query:""},m=Cr(o.timeEpochMs,f,this.intervalPattern),b={from:m.from,to:m.to,raw:m},T=ir.calculateInterval(b,1);return{requestId:`log-context-request-${o.dataFrame.refId}-${u?.direction}`,targets:[$],interval:T.interval,intervalMs:T.intervalMs,range:b,scopedVars:{},timezone:"UTC",app:Qs.Jk.Explore,startTime:Date.now(),hideFromInspector:!0}},this.basicAuth=i.basicAuth,this.withCredentials=i.withCredentials,this.url=i.url,this.name=i.name,this.isProxyAccess=i.access==="proxy";const n=i.jsonData||{};this.index=n.index??i.database??"",this.timeField=n.timeField,this.indexPattern=new lr(this.index,n.interval),this.intervalPattern=n.interval,this.interval=n.timeInterval,this.maxConcurrentShardRequests=n.maxConcurrentShardRequests,this.queryBuilder=new y({timeField:this.timeField}),this.logLevelField=n.logLevelField||"",this.dataLinks=n.dataLinks||[],this.includeFrozen=n.includeFrozen??!1,this.databaseVersion=null,this.annotations={QueryEditor:ur},this.logLevelField===""&&(this.logLevelField=void 0),this.languageProvider=new or(this)}getResourceRequest(i,r,n){return this.getResource(i,r,n)}postResourceRequest(i,r,n){const o=n??{};return o.headers=o.headers??{},o.headers["content-type"]="application/x-ndjson",this.postResource(i,r,o)}async importFromAbstractQueries(i){return i.map(r=>this.languageProvider.importFromAbstractQuery(r))}requestAllIndices(i=(0,z.E2)()){let r=this.indexPattern.getIndexList(i.from,i.to);Array.isArray(r)||(r=[this.indexPattern.getIndexForToday()]);const n="_mapping",o=r.map(v=>(v=v.replace(/\/$/,""),v===""?n:`${v}/${n}`)),u=7,f=o.length;return(0,Ji.c)({initialState:0,condition:v=>v<Math.min(f,u),iterate:v=>v+1}).pipe((0,ii.Z)(v=>{const $=o[f-v-1];return(0,ns.H)(this.getResource($)).pipe((0,Bs.W)(m=>(0,as.of)({err:m})))}),(0,Xi.j)(v=>v?.err?.status===404),(0,er.v)(()=>"Could not find an available index for this time range."),(0,tr.$)(),(0,$t.T)(v=>{if(v.err)throw v.err;return v}))}annotationQuery(i){const r=this.prepareAnnotationRequest(i);br(i.annotation);const n=(0,ns.H)(this.postResourceRequest("_msearch",r));return(0,re.s)(n.pipe((0,$t.T)(o=>{if(!jr(o))return[];const u=o?.responses[0].hits?.hits??[];return this.processHitsToAnnotationEvents(i.annotation,u)})))}prepareAnnotationRequest(i){const r=i.annotation,n=r.timeField||"@timestamp",o=r.timeEndField||null,$=i.dashboard.getVariables().filter(Se=>Se.type==="adhoc").filter(Se=>Se.datasource?.uid===r.datasource.uid).map(Se=>Se.filters).flat(),m=r.query??r.target?.query??"",b=[],T={};if(T[n]={from:i.range.from.valueOf(),to:i.range.to.valueOf(),format:"epoch_millis"},b.push({range:T}),o){const Se={};Se[o]={from:i.range.from.valueOf(),to:i.range.to.valueOf(),format:"epoch_millis"},b.push({range:Se})}const L=this.interpolateLuceneQuery(m),O=this.addAdHocFilters(L,$),Z={bool:{filter:[{bool:{should:b,minimum_should_match:1}}]}};O&&Z.bool.filter.push({query_string:{query:O}});const Mr={query:Z,size:1e4},Ks={search_type:"query_then_fetch",ignore_unavailable:!0};return r.index?Ks.index=r.index:Ks.index=this.indexPattern.getIndexList(i.range.from,i.range.to),JSON.stringify(Ks)+`
`+JSON.stringify(Mr)+`
`}processHitsToAnnotationEvents(i,r){const n=i.timeField||"@timestamp",o=i.timeEndField||null,u=i.textField||"tags",f=i.tagsField||null,v=[],$=(m,b)=>{if(!b)return;const T=b.split(".");let L=m;for(let O=0;O<T.length;O++)if(L=L[T[O]],!L)return"";return L};for(let m=0;m<r.length;m++){const b=r[m]._source;let T=$(b,n);if(typeof r[m].fields<"u"){const Z=r[m].fields;typeof Z=="object"&&((0,N.isString)(Z[n])||(0,N.isNumber)(Z[n]))&&(T=Z[n])}const L={annotation:i,time:(0,X.yT)(T).valueOf(),text:$(b,u)};if(o){const Z=$(b,o);Z&&(L.timeEnd=(0,X.yT)(Z).valueOf())}if(i.titleField){const Z=$(b,i.titleField);Z&&(L.text=Z+`
`+L.text)}const O=$(b,f);typeof O=="string"?L.tags=O.split(","):L.tags=O,v.push(L)}return v}interpolateLuceneQuery(i,r){return this.templateSrv.replace(i,r,"lucene")}interpolateVariablesInQueries(i,r,n){return i.map(o=>this.applyTemplateVariables(o,r,n))}async testDatasource(){const i=await this.getDatabaseVersion(!1),n=(i!=null?nt(i):!0)?"":`WARNING: ${at} `;return(0,re.s)(this.getFields(["date"]).pipe((0,ii.Z)(o=>(0,N.find)(o,{text:this.timeField})?(0,as.of)({status:"success",message:`${n}Data source successfully connected.`}):(0,as.of)({status:"error",message:"No date field named "+this.timeField+" found"})),(0,Bs.W)(o=>{const f=`Unable to connect with Elasticsearch${o.message?` (${o.message})`:""}. Please check the server logs for more details.`;return(0,as.of)({status:"error",message:f})})))}getQueryHeader(i,r,n){const o={search_type:i,ignore_unavailable:!0,index:this.indexPattern.getIndexList(r,n)};return JSON.stringify(o)}getQueryDisplayText(i){const r=i.metrics,n=i.bucketAggs;let o="";return i.query&&(o+="Query: "+i.query+", "),o+="Metrics: ",o+=r?.reduce((u,f)=>{let $=Q[f.type].label+"(";return ge(f)&&($+=f.field),Ne(f)&&($+=We(f).replace(new RegExp("params.","g"),"")),$+="), ",`${u} ${$}`},""),o+=n?.reduce((u,f,v)=>{const $=W[f.type];let m="";return v===0&&(m+=" Group by: "),m+=$.label+"(",pt(f)&&(m+=f.field),`${u} ${m}), `},""),i.alias&&(o+="Alias: "+i.alias),o}getSupplementaryRequest(i,r){switch(i){case ie.cF.LogsVolume:return this.getLogsVolumeDataProvider(r);case ie.cF.LogsSample:return this.getLogsSampleDataProvider(r);default:return}}getSupportedSupplementaryQueryTypes(){return[ie.cF.LogsVolume,ie.cF.LogsSample]}getSupplementaryQuery(i,r){let n=!1;switch(i.type){case ie.cF.LogsVolume:if(n=r.metrics?.length===1&&r.metrics[0].type==="logs",!n)return;const o=[],u=this.timeField??"@timestamp";return this.logLevelField&&o.push({id:"2",type:"terms",settings:{min_doc_count:"0",size:"0",order:"desc",orderBy:"_count",missing:ie.$b.unknown},field:this.logLevelField}),o.push({id:"3",type:"date_histogram",settings:{interval:"auto",min_doc_count:"0",trimEdges:"0"},field:u}),{refId:`${gi}${r.refId}`,query:r.query,metrics:[{type:"count",id:"1"}],timeField:u,bucketAggs:o};case ie.cF.LogsSample:return n=qe(r),n?i.limit?{refId:`${pi}${r.refId}`,query:r.query,metrics:[{type:"logs",id:"1",settings:{limit:i.limit.toString()}}]}:{refId:`${pi}${r.refId}`,query:r.query,metrics:[{type:"logs",id:"1"}]}:void 0;default:return}}getLogsVolumeDataProvider(i){const r=(0,N.cloneDeep)(i),n=r.targets.map(o=>this.getSupplementaryQuery({type:ie.cF.LogsVolume},o)).filter(o=>!!o);if(n.length)return{...r,targets:n}}getLogsSampleDataProvider(i){const r=(0,N.cloneDeep)(i),u=r.targets.map(f=>this.getSupplementaryQuery({type:ie.cF.LogsSample,limit:100},f)).filter(f=>!!f);if(u.length)return{...r,targets:u}}query(i){const r=new Date;return super.query(i).pipe((0,sr.M)(n=>xr(n,i,r)),(0,$t.T)(n=>(n.data.forEach(o=>{Ir(o,this.dataLinks)}),n)))}filterQuery(i){return!i.hide}isMetadataField(i){return Fr.includes(i)}getFields(i,r){const n={float:"number",double:"number",integer:"number",long:"number",date:"date",date_nanos:"date",string:"string",text:"string",scaled_float:"number",nested:"nested",histogram:"number"};return this.requestAllIndices(r).pipe((0,$t.T)(o=>{const u=(m,b)=>this.isMetadataField(b)?!1:!i||i.length===0?!0:i.includes(m.type)||i.includes(n[m.type]),f=[],v={};function $(m){for(const b in m){const T=m[b];if((0,N.isObject)(T.properties)&&(f.push(b),$(T.properties)),(0,N.isObject)(T.fields)&&(f.push(b),$(T.fields)),(0,N.isString)(T.type)){const L=f.concat(b).join(".");u(T,b)&&(v[L]={text:L,type:T.type})}}f.pop()}for(const m in o){const b=o[m];if(b&&b.mappings){const L=b.mappings.properties;$(L)}}return(0,N.map)(v,m=>m)}))}getTerms(i,r=(0,z.E2)()){const o=this.getQueryHeader("query_then_fetch",r.from,r.to);let u=JSON.stringify(this.queryBuilder.getTermsQuery(i));u=u.replace(/\$timeFrom/g,r.from.valueOf().toString()),u=u.replace(/\$timeTo/g,r.to.valueOf().toString()),u=o+`
`+u+`
`;const f=this.getMultiSearchUrl();return(0,ns.H)(this.postResourceRequest(f,u)).pipe((0,$t.T)(v=>{if(!$r(v))return[];if(!v||!v.responses[0].aggregations)return[];const $=v.responses[0].aggregations[1].buckets;return(0,N.map)($,m=>({text:m.key_as_string||m.key,value:m.key}))}))}getMultiSearchUrl(){const i=new URLSearchParams;return this.maxConcurrentShardRequests&&i.append("max_concurrent_shard_requests",`${this.maxConcurrentShardRequests}`),this.includeFrozen&&i.append("ignore_throttled","false"),("_msearch?"+i.toString()).replace(/\?$/,"")}metricFindQuery(i,r){const n=r?.range,o=JSON.parse(i);if(i){if(o.find==="fields")return o.type=this.interpolateLuceneQuery(o.type),(0,re.s)(this.getFields(o.type,n));if(o.find==="terms")return o.field=this.interpolateLuceneQuery(o.field),o.query=this.interpolateLuceneQuery(o.query),(0,re.s)(this.getTerms(o,n))}return Promise.resolve([])}getTagKeys(){return(0,re.s)(this.getFields())}getTagValues(i){return(0,re.s)(this.getTerms({field:i.key},i.timeRange))}targetContainsTemplate(i){if(this.templateSrv.containsTemplate(i.query)||this.templateSrv.containsTemplate(i.alias))return!0;if(i.bucketAggs){for(const r of i.bucketAggs)if(pt(r)&&this.templateSrv.containsTemplate(r.field)||this.objectContainsTemplate(r.settings))return!0}if(i.metrics){for(const r of i.metrics)if(ge(r)&&(r.field&&this.templateSrv.containsTemplate(r.field)||r.settings&&this.objectContainsTemplate(r.settings)||dr(r)&&this.objectContainsTemplate(r.meta)))return!0}return!1}objectContainsTemplate(i){if(typeof i=="string")return this.templateSrv.containsTemplate(i);if(!i||typeof i!="object")return!1;for(const r in i)if(Array.isArray(i[r])){for(const n of i[r])if(this.objectContainsTemplate(n))return!0}else if(this.objectContainsTemplate(i[r]))return!0;return!1}toggleQueryFilter(i,r){let n=i.query??"";switch(r.type){case"FILTER_FOR":{n=cs(n,r.options.key,r.options.value)?li(n,r.options.key,r.options.value):Ft(n,r.options.key,r.options.value);break}case"FILTER_OUT":{cs(n,r.options.key,r.options.value)&&(n=li(n,r.options.key,r.options.value)),n=Ft(n,r.options.key,r.options.value,"-");break}}return{...i,query:n}}queryHasFilter(i,r){let n=i.query??"";return cs(n,r.key,r.value)}modifyQuery(i,r){if(!r.options)return i;let n=i.query??"";switch(r.type){case"ADD_FILTER":{n=Ft(n,r.options.key,r.options.value);break}case"ADD_FILTER_OUT":{n=Ft(n,r.options.key,r.options.value,"-");break}case"ADD_STRING_FILTER":{n=di(n,r.options.value);break}case"ADD_STRING_FILTER_OUT":{n=di(n,r.options.value,!1);break}}return{...i,query:n}}getSupportedQueryModifications(){return["ADD_FILTER","ADD_FILTER_OUT","ADD_STRING_FILTER","ADD_STRING_FILTER_OUT"]}addAdHocFilters(i,r){if(!r)return i;let n=i;return r.forEach(o=>{n=fr(n,o)}),n}applyTemplateVariables(i,r,n){const o=v=>v.type==="filters"?{...v,settings:{...v.settings,filters:v.settings?.filters?.map($=>({...$,query:this.interpolateLuceneQuery($.query,r)||"*"}))}}:v,u={...i,datasource:this.getRef(),query:this.addAdHocFilters(this.interpolateLuceneQuery(i.query||"",r),n),bucketAggs:i.bucketAggs?.map(o)};return JSON.parse(this.templateSrv.replace(JSON.stringify(u),r))}getDatabaseVersionUncached(){const i=(0,ns.H)(this.getResourceRequest(""));return(0,re.s)(i).then(r=>{const n=r?.version?.number;if(typeof n!="string")return null;try{return new Be.SemVer(n)}catch(o){return console.error(o),null}},r=>(console.error(r),null))}async getDatabaseVersion(i=!0){if(i){const n=this.databaseVersion;if(n!=null)return n}const r=await this.getDatabaseVersionUncached();return this.databaseVersion=r,r}}function Ir(t,i){if(i.length)for(const r of t.fields){const n=i.filter(o=>new RegExp(o.field).test(r.name));n.length!==0&&(r.config=r.config||{},r.config.links=[...(r.config.links,n.map(Ar))])}}function Ar(t){const i=(0,ar.l)();if(t.datasourceUid){const r=i.getInstanceSettings(t.datasourceUid);return{title:t.urlDisplayLabel||"",url:"",internal:{query:{query:t.url},datasourceUid:t.datasourceUid,datasourceName:r?.name??"Data source not found"}}}else return{title:t.urlDisplayLabel||"",url:t.url}}function Cr(t,i,r){if(r){const o=ri[r];return i===ie.ZF.Forward?{from:(0,X.KQ)(t).utc(),to:(0,X.KQ)(t).add(7,o.amount).utc().startOf(o.startOf)}:{from:(0,X.KQ)(t).subtract(7,o.amount).utc().startOf(o.startOf),to:(0,X.KQ)(t).utc()}}else return i===ie.ZF.Forward?{from:(0,X.KQ)(t).utc(),to:(0,X.KQ)(t).add(7,"hours").utc()}:{from:(0,X.KQ)(t).subtract(7,"hours").utc(),to:(0,X.KQ)(t).utc()}}const wr=new F.tD(Sr).setQueryEditor(Fi).setConfigEditor(Zi);(0,P.J7)().subscribe(d.gc,hr)},27487:(oe,V)=>{V.escape=function(P){return P.replace(/[\+\-\!\(\)\{\}\[\]\^\"\?\:\\\&\|\'\/\s\*\~]/g,p)};function p(d){return"\\"+d}V.unescape=function(P){return P.replace(/\\([\+\-\!\(\)\{\}\[\]\^\"\?\:\\\&\|\'\/\s\*\~])/g,F)};function F(d,P){return P}V.escapePhrase=function(P){return P.replace(/"/g,p)},V.unescapePhrase=function(P){return P.replace(/\\(")/g,F)}},94601:(oe,V,p)=>{"use strict";var F=p(79148),d=p(27487);V.parse=F.parse.bind(F),V.toString=p(20559),V.term={escape:d.escape,unescape:d.unescape},V.phrase={escape:d.escapePhrase,unescape:d.unescapePhrase}},79148:oe=>{"use strict";function V(d,P){function e(){this.constructor=d}e.prototype=P.prototype,d.prototype=new e}function p(d,P,e,I){this.message=d,this.expected=P,this.found=e,this.location=I,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,p)}V(p,Error),p.buildMessage=function(d,P){var e={literal:function(M){return'"'+A(M.text)+'"'},class:function(M){var j="",S;for(S=0;S<M.parts.length;S++)j+=M.parts[S]instanceof Array?z(M.parts[S][0])+"-"+z(M.parts[S][1]):z(M.parts[S]);return"["+(M.inverted?"^":"")+j+"]"},any:function(M){return"any character"},end:function(M){return"end of input"},other:function(M){return M.description}};function I(M){return M.charCodeAt(0).toString(16).toUpperCase()}function A(M){return M.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(j){return"\\x0"+I(j)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(j){return"\\x"+I(j)})}function z(M){return M.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(j){return"\\x0"+I(j)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(j){return"\\x"+I(j)})}function U(M){return e[M.type](M)}function q(M){var j=new Array(M.length),S,te;for(S=0;S<M.length;S++)j[S]=U(M[S]);if(j.sort(),j.length>0){for(S=1,te=1;S<j.length;S++)j[S-1]!==j[S]&&(j[te]=j[S],te++);j.length=te}switch(j.length){case 1:return j[0];case 2:return j[0]+" or "+j[1];default:return j.slice(0,-1).join(", ")+", or "+j[j.length-1]}}function ee(M){return M?'"'+A(M)+'"':"end of input"}return"Expected "+q(d)+" but "+ee(P)+" found."};function F(d,P){P=P!==void 0?P:{};var e={},I={start:Yt},A=Yt,z=function(s){return s[0]},U=function(){return{}},q=function(s){return{operator:s}},ee=function(s,l,c,D){var h={start:s,left:l},D=D.length==0?null:D[0].right==null?D[0].left:D[0];return D!=null&&(h.operator=c==""?"<implicit>":c[0],h.right=D),h},M=function(s,l){return l},j=function(s,l,h){var g={left:s},h=h.length==0?null:h[0].right==null?h[0].left:h[0];return h!=null&&(g.operator=l==""?"<implicit>":l[0],g.right=h),g},S=function(s){return s},te="(",ce=_("(",!1),ve=")",B=_(")",!1),fe=function(s){return s[0].parenthesized=!0,s[0]},It=function(s,l){return l.field=s==null||s.label==""?"<implicit>":s.label,l.fieldLocation=s==null||s.label==""?null:s.location,l},At=function(s,l){return l.field=s.label,l.fieldLocation=s.location,l},tt=function(s,l){var c={field:s==null||s.label==""?"<implicit>":s.label,fieldLocation:s==null||s.label==""?null:s.location};for(var g in l)c[g]=l[g];return c},Ve=/^[:]/,ds=Re([":"],!1,!1),ge=function(s){return{label:s.label,location:s.location}},Ie=function(s,l,c,g){var h={term:l,quoted:!0,regex:!1,termLocation:Oe()};return c!=""&&(h.proximity=c),g!=""&&(h.boost=g),s!=""&&(h.prefix=s),h},Ne=function(s,l){var c={term:l,quoted:!1,regex:!0,termLocation:Oe()};return c},fs=function(s,l,c,g){var h={term:l.label,quoted:!1,regex:!1,termLocation:Oe()};return c!=""&&(h.similarity=c),g!=""&&(h.boost=g),s!=""&&(h.prefix=s),h},ae="\\",pe=_("\\",!1),Ae=function(s){return"\\"+s},Ct=".",wt=_(".",!1),Q=/^[^ \t\r\n\f{}()"\/\^~[\]]/,Gs=Re([" ","	","\r",`
`,"\f","{","}","(",")",'"',"/","^","~","[","]"],!0,!1),Mt=function(s){return s.join("")},Et=function(s){return{label:s.join(""),location:Oe()}},gs=/^[^: \t\r\n\f{}()"\/\^~[\]]/,Dt=Re([":"," ","	","\r",`
`,"\f","{","}","(",")",'"',"/","^","~","[","]"],!0,!1),xe='"',he=_('"',!1),st=function(s){return s.join("")},Ce="/",it=_("/",!1),Ys=function(s){return s.join("")},Tt=Is(),Be=function(s){return s},be="+",Qe=_("+",!1),rt="-",We=_("-",!1),nt="!",at=_("!",!1),qe="{",lt=_("{",!1),Pt="}",R=_("}",!1),ke="[",ze=_("[",!1),He="]",we=_("]",!1),Me="^",ot=_("^",!1),k="?",_t=_("?",!1),Ee=":",Ot=_(":",!1),Rt="&",ps=_("&",!1),hs="|",ct=_("|",!1),Lt="'",W=_("'",!1),Ue="~",De=_("~",!1),ms="*",Vt=_("*",!1),Nt=" ",Bt=_(" ",!1),Qt=function(s){return s},H=function(s){return s},ys=function(s){return s==""||s==null?.5:s},Wt="0.",qt=_("0.",!1),Te=/^[0-9]/,Pe=Re([["0","9"]],!1,!1),vs=function(s){return parseFloat("0."+s.join(""))},ut=function(s){return parseInt(s.join(""))},K="TO",_e=_("TO",!1),xs=function(s,l){return{term_min:s,term_max:l,inclusive:"both"}},kt=function(s,l){return{term_min:s,term_max:l,inclusive:"none"}},bs=function(s,l){return{term_min:s,term_max:l,inclusive:"left"}},js=function(s,l){return{term_min:s,term_max:l,inclusive:"right"}},ue=function(s){return s},N="OR NOT",dt=_("OR NOT",!1),je="AND NOT",zt=_("AND NOT",!1),ft="OR",$s=_("OR",!1),gt="AND",Ke=_("AND",!1),re="NOT",pt=_("NOT",!1),Ht="||",Fs=_("||",!1),Ut="&&",Ss=_("&&",!1),Ge=ht("whitespace"),me=/^[ \t\r\n\f]/,Kt=Re([" ","	","\r",`
`,"\f"],!1,!1),a=0,w=0,J=[{line:1,column:1}],ne=0,Ye=[],y=0,Ze;if("startRule"in P){if(!(P.startRule in I))throw new Error(`Can't start parsing from rule "`+P.startRule+'".');A=I[P.startRule]}function Zs(){return d.substring(w,a)}function Oe(){return $e(w,a)}function Js(s,l){throw l=l!==void 0?l:$e(w,a),Gt([ht(s)],d.substring(w,a),l)}function Xs(s,l){throw l=l!==void 0?l:$e(w,a),Cs(s,l)}function _(s,l){return{type:"literal",text:s,ignoreCase:l}}function Re(s,l,c){return{type:"class",parts:s,inverted:l,ignoreCase:c}}function Is(){return{type:"any"}}function As(){return{type:"end"}}function ht(s){return{type:"other",description:s}}function Je(s){var l=J[s],c;if(l)return l;for(c=s-1;!J[c];)c--;for(l=J[c],l={line:l.line,column:l.column};c<s;)d.charCodeAt(c)===10?(l.line++,l.column=1):l.column++,c++;return J[s]=l,l}function $e(s,l){var c=Je(s),g=Je(l);return{start:{offset:s,line:c.line,column:c.column},end:{offset:l,line:g.line,column:g.column}}}function x(s){a<ne||(a>ne&&(ne=a,Ye=[]),Ye.push(s))}function Cs(s,l){return new p(s,null,null,l)}function Gt(s,l,c){return new p(p.buildMessage(s,l),s,l,c)}function Yt(){var s,l,c,g;for(s=a,l=[],c=E();c!==e;)l.push(c),c=E();if(l!==e){if(c=[],g=le(),g!==e)for(;g!==e;)c.push(g),g=le();else c=e;c!==e?(w=s,l=z(c),s=l):(a=s,s=e)}else a=s,s=e;if(s===e){for(s=a,l=[],c=E();c!==e;)l.push(c),c=E();l!==e&&(w=s,l=U()),s=l,s===e&&(s=a,l=jt(),l!==e&&(w=s,l=U()),s=l)}return s}function le(){var s,l,c,g,h,D;if(s=a,l=ye(),l!==e?(c=jt(),c!==e?(w=s,l=q(l),s=l):(a=s,s=e)):(a=s,s=e),s===e){if(s=a,l=ye(),l!==e)if(c=Zt(),c!==e){for(g=[],h=ye();h!==e;)g.push(h),h=ye();if(g!==e){for(h=[],D=le();D!==e;)h.push(D),D=le();h!==e?(w=s,l=ee(l,c,g,h),s=l):(a=s,s=e)}else a=s,s=e}else a=s,s=e;else a=s,s=e;if(s===e&&(s=a,l=ye(),l!==e?(c=le(),c!==e?(w=s,l=M(l,c),s=l):(a=s,s=e)):(a=s,s=e),s===e))if(s=a,l=Zt(),l!==e){for(c=[],g=ye();g!==e;)c.push(g),g=ye();if(c!==e){for(g=[],h=le();h!==e;)g.push(h),h=le();g!==e?(w=s,l=j(l,c,g),s=l):(a=s,s=e)}else a=s,s=e}else a=s,s=e}return s}function Zt(){var s,l,c,g;if(s=a,l=ws(),l!==e){for(c=[],g=E();g!==e;)c.push(g),g=E();c!==e?(w=s,l=S(l),s=l):(a=s,s=e)}else a=s,s=e;return s===e&&(s=Jt()),s}function Jt(){var s,l,c,g,h,D,C;if(s=a,d.charCodeAt(a)===40?(l=te,a++):(l=e,y===0&&x(ce)),l!==e){for(c=[],g=E();g!==e;)c.push(g),g=E();if(c!==e){if(g=[],h=le(),h!==e)for(;h!==e;)g.push(h),h=le();else g=e;if(g!==e)if(d.charCodeAt(a)===41?(h=ve,a++):(h=e,y===0&&x(B)),h!==e){for(D=[],C=E();C!==e;)D.push(C),C=E();D!==e?(w=s,l=fe(g),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e}else a=s,s=e}else a=s,s=e;return s}function ws(){var s,l,c;return s=a,l=Xe(),l===e&&(l=null),l!==e?(c=ss(),c!==e?(w=s,l=It(l,c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(s=a,l=Xe(),l!==e?(c=Jt(),c!==e?(w=s,l=At(l,c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(s=a,l=Xe(),l===e&&(l=null),l!==e?(c=Ms(),c!==e?(w=s,l=tt(l,c),s=l):(a=s,s=e)):(a=s,s=e))),s}function Xe(){var s,l,c,g,h;if(s=a,l=Xt(),l!==e)if(Ve.test(d.charAt(a))?(c=d.charAt(a),a++):(c=e,y===0&&x(ds)),c!==e){for(g=[],h=E();h!==e;)g.push(h),h=E();g!==e?(w=s,l=ge(l),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e;return s}function Ms(){var s,l,c,g,h,D,C;if(s=a,l=bt(),l===e&&(l=null),l!==e)if(c=Es(),c!==e)if(g=Ts(),g===e&&(g=null),g!==e)if(h=mt(),h===e&&(h=null),h!==e){for(D=[],C=E();C!==e;)D.push(C),C=E();D!==e?(w=s,l=Ie(l,c,g,h),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e;else a=s,s=e;else a=s,s=e;if(s===e){if(s=a,l=bt(),l===e&&(l=null),l!==e)if(c=Ds(),c!==e){for(g=[],h=E();h!==e;)g.push(h),h=E();g!==e?(w=s,l=Ne(l,c),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e;if(s===e)if(s=a,l=bt(),l===e&&(l=null),l!==e)if(c=Xt(),c!==e)if(g=Y(),g===e&&(g=null),g!==e)if(h=mt(),h===e&&(h=null),h!==e){for(D=[],C=E();C!==e;)D.push(C),C=E();D!==e?(w=s,l=fs(l,c,g,h),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e;else a=s,s=e;else a=s,s=e}return s}function G(){var s,l,c;return s=a,d.charCodeAt(a)===92?(l=ae,a++):(l=e,y===0&&x(pe)),l!==e?(c=Le(),c!==e?(w=s,l=Ae(c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(d.charCodeAt(a)===46?(s=Ct,a++):(s=e,y===0&&x(wt)),s===e&&(Q.test(d.charAt(a))?(s=d.charAt(a),a++):(s=e,y===0&&x(Gs)))),s}function de(){var s,l,c;if(s=a,l=[],c=G(),c!==e)for(;c!==e;)l.push(c),c=G();else l=e;return l!==e&&(w=s,l=Mt(l)),s=l,s}function Xt(){var s,l,c;if(s=a,l=[],c=es(),c!==e)for(;c!==e;)l.push(c),c=es();else l=e;return l!==e&&(w=s,l=Et(l)),s=l,s}function es(){var s,l,c;return s=a,d.charCodeAt(a)===92?(l=ae,a++):(l=e,y===0&&x(pe)),l!==e?(c=Le(),c!==e?(w=s,l=Ae(c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(d.charCodeAt(a)===46?(s=Ct,a++):(s=e,y===0&&x(wt)),s===e&&(gs.test(d.charAt(a))?(s=d.charAt(a),a++):(s=e,y===0&&x(Dt)))),s}function Es(){var s,l,c,g;if(s=a,d.charCodeAt(a)===34?(l=xe,a++):(l=e,y===0&&x(he)),l!==e){for(c=[],g=Fe();g!==e;)c.push(g),g=Fe();c!==e?(d.charCodeAt(a)===34?(g=xe,a++):(g=e,y===0&&x(he)),g!==e?(w=s,l=st(c),s=l):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;return s}function Ds(){var s,l,c,g;if(s=a,d.charCodeAt(a)===47?(l=Ce,a++):(l=e,y===0&&x(it)),l!==e){if(c=[],g=ts(),g!==e)for(;g!==e;)c.push(g),g=ts();else c=e;c!==e?(d.charCodeAt(a)===47?(g=Ce,a++):(g=e,y===0&&x(it)),g!==e?(w=s,l=Ys(c),s=l):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;return s}function Fe(){var s,l,c;return s=a,l=a,y++,d.charCodeAt(a)===34?(c=xe,a++):(c=e,y===0&&x(he)),c===e&&(d.charCodeAt(a)===92?(c=ae,a++):(c=e,y===0&&x(pe))),y--,c===e?l=void 0:(a=l,l=e),l!==e?(d.length>a?(c=d.charAt(a),a++):(c=e,y===0&&x(Tt)),c!==e?(w=s,l=Be(c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(s=a,d.charCodeAt(a)===92?(l=ae,a++):(l=e,y===0&&x(pe)),l!==e?(c=Le(),c!==e?(w=s,l=Ae(c),s=l):(a=s,s=e)):(a=s,s=e)),s}function ts(){var s,l,c;return s=a,l=a,y++,d.charCodeAt(a)===47?(c=Ce,a++):(c=e,y===0&&x(it)),c===e&&(d.charCodeAt(a)===92?(c=ae,a++):(c=e,y===0&&x(pe))),y--,c===e?l=void 0:(a=l,l=e),l!==e?(d.length>a?(c=d.charAt(a),a++):(c=e,y===0&&x(Tt)),c!==e?(w=s,l=Be(c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(s=a,d.charCodeAt(a)===92?(l=ae,a++):(l=e,y===0&&x(pe)),l!==e?(c=Le(),c!==e?(w=s,l=Ae(c),s=l):(a=s,s=e)):(a=s,s=e)),s}function Le(){var s;return d.charCodeAt(a)===43?(s=be,a++):(s=e,y===0&&x(Qe)),s===e&&(d.charCodeAt(a)===45?(s=rt,a++):(s=e,y===0&&x(We)),s===e&&(d.charCodeAt(a)===33?(s=nt,a++):(s=e,y===0&&x(at)),s===e&&(d.charCodeAt(a)===40?(s=te,a++):(s=e,y===0&&x(ce)),s===e&&(d.charCodeAt(a)===41?(s=ve,a++):(s=e,y===0&&x(B)),s===e&&(d.charCodeAt(a)===123?(s=qe,a++):(s=e,y===0&&x(lt)),s===e&&(d.charCodeAt(a)===125?(s=Pt,a++):(s=e,y===0&&x(R)),s===e&&(d.charCodeAt(a)===91?(s=ke,a++):(s=e,y===0&&x(ze)),s===e&&(d.charCodeAt(a)===93?(s=He,a++):(s=e,y===0&&x(we)),s===e&&(d.charCodeAt(a)===94?(s=Me,a++):(s=e,y===0&&x(ot)),s===e&&(d.charCodeAt(a)===34?(s=xe,a++):(s=e,y===0&&x(he)),s===e&&(d.charCodeAt(a)===63?(s=k,a++):(s=e,y===0&&x(_t)),s===e&&(d.charCodeAt(a)===58?(s=Ee,a++):(s=e,y===0&&x(Ot)),s===e&&(d.charCodeAt(a)===92?(s=ae,a++):(s=e,y===0&&x(pe)),s===e&&(d.charCodeAt(a)===38?(s=Rt,a++):(s=e,y===0&&x(ps)),s===e&&(d.charCodeAt(a)===124?(s=hs,a++):(s=e,y===0&&x(ct)),s===e&&(d.charCodeAt(a)===39?(s=Lt,a++):(s=e,y===0&&x(W)),s===e&&(d.charCodeAt(a)===47?(s=Ce,a++):(s=e,y===0&&x(it)),s===e&&(d.charCodeAt(a)===126?(s=Ue,a++):(s=e,y===0&&x(De)),s===e&&(d.charCodeAt(a)===42?(s=ms,a++):(s=e,y===0&&x(Vt)),s===e&&(d.charCodeAt(a)===32?(s=Nt,a++):(s=e,y===0&&x(Bt)))))))))))))))))))))),s}function Ts(){var s,l,c;return s=a,d.charCodeAt(a)===126?(l=Ue,a++):(l=e,y===0&&x(De)),l!==e?(c=xt(),c!==e?(w=s,l=Qt(c),s=l):(a=s,s=e)):(a=s,s=e),s}function mt(){var s,l,c;return s=a,d.charCodeAt(a)===94?(l=Me,a++):(l=e,y===0&&x(ot)),l!==e?(c=yt(),c!==e?(w=s,l=H(c),s=l):(a=s,s=e)):(a=s,s=e),s}function Y(){var s,l,c;return s=a,d.charCodeAt(a)===126?(l=Ue,a++):(l=e,y===0&&x(De)),l!==e?(c=vt(),c===e&&(c=null),c!==e?(w=s,l=ys(c),s=l):(a=s,s=e)):(a=s,s=e),s}function yt(){var s;return s=vt(),s===e&&(s=xt()),s}function vt(){var s,l,c,g;if(s=a,d.substr(a,2)===Wt?(l=Wt,a+=2):(l=e,y===0&&x(qt)),l!==e){if(c=[],Te.test(d.charAt(a))?(g=d.charAt(a),a++):(g=e,y===0&&x(Pe)),g!==e)for(;g!==e;)c.push(g),Te.test(d.charAt(a))?(g=d.charAt(a),a++):(g=e,y===0&&x(Pe));else c=e;c!==e?(w=s,l=vs(c),s=l):(a=s,s=e)}else a=s,s=e;return s}function xt(){var s,l,c;if(s=a,l=[],Te.test(d.charAt(a))?(c=d.charAt(a),a++):(c=e,y===0&&x(Pe)),c!==e)for(;c!==e;)l.push(c),Te.test(d.charAt(a))?(c=d.charAt(a),a++):(c=e,y===0&&x(Pe));else l=e;return l!==e&&(w=s,l=ut(l)),s=l,s}function ss(){var s,l,c,g,h,D,C,se;if(s=a,d.charCodeAt(a)===91?(l=ke,a++):(l=e,y===0&&x(ze)),l!==e)if(c=de(),c!==e){for(g=[],h=E();h!==e;)g.push(h),h=E();if(g!==e)if(d.substr(a,2)===K?(h=K,a+=2):(h=e,y===0&&x(_e)),h!==e){if(D=[],C=E(),C!==e)for(;C!==e;)D.push(C),C=E();else D=e;D!==e?(C=de(),C!==e?(d.charCodeAt(a)===93?(se=He,a++):(se=e,y===0&&x(we)),se!==e?(w=s,l=xs(c,C),s=l):(a=s,s=e)):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;else a=s,s=e}else a=s,s=e;else a=s,s=e;if(s===e){if(s=a,d.charCodeAt(a)===123?(l=qe,a++):(l=e,y===0&&x(lt)),l!==e)if(c=de(),c!==e){for(g=[],h=E();h!==e;)g.push(h),h=E();if(g!==e)if(d.substr(a,2)===K?(h=K,a+=2):(h=e,y===0&&x(_e)),h!==e){if(D=[],C=E(),C!==e)for(;C!==e;)D.push(C),C=E();else D=e;D!==e?(C=de(),C!==e?(d.charCodeAt(a)===125?(se=Pt,a++):(se=e,y===0&&x(R)),se!==e?(w=s,l=kt(c,C),s=l):(a=s,s=e)):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;else a=s,s=e}else a=s,s=e;else a=s,s=e;if(s===e){if(s=a,d.charCodeAt(a)===91?(l=ke,a++):(l=e,y===0&&x(ze)),l!==e)if(c=de(),c!==e){for(g=[],h=E();h!==e;)g.push(h),h=E();if(g!==e)if(d.substr(a,2)===K?(h=K,a+=2):(h=e,y===0&&x(_e)),h!==e){if(D=[],C=E(),C!==e)for(;C!==e;)D.push(C),C=E();else D=e;D!==e?(C=de(),C!==e?(d.charCodeAt(a)===125?(se=Pt,a++):(se=e,y===0&&x(R)),se!==e?(w=s,l=bs(c,C),s=l):(a=s,s=e)):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;else a=s,s=e}else a=s,s=e;else a=s,s=e;if(s===e)if(s=a,d.charCodeAt(a)===123?(l=qe,a++):(l=e,y===0&&x(lt)),l!==e)if(c=de(),c!==e){for(g=[],h=E();h!==e;)g.push(h),h=E();if(g!==e)if(d.substr(a,2)===K?(h=K,a+=2):(h=e,y===0&&x(_e)),h!==e){if(D=[],C=E(),C!==e)for(;C!==e;)D.push(C),C=E();else D=e;D!==e?(C=de(),C!==e?(d.charCodeAt(a)===93?(se=He,a++):(se=e,y===0&&x(we)),se!==e?(w=s,l=js(c,C),s=l):(a=s,s=e)):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;else a=s,s=e}else a=s,s=e;else a=s,s=e}}return s}function ye(){var s,l,c,g,h;for(s=a,l=[],c=E();c!==e;)l.push(c),c=E();if(l!==e)if(c=is(),c!==e){if(g=[],h=E(),h!==e)for(;h!==e;)g.push(h),h=E();else g=e;g!==e?(w=s,l=ue(c),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e;if(s===e){for(s=a,l=[],c=E();c!==e;)l.push(c),c=E();l!==e?(c=is(),c!==e?(g=jt(),g!==e?(w=s,l=ue(c),s=l):(a=s,s=e)):(a=s,s=e)):(a=s,s=e)}return s}function is(){var s;return d.substr(a,6)===N?(s=N,a+=6):(s=e,y===0&&x(dt)),s===e&&(d.substr(a,7)===je?(s=je,a+=7):(s=e,y===0&&x(zt)),s===e&&(d.substr(a,2)===ft?(s=ft,a+=2):(s=e,y===0&&x($s)),s===e&&(d.substr(a,3)===gt?(s=gt,a+=3):(s=e,y===0&&x(Ke)),s===e&&(d.substr(a,3)===re?(s=re,a+=3):(s=e,y===0&&x(pt)),s===e&&(d.substr(a,2)===Ht?(s=Ht,a+=2):(s=e,y===0&&x(Fs)),s===e&&(d.substr(a,2)===Ut?(s=Ut,a+=2):(s=e,y===0&&x(Ss)))))))),s}function bt(){var s,l,c;for(s=a,l=[],c=E();c!==e;)l.push(c),c=E();return l!==e?(c=Ps(),c!==e?(w=s,l=ue(c),s=l):(a=s,s=e)):(a=s,s=e),s}function Ps(){var s;return d.charCodeAt(a)===43?(s=be,a++):(s=e,y===0&&x(Qe)),s===e&&(d.charCodeAt(a)===45?(s=rt,a++):(s=e,y===0&&x(We)),s===e&&(d.charCodeAt(a)===33?(s=nt,a++):(s=e,y===0&&x(at)))),s}function E(){var s,l;if(y++,s=[],me.test(d.charAt(a))?(l=d.charAt(a),a++):(l=e,y===0&&x(Kt)),l!==e)for(;l!==e;)s.push(l),me.test(d.charAt(a))?(l=d.charAt(a),a++):(l=e,y===0&&x(Kt));else s=e;return y--,s===e&&(l=e,y===0&&x(Ge)),s}function jt(){var s,l;return s=a,y++,d.length>a?(l=d.charAt(a),a++):(l=e,y===0&&x(Tt)),y--,l===e?s=void 0:(a=s,s=e),s}if(Ze=A(),Ze!==e&&a===d.length)return Ze;throw Ze!==e&&a<d.length&&x(As()),Gt(Ye,ne<d.length?d.charAt(ne):null,ne<d.length?$e(ne,ne+1):$e(ne,ne))}oe.exports={SyntaxError:p,parse:F}},20559:oe=>{"use strict";var V="<implicit>";oe.exports=function p(F){if(!F)return"";var d="";return F.start!=null&&(d+=(F.parenthesized?"(":"")+F.start+" "),F.field&&F.field!==V&&(d+=F.field+":"),F.left&&(F.parenthesized&&!F.start&&(d+="("),d+=p(F.left),F.parenthesized&&!F.right&&(d+=")")),F.operator&&(F.left&&(d+=" "),F.operator!==V&&(d+=F.operator)),F.right&&(F.operator&&F.operator!==V&&(d+=" "),d+=p(F.right),F.parenthesized&&(d+=")")),(F.term||F.term===""&&F.quoted)&&(F.prefix&&(d+=F.prefix),F.quoted?(d+='"',d+=F.term,d+='"'):F.regex?(d+="/",d+=F.term,d+="/"):d+=F.term,F.proximity!=null&&(d+="~"+F.proximity),F.boost!=null&&(d+="^"+F.boost)),F.term_min&&(F.inclusive==="both"||F.inclusive==="left"?d+="[":d+="{",d+=F.term_min,d+=" TO ",d+=F.term_max,F.inclusive==="both"||F.inclusive==="right"?d+="]":d+="}"),F.similarity&&(d+="~",F.similarity!==.5&&(d+=F.similarity)),d}},49935:(oe,V,p)=>{"use strict";p.d(V,{v:()=>P});var F=p(88483),d=p(15964);function P(e){return new F.c(function(I){(0,d.Tg)(e()).subscribe(I)})}},51553:(oe,V,p)=>{"use strict";p.d(V,{c:()=>A});var F=p(31635),d=p(58307),P=p(98820),e=p(49935),I=p(98581);function A(z,U,q,ee,M){var j,S,te,ce;arguments.length===1?(j=z,ce=j.initialState,U=j.condition,q=j.iterate,S=j.resultSelector,te=S===void 0?d.D:S,M=j.scheduler):(ce=z,!ee||(0,P.m)(ee)?(te=d.D,M=ee):te=ee);function ve(){var B;return(0,F.__generator)(this,function(fe){switch(fe.label){case 0:B=ce,fe.label=1;case 1:return!U||U(B)?[4,te(B)]:[3,4];case 2:fe.sent(),fe.label=3;case 3:return B=q(B),[3,1];case 4:return[2]}})}return(0,e.v)(M?function(){return(0,I.S)(ve(),M)}:ve)}},2174:(oe,V,p)=>{"use strict";p.d(V,{j:()=>P});var F=p(92908),d=p(64878);function P(e){return(0,F.N)(function(I,A){var z=!1,U=0;I.subscribe((0,d._)(A,function(q){return(z||(z=!e(q,U++)))&&A.next(q)}))})}}}]);

//# sourceMappingURL=8747.4212653b167a52121b0f.js.map