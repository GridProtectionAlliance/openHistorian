"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9469],{9469:(Wr,xe,v)=>{v.r(xe),v.d(xe,{plugin:()=>Lr});var gt=v(7238),ht=v(55294),bt=v(82378),a=v(68404),vt=v(5916),L=v(20308),Ne=v(54899),O=v(45253),yt=v(12580),wt=v(47694),w=v(82897),de=v.n(w),Me=v(33180);class I{static createISO8601Duration(e,s){const r=["hour","minute","h","m"];return(0,w.includes)(r,s)?`PT${e}${s[0].toUpperCase()}`:`P${e}${s[0].toUpperCase()}`}static createISO8601DurationFromInterval(e){const s=+e.slice(0,e.length-1),r=e[e.length-1];if(e.indexOf("ms")>-1)return I.createISO8601Duration(1,"m");if(e[e.length-1]==="s"){let o=s*60%60;return o<1&&(o=1),I.createISO8601Duration(o,"m")}return I.createISO8601Duration(s,r)}static findClosestTimeGrain(e,s){const r=(0,w.filter)(s,n=>n!=="auto");let o=r[0];const i=Me.intervalToMs(e);for(let n=0;n<r.length;n++)i>Me.intervalToMs(r[n])&&(n+1<r.length?o=r[n+1]:o=r[n]);return o}static createTimeGrainFromISO8601Duration(e){let s=1;e.substring(0,2)==="PT"&&(s=2);const r=e.substring(s,e.length-1),o=e.substring(e.length-1);return r+" "+I.timeUnitToText(+r,o)}static timeUnitToText(e,s){let r="";return s==="S"&&(r="second"),s==="M"&&(r="minute"),s==="H"&&(r="hour"),s==="D"&&(r="day"),e>1?r+"s":r}static createKbnUnitFromISO8601Duration(e){if(e==="auto")return"auto";let s=1;e.substring(0,2)==="PT"&&(s=2);const r=e.substring(s,e.length-1),o=e.substring(e.length-1);return r+I.timeUnitToKbn(+r,o)}static timeUnitToKbn(e,s){return s==="S"?"s":s==="M"?"m":s==="H"?"h":s==="D"?"d":""}}class P{static parseResponseValues(e,s,r){const o=[];if(!e)return o;for(let i=0;i<e.value.length;i++)if(!(0,w.find)(o,["value",(0,w.get)(e.value[i],r)])){const n=(0,w.get)(e.value[i],r),c=(0,w.get)(e.value[i],s,n);o.push({text:c,value:n})}return o}static parseResourceNames(e,s){const r=[];if(!e)return r;for(let o=0;o<e.value.length;o++)typeof e.value[o].type=="string"&&(!s||e.value[o].type.toLocaleLowerCase()===s.toLocaleLowerCase())&&r.push({text:e.value[o].name,value:e.value[o].name});return r}static parseMetadata(e,s){const r=["None","Average","Minimum","Maximum","Total","Count"],o=e?.value.find(i=>i.name.value===s);return o?{primaryAggType:o.primaryAggregationType,supportedAggTypes:o.supportedAggregationTypes||r,supportedTimeGrains:[{label:"Auto",value:"auto"},...P.parseTimeGrains(o.metricAvailabilities??[])],dimensions:P.parseDimensions(o.dimensions??[])}:{primaryAggType:"",supportedAggTypes:r,supportedTimeGrains:[],dimensions:[]}}static parseTimeGrains(e){const s=[];return e&&e.forEach(r=>{r.timeGrain&&s.push({label:I.createTimeGrainFromISO8601Duration(r.timeGrain),value:r.timeGrain})}),s}static parseDimensions(e){return e.map(s=>({label:s.localizedValue||s.value,value:s.value}))}static parseSubscriptions(e){const s=[];if(!e)return s;const r="subscriptionId",o="displayName";for(let i=0;i<e.value.length;i++)(0,w.find)(s,["value",(0,w.get)(e.value[i],r)])||s.push({text:`${(0,w.get)(e.value[i],o)}`,value:(0,w.get)(e.value[i],r)});return s}static parseSubscriptionsForSelect(e){const s=[];if(!e)return s;const r="subscriptionId",o="displayName";for(let i=0;i<e.data.value.length;i++)(0,w.find)(s,["value",(0,w.get)(e.data.value[i],r)])||s.push({label:`${(0,w.get)(e.data.value[i],o)} - ${(0,w.get)(e.data.value[i],r)}`,value:(0,w.get)(e.data.value[i],r)});return s}static parseWorkspacesForSelect(e){const s=[];if(!e)return s;const r="customerId",o="name";for(let i=0;i<e.data.value.length;i++)(0,w.find)(s,["value",(0,w.get)(e.data.value[i].properties,r)])||s.push({label:(0,w.get)(e.data.value[i],o),value:(0,w.get)(e.data.value[i].properties,r)});return s}static parseLocations(e){const s=[];if(!e)return s;for(const r of e.value)s.push({name:r.name,displayName:r.displayName,supportsLogs:void 0});return s}}const kt=(t,e)=>t.some(s=>s.options?kt(s.options,e):s.value===e),Ve=(t,e=[])=>{if(e.length===0)return[];const s=e.reduce((r,o)=>(r.add(o),r),new Set);return t.filter(r=>s.has(r.value))},St=t=>({value:t.value,label:t.text}),fe=(t,e,s)=>{const r=[...t,e],o=t.map(i=>i.value.toLowerCase()).concat(e.options.map(i=>i.value));return s&&!o.includes(s.toLowerCase())&&r.push({label:s,value:s}),r};function Ur(t){const e=[];return t.forEach(s=>{s.value!=="auto"&&e.push(rangeUtil.intervalToMs(TimegrainConverter.createKbnUnitFromISO8601Duration(s.value)))}),e}const H={azureMonitor:"azuremonitor",logAnalytics:"loganalytics",appInsights:"appinsights",resourceGraph:"resourcegraph"};function ge(t,e){return typeof t=="string"?e.multi||e.includeAll&&!e.allValue?"'"+t+"'":t:typeof t=="number"?t:(0,w.map)(t,r=>typeof t=="number"?t:"'"+r+"'").join(",")}var Y=v(35645),Xr=v(89829);const Or=Object.freeze([0,0]),jr={subscriptions:[]};var d=(t=>(t.AzureMonitor="Azure Monitor",t.AzureResourceGraph="Azure Resource Graph",t.GrafanaTemplateVariableFn="Grafana Template Variable Function",t.LocationsQuery="Azure Regions",t.LogAnalytics="Azure Log Analytics",t.MetricNamesQuery="Azure Metric Names",t.NamespacesQuery="Azure Namespaces",t.ResourceGroupsQuery="Azure Resource Groups",t.ResourceNamesQuery="Azure Resource Names",t.SubscriptionsQuery="Azure Subscriptions",t.WorkspacesQuery="Azure Workspaces",t))(d||{});const Br={allowedTimeGrainsMs:[],dimensionFilters:[],resources:[]},Hr={resources:[]};var Re=(t=>(t.Table="table",t.TimeSeries="time_series",t))(Re||{});const Jr={filters:[]};var ie=(t=>(t.Public="AzureCloud",t.China="AzureChinaCloud",t.USGovernment="AzureUSGovernment",t.None="",t))(ie||{});const Et=Symbol("Concealed client secret");function he(t){return t.jsonData.azureAuthType?t.jsonData.azureAuthType:t.jsonData.tenantId&&t.jsonData.clientId?"clientsecret":Y.v.azure.managedIdentityEnabled?"msi":"clientsecret"}function ne(){switch(Y.v.azure.cloud){case ie.Public:case ie.None:case void 0:return"azuremonitor";case ie.China:return"chinaazuremonitor";case ie.USGovernment:return"govazuremonitor";default:throw new Error(`The cloud '${Y.v.azure.cloud}' not supported.`)}}function $e(t){switch(t){case"azuremonitor":return"https://portal.azure.com";case"chinaazuremonitor":return"https://portal.azure.cn";case"govazuremonitor":return"https://portal.azure.us";default:throw new Error("The cloud not supported.")}}function We(t){switch(he(t)){case"msi":return ne();case"clientsecret":return t.jsonData.cloudName||ne()}}function zt(t){if(t.secureJsonFields.clientSecret)return Et;{const e=t.secureJsonData?.clientSecret;return typeof e=="string"&&e.length>0?e:void 0}}function At(t){switch(t.authType){case"msi":return!0;case"clientsecret":return!!(t.azureCloud&&t.tenantId&&t.clientId&&t.clientSecret)}}function Nt(t){switch(he(t)){case"msi":return Y.v.azure.managedIdentityEnabled?{authType:"msi"}:{authType:"clientsecret",azureCloud:ne()};case"clientsecret":return{authType:"clientsecret",azureCloud:t.jsonData.cloudName||ne(),tenantId:t.jsonData.tenantId,clientId:t.jsonData.clientId,clientSecret:zt(t)}}}function Mt(t,e){switch(e.authType){case"msi":if(!Y.v.azure.managedIdentityEnabled)throw new Error("Managed Identity authentication is not enabled in Grafana config.");return t={...t,jsonData:{...t.jsonData,azureAuthType:"msi"}},t;case"clientsecret":return t={...t,jsonData:{...t.jsonData,azureAuthType:"clientsecret",cloudName:e.azureCloud||ne(),tenantId:e.tenantId,clientId:e.clientId},secureJsonData:{...t.secureJsonData,clientSecret:typeof e.clientSecret=="string"?e.clientSecret:void 0},secureJsonFields:{...t.secureJsonFields,clientSecret:typeof e.clientSecret=="symbol"}},t}}var Rt=v(14835),C=v(81764),T=v(53217),J=v(31403);const N={components:{configEditor:{authType:{select:"data-testid auth-type"},azureCloud:{input:"data-testid azure-cloud"},tenantID:{input:"data-testid tenant-id"},clientID:{input:"data-testid client-id"},clientSecret:{input:"data-testid client-secret"},loadSubscriptions:{button:"data-testid load-subscriptions"},defaultSubscription:{input:"data-testid default-subscription"}},queryEditor:{header:{select:"data-testid azure-monitor-experimental-header"},resourcePicker:{select:{button:"data-testid resource-picker-select"},search:{input:"data-testid resource-picker-search"},apply:{button:"data-testid resource-picker-apply"},cancel:{button:"data-testid resource-picker-cancel"},advanced:{collapse:"data-testid resource-picker-advanced",subscription:{input:"data-testid resource-picker-subscription"},resourceGroup:{input:"data-testid resource-picker-resource-group"},namespace:{input:"data-testid resource-picker-namespace"},region:{input:"data-testid resource-picker-region"},resource:{input:"data-testid resource-picker-resource"}}},metricsQueryEditor:{metricName:{input:"data-testid metric-name"}},logsQueryEditor:{formatSelection:{input:"data-testid format-selection"}},argsQueryEditor:{container:{input:"data-testid azure-monitor-arg-query-editor"},subscriptions:{input:"data-testid azure-monitor-args-subscription"}}},variableEditor:{queryType:{input:"data-testid query-type"},subscription:{input:"data-testid subscription"},resourceGroup:{input:"data-testid resource-group"},namespace:{input:"data-testid namespace"},resource:{input:"data-testid resource"},region:{input:"data-testid region"}}}},{Input:be}=Rt.LegacyForms,Ue=[{value:"msi",label:"Managed Identity"},{value:"clientsecret",label:"App Registration"}],_=18,Ct=t=>{const{credentials:e,azureCloudOptions:s,onCredentialsChange:r,disabled:o,managedIdentityEnabled:i}=t,n=g=>{if(r){const f={...e,authType:g.value||"msi"};r(f)}},c=g=>{if(r&&e.authType==="clientsecret"){const f={...e,azureCloud:g.value};r(f)}},u=g=>{if(r&&e.authType==="clientsecret"){const f={...e,tenantId:g.target.value};r(f)}},l=g=>{if(r&&e.authType==="clientsecret"){const f={...e,clientId:g.target.value};r(f)}},m=g=>{if(r&&e.authType==="clientsecret"){const f={...e,clientSecret:g.target.value};r(f)}},h=()=>{if(r&&e.authType==="clientsecret"){const g={...e,clientSecret:""};r(g)}};return a.createElement("div",{className:"gf-form-group"},i&&a.createElement(C._,{label:"Authentication",labelWidth:_,tooltip:"Choose the type of authentication to Azure services","data-testid":N.components.configEditor.authType.select,htmlFor:"authentication-type"},a.createElement(T.Ph,{className:"width-15",value:Ue.find(g=>g.value===e.authType),options:Ue,onChange:n,disabled:o})),e.authType==="clientsecret"&&a.createElement(a.Fragment,null,s&&a.createElement(C._,{label:"Azure Cloud",labelWidth:_,tooltip:"Choose an Azure Cloud","data-testid":N.components.configEditor.azureCloud.input,htmlFor:"azure-cloud-type",disabled:o},a.createElement(T.Ph,{inputId:"azure-cloud-type","aria-label":"Azure Cloud",className:"width-15",value:s.find(g=>g.value===e.azureCloud),options:s,onChange:c})),a.createElement(C._,{label:"Directory (tenant) ID",labelWidth:_,"data-testid":N.components.configEditor.tenantID.input,htmlFor:"tenant-id"},a.createElement("div",{className:"width-15"},a.createElement(be,{"aria-label":"Tenant ID",className:"width-30",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:e.tenantId||"",onChange:u,disabled:o}))),a.createElement(C._,{label:"Application (client) ID",labelWidth:_,"data-testid":N.components.configEditor.clientID.input,htmlFor:"tenant-id"},a.createElement("div",{className:"width-15"},a.createElement(be,{className:"width-30","aria-label":"Client ID",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:e.clientId||"",onChange:l,disabled:o}))),!o&&(typeof e.clientSecret=="symbol"?a.createElement(C._,{label:"Client Secret",labelWidth:_,htmlFor:"client-secret"},a.createElement("div",{className:"width-30",style:{display:"flex",gap:"4px"}},a.createElement(be,{"aria-label":"Client Secret",placeholder:"configured",disabled:!0,"data-testid":"client-secret"}),a.createElement(J.zx,{variant:"secondary",type:"button",onClick:h,disabled:o},"Reset"))):a.createElement(C._,{label:"Client Secret",labelWidth:_,"data-testid":N.components.configEditor.clientSecret.input,htmlFor:"client-secret"},a.createElement(be,{className:"width-30","aria-label":"Client Secret",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:e.clientSecret||"",onChange:m,id:"client-secret",disabled:o})))),t.children)},Zr=null,Tt=18,Gt=t=>{const{credentials:e,disabled:s,options:r,subscriptions:o,getSubscriptions:i,onSubscriptionChange:n,onSubscriptionsChange:c}=t,u=At(e),[l,m]=(0,a.useReducer)(f=>f+1,0);(0,a.useEffect)(()=>{if(!i||!u){h([]);return}let f=!1;return i().then(y=>{f||h(y,l)}),()=>{f=!0}},[l]);const h=(f,y=!1)=>{c(f),i&&(y&&!r.subscriptionId&&f.length>0?g(f[0]):r.subscriptionId&&(f.find(b=>b.value===r.subscriptionId)||g(void 0)))},g=f=>n(f?.value);return a.createElement(a.Fragment,null,a.createElement(C._,{label:"Default Subscription",labelWidth:Tt,"data-testid":N.components.configEditor.defaultSubscription.input,htmlFor:"default-subscription"},a.createElement("div",{className:"width-30",style:{display:"flex",gap:"4px"}},a.createElement(T.Ph,{inputId:"default-subscription","aria-label":"Default Subscription",value:r.subscriptionId?o.find(f=>f.value===r.subscriptionId):void 0,options:o,onChange:g,disabled:s}),a.createElement(J.zx,{variant:"secondary",type:"button",onClick:m,disabled:!u||s,"data-testid":N.components.configEditor.loadSubscriptions.button},"Load Subscriptions"))))},Dt=[{value:"azuremonitor",label:"Azure"},{value:"govazuremonitor",label:"Azure US Government"},{value:"chinaazuremonitor",label:"Azure China"}],Ft=t=>{const{updateOptions:e,getSubscriptions:s,options:r}=t,[o,i]=(0,a.useState)([]),n=(0,a.useMemo)(()=>Nt(t.options),[t.options]),c=(m,h)=>{h||i([]),e(g=>Mt({...g,jsonData:{...g.jsonData,subscriptionId:h}},m))},u=m=>i(m),l=m=>e(h=>({...h,jsonData:{...h.jsonData,subscriptionId:m}}));return a.createElement(a.Fragment,null,a.createElement("h3",{className:"page-heading"},"Authentication"),a.createElement(Ct,{managedIdentityEnabled:Y.v.azure.managedIdentityEnabled,credentials:n,azureCloudOptions:Dt,onCredentialsChange:c,disabled:t.options.readOnly},a.createElement(Gt,{subscriptions:o,credentials:n,getSubscriptions:s,disabled:t.options.readOnly,onSubscriptionsChange:u,onSubscriptionChange:l,options:r.jsonData})))},qr=null;class Lt extends a.PureComponent{constructor(e){super(e),this.templateSrv=(0,L.J)(),this.updateOptions=s=>{const r=s(this.props.options);this.props.onOptionsChange(r),this.setState({unsaved:!0})},this.saveOptions=async()=>{this.state.unsaved&&(await(0,Ne.i)().put(`/api/datasources/${this.props.options.id}`,this.props.options).then(s=>{(0,vt.fd)(this.props,"version",s.datasource.version)}),this.setState({unsaved:!1}))},this.getSubscriptions=async()=>{await this.saveOptions();const s="?api-version=2019-03-01";try{const r=await(0,Ne.i)().fetch({url:this.baseURL+s,method:"GET"}).toPromise();return this.setState({error:void 0}),P.parseSubscriptionsForSelect(r)}catch(r){return(0,Ne.kW)(r)&&this.setState({error:{title:"Error requesting subscriptions",description:"Could not request subscriptions from Azure. Check your credentials and try again.",details:r?.data?.message}}),Promise.resolve([])}},this.state={unsaved:!1},this.baseURL=`/api/datasources/${this.props.options.id}/resources/${H.azureMonitor}/subscriptions`}render(){const{options:e,onOptionsChange:s}=this.props,{error:r}=this.state;return a.createElement(a.Fragment,null,a.createElement(Ft,{options:e,updateOptions:this.updateOptions,getSubscriptions:this.getSubscriptions}),r&&a.createElement(O.b,{severity:"error",title:r.title},a.createElement("p",null,r.description),r.details&&a.createElement("details",{style:{whiteSpace:"pre-wrap"}},r.details)),wt.vc.featureToggles.secureSocksDatasourceProxy&&a.createElement(yt.i,{options:e,onOptionsChange:s}))}}const Yr=null;var Ce=v(9405);function It(t){return(0,a.isValidElement)(t)?t:ee(t)}function ee(t){if(!t||typeof t!="object")return;if(typeof t.message=="string")return t.message;if(typeof t.data?.error?.message=="string")return t.data.error.message;const e=t.error?.data?.error?.innererror?.innererror?.message||t.error?.data?.error?.innererror?.message||t.error?.data?.error?.message||t.error?.data?.message||t.data?.message||t;if(typeof e=="string")return e;if(e&&e.toString)return e.toString()}function Xe(){const[t,e]=(0,a.useState)([]),s=(0,a.useCallback)((o,i)=>{e(n=>{const c=[...n],u=n.findIndex(([l])=>l===o);return u>-1&&c.splice(u,1),i&&c.unshift([o,i]),c})},[]);return[(0,a.useMemo)(()=>{const o=t[0];return o&&It(o[1])},[t]),s]}var M=v(26418);const Pt=({query:t,onQueryChange:e})=>{const s=(0,a.useCallback)(r=>{e({...t,azureResourceGraph:{...t.azureResourceGraph,query:r}})},[e,t]);return a.createElement(Ce.p,{value:t.azureResourceGraph?.query??"",language:"kusto",height:200,width:"100%",showMiniMap:!1,onBlur:s,onSave:s})};var Qt=v(57227);const Oe=18,W=t=>{const{labelWidth:e,inlineField:s,...r}=t;return s?a.createElement(C._,{labelWidth:e||Oe,...r}):a.createElement(M.EditorField,{width:e||Oe,...r})},xt=({query:t,subscriptions:e,variableOptionGroup:s,onQueryChange:r})=>{const[o,i]=(0,a.useState)(!1),[n,c]=(0,a.useState)([]),u=(0,a.useMemo)(()=>[...e,s],[e,s]);(0,a.useEffect)(()=>{t.subscriptions&&t.subscriptions.length>0?(c(Ve([...e,...s.options],t.subscriptions)),i(!1)):i(!0)},[t.subscriptions,e,s.options]);const l=m=>{if(!m||m.length===0)c([]),r({...t,subscriptions:[]}),i(!0);else{const h=m.map(g=>g.value??"");r({...t,subscriptions:h}),c(Ve([...e,...s.options],h)),i(!1)}};return a.createElement(W,{label:"Subscriptions","data-testid":N.components.queryEditor.argsQueryEditor.subscriptions.input},a.createElement(a.Fragment,null,a.createElement(T.NU,{isClearable:!0,value:n,inputId:"azure-monitor-subscriptions-field",onChange:l,options:u,width:38}),o?a.createElement(Qt.S,null,"At least one subscription must be chosen."):null))},je="arg-subscriptions";function Vt(t,e,s){let r=e||[];r.length===0&&s&&(r=[s]),r.length===0&&t.length&&(r=[t[0]]);const o=r.filter(n=>n.includes("$")),i=(0,w.intersection)(r,t).concat(o);return t.length&&r.length>i.length&&(r=i.length>0?i:[t[0]]),r}const Be=({query:t,datasource:e,subscriptionId:s,variableOptionGroup:r,onChange:o,setError:i})=>{const[n,c]=(0,a.useState)([]);return(0,a.useMemo)(()=>{e.getSubscriptions().then(u=>{const l=u.map(m=>({label:m.text,value:m.value,description:m.value}));c(l),i(je,void 0),o({...t,subscriptions:Vt(l.map(m=>m.value),t.subscriptions,t.subscription)})}).catch(u=>i(je,u))},[e]),a.createElement("span",{"data-testid":N.components.queryEditor.argsQueryEditor.container.input},a.createElement(M.EditorRows,null,a.createElement(M.EditorRow,null,a.createElement(M.EditorFieldGroup,null,a.createElement(xt,{subscriptions:n,query:t,datasource:e,subscriptionId:s,variableOptionGroup:r,onQueryChange:o,setError:i})))),a.createElement(Pt,{query:t,datasource:e,subscriptionId:s,variableOptionGroup:r,onQueryChange:o,setError:i}))};var S=v(9892),X=v(72648),$t=v(35029),j=v(39904),He=v(58252),Je=v(61744),Wt=v(7804);const F=t=>{const e=(0,X.l4)(),s=Ut(e,t);return a.createElement("span",{className:(0,S.cx)(s.wrapper)})};F.defaultProps={v:0,h:0,layout:"block"};const Ut=(0,Wt.B)((t,e)=>({wrapper:(0,S.css)([{paddingRight:t.spacing(e.h??0),paddingBottom:t.spacing(e.v??0)},e.layout==="inline"&&{display:"inline-block"},e.layout==="block"&&{display:"block"}])}));var Xt=v(2352);const Ot=({resources:t,onChange:e,renderAdvanced:s})=>{const[r,o]=(0,a.useState)(!!t.length&&JSON.stringify(t).includes("$"));return a.createElement("div",{"data-testid":N.components.queryEditor.resourcePicker.advanced.collapse},a.createElement(Xt.U,{collapsible:!0,label:"Advanced",isOpen:r,onToggle:()=>o(!r)},s(t,e),a.createElement(F,{v:2})))};var jt=v(19801),Bt=v(8180),Ht=v(58255),R=(t=>(t.Subscription="Subscription",t.ResourceGroup="ResourceGroup",t.Resource="Resource",t.VariableGroup="TemplateVariableGroup",t.Variable="TemplateVariable",t))(R||{});const Jt=({isOpen:t,entry:{type:e}})=>{switch(e){case R.Subscription:return a.createElement(j.J,{name:"layer-group"});case R.ResourceGroup:return a.createElement(j.J,{name:t?"folder-open":"folder"});case R.Resource:return a.createElement(j.J,{name:"cube"});case R.VariableGroup:return a.createElement(j.J,{name:"x"});case R.Variable:return a.createElement(j.J,{name:"x"});default:return null}},ce=t=>({table:(0,S.css)({width:"100%",tableLayout:"fixed"}),tableScroller:(0,S.css)({maxHeight:"50vh",overflow:"auto"}),header:(0,S.css)({background:t.colors.background.secondary}),row:(0,S.css)({borderBottom:`1px solid ${t.colors.border.weak}`,"&:last-of-type":{borderBottomColor:t.colors.border.medium}}),disabledRow:(0,S.css)({opacity:.5}),cell:(0,S.css)({padding:t.spacing(1,1,1,0),width:"25%",overflow:"hidden",textOverflow:"ellipsis","&:first-of-type":{width:"50%",padding:t.spacing(1,1,1,2)}}),collapseButton:(0,S.css)({margin:0}),loadingCell:(0,S.css)({textAlign:"center"}),spinner:(0,S.css)({marginBottom:0}),nestedEntry:(0,S.css)({display:"flex",alignItems:"center"}),entryContentItem:(0,S.css)({margin:t.spacing(0,1,0,0)}),truncated:(0,S.css)({minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),resourceField:(0,S.css)({maxWidth:t.spacing(36),overflow:"hidden"}),resourceFieldButton:(0,S.css)({padding:"7px",textAlign:"left"}),nestedRowCheckbox:(0,S.css)({zIndex:0}),selectionFooter:(0,S.css)({position:"sticky",bottom:0,background:t.colors.background.primary,paddingTop:t.spacing(2)}),loadingWrapper:(0,S.css)({textAlign:"center",paddingTop:t.spacing(2),paddingBottom:t.spacing(2),color:t.colors.text.secondary}),resultLimit:(0,S.css)({margin:"4px 0",fontStyle:"italic"}),modal:(0,S.css)({width:t.breakpoints.values.lg})}),Kt=({entry:t,isSelected:e,isDisabled:s,isOpen:r,isSelectable:o,level:i,scrollIntoView:n,onToggleCollapse:c,onSelectedChange:u})=>{const l=(0,X.l4)(),m=(0,X.wW)(ce),h=!!t.children,g=(0,a.useCallback)(()=>{c(t)},[c,t]),f=(0,a.useCallback)(p=>{const b=p.target.checked;u(t,b)},[t,u]),y=`${n?"table":"summary"}_checkbox_${t.uri}`;return(0,a.useEffect)(()=>{e&&n&&document.getElementById(y)?.scrollIntoView({behavior:"smooth",block:"center"})},[]),a.createElement("div",{className:m.nestedEntry,style:{marginLeft:i*(3*l.spacing.gridSize)}},h?a.createElement(Bt.h,{className:m.collapseButton,name:r?"angle-down":"angle-right","aria-label":r?`Collapse ${t.name}`:`Expand ${t.name}`,onClick:g,id:t.id}):a.createElement(F,{layout:"inline",h:2}),a.createElement(F,{layout:"inline",h:2}),o&&a.createElement(a.Fragment,null,a.createElement(Ht.X,{id:y,onChange:f,disabled:s,value:e,className:m.nestedRowCheckbox}),a.createElement(F,{layout:"inline",h:2})),a.createElement(Jt,{entry:t,isOpen:r}),a.createElement(F,{layout:"inline",h:1}),a.createElement("label",{htmlFor:y,className:(0,S.cx)(m.entryContentItem,m.truncated)},t.name))};var Zt=v(39493);class K{static buildResourceUri(e,s){const r=[],{subscription:o,resourceGroup:i,metricNamespace:n,resourceName:c}=s;if(o&&(r.push("/subscriptions",o),i&&(r.push("resourceGroups",i),n&&c))){const u=e.replace(n),l=n.split("/"),m=e.replace(c),h=c.split("/"),g=l.shift();if(g&&r.push("providers",g),u.toLowerCase().startsWith("microsoft.storage/storageaccounts/")&&!m.endsWith("default")&&h.push("default"),h.length>l.length){const f=h.shift();f&&r.push(f)}for(const f in l)r.push(l[f]),r.push(h[f])}return r.join("/")}static buildAzureMonitorGetMetricNamespacesUrl(e,s,r,o,i){let n;if("resourceUri"in r)n=r.resourceUri;else{const{subscription:c,resourceGroup:u,metricNamespace:l,resourceName:m}=r;n=K.buildResourceUri(i,{subscription:c,resourceGroup:u,metricNamespace:l,resourceName:m})}return`${e}${n}/providers/microsoft.insights/metricNamespaces?api-version=${s}${o?"&region=global":""}`}static buildAzureMonitorGetMetricNamesUrl(e,s,r,o){let i;const{customNamespace:n}=r;if("resourceUri"in r)i=r.resourceUri;else{const{subscription:u,resourceGroup:l,metricNamespace:m,resourceName:h}=r;i=K.buildResourceUri(o,{subscription:u,resourceGroup:l,metricNamespace:m,resourceName:h})}let c=`${e}${i}/providers/microsoft.insights/metricdefinitions?api-version=${s}`;return n&&(c+=`&metricnamespace=${encodeURIComponent(n)}`),c}}const qt=/\/subscriptions\/(?<subscription>[^/]+)(?:\/resourceGroups\/(?<resourceGroup>[^/]+)(?:\/providers\/(?<metricNamespaceAndResource>.+))?)?/;function Yt(t){if(!t)return{};const e=t.split("/"),s=e.splice(0,2),r=e.splice(0,1);for(;e.length;){const o=e.shift();e.length%2===0?r.push(o):s.push(o)}return{metricNamespace:s.join("/"),resourceName:r.join("/")}}function ve(t){const s=qt.exec(t)?.groups??{},{subscription:r,resourceGroup:o,metricNamespaceAndResource:i}=s,{metricNamespace:n,resourceName:c}=Yt(i);return{subscription:r,resourceGroup:o,metricNamespace:n,resourceName:c}}function Z(t,e){return t.map(s=>x(s,e))}function x(t,e){if(typeof t=="string"){const s=ve(t);return e&&(s.region=e),s}return t}function Ke(t){return t.map(e=>ye(e))}function ye(t){return t?typeof t=="string"?t:K.buildResourceUri((0,L.J)(),t):""}function Te(t){return!!t.match(/^[A-Z0-9]+/i)}function _t(t,e,s,r){return s?.startsWith("microsoft.storage/storageaccounts")&&(s="microsoft.storage/storageaccounts",r?.endsWith("/default")&&(r=r.slice(0,-8))),t===s&&e===r}function Ze(t,e){const s=x(e),r=x(t);return r?.subscription===s?.subscription&&r?.resourceGroup?.toLowerCase()===s?.resourceGroup?.toLowerCase()&&_t(r?.metricNamespace?.toLowerCase(),r?.resourceName,s?.metricNamespace?.toLowerCase(),s?.resourceName)}function es(t,e){const s=[];return e.forEach(r=>{const o=te(t,r);o&&s.push(o)}),s}function te(t,e){for(const s of t){if(Ze(s.uri,e))return s;if(s.children){const r=te(s.children,e);if(r)return r}}}function Ge(t,e,s){return(0,Zt.ZP)(t,r=>{const o=te(r,e);o&&(o.children=s)})}function ts(t,e,s){if(e==="logs")return{...t,azureLogAnalytics:{...t.azureLogAnalytics,resources:Ke(s).filter(o=>o!=="")}};const r=s.length?x(s[0]):{};return{...t,subscription:r.subscription,azureMonitor:{...t.azureMonitor,metricNamespace:r.metricNamespace?.toLocaleLowerCase(),region:r.region,resources:Z(s).filter(o=>o.resourceName!==""&&o.metricNamespace!==""&&o.subscription!==""&&o.resourceGroup!==""),metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]}}}const qe=({row:t,selectedRows:e,level:s,requestNestedRows:r,onRowSelectedChange:o,selectableEntryTypes:i,scrollIntoView:n,disableRow:c})=>{const u=(0,X.wW)(ce),[l,m]=(0,a.useState)("closed"),h=!!e.find(p=>p.uri.toLowerCase()===t.uri.toLowerCase()),g=!h&&c(t,e),f=l==="open",y=async()=>{if(l==="open"){m("closed");return}m("loading"),r(t).then(()=>m("open")).catch(()=>m("closed"))};return(0,a.useEffect)(()=>{const p=e[0];p&&!!te(t.children??[],p.uri)&&m("open")},[e,t]),a.createElement(a.Fragment,null,a.createElement("tr",{className:(0,S.cx)(u.row,g&&u.disabledRow),key:t.id},a.createElement("td",{className:u.cell},a.createElement(Kt,{level:s,isSelected:h,isDisabled:g,isOpen:f,entry:t,onToggleCollapse:y,onSelectedChange:o,isSelectable:i.some(p=>p===t.type),scrollIntoView:n})),a.createElement("td",{className:u.cell},t.typeLabel),a.createElement("td",{className:u.cell},t.locationDisplayName??"-")),f&&t.children&&Object.keys(t.children).length>0&&t.children.map(p=>a.createElement(qe,{key:p.uri,row:p,selectedRows:e,level:s+1,requestNestedRows:r,onRowSelectedChange:o,selectableEntryTypes:i,scrollIntoView:n,disableRow:c})),a.createElement(jt.n,{visible:l==="loading"},a.createElement("tr",null,a.createElement("td",{className:(0,S.cx)(u.cell,u.loadingCell),colSpan:3},a.createElement(Je.u,{text:"Loading...",className:u.spinner})))))},Ye=qe;var U=v(46967);const ss=({searchFn:t})=>{const[e,s]=(0,a.useState)(""),r=(0,a.useMemo)(()=>(0,w.debounce)(t,600),[t]);return(0,a.useEffect)(()=>()=>{r.cancel()},[r]),a.createElement(U.I,{"aria-label":"resource search",prefix:a.createElement(j.J,{name:"search"}),value:e,onChange:o=>{const i=o.currentTarget.value;s(i),r(i)},placeholder:"search for a resource","data-testid":N.components.queryEditor.resourcePicker.search.input})},rs=({resourcePickerData:t,resources:e,onApply:s,onCancel:r,selectableEntryTypes:o,queryType:i,disableRow:n,renderAdvanced:c,selectionNotice:u})=>{const l=(0,X.wW)(ce),[m,h]=(0,a.useState)(!1),[g,f]=(0,a.useState)([]),[y,p]=(0,a.useState)([]),[b,z]=(0,a.useState)(e),[A,V]=(0,a.useState)(void 0),[Se,Ee]=(0,a.useState)(!1),ze=u?.(y);(0,a.useEffect)(()=>{z(e)},[e]);const oe=(0,a.useCallback)(async()=>{if(!m){try{h(!0);const k=await t.fetchInitialRows(i,Z(b??{}));f(k)}catch(k){V(ee(k))}h(!1)}},[b,m,t,i]);(0,He.Z)(()=>{oe()});const le=k=>typeof k=="string"?k!=="":k.subscription&&k.resourceGroup&&k.resourceName&&k.metricNamespace;(0,a.useEffect)(()=>{b||p([]);const k=b.filter($=>le($)),D=b&&es(g,Ke(k));return k?.length>D.length?p(t.parseRows(k)):D&&D.length?p(D):p([])},[b,g,t]);const me=(0,a.useCallback)(async k=>{if(V(void 0),!k.children?.length)try{const D=await t.fetchAndAppendNestedRow(g,k,i);f(D)}catch(D){throw V(ee(D)),D}},[t,g,i]),Ae=(0,a.useCallback)((k,D)=>{if(D){const $=i==="logs"?k.uri:Z([k.uri],k.location)[0],ae=b?b.concat($):[$];z(ae.filter(q=>le(q)))}else{const $=b?.filter(ae=>!Ze(ye(ae),k.uri));z($)}},[i,b,z]),Pe=(0,a.useCallback)(()=>{b&&s(i==="logs"?b:Z(b))},[i,b,s]),Qe=(0,a.useCallback)(async k=>{if(V(void 0),Ee(!1),!k){oe();return}try{h(!0);const D=await t.search(k,i);f(D),D.length>=t.resultLimit&&Ee(!0)}catch(D){V(ee(D))}h(!1)},[oe,t,i]);return a.createElement("div",null,a.createElement(ss,{searchFn:Qe}),Se?a.createElement("p",{className:l.resultLimit},"Showing first ",t.resultLimit," results"):a.createElement(F,{v:2}),a.createElement("table",{className:l.table},a.createElement("thead",null,a.createElement("tr",{className:(0,S.cx)(l.row,l.header)},a.createElement("td",{className:l.cell},"Scope"),a.createElement("td",{className:l.cell},"Type"),a.createElement("td",{className:l.cell},"Location")))),a.createElement("div",{className:l.tableScroller},a.createElement("table",{className:l.table},a.createElement("tbody",null,m&&a.createElement("tr",{className:(0,S.cx)(l.row)},a.createElement("td",{className:l.cell},a.createElement(Je.u,{text:"Loading..."}))),!m&&g.length===0&&a.createElement("tr",{className:(0,S.cx)(l.row)},a.createElement("td",{className:l.cell,"aria-live":"polite"},"No resources found")),!m&&g.map(k=>a.createElement(Ye,{key:k.uri,row:k,selectedRows:y,level:0,requestNestedRows:me,onRowSelectedChange:Ae,selectableEntryTypes:o,scrollIntoView:!0,disableRow:n}))))),a.createElement("div",{className:l.selectionFooter},y.length>0&&a.createElement(a.Fragment,null,a.createElement("h5",null,"Selection"),a.createElement("div",{className:l.tableScroller},a.createElement("table",{className:l.table},a.createElement("tbody",null,y.map(k=>a.createElement(Ye,{key:k.uri,row:k,selectedRows:y,level:0,requestNestedRows:me,onRowSelectedChange:Ae,selectableEntryTypes:o,disableRow:()=>!1}))))),a.createElement(F,{v:2}),ze?.length?a.createElement(O.b,{title:"",severity:"info"},ze):null),a.createElement(Ot,{resources:b,onChange:k=>z(k),renderAdvanced:c}),a.createElement(F,{v:2}),a.createElement(J.zx,{disabled:!!A||!b.every(le),onClick:Pe,"data-testid":N.components.queryEditor.resourcePicker.apply.button},"Apply"),a.createElement(F,{layout:"inline",h:1}),a.createElement(J.zx,{onClick:r,variant:"secondary"},"Cancel")),A&&a.createElement(a.Fragment,null,a.createElement(F,{v:2}),a.createElement(O.b,{severity:"error",title:"An error occurred while requesting resources from Azure Monitor"},A)))},os=({query:t,datasource:e,onQueryChange:s,selectableEntryTypes:r,queryType:o,resources:i,inlineField:n,labelWidth:c,disableRow:u,renderAdvanced:l,selectionNotice:m})=>{const h=(0,X.wW)(ce),[g,f]=(0,a.useState)(!1),y=(0,a.useCallback)(()=>{f(!0)},[]),p=(0,a.useCallback)(()=>{f(!1)},[]),b=(0,a.useCallback)(z=>{s(ts(t,o,z)),p()},[p,s,t,o]);return a.createElement("span",{"data-testid":N.components.queryEditor.resourcePicker.select.button},a.createElement($t.u,{className:h.modal,title:"Select a resource",isOpen:g,onDismiss:p,trapFocus:!1},a.createElement(rs,{resourcePickerData:e.resourcePickerData,resources:i,onApply:b,onCancel:p,selectableEntryTypes:r,queryType:o,disableRow:u,renderAdvanced:l,selectionNotice:m})),a.createElement(W,{label:"Resource",inlineField:n,labelWidth:c},a.createElement(J.zx,{className:h.resourceFieldButton,variant:"secondary",onClick:y,type:"button"},a.createElement(as,{resources:i,datasource:e}))))},as=({resources:t,datasource:e})=>{const[s,r]=(0,a.useState)(Z(t));return(0,a.useEffect)(()=>{r(Z(t))},[t]),t.length?a.createElement(is,{resources:s}):a.createElement(a.Fragment,null,"Select a resource")},is=({resources:t})=>{const e=(0,X.wW)(ce);let s="cube";const r=[];return t.forEach(o=>{if(o.resourceName){r.push(o.resourceName.split("/")[0]);return}if(o.resourceGroup){s="folder",r.push(o.resourceGroup);return}if(o.subscription){s="layer-group",r.push(o.subscription);return}}),a.createElement("span",{className:(0,S.cx)(e.truncated,e.resourceField)},a.createElement(j.J,{name:s}),r.join(", "))},_e=os;var et=v(64353),ns=v(6554);const cs=t=>({resourceList:(0,S.css)({width:"100%",display:"flex",marginBlock:t.spacing(1)})}),us=({resources:t,onChange:e})=>{const s=(0,X.wW)(cs);(0,a.useEffect)(()=>{t.length===0&&e([""])},[t,e]);const r=(n,c)=>{const u=[...t];u[n]=c,e(u)},o=n=>{const c=[...t];c.splice(n,1),e(c)},i=()=>{e(t.concat(""))};return a.createElement(a.Fragment,null,a.createElement(et._,null,a.createElement("h6",null,"Resource URI(s)"," ",a.createElement(ns.u,{content:a.createElement(a.Fragment,null,"Manually edit the"," ",a.createElement("a",{href:"https://docs.microsoft.com/en-us/azure/azure-monitor/logs/log-standard-columns#_resourceid",rel:"noopener noreferrer",target:"_blank"},"resource uri"),". Supports the use of multiple template variables (ex: /subscriptions/$subId/resourceGroups/$rg)"),placement:"right",interactive:!0},a.createElement(j.J,{name:"info-circle"})))),t.map((n,c)=>a.createElement("div",{key:`resource-${c+1}`},a.createElement("div",{className:s.resourceList},a.createElement(U.I,{id:`input-advanced-resource-picker-${c+1}`,value:n,onChange:u=>r(c,u.currentTarget.value),placeholder:"ex: /subscriptions/$subId","data-testid":`input-advanced-resource-picker-${c+1}`}),a.createElement(M.AccessoryButton,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:()=>o(c),"data-testid":"remove-resource",hidden:t.length===1})))),a.createElement(J.zx,{"aria-label":"Add",icon:"plus",variant:"secondary",onClick:i,type:"button"},"Add resource URI"))};function De(t,e){return{...t,azureLogAnalytics:{...t.azureLogAnalytics,query:e}}}function ls(t,e){return{...t,azureLogAnalytics:{...t.azureLogAnalytics,resultFormat:e}}}const ms=[{label:"Time series",value:Re.TimeSeries},{label:"Table",value:Re.Table}],ps=({query:t,variableOptionGroup:e,onQueryChange:s})=>{const r=(0,a.useMemo)(()=>[...ms,e],[e]),o=(0,a.useCallback)(i=>{const{value:n}=i;if(!n)return;const c=ls(t,n);s(c)},[s,t]);return a.createElement(W,{label:"Format as","data-testid":N.components.queryEditor.logsQueryEditor.formatSelection.input},a.createElement(T.Ph,{inputId:"azure-monitor-logs-workspaces-field",value:t.azureLogAnalytics?.resultFormat,onChange:o,options:r,width:38}))};class ds{constructor(){this.resolve=void 0,this.reject=void 0,this.promise=new Promise((e,s)=>{this.resolve=e,this.reject=s}),Object.freeze(this)}}const fs=({query:t,datasource:e,onQueryChange:s})=>{const r=(0,a.useRef)();function o(){return r.current||(r.current=new ds),r.current.promise}(0,a.useEffect)(()=>{if(!t.azureLogAnalytics?.resources||!t.azureLogAnalytics.resources.length)return;const c=[e.azureLogAnalyticsDatasource.getKustoSchema(t.azureLogAnalytics.resources[0]),o()];Promise.all(c).then(([u,{monaco:l,editor:m}])=>{l.languages.kusto.getKustoWorker().then(g=>{const f=m.getModel();return f&&g(f.uri)}).then(g=>{g?.setSchema(u,"https://help.kusto.windows.net","Samples")})})},[e.azureLogAnalyticsDatasource,t.azureLogAnalytics?.resources]);const i=(0,a.useCallback)((c,u)=>{r.current?.resolve?.({editor:c,monaco:u})},[]),n=(0,a.useCallback)(c=>{s(De(t,c))},[s,t]);return a.createElement(Ce.p,{value:t.azureLogAnalytics?.query??"",language:"kusto",height:200,width:"100%",showMiniMap:!1,onBlur:n,onSave:n,onEditorDidMount:i})};async function gs(t,e,s){if(e.azureLogAnalytics?.workspace!==void 0&&!e.azureLogAnalytics.resources){const r=Te(e.azureLogAnalytics.workspace);let o;r?o=await t.resourcePickerData.getResourceURIFromWorkspace(e.azureLogAnalytics.workspace):o=e.azureLogAnalytics.workspace;const i={...e,azureLogAnalytics:{...e.azureLogAnalytics,resource:o,workspace:void 0}};delete i.azureLogAnalytics.workspace,s(i)}}function hs(t,e,s){const[r,o]=(0,a.useState)();return(0,a.useEffect)(()=>{gs(t,e,s).catch(i=>o({title:"Unable to migrate workspace as a resource",message:i.message}))},[t,e,s]),r}const tt=({query:t,datasource:e,subscriptionId:s,variableOptionGroup:r,onChange:o,setError:i,hideFormatAs:n})=>{const c=hs(e,t,o),u=(l,m)=>{if(m.length===0)return!1;const h=x(l.uri,l.location).metricNamespace?.toLowerCase(),g=x(m[0].uri,m[0].location).metricNamespace?.toLowerCase();return h!==g};return a.createElement("span",{"data-testid":"azure-monitor-logs-query-editor-with-experimental-ui"},a.createElement(M.EditorRows,null,a.createElement(M.EditorRow,null,a.createElement(M.EditorFieldGroup,null,a.createElement(_e,{query:t,datasource:e,inlineField:!0,labelWidth:10,subscriptionId:s,variableOptionGroup:r,onQueryChange:o,setError:i,selectableEntryTypes:[R.Subscription,R.ResourceGroup,R.Resource,R.Variable],resources:t.azureLogAnalytics?.resources??[],queryType:"logs",disableRow:u,renderAdvanced:(l,m)=>a.createElement(us,{resources:l,onChange:m}),selectionNotice:()=>"You may only choose items of the same resource type."}))),a.createElement(fs,{query:t,datasource:e,subscriptionId:s,variableOptionGroup:r,onQueryChange:o,setError:i}),a.createElement(M.EditorRow,null,a.createElement(M.EditorFieldGroup,null,!n&&a.createElement(ps,{query:t,datasource:e,subscriptionId:s,variableOptionGroup:r,onQueryChange:o,setError:i}),c&&a.createElement(O.b,{title:c.title},c.message)))))},Fe={"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems":"Backup Items","microsoft.resources/subscriptions":"Subscriptions","microsoft.resources/subscriptions/resourcegroups":"Resource groups","citrix.services/xenappessentials":"Citrix Virtual Apps Essentials","citrix.services/xendesktopessentials":"Citrix Virtual Desktops Essentials","dynatrace.observability/monitors":"Dynatrace","github.enterprise/accounts":"GitHub AE","microsoft.aad/domainservices":"Azure AD Domain Services","microsoft.aadiam/privatelinkforazuread":"Private Link for Azure AD","microsoft.agfoodplatform/farmbeats":"Azure FarmBeats","microsoft.analysisservices/servers":"Analysis Services","microsoft.anybuild/clusters":"AnyBuild clusters","microsoft.apimanagement/service":"API Management services","microsoft.appconfiguration/configurationstores":"App Configuration","microsoft.appplatform/spring":"Azure Spring Cloud","microsoft.attestation/attestationproviders":"Attestation providers","microsoft.authorization/resourcemanagementprivatelinks":"Resource management private links","microsoft.automation/automationaccounts":"Automation Accounts","microsoft.automation/automationaccounts/runbooks":"Runbook","microsoft.autonomoussystems/workspaces":"Bonsai","microsoft.avs/privateclouds":"AVS Private clouds","microsoft.azureactivedirectory/b2cdirectories":"B2C Tenants","microsoft.azureactivedirectory/guestusages":"Guest Usages","microsoft.azurearcdata/datacontrollers":"Azure Arc data controllers","microsoft.azurearcdata/postgresinstances":"Azure Arc-enabled PostgreSQL Hyperscale server groups","microsoft.azurearcdata/sqlmanagedinstances":"SQL managed instances - Azure Arc","microsoft.azurearcdata/sqlserverinstances":"SQL Server - Azure Arc","microsoft.azuredata/sqlserverregistrations":"SQL Server registries","microsoft.azurepercept/accounts":"Azure Percept accounts","microsoft.azurestackhci/clusters":"Azure Stack HCI","microsoft.azurestackhci/virtualmachines":"Azure Stack HCI virtual machine - Azure Arc","microsoft.baremetal/crayservers":"Cray Servers","microsoft.baremetal/monitoringservers":"Monitoring Servers","microsoft.baremetalinfrastructure/baremetalinstances":"BareMetal Instances","microsoft.batch/batchaccounts":"Batch accounts","microsoft.bing/accounts":"Bing Resources","microsoft.botservice/botservices":"Bot Services","microsoft.cache/redis":"Azure Cache for Redis","microsoft.cache/redisenterprise":"Redis Enterprise","microsoft.cdn/cdnwebapplicationfirewallpolicies":"Content Delivery Network WAF policies","microsoft.cdn/profiles (front doors standard/premium":"Preview)","microsoft.cdn/profiles/afdendpoints":"Endpoints","microsoft.cdn/profiles/endpoints":"Endpoints","microsoft.certificateregistration/certificateorders":"App Service Certificates","microsoft.chaos/chaosexperiments":"Chaos Experiments (Classic)","microsoft.chaos/experiments":"Chaos Experiments","microsoft.classiccompute/domainnames":"Cloud services (classic)","microsoft.classiccompute/virtualmachines":"Virtual machines (classic)","microsoft.classicnetwork/networksecuritygroups":"Network security groups (classic)","microsoft.classicnetwork/reservedips":"Reserved IP addresses (classic)","microsoft.classicnetwork/virtualnetworks":"Virtual networks (classic)","microsoft.classicstorage/storageaccounts":"Storage accounts (classic)","microsoft.cloudtest/accounts":"CloudTest Accounts","microsoft.cloudtest/hostedpools":"1ES Hosted Pools","microsoft.cloudtest/images":"CloudTest Images","microsoft.cloudtest/pools":"CloudTest Pools","microsoft.clusterstor/nodes":"ClusterStors","microsoft.cognitiveservices/accounts":"Cognitive Services","microsoft.compute/availabilitysets":"Availability sets","microsoft.compute/capacityreservationgroups":"Capacity Reservation Groups","microsoft.compute/cloudservices":"Cloud services (extended support)","microsoft.compute/diskaccesses":"Disk Accesses","microsoft.compute/diskencryptionsets":"Disk Encryption Sets","microsoft.compute/disks":"Disks","microsoft.compute/galleries":"Azure compute galleries","microsoft.compute/galleries/applications":"VM application definitions","microsoft.compute/galleries/applications/versions":"VM application versions","microsoft.compute/galleries/images":"VM image definitions","microsoft.compute/galleries/images/versions":"VM image versions","microsoft.compute/hostgroups":"Host groups","microsoft.compute/hostgroups/hosts":"Hosts","microsoft.compute/images":"Images","microsoft.compute/proximityplacementgroups":"Proximity placement groups","microsoft.compute/restorepointcollections":"Restore Point Collections","microsoft.compute/snapshots":"Snapshots","microsoft.compute/sshpublickeys":"SSH keys","microsoft.compute/virtualmachines":"Virtual machines","microsoft.compute/virtualmachinescalesets":"Virtual machine scale sets","microsoft.confidentialledger/ledgers":"Confidential Ledgers","microsoft.confluent/organizations":"Confluent organizations","microsoft.connectedcache/cachenodes":"Connected Cache Resources","microsoft.connectedcache/enterprisecustomers":"Connected Cache Resources","microsoft.connectedvehicle/platformaccounts":"Connected Vehicle Platforms","microsoft.connectedvmwarevsphere/vcenters":"VMware vCenters","microsoft.connectedvmwarevsphere/virtualmachines":"VMware + AVS virtual machines","microsoft.containerinstance/containergroups":"Container instances","microsoft.containerregistry/registries":"Container registries","microsoft.containerregistry/registries/replications":"Container registry replications","microsoft.containerregistry/registries/webhooks":"Container registry webhooks","microsoft.containerservice/managedclusters":"Kubernetes services","microsoft.dashboard/grafana":"Grafana Workspaces","microsoft.databox/jobs":"Azure Data Box","microsoft.databoxedge/databoxedgedevices":"Azure Stack Edge / Data Box Gateway","microsoft.databricks/workspaces":"Azure Databricks Services","microsoft.datacatalog/catalogs":"Data Catalog","microsoft.datacollaboration/workspaces":"Project CI","microsoft.datadog/monitors":"Datadog","microsoft.datafactory/datafactories":"Data factories","microsoft.datafactory/factories":"Data factories (V2)","microsoft.datalakeanalytics/accounts":"Data Lake Analytics","microsoft.datalakestore/accounts":"Data Lake Storage Gen1","microsoft.datamigration/services":"Azure Database Migration Services","microsoft.datamigration/services/projects":"Azure Database Migration Projects","microsoft.datamigration/sqlmigrationservices":"Azure Database Migration Services","microsoft.dataprotection/backupvaults":"Backup vaults","microsoft.dataprotection/resourceguards":"Resource Guards (Preview)","microsoft.datareplication/replicationvaults":"Site Recovery Vaults","microsoft.datashare/accounts":"Data Shares","microsoft.dbformariadb/servers":"Azure Database for MariaDB servers","microsoft.dbformysql/flexibleservers":"Azure Database for MySQL flexible servers","microsoft.dbformysql/servers":"Azure Database for MySQL servers","microsoft.dbforpostgresql/flexibleservers":"Azure Database for PostgreSQL flexible servers","microsoft.dbforpostgresql/servergroups":"Azure Database for PostgreSQL server groups","microsoft.dbforpostgresql/servergroupsv2":"Azure Database for PostgreSQL server groups","microsoft.dbforpostgresql/servers":"Azure Database for PostgreSQL servers","microsoft.dbforpostgresql/serversv2":"Azure Database for PostgreSQL servers v2","microsoft.deploymentmanager/rollouts":"Rollouts","microsoft.desktopvirtualization/applicationgroups":"Application groups","microsoft.desktopvirtualization/hostpools":"Host pools","microsoft.desktopvirtualization/scalingplans":"Scaling plans","microsoft.desktopvirtualization/workspaces":"Workspaces","microsoft.devices/iothubs":"IoT Hub","microsoft.devices/provisioningservices":"Device Provisioning Services","microsoft.deviceupdate/accounts":"Device Update for IoT Hubs","microsoft.devops/pipelines":"DevOps Starter","microsoft.devtestlab/labs":"DevTest Labs","microsoft.devtestlab/labs/virtualmachines":"Virtual machines","microsoft.digitaltwins/digitaltwinsinstances":"Azure Digital Twins","microsoft.documentdb/cassandraclusters":"Azure Managed Instance for Apache Cassandra","microsoft.documentdb/databaseaccounts":"Azure Cosmos DB accounts","microsoft.domainregistration/domains":"App Service Domains","microsoft.edgeorder/addresses":"Azure Edge Hardware Center Address","microsoft.edgeorder/orderitems":"Azure Edge Hardware Center","microsoft.elastic/monitors":"Elasticsearch (Elastic Cloud)","microsoft.eventgrid/domains":"Event Grid Domains","microsoft.eventgrid/partnernamespaces":"Event Grid Partner Namespaces","microsoft.eventgrid/partnerregistrations":"Event Grid Partner Registrations","microsoft.eventgrid/partnertopics":"Event Grid Partner Topics","microsoft.eventgrid/systemtopics":"Event Grid System Topics","microsoft.eventgrid/topics":"Event Grid Topics","microsoft.eventhub/clusters":"Event Hubs Clusters","microsoft.eventhub/namespaces":"Event Hubs Namespaces","microsoft.experimentation/experimentworkspaces":"Experiment Workspaces","microsoft.extendedlocation/customlocations":"Custom locations","microsoft.fidalgo/devcenters":"Fidalgo DevCenters","microsoft.fidalgo/networksettings":"Network Configurations","microsoft.fidalgo/projects":"Fidalgo Projects","microsoft.fidalgo/projects/environments":"Fidalgo Environments","microsoft.fluidrelay/fluidrelayservers":"Fluid Relay","microsoft.genomics/accounts":"Genomics accounts","microsoft.hanaonazure/hanainstances":"SAP HANA on Azure","microsoft.hanaonazure/sapmonitors":"Azure Monitors for SAP Solutions","microsoft.hdinsight/clusterpools":"HDInsight cluster pools","microsoft.hdinsight/clusterpools/clusters":"HDInsight gen2 clusters","microsoft.hdinsight/clusterpools/clusters/sessionclusters":"HDInsight session clusters","microsoft.hdinsight/clusters":"HDInsight clusters","microsoft.healthbot/healthbots":"Azure Health Bot","microsoft.healthcareapis/services":"Azure API for FHIR","microsoft.healthcareapis/workspaces":"Healthcare APIs Workspaces","microsoft.healthcareapis/workspaces/dicomservices":"DICOM services","microsoft.healthcareapis/workspaces/fhirservices":"FHIR services","microsoft.healthcareapis/workspaces/iotconnectors":"IoT connectors","microsoft.hpcworkbench/instances":"HPC Workbenches (preview)","microsoft.hpcworkbench/instances/chambers":"Chambers (preview)","microsoft.hpcworkbench/instances/chambers/accessprofiles":"Chamber Profiles (preview)","microsoft.hpcworkbench/instances/chambers/workloads":"Chamber VMs (preview)","microsoft.hpcworkbench/instances/consortiums":"Consortiums (preview)","microsoft.hybridcompute/machines":"Servers - Azure Arc","microsoft.hybridcompute/privatelinkscopes":"Azure Arc Private Link Scopes","microsoft.hybridcontainerservice/provisionedclusters":"Provisioned clusters","microsoft.hybriddata/datamanagers":"StorSimple Data Managers","microsoft.hybridnetwork/devices":"Azure Network Function Manager \u2013 Devices","microsoft.hybridnetwork/networkfunctions":"Azure Network Function Manager \u2013 Network Functions","microsoft.importexport/jobs":"Import/export jobs","microsoft.insights/components":"Application Insights","microsoft.insights/datacollectionendpoints":"Data collection endpoints","microsoft.insights/datacollectionrules":"Data collection rules","microsoft.insights/privatelinkscopes":"Azure Monitor Private Link Scopes","microsoft.insights/webtests":"Availability tests","microsoft.insights/workbooks":"Azure Workbooks","microsoft.insights/workbooktemplates":"Azure Workbook Templates","microsoft.iotcentral/iotapps":"IoT Central Applications","microsoft.keyvault/vaults":"Key vaults","microsoft.kubernetes/connectedclusters":"Kubernetes - Azure Arc","microsoft.kusto/clusters":"Azure Data Explorer Clusters","microsoft.kusto/clusters/databases":"Azure Data Explorer Databases","microsoft.labservices/labaccounts":"Lab accounts","microsoft.labservices/labplans":"Lab plans","microsoft.labservices/labs":"Labs","microsoft.loadtestservice/loadtests":"Azure Load Testing","microsoft.logic/integrationaccounts":"Integration accounts","microsoft.logic/integrationserviceenvironments":"Integration Service Environments","microsoft.logic/integrationserviceenvironments/managedapis":"Managed Connector","microsoft.logic/workflows":"Logic apps","microsoft.logz/monitors":"Logz main account","microsoft.logz/monitors/accounts":"Logz sub account","microsoft.logz/monitors/metricssource":"Logz metrics data source","microsoft.machinelearning/commitmentplans":"Machine Learning Studio (classic) web service plans","microsoft.machinelearning/webservices":"Machine Learning Studio (classic) web services","microsoft.machinelearning/workspaces":"Machine Learning Studio (classic) workspaces","microsoft.machinelearningservices/workspaces":"Machine learning","microsoft.machinelearningservices/workspaces/onlineendpoints":"Machine learning online endpoints","microsoft.machinelearningservices/workspaces/onlineendpoints/deployments":"Machine learning online deployments","microsoft.maintenance/maintenanceconfigurations":"Maintenance Configurations","microsoft.managedidentity/userassignedidentities":"Managed Identities","microsoft.maps/accounts":"Azure Maps Accounts","microsoft.maps/accounts/creators":"Azure Maps Creator Resources","microsoft.media/mediaservices":"Media Services","microsoft.media/mediaservices/liveevents":"Live events","microsoft.media/mediaservices/streamingendpoints":"Streaming Endpoints","microsoft.media/videoanalyzers":"Video Analyzers","microsoft.migrate/projects":"Migration projects","microsoft.mixedreality/objectanchorsaccounts":"Object Anchors Accounts","microsoft.mixedreality/objectunderstandingaccounts":"Object Understanding Accounts","microsoft.mixedreality/remoterenderingaccounts":"Remote Rendering Accounts","microsoft.mixedreality/spatialanchorsaccounts":"Spatial Anchors Accounts","microsoft.mobilenetwork/mobilenetworks":"Mobile Networks","microsoft.mobilenetwork/mobilenetworks/datanetworks":"Data Networks","microsoft.mobilenetwork/mobilenetworks/services":"Services","microsoft.mobilenetwork/mobilenetworks/simpolicies":"Sim Policies","microsoft.mobilenetwork/mobilenetworks/sites":"Mobile Network Sites","microsoft.mobilenetwork/mobilenetworks/slices":"Slices","microsoft.mobilenetwork/packetcorecontrolplanes":"Packet Core Control Planes","microsoft.mobilenetwork/packetcorecontrolplanes/packetcoredataplanes":"Packet Core Data Planes","microsoft.mobilenetwork/packetcorecontrolplanes/packetcoredataplanes/attacheddatanetworks":"Attached Data Networks","microsoft.mobilenetwork/sims":"Sims","microsoft.netapp/netappaccounts":"NetApp accounts","microsoft.netapp/netappaccounts/capacitypools":"Capacity pools","microsoft.netapp/netappaccounts/capacitypools/volumes":"Volumes","microsoft.netapp/netappaccounts/capacitypools/volumes/snapshots":"Snapshots","microsoft.netapp/netappaccounts/snapshotpolicies":"Snapshot policies","microsoft.network/applicationgateways":"Application gateways","microsoft.network/applicationgatewaywebapplicationfirewallpolicies":"Application Gateway WAF policies","microsoft.network/applicationsecuritygroups":"Application security groups","microsoft.network/azurefirewalls":"Firewalls","microsoft.network/bastionhosts":"Bastions","microsoft.network/connections":"Connections","microsoft.network/customipprefixes":"Custom IP Prefixes","microsoft.network/ddosprotectionplans":"DDoS protection plans","microsoft.network/dnsforwardingrulesets":"Dns Forwarding Rulesets","microsoft.network/dnsresolvers":"DNS Private Resolvers","microsoft.network/dnszones":"DNS zones","microsoft.network/expressroutecircuits":"ExpressRoute circuits","microsoft.network/expressrouteports":"ExpressRoute Direct","microsoft.network/firewallpolicies":"Firewall Policies","microsoft.network/frontdoors":"Front Doors","microsoft.network/frontdoorwebapplicationfirewallpolicies":"Web Application Firewall policies (WAF)","microsoft.network/ipgroups":"IP Groups","microsoft.network/loadbalancers":"Load balancers","microsoft.network/localnetworkgateways":"Local network gateways","microsoft.network/natgateways":"NAT gateways","microsoft.network/networkexperimentprofiles":"Internet Analyzer profiles","microsoft.network/networkinterfaces":"Network interfaces","microsoft.network/networkmanagers":"Network Managers","microsoft.network/networksecuritygroups":"Network security groups","microsoft.network/networkwatchers":"Network Watchers","microsoft.network/networkwatchers/connectionmonitors":"Connection Monitors","microsoft.network/networkwatchers/flowlogs":"NSG Flow Logs","microsoft.network/privatednszones":"Private DNS zones","microsoft.network/privateendpoints":"Private endpoints","microsoft.network/privatelinkservices":"Private link services","microsoft.network/publicipaddresses":"Public IP addresses","microsoft.network/publicipprefixes":"Public IP Prefixes","microsoft.network/routefilters":"Route filters","microsoft.network/routetables":"Route tables","microsoft.network/serviceendpointpolicies":"Service endpoint policies","microsoft.network/trafficmanagerprofiles":"Traffic Manager profiles","microsoft.network/virtualnetworkgateways":"Virtual network gateways","microsoft.network/virtualnetworks":"Virtual networks","microsoft.network/virtualwans":"Virtual WANs","microsoft.notificationhubs/namespaces":"Notification Hub Namespaces","microsoft.notificationhubs/namespaces/notificationhubs":"Notification Hubs","microsoft.openenergyplatform/energyservices":"Project Oak Forest","microsoft.openlogisticsplatform/workspaces":"Open Supply Chain Platform","microsoft.operationalinsights/querypacks":"Log Analytics query packs","microsoft.operationalinsights/workspaces":"Log Analytics workspaces","microsoft.operationsmanagement/solutions":"Solutions","microsoft.orbital/contactprofiles":"Contact Profiles","microsoft.orbital/edgesites":"Edge Sites","microsoft.orbital/groundstations":"Ground Stations","microsoft.orbital/l2connections":"L2 Connections","microsoft.orbital/spacecrafts":"Spacecrafts","microsoft.peering/peerings":"Peerings","microsoft.peering/peeringservices":"Peering Services","microsoft.playfab/playeraccountpools":"PlayFab player account pools","microsoft.playfab/titles":"PlayFab titles","microsoft.portal/dashboards":"Shared dashboards","microsoft.powerbidedicated/capacities":"Power BI Embedded","microsoft.purview/accounts":"Microsoft Purview accounts","microsoft.quantum/workspaces":"Quantum Workspaces","microsoft.recommendationsservice/accounts":"Intelligent Recommendations Accounts","microsoft.recommendationsservice/accounts/modeling":"Modeling","microsoft.recommendationsservice/accounts/serviceendpoints":"Service Endpoints","microsoft.recoveryservices/vaults":"Recovery Services vaults","microsoft.redhatopenshift/openshiftclusters":"Azure Red Hat OpenShift","microsoft.relay/namespaces":"Relays","microsoft.resourceconnector/appliances":"Resource bridges","microsoft.resourcegraph/queries":"Resource Graph queries","microsoft.resources/deploymentscripts":"Deployment Scripts","microsoft.resources/templatespecs":"Template specs","microsoft.saas/applications":"Software as a Service (classic)","microsoft.saas/resources":"SaaS","microsoft.scom/managedinstances":"Aquila Instances","microsoft.scvmm/virtualmachines":"SCVMM virtual machine - Azure Arc","microsoft.scvmm/vmmservers":"SCVMM management servers","microsoft.search/searchservices":"Search services","microsoft.securitydetonation/chambers":"Security Detonation Chambers","microsoft.servicebus/namespaces":"Service Bus Namespaces","microsoft.servicefabric/clusters":"Service Fabric clusters","microsoft.servicefabric/managedclusters":"Service Fabric managed clusters","microsoft.serviceshub/connectors":"Services Hub Connectors","microsoft.signalrservice/signalr":"SignalR","microsoft.signalrservice/webpubsub":"Web PubSub Service","microsoft.solutions/applicationdefinitions":"Service catalog managed application definitions","microsoft.solutions/applications":"Managed applications","microsoft.sql/instancepools":"Instance pools","microsoft.sql/managedinstances":"SQL managed instances","microsoft.sql/managedinstances/databases":"Managed databases","microsoft.sql/servers":"SQL servers","microsoft.sql/servers/databases":"SQL databases","microsoft.sql/servers/elasticpools":"SQL elastic pools","microsoft.sql/servers/jobagents":"Elastic Job agents","microsoft.sql/virtualclusters":"Virtual clusters","microsoft.sqlvirtualmachine/sqlvirtualmachines":"SQL virtual machines","microsoft.storage/storageaccounts":"Storage accounts","microsoft.storagecache/amlfilesystems":"Lustre File Systems","microsoft.storagecache/caches":"HPC caches","microsoft.storagepool/diskpools":"Disk Pools","microsoft.storagesync/storagesyncservices":"Storage Sync Services","microsoft.storagesyncdev/storagesyncservices":"Storage Sync Services","microsoft.storagesyncint/storagesyncservices":"Storage Sync Services","microsoft.storsimple/managers":"StorSimple Device Managers","microsoft.streamanalytics/clusters":"Stream Analytics clusters","microsoft.streamanalytics/streamingjobs":"Stream Analytics jobs","microsoft.synapse/privatelinkhubs":"Azure Synapse Analytics (private link hubs)","microsoft.synapse/workspaces":"Azure Synapse Analytics","microsoft.synapse/workspaces/bigdatapools":"Apache Spark pools","microsoft.synapse/workspaces/kustopools":"Data Explorer pools (preview)","microsoft.synapse/workspaces/sqlpools":"Dedicated SQL pools","microsoft.testbase/testbaseaccounts":"Test Base Accounts","microsoft.testbase/testbaseaccounts/packages":"Test Base Packages","microsoft.timeseriesinsights/environments":"Time Series Insights environments","microsoft.timeseriesinsights/environments/eventsources":"Time Series Insights event sources","microsoft.timeseriesinsights/environments/referencedatasets":"Time Series Insights reference data sets","microsoft.videoindexer/accounts":"Video Analyzer for Media","microsoft.virtualmachineimages/imagetemplates":"Image Templates","microsoft.visualstudio/account":"Azure DevOps organizations","microsoft.visualstudio/account/project":"DevOps Starter","microsoft.vmwarecloudsimple/dedicatedcloudnodes":"CloudSimple Nodes","microsoft.vmwarecloudsimple/dedicatedcloudservices":"CloudSimple Services","microsoft.vmwarecloudsimple/virtualmachines":"CloudSimple Virtual Machines","microsoft.vsonline/plans":"Visual Studio Online Plans","microsoft.web/connectiongateways":"On-premises data gateways","microsoft.web/connections":"API Connections","microsoft.web/containerapps":"Container Apps","microsoft.web/customapis":"Logic Apps Custom Connector","microsoft.web/hostingenvironments":"App Service Environments","microsoft.web/kubeenvironments":"App Service Kubernetes Environments","microsoft.web/serverfarms":"App Service plans","microsoft.web/sites":"App Services","microsoft.web/sites/slots":"App Service (Slots)","microsoft.web/staticsites":"Static Web Apps","microsoft.windowsesu/multipleactivationkeys":"Windows Multiple Activation Keys","microsoft.windowsiot/deviceservices":"Windows 10 IoT Core Services","microsoft.workloads/monitors":"Azure Monitors for SAP Solutions (v2)","microsoft.workloads/phpworkloads":"Scalable WordPress on Linux","microsoft.workloads/sapvirtualinstances":"SAP Virtual Instances","microsoft.workloads/sapvirtualinstances/applicationinstances":"SAP app server instances","microsoft.workloads/sapvirtualinstances/centralinstances":"SAP central server instances","microsoft.workloads/sapvirtualinstances/databaseinstances":"SAP database server instances","nginx.nginxplus/nginxdeployments":"NGINX Deployment","providers.test/statefulibizaengines":"VLCentral Help","wandisco.fusion/fusiongroups":"LiveData Planes","wandisco.fusion/fusiongroups/azurezones":"Azure Zones","wandisco.fusion/fusiongroups/azurezones/plugins":"Plugins","wandisco.fusion/fusiongroups/hivereplicationrules":"Hive Replication Rules","wandisco.fusion/fusiongroups/managedonpremzones":"On-premises Zones","wandisco.fusion/fusiongroups/replicationrules":"Replication Rules","wandisco.fusion/migrators":"LiveData Migrators","wandisco.fusion/migrators/exclusiontemplates":"Exclusions","wandisco.fusion/migrators/livedatamigrations":"Migrations","wandisco.fusion/migrators/metadatamigrations":"Metadata Migrations","wandisco.fusion/migrators/metadatatargets":"Metadata Targets","wandisco.fusion/migrators/pathmappings":"Path Mappings","wandisco.fusion/migrators/targets":"Targets","microsoft.security/insights/classification":"Data Sensitivity Security Insights (Preview)","microsoft.security/locations/alerts":"Security Alerts"},bs={"microsoft.cache/redis":!0,"microsoft.dbforpostgresql/flexibleservers":!0,"microsoft.storagecache/amlfilesystems":!0,"microsoft.databoxedge/databoxedgedevices":!0,"microsoft.dataprotection/backupvaults":!0,"microsoft.netapp/netappaccounts/capacitypools":!0,"microsoft.network/networkwatchers/connectionmonitors":!0,"microsoft.keyvault/vaults":!0,"microsoft.recoveryservices/vaults":!0,"microsoft.sql/servers/databases":!0,"microsoft.sql/servers/elasticpools":!0,"microsoft.compute/virtualmachinescalesets":!0,"microsoft.compute/virtualmachines":!0,"microsoft.signalrservice/webpubsub":!0},vs=["microsoft.aad/domainservices","microsoft.aadiam/azureadmetrics","microsoft.aadiam/tenants","microsoft.agfoodplatform/farmbeats","microsoft.analysisservices/servers","microsoft.apimanagement/service","microsoft.appconfiguration/configurationstores","microsoft.appplatform/spring","microsoft.attestation/attestationproviders","microsoft.automation/automationaccounts","microsoft.autonomousdevelopmentplatform/accounts","microsoft.autonomousdevelopmentplatform/datapools","microsoft.autonomousdevelopmentplatform/workspaces","microsoft.avs/privateclouds","microsoft.azurestackresourcemonitor/storageaccountmonitor","microsoft.batch/batchaccounts","microsoft.batchai/workspaces","microsoft.blockchain/blockchainmembers","microsoft.blockchain/cordamembers","microsoft.botservice/botservices","microsoft.cache/redis","microsoft.cache/redisenterprise","microsoft.cdn/cdnwebapplicationfirewallpolicies","microsoft.cdn/profiles","microsoft.cdn/profiles/endpoints","microsoft.classiccompute/domainnames","microsoft.classiccompute/virtualmachines","microsoft.classicnetwork/networksecuritygroups","microsoft.classicstorage/storageaccounts","microsoft.cognitiveservices/accounts","microsoft.communication/communicationservices","microsoft.compute/disks","microsoft.compute/virtualmachines","microsoft.compute/virtualmachinescalesets","microsoft.connectedcache/cachenodes","microsoft.connectedvehicle/platformaccounts","microsoft.containerinstance/containergroups","microsoft.containerregistry/registries","microsoft.containerservice/managedclusters","microsoft.customerinsights/hubs","microsoft.customproviders/resourceproviders","microsoft.d365customerinsights/instances","microsoft.dashboard/grafana","microsoft.databoxedge/databoxedgedevices","microsoft.databricks/workspaces","microsoft.datacollaboration/workspaces","microsoft.datafactory/datafactories","microsoft.datafactory/factories","microsoft.datalakeanalytics/accounts","microsoft.datalakestore/accounts","microsoft.datashare/accounts","microsoft.dbformariadb/servers","microsoft.dbformysql/flexibleservers","microsoft.dbformysql/servers","microsoft.dbforpostgresql/flexibleservers","microsoft.dbforpostgresql/servergroupsv2","microsoft.dbforpostgresql/servers","microsoft.dbforpostgresql/serversv2","microsoft.desktopvirtualization/applicationgroups","microsoft.desktopvirtualization/hostpools","microsoft.desktopvirtualization/scalingplans","microsoft.desktopvirtualization/workspaces","microsoft.devices/elasticpools/iothubtenants","microsoft.devices/iothubs","microsoft.devices/provisioningservices","microsoft.digitaltwins/digitaltwinsinstances","microsoft.documentdb/cassandraclusters","microsoft.documentdb/databaseaccounts","microsoft.eventgrid/domains","microsoft.eventgrid/partnernamespaces","microsoft.eventgrid/partnertopics","microsoft.eventgrid/systemtopics","microsoft.eventgrid/topics","microsoft.eventhub/clusters","microsoft.eventhub/namespaces","microsoft.experimentation/experimentworkspaces","microsoft.fabric.admin/fabriclocations","microsoft.hdinsight/clusters","microsoft.healthcareapis/services","microsoft.healthcareapis/workspaces/dicomservices","microsoft.healthcareapis/workspaces/fhirservices","microsoft.insights/autoscalesettings","microsoft.insights/components","microsoft.insights/qos","microsoft.iotcentral/iotapps","microsoft.keyvault/managedhsms","microsoft.keyvault/vaults","microsoft.kubernetes/connectedclusters","microsoft.kusto/clusters","microsoft.loadtestservice/loadtests","microsoft.logic/integrationaccounts","microsoft.logic/integrationserviceenvironments","microsoft.logic/workflows","microsoft.machinelearningservices/workspaces","microsoft.media/mediaservices","microsoft.media/mediaservices/liveevents","microsoft.media/mediaservices/streamingendpoints","microsoft.media/videoanalyzers","microsoft.netapp/netappaccounts/capacitypools","microsoft.netapp/netappaccounts/capacitypools/volumes","microsoft.network/applicationgateways","microsoft.network/azurefirewalls","microsoft.network/bastionhosts","microsoft.network/connections","microsoft.network/dnszones","microsoft.network/expressroutecircuits","microsoft.network/expressroutegateways","microsoft.network/expressrouteports","microsoft.network/frontdoors","microsoft.network/loadbalancers","microsoft.network/natgateways","microsoft.network/networkinterfaces","microsoft.network/networksecuritygroups","microsoft.network/networksecurityperimeters","microsoft.network/networkvirtualappliances","microsoft.network/networkwatchers","microsoft.network/networkwatchers/connectionmonitors","microsoft.network/p2svpngateways","microsoft.network/privateendpoints","microsoft.network/privatelinkservices","microsoft.network/publicipaddresses","microsoft.network/trafficmanagerprofiles","microsoft.network/virtualnetworkgateways","microsoft.network/virtualnetworks","microsoft.network/vpngateways","microsoft.networkfunction/azuretrafficcollectors","microsoft.notificationhubs/namespaces","microsoft.notificationhubs/namespaces/notificationhubs","microsoft.openlogisticsplatform/workspaces","microsoft.operationalinsights/workspaces","microsoft.operationsmanagement/solutions","microsoft.peering/peeringservices","microsoft.powerbi/tenants","microsoft.powerbi/tenants/workspaces","microsoft.powerbidedicated/capacities","microsoft.purview/accounts","microsoft.recoveryservices/vaults","microsoft.relay/namespaces","microsoft.resources/subscriptions","microsoft.resources/subscriptions/resourcegroups","microsoft.search/searchservices","microsoft.security/antimalwaresettings","microsoft.securityinsights/settings","microsoft.servicebus/namespaces","microsoft.signalrservice/signalr","microsoft.signalrservice/webpubsub","microsoft.singularity/accounts","microsoft.sql/managedinstances","microsoft.sql/managedinstances/databases","microsoft.sql/servers/databases","microsoft.sql/servers/elasticpools","microsoft.storage/storageaccounts","microsoft.storage/storageaccounts/blobservices","microsoft.storage/storageaccounts/fileservices","microsoft.storage/storageaccounts/queueservices","microsoft.storage/storageaccounts/tableservices","microsoft.storagecache/caches","microsoft.storagesync/storagesyncservices","microsoft.streamanalytics/streamingjobs","microsoft.synapse/workspaces","microsoft.synapse/workspaces/bigdatapools","microsoft.synapse/workspaces/kustopools","microsoft.synapse/workspaces/scopepools","microsoft.synapse/workspaces/sqlpools","microsoft.timeseriesinsights/environments","microsoft.timeseriesinsights/environments/eventsources","microsoft.videoindexer/accounts","microsoft.vmwarecloudsimple/virtualmachines","microsoft.web/hostingenvironments","microsoft.web/hostingenvironments/workerpools","microsoft.web/serverfarms","microsoft.web/sites","microsoft.web/sites/slots"],ys=t=>({resourceList:(0,S.css)({display:"flex",columnGap:t.spacing(1),flexWrap:"wrap",marginBottom:t.spacing(1)}),resource:(0,S.css)({flex:"0 0 auto"}),resourceLabel:(0,S.css)({padding:t.spacing(1)}),resourceGroupAndName:(0,S.css)({display:"flex",columnGap:t.spacing(.5)})}),ws=({resources:t,onChange:e})=>{const s=(0,X.wW)(ys);(0,a.useEffect)(()=>{t.length===0&&e([{}])},[t,e]);const r=(c,u)=>{const l=[...t];l[c]=u,e(l)},o=c=>{const u=[...t];u.splice(c,1),e(u)},i=()=>{e(t.concat({subscription:t[0]?.subscription,metricNamespace:t[0]?.metricNamespace,resourceGroup:"",resourceName:""}))},n=c=>{e(t.map(u=>({...u,...c})))};return a.createElement(a.Fragment,null,a.createElement(C._,{label:"Subscription",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-subscription",labelWidth:15,"data-testid":N.components.queryEditor.resourcePicker.advanced.subscription.input},a.createElement(U.I,{id:"input-advanced-resource-picker-subscription",value:t[0]?.subscription??"",onChange:c=>n({subscription:c.currentTarget.value}),placeholder:"aaaaaaaa-bbbb-cccc-dddd-eeeeeeee"})),a.createElement(C._,{label:"Namespace",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-metricNamespace",labelWidth:15,"data-testid":N.components.queryEditor.resourcePicker.advanced.namespace.input},a.createElement(U.I,{id:"input-advanced-resource-picker-metricNamespace",value:t[0]?.metricNamespace??"",onChange:c=>n({metricNamespace:c.currentTarget.value}),placeholder:"Microsoft.Insights/metricNamespaces"})),a.createElement(C._,{label:"Region",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-region",labelWidth:15,"data-testid":N.components.queryEditor.resourcePicker.advanced.region.input,tooltip:"The code region of the resource. Optional for one resource but mandatory when selecting multiple ones."},a.createElement(U.I,{id:"input-advanced-resource-picker-region",value:t[0]?.region??"",onChange:c=>n({region:c.currentTarget.value}),placeholder:"northeurope"})),a.createElement("div",{className:s.resourceList},t.map((c,u)=>a.createElement("div",{key:`resource-${u+1}`,className:s.resource},t.length!==1&&a.createElement(et._,{className:s.resourceLabel},"Resource ",u+1),a.createElement(C._,{label:"Resource Group",transparent:!0,htmlFor:`input-advanced-resource-picker-resourceGroup-${u+1}`,labelWidth:15,"data-testid":N.components.queryEditor.resourcePicker.advanced.resourceGroup.input},a.createElement("div",{className:s.resourceGroupAndName},a.createElement(U.I,{id:`input-advanced-resource-picker-resourceGroup-${u+1}`,value:c?.resourceGroup??"",onChange:l=>r(u,{...c,resourceGroup:l.currentTarget.value}),placeholder:"resource-group"}),a.createElement(M.AccessoryButton,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:()=>o(u),hidden:t.length===1,"data-testid":"remove-resource"}))),a.createElement(C._,{label:"Resource Name",transparent:!0,htmlFor:`input-advanced-resource-picker-resourceName-${u+1}`,labelWidth:15,"data-testid":N.components.queryEditor.resourcePicker.advanced.resource.input},a.createElement(U.I,{id:`input-advanced-resource-picker-resourceName-${u+1}`,value:c?.resourceName??"",onChange:l=>r(u,{...c,resourceName:l.currentTarget.value}),placeholder:"name"}))))),a.createElement(J.zx,{"aria-label":"Add",icon:"plus",variant:"secondary",onClick:i,type:"button"},"Add resource"))};function st(t,e){return t.azureMonitor?.customNamespace===e?t:e?.toLowerCase().startsWith("microsoft.storage/storageaccounts/")?{...t,azureMonitor:{...t.azureMonitor,metricNamespace:e,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]}}:{...t,azureMonitor:{...t.azureMonitor,customNamespace:e,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]}}}function ks(t,e){return t.azureMonitor?.metricName===e?t:{...t,azureMonitor:{...t.azureMonitor,metricName:e,aggregation:void 0,timeGrain:"",dimensionFilters:[]}}}function Ss(t,e){return t.azureMonitor?.aggregation===e?t:{...t,azureMonitor:{...t.azureMonitor,aggregation:e}}}function rt(t,e){return t.azureMonitor?.timeGrain===e?t:{...t,azureMonitor:{...t.azureMonitor,timeGrain:e}}}function we(t,e){return t.azureMonitor?.dimensionFilters===e?t:{...t,azureMonitor:{...t.azureMonitor,dimensionFilters:e}}}function Es(t,e="",s="eq",r=[]){const o=t.azureMonitor?.dimensionFilters??[];return we(t,[...o,{dimension:e,operator:s,filters:r}])}function mo(t,e){const r=[...t.azureMonitor?.dimensionFilters??[]];return r.splice(e,1),we(t,r)}function po(t,e,s,r){const i=[...t.azureMonitor?.dimensionFilters??[]],n=i[e];return n[s]=r,(s==="dimension"||s==="operator")&&(n.filters=[]),we(t,i)}function zs(t,e){return t.azureMonitor?.top===e?t:{...t,azureMonitor:{...t.azureMonitor,top:e}}}function As(t,e){return t.azureMonitor?.alias===e?t:{...t,azureMonitor:{...t.azureMonitor,alias:e}}}const Ns=({query:t,variableOptionGroup:e,onQueryChange:s,aggregationOptions:r,isLoading:o})=>{const i=(0,a.useCallback)(c=>{if(!c.value)return;const u=Ss(t,c.value);s(u)},[s,t]),n=fe(r,e,t.azureMonitor?.aggregation);return a.createElement(W,{label:"Aggregation"},a.createElement(T.Ph,{inputId:"azure-monitor-metrics-aggregation-field",value:t.azureMonitor?.aggregation||null,onChange:i,options:n,isLoading:o}))};var Ms=v(52081);const Rs=(t,e)=>{const[s,r]=(0,a.useState)({});return(0,a.useEffect)(()=>{let o={};if(t?.series?.length){const c=t.series.flat().filter(u=>u.refId===e.refId).flatMap(u=>u.fields).map(u=>u.labels).flat().filter(u=>u!=null);for(const u of c)for(const[l,m]of Object.entries(u)){const h=l.toLowerCase();o[h]?o[h].add(m):o[h]=new Set([m])}}r(i=>{const n={},c=Object.keys(o);if(c.length===0)return i;for(const u of c)i[u]&&o[u].size<i[u].size?n[u]=i[u]:n[u]=o[u];return n})},[t?.series,e.refId]),s},Cs=({data:t,query:e,dimensionOptions:s,onQueryChange:r})=>{const o=(0,a.useMemo)(()=>e.azureMonitor?.dimensionFilters??[],[e.azureMonitor?.dimensionFilters]),i=Rs(t,e),n=[{label:"==",value:"eq"},{label:"!=",value:"ne"},{label:"starts with",value:"sw"}],c=(0,a.useMemo)(()=>{let p=s;return o.length&&(p=s.filter(b=>!o.some(z=>z.dimension===b.value))),p},[o,s]),u=(p,b,z,A)=>{b[p]=z,A(b)},l=p=>c.concat(s.filter(b=>b.value===p)),m=(p,b)=>{const z=Array.from(i[b.toLowerCase()]??[]);return z.find(A=>A===p)?z.map(A=>({value:A,label:A})):[...z,...p&&p!=="*"?[p]:[]].map(A=>({value:A,label:A}))},h=(p,b)=>{const z=m(void 0,b);if(p)for(const A of p)z.find(V=>V.value===A)||z.push({value:A,label:A});return z},g=p=>n.find(b=>b.value===p)?n:[...n,...p?[{label:p,value:p}]:[]],f=p=>{const b=p.map(z=>({dimension:z.dimension??"",operator:z.operator??"eq",filters:z.filters??[]}));r(we(e,b))},y=(p,b,z)=>a.createElement(Ms.Lh,{spacing:"none"},a.createElement(T.Ph,{menuShouldPortal:!0,placeholder:"Field",value:p.dimension,options:l(p.dimension||""),onChange:A=>u("dimension",p,A.value??"",b)}),a.createElement(T.Ph,{menuShouldPortal:!0,placeholder:"Operation",value:p.operator,options:g(p.operator||"eq"),onChange:A=>u("operator",p,A.value??"",b),allowCustomValue:!0}),p.operator==="eq"||p.operator==="ne"?a.createElement(T.NU,{menuShouldPortal:!0,placeholder:"Select value(s)",value:p.filters,options:h(p.filters,p.dimension??""),onChange:A=>u("filters",p,A.map(V=>V.value??""),b),"aria-label":"dimension-labels-select",allowCustomValue:!0}):a.createElement(T.Ph,{menuShouldPortal:!0,placeholder:"Select value",value:p.filters?p.filters[0]:"",allowCustomValue:!0,options:m(p.filters?p.filters[0]:"",p.dimension??""),onChange:A=>u("filters",p,[A?.value??""],b),isClearable:!0}),a.createElement(M.AccessoryButton,{"aria-label":"Remove",icon:"times",variant:"secondary",onClick:z,type:"button"}));return a.createElement(W,{label:"Dimensions"},a.createElement(M.EditorList,{items:o,onChange:f,renderItem:y}))},Ts=({onQueryChange:t,query:e})=>{const[s,r]=(0,a.useState)(e.azureMonitor?.alias??""),o=(0,a.useCallback)(n=>{n.target instanceof HTMLInputElement&&r(n.target.value)},[]),i=(0,a.useCallback)(()=>{const n=As(e,s);t(n)},[t,e,s]);return a.createElement(W,{label:"Legend format"},a.createElement(U.I,{id:"azure-monitor-metrics-legend-field",placeholder:"Alias patterns",value:s,onChange:o,onBlur:i,width:38}))},Gs=({metricNames:t,query:e,variableOptionGroup:s,onQueryChange:r})=>{const o=(0,a.useCallback)(n=>{if(!n.value)return;const c=ks(e,n.value);r(c)},[r,e]),i=fe(t,s,e.azureMonitor?.metricName);return a.createElement(W,{label:"Metric","data-testid":N.components.queryEditor.metricsQueryEditor.metricName.input},a.createElement(T.Ph,{inputId:"azure-monitor-metrics-metric-field",value:e.azureMonitor?.metricName??null,onChange:o,options:i,allowCustomValue:!0}))},Ds=({metricNamespaces:t,query:e,variableOptionGroup:s,onQueryChange:r})=>{const o=(0,a.useCallback)(c=>{if(!c.value)return;const u=st(e,c.value);r(u)},[r,e]),i=e.azureMonitor?.customNamespace||e.azureMonitor?.metricNamespace,n=fe(t,s,i);return a.createElement(W,{label:"Metric namespace"},a.createElement(T.Ph,{inputId:"azure-monitor-metrics-metric-namespace-field",value:i||null,onChange:o,options:n,allowCustomValue:!0}))},Fs=({query:t,timeGrainOptions:e,variableOptionGroup:s,onQueryChange:r})=>{const o=(0,a.useCallback)(n=>{if(!n.value)return;const c=rt(t,n.value);r(c)},[r,t]),i=(0,a.useMemo)(()=>{const n=I.findClosestTimeGrain("1m",e.map(l=>I.createKbnUnitFromISO8601Duration(l.value))||["1m","5m","15m","30m","1h","6h","12h","1d"]),c=e.map(l=>l.value==="auto"?{...l,description:n}:l);return fe(c,s,t.azureMonitor?.timeGrain)},[e,s,t.azureMonitor?.timeGrain]);return a.createElement(W,{label:"Time grain"},a.createElement(T.Ph,{inputId:"azure-monitor-metrics-time-grain-field",value:t.azureMonitor?.timeGrain,onChange:o,options:i}))},Ls=({onQueryChange:t,query:e})=>{const[s,r]=(0,a.useState)(e.azureMonitor?.top??""),o=(0,a.useCallback)(n=>{n.target instanceof HTMLInputElement&&r(n.target.value)},[]),i=(0,a.useCallback)(()=>{const n=zs(e,s);t(n)},[t,e,s]);return a.createElement(W,{label:"Top"},a.createElement(U.I,{id:"azure-monitor-metrics-top-field",value:s,onChange:o,onBlur:i,width:16}))};function ot(t,e,s){const[r]=(0,a.useState)(()=>Math.random()),[o,i]=(0,a.useState)(),n=(0,a.useMemo)(()=>o??[],[o]);return(0,a.useEffect)(()=>{t().then(c=>{i(c),e(r,void 0)}).catch(c=>{e(r,c)})},s),n}const Le=t=>!t||!t.length?{resourceGroup:"",resourceName:""}:{resourceGroup:t[0].resourceGroup??"",resourceName:t[0].resourceName??""},Is=(t,e,s,r)=>{const{subscription:o}=t,{metricNamespace:i,resources:n}=t.azureMonitor??{},{resourceGroup:c,resourceName:u}=Le(n);return ot(async()=>{if(!o||!c||!u)return;const m=await e.azureMonitorDatasource.getMetricNamespaces({subscription:o,metricNamespace:i,resourceGroup:c,resourceName:u},!1),h=it(m,i);return!i&&h.length&&s(st(t,h[0].value)),h},r,[o,i,c,u])},Ps=(t,e,s,r)=>{const{subscription:o}=t,{metricNamespace:i,metricName:n,resources:c,customNamespace:u}=t.azureMonitor??{},{resourceGroup:l,resourceName:m}=Le(c);return ot(async()=>{if(!o||!i||!l||!m)return;const h=await e.azureMonitorDatasource.getMetricNames({subscription:o,resourceGroup:l,resourceName:m,metricNamespace:i,customNamespace:u});return it(h,n)},r,[o,l,m,i,u])},at={aggOptions:[],timeGrains:[],dimensions:[],isLoading:!1,supportedAggTypes:[],primaryAggType:void 0},Qs=(t,e,s)=>{const[r,o]=(0,a.useState)(at),{subscription:i}=t,{resources:n,metricNamespace:c,metricName:u,aggregation:l,timeGrain:m,customNamespace:h}=t.azureMonitor??{},{resourceGroup:g,resourceName:f}=Le(n);return(0,a.useEffect)(()=>{if(!i||!g||!f||!c||!u){o(at);return}e.azureMonitorDatasource.getMetricMetadata({subscription:i,resourceGroup:g,resourceName:f,metricNamespace:c,metricName:u,customNamespace:h}).then(y=>{const p=(y.supportedAggTypes||[y.primaryAggType]).map(b=>({label:b,value:b}));o({aggOptions:p,timeGrains:y.supportedTimeGrains,dimensions:y.dimensions,isLoading:!1,supportedAggTypes:y.supportedAggTypes??[],primaryAggType:y.primaryAggType})})},[e,i,g,f,c,u,h]),(0,a.useEffect)(()=>{const y=l||r.primaryAggType,p=m||"auto";(y!==l||p!==m)&&s({...t,azureMonitor:{...t.azureMonitor,aggregation:y,timeGrain:p,allowedTimeGrainsMs:r.timeGrains.filter(b=>b.value!=="auto").map(b=>Me.intervalToMs(I.createKbnUnitFromISO8601Duration(b.value)))}})},[s,r,l,m,t]),r};function it(t,e){const s=t.map(St);return e&&!s.find(r=>r.value===e.toLowerCase())&&s.push({label:e,value:e}),s}const xs=({data:t,query:e,datasource:s,variableOptionGroup:r,onChange:o,setError:i})=>{const n=Qs(e,s,o),c=Is(e,s,o,i),u=Ps(e,s,o,i),l=e.azureMonitor?.resources?.map(f=>({subscription:e.subscription,resourceGroup:f.resourceGroup,metricNamespace:e.azureMonitor?.metricNamespace,resourceName:f.resourceName,region:e.azureMonitor?.region}))??[],m=f=>bs[f?.toLocaleLowerCase()??""]??!1,h=(f,y)=>{if(y.length===0)return!1;const p=x(f.uri,f.location),b=x(y[0].uri,y[0].location);return p.subscription!==b.subscription||p.region!==b.region||p.metricNamespace?.toLocaleLowerCase()!==b.metricNamespace?.toLocaleLowerCase()||!m(p.metricNamespace)},g=f=>{if(f.length===0)return"";const y=x(f[0].uri,f[0].location);return m(y.metricNamespace)?"You can select items of the same resource type and location. To select resources of a different resource type or location, please first uncheck your current selection.":""};return a.createElement("span",{"data-testid":"azure-monitor-metrics-query-editor-with-experimental-ui"},a.createElement(M.EditorRows,null,a.createElement(M.EditorRow,null,a.createElement(M.EditorFieldGroup,null,a.createElement(_e,{query:e,datasource:s,variableOptionGroup:r,onQueryChange:o,setError:i,selectableEntryTypes:[R.Resource],resources:l??[],queryType:"metrics",disableRow:h,renderAdvanced:(f,y)=>a.createElement(ws,{resources:f,onChange:y}),selectionNotice:g}),a.createElement(Ds,{metricNamespaces:c,query:e,datasource:s,variableOptionGroup:r,onQueryChange:o,setError:i}),a.createElement(Gs,{metricNames:u,query:e,datasource:s,variableOptionGroup:r,onQueryChange:o,setError:i}),a.createElement(Ns,{query:e,datasource:s,variableOptionGroup:r,onQueryChange:o,setError:i,aggregationOptions:n?.aggOptions??[],isLoading:n.isLoading}),a.createElement(Fs,{query:e,datasource:s,variableOptionGroup:r,onQueryChange:o,setError:i,timeGrainOptions:n?.timeGrains??[]}))),a.createElement(M.EditorRow,null,a.createElement(M.EditorFieldGroup,null,a.createElement(Cs,{data:t,query:e,datasource:s,variableOptionGroup:r,onQueryChange:o,setError:i,dimensionOptions:n?.dimensions??[]}))),a.createElement(M.EditorRow,null,a.createElement(M.EditorFieldGroup,null,a.createElement(Ls,{query:e,datasource:s,variableOptionGroup:r,onQueryChange:o,setError:i}),a.createElement(Ts,{query:e,datasource:s,variableOptionGroup:r,onQueryChange:o,setError:i})))))},Vs=({query:t,onQueryChange:e})=>{const s=[{value:d.AzureMonitor,label:"Metrics"},{value:d.LogAnalytics,label:"Logs"},{value:d.AzureResourceGraph,label:"Azure Resource Graph"}],r=(0,a.useCallback)(o=>{o.value&&e({...t,queryType:o.value})},[e,t]);return a.createElement("span",{"data-testid":N.components.queryEditor.header.select},a.createElement(M.EditorHeader,null,a.createElement(M.InlineSelect,{label:"Service",value:t.queryType,placeholder:"Service...",allowCustomValue:!0,options:s,onChange:r})))};var $s=v(10322),Ws=v.n($s);const Us="select";function Ie(t){let e=t;return e.queryType||(e={...e,queryType:d.AzureMonitor}),e=Os(e),e.queryType===d.AzureMonitor&&e.azureMonitor&&(e=Xs(e),e=js(e),e=Bs(e),e=Hs(e),e=Js(e)),(e.azureMonitor?.resourceGroup||e.azureMonitor?.resourceName)&&(e=Ks(e)),e.azureLogAnalytics?.resource&&(e={...e,azureLogAnalytics:{...e.azureLogAnalytics,resources:[e.azureLogAnalytics.resource]}},delete e.azureLogAnalytics?.resource),e}function Xs(t){let e=t;if(e.azureMonitor?.timeGrainUnit&&e.azureMonitor.timeGrain!=="auto"){const s=I.createISO8601Duration(e.azureMonitor.timeGrain??"auto",e.azureMonitor.timeGrainUnit);e=rt(e,s),delete e.azureMonitor?.timeGrainUnit}return e}function Os(t){let e=t;return e.azureLogAnalytics?.query?.match(/\$__from\s/gi)&&(e=De(e,e.azureLogAnalytics.query.replace(/\$__from\s/gi,"$__timeFrom() "))),e.azureLogAnalytics?.query?.match(/\$__to\s/gi)&&(e=De(e,e.azureLogAnalytics.query.replace(/\$__to\s/gi,"$__timeTo() "))),e}function js(t){return!(t.azureMonitor?.metricNamespace&&t.azureMonitor.metricNamespace!==Us)&&t.azureMonitor?.metricDefinition?{...t,azureMonitor:{...t.azureMonitor,metricNamespace:t.azureMonitor.metricDefinition,metricDefinition:void 0}}:t}function Bs(t){let e=t;const s=e.azureMonitor?.dimension;return s&&s!=="None"&&(e=Es(e,s,"eq",[e.azureMonitor?.dimensionFilter||""])),delete e.azureMonitor?.dimension,delete e.azureMonitor?.dimensionFilter,e}function Hs(t){const e=t.azureMonitor;if(!e)return t;const s=[],r=e.dimensionFilters;return r&&r.length>0&&(r.forEach(o=>{const i={dimension:o.dimension,operator:o.operator};if(!o.filters&&o.filter)s.push({...i,filters:[o.filter]});else{let n=!1;if(o.filters&&o.filter){for(const c of o.filters)if(o.filter===c){n=!0;break}!n&&o.filter!=="*"&&o.filters.push(o.filter),s.push({...i,filters:o.filters})}}}),s.length>0)?{...t,azureMonitor:{...e,dimensionFilters:s}}:t}function Js(t){if(t.azureMonitor?.resourceUri&&!t.azureMonitor.resourceUri.startsWith("$")){const e=x(t.azureMonitor.resourceUri),s=e?.subscription&&e?.resourceGroup&&e?.resourceName;return{...t,subscription:e?.subscription,azureMonitor:{...t.azureMonitor,resources:[{resourceGroup:e?.resourceGroup,resourceName:e?.resourceName}],metricNamespace:e?.metricNamespace,resourceUri:s?void 0:t.azureMonitor.resourceUri}}}return t}function Ks(t){let e=t;return e.azureMonitor&&(e.azureMonitor.resources=[{resourceGroup:e.azureMonitor.resourceGroup,resourceName:e.azureMonitor.resourceName}],delete e.azureMonitor.resourceGroup,delete e.azureMonitor.resourceName),e}const Zs={queryType:d.AzureMonitor},qs=t=>{const e=(0,w.defaults)({},t,Zs),s=Ie(e);return Ws()(s,t)?t:s},Ys=(t,e)=>{const s=(0,a.useMemo)(()=>qs(t),[t]);return(0,a.useEffect)(()=>{s!==t&&e(s)},[s,t,e]),s},_s=({query:t,datasource:e,onChange:s,onRunQuery:r,data:o})=>{const[i,n]=Xe(),c=(0,a.useMemo)(()=>(0,w.debounce)(r,500),[r]),u=(0,a.useCallback)(g=>{s(g),c()},[s,c]),l=Ys(t,u),m=l.subscription||e.azureMonitorDatasource.defaultSubscriptionId,h={label:"Template Variables",options:e.getVariables().map(g=>({label:g,value:g}))};return a.createElement("div",{"data-testid":"azure-monitor-query-editor"},a.createElement(Vs,{query:l,onQueryChange:u}),a.createElement(er,{data:o,subscriptionId:m,query:l,datasource:e,onChange:u,variableOptionGroup:h,setError:n}),i&&a.createElement(a.Fragment,null,a.createElement(F,{v:2}),a.createElement(O.b,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor"},i)))},er=({data:t,subscriptionId:e,query:s,datasource:r,variableOptionGroup:o,onChange:i,setError:n})=>{switch(s.queryType){case d.AzureMonitor:return a.createElement(xs,{data:t,query:s,datasource:r,onChange:i,variableOptionGroup:o,setError:n});case d.LogAnalytics:return a.createElement(tt,{subscriptionId:e,query:s,datasource:r,onChange:i,variableOptionGroup:o,setError:n});case d.AzureResourceGraph:return a.createElement(Be,{subscriptionId:e,query:s,datasource:r,onChange:i,variableOptionGroup:o,setError:n});default:const c=s.queryType;return a.createElement(O.b,{title:"Unknown query type"},(c==="Application Insights"||c==="Insights Analytics")&&a.createElement(a.Fragment,null,c," was deprecated in Grafana 9. See the"," ",a.createElement("a",{href:"https://grafana.com/docs/grafana/latest/datasources/azuremonitor/deprecated-application-insights/",target:"_blank",rel:"noreferrer"},"deprecation notice")," ","to get more information about how to migrate your queries. This is the current query definition:",a.createElement(Ce.p,{height:"200px",readOnly:!0,language:"json",value:JSON.stringify(s,null,4)})))}},tr=_s;var sr=v(53208),rr=v(59980),or=v(9471),nt=v(49922),ue=v(22069),ar=v(58155),ke=v(46519);class ir{constructor(e,s,r){this.rawQueryString=e,this.options=s,this.defaultTimeField=r}generate(){let e=this.rawQueryString;const s=/\$__([_a-zA-Z0-9]+)\(([^()]*)\)/gi;e=e.replace(s,(i,n,c)=>n==="contains"?this.getMultiContains(c):i),e=e.replace(/\$__escapeMulti\(('[^]*')\)/gi,(i,n)=>this.escape(n)),this.options&&(e=e.replace(s,(i,n,c)=>n==="timeFilter"?this.getTimeFilter(c,this.options):n==="timeFrom"?this.getFrom(this.options):n==="timeTo"?this.getUntil(this.options):i),e=e.replace(/\$__interval/gi,this.options.interval));const r=e;return e=encodeURIComponent(e),{uriString:`query=${e}`,rawQuery:r}}getFrom(e){const s=e.range.from;return`datetime(${(0,ke.CQ)(s).startOf("minute").toISOString()})`}getUntil(e){if(e.rangeRaw?.to==="now"){const s=Date.now();return`datetime(${(0,ke.CQ)(s).startOf("minute").toISOString()})`}else{const s=e.range.to;return`datetime(${(0,ke.CQ)(s).startOf("minute").toISOString()})`}}getTimeFilter(e,s){const r=e||this.defaultTimeField;return s.rangeRaw?.to==="now"?`${r} >= ${this.getFrom(s)}`:`${r}  >= ${this.getFrom(s)} and ${r} <= ${this.getUntil(s)}`}getMultiContains(e){const s=e.indexOf(","),r=e.substring(0,s),o=e.substring(e.indexOf(",")+1);return o&&o.toLowerCase().trim()==="all"?"1 == 1":`${r.trim()} in (${o.trim()})`}escape(e){return e.substring(1,e.length-1).split("','").map(s=>`@'${s}'`).join(", ")}}class se{constructor(e){this.results=e}parseQueryResult(){let e=[],s=[];for(let r=0;r<this.results.length;r++){if(this.results[r].result.tables.length===0)continue;s=this.results[r].result.tables[0].columns;const o=this.results[r].result.tables[0].rows;this.results[r].query.resultFormat==="time_series"?e=(0,w.concat)(e,this.parseTimeSeriesResult(this.results[r].query,s,o)):e=(0,w.concat)(e,this.parseTableResult(this.results[r].query,s,o))}return e}parseTimeSeriesResult(e,s,r){const o=[];let i=-1,n=-1,c=-1;for(let u=0;u<s.length;u++)i===-1&&s[u].type==="datetime"&&(i=u),n===-1&&s[u].type==="string"&&(n=u),c===-1&&["int","long","real","double"].indexOf(s[u].type)>-1&&(c=u);if(i===-1)throw new Error("No datetime column found in the result. The Time Series format requires a time column.");return(0,w.forEach)(r,u=>{const l=se.dateTimeToEpoch(u[i]),m=n>-1?u[n]:s[c].name,h=se.findOrCreateBucket(o,m);h.datapoints.push([u[c],l]),h.refId=e.refId,h.meta={executedQueryString:e.query}}),o}parseTableResult(e,s,r){return{type:"table",columns:(0,w.map)(s,i=>({text:i.name,type:i.type})),rows:r,refId:e.refId,meta:{executedQueryString:e.query}}}parseToVariables(){const e=this.parseQueryResult(),s=[];return(0,w.forEach)(e,r=>{(0,w.forEach)((0,w.flattenDeep)(r.rows),o=>{s.push({text:o,value:o})})}),s}transformToAnnotations(e){const s=this.parseQueryResult(),r=[];return(0,w.forEach)(s,o=>{let i=-1,n=-1,c=-1;for(let u=0;u<o.columns.length;u++)i===-1&&o.columns[u].type==="datetime"&&(i=u),n===-1&&o.columns[u].text.toLowerCase()==="text"&&(n=u),c===-1&&o.columns[u].text.toLowerCase()==="tags"&&(c=u);(0,w.forEach)(o.rows,u=>{r.push({annotation:e.annotation,time:Math.floor(se.dateTimeToEpoch(u[i])),text:u[n]?u[n].toString():"",tags:u[c]?u[c].trim().split(/\s*,\s*/):[]})})}),r}static findOrCreateBucket(e,s){let r=(0,w.find)(e,["target",s]);return r||(r={target:s,datapoints:[],refId:"",query:""},e.push(r)),r}static dateTimeToEpoch(e){return(0,ke.CQ)(e).valueOf()}static parseSubscriptions(e){const s=[];if(!e)return s;const r="subscriptionId",o="displayName";for(let i=0;i<e.value.length;i++)(0,w.find)(s,["value",(0,w.get)(e.value[i],r)])||s.push({text:`${(0,w.get)(e.value[i],o)}`,value:(0,w.get)(e.value[i],r)});return s}}const nr=/([\w\W]+):([\w]+)(?:\s?=\s?([\w\W]+))?/;function cr(t){return t.functions?t.functions.map(e=>{const s=e.parameters&&e.parameters.split(", ").map(r=>{const o=r.match(nr);if(!o)return;const[,i,n,c]=o;return{name:i,type:n,defaultValue:c,cslDefaultValue:c}}).filter(r=>!!r);return{name:e.name,body:e.body,inputParameters:s||[]}}):[]}function ur(t,e,s){const r={name:e,tables:t.tables,functions:cr(t),majorVersion:0,minorVersion:0};r.functions.push({name:"$__timeFilter",body:"{ true }",inputParameters:[{name:"timeColumn",type:"System.String",defaultValue:'""',cslDefaultValue:'""'}]},{name:"$__timeFrom",body:"{ datetime(2018-06-05T18:09:58.907Z) }",inputParameters:[]},{name:"$__timeTo",body:"{ datetime(2018-06-05T20:09:58.907Z) }",inputParameters:[]},{name:"$__escapeMulti",body:"{ @'\\grafana-vmNetwork(eth0)Total', @'\\hello!'}",inputParameters:[{name:"$myVar",type:"System.String",defaultValue:"$myVar",cslDefaultValue:"$myVar"}]},{name:"$__contains",body:"{ colName in ('value1','value2') }",inputParameters:[{name:"colName",type:"System.String",defaultValue:"colName",cslDefaultValue:"colName"},{name:"$myVar",type:"System.String",defaultValue:"$myVar",cslDefaultValue:"$myVar"}]});const o=s.map(i=>({name:`$${i.name}`,type:"dynamic"}));return{clusterType:"Engine",cluster:{connectionString:e,databases:[r]},database:r,globalParameters:o}}class lr extends ue.CK{constructor(e){super(e),this.instanceSettings=e,this.resourcePath=`${H.logAnalytics}`,this.azureMonitorPath=`${H.azureMonitor}/subscriptions`;const s=We(e);this.azurePortalUrl=$e(s),this.defaultSubscriptionId=this.instanceSettings.jsonData.subscriptionId||""}isConfigured(){return!this.validateDatasource()}filterQuery(e){return e.hide!==!0&&!!e.azureLogAnalytics?.query&&(!!e.azureLogAnalytics.resources?.length||!!e.azureLogAnalytics.workspace)}async getSubscriptions(){if(!this.isConfigured())return[];const e=`${this.azureMonitorPath}?api-version=2019-03-01`;return await this.getResource(e).then(s=>se.parseSubscriptions(s))}async getWorkspaces(e){const s=await this.getWorkspaceList(e);return(0,w.map)(s.value,r=>({text:r.name,value:r.id}))||[]}getWorkspaceList(e){const s=(0,L.J)().replace(e||this.defaultSubscriptionId),r=this.azureMonitorPath+`/${s}/providers/Microsoft.OperationalInsights/workspaces?api-version=2017-04-26-preview`;return this.getResource(r)}async getMetadata(e){const s=`${this.resourcePath}/v1${e}/metadata`;return await this.getResource(s)}async getKustoSchema(e){const s=(0,L.J)(),r=s.replace(e,{},ge),o=await this.getMetadata(r);return ur(o,r,s.getVariables())}applyTemplateVariables(e,s){const r=e.azureLogAnalytics;if(!r)return e;const o=(0,L.J)(),i=r.resources?.map(u=>o.replace(u,s));let n=o.replace(r.workspace,s);!n&&!i&&this.firstWorkspace&&(n=this.firstWorkspace);const c=o.replace(r.query,s,ge);return{...e,queryType:d.LogAnalytics,azureLogAnalytics:{resultFormat:r.resultFormat,query:c,resources:i,workspace:n}}}getDeprecatedDefaultWorkSpace(){return this.instanceSettings.jsonData.logAnalyticsDefaultWorkspace}buildQuery(e,s,r){const i=new ir((0,L.J)().replace(e,{},ge),s,"TimeGenerated").generate().uriString,n=Te(r)?`${this.resourcePath}/v1/workspaces/${r}/query?${i}`:`${this.resourcePath}/v1${r}/query?${i}`;return[{datasource:this.getRef(),path:n,resultFormat:"table"}]}async getDefaultOrFirstSubscription(){return this.defaultSubscriptionId?this.defaultSubscriptionId:(await this.getSubscriptions())[0]?.value}async getFirstWorkspace(){if(this.firstWorkspace)return this.firstWorkspace;const e=await this.getDefaultOrFirstSubscription();if(!e)return;const r=(await this.getWorkspaces(e))[0]?.value;return r&&(this.firstWorkspace=r),r}annotationQuery(e){if(!e.annotation.rawQuery)return Promise.reject({message:"Query missing in annotation definition"});const s=this.buildQuery(e.annotation.rawQuery,e,e.annotation.workspace),r=this.doQueries(s);return Promise.all(r).then(o=>new se(o).transformToAnnotations(e))}doQueries(e){return(0,w.map)(e,s=>this.getResource(s.path).then(r=>({result:r,query:s})).catch(r=>{throw{error:r,query:s}}))}validateDatasource(){if(he(this.instanceSettings)==="clientsecret"){if(!this.isValidConfigField(this.instanceSettings.jsonData.tenantId))return{status:"error",message:"The Tenant Id field is required."};if(!this.isValidConfigField(this.instanceSettings.jsonData.clientId))return{status:"error",message:"The Client Id field is required."}}}isValidConfigField(e){return typeof e=="string"&&e.length>0}}var mr=v(19349);const pr="select";function re(t){return!!(t&&t!==pr)}class dr extends ue.CK{constructor(e){super(e),this.instanceSettings=e,this.apiVersion="2018-01-01",this.apiPreviewVersion="2017-12-01-preview",this.listByResourceGroupApiVersion="2021-04-01",this.providerApiVersion="2021-04-01",this.locationsApiVersion="2020-01-01",this.timeSrv=(0,mr.$t)(),this.templateSrv=(0,L.J)(),this.defaultSubscriptionId=e.jsonData.subscriptionId;const s=We(e);this.resourcePath=H.azureMonitor,this.azurePortalUrl=$e(s)}isConfigured(){return!this.validateDatasource()}filterQuery(e){const s=e?.azureMonitor?.resources&&e.azureMonitor.resources.length>0&&e.azureMonitor.resources.every(o=>re(o.resourceGroup)&&re(o.resourceName))&&re(e?.azureMonitor?.metricDefinition||e?.azureMonitor?.metricNamespace),r=re(e.azureMonitor?.resourceUri);return!!(e.hide!==!0&&(s||r)&&re(e?.azureMonitor?.metricName)&&re(e?.azureMonitor?.aggregation))}applyTemplateVariables(e,s){const r=e.azureMonitor;if(!r)throw new Error("Query is not a valid Azure Monitor Metrics query");r.timeGrain&&r.timeGrainUnit&&r.timeGrain!=="auto"&&(r.timeGrain=I.createISO8601Duration(r.timeGrain,r.timeGrainUnit));const o=(0,L.J)(),i=o.replace(e.subscription||this.defaultSubscriptionId,s),n=r.resources?.map(y=>this.replaceTemplateVariables(y,s)).flat(),c=o.replace(r.metricNamespace,s),u=o.replace(r.customNamespace,s),l=o.replace((r.timeGrain||"").toString(),s),m=o.replace(r.aggregation,s),h=o.replace(r.top||"",s),g=(r.dimensionFilters??[]).filter(y=>y.dimension&&y.dimension!=="None").map(y=>{const p=y.filters?.map(b=>o.replace(b??"",s));return{dimension:o.replace(y.dimension,s),operator:y.operator||"eq",filters:p||[]}}),f={...r,resources:n,metricNamespace:c,customNamespace:u,timeGrain:l,allowedTimeGrainsMs:r.allowedTimeGrainsMs,metricName:o.replace(r.metricName,s),region:o.replace(r.region,s),aggregation:m,dimensionFilters:g,top:h||"10",alias:r.alias};return r.metricDefinition&&(f.metricDefinition=o.replace(r.metricDefinition,s)),r.resourceUri&&(f.resourceUri=o.replace(r.resourceUri,s)),Ie({...e,subscription:i,queryType:d.AzureMonitor,azureMonitor:f})}async getSubscriptions(){return this.isConfigured()?this.getResource(`${this.resourcePath}/subscriptions?api-version=2019-03-01`).then(e=>P.parseSubscriptions(e)):[]}getResourceGroups(e){return this.getResource(`${this.resourcePath}/subscriptions/${e}/resourceGroups?api-version=${this.listByResourceGroupApiVersion}`).then(s=>P.parseResponseValues(s,"name","name"))}async getResourceNames(e,s){const r=this.replaceTemplateVariables(e).map(({metricNamespace:o,subscriptionId:i,resourceGroup:n,region:c})=>{const u=(0,w.startsWith)(o?.toLowerCase(),"microsoft.storage/storageaccounts/")?"microsoft.storage/storageaccounts":o;let l=`${this.resourcePath}/subscriptions/${i}`;n&&(l+=`/resourceGroups/${n}`),l+=`/resources?api-version=${this.listByResourceGroupApiVersion}`;const m=[];return u&&m.push(`resourceType eq '${u}'`),c&&m.push(`location eq '${c}'`),m.length>0&&(l+=`&$filter=${m.join(" and ")}`),s&&(l+=`&$skiptoken=${s}`),this.getResource(l).then(async h=>{let g=[];if((0,w.startsWith)(o?.toLowerCase(),"microsoft.storage/storageaccounts/")){g=P.parseResourceNames(h,"microsoft.storage/storageaccounts");for(let f=0;f<g.length;f++)g[f].text+="/default",g[f].value+="/default"}else g=P.parseResourceNames(h,o);if(h.nextLink){const y=new URL(h.nextLink).searchParams.get("$skiptoken");if(!y)throw Error("unable to request the next page of resources");const p=await this.getResourceNames({metricNamespace:o,subscriptionId:i,resourceGroup:n},y);g=g.concat(p)}return g})});return(await Promise.all(r)).flat()}getMetricNamespaces(e,s){const r=K.buildAzureMonitorGetMetricNamespacesUrl(this.resourcePath,this.apiPreviewVersion,this.replaceSingleTemplateVariables(e),s,this.templateSrv);return this.getResource(r).then(o=>P.parseResponseValues(o,"properties.metricNamespaceName","properties.metricNamespaceName")).then(o=>{if(r.toLowerCase().includes("microsoft.storage/storageaccounts")){const i=["microsoft.storage/storageaccounts","microsoft.storage/storageaccounts/blobservices","microsoft.storage/storageaccounts/fileservices","microsoft.storage/storageaccounts/tableservices","microsoft.storage/storageaccounts/queueservices"];for(const n of i)(0,w.find)(o,["value",n.toLowerCase()])||o.push({value:n,text:n})}return o})}getMetricNames(e){const s=K.buildAzureMonitorGetMetricNamesUrl(this.resourcePath,this.apiVersion,this.replaceSingleTemplateVariables(e),this.templateSrv);return this.getResource(s).then(r=>P.parseResponseValues(r,"name.localizedValue","name.value"))}getMetricMetadata(e){const{metricName:s}=e,r=K.buildAzureMonitorGetMetricNamesUrl(this.resourcePath,this.apiVersion,this.replaceSingleTemplateVariables(e),this.templateSrv);return this.getResource(r).then(o=>P.parseMetadata(o,this.templateSrv.replace(s)))}validateDatasource(){if(he(this.instanceSettings)==="clientsecret"){if(!this.isValidConfigField(this.instanceSettings.jsonData.tenantId))return{status:"error",message:"The Tenant Id field is required."};if(!this.isValidConfigField(this.instanceSettings.jsonData.clientId))return{status:"error",message:"The Client Id field is required."}}}isValidConfigField(e){return typeof e=="string"&&e.length>0}replaceSingleTemplateVariables(e,s){return this.replaceTemplateVariables(e,s)[0]}replaceTemplateVariables(e,s){const r=[{...e}];return Object.keys(e).forEach(i=>{const n=this.templateSrv.replace(r[0][i],s,"raw");if(n.includes(",")){const c=n.split(","),u=[...r];c.forEach((l,m)=>{u.forEach(h=>{m===0?h[i]=l:r.push({...h,[i]:l})})})}else r.forEach(c=>{c[i]=n})}),r}async getProvider(e){return await this.getResource(`${H.azureMonitor}/providers/${e}?api-version=${this.providerApiVersion}`)}async getLocations(e){const s=new Map;for(const r of e){const o=P.parseLocations(await this.getResource(`${H.azureMonitor}/subscriptions/${this.templateSrv.replace(r)}/locations?api-version=${this.locationsApiVersion}`));for(const i of o)s.set(i.name,i)}return s}}class fr extends ue.CK{filterQuery(e){return!!e.azureResourceGraph?.query&&!!e.subscriptions&&e.subscriptions.length>0}applyTemplateVariables(e,s){const r=e.azureResourceGraph;if(!r)return e;const o=(0,L.J)(),i=o.getVariables().map(m=>`$${m.name}`),n=de().find(e.subscriptions,m=>de().includes(i,m)),u=[...o.replace(n,s,m=>m).split(",").filter(m=>m.length>0),...de().filter(e.subscriptions,m=>!de().includes(i,m))],l=o.replace(r.query,s,ge);return{...e,queryType:d.AzureResourceGraph,subscriptions:u,azureResourceGraph:{resultFormat:"table",query:l}}}}const gr="/providers/Microsoft.ResourceGraph/resources?api-version=2021-03-01",hr=vs.map(t=>`"${t}"`).join(",");class br extends ue.CK{constructor(e,s){super(e),this.resultLimit=200,this.supportedMetricNamespaces="",this.logLocationsMap=new Map,this.logLocations=[],this.search=async(r,o)=>{let i="resources";o==="logs"&&(i+=`
      | union resourcecontainers`),i+=`
        | where id contains "${r}"
        ${await this.filterByType(o)}
        | order by tolower(name) asc
        | limit ${this.resultLimit}
      `;const{data:n}=await this.makeResourceGraphRequest(i);return n.map(c=>{const u=ve(c.id);if(!u||!(u.resourceName||u.resourceGroup||u.subscription))throw new Error("unable to fetch resource details");let l=u.subscription??"",m=R.Subscription;return u.resourceName?(l=u.resourceName,m=R.Resource):u.resourceGroup&&(l=u.resourceGroup,m=R.ResourceGroup),{name:c.name,id:l,uri:c.id,resourceGroupName:c.resourceGroup,type:m,typeLabel:Fe[c.type]||c.type,location:this.logLocationsMap.get(c.location)?.displayName||c.location}})},this.filterByType=async r=>(this.supportedMetricNamespaces===""&&r!=="logs"&&await this.fetchAllNamespaces(),r==="logs"?`| where type in (${hr})`:`| where type in (${this.supportedMetricNamespaces})`),this.resourcePath=`${H.resourceGraph}`,this.azureMonitorDatasource=s}async fetchInitialRows(e,s){const r=await this.getSubscriptions();if(this.logLocationsMap.size===0&&(this.logLocationsMap=await this.getLogsLocations(r),this.logLocations=Array.from(this.logLocationsMap.values()).map(n=>`"${n.name}"`)),!s)return r;let o=r;const i=s.map(n=>async()=>{if(n.subscription){const c=`/subscriptions/${n.subscription}/resourceGroups/${n.resourceGroup}`;if(n.resourceGroup&&!te(o,c)){const l=await this.getResourceGroupsBySubscriptionId(n.subscription,e);o=Ge(o,`/subscriptions/${n.subscription}`,l)}const u=ye(n);if(n.resourceName&&!te(o,u)){const l=await this.getResourcesForResourceGroup(c,e);o=Ge(o,c,l)}}});for(const n of i)await n();return o}async fetchAndAppendNestedRow(e,s,r){const o=s.type===R.Subscription?await this.getResourceGroupsBySubscriptionId(s.id,r):await this.getResourcesForResourceGroup(s.id,r);return Ge(e,s.uri,o)}async getSubscriptions(){const e=`
    resources
    | join kind=inner (
              ResourceContainers
                | where type == 'microsoft.resources/subscriptions'
                | project subscriptionName=name, subscriptionURI=id, subscriptionId
              ) on subscriptionId
    | summarize count() by subscriptionName, subscriptionURI, subscriptionId
    | order by subscriptionName desc
  `;let s=[],r=!1,o;for(;!r;){let i={};o&&(i={$skipToken:o});const n=await this.makeResourceGraphRequest(e,1,i);if(!n.data.length)throw new Error("No subscriptions were found");s=s.concat(n.data),o=n.$skipToken,r=!o}return s.map(i=>({name:i.subscriptionName,id:i.subscriptionId,uri:`/subscriptions/${i.subscriptionId}`,typeLabel:"Subscription",type:R.Subscription,children:[]}))}async getResourceGroupsBySubscriptionId(e,s){const r=`
    resources
     | join kind=inner (
       ResourceContainers
       | where type == 'microsoft.resources/subscriptions/resourcegroups'
       | project resourceGroupURI=id, resourceGroupName=name, resourceGroup, subscriptionId
     ) on resourceGroup, subscriptionId

     ${await this.filterByType(s)}
     | where subscriptionId == '${e}'
     | summarize count() by resourceGroupName, resourceGroupURI
     | order by resourceGroupURI asc`;let o=[],i=!1,n;for(;!i;){let c={};n&&(c={$skipToken:n});const u=await this.makeResourceGraphRequest(r,1,c);o=o.concat(u.data),n=u.$skipToken,i=!n}return o.map(c=>{const u=ve(c.resourceGroupURI);if(!u||!u.resourceGroup)throw new Error("unable to fetch resource groups");return{name:c.resourceGroupName,uri:c.resourceGroupURI,id:u.resourceGroup,type:R.ResourceGroup,typeLabel:"Resource Group",children:[]}})}async getResourcesForResourceGroup(e,s){if(!this.logLocations)return[];const{data:r}=await this.makeResourceGraphRequest(`
      resources
      | where id hasprefix "${e}"
      ${await this.filterByType(s)} and location in (${this.logLocations})
    `);return r.map(o=>{const i=ve(o.id);if(!i||!i.resourceName)throw new Error("unable to fetch resource details");return{name:o.name,id:i.resourceName,uri:o.id,resourceGroupName:o.resourceGroup,type:R.Resource,typeLabel:Fe[o.type]||o.type,locationDisplayName:this.logLocationsMap.get(o.location)?.displayName||o.location,location:o.location}})}async getResourceURIDisplayProperties(e){const{subscription:s,resourceGroup:r,resourceName:o}=x(e)??{};if(!s)throw new Error("Invalid resource URI passed");const i=`/subscriptions/${s}`,n=`${i}/resourceGroups/${r}`,c=`
    resourcecontainers
    | where type == "microsoft.resources/subscriptions"
    | where id =~ "${i}"
    | project subscriptionName=name, subscriptionId

    | join kind=leftouter (
      resourcecontainers            
            | where type == "microsoft.resources/subscriptions/resourcegroups"
            | where id =~ "${n}"
            | project resourceGroupName=name, resourceGroup, subscriptionId
        ) on subscriptionId

        | join kind=leftouter (
          resources
            | where id =~ "${e}"
            | project resourceName=name, subscriptionId
        ) on subscriptionId

        | project subscriptionName, resourceGroupName, resourceName
    `,{data:u}=await this.makeResourceGraphRequest(c);if(!u.length)throw new Error("unable to fetch resource details");const{subscriptionName:l,resourceGroupName:m,resourceName:h}=u[0];return{subscription:l||s,resourceGroup:m||r,resourceName:h||o}}async getResourceURIFromWorkspace(e){const{data:s}=await this.makeResourceGraphRequest(`
      resources
      | where properties['customerId'] == "${e}"
      | project id
    `);if(!s.length)throw new Error("unable to find resource for workspace "+e);return s[0].id}async makeResourceGraphRequest(e,s=1,r){try{return await this.postResource(this.resourcePath+gr,{query:e,options:{resultFormat:"objectArray",...r}})}catch(o){if(s>0)return this.makeResourceGraphRequest(e,s-1);throw o}}async fetchAllNamespaces(){const e=await this.getSubscriptions();let s=[];for await(const r of e){const o=await this.azureMonitorDatasource.getMetricNamespaces({resourceUri:`/subscriptions/${r.id}`},!0);if(o){const i=o.map(n=>`"${n.value.toLocaleLowerCase()}"`);s=s.concat(i)}}if(s.length===0)throw new Error("Unable to resolve a list of valid metric namespaces. Validate the datasource configuration is correct and required permissions have been granted for all subscriptions. Grafana requires at least the Reader role to be assigned.");this.supportedMetricNamespaces=(0,w.uniq)(s).join(",")}async getLogsLocations(e){const s=e.map(u=>u.id),r=await this.azureMonitorDatasource.getLocations(s),i=(await this.azureMonitorDatasource.getProvider("Microsoft.Insights"))?.resourceTypes.find(u=>u.resourceType==="logs");if(!i)return r;const n=i.locations.map(u=>({displayName:u,name:"",supportsLogs:!0})),c=new Map;for(const u of n){const l=Array.from(r.values()).find(m=>u.displayName===m.displayName)?.name||"";l!==""&&c.set(l,{...u,name:l})}return c}parseRows(e){const s=Z(e),r=[];return s.forEach((o,i)=>{let n=o.resourceName,c=o.resourceName,u=R.Resource;n||(n=o.resourceGroup,c=o.resourceGroup,u=R.ResourceGroup,n||(n=o.subscription,c=o.subscription,u=R.Subscription)),r.push({id:n??"",name:c??"",type:u,uri:ye(o),typeLabel:Fe[o.metricNamespace?.toLowerCase()??""]??o.metricNamespace??"",locationDisplayName:this.logLocationsMap.get(o.region??"")?.displayName||o.region,location:o.region})}),r}}function vr(t){const e=typeof t.rawQuery=="string"?t.rawQuery:null,s=typeof t.workspace=="string"?t.workspace:null;if(!(e&&s&&!t.target?.azureLogAnalytics?.query))return t;const r={...t.target??{},refId:t.target?.refId??"Anno",queryType:d.LogAnalytics,azureLogAnalytics:{query:e,resources:[s]}};return{...t,rawQuery:void 0,workspace:void 0,subscription:void 0,queryType:void 0,target:r}}var yr=v(65583),wr=v(49372),kr=v(59670),B=v(16911);const ct=t=>({subscriptions:t.match(/^Subscriptions\(\)/i),resourceGroups:t.match(/^ResourceGroups\(\)/i),resourceGroupsWithSub:t.match(/^ResourceGroups\(([^\)]+?)(,\s?([^,]+?))?\)/i),namespaces:t.match(/^Namespaces\(([^\)]+?)(,\s?([^,]+?))?\)/i),namespacesWithSub:t.match(/^Namespaces\(([^,]+?),\s?([^,]+?)\)/i),resourceNames:t.match(/^ResourceNames\(([^,]+?),\s?([^,]+?)\)/i),resourceNamesWithSub:t.match(/^ResourceNames\(([^,]+?),\s?([^,]+?),\s?(.+?)\)/i),metricNamespace:t.match(/^MetricNamespace\(([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNamespaceWithSub:t.match(/^metricnamespace\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNames:t.match(/^MetricNames\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNamesWithSub:t.match(/^MetricNames\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?(.+?)\)/i),appInsightsMetricNameQuery:t.match(/^AppInsightsMetricNames\(\)/i),appInsightsGroupByQuery:t.match(/^AppInsightsGroupBys\(([^\)]+?)(,\s?([^,]+?))?\)/i),workspacesQuery:t.match(/^workspaces\(\)/i),workspacesQueryWithSub:t.match(/^workspaces\(["']?([^\)]+?)["']?\)/i)}),Sr=t=>{const e=ct(t);return Object.keys(e).some(s=>!!e[s])},Er=(t,e)=>{const s=ct(t),r=e.azureMonitorDatasource.defaultSubscriptionId,o=()=>s.appInsightsMetricNameQuery?{rawQuery:t,kind:"AppInsightsMetricNameQuery"}:s.appInsightsGroupByQuery?{kind:"AppInsightsGroupByQuery",rawQuery:t,metricName:s.appInsightsGroupByQuery[1]}:s.subscriptions?{kind:"SubscriptionsQuery",rawQuery:t}:s.resourceGroupsWithSub?{kind:"ResourceGroupsQuery",rawQuery:t,subscription:s.resourceGroupsWithSub[1]}:s.resourceGroups&&r?{kind:"ResourceGroupsQuery",rawQuery:t,subscription:r}:s.namespacesWithSub?{kind:"MetricNamespaceQuery",rawQuery:t,subscription:s.namespacesWithSub[1],resourceGroup:s.namespacesWithSub[2]}:s.namespaces&&r?{kind:"MetricNamespaceQuery",rawQuery:t,subscription:r,resourceGroup:s.namespaces[1]}:s.resourceNamesWithSub?{kind:"ResourceNamesQuery",rawQuery:t,subscription:s.resourceNamesWithSub[1],resourceGroup:s.resourceNamesWithSub[2],metricNamespace:s.resourceNamesWithSub[3]}:s.resourceNames&&r?{kind:"ResourceNamesQuery",rawQuery:t,subscription:r,resourceGroup:s.resourceNames[1],metricNamespace:s.resourceNames[2]}:s.metricNamespaceWithSub?{kind:"MetricNamespaceQuery",rawQuery:t,subscription:s.metricNamespaceWithSub[1],resourceGroup:s.metricNamespaceWithSub[2],metricNamespace:s.metricNamespaceWithSub[3],resourceName:s.metricNamespaceWithSub[4]}:s.metricNamespace&&r?{kind:"MetricNamespaceQuery",rawQuery:t,subscription:r,resourceGroup:s.metricNamespace[1],metricNamespace:s.metricNamespace[2],resourceName:s.metricNamespace[3]}:s.metricNames&&r&&s.metricNames[3].indexOf(",")===-1?{kind:"MetricNamesQuery",rawQuery:t,subscription:r,resourceGroup:s.metricNames[1],metricNamespace:s.metricNames[2],resourceName:s.metricNames[3]}:s.metricNamesWithSub?{kind:"MetricNamesQuery",rawQuery:t,subscription:s.metricNamesWithSub[1],resourceGroup:s.metricNamesWithSub[2],metricNamespace:s.metricNamesWithSub[3],resourceName:s.metricNamesWithSub[4]}:s.workspacesQueryWithSub?{kind:"WorkspacesQuery",rawQuery:t,subscription:(s.workspacesQueryWithSub[1]||"").trim()}:s.workspacesQuery&&r?{kind:"WorkspacesQuery",rawQuery:t,subscription:r}:{kind:"SubscriptionsQuery",rawQuery:t};return{refId:"A",queryType:d.GrafanaTemplateVariableFn,grafanaTemplateVariableFn:o(),subscription:r}},zr=async(t,e)=>{const s=e.azureMonitorDatasource.defaultSubscriptionId;let r="";if(t){const o=e.azureLogAnalyticsDatasource.getDeprecatedDefaultWorkSpace();o?Te(o)?r=await e.resourcePickerData.getResourceURIFromWorkspace(o):r=o:r=await e.azureLogAnalyticsDatasource.getFirstWorkspace()||""}return{refId:"A",queryType:d.LogAnalytics,azureLogAnalytics:{query:t,resources:r?[r]:[]},subscription:s}},Ar=t=>{const{queryType:e,grafanaTemplateVariableFn:s}=t;if(e!==d.GrafanaTemplateVariableFn||!s)return t;const r={...t};switch("subscription"in s&&(r.subscription=s.subscription),"resourceGroup"in s&&(r.resourceGroup=s.resourceGroup),"metricNamespace"in s&&(r.namespace=s.metricNamespace),"resourceName"in s&&(r.resource=s.resourceName),s.kind){case"SubscriptionsQuery":r.queryType=d.SubscriptionsQuery;break;case"ResourceGroupsQuery":r.queryType=d.ResourceGroupsQuery;break;case"ResourceNamesQuery":r.queryType=d.ResourceNamesQuery;break;case"MetricNamespaceQuery":r.queryType=d.NamespacesQuery;break;case"MetricDefinitionsQuery":r.queryType=d.NamespacesQuery;break;case"MetricNamesQuery":r.queryType=d.MetricNamesQuery;break;case"WorkspacesQuery":r.queryType=d.WorkspacesQuery;break}return r},ut=async(t,e)=>typeof t!="string"?t:Sr(t)?Er(t,e.datasource):zr(t,e.datasource),lt=async(t,e)=>{let s=await ut(t,e);return s.queryType===d.GrafanaTemplateVariableFn&&(s=Ar(s)),s},Nr=({query:t,updateQuery:e,datasource:s})=>{const[r,o]=(0,a.useState)("");(0,a.useEffect)(()=>{o(t.grafanaTemplateVariableFn?.rawQuery||"")},[t.grafanaTemplateVariableFn?.rawQuery]);const i=(0,a.useCallback)(c=>{ut(c,{datasource:s}).then(u=>{u.queryType===d.GrafanaTemplateVariableFn?e(u):e({...t,grafanaTemplateVariableFn:{kind:"UnknownQuery",rawQuery:c}})})},[s,t,e]),n=c=>{o(c.target.value)};return a.createElement(C._,{label:"Grafana template variable function"},a.createElement(U.I,{placeholder:"type a grafana template variable function, ex: Subscriptions()",value:r,onChange:n,onBlur:()=>i(r)}))},mt={label:"-",value:""},Mr=t=>{const{query:e,onChange:s,datasource:r}=t,o=[{label:"Subscriptions",value:d.SubscriptionsQuery},{label:"Resource Groups",value:d.ResourceGroupsQuery},{label:"Namespaces",value:d.NamespacesQuery},{label:"Regions",value:d.LocationsQuery},{label:"Resource Names",value:d.ResourceNamesQuery},{label:"Metric Names",value:d.MetricNamesQuery},{label:"Workspaces",value:d.WorkspacesQuery},{label:"Resource Graph",value:d.AzureResourceGraph},{label:"Logs",value:d.LogAnalytics}];typeof t.query=="object"&&t.query.queryType===d.GrafanaTemplateVariableFn&&o.push({label:"Grafana Query Function",value:d.GrafanaTemplateVariableFn});const[i,n]=(0,a.useState)({label:"Template Variables",options:[]}),[c,u]=(0,a.useState)(!1),[l,m]=(0,a.useState)(!1),[h,g]=(0,a.useState)(!1),[f,y]=(0,a.useState)(!1),[p,b]=(0,a.useState)(!1),[z,A]=(0,a.useState)(!1),[V,Se]=(0,a.useState)(!1),[Ee,ze]=(0,a.useState)([]),[oe,le]=(0,a.useState)([]),[me,Ae]=(0,a.useState)([]),[Pe,Qe]=(0,a.useState)([]),[k,D]=(0,a.useState)([]),[$,ae]=Xe(),q=typeof e=="string"?"":e.queryType;(0,a.useEffect)(()=>{lt(e,{datasource:r}).then(E=>{(0,w.isEqual)(e,E)||s(E)})},[e,r,s]),(0,a.useEffect)(()=>{switch(u(!1),m(!1),g(!1),b(!1),A(!1),Se(!1),q){case d.ResourceGroupsQuery:case d.WorkspacesQuery:u(!0);break;case d.NamespacesQuery:u(!0),m(!0);break;case d.ResourceNamesQuery:u(!0),m(!0),g(!0),y(!0);break;case d.MetricNamesQuery:u(!0),b(!0),A(!0),Se(!0);break;case d.LocationsQuery:u(!0);break}},[q]),(0,a.useEffect)(()=>{const E=[];r.getVariablesRaw().forEach(G=>{(0,w.get)(G,"query.queryType")!==q&&E.push({label:G.label||G.name,value:`$${G.name}`})}),n({label:"Template Variables",options:E})},[r,q]),(0,He.Z)(()=>{r.getSubscriptions().then(E=>{ze(E.map(G=>({label:G.text,value:G.value})))})});const Q=typeof e=="object"&&e.subscription;(0,a.useEffect)(()=>{Q&&r.getResourceGroups(Q).then(E=>{le(E.map(G=>({label:G.text,value:G.value})))})},[r,Q]);const pe=typeof e=="object"&&e.resourceGroup||"";(0,a.useEffect)(()=>{Q&&r.getMetricNamespaces(Q,pe).then(E=>{Ae(E.map(G=>({label:G.text,value:G.value})))})},[r,Q,pe]),(0,a.useEffect)(()=>{Q&&r.azureMonitorDatasource.getLocations([Q]).then(E=>{const G=[];E.forEach(ft=>G.push({label:ft.displayName,value:ft.name})),D(G)})},[r,Q,pe]);const pt=typeof e=="object"&&e.namespace||"";if((0,a.useEffect)(()=>{Q&&r.getResourceNames(Q,pe,pt).then(E=>{Qe(E.map(G=>({label:G.text,value:G.value})))})},[r,Q,pe,pt]),typeof e=="string")return null;const Ir=E=>{E.value&&s({...e,queryType:E.value,subscription:void 0,resourceGroup:void 0,namespace:void 0,resource:void 0})},Pr=E=>{E.value&&s({...e,subscription:E.value,resourceGroup:void 0,namespace:void 0,resource:void 0})},Qr=E=>{s({...e,resourceGroup:E.value,namespace:void 0,resource:void 0})},xr=E=>{s({...e,namespace:E.value,resource:void 0})},Vr=E=>{s({...e,region:E.value})},$r=E=>{s({...e,resource:E.value})},dt=E=>{s(E)};return a.createElement(a.Fragment,null,a.createElement(C._,{label:"Select query type",labelWidth:20,"data-testid":N.components.variableEditor.queryType.input},a.createElement(T.Ph,{"aria-label":"select query type",onChange:Ir,options:o,width:25,value:q})),e.queryType===d.LogAnalytics&&a.createElement(a.Fragment,null,a.createElement(tt,{subscriptionId:e.subscription,query:e,datasource:r,onChange:dt,variableOptionGroup:i,setError:ae,hideFormatAs:!0}),$&&a.createElement(a.Fragment,null,a.createElement(F,{v:2}),a.createElement(O.b,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor"},$))),e.queryType===d.GrafanaTemplateVariableFn&&a.createElement(Nr,{query:e,updateQuery:t.onChange,datasource:r}),c&&a.createElement(C._,{label:"Select subscription",labelWidth:20,"data-testid":N.components.variableEditor.subscription.input},a.createElement(T.Ph,{"aria-label":"select subscription",onChange:Pr,options:Ee.concat(i),width:25,value:e.subscription||null})),(p||l)&&a.createElement(C._,{label:"Select resource group",labelWidth:20,"data-testid":N.components.variableEditor.resourceGroup.input},a.createElement(T.Ph,{"aria-label":"select resource group",onChange:Qr,options:p?oe.concat(i):oe.concat(i,mt),width:25,value:e.resourceGroup||null,placeholder:p?void 0:"Optional"})),(z||h)&&a.createElement(C._,{label:"Select namespace",labelWidth:20,"data-testid":N.components.variableEditor.namespace.input},a.createElement(T.Ph,{"aria-label":"select namespace",onChange:xr,options:z?me.concat(i):me.concat(i,mt),width:25,value:e.namespace||null,placeholder:z?void 0:"Optional"})),f&&a.createElement(C._,{label:"Select region",labelWidth:20,"data-testid":N.components.variableEditor.region.input},a.createElement(T.Ph,{"aria-label":"select region",onChange:Vr,options:k.concat(i),width:25,value:e.region||null,placeholder:"Optional"})),V&&a.createElement(C._,{label:"Select resource",labelWidth:20,"data-testid":N.components.variableEditor.resource.input},a.createElement(T.Ph,{"aria-label":"select resource",onChange:$r,options:Pe.concat(i),width:25,value:e.resource||null})),e.queryType===d.AzureResourceGraph&&a.createElement(a.Fragment,null,a.createElement(Be,{subscriptionId:r.azureLogAnalyticsDatasource.defaultSubscriptionId,query:e,datasource:r,onChange:dt,variableOptionGroup:i,setError:ae}),$&&a.createElement(a.Fragment,null,a.createElement(F,{v:2}),a.createElement(O.b,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor"},$))))};class Rr extends kr.Mg{constructor(e){super(),this.datasource=e,this.templateSrv=(0,L.J)(),this.editor=Mr,this.datasource=e,this.query=this.query.bind(this),this.templateSrv=(0,L.J)()}hasValue(...e){return e.every(s=>!!this.templateSrv.replace(s))}query(e){const s=async()=>{const r=await lt(e.targets[0],{datasource:this.datasource});try{switch(r.queryType){case d.SubscriptionsQuery:const o=await this.datasource.getSubscriptions();return{data:o?.length?[(0,B.g0)(o)]:[]};case d.ResourceGroupsQuery:if(r.subscription&&this.hasValue(r.subscription)){const n=await this.datasource.getResourceGroups(r.subscription);return{data:n?.length?[(0,B.g0)(n)]:[]}}return{data:[]};case d.NamespacesQuery:if(r.subscription&&this.hasValue(r.subscription)){const n=await this.datasource.getMetricNamespaces(r.subscription,r.resourceGroup);return{data:n?.length?[(0,B.g0)(n)]:[]}}return{data:[]};case d.ResourceNamesQuery:if(r.subscription&&this.hasValue(r.subscription)){const n=await this.datasource.getResourceNames(r.subscription,r.resourceGroup,r.namespace,r.region);return{data:n?.length?[(0,B.g0)(n)]:[]}}return{data:[]};case d.MetricNamesQuery:if(r.subscription&&r.resourceGroup&&r.namespace&&r.resource&&this.hasValue(r.subscription,r.resourceGroup,r.namespace,r.resource)){const n=await this.datasource.getMetricNames(r.subscription,r.resourceGroup,r.namespace,r.resource);return{data:n?.length?[(0,B.g0)(n)]:[]}}return{data:[]};case d.WorkspacesQuery:if(r.subscription&&this.hasValue(r.subscription)){const n=await this.datasource.getAzureLogAnalyticsWorkspaces(r.subscription);return{data:n?.length?[(0,B.g0)(n)]:[]}}return{data:[]};case d.GrafanaTemplateVariableFn:if(r.grafanaTemplateVariableFn){const n=await this.callGrafanaTemplateVariableFn(r.grafanaTemplateVariableFn);return{data:n?.length?[(0,B.g0)(n)]:[]}}return{data:[]};case d.LocationsQuery:if(r.subscription&&this.hasValue(r.subscription)){const n=await this.datasource.azureMonitorDatasource.getLocations([r.subscription]),c=[];return n.forEach(u=>{c.push({text:u.displayName,value:u.name})}),{data:c?.length?[(0,B.g0)(c)]:[]}}default:e.targets[0]=r;const i=await(0,yr.n)(this.datasource.query(e));return{data:i.data,error:i.error?new Error(ee(i.error)):void 0}}}catch(o){return{data:[],error:new Error(ee(o))}}};return(0,wr.D)(s())}callGrafanaTemplateVariableFn(e){return e.kind==="SubscriptionsQuery"?this.datasource.getSubscriptions():e.kind==="ResourceGroupsQuery"?this.datasource.getResourceGroups(this.replaceVariable(e.subscription)):e.kind==="ResourceNamesQuery"?this.datasource.getResourceNames(this.replaceVariable(e.subscription),this.replaceVariable(e.resourceGroup),this.replaceVariable(e.metricNamespace)):e.kind==="MetricNamespaceQuery"?this.datasource.azureMonitorDatasource.getMetricNamespaces(e,!0):e.kind==="MetricNamesQuery"?this.datasource.azureMonitorDatasource.getMetricNames(e):e.kind==="WorkspacesQuery"?this.datasource.azureLogAnalyticsDatasource.getWorkspaces(this.replaceVariable(e.subscription)):null}replaceVariable(e){return(0,L.J)().replace((e||"").trim())}}class Cr extends ue.CK{constructor(e,s=(0,ar.J)()){super(e),this.templateSrv=s,this.annotations={prepareAnnotation:vr},this.pseudoDatasource={},this.azureMonitorDatasource=new dr(e),this.azureLogAnalyticsDatasource=new lr(e),this.azureResourceGraphDatasource=new fr(e),this.resourcePickerData=new br(e,this.azureMonitorDatasource),this.pseudoDatasource={[d.AzureMonitor]:this.azureMonitorDatasource,[d.LogAnalytics]:this.azureLogAnalyticsDatasource,[d.AzureResourceGraph]:this.azureResourceGraphDatasource},this.variables=new Rr(this)}filterQuery(e){return e.queryType?this.pseudoDatasource[e.queryType]?.filterQuery?.(e)??!0:!1}query(e){const s=new Map;for(const o of e.targets){const i=Ie(o);if(!i.queryType||i.hide||!Tr(i))continue;if(!s.has(i.queryType)){const c=(0,w.cloneDeep)(e);c.requestId=`${c.requestId}-${i.refId}`,c.targets=[],s.set(i.queryType,c)}s.get(i.queryType)?.targets.push(i)}const r=Array.from(s.entries()).map(([o,i])=>{const n=this.pseudoDatasource[o];if(!n)throw new Error("Data source not created for query type "+o);return n.query(i)});return r.length===1?r[0]:r.length>1?(0,sr.D)(r).pipe((0,or.U)(o=>{const i=[];for(const n of o)for(const c of n.data)i.push(c);return{state:nt.Gu.Done,data:i}})):(0,rr.of)({state:nt.Gu.Done,data:[]})}targetContainsTemplate(e){if(e.subscription&&this.templateSrv.containsTemplate(e.subscription))return!0;let s;return e.queryType===d.AzureMonitor?s=JSON.stringify(e.azureMonitor):e.queryType===d.LogAnalytics?s=JSON.stringify(e.azureLogAnalytics):e.queryType===d.AzureResourceGraph&&(s=JSON.stringify([e.azureResourceGraph,e.subscriptions])),!!s&&this.templateSrv.containsTemplate(s)}async annotationQuery(e){return this.azureLogAnalyticsDatasource.annotationQuery(e)}getResourceGroups(e){return this.azureMonitorDatasource.getResourceGroups(this.templateSrv.replace(e))}getMetricNamespaces(e,s){let r=`/subscriptions/${e}`;return s&&(r+=`/resourceGroups/${s};`),this.azureMonitorDatasource.getMetricNamespaces({resourceUri:r},!0)}getResourceNames(e,s,r,o){return this.azureMonitorDatasource.getResourceNames({subscriptionId:e,resourceGroup:s,metricNamespace:r,region:o})}getMetricNames(e,s,r,o){return this.azureMonitorDatasource.getMetricNames({subscription:e,resourceGroup:s,metricNamespace:r,resourceName:o})}getAzureLogAnalyticsWorkspaces(e){return this.azureLogAnalyticsDatasource.getWorkspaces(e)}getSubscriptions(){return this.azureMonitorDatasource.getSubscriptions()}interpolateVariablesInQueries(e,s){return e.map(o=>{if(!o.queryType)return o;const i=this.pseudoDatasource[o.queryType];return{datasource:i?.getRef(),...i?.applyTemplateVariables(o,s)??o}})}getVariables(){return this.templateSrv.getVariables().map(e=>`$${e.name}`)}getVariablesRaw(){return this.templateSrv.getVariables()}}function Tr(t){switch(t.queryType){case d.AzureMonitor:return!!t.azureMonitor;case d.LogAnalytics:return!!t.azureLogAnalytics;case d.AzureResourceGraph:return!!t.azureResourceGraph;case d.GrafanaTemplateVariableFn:return!!t.grafanaTemplateVariableFn;default:return!1}}var Gr=v(40507),Dr=v(41818);const Fr=t=>{(0,Dr.ff)("grafana_ds_azuremonitor_dashboard_loaded",t)},Lr=new gt.hf(Cr).setConfigEditor(Lt).setQueryEditor(tr);(0,bt.N$)().subscribe(ht.Pl,({payload:{dashboardId:t,orgId:e,userId:s,grafanaVersion:r,queries:o}})=>{const i=o[Gr.id];let n={[d.AzureMonitor]:{hidden:0,visible:0},[d.LogAnalytics]:{hidden:0,visible:0},[d.AzureResourceGraph]:{hidden:0,visible:0}};i.forEach(c=>{(c.queryType===d.AzureMonitor||c.queryType===d.LogAnalytics||c.queryType===d.AzureResourceGraph)&&n[c.queryType][c.hide?"hidden":"visible"]++}),i&&i.length>0&&Fr({grafana_version:r,dashboard_id:t,org_id:e,azure_monitor_queries:n[d.AzureMonitor].visible,azure_log_analytics_queries:n[d.LogAnalytics].visible,azure_resource_graph_queries:n[d.AzureResourceGraph].visible,azure_monitor_queries_hidden:n[d.AzureMonitor].hidden,azure_log_analytics_queries_hidden:n[d.LogAnalytics].hidden,azure_resource_graph_queries_hidden:n[d.AzureResourceGraph].hidden})})},89829:()=>{}}]);

//# sourceMappingURL=9469.11d2c66c7202aad45b8d.js.map