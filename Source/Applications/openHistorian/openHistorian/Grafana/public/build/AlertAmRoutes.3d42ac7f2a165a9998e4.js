"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6719],{40715:(ce,w,n)=>{n.d(w,{o:()=>S});var e=n(96540),u=n(31678),i=n(97007);function S(j){const E=(0,u.useDispatch)(),M=(0,e.useRef)(j);M.current=j,(0,e.useEffect)(()=>()=>{E((0,i.N)({cleanupAction:M.current}))},[E])}},69510:(ce,w,n)=>{n.r(w),n.d(w,{default:()=>ss,findRoutesMatchingFilters:()=>Yt});var e=n(74848),u=n(32196),i=n(96540),S=n(41053),j=n(40845),E=n(63021),M=n(40675),$=n(40980),G=n(39558),B=n(42418),h=n(67061),f=n(66602),x=n(83277),P=n(37198),O=n(31678),K=n(40715),N=n(82843),ne=n(55740),z=n(49962),se=n(75505),ge=n(17172),ye=n(57220);const Ie=t=>{const s=t.match(/^(\w+)(\[\d+\])?$/);return s?{type:s[1],index:s[2]}:{type:t,index:void 0}},Ae=t=>{const s={receivers:{},errorCount:0};t.forEach(a=>{s.receivers[a.name]={active:a.active,notifiers:{},errorCount:0};const r=s.receivers[a.name];a.integrations.forEach(m=>{!!m?.lastNotifyAttemptError&&(r.errorCount+=1);const l=Te(m.name);l&&(r.notifiers[l]||(r.notifiers[l]=[]),r.notifiers[l].push(m))})});const o=Object.values(s.receivers).reduce((a,r)=>a+r.errorCount,0);return{...s,errorCount:o}},Te=t=>Ie(t)?.type;async function be(t){try{const s=await(0,se.s)((0,ge.AI)().fetch({url:`/api/alertmanager/${(0,ye.w5)(t)}/config/api/v1/receivers`,showErrorAlert:!1,showSuccessAlert:!1}));return Ae(s.data)}catch{return Ae([])}}const Se=z.H.injectEndpoints({endpoints:t=>({contactPointsState:t.query({queryFn:async({amSourceName:s})=>{try{return{data:await be(s)}}catch(o){return{error:o}}}})})}),Ce=t=>{const s={receivers:{},errorCount:0},{currentData:o}=Se.useContactPointsStateQuery({amSourceName:t??""},{skip:!t,pollingInterval:ne.cB});return o??s};var Me=n(37959),je=n(57895),R=n(55852),c=n(8484),b=n(39938),J=n(96374),oe=n(42941),V=n(79938),I=n(16293),pe=n(76648),Tt=n(84029);const Zt=({exportFormat:t,onClose:s})=>{const{currentData:o="",isFetching:a}=V.hK.useExportMuteTimingsQuery({format:t}),r=`mute-timings-${new Date().getTime()}`;return a?(0,e.jsx)(G._,{text:"Loading...."}):(0,e.jsx)(I.J,{format:t,textDefinition:o,downloadFileName:r,onClose:s})},Xt=({exportFormat:t,onClose:s,muteTimingName:o})=>{const{currentData:a="",isFetching:r}=V.hK.useExportMuteTimingQuery({format:t,muteTiming:o}),m=`mute-timing-${o}-${new Date().getTime()}`;return r?(0,e.jsx)(G._,{text:"Loading...."}):(0,e.jsx)(I.J,{format:t,textDefinition:a,downloadFileName:m,onClose:s})},bt=({onClose:t,muteTimingName:s})=>{const[o,a]=(0,i.useState)("yaml");return(0,e.jsx)(pe.m,{activeTab:o,onTabChange:a,onClose:t,formatProviders:Object.values(Tt.sl),children:s?(0,e.jsx)(Xt,{exportFormat:o,onClose:t,muteTimingName:s}):(0,e.jsx)(Zt,{exportFormat:o,onClose:t})})},St=Symbol("all mute timings"),Ot=()=>{const[t,s]=(0,i.useState)(null),[o,a]=(0,oe.A)(!1),r=(0,i.useCallback)(()=>{s(null),a(!1)},[a]),m=l=>{s(l),a(!0)};return[(0,i.useMemo)(()=>!t||!o?null:t===St?(0,e.jsx)(bt,{onClose:r}):(0,e.jsx)(bt,{muteTimingName:t,onClose:r}),[o,r,t]),m]};var $e=n(64853),H=n(19073),tt=n(6833),Ee=n(78742),kt=n(54486);const qt=({muteTiming:t,alertManagerSourceName:s})=>{const[o,a]=(0,P.gB)({alertmanager:s}),[r,m]=(0,i.useState)(!1),[d,l]=Ot(),[g,v]=(0,H.L7)(H.QI.ExportMuteTimings),C=()=>m(!1),A=s===ye.hY,D=(0,Ee.nL)("/alerting/routes/mute-timing/edit",s,{muteName:t.id}),p=(0,e.jsx)(R.z9,{href:D,variant:"secondary",size:"sm",icon:t.provisioned?"eye":"pen",disabled:(0,tt.VP)(a),children:t.provisioned?(0,e.jsx)(c.x6,{i18nKey:"alerting.common.view",children:"View"}):(0,e.jsx)(c.x6,{i18nKey:"alerting.common.edit",children:"Edit"})});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(h.B,{direction:"row",alignItems:"center",justifyContent:"flex-end",wrap:"wrap",children:[!A&&(0,kt.d6)(t)&&(0,e.jsx)(b.E,{text:"Disabled",color:"orange"}),(0,e.jsx)($e._,{actions:[H.QI.UpdateMuteTiming],children:p}),g&&(0,e.jsx)(R.z9,{icon:"download-alt",variant:"secondary",size:"sm","data-testid":"export",disabled:!v||(0,tt.VP)(a),onClick:()=>l(t.name),children:(0,e.jsx)(c.x6,{i18nKey:"alerting.common.export",children:"Export"})}),!t.provisioned&&(0,e.jsx)($e._,{actions:[H.QI.DeleteMuteTiming],children:(0,e.jsx)(R.z9,{icon:"trash-alt",variant:"secondary",size:"sm",onClick:()=>m(!0),disabled:(0,tt.VP)(a),children:(0,e.jsx)(c.x6,{i18nKey:"alerting.common.delete",children:"Delete"})})})]}),(0,e.jsx)(J.u,{isOpen:r,title:"Delete mute timing",body:`Are you sure you would like to delete "${t.name}"?`,confirmText:(0,c.t)("alerting.common.delete","Delete"),onConfirm:async()=>{await o.execute({name:t?.metadata?.name??t.name}),C()},onDismiss:C}),d]})};var _t=n(2859),en=n(75591),tn=n(23088);const Rt=({buttonIcon:t,buttonLabel:s,buttonSize:o="lg",buttonVariant:a="primary",onButtonClick:r,text:m,href:d,showButton:l=!0})=>{const g=(0,j.of)(nn),v={className:g.button,icon:t,size:o,variant:a};return(0,e.jsx)(tn.Z,{children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{className:g.text,children:m}),l&&(d?(0,e.jsx)(R.z9,{href:d,type:"button",...v,children:s}):(0,e.jsx)(R.$n,{onClick:r,type:"button",...v,children:s}))]})})},nn=t=>({container:(0,u.css)({backgroundColor:t.colors.background.secondary,color:t.colors.text.secondary,padding:t.spacing(4),textAlign:"center"}),text:(0,u.css)({marginBottom:t.spacing(2)}),button:(0,u.css)({margin:t.spacing(2,0,1)})});var Bt=n(48205),Wt=n(26058),sn=n(4724);const on=({alertManagerSourceName:t,hideActions:s})=>{const o=(0,j.of)(rn),[a,r]=Ot(),{data:m,isLoading:d,error:l}=(0,P.Ad)({alertmanager:t}),g=(0,i.useMemo)(()=>(m||[]).map(T=>({id:T.id,data:T})),[m]),[v,C]=(0,H.L7)(H.QI.CreateMuteTiming),[A,D]=(0,H.L7)(H.QI.ExportMuteTimings),p=an(t,s);return d?(0,e.jsx)(G._,{text:"Loading mute timings..."}):l?(0,e.jsx)(B.F,{severity:"error",title:(0,c.t)("alerting.mute_timings.error-loading.title","Error loading mute timings"),children:(0,e.jsx)(c.x6,{i18nKey:"alerting.mute_timings.error-loading.description",children:"Could not load mute timings. Please try again later."})}):(0,e.jsxs)("div",{className:o.container,children:[(0,e.jsxs)(h.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)("span",{children:"Enter specific time intervals when not to send notifications or freeze notifications for recurring periods of time."}),(0,e.jsx)(Wt.h,{}),!s&&g.length>0&&(0,e.jsx)($e._,{actions:[H.QI.CreateMuteTiming],children:(0,e.jsx)(R.z9,{className:o.muteTimingsButtons,icon:"plus",variant:"primary",href:(0,Ee.nL)("alerting/routes/mute-timing/new",t),children:"Add mute timing"})}),A&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(R.$n,{icon:"download-alt",className:o.muteTimingsButtons,variant:"secondary",disabled:!D,onClick:()=>r(St),children:(0,e.jsx)(c.x6,{i18nKey:"alerting.common.export-all",children:"Export all"})}),a]})]}),g.length>0?(0,e.jsx)(en.E,{items:g,cols:p,pagination:{itemsPerPage:25}}):s?(0,e.jsx)(Rt,{text:"No mute timings configured",buttonLabel:"",showButton:!1}):(0,e.jsx)(Rt,{text:"You haven't created any mute timings yet",buttonLabel:"Add mute timing",buttonIcon:"plus",buttonSize:"lg",href:(0,Ee.nL)("alerting/routes/mute-timing/new",t),showButton:C})]})};function an(t,s=!1){const[[o,a],[r,m]]=(0,H.Hl)([H.QI.UpdateMuteTiming,H.QI.DeleteMuteTiming]),d=!s&&(a||m);return(0,i.useMemo)(()=>{const l=[{id:"name",label:"Name",renderCell:function({data:v}){return(0,e.jsxs)("div",{children:[v.name," ",v.provisioned&&(0,e.jsx)(Bt.rS,{tooltip:!0,provenance:v.metadata?.annotations?.[_t.a3]})]})},size:1},{id:"timeRange",label:"Time range",renderCell:({data:g})=>(0,sn.av)(g),size:5}];return d&&l.push({id:"actions",label:"Actions",alignColumn:"end",renderCell:({data:g})=>(0,e.jsx)(qt,{muteTiming:g,alertManagerSourceName:t}),size:2}),l},[d,t])}const rn=t=>({container:(0,u.css)({display:"flex",flexFlow:"column nowrap"}),muteTimingsButtons:(0,u.css)({marginBottom:t.spacing(2)})});var te=n(2543),Q=n(88575),ln=n(60029),Pe=n(56034),Oe=n(14578),nt=n(10354),he=n(94753),st=n(39184),cn=n(39964),ze=n(98164),Ve=n(32642);const dn=({onChangeReceiver:t,onChangeMatchers:s,matchingCount:o})=>{const[a,r]=(0,cn.l)(),m=(0,i.useRef)(null),{queryString:d,contactPoint:l}=mn(a),g=(0,j.of)(gn),v=(0,i.useCallback)(()=>(0,te.debounce)(s,500),[s]);(0,i.useEffect)(()=>{t(l)},[l,t]),(0,i.useEffect)(()=>{const p=(0,Ve.Zc)(d??"").map(ze.NL);v()(p)},[v,d]);const C=(0,i.useCallback)(()=>{m.current&&(m.current.value=""),r({contactPoint:"",queryString:void 0})},[r]),A=d||l;let D=!!(d&&d.length>3);try{d?(0,Ve.S6)(d):D=!0}catch{D=!1}return(0,e.jsxs)(h.B,{direction:"row",alignItems:"flex-end",gap:1,children:[(0,e.jsx)(Q.D,{className:g.noBottom,label:(0,e.jsx)(ln.J,{children:(0,e.jsxs)(h.B,{gap:.5,children:[(0,e.jsx)("span",{children:"Search by matchers"}),(0,e.jsx)(Pe.m,{content:(0,e.jsxs)("div",{children:["Filter notification policies by using a comma separated list of matchers, e.g.:",(0,e.jsx)("pre",{children:"severity=critical, region=EMEA"})]}),children:(0,e.jsx)(Oe.I,{name:"info-circle",size:"sm"})})]})}),invalid:!D,error:D?null:"Query must use valid matcher syntax",children:(0,e.jsx)(nt.p,{ref:m,"data-testid":"search-query-input",placeholder:"Search",width:46,prefix:(0,e.jsx)(Oe.I,{name:"search"}),onChange:p=>{r({queryString:p.currentTarget.value})},defaultValue:d})}),(0,e.jsx)(Q.D,{label:"Search by contact point",style:{marginBottom:0},children:(0,e.jsx)(st.u,{selectProps:{id:"receiver","aria-label":"Search by contact point",onChange:p=>{r({contactPoint:p?.value?.name})},width:28,isClearable:!0},selectedContactPointName:a.get("contactPoint")??void 0})}),A&&(0,e.jsxs)(h.B,{alignItems:"center",children:[(0,e.jsx)(R.$n,{variant:"secondary",icon:"times",onClick:C,children:"Clear filters"}),(0,e.jsxs)(he.E,{variant:"bodySmall",color:"secondary",children:[o===0&&"No policies matching filters.",o===1&&`${o} policy matches the filters.`,o>1&&`${o} policies match the filters.`]})]})]})};function Lt(t,s){const o=new Map;function a(r,m){const d=[...m,r];if(s(r)){const l=o.get(r)??[];o.set(r,[...l,...d])}r.routes?.forEach(l=>a(l,d))}return a(t,[]),o}function un(t,s){const o=(0,Ve.J$)(t);return s.every(a=>o.some(r=>(0,te.isEqual)(a,r)))}const mn=t=>({queryString:t.get("queryString")??void 0,contactPoint:t.get("contactPoint")??void 0}),gn=()=>({noBottom:(0,u.css)({marginBottom:0})});var de=n(37390),pn=n(62930),Re=n(60021),hn=n(35016),fn=n(55127),ot=n.n(fn);const xn=({active:t=0,suppressed:s=0,unprocessed:o=0})=>{const a=[],r=t+s+o;return t&&a.push((0,e.jsx)(b.E,{color:"red",text:`${t} firing`},"firing")),s&&a.push((0,e.jsx)(b.E,{color:"blue",text:`${s} suppressed`},"suppressed")),o&&a.push((0,e.jsx)(b.E,{color:"orange",text:`${o} unprocessed`},"unprocessed")),a.length>1&&a.unshift((0,e.jsxs)(i.Fragment,{children:[r," ",ot()("instance",r)]},"total")),!!a.length?(0,e.jsx)(h.B,{gap:.5,children:a}):null};var fe=n(49785),vn=n(50720),at=n(90182),yn=n(82762);const wt=(t,s)=>s(t===null?null:t?t.value?.name:"");var Y=n(79657),De=n(33915),Nt=n(99903),He=n(27835);const jn=({actionButtons:t,alertManagerSourceName:s,onSubmit:o,route:a})=>{const r=(0,j.of)(Nt.t),[m,d]=(0,i.useState)(!1),[l,g]=(0,i.useState)((0,Y.gY)(a.group_by)),v=(0,Y.YE)(a),{handleSubmit:C,register:A,control:D,formState:{errors:p},setValue:y,getValues:T}=(0,fe.mN)({defaultValues:{...v,overrideTimings:!0,overrideGrouping:!0}});return(0,e.jsxs)("form",{onSubmit:C(o),children:[(0,e.jsx)(Q.D,{label:"Default contact point",invalid:!!p.receiver,error:p.receiver?.message,children:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:r.container,"data-testid":"am-receiver-select",children:[(0,e.jsx)(fe.xI,{render:({field:{onChange:U,ref:Z,value:k,...q}})=>(0,e.jsx)(st.u,{selectProps:{...q,onChange:X=>wt(X,U)},selectedContactPointName:k}),control:D,name:"receiver",rules:{required:{value:!0,message:"Required."}}}),(0,e.jsx)("span",{children:"or"}),(0,e.jsx)(vn.N,{className:r.linkText,href:(0,Ee.nL)("/alerting/notifications/receivers/new",s),children:"Create a contact point"})]})})}),(0,e.jsx)(Q.D,{label:"Group by",description:"Combine multiple alerts into a single notification by grouping them by the same label values.","data-testid":"am-group-select",children:(0,e.jsx)(fe.xI,{render:({field:{onChange:U,ref:Z,...k}})=>(0,e.jsx)(at.KF,{"aria-label":"Group by",...k,allowCustomValue:!0,className:r.input,onCreateOption:q=>{g(X=>[...X,(0,Y.Mk)(q)]),y("groupBy",[...k.value||[],q])},onChange:q=>U((0,Y.ie)(q)),options:[...Y.Yl,...l]}),control:D,name:"groupBy"})}),(0,e.jsx)(yn.S,{collapsible:!0,className:r.collapse,isOpen:m,label:"Timing options",onToggle:d,children:(0,e.jsxs)("div",{className:r.timingFormContainer,children:[(0,e.jsx)(Q.D,{label:"Group wait",description:"The waiting time before sending the first notification for a new group of alerts. Default 30 seconds.",invalid:!!p.groupWaitValue,error:p.groupWaitValue?.message,"data-testid":"am-group-wait",children:(0,e.jsx)(De.V,{...A("groupWaitValue",{validate:Y.hH}),placeholder:He.H.group_wait,className:r.promDurationInput,"aria-label":"Group wait"})}),(0,e.jsx)(Q.D,{label:"Group interval",description:"The wait time before sending a notification about changes in the alert group after the first notification has been sent. Default is 5 minutes.",invalid:!!p.groupIntervalValue,error:p.groupIntervalValue?.message,"data-testid":"am-group-interval",children:(0,e.jsx)(De.V,{...A("groupIntervalValue",{validate:Y.hH}),placeholder:He.H.group_interval,className:r.promDurationInput,"aria-label":"Group interval"})}),(0,e.jsx)(Q.D,{label:"Repeat interval",description:"The wait time before resending a notification that has already been sent successfully. Default is 4 hours. Should be a multiple of Group interval.",invalid:!!p.repeatIntervalValue,error:p.repeatIntervalValue?.message,"data-testid":"am-repeat-interval",children:(0,e.jsx)(De.V,{...A("repeatIntervalValue",{validate:U=>{const Z=T("groupIntervalValue");return(0,Y.DY)(U,Z)}}),placeholder:He.H.repeat_interval,className:r.promDurationInput,"aria-label":"Repeat interval"})})]})}),(0,e.jsx)("div",{className:r.container,children:t})]})};var Ft=n(29158),rt=n(15292),En=n(72093),An=n(39127),Gt=n(70383),xe=n(97174);const Kt=({actionButtons:t,route:s,onSubmit:o,defaults:a})=>{const r=(0,j.of)(Pn),m=(0,j.of)(Nt.t),{selectedAlertmanager:d}=(0,Gt.VI)(),[l,g]=(0,i.useState)((0,Y.gY)(s?.group_by)),v=[{name:"",operator:Re.ho.equal,value:""}],C={...(0,Y.YE)(s),...a},A={...C,object_matchers:s?C.object_matchers:v},{handleSubmit:D,control:p,register:y,formState:{errors:T},setValue:U,watch:Z,getValues:k}=(0,fe.mN)({defaultValues:A}),{fields:q,append:X,remove:ae}=(0,fe.jz)({control:p,name:"object_matchers"});return(0,e.jsxs)("form",{onSubmit:D(o),children:[(0,e.jsx)("input",{type:"hidden",...y("id")}),(0,e.jsxs)(h.B,{direction:"column",alignItems:"flex-start",children:[(0,e.jsx)("div",{children:"Matching labels"}),q.length===0&&(0,e.jsx)(b.E,{color:"orange",className:r.noMatchersWarning,icon:"exclamation-triangle",text:"If no matchers are specified, this notification policy will handle all alert instances."}),q.length>0&&(0,e.jsx)("div",{className:r.matchersContainer,children:q.map((F,W)=>(0,e.jsxs)(h.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)(Q.D,{label:"Label",invalid:!!T.object_matchers?.[W]?.name,error:T.object_matchers?.[W]?.name?.message,children:(0,e.jsx)(nt.p,{...y(`object_matchers.${W}.name`,{required:"Field is required"}),defaultValue:F.name,placeholder:"label",autoFocus:!0})}),(0,e.jsx)(Q.D,{label:"Operator",children:(0,e.jsx)(fe.xI,{render:({field:{onChange:_,ref:re,...ie}})=>(0,e.jsx)(at.l6,{...ie,className:r.matchersOperator,onChange:L=>_(L?.value),options:ze.xH,"aria-label":"Operator"}),defaultValue:F.operator,control:p,name:`object_matchers.${W}.operator`,rules:{required:{value:!0,message:"Required."}}})}),(0,e.jsx)(Q.D,{label:"Value",invalid:!!T.object_matchers?.[W]?.value,error:T.object_matchers?.[W]?.value?.message,children:(0,e.jsx)(nt.p,{...y(`object_matchers.${W}.value`),defaultValue:F.value,placeholder:"value"})}),(0,e.jsx)(Ft.K,{tooltip:"Remove matcher",name:"trash-alt",onClick:()=>ae(W),children:"Remove"})]},F.id))}),(0,e.jsx)(R.$n,{className:r.addMatcherBtn,icon:"plus",onClick:()=>X(Y.Rg),variant:"secondary",type:"button",children:"Add matcher"})]}),(0,e.jsx)(Q.D,{label:"Contact point",children:(0,e.jsx)(fe.xI,{render:({field:{onChange:F,ref:W,value:_,...re}})=>(0,e.jsx)(st.u,{selectProps:{...re,className:m.input,onChange:ie=>wt(ie,F),isClearable:!0},selectedContactPointName:_}),control:p,name:"receiver"})}),(0,e.jsx)(Q.D,{label:"Continue matching subsequent sibling nodes",children:(0,e.jsx)(rt.d,{id:"continue-toggle",...y("continue")})}),(0,e.jsx)(Q.D,{label:"Override grouping",children:(0,e.jsx)(rt.d,{id:"override-grouping-toggle",...y("overrideGrouping")})}),Z().overrideGrouping&&(0,e.jsx)(Q.D,{label:"Group by",description:"Combine multiple alerts into a single notification by grouping them by the same label values. If empty, it is inherited from the parent policy.",children:(0,e.jsx)(fe.xI,{rules:{validate:F=>!F||F.length===0?"At least one group by option is required.":!0},render:({field:{onChange:F,ref:W,..._},fieldState:{error:re}})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(at.KF,{"aria-label":"Group by",..._,invalid:!!re,allowCustomValue:!0,className:m.input,onCreateOption:ie=>{g(L=>[...L,(0,Y.Mk)(ie)]),U("groupBy",[..._.value||[],ie])},onChange:ie=>F((0,Y.ie)(ie)),options:[...Y.Yl,...l]}),re&&(0,e.jsx)(En.P,{children:re.message})]}),control:p,name:"groupBy"})}),(0,e.jsx)(Q.D,{label:"Override general timings",children:(0,e.jsx)(rt.d,{id:"override-timings-toggle",...y("overrideTimings")})}),Z().overrideTimings&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Q.D,{label:xe.G.groupWait.label,description:xe.G.groupWait.description,invalid:!!T.groupWaitValue,error:T.groupWaitValue?.message,children:(0,e.jsx)(De.V,{...y("groupWaitValue",{validate:Y.hH}),"aria-label":xe.G.groupWait.ariaLabel,className:m.promDurationInput})}),(0,e.jsx)(Q.D,{label:xe.G.groupInterval.label,description:xe.G.groupInterval.description,invalid:!!T.groupIntervalValue,error:T.groupIntervalValue?.message,children:(0,e.jsx)(De.V,{...y("groupIntervalValue",{validate:Y.hH}),"aria-label":xe.G.groupInterval.ariaLabel,className:m.promDurationInput})}),(0,e.jsx)(Q.D,{label:xe.G.repeatInterval.label,description:xe.G.repeatInterval.description,invalid:!!T.repeatIntervalValue,error:T.repeatIntervalValue?.message,children:(0,e.jsx)(De.V,{...y("repeatIntervalValue",{validate:(F="")=>{const W=k("groupIntervalValue");return(0,Y.DY)(F,W)}}),"aria-label":xe.G.repeatInterval.ariaLabel,className:m.promDurationInput})})]}),(0,e.jsx)(Q.D,{label:"Mute timings","data-testid":"am-mute-timing-select",description:"Add mute timing to policy",invalid:!!T.muteTimeIntervals,children:(0,e.jsx)(fe.xI,{render:({field:{onChange:F,ref:W,..._}})=>(0,e.jsx)(An.A,{alertmanager:d,selectProps:{..._,onChange:re=>F((0,Y.ie)(re))}}),control:p,name:"muteTimeIntervals"})}),t]})},Pn=t=>{const s=t.spacing(3.5);return{addMatcherBtn:(0,u.css)({marginBottom:s}),matchersContainer:(0,u.css)({backgroundColor:t.colors.background.secondary,padding:`${t.spacing(1.5)} ${t.spacing(2)}`,paddingBottom:0,width:"fit-content"}),matchersOperator:(0,u.css)({minWidth:"120px"}),noMatchersWarning:(0,u.css)({padding:`${t.spacing(1)} ${t.spacing(2)}`,marginBottom:t.spacing(1)})}};var Ut=n(26928);const Cn=(t,s)=>{const[o,a]=(0,i.useState)(!1),[r,m]=(0,i.useState)(void 0),[d,l]=(0,i.useState)(),g=(0,i.useCallback)(()=>{l(void 0),m(void 0),a(!1)},[]),v=(0,i.useCallback)((A,D)=>{l(A),m(D),a(!0)},[]);return[(0,i.useMemo)(()=>s?(0,e.jsx)(it,{isOpen:o}):(0,e.jsx)(de.a,{isOpen:o,onDismiss:g,closeOnBackdropClick:!0,closeOnEscape:!0,title:"Add notification policy",children:(0,e.jsx)(Kt,{defaults:{groupBy:d?.group_by},onSubmit:A=>{d&&r&&t(A,d,r)},actionButtons:(0,e.jsxs)(de.a.ButtonRow,{children:[(0,e.jsx)(R.$n,{type:"button",variant:"secondary",onClick:g,fill:"outline",children:"Cancel"}),(0,e.jsx)(R.$n,{type:"submit",children:"Save policy"})]})})}),[t,g,r,s,d,o]),v,g]},Mn=(t,s,o)=>{const[a,r]=(0,i.useState)(!1),[m,d]=(0,i.useState)(!1),[l,g]=(0,i.useState)(),v=(0,i.useCallback)(()=>{g(void 0),r(!1)},[]),C=(0,i.useCallback)((D,p)=>{d(p??!1),g(D),r(!0)},[]);return[(0,i.useMemo)(()=>o?(0,e.jsx)(it,{isOpen:a}):(0,e.jsxs)(de.a,{isOpen:a,onDismiss:v,closeOnBackdropClick:!0,closeOnEscape:!0,title:"Edit notification policy",children:[m&&l&&(0,e.jsx)(jn,{alertManagerSourceName:t,onSubmit:s,route:l,actionButtons:(0,e.jsxs)(de.a.ButtonRow,{children:[(0,e.jsx)(R.$n,{type:"button",variant:"secondary",onClick:v,fill:"outline",children:"Cancel"}),(0,e.jsx)(R.$n,{type:"submit",children:"Update default policy"})]})}),!m&&(0,e.jsx)(Kt,{route:l,onSubmit:s,actionButtons:(0,e.jsxs)(de.a.ButtonRow,{children:[(0,e.jsx)(R.$n,{type:"button",variant:"secondary",onClick:v,fill:"outline",children:"Cancel"}),(0,e.jsx)(R.$n,{type:"submit",children:"Update policy"})]})})]}),[t,v,s,m,o,l,a]),C,v]},Dn=(t,s)=>{const[o,a]=(0,i.useState)(!1),[r,m]=(0,i.useState)(),d=(0,i.useCallback)(()=>{m(void 0),a(!1)},[m]),l=(0,i.useCallback)(C=>{m(C),a(!0)},[]),g=(0,i.useCallback)(()=>{r&&t(r)},[t,r]);return[(0,i.useMemo)(()=>s?(0,e.jsx)(it,{isOpen:o}):(0,e.jsxs)(de.a,{isOpen:o,onDismiss:d,closeOnBackdropClick:!0,closeOnEscape:!0,title:"Delete notification policy",children:[(0,e.jsx)("p",{children:"Deleting this notification policy will permanently remove it."}),(0,e.jsx)("p",{children:"Are you sure you want to delete this policy?"}),(0,e.jsxs)(de.a.ButtonRow,{children:[(0,e.jsx)(R.$n,{type:"button",variant:"destructive",onClick:g,children:"Yes, delete policy"}),(0,e.jsx)(R.$n,{type:"button",variant:"secondary",onClick:d,children:"Cancel"})]})]}),[d,g,s,o]),l,d]},In=t=>{const[s,o]=(0,i.useState)(!1),[a,r]=(0,i.useState)([]),[m,d]=(0,i.useState)([]),[l,g]=(0,i.useState)("default"),v=(0,i.useCallback)(()=>{o(!1),r([]),d([])},[]),C=(0,i.useCallback)((p,y,T)=>{r(p),y&&d(y),T&&g(T),o(!0)},[]),A=(0,i.useMemo)(()=>{const p=a.flatMap(y=>y.alerts);return(0,te.groupBy)(p,y=>y.status.state)},[a]);return[(0,i.useMemo)(()=>(0,e.jsxs)(de.a,{isOpen:s,onDismiss:v,closeOnBackdropClick:!0,closeOnEscape:!0,title:(0,e.jsxs)(h.B,{direction:"row",alignItems:"center",gap:1,wrap:"wrap",children:[(0,e.jsxs)(h.B,{direction:"row",alignItems:"center",gap:.5,children:[(0,e.jsx)(Oe.I,{name:"x"})," Matchers"]}),(0,e.jsx)(Ut.s,{matchers:m,formatter:l})]}),children:[(0,e.jsxs)(h.B,{direction:"column",children:[(0,e.jsx)(xn,{active:A[Re.Or.Active]?.length,suppressed:A[Re.Or.Suppressed]?.length,unprocessed:A[Re.Or.Unprocessed]?.length}),(0,e.jsx)("div",{children:a.map((p,y)=>(0,e.jsx)(hn._,{alertManagerSourceName:t,group:p},y))})]}),(0,e.jsx)(de.a.ButtonRow,{children:(0,e.jsx)(R.$n,{type:"button",variant:"secondary",onClick:v,children:"Cancel"})})]}),[a,v,A,m,l,s,t]),C,v]},it=({isOpen:t})=>(0,e.jsx)(de.a,{isOpen:t,onDismiss:()=>{},closeOnBackdropClick:!1,closeOnEscape:!1,title:(0,e.jsxs)(h.B,{direction:"row",alignItems:"center",gap:.5,children:["Updating... ",(0,e.jsx)(pn.y,{inline:!0})]}),children:"Please wait while we update your notification policies."});var Tn=n(32264),$t=n(83122),ue=n(38138),Qe=n(72109),bn=n(69613),lt=n(23896),ct=n(10685),Sn=n(19645),zt=n(79581),dt=n(35108),ut=n(8406),me=n(55196);const On=({exportFormat:t,onClose:s})=>{const{currentData:o="",isFetching:a}=V.hK.useExportPoliciesQuery({format:t}),r=`policies-${new Date().getTime()}`;return a?(0,e.jsx)(G._,{text:"Loading...."}):(0,e.jsx)(I.J,{format:t,textDefinition:o,downloadFileName:r,onClose:s})},Rn=({onClose:t})=>{const[s,o]=(0,i.useState)("yaml");return(0,e.jsx)(pe.m,{activeTab:s,onTabChange:o,onClose:t,formatProviders:Object.values(Tt.sl),children:(0,e.jsx)(On,{exportFormat:s,onClose:t})})},Vt=t=>{const{receivers:s=[],contactPointsState:o,readOnly:a=!1,provisioned:r=!1,alertGroups:m=[],alertManagerSourceName:d,currentRoute:l,routeTree:g,inheritedProperties:v,routesMatchingFilters:C={filtersApplied:!1,matchedRoutesWithPath:new Map},matchingInstancesPreview:A={enabled:!1},onEditPolicy:D,onAddPolicy:p,onDeletePolicy:y,onShowAlertInstances:T,isAutoGenerated:U=!1}=t,Z=(0,j.of)(Be),k=l===g,q=l.receiver,X=l.continue??!1,ae=(0,Ve.J$)(l),F=!!(ae&&ae.length),{filtersApplied:W,matchedRoutesWithPath:_}=C,re=Array.from(_.keys()),ie=W&&re.some(ee=>ee.id===l.id),L=Array.from(_.values()).flat(),gt=L.some(ee=>ee.id===l.id),We=[],Je=!F&&!k&&!X,Ze=q??v?.receiver??"",pt=o?Vn(Ze,o):[],Xe=l.routes??[],Le=W?Xe.filter(ee=>L.some(Ue=>Ue.id===ee.id)):Xe,ht=Le.length>0,[we,ke]=(0,oe.A)(!1),Ne=A?.groupsMap?.get(l.id),ft=Ne?(0,te.sumBy)(Ne,ee=>ee.alerts.length):void 0,[xt,vt]=(0,H.L7)(H.QI.ViewAutogeneratedPolicyTree),Fe=Ht(l),[Ge,yt]=(0,oe.A)(!Fe),jt=l.group_by,Et=l.mute_time_intervals??[],At=l.active_time_intervals??[],Pt={group_wait:l.group_wait,group_interval:l.group_interval,repeat_interval:l.repeat_interval};pt.forEach(ee=>{We.push(ee)});const qe=20,[_e,Ct]=(0,i.useState)(qe),Ke=Wn(U,k,r,D,l,ke,y);if(U&&(!vt||!xt)||W&&!gt)return null;const ve=k||Fe,Dt=Le.filter(ee=>L.some(Ue=>Ue.id===ee.id)),et=W?Dt:Le,Jt=et.slice(0,_e),It=et.length-Jt.length,os=It>0;return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(h.B,{direction:"column",gap:1.5,children:[(0,e.jsxs)("div",{className:Z.policyWrapper(ie),"data-testid":k?"am-root-route-container":"am-route-container",children:[X&&(0,e.jsx)(Nn,{}),Je&&(0,e.jsx)(Fn,{}),(0,e.jsx)("div",{className:Z.policyItemWrapper,children:(0,e.jsxs)(h.B,{direction:"column",gap:1,children:[(0,e.jsx)("div",{children:(0,e.jsxs)(h.B,{direction:"row",alignItems:"center",gap:1,children:[ht?(0,e.jsx)(Ft.K,{name:Ge?"angle-down":"angle-right",onClick:yt,"aria-label":Ge?"Collapse":"Expand"}):null,ve?Fe?(0,e.jsx)(Kn,{}):(0,e.jsx)(Gn,{}):F?(0,e.jsx)(Ut.s,{matchers:ae??[],formatter:(0,ze.VE)(d)}):(0,e.jsx)("span",{className:Z.metadata,children:(0,e.jsx)(c.x6,{i18nKey:"alerting.policies.no-matchers",children:"No matchers"})}),(0,e.jsx)(Wt.h,{}),We.length>0&&(0,e.jsx)(wn,{errors:We}),r&&(0,e.jsx)(Bt.rS,{}),(0,e.jsxs)(h.B,{direction:"row",gap:.5,children:[!U&&!a&&(0,e.jsx)($e._,{actions:[H.QI.CreateNotificationPolicy],children:(0,e.jsx)(lt.A,{shouldWrap:r,wrap:mt,children:k?(0,e.jsx)(R.$n,{variant:"secondary",icon:"plus",size:"sm",disabled:r,type:"button",onClick:()=>p(l,"child"),children:(0,e.jsx)(c.x6,{i18nKey:"alerting.policies.new-child",children:"New child policy"})}):(0,e.jsx)($t.m,{overlay:(0,e.jsxs)(ue.W,{children:[(0,e.jsx)(ue.W.Item,{label:"New sibling above",icon:"arrow-up",onClick:()=>p(l,"above")}),(0,e.jsx)(ue.W.Item,{label:"New sibling below",icon:"arrow-down",onClick:()=>p(l,"below")}),(0,e.jsx)(ue.W.Divider,{}),(0,e.jsx)(ue.W.Item,{label:"New child policy",icon:"plus",onClick:()=>p(l,"child")})]}),children:(0,e.jsx)(R.$n,{size:"sm",variant:"secondary",disabled:r,icon:"angle-down",type:"button",children:(0,e.jsx)(c.x6,{i18nKey:"alerting.policies.new-policy",children:"Add new policy"})})})})}),Ke.length>0&&(0,e.jsx)($t.m,{overlay:(0,e.jsx)(ue.W,{children:Ke}),children:(0,e.jsx)(R.$n,{icon:"ellipsis-h",variant:"secondary",size:"sm",type:"button","aria-label":"more-actions","data-testid":"more-actions"})})]})]})}),(0,e.jsx)(Bn,{matchingInstancesPreview:A,numberOfAlertInstances:ft,contactPoint:q??void 0,groupBy:jt,muteTimings:Et,activeTimings:At,timingOptions:Pt,inheritedProperties:v,alertManagerSourceName:d,receivers:s,matchingAlertGroups:Ne,matchers:ae,isDefaultPolicy:k,onShowAlertInstances:T})]})})]}),(0,e.jsx)("div",{className:Z.childPolicies,children:Ge&&(0,e.jsxs)(e.Fragment,{children:[Jt.map(ee=>{const Ue=(0,zt.W$)(l,ee,v),as=Ht(ee)||U,rs=a||r||U;return(0,e.jsx)(Vt,{routeTree:g,currentRoute:ee,receivers:s,contactPointsState:o,readOnly:rs,inheritedProperties:Ue,onAddPolicy:p,onEditPolicy:D,onDeletePolicy:y,onShowAlertInstances:T,alertManagerSourceName:d,alertGroups:m,routesMatchingFilters:C,matchingInstancesPreview:A,isAutoGenerated:as,provisioned:r},ee.id)}),os&&(0,e.jsx)(R.$n,{size:"sm",icon:"angle-down",variant:"secondary",className:Z.moreButtons,onClick:()=>Ct(_e+qe),children:(0,e.jsxs)(c.x6,{i18nKey:"alerting.policies.n-more-policies",count:It,children:[{count:It}," additional policies"]})})]})}),we&&(0,e.jsx)(Rn,{onClose:ke})]})})};function Bn({numberOfAlertInstances:t,isDefaultPolicy:s,timingOptions:o,groupBy:a,muteTimings:r=[],activeTimings:m=[],matchingInstancesPreview:d,inheritedProperties:l,matchingAlertGroups:g,onShowAlertInstances:v,matchers:C,contactPoint:A,alertManagerSourceName:D,receivers:p}){const y=(0,j.of)(Be),T=l&&l.group_by,U=l&&Object.keys(l).length>0,Z=(0,te.isArray)(a)&&a[0]==="...",k=!Z&&(0,te.isArray)(a)&&a.length>0,q=s&&(0,te.isArray)(a)&&a.length===0,X=!!r.length,ae=!!m.length;return(0,e.jsx)("div",{className:y.metadataRow,children:(0,e.jsxs)(h.B,{direction:"row",alignItems:"center",gap:1,children:[d.enabled&&(0,e.jsxs)(me.P,{icon:"layers-alt",onClick:()=>{g&&v(g,C,(0,ze.VE)(D))},"data-testid":"matching-instances",children:[(0,e.jsx)(he.E,{color:"primary",children:t??"-"}),(0,e.jsx)("span",{children:(0,e.jsx)(c.x6,{i18nKey:"alerting.policies.metadata.n-instances",count:t??0,children:"instance"})})]}),A&&(0,e.jsxs)(me.P,{icon:"at","data-testid":"contact-point",children:[(0,e.jsx)("span",{children:(0,e.jsx)(c.x6,{i18nKey:"alerting.policies.metadata.delivered-to",children:"Delivered to"})}),(0,e.jsx)(zn,{alertManagerSourceName:D,receivers:p,contactPoint:A})]}),!T&&(0,e.jsxs)(e.Fragment,{children:[k&&(0,e.jsxs)(me.P,{icon:"layer-group","data-testid":"grouping",children:[(0,e.jsx)("span",{children:(0,e.jsx)(c.x6,{i18nKey:"alerting.policies.metadata.grouped-by",children:"Grouped by"})}),(0,e.jsx)(he.E,{color:"primary",children:a.join(", ")})]}),q&&(0,e.jsx)(me.P,{icon:"layer-group",children:(0,e.jsx)("span",{children:(0,e.jsx)(c.x6,{i18nKey:"alerting.policies.metadata.grouping.single-group",children:"Single group"})})}),Z&&(0,e.jsx)(me.P,{icon:"layer-group",children:(0,e.jsx)("span",{children:(0,e.jsx)(c.x6,{i18nKey:"alerting.policies.metadata.grouping.none",children:"Not grouping"})})})]}),X&&(0,e.jsxs)(me.P,{icon:"calendar-slash","data-testid":"mute-timings",children:[(0,e.jsx)("span",{children:(0,e.jsx)(c.x6,{i18nKey:"alerting.policies.metadata.mute-time",children:"Muted when"})}),(0,e.jsx)(Qt,{timings:r,alertManagerSourceName:D})]}),ae&&(0,e.jsxs)(me.P,{icon:"calendar-alt","data-testid":"active-timings",children:[(0,e.jsx)("span",{children:(0,e.jsx)(c.x6,{i18nKey:"alerting.policies.metadata.active-time",children:"Active when"})}),(0,e.jsx)(Qt,{timings:m,alertManagerSourceName:D})]}),o&&(0,e.jsx)($n,{timingOptions:s?(0,te.defaults)(o,He.H):o}),U&&(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(me.P,{icon:"corner-down-right-alt","data-testid":"inherited-properties",children:[(0,e.jsx)("span",{children:(0,e.jsx)(c.x6,{i18nKey:"alerting.policies.metadata.inherited",children:"Inherited"})}),(0,e.jsx)(Un,{properties:l})]})})]})})}const Wn=(t,s,o,a,r,m,d)=>{const[[l,g],[v,C],[A,D]]=(0,H.Hl)([H.QI.UpdateNotificationPolicyTree,H.QI.DeleteNotificationPolicy,H.QI.ExportNotificationPolicies]),p=[],y=D&&A&&s&&!t,T=l&&g,U=v&&C&&!s&&!t;return T&&p.push((0,e.jsx)(i.Fragment,{children:(0,e.jsx)(lt.A,{shouldWrap:o,wrap:mt,children:(0,e.jsx)(ue.W.Item,{icon:"edit",disabled:o||t,label:"Edit",onClick:()=>a(r,s)})})},"edit-policy")),y&&p.push((0,e.jsx)(ue.W.Item,{icon:"download-alt",label:"Export",onClick:m},"export-policy")),U&&p.push((0,e.jsxs)(i.Fragment,{children:[(0,e.jsx)(ue.W.Divider,{}),(0,e.jsx)(lt.A,{shouldWrap:o,wrap:mt,children:(0,e.jsx)(ue.W.Item,{destructive:!0,icon:"trash-alt",disabled:o||t,label:"Delete",onClick:()=>d(r)})})]},"delete-policy")),p},Ln="__grafana_autogenerated__";function Ht(t){return!(Tn.$.featureToggles.alertingSimplifiedRouting??!1)||!t.object_matchers?!1:t.object_matchers.some(o=>o[0]===Ln&&o[1]===Re.ho.equal&&o[2]==="true")??!1}const mt=t=>(0,e.jsx)(Pe.m,{content:"Provisioned items cannot be edited in the UI",placement:"top",children:(0,e.jsx)("span",{children:t})}),wn=({errors:t})=>(0,e.jsx)(dt.B,{arrow:!0,placement:"top",content:(0,e.jsx)(h.B,{direction:"column",gap:.5,children:t.map(s=>(0,e.jsx)(i.Fragment,{children:s},(0,te.uniqueId)()))}),children:(0,e.jsx)("span",{children:(0,e.jsx)(b.E,{icon:"exclamation-circle",color:"red",text:ot()("error",t.length,!0)})})}),Nn=()=>{const t=(0,j.of)(Be);return(0,e.jsx)(Pe.m,{placement:"top",content:"This route will continue matching other policies",children:(0,e.jsx)("div",{className:t.gutterIcon,"data-testid":"continue-matching",children:(0,e.jsx)(Oe.I,{name:"arrow-down"})})})},Fn=()=>{const t=(0,j.of)(Be);return(0,e.jsx)(Pe.m,{placement:"top",content:"This policy matches all labels",children:(0,e.jsx)("div",{className:t.gutterIcon,"data-testid":"matches-all",children:(0,e.jsx)(Oe.I,{name:"exclamation-triangle"})})})};function Gn(){const t=(0,j.of)(Be);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(he.E,{element:"h2",variant:"body",weight:"medium",children:(0,e.jsx)(c.x6,{i18nKey:"alerting.policies.default-policy.title",children:"Default policy"})}),(0,e.jsx)("span",{className:t.metadata,children:(0,e.jsx)(c.x6,{i18nKey:"alerting.policies.default-policy.description",children:"All alert instances will be handled by the default policy if no other matching policies are found."})})]})}function Kn(){return(0,e.jsx)(he.E,{element:"h3",variant:"body",weight:"medium",children:(0,e.jsx)(c.x6,{i18nKey:"alerting.policies.generated-policies",children:"Auto-generated policies"})})}const Un=({properties:t})=>(0,e.jsx)(dt.B,{arrow:!0,placement:"top",content:(0,e.jsx)(h.B,{direction:"row",gap:.5,children:Object.entries(t).map(([s,o])=>o?(0,e.jsx)(ut.J,{label:Hn(s),value:Qn(s,o)},s):null)}),children:(0,e.jsx)("div",{children:(0,e.jsx)(he.E,{color:"primary",children:ot()("property",Object.keys(t).length,!0)})})}),Qt=({timings:t,alertManagerSourceName:s})=>(0,e.jsx)("div",{children:t.map((o,a)=>(0,e.jsxs)(i.Fragment,{children:[(0,e.jsx)(Qe.Y,{href:(0,Ee.i7)(o,s),color:"primary",variant:"bodySmall",inline:!1,children:o}),a<t.length-1&&", "]},o))}),$n=({timingOptions:t})=>{const s=t.group_wait,o=t.group_interval,a=t.repeat_interval;if(!s&&!o&&!a)return null;const r=[];return s&&r.push((0,e.jsx)(Pe.m,{placement:"top",content:(0,c.t)("alerting.policies.metadata.timingOptions.groupWait.description","How long to initially wait to send a notification for a group of alert instances."),children:(0,e.jsx)("span",{children:(0,e.jsxs)(c.x6,{i18nKey:"alerting.policies.metadata.timingOptions.groupWait.label",children:["Wait ",(0,e.jsx)(ct.S,{content:s})," to group instances"]})})})),o&&r.push((0,e.jsx)(Pe.m,{placement:"top",content:(0,c.t)("alerting.policies.metadata.timingOptions.groupInterval.description","How long to wait before sending a notification about new alerts that are added to a group of alerts for which an initial notification has already been sent."),children:(0,e.jsx)("span",{children:(0,e.jsxs)(c.x6,{i18nKey:"alerting.policies.metadata.timingOptions.groupInterval.label",children:["Wait ",(0,e.jsx)(ct.S,{content:o})," before sending updates"]})})})),a&&r.push((0,e.jsx)(Pe.m,{placement:"top",content:(0,c.t)("alerting.policies.metadata.timingOptions.repeatInterval.description","How often notifications are sent if the group of alerts has not changed since the last notification."),children:(0,e.jsx)("span",{children:(0,e.jsxs)(c.x6,{i18nKey:"alerting.policies.metadata.timingOptions.repeatInterval.label",children:["Repeated every ",(0,e.jsx)(ct.S,{content:a})]})})})),(0,e.jsx)(me.P,{icon:"hourglass","data-testid":"timing-options",children:r.map((m,d)=>(0,e.jsxs)("span",{children:[m,d<r.length-1&&" \xB7 "]},(0,te.uniqueId)()))})},zn=({alertManagerSourceName:t,contactPoint:s,receivers:o})=>{const a=o.find(d=>d.name===s);if(!a)return(0,e.jsx)(Qe.Y,{href:(0,Ee.bg)(s,t),color:"primary",variant:"bodySmall",inline:!1,children:s});if(!a.grafana_managed_receiver_configs)return(0,e.jsx)(Qe.Y,{href:(0,Ee.bg)(s,t),color:"primary",variant:"bodySmall",inline:!1,children:s});const m=(0,te.groupBy)(a.grafana_managed_receiver_configs,d=>d.type);return(0,e.jsx)(dt.B,{arrow:!0,placement:"top",header:(0,e.jsxs)(me.P,{icon:"at",children:[(0,e.jsx)("div",{children:(0,e.jsx)(c.x6,{i18nKey:"alerting.contact-point",children:"Contact Point"})}),(0,e.jsx)(he.E,{color:"primary",children:s})]}),content:(0,e.jsx)(h.B,{direction:"row",gap:.5,children:Object.entries(m).map(([d,l])=>(0,e.jsx)(ut.J,{label:l.length>1?l.length:void 0,icon:Sn.M[d],value:(0,te.upperFirst)(d)},(0,te.uniqueId)()))}),children:(0,e.jsx)(Qe.Y,{href:(0,Ee.bg)(s,t),color:"primary",variant:"bodySmall",inline:!1,children:s})},(0,te.uniqueId)())};function Vn(t,s){return Object.entries(s[t]?.notifiers??[]).reduce((r=[],[m,d])=>{const l=d.filter(g=>g.lastNotifyAttemptError).map(g=>(0,e.jsx)(ut.J,{icon:"at",label:`Contact Point \u203A ${g.name}`,value:g.lastNotifyAttemptError},(0,te.uniqueId)()));return r.concat(l)},[])}const Hn=t=>{switch(t){case"receiver":return"Contact Point";case"group_by":return"Group by";case"group_interval":return"Group interval";case"group_wait":return"Group wait";case"repeat_interval":return"Repeat interval";default:return t}},Qn=(t,s)=>{const o=t==="group_by"&&Array.isArray(s)&&s[0]==="...",a=t==="group_by"&&Array.isArray(s)&&s.length===0;return o?(0,e.jsx)(he.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(c.x6,{i18nKey:"alerting.policies.metadata.grouping.none",children:"Not grouping"})}):a?(0,e.jsx)(he.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(c.x6,{i18nKey:"alerting.policies.metadata.grouping.single-group",children:"Single group"})}):Array.isArray(s)?s.join(", "):s},Be=t=>({matcher:s=>{const{color:o,borderColor:a}=(0,bn.MC)(s);return{wrapper:(0,u.css)({color:"#fff",background:o,padding:`${t.spacing(.33)} ${t.spacing(.66)}`,fontSize:t.typography.bodySmall.fontSize,border:`solid 1px ${a}`,borderRadius:t.shape.radius.default})}},childPolicies:(0,u.css)({marginLeft:t.spacing(4),position:"relative","&:before":{content:'""',position:"absolute",height:"calc(100% - 10px)",borderLeft:`solid 1px ${t.colors.border.weak}`,marginTop:0,marginLeft:"-20px"}}),policyItemWrapper:(0,u.css)({padding:t.spacing(1.5)}),metadataRow:(0,u.css)({borderBottomLeftRadius:t.shape.borderRadius(2),borderBottomRightRadius:t.shape.borderRadius(2)}),policyWrapper:(s=!1)=>(0,u.css)({flex:1,position:"relative",background:t.colors.background.secondary,borderRadius:t.shape.radius.default,border:`solid 1px ${t.colors.border.weak}`,...s&&{borderColor:t.colors.primary.border,background:t.colors.primary.transparent}}),metadata:(0,u.css)({color:t.colors.text.secondary,fontSize:t.typography.bodySmall.fontSize,fontWeight:t.typography.bodySmall.fontWeight}),break:(0,u.css)({width:"100%",height:0,marginBottom:t.spacing(2)}),gutterIcon:(0,u.css)({position:"absolute",top:0,transform:"translateY(50%)",left:`-${t.spacing(4)}`,color:t.colors.text.secondary,background:t.colors.background.primary,width:"25px",height:"25px",textAlign:"center",border:`solid 1px ${t.colors.border.weak}`,borderRadius:t.shape.radius.default,padding:0}),moreButtons:(0,u.css)({marginTop:t.spacing(.5),marginBottom:t.spacing(1.5)})});var Yn=n(51488),Jn=n(26627),Zn=n(19143),Xn=n(88467),Ye=n(67332),kn=(t=>(t.NotificationPolicies="notification_policies",t.MuteTimings="mute_timings",t))(kn||{});const qn=()=>{const t=(0,O.useDispatch)(),s=(0,j.of)(es),{useGetAlertmanagerAlertGroupsQuery:o}=N.m,[a,r]=(0,x.s)(),{tab:m}=ts(a),[d,l]=(0,i.useState)(m),[g,v]=(0,i.useState)(!1),[C,A]=(0,i.useState)(),[D,p]=(0,i.useState)([]),{selectedAlertmanager:y,hasConfigurationAPI:T,isGrafanaAlertmanager:U}=(0,Gt.VI)(),{getRouteGroupsMap:Z}=(0,Zn.L)(),{data:k=[]}=(0,P.Ad)({alertmanager:y??""}),q=Ce(y??""),{currentData:X,isLoading:ae,error:F}=(0,Yn.f)(y,{refetchOnFocus:!0,refetchOnReconnect:!0}),W=X?.alertmanager_config,{currentData:_,refetch:re}=o({amSourceName:y??""},{skip:!y}),ie=W?.receivers??[],L=(0,i.useMemo)(()=>{if(W?.route)return(0,Y.QM)(W.route)},[W?.route]),[{value:gt,error:We},Je]=(0,S.A)(Z,[Z]);(0,i.useEffect)(()=>{L&&_&&Je(L,_,{unquoteMatchers:!U})},[L,_,Je,U]);const Ze=(0,i.useMemo)(()=>L?Yt(L,{contactPointFilter:C,labelMatchersFilter:D}):{filtersApplied:!1,matchedRoutesWithPath:new Map},[C,D,L]),pt=!!W?.route?.provenance;function Xe(le){if(!L)return;const ve=(0,Ye.AB)(y??"",le,L);we(ve)}function Le(le){if(!L)return;const ve=(0,Ye.AS)(le,L);we(ve)}function ht(le,ve,Dt){if(!L)return;const et=(0,Ye.I8)(y??"",le,ve,L,Dt);we(et)}function we(le){if(!X)return;const ve=(0,Ye.dn)(le);v(!0),t((0,Jn.RW)({newConfig:{...X,alertmanager_config:{...X.alertmanager_config,route:ve}},oldConfig:X,alertManagerSourceName:y,successMessage:"Updated notification policies"})).unwrap().then(()=>{y&&re(),Fe(),ft(),jt()}).finally(()=>{v(!1)})}const[ke,Ne,ft]=Cn(ht,g),[xt,vt,Fe]=Mn(y??"",Xe,g),[Ge,yt,jt]=Dn(Le,g),[Et,At]=In(y??"");if((0,K.o)(le=>le.unifiedAlerting.saveAMConfig=Xn.jA),!y)return null;const Pt=k.length,qe=X&&!F&&!ae,_e=!X&&ae,Ct=F&&!ae,Ke=d==="mute_timings",Mt=d==="notification_policies";return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(je.M,{currentAlertmanager:y}),(0,e.jsxs)(E.U,{children:[(0,e.jsx)(M.o,{label:"Notification Policies",active:Mt,onChangeTab:()=>{l("notification_policies"),r({tab:"notification_policies"})}}),(0,e.jsx)(M.o,{label:"Mute Timings",active:Ke,counter:Pt,onChangeTab:()=>{l("mute_timings"),r({tab:"mute_timings"})}})]}),(0,e.jsxs)($.J,{className:s.tabContent,children:[_e&&(0,e.jsx)(G._,{text:"Loading Alertmanager config..."}),Ct&&(0,e.jsx)(B.F,{severity:"error",title:"Error loading Alertmanager config",children:F.message||"Unknown error."}),qe&&(0,e.jsxs)(e.Fragment,{children:[Mt&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(h.B,{direction:"column",gap:1,children:[L&&(0,e.jsx)(dn,{onChangeMatchers:p,onChangeReceiver:A,matchingCount:Ze.matchedRoutesWithPath.size}),L&&(0,e.jsx)(Vt,{receivers:ie,routeTree:L,currentRoute:L,alertGroups:_??[],contactPointsState:q.receivers,readOnly:!T,provisioned:pt,alertManagerSourceName:y,onAddPolicy:Ne,onEditPolicy:vt,onDeletePolicy:yt,onShowAlertInstances:At,routesMatchingFilters:Ze,matchingInstancesPreview:{groupsMap:gt,enabled:!We},isAutoGenerated:!1})]}),ke,xt,Ge,Et]}),Ke&&(0,e.jsx)(on,{alertManagerSourceName:y,hideActions:!T})]})]})]})},Yt=(t,s)=>{const{contactPointFilter:o,labelMatchersFilter:a=[]}=s,r=o||a.length>0,m=!!o&&a.length>0;if(!r)return{filtersApplied:!1,matchedRoutesWithPath:new Map};const d=[],l=(0,zt._I)(t),g=o?Lt(l,p=>p.receiver===o):new Map,v=Array.from(g.keys());v&&d.push(v);const C=a.length?Lt(l,p=>un(p,a)):new Map,A=Array.from(C.keys());return C.size>0&&d.push(A),{filtersApplied:!0,matchedRoutesWithPath:m?_n(C,g):new Map([...C,...g])}};function _n(...t){const s=new Map;for(const o of t[0].keys())t.every(a=>a.has(o))&&s.set(o,t[0].get(o));return s}const es=t=>({tabContent:(0,u.css)({marginTop:t.spacing(2)})});function ts(t){let s="notification_policies";return t.tab==="notification_policies"&&(s="notification_policies"),t.tab==="mute_timings"&&(s="mute_timings"),{tab:s}}const ns=()=>(0,e.jsx)(Me.y,{navId:"am-routes",accessType:"notification",children:(0,e.jsx)(qn,{})}),ss=(0,f.Xc)(ns,{style:"page"})},64853:(ce,w,n)=>{n.d(w,{_:()=>j});var e=n(74848),u=n(2543),i=n.n(u),S=n(19073);const j=({actions:h,children:f})=>{const x=(0,u.filter)(h,G),P=(0,u.filter)(h,B);return x.length?(0,e.jsx)(E,{actions:x,children:f}):P.length?(0,e.jsx)(M,{actions:P,children:f}):null},E=({actions:h,children:f})=>{const x=(0,S.iI)();return $(x,h)?(0,e.jsx)(e.Fragment,{children:f}):null},M=({actions:h,children:f})=>{const x=(0,S.e2)();return $(x,h)?(0,e.jsx)(e.Fragment,{children:f}):null};function $(h,f){return(0,u.chain)(h).pick(f).values().value().some(([x,P])=>P===!0)}function G(h){return Object.values(S.QI).includes(h)}function B(h){return Object.values(S.RY).includes(h)}},23088:(ce,w,n)=>{n.d(w,{Z:()=>S});var e=n(74848),u=n(32196),i=n(40845);const S=({children:E})=>{const M=(0,i.of)(j);return(0,e.jsx)("div",{className:M.container,children:E})},j=E=>({container:(0,u.css)({backgroundColor:E.colors.background.secondary,color:E.colors.text.secondary,padding:E.spacing(4),textAlign:"center"})})},57895:(ce,w,n)=>{n.d(w,{M:()=>G});var e=n(74848),u=n(32196),i=n(40845),S=n(42418),j=n(60021),E=n(82843),M=n(19073),$=n(57220);function G({currentAlertmanager:h}){const f=(0,i.of)(B),x=h!==$.hY,[P,O]=(0,M.Ej)(M.RY.ReadConfigurationStatus),K=P&&O,{currentData:N}=E.m.endpoints.getGrafanaAlertingConfigurationStatus.useQuery(void 0,{skip:x||!K});if(!(N?.alertmanagersChoice&&[j.nA.External,j.nA.All].includes(N?.alertmanagersChoice))||x)return null;const z=N.numExternalAlertmanagers>0;return N.alertmanagersChoice===j.nA.External?(0,e.jsxs)(S.F,{title:"Grafana alerts are not delivered to Grafana Alertmanager",children:["Grafana is configured to send alerts to external Alertmanagers only. Changing Grafana Alertmanager configuration will not affect delivery of your alerts.",(0,e.jsx)("div",{className:f.adminHint,children:"To change your Alertmanager setup, go to the Alerting Admin page. If you do not have access, contact your Administrator."})]}):N.alertmanagersChoice===j.nA.All&&z?(0,e.jsxs)(S.F,{title:"You have additional Alertmanagers to configure",severity:"warning",children:["Ensure you make configuration changes in the correct Alertmanagers; both internal and external. Changing one will not affect the others.",(0,e.jsx)("div",{className:f.adminHint,children:"To change your Alertmanager setup, go to the Alerting Admin page. If you do not have access, contact your Administrator."})]}):null}const B=h=>({adminHint:(0,u.css)({fontSize:h.typography.bodySmall.fontSize,fontWeight:h.typography.bodySmall.fontWeight})})},35016:(ce,w,n)=>{n.d(w,{_:()=>je});var e=n(74848),u=n(32196),i=n(96540),S=n(40845),j=n(67061),E=n(72109),M=n(60021),$=n(78742),G=n(69087),B=n(64047),h=n(55196),f=n(70416),x=n(10562),P=n(97754),O=n(55852),K=n(16233),N=n(31678),ne=n(19073),z=n(57220),se=n(71223),ge=n(64853);const ye=({alert:c,alertManagerSourceName:b})=>{const J=(0,S.of)(Ie),oe=(0,z.z2)(b),V=oe?K.TP.hasPermission(N.AccessControlAction.AlertingRuleRead):!0;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:J.actionsRow,children:[c.status.state===M.Or.Suppressed&&(0,e.jsx)(ge._,{actions:[ne.QI.CreateSilence,ne.QI.UpdateSilence],children:(0,e.jsx)(O.z9,{href:`${(0,$.nL)("/alerting/silences",b)}&silenceIds=${c.status.silencedBy.join(",")}`,className:J.button,icon:"bell",size:"sm",children:"Manage silences"})}),c.status.state===M.Or.Active&&(0,e.jsx)(ge._,{actions:[ne.QI.CreateSilence],children:(0,e.jsx)(O.z9,{href:(0,$.BK)(b,c.labels),className:J.button,icon:"bell-slash",size:"sm",children:"Silence"})}),V&&c.generatorURL&&(0,e.jsx)(O.z9,{className:J.button,href:c.generatorURL,icon:"chart-line",size:"sm",children:oe?"See alert rule":"See source"})]}),Object.entries(c.annotations).map(([I,pe])=>(0,e.jsx)(se.s,{annotationKey:I,value:pe},I)),(0,e.jsxs)("div",{className:J.receivers,children:["Receivers:"," ",c.receivers.map(({name:I})=>I).filter(I=>!!I).join(", ")]})]})},Ie=c=>({button:(0,u.css)({"& + &":{marginLeft:c.spacing(1)}}),actionsRow:(0,u.css)({padding:`${c.spacing(2,0)} !important`,borderBottom:`1px solid ${c.colors.border.medium}`}),receivers:(0,u.css)({padding:c.spacing(1,0)})}),Ae=({alerts:c,alertManagerSourceName:b})=>{const J=(0,S.of)(Te),oe=(0,i.useMemo)(()=>[{id:"state",label:"Notification state",renderCell:({data:I})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(P.y,{state:I.status.state}),(0,e.jsxs)("span",{className:J.duration,children:["for"," ",(0,f.dU)({start:new Date(I.startsAt),end:new Date(I.endsAt)})]})]}),size:"220px"},{id:"labels",label:"Instance labels",renderCell:({data:{labels:I}})=>(0,e.jsx)(G.m,{labels:I,size:"sm"}),size:1}],[J]),V=(0,i.useMemo)(()=>c.map(I=>({id:I.fingerprint,data:I})),[c]);return(0,e.jsx)("div",{className:J.tableWrapper,"data-testid":"alert-group-table",children:(0,e.jsx)(x.B,{cols:oe,items:V,isExpandable:!0,renderExpandedContent:({data:I})=>(0,e.jsx)(ye,{alert:I,alertManagerSourceName:b})})})},Te=c=>({tableWrapper:(0,u.css)({marginTop:c.spacing(3),[c.breakpoints.up("md")]:{marginLeft:c.spacing(4.5)}}),duration:(0,u.css)({marginLeft:c.spacing(1),fontSize:c.typography.bodySmall.fontSize})});var be=n(55127),Se=n.n(be);const Ce=c=>({[M.Or.Active]:(0,u.css)({color:c.colors.error.text}),[M.Or.Suppressed]:(0,u.css)({color:c.colors.primary.text}),[M.Or.Unprocessed]:(0,u.css)({color:c.colors.secondary.text})}),Me=({group:c})=>{const b=(0,S.of)(Ce),J=c.alerts.length,oe=c.alerts.reduce((V,I)=>(V[I.status.state]?V[I.status.state]+=1:V[I.status.state]=1,V),{});return(0,e.jsxs)("div",{children:[`${J} ${Se()("alert",J)}: `,Object.entries(oe).map(([V,I],pe)=>(0,e.jsxs)("span",{className:b[V],children:[pe>0&&", ",`${I} ${V}`]},`${JSON.stringify(c.labels)}-notifications-${pe}`))]})},je=({alertManagerSourceName:c,group:b})=>{const[J,oe]=(0,i.useState)(!0),V=(0,S.of)(R),I=b.receiver.name!=="NONE",pe=b.receiver.name;return(0,e.jsxs)("div",{className:V.wrapper,children:[(0,e.jsxs)("div",{className:V.header,children:[(0,e.jsxs)("div",{className:V.group,"data-testid":"alert-group",children:[(0,e.jsx)(B.e,{size:"sm",isCollapsed:J,onToggle:()=>oe(!J),"data-testid":"alert-group-collapse-toggle"}),Object.keys(b.labels).length?(0,e.jsxs)(j.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)(G.m,{labels:b.labels,size:"sm"}),I&&(0,e.jsxs)(h.P,{icon:"at",children:["Delivered to"," ",(0,e.jsx)(E.Y,{href:(0,$.bg)(pe,c),variant:"bodySmall",color:"primary",inline:!1,children:b.receiver.name})]})]}):(0,e.jsx)("span",{children:"No grouping"})]}),(0,e.jsx)(Me,{group:b})]}),!J&&(0,e.jsx)(Ae,{alertManagerSourceName:c,alerts:b.alerts})]})},R=c=>({wrapper:(0,u.css)({"& + &":{marginTop:c.spacing(2)}}),header:(0,u.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",padding:`${c.spacing(1)} ${c.spacing(1)} ${c.spacing(1)} 0`,backgroundColor:c.colors.background.secondary,width:"100%"}),group:(0,u.css)({display:"flex",flexDirection:"row",alignItems:"center"}),summary:(0,u.css)({}),[M.Or.Active]:(0,u.css)({color:c.colors.error.main}),[M.Or.Suppressed]:(0,u.css)({color:c.colors.primary.main}),[M.Or.Unprocessed]:(0,u.css)({color:c.colors.secondary.main})})},39184:(ce,w,n)=>{n.d(w,{u:()=>K});var e=n(74848),u=n(32196),i=n(96540),S=n(40845),j=n(94753),E=n(42418),M=n(67061),$=n(90182),G=n(29158),B=n(79633),h=n(70383),f=n(93667);const x=500,P=z=>new Promise(se=>setTimeout(se,z)),O=1e3,K=({selectProps:z,showRefreshButton:se,selectedContactPointName:ge})=>{const{selectedAlertmanager:ye}=(0,h.VI)(),{contactPoints:Ie,isLoading:Ae,error:Te,refetch:be}=(0,f.dK)({alertmanager:ye}),[Se,Ce]=(0,i.useState)(!1),Me=(0,S.of)(ne),je=Ie.map(b=>({label:b.name,value:b,component:()=>(0,e.jsx)(j.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(B.yz,{receivers:b.grafana_managed_receiver_configs,limit:2})})})),R=(0,i.useMemo)(()=>je.find(b=>b.value?.name===ge)||null,[je,ge]),c=()=>{Ce(!0),Promise.all([be(),P(O)]).finally(()=>{Ce(!1)})};return Te?(0,e.jsx)(E.F,{title:"Failed to fetch contact points",severity:"error"}):(0,e.jsxs)(M.B,{children:[(0,e.jsx)($.l6,{virtualized:je.length>x,options:je,value:R,...z,isLoading:Ae}),se&&(0,e.jsx)(G.K,{name:"sync",onClick:c,"aria-label":"Refresh contact points",tooltip:"Refresh contact points list",className:(0,u.cx)(Me.refreshButton,{[Me.loading]:Se||Ae})})]})},N=(0,u.keyframes)({from:{transform:"rotate(0deg)"},to:{transform:"rotate(720deg)"}}),ne=z=>({refreshButton:(0,u.css)({color:z.colors.text.secondary,cursor:"pointer",borderRadius:z.shape.radius.circle,overflow:"hidden"}),loading:(0,u.css)({pointerEvents:"none",[z.transitions.handleMotion("no-preference")]:{animation:`${N} 2s infinite linear`},[z.transitions.handleMotion("reduce")]:{animation:`${N} 6s infinite linear`}})})},26928:(ce,w,n)=>{n.d(w,{s:()=>B});var e=n(74848),u=n(32196),i=n(2543),S=n.n(i),j=n(40845),E=n(67061),M=n(69613),$=n(32642),G=n(35108);const B=({matchers:x,formatter:P="default"})=>{const O=(0,j.of)(f),K=5,N=(0,i.take)(x,K),ne=(0,i.takeRight)(x,x.length-K),z=ne.length>0;return(0,e.jsx)("span",{"data-testid":"label-matchers",children:(0,e.jsxs)(E.B,{direction:"row",gap:1,alignItems:"center",wrap:"wrap",children:[N.map(se=>(0,e.jsx)(h,{matcher:se,formatter:P},(0,i.uniqueId)())),z&&(0,e.jsx)(G.B,{arrow:!0,placement:"top",content:(0,e.jsx)(e.Fragment,{children:ne.map(se=>(0,e.jsx)(h,{matcher:se},(0,i.uniqueId)()))}),children:(0,e.jsx)("span",{children:(0,e.jsx)("div",{className:O.metadata,children:`and ${ne.length} more`})})})]})})},h=({matcher:x,formatter:P="default"})=>{const O=(0,j.of)(f);return(0,e.jsx)("div",{className:O.matcher(x[0]).wrapper,children:(0,e.jsx)(E.B,{direction:"row",gap:0,alignItems:"baseline",children:$.t8[P](x)})})},f=x=>({matcher:P=>{const{color:O,borderColor:K}=(0,M.MC)(P);return{wrapper:(0,u.css)({color:"#fff",background:O,padding:`${x.spacing(.33)} ${x.spacing(.66)}`,fontSize:x.typography.bodySmall.fontSize,border:`solid 1px ${K}`,borderRadius:x.shape.borderRadius(2),whiteSpace:"pre"})}},metadata:(0,u.css)({color:x.colors.text.secondary,fontSize:x.typography.bodySmall.fontSize,fontWeight:x.typography.bodySmall.fontWeight})})},51488:(ce,w,n)=>{n.d(w,{f:()=>u});var e=n(82843);function u(i,S){const j=e.m.endpoints.getAlertmanagerConfiguration.useQuery(i??"",{refetchOnMountOrArgChange:!0,...S,skip:!i});return{...j,error:j.error}}},19143:(ce,w,n)=>{n.d(w,{L:()=>G});var e=n(14590),u=n(96540),i=n(25027),S=n(67278);const j=()=>new S.c(new URL(n.p+n.u(5398),n.b));let E;function M(){let B;if(E===void 0)try{B=j(),E=e.LV(B)}catch(f){f instanceof Error&&(0,i.vV)(f)}return{disposeWorker:()=>{B&&E&&(E[e.A2](),B.terminate(),E=void 0,B=void 0)}}}function $(B){if(!E)throw new Error("Route Matcher has not been initialized")}function G(){(0,u.useEffect)(()=>{const{disposeWorker:f}=M();return f},[]);const B=(0,u.useCallback)(async(f,x,P)=>{$(E);const O=performance.now(),K=await E.getRouteGroupsMap(f,x,P),N=performance.now()-O;return(0,i.fH)(`Route Groups Matched in  ${N} ms`,{matchingTime:N.toString(),alertGroupsCount:x.length.toString(),topLevelRoutesCount:f.routes?.length.toString()??"0"}),K},[]),h=(0,u.useCallback)(async(f,x,P)=>{$(E);const O=performance.now(),K=await E.matchInstancesToRoute(f,x,P),N=performance.now()-O;return(0,i.fH)(`Instances Matched in  ${N} ms`,{matchingTime:N.toString(),instancesToMatchCount:x.length.toString(),topLevelRoutesCount:f.routes?.length.toString()??"0"}),K},[]);return{getRouteGroupsMap:B,matchInstancesToRoute:h}}},54486:(ce,w,n)=>{n.d(w,{KR:()=>S,Ww:()=>E,d6:()=>h,iF:()=>$,jU:()=>i,jb:()=>B,oU:()=>j});var e=n(2543),u=n.n(e);const i=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],S=["january","february","march","april","may","june","july","august","september","october","november","december"],j={times:[{start_time:"",end_time:""}],weekdays:"",days_of_month:"",months:"",years:"",location:"",disable:!1},E=(f,x,P)=>f?f.split(",").map(O=>O.trim()).every(O=>O.split(":").every(x))||P:!0,M=f=>f?f.split(",").map(x=>x.trim()):void 0,$=f=>{const x=f.time_intervals.map(({times:P,weekdays:O,days_of_month:K,months:N,years:ne,location:z,disable:se})=>{const ge={times:G(P,se),weekdays:M(O)?.map(ye=>ye.toLowerCase()),days_of_month:M(K),months:M(N),years:M(ne),location:z||void 0};return(0,e.omitBy)(ge,e.isUndefined)});return{name:f.name,time_intervals:x}};function G(f,x){if(x)return[];const P=f?.filter(({start_time:O,end_time:K})=>!!O&&!!K);return P?.length?P:void 0}function B(f){return f.times?.length===0||f.weekdays?.length===0||f.days_of_month?.length===0||f.months?.length===0||f.years?.length===0}function h(f){return f.time_intervals.every(x=>B(x))}}}]);

//# sourceMappingURL=AlertAmRoutes.3d42ac7f2a165a9998e4.js.map