"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4712],{91159:(X,$,n)=>{n.d($,{n:()=>F});var y=n(68404),O=n(31439);const V=y.lazy(()=>Promise.all([n.e(1899),n.e(4254),n.e(924),n.e(9305),n.e(7142)]).then(n.bind(n,47864))),k=C=>y.createElement(y.Suspense,{fallback:null},y.createElement(V,{...C})),e=C=>{const T=(0,y.useRef)(null),{onRunQuery:R,onChange:D,...M}=C,p=P=>{T.current=P,D(P),R()},L=P=>{D(P)};return y.createElement(k,{onRunQuery:p,onBlur:L,...M})};class F extends y.PureComponent{constructor(T){super(T),this._isMounted=!1,this.onChangeQuery=(R,D)=>{const{query:M,onChange:p,onRunQuery:L}=this.props;if(p){const P={...M,expr:R};p(P),D&&L&&L()}},this.state={labelsLoaded:!1}}async componentDidMount(){this._isMounted=!0,await this.props.datasource.languageProvider.start(),this._isMounted&&this.setState({labelsLoaded:!0})}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(T){const{range:R,datasource:{languageProvider:D}}=this.props;(0,O.rf)(R,T.range)&&D.fetchLabels()}render(){const{ExtraFieldElement:T,query:R,datasource:D,history:M,onRunQuery:p,onQueryType:L}=this.props,P=this.props.placeholder??"Enter a Loki query (run with Shift+Enter)";return y.createElement(y.Fragment,null,y.createElement("div",{className:"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1","data-testid":this.props["data-testid"]},y.createElement("div",{className:"gf-form gf-form--grow flex-shrink-1 min-width-15"},y.createElement(e,{datasource:D,history:M??[],onChange:this.onChangeQuery,onRunQuery:p,initialValue:R.expr??"",placeholder:P,onQueryType:L}))),T)}}},31439:(X,$,n)=>{n.d($,{Hk:()=>R,U9:()=>F,_z:()=>D,aC:()=>M,iS:()=>C,rf:()=>V,tU:()=>T});function y(p){return O(p/1e3)}function O(p){return Math.floor(p/60)}function V(p,L){if(p&&L){const P=y(p.from.valueOf())===y(L.from.valueOf()),A=y(p.to.valueOf())===y(L.to.valueOf());return!(P&&A)}return!1}const k=/[*+?()|\\.\[\]{}^$]/g;function e(p){return p.replace(k,"\\$&")}function F(p){return p.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/"/g,'\\"')}function C(p){return p.replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}function T(p){return F(e(p))}function R(p,L){return D(L)?T(p):F(p)}function D(p){return!!(p&&(p.includes("=~")||p.includes("!~")))}function M(p){const L=["b","kib","Kib","kb","KB","mib","Mib","mb","MB","gib","Gib","gb","GB","tib","Tib","tb","TB","pib","Pib","pb","PB","eib","Eib","eb","EB"],P=new RegExp(`^(?:-?\\d+(?:\\.\\d+)?)(?:${L.join("|")})$`);return!!p.match(P)}},34712:(X,$,n)=>{n.r($),n.d($,{plugin:()=>ha});var y=n(7238),O=n(55294),V=n(82378),k=n(82897),e=n(68404),F=n(41818);const C=['{job="default/prometheus"}'],T=["job","app","k8s_app"],R=5,D=[{title:"Log pipeline",expression:'{job="mysql"} |= "metrics" | logfmt | duration > 10s',label:'This query targets the MySQL job, keeps logs that contain the substring "metrics", and then parses and filters the logs further.'},{title:"Count over time",expression:'count_over_time({job="mysql"}[5m])',label:"This query counts all the log lines within the last five minutes for the MySQL job."},{title:"Rate",expression:'rate(({job="mysql"} |= "error" != "timeout")[10s])',label:"This query gets the per-second rate of all non-timeout errors within the last ten seconds for the MySQL job."},{title:"Aggregate, count, and group",expression:'sum(count_over_time({job="mysql"}[5m])) by (level)',label:"Get the count of logs during the last five minutes, grouping by level."}];class M extends e.PureComponent{constructor(){super(...arguments),this.state={userExamples:[]},this.checkUserLabels=async()=>{const t=this.props.datasource?.languageProvider;if(t.started){const s=t.getLabelKeys()||[],l=T.find(r=>s.includes(r));if(l){const r=await t.getLabelValues(l),i=(0,k.shuffle)(r).slice(0,R).map(c=>`{${l}="${c}"}`);this.setState({userExamples:i})}}else this.scheduleUserLabelChecking()}}componentDidMount(){this.scheduleUserLabelChecking(),(0,F.ff)("grafana_loki_cheatsheet_opened",{})}componentWillUnmount(){clearTimeout(this.userLabelTimer)}scheduleUserLabelChecking(){this.userLabelTimer=setTimeout(this.checkUserLabels,1e3)}renderExpression(t){const{onClickExample:s}=this.props,l=r=>{s(r),(0,F.ff)("grafana_loki_cheatsheet_example_clicked",{})};return e.createElement("button",{type:"button",className:"cheat-sheet-item__example",key:t,onClick:r=>l({refId:"A",expr:t})},e.createElement("code",null,t))}render(){const{userExamples:t}=this.state,s=t.length>0;return e.createElement("div",null,e.createElement("h2",null,"Loki Cheat Sheet"),e.createElement("div",{className:"cheat-sheet-item"},e.createElement("div",{className:"cheat-sheet-item__title"},"See your logs"),e.createElement("div",{className:"cheat-sheet-item__label"},"Start by selecting a log stream from the Label browser, or alternatively you can write a stream selector into the query field."),s?e.createElement("div",null,e.createElement("div",{className:"cheat-sheet-item__label"},"Here are some example streams from your logs:"),t.map(l=>this.renderExpression(l))):e.createElement("div",null,e.createElement("div",{className:"cheat-sheet-item__label"},"Here is an example of a log stream:"),this.renderExpression(C[0]))),e.createElement("div",{className:"cheat-sheet-item"},e.createElement("div",{className:"cheat-sheet-item__title"},"Combine stream selectors"),this.renderExpression('{app="cassandra",namespace="prod"}'),e.createElement("div",{className:"cheat-sheet-item__label"},"Returns all log lines from streams that have both labels.")),e.createElement("div",{className:"cheat-sheet-item"},e.createElement("div",{className:"cheat-sheet-item__title"},"Filtering for search terms."),this.renderExpression('{app="cassandra"} |~ "(duration|latency)s*(=|is|of)s*[d.]+"'),this.renderExpression('{app="cassandra"} |= "exact match"'),this.renderExpression('{app="cassandra"} != "do not match"'),e.createElement("div",{className:"cheat-sheet-item__label"},e.createElement("a",{href:"https://grafana.com/docs/loki/latest/logql/#log-pipeline",target:"logql"},"LogQL")," ","supports exact and regular expression filters.")),D.map(l=>e.createElement("div",{className:"cheat-sheet-item",key:l.expression},e.createElement("div",{className:"cheat-sheet-item__title"},l.title),this.renderExpression(l.expression),e.createElement("div",{className:"cheat-sheet-item__label"},l.label))))}}var p=n(40400),L=n(54291),P=n(49922),A=n(68183),Q=n(26418),Ue=n(98102),B=n(31403),$e=n(92611),Ve=n(61458),G=n(58079),ye=n(89290),v=n(9892),W=n(72648),be=n(35029),Le=n(61744),Ae=n(59796),We=n(75478),ze=n(27303),le=n(64353),ne=n(85951),je=n(46967),Ge=n(52081),re=n(31439);const oe=1e3,ie=1e4,Ke=4,ce="{}";function z(a){const t=[];for(const s of a)if(s.selected&&s.values&&s.values.length>0){const l=s.values.filter(r=>r.selected).map(r=>r.name);l.length>1?t.push(`${s.name}=~"${l.map(re.tU).join("|")}"`):l.length===1&&t.push(`${s.name}="${(0,re.U9)(l[0])}"`)}return["{",t.join(","),"}"].join("")}function He(a,t,s){return a.map(l=>{const r=t[l.name];if(r){let i;if(l.name===s&&l.values)i=l.values;else{const c=new Set(l.values?.filter(o=>o.selected).map(o=>o.name)||[]);i=r.map(o=>({name:o,selected:c.has(o)}))}return{...l,loading:!1,values:i,facets:i.length}}return{...l,loading:!1,hidden:!r,values:void 0,facets:0}})}const Ze=a=>({wrapper:v.css`
    background-color: ${a.colors.background.secondary};
    padding: ${a.spacing(2)};
    width: 100%;
  `,list:v.css`
    margin-top: ${a.spacing(1)};
    display: flex;
    flex-wrap: wrap;
    max-height: 200px;
    overflow: auto;
  `,section:v.css`
    & + & {
      margin: ${a.spacing(2,0)};
    }
    position: relative;
  `,selector:v.css`
    font-family: ${a.typography.fontFamilyMonospace};
    margin-bottom: ${a.spacing(1)};
  `,status:v.css`
    margin-bottom: ${a.spacing(1)};
    color: ${a.colors.text.secondary};
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    transition: opacity 100ms linear;
    opacity: 0;
  `,statusShowing:v.css`
    opacity: 1;
  `,error:v.css`
    color: ${a.colors.error.main};
  `,valueList:v.css`
    margin-right: ${a.spacing(1)};
    resize: horizontal;
  `,valueListWrapper:v.css`
    border-left: 1px solid ${a.colors.border.medium};
    margin: ${a.spacing(1,0)};
    padding: ${a.spacing(1,0,1,1)};
  `,valueListArea:v.css`
    display: flex;
    flex-wrap: wrap;
    margin-top: ${a.spacing(1)};
  `,valueTitle:v.css`
    margin-left: -${a.spacing(.5)};
    margin-bottom: ${a.spacing(1)};
  `,validationStatus:v.css`
    padding: ${a.spacing(.5)};
    margin-bottom: ${a.spacing(1)};
    color: ${a.colors.text.maxContrast};
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  `});class Ye extends e.Component{constructor(){super(...arguments),this.state={labels:[],searchTerm:"",status:"Ready",error:"",validationStatus:""},this.onChangeSearch=t=>{this.setState({searchTerm:t.target.value})},this.onClickRunLogsQuery=()=>{(0,F.ff)("grafana_loki_label_browser_closed",{app:this.props.app,closeType:"showLogsButton"});const t=z(this.state.labels);this.props.onChange(t)},this.onClickRunMetricsQuery=()=>{(0,F.ff)("grafana_loki_label_browser_closed",{app:this.props.app,closeType:"showLogsRateButton"});const s=`rate(${z(this.state.labels)}[$__interval])`;this.props.onChange(s)},this.onClickClear=()=>{this.setState(t=>({labels:t.labels.map(l=>({...l,values:void 0,selected:!1,loading:!1,hidden:!1,facets:void 0})),searchTerm:"",status:"",error:"",validationStatus:""})),this.props.deleteLastUsedLabels()},this.onClickLabel=(t,s,l)=>{const r=this.state.labels.find(o=>o.name===t);if(!r)return;const i=!r.selected;let c={selected:i};if(r.values&&!i){const o=r.values.map(m=>({...m,selected:!1}));c={...c,facets:0,values:o}}this.setState({searchTerm:""}),this.updateLabelState(t,c,"",()=>this.doFacettingForLabel(t))},this.onClickValue=(t,s,l)=>{const r=this.state.labels.find(c=>c.name===t);if(!r||!r.values)return;this.setState({searchTerm:""});const i=r.values.map(c=>({...c,selected:c.name===s?!c.selected:c.selected}));this.updateLabelState(t,{values:i},"",()=>this.doFacetting(t))},this.onClickValidate=()=>{const t=z(this.state.labels);this.validateSelector(t)},this.doFacetting=t=>{const s=z(this.state.labels);if(s===ce){const l=this.state.labels.map(r=>({...r,facets:0,values:void 0,hidden:!1}));this.setState({labels:l},()=>{this.state.labels.forEach(r=>r.selected&&this.fetchValues(r.name,s))})}else this.fetchSeries(s,t)}}updateLabelState(t,s,l="",r){this.setState(i=>{const c=i.labels.map(m=>m.name===t?{...m,...s}:m),o=l?"":i.error;return{labels:c,status:l,error:o,validationStatus:""}},r)}componentDidMount(){const{languageProvider:t,autoSelect:s=Ke,lastUsedLabels:l}=this.props;if(t){const r=l;t.start().then(()=>{let i=t.getLabelKeys();if(i.length>oe){const o=`Too many labels found (showing only ${oe} of ${i.length})`;i=i.slice(0,oe),this.setState({error:o})}const c=i.map((o,m,g)=>({name:o,selected:g.length<=s&&r.length===0||r.includes(o),loading:!1}));this.setState({labels:c},()=>{this.state.labels.forEach(o=>{o.selected&&this.fetchValues(o.name,ce)})})})}}doFacettingForLabel(t){const s=this.state.labels.find(r=>r.name===t);if(!s)return;const l=this.state.labels.filter(r=>r.selected).map(r=>r.name);this.props.storeLastUsedLabels(l),s.selected?s.values||this.fetchValues(t,z(this.state.labels)):this.doFacetting()}async fetchValues(t,s){const{languageProvider:l}=this.props;this.updateLabelState(t,{loading:!0},`Fetching values for ${t}`);try{let r=await l.getLabelValues(t);if(s!==z(this.state.labels)){this.updateLabelState(t,{loading:!1},"");return}if(r.length>ie){const c=`Too many values for ${t} (showing only ${ie} of ${r.length})`;r=r.slice(0,ie),this.setState({error:c})}const i=r.map(c=>({name:c}));this.updateLabelState(t,{values:i,loading:!1})}catch(r){console.error(r)}}async fetchSeries(t,s){const{languageProvider:l}=this.props;s&&this.updateLabelState(s,{loading:!0},`Loading labels for ${t}`);try{const r=await l.fetchSeriesLabels(t,!0);if(t!==z(this.state.labels)){s&&this.updateLabelState(s,{loading:!1});return}if(Object.keys(r).length===0){this.setState({error:`Empty results, no matching label for ${t}`});return}const i=He(this.state.labels,r,s);this.setState({labels:i,error:""}),s&&this.updateLabelState(s,{loading:!1})}catch(r){console.error(r)}}async validateSelector(t){const{languageProvider:s}=this.props;this.setState({validationStatus:`Validating selector ${t}`,error:""});const l=await s.fetchSeries(t);this.setState({validationStatus:`Selector is valid (${l.length} streams found)`})}render(){const{theme:t}=this.props,{labels:s,searchTerm:l,status:r,error:i,validationStatus:c}=this.state;if(s.length===0)return e.createElement(Le.u,{text:"Loading labels..."});const o=Ze(t),m=z(this.state.labels),g=m===ce;let h=s.filter(d=>d.selected&&d.values);return l?h=h.map(d=>{const b=d.values.filter(x=>{if(x.selected)return x.highlightParts=void 0,!0;const S=(0,ze.C)(x.name.toLowerCase(),l.toLowerCase());return S.found?(x.highlightParts=S.ranges,x.order=S.distance,!0):!1});return{...d,values:(0,k.sortBy)(b,x=>x.selected?-1/0:x.order)}}):h=this.state.labels.filter(d=>d.selected&&d.values).map(d=>({...d,values:d?.values?d.values.map(b=>({...b,highlightParts:void 0})):[]})),e.createElement("div",{className:o.wrapper},e.createElement("div",{className:o.section},e.createElement(le._,{description:"Which labels would you like to consider for your search?"},"1. Select labels to search in"),e.createElement("div",{className:o.list},s.map(d=>e.createElement(ne._,{key:d.name,name:d.name,loading:d.loading,active:d.selected,hidden:d.hidden,facets:d.facets,onClick:this.onClickLabel})))),e.createElement("div",{className:o.section},e.createElement(le._,{description:"Choose the label values that you would like to use for the query. Use the search field to find values across selected labels."},"2. Find values for the selected labels"),e.createElement("div",null,e.createElement(je.I,{onChange:this.onChangeSearch,"aria-label":"Filter expression for values",value:l,placeholder:"Enter a label value"})),e.createElement("div",{className:o.valueListArea},h.map(d=>e.createElement("div",{role:"list",key:d.name,className:o.valueListWrapper},e.createElement("div",{className:o.valueTitle,"aria-label":`Values for ${d.name}`},e.createElement(ne._,{name:d.name,loading:d.loading,active:d.selected,hidden:d.hidden,facets:d.facets||d.values?.length,onClick:this.onClickLabel})),e.createElement(We.t7,{height:200,itemCount:d.values?.length||0,itemSize:28,itemKey:b=>d.values[b].name,width:200,className:o.valueList},({index:b,style:x})=>{const S=d.values?.[b];return S?e.createElement("div",{style:x},e.createElement(ne._,{name:d.name,value:S?.name,active:S?.selected,highlightParts:S?.highlightParts,onClick:this.onClickValue,searchTerm:l})):null}))))),e.createElement("div",{className:o.section},e.createElement(le._,null,"3. Resulting selector"),e.createElement("div",{"aria-label":"selector",className:o.selector},m),c&&e.createElement("div",{className:o.validationStatus},c),e.createElement("div",{className:(0,v.cx)(o.status,(r||i)&&o.statusShowing)},e.createElement("span",{className:i?o.error:""},i||r)),e.createElement(Ge.Lh,null,e.createElement(B.zx,{"aria-label":"Use selector as logs button",disabled:g,onClick:this.onClickRunLogsQuery},"Show logs"),e.createElement(B.zx,{"aria-label":"Use selector as metrics button",variant:"secondary",disabled:g,onClick:this.onClickRunMetricsQuery},"Show logs rate"),e.createElement(B.zx,{"aria-label":"Validate submit button",variant:"secondary",disabled:g,onClick:this.onClickValidate},"Validate selector"),e.createElement(B.zx,{"aria-label":"Selector clear button",variant:"secondary",onClick:this.onClickClear},"Clear"))))}}const Xe=(0,W.HE)(Ye),Je=a=>{const{isOpen:t,onClose:s,datasource:l,app:r}=a,[i,c]=(0,e.useState)(!1),[o,m]=(0,e.useState)(!1),g="grafana.datasources.loki.browser.labels",h=(0,W.wW)(qe);(0,e.useEffect)(()=>{t&&l.languageProvider.fetchLabels().then(S=>{c(!0),m(S.length>0)})},[l,t]);const d=S=>{const{query:E,onChange:u,onRunQuery:f}=a,N={...E,expr:S};u(N),f()},b=S=>{d(S),s()},x=()=>{(0,F.ff)("grafana_loki_label_browser_closed",{app:r,closeType:"modalClose"}),s()};return e.createElement(be.u,{isOpen:t,title:"Label browser",onDismiss:x,className:h.modal},!i&&e.createElement(Le.u,{text:"Loading labels..."}),i&&!o&&e.createElement("p",null,"No labels found."),i&&o&&e.createElement(Ae.G,{storageKey:g,defaultValue:[]},(S,E,u)=>e.createElement(Xe,{languageProvider:l.languageProvider,onChange:b,lastUsedLabels:S,storeLastUsedLabels:E,deleteLastUsedLabels:u,app:r})))},qe=a=>({modal:v.css`
      width: 85vw;
      ${a.breakpoints.down("md")} {
        width: 100%;
      }
    `});var _e=n(62992),I=n(39682),K=n(21745),et=n(69311),H=n(63134),tt=n(81764),Z=n(53217),Y=n(91720),at=n(8373);function st({item:a,items:t,defaultOp:s,onChange:l,onDelete:r,onGetLabelNames:i,onGetLabelValues:c,invalidLabel:o,invalidValue:m}){const[g,h]=(0,e.useState)({}),d="You have conflicting label filters",b=(u=a.op)=>xe.find(f=>f.label===u)?.isMultiValue,x=u=>u?u.indexOf("|")>0?u.split("|"):[u]:[],S=()=>{const u=g.labelValues?[...g.labelValues]:[],f=x(a?.value).map(H.E);return(0,k.uniqBy)([...f,...u],"value")},E=(0,at.Zc)(a,t);return e.createElement("div",{"data-testid":"prometheus-dimensions-filter-item"},e.createElement(tt._,{error:d,invalid:E?!0:void 0},e.createElement(Q.InputGroup,null,e.createElement(Z.Ph,{placeholder:"Select label","aria-label":A.wl.components.QueryBuilder.labelSelect,inputId:"prometheus-dimensions-filter-item-key",width:"auto",value:a.label?(0,H.E)(a.label):null,allowCustomValue:!0,onOpenMenu:async()=>{h({isLoadingLabelNames:!0});const u=await i(a);h({labelNames:u,isLoadingLabelNames:void 0})},isLoading:g.isLoadingLabelNames,options:g.labelNames,onChange:u=>{u.label&&l({...a,op:a.op??s,label:u.label})},invalid:E||o}),e.createElement(Z.Ph,{"aria-label":A.wl.components.QueryBuilder.matchOperatorSelect,value:(0,H.E)(a.op??s),options:xe,width:"auto",onChange:u=>{u.value!=null&&l({...a,op:u.value,value:b(u.value)?a.value:x(a?.value)[0]})},invalid:E}),e.createElement(Z.Ph,{placeholder:"Select value","aria-label":A.wl.components.QueryBuilder.valueSelect,inputId:"prometheus-dimensions-filter-item-value",width:"auto",value:b()?x(a?.value).map(H.E):x(a?.value).map(H.E)[0],allowCustomValue:!0,onOpenMenu:async()=>{h({isLoadingLabelValues:!0});const u=await c(a);h({...g,labelValues:u,isLoadingLabelValues:void 0})},isMulti:b(),isLoading:g.isLoadingLabelValues,options:S(),onChange:u=>{if(u.value)l({...a,value:u.value,op:a.op??s});else{const f=u.map(N=>N.label).join("|");l({...a,value:f,op:a.op??s})}},invalid:E||m}),e.createElement(Q.AccessoryButton,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:r}))))}const xe=[Y.AI.equals,Y.AI.doesNotEqual,Y.AI.matchesRegex,Y.AI.doesNotMatchRegex],lt="Select at least 1 label filter (label and value)";function nt({labelsFilters:a,onChange:t,onGetLabelNames:s,onGetLabelValues:l,labelFilterRequired:r}){const i="=",[c,o]=(0,e.useState)([{op:i}]);(0,e.useEffect)(()=>{a.length>0?o(a):o([{op:i}])},[a]);const m=h=>{o(h);const d=h.filter(b=>b.label!=null&&b.value!=null);(0,k.isEqual)(d,a)||t(d)},g=c.some(h=>h.label&&h.value);return e.createElement(Q.EditorFieldGroup,null,e.createElement(Q.EditorField,{label:"Label filters",error:lt,invalid:r&&!g},e.createElement(Q.EditorList,{items:c,onChange:m,renderItem:(h,d,b)=>e.createElement(st,{item:h,items:c,defaultOp:i,onChange:d,onDelete:b,onGetLabelNames:s,onGetLabelValues:l,invalidLabel:r&&!h.label,invalidValue:r&&!h.value})})))}var Se=n(58439),rt=n(41285),Ce=n(19023),ot=n(73250),it=n(75765),q=n(45204),_=n(19370);const Me="Fetch all log lines matching label filters.",Ne=e.memo(({query:a})=>{const t=(0,K._)(a||"").query,s={grammar:_.xY,name:"lokiql"};return e.createElement(Q.Stack,{gap:0,direction:"column"},e.createElement(Se.B,{stepNumber:1,title:e.createElement(q.U,{query:`${I.y.renderLabels(t.labels)}`,lang:s})},Me),e.createElement(Ce.V,{stepNumber:2,queryModeller:I.y,query:t,lang:s}))});Ne.displayName="LokiQueryBuilderExplained";var ee=n(68668),ct=n(8180),ut=n(75215);const Qe=e.memo(({nestedQuery:a,index:t,datasource:s,onChange:l,onRemove:r,onRunQuery:i,showExplain:c})=>{const o=(0,W.wW)(mt);return e.createElement("div",{className:o.card},e.createElement("div",{className:o.header},e.createElement("div",{className:o.name},"Operator"),e.createElement(Z.Ph,{"aria-label":"Select operator",width:"auto",options:dt,value:(0,H.E)(a.operator),onChange:m=>{l(t,{...a,operator:m.value})}}),e.createElement("div",{className:o.name},"Vector matches"),e.createElement("div",{className:o.vectorMatchWrapper},e.createElement(Z.Ph,{width:"auto",value:a.vectorMatchesType||"on",allowCustomValue:!0,options:[{value:"on",label:"on"},{value:"ignoring",label:"ignoring"}],onChange:m=>{l(t,{...a,vectorMatchesType:m.value})}}),e.createElement(ee.H,{className:o.vectorMatchInput,minWidth:20,defaultValue:a.vectorMatches,onCommitChange:m=>{l(t,{...a,vectorMatches:m.currentTarget.value,vectorMatchesType:a.vectorMatchesType||"on"})}})),e.createElement(Q.FlexItem,{grow:1}),e.createElement(ct.h,{ariaLabel:"Remove nested query",name:"times",size:"sm",onClick:()=>r(t)})),e.createElement("div",{className:o.body},e.createElement(Q.EditorRows,null,e.createElement(ue,{showExplain:c,query:a.query,datasource:s,onRunQuery:i,onChange:m=>{l(t,{...a,query:m})}}))))}),dt=ut.i.map(a=>({label:a.sign,value:a.sign}));Qe.displayName="NestedQuery";const mt=a=>({card:(0,v.css)({label:"card",display:"flex",flexDirection:"column",gap:a.spacing(.5)}),header:(0,v.css)({label:"header",padding:a.spacing(.5,.5,.5,1),gap:a.spacing(1),display:"flex",alignItems:"center"}),name:(0,v.css)({label:"name",whiteSpace:"nowrap"}),body:(0,v.css)({label:"body",paddingLeft:a.spacing(2)}),vectorMatchInput:(0,v.css)({label:"vectorMatchInput",marginLeft:-1}),vectorMatchWrapper:(0,v.css)({label:"vectorMatchWrapper",display:"flex"})});function gt({query:a,datasource:t,onChange:s,onRunQuery:l,showExplain:r}){const i=a.binaryQueries??[],c=(m,g)=>{const h=[...i];h.splice(m,1,g),s({...a,binaryQueries:h})},o=m=>{const g=[...i.slice(0,m),...i.slice(m+1)];s({...a,binaryQueries:g})};return e.createElement(Q.Stack,{direction:"column",gap:1},i.map((m,g)=>e.createElement(Qe,{key:g.toString(),nestedQuery:m,index:g,onChange:c,datasource:t,onRemove:o,onRunQuery:l,showExplain:r})))}const ue=e.memo(({datasource:a,query:t,onChange:s,onRunQuery:l,showExplain:r})=>{const[i,c]=(0,e.useState)(),[o,m]=(0,e.useState)(void 0),g=E=>{s({...t,labels:E})},h=async E=>{const u=await E;return[...a.getVariables(),...u].map(f=>({label:f,value:f}))},d=async E=>{const u=t.labels.filter(j=>j!==E);if(u.length===0)return await a.languageProvider.fetchLabels();const f=I.y.renderLabels(u),N=await a.languageProvider.fetchSeriesLabels(f),ae=u.map(j=>j.label);return Object.keys(N).filter(j=>!ae.includes(j)).sort()},b=async E=>{if(!E.label)return[];let u;const f=t.labels.filter(N=>N!==E);if(f.length===0)u=await a.languageProvider.fetchLabelValues(E.label);else{const N=I.y.renderLabels(f);u=(await a.languageProvider.fetchSeriesLabels(N))[a.interpolateString(E.label)]}return u?u.map(N=>(0,re.Hk)(N,E.op)):[]},x=(0,e.useMemo)(()=>{const{labels:E,operations:u}=t;return!E.length&&u.length?!(u.length===1&&u[0].id===Y.B5.LineContains&&u[0].params[0]===""):!1},[t]);(0,e.useEffect)(()=>{(async()=>{const u={expr:I.y.renderQuery(t),refId:"data-samples"},N={series:await a.getDataSamples(u),state:P.Gu.Done,timeRange:(0,et.JK)()};c(N)})().catch(console.error)},[a,t]);const S={grammar:_.ZP,name:"logql"};return e.createElement("div",{"data-testid":pe.editor},e.createElement(Q.EditorRow,null,e.createElement(nt,{onGetLabelNames:E=>h(d(E)),onGetLabelValues:E=>h(b(E)),labelsFilters:t.labels,onChange:g,labelFilterRequired:x})),r&&e.createElement(Se.B,{stepNumber:1,title:e.createElement(q.U,{query:`${I.y.renderLabels(t.labels)}`,lang:S})},Me),e.createElement(ot.B,null,e.createElement(rt.P,{queryModeller:I.y,query:t,onChange:s,onRunQuery:l,datasource:a,highlightedOp:o}),e.createElement(it.L,{datasource:a,query:t,onChange:s,data:i,queryModeller:I.y,buildVisualQueryFromString:K._})),r&&e.createElement(Ce.V,{stepNumber:2,queryModeller:I.y,query:t,lang:S,onMouseEnter:E=>{m(E)},onMouseLeave:()=>{m(void 0)}}),t.binaryQueries&&t.binaryQueries.length>0&&e.createElement(gt,{query:t,datasource:a,onChange:s,onRunQuery:l,showExplain:r}))});ue.displayName="LokiQueryBuilder";function pt({query:a}){return e.createElement(Q.EditorRow,null,e.createElement(Q.EditorFieldGroup,null,e.createElement(q.U,{query:a,lang:{grammar:_.xY,name:"lokiql"}})))}function ht(a){const{query:t,onChange:s,onRunQuery:l,datasource:r,showExplain:i}=a,[c,o]=(0,e.useReducer)(Fe.reducer,{expr:t.expr,visQuery:t.expr===""?{labels:[],operations:[{id:"__line_contains",params:[""]}]}:void 0});(0,e.useEffect)(()=>{o(Et(t.expr))},[t.expr]);const m=g=>{const h=I.y.renderQuery(g);o(vt({visQuery:g,expr:h})),s({...a.query,expr:h})};return c.visQuery?e.createElement(e.Fragment,null,e.createElement(ue,{query:c.visQuery,datasource:r,onChange:m,onRunQuery:l,showExplain:i,"data-testid":pe.editor}),t.expr!==""&&e.createElement(pt,{query:t.expr})):null}const ft={expr:""},Fe=(0,_e.oM)({name:"loki-builder-container",initialState:ft,reducers:{visualQueryChange:(a,t)=>{a.expr=t.payload.expr,a.visQuery=t.payload.visQuery},exprChanged:(a,t)=>{if(!a.visQuery||a.expr!==t.payload){a.expr=t.payload;const s=(0,K._)(t.payload);a.visQuery=s.query}}}}),{visualQueryChange:vt,exprChanged:Et}=Fe.actions;var yt=n(37556),de=n(35645),bt=n(2594),Lt=n(38435),J=n(47138),xt=n(24666),me=n(89545);const Te=e.memo(({app:a,query:t,onChange:s,onRunQuery:l,maxLines:r,datasource:i,queryStats:c})=>{const[o,m]=(0,e.useState)(!0),g=u=>{s({...t,queryType:u}),l()},h=u=>{(0,F.ff)("grafana_loki_resolution_clicked",{app:a,resolution:u.value}),s({...t,resolution:u.value}),l()},d=u=>{const f=u.currentTarget.value;if(!(0,yt.jO)(f)){m(!1);return}m(!0),s({...t,splitDuration:f}),l()},b=u=>{s({...t,legendFormat:u.currentTarget.value}),l()};function x(u){const f=(0,J.Wz)(u.currentTarget.value);t.maxLines!==f&&(s({...t,maxLines:f}),l())}let S=t.queryType??(t.instant?me.EM.Instant:me.EM.Range),E=(0,xt.rE)(t.expr);return e.createElement(Q.EditorRow,null,e.createElement(Lt.d,{title:"Options",collapsedInfo:St(t,S,E,r),queryStats:c},e.createElement(Q.EditorField,{label:"Legend",tooltip:"Series name override or template. Ex. {{hostname}} will be replaced with label value for hostname."},e.createElement(ee.H,{placeholder:"{{label}}",id:"loki-query-editor-legend-format",type:"string",minWidth:14,defaultValue:t.legendFormat,onCommitChange:b})),e.createElement(Q.EditorField,{label:"Type"},e.createElement(bt.S,{options:J.uG,value:S,onChange:g})),E&&e.createElement(Q.EditorField,{label:"Line limit",tooltip:"Upper limit for number of log lines returned by query."},e.createElement(ee.H,{className:"width-4",placeholder:r.toString(),type:"number",min:0,defaultValue:t.maxLines?.toString()??"",onCommitChange:x})),e.createElement(Q.EditorField,{label:"Resolution"},e.createElement(Z.Ph,{isSearchable:!1,onChange:h,options:J.oZ,value:t.resolution||1,"aria-label":"Select resolution"})),de.v.featureToggles.lokiQuerySplittingConfig&&de.v.featureToggles.lokiQuerySplitting&&e.createElement(Q.EditorField,{label:"Split Duration",tooltip:"Defines the duration of a single query when query splitting is enabled."},e.createElement(ee.H,{minWidth:14,type:"string",min:0,defaultValue:t.splitDuration??"1d",onCommitChange:d,invalid:!o}))))});function St(a,t,s,l){const r=J.uG.find(o=>o.value===t),i=J.oZ.find(o=>o.value===(a.resolution??1)),c=[];return a.legendFormat&&c.push(`Legend: ${a.legendFormat}`),a.resolution&&c.push(`Resolution: ${i?.label}`),c.push(`Type: ${r?.label}`),s&&c.push(`Line limit: ${a.maxLines??l}`),c}Te.displayName="LokiQueryBuilderOptions";var Re=n(91159),Ct=n(46519);async function De(a,t){if(!t)return;const s=await a.getQueryStats(t);return Object.values(s).every(l=>l===0)?void 0:s}function Pe(a,t){return(0,Ct.v9)(a)?a.isSame(t):a===t}function Mt(a,t,s,l){return a!==t?!0:!(Pe(s.raw.from,l?.raw.from)&&Pe(s.raw.to,l?.raw.to))}function Nt({query:a,datasource:t,range:s,onRunQuery:l,onChange:r,data:i,app:c,showExplain:o,history:m,setQueryStats:g}){const h=(0,W.wW)(Qt);return e.createElement("div",{className:h.wrapper},e.createElement(Re.n,{datasource:t,query:a,range:s,onRunQuery:l,onChange:r,history:m,data:i,app:c,"data-testid":pe.editor,onQueryType:async d=>{const b=await De(t,d);g(b)}}),o&&e.createElement(Ne,{query:a.expr}))}const Qt=a=>({wrapper:v.css`
      max-width: 100%;
      .gf-form {
        margin-bottom: 0.5;
      }
    `});var Ft=n(2352),Tt=n(99822),ge=n(72948);const Rt=a=>{const{pattern:t,onPatternSelect:s,hasNewQueryOption:l,hasPreviousQuery:r,selectedPatternName:i,setSelectedPatternName:c}=a,o=(0,W.wW)(Dt),m={grammar:_.ZP,name:"logql"};return e.createElement(ge.Z,{className:o.card},e.createElement(ge.Z.Heading,null,t.name),e.createElement("div",{className:o.rawQueryContainer},e.createElement(q.U,{query:I.y.renderQuery({labels:[],operations:t.operations}),lang:m,className:o.rawQuery})),e.createElement(ge.Z.Actions,null,i!==t.name?e.createElement(B.zx,{size:"sm",onClick:()=>{r?c(t.name):s(t)}},"Use this query"):e.createElement(e.Fragment,null,e.createElement("div",{className:o.spacing},`If you would like to use this query, ${l?"you can either replace your current query or create a new query":"your current query will be replaced"}.`),e.createElement(B.zx,{size:"sm",fill:"outline",onClick:()=>c(null)},"Back"),e.createElement(B.zx,{size:"sm",onClick:()=>{s(t)}},"Replace query"),l&&e.createElement(B.zx,{size:"sm",onClick:()=>{s(t,!0)}},"Create new query"))))},Dt=a=>({card:v.css`
      width: 49.5%;
      display: flex;
      flex-direction: column;
    `,rawQueryContainer:v.css`
      flex-grow: 1;
    `,rawQuery:v.css`
      background-color: ${a.colors.background.primary};
      padding: ${a.spacing(1)};
      margin-top: ${a.spacing(1)};
    `,spacing:v.css`
      margin-bottom: ${a.spacing(1)};
    `}),Pt=a=>{const{isOpen:t,onClose:s,onChange:l,onAddQuery:r,query:i,queries:c,app:o}=a,[m,g]=(0,e.useState)([]),[h,d]=(0,e.useState)(null),b=(0,W.wW)(wt),x=!!r,S=(0,e.useMemo)(()=>(0,K._)(i.expr).query.operations.length>0,[i.expr]),E=(u,f=!1)=>{const N=(0,K._)(f?"":i.expr);(0,F.ff)("grafana_loki_query_patterns_selected",{version:"v2",app:o??"",editorMode:i.editorMode,selectedPattern:u.name,preSelectedOperationsCount:N.query.operations.length,preSelectedLabelsCount:N.query.labels.length,createNewQuery:x&&f}),N.query.operations=u.operations,x&&f?r({...i,refId:(0,Tt.Hs)(c??[i]),expr:I.y.renderQuery(N.query)}):l({...i,expr:I.y.renderQuery(N.query)}),d(null),s()};return e.createElement(be.u,{isOpen:t,title:"Kick start your query",onDismiss:s,className:b.modal},e.createElement("div",{className:b.spacing},"Kick start your query by selecting one of these queries. You can then continue to complete your query."),Object.values(Y.Hv).map(u=>e.createElement(Ft.U,{key:u,label:`${(0,k.capitalize)(u)} query starters`,isOpen:m.includes(u),collapsible:!0,onToggle:()=>g(f=>f.includes(u)?f.filter(N=>N!==u):[...f,u])},e.createElement("div",{className:b.cardsContainer},I.y.getQueryPatterns().filter(f=>f.type===u).map(f=>e.createElement(Rt,{key:f.name,pattern:f,hasNewQueryOption:x,hasPreviousQuery:S,onPatternSelect:E,selectedPatternName:h,setSelectedPatternName:d}))))),e.createElement(B.zx,{variant:"secondary",onClick:s},"Close"))},wt=a=>({cardsContainer:v.css`
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: space-between;
    `,spacing:v.css`
      margin-bottom: ${a.spacing(1)};
    `,modal:v.css`
      width: 85vw;
      ${a.breakpoints.down("md")} {
        width: 100%;
      }
    `});var we=n(58379);const Oe="LokiQueryEditorModeDefault";function Ot(a,t,s){a.expr===""&&we.Z.set(Oe,t),s({...a,editorMode:t})}function kt(a){if(a!=null&&a!=="")return G.c.Code;switch(we.Z.get(Oe)){case"code":return G.c.Code;case"builder":default:return G.c.Builder}}function Bt(a){let t=a;return a.editorMode||(t={...a,editorMode:kt(a.expr)}),a.expr==null&&(t={...t,expr:""}),a.queryType==null&&(t={...t,queryType:me.EM.Range}),t}const pe={editor:"loki-editor"},ke=e.memo(a=>{const{onChange:t,onRunQuery:s,onAddQuery:l,data:r,app:i,queries:c,datasource:o}=a,[m,g]=(0,e.useState)(!1),[h,d]=(0,e.useState)(!1),[b,x]=(0,e.useState)(!1),[S,E]=(0,e.useState)(!1),[u,f]=(0,e.useState)(),{flag:N,setFlag:ae}=(0,ye.P5)(ye.iS),se=o.getTimeRange(),j=(0,L.Z)(se),w=Bt(a.query),Ie=(0,L.Z)(w.expr),fe=w.editorMode,fa=U=>{ae(U.currentTarget.checked)},va=(0,e.useCallback)(U=>{if((0,F.ff)("grafana_loki_editor_mode_clicked",{newEditor:U,previousEditor:w.editorMode??"",newQuery:!w.expr,app:i??""}),U===G.c.Builder&&(0,K._)(w.expr||"").errors.length){g(!0);return}Ot(w,U,t)},[t,w,i]);(0,e.useEffect)(()=>{x(!1)},[r]);const ve=U=>{(0,k.isEqual)(U,a.query)||x(!0),t(U)},Ea=()=>{(0,F.ff)("grafana_loki_label_browser_opened",{app:i}),E(U=>!U)};return(0,e.useEffect)(()=>{Mt(w.expr,Ie,se,j)&&(async()=>{const ya=await De(o,w.expr);f(ya)})()},[o,se,j,w,Ie,f]),e.createElement(e.Fragment,null,e.createElement(Ue.s,{isOpen:m,title:"Query parsing",body:"There were errors while trying to parse the query. Continuing to visual builder may lose some parts of the query.",confirmText:"Continue",onConfirm:()=>{t({...w,editorMode:G.c.Builder}),g(!1)},onDismiss:()=>g(!1)}),e.createElement(Pt,{isOpen:h,onClose:()=>d(!1),query:w,queries:c,app:i,onChange:t,onAddQuery:l}),e.createElement(Je,{isOpen:S,datasource:o,query:w,app:i,onClose:()=>E(!1),onChange:ve,onRunQuery:s}),e.createElement(Q.EditorHeader,null,e.createElement(Q.Stack,{gap:1},e.createElement(B.zx,{"aria-label":A.wl.components.QueryBuilder.queryPatterns,variant:"secondary",size:"sm",onClick:()=>{d(Ee=>!Ee);const U=(0,K._)(w.expr||"");(0,F.ff)("grafana_loki_query_patterns_opened",{version:"v2",app:i??"",editorMode:w.editorMode,preSelectedOperationsCount:U.query.operations.length,preSelectedLabelsCount:U.query.labels.length})}},"Kick start your query"),e.createElement(B.zx,{variant:"secondary",size:"sm",onClick:Ea,"data-testid":"label-browser-button"},"Label browser")),e.createElement(Ve.n,{label:"Explain query",value:N,onChange:fa}),e.createElement(Q.FlexItem,{grow:1}),i!==p.zj.Explore&&i!==p.zj.Correlations&&e.createElement(B.zx,{variant:b?"primary":"secondary",size:"sm",onClick:s,icon:r?.state===P.Gu.Loading?"fa fa-spinner":void 0,disabled:r?.state===P.Gu.Loading},"Run queries"),e.createElement($e.k,{mode:fe,onChange:va})),e.createElement(Q.Space,{v:.5}),e.createElement(Q.EditorRows,null,fe===G.c.Code&&e.createElement(Nt,{...a,query:w,onChange:ve,showExplain:N,setQueryStats:f}),fe===G.c.Builder&&e.createElement(ht,{datasource:a.datasource,query:w,onChange:ve,onRunQuery:a.onRunQuery,showExplain:N}),e.createElement(Te,{query:w,onChange:t,onRunQuery:s,app:i,maxLines:o.maxLines,datasource:o,queryStats:u})))});ke.displayName="LokiQueryEditor";function It(a){const{query:t,data:s,datasource:l,onChange:r,onRunQuery:i,history:c}=a;return e.createElement(Re.n,{datasource:l,query:t,onChange:r,onRunQuery:i,history:c,data:s,placeholder:"Enter a Loki query","data-testid":Ut.editor})}const Ut={editor:"loki-editor-cloud-alerting"};function $t(a){const{app:t}=a;switch(t){case p.zj.CloudAlerting:return e.createElement(It,{...a});default:return e.createElement(ke,{...a})}}const Vt=(0,e.memo)($t),ba={editor:"loki-editor"};var At=n(12006),Wt=n(12580),zt=n(64260),jt=n(89029),Gt=n(28151),Kt=n(9085),Ht=n.n(Kt),Zt=n(14582),Yt=n(19695),he=n(14835),Xt=n(41611);const{FormField:Jt}=he.LegacyForms,qt=a=>{const{derivedFields:t,className:s}=a,[l,r]=(0,e.useState)("");let i=[];return l&&t&&(i=ea(t,l)),e.createElement("div",{className:s},e.createElement(Jt,{labelWidth:12,label:"Debug log message",inputEl:e.createElement("textarea",{placeholder:"Paste an example log line here to test the regular expressions of your derived fields",className:Ht()("gf-form-input gf-form-textarea",v.css`
                width: 100%;
              `),value:l,onChange:c=>r(c.currentTarget.value)})}),!!i.length&&e.createElement(_t,{fields:i}))},_t=({fields:a})=>e.createElement("table",{className:"filter-table"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Name"),e.createElement("th",null,"Value"),e.createElement("th",null,"Url"))),e.createElement("tbody",null,a.map(t=>{let s=t.value;return t.error&&t.error instanceof Error?s=t.error.message:t.href&&(s=e.createElement("a",{href:t.href},s)),e.createElement("tr",{key:`${t.name}=${t.value}`},e.createElement("td",null,t.name),e.createElement("td",null,s),e.createElement("td",null,t.href?e.createElement("a",{href:t.href},t.href):""))})));function ea(a,t){return a.filter(s=>s.name&&s.matcherRegex).map(s=>{try{const l=t.match(s.matcherRegex),r=l&&l[1];let i=null;return s.url&&r&&(i=(0,Xt.a_)({field:{name:"",type:Zt.fS.string,values:new Yt.G([r]),config:{links:[{title:"",url:s.url}]}},rowIndex:0,range:{}})[0]),{name:s.name,value:r||"<no match>",href:i?i.href:void 0}}catch(l){return{name:s.name,error:l}}})}var ta=n(53117),aa=n(35919);const{Switch:sa,FormField:te}=he.LegacyForms,la=a=>({row:v.css`
    display: flex;
    align-items: baseline;
  `,nameField:v.css`
    flex: 2;
  `,regexField:v.css`
    flex: 3;
  `,urlField:v.css`
    flex: 1;
    margin-right: ${a.spacing(.5)};
  `,urlDisplayLabelField:v.css`
    flex: 1;
  `}),na=a=>{const{value:t,onChange:s,onDelete:l,suggestions:r,className:i}=a,c=(0,W.wW)(la),[o,m]=(0,e.useState)(!!t.datasourceUid),g=(0,L.Z)(t.datasourceUid);(0,e.useEffect)(()=>{!g&&t.datasourceUid&&!o&&m(!0),g&&!t.datasourceUid&&o&&m(!1)},[g,t.datasourceUid,o]);const h=d=>b=>{s({...t,[d]:b.currentTarget.value})};return e.createElement("div",{className:i,"data-testid":"derived-field"},e.createElement("div",{className:"gf-form"},e.createElement(te,{labelWidth:10,className:c.nameField,inputWidth:null,label:"Name",type:"text",value:t.name,onChange:h("name")}),e.createElement(te,{labelWidth:10,className:c.regexField,inputWidth:null,label:"Regex",type:"text",value:t.matcherRegex,onChange:h("matcherRegex"),tooltip:"Use to parse and capture some part of the log message. You can use the captured groups in the template."}),e.createElement(B.zx,{variant:"destructive",title:"Remove field",icon:"times",onClick:d=>{d.preventDefault(),l()}})),e.createElement("div",{className:"gf-form"},e.createElement(te,{labelWidth:10,label:o?"Query":"URL",inputEl:e.createElement(aa.v,{placeholder:o?"${__value.raw}":"http://example.com/${__value.raw}",value:t.url||"",onChange:d=>s({...t,url:d}),suggestions:r}),className:c.urlField}),e.createElement(te,{className:c.urlDisplayLabelField,labelWidth:10,inputWidth:null,label:"URL Label",type:"text",value:t.urlDisplayLabel,onChange:h("urlDisplayLabel"),tooltip:"Use to override the button label when this derived field is found in a log."})),e.createElement("div",{className:c.row},e.createElement(sa,{label:"Internal link",checked:o,onChange:()=>{o&&s({...t,datasourceUid:void 0}),m(!o)}}),o&&e.createElement(ta.q,{tracing:!0,onChange:d=>s({...t,datasourceUid:d.uid}),current:t.datasourceUid})))},ra=a=>({infoText:v.css`
    padding-bottom: ${a.spacing(2)};
    color: ${a.colors.text.secondary};
  `,derivedField:v.css`
    margin-bottom: ${a.spacing(1)};
  `}),oa=({value:a=[],onChange:t})=>{const s=(0,W.l4)(),l=ra(s),[r,i]=(0,e.useState)(!1);return e.createElement(e.Fragment,null,e.createElement("h3",{className:"page-heading"},"Derived fields"),e.createElement("div",{className:l.infoText},"Derived fields can be used to extract new fields from a log message and create a link from its value."),e.createElement("div",{className:"gf-form-group"},a.map((c,o)=>e.createElement(na,{className:l.derivedField,key:o,value:c,onChange:m=>{const g=[...a];g.splice(o,1,m),t(g)},onDelete:()=>{const m=[...a];m.splice(o,1),t(m)},suggestions:[{value:jt.W.valueRaw,label:"Raw value",documentation:"Exact string captured by the regular expression",origin:Gt.L8.Value}]})),e.createElement("div",null,e.createElement(B.zx,{variant:"secondary",className:v.css`
              margin-right: 10px;
            `,icon:"plus",onClick:c=>{c.preventDefault();const o=[...a,{name:"",matcherRegex:""}];t(o)}},"Add"),a.length>0&&e.createElement(B.zx,{variant:"secondary",type:"button",onClick:()=>i(!r)},r?"Hide example log message":"Show example log message"))),r&&e.createElement("div",{className:"gf-form-group"},e.createElement(qt,{className:v.css`
              margin-bottom: 10px;
            `,derivedFields:a})))},{FormField:ia}=he.LegacyForms,ca=a=>{const{value:t,onChange:s}=a;return e.createElement(ia,{label:"Maximum lines",labelWidth:11,inputWidth:20,inputEl:e.createElement("input",{type:"number",className:"gf-form-input width-8 gf-form-input--has-help-icon",value:t,onChange:l=>s(l.currentTarget.value),spellCheck:!1,placeholder:"1000"}),tooltip:e.createElement(e.Fragment,null,"Loki queries must contain a limit of the maximum number of lines returned (default: 1000). Increase this limit to have a bigger result set for ad-hoc analysis. Decrease this limit if your browser becomes sluggish when displaying the log results.")})},Be=a=>(t,s)=>({...t,jsonData:{...t.jsonData,[a]:s}}),ua=Be("maxLines"),da=Be("derivedFields"),ma=a=>{const{options:t,onOptionsChange:s}=a;return e.createElement(e.Fragment,null,e.createElement(At.E,{defaultUrl:"http://localhost:3100",dataSourceConfig:t,showAccessOptions:!1,onChange:s}),de.v.featureToggles.secureSocksDatasourceProxy&&e.createElement(Wt.i,{options:t,onOptionsChange:s}),e.createElement(zt.O,{options:t,onOptionsChange:s}),e.createElement("div",{className:"gf-form-group"},e.createElement("div",{className:"gf-form-inline"},e.createElement("div",{className:"gf-form"},e.createElement(ca,{value:t.jsonData.maxLines||"",onChange:l=>s(ua(t,l))})))),e.createElement(oa,{value:t.jsonData.derivedFields,onChange:l=>s(da(t,l))}))};var ga=n(28934),pa=n(32920);const ha=new y.hf(ga.KV).setQueryEditor(Vt).setConfigEditor(ma).setQueryEditorHelp(M);(0,V.N$)().subscribe(O.Pl,pa.u)},58439:(X,$,n)=>{n.d($,{B:()=>e});var y=n(9892),O=n(68404),V=n(41959),k=n(72648);function e({title:C,stepNumber:T,markdown:R,children:D}){const M=(0,k.wW)(F);return O.createElement("div",{className:M.box},T!==void 0&&O.createElement("div",{className:M.stepNumber},T),O.createElement("div",{className:M.boxInner},C&&O.createElement("div",{className:M.header},O.createElement("span",null,C)),O.createElement("div",{className:M.body},R&&O.createElement("div",{dangerouslySetInnerHTML:{__html:(0,V.a)(R)}}),D)))}const F=C=>({box:(0,y.css)({background:C.colors.background.secondary,padding:C.spacing(1),borderRadius:C.shape.borderRadius(),position:"relative"}),boxInner:(0,y.css)({marginLeft:C.spacing(4)}),stepNumber:(0,y.css)({fontWeight:C.typography.fontWeightMedium,background:C.colors.secondary.main,width:"20px",height:"20px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"10px",left:"11px",fontSize:C.typography.bodySmall.fontSize}),header:(0,y.css)({paddingBottom:C.spacing(.5),display:"flex",alignItems:"center",fontFamily:C.typography.fontFamilyMonospace}),body:(0,y.css)({color:C.colors.text.secondary,"p:last-child":{margin:0},a:{color:C.colors.text.link,textDecoration:"underline"}})})},19023:(X,$,n)=>{n.d($,{V:()=>k});var y=n(68404),O=n(58439),V=n(45204);function k({query:e,queryModeller:F,stepNumber:C,lang:T,onMouseEnter:R,onMouseLeave:D}){return y.createElement(y.Fragment,null,e.operations.map((M,p)=>{const L=F.getOperationDef(M.id);if(!L)return`Operation ${M.id} not found`;const P=L.renderer(M,L,"<expr>"),A=L.explainHandler?L.explainHandler(M,L):L.documentation??"no docs";return y.createElement("div",{key:p,onMouseEnter:()=>R?.(M,p),onMouseLeave:()=>D?.(M,p)},y.createElement(O.B,{stepNumber:p+C,title:y.createElement(V.U,{query:P,lang:T}),markdown:A}))}))}},45204:(X,$,n)=>{n.d($,{U:()=>F});var y=n(9892),O=n(57706),V=n.n(O),k=n(68404),e=n(72648);function F({query:T,lang:R,className:D}){const M=(0,e.l4)(),p=C(M),L=V().highlight(T,R.grammar,R.name);return k.createElement("div",{className:(0,y.cx)(p.editorField,"prism-syntax-highlight",D),"aria-label":"selector",dangerouslySetInnerHTML:{__html:L}})}const C=T=>({editorField:(0,y.css)({fontFamily:T.typography.fontFamilyMonospace,fontSize:T.typography.bodySmall.fontSize})})}}]);

//# sourceMappingURL=4712.373cf489d418bd8ea4f5.js.map