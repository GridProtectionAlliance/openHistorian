"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2212],{7521:(Z,M,s)=>{s.d(M,{A:()=>d});var e=s(74848),T=s(32196),h=s(13544),A=s(14578),E=s(42418),v=s(55852),D=s(76442);const i=(0,T.css)({textAlign:"center"}),p=(0,T.css)({maxWidth:"700px",margin:"0 auto"}),d=({title:l,buttonIcon:f,buttonLink:R,buttonTitle:x,buttonDisabled:S,onClick:H,proTip:K,proTipLink:g,proTipLinkTitle:B,proTipTarget:$,infoBox:y,infoBoxTitle:a})=>{const o=()=>(0,e.jsxs)(e.Fragment,{children:[K?(0,e.jsxs)("span",{children:[(0,e.jsx)(A.I,{name:"rocket"}),(0,e.jsxs)(e.Fragment,{children:[" ProTip: ",K," "]}),g&&(0,e.jsx)("a",{href:g,target:$,className:"text-link",children:B})]},"proTipFooter"):"",y?(0,e.jsx)(E.F,{severity:"info",title:a??"",className:p,children:(0,e.jsx)("div",{dangerouslySetInnerHTML:y})}):""]}),P=o()?"":(0,T.css)({marginBottom:"20px"}),C=R?v.z9:v.$n,N=(0,e.jsx)(C,{size:"lg",onClick:H,href:R,icon:f,className:P,"data-testid":h.Tp.components.CallToActionCard.buttonV2(x),disabled:S,children:x});return(0,e.jsx)(D.c,{className:i,message:l,footer:o(),callToActionElement:N})}},31084:(Z,M,s)=>{s.d(M,{Y:()=>i});var e=s(74848),T=s(96540),h=s(41053),A=s(10096),E=s(31678),v=s(37425),D=s(85927);const i=({teamId:p,roleOptions:n,disabled:d,roles:l,onApplyRoles:f,pendingRoles:R,apply:x=!1,maxWidth:S,width:H,isLoading:K})=>{const[{loading:g,value:B=l||[]},$]=(0,h.A)(async()=>{try{if(l)return l;if(x&&R?.length)return R;if(A.TP.hasPermission(E.AccessControlAction.ActionTeamsRolesList)&&p>0)return await(0,D.xN)(p)}catch(o){console.error("Error loading options",o)}return[]},[p,R,l]);(0,T.useEffect)(()=>{$()},[$]);const y=async o=>{x?f&&f(o):(await(0,D.G3)(o,p),await $())},a=A.TP.hasPermission(E.AccessControlAction.ActionTeamsRolesAdd)&&A.TP.hasPermission(E.AccessControlAction.ActionTeamsRolesRemove);return(0,e.jsx)(v.n,{apply:x,onRolesChange:y,roleOptions:n,appliedRoles:B,isLoading:g||K,disabled:d,basicRoleDisabled:!0,canUpdateRoles:a,maxWidth:S,width:H})}},54939:(Z,M,s)=>{s.d(M,{o:()=>i});var e=s(2543),T=s.n(e),h=s(96540),A=s(24705),E=s(10096),v=s(31678),D=s(85927);const i=n=>{const[d,l]=(0,h.useState)(n),{value:f=[]}=(0,A.A)(async()=>E.TP.licensedAccessControlEnabled()&&E.TP.hasPermission(v.AccessControlAction.ActionRolesList)?(0,D.RL)(d):Promise.resolve([]),[d]);return[{roleOptions:f},l]},p=n=>{const[d,l]=useState({});return useDeepCompareEffect(()=>{if(!contextSrv.licensedAccessControlEnabled()||!contextSrv.hasPermission(AccessControlAction.ActionRolesList))return;const f=Object.keys(d).map(x=>typeof x=="number"?x:parseInt(x,10)),R=difference(n,f);Promise.all(R.map(x=>fetchRoleOptions(x).then(S=>[x,S]))).then(x=>{l({...d,...Object.fromEntries(x)})})},[n]),d}},39745:(Z,M,s)=>{s.d(M,{A:()=>P,u:()=>o});var e=s(74848),T=s(32196),h=s(96540),A=s(97594),E=s(41987),v=s(13544),D=s(14110),i=s(32264),p=s(84167),n=s(88575),d=s(60029),l=s(20333),f=s(15648),R=s(29678),x=s(55852),S=s(3911),H=s(55014),K=s(59429),g=s(8484),B=s(74513),$=s(65615),y=s(2769);function a(){const U=B.Yj.map(c=>({value:c.code,label:c.name})).sort((c,G)=>c.value===B.wi?1:G.value===B.wi?-1:c.label.localeCompare(G.label));return[{value:"",label:(0,g.t)("common.locale.default","Default")},...U]}class o extends h.PureComponent{constructor(_){super(_),this.onSubmitForm=async c=>{if(c.preventDefault(),this.props.onConfirm?await this.props.onConfirm():!0){const{homeDashboardUID:V,theme:W,timezone:z,weekStart:J,language:X,queryHistory:Q,navbar:F}=this.state;await this.service.update({homeDashboardUID:V,theme:W,timezone:z,weekStart:J,language:X,queryHistory:Q,navbar:F}),window.location.reload()}},this.onThemeChanged=c=>{c&&(this.setState({theme:c.value}),c.value&&(0,y.K)(c.value,!0))},this.onTimeZoneChanged=c=>{typeof c=="string"&&this.setState({timezone:c})},this.onWeekStartChanged=c=>{this.setState({weekStart:c})},this.onHomeDashboardChanged=c=>{this.setState({homeDashboardUID:c})},this.onLanguageChanged=c=>{this.setState({language:c}),(0,D.rR)("grafana_preferences_language_changed",{toLanguage:c,preferenceType:this.props.preferenceType})},this.service=new $.W(_.resourceUri),this.state={theme:"",timezone:"",weekStart:"",language:"",queryHistory:{homeTab:""},navbar:{bookmarkUrls:[]}},this.themeOptions=(0,A.k)(i.$.featureToggles.extraThemes).map(c=>({value:c.id,label:N(c)})),this.themeOptions.unshift({value:"",label:(0,g.t)("shared-preferences.theme.default-label","Default")})}async componentDidMount(){const _=await this.service.load();this.setState({homeDashboardUID:_.homeDashboardUID,theme:_.theme,timezone:_.timezone,weekStart:_.weekStart,language:_.language,queryHistory:_.queryHistory,navbar:_.navbar})}render(){const{theme:_,timezone:c,weekStart:G,homeDashboardUID:V,language:W}=this.state,{disabled:z}=this.props,J=C(),X=a(),Q=this.themeOptions.find(F=>F.value===_)??this.themeOptions[0];return(0,e.jsxs)("form",{onSubmit:this.onSubmitForm,className:J.form,children:[(0,e.jsxs)(p.n,{label:(0,e.jsx)(g.x6,{i18nKey:"shared-preferences.title",children:"Preferences"}),disabled:z,children:[(0,e.jsx)(n.D,{label:(0,g.t)("shared-preferences.fields.theme-label","Interface theme"),children:(0,e.jsx)(H.G,{options:this.themeOptions,value:Q.value,onChange:this.onThemeChanged,id:"shared-preferences-theme-select"})}),(0,e.jsx)(n.D,{label:(0,e.jsx)(d.J,{htmlFor:"home-dashboard-select",children:(0,e.jsx)("span",{className:J.labelText,children:(0,e.jsx)(g.x6,{i18nKey:"shared-preferences.fields.home-dashboard-label",children:"Home Dashboard"})})}),"data-testid":"User preferences home dashboard drop down",children:(0,e.jsx)(K.b,{value:V,onChange:F=>this.onHomeDashboardChanged(F?.uid??""),defaultOptions:!0,isClearable:!0,placeholder:(0,g.t)("shared-preferences.fields.home-dashboard-placeholder","Default dashboard"),inputId:"home-dashboard-select"})}),(0,e.jsx)(n.D,{label:(0,g.t)("shared-dashboard.fields.timezone-label","Timezone"),"data-testid":v.Tp.components.TimeZonePicker.containerV2,children:(0,e.jsx)(l.U,{includeInternal:!0,value:c,onChange:this.onTimeZoneChanged,inputId:"shared-preferences-timezone-picker"})}),(0,e.jsx)(n.D,{label:(0,g.t)("shared-preferences.fields.week-start-label","Week start"),"data-testid":v.Tp.components.WeekStartPicker.containerV2,children:(0,e.jsx)(f.l,{value:G||"",onChange:this.onWeekStartChanged,inputId:"shared-preferences-week-start-picker"})}),(0,e.jsx)(n.D,{label:(0,e.jsxs)(d.J,{htmlFor:"locale-select",children:[(0,e.jsx)("span",{className:J.labelText,children:(0,e.jsx)(g.x6,{i18nKey:"shared-preferences.fields.locale-label",children:"Language"})}),(0,e.jsx)(R.y,{featureState:E.Ay.beta})]}),"data-testid":"User preferences language drop down",children:(0,e.jsx)(H.G,{value:X.find(F=>F.value===W)?.value||"",onChange:F=>this.onLanguageChanged(F?.value??""),options:X,placeholder:(0,g.t)("shared-preferences.fields.locale-placeholder","Choose language"),id:"locale-select"})})]}),(0,e.jsx)(x.$n,{type:"submit",variant:"primary","data-testid":v.Tp.components.UserProfile.preferencesSaveButton,children:(0,e.jsx)(g.x6,{i18nKey:"common.save",children:"Save"})})]})}}const P=o,C=(0,S.N)(()=>({labelText:(0,T.css)({marginRight:"6px"}),form:(0,T.css)({width:"100%",maxWidth:"600px"})}));function N(U){switch(U.id){case"dark":return(0,g.t)("shared.preferences.theme.dark-label","Dark");case"light":return(0,g.t)("shared.preferences.theme.light-label","Light");case"system":return(0,g.t)("shared.preferences.theme.system-label","System preference");default:return U.name}}},76323:(Z,M,s)=>{s.d(M,{J:()=>v});var e=s(74848),T=s(32196),h=s(96540),A=s(14110),E=s(40845);const v=({text:i="PRO",className:p,experimentId:n,eventVariant:d="",...l})=>{const f=(0,E.of)(D);return(0,h.useEffect)(()=>{n&&(0,A.Xp)(n,"test",d)},[n,d]),(0,e.jsx)("span",{className:(0,T.cx)(f.badge,p),...l,children:i})},D=i=>({badge:(0,T.css)`
      margin-left: ${i.spacing(1.25)};
      border-radius: ${i.shape.borderRadius(5)};
      background-color: ${i.colors.success.main};
      padding: ${i.spacing(.25,.75)};
      color: white; // use the same color for both themes
      font-weight: ${i.typography.fontWeightMedium};
      font-size: ${i.typography.pxToRem(10)};
    `})},35538:(Z,M,s)=>{s.d(M,{pL:()=>T,z5:()=>A});var e=s(32264);const T=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function h(){const E=e.$.licenseInfo?.trialExpiry;return!!(E&&E>0)}const A=()=>h()&&e.$.featureToggles.featureHighlights},92886:(Z,M,s)=>{s.r(M),s.d(M,{default:()=>Ae});var e=s(74848),T=s(25508),h=s(96540),A=s(54148),E=s(16817),v=s(33378),D=s(21780),i=s(32196),p=s(14110),n=s(40845),d=s(14578),l=s(55852);const f=({featureName:t,className:r,children:m,text:u,featureId:O,eventVariant:L="",size:I="md",...j})=>{const b=(0,n.of)(R,I);return(0,h.useEffect)(()=>{(0,p.Xp)(`feature-highlights-${O}`,"test",L)},[L,O]),(0,e.jsxs)("div",{className:(0,i.cx)(b.box,r),...j,children:[(0,e.jsx)(d.I,{name:"rocket",className:b.icon}),(0,e.jsxs)("div",{className:b.inner,children:[(0,e.jsxs)("p",{className:b.text,children:["You\u2019ve discovered a Pro feature! ",u||`Get the Grafana Pro plan to access ${t}.`]}),(0,e.jsx)(l.z9,{variant:"secondary",size:I,className:b.button,href:"https://grafana.com/profile/org/subscription",target:"__blank",rel:"noopener noreferrer",children:"Upgrade"})]})]})},R=(t,r)=>{const m=t.shape.borderRadius(2),u=r==="md"?"body":"bodySmall";return{box:(0,i.css)`
      display: flex;
      align-items: center;
      position: relative;
      border-radius: ${m};
      background: ${t.colors.success.transparent};
      padding: ${t.spacing(2)};
      color: ${t.colors.success.text};
      font-size: ${t.typography[u].fontSize};
      text-align: left;
      line-height: 16px;
      margin: ${t.spacing(0,"auto",3,"auto")};
      max-width: ${t.breakpoints.values.xxl}px;
      width: 100%;
    `,inner:(0,i.css)`
      display: flex;
      align-items: center;
      width: 100%;
      justify-content: space-between;
    `,text:(0,i.css)`
      margin: 0;
    `,button:(0,i.css)`
      background-color: ${t.colors.success.main};
      font-weight: ${t.typography.fontWeightLight};
      color: white;

      &:hover {
        background-color: ${t.colors.success.main};
      }

      &:focus-visible {
        box-shadow: none;
        color: ${t.colors.text.primary};
        outline: 2px solid ${t.colors.primary.main};
      }
    `,icon:(0,i.css)`
      margin: ${t.spacing(.5,1,.5,.5)};
    `}},x=({listItems:t,image:r,featureUrl:m,featureName:u,description:O,caption:L,action:I})=>{const j=(0,n.of)(S);return(0,e.jsxs)("div",{className:j.container,children:[(0,e.jsxs)("div",{className:j.content,children:[(0,e.jsxs)("h3",{className:j.title,children:["Get started with ",u]}),O&&(0,e.jsx)("h6",{className:j.description,children:O}),(0,e.jsx)("ul",{className:j.list,children:t.map((b,w)=>(0,e.jsxs)("li",{children:[(0,e.jsx)(d.I,{name:"check",size:"xl",className:j.icon})," ",b]},w))}),I?.link&&(0,e.jsx)(l.z9,{variant:"primary",href:I.link,children:I.text}),I?.onClick&&(0,e.jsx)(l.$n,{variant:"primary",onClick:I.onClick,children:I.text}),m&&(0,e.jsx)(l.z9,{fill:"text",href:m,className:j.link,target:"_blank",rel:"noreferrer noopener",children:"Learn more"})]}),(0,e.jsxs)("div",{className:j.media,children:[(0,e.jsx)("img",{src:g(r),alt:"Feature screenshot"}),L&&(0,e.jsx)("p",{className:j.caption,children:L})]})]})},S=t=>({container:(0,i.css)`
      display: flex;
      justify-content: space-between;
    `,content:(0,i.css)`
      width: 45%;
      margin-right: ${t.spacing(4)};
    `,media:(0,i.css)`
      width: 55%;

      img {
        width: 100%;
      }
    `,title:(0,i.css)`
      color: ${t.colors.text.maxContrast};
    `,description:(0,i.css)`
      color: ${t.colors.text.primary};
      font-weight: ${t.typography.fontWeightLight};
    `,list:(0,i.css)`
      list-style: none;
      margin: ${t.spacing(4,0,2,0)};

      li {
        display: flex;
        align-items: flex-start;
        color: ${t.colors.text.primary};
        padding: ${t.spacing(1,0)};
      }
    `,icon:(0,i.css)`
      color: ${t.colors.success.main};
      margin-right: ${t.spacing(1)};
    `,link:(0,i.css)`
      margin-left: ${t.spacing(2)};
    `,caption:(0,i.css)`
      font-weight: ${t.typography.fontWeightLight};
      margin: ${t.spacing(1,0,0)};
    `}),H=({featureName:t,description:r,featureUrl:m,image:u})=>{const O=useStyles2(K);return jsxs("div",{className:O.container,children:[jsxs("h3",{className:O.title,children:["Get started with ",t]}),r&&jsx("h6",{className:O.description,children:r}),jsx(LinkButton,{fill:"text",href:m,target:"_blank",rel:"noreferrer noopener",children:"Learn more"}),jsx("div",{className:O.media,children:jsx("img",{src:g(u),alt:"Feature screenshot"})})]})},K=t=>({container:css`
      overflow: auto;
      height: 100%;
    `,title:css`
      color: ${t.colors.text.maxContrast};
    `,description:css`
      color: ${t.colors.text.primary};
      font-weight: ${t.typography.fontWeightLight};
    `,media:css`
      width: 100%;
      margin-top: ${t.spacing(2)};

      img {
        width: 100%;
      }
    `}),g=t=>t.startsWith("http")?t:"/public/img/enterprise/highlights/"+t;var B=s(2913),$=s(17422),y=s(16233),a=s(31678),o=s(71468),P=s(56034),C=s(39268),N=s(14186),U=s(10354),_=s(9025),c=s(25469),G=s(7521),V=s(35538),W=s(33667);const z=t=>t.groups,J=(t,r)=>t.team.uid===r?t.team:null;function X(t){return{groups:z(t.team)}}const Q={loadTeamGroups:W.aK,addTeamGroup:W.It,removeTeamGroup:W.nC},F=(0,o.connect)(X,Q),ee="Sync LDAP, OAuth or SAML groups with your Grafana teams.";class oe extends h.PureComponent{constructor(r){super(r),this.onToggleAdding=()=>{this.setState({isAdding:!this.state.isAdding})},this.onNewGroupIdChanged=m=>{this.setState({newGroupId:m.target.value})},this.onAddGroup=m=>{m.preventDefault(),this.props.addTeamGroup(this.state.newGroupId),this.setState({isAdding:!1,newGroupId:""})},this.onRemoveGroup=m=>{this.props.removeTeamGroup(m.groupId)},this.state={isAdding:!1,newGroupId:""}}componentDidMount(){this.fetchTeamGroups()}async fetchTeamGroups(){this.props.loadTeamGroups()}isNewGroupValid(){return this.state.newGroupId.length>1}renderGroup(r){const{isReadOnly:m}=this.props;return(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:r.groupId}),(0,e.jsx)("td",{style:{width:"1%"},children:(0,e.jsx)(l.$n,{size:"sm",variant:"destructive",onClick:()=>this.onRemoveGroup(r),disabled:m,"aria-label":`Remove group ${r.groupId}`,children:(0,e.jsx)(d.I,{name:"times"})})})]},r.groupId)}render(){const{isAdding:r,newGroupId:m}=this.state,{groups:u,isReadOnly:O}=this.props,L=ie();return(0,e.jsxs)("div",{children:[(0,V.z5)()&&(0,e.jsx)(f,{featureId:"team-sync",eventVariant:"trial",featureName:"team sync",text:"Add a group to enable team sync for free during your trial of Grafana Pro."}),(0,e.jsxs)("div",{className:"page-action-bar",children:[(!(0,V.z5)()||u.length>0)&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("h3",{className:"page-sub-heading",children:"External group sync"}),(0,e.jsx)(P.m,{placement:"auto",content:ee,children:(0,e.jsx)(d.I,{className:(0,i.cx)(L.icon,"page-sub-heading-icon"),name:"question-circle"})})]}),(0,e.jsx)("div",{className:"page-action-bar__spacer"}),u.length>0&&(0,e.jsxs)(l.$n,{onClick:this.onToggleAdding,disabled:O,children:[(0,e.jsx)(d.I,{name:"plus"})," Add group"]})]}),(0,e.jsx)(_.a,{in:r,children:(0,e.jsxs)("div",{className:"cta-form",children:[(0,e.jsx)(c.J,{onClick:this.onToggleAdding}),(0,e.jsx)("form",{onSubmit:this.onAddGroup,children:(0,e.jsxs)(C.C,{children:[(0,e.jsx)(N.I,{label:"Add External Group",tooltip:"LDAP Group Example: cn=users,ou=groups,dc=grafana,dc=org.",children:(0,e.jsx)(U.p,{type:"text",id:"add-external-group",placeholder:"",value:m,onChange:this.onNewGroupIdChanged,disabled:O})}),(0,e.jsx)(l.$n,{type:"submit",disabled:O||!this.isNewGroupValid(),style:{marginLeft:4},children:"Add group"})]})})]})}),u.length===0&&!r&&((0,V.z5)()?(0,e.jsx)(se,{action:{onClick:this.onToggleAdding,text:"Add group"}}):(0,e.jsx)(G.A,{onClick:this.onToggleAdding,buttonIcon:"users-alt",title:"There are no external groups to sync with",buttonTitle:"Add group",proTip:ee,proTipLinkTitle:"Learn more",proTipLink:"https://grafana.com/docs/grafana/latest/setup-grafana/configure-security/configure-team-sync/",proTipTarget:"_blank",buttonDisabled:O})),u.length>0&&(0,e.jsx)("div",{className:"admin-list-table",children:(0,e.jsxs)("table",{className:"filter-table filter-table--hover form-inline",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:"External Group ID"}),(0,e.jsx)("th",{style:{width:"1%"}})]})}),(0,e.jsx)("tbody",{children:u.map(I=>this.renderGroup(I))})]})})]})}}const se=({action:t})=>{const r=(0,n.$j)();return(0,e.jsx)(x,{action:t,listItems:["Stop managing user access in two places - assign users to groups in SAML, LDAP or Oauth, and manage access at a Team level in Grafana","Update users\u2019 permissions immediately when you add or remove them from an LDAP group, with no need for them to sign out and back in"],image:`team-sync-${r.isLight?"light":"dark"}.png`,featureName:"team sync",featureUrl:"https://grafana.com/docs/grafana/latest/enterprise/team-sync",description:"Team Sync makes it easier for you to manage users\u2019 access in Grafana, by immediately updating each user\u2019s Grafana teams and permissions based on their single sign-on group membership, instead of when users sign in."})},re=(0,o.connect)(X,Q)(oe),ie=()=>({icon:(0,i.css)({opacity:.7,"&:hover":{opacity:1}})});var ce=s(5108);const le=t=>{const r=y.TP.hasPermissionInMetadata(a.AccessControlAction.ActionTeamsPermissionsWrite,t.team);return(0,e.jsx)(ce.x,{title:"",addPermissionTitle:"Add member",buttonLabel:"Add member",emptyLabel:"There are no members in this team or you do not have the permissions to list the current members.",resource:"teams",resourceId:t.team.id,canSetPermissions:r})};var de=s(49785),me=s(67061),he=s(84167),q=s(88575),ue=s(31084),ge=s(54939),pe=s(39745);const fe={updateTeam:W.n7},Ee=(0,o.connect)(null,fe)(({team:t,updateTeam:r})=>{const m=y.TP.hasPermissionInMetadata(a.AccessControlAction.ActionTeamsWrite,t),u=y.TP.user.orgId,[{roleOptions:O}]=(0,ge.o)(u),{handleSubmit:L,register:I,formState:{errors:j}}=(0,de.mN)({defaultValues:t}),b=y.TP.hasPermission(a.AccessControlAction.ActionTeamsRolesAdd)&&y.TP.hasPermission(a.AccessControlAction.ActionTeamsRolesRemove),w=y.TP.hasPermissionInMetadata(a.AccessControlAction.ActionTeamsRolesList,t)&&y.TP.hasPermission(a.AccessControlAction.ActionRolesList),Y=async k=>{r(k.name,k.email||"")};return(0,e.jsxs)(me.B,{direction:"column",gap:3,children:[(0,e.jsx)("form",{onSubmit:L(Y),style:{maxWidth:"600px"},children:(0,e.jsxs)(he.n,{label:"Team details",children:[(0,e.jsx)(q.D,{label:"Name",disabled:!m,required:!0,invalid:!!j.name,error:"Name is required",children:(0,e.jsx)(U.p,{...I("name",{required:!0}),id:"name-input"})}),y.TP.licensedAccessControlEnabled()&&w&&(0,e.jsx)(q.D,{label:"Role",children:(0,e.jsx)(ue.Y,{teamId:t.id,roleOptions:O,disabled:!b,maxWidth:"100%"})}),(0,e.jsx)(q.D,{label:"Email",description:"This is optional and is primarily used to set the team profile avatar (via gravatar service).",disabled:!m,children:(0,e.jsx)(U.p,{...I("email"),placeholder:"team@email.com",type:"email",id:"email-input"})}),(0,e.jsx)(l.$n,{type:"submit",disabled:!m,children:"Update"})]})}),(0,e.jsx)(pe.u,{resourceUri:`teams/${t.id}`,disabled:!m,preferenceType:"team"})]})});var Pe=s(78319),Te=(t=>(t.Members="members",t.Settings="settings",t.GroupSync="groupsync",t))(Te||{});const te=["members","settings","groupsync"],ve=(0,T.Mz)([t=>t.team,(t,r)=>r],(t,r)=>J(t,r)),xe=(0,T.Mz)([t=>t.navIndex,(t,r)=>r,(t,r,m)=>m],(t,r,m)=>{const u=(0,Pe.X)(r);return(0,$.tc)(t,`team-${r}-${m}`,u).main}),ae=(0,h.memo)(()=>{const t=(0,h.useRef)((0,v.a)("teamsync")),{uid:r="",page:m}=(0,A.g)(),u=(0,a.useSelector)(Y=>ve(Y,r));let O="members";(!u||!y.TP.hasPermissionInMetadata(a.AccessControlAction.ActionTeamsPermissionsRead,u))&&(O="settings");const L=m??O,I=(0,a.useSelector)(Y=>xe(Y,L,r)),j=(0,a.useDispatch)(),{loading:b}=(0,E.A)(async()=>j((0,W.eo)(r)),[r]),w=()=>{const Y=te.includes(L)?L:te[0],k=y.TP.hasPermissionInMetadata(a.AccessControlAction.ActionTeamsRead,u),ne=y.TP.hasPermissionInMetadata(a.AccessControlAction.ActionTeamsPermissionsRead,u),De=y.TP.hasPermissionInMetadata(a.AccessControlAction.ActionTeamsPermissionsWrite,u);switch(Y){case"members":return ne?(0,e.jsx)(le,{team:u}):null;case"settings":return k&&(0,e.jsx)(Ee,{team:u});case"groupsync":if(t.current){if(ne)return(0,e.jsx)(re,{isReadOnly:!De})}else if(B.Ay.featureToggles.featureHighlights)return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(f,{featureName:"team sync",featureId:"team-sync"}),(0,e.jsx)(se,{})]})}return null};return(0,e.jsx)(D.YW,{navId:"teams",pageNav:I,children:(0,e.jsx)(D.YW.Contents,{isLoading:b,children:u&&Object.keys(u).length!==0&&w()})})});ae.displayName="TeamPages";const Ae=ae},33667:(Z,M,s)=>{s.d(M,{Bu:()=>n,It:()=>B,To:()=>f,Vk:()=>S,aK:()=>g,eo:()=>l,n7:()=>K,nC:()=>$,nM:()=>R,yd:()=>x});var e=s(2543),T=s.n(e),h=s(17172),A=s(82467),E=s(10096),v=s(80714),D=s(31678),i=s(78319),p=s(34655);function n(a=!1){return async(o,P)=>{const{query:C,page:N,perPage:U,sort:_}=P().teams;if(!E.TP.hasPermission(D.AccessControlAction.ActionTeamsRead)){o((0,p.Q9)({teams:[],totalCount:0,page:1,perPage:U,noTeams:!0}));return}const c=await(0,h.AI)().get("/api/teams/search",(0,v.F)({query:C,page:N,perpage:U,sort:_}));let G=!1;if(a&&(G=c.teams.length===0),E.TP.licensedAccessControlEnabled()&&E.TP.hasPermission(D.AccessControlAction.ActionTeamsRolesList)){o((0,p.dJ)());const V=c?.teams.map(z=>z.id),W=await(0,h.AI)().post("/api/access-control/teams/roles/search",{teamIds:V});c.teams.forEach(z=>{z.roles=W?W[z.id]||[]:[]}),o((0,p.jE)())}o((0,p.Q9)({noTeams:G,...c}))}}const d=(0,e.debounce)(a=>a(n()),500);function l(a){return async o=>{const P=await(0,h.AI)().get(`/api/teams/${a}`,(0,v.F)());o((0,p.$T)(P)),o((0,A.Vz)((0,i.R)(P)))}}function f(a){return async o=>{await(0,h.AI)().delete(`/api/teams/${a}`),await E.TP.fetchUserPermissions(),o(n())}}function R(a){return async o=>{o((0,p.L5)(a)),d(o)}}function x(a){return async o=>{o((0,p.EC)(a)),o(n())}}function S({sortBy:a}){const o=a.length?`${a[0].id}-${a[0].desc?"desc":"asc"}`:void 0;return async P=>{P((0,p.$u)(o)),P(n())}}function H(){return async(a,o)=>{const P=o().team.team,C=await getBackendSrv().get(`/api/teams/${P.uid}/members`);a(teamMembersLoaded(C))}}function K(a,o){return async(P,C)=>{const N=C().team.team;await(0,h.AI)().put(`/api/teams/${N.uid}`,{name:a,email:o}),P(l(N.uid))}}function g(){return async(a,o)=>{const P=o().team.team,C=await(0,h.AI)().get(`/api/teams/${P.id}/groups`);a((0,p.tC)(C))}}function B(a){return async(o,P)=>{const C=P().team.team;await(0,h.AI)().post(`/api/teams/${C.id}/groups`,{groupId:a}),o(g())}}function $(a){return async(o,P)=>{const C=P().team.team;await(0,h.AI)().delete(`/api/teams/${C.id}/groups?groupId=${encodeURIComponent(a)}`),o(g())}}function y(a){return async o=>{await getBackendSrv().put(`/api/teams/${a.teamId}/members/${a.userId}`,{permission:a.permission}),o(H())}}},78319:(Z,M,s)=>{s.d(M,{R:()=>i,X:()=>p});var e=s(33378),T=s(76323),h=s(2913),A=s(16233),E=s(35538),v=s(31678);const D={avatarUrl:"public/img/user_profile.png",id:1,uid:"",name:"Loading",email:"loading",memberCount:0,permission:v.TeamPermissionLevel.Member,accessControl:{isEditor:!1},orgId:0,updated:""};function i(n){const d={img:n.avatarUrl,id:"team-"+n.uid,subTitle:"Manage members and settings",url:`org/teams/edit/${n.uid}`,text:n.name,children:[{active:!1,icon:"sliders-v-alt",id:`team-settings-${n.uid}`,text:"Settings",url:`org/teams/edit/${n.uid}/settings`}]};(n===D||A.TP.hasPermissionInMetadata(v.AccessControlAction.ActionTeamsPermissionsRead,n))&&d.children.unshift({active:!1,icon:"users-alt",id:`team-members-${n.uid}`,text:"Members",url:`org/teams/edit/${n.uid}/members`});const l={active:!1,icon:"sync",id:`team-groupsync-${n.uid}`,text:"External group sync",url:`org/teams/edit/${n.uid}/groupsync`},f=n===D;return(0,E.z5)()&&(l.tabSuffix=()=>(0,T.J)({experimentId:f?"":"feature-highlights-team-sync-badge",eventVariant:"trial"})),(0,e.a)("teamsync")?(f||A.TP.hasPermissionInMetadata(v.AccessControlAction.ActionTeamsPermissionsRead,n))&&d.children.push(l):h.Ay.featureToggles.featureHighlights&&d.children.push({...l,tabSuffix:()=>(0,T.J)({experimentId:f?"":"feature-highlights-team-sync-badge"})}),d}function p(n){const d=i(D);let l;for(const f of d.children)if(f.id.indexOf(n)>0){f.active=!0,l=f;break}return{main:d,node:l}}}}]);

//# sourceMappingURL=TeamPages.6936065da991ddfe49ae.js.map