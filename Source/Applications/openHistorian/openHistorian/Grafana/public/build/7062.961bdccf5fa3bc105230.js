"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7062],{73358:(e,t,n)=>{n.d(t,{C0:()=>i,Uv:()=>l,Xq:()=>o});n(68404);var r,a=n(3490),s=n(45916);let l;!function(e){e.ContactPoint="contact point",e.Template="template",e.MuteTiming="mute timing",e.AlertRule="alert rule",e.RootNotificationPolicy="root notification policy"}(l||(l={}));const o=e=>{let{resource:t}=e;return(0,s.jsxs)(a.Alert,{title:`This ${t} cannot be edited through the UI`,severity:"info",children:["This ",t," has been provisioned, that means it was created by config. Please contact your server admin to update this ",t,"."]})},i=()=>r||(r=(0,s.jsx)(a.Badge,{text:"Provisioned",color:"purple"}))},16905:(e,t,n)=>{n.d(t,{F:()=>u});var r,a,s,l=n(36636),o=(n(68404),n(8072)),i=n(3490),c=n(45916);const u=e=>{let{className:t,onFilterChange:n,defaultQueryString:l,queryString:u}=e;const p=(0,i.useStyles2)(d),m=r||(r=(0,c.jsx)(i.Icon,{name:"search"}));return(0,c.jsxs)("div",{className:t,children:[(0,c.jsx)(i.Label,{children:(0,c.jsxs)(o.Stack,{gap:.5,children:[a||(a=(0,c.jsx)("span",{children:"Search by label"})),(0,c.jsx)(i.Tooltip,{content:s||(s=(0,c.jsxs)("div",{children:["Filter alerts using label querying, ex:",(0,c.jsx)("pre",{children:'{severity="critical", instance=~"cluster-us-.+"}'})]})),children:(0,c.jsx)(i.Icon,{className:p.icon,name:"info-circle",size:"sm"})})]})}),(0,c.jsx)(i.Input,{placeholder:"Search",defaultValue:l,value:u,onChange:e=>{const t=e.target;n(t.value)},"data-testid":"search-query-input",prefix:m,className:p.inputWidth})]})},d=e=>({icon:l.css`
    margin-right: ${e.spacing(.5)};
  `,inputWidth:l.css`
    width: 340px;
    flex-grow: 0;
  `})},83039:(e,t,n)=>{n.d(t,{f:()=>B});var r=n(36636),a=n(68404),s=n(18745),l=n(42326),o=n(43215),i=n(90923),c=n(3490),u=n(58257),d=n(61959),p=n(47570),m=n(78567),h=n(82897),g=n(8072),x=n(83809),f=n(33899);var v,j,b,y=n(23906),S=n(9019),w=n(69357),R=n(45916);const C=e=>{let{alertId:t}=e;const[n,r]=(0,a.useState)(""),l=(0,a.useCallback)((e=>{r(e.currentTarget.value)}),[]),{loading:o,error:i,result:u=[]}=function(e){const t=(0,s.useDispatch)(),n=(0,f._)((e=>e.managedAlertStateHistory));return(0,a.useEffect)((()=>{t((0,x.Ms)(e))}),[t,e]),n}(t),d=(0,c.useStyles2)(q);if(o&&!i)return v||(v=(0,R.jsx)(c.LoadingPlaceholder,{text:"Loading history..."}));if(i&&!o)return(0,R.jsx)(c.Alert,{title:"Failed to fetch alert state history",children:i.message});const p=[{id:"state",label:"State",size:"max-content",renderCell:I},{id:"value",label:"",size:"auto",renderCell:k},{id:"timestamp",label:"Time",size:"max-content",renderCell:N}],m=Object.entries(function(e){const t=e.map((e=>{var t,n;const r=/{.*?}/g,a=null!==(t=null===(n=e.text.match(r))||void 0===n?void 0:n.at(-1))&&void 0!==t?t:"";return{id:String(e.id),state:e.newState,text:e.text.replace(a,""),data:e.data,timestamp:e.updated,stringifiedLabels:a}}));return(0,h.groupBy)(t,(e=>e.stringifiedLabels))}(u)).sort().filter((e=>{let[t]=e;return function(e,t){if(""===t)return!0;if(!t.startsWith("/")||!t.endsWith("/"))return e.includes(t);try{return new RegExp(t.slice(1,-1)).test(e)}catch(e){return!1}}(t,n)})).map((e=>{let[t,n]=e;const r=n.map((e=>({id:e.id,data:e})));return(0,R.jsxs)("div",{children:[(0,R.jsx)("header",{className:d.tableGroupKey,children:(0,R.jsx)("code",{children:t})}),(0,R.jsx)(S.t,{cols:p,items:r})]},t)}));return(0,R.jsxs)("div",{children:[(0,R.jsx)("nav",{children:(0,R.jsx)(c.Field,{label:j||(j=(0,R.jsx)(c.Label,{children:(0,R.jsxs)(g.Stack,{gap:.5,children:[(0,R.jsx)("span",{children:"Filter group"}),(0,R.jsx)(c.Tooltip,{content:(0,R.jsxs)("div",{children:["Filter each state history group either by exact match or a regular expression, ex:"," ",(0,R.jsx)("code",{children:"region=eu-west-1"})," or ",(0,R.jsx)("code",{children:"/region=us-.+/"})]}),children:(0,R.jsx)(c.Icon,{name:"info-circle",size:"sm"})})]})})),children:(0,R.jsx)(c.Input,{prefix:b||(b=(0,R.jsx)(c.Icon,{name:"search"})),onChange:l,placeholder:"Search"})})}),m]})};function k(e){var t,n;const r=null!==(t=null===(n=e.data.data)||void 0===n?void 0:n.evalMatches)&&void 0!==t?t:[];return(0,R.jsxs)(R.Fragment,{children:[e.data.text,(0,R.jsx)($,{children:r.map((e=>(0,R.jsx)(y.i,{labelKey:e.metric,value:String(e.value)},e.metric)))})]})}function I(e){return(0,R.jsx)(w.l,{state:e.data.state})}function N(e){return(0,R.jsx)("div",{className:_,children:e.data.timestamp&&(0,R.jsx)("span",{children:(0,o.dateTimeFormat)(e.data.timestamp)})})}const $=e=>{let{children:t}=e;const{wrapper:n}=(0,c.useStyles2)(q);return(0,R.jsx)("div",{className:n,children:t})},_=r.css`
  display: flex;
  align-items: flex-end;
  flex-direction: column;
`,q=e=>({wrapper:r.css`
    & > * {
      margin-right: ${e.spacing(1)};
    }
  `,tableGroupKey:r.css`
    margin-top: ${e.spacing(2)};
    margin-bottom: ${e.spacing(2)};
  `});var z,E,M=n(82139),F=n(85464),L=n(19462),D=n(39357),P=n(59940),U=n(86647);const B=e=>{var t,n;let{rule:r,rulesSource:h}=e;const g=(0,s.useDispatch)(),f=(0,l.TH)(),v=(0,u.iG)(),j=(0,c.useStyles2)(T),{namespace:b,group:y,rulerRule:S}=r,[w,k]=(0,a.useState)(),I=(0,U.Pc)(r.rulerRule)&&null!==(t=r.rulerRule.grafana_alert.id)&&void 0!==t?t:"",{StateHistoryModal:N,showStateHistoryModal:$}=function(e){var t;const[n,r]=(0,a.useState)(!1);return{StateHistoryModal:(0,a.useMemo)((()=>(0,R.jsx)(c.Modal,{isOpen:n,onDismiss:()=>r(!1),closeOnBackdropClick:!0,closeOnEscape:!0,title:"State history",children:t||(t=(0,R.jsx)(C,{alertId:e}))})),[e,n]),showStateHistoryModal:()=>r(!0),hideStateHistoryModal:()=>r(!1)}}(I),_=(0,L.HY)(h)?h:null===(n=(0,M.Xy)(h.jsonData.alertmanagerUid))||void 0===n?void 0:n.name,q=(0,L.EG)(h),B=d.Vt.hasPermission(p.bW.DataSourcesExplore),V=(0,U.Pc)(r.rulerRule)&&Boolean(r.rulerRule.grafana_alert.provenance),G=[],H=[],O=(0,U.Jq)(y),{isEditable:A,isRemovable:W}=(0,m.M)(q,S),Z=f.pathname+f.search,Y=f.pathname.endsWith("/view");const K=()=>{if(w&&w.rulerRule){const e=P.Zk((0,L.EG)(w.namespace.rulesSource),w.namespace.name,w.group.name,w.rulerRule);g((0,x.hS)(e,{navigateTo:Y?"/alerting/list":void 0})),k(void 0)}},J=()=>{if((0,L.jq)(h)){const{appUrl:e,appSubUrl:t}=i.config;return`${""!==t?`${e}${t}/`:i.config.appUrl}alerting/${`${encodeURIComponent(h.name)}/${encodeURIComponent(r.name)}`}/find`}return window.location.href.split("?")[0]};if((0,L.jq)(h)&&B&&!O&&G.push((0,R.jsx)(c.LinkButton,{className:j.button,size:"xs",variant:"primary",icon:"chart-line",target:"__blank",href:(0,D.mH)(h.name,r.query),children:"See graph"},"explore")),r.annotations[F.q6.runbookURL]&&G.push((0,R.jsx)(c.LinkButton,{className:j.button,size:"xs",variant:"primary",icon:"book",target:"__blank",href:r.annotations[F.q6.runbookURL],children:"View runbook"},"runbook")),r.annotations[F.q6.dashboardUID]){const e=r.annotations[F.q6.dashboardUID];if(e){G.push((0,R.jsx)(c.LinkButton,{className:j.button,size:"xs",variant:"primary",icon:"apps",target:"__blank",href:`d/${encodeURIComponent(e)}`,children:"Go to dashboard"},"dashboard"));const t=r.annotations[F.q6.panelID];t&&G.push((0,R.jsx)(c.LinkButton,{className:j.button,size:"xs",variant:"primary",icon:"apps",target:"__blank",href:`d/${encodeURIComponent(e)}?viewPanel=${encodeURIComponent(t)}`,children:"Go to panel"},"panel"))}}if(_&&d.Vt.hasAccess(p.bW.AlertingInstanceCreate,d.Vt.isEditor)&&G.push((0,R.jsx)(c.LinkButton,{className:j.button,size:"xs",icon:"bell-slash",target:"__blank",href:(0,D.Vv)(_,r),children:"Silence"},"silence")),I&&G.push((0,R.jsxs)(a.Fragment,{children:[(0,R.jsx)(c.Button,{className:j.button,size:"xs",icon:"history",onClick:()=>$(),children:"Show state history"}),N]},"history")),Y||H.push((0,R.jsx)(c.LinkButton,{className:j.button,size:"xs",variant:"secondary",icon:"eye",href:(0,D.V2)(h,r,Z),children:"View"},"view")),A&&S&&!O&&!V){const e=(0,L.EG)(h),t=P.Zk(e,b.name,y.name,S),n=o.urlUtil.renderUrl(`${i.config.appSubUrl}/alerting/${encodeURIComponent(P.$V(t))}/edit`,{returnTo:Z});Y&&H.push((0,R.jsx)(c.ClipboardButton,{icon:"copy",onClipboardError:e=>{v.error("Error while copying URL",e)},className:j.button,size:"sm",getText:J,children:"Copy link to rule"},"copy")),H.push((0,R.jsx)(c.LinkButton,{className:j.button,size:"xs",variant:"secondary",icon:"pen",href:n,children:"Edit"},"edit"))}return W&&S&&!O&&!V&&H.push((0,R.jsx)(c.Button,{className:j.button,size:"xs",type:"button",variant:"secondary",icon:"trash-alt",onClick:()=>k(r),children:"Delete"},"delete")),G.length||H.length?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)("div",{className:j.wrapper,children:[(0,R.jsx)(c.HorizontalGroup,{width:"auto",children:G.length?G:z||(z=(0,R.jsx)("div",{}))}),(0,R.jsx)(c.HorizontalGroup,{width:"auto",children:H.length?H:E||(E=(0,R.jsx)("div",{}))})]}),!!w&&(0,R.jsx)(c.ConfirmModal,{isOpen:!0,title:"Delete rule",body:"Deleting this rule will permanently remove it from your alert rule list. Are you sure you want to delete this rule?",confirmText:"Yes, delete",icon:"exclamation-triangle",onConfirm:K,onDismiss:()=>k(void 0)})]}):null};const T=e=>({wrapper:r.css`
    padding: ${e.spacing(2)} 0;
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    flex-wrap: wrap;
    border-bottom: solid 1px ${e.colors.border.medium};
  `,button:r.css`
    height: 24px;
    margin-top: ${e.spacing(1)};
    font-size: ${e.typography.size.sm};
  `})},97292:(e,t,n)=>{n.d(t,{J:()=>o});var r=n(36636),a=(n(68404),n(3490)),s=n(212),l=n(45916);function o(e){const{annotations:t}=e,n=(0,a.useStyles2)(i);return 0===t.length?null:(0,l.jsx)("div",{className:n.annotations,children:t.map((e=>{let[t,n]=e;return(0,l.jsx)(s.a,{annotationKey:t,value:n},t)}))})}const i=()=>({annotations:r.css`
    margin-top: 46px;
  `})},79842:(e,t,n)=>{n.d(t,{C:()=>p});var r=n(36636),a=n(68404),s=n(90923),l=n(3490),o=n(24036),i=n(19462),c=n(86647),u=n(52510),d=n(45916);function p(e){const{rulesSource:t,rule:n}=e,r=(0,l.useStyles2)(m),p=(0,a.useMemo)((()=>{if((0,i.jq)(t))return[{name:t.name,icon:t.meta.info.logos.small}];if((0,c.Pc)(n.rulerRule)){const{data:e}=n.rulerRule.grafana_alert,t=e.reduce(((e,t)=>{const n=(0,s.getDataSourceSrv)().getInstanceSettings(t.datasourceUid);return n&&n.uid!==o.Yq?(e[n.name]={name:n.name,icon:n.meta.info.logos.small},e):e}),{});return Object.values(t)}return[]}),[n,t]);return 0===p.length?null:(0,d.jsx)(u.C,{label:"Data source",children:p.map(((e,t)=>{let{name:n,icon:a}=e;return(0,d.jsxs)("div",{children:[a&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("img",{alt:`${n} datasource logo`,className:r.dataSourceIcon,src:a})," "]}),n]},n)}))})}function m(e){const t=e.spacing(2);return{dataSourceIcon:r.css`
      width: ${t};
      height: ${t};
    `}}},85351:(e,t,n)=>{n.d(t,{C:()=>f});var r=n(36636),a=n(68404),s=n(19462),l=n(52510),o=n(50539),i=n(35380),c=n(3490),u=n(17245),d=n(85548),p=n(38708),m=n(45916);const h=e=>{let{language:t,expr:n}=e;const r=(0,a.useMemo)((()=>[(0,c.SlatePrism)({onlyIn:e=>"code_block"===e.type,getSyntax:()=>t},Object.assign({},o.languages,{[t]:"logql"===t?u.ZP:d.ZP}))]),[t]),s=(0,a.useMemo)((()=>(0,c.makeValue)(n)),[n]);return(0,m.jsx)(i.ML,{plugins:r,value:s,readOnly:!0})},g=e=>{let{expression:t,rulesSource:n}=e;const a=(0,c.useStyles)(x);return(0,m.jsx)(p.t,{className:(0,r.cx)(a.well,"slate-query-field"),children:(0,s.jq)(n)?(0,m.jsx)(h,{expr:t,language:n.type===s.ye.Loki?"logql":"promql"}):t})},x=e=>({well:r.css`
    font-family: ${e.typography.fontFamily.monospace};
  `});function f(e){const{annotations:t,rulesSource:n,rule:a}=e,o=v();return(0,s.jq)(n)?(0,m.jsx)(l.C,{label:"Expression",horizontal:!0,className:(0,r.cx)({[o.exprRow]:!!t.length}),children:(0,m.jsx)(g,{expression:a.query,rulesSource:n})}):null}const v=()=>({exprRow:r.css`
    margin-bottom: 46px;
  `})},12135:(e,t,n)=>{n.d(t,{M:()=>y});var r,a=n(36636),s=n(82897),l=n(68404),o=n(3490),i=n(16905),c=n(51542),u=n(45916);const d=e=>{let{className:t,onStateFilterChange:n,stateFilter:a,filterType:l,itemPerStateStats:i}=e;const d=(0,o.useStyles2)(p),m=e=>function(){return i&&i[e]?(0,u.jsx)(o.Tag,{name:i[e].toFixed(0),colorIndex:9,className:d.tag}):null},h=Object.values(c.bj).map((e=>({label:e,value:e,component:m(e)}))),g=[c.x_.Firing,c.x_.Pending].map((e=>({label:(0,s.capitalize)(e),value:e,component:m(e)}))),x="grafana"===l?h:g;return(0,u.jsxs)("div",{className:t,"data-testid":"alert-instance-state-filter",children:[r||(r=(0,u.jsx)(o.Label,{children:"State"})),(0,u.jsx)(o.RadioButtonGroup,{options:x,value:a,onChange:n,onClick:e=>{e===a&&n(void 0)}})]})};function p(e){return{tag:a.css`
      font-size: 11px;
      font-weight: normal;
      padding: ${e.spacing(.25,.5)};
      vertical-align: middle;
      margin-left: ${e.spacing(.5)};
    `}}var m=n(82139),h=n(39357),g=n(40206),x=n(19462),f=n(86647),v=n(52510),j=n(9290);function b(e){const t=(0,o.useStyles)(S),{ruleViewPageLink:n,stats:r}=e;return(0,u.jsxs)("div",{className:t.footerRow,children:[(0,u.jsxs)("div",{children:["Showing ",r.visibleItemsCount," out of ",r.totalItemsCount," instances"]}),n&&(0,u.jsxs)(o.LinkButton,{href:n,size:"sm",variant:"secondary",children:["Show all ",r.totalItemsCount," alert instances"]})]})}function y(e){const{rule:{promRule:t,namespace:n},itemsDisplayLimit:r=Number.POSITIVE_INFINITY,pagination:p}=e,[y,w]=(0,l.useState)(),[R,C]=(0,l.useState)(),[k]=(0,l.useState)(Math.floor(100*Math.random())),I=`queryString-${k}`,N=(0,o.useStyles)(S),$=(0,x.HY)(n.rulesSource)?x.GC:"prometheus",_=(0,l.useMemo)((()=>{var e;return(0,f.x_)(t)&&null!==(e=t.alerts)&&void 0!==e&&e.length?function(e,t,n){let r=[...n];if(e){const t=(0,m.Zh)(e||"");r=r.filter((e=>{let{labels:n}=e;return(0,m.eD)(n,t)}))}t&&(r=r.filter((e=>(0,c.ED)(e.state)===t)));return r}(y,R,(0,h.Zl)(g.As.Importance,t.alerts)):[]}),[t,R,y]);if(!(0,f.x_)(t))return null;const q=_.slice(0,r),z=(0,s.countBy)(t.alerts,(e=>(0,c.ED)(e.state))),E=_.length-q.length,M={totalItemsCount:_.length,visibleItemsCount:q.length},F=(0,h.V2)(n.rulesSource,e.rule,location.pathname+location.search),L=E?(0,u.jsx)(b,{stats:M,ruleViewPageLink:F}):void 0;return(0,u.jsxs)(v.C,{label:"Matching instances",horizontal:!0,children:[(0,u.jsx)("div",{className:(0,a.cx)(N.flexRow,N.spaceBetween),children:(0,u.jsxs)("div",{className:N.flexRow,children:[(0,u.jsx)(i.F,{className:N.rowChild,defaultQueryString:y,onFilterChange:e=>w(e)},I),(0,u.jsx)(d,{className:N.rowChild,filterType:$,stateFilter:R,onStateFilterChange:C,itemPerStateStats:z})]})}),(0,u.jsx)(j.o,{instances:q,pagination:p,footerRow:L})]})}const S=e=>({flexRow:a.css`
      display: flex;
      flex-direction: row;
      align-items: flex-end;
      width: 100%;
      flex-wrap: wrap;
      margin-bottom: ${e.spacing.sm};
    `,spaceBetween:a.css`
      justify-content: space-between;
    `,rowChild:a.css`
      margin-right: ${e.spacing.sm};
    `,footerRow:a.css`
      display: flex;
      flex-direction: column;
      gap: ${e.spacing.sm};
      justify-content: space-between;
      align-items: center;
      width: 100%;
    `})},82434:(e,t,n)=>{n.d(t,{V:()=>i});var r,a,s=n(36636),l=(n(68404),n(3490)),o=n(45916);const i=e=>{let{rule:t}=e;const n=(0,l.useStyles2)(c);return"err"===t.health||"error"===t.health?(0,o.jsx)(l.Tooltip,{theme:"error",content:t.lastError||"No error message provided.",children:(0,o.jsxs)("div",{className:n.warn,children:[r||(r=(0,o.jsx)(l.Icon,{name:"exclamation-triangle"})),a||(a=(0,o.jsx)("span",{children:"error"}))]})}):(0,o.jsx)(o.Fragment,{children:t.health})},c=e=>({warn:s.css`
    display: inline-flex;
    flex-direction: row;
    align-items: center;
    gap: ${e.spacing(1)};

    color: ${e.colors.warning.text};
  `})},18181:(e,t,n)=>{n.d(t,{p:()=>m});var r,a,s=n(36636),l=n(68404),o=n(43215),i=n(3490),c=n(51542),u=n(86647),d=n(69357),p=n(45916);const m=e=>{let{rule:t,isDeleting:n,isCreating:s}=e;const m=(0,i.useStyles2)(h),{promRule:g}=t,x=(0,l.useMemo)((()=>{var e;if(g&&(0,u.x_)(g)&&null!==(e=g.alerts)&&void 0!==e&&e.length&&g.state!==c.x_.Inactive){const e=(0,u.ub)(g);if(e)return(0,p.jsxs)("span",{title:String(e),className:m.for,children:["for"," ",(0,o.intervalToAbbreviatedDurationString)({start:e,end:new Date},!1)]})}return null}),[g,m]);return n?r||(r=(0,p.jsxs)(i.HorizontalGroup,{align:"flex-start",children:[(0,p.jsx)(i.Spinner,{}),"deleting"]})):s?a||(a=(0,p.jsxs)(i.HorizontalGroup,{align:"flex-start",children:[" ",(0,p.jsx)(i.Spinner,{}),"creating"]})):g&&(0,u.x_)(g)?(0,p.jsxs)(i.HorizontalGroup,{align:"flex-start",children:[(0,p.jsx)(d.l,{state:g.state}),x]}):g&&(0,u.OP)(g)?(0,p.jsx)(p.Fragment,{children:"Recording rule"}):(0,p.jsx)(p.Fragment,{children:"n/a"})},h=e=>({for:s.css`
    font-size: ${e.typography.bodySmall.fontSize};
    color: ${e.colors.text.secondary};
    white-space: nowrap;
    padding-top: 2px;
  `})},75678:(e,t,n)=>{n.d(t,{Kd:()=>i,Zo:()=>o});var r=n(68404),a=n(19462),s=n(86647),l=n(33899);function o(e){const t=(0,l._)((e=>e.promRules)),n=(0,l._)((e=>e.rulerRules)),o=(0,r.useRef)({}),i=(0,r.useMemo)((()=>{if(e){const t=(0,a.o_)(e);if(!t)throw new Error(`Unknown rules source: ${e}`);return[t]}return(0,a.h_)()}),[e]);return(0,r.useMemo)((()=>i.map((e=>{var r,l;const i=(0,a.jq)(e)?e.name:e,d=null===(r=t[i])||void 0===r?void 0:r.result,p=null===(l=n[i])||void 0===l?void 0:l.result,m=o.current[i];if(m&&m.promRules===d&&m.rulerRules===p)return m.result;const h={};Object.entries(p||{}).forEach((t=>{let[n,r]=t;const a={rulesSource:e,name:n,groups:[]};h[n]=a,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e.groups=t.map((t=>{const n={name:t.name,interval:t.interval,source_tenants:t.source_tenants,rules:[]};return n.rules=t.rules.map((t=>c(t,e,n))),n}))}(a,r)})),null==d||d.forEach((t=>{let{name:n,groups:r}=t;!function(e,t){t.forEach((t=>{var n;let r=e.groups.find((e=>e.name===t.name));r||(r={name:t.name,rules:[]},e.groups.push(r)),(null!==(n=t.rules)&&void 0!==n?n:[]).forEach((t=>{const n=function(e,t,n){var r;if((0,a.HY)(n))return t.rules.find((t=>t.name===e.name));return null!==(r=t.rules.find((t=>!t.promRule&&u(t,e,!0))))&&void 0!==r?r:t.rules.find((t=>!t.promRule&&u(t,e,!1)))}(t,r,e.rulesSource);n?n.promRule=t:r.rules.push(function(e,t,n){return{name:e.name,query:e.query,labels:e.labels||{},annotations:(0,s.x_)(e)&&e.annotations||{},promRule:e,namespace:t,group:n}}(t,e,r))}))}))}(h[n]=h[n]||{rulesSource:e,name:n,groups:[]},r)}));const g=Object.values(h);return o.current[i]={promRules:d,rulerRules:p,result:g},g})).flat()),[t,n,i])}function i(e){return e.map((e=>{const t=Object.assign({},e,{groups:[]});var n;return t.groups.push({name:"default",rules:(n=e.groups.flatMap((e=>e.rules)),n.sort(((e,t)=>e.name.localeCompare(t.name))))}),t}))}function c(e,t,n){return(0,s.cG)(e)?{name:e.alert,query:e.expr,labels:e.labels||{},annotations:e.annotations||{},rulerRule:e,namespace:t,group:n}:(0,s.yF)(e)?{name:e.record,query:e.expr,labels:e.labels||{},annotations:{},rulerRule:e,namespace:t,group:n}:{name:e.grafana_alert.title,query:"",labels:e.labels||{},annotations:e.annotations||{},rulerRule:e,namespace:t,group:n}}function u(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e.name===t.name&&JSON.stringify([n?d(e.query):"",e.labels,e.annotations])===JSON.stringify([n?d(t.query):"",t.labels||{},(0,s.x_)(t)&&t.annotations||{}])}function d(e){return e.length>1&&"("===e[0]&&")"===e[e.length-1]&&(e=e.slice(1,-1)),(e=e.replace(/\s|\n/g,"")).split("").sort().join("")}},13309:(e,t,n)=>{n.d(t,{W:()=>i});var r=n(68404),a=n(18745),s=n(83809),l=n(8455),o=n(33899);function i(e){const t=(0,a.useDispatch)(),n=(0,o._)((e=>e.folders));if((0,r.useEffect)((()=>{e&&t((0,s.sw)(e))}),[t,e]),e){const t=n[e]||l.oq;return{folder:t.result,loading:t.loading}}return{loading:!1}}},78567:(e,t,n)=>{n.d(t,{M:()=>i});var r=n(61959),a=n(82969),s=n(86647),l=n(13309),o=n(33899);function i(e,t){var n,i,c;const u=(0,o._)((e=>e.dataSources)),d=t&&(0,s.Pc)(t)?t.grafana_alert.namespace_uid:void 0,p=(0,a.Bz)(e),{folder:m,loading:h}=(0,l.W)(d);if(!t)return{isEditable:!1,isRemovable:!1,loading:!1};if((0,s.Pc)(t)){if(!d)throw new Error(`Rule ${t.grafana_alert.title} does not have a folder uid, cannot determine if it is editable.`);if(!m)return{isEditable:!1,isRemovable:!1,loading:h};const e=m.canSave;return{isEditable:r.Vt.hasAccessInMetadata(p.update,m,e),isRemovable:r.Vt.hasAccessInMetadata(p.delete,m,e),loading:h}}const g=Boolean(null===(n=u[e])||void 0===n||null===(i=n.result)||void 0===i?void 0:i.rulerConfig);return{isEditable:r.Vt.hasAccess(p.update,r.Vt.isEditor)&&g,isRemovable:r.Vt.hasAccess(p.delete,r.Vt.isEditor)&&g,loading:null===(c=u[e])||void 0===c?void 0:c.loading}}}}]);
//# sourceMappingURL=7062.961bdccf5fa3bc105230.js.map