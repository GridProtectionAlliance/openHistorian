(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7049],{35931:(Ke,Fe,l)=>{"use strict";l.d(Fe,{H:()=>o});var Q=l(32196),Oe=l(96540),M=l(40845);function o(K){const{description:i,suffix:ne,feature:D}=K,te=`Learn more about ${D}`,le=(0,M.of)(h);return Oe.createElement("span",{className:le.container},i,Oe.createElement("a",{"aria-label":te,href:`https://grafana.com/docs/grafana/next/datasources/${ne}`,rel:"noreferrer",target:"_blank"},te))}const h=K=>({container:(0,Q.css)({color:K.colors.text.secondary,a:(0,Q.css)({color:K.colors.text.link,textDecoration:"underline",marginLeft:"5px","&:hover":{textDecoration:"none"}})})})},91062:(Ke,Fe,l)=>{"use strict";l.d(Fe,{A:()=>de});var Q=l(96540),Oe=l(47433),M=Object.defineProperty,o=Object.defineProperties,h=Object.getOwnPropertyDescriptors,K=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable,D=(Z,x,U)=>x in Z?M(Z,x,{enumerable:!0,configurable:!0,writable:!0,value:U}):Z[x]=U,te=(Z,x)=>{for(var U in x||(x={}))i.call(x,U)&&D(Z,U,x[U]);if(K)for(var U of K(x))ne.call(x,U)&&D(Z,U,x[U]);return Z},le=(Z,x)=>o(Z,h(x)),R=(Z,x)=>{var U={};for(var I in Z)i.call(Z,I)&&x.indexOf(I)<0&&(U[I]=Z[I]);if(Z!=null&&K)for(var I of K(Z))x.indexOf(I)<0&&ne.call(Z,I)&&(U[I]=Z[I]);return U};const de=Z=>{var x=Z,{children:U}=x,I=R(x,["children"]);return Q.createElement(Oe.x,le(te({},I),{kind:"section"}),U)}},29020:(Ke,Fe,l)=>{"use strict";l.d(Fe,{I:()=>de});var Q=l(96540),Oe=l(47433),M=Object.defineProperty,o=Object.defineProperties,h=Object.getOwnPropertyDescriptors,K=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable,D=(Z,x,U)=>x in Z?M(Z,x,{enumerable:!0,configurable:!0,writable:!0,value:U}):Z[x]=U,te=(Z,x)=>{for(var U in x||(x={}))i.call(x,U)&&D(Z,U,x[U]);if(K)for(var U of K(x))ne.call(x,U)&&D(Z,U,x[U]);return Z},le=(Z,x)=>o(Z,h(x)),R=(Z,x)=>{var U={};for(var I in Z)i.call(Z,I)&&x.indexOf(I)<0&&(U[I]=Z[I]);if(Z!=null&&K)for(var I of K(Z))x.indexOf(I)<0&&ne.call(Z,I)&&(U[I]=Z[I]);return U};const de=Z=>{var x=Z,{children:U}=x,I=R(x,["children"]);return Q.createElement(Oe.x,le(te({},I),{kind:"sub-section"}),U)}},47433:(Ke,Fe,l)=>{"use strict";l.d(Fe,{x:()=>Z});var Q=l(96540),Oe=l(32196),M=l(40845),o=l(29158),h=Object.defineProperty,K=Object.defineProperties,i=Object.getOwnPropertyDescriptors,ne=Object.getOwnPropertySymbols,D=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable,le=(x,U,I)=>U in x?h(x,U,{enumerable:!0,configurable:!0,writable:!0,value:I}):x[U]=I,R=(x,U)=>{for(var I in U||(U={}))D.call(U,I)&&le(x,I,U[I]);if(ne)for(var I of ne(U))te.call(U,I)&&le(x,I,U[I]);return x},de=(x,U)=>K(x,i(U));const Z=({children:x,title:U,description:I,isCollapsible:Me=!1,isInitiallyOpen:xe=!0,kind:Se="section",className:ve})=>{const{colors:ge,typography:fe,spacing:Pe}=(0,M.$j)(),[Le,B]=(0,Q.useState)(Me?xe:!0),Qe=Le?"angle-up":"angle-down",De=Se==="sub-section",He=`${Le?"Collapse":"Expand"} section ${U}`,w={header:(0,Oe.css)({display:"flex",justifyContent:"space-between",alignItems:"center"}),title:(0,Oe.css)({margin:0}),subtitle:(0,Oe.css)({margin:0,fontWeight:fe.fontWeightRegular}),descriptionText:(0,Oe.css)(de(R({marginTop:Pe(De?.25:.5),marginBottom:0},fe.bodySmall),{color:ge.text.secondary})),content:(0,Oe.css)({marginTop:Pe(2)})};return Q.createElement("div",{className:ve},Q.createElement("div",{className:w.header},Se==="section"?Q.createElement("h3",{className:w.title},U):Q.createElement("h6",{className:w.subtitle},U),Me&&Q.createElement(o.K,{name:Qe,onClick:()=>B(!Le),type:"button",size:"xl","aria-label":He})),I&&Q.createElement("p",{className:w.descriptionText},I),Le&&Q.createElement("div",{className:w.content},x))}},6191:(Ke,Fe,l)=>{"use strict";l.d(Fe,{X:()=>o});var Q=l(32196),Oe=l(96540),M=l(40845);const o=({children:K})=>{const i=(0,M.of)(h);return Oe.createElement("div",{className:i.root},K)},h=K=>({root:(0,Q.css)({display:"flex",flexWrap:"wrap",alignItems:"center",gap:K.spacing(3),minHeight:K.spacing(4)})})},31347:(Ke,Fe,l)=>{"use strict";l.d(Fe,{Z:()=>Oe});var Q=l(96540);const Oe=({grow:M,shrink:o})=>Q.createElement("div",{style:{display:"block",flexGrow:M,flexShrink:o}})},92762:(Ke,Fe,l)=>{"use strict";l.d(Fe,{Z:()=>i});var Q=l(32196),Oe=l(28848),M=l.n(Oe),o=l(96540),h=l(80997),K=l(40845);function i({query:D,language:te,className:le}){const R=(0,K.$j)(),de=ne(R),Z=M().highlight(D,te.grammar,te.name);return o.createElement("div",{className:(0,Q.cx)(de.editorField,"prism-syntax-highlight",le),"aria-label":"selector",dangerouslySetInnerHTML:{__html:h.sQ.sanitize(Z)}})}const ne=D=>({editorField:(0,Q.css)({fontFamily:D.typography.fontFamilyMonospace,fontSize:D.typography.bodySmall.fontSize})})},42952:(Ke,Fe,l)=>{"use strict";l.d(Fe,{T:()=>Oe,f:()=>Q});var Q=(M=>(M.Code="code",M.Builder="builder",M))(Q||{});const Oe="Binary operations"},60016:(Ke,Fe,l)=>{"use strict";l.d(Fe,{BI:()=>x,TO:()=>Z,iB:()=>I,kl:()=>Me,wU:()=>Se});var Q=l(74848),Oe=l(2543),M=l.n(Oe),o=l(96540),h=l(32264),K=l(67061),i=l(38894),ne=l(94354),D=l(14186),te=l(10354),le=l(90182),R=l(56587),de=l(13137);const Z=[{value:de.U3.Range,label:"Range",description:"Run query over a range of time."},{value:de.U3.Instant,label:"Instant",description:'Run query against a single point in time. For this query, the "To" time is used.'}],x=[{value:de.ti.Backward,label:"Backward",description:"Search in backward direction."},{value:de.ti.Forward,label:"Forward",description:"Search in forward direction."}];h.$.featureToggles.lokiExperimentalStreaming&&Z.push({value:de.U3.Stream,label:"Stream",description:"Run a query and keep sending results on an interval"});const I=[{value:1,label:"1/1"}].concat((0,Oe.map)([2,3,4,5,10],ve=>({value:ve,label:"1/"+ve})));function Me(ve){const{lineLimitValue:ge,resolution:fe,onRunQuery:Pe,runOnBlur:Le,onChange:B}=ve,Qe=ve.query??{},De=(0,R.Io)(Qe);function He(G){const T={...Qe,maxLines:Se(G)};B(T)}function w(G){const{instant:T,range:Y,...z}=Qe;B({...z,queryType:G})}function N(G){Qe.maxLines!==Se(G.currentTarget.value)&&He(G.currentTarget.value)}function pe(G){G.key==="Enter"&&Pe()}function ce(G){const T={...Qe,resolution:G.value};B(T)}return(0,Q.jsxs)(K.B,{alignItems:"flex-start",gap:.5,"aria-label":"Loki extra field",children:[(0,Q.jsxs)(K.B,{wrap:"nowrap",gap:0,"data-testid":"queryTypeField","aria-label":"Query type field",children:[(0,Q.jsx)(i.I,{width:"auto",children:"Query type"}),(0,Q.jsx)(ne.z,{options:Z,value:De,onChange:G=>{w(G),Le&&Pe()}})]}),(0,Q.jsxs)(K.B,{wrap:"nowrap",gap:0,"data-testid":"lineLimitField","aria-label":"Line limit field",children:[(0,Q.jsx)(D.I,{label:"Line limit",tooltip:"Upper limit for number of log lines returned by query.",children:(0,Q.jsx)(te.p,{className:"width-4",placeholder:"auto",type:"number",min:0,onChange:N,onKeyDown:pe,value:ge,onBlur:()=>{Le&&Pe()}})}),(0,Q.jsx)(D.I,{label:"Resolution",tooltip:"Resolution 1/1 sets step parameter of Loki metrics range queries such that each pixel corresponds to one data point. For better performance, lower resolutions can be picked. 1/2 only retrieves a data point for every other pixel, and 1/10 retrieves one data point per 10 pixels.",children:(0,Q.jsx)(le.l6,{isSearchable:!1,onChange:ce,options:I,value:fe,"aria-label":"Select resolution"})})]})]})}var xe=(0,o.memo)(Me);function Se(ve){const ge=parseInt(ve,10);if(!(isNaN(ge)||ge<0))return ge}},95881:(Ke,Fe,l)=>{"use strict";l.d(Fe,{W:()=>i});var Q=l(74848),Oe=l(96540),M=l(97535);const o=(0,Oe.lazy)(()=>l.e(1952).then(l.bind(l,51639))),h=ne=>(0,Q.jsx)(Oe.Suspense,{fallback:null,children:(0,Q.jsx)(o,{...ne})}),K=ne=>{const D=(0,Oe.useRef)(null),{onRunQuery:te,onChange:le,...R}=ne,de=x=>{D.current=x,le(x),te()},Z=x=>{le(x)};return(0,Q.jsx)(h,{onRunQuery:de,onBlur:Z,onChange:le,...R})};class i extends Oe.PureComponent{constructor(D){super(D),this._isMounted=!1,this.onChangeQuery=(te,le)=>{const{query:R,onChange:de,onRunQuery:Z}=this.props;if(de){const x={...R,expr:te};de(x),le&&Z&&Z()}},this.state={labelsLoaded:!1}}async componentDidMount(){this._isMounted=!0,await this.props.datasource.languageProvider.start(this.props.range),this._isMounted&&this.setState({labelsLoaded:!0})}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(D){const{range:te,datasource:{languageProvider:le}}=this.props;(0,M.WV)(te,D.range)&&le.fetchLabels({timeRange:te})}render(){const{ExtraFieldElement:D,query:te,datasource:le,history:R,onRunQuery:de,range:Z}=this.props,x=this.props.placeholder??"Enter a Loki query (run with Shift+Enter)";return(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)("div",{className:"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1","data-testid":this.props["data-testid"],children:(0,Q.jsx)("div",{className:"gf-form--grow flex-shrink-1 min-width-15",children:(0,Q.jsx)(K,{datasource:le,history:R??[],onChange:this.onChangeQuery,onRunQuery:de,initialValue:te.expr??"",placeholder:x,timeRange:Z})})}),D]})}}},20065:(Ke,Fe,l)=>{"use strict";l.d(Fe,{B:()=>Oe,a:()=>K});var Q=l(56245);function Oe(i,ne,D,te){if(!i)return!1;const le=M(ne,te);if(!le.length)return!1;let R=le;if(i!==ne){const de=M(i,te);R=le.flatMap(Z=>de.filter(x=>Z.text===x.text)||Z)}return R.map(de=>o(i,D,de)).filter(h)}function M(i,ne){const D=[];return ne.parse(i).iterate({enter:le=>{if(le.type.id===Q.Ql){const R=le.node;D.push({node:R,text:i.substring(R.from,R.to)})}}}),D}function o(i,ne,D){if(ne.length===1){const R=D.node.from===D.node.to,de=R&&D.node.parent?D.node.parent:D.node,Z=R?i.substring(de.from,de.to):D.text;return{startLineNumber:1,startColumn:de.from+1,endLineNumber:1,endColumn:de.to+1,error:Z}}let te=0,le=0;for(let R=0;R<ne.length;R++){if(le=te+ne[R].length,D.node.from>le){te+=ne[R].length+1;continue}return{startLineNumber:R+1,startColumn:D.node.from-te+1,endLineNumber:R+1,endColumn:D.node.to-te+1,error:D.text}}return null}function h(i){return i!==null}const K={__interval:{text:"1s",value:"1s"},__rate_interval:{text:"1s",value:"1s"},__auto:{text:"1s",value:"1s"},__interval_ms:{text:"1000",value:1e3},__range_ms:{text:"1000",value:1e3},__range_s:{text:"1",value:1},__range:{text:"1s",value:"1s"}}},27724:(Ke,Fe,l)=>{"use strict";l.d(Fe,{we:()=>St,VQ:()=>Pt,lb:()=>br,Gf:()=>La,M1:()=>Xr,ow:()=>$a,mL:()=>Sa,In:()=>xr});var Q=l(2543),Oe=l(13288),M=l(44240),o=l(62467),h=l(75505),K=l(81160),i=l(66847),ne=l(59099),D=l(63720),te=l(65879),le=l(39070),R=l(9557),de=l(41987),Z=l(76885),x=l(78368),U=l(43659),I=l(36195),Me=l(26657),xe=l(72574),Se=l(32264),ve=l(14792);const ge=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,fe=new Set,Pe=typeof process=="object"&&process?process:{},Le=(v,a,r,s)=>{typeof Pe.emitWarning=="function"?Pe.emitWarning(v,a,r,s):console.error(`[${r}] ${a}: ${v}`)};let B=globalThis.AbortController,Qe=globalThis.AbortSignal;if(typeof B>"u"){Qe=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(s,c){this._onabort.push(c)}},B=class{constructor(){a()}signal=new Qe;abort(s){if(!this.signal.aborted){this.signal.reason=s,this.signal.aborted=!0;for(const c of this.signal._onabort)c(s);this.signal.onabort?.(s)}}};let v=Pe.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1";const a=()=>{v&&(v=!1,Le("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",a))}}const De=v=>!fe.has(v),He=Symbol("type"),w=v=>v&&v===Math.floor(v)&&v>0&&isFinite(v),N=v=>w(v)?v<=Math.pow(2,8)?Uint8Array:v<=Math.pow(2,16)?Uint16Array:v<=Math.pow(2,32)?Uint32Array:v<=Number.MAX_SAFE_INTEGER?pe:null:null;class pe extends Array{constructor(a){super(a),this.fill(0)}}class ce{heap;length;static#l=!1;static create(a){const r=N(a);if(!r)return[];ce.#l=!0;const s=new ce(a,r);return ce.#l=!1,s}constructor(a,r){if(!ce.#l)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new r(a),this.length=0}push(a){this.heap[this.length++]=a}pop(){return this.heap[--this.length]}}class G{#l;#d;#g;#m;#T;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#n;#v;#a;#r;#e;#c;#f;#o;#s;#O;#i;#y;#b;#p;#x;#S;#u;static unsafeExposeInternals(a){return{starts:a.#b,ttls:a.#p,sizes:a.#y,keyMap:a.#a,keyList:a.#r,valList:a.#e,next:a.#c,prev:a.#f,get head(){return a.#o},get tail(){return a.#s},free:a.#O,isBackgroundFetch:r=>a.#t(r),backgroundFetch:(r,s,c,d)=>a.#C(r,s,c,d),moveToTail:r=>a.#Q(r),indexes:r=>a.#E(r),rindexes:r=>a.#P(r),isStale:r=>a.#h(r)}}get max(){return this.#l}get maxSize(){return this.#d}get calculatedSize(){return this.#v}get size(){return this.#n}get fetchMethod(){return this.#T}get dispose(){return this.#g}get disposeAfter(){return this.#m}constructor(a){const{max:r=0,ttl:s,ttlResolution:c=1,ttlAutopurge:d,updateAgeOnGet:m,updateAgeOnHas:P,allowStale:L,dispose:j,disposeAfter:q,noDisposeOnSet:H,noUpdateTTL:ee,maxSize:oe=0,maxEntrySize:we=0,sizeCalculation:Te,fetchMethod:Ie,noDeleteOnFetchRejection:Re,noDeleteOnStaleGet:Ve,allowStaleOnFetchRejection:qe,allowStaleOnFetchAbort:Xe,ignoreFetchAbort:et}=a;if(r!==0&&!w(r))throw new TypeError("max option must be a nonnegative integer");const $t=r?N(r):Array;if(!$t)throw new Error("invalid max value: "+r);if(this.#l=r,this.#d=oe,this.maxEntrySize=we||this.#d,this.sizeCalculation=Te,this.sizeCalculation){if(!this.#d&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(Ie!==void 0&&typeof Ie!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#T=Ie,this.#S=!!Ie,this.#a=new Map,this.#r=new Array(r).fill(void 0),this.#e=new Array(r).fill(void 0),this.#c=new $t(r),this.#f=new $t(r),this.#o=0,this.#s=0,this.#O=ce.create(r),this.#n=0,this.#v=0,typeof j=="function"&&(this.#g=j),typeof q=="function"?(this.#m=q,this.#i=[]):(this.#m=void 0,this.#i=void 0),this.#x=!!this.#g,this.#u=!!this.#m,this.noDisposeOnSet=!!H,this.noUpdateTTL=!!ee,this.noDeleteOnFetchRejection=!!Re,this.allowStaleOnFetchRejection=!!qe,this.allowStaleOnFetchAbort=!!Xe,this.ignoreFetchAbort=!!et,this.maxEntrySize!==0){if(this.#d!==0&&!w(this.#d))throw new TypeError("maxSize must be a positive integer if specified");if(!w(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#N()}if(this.allowStale=!!L,this.noDeleteOnStaleGet=!!Ve,this.updateAgeOnGet=!!m,this.updateAgeOnHas=!!P,this.ttlResolution=w(c)||c===0?c:1,this.ttlAutopurge=!!d,this.ttl=s||0,this.ttl){if(!w(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#D()}if(this.#l===0&&this.ttl===0&&this.#d===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#l&&!this.#d){const Rt="LRU_CACHE_UNBOUNDED";De(Rt)&&(fe.add(Rt),Le("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",Rt,G))}}getRemainingTTL(a){return this.#a.has(a)?1/0:0}#D(){const a=new pe(this.#l),r=new pe(this.#l);this.#p=a,this.#b=r,this.#A=(d,m,P=ge.now())=>{if(r[d]=m!==0?P:0,a[d]=m,m!==0&&this.ttlAutopurge){const L=setTimeout(()=>{this.#h(d)&&this.delete(this.#r[d])},m+1);L.unref&&L.unref()}},this.#$=d=>{r[d]=a[d]!==0?ge.now():0},this.#L=(d,m)=>{if(a[m]){const P=a[m],L=r[m];if(!P||!L)return;d.ttl=P,d.start=L,d.now=s||c();const j=d.now-L;d.remainingTTL=P-j}};let s=0;const c=()=>{const d=ge.now();if(this.ttlResolution>0){s=d;const m=setTimeout(()=>s=0,this.ttlResolution);m.unref&&m.unref()}return d};this.getRemainingTTL=d=>{const m=this.#a.get(d);if(m===void 0)return 0;const P=a[m],L=r[m];if(!P||!L)return 1/0;const j=(s||c())-L;return P-j},this.#h=d=>{const m=r[d],P=a[d];return!!P&&!!m&&(s||c())-m>P}}#$=()=>{};#L=()=>{};#A=()=>{};#h=()=>!1;#N(){const a=new pe(this.#l);this.#v=0,this.#y=a,this.#R=r=>{this.#v-=a[r],a[r]=0},this.#M=(r,s,c,d)=>{if(this.#t(s))return 0;if(!w(c))if(d){if(typeof d!="function")throw new TypeError("sizeCalculation must be a function");if(c=d(s,r),!w(c))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return c},this.#w=(r,s,c)=>{if(a[r]=s,this.#d){const d=this.#d-a[r];for(;this.#v>d;)this.#F(!0)}this.#v+=a[r],c&&(c.entrySize=s,c.totalCalculatedSize=this.#v)}}#R=a=>{};#w=(a,r,s)=>{};#M=(a,r,s,c)=>{if(s||c)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#E({allowStale:a=this.allowStale}={}){if(this.#n)for(let r=this.#s;!(!this.#j(r)||((a||!this.#h(r))&&(yield r),r===this.#o));)r=this.#f[r]}*#P({allowStale:a=this.allowStale}={}){if(this.#n)for(let r=this.#o;!(!this.#j(r)||((a||!this.#h(r))&&(yield r),r===this.#s));)r=this.#c[r]}#j(a){return a!==void 0&&this.#a.get(this.#r[a])===a}*entries(){for(const a of this.#E())this.#e[a]!==void 0&&this.#r[a]!==void 0&&!this.#t(this.#e[a])&&(yield[this.#r[a],this.#e[a]])}*rentries(){for(const a of this.#P())this.#e[a]!==void 0&&this.#r[a]!==void 0&&!this.#t(this.#e[a])&&(yield[this.#r[a],this.#e[a]])}*keys(){for(const a of this.#E()){const r=this.#r[a];r!==void 0&&!this.#t(this.#e[a])&&(yield r)}}*rkeys(){for(const a of this.#P()){const r=this.#r[a];r!==void 0&&!this.#t(this.#e[a])&&(yield r)}}*values(){for(const a of this.#E())this.#e[a]!==void 0&&!this.#t(this.#e[a])&&(yield this.#e[a])}*rvalues(){for(const a of this.#P())this.#e[a]!==void 0&&!this.#t(this.#e[a])&&(yield this.#e[a])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(a,r={}){for(const s of this.#E()){const c=this.#e[s],d=this.#t(c)?c.__staleWhileFetching:c;if(d!==void 0&&a(d,this.#r[s],this))return this.get(this.#r[s],r)}}forEach(a,r=this){for(const s of this.#E()){const c=this.#e[s],d=this.#t(c)?c.__staleWhileFetching:c;d!==void 0&&a.call(r,d,this.#r[s],this)}}rforEach(a,r=this){for(const s of this.#P()){const c=this.#e[s],d=this.#t(c)?c.__staleWhileFetching:c;d!==void 0&&a.call(r,d,this.#r[s],this)}}purgeStale(){let a=!1;for(const r of this.#P({allowStale:!0}))this.#h(r)&&(this.delete(this.#r[r]),a=!0);return a}info(a){const r=this.#a.get(a);if(r===void 0)return;const s=this.#e[r],c=this.#t(s)?s.__staleWhileFetching:s;if(c===void 0)return;const d={value:c};if(this.#p&&this.#b){const m=this.#p[r],P=this.#b[r];if(m&&P){const L=m-(ge.now()-P);d.ttl=L,d.start=Date.now()}}return this.#y&&(d.size=this.#y[r]),d}dump(){const a=[];for(const r of this.#E({allowStale:!0})){const s=this.#r[r],c=this.#e[r],d=this.#t(c)?c.__staleWhileFetching:c;if(d===void 0||s===void 0)continue;const m={value:d};if(this.#p&&this.#b){m.ttl=this.#p[r];const P=ge.now()-this.#b[r];m.start=Math.floor(Date.now()-P)}this.#y&&(m.size=this.#y[r]),a.unshift([s,m])}return a}load(a){this.clear();for(const[r,s]of a){if(s.start){const c=Date.now()-s.start;s.start=ge.now()-c}this.set(r,s.value,s)}}set(a,r,s={}){if(r===void 0)return this.delete(a),this;const{ttl:c=this.ttl,start:d,noDisposeOnSet:m=this.noDisposeOnSet,sizeCalculation:P=this.sizeCalculation,status:L}=s;let{noUpdateTTL:j=this.noUpdateTTL}=s;const q=this.#M(a,r,s.size||0,P);if(this.maxEntrySize&&q>this.maxEntrySize)return L&&(L.set="miss",L.maxEntrySizeExceeded=!0),this.delete(a),this;let H=this.#n===0?void 0:this.#a.get(a);if(H===void 0)H=this.#n===0?this.#s:this.#O.length!==0?this.#O.pop():this.#n===this.#l?this.#F(!1):this.#n,this.#r[H]=a,this.#e[H]=r,this.#a.set(a,H),this.#c[this.#s]=H,this.#f[H]=this.#s,this.#s=H,this.#n++,this.#w(H,q,L),L&&(L.set="add"),j=!1;else{this.#Q(H);const ee=this.#e[H];if(r!==ee){if(this.#S&&this.#t(ee)){ee.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:oe}=ee;oe!==void 0&&!m&&(this.#x&&this.#g?.(oe,a,"set"),this.#u&&this.#i?.push([oe,a,"set"]))}else m||(this.#x&&this.#g?.(ee,a,"set"),this.#u&&this.#i?.push([ee,a,"set"]));if(this.#R(H),this.#w(H,q,L),this.#e[H]=r,L){L.set="replace";const oe=ee&&this.#t(ee)?ee.__staleWhileFetching:ee;oe!==void 0&&(L.oldValue=oe)}}else L&&(L.set="update")}if(c!==0&&!this.#p&&this.#D(),this.#p&&(j||this.#A(H,c,d),L&&this.#L(L,H)),!m&&this.#u&&this.#i){const ee=this.#i;let oe;for(;oe=ee?.shift();)this.#m?.(...oe)}return this}pop(){try{for(;this.#n;){const a=this.#e[this.#o];if(this.#F(!0),this.#t(a)){if(a.__staleWhileFetching)return a.__staleWhileFetching}else if(a!==void 0)return a}}finally{if(this.#u&&this.#i){const a=this.#i;let r;for(;r=a?.shift();)this.#m?.(...r)}}}#F(a){const r=this.#o,s=this.#r[r],c=this.#e[r];return this.#S&&this.#t(c)?c.__abortController.abort(new Error("evicted")):(this.#x||this.#u)&&(this.#x&&this.#g?.(c,s,"evict"),this.#u&&this.#i?.push([c,s,"evict"])),this.#R(r),a&&(this.#r[r]=void 0,this.#e[r]=void 0,this.#O.push(r)),this.#n===1?(this.#o=this.#s=0,this.#O.length=0):this.#o=this.#c[r],this.#a.delete(s),this.#n--,r}has(a,r={}){const{updateAgeOnHas:s=this.updateAgeOnHas,status:c}=r,d=this.#a.get(a);if(d!==void 0){const m=this.#e[d];if(this.#t(m)&&m.__staleWhileFetching===void 0)return!1;if(this.#h(d))c&&(c.has="stale",this.#L(c,d));else return s&&this.#$(d),c&&(c.has="hit",this.#L(c,d)),!0}else c&&(c.has="miss");return!1}peek(a,r={}){const{allowStale:s=this.allowStale}=r,c=this.#a.get(a);if(c===void 0||!s&&this.#h(c))return;const d=this.#e[c];return this.#t(d)?d.__staleWhileFetching:d}#C(a,r,s,c){const d=r===void 0?void 0:this.#e[r];if(this.#t(d))return d;const m=new B,{signal:P}=s;P?.addEventListener("abort",()=>m.abort(P.reason),{signal:m.signal});const L={signal:m.signal,options:s,context:c},j=(Te,Ie=!1)=>{const{aborted:Re}=m.signal,Ve=s.ignoreFetchAbort&&Te!==void 0;if(s.status&&(Re&&!Ie?(s.status.fetchAborted=!0,s.status.fetchError=m.signal.reason,Ve&&(s.status.fetchAbortIgnored=!0)):s.status.fetchResolved=!0),Re&&!Ve&&!Ie)return H(m.signal.reason);const qe=oe;return this.#e[r]===oe&&(Te===void 0?qe.__staleWhileFetching?this.#e[r]=qe.__staleWhileFetching:this.delete(a):(s.status&&(s.status.fetchUpdated=!0),this.set(a,Te,L.options))),Te},q=Te=>(s.status&&(s.status.fetchRejected=!0,s.status.fetchError=Te),H(Te)),H=Te=>{const{aborted:Ie}=m.signal,Re=Ie&&s.allowStaleOnFetchAbort,Ve=Re||s.allowStaleOnFetchRejection,qe=Ve||s.noDeleteOnFetchRejection,Xe=oe;if(this.#e[r]===oe&&(!qe||Xe.__staleWhileFetching===void 0?this.delete(a):Re||(this.#e[r]=Xe.__staleWhileFetching)),Ve)return s.status&&Xe.__staleWhileFetching!==void 0&&(s.status.returnedStale=!0),Xe.__staleWhileFetching;if(Xe.__returned===Xe)throw Te},ee=(Te,Ie)=>{const Re=this.#T?.(a,d,L);Re&&Re instanceof Promise&&Re.then(Ve=>Te(Ve===void 0?void 0:Ve),Ie),m.signal.addEventListener("abort",()=>{(!s.ignoreFetchAbort||s.allowStaleOnFetchAbort)&&(Te(void 0),s.allowStaleOnFetchAbort&&(Te=Ve=>j(Ve,!0)))})};s.status&&(s.status.fetchDispatched=!0);const oe=new Promise(ee).then(j,q),we=Object.assign(oe,{__abortController:m,__staleWhileFetching:d,__returned:void 0});return r===void 0?(this.set(a,we,{...L.options,status:void 0}),r=this.#a.get(a)):this.#e[r]=we,we}#t(a){if(!this.#S)return!1;const r=a;return!!r&&r instanceof Promise&&r.hasOwnProperty("__staleWhileFetching")&&r.__abortController instanceof B}async fetch(a,r={}){const{allowStale:s=this.allowStale,updateAgeOnGet:c=this.updateAgeOnGet,noDeleteOnStaleGet:d=this.noDeleteOnStaleGet,ttl:m=this.ttl,noDisposeOnSet:P=this.noDisposeOnSet,size:L=0,sizeCalculation:j=this.sizeCalculation,noUpdateTTL:q=this.noUpdateTTL,noDeleteOnFetchRejection:H=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:ee=this.allowStaleOnFetchRejection,ignoreFetchAbort:oe=this.ignoreFetchAbort,allowStaleOnFetchAbort:we=this.allowStaleOnFetchAbort,context:Te,forceRefresh:Ie=!1,status:Re,signal:Ve}=r;if(!this.#S)return Re&&(Re.fetch="get"),this.get(a,{allowStale:s,updateAgeOnGet:c,noDeleteOnStaleGet:d,status:Re});const qe={allowStale:s,updateAgeOnGet:c,noDeleteOnStaleGet:d,ttl:m,noDisposeOnSet:P,size:L,sizeCalculation:j,noUpdateTTL:q,noDeleteOnFetchRejection:H,allowStaleOnFetchRejection:ee,allowStaleOnFetchAbort:we,ignoreFetchAbort:oe,status:Re,signal:Ve};let Xe=this.#a.get(a);if(Xe===void 0){Re&&(Re.fetch="miss");const et=this.#C(a,Xe,qe,Te);return et.__returned=et}else{const et=this.#e[Xe];if(this.#t(et)){const cr=s&&et.__staleWhileFetching!==void 0;return Re&&(Re.fetch="inflight",cr&&(Re.returnedStale=!0)),cr?et.__staleWhileFetching:et.__returned=et}const $t=this.#h(Xe);if(!Ie&&!$t)return Re&&(Re.fetch="hit"),this.#Q(Xe),c&&this.#$(Xe),Re&&this.#L(Re,Xe),et;const Rt=this.#C(a,Xe,qe,Te),kr=Rt.__staleWhileFetching!==void 0&&s;return Re&&(Re.fetch=$t?"stale":"refresh",kr&&$t&&(Re.returnedStale=!0)),kr?Rt.__staleWhileFetching:Rt.__returned=Rt}}get(a,r={}){const{allowStale:s=this.allowStale,updateAgeOnGet:c=this.updateAgeOnGet,noDeleteOnStaleGet:d=this.noDeleteOnStaleGet,status:m}=r,P=this.#a.get(a);if(P!==void 0){const L=this.#e[P],j=this.#t(L);return m&&this.#L(m,P),this.#h(P)?(m&&(m.get="stale"),j?(m&&s&&L.__staleWhileFetching!==void 0&&(m.returnedStale=!0),s?L.__staleWhileFetching:void 0):(d||this.delete(a),m&&s&&(m.returnedStale=!0),s?L:void 0)):(m&&(m.get="hit"),j?L.__staleWhileFetching:(this.#Q(P),c&&this.#$(P),L))}else m&&(m.get="miss")}#I(a,r){this.#f[r]=a,this.#c[a]=r}#Q(a){a!==this.#s&&(a===this.#o?this.#o=this.#c[a]:this.#I(this.#f[a],this.#c[a]),this.#I(this.#s,a),this.#s=a)}delete(a){let r=!1;if(this.#n!==0){const s=this.#a.get(a);if(s!==void 0)if(r=!0,this.#n===1)this.clear();else{this.#R(s);const c=this.#e[s];if(this.#t(c)?c.__abortController.abort(new Error("deleted")):(this.#x||this.#u)&&(this.#x&&this.#g?.(c,a,"delete"),this.#u&&this.#i?.push([c,a,"delete"])),this.#a.delete(a),this.#r[s]=void 0,this.#e[s]=void 0,s===this.#s)this.#s=this.#f[s];else if(s===this.#o)this.#o=this.#c[s];else{const d=this.#f[s];this.#c[d]=this.#c[s];const m=this.#c[s];this.#f[m]=this.#f[s]}this.#n--,this.#O.push(s)}}if(this.#u&&this.#i?.length){const s=this.#i;let c;for(;c=s?.shift();)this.#m?.(...c)}return r}clear(){for(const a of this.#P({allowStale:!0})){const r=this.#e[a];if(this.#t(r))r.__abortController.abort(new Error("deleted"));else{const s=this.#r[a];this.#x&&this.#g?.(r,s,"delete"),this.#u&&this.#i?.push([r,s,"delete"])}}if(this.#a.clear(),this.#e.fill(void 0),this.#r.fill(void 0),this.#p&&this.#b&&(this.#p.fill(0),this.#b.fill(0)),this.#y&&this.#y.fill(0),this.#o=0,this.#s=0,this.#O.length=0,this.#v=0,this.#n=0,this.#u&&this.#i){const a=this.#i;let r;for(;r=a?.shift();)this.#m?.(...r)}}}var T=l(40187),Y=l(43127),z=l(97535),J=l(56587),g=l(60706),$=l(75723),O=l(13137);const F=1e6,_="{}";class ae extends T.Is{constructor(a,r){super(),this.started=!1,this.seriesCache=new G({max:10}),this.labelsCache=new G({max:10}),this.labelsPromisesCache=new G({max:10}),this.request=async(s,c)=>{try{return await this.datasource.metadataRequest(s,c)}catch(d){console.error(d)}},this.start=s=>{const c=s??this.getDefaultTimeRange(),d=this.datasource.getTimeRangeParams(c),m=this.startedTimeRange?this.datasource.getTimeRangeParams(this.startedTimeRange):null;return(!this.startTask||!m||d.start!==m.start||d.end!==m.end)&&(this.startedTimeRange=c,this.startTask=this.fetchLabels({timeRange:c}).then(()=>(this.started=!0,[]))),this.startTask},this.fetchSeriesLabels=async(s,c)=>{const d=this.datasource.interpolateString(s),m="series",P=c?.timeRange??this.getDefaultTimeRange(),{start:L,end:j}=this.datasource.getTimeRangeParams(P),q=this.generateCacheKey(m,L,j,d);let H=this.seriesCache.get(q);if(!H){const ee={"match[]":d,start:L,end:j},oe=await this.request(m,ee);if(!Array.isArray(oe))return{};const{values:we}=(0,z.P7)(oe);H=we,this.seriesCache.set(q,H)}return H},this.fetchSeries=async(s,c)=>{const d="series",m=c?.timeRange??this.getDefaultTimeRange(),{start:P,end:L}=this.datasource.getTimeRangeParams(m),j={"match[]":s,start:P,end:L};return await this.request(d,j)},this.datasource=a,this.labelKeys=[],Object.assign(this,r)}getLabelKeys(){return this.labelKeys}importFromAbstractQuery(a){return{refId:a.refId,expr:(0,z.tt)(a),queryType:O.U3.Range}}exportToAbstractQuery(a){if(!a.expr||a.expr.length===0)return{refId:a.refId,labelMatchers:[]};const s=(0,J.pk)(a.expr).map(c=>(0,g.u_)(c).query.labels.map(P=>({name:P.label,value:P.value,operator:z.sM[P.op]})));return{refId:a.refId,labelMatchers:(0,Q.flatten)(s)}}async fetchLabels(a){if(!a||!a.streamSelector)return this.fetchLabelsByLabelsEndpoint(a);{const r=await this.fetchSeriesLabels(a.streamSelector,{timeRange:a.timeRange});return Object.keys(r??{})}}async fetchLabelsByLabelsEndpoint(a){const r="labels",s=a?.timeRange??this.getDefaultTimeRange(),c=this.datasource.getTimeRangeParams(s),d=await this.request(r,c);if(Array.isArray(d)){const m=d.slice().sort().filter(P=>P!=="__name__");return this.labelKeys=m,this.labelKeys}return[]}generateCacheKey(a,r,s,c){return[a,this.roundTime(r),this.roundTime(s),c].join()}roundTime(a){return a?Math.floor(a/F/1e3/60/5):0}async fetchLabelValues(a,r){const s=encodeURIComponent(this.datasource.interpolateString(a)),c=r?.streamSelector&&r.streamSelector!==_?this.datasource.interpolateString(r.streamSelector):void 0,d=`label/${s}/values`,m=r?.timeRange??this.getDefaultTimeRange(),P=this.datasource.getTimeRangeParams(m),{start:L,end:j}=P,q={start:L,end:j};let H=s;c&&(q.query=c,H+=c);const ee=this.generateCacheKey(d,L,j,H),oe=this.labelsCache.get(ee);if(oe)return oe;let we=this.labelsPromisesCache.get(ee);return we||(we=new Promise(async Te=>{try{const Ie=await this.request(d,q);if(Array.isArray(Ie)){const Re=Ie.slice().sort();this.labelsCache.set(ee,Re),this.labelsPromisesCache.delete(ee),Te(Re)}}catch(Ie){console.error(Ie),Te([])}}),this.labelsPromisesCache.set(ee,we),we)}async getParserAndLabelKeys(a,r){const s={extractedLabelKeys:[],structuredMetadataKeys:[],unwrapLabelKeys:[],hasJSON:!1,hasLogfmt:!1,hasPack:!1};if(!Se.$.featureToggles.lokiQueryHints)return s;const c=await this.datasource.getDataSamples({expr:a,refId:"data-samples",maxLines:r?.maxLines||St},r?.timeRange??this.getDefaultTimeRange());if(!c.length)return s;const{hasLogfmt:d,hasJSON:m,hasPack:P}=(0,$.YB)(c[0]);return{extractedLabelKeys:[...(0,$.fV)(c[0],O.HD.Indexed),...(0,$.fV)(c[0],O.HD.Parsed)],structuredMetadataKeys:(0,$.fV)(c[0],O.HD.StructuredMetadata),unwrapLabelKeys:(0,$.aN)(c[0]),hasJSON:m,hasPack:P,hasLogfmt:d}}getDefaultTimeRange(){return(0,Y.E2)()}}var ye=l(39697),ie=l(37748),Ne=l(69862),Ue=l(69850),tt=l(31635),dt=l(13752),Ot=l(75508),Ct=l(88483),Bt=l(64423),Wt=l(39741),Dt={url:"",deserializer:function(v){return JSON.parse(v.data)},serializer:function(v){return JSON.stringify(v)}},Qr="WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }",Tr=function(v){(0,tt.__extends)(a,v);function a(r,s){var c=v.call(this)||this;if(c._socket=null,r instanceof Ct.c)c.destination=s,c.source=r;else{var d=c._config=(0,tt.__assign)({},Dt);if(c._output=new dt.B,typeof r=="string")d.url=r;else for(var m in r)r.hasOwnProperty(m)&&(d[m]=r[m]);if(!d.WebSocketCtor&&WebSocket)d.WebSocketCtor=WebSocket;else if(!d.WebSocketCtor)throw new Error("no WebSocket constructor can be found");c.destination=new Wt.m}return c}return a.prototype.lift=function(r){var s=new a(this._config,this.destination);return s.operator=r,s.source=this,s},a.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new Wt.m),this._output=new dt.B},a.prototype.multiplex=function(r,s,c){var d=this;return new Ct.c(function(m){try{d.next(r())}catch(L){m.error(L)}var P=d.subscribe({next:function(L){try{c(L)&&m.next(L)}catch(j){m.error(j)}},error:function(L){return m.error(L)},complete:function(){return m.complete()}});return function(){try{d.next(s())}catch(L){m.error(L)}P.unsubscribe()}})},a.prototype._connectSocket=function(){var r=this,s=this._config,c=s.WebSocketCtor,d=s.protocol,m=s.url,P=s.binaryType,L=this._output,j=null;try{j=d?new c(m,d):new c(m),this._socket=j,P&&(this._socket.binaryType=P)}catch(H){L.error(H);return}var q=new Bt.yU(function(){r._socket=null,j&&j.readyState===1&&j.close()});j.onopen=function(H){var ee=r._socket;if(!ee){j.close(),r._resetState();return}var oe=r._config.openObserver;oe&&oe.next(H);var we=r.destination;r.destination=Ot.vU.create(function(Te){if(j.readyState===1)try{var Ie=r._config.serializer;j.send(Ie(Te))}catch(Re){r.destination.error(Re)}},function(Te){var Ie=r._config.closingObserver;Ie&&Ie.next(void 0),Te&&Te.code?j.close(Te.code,Te.reason):L.error(new TypeError(Qr)),r._resetState()},function(){var Te=r._config.closingObserver;Te&&Te.next(void 0),j.close(),r._resetState()}),we&&we instanceof Wt.m&&q.add(we.subscribe(r.destination))},j.onerror=function(H){r._resetState(),L.error(H)},j.onclose=function(H){j===r._socket&&r._resetState();var ee=r._config.closeObserver;ee&&ee.next(H),H.wasClean?L.complete():L.error(H)},j.onmessage=function(H){try{var ee=r._config.deserializer;L.next(ee(H))}catch(oe){L.error(oe)}}},a.prototype._subscribe=function(r){var s=this,c=this.source;return c?c.subscribe(r):(this._socket||this._connectSocket(),this._output.subscribe(r),r.add(function(){var d=s._socket;s._output.observers.length===0&&(d&&(d.readyState===1||d.readyState===0)&&d.close(),s._resetState())}),r)},a.prototype.unsubscribe=function(){var r=this._socket;r&&(r.readyState===1||r.readyState===0)&&r.close(),this._resetState(),v.prototype.unsubscribe.call(this)},a}(dt.k);function wa(v){return new Tr(v)}var pr=l(33526),Je=l(11261),Fa=l(38823),Yr=l(8227);function Jr(v){if(!(0,Yr.A)(v))throw TypeError("Invalid UUID");let a;const r=new Uint8Array(16);return r[0]=(a=parseInt(v.slice(0,8),16))>>>24,r[1]=a>>>16&255,r[2]=a>>>8&255,r[3]=a&255,r[4]=(a=parseInt(v.slice(9,13),16))>>>8,r[5]=a&255,r[6]=(a=parseInt(v.slice(14,18),16))>>>8,r[7]=a&255,r[8]=(a=parseInt(v.slice(19,23),16))>>>8,r[9]=a&255,r[10]=(a=parseInt(v.slice(24,36),16))/1099511627776&255,r[11]=a/4294967296&255,r[12]=a>>>24&255,r[13]=a>>>16&255,r[14]=a>>>8&255,r[15]=a&255,r}const qr=Jr;function ea(v){v=unescape(encodeURIComponent(v));const a=[];for(let r=0;r<v.length;++r)a.push(v.charCodeAt(r));return a}const Ca="6ba7b810-9dad-11d1-80b4-00c04fd430c8",Da="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function lt(v,a,r){function s(c,d,m,P){var L;if(typeof c=="string"&&(c=ea(c)),typeof d=="string"&&(d=qr(d)),((L=d)===null||L===void 0?void 0:L.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let j=new Uint8Array(16+c.length);if(j.set(d),j.set(c,d.length),j=r(j),j[6]=j[6]&15|a,j[8]=j[8]&63|128,m){P=P||0;for(let q=0;q<16;++q)m[P+q]=j[q];return m}return(0,Fa.k)(j)}try{s.name=v}catch{}return s.DNS=Ca,s.URL=Da,s}function At(v,a,r,s){switch(v){case 0:return a&r^~a&s;case 1:return a^r^s;case 2:return a&r^a&s^r&s;case 3:return a^r^s}}function wr(v,a){return v<<a|v>>>32-a}function Fr(v){const a=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof v=="string"){const m=unescape(encodeURIComponent(v));v=[];for(let P=0;P<m.length;++P)v.push(m.charCodeAt(P))}else Array.isArray(v)||(v=Array.prototype.slice.call(v));v.push(128);const s=v.length/4+2,c=Math.ceil(s/16),d=new Array(c);for(let m=0;m<c;++m){const P=new Uint32Array(16);for(let L=0;L<16;++L)P[L]=v[m*64+L*4]<<24|v[m*64+L*4+1]<<16|v[m*64+L*4+2]<<8|v[m*64+L*4+3];d[m]=P}d[c-1][14]=(v.length-1)*8/Math.pow(2,32),d[c-1][14]=Math.floor(d[c-1][14]),d[c-1][15]=(v.length-1)*8&4294967295;for(let m=0;m<c;++m){const P=new Uint32Array(80);for(let oe=0;oe<16;++oe)P[oe]=d[m][oe];for(let oe=16;oe<80;++oe)P[oe]=wr(P[oe-3]^P[oe-8]^P[oe-14]^P[oe-16],1);let L=r[0],j=r[1],q=r[2],H=r[3],ee=r[4];for(let oe=0;oe<80;++oe){const we=Math.floor(oe/20),Te=wr(L,5)+At(we,j,q,H)+ee+a[we]+P[oe]>>>0;ee=H,H=q,q=wr(j,30)>>>0,j=L,L=Te}r[0]=r[0]+L>>>0,r[1]=r[1]+j>>>0,r[2]=r[2]+q>>>0,r[3]=r[3]+H>>>0,r[4]=r[4]+ee>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,r[0]&255,r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,r[1]&255,r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,r[2]&255,r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,r[3]&255,r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,r[4]&255]}const Ma=lt("v5",80,Fr),ta="6ec946da-0f49-47a8-983a-1d76d17e7c92";function jt(v,a){const r=v.streams;if(!r||!r.length)return;const s=a.fields[0],c=a.fields[1],d=a.fields[2],m={};for(const P of r){const L=Object.entries(P.stream).map(([j,q])=>`${j}="${q}"`).sort().join("");for(const[j,q]of P.values)s.values.push(new Date(parseInt(j.slice(0,-6),10)).toISOString()),c.values.push(q),d.values.push(It(j,L,q,m,a.refId))}}function It(v,a,r,s,c){let d=Ma(`${v}_${a}_${r}`,ta);if(d in s){const m=s[d]+1;s[d]=m,d=`${d}_${m}`}else s[d]=0;return c?`${c}_${d}`:d}class yt{constructor(){this.streams={}}getStream(a,r=5e3){let s=this.streams[a.url];if(s)return s;const c=new pr.x({capacity:a.size});return c.addField({name:"Time",type:Je.PU.time,config:{}}),c.addField({name:"Line",type:Je.PU.string}),c.addField({name:"id",type:Je.PU.string}),c.meta={...c.meta,preferredVisualisationType:"logs"},c.refId=a.refId,s=wa(a.url).pipe((0,K.T)(d=>(jt(d,c),[c])),(0,ie.l)(d=>d.pipe((0,Ne.Z)((m,P)=>{const L=P+1;return m.code===1006&&L<30?(L>10&&console.warn(`Websocket connection is being disrupted. We keep reconnecting but consider starting new live tailing again. Error: ${m.reason}`),(0,ye.O)(r)):(0,Oe.$)(m)}))),(0,Ue.j)(()=>{delete this.streams[a.url]})),this.streams[a.url]=s,s}}var ct=l(47232),ra=l(85404),Ae=l(74848),ft=l(32196),Ye=l(96540),Cr=l(16817),aa=l(36663),ja=l(92762),mt=l(14110),qt=l(40845),er=l(42418),na=l(56034),sa=l(55852),Dr=l(82762),ia=l(14578),oa=l(62930),Ar=l(60029),Vt=l(90182),Xt=l(39268),hr=l(14186),tr=l(44522),la=l(15292),gr=l(71713);function ca(v){return{labels:(0,ft.css)`
      display: flex;
      gap: ${v.spacing(.5)};
    `,wrapper:(0,ft.css)`
      display: flex;
      flex-direction: column;
      flex: 1;
      gap: ${v.spacing(.5)};
      position: relative;
    `,textWrapper:(0,ft.css)`
      display: flex;
      align-items: center;
    `,hidden:(0,ft.css)`
      visibility: hidden;
    `,label:(0,ft.css)`
      max-width: 100%;
      &:first-of-type {
        margin-bottom: ${v.spacing(2)};
      }
      &:not(:first-of-type) {
        margin: ${v.spacing(2)} 0;
      }
    `,rawQueryContainer:(0,ft.css)`
      text-align: start;
      line-break: anywhere;
      margin-top: -${v.spacing(.25)};
      margin-right: ${v.spacing(6)};
      min-height: ${v.spacing(4)};
    `,ui:(0,ft.css)`
      background-color: ${v.colors.background.secondary};
      padding: ${v.spacing(2)};
    `,notification:(0,ft.css)({position:"absolute",zIndex:v.zIndex.portal,top:0,right:0}),rawQuery:(0,ft.css)`
      display: inline;
    `,queryDescription:(0,ft.css)`
      margin-left: ${v.spacing(.5)};
    `,iconButton:(0,ft.css)`
      position: absolute;
      top: ${v.spacing(1)};
      right: ${v.spacing(1)};
      z-index: ${v.zIndex.navbarFixed};
    `,operationsToggle:(0,ft.css)`
      margin: ${v.spacing(1)} 0 ${v.spacing(-1)} 0;
      & > div {
        margin: 0;
        & > label {
          padding: 0;
        }
      }
    `}}const ua="isLogContextQueryUiOpen";function rr(v){const{row:a,logContextProvider:r,updateFilter:s,onClose:c,origQuery:d,runContextQuery:m}=v,P=(0,qt.of)(ca),[L,j]=(0,Ye.useState)([]),[q,H]=(0,Ye.useState)(!1),[ee,oe]=(0,Ye.useState)(!1),[we,Te]=(0,Ye.useState)(!1),[Ie,Re]=(0,Ye.useState)(window.localStorage.getItem(ua)==="true"),[Ve,qe]=(0,Ye.useState)(window.localStorage.getItem(nt)==="true"),Xe=(0,Ye.useRef)(),et=(0,Ye.useRef)(!1),$t=(0,Ye.useRef)([]),Rt=(0,Ye.useMemo)(()=>!(ee&&L.some(We=>We.nonIndexed===We.enabled)||Ve&&r.queryContainsValidPipelineStages(d)),[L,Ve,ee,r,d]);(0,Ye.useEffect)(()=>{if(ee){if(!et.current){et.current=ee;return}if(L.filter(({enabled:We,nonIndexed:ut})=>We&&!ut).length===0){j($t.current);return}return $t.current=structuredClone(L),Xe.current&&clearTimeout(Xe.current),Te(!0),Xe.current=window.setTimeout(()=>{s(L.filter(({enabled:ut})=>ut));const We={removedLabels:[],selectedExtractedLabels:[]};L.forEach(({enabled:ut,nonIndexed:at,label:ur})=>{!ut&&!at&&We.removedLabels.push(ur),ut&&at&&We.selectedExtractedLabels.push(ur)}),window.localStorage.setItem(bt,JSON.stringify(We)),Te(!1)},1500),()=>{clearTimeout(Xe.current)}}},[L,ee]),(0,Ye.useEffect)(()=>()=>{clearTimeout(Xe.current),c()},[c]),(0,Cr.A)(async()=>{Te(!0);const We=await r.getInitContextFilters(a,d,{from:(0,ct.KQ)(a.timeEpochMs),to:(0,ct.KQ)(a.timeEpochMs),raw:{from:(0,ct.KQ)(a.timeEpochMs),to:(0,ct.KQ)(a.timeEpochMs)}});j(We.contextFilters),H(We.preservedFiltersApplied),oe(!0),Te(!1)}),(0,Ye.useEffect)(()=>{q&&setTimeout(()=>{H(!1)},2e3)},[q]),(0,Ye.useEffect)(()=>((0,mt.rR)("grafana_explore_logs_loki_log_context_loaded",{logRowUid:a.uid,type:"load"}),()=>{(0,mt.rR)("grafana_explore_logs_loki_log_context_loaded",{logRowUid:a.uid,type:"unload"})}),[a.uid]);const _t=L.filter(({nonIndexed:We})=>!We),kr=_t.filter(({enabled:We})=>We),cr=L.filter(({nonIndexed:We})=>We),cn=cr.filter(({enabled:We})=>We),zr=(0,Ye.useCallback)(We=>({label:`${We.label}="${(0,z.Bb)(We.value)}"`,value:We.label}),[]),un=cr.length>0;let dn=r.prepareExpression(L.filter(({enabled:We})=>We),d);return(0,Ae.jsxs)("div",{className:P.wrapper,children:[q&&(0,Ae.jsx)(er.F,{className:P.notification,title:"Previously used filters have been applied.",severity:"info",elevated:!0}),(0,Ae.jsx)(na.m,{content:"Revert to initial log context query.",children:(0,Ae.jsx)("div",{className:P.iconButton,children:(0,Ae.jsx)(sa.$n,{"data-testid":"revert-button",icon:"history-alt",variant:"secondary",disabled:Rt,onClick:We=>{(0,mt.rR)("grafana_explore_logs_loki_log_context_reverted",{logRowUid:a.uid}),j(ut=>ut.map(at=>({...at,enabled:!at.nonIndexed}))),window.localStorage.removeItem(bt),window.localStorage.removeItem(nt),qe(!1)}})})}),(0,Ae.jsx)(Dr.S,{collapsible:!0,isOpen:Ie,onToggle:()=>{window.localStorage.setItem(ua,(!Ie).toString()),Re(We=>!We),(0,mt.rR)("grafana_explore_logs_loki_log_context_toggled",{logRowUid:a.uid,action:Ie?"close":"open"})},label:(0,Ae.jsx)("div",{className:P.rawQueryContainer,children:ee?(0,Ae.jsxs)(Ae.Fragment,{children:[(0,Ae.jsx)(ja.Z,{language:{grammar:gr.vB,name:"loki"},query:dn,className:P.rawQuery}),(0,Ae.jsx)(na.m,{content:"The initial log context query is created from all labels defining the stream for the selected log line. Use the editor below to customize the log context query.",children:(0,Ae.jsx)(ia.I,{name:"info-circle",size:"sm",className:P.queryDescription})})]}):(0,Ae.jsx)(oa.y,{})}),children:(0,Ae.jsxs)("div",{className:P.ui,children:[(0,Ae.jsx)(Ar.J,{className:P.label,description:"The initial log context query is created from all labels defining the stream for the selected log line. You can broaden your search by removing one or more of the label filters.",children:"Widen the search"}),(0,Ae.jsx)(Vt.KF,{isLoading:we,options:_t.map(zr),value:kr.map(zr),closeMenuOnSelect:!0,maxMenuHeight:200,noOptionsMessage:"No further labels available",onChange:(We,ut)=>(ut.action==="select-option"&&(0,mt.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:a.uid,type:"label",action:"select"}),ut.action==="remove-value"&&(0,mt.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:a.uid,type:"label",action:"remove"}),j(L.map(at=>(at.nonIndexed||(at.enabled=We.some(ur=>ur.value===at.label)),at))))}),un&&(0,Ae.jsxs)(Ae.Fragment,{children:[(0,Ae.jsx)(Ar.J,{className:P.label,description:"By using a parser in your original query, you can use filters for extracted labels. Refine your search by applying extracted labels created from the selected log line.",children:"Refine the search"}),(0,Ae.jsx)(Vt.KF,{isLoading:we,options:cr.map(zr),value:cn.map(zr),closeMenuOnSelect:!0,maxMenuHeight:200,noOptionsMessage:"No further labels available",isClearable:!0,onChange:(We,ut)=>{ut.action==="select-option"&&(0,mt.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:a.uid,type:"parsed_label",action:"select"}),ut.action==="remove-value"&&(0,mt.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:a.uid,type:"parsed_label",action:"remove"}),j(L.map(at=>(at.nonIndexed&&(at.enabled=We.some(ur=>ur.value===at.label)),at)))}})]}),r.queryContainsValidPipelineStages(d)&&(0,Ae.jsx)(Xt.C,{className:P.operationsToggle,children:(0,Ae.jsx)(hr.I,{label:"Include LogQL pipeline operations",tooltip:(0,Ae.jsx)(tr.I,{content:(0,aa.G)("This will include LogQL operations such as `line_format` or `label_format`. It won't include line or label filter operations.")}),children:(0,Ae.jsx)(la.K,{value:Ve,showLabel:!0,transparent:!0,onChange:We=>{(0,mt.rR)("grafana_explore_logs_loki_log_context_pipeline_toggled",{logRowUid:a.uid,action:We.currentTarget.checked?"enable":"disable"}),window.localStorage.setItem(nt,We.currentTarget.checked.toString()),qe(We.currentTarget.checked),m&&m()}})})})]})})]})}var ke=l(12798),Mr=(v=>(v[v.Ascending=0]="Ascending",v[v.Descending=1]="Descending",v))(Mr||{});function Qt(v,a){const r=v.values,{nanos:s}=v,c=Array(r.length);for(let m=0;m<c.length;m++)c[m]=m;const d=a===0;return c.sort((m,P)=>{const L=r[m],j=r[P];if(L<j)return d?-1:1;if(L>j)return d?1:-1;if(s===void 0)return 0;const q=s[m],H=s[P];return q<H?d?-1:1:q>H?d?1:-1:0}),c}function da(v,a){const{fields:r,...s}=v,c=r.find(m=>m.type===Je.PU.time);if(c===void 0)throw new Error("missing timestamp field. should never happen");const d=Qt(c,a);return{...s,fields:r.map(m=>({...m,values:it(m.values,d),nanos:m.nanos===void 0?void 0:it(m.nanos,d)}))}}function it(v,a){return v.map((r,s)=>v[a[s]])}const bt="lokiLogContextPreservedLabels",nt="lokiLogContextShouldIncludePipelineOperations";class mr{constructor(a){this.getLogRowContextQuery=async(r,s,c,d=!0)=>{const{query:m}=await this.getQueryAndRange(r,s,c,d);return d||(this.cachedContextFilters=[]),m},this.getLogRowContext=async(r,s,c)=>{const d=s&&s.direction||R.ZF.Backward,{query:m,range:P}=await this.getQueryAndRange(r,s,c),L=q=>{const ee=q.data.map(oe=>da(oe,Mr.Descending));return{...q,data:ee}},j=de.Jk.Explore;return(0,h.s)(this.datasource.query(xr(m,P,j,`${Xr}${d}`)).pipe((0,i.W)(q=>{throw{message:"Error during context query. Please check JS console logs.",status:q.status,statusText:q.statusText}}),(0,D.n)(q=>(0,o.of)(L(q)))))},this.processContextFiltersToExpr=(r,s)=>{let d=`{${r.map(m=>!m.nonIndexed&&m.enabled?`${m.label}="${(0,z.Qn)(m.value)}"`:"").filter(m=>!!m).join(",")}}`;if(s){let m=!1;if((0,J.MX)(s.expr).parserCount===1){m=!0;const L=(0,J.aw)(s.expr);L&&(d=(0,ke.aH)(d,L))}const P=r.filter(L=>L.nonIndexed&&L.enabled);for(const L of P)L.enabled&&(d=(0,ke.tE)(d,L.label,"=",L.value,m?O.HD.Parsed:O.HD.StructuredMetadata))}return d},this.processPipelineStagesToExpr=(r,s)=>{let c=r;const d=s?.expr??"";if((0,J.MX)(d).parserCount>1)return c;const m=(0,J.TQ)(d,[I.t3,I.iT,I.c$,I.LM,I.CX,I.bY]),P=m.filter(j=>j.type?.id===I.t3),L=m.filter(j=>j.type?.id!==I.t3);for(const j of P)L.some(q=>j.contains(q))||(c+=` ${j.getExpression(d)}`);return c},this.queryContainsValidPipelineStages=r=>{const s=r?.expr??"",c=(0,J.TQ)(s,[I.t3,I.iT,I.CX,I.bY]),d=c.filter(P=>P.type?.id===I.t3),m=c.filter(P=>P.type?.id!==I.t3);return d.some(P=>m.every(L=>P.contains(L)===!1))},this.getInitContextFilters=async(r,s,c)=>{let d=!1;if(!s||(0,Q.isEmpty)(r.labels))return{contextFilters:[],preservedFiltersApplied:d};const m=r.labels;let P=[];if(!(0,J.MX)(s.expr).queryWithParser)await this.datasource.languageProvider.start(c),P=this.datasource.languageProvider.getLabelKeys();else{const H=(0,J.pk)(s.expr);P=await this.datasource.languageProvider.fetchLabels({streamSelector:H[0],timeRange:c})}const L=[];Object.entries(m).forEach(([H,ee])=>{const oe=(0,z.Ed)(H,r.dataFrame,r.rowIndex),we={label:H,value:ee,enabled:P.includes(H),nonIndexed:oe!==null&&oe!==O.HD.Indexed};L.push(we)});let j;const q=window.localStorage.getItem(bt);if(q)try{j=JSON.parse(q)}catch{}if(j){let H=!1;const ee=L.map(we=>j.removedLabels.includes(we.label)?(H=!0,{...we,enabled:!1}):j.selectedExtractedLabels.includes(we.label)?(H=!0,{...we,enabled:!0}):{...we});return ee.some(({enabled:we,nonIndexed:Te})=>we&&!Te)?(H&&(d=!0),{contextFilters:ee,preservedFiltersApplied:d}):{contextFilters:L,preservedFiltersApplied:d}}else return{contextFilters:L,preservedFiltersApplied:d}},this.datasource=a,this.cachedContextFilters=[]}async getQueryAndRange(a,r,s,c=!0){const d=r&&r.direction||R.ZF.Backward,m=r&&r.limit||this.datasource.maxLines;if(this.cachedContextFilters.length===0||!c){const P=(await this.getInitContextFilters(a,s,{from:(0,ct.KQ)(a.timeEpochMs),to:(0,ct.KQ)(a.timeEpochMs),raw:{from:(0,ct.KQ)(a.timeEpochMs),to:(0,ct.KQ)(a.timeEpochMs)}})).contextFilters.filter(L=>L.enabled);this.cachedContextFilters=P}return await this.prepareLogRowContextQueryTarget(a,m,d,s)}async prepareLogRowContextQueryTarget(a,r,s,c){const d=this.prepareExpression(this.cachedContextFilters,c),m=2*60*60*1e3,P=s===R.ZF.Forward?O.ti.Forward:O.ti.Backward,L={expr:d,queryType:O.U3.Range,refId:`${Xr}_${Math.random().toString()}`,maxLines:r,direction:P,datasource:{uid:this.datasource.uid,type:this.datasource.type}},q=new ra.L(a.dataFrame).getFirstFieldOfType(Je.PU.time);if(q===void 0)throw new Error("loki: data frame missing time-field, should never happen");const H=q.values[a.rowIndex],ee=(0,ct.yT)(H),oe=P===O.ti.Forward?{from:ee,to:(0,ct.yT)(a.timeEpochMs+m)}:{from:(0,ct.yT)(a.timeEpochMs-m),to:ee};return{query:L,range:{from:oe.from,to:oe.to,raw:oe}}}getLogRowContextUi(a,r,s){const c=d=>{this.cachedContextFilters=d,r&&r()};return this.onContextClose=this.onContextClose??(()=>{this.cachedContextFilters=[]}),rr({row:a,origQuery:s,updateFilter:c,onClose:this.onContextClose,logContextProvider:this,runContextQuery:r})}prepareExpression(a,r){let s=this.processContextFiltersToExpr(a,r);return window.localStorage.getItem(nt)==="true"&&(s=this.processPipelineStagesToExpr(s,r)),s}}var Tt=l(65474),ar=l(29505),kt=l(84596),zt=l(10354);const vr=/^label_names\(\)\s*$/,Nt=/^label_values\((?:(.+),\s*)?([a-zA-Z_$][a-zA-Z0-9_]*)\)\s*$/;function jr(v){if(typeof v!="string")return v;const a={refId:"LokiVariableQueryEditor-VariableQuery",type:O.ie.LabelNames};if(v.match(vr))return{...a,type:O.ie.LabelNames};const s=v.match(Nt);return s?{...a,type:O.ie.LabelValues,label:s[2]?s[2]:s[1],stream:s[2]?s[1]:void 0}:a}const Ia=[{label:"Label names",value:O.ie.LabelNames},{label:"Label values",value:O.ie.LabelValues}],Na="LokiVariableQueryEditor-VariableQuery",xt=({onChange:v,query:a,datasource:r,range:s})=>{const[c,d]=(0,Ye.useState)(void 0),[m,P]=(0,Ye.useState)(""),[L,j]=(0,Ye.useState)([]),[q,H]=(0,Ye.useState)(""),ee=(0,kt.A)(c);(0,Ye.useEffect)(()=>{if(!a)return;const Re=typeof a=="string"?jr(a):a;d(Re.type),P(Re.label||""),H(Re.stream||"")},[a]),(0,Ye.useEffect)(()=>{c!==O.ie.LabelValues||ee===c||r.languageProvider.fetchLabels({timeRange:s}).then(Re=>{j(Re.map(Ve=>({label:Ve,value:Ve})))})},[r,c,s,ee]);const oe=Re=>{d(Re.value),Re.value!==void 0&&v({type:Re.value,label:m,stream:q,refId:Na})},we=Re=>{P(Re.value||"")},Te=Re=>{H(Re.currentTarget.value)},Ie=()=>{c!==void 0&&v({type:c,label:m,stream:q,refId:"LokiVariableQueryEditor-VariableQuery"})};return(0,Ae.jsxs)(Ae.Fragment,{children:[(0,Ae.jsxs)(Xt.C,{children:[(0,Ae.jsx)(hr.I,{label:"Query type",labelWidth:20,children:(0,Ae.jsx)(Vt.l6,{"aria-label":"Query type",onChange:oe,onBlur:Ie,value:c,options:Ia,width:16})}),c===O.ie.LabelValues&&(0,Ae.jsx)(Ae.Fragment,{children:(0,Ae.jsx)(hr.I,{label:"Label",labelWidth:20,children:(0,Ae.jsx)(Vt.l6,{"aria-label":"Label",onChange:we,onBlur:Ie,value:{label:m,value:m},options:L,width:16,allowCustomValue:!0})})})]}),c===O.ie.LabelValues&&(0,Ae.jsx)(Xt.C,{children:(0,Ae.jsx)(hr.I,{label:"Stream selector",labelWidth:20,grow:!0,tooltip:(0,Ae.jsx)("div",{children:'Optional. If defined, a list of values for the specified log stream selector is returned. For example: {label="value"} or {label="$variable"}'}),children:(0,Ae.jsx)(zt.p,{type:"text","aria-label":"Stream selector",placeholder:"Optional stream selector",value:q,onChange:Te,onBlur:Ie})})})]})};class wt extends ar.f5{constructor(a){super(),this.datasource=a,this.editor=xt}async execute(a,r,s){return this.datasource.metricFindQuery(a,{scopedVars:r,range:s})}query(a){const r=this.execute(a.targets[0],a.scopedVars,a.range);return(0,Tt.H)(r).pipe((0,K.T)(s=>({data:s})))}}var Ir=l(14236),Et=l(19347);function Or(v,a){if(!a.length)return[];const r=(0,Q.groupBy)(a,"name"),s=Object.values(r).map(_a),c=v.fields.find(m=>m.type===Je.PU.string);if(c===void 0)throw new Error("invalid logs-dataframe, string-field missing");const d=v.fields.find(m=>m.type===Je.PU.other&&m.name==="labels");for(let m=0;m<c.values.length;m++)for(const P of s)if(r[P.name][0].matcherType==="label"&&d){const L=d.values[m];if(L){const j=Object.keys(L).find(q=>r[P.name][0].matcherRegex===q);if(j){P.values.push(L[j]);continue}}P.values.push(null)}else if(r[P.name][0].matcherType==="regex"||r[P.name][0].matcherType===void 0){const j=c.values[m].match(r[P.name][0].matcherRegex);if(j&&j[1]){P.values.push(j[1]);continue}P.values.push(null)}else P.values.push(null);return s}function _a(v){const a=(0,Et.l)(),r=v.reduce((s,c)=>{if(c.datasourceUid){const d=a.getInstanceSettings(c.datasourceUid),m=P=>{switch(P){case"tempo":return"traceql";case"grafana-x-ray-datasource":return"getTrace";default:return}};s.push({title:c.urlDisplayLabel||"",url:"",internal:{query:{query:c.url,queryType:m(d?.type)},datasourceUid:c.datasourceUid,datasourceName:d?.name??"Data source not found"}})}else c.url&&s.push({title:c.urlDisplayLabel||"",url:c.url});return s},[]);return{name:v[0].name,type:Je.PU.string,config:{links:r},values:[]}}function Ua(v){const a=v.filter(s=>s.refId!==void 0),r=(0,Q.groupBy)(a,s=>s.refId);return Object.entries(r).map(([s,c])=>yr(c,s))}function yr(v,a){const r={name:"Time",config:{},values:[],type:Je.PU.time},s={name:`Value #${a}`,config:{},values:[],type:Je.PU.number},c=new Set(v.map(P=>P.fields.map(L=>Object.keys(L.labels??{})).flat()).flat()),m=Array.from(c).sort().map(P=>({name:P,config:{filterable:!0},values:[],type:Je.PU.string}));return v.forEach(P=>{const L=P.fields.find(oe=>oe.type===Je.PU.time),j=P.fields.find(oe=>oe.type===Je.PU.number);if(L==null||j==null)return;const q=L.values,H=j.values;for(let oe of q)r.values.push(oe);for(let oe of H)s.values.push(oe);const ee=j.labels??{};for(let oe of m){const we=ee[oe.name]??"";for(let Te=0;Te<H.length;Te++)oe.values.push(we)}}),{fields:[r,...m,s],refId:a,meta:{preferredVisualisationType:"table"},length:r.values.length}}function nr(v){return v.fields.every(a=>a.type===Je.PU.time||a.type===Je.PU.number)}function Nr(v,a){const{meta:r,...s}=v,c={...r,...a};return{...s,meta:c}}function Kt(v,a,r){const s={...v.meta?.custom,lokiQueryStatKey:"Summary: total bytes processed"};(0,$.nE)(v)&&(s.error="Error when parsing some of the logs");const c={preferredVisualisationType:"logs",limit:a?.maxLines,searchWords:a?(0,J.H0)(a.expr):void 0,custom:s},d=Nr(v,c),m=Or(d,r);return{...d,fields:[...d.fields,...m]}}function Ba(v,a,r){return v.map(s=>{const c=s.refId!==void 0?a.get(s.refId):void 0;return Kt(s,c,r)})}function _r(v){return v.length>0?Ua(v):[]}function fa(v){const a={preferredVisualisationType:"graph"};return v.map(r=>Nr(r,a))}function Ht(v,a){const r=[],s=[],c=[];return v.forEach(d=>{nr(d)?d.refId!=null&&a.get(d.refId)?.queryType===O.U3.Instant?s.push(d):c.push(d):r.push(d)}),{streamsFrames:r,metricInstantFrames:s,metricRangeFrames:c}}function ot(v,a){if(v===void 0)return v;const{refId:r,message:s}=v;if(r===void 0||s===void 0)return v;const c=a.get(r);return c===void 0?v:s.includes("escape")&&c.expr.includes("\\")?{...v,message:`${s}. Make sure that all special characters are escaped with \\. For more information on escaping of special characters visit LogQL documentation at https://grafana.com/docs/loki/latest/logql/.`}:v}function pt(v,a,r){const{data:s,error:c,...d}=v,m=s.map(H=>{if(!(0,Ir.ci)(H))throw new Error("transformation only supports dataframe responses");return H}),P=new Map(a.map(H=>{const ee=v.data.find(we=>we.refId===H.refId)?.meta.executedQueryString,oe={...H,expr:ee?(0,J.mW)(ee):H.expr};return[H.refId,oe]})),{streamsFrames:L,metricInstantFrames:j,metricRangeFrames:q}=Ht(m,P);return{...d,error:ot(c,P),data:[...fa(q),..._r(j),...Ba(L,P,r)]}}var ht=l(9e4),rt=l(81580),sr=l(67061),Gt=l(60016),Zt=l(95881);const ir=(0,Ye.memo)(function(a){const{annotation:r,onAnnotationChange:s,history:c}=a;if(r===void 0||s===void 0)return null;const d=P=>{const L=(0,J.vV)(P).queryType===O.U3.Instant;s({...r,expr:P.expr,maxLines:P.maxLines,instant:L})},m={refId:"",expr:r.expr,maxLines:r.maxLines,instant:r.instant,queryType:r.queryType};return(0,Ae.jsxs)(sr.B,{gap:5,direction:"column",children:[(0,Ae.jsx)(sr.B,{gap:0,direction:"column",children:(0,Ae.jsx)(Zt.W,{datasource:a.datasource,query:m,onChange:d,onRunQuery:()=>{},history:c,ExtraFieldElement:(0,Ae.jsx)(Gt.kl,{lineLimitValue:m?.maxLines?.toString()||"",resolution:m.resolution||1,query:m,onRunQuery:()=>{},onChange:d})})}),(0,Ae.jsxs)(ht.U,{children:[(0,Ae.jsx)(rt.c,{label:"Title",tooltip:"Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance.",children:(0,Ae.jsx)(zt.p,{type:"text",placeholder:"alertname",value:r.titleFormat,onChange:P=>{s({...r,titleFormat:P.currentTarget.value})}})}),(0,Ae.jsx)(rt.c,{label:"Tags",children:(0,Ae.jsx)(zt.p,{type:"text",placeholder:"label1,label2",value:r.tagKeys,onChange:P=>{s({...r,tagKeys:P.currentTarget.value})}})}),(0,Ae.jsx)(rt.c,{label:"Text",tooltip:"Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance.",children:(0,Ae.jsx)(zt.p,{type:"text",placeholder:"instance",value:r.textFormat,onChange:P=>{s({...r,textFormat:P.currentTarget.value})}})})]})]})});var Ur=l(20065);function pa(v,a){if(a.length===0)return[];const r=[],{queryWithParser:s,parserCount:c}=(0,J.MX)(v);if(!s){const{hasLogfmt:P,hasJSON:L,hasPack:j}=(0,$.YB)(a[0]);L&&(j?r.push({type:"ADD_UNPACK_PARSER",label:"Selected log stream selector has packed logs.",fix:{title:"add unpack parser",label:"Consider using unpack parser.",action:{type:"ADD_UNPACK_PARSER",query:v}}}):r.push({type:"ADD_JSON_PARSER",label:"Selected log stream selector has JSON formatted logs.",fix:{title:"add json parser",label:"Consider using JSON parser.",action:{type:"ADD_JSON_PARSER",query:v}}})),P&&r.push({type:"ADD_LOGFMT_PARSER",label:"Selected log stream selector has logfmt formatted logs.",fix:{title:"add logfmt parser",label:"Consider using logfmt parser to turn key-value pairs in your log lines to labels.",action:{type:"ADD_LOGFMT_PARSER",query:v}}})}if(s){if(c===1){const L=(0,J.d_)(v);(0,$.db)(a[0])&&!L&&r.push({type:"ADD_NO_PIPELINE_ERROR",label:"Some logs in your selected log streams have parsing error.",fix:{title:"remove pipeline errors",label:"Consider filtering out logs with parsing errors.",action:{type:"ADD_NO_PIPELINE_ERROR",query:v}}})}(0,J.pS)(v)||r.push({type:"ADD_LABEL_FILTER",label:"Consider filtering logs by their label and value.",fix:{title:"add label filter",label:"",action:{type:"ADD_LABEL_FILTER",query:v}}})}if(!(0,J._i)(v)){const P=(0,$.Ac)(a[0]),L=(0,$.sz)(a[0]);!P&&L&&r.push({type:"ADD_LEVEL_LABEL_FORMAT",label:`Some logs in your selected log stream have "${L}" label.`,fix:{title:"add label level format",label:`If ${L} label has level values, consider using label_format to rename it to "level". Level label can be then visualized in log volumes.`,action:{type:"ADD_LEVEL_LABEL_FORMAT",query:v,options:{renameTo:"level",originalLabel:L}}}})}return(0,J.Rn)(v)||r.push({type:"ADD_LINE_FILTER",label:"Consider filtering logs for specific string.",fix:{title:"add line filter",label:"",action:{type:"ADD_LINE_FILTER",query:v}}}),r}var Yt=l(62938),Wa=l(33948),ha=l(52622),or=l(70416),Va=l(80822);function Xa(v,a,r){if(a-v<=r)return[[v,a]];const s=[];for(let c=a;c>v;c-=r){const d=Math.max(c-r,v);s.push([d,c])}return s.reverse(),s}function ka(v,a,r,s){if(s<r)return[[v,a]];const c=Math.trunc(s/r)*r,d=v-v%r,m=[];for(let P=d;P<a;P+=c){const L=Math.min(P+c-r,a);m.push([P,L])}return m}var ga=l(79007);function ma(v,a,r,s){const c=a.from.toDate().getTime(),d=a.to.toDate().getTime();return(v?Xa(c,d,s):ka(c,d,r,s)).map(([P,L])=>{const j=(0,ct.KQ)(P),q=(0,ct.KQ)(L);return{from:j,to:q,raw:{from:j,to:q}}})}function za(v,a){return a?v.map(r=>{if(!r.maxLines||!(0,J.sI)(r.expr))return r;const s=a.data.find(d=>d.refId===r.refId);if(!s)return r;const c=r.maxLines-s.length;return{...r,maxLines:c<0?0:c}}).filter(r=>r.maxLines===void 0||r.maxLines>0):v}function Ka(v,a){const r=a.length?a[0].request.queryGroupId:(0,Yt.A)();let s={data:[],state:le.Gu.Streaming,key:r};const c=Math.max(...a.map(({partition:q})=>q.length)),d=a.filter(({partition:q})=>q.length===c)[0].partition;let m=!1,P=null;const L=(q,H,ee)=>{if(m){q.complete();return}const oe=()=>{s.state=le.Gu.Done,q.next(s),q.complete()},we=()=>{const{nextRequestN:qe,nextRequestGroup:Xe}=Ha(a,ee,H);if(qe>0&&Xe>=0){L(q,qe,Xe);return}oe()},Te=a[ee],Ie=Te.partition[H-1],Re=za(Te.request.targets,s);if(!Re.length){we();return}const Ve={...a[ee].request,range:Ie,targets:Re};Te.request.requestId&&(Ve.requestId=`${Te.request.requestId}_${H}`),P=v.runQuery(Ve).subscribe({next:qe=>{s=(0,Va.Wn)(s,qe),s=va(s,Ve,d,H),((s.errors??[]).length>0||s.error!=null)&&(m=!0)},complete:()=>{q.next(s),we()},error:qe=>{q.error(qe)}})};return new Ct.c(q=>(L(q,c,0),()=>{m=!0,P?.unsubscribe()}))}const Br="loki-splitting-progress";function va(v,a,r,s){if((0,J.sI)(a.targets[0].expr)||(v.data=v.data.filter(d=>d.name!==Br),s<=1))return v;const c=(0,Wa.I)([{time:r[0].from.valueOf(),timeEnd:r[s-2].to.valueOf(),isRegion:!0,color:"rgba(120, 120, 120, 0.1)"}]);return c.name=Br,c.meta={dataTopic:ha.QR.Annotations},v.data.push(c),v}function Ha(v,a,r){for(let s=a+1;s<v.length;s++)if(v[s].partition[r-1])return{nextRequestGroup:s,nextRequestN:r};return{nextRequestGroup:v.findIndex(s=>s?.partition[r-1]!==void 0),nextRequestN:r-1}}function Oa(v){return v.queryType!==O.U3.Instant&&!(0,J.Cg)(v.expr)}function ya(v,a){const r=a.targets.filter(ee=>!ee.hide).filter(ee=>ee.expr),[s,c]=(0,Q.partition)(r,ee=>!Oa(ee)),[d,m]=(0,Q.partition)(c,ee=>(0,J.sI)(ee.expr));a.queryGroupId=(0,Yt.A)();const P=24*60*60*1e3,L=(0,Q.groupBy)(d,ee=>ee.direction===O.ti.Forward?O.ti.Forward:O.ti.Backward),j=[];for(const ee in L){const oe=(0,Q.groupBy)(L[ee],we=>we.splitDuration?(0,or.WT)((0,or.E9)(we.splitDuration)):P);for(const[we,Te]of Object.entries(oe)){const Ie=(0,Q.groupBy)(Te,Re=>Re.resolution||1);for(const Re in Ie){const Ve={request:{...a,targets:Ie[Re]},partition:ma(!0,a.range,a.intervalMs,Number(we))};ee===O.ti.Forward&&Ve.partition.reverse(),j.push(Ve)}}}const q=(0,Q.groupBy)(m,ee=>ee.splitDuration?(0,or.WT)((0,or.E9)(ee.splitDuration)):P);for(const[ee,oe]of Object.entries(q)){const we=(0,Q.groupBy)(oe,Te=>Ga(a.intervalMs,a.range,Te.resolution||1,Te.step));for(const Te in we){const Ie=we[Te].map(Re=>{const{maxLines:Ve,...qe}=Re;return qe});j.push({request:{...a,targets:Ie},partition:ma(!1,a.range,Number(Te),Number(ee))})}}s.length&&j.push({request:{...a,targets:s},partition:[a.range]});const H=new Date;return Ka(v,j).pipe((0,ne.M)(ee=>{ee.state===le.Gu.Done&&(0,ga.uJ)(ee,j,a,H,{predefinedOperations:v.predefinedOperations})}))}function Ga(v,a,r,s){const c=/(-?\d+(?:\.\d+)?)(ms|[Mwdhmsy])/;if(s?.match(c))return te.intervalToMs(s)*r;const d=v*r,m=Math.round((a.to.valueOf()-a.from.valueOf())/11e3);return Math.max(d,m)}var ba=l(56245),xa=l(49935),Wr=l(9631),Za=l(55004),Ya=l(78731);async function lr(v){const a=JSON.stringify({expr:v.expr}),r=new TextEncoder().encode(a),s=await crypto.subtle.digest("SHA-1",r);return Array.from(new Uint8Array(s.slice(0,8))).map(d=>d.toString(16).padStart(2,"0")).join("")}function Ea(v,a,r){const s=r.range,c=s.to.valueOf()-s.from.valueOf()+1e3;let d=r.maxDataPoints??1e3;d>100&&(d*=2);let m;const P=L=>{if("message"in L&&L.message){const j=L.message;m?m.push(j):m=Wr.k9.fromDataFrameJSON(j,{maxLength:d,maxDelta:c,displayNameFormat:v.legendFormat})}return m};return(0,xa.v)(()=>lr(v)).pipe((0,Ne.Z)(L=>(0,Ya.oF)().getStream({scope:Za.qD.DataSource,namespace:a.uid,path:`tail/${L}`,data:{...v,timeRange:{from:s.from.valueOf().toString(),to:s.to.valueOf().toString()}}}).pipe((0,K.T)(j=>{const q=P(j);return{data:q?[q]:[],state:le.Gu.Streaming}}))))}const Pa=v=>{let r=`${window.location.protocol==="https:"?"wss://":"ws://"}${window.location.host}${Se.$.appSubUrl}`;return r.endsWith("/")&&(r=r.slice(0,-1)),`${r}${v}`},vt=1e3,St=10,Vr="/loki/api/v1",br="loki-data-samples",La="annotation-",Xr="log-row-context-query-",Sa="log-volume-",$a="log-sample-",Ra="log-stats-",Qa=1e6;function xr(v,a,r,s,c){const d=te.calculateInterval(a,1);return{targets:[v],requestId:s,interval:d.interval,intervalMs:d.intervalMs,range:a,scopedVars:{},timezone:"UTC",app:r,startTime:Date.now(),hideFromInspector:c}}class Pt extends Me.iy{constructor(a,r=(0,xe.w)()){super(a),this.instanceSettings=a,this.templateSrv=r,this.streams=new yt,this.runLiveQuery=(c,d)=>{const m=this.createLiveTarget(c,d);return this.streams.getStream(m).pipe((0,K.T)(P=>({data:P||[],key:`loki-${m.refId}`,state:le.Gu.Streaming})),(0,i.W)(P=>(0,Oe.$)(()=>`Live tailing was stopped due to following error: ${P.reason}`)))},this.getLogRowContext=async(c,d,m)=>await this.logContextProvider.getLogRowContext(c,d,(0,J.sc)(m)),this.getLogRowContextQuery=async(c,d,m,P)=>await this.logContextProvider.getLogRowContextQuery(c,d,(0,J.sc)(m),P),this.languageProvider=new ae(this);const s=a.jsonData||{};this.maxLines=parseInt(s.maxLines??"0",10)||vt,this.predefinedOperations=s.predefinedOperations??"",this.annotations={QueryEditor:ir},this.variables=new wt(this),this.logContextProvider=new mr(this)}getSupplementaryRequest(a,r,s){switch(a){case R.cF.LogsVolume:const c=s?.type===R.cF.LogsVolume?s:{type:a};return this.getLogsVolumeDataProvider(r,c);case R.cF.LogsSample:const d=s?.type===R.cF.LogsSample?s:{type:a};return this.getLogsSampleDataProvider(r,d);default:return}}getSupportedSupplementaryQueryTypes(){return[R.cF.LogsVolume,R.cF.LogsSample]}getSupplementaryQuery(a,r){const s=(0,J.vV)(r);let c=(0,ke.Lv)(s.expr),d=!1;switch(a.type){case R.cF.LogsVolume:if(d=!!(c&&(0,J.sI)(c)&&s.queryType===O.U3.Range),!d)return;const m=`${c} | drop __error__`,P=a.field||"level, detected_level";return(0,J.FV)(this.interpolateString(m,Ur.a))===!1&&(c=m),{...s,refId:`${Sa}${s.refId}`,queryType:O.U3.Range,supportingQueryType:O.Q$.LogsVolume,expr:`sum by (${P}) (count_over_time(${c}[$__auto]))`};case R.cF.LogsSample:return d=!!(c&&!(0,J.sI)(c)),d?{...s,queryType:O.U3.Range,refId:`${$a}${s.refId}`,expr:(0,J.OT)(c),maxLines:Number.isNaN(Number(a.limit))?this.maxLines:Number(a.limit),supportingQueryType:O.Q$.LogsSample}:void 0;default:return}}getLogsVolumeDataProvider(a,r){const s=(0,Q.cloneDeep)(a),c=s.targets.map(d=>this.getSupplementaryQuery(r,d)).filter(d=>!!d);if(c.length)return{...s,targets:c}}getLogsSampleDataProvider(a,r){const s=(0,Q.cloneDeep)(a),c=s.targets.map(d=>this.getSupplementaryQuery({type:R.cF.LogsSample,limit:100},d)).filter(d=>!!d);if(c.length)return{...s,targets:c}}getQueryHeaders(a){const r={};if(!Se.$.featureToggles.lokiSendDashboardPanelNames||[de.Jk.Dashboard.toString(),de.Jk.PanelEditor.toString(),de.Jk.PanelViewer.toString()].includes(a.app)===!1)return r;const s=(0,ve.UA)().getCurrent(),c=s?.title,d=s?.panels.find(m=>m.id===a?.panelId)?.title;return c&&(r["X-Dashboard-Title"]=c),d&&(r["X-Panel-Title"]=d),r}query(a){const r=a.targets.map(J.vV).map(m=>({...m,maxLines:m.maxLines??this.maxLines})),s={...a,targets:r};s.headers=this.getQueryHeaders(a);const c=s.targets.filter(m=>m.queryType===O.U3.Stream);if(Se.$.featureToggles.lokiExperimentalStreaming&&c.length>0&&s.rangeRaw?.to==="now"){const m={...s,targets:c};return(0,M.h)(...c.map(P=>Ea(this.applyTemplateVariables(P,a.scopedVars,a.filters),this,m)))}if(s.liveStreaming)return this.runLiveQueryThroughBackend(s);if(Se.$.featureToggles.lokiQuerySplitting&&(0,J.gy)(s.targets))return ya(this,s);const d=new Date;return this.runQuery(s).pipe((0,ne.M)(m=>(0,ga.Ex)(m,s,d,{predefinedOperations:this.predefinedOperations})))}runQuery(a){return super.query(a).pipe((0,K.T)(r=>pt(r,a.targets,this.instanceSettings.jsonData.derivedFields??[])))}runLiveQueryThroughBackend(a){const r=a.targets.filter(c=>c.expr!==""&&(0,J.sI)(c.expr));if(r.length===0)return(0,o.of)({data:[],state:le.Gu.Done});const s=r.map(c=>{const d=this.applyTemplateVariables(c,a.scopedVars,a.filters),m=d.maxLines||this.maxLines;return this.runLiveQuery(d,m)});return(0,M.h)(...s)}createLiveTarget(a,r){const s=a.expr,c=this.instanceSettings.url,d=Z.kM.serializeParams({query:s});return{query:s,url:Pa(`${c}/loki/api/v1/tail?${d}`),refId:a.refId,size:r}}interpolateVariablesInQueries(a,r,s){let c=a;return a&&a.length&&(c=a.map(d=>({...d,datasource:this.getRef(),expr:this.addAdHocFilters(this.templateSrv.replace(d.expr,r,this.interpolateQueryExpr),s)}))),c}getQueryDisplayText(a){return a.expr}getTimeRangeParams(a){return{start:a.from.valueOf()*Qa,end:a.to.valueOf()*Qa}}async importFromAbstractQueries(a){await this.languageProvider.start();const r=this.languageProvider.labelKeys;return r&&r.length&&(a=a.map(s=>(s.labelMatchers=s.labelMatchers.filter(c=>r.includes(c.name)),s))),a.map(s=>this.languageProvider.importFromAbstractQuery(s))}async exportToAbstractQueries(a){return a.map(r=>this.languageProvider.exportToAbstractQuery(r))}async metadataRequest(a,r,s){if(a.startsWith("/"))throw new Error(`invalid metadata request url: ${a}`);return(await this.getResource(a,r,s)).data||[]}async statsMetadataRequest(a,r,s){if(a.startsWith("/"))throw new Error(`invalid metadata request url: ${a}`);return await this.getResource(a,r,s)}async getQueryStats(a,r){if((0,J.FV)(this.interpolateString(a.expr,Ur.a)))return;const s=(0,J.pk)(a.expr);let c={streams:0,chunks:0,bytes:0,entries:0};for(const d in s){const{start:m,end:P}=this.getStatsTimeRange(a,Number(d),r);if(m===void 0||P===void 0)return{streams:0,chunks:0,bytes:0,entries:0,message:"Query size estimate not available."};try{const L=await this.statsMetadataRequest("index/stats",{query:s[d],start:m,end:P},{showErrorAlert:!1,requestId:`${Ra}${a.refId}`});c={streams:c.streams+L.streams,chunks:c.chunks+L.chunks,bytes:c.bytes+L.bytes,entries:c.entries+L.entries}}catch{break}}return c}getStatsTimeRange(a,r,s){let c,d;const L=(0,J.QH)(a.expr,[I.dw]).map(j=>a.expr.substring(j.from,j.to));return(0,J.sI)(a.expr)?a.queryType===O.U3.Instant?{start:void 0,end:void 0}:this.getTimeRangeParams(s):a.queryType===O.U3.Instant?L[r]?(d=this.getTimeRangeParams(s).end,c=d-te.intervalToMs(L[r])*1e6,{start:c,end:d}):/(\$__auto|\$__range)/.test(a.expr)?this.getTimeRangeParams(s):{start:void 0,end:void 0}:this.getTimeRangeParams(s)}async getStats(a,r){if(!a.expr)return null;const s=await this.getQueryStats(a,r);return s?Object.values(s).every(c=>c===0)?null:s:null}async metricFindQuery(a,r){if(!a)return Promise.resolve([]);let s;return typeof a=="string"?s=this.parseStringToVariableQuery(this.interpolateString(a,r?.scopedVars)):s={...a,label:this.interpolateString(a.label||"",r?.scopedVars),stream:this.interpolateString(a.stream||"",r?.scopedVars)},s?await this.processMetricFindQuery(s,r?.range):Promise.resolve([])}async processMetricFindQuery(a,r){return a.type===O.ie.LabelNames?(await this.languageProvider.fetchLabels({timeRange:r})).map(d=>({text:d})):a.label?(await this.languageProvider.fetchLabelValues(a.label,{streamSelector:a.stream,timeRange:r})).map(c=>({text:c})):[]}parseStringToVariableQuery(a){const r="LokiVariableQueryEditor-VariableQuery";if(a.match(vr))return{type:O.ie.LabelNames,refId:r};const c=a.match(Nt);if(c)return{type:O.ie.LabelValues,label:c[2],stream:c[1],refId:r}}async getDataSamples(a,r){if(!(0,J.sI)(a.expr)||(0,J.FV)(this.interpolateString(a.expr,Ur.a)))return[];const s={expr:a.expr,queryType:O.U3.Range,refId:br,maxLines:a.maxLines||St,supportingQueryType:O.Q$.DataSample},c=xr(s,r,de.Jk.Unknown,br,!0);return await(0,h.s)(this.query(c).pipe((0,D.n)(d=>(0,o.of)(d.data))))}async getTagKeys(a){let r="{}";for(const c of a?.filters??[])r=(0,ke.tE)(r,c.key,c.operator,c.value);return(await this.languageProvider.fetchLabels({timeRange:a?.timeRange,streamSelector:r})).map(c=>({text:c}))}async getTagValues(a){let r="{}";for(const c of a?.filters??[])r=(0,ke.tE)(r,c.key,c.operator,c.value);return(await this.languageProvider.fetchLabelValues(a.key,{timeRange:a.timeRange,streamSelector:r})).map(c=>({text:c}))}interpolateQueryExpr(a,r){return!r.multi&&!r.includeAll?Er(a):typeof a=="string"?Ja(a):(0,Q.map)(a,Ja).join("|")}toggleQueryFilter(a,r){let s=a.expr??"";const c=(0,z.Ed)(r.options.key,r.frame,0);switch(r.type){case"FILTER_FOR":{if(r.options?.key&&r.options?.value){const d=(0,z.Bb)(r.options.value);s=(0,ke.je)(s,r.options.key,"=",d)?(0,ke.FN)(s,r.options.key,"=",d):(0,ke.tE)(s,r.options.key,"=",d,c)}break}case"FILTER_OUT":{if(r.options?.key&&r.options?.value){const d=(0,z.Bb)(r.options.value);(0,ke.je)(s,r.options.key,"=",d)&&(s=(0,ke.FN)(s,r.options.key,"=",d)),s=(0,ke.tE)(s,r.options.key,"!=",d,c)}break}default:break}return{...a,expr:s}}queryHasFilter(a,r){let s=a.expr??"";return(0,ke.je)(s,r.key,"=",r.value)}modifyQuery(a,r){let s=a.expr??"";switch(r.type){case"ADD_FILTER":{if(r.options?.key&&r.options?.value){const c=(0,z.Ed)(r.options.key,r.frame,0),d=(0,z.Bb)(r.options.value);s=(0,ke.tE)(s,r.options.key,"=",d,c)}break}case"ADD_FILTER_OUT":{if(r.options?.key&&r.options?.value){const c=(0,z.Ed)(r.options.key,r.frame,0),d=(0,z.Bb)(r.options.value);s=(0,ke.tE)(s,r.options.key,"!=",d,c)}break}case"ADD_LOGFMT_PARSER":{s=(0,ke.aH)(s,"logfmt");break}case"ADD_JSON_PARSER":{s=(0,ke.aH)(s,"json");break}case"ADD_UNPACK_PARSER":{s=(0,ke.aH)(s,"unpack");break}case"ADD_NO_PIPELINE_ERROR":{s=(0,ke.yI)(s);break}case"ADD_LEVEL_LABEL_FORMAT":{r.options?.originalLabel&&r.options?.renameTo&&(s=(0,ke.o9)(s,{renameTo:r.options.renameTo,originalLabel:r.options.originalLabel}));break}case"ADD_LABEL_FILTER":{const c=(0,ke.cH)(a.expr),d=(0,ke.lN)(a.expr),m=(0,ke.lq)([...c,...d]),P=(0,ke.i6)("","","=");s=(0,ke.cQ)(s,[m],P);break}case"ADD_STRING_FILTER":case"ADD_LINE_FILTER":{s=(0,ke.OS)(s,r.options?.value);break}case"ADD_STRING_FILTER_OUT":case"ADD_LINE_FILTER_OUT":{s=(0,ke.OS)(s,r.options?.value,"!=");break}default:break}return{...a,expr:s}}getSupportedQueryModifications(){return["ADD_FILTER","ADD_FILTER_OUT","ADD_LOGFMT_PARSER","ADD_JSON_PARSER","ADD_UNPACK_PARSER","ADD_NO_PIPELINE_ERROR","ADD_LEVEL_LABEL_FORMAT","ADD_LABEL_FILTER","ADD_STRING_FILTER","ADD_STRING_FILTER_OUT"]}getLogRowContextUi(a,r,s){return this.logContextProvider.getLogRowContextUi(a,r,(0,J.sc)(s))}async annotationQuery(a){const{expr:r,maxLines:s,instant:c,tagKeys:d="",titleFormat:m="",textFormat:P=""}=a.annotation;if(!r)return[];const L=`${La}${a.annotation.name}`,j={refId:L,expr:r,maxLines:s,instant:c,queryType:c?O.U3.Instant:O.U3.Range},q=xr(j,a.range,de.Jk.Dashboard,L),{data:H}=await(0,h.s)(this.query(q)),ee=[],oe=d.split(",").filter(we=>we!=="");for(const we of H)new x.R(we).forEach(Ie=>{const{labels:Re}=Ie,Ve=Object.entries(Re).map(([Xe,et])=>[Xe,et.trim()]).filter(([Xe,et])=>!(et===""||oe.length&&!oe.includes(Xe))).map(([Xe,et])=>et),qe=Array.from(new Set(Ve));ee.push({time:new Date(Ie.Time).valueOf(),title:(0,U.j)(m,Re),text:(0,U.j)(P,Re)||Ie.Line,tags:qe})});return ee}addAdHocFilters(a,r){if(!r?.length)return a;let s=(0,ba.qk)(a);return s=r.reduce((c,d)=>{const{key:m,operator:P}=d;let{value:L}=d;return(0,z.N4)(P)?L=Er(L):L=(0,z.Bb)(L,P),(0,ke.tE)(c,m,P,L)},s),(0,ba.If)(s)}filterQuery(a){return!(a.hide||a.expr==="")}applyTemplateVariables(a,r,s){const{__auto:c,__interval:d,__interval_ms:m,__range:P,__range_s:L,__range_ms:j,...q}=r||{},H={...q,__interval:{value:"$__interval"},__interval_ms:{value:"$__interval_ms"}},ee=this.addAdHocFilters(this.templateSrv.replace(a.expr,H,this.interpolateQueryExpr),s),oe=this.templateSrv.replace(a.step,H),we=this.templateSrv.replace(a.legendFormat,H);return{...a,expr:ee,step:oe,legendFormat:we}}interpolateString(a,r){return this.templateSrv.replace(a,r,this.interpolateQueryExpr)}getVariables(){return this.templateSrv.getVariables().map(a=>`$${a.name}`)}getQueryHints(a,r){return pa(a.expr,r)}getDefaultQuery(a){const r={refId:"A",expr:""};return a===de.Jk.UnifiedAlerting?{...r,queryType:O.U3.Instant}:{...r,queryType:O.U3.Range}}}function Er(v){return typeof v=="string"?v.replace(/'/g,"\\\\'"):v}function Ja(v){return typeof v=="string"?Er(v.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]+?.()|]/g,"\\\\$&")):v}},97535:(Ke,Fe,l)=>{"use strict";l.d(Fe,{Bb:()=>de,Cs:()=>R,Ed:()=>U,N4:()=>Z,P7:()=>Se,Qn:()=>te,WV:()=>i,qv:()=>le,sM:()=>Me,tY:()=>x,tt:()=>xe});var Q=l(2543),Oe=l.n(Q),M=l(73372),o=l(13137);function h(fe){return K(fe/1e3)}function K(fe){return Math.floor(fe/60)}function i(fe,Pe){if(fe&&Pe){const Le=h(fe.from.valueOf())===h(Pe.from.valueOf()),B=h(fe.to.valueOf())===h(Pe.to.valueOf());return!(Le&&B)}return!1}const ne=/[*+?()|\\.\[\]{}^$]/g;function D(fe){return fe.replace(ne,"\\$&")}function te(fe){return fe.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/"/g,'\\"')}function le(fe){return fe.replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}function R(fe){return te(D(fe))}function de(fe,Pe){return Z(Pe)?R(fe):te(fe)}function Z(fe){return!!(fe&&(fe.includes("=~")||fe.includes("!~")))}function x(fe){const Pe=["b","kib","Kib","kb","KB","mib","Mib","mb","MB","gib","Gib","gb","GB","tib","Tib","tb","TB","pib","Pib","pb","PB","eib","Eib","eb","EB"],Le=new RegExp(`^(?:-?\\d+(?:\\.\\d+)?)(?:${Pe.join("|")})$`);return!!fe.match(Le)}function U(fe,Pe,Le){if(!Pe||Le===void 0)return null;const B=Pe.fields.find(Qe=>Qe.name==="labelTypes")?.values[Le];if(!B)return null;switch(B[fe]){case"I":return o.HD.Indexed;case"S":return o.HD.StructuredMetadata;case"P":return o.HD.Parsed;default:return null}}const I={[M.D_.Equal]:"=",[M.D_.NotEqual]:"!=",[M.D_.EqualRegEx]:"=~",[M.D_.NotEqualRegEx]:"!~"},Me=(0,Q.invert)(I);function xe(fe){const Pe=fe.labelMatchers.map(Le=>{const B=I[Le.operator];return B?`${Le.name}${B}"${Le.value}"`:""}).filter(Le=>Le!=="").join(", ");return Pe?`{${Pe}}`:""}function Se(fe){const Pe={};fe.forEach(B=>{Object.keys(B).forEach(Qe=>{Pe[Qe]||(Pe[Qe]=new Set),Pe[Qe].has(B[Qe])||Pe[Qe].add(B[Qe])})});const Le={};return ge(Object.keys(Pe)).forEach(B=>{Le[B]=ge(Array.from(Pe[B]))}),{values:Le,keys:Object.keys(Le)}}const ve=1e4;function ge(fe){return fe.slice(0,ve)}},12798:(Ke,Fe,l)=>{"use strict";l.d(Fe,{Ch:()=>D,FN:()=>le,Lv:()=>Se,OS:()=>N,aH:()=>I,cH:()=>ge,cQ:()=>De,i6:()=>B,je:()=>te,lN:()=>fe,lq:()=>G,o9:()=>xe,tE:()=>x,yB:()=>ve,yI:()=>Me});var Q=l(2543),Oe=l.n(Q),M=l(36195),o=l(97535),h=l(56587),K=l(43548),i=l(60706),ne=l(13137);class D{constructor($,O,F){this.from=$,this.to=O,this.type=F}static fromNode($){return new D($.from,$.to,$.type)}contains($){return this.from<=$.from&&this.to>=$.to}getExpression($){return $.substring(this.from,this.to)}}function te(g,$,O,F){return Z(g,$,O,F).length>0}function le(g,$,O,F){const _=Z(g,$,O,F);for(const ae of _)g=ae.parent?.type.id===M.bY?R(g,ae):de(g,ae);return g}function R(g,$){const O=$.parent?.parent;return!O||O.type.id!==M.t3?g:(g.substring(0,O.from)+g.substring(O.to)).trim()}function de(g,$){let O=$;do O=O.parent;while(O&&O.type.id!==M.MD);const F=$.getChild(M.gw);if(!O||!F)return g;const _=g.substring(F.from,F.to),ae=g.substring(0,O.from),ye=g.substring(O.to),ie=(0,i.u_)(g.substring(O.from,O.to));return ie.query.labels=ie.query.labels.filter(Ne=>Ne.label!==_),ae+K.y.renderQuery(ie.query)+ye}function Z(g,$,O,F){const _=M.K3.parse(g),ae=[];return _.iterate({enter:({type:ye,node:ie})=>{ye.id===M.g$&&ae.push(ie)}}),ae.filter(ye=>{const ie=ye.getChild(M.gw),Ne=ie?.nextSibling,Ue=ye.getChild(M.Qf);if(!ie||!Ne||!Ue||g.substring(ie.from,ie.to)!==$)return!1;const dt=g.substring(Ue.from,Ue.to);return!((0,i.w4)(dt)!==(0,o.qv)(F)||g.substring(Ne.from,Ne.to)!==O)})}function x(g,$,O,F,_){if(!$||!F)throw new Error("Need label to add to query.");const ae=ve(g);if(!ae.length)return g;const ye=ge(g),ie=fe(g),Ne=z(g),Ue=(0,h.TQ)(g,[M.J_]);_||J(g).map(Bt=>Bt.getExpression(g)).includes($)&&(_=ne.HD.Indexed);const tt=ae.every(Ot=>Ne.some(Ct=>Ct.from>=Ot.from&&Ct.to<=Ot.to)),dt=B($,F,O);if(_===ne.HD.Parsed||_===ne.HD.StructuredMetadata){const Ot=U(g,[...ae,...ie,...ye,...Ue]);return De(g,Ot,dt)}else{if(_===ne.HD.Indexed)return Qe(g,ae,dt);if(ye.length===0||tt===!1)return Qe(g,ae,dt);{const Ot=U(g,[...ye,...ie,...Ue]);return De(g,Ot,dt)}}}function U(g,$){const O=T((0,h.TQ)(g,[M.GN])),F=[...$];return O.map(ae=>G(F.filter(ye=>ae.contains(ye))))}function I(g,$){const O=Pe(g);if(O.length)return He(g,O,$);{const F=ve(g);return F.length?He(g,F,$):g}}function Me(g){const $=ge(g);if(!$.length)return g;const O=B("__error__","","=");return De(g,$,O)}function xe(g,$){const O=Le(g);return w(g,O,$)}function Se(g){const $=pe(g);if(!$.length)return g;let O="",F=0;for(let _ of $)O=O+g.substring(F,_.from),F=_.to;return O=O+g.substring(F),O}function ve(g){const $=M.K3.parse(g),O=[];return $.iterate({enter:({type:F,node:_})=>{if(F.id===M.MD)return O.push(D.fromNode(_)),!1}}),O}function ge(g){const $=M.K3.parse(g),O=[],F=[M.iT,M.eF,M.Zj,M.Tz];return $.iterate({enter:({type:_,node:ae})=>{if(F.includes(_.id))return O.push(D.fromNode(ae)),!1}}),O}function fe(g){const $=M.K3.parse(g),O=[];return $.iterate({enter:({type:F,node:_})=>{if(F.id===M.bY)return O.push(D.fromNode(_)),!1}}),O}function Pe(g){const $=M.K3.parse(g),O=[];return $.iterate({enter:({type:F,node:_})=>{if(F.id===M.CX)return O.push(D.fromNode(_)),!1}}),O}function Le(g){const $=M.K3.parse(g),O=[];return $.iterate({enter:({type:F,node:_})=>{if(F.id===M.UK)return O.push(D.fromNode(_)),!1;if(F.id===M.xo){const ae=[],ye=_.getChild(M.MD);ye&&ae.push(D.fromNode(ye));const ie=_.getChild(M.AL);ie&&ae.push(D.fromNode(ie));const Ne=_.getChild(M.HV);Ne&&ae.push(D.fromNode(Ne));const Ue=(0,Q.sortBy)(ae,tt=>tt.to);return O.push(new D(Ue[0].from,Ue[Ue.length-1].to)),!1}}}),O}function B(g,$,O){return{label:g,op:O,value:$}}function Qe(g,$,O){let F="",_=0;for(let ae=0;ae<$.length;ae++){const ye=$[ae],ie=ae===$.length-1,Ne=g.substring(_,ye.from),Ue=ie?g.substring(ye.to):"",tt=(0,i.u_)(g.substring(ye.from,ye.to));ce(tt.query.labels,O)||tt.query.labels.push(O);const dt=K.y.renderQuery(tt.query);F+=Ne+dt+Ue,_=ye.to}return F}function De(g,$,O){let F="",_=0;for(let ae=0;ae<$.length;ae++){const ye=$[ae],ie=ae===$.length-1,Ne=g.substring(_,ye.to),Ue=ie?g.substring(ye.to):"";let tt="";!Number.isNaN(Number(O.value))&&(O.op==="<"||O.op===">")?tt=` | ${O.label}${O.op}${Number(O.value)}`:tt=` | ${O.label}${O.op}\`${(0,o.qv)(O.value)}\``,F+=Ne+tt+Ue,_=ye.to}return F}function He(g,$,O){let F="",_=0;for(let ae=0;ae<$.length;ae++){const ye=$[ae],ie=ae===$.length-1,Ne=g.substring(_,ye.to),Ue=ie?g.substring(ye.to):"";F+=Ne+` | ${O}`+Ue,_=ye.to}return F}function w(g,$,O){let F="",_=0;for(let ae=0;ae<$.length;ae++){const ye=$[ae],ie=ae===$.length-1,Ne=g.substring(_,ye.to),Ue=ie?g.substring(ye.to):"",tt=` | label_format ${O.renameTo}=${O.originalLabel}`;F+=Ne+tt+Ue,_=ye.to}return F}function N(g,$="",O="|="){const F=ve(g);if(!F.length)return g;const _=F[0].to;return g.slice(0,_)+` ${O} \`${$}\``+g.slice(_)}function pe(g){const $=M.K3.parse(g),O=[];return $.iterate({enter:({type:F,from:_,to:ae})=>{if(F.id===M.uk)return O.push(new D(_,ae,F)),!1}}),O}function ce(g,$){return g.find(O=>O.label===$.label&&O.value===$.value)}function G(g){return g.length?g.reduce(($,O)=>$.to>O.to?$:O):new D(0,0)}function T(g){return g.filter($=>g.every(O=>$.contains(O)===!1||$===O))}function Y(g,$){if(g.type.id===$)return[D.fromNode(g)];const O=[];let F=0,_=g.childAfter(F);for(;_;)O.push(...Y(_,$)),F=_.to,_=g.childAfter(F);return O}function z(g){const $=M.K3.parse(g),O=[];return $.iterate({enter:({node:F})=>{F.type.id===M.MD&&O.push(...Y(F,M.g$))}}),O}function J(g){const $=M.K3.parse(g),O=[];return $.iterate({enter:({node:F})=>{F.type.id===M.MD&&O.push(...Y(F,M.gw))}}),O}},27049:(Ke,Fe,l)=>{"use strict";l.r(Fe),l.d(Fe,{plugin:()=>To});var Q=l(40187),Oe=l(69129),M=l(3591),o=l(74848),h=l(32196),K=l(2543),i=l(96540),ne=l(14110),D=l(40845),te=l(97535);const le=['{job="default/prometheus"}'],R=["job","app","k8s_app"],de=5,Z=[{title:"Log pipeline",expression:'{job="mysql"} |= "metrics" | logfmt | duration > 10s',label:'This query targets the MySQL job, keeps logs that contain the substring "metrics", and then parses and filters the logs further.'},{title:"Count over time",expression:'count_over_time({job="mysql"}[5m])',label:"This query counts all the log lines within the last five minutes for the MySQL job."},{title:"Rate",expression:'rate(({job="mysql"} |= "error" != "timeout")[10s])',label:"This query gets the per-second rate of all non-timeout errors within the last ten seconds for the MySQL job."},{title:"Aggregate, count, and group",expression:'sum(count_over_time({job="mysql"}[5m])) by (level)',label:"Get the count of logs during the last five minutes, grouping by level."}];class x extends i.PureComponent{constructor(){super(...arguments),this.state={userExamples:[]},this.checkUserLabels=async()=>{const t=this.props.datasource?.languageProvider;if(t.started){const n=t.getLabelKeys()||[],u=R.find(f=>n.includes(f));if(u){const f=await t.fetchLabelValues(u),p=(0,K.shuffle)(f).slice(0,de).map(E=>`{${u}="${(0,te.Qn)(E)}"}`);this.setState({userExamples:p})}}else this.scheduleUserLabelChecking()}}componentDidMount(){this.scheduleUserLabelChecking(),(0,ne.rR)("grafana_loki_cheatsheet_opened",{})}componentWillUnmount(){clearTimeout(this.userLabelTimer)}scheduleUserLabelChecking(){this.userLabelTimer=setTimeout(this.checkUserLabels,1e3)}renderExpression(t){const{onClickExample:n,theme:u}=this.props,f=I(u),p=E=>{n(E),(0,ne.rR)("grafana_loki_cheatsheet_example_clicked",{})};return(0,o.jsx)("button",{type:"button",className:f.cheatSheetExample,onClick:()=>p({refId:"A",expr:t}),children:(0,o.jsx)("code",{children:t})},t)}render(){const{userExamples:t}=this.state,{theme:n}=this.props,u=t.length>0,f=I(n);return(0,o.jsxs)("div",{children:[(0,o.jsx)("h2",{children:"Loki Cheat Sheet"}),(0,o.jsxs)("div",{className:f.cheatSheetItem,children:[(0,o.jsx)("div",{className:f.cheatSheetItemTitle,children:"See your logs"}),"Start by selecting a log stream from the Label browser, or alternatively you can write a stream selector into the query field.",u?(0,o.jsxs)("div",{children:["Here are some example streams from your logs:",t.map(p=>this.renderExpression(p))]}):(0,o.jsxs)("div",{children:["Here is an example of a log stream:",this.renderExpression(le[0])]})]}),(0,o.jsxs)("div",{className:f.cheatSheetItem,children:[(0,o.jsx)("div",{className:f.cheatSheetItemTitle,children:"Combine stream selectors"}),this.renderExpression('{app="cassandra",namespace="prod"}'),"Returns all log lines from streams that have both labels."]}),(0,o.jsxs)("div",{className:f.cheatSheetItem,children:[(0,o.jsx)("div",{className:f.cheatSheetItemTitle,children:"Filtering for search terms."}),this.renderExpression('{app="cassandra"} |~ "(duration|latency)s*(=|is|of)s*[d.]+"'),this.renderExpression('{app="cassandra"} |= "exact match"'),this.renderExpression('{app="cassandra"} != "do not match"'),(0,o.jsx)("a",{href:"https://grafana.com/docs/loki/latest/logql/#log-pipeline",target:"logql",children:"LogQL"})," ","supports exact and regular expression filters."]}),Z.map(p=>(0,o.jsxs)("div",{className:f.cheatSheetItem,children:[(0,o.jsx)("div",{className:f.cheatSheetItemTitle,children:p.title}),this.renderExpression(p.expression),p.label]},p.expression))]})}}const U=(0,D.cV)(x),I=e=>({cheatSheetItem:(0,h.css)({margin:e.spacing(3,0)}),cheatSheetItemTitle:(0,h.css)({fontSize:e.typography.h3.fontSize}),cheatSheetExample:(0,h.css)({margin:e.spacing(.5,0),textAlign:"left",border:"none",background:"transparent",display:"block"})});var Me=l(41987),xe=l(84596),Se=l(39070),ve=l(13544),ge=l(42952),fe=l(6191),Pe=l(15292),Le=l(46819),B=Object.defineProperty,Qe=Object.defineProperties,De=Object.getOwnPropertyDescriptors,He=Object.getOwnPropertySymbols,w=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable,pe=(e,t,n)=>t in e?B(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ce=(e,t)=>{for(var n in t||(t={}))w.call(t,n)&&pe(e,n,t[n]);if(He)for(var n of He(t))N.call(t,n)&&pe(e,n,t[n]);return e},G=(e,t)=>Qe(e,De(t)),T=(e,t)=>{var n={};for(var u in e)w.call(e,u)&&t.indexOf(u)<0&&(n[u]=e[u]);if(e!=null&&He)for(var u of He(e))t.indexOf(u)<0&&N.call(e,u)&&(n[u]=e[u]);return n};function Y(e){var t=e,{label:n}=t,u=T(t,["label"]);const f=n.replace(" ","-"),p=(0,i.useRef)((0,K.uniqueId)(`switch-${f}`)),E=(0,D.of)(z);return i.createElement(Le.B,{gap:1},i.createElement("label",{htmlFor:p.current,className:E.switchLabel},n),i.createElement(Pe.d,G(ce({},u),{id:p.current})))}const z=e=>({switchLabel:(0,h.css)({color:e.colors.text.secondary,cursor:"pointer",fontSize:e.typography.bodySmall.fontSize,"&:hover":{color:e.colors.text.primary}})});var J=l(31347),g=l(94354);const $=[{label:"Builder",value:ge.f.Builder},{label:"Code",value:ge.f.Code}];function O({mode:e,onChange:t}){return i.createElement("div",{"data-testid":"QueryEditorModeToggle"},i.createElement(g.z,{options:$,size:"sm",value:e,onChange:t}))}var F=l(71087),_=l(32264),ae=l(96374),ye=l(67061),ie=l(55852),Ne=l(68402),Ue=l(7144),tt=l(37390),dt=l(39558),Ot=l(91793),Ct=l(9830),Bt=l(60029),Wt=l(54438),Dt=l(10354);const Qr=1e3,Tr=1e4,wa=4,pr="{}";function Je(e){const t=[];for(const n of e)if(n.selected&&n.values&&n.values.length>0){const u=n.values.filter(f=>f.selected).map(f=>f.name);u.length>1?t.push(`${n.name}=~"${u.map(te.Cs).join("|")}"`):u.length===1&&t.push(`${n.name}="${(0,te.Qn)(u[0])}"`)}return["{",t.join(","),"}"].join("")}function Fa(e,t,n){return e.map(u=>{const f=t[u.name];if(f){let p;if(u.name===n&&u.values)p=u.values;else{const E=new Set(u.values?.filter(b=>b.selected).map(b=>b.name)||[]);p=f.map(b=>({name:b,selected:E.has(b)}))}return{...u,loading:!1,values:p,facets:p.length}}return{...u,loading:!1,hidden:!f,values:void 0,facets:0}})}const Yr=e=>({wrapper:(0,h.css)`
    background-color: ${e.colors.background.secondary};
    width: 100%;
  `,wrapperPadding:(0,h.css)`
    padding: ${e.spacing(2)};
  `,list:(0,h.css)`
    margin-top: ${e.spacing(1)};
    display: flex;
    flex-wrap: wrap;
    max-height: 200px;
    overflow: auto;
  `,section:(0,h.css)`
    & + & {
      margin: ${e.spacing(2,0)};
    }

    position: relative;
  `,footerSectionStyles:(0,h.css)`
    padding: ${e.spacing(1)};
    background-color: ${e.colors.background.primary};
    position: sticky;
    bottom: -${e.spacing(3)}; /* offset the padding on modal */
    left: 0;
  `,selector:(0,h.css)`
    font-family: ${e.typography.fontFamilyMonospace};
    margin-bottom: ${e.spacing(1)};
    width: 100%;
  `,status:(0,h.css)`
    margin-bottom: ${e.spacing(1)};
    color: ${e.colors.text.secondary};
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    transition: opacity 100ms linear;
    opacity: 0;
    font-size: ${e.typography.bodySmall.fontSize};
    height: calc(${e.typography.bodySmall.fontSize} + 10px);
  `,statusShowing:(0,h.css)`
    opacity: 1;
  `,error:(0,h.css)`
    color: ${e.colors.error.main};
  `,valueList:(0,h.css)`
    margin-right: ${e.spacing(1)};
    resize: horizontal;
  `,valueListWrapper:(0,h.css)`
    border-left: 1px solid ${e.colors.border.medium};
    margin: ${e.spacing(1,0)};
    padding: ${e.spacing(1,0,1,1)};
  `,valueListArea:(0,h.css)`
    display: flex;
    flex-wrap: wrap;
    margin-top: ${e.spacing(1)};
  `,valueTitle:(0,h.css)`
    margin-left: -${e.spacing(.5)};
    margin-bottom: ${e.spacing(1)};
  `,validationStatus:(0,h.css)`
    padding: ${e.spacing(.5)};
    margin-bottom: ${e.spacing(1)};
    color: ${e.colors.text.maxContrast};
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  `});class Jr extends i.Component{constructor(){super(...arguments),this.state={labels:[],searchTerm:"",status:"Ready",error:"",validationStatus:""},this.onChangeSearch=t=>{this.setState({searchTerm:t.target.value})},this.onClickRunLogsQuery=()=>{(0,ne.rR)("grafana_loki_label_browser_closed",{app:this.props.app,closeType:"showLogsButton"});const t=Je(this.state.labels);this.props.onChange(t)},this.onClickRunMetricsQuery=()=>{(0,ne.rR)("grafana_loki_label_browser_closed",{app:this.props.app,closeType:"showLogsRateButton"});const n=`rate(${Je(this.state.labels)}[$__auto])`;this.props.onChange(n)},this.onClickClear=()=>{this.setState(t=>({labels:t.labels.map(u=>({...u,values:void 0,selected:!1,loading:!1,hidden:!1,facets:void 0})),searchTerm:"",status:"",error:"",validationStatus:""})),this.props.deleteLastUsedLabels()},this.onClickLabel=(t,n,u)=>{const f=this.state.labels.find(b=>b.name===t);if(!f)return;const p=!f.selected;let E={selected:p};if(f.values&&!p){const b=f.values.map(y=>({...y,selected:!1}));E={...E,facets:0,values:b}}this.setState({searchTerm:""}),this.updateLabelState(t,E,"",()=>this.doFacettingForLabel(t))},this.onClickValue=(t,n,u)=>{const f=this.state.labels.find(E=>E.name===t);if(!f||!f.values)return;this.setState({searchTerm:""});const p=f.values.map(E=>({...E,selected:E.name===n?!E.selected:E.selected}));this.updateLabelState(t,{values:p},"",()=>this.doFacetting(t))},this.onClickValidate=()=>{const t=Je(this.state.labels);this.validateSelector(t)},this.doFacetting=t=>{const n=Je(this.state.labels);if(n===pr){const u=this.state.labels.map(f=>({...f,facets:0,values:void 0,hidden:!1}));this.setState({labels:u},()=>{this.state.labels.forEach(f=>f.selected&&this.fetchValues(f.name,n))})}else this.fetchSeries(n,t)}}updateLabelState(t,n,u="",f){this.setState(p=>{const E=p.labels.map(y=>y.name===t?{...y,...n}:y),b=u?"":p.error;return{labels:E,status:u,error:b,validationStatus:""}},f)}componentDidMount(){const{languageProvider:t,autoSelect:n=wa,lastUsedLabels:u,timeRange:f}=this.props;if(t){const p=u;t.start(f).then(()=>{let E=t.getLabelKeys();if(E.length>Qr){const y=`Too many labels found (showing only ${Qr} of ${E.length})`;E=E.slice(0,Qr),this.setState({error:y})}const b=E.map((y,S,A)=>({name:y,selected:A.length<=n&&p.length===0||p.includes(y),loading:!1}));this.setState({labels:b},()=>{this.state.labels.forEach(y=>{y.selected&&this.fetchValues(y.name,pr)})})})}}doFacettingForLabel(t){const n=this.state.labels.find(f=>f.name===t);if(!n)return;const u=this.state.labels.filter(f=>f.selected).map(f=>f.name);this.props.storeLastUsedLabels(u),n.selected?n.values||this.fetchValues(t,Je(this.state.labels)):this.doFacetting()}async fetchValues(t,n){const{languageProvider:u,timeRange:f}=this.props;this.updateLabelState(t,{loading:!0},`Fetching values for ${t}`);try{let p=await u.fetchLabelValues(t,{timeRange:f});if(n!==Je(this.state.labels)){this.updateLabelState(t,{loading:!1},"");return}if(p.length>Tr){const b=`Too many values for ${t} (showing only ${Tr} of ${p.length})`;p=p.slice(0,Tr),this.setState({error:b})}const E=p.map(b=>({name:b}));this.updateLabelState(t,{values:E,loading:!1})}catch(p){console.error(p)}}async fetchSeries(t,n){const{languageProvider:u,timeRange:f}=this.props;n&&this.updateLabelState(n,{loading:!0},`Loading labels for ${t}`);try{const p=await u.fetchSeriesLabels(t,{timeRange:f});if(t!==Je(this.state.labels)){n&&this.updateLabelState(n,{loading:!1});return}if(Object.keys(p).length===0){this.setState({error:`Empty results, no matching label for ${t}`});return}const E=Fa(this.state.labels,p,n);this.setState({labels:E,error:""}),n&&this.updateLabelState(n,{loading:!1})}catch(p){console.error(p)}}async validateSelector(t){const{languageProvider:n,timeRange:u}=this.props;this.setState({validationStatus:`Validating selector ${t}`,error:""});const f=await n.fetchSeries(t,{timeRange:u});this.setState({validationStatus:`Selector is valid (${f.length} streams found)`})}render(){const{theme:t}=this.props,{labels:n,searchTerm:u,status:f,error:p,validationStatus:E}=this.state;if(n.length===0)return(0,o.jsx)(dt._,{text:"Loading labels..."});const b=Yr(t),y=Je(this.state.labels),S=y===pr;let A=n.filter(C=>C.selected&&C.values);return u?A=A.map(C=>{const X=C.values.filter(W=>{if(W.selected)return W.highlightParts=void 0,!0;const Ee=(0,Ct.I)(W.name.toLowerCase(),u.toLowerCase());return Ee.found?(W.highlightParts=Ee.ranges,W.order=Ee.distance,!0):!1});return{...C,values:(0,K.sortBy)(X,W=>W.selected?-1/0:W.order)}}):A=this.state.labels.filter(C=>C.selected&&C.values).map(C=>({...C,values:C?.values?C.values.map(X=>({...X,highlightParts:void 0})):[]})),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:b.wrapper,children:[(0,o.jsxs)("div",{className:(0,h.cx)(b.section,b.wrapperPadding),children:[(0,o.jsx)(Bt.J,{description:"Which labels would you like to consider for your search?",children:"1. Select labels to search in"}),(0,o.jsx)("div",{className:b.list,children:n.map(C=>(0,o.jsx)(Wt.J,{name:C.name,loading:C.loading,active:C.selected,hidden:C.hidden,facets:C.facets,onClick:this.onClickLabel},C.name))})]}),(0,o.jsxs)("div",{className:(0,h.cx)(b.section,b.wrapperPadding),children:[(0,o.jsx)(Bt.J,{description:"Choose the label values that you would like to use for the query. Use the search field to find values across selected labels.",children:"2. Find values for the selected labels"}),(0,o.jsx)("div",{children:(0,o.jsx)(Dt.p,{onChange:this.onChangeSearch,"aria-label":"Filter expression for values",value:u,placeholder:"Enter a label value"})}),(0,o.jsx)("div",{className:b.valueListArea,children:A.map(C=>(0,o.jsxs)("div",{role:"list",className:b.valueListWrapper,children:[(0,o.jsx)("div",{className:b.valueTitle,"aria-label":`Values for ${C.name}`,children:(0,o.jsx)(Wt.J,{name:C.name,loading:C.loading,active:C.selected,hidden:C.hidden,facets:C.facets||C.values?.length,onClick:this.onClickLabel})}),(0,o.jsx)(Ot.Y1,{height:200,itemCount:C.values?.length||0,itemSize:28,itemKey:X=>C.values?.[X].name??X,width:200,className:b.valueList,children:({index:X,style:W})=>{const Ee=C.values?.[X];return Ee?(0,o.jsx)("div",{style:W,children:(0,o.jsx)(Wt.J,{name:C.name,value:Ee?.name,active:Ee?.selected,highlightParts:Ee?.highlightParts,onClick:this.onClickValue,searchTerm:u})}):null}})]},C.name))})]})]}),(0,o.jsxs)("div",{className:b.footerSectionStyles,children:[(0,o.jsx)(Bt.J,{children:"3. Resulting selector"}),(0,o.jsx)("pre",{"aria-label":"selector",className:b.selector,children:y}),E&&(0,o.jsx)("div",{className:b.validationStatus,children:E}),(0,o.jsx)("div",{className:(0,h.cx)(b.status,(f||p)&&b.statusShowing),children:(0,o.jsx)("span",{className:p?b.error:"",children:p||f})}),(0,o.jsxs)(ye.B,{gap:1,children:[(0,o.jsx)(ie.$n,{"aria-label":"Use selector as logs button",disabled:S,onClick:this.onClickRunLogsQuery,children:"Show logs"}),(0,o.jsx)(ie.$n,{"aria-label":"Use selector as metrics button",variant:"secondary",disabled:S,onClick:this.onClickRunMetricsQuery,children:"Show logs rate"}),(0,o.jsx)(ie.$n,{"aria-label":"Validate submit button",variant:"secondary",disabled:S,onClick:this.onClickValidate,children:"Validate selector"}),(0,o.jsx)(ie.$n,{"aria-label":"Selector clear button",variant:"secondary",onClick:this.onClickClear,children:"Clear"})]})]})]})}}const qr=(0,D.cV)(Jr),ea=e=>{const{isOpen:t,onClose:n,datasource:u,app:f,timeRange:p}=e,[E,b]=(0,i.useState)(!1),[y,S]=(0,i.useState)(!1),A="grafana.datasources.loki.browser.labels",C=(0,D.of)(Ca);(0,i.useEffect)(()=>{t&&u.languageProvider.fetchLabels({timeRange:p}).then(k=>{b(!0),S(k.length>0)})},[u,t,p]);const X=k=>{const{query:re,onChange:be,onRunQuery:ue}=e,me={...re,expr:k};be(me),ue()},W=k=>{X(k),n()},Ee=()=>{(0,ne.rR)("grafana_loki_label_browser_closed",{app:f,closeType:"modalClose"}),n()};return(0,o.jsxs)(tt.a,{isOpen:t,title:"Label browser",onDismiss:Ee,className:C.modal,children:[!E&&(0,o.jsx)(dt._,{text:"Loading labels..."}),E&&!y&&(0,o.jsx)("p",{children:"No labels found."}),E&&y&&(0,o.jsx)(Ue.b,{storageKey:A,defaultValue:[],children:(k,re,be)=>(0,o.jsx)(qr,{languageProvider:u.languageProvider,onChange:W,lastUsedLabels:k,storeLastUsedLabels:re,deleteLastUsedLabels:be,app:f,timeRange:p})})]})},Ca=e=>({modal:(0,h.css)`
      width: 85vw;
      ${e.breakpoints.down("md")} {
        width: 100%;
      }
    `});var Da=l(65307),lt=l(43548),At=l(60706),wr=l(43127),Fr=l(9e4),Mt=l(81580),Aa=l(97801),Ma=l(85269),ta=l(44600),jt=l(50877),It=l(14186),yt=l(90182),ct=l(81392),ra=l(3721),Ae=Object.defineProperty,ft=Object.defineProperties,Ye=Object.getOwnPropertyDescriptors,Cr=Object.getOwnPropertySymbols,aa=Object.prototype.hasOwnProperty,ja=Object.prototype.propertyIsEnumerable,mt=(e,t,n)=>t in e?Ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,qt=(e,t)=>{for(var n in t||(t={}))aa.call(t,n)&&mt(e,n,t[n]);if(Cr)for(var n of Cr(t))ja.call(t,n)&&mt(e,n,t[n]);return e},er=(e,t)=>ft(e,Ye(t));const na="You have conflicting label filters";function sa({item:e,items:t,defaultOp:n,onChange:u,onDelete:f,onGetLabelNames:p,onGetLabelValues:E,invalidLabel:b,invalidValue:y,multiValueSeparator:S="|"}){var A;const[C,X]=(0,i.useState)({}),[W,Ee]=(0,i.useState)(!1),[k,re]=(0,i.useState)(!1),be=(se=e.op)=>{var Ce;return(Ce=Dr.find(he=>he.label===se))==null?void 0:Ce.isMultiValue},ue=se=>se?se.indexOf(S)>0?se.split(S):[se]:[],me=()=>{const se=C.labelValues?[...C.labelValues]:[],Ce=ue(e?.value).map(jt.z);return(0,K.uniqBy)([...Ce,...se],"value")},V=ia(e,t),{current:$e}=(0,i.useRef)((0,ta.A)());return i.createElement("div",{"data-testid":"visual-query-builder-dimensions-filter-item"},i.createElement(It.I,{error:na,invalid:V?!0:void 0},i.createElement(ct.M,null,i.createElement(yt.l6,{placeholder:"Select label","data-testid":ve.Tp.components.QueryBuilder.labelSelect,inputId:`visual-query-builder-dimensions-filter-item-key-${$e}`,width:"auto",value:e.label?(0,jt.z)(e.label):null,allowCustomValue:!0,onOpenMenu:async()=>{X({isLoadingLabelNames:!0});const se=await p(e);Ee(!0),X({labelNames:se,isLoadingLabelNames:void 0})},onCloseMenu:()=>{Ee(!1)},isOpen:W,isLoading:C.isLoadingLabelNames,options:C.labelNames,onChange:se=>{var Ce;se.value&&u(er(qt({},e),{op:(Ce=e.op)!=null?Ce:n,label:se.value}))},invalid:V||b}),i.createElement(yt.l6,{"data-testid":ve.Tp.components.QueryBuilder.matchOperatorSelect,value:(0,jt.z)((A=e.op)!=null?A:n),options:Dr,width:"auto",onChange:se=>{se.value&&u(er(qt({},e),{op:se.value,value:be(se.value)?e.value:ue(e?.value)[0]}))},invalid:V}),i.createElement(yt.l6,{placeholder:"Select value","data-testid":ve.Tp.components.QueryBuilder.valueSelect,inputId:`visual-query-builder-dimensions-filter-item-value-${$e}`,width:"auto",value:be()?ue(e?.value).map(jt.z):ue(e?.value).map(jt.z)[0],allowCustomValue:!0,onOpenMenu:async()=>{X({isLoadingLabelValues:!0});const se=await E(e);X(er(qt({},C),{labelValues:se,isLoadingLabelValues:void 0})),re(!0)},onCloseMenu:()=>{re(!1)},isOpen:k,isMulti:be(),isLoading:C.isLoadingLabelValues,options:me(),onChange:se=>{var Ce,he;if(se.value)u(er(qt({},e),{value:se.value,op:(Ce=e.op)!=null?Ce:n}));else{const _e=se.map(Be=>{if(Be.value)return Be.value}).filter(Be=>Be!==void 0).join(S);u(er(qt({},e),{value:_e,op:(he=e.op)!=null?he:n}))}},invalid:V||y}),i.createElement(ra.Z,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:f}))))}const Dr=[{label:"=",value:"=",description:"Equals",isMultiValue:!1},{label:"!=",value:"!=",description:"Does not equal",isMultiValue:!1},{label:"=~",value:"=~",description:"Matches regex",isMultiValue:!0},{label:"!~",value:"!~",description:"Does not match regex",isMultiValue:!0}];function ia(e,t){if(!e.label||!e.op||!e.value||t.length<2)return!1;const n=e.op.toString().startsWith("!");return t.filter(p=>p.label===e.label&&p.value===e.value&&p.op!==e.op).some(p=>{var E,b;return!!(n&&((E=p?.op)==null?void 0:E.toString().startsWith("!"))===!1||n===!1&&((b=p?.op)!=null&&b.toString().startsWith("!")))})}const oa="Select at least 1 label filter (label and value)";function Ar({labelsFilters:e,onChange:t,onGetLabelNames:n,onGetLabelValues:u,labelFilterRequired:f,multiValueSeparator:p}){const E="=",[b,y]=(0,i.useState)([{op:E}]);(0,i.useEffect)(()=>{e.length>0?y(e):y([{op:E}])},[e]);const S=C=>{y(C);const X=C.filter(W=>W.label!==void 0&&W.value!==void 0);(0,K.isEqual)(X,e)||t(X)},A=b.some(C=>C.label&&C.value);return i.createElement(Aa.B,null,i.createElement(Mt.c,{label:"Label filters",error:oa,invalid:f&&!A},i.createElement(Ma.o,{items:b,onChange:S,renderItem:(C,X,W)=>i.createElement(sa,{item:C,items:b,defaultOp:E,onChange:X,onDelete:W,onGetLabelNames:n,onGetLabelValues:u,invalidLabel:f&&!C.label,invalidValue:f&&!C.value,multiValueSeparator:p})})))}var Vt=l(36663);function Xt({title:e,stepNumber:t,markdown:n,children:u}){const f=(0,D.of)(hr);return i.createElement("div",{className:f.box},t!==void 0&&i.createElement("div",{className:f.stepNumber},t),i.createElement("div",{className:f.boxInner},e&&i.createElement("div",{className:f.header},i.createElement("span",null,e)),i.createElement("div",{className:f.body},n&&i.createElement("div",{dangerouslySetInnerHTML:{__html:(0,Vt.G)(n)}}),u)))}const hr=e=>({box:(0,h.css)({background:e.colors.background.secondary,padding:e.spacing(1),borderRadius:e.shape.radius.default,position:"relative"}),boxInner:(0,h.css)({marginLeft:e.spacing(4)}),stepNumber:(0,h.css)({fontWeight:e.typography.fontWeightMedium,background:e.colors.secondary.main,width:"20px",height:"20px",borderRadius:e.shape.radius.circle,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"10px",left:"11px",fontSize:e.typography.bodySmall.fontSize}),header:(0,h.css)({paddingBottom:e.spacing(.5),display:"flex",alignItems:"center",fontFamily:e.typography.fontFamilyMonospace}),body:(0,h.css)({color:e.colors.text.secondary,"p:last-child":{margin:0},a:{color:e.colors.text.link,textDecoration:"underline"}})});var tr=l(92762),la=l(21103),gr=l(91076),ca=l(1604),ua=l(3988),rr=l(56034),ke=l(14578),Mr=l(98587),Qt=l(58168),da=l(40961);function it(e){if(e==null)return window;if(e.toString()!=="[object Window]"){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function bt(e){var t=it(e).Element;return e instanceof t||e instanceof Element}function nt(e){var t=it(e).HTMLElement;return e instanceof t||e instanceof HTMLElement}function mr(e){if(typeof ShadowRoot>"u")return!1;var t=it(e).ShadowRoot;return e instanceof t||e instanceof ShadowRoot}var Tt=Math.max,ar=Math.min,kt=Math.round;function zt(){var e=navigator.userAgentData;return e!=null&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function vr(){return!/^((?!chrome|android).)*safari/i.test(zt())}function Nt(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var u=e.getBoundingClientRect(),f=1,p=1;t&&nt(e)&&(f=e.offsetWidth>0&&kt(u.width)/e.offsetWidth||1,p=e.offsetHeight>0&&kt(u.height)/e.offsetHeight||1);var E=bt(e)?it(e):window,b=E.visualViewport,y=!vr()&&n,S=(u.left+(y&&b?b.offsetLeft:0))/f,A=(u.top+(y&&b?b.offsetTop:0))/p,C=u.width/f,X=u.height/p;return{width:C,height:X,top:A,right:S+C,bottom:A+X,left:S,x:S,y:A}}function jr(e){var t=it(e),n=t.pageXOffset,u=t.pageYOffset;return{scrollLeft:n,scrollTop:u}}function Ia(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}function Na(e){return e===it(e)||!nt(e)?jr(e):Ia(e)}function xt(e){return e?(e.nodeName||"").toLowerCase():null}function wt(e){return((bt(e)?e.ownerDocument:e.document)||window.document).documentElement}function Ir(e){return Nt(wt(e)).left+jr(e).scrollLeft}function Et(e){return it(e).getComputedStyle(e)}function Or(e){var t=Et(e),n=t.overflow,u=t.overflowX,f=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+f+u)}function _a(e){var t=e.getBoundingClientRect(),n=kt(t.width)/e.offsetWidth||1,u=kt(t.height)/e.offsetHeight||1;return n!==1||u!==1}function Ua(e,t,n){n===void 0&&(n=!1);var u=nt(t),f=nt(t)&&_a(t),p=wt(t),E=Nt(e,f,n),b={scrollLeft:0,scrollTop:0},y={x:0,y:0};return(u||!u&&!n)&&((xt(t)!=="body"||Or(p))&&(b=Na(t)),nt(t)?(y=Nt(t,!0),y.x+=t.clientLeft,y.y+=t.clientTop):p&&(y.x=Ir(p))),{x:E.left+b.scrollLeft-y.x,y:E.top+b.scrollTop-y.y,width:E.width,height:E.height}}function yr(e){var t=Nt(e),n=e.offsetWidth,u=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-u)<=1&&(u=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:u}}function nr(e){return xt(e)==="html"?e:e.assignedSlot||e.parentNode||(mr(e)?e.host:null)||wt(e)}function Nr(e){return["html","body","#document"].indexOf(xt(e))>=0?e.ownerDocument.body:nt(e)&&Or(e)?e:Nr(nr(e))}function Kt(e,t){var n;t===void 0&&(t=[]);var u=Nr(e),f=u===((n=e.ownerDocument)==null?void 0:n.body),p=it(u),E=f?[p].concat(p.visualViewport||[],Or(u)?u:[]):u,b=t.concat(E);return f?b:b.concat(Kt(nr(E)))}function Ba(e){return["table","td","th"].indexOf(xt(e))>=0}function _r(e){return!nt(e)||Et(e).position==="fixed"?null:e.offsetParent}function fa(e){var t=/firefox/i.test(zt()),n=/Trident/i.test(zt());if(n&&nt(e)){var u=Et(e);if(u.position==="fixed")return null}var f=nr(e);for(mr(f)&&(f=f.host);nt(f)&&["html","body"].indexOf(xt(f))<0;){var p=Et(f);if(p.transform!=="none"||p.perspective!=="none"||p.contain==="paint"||["transform","perspective"].indexOf(p.willChange)!==-1||t&&p.willChange==="filter"||t&&p.filter&&p.filter!=="none")return f;f=f.parentNode}return null}function Ht(e){for(var t=it(e),n=_r(e);n&&Ba(n)&&Et(n).position==="static";)n=_r(n);return n&&(xt(n)==="html"||xt(n)==="body"&&Et(n).position==="static")?t:n||fa(e)||t}var ot="top",pt="bottom",ht="right",rt="left",sr="auto",Gt=[ot,pt,ht,rt],Zt="start",ir="end",Ur="clippingParents",pa="viewport",Yt="popper",Wa="reference",ha=Gt.reduce(function(e,t){return e.concat([t+"-"+Zt,t+"-"+ir])},[]),or=[].concat(Gt,[sr]).reduce(function(e,t){return e.concat([t,t+"-"+Zt,t+"-"+ir])},[]),Va="beforeRead",Xa="read",ka="afterRead",ga="beforeMain",ma="main",za="afterMain",Ka="beforeWrite",Br="write",va="afterWrite",Ha=[Va,Xa,ka,ga,ma,za,Ka,Br,va];function Oa(e){var t=new Map,n=new Set,u=[];e.forEach(function(p){t.set(p.name,p)});function f(p){n.add(p.name);var E=[].concat(p.requires||[],p.requiresIfExists||[]);E.forEach(function(b){if(!n.has(b)){var y=t.get(b);y&&f(y)}}),u.push(p)}return e.forEach(function(p){n.has(p.name)||f(p)}),u}function ya(e){var t=Oa(e);return Ha.reduce(function(n,u){return n.concat(t.filter(function(f){return f.phase===u}))},[])}function Ga(e){var t;return function(){return t||(t=new Promise(function(n){Promise.resolve().then(function(){t=void 0,n(e())})})),t}}function ba(e){var t=e.reduce(function(n,u){var f=n[u.name];return n[u.name]=f?Object.assign({},f,u,{options:Object.assign({},f.options,u.options),data:Object.assign({},f.data,u.data)}):u,n},{});return Object.keys(t).map(function(n){return t[n]})}var xa={placement:"bottom",modifiers:[],strategy:"absolute"};function Wr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some(function(u){return!(u&&typeof u.getBoundingClientRect=="function")})}function Za(e){e===void 0&&(e={});var t=e,n=t.defaultModifiers,u=n===void 0?[]:n,f=t.defaultOptions,p=f===void 0?xa:f;return function(b,y,S){S===void 0&&(S=p);var A={placement:"bottom",orderedModifiers:[],options:Object.assign({},xa,p),modifiersData:{},elements:{reference:b,popper:y},attributes:{},styles:{}},C=[],X=!1,W={state:A,setOptions:function(be){var ue=typeof be=="function"?be(A.options):be;k(),A.options=Object.assign({},p,A.options,ue),A.scrollParents={reference:bt(b)?Kt(b):b.contextElement?Kt(b.contextElement):[],popper:Kt(y)};var me=ya(ba([].concat(u,A.options.modifiers)));return A.orderedModifiers=me.filter(function(V){return V.enabled}),Ee(),W.update()},forceUpdate:function(){if(!X){var be=A.elements,ue=be.reference,me=be.popper;if(Wr(ue,me)){A.rects={reference:Ua(ue,Ht(me),A.options.strategy==="fixed"),popper:yr(me)},A.reset=!1,A.placement=A.options.placement,A.orderedModifiers.forEach(function(Be){return A.modifiersData[Be.name]=Object.assign({},Be.data)});for(var V=0;V<A.orderedModifiers.length;V++){if(A.reset===!0){A.reset=!1,V=-1;continue}var $e=A.orderedModifiers[V],se=$e.fn,Ce=$e.options,he=Ce===void 0?{}:Ce,_e=$e.name;typeof se=="function"&&(A=se({state:A,options:he,name:_e,instance:W})||A)}}}},update:Ga(function(){return new Promise(function(re){W.forceUpdate(),re(A)})}),destroy:function(){k(),X=!0}};if(!Wr(b,y))return W;W.setOptions(S).then(function(re){!X&&S.onFirstUpdate&&S.onFirstUpdate(re)});function Ee(){A.orderedModifiers.forEach(function(re){var be=re.name,ue=re.options,me=ue===void 0?{}:ue,V=re.effect;if(typeof V=="function"){var $e=V({state:A,name:be,instance:W,options:me}),se=function(){};C.push($e||se)}})}function k(){C.forEach(function(re){return re()}),C=[]}return W}}var Ya=null,lr={passive:!0};function Ea(e){var t=e.state,n=e.instance,u=e.options,f=u.scroll,p=f===void 0?!0:f,E=u.resize,b=E===void 0?!0:E,y=it(t.elements.popper),S=[].concat(t.scrollParents.reference,t.scrollParents.popper);return p&&S.forEach(function(A){A.addEventListener("scroll",n.update,lr)}),b&&y.addEventListener("resize",n.update,lr),function(){p&&S.forEach(function(A){A.removeEventListener("scroll",n.update,lr)}),b&&y.removeEventListener("resize",n.update,lr)}}const Pa={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Ea,data:{}};function vt(e){return e.split("-")[0]}function St(e){return e.split("-")[1]}function Vr(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function br(e){var t=e.reference,n=e.element,u=e.placement,f=u?vt(u):null,p=u?St(u):null,E=t.x+t.width/2-n.width/2,b=t.y+t.height/2-n.height/2,y;switch(f){case ot:y={x:E,y:t.y-n.height};break;case pt:y={x:E,y:t.y+t.height};break;case ht:y={x:t.x+t.width,y:b};break;case rt:y={x:t.x-n.width,y:b};break;default:y={x:t.x,y:t.y}}var S=f?Vr(f):null;if(S!=null){var A=S==="y"?"height":"width";switch(p){case Zt:y[S]=y[S]-(t[A]/2-n[A]/2);break;case ir:y[S]=y[S]+(t[A]/2-n[A]/2);break;default:}}return y}function La(e){var t=e.state,n=e.name;t.modifiersData[n]=br({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})}const Xr={name:"popperOffsets",enabled:!0,phase:"read",fn:La,data:{}};var Sa={top:"auto",right:"auto",bottom:"auto",left:"auto"};function $a(e,t){var n=e.x,u=e.y,f=t.devicePixelRatio||1;return{x:kt(n*f)/f||0,y:kt(u*f)/f||0}}function Ra(e){var t,n=e.popper,u=e.popperRect,f=e.placement,p=e.variation,E=e.offsets,b=e.position,y=e.gpuAcceleration,S=e.adaptive,A=e.roundOffsets,C=e.isFixed,X=E.x,W=X===void 0?0:X,Ee=E.y,k=Ee===void 0?0:Ee,re=typeof A=="function"?A({x:W,y:k}):{x:W,y:k};W=re.x,k=re.y;var be=E.hasOwnProperty("x"),ue=E.hasOwnProperty("y"),me=rt,V=ot,$e=window;if(S){var se=Ht(n),Ce="clientHeight",he="clientWidth";if(se===it(n)&&(se=wt(n),Et(se).position!=="static"&&b==="absolute"&&(Ce="scrollHeight",he="scrollWidth")),se=se,f===ot||(f===rt||f===ht)&&p===ir){V=pt;var _e=C&&se===$e&&$e.visualViewport?$e.visualViewport.height:se[Ce];k-=_e-u.height,k*=y?1:-1}if(f===rt||(f===ot||f===pt)&&p===ir){me=ht;var Be=C&&se===$e&&$e.visualViewport?$e.visualViewport.width:se[he];W-=Be-u.width,W*=y?1:-1}}var Ge=Object.assign({position:b},S&&Sa),gt=A===!0?$a({x:W,y:k},it(n)):{x:W,y:k};if(W=gt.x,k=gt.y,y){var st;return Object.assign({},Ge,(st={},st[V]=ue?"0":"",st[me]=be?"0":"",st.transform=($e.devicePixelRatio||1)<=1?"translate("+W+"px, "+k+"px)":"translate3d("+W+"px, "+k+"px, 0)",st))}return Object.assign({},Ge,(t={},t[V]=ue?k+"px":"",t[me]=be?W+"px":"",t.transform="",t))}function Qa(e){var t=e.state,n=e.options,u=n.gpuAcceleration,f=u===void 0?!0:u,p=n.adaptive,E=p===void 0?!0:p,b=n.roundOffsets,y=b===void 0?!0:b,S={placement:vt(t.placement),variation:St(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:f,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,Ra(Object.assign({},S,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:E,roundOffsets:y})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,Ra(Object.assign({},S,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:y})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const xr={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Qa,data:{}};function Pt(e){var t=e.state;Object.keys(t.elements).forEach(function(n){var u=t.styles[n]||{},f=t.attributes[n]||{},p=t.elements[n];!nt(p)||!xt(p)||(Object.assign(p.style,u),Object.keys(f).forEach(function(E){var b=f[E];b===!1?p.removeAttribute(E):p.setAttribute(E,b===!0?"":b)}))})}function Er(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach(function(u){var f=t.elements[u],p=t.attributes[u]||{},E=Object.keys(t.styles.hasOwnProperty(u)?t.styles[u]:n[u]),b=E.reduce(function(y,S){return y[S]="",y},{});!nt(f)||!xt(f)||(Object.assign(f.style,b),Object.keys(p).forEach(function(y){f.removeAttribute(y)}))})}}const Ja={name:"applyStyles",enabled:!0,phase:"write",fn:Pt,effect:Er,requires:["computeStyles"]};function v(e,t,n){var u=vt(e),f=[rt,ot].indexOf(u)>=0?-1:1,p=typeof n=="function"?n(Object.assign({},t,{placement:e})):n,E=p[0],b=p[1];return E=E||0,b=(b||0)*f,[rt,ht].indexOf(u)>=0?{x:b,y:E}:{x:E,y:b}}function a(e){var t=e.state,n=e.options,u=e.name,f=n.offset,p=f===void 0?[0,0]:f,E=or.reduce(function(A,C){return A[C]=v(C,t.rects,p),A},{}),b=E[t.placement],y=b.x,S=b.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=y,t.modifiersData.popperOffsets.y+=S),t.modifiersData[u]=E}const r={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:a};var s={left:"right",right:"left",bottom:"top",top:"bottom"};function c(e){return e.replace(/left|right|bottom|top/g,function(t){return s[t]})}var d={start:"end",end:"start"};function m(e){return e.replace(/start|end/g,function(t){return d[t]})}function P(e,t){var n=it(e),u=wt(e),f=n.visualViewport,p=u.clientWidth,E=u.clientHeight,b=0,y=0;if(f){p=f.width,E=f.height;var S=vr();(S||!S&&t==="fixed")&&(b=f.offsetLeft,y=f.offsetTop)}return{width:p,height:E,x:b+Ir(e),y}}function L(e){var t,n=wt(e),u=jr(e),f=(t=e.ownerDocument)==null?void 0:t.body,p=Tt(n.scrollWidth,n.clientWidth,f?f.scrollWidth:0,f?f.clientWidth:0),E=Tt(n.scrollHeight,n.clientHeight,f?f.scrollHeight:0,f?f.clientHeight:0),b=-u.scrollLeft+Ir(e),y=-u.scrollTop;return Et(f||n).direction==="rtl"&&(b+=Tt(n.clientWidth,f?f.clientWidth:0)-p),{width:p,height:E,x:b,y}}function j(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&mr(n)){var u=t;do{if(u&&e.isSameNode(u))return!0;u=u.parentNode||u.host}while(u)}return!1}function q(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function H(e,t){var n=Nt(e,!1,t==="fixed");return n.top=n.top+e.clientTop,n.left=n.left+e.clientLeft,n.bottom=n.top+e.clientHeight,n.right=n.left+e.clientWidth,n.width=e.clientWidth,n.height=e.clientHeight,n.x=n.left,n.y=n.top,n}function ee(e,t,n){return t===pa?q(P(e,n)):bt(t)?H(t,n):q(L(wt(e)))}function oe(e){var t=Kt(nr(e)),n=["absolute","fixed"].indexOf(Et(e).position)>=0,u=n&&nt(e)?Ht(e):e;return bt(u)?t.filter(function(f){return bt(f)&&j(f,u)&&xt(f)!=="body"}):[]}function we(e,t,n,u){var f=t==="clippingParents"?oe(e):[].concat(t),p=[].concat(f,[n]),E=p[0],b=p.reduce(function(y,S){var A=ee(e,S,u);return y.top=Tt(A.top,y.top),y.right=ar(A.right,y.right),y.bottom=ar(A.bottom,y.bottom),y.left=Tt(A.left,y.left),y},ee(e,E,u));return b.width=b.right-b.left,b.height=b.bottom-b.top,b.x=b.left,b.y=b.top,b}function Te(){return{top:0,right:0,bottom:0,left:0}}function Ie(e){return Object.assign({},Te(),e)}function Re(e,t){return t.reduce(function(n,u){return n[u]=e,n},{})}function Ve(e,t){t===void 0&&(t={});var n=t,u=n.placement,f=u===void 0?e.placement:u,p=n.strategy,E=p===void 0?e.strategy:p,b=n.boundary,y=b===void 0?Ur:b,S=n.rootBoundary,A=S===void 0?pa:S,C=n.elementContext,X=C===void 0?Yt:C,W=n.altBoundary,Ee=W===void 0?!1:W,k=n.padding,re=k===void 0?0:k,be=Ie(typeof re!="number"?re:Re(re,Gt)),ue=X===Yt?Wa:Yt,me=e.rects.popper,V=e.elements[Ee?ue:X],$e=we(bt(V)?V:V.contextElement||wt(e.elements.popper),y,A,E),se=Nt(e.elements.reference),Ce=br({reference:se,element:me,strategy:"absolute",placement:f}),he=q(Object.assign({},me,Ce)),_e=X===Yt?he:se,Be={top:$e.top-_e.top+be.top,bottom:_e.bottom-$e.bottom+be.bottom,left:$e.left-_e.left+be.left,right:_e.right-$e.right+be.right},Ge=e.modifiersData.offset;if(X===Yt&&Ge){var gt=Ge[f];Object.keys(Be).forEach(function(st){var Lt=[ht,pt].indexOf(st)>=0?1:-1,ze=[ot,pt].indexOf(st)>=0?"y":"x";Be[st]+=gt[ze]*Lt})}return Be}function qe(e,t){t===void 0&&(t={});var n=t,u=n.placement,f=n.boundary,p=n.rootBoundary,E=n.padding,b=n.flipVariations,y=n.allowedAutoPlacements,S=y===void 0?or:y,A=St(u),C=A?b?ha:ha.filter(function(Ee){return St(Ee)===A}):Gt,X=C.filter(function(Ee){return S.indexOf(Ee)>=0});X.length===0&&(X=C);var W=X.reduce(function(Ee,k){return Ee[k]=Ve(e,{placement:k,boundary:f,rootBoundary:p,padding:E})[vt(k)],Ee},{});return Object.keys(W).sort(function(Ee,k){return W[Ee]-W[k]})}function Xe(e){if(vt(e)===sr)return[];var t=c(e);return[m(e),t,m(t)]}function et(e){var t=e.state,n=e.options,u=e.name;if(!t.modifiersData[u]._skip){for(var f=n.mainAxis,p=f===void 0?!0:f,E=n.altAxis,b=E===void 0?!0:E,y=n.fallbackPlacements,S=n.padding,A=n.boundary,C=n.rootBoundary,X=n.altBoundary,W=n.flipVariations,Ee=W===void 0?!0:W,k=n.allowedAutoPlacements,re=t.options.placement,be=vt(re),ue=be===re,me=y||(ue||!Ee?[c(re)]:Xe(re)),V=[re].concat(me).reduce(function(Zr,fr){return Zr.concat(vt(fr)===sr?qe(t,{placement:fr,boundary:A,rootBoundary:C,padding:S,flipVariations:Ee,allowedAutoPlacements:k}):fr)},[]),$e=t.rects.reference,se=t.rects.popper,Ce=new Map,he=!0,_e=V[0],Be=0;Be<V.length;Be++){var Ge=V[Be],gt=vt(Ge),st=St(Ge)===Zt,Lt=[ot,pt].indexOf(gt)>=0,ze=Lt?"width":"height",je=Ve(t,{placement:Ge,boundary:A,rootBoundary:C,altBoundary:X,padding:S}),Ze=Lt?st?ht:rt:st?pt:ot;$e[ze]>se[ze]&&(Ze=c(Ze));var Ft=c(Ze),Ut=[];if(p&&Ut.push(je[gt]<=0),b&&Ut.push(je[Ze]<=0,je[Ft]<=0),Ut.every(function(Zr){return Zr})){_e=Ge,he=!1;break}Ce.set(Ge,Ut)}if(he)for(var Sr=Ee?3:1,Gr=function(fr){var Ta=V.find(function(on){var $r=Ce.get(on);if($r)return $r.slice(0,fr).every(function(En){return En})});if(Ta)return _e=Ta,"break"},Jt=Sr;Jt>0;Jt--){var sn=Gr(Jt);if(sn==="break")break}t.placement!==_e&&(t.modifiersData[u]._skip=!0,t.placement=_e,t.reset=!0)}}const $t={name:"flip",enabled:!0,phase:"main",fn:et,requiresIfExists:["offset"],data:{_skip:!1}};function Rt(e){return e==="x"?"y":"x"}function _t(e,t,n){return Tt(e,ar(t,n))}function kr(e,t,n){var u=_t(e,t,n);return u>n?n:u}function cr(e){var t=e.state,n=e.options,u=e.name,f=n.mainAxis,p=f===void 0?!0:f,E=n.altAxis,b=E===void 0?!1:E,y=n.boundary,S=n.rootBoundary,A=n.altBoundary,C=n.padding,X=n.tether,W=X===void 0?!0:X,Ee=n.tetherOffset,k=Ee===void 0?0:Ee,re=Ve(t,{boundary:y,rootBoundary:S,padding:C,altBoundary:A}),be=vt(t.placement),ue=St(t.placement),me=!ue,V=Vr(be),$e=Rt(V),se=t.modifiersData.popperOffsets,Ce=t.rects.reference,he=t.rects.popper,_e=typeof k=="function"?k(Object.assign({},t.rects,{placement:t.placement})):k,Be=typeof _e=="number"?{mainAxis:_e,altAxis:_e}:Object.assign({mainAxis:0,altAxis:0},_e),Ge=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,gt={x:0,y:0};if(se){if(p){var st,Lt=V==="y"?ot:rt,ze=V==="y"?pt:ht,je=V==="y"?"height":"width",Ze=se[V],Ft=Ze+re[Lt],Ut=Ze-re[ze],Sr=W?-he[je]/2:0,Gr=ue===Zt?Ce[je]:he[je],Jt=ue===Zt?-he[je]:-Ce[je],sn=t.elements.arrow,Zr=W&&sn?yr(sn):{width:0,height:0},fr=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:Te(),Ta=fr[Lt],on=fr[ze],$r=_t(0,Ce[je],Zr[je]),En=me?Ce[je]/2-Sr-$r-Ta-Be.mainAxis:Gr-$r-Ta-Be.mainAxis,wo=me?-Ce[je]/2+Sr+$r+on+Be.mainAxis:Jt+$r+on+Be.mainAxis,Pn=t.elements.arrow&&Ht(t.elements.arrow),Fo=Pn?V==="y"?Pn.clientTop||0:Pn.clientLeft||0:0,ns=(st=Ge?.[V])!=null?st:0,Co=Ze+En-ns-Fo,Do=Ze+wo-ns,ss=_t(W?ar(Ft,Co):Ft,Ze,W?Tt(Ut,Do):Ut);se[V]=ss,gt[V]=ss-Ze}if(b){var is,Ao=V==="x"?ot:rt,Mo=V==="x"?pt:ht,Rr=se[$e],ln=$e==="y"?"height":"width",os=Rr+re[Ao],ls=Rr-re[Mo],Ln=[ot,rt].indexOf(be)!==-1,cs=(is=Ge?.[$e])!=null?is:0,us=Ln?os:Rr-Ce[ln]-he[ln]-cs+Be.altAxis,ds=Ln?Rr+Ce[ln]+he[ln]-cs-Be.altAxis:ls,fs=W&&Ln?kr(us,Rr,ds):_t(W?us:os,Rr,W?ds:ls);se[$e]=fs,gt[$e]=fs-Rr}t.modifiersData[u]=gt}}const cn={name:"preventOverflow",enabled:!0,phase:"main",fn:cr,requiresIfExists:["offset"]};var zr=function(t,n){return t=typeof t=="function"?t(Object.assign({},n.rects,{placement:n.placement})):t,Ie(typeof t!="number"?t:Re(t,Gt))};function un(e){var t,n=e.state,u=e.name,f=e.options,p=n.elements.arrow,E=n.modifiersData.popperOffsets,b=vt(n.placement),y=Vr(b),S=[rt,ht].indexOf(b)>=0,A=S?"height":"width";if(!(!p||!E)){var C=zr(f.padding,n),X=yr(p),W=y==="y"?ot:rt,Ee=y==="y"?pt:ht,k=n.rects.reference[A]+n.rects.reference[y]-E[y]-n.rects.popper[A],re=E[y]-n.rects.reference[y],be=Ht(p),ue=be?y==="y"?be.clientHeight||0:be.clientWidth||0:0,me=k/2-re/2,V=C[W],$e=ue-X[A]-C[Ee],se=ue/2-X[A]/2+me,Ce=_t(V,se,$e),he=y;n.modifiersData[u]=(t={},t[he]=Ce,t.centerOffset=Ce-se,t)}}function dn(e){var t=e.state,n=e.options,u=n.element,f=u===void 0?"[data-popper-arrow]":u;f!=null&&(typeof f=="string"&&(f=t.elements.popper.querySelector(f),!f)||j(t.elements.popper,f)&&(t.elements.arrow=f))}const We={name:"arrow",enabled:!0,phase:"main",fn:un,effect:dn,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function ut(e,t,n){return n===void 0&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function at(e){return[ot,ht,pt,rt].some(function(t){return e[t]>=0})}function ur(e){var t=e.state,n=e.name,u=t.rects.reference,f=t.rects.popper,p=t.modifiersData.preventOverflow,E=Ve(t,{elementContext:"reference"}),b=Ve(t,{altBoundary:!0}),y=ut(E,u),S=ut(b,f,p),A=at(y),C=at(S);t.modifiersData[n]={referenceClippingOffsets:y,popperEscapeOffsets:S,isReferenceHidden:A,hasPopperEscaped:C},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":A,"data-popper-escaped":C})}var ps=[Pa,Xr,xr,Ja,r,$t,cn,We,{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:ur}],hs=Za({defaultModifiers:ps}),gs=l(30115),ms=l.n(gs),Io=function(t){return Array.isArray(t)?t[0]:t},vs=function(t){if(typeof t=="function"){for(var n=arguments.length,u=new Array(n>1?n-1:0),f=1;f<n;f++)u[f-1]=arguments[f];return t.apply(void 0,u)}},No=function(t,n){if(typeof t=="function")return vs(t,n);t!=null&&(t.current=n)},Sn=function(t){return t.reduce(function(n,u){var f=u[0],p=u[1];return n[f]=p,n},{})},$n=typeof window<"u"&&window.document&&window.document.createElement?i.useLayoutEffect:i.useEffect,Os=[],ys=function(t,n,u){u===void 0&&(u={});var f=i.useRef(null),p={onFirstUpdate:u.onFirstUpdate,placement:u.placement||"bottom",strategy:u.strategy||"absolute",modifiers:u.modifiers||Os},E=i.useState({styles:{popper:{position:p.strategy,left:"0",top:"0"},arrow:{position:"absolute"}},attributes:{}}),b=E[0],y=E[1],S=i.useMemo(function(){return{name:"updateState",enabled:!0,phase:"write",fn:function(W){var Ee=W.state,k=Object.keys(Ee.elements);da.flushSync(function(){y({styles:Sn(k.map(function(re){return[re,Ee.styles[re]||{}]})),attributes:Sn(k.map(function(re){return[re,Ee.attributes[re]]}))})})},requires:["computeStyles"]}},[]),A=i.useMemo(function(){var X={onFirstUpdate:p.onFirstUpdate,placement:p.placement,strategy:p.strategy,modifiers:[].concat(p.modifiers,[S,{name:"applyStyles",enabled:!1}])};return ms()(f.current,X)?f.current||X:(f.current=X,X)},[p.onFirstUpdate,p.placement,p.strategy,p.modifiers,S]),C=i.useRef();return $n(function(){C.current&&C.current.setOptions(A)},[A]),$n(function(){if(!(t==null||n==null)){var X=u.createPopper||hs,W=X(t,n,A);return C.current=W,function(){W.destroy(),C.current=null}}},[t,n,u.createPopper]),{state:C.current?C.current.state:null,styles:b.styles,attributes:b.attributes,update:C.current?C.current.update:null,forceUpdate:C.current?C.current.forceUpdate:null}};function Rn(e){var t=i.useRef(e);return t.current=e,i.useCallback(function(){return t.current},[])}var bs=function(){};function xs(e){var t=e.initial,n=e.value,u=e.onChange,f=u===void 0?bs:u;if(t===void 0&&n===void 0)throw new TypeError('Either "value" or "initial" variable must be set. Now both are undefined');var p=i.useState(t),E=p[0],b=p[1],y=Rn(E),S=i.useCallback(function(C){var X=y(),W=typeof C=="function"?C(X):C;typeof W.persist=="function"&&W.persist(),b(W),typeof f=="function"&&f(W)},[y,f]),A=n!==void 0;return[A?n:E,A?f:S]}function Qn(e,t){return e===void 0&&(e=0),t===void 0&&(t=0),function(){return{width:0,height:0,top:t,right:e,bottom:t,left:e,x:0,y:0,toJSON:function(){return null}}}}var Es=["styles","attributes"],Tn={getBoundingClientRect:Qn()},wn={closeOnOutsideClick:!0,closeOnTriggerHidden:!1,defaultVisible:!1,delayHide:0,delayShow:0,followCursor:!1,interactive:!1,mutationObserverOptions:{attributes:!0,childList:!0,subtree:!0},offset:[0,6],trigger:"hover"};function Ps(e,t){var n,u,f;e===void 0&&(e={}),t===void 0&&(t={});var p=Object.keys(wn).reduce(function(ze,je){var Ze;return(0,Qt.A)({},ze,(Ze={},Ze[je]=ze[je]!==void 0?ze[je]:wn[je],Ze))},e),E=i.useMemo(function(){return[{name:"offset",options:{offset:p.offset}}]},Array.isArray(p.offset)?p.offset:[]),b=(0,Qt.A)({},t,{placement:t.placement||p.placement,modifiers:t.modifiers||E}),y=i.useState(null),S=y[0],A=y[1],C=i.useState(null),X=C[0],W=C[1],Ee=xs({initial:p.defaultVisible,value:p.visible,onChange:p.onVisibleChange}),k=Ee[0],re=Ee[1],be=i.useRef();i.useEffect(function(){return function(){return clearTimeout(be.current)}},[]);var ue=ys(p.followCursor?Tn:S,X,b),me=ue.styles,V=ue.attributes,$e=(0,Mr.A)(ue,Es),se=$e.update,Ce=Rn({visible:k,triggerRef:S,tooltipRef:X,finalConfig:p}),he=i.useCallback(function(ze){return Array.isArray(p.trigger)?p.trigger.includes(ze):p.trigger===ze},Array.isArray(p.trigger)?p.trigger:[p.trigger]),_e=i.useCallback(function(){clearTimeout(be.current),be.current=window.setTimeout(function(){return re(!1)},p.delayHide)},[p.delayHide,re]),Be=i.useCallback(function(){clearTimeout(be.current),be.current=window.setTimeout(function(){return re(!0)},p.delayShow)},[p.delayShow,re]),Ge=i.useCallback(function(){Ce().visible?_e():Be()},[Ce,_e,Be]);i.useEffect(function(){if(Ce().finalConfig.closeOnOutsideClick){var ze=function(Ze){var Ft,Ut=Ce(),Sr=Ut.tooltipRef,Gr=Ut.triggerRef,Jt=(Ze.composedPath==null||(Ft=Ze.composedPath())==null?void 0:Ft[0])||Ze.target;Jt instanceof Node&&Sr!=null&&Gr!=null&&!Sr.contains(Jt)&&!Gr.contains(Jt)&&_e()};return document.addEventListener("mousedown",ze),function(){return document.removeEventListener("mousedown",ze)}}},[Ce,_e]),i.useEffect(function(){if(!(S==null||!he("click")))return S.addEventListener("click",Ge),function(){return S.removeEventListener("click",Ge)}},[S,he,Ge]),i.useEffect(function(){if(!(S==null||!he("double-click")))return S.addEventListener("dblclick",Ge),function(){return S.removeEventListener("dblclick",Ge)}},[S,he,Ge]),i.useEffect(function(){if(!(S==null||!he("right-click"))){var ze=function(Ze){Ze.preventDefault(),Ge()};return S.addEventListener("contextmenu",ze),function(){return S.removeEventListener("contextmenu",ze)}}},[S,he,Ge]),i.useEffect(function(){if(!(S==null||!he("focus")))return S.addEventListener("focus",Be),S.addEventListener("blur",_e),function(){S.removeEventListener("focus",Be),S.removeEventListener("blur",_e)}},[S,he,Be,_e]),i.useEffect(function(){if(!(S==null||!he("hover")))return S.addEventListener("mouseenter",Be),S.addEventListener("mouseleave",_e),function(){S.removeEventListener("mouseenter",Be),S.removeEventListener("mouseleave",_e)}},[S,he,Be,_e]),i.useEffect(function(){if(!(X==null||!he("hover")||!Ce().finalConfig.interactive))return X.addEventListener("mouseenter",Be),X.addEventListener("mouseleave",_e),function(){X.removeEventListener("mouseenter",Be),X.removeEventListener("mouseleave",_e)}},[X,he,Be,_e,Ce]);var gt=$e==null||(n=$e.state)==null||(u=n.modifiersData)==null||(f=u.hide)==null?void 0:f.isReferenceHidden;i.useEffect(function(){p.closeOnTriggerHidden&&gt&&_e()},[p.closeOnTriggerHidden,_e,gt]),i.useEffect(function(){if(!p.followCursor||S==null)return;function ze(je){var Ze=je.clientX,Ft=je.clientY;Tn.getBoundingClientRect=Qn(Ze,Ft),se?.()}return S.addEventListener("mousemove",ze),function(){return S.removeEventListener("mousemove",ze)}},[p.followCursor,S,se]),i.useEffect(function(){if(!(X==null||se==null||p.mutationObserverOptions==null)){var ze=new MutationObserver(se);return ze.observe(X,p.mutationObserverOptions),function(){return ze.disconnect()}}},[p.mutationObserverOptions,X,se]);var st=function(je){return je===void 0&&(je={}),(0,Qt.A)({},je,{style:(0,Qt.A)({},je.style,me.popper)},V.popper,{"data-popper-interactive":p.interactive})},Lt=function(je){return je===void 0&&(je={}),(0,Qt.A)({},je,V.arrow,{style:(0,Qt.A)({},je.style,me.arrow),"data-popper-arrow":!0})};return(0,Qt.A)({getArrowProps:Lt,getTooltipProps:st,setTooltipRef:W,setTriggerRef:A,tooltipRef:X,triggerRef:S,visible:k},$e)}var Ls=l(17464),Ss=Object.defineProperty,$s=Object.defineProperties,Rs=Object.getOwnPropertyDescriptors,Fn=Object.getOwnPropertySymbols,Qs=Object.prototype.hasOwnProperty,Ts=Object.prototype.propertyIsEnumerable,Cn=(e,t,n)=>t in e?Ss(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ws=(e,t)=>{for(var n in t||(t={}))Qs.call(t,n)&&Cn(e,n,t[n]);if(Fn)for(var n of Fn(t))Ts.call(t,n)&&Cn(e,n,t[n]);return e},Fs=(e,t)=>$s(e,Rs(t));const Dn=i.memo(({definition:e,operation:t,innerQueryPlaceholder:n})=>{const u=(0,D.of)(Cs),[f,p]=(0,i.useState)(!1),{getTooltipProps:E,setTooltipRef:b,setTriggerRef:y,visible:S}=Ps({placement:"top",visible:f,offset:[0,16],onVisibleChange:p,interactive:!0,trigger:["click"]});return i.createElement(i.Fragment,null,i.createElement(ie.$n,{title:"Click to show description",ref:y,icon:"info-circle",size:"sm",variant:"secondary",fill:"text"}),S&&i.createElement(Ls.ZL,null,i.createElement("div",Fs(ws({ref:b},E()),{className:u.docBox}),i.createElement("div",{className:u.docBoxHeader},i.createElement("span",null,e.renderer(t,e,n)),i.createElement(J.Z,{grow:1}),i.createElement(ie.$n,{icon:"times",onClick:()=>p(!1),fill:"text",variant:"secondary",title:"Remove operation"})),i.createElement("div",{className:u.docBoxBody,dangerouslySetInnerHTML:{__html:Ds(e,t)}}))))});Dn.displayName="OperationDocs";const Cs=e=>({docBox:(0,h.css)({overflow:"hidden",background:e.colors.background.primary,border:`1px solid ${e.colors.border.strong}`,boxShadow:e.shadows.z3,maxWidth:"600px",padding:e.spacing(1),borderRadius:e.shape.radius.default,zIndex:e.zIndex.tooltip}),docBoxHeader:(0,h.css)({fontSize:e.typography.h5.fontSize,fontFamily:e.typography.fontFamilyMonospace,paddingBottom:e.spacing(1),display:"flex",alignItems:"center"}),docBoxBody:(0,h.css)({marginBottom:e.spacing(-1),color:e.colors.text.secondary}),signature:(0,h.css)({fontSize:e.typography.bodySmall.fontSize,fontFamily:e.typography.fontFamilyMonospace}),dropdown:(0,h.css)({opacity:0,color:e.colors.text.secondary})});function Ds(e,t){var n;return(0,Vt.G)(e.explainHandler?e.explainHandler(t,e):(n=e.documentation)!=null?n:"no docs")}var As=Object.defineProperty,Ms=Object.defineProperties,js=Object.getOwnPropertyDescriptors,An=Object.getOwnPropertySymbols,Is=Object.prototype.hasOwnProperty,Ns=Object.prototype.propertyIsEnumerable,Mn=(e,t,n)=>t in e?As(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,fn=(e,t)=>{for(var n in t||(t={}))Is.call(t,n)&&Mn(e,n,t[n]);if(An)for(var n of An(t))Ns.call(t,n)&&Mn(e,n,t[n]);return e},jn=(e,t)=>Ms(e,js(t));const In=i.memo(({operation:e,definition:t,index:n,onChange:u,onRemove:f,queryModeller:p,dragHandleProps:E})=>{var b;const y=(0,D.of)(_s),[S,A]=(0,i.useState)({}),C=()=>{if(S.isOpen)A(jn(fn({},S),{isOpen:!1}));else{const X=p.getAlternativeOperations(t.alternativesKey).map(W=>({label:W.name,value:W}));A({isOpen:!0,alternatives:X})}};return i.createElement("div",{className:y.header},!S.isOpen&&i.createElement(i.Fragment,null,i.createElement("div",fn({},E),(b=t.name)!=null?b:t.id),i.createElement(J.Z,{grow:1}),i.createElement("div",{className:`${y.operationHeaderButtons} operation-header-show-on-hover`},i.createElement(ie.$n,{icon:"angle-down",size:"sm",onClick:C,fill:"text",variant:"secondary",title:"Click to view alternative operations"}),i.createElement(Dn,{definition:t,operation:e,innerQueryPlaceholder:p.innerQueryPlaceholder}),i.createElement(ie.$n,{icon:"times",size:"sm",onClick:()=>f(n),fill:"text",variant:"secondary",title:"Remove operation"}))),S.isOpen&&i.createElement("div",{className:y.selectWrapper},i.createElement(yt.l6,{autoFocus:!0,openMenuOnFocus:!0,placeholder:"Replace with",options:S.alternatives,isOpen:!0,onCloseMenu:C,onChange:X=>{if(X.value){const W=p.getOperationDefinition(X.value.id),Ee=[...W.defaultParams];for(let re=0;re<Math.min(e.params.length,Ee.length);re++)W.params[re].type===t.params[re].type&&(Ee[re]=e.params[re]);const k=jn(fn({},e),{params:Ee,id:X.value.id});u(n,t.changeTypeHandler?t.changeTypeHandler(k,W):k)}}})))});In.displayName="OperationHeader";const _s=e=>({header:(0,h.css)({borderBottom:`1px solid ${e.colors.border.medium}`,padding:e.spacing(.5,.5,.5,1),display:"flex",alignItems:"center"}),operationHeaderButtons:(0,h.css)({opacity:1}),selectWrapper:(0,h.css)({paddingRight:e.spacing(2)})});var Kr=l(51440),Us=l(10880);function Bs(e){if(e.editor)return e.editor;if(e.options)return Xs;switch(e.type){case"boolean":return Vs;case"number":case"string":default:return Ws}}function Ws(e){var t;return i.createElement(Kr.D,{id:qa(e.operationId,e.index),defaultValue:(t=e.value)==null?void 0:t.toString(),minWidth:e.paramDef.minWidth,placeholder:e.paramDef.placeholder,title:e.paramDef.description,maxWidth:(e.paramDef.minWidth||20)*3,onCommitChange:n=>{e.onChange(e.index,n.currentTarget.value),e.paramDef.runQueryOnEnter&&n.type==="keydown"&&e.onRunQuery()}})}function Vs(e){return i.createElement(Us.S,{id:qa(e.operationId,e.index),value:!!e.value,onChange:t=>e.onChange(e.index,t.currentTarget.checked)})}function Xs({paramDef:e,value:t,index:n,operationId:u,onChange:f}){var p,E;const b=(0,D.of)(ks);let y=e.options;(p=y[0])!=null&&p.label||(y=e.options.map(A=>({label:A.toString(),value:A})));let S=(E=y.find(A=>A.value===t))!=null?E:(0,jt.z)(t);return!t&&e.optional?i.createElement("div",{className:b.optionalParam},i.createElement(ie.$n,{size:"sm",variant:"secondary",title:`Add ${e.name}`,icon:"plus",onClick:()=>f(n,y[0].value)},e.name)):i.createElement(Le.B,{gap:.5,direction:"row",alignItems:"center"},i.createElement(yt.l6,{id:qa(u,n),value:S,options:y,placeholder:e.placeholder,allowCustomValue:!0,onChange:A=>f(n,A.value),width:e.minWidth||"auto"}),e.optional&&i.createElement(ie.$n,{"data-testid":`operations.${n}.remove-param`,size:"sm",fill:"text",icon:"times",variant:"secondary",title:`Remove ${e.name}`,onClick:()=>f(n,"")}))}const ks=e=>({optionalParam:(0,h.css)({marginTop:e.spacing(1)})});function qa(e,t){return`operations.${e}.param.${t}`}var zs=Object.defineProperty,Ks=Object.defineProperties,Hs=Object.getOwnPropertyDescriptors,Nn=Object.getOwnPropertySymbols,Gs=Object.prototype.hasOwnProperty,Zs=Object.prototype.propertyIsEnumerable,_n=(e,t,n)=>t in e?zs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,en=(e,t)=>{for(var n in t||(t={}))Gs.call(t,n)&&_n(e,n,t[n]);if(Nn)for(var n of Nn(t))Zs.call(t,n)&&_n(e,n,t[n]);return e},tn=(e,t)=>Ks(e,Hs(t));function Ys({provided:e,flash:t,isConflicting:n,highlight:u,index:f,queryModeller:p,onChange:E,onRemove:b,operation:y,definition:S,query:A,timeRange:C,onRunQuery:X,datasource:W}){const Ee=(0,D.$j)(),k=Js(Ee,n),re=qs(t),{current:be}=(0,i.useRef)((0,ta.A)()),ue=(se,Ce)=>{const he=tn(en({},y),{params:[...y.params]});he.params[se]=Ce,pn(S,he,f,se,E)},me=()=>{const se=tn(en({},y),{params:[...y.params,""]});pn(S,se,f,y.params.length,E)},V=se=>{const Ce=tn(en({},y),{params:[...y.params.slice(0,se),...y.params.slice(se+1)]});pn(S,Ce,f,se,E)};let $e;if(S.params.length>0){const se=S.params[S.params.length-1];se.restParam&&($e=ei(se,me,f,y.params.length,k))}return i.createElement("div",tn(en({className:(0,h.cx)(k.card,(re||u)&&k.cardHighlight,n&&k.cardError),ref:e.innerRef},e.draggableProps),{"data-testid":`operations.${f}.wrapper`}),i.createElement(In,{operation:y,dragHandleProps:e.dragHandleProps,definition:S,index:f,onChange:E,onRemove:b,queryModeller:p}),i.createElement("div",{className:k.body},y.params.map((se,Ce)=>{const he=S.params[Math.min(S.params.length-1,Ce)],_e=Bs(he);return i.createElement("div",{className:k.paramRow,key:`${Ce}-1`},!he.hideName&&i.createElement("div",{className:k.paramName},i.createElement("label",{htmlFor:qa(be,Ce)},he.name),he.description&&i.createElement(rr.m,{placement:"top",content:he.description,theme:"info"},i.createElement(ke.I,{name:"info-circle",size:"sm",className:k.infoIcon}))),i.createElement("div",{className:k.paramValue},i.createElement(Le.B,{gap:.5,direction:"row",alignItems:"center",wrap:!1},i.createElement(_e,{index:Ce,paramDef:he,value:y.params[Ce],operation:y,operationId:be,onChange:ue,onRunQuery:X,query:A,datasource:W,timeRange:C,queryModeller:p}),he.restParam&&(y.params.length>S.params.length||he.optional)&&i.createElement(ie.$n,{"data-testid":`operations.${f}.remove-rest-param`,size:"sm",fill:"text",icon:"times",variant:"secondary",title:`Remove ${he.name}`,onClick:()=>V(Ce)}))))})),$e,f<A.operations.length-1&&i.createElement("div",{className:k.arrow},i.createElement("div",{className:k.arrowLine}),i.createElement("div",{className:k.arrowArrow})))}const Js=(e,t)=>({cardWrapper:(0,h.css)({alignItems:"stretch"}),error:(0,h.css)({marginBottom:e.spacing(1)}),card:(0,h.css)({background:e.colors.background.primary,border:`1px solid ${e.colors.border.medium}`,cursor:"grab",borderRadius:e.shape.radius.default,position:"relative",transition:"all 0.5s ease-in 0s",height:t?"auto":"100%"}),cardError:(0,h.css)({boxShadow:`0px 0px 4px 0px ${e.colors.warning.main}`,border:`1px solid ${e.colors.warning.main}`}),cardHighlight:(0,h.css)({boxShadow:`0px 0px 4px 0px ${e.colors.primary.border}`,border:`1px solid ${e.colors.primary.border}`}),infoIcon:(0,h.css)({marginLeft:e.spacing(.5),color:e.colors.text.secondary,":hover":{color:e.colors.text.primary}}),body:(0,h.css)({margin:e.spacing(1,1,.5,1),display:"table"}),paramRow:(0,h.css)({label:"paramRow",display:"table-row",verticalAlign:"middle"}),paramName:(0,h.css)({display:"table-cell",padding:e.spacing(0,1,0,0),fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,verticalAlign:"middle",height:"32px"}),paramValue:(0,h.css)({label:"paramValue",display:"table-cell",verticalAlign:"middle"}),restParam:(0,h.css)({padding:e.spacing(0,1,1,1)}),arrow:(0,h.css)({position:"absolute",top:"0",right:"-18px",display:"flex"}),arrowLine:(0,h.css)({height:"2px",width:"8px",backgroundColor:e.colors.border.strong,position:"relative",top:"14px"}),arrowArrow:(0,h.css)({width:0,height:0,borderTop:"5px solid transparent",borderBottom:"5px solid transparent",borderLeft:`7px solid ${e.colors.border.strong}`,position:"relative",top:"10px"})});function qs(e){const[t,n]=(0,i.useState)(!0);return(0,i.useEffect)(()=>{let u;return e?u=setTimeout(()=>{n(!1)},1e3):n(!0),()=>clearTimeout(u)},[e]),t&&e}function pn(e,t,n,u,f){e.paramChangedHandler?f(n,e.paramChangedHandler(u,t,e)):f(n,t)}function ei(e,t,n,u,f){return i.createElement("div",{className:f.restParam,key:`${u}-2`},i.createElement(ie.$n,{size:"sm",icon:"plus",title:`Add ${e.name}`.trimEnd(),variant:"secondary",onClick:t,"data-testid":`operations.${n}.add-rest-param`},e.name))}function ti({operation:e,index:t,onRemove:n,onChange:u,onRunQuery:f,queryModeller:p,query:E,datasource:b,flash:y,highlight:S,timeRange:A,isConflictingOperation:C}){const X=p.getOperationDefinition(e.id),W=(0,D.$j)(),Ee=C?C(e,E.operations):!1,k=ri(W);if(!X)return i.createElement("span",null,"Operation ",e.id," not found");const re=be=>{if(!be)return Ee?!0:void 0};return i.createElement(gr.sx,{draggableId:`operation-${t}`,index:t},(be,ue)=>i.createElement(It.I,{error:"You have conflicting label filters",invalid:re(ue.isDragging),className:(0,h.cx)(k.error,k.cardWrapper)},i.createElement(Ys,{provided:be,flash:y,highlight:S,isConflicting:Ee,index:t,operation:e,definition:X,onChange:u,onRemove:n,queryModeller:p,query:E,timeRange:A,onRunQuery:f,datasource:b})))}const ri=(e,t)=>({cardWrapper:(0,h.css)({alignItems:"stretch"}),error:(0,h.css)({marginBottom:e.spacing(1)})});var ai=Object.defineProperty,ni=Object.defineProperties,si=Object.getOwnPropertyDescriptors,Un=Object.getOwnPropertySymbols,ii=Object.prototype.hasOwnProperty,oi=Object.prototype.propertyIsEnumerable,Bn=(e,t,n)=>t in e?ai(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,rn=(e,t)=>{for(var n in t||(t={}))ii.call(t,n)&&Bn(e,n,t[n]);if(Un)for(var n of Un(t))oi.call(t,n)&&Bn(e,n,t[n]);return e},hn=(e,t)=>ni(e,si(t));function li({query:e,datasource:t,queryModeller:n,onChange:u,onRunQuery:f,highlightedOp:p,timeRange:E,isConflictingOperation:b}){const y=(0,D.of)(di),{operations:S}=e,A=ci(S),[C,X]=(0,i.useState)(!1),W=(me,V)=>{const $e=[...S];$e.splice(me,1,V),u(hn(rn({},e),{operations:$e}))},Ee=me=>{const V=[...S.slice(0,me),...S.slice(me+1)];u(hn(rn({},e),{operations:V}))},k=n.getCategories().map(me=>({value:me,label:me,items:n.getOperationsForCategory(me).map(V=>({value:V.id,label:V.name,isLeaf:!0}))})),re=me=>{const V=n.getOperationDefinition(me);V&&(u(V.addOperationHandler(V,e,n)),X(!1))},be=me=>{if(!me.destination)return;const V=[...S],$e=V[me.source.index];V.splice(me.source.index,1),V.splice(me.destination.index,0,$e),u(hn(rn({},e),{operations:V}))},ue=()=>{X(!1)};return i.createElement(Le.B,{gap:1,direction:"column"},i.createElement(Le.B,{gap:1},S.length>0&&i.createElement(gr.JY,{onDragEnd:be},i.createElement(gr.gL,{droppableId:"sortable-field-mappings",direction:"horizontal"},me=>i.createElement("div",rn({className:y.operationList,ref:me.innerRef},me.droppableProps),S.map((V,$e)=>i.createElement(ti,{key:V.id+JSON.stringify(V.params)+$e,queryModeller:n,index:$e,operation:V,query:e,datasource:t,onChange:W,onRemove:Ee,onRunQuery:f,flash:A[$e],highlight:p===V,timeRange:E,isConflictingOperation:b})),me.placeholder))),i.createElement("div",{className:y.addButton},C?i.createElement(ua.v,{options:k,onSelect:re,onBlur:ue,autoFocus:!0,alwaysOpen:!0,hideActiveLevelLabel:!0,placeholder:"Search"}):i.createElement(ie.$n,{icon:"plus",variant:"secondary",onClick:()=>X(!0),title:"Add operation"},"Operations"))))}function ci(e){const t=(0,ca.A)(),n=(0,xe.A)(e);if(!t())return e.map(()=>!1);if(!n)return e.map(()=>!0);let u=[];if(n.length-1===e.length&&e.every(f=>n.includes(f)))return e.map(()=>!1);if(n.length+1===e.length&&n.every(f=>e.includes(f))){const f=e.find(p=>!n.includes(p));u=e.map(p=>p===f)}else u=e.map((f,p)=>{var E;return!ui(f.id,(E=n[p])==null?void 0:E.id)});return u}function ui(e,t){return e===t||`__${e}_by`===t||e===`__${t}_by`}const di=e=>({heading:(0,h.css)({label:"heading",fontSize:12,fontWeight:e.typography.fontWeightMedium,marginBottom:0}),operationList:(0,h.css)({label:"operationList",display:"flex",flexWrap:"wrap",gap:e.spacing(2)}),addButton:(0,h.css)({label:"addButton",width:126,paddingBottom:e.spacing(1)})}),Wn=({datasource:e,query:t,onChange:n,data:u,queryModeller:f,buildVisualQueryFromString:p,buildDataQueryFromQueryString:E,buildQueryStringFromDataQuery:b})=>{const[y,S]=(0,i.useState)([]),A=(0,D.of)(fi);return(0,i.useEffect)(()=>{var C;const X=E(f.renderQuery(t)),W=(C=e.getQueryHints)==null?void 0:C.call(e,X,u?.series||[]).filter(Ee=>{var k;return(k=Ee.fix)==null?void 0:k.action});S(W??[])},[e,t,u,f,E]),i.createElement(i.Fragment,null,y.length>0&&i.createElement("div",{className:A.container},y.map(C=>{var X,W,Ee,k;return i.createElement(rr.m,{content:`${C.label} ${(X=C.fix)==null?void 0:X.label}`,key:C.type},i.createElement(ie.$n,{onClick:()=>{var re,be,ue;if((0,ne.rR)("grafana_query_builder_hints_clicked",{hint:C.type,datasourceType:e.type}),(re=C?.fix)!=null&&re.action){const me=E(f.renderQuery(t)),V=(be=e.modifyQuery)==null?void 0:be.call(e,me,C.fix.action);if(V){const $e=p((ue=b(V))!=null?ue:"");return n($e.query)}}},fill:"outline",size:"sm",className:A.hint},"hint: ",((W=C.fix)==null?void 0:W.title)||((k=(Ee=C.fix)==null?void 0:Ee.action)==null?void 0:k.type.toLowerCase().replace("_"," "))))})))};Wn.displayName="QueryBuilderHints";const fi=e=>({container:(0,h.css)`
      display: flex;
      align-items: start;
    `,hint:(0,h.css)`
      margin-right: ${e.spacing(1)};
    `});function Vn({query:e,queryModeller:t,stepNumber:n,language:u,onMouseEnter:f,onMouseLeave:p}){return i.createElement(i.Fragment,null,e.operations.map((E,b)=>{var y;const S=t.getOperationDefinition(E.id);if(!S)return`Operation ${E.id} not found`;const A=S.renderer(E,S,t.innerQueryPlaceholder),C=S.explainHandler?S.explainHandler(E,S):(y=S.documentation)!=null?y:"no docs";return i.createElement("div",{key:b,onMouseEnter:()=>f?.(E,b),onMouseLeave:()=>p?.(E,b)},i.createElement(Xt,{stepNumber:b+n,title:i.createElement(tr.Z,{query:A,language:u}),markdown:C}))}))}var an=l(71713),pi=l(11216),Pr=l(54623);const Xn="Fetch all log lines matching label filters.",kn=(0,i.memo)(({query:e})=>{const t=(0,At.u_)(e||"").query,n={grammar:an.vB,name:"lokiql"};return(0,o.jsxs)(ye.B,{gap:0,direction:"column",children:[(0,o.jsx)(Xt,{stepNumber:1,title:(0,o.jsx)(tr.Z,{query:`${lt.y.renderLabels(t.labels)}`,language:n}),children:Xn}),(0,o.jsx)(Vn,{stepNumber:2,queryModeller:lt.y,query:t,language:n})]})});kn.displayName="LokiQueryBuilderExplained";var hi=l(29158),gi=l(58592);const zn=(0,i.memo)(({nestedQuery:e,index:t,datasource:n,onChange:u,onRemove:f,onRunQuery:p,showExplain:E})=>{const b=(0,D.of)(vi);return(0,o.jsxs)("div",{className:b.card,children:[(0,o.jsxs)("div",{className:b.header,children:[(0,o.jsx)("div",{className:b.name,children:"Operator"}),(0,o.jsx)(yt.l6,{"aria-label":"Select operator",width:"auto",options:mi,value:(0,jt.z)(e.operator),onChange:y=>{u(t,{...e,operator:y.value})}}),(0,o.jsx)("div",{className:b.name,children:"Vector matches"}),(0,o.jsxs)("div",{className:b.vectorMatchWrapper,children:[(0,o.jsx)(yt.l6,{width:"auto",value:e.vectorMatchesType||"on",allowCustomValue:!0,options:[{value:"on",label:"on"},{value:"ignoring",label:"ignoring"}],onChange:y=>{u(t,{...e,vectorMatchesType:y.value})}}),(0,o.jsx)(Kr.D,{className:b.vectorMatchInput,minWidth:20,defaultValue:e.vectorMatches,onCommitChange:y=>{u(t,{...e,vectorMatches:y.currentTarget.value,vectorMatchesType:e.vectorMatchesType||"on"})}})]}),(0,o.jsx)(J.Z,{grow:1}),(0,o.jsx)(hi.K,{name:"times",size:"sm",onClick:()=>f(t),tooltip:"Remove nested query"})]}),(0,o.jsx)("div",{className:b.body,children:(0,o.jsx)(F.D,{children:(0,o.jsx)(gn,{showExplain:E,query:e.query,datasource:n,onRunQuery:p,onChange:y=>{u(t,{...e,query:y})}})})})]})}),mi=gi.C.map(e=>({label:e.sign,value:e.sign}));zn.displayName="NestedQuery";const vi=e=>({card:(0,h.css)({label:"card",display:"flex",flexDirection:"column",gap:e.spacing(.5)}),header:(0,h.css)({label:"header",padding:e.spacing(.5,.5,.5,1),gap:e.spacing(1),display:"flex",alignItems:"center"}),name:(0,h.css)({label:"name",whiteSpace:"nowrap"}),body:(0,h.css)({label:"body",paddingLeft:e.spacing(2)}),vectorMatchInput:(0,h.css)({label:"vectorMatchInput",marginLeft:-1}),vectorMatchWrapper:(0,h.css)({label:"vectorMatchWrapper",display:"flex"})});function Oi({query:e,datasource:t,onChange:n,onRunQuery:u,showExplain:f}){const p=e.binaryQueries??[],E=(y,S)=>{const A=[...p];A.splice(y,1,S),n({...e,binaryQueries:A})},b=y=>{const S=[...p.slice(0,y),...p.slice(y+1)];n({...e,binaryQueries:S})};return(0,o.jsx)(ye.B,{direction:"column",gap:1,children:p.map((y,S)=>(0,o.jsx)(zn,{nestedQuery:y,index:S,onChange:E,datasource:t,onRemove:b,onRunQuery:u,showExplain:f},S.toString()))})}const Kn=5*60*1e3,gn=(0,i.memo)(({datasource:e,query:t,onChange:n,onRunQuery:u,showExplain:f,timeRange:p})=>{const[E,b]=(0,i.useState)(),[y,S]=(0,i.useState)(void 0),A=(0,xe.A)(t),C=(0,xe.A)(p),X=ue=>{n({...t,labels:ue})},W=async ue=>{const me=await ue;return[...e.getVariables(),...me].map(V=>({label:V,value:V}))},Ee=async ue=>{const me=t.labels.filter(he=>he!==ue),V=me.find(he=>he.op==="="||he.op==="=~"&&new RegExp(he.value).test("")===!1);if(me.length===0||!V)return await e.languageProvider.fetchLabels({timeRange:p});const $e=lt.y.renderLabels(me),se=await e.languageProvider.fetchLabels({streamSelector:$e,timeRange:p}),Ce=me.map(he=>he.label);return se.filter(he=>!Ce.includes(he)).sort()},k=async ue=>{if(!ue.label)return[];let me;const V=t.labels.filter(se=>se!==ue),$e=V.find(se=>se.op==="="||se.op==="=~"&&new RegExp(se.value).test("")===!1);if(V.length===0||!$e)me=await e.languageProvider.fetchLabelValues(ue.label,{timeRange:p});else{const se=lt.y.renderLabels(V);me=await e.languageProvider.fetchLabelValues(ue.label,{streamSelector:se,timeRange:p})}return me?me.map(se=>(0,te.Bb)(se,ue.op)):[]},re=(0,i.useMemo)(()=>{const{labels:ue,operations:me}=t;return!ue.length&&me.length?!(me.length===1&&me[0].id===Pr.EF.LineContains&&me[0].params[0]===""):!1},[t]);(0,i.useEffect)(()=>{const ue=async()=>{const $e={expr:lt.y.renderQuery(t),refId:"data-samples"},se=p??(0,wr.E2)(),he={series:await e.getDataSamples($e,se),state:Se.Gu.Done,timeRange:se};b(he)},me=C&&p&&(Math.abs(p.to.valueOf()-C.to.valueOf())>Kn||Math.abs(p.from.valueOf()-C.from.valueOf())>Kn),V=!(0,K.isEqual)(A,t);_.$.featureToggles.lokiQueryHints&&(me||V)&&ue().catch(console.error)},[e,t,p,A,C]);const be={grammar:an.Ay,name:"logql"};return(0,o.jsxs)("div",{"data-testid":vn.editor,children:[(0,o.jsx)(Fr.U,{children:(0,o.jsx)(Ar,{onGetLabelNames:ue=>W(Ee(ue)),onGetLabelValues:ue=>W(k(ue)),labelsFilters:t.labels,onChange:X,labelFilterRequired:re})}),f&&(0,o.jsx)(Xt,{stepNumber:1,title:(0,o.jsx)(tr.Z,{query:`${lt.y.renderLabels(t.labels)}`,language:be}),children:Xn}),(0,o.jsxs)(la.i,{children:[(0,o.jsx)(li,{queryModeller:lt.y,query:t,onChange:n,onRunQuery:u,datasource:e,highlightedOp:y,isConflictingOperation:(ue,me)=>ue.id===Pr.EF.LabelFilter&&(0,pi.hh)(ue,me)}),(0,o.jsx)(Wn,{datasource:e,query:t,onChange:n,data:E,queryModeller:lt.y,buildVisualQueryFromString:At.u_,buildDataQueryFromQueryString:ue=>({expr:ue,refId:"hints"}),buildQueryStringFromDataQuery:ue=>ue.expr})]}),f&&(0,o.jsx)(Vn,{stepNumber:2,queryModeller:lt.y,query:t,language:be,onMouseEnter:ue=>{S(ue)},onMouseLeave:()=>{S(void 0)}}),t.binaryQueries&&t.binaryQueries.length>0&&(0,o.jsx)(Oi,{query:t,datasource:e,onChange:n,onRunQuery:u,showExplain:f})]})});gn.displayName="LokiQueryBuilder";function yi({query:e}){return(0,o.jsx)(Fr.U,{children:(0,o.jsx)(Aa.B,{children:(0,o.jsx)(tr.Z,{query:e,language:{grammar:an.vB,name:"lokiql"}})})})}function bi(e){const{query:t,onChange:n,onRunQuery:u,datasource:f,showExplain:p,timeRange:E}=e,[b,y]=(0,i.useReducer)(Hn.reducer,{expr:t.expr,visQuery:t.expr===""?{labels:[],operations:[{id:"__line_contains",params:[""]}]}:void 0});(0,i.useEffect)(()=>{y(Pi(t.expr))},[t.expr]);const S=A=>{const C=lt.y.renderQuery(A);y(Ei({visQuery:A,expr:C})),n({...e.query,expr:C})};return b.visQuery?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(gn,{query:b.visQuery,datasource:f,onChange:S,onRunQuery:u,showExplain:p,"data-testid":vn.editor,timeRange:E}),t.expr!==""&&(0,o.jsx)(yi,{query:t.expr})]}):null}const xi={expr:""},Hn=(0,Da.Z0)({name:"loki-builder-container",initialState:xi,reducers:{visualQueryChange:(e,t)=>{e.expr=t.payload.expr,e.visQuery=t.payload.visQuery},exprChanged:(e,t)=>{if(!e.visQuery||e.expr!==t.payload){e.expr=t.payload;const n=(0,At.u_)(t.payload);e.visQuery=n.query}}}}),{visualQueryChange:Ei,exprChanged:Pi}=Hn.actions;var Gn=l(70416),Li=l(42941),Si=l(83195),Zn=l(82762);function $i({title:e,children:t,collapsedInfo:n,queryStats:u}){const[f,p]=(0,Li.A)(!1),E=(0,D.of)(Ri);return i.createElement("div",{className:E.wrapper},i.createElement(Zn.S,{className:E.collapse,collapsible:!0,isOpen:f,onToggle:p,label:i.createElement(Le.B,{gap:0},i.createElement("h6",{className:E.title},e),!f&&i.createElement("div",{className:E.description},n.map((b,y)=>i.createElement("span",{key:y},b))))},i.createElement("div",{className:E.body},t)),u&&_.$.featureToggles.lokiQuerySplitting&&i.createElement(rr.m,{content:"Note: the query will be split into multiple parts and executed in sequence. Query limits will only apply each individual part."},i.createElement(ke.I,{tabIndex:0,name:"info-circle",className:E.tooltip,size:"sm"})),u&&i.createElement("p",{className:E.stats},Qi(u)))}const Ri=e=>({collapse:(0,h.css)({backgroundColor:"unset",border:"unset",marginBottom:0,"> button":{padding:e.spacing(0,1)}}),wrapper:(0,h.css)({width:"100%",display:"flex",justifyContent:"space-between",alignItems:"baseline"}),title:(0,h.css)({flexGrow:1,overflow:"hidden",fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,margin:0}),description:(0,h.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.bodySmall.fontWeight,paddingLeft:e.spacing(2),gap:e.spacing(2),display:"flex"}),body:(0,h.css)({display:"flex",gap:e.spacing(2),flexWrap:"wrap"}),stats:(0,h.css)({margin:"0px",color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize}),tooltip:(0,h.css)({marginRight:e.spacing(.25)})}),Qi=e=>e.message?e.message:`This query will process approximately ${Ti(e)}.`,Ti=e=>{const{text:t,suffix:n}=(0,Si.j_)("bytes")(e.bytes,1);return t+n};var wi=l(42418),Lr=l(60016),Yn=l(56587),Hr=l(13137);const Jn=i.memo(({app:e,query:t,onChange:n,onRunQuery:u,maxLines:f,queryStats:p})=>{const[E,b]=(0,i.useState)(!0),y=V=>{n({...t,queryType:V}),u()},S=V=>{n({...t,direction:V}),u()},A=V=>{(0,ne.rR)("grafana_loki_resolution_clicked",{app:e,resolution:V.value}),n({...t,resolution:V.value}),u()},C=V=>{const $e=V.currentTarget.value;if(!(0,Gn.di)($e)){b(!1);return}b(!0),n({...t,splitDuration:$e}),u()},X=V=>{n({...t,legendFormat:V.currentTarget.value}),u()};function W(V){const $e=(0,Lr.wU)(V.currentTarget.value);t.maxLines!==$e&&(n({...t,maxLines:$e}),u())}function Ee(V){n({...t,step:(0,K.trim)(V.currentTarget.value)}),u()}let k=(0,Yn.Io)(t);const re=(0,Yn.sI)(t.expr),be=re?Lr.TO.filter(V=>V.value!==Hr.U3.Instant):Lr.TO,ue=t.direction??Hr.ti.Backward;re&&k===Hr.U3.Instant&&(n({...t,queryType:Hr.U3.Range}),k=Hr.U3.Range);const me=(0,i.useMemo)(()=>!!(!t.step||(0,Gn.V3)(t.step)||!isNaN(Number(t.step))),[t.step]);return(0,o.jsx)(Fr.U,{children:(0,o.jsxs)($i,{title:"Options",collapsedInfo:Fi(t,k,f,re,me),queryStats:p,children:[(0,o.jsx)(Mt.c,{label:"Legend",tooltip:"Series name override or template. Ex. {{hostname}} will be replaced with label value for hostname.",children:(0,o.jsx)(Kr.D,{placeholder:"{{label}}",type:"string",minWidth:14,defaultValue:t.legendFormat,onCommitChange:X})}),be.length>1&&(0,o.jsx)(Mt.c,{label:"Type",children:(0,o.jsx)(g.z,{options:be,value:k,onChange:y})}),re&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Mt.c,{label:"Line limit",tooltip:"Upper limit for number of log lines returned by query.",children:(0,o.jsx)(Kr.D,{className:"width-4",placeholder:f.toString(),type:"number",min:0,defaultValue:t.maxLines?.toString()??"",onCommitChange:W})}),(0,o.jsx)(Mt.c,{label:"Direction",tooltip:"Direction to search for logs.",children:(0,o.jsx)(g.z,{options:Lr.BI,value:ue,onChange:S})})]}),!re&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Mt.c,{label:"Step",tooltip:"Use the step parameter when making metric queries to Loki. If not filled, Grafana's calculated interval will be used. Example valid values: 1s, 5m, 10h, 1d.",invalid:!me,error:"Invalid step. Example valid values: 1s, 5m, 10h, 1d.",children:(0,o.jsx)(Kr.D,{className:"width-6",placeholder:"auto",type:"string",defaultValue:t.step??"",onCommitChange:Ee})}),t.resolution!==void 0&&t.resolution>1&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Mt.c,{label:"Resolution",tooltip:"Changes the step parameter of Loki metrics range queries. With a resolution of 1/1, each pixel corresponds to one data point. 1/10 retrieves one data point per 10 pixels. Lower resolutions perform better.",children:(0,o.jsx)(yt.l6,{isSearchable:!1,onChange:A,options:Lr.iB,value:t.resolution||1,"aria-label":"Select resolution"})}),(0,o.jsx)(wi.F,{severity:"warning",title:"The 'Resolution' is deprecated. Use 'Step' editor instead to change step parameter."})]})]}),_.$.featureToggles.lokiQuerySplittingConfig&&_.$.featureToggles.lokiQuerySplitting&&(0,o.jsx)(Mt.c,{label:"Split Duration",tooltip:"Defines the duration of a single query when query splitting is enabled.",children:(0,o.jsx)(Kr.D,{minWidth:14,type:"string",min:0,defaultValue:t.splitDuration??"1d",onCommitChange:C,invalid:!E})})]})})});function Fi(e,t,n,u,f){const p=Lr.TO.find(y=>y.value===t),E=Lr.iB.find(y=>y.value===(e.resolution??1)),b=[];return e.legendFormat&&b.push(`Legend: ${e.legendFormat}`),b.push(`Type: ${p?.label}`),u&&b.push(`Line limit: ${e.maxLines??n}`),u||(e.step&&b.push(`Step: ${f?e.step:"Invalid value"}`),e.resolution&&b.push(`Resolution: ${E?.label}`)),b}Jn.displayName="LokiQueryBuilderOptions";var qn=l(95881);function Ci({query:e,datasource:t,range:n,onRunQuery:u,onChange:f,data:p,app:E,showExplain:b,history:y}){const S=(0,D.of)(Di);return(0,o.jsxs)("div",{className:S.wrapper,children:[(0,o.jsx)(qn.W,{datasource:t,query:e,range:n,onRunQuery:u,onChange:f,history:y,data:p,app:E,"data-testid":vn.editor}),b&&(0,o.jsx)(kn,{query:e.expr})]})}const Di=e=>({wrapper:(0,h.css)`
      max-width: 100%;
      .gf-form {
        margin-bottom: 0.5;
      }
    `,buttonGroup:(0,h.css)`
      border: 1px solid ${e.colors.border.medium};
      border-top: none;
      padding: ${e.spacing(.5,.5,.5,.5)};
      margin-bottom: ${e.spacing(.5)};
      display: flex;
      flex-grow: 1;
      justify-content: end;
      font-size: ${e.typography.bodySmall.fontSize};
    `,hint:(0,h.css)`
      color: ${e.colors.text.disabled};
      white-space: nowrap;
      cursor: help;
    `});var Ai=l(77789),Mi=l(83657),mn=l(10860);const ji=e=>{const{pattern:t,onPatternSelect:n,hasNewQueryOption:u,hasPreviousQuery:f,selectedPatternName:p,setSelectedPatternName:E}=e,b=(0,D.of)(Ii),y={grammar:an.Ay,name:"logql"};return(0,o.jsxs)(mn.Z,{className:b.card,children:[(0,o.jsx)(mn.Z.Heading,{children:t.name}),(0,o.jsx)("div",{className:b.rawQueryContainer,children:(0,o.jsx)(tr.Z,{query:lt.y.renderQuery({labels:[],operations:t.operations}),language:y,className:b.rawQuery})}),(0,o.jsx)(mn.Z.Actions,{children:p!==t.name?(0,o.jsx)(ie.$n,{size:"sm",onClick:()=>{f?E(t.name):n(t)},children:"Use this query"}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:b.spacing,children:`If you would like to use this query, ${u?"you can either replace your current query or create a new query":"your current query will be replaced"}.`}),(0,o.jsx)(ie.$n,{size:"sm",fill:"outline",onClick:()=>E(null),children:"Back"}),(0,o.jsx)(ie.$n,{size:"sm",onClick:()=>{n(t)},children:"Apply to query"}),u&&(0,o.jsx)(ie.$n,{size:"sm",onClick:()=>{n(t,!0)},children:"Create new query"})]})})]})},Ii=e=>({card:(0,h.css)`
      width: 49.5%;
      display: flex;
      flex-direction: column;
    `,rawQueryContainer:(0,h.css)`
      flex-grow: 1;
    `,rawQuery:(0,h.css)`
      background-color: ${e.colors.background.primary};
      padding: ${e.spacing(1)};
      margin-top: ${e.spacing(1)};
    `,spacing:(0,h.css)`
      margin-bottom: ${e.spacing(1)};
    `}),Ni=[Pr.Ln.Formats,Pr.Ln.LineFilters,Pr.Ln.LabelFilters],_i=[Pr.EF.Unwrap],Ui=Mi.sp.filter(e=>e.category&&Ni.includes(e.category)&&!_i.includes(e.id)).map(e=>e.id),Bi=e=>{const{isOpen:t,onClose:n,onChange:u,onAddQuery:f,query:p,queries:E,app:b}=e,[y,S]=(0,i.useState)([]),[A,C]=(0,i.useState)(null),X=(0,D.of)(Wi),W=!!f,Ee=(0,i.useMemo)(()=>(0,At.u_)(p.expr).query.operations.length>0,[p.expr]),k=(re,be=!1)=>{const ue=(0,At.u_)(be?"":p.expr);(0,ne.rR)("grafana_loki_query_patterns_selected",{version:"v2",app:b??"",editorMode:p.editorMode,selectedPattern:re.name,preSelectedOperationsCount:ue.query.operations.length,preSelectedLabelsCount:ue.query.labels.length,createNewQuery:W&&be}),ue.query.operations=ue.query.operations.filter(V=>Ui.includes(V.id));const me=re.operations.filter(V=>ue.query.operations.findIndex($e=>$e.id===V.id)<0);ue.query.operations=[...ue.query.operations,...me],W&&be?f({...p,refId:(0,Ai.M)(E??[p]),expr:lt.y.renderQuery(ue.query)}):u({...p,expr:lt.y.renderQuery(ue.query)}),C(null),n()};return(0,o.jsxs)(tt.a,{isOpen:t,title:"Kick start your query",onDismiss:n,className:X.modal,children:[(0,o.jsx)("div",{className:X.spacing,children:"Kick start your query by selecting one of these queries. You can then continue to complete your query."}),Object.values(Pr.IQ).map(re=>(0,o.jsx)(Zn.S,{label:`${(0,K.capitalize)(re)} query starters`,isOpen:y.includes(re),collapsible:!0,onToggle:()=>S(be=>be.includes(re)?be.filter(ue=>ue!==re):[...be,re]),children:(0,o.jsx)("div",{className:X.cardsContainer,children:lt.y.getQueryPatterns().filter(be=>be.type===re).map(be=>(0,o.jsx)(ji,{pattern:be,hasNewQueryOption:W,hasPreviousQuery:Ee,onPatternSelect:k,selectedPatternName:A,setSelectedPatternName:C},be.name))})},re)),(0,o.jsx)(ie.$n,{variant:"secondary",onClick:n,children:"Close"})]})},Wi=e=>({cardsContainer:(0,h.css)`
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: space-between;
    `,spacing:(0,h.css)`
      margin-bottom: ${e.spacing(1)};
    `,modal:(0,h.css)`
      width: 85vw;
      ${e.breakpoints.down("md")} {
        width: 100%;
      }
    `}),es="LokiQueryEditorModeDefault";function Vi(e,t,n){e.expr===""&&window.localStorage.setItem(es,t),n({...e,editorMode:t})}function Xi(e){if(e!=null&&e!=="")return ge.f.Code;switch(window.localStorage.getItem(es)){case"code":return ge.f.Code;case"builder":default:return ge.f.Builder}}function ki(e){let t=e;return e.editorMode||(t={...e,editorMode:Xi(e.expr)}),e.expr==null&&(t={...t,expr:""}),e.queryType==null&&(t={...t,queryType:Hr.U3.Range}),t}var zi=l(47232);function ts(e,t){return!e||!t?!1:(0,zi.Ar)(e)?e.isSame(t):e===t}function Ki(e,t,n,u,f,p){return t===void 0||e.trim()!==t.trim()||f!==p?!0:!(ts(n?.raw.from,u?.raw.from)&&ts(n?.raw.to,u?.raw.to))}const vn={editor:"loki-editor"},rs="LokiQueryEditorExplainDefault",as=(0,i.memo)(e=>{const t=(0,i.useId)(),{onChange:n,onRunQuery:u,onAddQuery:f,data:p,app:E,queries:b,datasource:y,range:S}=e,[A,C]=(0,i.useState)(!1),[X,W]=(0,i.useState)(!1),[Ee,k]=(0,i.useState)(!1),[re,be]=(0,i.useState)(!1),[ue,me]=(0,i.useState)(null),[V,$e]=(0,i.useState)(window.localStorage.getItem(rs)==="true"),se=y.predefinedOperations,Ce=(0,xe.A)(S),he=ki(e.query);_.$.featureToggles.lokiPredefinedOperations&&!he.expr&&se&&(he.expr=`{} ${se}`);const _e=(0,xe.A)(he.expr),Be=(0,xe.A)(he.queryType),Ge=he.editorMode,gt=je=>{window.localStorage.setItem(rs,je.currentTarget.checked?"true":"false"),$e(je.currentTarget.checked)},st=(0,i.useCallback)(je=>{if((0,ne.rR)("grafana_loki_editor_mode_clicked",{newEditor:je,previousEditor:he.editorMode??"",newQuery:!he.expr,app:E??""}),je===ge.f.Builder&&(0,At.u_)(he.expr||"").errors.length){C(!0);return}Vi(he,je,n)},[n,he,E]);(0,i.useEffect)(()=>{k(!1)},[p]);const Lt=je=>{(0,K.isEqual)(je,e.query)||k(!0),n(je)},ze=()=>{(0,ne.rR)("grafana_loki_label_browser_opened",{app:E}),be(je=>!je)};return(0,i.useEffect)(()=>{Ki(he.expr,_e,S,Ce,he.queryType,Be)&&S&&(async()=>{const Ft=await y.getStats({...he,refId:`${t}_${he.refId}`},S);me(Ft)})()},[y,S,Ce,he,_e,Be,me,t]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(ae.u,{isOpen:A,title:"Query parsing",body:"There were errors while trying to parse the query. Continuing to visual builder may lose some parts of the query.",confirmText:"Continue",onConfirm:()=>{n({...he,editorMode:ge.f.Builder}),C(!1)},onDismiss:()=>C(!1)}),(0,o.jsx)(Bi,{isOpen:X,onClose:()=>W(!1),query:he,queries:b,app:E,onChange:n,onAddQuery:f}),(0,o.jsx)(ea,{isOpen:re,datasource:y,query:he,app:E,onClose:()=>be(!1),onChange:Lt,onRunQuery:u,timeRange:S}),(0,o.jsxs)(fe.X,{children:[(0,o.jsxs)(ye.B,{gap:1,children:[(0,o.jsx)(ie.$n,{"data-testid":ve.Tp.components.QueryBuilder.queryPatterns,variant:"secondary",size:"sm",onClick:()=>{W(Ze=>!Ze);const je=(0,At.u_)(he.expr||"");(0,ne.rR)("grafana_loki_query_patterns_opened",{version:"v2",app:E??"",editorMode:he.editorMode,preSelectedOperationsCount:je.query.operations.length,preSelectedLabelsCount:je.query.labels.length})},children:"Kick start your query"}),(0,o.jsx)(ie.$n,{variant:"secondary",size:"sm",onClick:ze,"data-testid":"label-browser-button",children:"Label browser"})]}),(0,o.jsx)(Y,{label:"Explain query",value:V,onChange:gt}),(0,o.jsx)(J.Z,{grow:1}),E!==Me.Jk.Explore&&E!==Me.Jk.Correlations&&(0,o.jsx)(ie.$n,{variant:Ee?"primary":"secondary",size:"sm",onClick:u,icon:p?.state===Se.Gu.Loading?"spinner":void 0,disabled:p?.state===Se.Gu.Loading,children:b&&b.length>1?"Run queries":"Run query"}),(0,o.jsx)(O,{mode:Ge,onChange:st})]}),(0,o.jsx)(Ne.$,{v:.5}),(0,o.jsxs)(F.D,{children:[Ge===ge.f.Code&&(0,o.jsx)(Ci,{...e,query:he,onChange:Lt,showExplain:V}),Ge===ge.f.Builder&&(0,o.jsx)(bi,{datasource:e.datasource,query:he,onChange:Lt,onRunQuery:e.onRunQuery,showExplain:V,timeRange:S}),(0,o.jsx)(Jn,{query:he,onChange:n,onRunQuery:u,app:E,maxLines:y.maxLines,queryStats:ue})]})]})});as.displayName="LokiQueryEditor";function Hi(e){const{query:t,data:n,datasource:u,onChange:f,onRunQuery:p,history:E}=e;return(0,o.jsx)(qn.W,{datasource:u,query:t,onChange:f,onRunQuery:p,history:E,data:n,placeholder:"Enter a Loki query","data-testid":Gi.editor})}const Gi={editor:"loki-editor-cloud-alerting"};function Zi(e){const{app:t}=e;switch(t){case Me.Jk.CloudAlerting:return(0,o.jsx)(Hi,{...e});default:return(0,o.jsx)(as,{...e})}}const Yi=(0,i.memo)(Zi),_o={editor:"loki-editor"};var Ji=l(68704),qi=l(77657),eo=l(39748),to=l(66025),ro=l(91062),ao=l(32346),On=l(25994),no=l(17081),yn=l(29020),bn=l(35931);function so({options:e,onOptionsChange:t}){return(0,o.jsx)(yn.I,{title:"Alerting",description:(0,o.jsx)(bn.H,{description:"Manage alert rules for the Loki data source.",suffix:"loki/configure-loki-data-source/#alerting",feature:"alerting"}),children:(0,o.jsx)(It.I,{labelWidth:29,label:"Manage alert rules in Alerting UI",disabled:e.readOnly,tooltip:"Manage alert rules for this data source. To manage other alerting resources, add an Alertmanager data source.",children:(0,o.jsx)(Pe.K,{value:e.jsonData.manageAlerts!==!1,onChange:n=>t({...e,jsonData:{...e.jsonData,manageAlerts:n.currentTarget.checked}})})})})}var io=l(6709),oo=l(91890),lo=l(72574),co=l(21744);const uo=e=>{const{derivedFields:t,className:n}=e,[u,f]=(0,i.useState)("");let p=[];return u&&t&&(p=po(t,u)),(0,o.jsxs)("div",{className:n,children:[(0,o.jsx)(It.I,{label:"Debug log message",labelWidth:24,grow:!0,children:(0,o.jsx)(co.f,{type:"text","aria-label":"Loki query",placeholder:"Paste an example log line here to test the regular expressions of your derived fields",value:u,onChange:E=>f(E.currentTarget.value)})}),!!p.length&&(0,o.jsx)(fo,{fields:p})]})},fo=({fields:e})=>(0,o.jsxs)("table",{className:"filter-table",children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{children:"Name"}),(0,o.jsx)("th",{children:"Value"}),(0,o.jsx)("th",{children:"Url"})]})}),(0,o.jsx)("tbody",{children:e.map(t=>{let n=t.value;return t.error&&t.error instanceof Error?n=t.error.message:t.href&&(n=(0,o.jsx)("a",{href:t.href,children:n})),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:t.name}),(0,o.jsx)("td",{children:n}),(0,o.jsx)("td",{children:t.href?(0,o.jsx)("a",{href:t.href,children:t.href}):""})]},`${t.name}=${t.value}`)})})]});function po(e,t){return e.filter(n=>n.name&&n.matcherRegex).map(n=>{try{const u=t.match(n.matcherRegex);let f;const p=u&&u[1];return p&&(f=(0,lo.w)().replace(n.url,{__value:{value:{raw:p},text:"Raw value"}})),{name:n.name,value:p||"<no match>",href:f}}catch(u){return{name:n.name,error:u}}})}var ho=l(55882),dr=l(88575),go=l(64078);const mo=e=>({row:(0,h.css)`
    display: flex;
    align-items: baseline;
  `,nameField:(0,h.css)`
    flex: 2;
    margin-right: ${e.spacing(.5)};
  `,regexField:(0,h.css)`
    flex: 3;
    margin-right: ${e.spacing(.5)};
  `,urlField:(0,h.css)`
    flex: 1;
    margin-right: ${e.spacing(.5)};
  `,urlDisplayLabelField:(0,h.css)`
    flex: 1;
  `,internalLink:(0,h.css)`
    margin-right: ${e.spacing(1)};
  `,dataSource:(0,h.css)``,nameMatcherField:(0,h.css)({width:e.spacing(20),marginRight:e.spacing(.5)})}),vo=e=>{const{value:t,onChange:n,onDelete:u,suggestions:f,className:p,validateName:E}=e,b=(0,D.of)(mo),[y,S]=(0,i.useState)(!!t.datasourceUid),A=(0,xe.A)(t.datasourceUid),[C,X]=(0,i.useState)(t.matcherType??"regex");(0,i.useEffect)(()=>{!A&&t.datasourceUid&&!y&&S(!0),A&&!t.datasourceUid&&y&&S(!1)},[A,t.datasourceUid,y]);const W=k=>re=>{n({...t,[k]:re.currentTarget.value})},Ee=!E(t.name);return(0,o.jsxs)("div",{className:p,"data-testid":"derived-field",children:[(0,o.jsxs)("div",{className:"gf-form",children:[(0,o.jsx)(dr.D,{className:b.nameField,label:"Name",invalid:Ee,error:"The name is already in use",children:(0,o.jsx)(Dt.p,{value:t.name,onChange:W("name"),placeholder:"Field name",invalid:Ee})}),(0,o.jsx)(dr.D,{className:b.nameMatcherField,label:(0,o.jsx)(nn,{label:"Type",content:"Derived fields can be created from labels or by applying a regular expression to the log message."}),children:(0,o.jsx)(yt.l6,{options:[{label:"Regex in log line",value:"regex"},{label:"Label",value:"label"}],value:C,onChange:k=>{(k.value==="label"||k.value==="regex")&&(X(k.value),n({...t,matcherType:k.value}))}})}),(0,o.jsx)(dr.D,{className:b.regexField,label:(0,o.jsxs)(o.Fragment,{children:[C==="regex"&&(0,o.jsx)(nn,{label:"Regex",content:"Use to parse and capture some part of the log message. You can use the captured groups in the template."}),C==="label"&&(0,o.jsx)(nn,{label:"Label",content:"Use to derive the field from a label."})]}),children:(0,o.jsx)(Dt.p,{value:t.matcherRegex,onChange:W("matcherRegex")})}),(0,o.jsx)(dr.D,{label:"",children:(0,o.jsx)(ie.$n,{variant:"destructive",title:"Remove field",icon:"times",onClick:k=>{k.preventDefault(),u()}})})]}),(0,o.jsxs)("div",{className:"gf-form",children:[(0,o.jsx)(dr.D,{label:y?"Query":"URL",className:b.urlField,children:(0,o.jsx)(go.l,{placeholder:y?"${__value.raw}":"http://example.com/${__value.raw}",value:t.url||"",onChange:k=>n({...t,url:k}),suggestions:f})}),(0,o.jsx)(dr.D,{className:b.urlDisplayLabelField,label:(0,o.jsx)(nn,{label:"URL Label",content:"Use to override the button label when this derived field is found in a log."}),children:(0,o.jsx)(Dt.p,{value:t.urlDisplayLabel,onChange:W("urlDisplayLabel")})})]}),(0,o.jsxs)("div",{className:"gf-form",children:[(0,o.jsx)(dr.D,{label:"Internal link",className:b.internalLink,children:(0,o.jsx)(Pe.d,{value:y,onChange:k=>{const{checked:re}=k.currentTarget;re||n({...t,datasourceUid:void 0}),S(re)}})}),y&&(0,o.jsx)(dr.D,{label:"",className:b.dataSource,children:(0,o.jsx)(ho.s,{tracing:!0,onChange:k=>n({...t,datasourceUid:k.uid}),current:t.datasourceUid,noDefault:!0})})]})]})},nn=({content:e,label:t})=>(0,o.jsxs)(Bt.J,{children:[t,(0,o.jsx)(rr.m,{placement:"top",content:e,theme:"info",children:(0,o.jsx)(ke.I,{tabIndex:0,name:"info-circle",size:"sm",style:{marginLeft:"10px"}})})]}),Oo=e=>({addButton:(0,h.css)`
    margin-right: 10px;
  `,derivedField:(0,h.css)`
    margin-bottom: ${e.spacing(1)};
  `,container:(0,h.css)`
    margin-bottom: ${e.spacing(4)};
  `,debugSection:(0,h.css)`
    margin-top: ${e.spacing(4)};
  `}),yo=({fields:e=[],onChange:t})=>{const n=(0,D.$j)(),u=Oo(n),[f,p]=(0,i.useState)(!1),E=(0,i.useCallback)(b=>e.filter(y=>y.name&&y.name===b).length<=1,[e]);return(0,o.jsx)(yn.I,{title:"Derived fields",description:(0,o.jsx)(bn.H,{description:"Derived fields can be used to extract new fields from a log message and create a link from its value.",suffix:"loki/configure-loki-data-source/#derived-fields",feature:"derived fields"}),children:(0,o.jsxs)("div",{className:u.container,children:[e.map((b,y)=>(0,o.jsx)(vo,{className:u.derivedField,value:b,onChange:S=>{const A=[...e];A.splice(y,1,S),t(A)},onDelete:()=>{const S=[...e];S.splice(y,1),t(S)},validateName:E,suggestions:[{value:io.c.valueRaw,label:"Raw value",documentation:"Exact string captured by the regular expression",origin:oo.$0.Value}]},y)),(0,o.jsxs)("div",{children:[(0,o.jsx)(ie.$n,{variant:"secondary",className:u.addButton,icon:"plus",onClick:b=>{b.preventDefault();const y={name:"",matcherRegex:"",urlDisplayLabel:"",url:"",matcherType:"regex"},S=[...e,y];t(S)},children:"Add"}),e.length>0&&(0,o.jsx)(ie.$n,{variant:"secondary",type:"button",onClick:()=>p(!f),children:f?"Hide example log message":"Show example log message"})]}),f&&(0,o.jsx)("div",{className:u.debugSection,children:(0,o.jsx)(uo,{className:(0,h.css)`
                margin-bottom: 10px;
              `,derivedFields:e})})]})})};var bo=l(39268),xo=l(39938);const Eo=e=>{const{maxLines:t,onMaxLinedChange:n,predefinedOperations:u,onPredefinedOperationsChange:f}=e;return(0,o.jsxs)(yn.I,{title:"Queries",description:(0,o.jsx)(bn.H,{description:"Additional options to customize your querying experience.",suffix:"loki/configure-loki-data-source/#queries",feature:"query settings"}),children:[(0,o.jsx)(It.I,{label:"Maximum lines",htmlFor:"loki_config_maxLines",labelWidth:22,tooltip:(0,o.jsx)(o.Fragment,{children:"Loki queries must contain a limit of the maximum number of lines returned (default: 1000). Increase this limit to have a bigger result set for ad-hoc analysis. Decrease this limit if your browser becomes sluggish when displaying the log results."}),children:(0,o.jsx)(Dt.p,{type:"number",id:"loki_config_maxLines",value:t,onChange:p=>n(p.currentTarget.value),width:16,placeholder:"1000",spellCheck:!1})}),_.$.featureToggles.lokiPredefinedOperations&&(0,o.jsxs)(bo.C,{children:[(0,o.jsx)(It.I,{label:"Predefined operations",htmlFor:"loki_config_predefinedOperations",labelWidth:22,tooltip:(0,o.jsx)(o.Fragment,{children:'Predefined operations are used as an initial state for your queries. They are useful, if you want to unpack, parse or format all log lines. Currently we support only log operations starting with |. For example: | unpack | line_format "{{.message}}".'}),children:(0,o.jsx)(Dt.p,{type:"string",id:"loki_config_predefinedOperations",value:u,onChange:p=>f(p.currentTarget.value),width:40,placeholder:"| unpack | line_format",spellCheck:!1})}),(0,o.jsx)(It.I,{children:(0,o.jsx)(xo.E,{text:"Experimental",color:"orange",icon:"exclamation-triangle",tooltip:"Predefined operations is an experimental feature that may change in the future."})})]})]})},xn=e=>(t,n)=>({...t,jsonData:{...t.jsonData,[e]:n}}),Po=xn("maxLines"),Lo=xn("predefinedOperations"),So=xn("derivedFields"),$o=e=>{const{options:t,onOptionsChange:n}=e,u=(0,i.useCallback)(f=>{(0,ne.rR)("grafana_loki_predefined_operations_changed",{value:f}),n(Lo(t,f))},[t,n]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ji.I,{dataSourceName:"Loki",docsLink:"https://grafana.com/docs/grafana/latest/datasources/loki/configure-loki-data-source/",hasRequiredFields:!1}),(0,o.jsx)(On.c,{spacing:4}),(0,o.jsx)(qi.u,{config:t,onChange:n,urlPlaceholder:"http://localhost:3100"}),(0,o.jsx)(On.c,{spacing:4}),(0,o.jsx)(eo.N,{...(0,to.pe)({config:t,onChange:n})}),(0,o.jsx)(On.c,{spacing:4}),(0,o.jsx)(ro.A,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source.",isCollapsible:!0,isInitiallyOpen:!0,children:(0,o.jsxs)(ye.B,{gap:5,direction:"column",children:[(0,o.jsx)(ao.g,{config:t,onChange:n}),_.$.secureSocksDSProxyEnabled&&(0,o.jsx)(no.Y,{options:t,onOptionsChange:n}),(0,o.jsx)(so,{options:t,onOptionsChange:n}),(0,o.jsx)(Eo,{maxLines:t.jsonData.maxLines||"",onMaxLinedChange:f=>n(Po(t,f)),predefinedOperations:t.jsonData.predefinedOperations||"",onPredefinedOperationsChange:u}),(0,o.jsx)(yo,{fields:t.jsonData.derivedFields,onChange:f=>n(So(t,f))})]})})]})};var Ro=l(27724),Qo=l(79007);const To=new Q.tD(Ro.VQ).setQueryEditor(Yi).setConfigEditor($o).setQueryEditorHelp(U);(0,M.J7)().subscribe(Oe.gc,Qo.jg)},56587:(Ke,Fe,l)=>{"use strict";l.d(Fe,{$F:()=>Z,Cg:()=>w,FV:()=>Se,H0:()=>i,Io:()=>le,MX:()=>ge,OT:()=>B,QH:()=>I,Rn:()=>He,TQ:()=>Me,_i:()=>Le,aw:()=>fe,d_:()=>Pe,g5:()=>Qe,gy:()=>pe,mW:()=>ne,pS:()=>De,pk:()=>N,sI:()=>ve,sc:()=>G,vV:()=>te});var Q=l(2543),Oe=l.n(Q),M=l(36195),o=l(12798),h=l(56245),K=l(13137);function i(T=""){const Y=[],z=I(T,[M.PN]);for(const J of z){const g=J.getChild(M.dJ)?.getChild(M.Sg),$=J.getChild(M.dJ)?.getChild(M.q5),O=D(J);if(!(!g&&!$||!O.length))for(const F of O){const _=T.substring(F.from,F.to).trim(),ae=_[0]==="`",ye=_.substring(1,_.length-1);if(!ye)continue;let ie="";$?ie=ae?ye:ye.replace(/\\\\/g,"\\"):ie=(0,Q.escapeRegExp)(ye),ie&&Y.push(ie)}}return Y}function ne(T){return T.replace("Expr: ","")}function D(T){const Y=[];let z=T;do{const J=z.getChild(M.Qf);J&&!z.getChild(M.w7)&&Y.push(J),z=z.getChild(M.ih)}while(z!=null);return Y}function te(T){let Y=le(T);const{instant:z,range:J,...g}=T;try{ve(T.expr)&&Y===K.U3.Instant&&(Y=K.U3.Range)}catch{}return{...g,queryType:Y}}function le(T){const{queryType:Y}=T;return Y===K.U3.Range||Y===K.U3.Instant||Y===K.U3.Stream?Y:T.instant===!0?K.U3.Instant:K.U3.Range}const R=["String","Identifier","LineComment","Number"],de=["__error__","__interval","__interval_ms","__auto"];function Z(T){let Y=T;return M.K3.parse(T).iterate({enter:({name:J,from:g,to:$})=>{const O=T.substring(g,$);R.includes(J)&&!de.includes(O)&&(Y=Y.replace(O,J))}}),Y}function x(T){const Y=[];return parser.parse(T).iterate({enter:({name:J})=>{Y.push(J)}}),Y}function U(T,Y){let z=!1;return M.K3.parse(T).iterate({enter:({type:g})=>{if(g.id===Y)return z=!0,!1}}),z}function I(T,Y){const z=[];return M.K3.parse(T).iterate({enter:g=>{(Y===void 0||Y.includes(g.type.id))&&z.push(g.node)}}),z}function Me(T,Y){const z=[];return M.K3.parse(T).iterate({enter:g=>{(Y===void 0||Y.includes(g.type.id))&&z.push(o.Ch.fromNode(g.node))}}),z}function xe(T,Y){const z=I(T,[Y]);return z.length>0?z[0]:void 0}function Se(T){return U(T,h.Ql)}function ve(T){return T.trim().length>2&&!U(T,M.Yw)}function ge(T){const z=I(T,[M.iT,M.eF,M.c$]).length;return{queryWithParser:z>0,parserCount:z}}function fe(T){const Y=I(T,[M.iT,M.LM,M.c$]);return Y.length>0?T.substring(Y[0].from,Y[0].to).trim():void 0}function Pe(T){const Y=I(T,[M.bY]);for(const z of Y){const J=z.getChild(M.g$)?.getChild(M.gw);if(J&&T.substring(J.from,J.to)==="__error__")return!0}return!1}function Le(T){return U(T,M.J_)}function B(T){if(ve(T))return T;const Y=xe(T,M.MD);if(!Y)return"";const z=T.substring(Y.from,Y.to),J=xe(T,M.AL),g=J?T.substring(J.from,J.to):"";return`${z} ${g}`.trim()}function Qe(T,Y){if(ve(T))return T;const z=I(T,[M.Yw]).reverse().find(J=>J.from<=Y&&J.to>=Y);return z?B(T.substring(z.from,z.to)):""}function De(T){return U(T,M.bY)}function He(T){return U(T,M.PN)}function w(T){const Y=I(T,[M.Q6]);for(const z of Y)if(T.substring(z.from,z.to).match(/\[\$__range(_s|_ms)?/))return!0;return!1}function N(T){return(0,o.yB)(T).map(J=>T.slice(J.from,J.to))}function pe(T){return T.filter(z=>!z.hide).filter(z=>!z.refId.includes("do-not-chunk")).filter(z=>z.expr).length>0}const ce=T=>T?"expr"in T&&T.expr!==void 0:!1,G=T=>{if(!(!T||!ce(T)))return T}},43548:(Ke,Fe,l)=>{"use strict";l.d(Fe,{y:()=>i});var Q=l(83077),Oe=l(42952);class M{constructor(D,te){this.categories=[],this.operationsRegistry=new Q.O(()=>D),this.innerQueryPlaceholder=te||"<query>"}setOperationCategories(D){this.categories=D}getOperationsForCategory(D){return this.operationsRegistry.list().filter(te=>te.category===D&&!te.hideFromList)}getAlternativeOperations(D){return this.operationsRegistry.list().filter(te=>te.alternativesKey&&te.alternativesKey===D)}getCategories(){return this.categories}getOperationDefinition(D){return this.operationsRegistry.getIfExists(D)}hasBinaryOp(D){return D.operations.find(te=>{const le=this.getOperationDefinition(te.id);return le?.category===Oe.T})!==void 0}}var o=l(83657),h=l(54623);class K extends M{constructor(){super(o.sp,"<expr>"),this.setOperationCategories([h.Ln.Aggregations,h.Ln.RangeFunctions,h.Ln.Formats,h.Ln.BinaryOps,h.Ln.LabelFilters,h.Ln.LineFilters])}renderOperations(D,te){for(const le of te){const R=this.operationsRegistry.getIfExists(le.id);if(!R){console.error(`Could not find operation ${le.id} in the registry`);continue}D=R.renderer(le,R,D)}return D}renderBinaryQueries(D,te){if(te)for(const le of te)D=`${this.renderBinaryQuery(D,le)}`;return D}renderBinaryQuery(D,te){let le=D+` ${te.operator} `;return te.vectorMatches&&(le+=`${te.vectorMatchesType}(${te.vectorMatches}) `),le+this.renderQuery(te.query,!0)}renderLabels(D){if(D.length===0)return"{}";let te="{";for(const le of D)te!=="{"&&(te+=", "),te+=`${le.label}${le.op}"${le.value}"`;return te+"}"}renderQuery(D,te){let le=this.renderLabels(D.labels);return le=this.renderOperations(le,D.operations),!te&&this.hasBinaryOp(D)&&D.binaryQueries?.length&&(le=`(${le})`),le=this.renderBinaryQueries(le,D.binaryQueries),le}getQueryPatterns(){return[{name:"Parse log lines with logfmt parser",type:h.IQ.Log,operations:[{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]}]},{name:"Parse log lines with JSON parser",type:h.IQ.Log,operations:[{id:h.EF.Json,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]}]},{name:"Filter log line and parse with logfmt parser",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]}]},{name:"Filter log lines and parse with json parser",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Json,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]}]},{name:"Parse log line with logfmt parser and use label filter",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.LabelFilter,params:["label","=","value"]}]},{name:"Parse log lines with nested json",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Json,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.LineFormat,params:["{{.message}}"]},{id:h.EF.Json,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]}]},{name:"Reformat log lines",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.LineFormat,params:["{{.message}}"]}]},{name:"Rename lvl label to level",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.LabelFormat,params:["lvl","level"]}]},{name:"Query on value inside a log line",type:h.IQ.Metric,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.Unwrap,params:[""]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.SumOverTime,params:["$__auto"]},{id:h.EF.Sum,params:[]}]},{name:"Total requests per label of streams",type:h.IQ.Metric,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.CountOverTime,params:["$__auto"]},{id:h.EF.Sum,params:[]}]},{name:"Total requests per parsed label or label of streams",type:h.IQ.Metric,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.CountOverTime,params:["$__auto"]},{id:h.EF.Sum,params:[]}]},{name:"Bytes used by a log stream",type:h.IQ.Metric,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.BytesOverTime,params:["$__auto"]}]},{name:"Count of log lines per stream",type:h.IQ.Metric,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.CountOverTime,params:["$__auto"]}]},{name:"Top N results by label or parsed label",type:h.IQ.Metric,operations:[{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.CountOverTime,params:["$__auto"]},{id:h.EF.Sum,params:[]},{id:h.EF.TopK,params:[10]}]},{name:"Extracted quantile",type:h.IQ.Metric,operations:[{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.Unwrap,params:["latency"]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.QuantileOverTime,params:["$__auto",.5]},{id:h.EF.Sum,params:[]}]}]}}const i=new K},58592:(Ke,Fe,l)=>{"use strict";l.d(Fe,{C:()=>M,I:()=>o});var Q=l(11216),Oe=l(54623);const M=[{id:Oe.EF.Addition,name:"Add scalar",sign:"+"},{id:Oe.EF.Subtraction,name:"Subtract scalar",sign:"-"},{id:Oe.EF.MultiplyBy,name:"Multiply by scalar",sign:"*"},{id:Oe.EF.DivideBy,name:"Divide by scalar",sign:"/"},{id:Oe.EF.Modulo,name:"Modulo by scalar",sign:"%"},{id:Oe.EF.Exponent,name:"Exponent",sign:"^"},{id:Oe.EF.EqualTo,name:"Equal to",sign:"==",comparison:!0},{id:Oe.EF.NotEqualTo,name:"Not equal to",sign:"!=",comparison:!0},{id:Oe.EF.GreaterThan,name:"Greater than",sign:">",comparison:!0},{id:Oe.EF.LessThan,name:"Less than",sign:"<",comparison:!0},{id:Oe.EF.GreaterOrEqual,name:"Greater or equal to",sign:">=",comparison:!0},{id:Oe.EF.LessOrEqual,name:"Less or equal to",sign:"<=",comparison:!0}],o=M.map(K=>{const i=[{name:"Value",type:"number"}];let ne=[2];return K.comparison&&(i.push({name:"Bool",type:"boolean",description:"If checked comparison will return 0 or 1 for the value rather than filtering."}),ne=[2,!1]),{id:K.id,name:K.name,params:i,defaultParams:ne,alternativesKey:"binary scalar operations",category:Oe.Ln.BinaryOps,renderer:h(K.sign),addOperationHandler:Q.iZ}});function h(K){return function(ne,D,te){let le=ne.params[0],R="";return ne.params.length===2&&(R=ne.params[1]?" bool":""),`${te} ${K}${R} ${le}`}}},11216:(Ke,Fe,l)=>{"use strict";l.d(Fe,{af:()=>ge,VR:()=>fe,G3:()=>pe,jC:()=>z,fu:()=>de,yD:()=>Z,iZ:()=>N,UF:()=>Pe,OS:()=>B,hh:()=>Me,sn:()=>I,EP:()=>xe});var Q=l(2543),Oe=l(55127),M=l.n(Oe),o=l(97535),h=l(71713),K=l(74848),i=l(96540),ne=l(90182);const D=({onChange:g,index:$,operationId:O,value:F,query:_,datasource:ae,queryModeller:ye})=>{const[ie,Ne]=(0,i.useState)({});return(0,K.jsx)(ne.l6,{inputId:B(O,$),autoFocus:F==="",openMenuOnFocus:!0,onOpenMenu:async()=>{Ne({isLoading:!0});const Ue=await te(_,ae,ye);Ne({options:Ue,isLoading:void 0})},isLoading:ie.isLoading,allowCustomValue:!0,noOptionsMessage:"No labels found",loadingMessage:"Loading labels",options:ie.options,value:le(F),onChange:Ue=>g($,Ue.value)})};async function te(g,$,O){let F=g.labels;const _=O.renderLabels(F);return(await $.languageProvider.fetchLabels({streamSelector:_})).map(ye=>({label:ye,value:ye}))}const le=g=>({label:g?.toString(),value:g});var R=l(54623);function de(g,$){const O=[Le()],F=["$__auto"];let _;return g===R.EF.QuantileOverTime&&(F.push("0.95"),O.push({name:"Quantile",type:"number"})),$&&(O.push({name:"By label",type:"string",restParam:!0,optional:!0}),_=Qe(`__${g}_by`)),{id:g,name:w(g),params:O,defaultParams:F,alternativesKey:"range function",category:R.Ln.RangeFunctions,orderRank:R.h5.RangeVectorFunction,renderer:U,addOperationHandler:ge,paramChangedHandler:_,explainHandler:(ae,ye)=>{let ie=h.AW.find(Ne=>Ne.insertText===ae.id)?.documentation??"";return ae.params[0]==="$__auto"?`${ie} \`$__auto\` is a variable that will be replaced with the [value of step](https://grafana.com/docs/grafana/next/datasources/loki/query-editor/#options) for range queries and with the value of the selected time range (calculated to - from) for instant queries.`:`${ie} The [range vector](https://grafana.com/docs/loki/latest/logql/metric_queries/#range-vector-aggregation) is set to \`${ae.params[0]}\`.`}}}function Z(g){const $=de(g,!0),O=$.params.slice(0,-1);return[$,{id:`__${g}_by`,name:`${w(g)} by`,params:[...O,{name:"Label",type:"string",restParam:!0,optional:!0,editor:D}],defaultParams:[...$.defaultParams,""],alternativesKey:"range function with grouping",category:R.Ln.RangeFunctions,renderer:x(g,"by"),paramChangedHandler:He(g),explainHandler:De(g,"by"),addOperationHandler:ge,hideFromList:!0},{id:`__${g}_without`,name:`${w(g)} without`,params:[...O,{name:"Label",type:"string",restParam:!0,optional:!0,editor:D}],defaultParams:[...$.defaultParams,""],alternativesKey:"range function with grouping",category:R.Ln.RangeFunctions,renderer:x(g,"without"),paramChangedHandler:He(g),explainHandler:De(g,"without"),addOperationHandler:ge,hideFromList:!0}]}function x(g,$){return function(F,_,ae){const ye=_.params.findIndex(Ue=>Ue.restParam),ie=F.params.slice(0,ye),Ne=F.params.slice(ye);return ie.length===2&&g===R.EF.QuantileOverTime?`${g}(${ie[1]}, ${ae} [${ie[0]}]) ${$} (${Ne.join(", ")})`:`${g}(${ae} [${ie[0]}]) ${$} (${Ne.join(", ")})`}}function U(g,$,O){const F=g.params??[],_=F[0]??"$__auto";if(F.length===2&&g.id===R.EF.QuantileOverTime){const ae=F[1];return`${g.id}(${ae}, ${O} [${_}])`}return`${g.id}(${O} [${F[0]??"$__auto"}])`}function I(g,$,O){return["<","<=",">",">="].includes(String(g.params[1]))?`${O} | ${g.params[0]} ${g.params[1]} ${g.params[2]}`:`${O} | ${g.params[0]} ${g.params[1]} \`${g.params[2]}\``}function Me(g,$){if(!g)return!1;const O=g.params[1].toString().startsWith("!");return $.filter(ae=>ae.id===R.EF.LabelFilter&&ae.params[0]===g.params[0]&&ae.params[2]===g.params[2]).some(ae=>!!(O&&ae.params[1].toString().startsWith("!")===!1||O===!1&&ae.params[1].toString().startsWith("!")))}function xe(g,$,O){switch(g.id){case R.EF.Logfmt:const[F=!1,_=!1,...ae]=g.params;return`${O} | logfmt${F?" --strict":""}${_?" --keep-empty":""} ${ae.filter(ye=>ye).join(", ")}`.trim();case R.EF.Json:return`${O} | json ${g.params.filter(ye=>ye).join(", ")}`.trim();case R.EF.Drop:return`${O} | drop ${g.params.filter(ye=>ye).join(", ")}`.trim();case R.EF.Keep:return`${O} | keep ${g.params.filter(ye=>ye).join(", ")}`.trim();default:return`${O} | ${g.id}`}}function Se(g){return g.category===R.Ln.RangeFunctions}function ve(g,$,O){const F=g.findIndex(_=>{const ae=$.getOperationDefinition(_.id);return ae?O(ae):!1});return F===-1?g.length:F}function ge(g,$,O){const F={id:g.id,params:g.defaultParams},_=[...$.operations],ae=_.find(ye=>{const ie=O.getOperationDefinition(ye.id);return ie?Se(ie):!1});switch(g.category){case R.Ln.Aggregations:case R.Ln.Functions:if(!ae){const ie=ve(_,O,Ne=>Ne.category===R.Ln.Functions);_.splice(ie,0,{id:R.EF.Rate,params:["$__auto"]})}_.push(F);break;case R.Ln.RangeFunctions:if(ae){const ie=_.indexOf(ae);_[ie]=F;break}default:const ye=ve(_,O,ie=>(g.orderRank??100)<(ie.orderRank??100));_.splice(ye,0,F);break}return{...$,operations:_}}function fe(g,$){return{...$,binaryQueries:[...$.binaryQueries??[],{operator:"/",query:$}]}}function Pe(g,$){return function(F,_,ae){const ye=F.params.some(Ue=>typeof Ue=="string"&&Ue.includes("`")),ie=ye?'"':"`";let Ne;return ye?Ne=F.params.map(Ue=>typeof Ue=="string"?(0,o.Qn)(Ue):Ue):Ne=F.params,$?`${ae} ${g} ${ie}(?i)${Ne.join(`${ie} or ${ie}(?i)`)}${ie}`:`${ae} ${g} ${ie}${Ne.join(`${ie} or ${ie}`)}${ie}`}}function Le(){return{name:"Range",type:"string",options:["$__auto","1m","5m","10m","1h","24h"]}}function B(g,$){return`operations.${g}.param.${$}`}function Qe(g){return function(O,F,_){return F.params.length===_.params.length?{...F,id:g}:F}}function De(g,$){return function(F){const _=F.params.map(ye=>`\`${ye}\``).join(" and "),ae=M()("label",F.params.length);switch($){case"by":return`Calculates ${g} over dimensions while preserving ${ae} ${_}.`;case"without":return`Calculates ${g} over the dimensions ${_}. All other labels are preserved.`;default:return`Calculates ${g} over the dimensions.`}}}function He(g){return function(O,F,_){return F.params.length<_.params.length?{...F,id:g}:F}}function w(g){return(0,Q.capitalize)(g.replace(/_/g," "))}function N(g,$){const O={id:g.id,params:g.defaultParams};return{...$,operations:[...$.operations,O]}}function pe(g,$={}){return[{id:g,name:w(g),params:[{name:"By label",type:"string",restParam:!0,optional:!0}],defaultParams:[],alternativesKey:"plain aggregations",category:R.Ln.Aggregations,renderer:G,paramChangedHandler:Qe(`__${g}_by`),explainHandler:De(g,""),addOperationHandler:N,...$},{id:`__${g}_by`,name:`${w(g)} by`,params:[{name:"Label",type:"string",restParam:!0,optional:!0,editor:D}],defaultParams:[""],alternativesKey:"aggregations by",category:R.Ln.Aggregations,renderer:Y(g),paramChangedHandler:He(g),explainHandler:De(g,"by"),addOperationHandler:N,hideFromList:!0,...$},{id:`__${g}_without`,name:`${w(g)} without`,params:[{name:"Label",type:"string",restParam:!0,optional:!0,editor:D}],defaultParams:[""],alternativesKey:"aggregations by",category:R.Ln.Aggregations,renderer:ce(g),paramChangedHandler:He(g),explainHandler:De(g,"without"),addOperationHandler:N,hideFromList:!0,...$}]}function ce(g){return function(O,F,_){return`${g} without(${O.params.join(", ")}) (${_})`}}function G(g,$,O){const F=T(g,$,O),_=g.id+"(";return O&&F.push(O),_+F.join(", ")+")"}function T(g,$,O){return(g.params??[]).map((F,_)=>$.params[_].type==="string"?'"'+F+'"':F)}function Y(g){return function(O,F,_){return`${g} by(${O.params.join(", ")}) (${_})`}}function z(g,$,O={}){const F=pe(g,O);return F[0].params.unshift(...$.params),F[1].params.unshift(...$.params),F[2].params.unshift(...$.params),F[0].defaultParams=$.defaultParams,F[1].defaultParams=[...$.defaultParams,""],F[2].defaultParams=[...$.defaultParams,""],F[1].renderer=J(g),F[2].renderer=J(g),F}function J(g){return function(O,F,_){const ae=F.params.findIndex(Ne=>Ne.restParam),ye=O.params.slice(0,ae),ie=O.params.slice(ae);return`${g} by(${ie.join(", ")}) (${ye.map((Ne,Ue)=>F.params[Ue].type==="string"?`"${Ne}"`:Ne).join(", ")}, ${_})`}}},83657:(Ke,Fe,l)=>{"use strict";l.d(Fe,{VI:()=>Se,y6:()=>Me,mD:()=>xe,sp:()=>I});var Q=l(58592),Oe=l(74848),M=l(96540),o=l(50877),h=l(43127),K=l(32264),i=l(90182),ne=l(20065),D=l(27724),te=l(56587),le=l(75723),R=l(11216);function de({onChange:ve,index:ge,operationId:fe,value:Pe,query:Le,datasource:B,timeRange:Qe,queryModeller:De}){const[He,w]=(0,M.useState)({});return(0,Oe.jsx)(i.l6,{inputId:(0,R.OS)(fe,ge),onOpenMenu:async()=>{if(B instanceof D.VQ&&K.$.featureToggles.lokiQueryHints){w({isLoading:!0});const N=await Z(Le,B,De,Qe);w({options:N,isLoading:void 0})}},isLoading:He.isLoading,allowCustomValue:!0,noOptionsMessage:"No labels found",loadingMessage:"Loading labels",options:He.options,value:Pe?(0,o.z)(Pe.toString()):null,onChange:N=>{N.value&&ve(ge,N.value)}})}async function Z(ve,ge,fe,Pe=(0,h.E2)()){const Le=fe.renderQuery(ve),B=(0,te.OT)(Le);if((0,te.FV)(ge.interpolateString(B,ne.a)))return[];const Qe=await ge.getDataSamples({expr:B,refId:"unwrap_samples"},Pe);return(0,le.aN)(Qe[0]).map(w=>({label:w,value:w}))}var x=l(54623);function U(){const ve=[x.EF.Sum,x.EF.Min,x.EF.Max,x.EF.Avg,x.EF.Stddev,x.EF.Stdvar,x.EF.Count].flatMap(B=>(0,R.G3)(B,{addOperationHandler:R.af,orderRank:x.h5.Last})),ge=[x.EF.TopK,x.EF.BottomK].flatMap(B=>(0,R.jC)(B,{params:[{name:"K-value",type:"number"}],defaultParams:[5]},{addOperationHandler:R.af,orderRank:x.h5.Last})),fe=[(0,R.fu)(x.EF.Rate),(0,R.fu)(x.EF.RateCounter),(0,R.fu)(x.EF.CountOverTime),(0,R.fu)(x.EF.SumOverTime),(0,R.fu)(x.EF.BytesRate),(0,R.fu)(x.EF.BytesOverTime),(0,R.fu)(x.EF.AbsentOverTime)],Pe=[...(0,R.yD)(x.EF.AvgOverTime),...(0,R.yD)(x.EF.MaxOverTime),...(0,R.yD)(x.EF.MinOverTime),...(0,R.yD)(x.EF.FirstOverTime),...(0,R.yD)(x.EF.LastOverTime),...(0,R.yD)(x.EF.StdvarOverTime),...(0,R.yD)(x.EF.StddevOverTime),...(0,R.yD)(x.EF.QuantileOverTime)];return[...ve,...ge,...fe,...Pe,{id:x.EF.Json,name:"Json",params:[{name:"Expression",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'server="servers[0]"',description:"Using expressions with your json parser will extract only the specified json fields to labels. You can specify one or more expressions in this way. All expressions must be quoted."}],defaultParams:[],alternativesKey:"format",category:x.Ln.Formats,orderRank:x.h5.Parsers,renderer:R.EP,addOperationHandler:R.af,explainHandler:()=>"This will extract keys and values from a [json](https://grafana.com/docs/loki/latest/logql/log_queries/#json) formatted log line as labels. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:x.EF.Logfmt,name:"Logfmt",params:[{name:"Strict",type:"boolean",optional:!0,description:"With strict parsing enabled, the logfmt parser immediately stops scanning the log line and returns early with an error when it encounters any poorly formatted key/value pair."},{name:"Keep empty",type:"boolean",optional:!0,description:"The logfmt parser retains standalone keys (keys without a value) as labels with its value set to empty string. "},{name:"Expression",type:"string",optional:!0,restParam:!0,minWidth:18,placeholder:"field_name",description:"Using expressions with your logfmt parser will extract and rename (if provided) only the specified fields to labels. You can specify one or more expressions in this way."}],defaultParams:[!1,!1],alternativesKey:"format",category:x.Ln.Formats,orderRank:x.h5.Parsers,renderer:R.EP,addOperationHandler:R.af,explainHandler:()=>"This will extract all keys and values from a [logfmt](https://grafana.com/docs/loki/latest/logql/log_queries/#logfmt) formatted log line as labels. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:x.EF.Regexp,name:"Regexp",params:[{name:"String",type:"string",hideName:!0,placeholder:"<re>",description:"The regexp expression that matches the structure of a log line.",minWidth:20}],defaultParams:[""],alternativesKey:"format",category:x.Ln.Formats,orderRank:x.h5.Parsers,renderer:(B,Qe,De)=>`${De} | regexp \`${B.params[0]}\``,addOperationHandler:R.af,explainHandler:()=>'The [regexp parser](https://grafana.com/docs/loki/latest/logql/log_queries/#regular-expression) takes a single parameter | regexp "<re>" which is the regular expression using the Golang RE2 syntax. The regular expression must contain a least one named sub-match (e.g (?P<name>re)), each sub-match will extract a different label. The expression matches the structure of a log line. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation.'},{id:x.EF.Pattern,name:"Pattern",params:[{name:"String",type:"string",hideName:!0,placeholder:"<pattern-expression>",description:"The expression that matches the structure of a log line.",minWidth:20}],defaultParams:[""],alternativesKey:"format",category:x.Ln.Formats,orderRank:x.h5.Parsers,renderer:(B,Qe,De)=>`${De} | pattern \`${B.params[0]}\``,addOperationHandler:R.af,explainHandler:()=>"The [pattern parser](https://grafana.com/docs/loki/latest/logql/log_queries/#pattern) allows the explicit extraction of fields from log lines by defining a pattern expression (| pattern `<pattern-expression>`). The expression matches the structure of a log line. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:x.EF.Unpack,name:"Unpack",params:[],defaultParams:[],alternativesKey:"format",category:x.Ln.Formats,orderRank:x.h5.Parsers,renderer:R.EP,addOperationHandler:R.af,explainHandler:()=>"This will extract all keys and values from a JSON log line, [unpacking](https://grafana.com/docs/loki/latest/logql/log_queries/#unpack) all embedded labels in the pack stage. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:x.EF.LineFormat,name:"Line format",params:[{name:"String",type:"string",hideName:!0,placeholder:"{{.status_code}}",description:"A line template that can refer to stream labels and extracted labels.",minWidth:20}],defaultParams:[""],alternativesKey:"format",category:x.Ln.Formats,orderRank:x.h5.PipeOperations,renderer:(B,Qe,De)=>`${De} | line_format \`${B.params[0]}\``,addOperationHandler:R.af,explainHandler:()=>`This will replace log line using a specified template. The template can refer to stream labels and extracted labels.

Example: \`{{.status_code}} - {{.message}}\`

[Read the docs](https://grafana.com/docs/loki/latest/logql/log_queries/#line-format-expression) for more.
        `},{id:x.EF.LabelFormat,name:"Label format",params:[{name:"Label",type:"string"},{name:"Rename to",type:"string"}],defaultParams:["",""],alternativesKey:"format",category:x.Ln.Formats,orderRank:x.h5.PipeOperations,renderer:(B,Qe,De)=>`${De} | label_format ${B.params[1]}=${B.params[0]}`,addOperationHandler:R.af,explainHandler:()=>'This will change name of label to desired new label. In the example below, label "error_level" will be renamed to "level".\n\nExample: ``error_level=`level` ``\n\n[Read the docs](https://grafana.com/docs/loki/latest/logql/log_queries/#labels-format-expression) for more.\n        '},{id:x.EF.LineContains,name:"Line contains",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to find",description:"Find log lines that contains this text",minWidth:20,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:x.Ln.LineFilters,orderRank:x.h5.LineFilters,renderer:(0,R.UF)("|="),addOperationHandler:R.af,explainHandler:B=>`Return log lines that contain string \`${B.params?.join("`, or `")}\`.`},{id:x.EF.LineContainsNot,name:"Line does not contain",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to exclude",description:"Find log lines that does not contain this text",minWidth:26,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:x.Ln.LineFilters,orderRank:x.h5.LineFilters,renderer:(0,R.UF)("!="),addOperationHandler:R.af,explainHandler:B=>`Return log lines that does not contain string \`${B.params?.join("`, or `")}\`.`},{id:x.EF.LineContainsCaseInsensitive,name:"Line contains case insensitive",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to find",description:"Find log lines that contains this text",minWidth:33,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:x.Ln.LineFilters,orderRank:x.h5.LineFilters,renderer:(0,R.UF)("|~",!0),addOperationHandler:R.af,explainHandler:B=>`Return log lines that match regex \`(?i)${B.params?.join("`, or `(?i)")}\`.`},{id:x.EF.LineContainsNotCaseInsensitive,name:"Line does not contain case insensitive",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to exclude",description:"Find log lines that does not contain this text",minWidth:40,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:x.Ln.LineFilters,orderRank:x.h5.LineFilters,renderer:(0,R.UF)("!~",!0),addOperationHandler:R.af,explainHandler:B=>`Return log lines that does not match regex \`(?i)${B.params?.join("`, or `(?i)")}\`.`},{id:x.EF.LineMatchesRegex,name:"Line contains regex match",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Pattern to match",description:"Find log lines that match this regex pattern",minWidth:30,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:x.Ln.LineFilters,orderRank:x.h5.LineFilters,renderer:(0,R.UF)("|~"),addOperationHandler:R.af,explainHandler:B=>`Return log lines that match a \`RE2\` regex pattern. \`${B.params?.join("`, or `")}\`.`},{id:x.EF.LineMatchesRegexNot,name:"Line does not match regex",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Pattern to exclude",description:"Find log lines that does not match this regex pattern",minWidth:30,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:x.Ln.LineFilters,orderRank:x.h5.LineFilters,renderer:(0,R.UF)("!~"),addOperationHandler:R.af,explainHandler:B=>`Return log lines that doesn't match a \`RE2\` regex pattern. \`${B.params?.join("`, or `")}\`.`},{id:x.EF.LineFilterIpMatches,name:"IP line filter expression",params:[{name:"Operator",type:"string",minWidth:16,options:[x.NS.contains,x.NS.doesNotContain]},{name:"Pattern",type:"string",placeholder:"<pattern>",minWidth:16,runQueryOnEnter:!0}],defaultParams:["|=",""],alternativesKey:"line filter",category:x.Ln.LineFilters,orderRank:x.h5.LineFilters,renderer:(B,Qe,De)=>`${De} ${B.params[0]} ip(\`${B.params[1]}\`)`,addOperationHandler:R.af,explainHandler:B=>`Return log lines using IP matching of \`${B.params[1]}\``},{id:x.EF.LabelFilter,name:"Label filter expression",params:[{name:"Label",type:"string",minWidth:14},{name:"Operator",type:"string",minWidth:14,options:[x.NS.equals,x.NS.doesNotEqual,x.NS.matchesRegex,x.NS.doesNotMatchRegex,x.NS.greaterThan,x.NS.lessThan,x.NS.greaterThanOrEqual,x.NS.lessThanOrEqual]},{name:"Value",type:"string",minWidth:14}],defaultParams:["","=",""],alternativesKey:"label filter",category:x.Ln.LabelFilters,orderRank:x.h5.PipeOperations,renderer:R.sn,addOperationHandler:R.af,explainHandler:()=>"Label expression filter allows filtering using original and extracted labels."},{id:x.EF.LabelFilterIpMatches,name:"IP label filter expression",params:[{name:"Label",type:"string",minWidth:14},{name:"Operator",type:"string",minWidth:14,options:[x.NS.equals,x.NS.doesNotEqual]},{name:"Value",type:"string",minWidth:14}],defaultParams:["","=",""],alternativesKey:"label filter",category:x.Ln.LabelFilters,orderRank:x.h5.PipeOperations,renderer:(B,Qe,De)=>`${De} | ${B.params[0]} ${B.params[1]} ip(\`${B.params[2]}\`)`,addOperationHandler:R.af,explainHandler:B=>`Return log lines using IP matching of \`${B.params[2]}\` for \`${B.params[0]}\` label`},{id:x.EF.LabelFilterNoErrors,name:"No pipeline errors",params:[],defaultParams:[],alternativesKey:"label filter",category:x.Ln.LabelFilters,orderRank:x.h5.NoErrors,renderer:(B,Qe,De)=>`${De} | __error__=\`\``,addOperationHandler:R.af,explainHandler:()=>"Filter out all formatting and parsing errors."},{id:x.EF.Unwrap,name:"Unwrap",params:[{name:"Identifier",type:"string",hideName:!0,minWidth:16,placeholder:"Label key",editor:de},{name:"Conversion function",hideName:!0,type:"string",options:["duration","duration_seconds","bytes"],optional:!0}],defaultParams:["",""],alternativesKey:"format",category:x.Ln.Formats,orderRank:x.h5.Unwrap,renderer:(B,Qe,De)=>`${De} | unwrap ${B.params[1]?`${B.params[1]}(${B.params[0]})`:B.params[0]}`,addOperationHandler:R.af,explainHandler:B=>{let Qe=String(B.params[0]).length>0?B.params[0]:"<label>";return`Use the extracted label \`${Qe}\` as sample values instead of log lines for the subsequent range aggregation.${B.params[1]?` Conversion function \`${B.params[1]}\` wrapping \`${Qe}\` will attempt to convert this label from a specific format (e.g. 3k, 500ms).`:""}`}},{id:x.EF.Decolorize,name:"Decolorize",params:[],defaultParams:[],alternativesKey:"format",category:x.Ln.Formats,orderRank:x.h5.PipeOperations,renderer:(B,Qe,De)=>`${De} | decolorize`,addOperationHandler:R.af,explainHandler:()=>"This will remove ANSI color codes from log lines."},{id:x.EF.Drop,name:"Drop",params:[{name:"Label",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'job="grafana"',description:"Specify labels or expressions to drop."}],defaultParams:[""],alternativesKey:"format",category:x.Ln.Formats,orderRank:x.h5.PipeOperations,renderer:R.EP,addOperationHandler:R.af,explainHandler:()=>"The drop expression will drop the given labels in the pipeline."},{id:x.EF.Keep,name:"Keep",params:[{name:"Label",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'job="grafana"',description:"Specify labels or expressions to keep."}],defaultParams:[""],alternativesKey:"format",category:x.Ln.Formats,orderRank:x.h5.PipeOperations,renderer:R.EP,addOperationHandler:R.af,explainHandler:()=>"The keep expression will keep only the specified labels in the pipeline and drop all the other labels."},...Q.I,{id:x.EF.NestedQuery,name:"Binary operation with query",params:[],defaultParams:[],category:x.Ln.BinaryOps,renderer:(B,Qe,De)=>De,addOperationHandler:R.VR}]}const I=U();function Me(ve){return(I.find(Pe=>Pe.id===ve)?.explainHandler?.({id:"",params:["<value>"]})||"").replace(/\[(.*)\]\(.*\)/g,"$1")}function xe(ve){return I.find(ge=>ge.id===ve)}function Se(ve,ge){return!(ge.length<ve.params.filter(fe=>!fe.optional).length)}},60706:(Ke,Fe,l)=>{"use strict";l.d(Fe,{u_:()=>K,w4:()=>Pe});var Q=l(36195),Oe=l(58592),M=l(83657),o=l(56245),h=l(54623);function K(w){const N=(0,o.qk)(w),ce=Q.K3.parse(N).topNode,T={query:{labels:[],operations:[]},errors:[]};try{i(N,ce,T)}catch(Y){console.error(Y),Y instanceof Error&&T.errors.push({text:Y.message})}return Qe(T.query)&&(T.errors=[]),T}function i(w,N,pe){const ce=pe.query;switch(N.type.id){case Q.g$:{ce.labels.push(ne(w,N));const G=N.getChild(o.Ql);G&&pe.errors.push((0,o.xz)(w,G));break}case Q.PN:{const{operation:G,error:T}=D(w,N);G&&ce.operations.push(G),T&&pe.errors.push(B(w,N,T));break}case Q.iT:{ce.operations.push(te(w,N));break}case Q.bY:{const{operation:G,error:T}=de(w,N);G&&ce.operations.push(G),T&&pe.errors.push(B(w,N,T));break}case Q.eF:{ce.operations.push(le(w,N));break}case Q.Zj:case Q.Tz:{const{operation:G,error:T}=R(w,N);G&&ce.operations.push(G),T&&pe.errors.push(B(w,N,T));break}case Q.pH:{ce.operations.push(Z(w,N));break}case Q.e_:{ce.operations.push(x(w,N));break}case Q.HV:{const{operation:G,error:T}=I(w,N,pe);G&&ce.operations.push(G),T&&pe.errors.push(B(w,N,T));break}case Q.Zg:{ce.operations.push(U());break}case Q.h1:{ce.operations.push(Me(w,N,pe));break}case Q.Rh:{ce.operations.push(xe(w,N,pe));break}case Q.MK:{ve(w,N,pe);break}case o.Ql:{if(fe(N))break;pe.errors.push((0,o.xz)(w,N));break}case Q.i8:{ce.operations.push(De(w,N,pe));break}case Q.UP:{ce.operations.push(He(w,N,pe));break}default:{let G=N.firstChild;for(;G;)i(w,G,pe),G=G.nextSibling}}}function ne(w,N){const pe=N.getChild(Q.gw),ce=(0,o.AA)(w,pe),G=(0,o.AA)(w,pe?.nextSibling);let T=(0,o.AA)(w,N.getChild(Q.Qf));return T=T.substring(1,T.length-1),{label:ce,op:G,value:T}}function D(w,N){const pe=(0,o.AA)(w,N.getChild(Q.dJ)),ce=Pe((0,o.AA)(w,N.getChild(Q.Qf)));if(N.getChild(Q.w7)?.getChild(Q.Ip))return{operation:{id:h.EF.LineFilterIpMatches,params:[pe,ce]}};const T=[ce];let Y=N.getChild(Q.ih);for(;Y;)T.push(Pe((0,o.AA)(w,Y.getChild(Q.Qf)))),Y=Y.getChild(Q.ih);return{operation:{id:{"|=":h.EF.LineContains,"!=":h.EF.LineContainsNot,"|~":h.EF.LineMatchesRegex,"!~":h.EF.LineMatchesRegexNot}[pe],params:T}}}function te(w,N){const pe=N.firstChild,ce=(0,o.AA)(w,pe),G=Pe((0,o.AA)(w,N.getChild(Q.Qf)));let T=G?[G]:[];const Y=(0,M.mD)(ce);return Y&&!(0,M.VI)(Y,T)&&(T=Y?.defaultParams||[]),{id:ce,params:T}}function le(w,N){const pe=N.getChild(Q.LM),ce=(0,o.AA)(w,pe),G=[...(0,o.R1)(w,N,Q.Gn)];return{id:ce,params:G}}function R(w,N){const pe=[],ce=[];let G;const T=N.from;return N.toTree().iterate({enter:z=>{z.type.id===Q.ov?pe.push(w.substring(z.from+T,z.to+T)):z.type.id===Q.Gn?ce.push(w.substring(z.from+T,z.to+T)):z.type.id===o.Ql&&(G=`Unexpected string "${w.substring(z.from+T,z.to+T)}"`)}}),{operation:{id:h.EF.Logfmt,params:[pe.includes("--strict"),pe.includes("--keep-empty"),...ce]},error:G}}function de(w,N){if(N.getChild(Q.Or)||N.getChild(Q.KD)||N.getChild("Comma"))return{error:'Label filter with comma, "and", "or" not supported in query builder'};if(N.firstChild.type.id===Q.GA){const J=N.firstChild,g=J?.getChild(Q.gw),$=g?.nextSibling,O=J?.getChild(Q.Qf),F=Pe((0,o.AA)(w,O));return{operation:{id:h.EF.LabelFilterIpMatches,params:[(0,o.AA)(w,g),(0,o.AA)(w,$),F]}}}const pe=h.EF.LabelFilter;if(N.firstChild.type.id===Q.Jq){const g=N.firstChild.firstChild.firstChild,$=g.nextSibling,O=$.nextSibling,F=Pe((0,o.AA)(w,O));return{operation:{id:pe,params:[(0,o.AA)(w,g),(0,o.AA)(w,$),F]}}}const G=N.firstChild.firstChild,T=G.nextSibling,Y=T.nextSibling,z=[(0,o.AA)(w,G),(0,o.AA)(w,T),Pe((0,o.AA)(w,Y))];return z.join("")==="__error__="?{operation:{id:h.EF.LabelFilterNoErrors,params:[]}}:{operation:{id:pe,params:z}}}function Z(w,N){const pe=h.EF.LineFormat,ce=Pe((0,o.AA)(w,N.getChild(Q.Qf)));return{id:pe,params:[ce]}}function x(w,N){const pe=h.EF.LabelFormat,ce=N.getChild(Q.gw),T=ce.nextSibling.nextSibling;return{id:pe,params:[(0,o.AA)(w,T),Pe((0,o.AA)(w,ce))]}}function U(){return{id:h.EF.Decolorize,params:[]}}function I(w,N,pe){const ce=N.getChild(Q.HV),G=N.getChild(Q.bY),T=N.getChild(Q.sK);if(ce&&i(w,ce,pe),G&&i(w,G,pe),T){if(T.nextSibling?.type.id===Q.yW){const Y=T.nextSibling,z=Y.nextSibling;return{operation:{id:h.EF.Unwrap,params:[(0,o.AA)(w,z),(0,o.AA)(w,Y)]}}}return{operation:{id:h.EF.Unwrap,params:[(0,o.AA)(w,T?.nextSibling),""]}}}return{}}function Me(w,N,pe){const ce=N.getChild(Q.lo),G=(0,o.AA)(w,ce),T=N.getChild(Q.wN),Y=N.getChild(Q.xo),z=T!=null?[(0,o.AA)(w,T)]:[],J=Y?.getChild(Q.Q6),g=J?(0,o.AA)(w,J):null,$=N.getChild(Q.aU);g&&z.unshift(g.substring(1,g.length-1)),$&&z.push(...(0,o.R1)(w,$,Q.gw));const O={id:G,params:z};return Y&&i(w,Y,pe),O}function xe(w,N,pe){const ce=N.getChild(Q.ZQ);let G=(0,o.AA)(w,ce);const T=N.getChild(Q.aU),Y=[],z=N.getChild(Q.wN);z&&Y.push(Number((0,o.AA)(w,z))),T&&(T.getChild(Q.By)&&G&&(G=`__${G}_by`),T.getChild(Q.xB)&&(G=`__${G}_without`),Y.push(...(0,o.R1)(w,T,Q.gw)));const J=N.getChild(Q.Yw),g={id:G,params:Y};return J&&(J.firstChild?.type.id===Q.MK&&pe.errors.push({text:"Query parsing is ambiguous.",from:J.firstChild.from,to:J.firstChild?.to}),i(w,J,pe)),g}const Se=Oe.C.reduce((w,N)=>(w[N.sign]={id:N.id,comparison:N.comparison},w),{});function ve(w,N,pe){const ce=pe.query,G=N.firstChild,T=(0,o.AA)(w,G.nextSibling),Y=ge(w,N.getChild(Q.o5)),z=N.lastChild,J=Se[T],g=Le(G,"MetricExpr.LiteralExpr.Number"),$=Le(z,"MetricExpr.LiteralExpr.Number"),O=z.getChild(Q.MK);if(g||i(w,G,pe),$)ce.operations.push((0,o.rq)(J,w,z,!!Y?.isBool));else if(O){const F=(0,o.z9)(z);F?.type.id===Q.wN&&ce.operations.push((0,o.rq)(J,w,F,!!Y?.isBool)),i(w,z,pe)}else{ce.binaryQueries=ce.binaryQueries||[];const F={operator:T,query:{labels:[],operations:[]}};Y?.isMatcher&&(F.vectorMatchesType=Y.matchType,F.vectorMatches=Y.matches),ce.binaryQueries.push(F),i(w,z,{query:F.query,errors:pe.errors})}}function ge(w,N){if(!N)return;const pe=N.getChild(Q.wT),ce=N.getChild(Q.x);if(!pe&&ce)return{isBool:!0,isMatcher:!1};{if(!pe)return;const G=(0,o.AA)(w,pe.getChild(Q.x$)?.getChild(Q.qJ));return{isMatcher:!0,isBool:!!ce,matches:G,matchType:pe.getChild(Q.On)?"on":"ignoring"}}}function fe(w){return w?.parent?.type.id===Q.Q6}function Pe(w){return w[0]==='"'&&w[w.length-1]==='"'?w.substring(1,w.length-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"):w.replace(/`/g,"")}function Le(w,N){let pe=w;const ce=N.split(".");for(const G of ce)if(pe=pe.getChild(G),!pe)return null;return pe}function B(w,N,pe){const ce=(0,o.xz)(w,N);return ce.text=`${pe}: ${ce.text}`,ce}function Qe(w){return w.labels.length===0&&w.operations.length===0}function De(w,N,pe){const ce=[];let G=N.getChild(Q.LQ);for(;G;){const T=(0,o.AA)(w,G.getChild(Q.yj));T&&ce.push(T),G=G?.getChild(Q.LQ)}return ce.reverse(),{id:h.EF.Drop,params:ce}}function He(w,N,pe){const ce=[];let G=N.getChild(Q.J3);for(;G;){const T=(0,o.AA)(w,G.getChild(Q.UM));T&&ce.push(T),G=G?.getChild(Q.J3)}return ce.reverse(),{id:h.EF.Keep,params:ce}}},56245:(Ke,Fe,l)=>{"use strict";l.d(Fe,{AA:()=>ne,If:()=>i,Ql:()=>Q,R1:()=>te,SY:()=>o,qk:()=>h,rq:()=>D,xz:()=>M,z9:()=>Oe});const Q=0;function Oe(R){return R.firstChild?Oe(R.firstChild):R}function M(R,de){return{text:ne(R,de),from:de.from,to:de.to,parentType:de.parent?.name}}const o=/\$(\w+)|\[\[([\s\S]+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::([^\}]+))?}/g;function h(R){return R.replace(o,(de,Z,x,U,I,Me,xe)=>{const Se=U||xe;let ve=Z,ge="0";return x&&(ve=x,ge="1"),I&&(ve=I,ge="2"),`__V_${ge}__`+ve+"__V__"+(Se?"__F__"+Se+"__F__":"")})}const K=[(R,de)=>`$${R}`,(R,de)=>`[[${R}${de?`:${de}`:""}]]`,(R,de)=>`\${${R}${de?`:${de}`:""}}`];function i(R){return R.replace(/__V_(\d)__(.+?)__V__(?:__F__(\w+)__F__)?/g,(de,Z,x,U)=>K[parseInt(Z,10)](x,U))}function ne(R,de){return de?i(R.substring(de.from,de.to)):""}function D(R,de,Z,x){const U=[parseFloat(ne(de,Z))];return R.comparison&&U.push(x),{id:R.id,params:U}}function te(R,de,Z){if(de.type.id===Z||de.name===Z)return[ne(R,de)];const x=[];let U=0,I=de.childAfter(U);for(;I;)x.push(...te(R,I,Z)),U=I.to,I=de.childAfter(U);return x}const le=R=>R.split(" ").map(Z=>`${Z}.*`).join("")},54623:(Ke,Fe,l)=>{"use strict";l.d(Fe,{EF:()=>o,IQ:()=>Oe,Ln:()=>M,NS:()=>K,h5:()=>h});var Q=l(42952),Oe=(i=>(i.Log="log",i.Metric="metric",i))(Oe||{}),M=(i=>(i.Aggregations="Aggregations",i.RangeFunctions="Range functions",i.Functions="Functions",i.Formats="Formats",i.LineFilters="Line filters",i.LabelFilters="Label filters",i[i.BinaryOps=Q.T]="BinaryOps",i))(M||{}),o=(i=>(i.Json="json",i.Logfmt="logfmt",i.Regexp="regexp",i.Pattern="pattern",i.Unpack="unpack",i.LineFormat="line_format",i.LabelFormat="label_format",i.Decolorize="decolorize",i.Drop="drop",i.Keep="keep",i.Rate="rate",i.RateCounter="rate_counter",i.CountOverTime="count_over_time",i.SumOverTime="sum_over_time",i.AvgOverTime="avg_over_time",i.MaxOverTime="max_over_time",i.MinOverTime="min_over_time",i.FirstOverTime="first_over_time",i.LastOverTime="last_over_time",i.StdvarOverTime="stdvar_over_time",i.StddevOverTime="stddev_over_time",i.QuantileOverTime="quantile_over_time",i.BytesRate="bytes_rate",i.BytesOverTime="bytes_over_time",i.AbsentOverTime="absent_over_time",i.Sum="sum",i.Avg="avg",i.Min="min",i.Max="max",i.Stddev="stddev",i.Stdvar="stdvar",i.Count="count",i.TopK="topk",i.BottomK="bottomk",i.LineContains="__line_contains",i.LineContainsNot="__line_contains_not",i.LineContainsCaseInsensitive="__line_contains_case_insensitive",i.LineContainsNotCaseInsensitive="__line_contains_not_case_insensitive",i.LineMatchesRegex="__line_matches_regex",i.LineMatchesRegexNot="__line_matches_regex_not",i.LineFilterIpMatches="__line_filter_ip_matches",i.LabelFilter="__label_filter",i.LabelFilterNoErrors="__label_filter_no_errors",i.LabelFilterIpMatches="__label_filter_ip_marches",i.Unwrap="unwrap",i.SumBy="__sum_by",i.SumWithout="__sum_without",i.Addition="__addition",i.Subtraction="__subtraction",i.MultiplyBy="__multiply_by",i.DivideBy="__divide_by",i.Modulo="__modulo",i.Exponent="__exponent",i.NestedQuery="__nested_query",i.EqualTo="__equal_to",i.NotEqualTo="__not_equal_to",i.GreaterThan="__greater_than",i.LessThan="__less_than",i.GreaterOrEqual="__greater_or_equal",i.LessOrEqual="__less_or_equal",i))(o||{}),h=(i=>(i[i.LineFilters=1]="LineFilters",i[i.Parsers=2]="Parsers",i[i.PipeOperations=3]="PipeOperations",i[i.Unwrap=4]="Unwrap",i[i.NoErrors=5]="NoErrors",i[i.RangeVectorFunction=5]="RangeVectorFunction",i[i.Last=6]="Last",i))(h||{});const K={equals:{label:"=",value:"=",description:"Equals",isMultiValue:!1},doesNotEqual:{label:"!=",value:"!=",description:"Does not equal",isMultiValue:!1},matchesRegex:{label:"=~",value:"=~",description:"Matches regex",isMultiValue:!0},doesNotMatchRegex:{label:"!~",value:"!~",description:"Does not match regex",isMultiValue:!0},greaterThan:{label:">",value:">",description:"Greater than",isMultiValue:!1},greaterThanOrEqual:{label:">=",value:">=",description:"Greater than or equal to",isMultiValue:!1},lessThan:{label:"<",value:"<",description:"Less than",isMultiValue:!1},lessThanOrEqual:{label:"<=",value:"<=",description:"Less than or equal to",isMultiValue:!1},contains:{label:"|=",value:"|=",description:"Contains",isMultiValue:!1},doesNotContain:{label:"!=",value:"!=",description:"Does not contain",isMultiValue:!1}}},75723:(Ke,Fe,l)=>{"use strict";l.d(Fe,{Ac:()=>te,nE:()=>D,db:()=>Z,fV:()=>R,sz:()=>x,YB:()=>le,aN:()=>de});var Q=l(11261),Oe=l(70416),M=l(97535);function o(U){let I;try{I=JSON.parse(U)}catch{}return typeof I=="object"}const h=/(?:^|\s)([\w\(\)\[\]\{\}]+)=(""|(?:".*?[^\\]"|[^"\s]\S*))/;function K(U){return h.test(U)}function i(U){let I;try{return I=JSON.parse(U),I.hasOwnProperty("_entry")}catch{return!1}}var ne=l(13137);function D(U){return(U.fields.find(Me=>Me.name==="labels")?.values??[]).some(Me=>Me.__error__!==void 0)}function te(U){return(U.fields.find(Me=>Me.name==="labels")?.values??[]).some(Me=>Me.level!==void 0)}function le(U){const I=U.fields.find(ge=>ge.type===Q.PU.string);if(I==null)return{hasJSON:!1,hasLogfmt:!1,hasPack:!1};const Me=I.values;let xe=!1,Se=!1,ve=!1;return Me.forEach(ge=>{o(ge)&&(xe=!0,ve=i(ge)),K(ge)&&(Se=!0)}),{hasLogfmt:Se,hasJSON:xe,hasPack:ve}}function R(U,I=ne.HD.Indexed){const Me=U?.fields?.find(ve=>ve.name==="labels")?.values??[],xe=U?.fields?.find(ve=>ve.name==="labelTypes")?.values??[];if(!Me?.length)return[];if(!xe?.length){if(I===ne.HD.Indexed){const{keys:ve}=(0,M.P7)(Me);return ve}return[]}let Se=new Set;for(let ve=0;ve<Me.length;ve++){const ge=Me[ve],fe=xe[ve],Pe=Object.keys(ge).filter(Le=>fe[Le]===I);Se=new Set([...Se,...Pe])}return Array.from(Se)}function de(U){const I=U?.fields?.find(xe=>xe.name==="labels")?.values??[];return I?.length?Object.keys(I[0]).filter(xe=>{const Se=I[0][xe];return Se?!isNaN(Number(Se))||(0,Oe.pp)(Se)||(0,M.tY)(Se):!1}).filter(xe=>I.every(Se=>Se[xe])):[]}function Z(U){const I=U.fields.find(xe=>xe.name==="labels"&&xe.type===Q.PU.other);return I==null?!1:I.values.some(xe=>xe.__error__)}function x(U){const I=U.fields.find(Se=>Se.name==="labels"&&Se.type===Q.PU.other);if(I==null)return null;const Me=I.values.slice(0,2);let xe=null;for(let Se of Me){const ve=Object.keys(Se).find(ge=>ge==="detected_level"||ge==="level"||ge==="lvl"||ge.includes("level"));if(ve){xe=ve;break}}return xe}},79007:(Ke,Fe,l)=>{"use strict";l.d(Fe,{Ex:()=>I,jg:()=>te,uJ:()=>Me});var Q=l(41987),Oe=l(42952),M=l(14110),o=l(32264),h=l(27724),K=l(51814),i=l(56587),ne=l(56245),D=l(13137);const te=({payload:{dashboardId:xe,orgId:Se,grafanaVersion:ve,queries:ge}})=>{try{const fe=ge[K.id]?.filter(T=>!T.hide)?.map(T=>(0,i.vV)(T));if(!fe?.length)return;const Pe=fe.filter(T=>(0,i.sI)(T.expr)),Le=fe.filter(T=>!(0,i.sI)(T.expr)),B=fe.filter(T=>T.queryType===D.U3.Instant),Qe=fe.filter(T=>T.queryType===D.U3.Range),De=fe.filter(T=>T.editorMode===Oe.f.Builder),He=fe.filter(T=>T.editorMode===Oe.f.Code),w=fe.filter(le),N=fe.filter(R),pe=fe.filter(de),ce=fe.filter(Z),G={grafana_version:ve,dashboard_id:xe,org_id:Se,queries_count:fe.length,logs_queries_count:Pe.length,metric_queries_count:Le.length,instant_queries_count:B.length,range_queries_count:Qe.length,builder_mode_queries_count:De.length,code_mode_queries_count:He.length,queries_with_template_variables_count:w.length,queries_with_changed_resolution_count:N.length,queries_with_changed_line_limit_count:pe.length,queries_with_changed_legend_count:ce.length};(0,M.rR)("grafana_loki_dashboard_loaded",G)}catch(fe){console.error("error in loki tracking handler",fe)}},le=xe=>ne.SY.test(xe.expr),R=xe=>xe.resolution?xe.resolution!==1:!1,de=xe=>xe.maxLines!==null&&xe.maxLines!==void 0,Z=xe=>xe.legendFormat?xe.legendFormat!=="":!1,x=xe=>!![h.Gf,h.M1,h.mL,h.ow,h.lb].some(ve=>xe.startsWith(ve)),U=xe=>{let Se=0;for(const ve of xe.data){const ge=ve.meta?.custom?.lokiQueryStatKey;ge&&(Se+=ve.meta?.stats?.find(fe=>fe.displayName===ge)?.value??0)}return Se};function I(xe,Se,ve,ge={},fe={}){const{app:Pe,targets:Le}=Se;if(Pe!==Q.Jk.Explore)return;let B=U(xe);for(const Qe of Le){if(x(Qe.refId))return;(0,M.rR)("grafana_explore_loki_query_executed",{grafana_version:o.$.buildInfo.version,editor_mode:Qe.editorMode,has_data:xe.data.some(De=>De.length>0),has_error:xe.error!==void 0,legend:Qe.legendFormat,line_limit:Qe.maxLines,obfuscated_query:(0,i.$F)(Qe.expr),query_type:(0,i.sI)(Qe.expr)?"logs":"metric",query_vector_type:Qe.queryType,resolution:Qe.resolution,simultaneously_executed_query_count:Le.filter(De=>!De.hide).length,simultaneously_hidden_query_count:Le.filter(De=>De.hide).length,time_range_from:Se?.range?.from?.toISOString(),time_range_to:Se?.range?.to?.toISOString(),time_taken:Date.now()-ve.getTime(),bytes_processed:B,is_split:!1,predefined_operations_applied:ge.predefinedOperations?Qe.expr.includes(ge.predefinedOperations):"n/a",...fe})}}function Me(xe,Se,ve,ge,fe={}){const Pe={split_query_group_count:Se.length,split_query_largest_partition_size:Math.max(...Se.map(({partition:Le})=>Le.length)),split_query_total_request_count:Se.reduce((Le,{partition:B})=>Le+B.length,0),is_split:!0,simultaneously_executed_query_count:ve.targets.filter(Le=>!Le.hide).length,simultaneously_hidden_query_count:ve.targets.filter(Le=>Le.hide).length};for(const Le of Se){const B=Le.partition.length;I(xe,Le.request,ge,fe,{...Pe,split_query_partition_size:B})}}},30115:Ke=>{var Fe=typeof Element<"u",l=typeof Map=="function",Q=typeof Set=="function",Oe=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function M(o,h){if(o===h)return!0;if(o&&h&&typeof o=="object"&&typeof h=="object"){if(o.constructor!==h.constructor)return!1;var K,i,ne;if(Array.isArray(o)){if(K=o.length,K!=h.length)return!1;for(i=K;i--!==0;)if(!M(o[i],h[i]))return!1;return!0}var D;if(l&&o instanceof Map&&h instanceof Map){if(o.size!==h.size)return!1;for(D=o.entries();!(i=D.next()).done;)if(!h.has(i.value[0]))return!1;for(D=o.entries();!(i=D.next()).done;)if(!M(i.value[1],h.get(i.value[0])))return!1;return!0}if(Q&&o instanceof Set&&h instanceof Set){if(o.size!==h.size)return!1;for(D=o.entries();!(i=D.next()).done;)if(!h.has(i.value[0]))return!1;return!0}if(Oe&&ArrayBuffer.isView(o)&&ArrayBuffer.isView(h)){if(K=o.length,K!=h.length)return!1;for(i=K;i--!==0;)if(o[i]!==h[i])return!1;return!0}if(o.constructor===RegExp)return o.source===h.source&&o.flags===h.flags;if(o.valueOf!==Object.prototype.valueOf)return o.valueOf()===h.valueOf();if(o.toString!==Object.prototype.toString)return o.toString()===h.toString();if(ne=Object.keys(o),K=ne.length,K!==Object.keys(h).length)return!1;for(i=K;i--!==0;)if(!Object.prototype.hasOwnProperty.call(h,ne[i]))return!1;if(Fe&&o instanceof Element)return!1;for(i=K;i--!==0;)if(!((ne[i]==="_owner"||ne[i]==="__v"||ne[i]==="__o")&&o.$$typeof)&&!M(o[ne[i]],h[ne[i]]))return!1;return!0}return o!==o&&h!==h}Ke.exports=function(h,K){try{return M(h,K)}catch(i){if((i.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw i}}},49935:(Ke,Fe,l)=>{"use strict";l.d(Fe,{v:()=>M});var Q=l(88483),Oe=l(15964);function M(o){return new Q.c(function(h){(0,Oe.Tg)(o()).subscribe(h)})}},8227:(Ke,Fe,l)=>{"use strict";l.d(Fe,{A:()=>M});const Q=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Oe(o){return typeof o=="string"&&Q.test(o)}const M=Oe},36195:(Ke,Fe,l)=>{"use strict";l.d(Fe,{AL:()=>sa,By:()=>Yr,CX:()=>ia,GA:()=>Tt,GN:()=>ra,Gn:()=>bt,HV:()=>Oa,I4:()=>it,Ip:()=>gr,J3:()=>pt,J_:()=>nr,Jq:()=>ar,K0:()=>ct,K3:()=>F,KD:()=>qr,LM:()=>_,LQ:()=>fa,MD:()=>ft,MK:()=>Ea,Nl:()=>Et,On:()=>Dt,Or:()=>ea,PN:()=>oa,Q6:()=>va,Qf:()=>mt,Rh:()=>Ya,Sg:()=>Vt,Tz:()=>nt,UK:()=>Ae,UM:()=>ht,UP:()=>ot,Yw:()=>rt,ZQ:()=>lr,Zg:()=>pr,Zj:()=>rr,aU:()=>Wr,bY:()=>mr,c$:()=>ae,dJ:()=>Ar,dw:()=>vr,eF:()=>da,e_:()=>Kt,g$:()=>Cr,gw:()=>aa,h1:()=>sr,i8:()=>_r,iT:()=>Qt,ih:()=>ca,lo:()=>Gt,o5:()=>Pa,ov:()=>Mr,pH:()=>yr,q5:()=>Xt,qJ:()=>Vr,sK:()=>Ue,sq:()=>Ye,t3:()=>Dr,uk:()=>yt,w7:()=>la,wN:()=>Or,wT:()=>vt,x:()=>Wt,x$:()=>St,xB:()=>Jr,xo:()=>Br,yW:()=>ya,yj:()=>Ht});var Q=l(48820);const Oe=1,M=2,o=3,h=4,K=5,i=6,ne=7,D=8,te=9,le=10,R=11,de=12,Z=13,x=14,U=15,I=16,Me=17,xe=18,Se=19,ve=20,ge=21,fe=22,Pe=23,Le=24,B=25,Qe=26,De=27,He=28,w=29,N=30,pe=31,ce=32,G=33,T=34,Y=35,z={json:Oe,logfmt:M,unpack:o,pattern:h,regexp:K,label_format:ne,line_format:D,label_replace:te,vector:le,offset:R,bool:de,on:Z,ignoring:x,group_left:U,group_right:I,unwrap:i,decolorize:Me,drop:xe,keep:Se},J=Pt=>z[Pt.toLowerCase()]||-1,g={by:ve,without:ge,and:fe,or:Pe,unless:Le,sum:B,avg:Qe,count:De,max:He,min:w,stddev:N,stdvar:pe,bottomk:ce,topk:G,sort:T,sort_desc:Y},$=Pt=>g[Pt.toLowerCase()]||-1,O={__proto__:null,ip:295,count_over_time:301,rate:303,rate_counter:305,bytes_over_time:307,bytes_rate:309,avg_over_time:311,sum_over_time:313,min_over_time:315,max_over_time:317,stddev_over_time:319,stdvar_over_time:321,quantile_over_time:323,first_over_time:325,last_over_time:327,absent_over_time:329,bytes:335,duration:337,duration_seconds:339},F=Q.U1.deserialize({version:14,states:"EtOYQPOOO#cQPO'#DUOOQO'#ER'#ERO#hQPO'#ERO$}QPO'#DTOYQPO'#DTOOQO'#Ed'#EdO%[QPO'#EcOOQO'#FP'#FPO%aQPO'#FOQ%lQPOOO&mQPO'#F]O&rQPO'#F^OOQO'#Eb'#EbOOQO'#DS'#DSOOQO'#Ee'#EeOOQO'#Ef'#EfOOQO'#Eg'#EgOOQO'#Eh'#EhOOQO'#Ei'#EiOOQO'#Ej'#EjOOQO'#Ek'#EkOOQO'#El'#ElOOQO'#Em'#EmOOQO'#En'#EnOOQO'#Eo'#EoOOQO'#Ep'#EpOOQO'#Eq'#EqOOQO'#Er'#ErOOQO'#Es'#EsO&wQPO'#DWOOQO'#DV'#DVO'VQPO,59pOOQO,5:m,5:mOOQO'#Dc'#DcO'_QPO'#DbO'gQPO'#DaO)lQPO'#D`O*{QPO'#D`OOQO'#D_'#D_O+sQPO,59oO-}QPO,59oO.UQPO,5:|O.]QPO,5:}O.hQPO'#E|O0sQPO,5;jO0zQPO,5;jO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lOYQPO,5;wO3cQPO,5;xO3hQPO,59rO#cQPO,59qOOQO1G/[1G/[OOQO'#Dh'#DhO3mQPO,59|O5^QPO,59|OOQO'#Di'#DiO5cQPO,59{OOQO,59{,59{O5kQPO'#DWO6YQPO'#DlO8PQPO'#DoO9sQPO'#DoOOQO'#Do'#DoOOQO'#Dv'#DvOOQO'#Dt'#DtO+kQPO'#DtO9xQPO,59zO;iQPO'#EVO;nQPO'#EWOOQO'#EZ'#EZO;sQPO'#E[O;xQPO'#E_OOQO,59z,59zOOQO,59y,59yOOQO1G/Z1G/ZOOQO1G0h1G0hO;}QPO'#EtO.`QPO'#EtO<XQPO1G0iO<^QPO1G0iO<cQPO,5;hO=oQPO1G1UO=vQPO1G1UO=}QPO1G1UO>UQPO'#FSO@dQPO'#FRO@nQPO'#FROYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WO@xQPO1G1cOAPQPO1G1dOOQO1G/^1G/^OOQO1G/]1G/]O5cQPO1G/hOAUQPO1G/hOAZQPO'#DjOBzQPO'#DjOOQO1G/g1G/gOCbQPO,59rOCPQPO,5:cOOQO'#Dm'#DmOClQPO,5:WOEcQPO'#DrOOQO'#Dq'#DqOGVQPO,5:_OHvQPO,5:[OOQO,5:Z,5:ZOJgQPO,5:`O+kQPO,5:`O+kQPO,5:`OOQO,5:q,5:qOJuQPO'#EYOOQO'#EX'#EXOJzQPO,5:rOLkQPO'#E^OOQO'#E^'#E^OOQO'#E]'#E]ONbQPO,5:vO!!RQPO'#EaOOQO'#Ea'#EaOOQO'#E`'#E`O!#xQPO,5:yO!%iQPO'#D`O;}QPO,5;`O!%pQPO'#EuO!%uQPO,5;`O!%}QPO,5;`O!&[QPO,5;`O!&iQPO,5;`O!&nQPO7+&TO.`QPO7+&TOOQO'#E}'#E}O!(OQPO1G1SOOQO1G1S1G1SOYQPO7+&pO!(WQPO7+&pO!)hQPO7+&pO!)oQPO7+&pO!)vQQO'#FTOOQO,5;n,5;nO!,UQPO,5;mO!,]QPO,5;mO!-nQPO7+&rO!-uQPO7+&rOOQO7+&r7+&rO!.SQPO7+&rO!.ZQPO7+&rO!/`QPO7+&rO!/pQPO7+&}OOQO7+'O7+'OOOQO7+%S7+%SO!/uQPO7+%SO5cQPO,5:UO!/zQPO,5:UO!0PQPO1G/{OOQO1G/}1G/}OOQO1G0U1G0UOOQO1G0W1G0WOOQO,5:X,5:XO!0UQPO1G/yO!1uQPO,5:^O!1zQPO,5:]OOQO1G/z1G/zO!2PQPO1G/zO!3pQPO,5:tO;nQPO,5:sO;sQPO,5:wO;xQPO,5:zO!3xQPO,5;cO!%uQPO1G0zO!4WQPO1G0zO!4`QPO,5;aO+kQPO,5;cO!4eQPO1G0zO!4oQPO'#EvO!4tQPO1G0zO!4eQPO1G0zO!4|QPO1G0zO!5ZQPO1G0zO!%xQPO1G0zOOQO1G0z1G0zOOQO<<Io<<IoO!5fQPO<<IoO!5kQPO,5;iOOQO7+&n7+&nO!5pQPO<<J[OOQO<<J[<<J[OYQPO<<J[OOQO'#FV'#FVO!5wQPO,5;oOOQO'#FU'#FUOOQO,5;o,5;oOOQO1G1X1G1XO!6PQPO1G1XO!8YQPO<<JiOOQO<<Hn<<HnOOQO1G/p1G/pO!8_QPO1G/pO!8dQPO7+%gOOQO1G/x1G/xOOQO1G/w1G/wOOQO1G0`1G0`OOQO1G0_1G0_OOQO1G0c1G0cOOQO1G0f1G0fOOQO'#Ex'#ExOOQO1G0}1G0}O!8iQPO1G0}OOQO'#Ey'#EyOOQO'#Ez'#EzOOQO'#E{'#E{OOQO7+&f7+&fOOQO1G0{1G0{O!8nQPO1G0}O!9SQPO7+&fOOQO,5;b,5;bO!9[QPO7+&fO!%xQPO7+&fO!9fQPO7+&fO!9qQPOAN?ZOOQO1G1T1G1TO!;RQPOAN?vO!<cQPOAN?vO!<jQQO1G1ZOOQO1G1Z1G1ZOOQO7+&s7+&sO!<rQPOAN@TOOQO7+%[7+%[O!<wQPO<<IRO!<|QPO7+&iO!=RQPO<<JQO!=ZQPO<<JQO!=cQPO'#EwO!=hQPO<<JQOOQOG24uG24uOOQOG25bG25bOOQO1G1[1G1[OOQO7+&u7+&uO!=pQPOG25oOOQOAN>mAN>mO!=uQPO<<JTOOQOAN?lAN?lO!=zQPOAN?lO!>SQPOLD+ZOOQOAN?oAN?oOOQO,5:r,5:rO!>XQPO!$'NuO!>^QPO!)9DaO!>cQPO!.K9{OOQO!4//g!4//gO;nQPO'#EWO!>hQPO'#D`O!?`QPO,59oO!@fQPO'#DTOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO!AqQPO7+&rO!AxQPO7+&rO!BVQPO7+&rO!C_QPO7+&rO!CfQPO7+&rO!B^QPO'#FQ",stateData:"!Cs~O$TOStOS~OXZOY[OiWOjWOkWOlWOmWOnWOoWOpWOqWOrWOsWO!vQO!wRO!xRO$UPO$YTO$[_O$]`O$^aO$_bO$`cO$adO$beO$cfO$dgO$ehO$fiO$gjO$hkO$ilO$jmO~O{nO~O!vqO~O!OrO!QrO!WrO!XrO!YrO!ZrOfwXgwXhwX!lwX!nwX!owX!pwX!qwX!wwX!xwX#{wX#|wX#}wX$OwX~O!_vO$RwX$ZwX~P#mO$Y{O~Od|Oe|O$Y}O~Of!QOg!POh!QO!O!UO!l!UO!n!UO!o!UO!p!UO!q!UO!w!RO!x!RO#{!SO#|!SO#}!SO$O!TO~O$Y!VO~O$Y!WO~O|!XO!O!XO!P!XO!Q!XO~O$V!YO$W!ZO~O}!]O$X!_O~Og!`Of!TXh!TX!O!TX!Q!TX!W!TX!X!TX!Y!TX!Z!TX!_!TX!l!TX!n!TX!o!TX!p!TX!q!TX!w!TX!x!TX#{!TX#|!TX#}!TX$O!TX$R!TX$Z!TX$k!TX$V!TX~O!OrO!QrO!WrO!XrO!YrO!ZrO~Of!SXg!SXh!SX!_!SX!l!SX!n!SX!o!SX!p!SX!q!SX!w!SX!x!SX#{!SX#|!SX#}!SX$O!SX$R!SX$Z!SX$k!SX$V!SX~P)WOP!dOQ!cOR!fOS!eOT!eOV!lOW!kOa!mOb!nOc!oO{!bO$Y!iO~O!_vOfwagwahwa!lwa!nwa!owa!pwa!qwa!wwa!xwa#{wa#|wa#}wa$Owa$Rwa$Zwa~P)WOfvXgvXhvX!OvX!lvX!nvX!ovX!pvX!qvX!wvX!xvX#{vX#|vX#}vX$OvX~O$Z!rO~P,|O$Z!sO~P,|O!v!wO$UPO$Y!uO~O$Y!xO~OXZOY[OiWOjWOkWOlWOmWOnWOoWOpWOqWOrWOsWO!wRO!xRO$UPO$YTO$[_O$]`O$^aO$_bO$`cO$adO$beO$cfO$dgO$ehO$fiO$gjO$hkO$ilO$jmO~O!v!yO~P.mO$Y!{O~O[#OO]!|O^!|OX#uPY#uPi#uPj#uPk#uPl#uPm#uPn#uPo#uPp#uPq#uPr#uPs#uP!v#uP!w#uP!x#uP$U#uP$Y#uP$[#uP$]#uP$^#uP$_#uP$`#uP$a#uP$b#uP$c#uP$d#uP$e#uP$f#uP$g#uP$h#uP$i#uP$j#uP~O!v#WO~O}#XO~Og#ZOf!Uah!Ua!O!Ua!Q!Ua!W!Ua!X!Ua!Y!Ua!Z!Ua!_!Ua!l!Ua!n!Ua!o!Ua!p!Ua!q!Ua!w!Ua!x!Ua#{!Ua#|!Ua#}!Ua$O!Ua$R!Ua$Z!Ua$k!Ua$V!Ua~O$Y#[O~O}#]O$X!_O~O|#`O!O#`O!P!XO!Q!XO!l#aO!n#aO!o#aO!p#aO!q#aO~O{#dO!b#bOf!`Xg!`Xh!`X!O!`X!Q!`X!W!`X!X!`X!Y!`X!Z!`X!_!`X!l!`X!n!`X!o!`X!p!`X!q!`X!w!`X!x!`X#{!`X#|!`X#}!`X$O!`X$R!`X$Z!`X$k!`X$V!`X~O{#dOf!cXg!cXh!cX!O!cX!Q!cX!W!cX!X!cX!Y!cX!Z!cX!_!cX!l!cX!n!cX!o!cX!p!cX!q!cX!w!cX!x!cX#{!cX#|!cX#}!cX$O!cX$R!cX$Z!cX$k!cX$V!cX~O}#hO~Of#jOg#kO$V#jOh!Sa!O!Sa!Q!Sa!W!Sa!X!Sa!Y!Sa!Z!Sa!_!Sa!l!Sa!n!Sa!o!Sa!p!Sa!q!Sa!w!Sa!x!Sa#{!Sa#|!Sa#}!Sa$O!Sa$R!Sa$Z!Sa$k!Sa~O}#lO~O{#mO~O{#pO~O{#tO~O!_#xO$k#zO~P)WO$Z$PO~O$V$QO~O{$RO$Z$TO~Of!uXg!uXh!uX!O!uX!l!uX!n!uX!o!uX!p!uX!q!uX!w!uX!x!uX#{!uX#|!uX#}!uX$O!uX$Z!uX~O$V$UO~P<kO$Z$VO~P,|O!v$WO~P.mO$Y$YO~OX#uXY#uXi#uXj#uXk#uXl#uXm#uXn#uXo#uXp#uXq#uXr#uXs#uX!v#uX!w#uX!x#uX$U#uX$Y#uX$[#uX$]#uX$^#uX$_#uX$`#uX$a#uX$b#uX$c#uX$d#uX$e#uX$f#uX$g#uX$h#uX$i#uX$j#uX~O_$[O`$[O~P>ZO]!|O^!|O~P>ZO$V$dO~P,|O$Z$eO~O}$gO~Og$hOf!^Xh!^X!O!^X!Q!^X!W!^X!X!^X!Y!^X!Z!^X!_!^X!l!^X!n!^X!o!^X!p!^X!q!^X!w!^X!x!^X#{!^X#|!^X#}!^X$O!^X$R!^X$Z!^X$k!^X$V!^X~O$Y$iO~O!m$kO!s$lO!vQO!wRO!xRO~O}#XO$X!_O~PCPO{#dO!b$nOf!`ag!`ah!`a!O!`a!Q!`a!W!`a!X!`a!Y!`a!Z!`a!_!`a!l!`a!n!`a!o!`a!p!`a!q!`a!w!`a!x!`a#{!`a#|!`a#}!`a$O!`a$R!`a$Z!`a$k!`a$V!`a~O|$pOf!fXg!fXh!fX!O!fX!Q!fX!W!fX!X!fX!Y!fX!Z!fX!_!fX!l!fX!n!fX!o!fX!p!fX!q!fX!w!fX!x!fX#{!fX#|!fX#}!fX$O!fX$R!fX$V!fX$Z!fX$k!fX~O$V$qOf!gag!gah!ga!O!ga!Q!ga!W!ga!X!ga!Y!ga!Z!ga!_!ga!l!ga!n!ga!o!ga!p!ga!q!ga!w!ga!x!ga#{!ga#|!ga#}!ga$O!ga$R!ga$Z!ga$k!ga~O$V$qOf!dag!dah!da!O!da!Q!da!W!da!X!da!Y!da!Z!da!_!da!l!da!n!da!o!da!p!da!q!da!w!da!x!da#{!da#|!da#}!da$O!da$R!da$Z!da$k!da~Of#jOg#kO$V#jO$Z$rO~O|$tO~O$V$uOf!zag!zah!za!O!za!Q!za!W!za!X!za!Y!za!Z!za!_!za!l!za!n!za!o!za!p!za!q!za!w!za!x!za#{!za#|!za#}!za$O!za$R!za$Z!za$k!za~O|!XO!O!XO!P!XO!Q!XOf#QXg#QXh#QX!W#QX!X#QX!Y#QX!Z#QX!_#QX!l#QX!n#QX!o#QX!p#QX!q#QX!w#QX!x#QX#{#QX#|#QX#}#QX$O#QX$R#QX$V#QX$Z#QX$k#QX~O$V$vOf#Oag#Oah#Oa!O#Oa!Q#Oa!W#Oa!X#Oa!Y#Oa!Z#Oa!_#Oa!l#Oa!n#Oa!o#Oa!p#Oa!q#Oa!w#Oa!x#Oa#{#Oa#|#Oa#}#Oa$O#Oa$R#Oa$Z#Oa$k#Oa~O|!XO!O!XO!P!XO!Q!XOf#TXg#TXh#TX!W#TX!X#TX!Y#TX!Z#TX!_#TX!l#TX!n#TX!o#TX!p#TX!q#TX!w#TX!x#TX#{#TX#|#TX#}#TX$O#TX$R#TX$V#TX$Z#TX$k#TX~O$V$wOf#Rag#Rah#Ra!O#Ra!Q#Ra!W#Ra!X#Ra!Y#Ra!Z#Ra!_#Ra!l#Ra!n#Ra!o#Ra!p#Ra!q#Ra!w#Ra!x#Ra#{#Ra#|#Ra#}#Ra$O#Ra$R#Ra$Z#Ra$k#Ra~OU$xO~P*{O!m${O~O!_$|O$k#zO~OZ%OO!_#xO$Z#ha~P)WO!_#xO$Z%TO$k#zO~P)WO$Z%UO~Od|Oe|Of#Vqg#Vqh#Vq!O#Vq!l#Vq!n#Vq!o#Vq!p#Vq!q#Vq!w#Vq!x#Vq#{#Vq#|#Vq#}#Vq$O#Vq$R#Vq$Z#Vq$V#Vq~O$V%XO$Z%YO~Od|Oe|Of#rqg#rqh#rq!O#rq!l#rq!n#rq!o#rq!p#rq!q#rq!w#rq!x#rq#{#rq#|#rq#}#rq$O#rq$R#rq$Z#rq$V#rq~O$V%]O~P<kO$Z%[O~P,|O#z%^O$Z%aO~OX#uaY#uai#uaj#uak#ual#uam#uan#uao#uap#uaq#uar#uas#ua!v#ua!w#ua!x#ua$U#ua$[#ua$]#ua$^#ua$_#ua$`#ua$a#ua$b#ua$c#ua$d#ua$e#ua$f#ua$g#ua$h#ua$i#ua$j#ua~O$Y$YO~P!*OO_%cO`%cO$Y#ua~P!*OOf!QOh!QO!O!UO!l!UO!n!UO!o!UO!p!UO!q!UO!w!RO!x!RO#{#tq#|#tq#}#tq$O#tq$R#tq$Z#tq~Og#tq~P!,jOf#tqg#tqh#tq~P!,pOg!PO~P!,jO$R#tq$Z#tq~P%lOf#tqg#tqh#tq!O#tq!l#tq!n#tq!o#tq!p#tq!q#tq#{#tq#|#tq#}#tq$O#tq~O!w!RO!x!RO$R#tq$Z#tq~P!.eO}%dO~O$Z%eO~O}%gO~O$Y%hO~O$V$qOf!gig!gih!gi!O!gi!Q!gi!W!gi!X!gi!Y!gi!Z!gi!_!gi!l!gi!n!gi!o!gi!p!gi!q!gi!w!gi!x!gi#{!gi#|!gi#}!gi$O!gi$R!gi$Z!gi$k!gi~O}%iO~O{#dO~Of#jO$V#jOg!hih!hi!O!hi!Q!hi!W!hi!X!hi!Y!hi!Z!hi!_!hi!l!hi!n!hi!o!hi!p!hi!q!hi!w!hi!x!hi#{!hi#|!hi#}!hi$O!hi$R!hi$Z!hi$k!hi~O{%kO}%kO~O{%pO$m%rO$n%sO$o%tO~OZ%OO$Z#hi~O$l%vO~O!_#xO$Z#hi~P)WO!m%yO~O!_$|O$Z#hi~O!_#xO$Z%{O$k#zO~P)WO!_$|O$Z%{O$k#zO~O$Z%}O~O{&OO~O$Z&PO~P,|O$V&RO$Z&SO~O$Y$YOX#uiY#uii#uij#uik#uil#uim#uin#uio#uip#uiq#uir#uis#ui!v#ui!w#ui!x#ui$U#ui$[#ui$]#ui$^#ui$_#ui$`#ui$a#ui$b#ui$c#ui$d#ui$e#ui$f#ui$g#ui$h#ui$i#ui$j#ui~O$V&UO~O$Z&VO~O}&WO~O$Y&XO~Of#jOg#kO$V#jO!_#ki$k#ki$Z#ki~O!_$|O$Z#hq~O!_#xO$Z#hq~P)WOZ%OO!_&[O$Z#hq~Od|Oe|Of#V!Rg#V!Rh#V!R!O#V!R!l#V!R!n#V!R!o#V!R!p#V!R!q#V!R!w#V!R!x#V!R#{#V!R#|#V!R#}#V!R$O#V!R$R#V!R$Z#V!R$V#V!R~Od|Oe|Of#r!Rg#r!Rh#r!R!O#r!R!l#r!R!n#r!R!o#r!R!p#r!R!q#r!R!w#r!R!x#r!R#{#r!R#|#r!R#}#r!R$O#r!R$R#r!R$Z#r!R$V#r!R~O$Z&_O~P,|O#z%^O$Z&aO~O}&bO~O$Z&cO~O{&dO~O!_$|O$Z#hy~OZ%OO$Z#hy~OU$xO~O!_&[O$Z#hy~O$V&gO~O$Z&hO~O!_$|O$Z#h!R~O}&jO~O$V&kO~O}&lO~O$Z&mO~OP!dOQ!cOR!fOS!eOT!eOV&nOW!kOa!mOb!nOc!oO{!bO$Y!iO~O!_&oOfwagwahwa!lwa!nwa!owa!pwa!qwa!wwa!xwa#{wa#|wa#}wa$Owa$Vwa~P)WO!_&oO$VwX~P#mOf&yOh&yO!O&}O!l&}O!n&}O!o&}O!p&}O!q&}O!w&zO!x&zO#{#tq#|#tq#}#tq$O#tq$V#tq~Og#tq~P!@pOf#tqg#tqh#tq~P!@vOg&xO~P!@pOf&yOg&xOh&yO!O&}O!l&}O!n&}O!o&}O!p&}O!q&}O!w&zO!x&zO#{&{O#|&{O#}&{O$O&|O~O$V#tq~P!B^O!w&zO!x&zO$V#tq~P!.eO",goto:"1l$RPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP$S%R%j&Y&]PPPPPP&t'W'h'v(XPPPP(h(p(yP)S)XP)S)S)[)e)S)m*O*O*XPPPPPP*XP*O*bPPP)S)S*{+R)S)S+Y+])S+c+f+l,_,t-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-p-y.^.j/S/V/V/V/Y/i,_/l,_0R0w1Y1c1fPPPPP,_,_[YOT}!{$U%]Q$^#PQ$_#QS$`#R&tQ$a#SQ$b#TQ$c#UQ'O&rQ'P&sQ'Q&uQ'R&vQ'S&wR'T!Vt^O}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wRyTjSOT}!V!{#P#Q#R#S#T#U$U%]S!t{$QQ#}!u]&q&r&s&t&u&v&wRpPQoP^!hv!i#j#k#x$|&oQ#Y!YS#q!n$vT#u!o$wQxSQ#y!tQ$}#|Q%R#}Q%z%QR&p&q[wS!t#|#}%Q&q]!qx#y$}%R%z&piuSx!t#y#|#}$}%Q%R%z&p&qhtSx!t#y#|#}$}%Q%R%z&p&qR!auksSux!t#y#|#}$}%Q%R%z&p&qQ!^sV#^!`#Z$hW![s!`#Z$hR$j#`Q#_!`Q$f#ZR%f$hV!pv#x&oR#c!cQ#f!cQ#g!dR$o#cU#e!c!d#cR%j$qU!jv#x&oQ#i!iQ$r#jQ$s#kR%w$|_!hv!i#j#k#x$|&o_!gv!i#j#k#x$|&ov]OT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wT$m#`#aQ#o!lR&i&nS#n!l&nR%l$uR#s!nQ#r!nR%m$vR#w!oQ#v!oR%n$wj^O#P#Q#R#S#T#U&r&s&t&u&v&wQzTQ!z}Q#V!VQ$X!{Q%Z$UR&Q%]w]OT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wwVOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wwUOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wQ!v{Q$O!uR%W$QS#|!t#}W$z#y#{%R%SQ%u$yQ%|%TR&Z%{Q%Q#|Q%u$zQ&]%|R&e&ZQ#{!tS$y#y%RQ%P#|Q%S#}S%x$}%QS&Y%z%|R&f&]R%q$xR%o$xQ!OXQ%V$PQ%[$VQ&^%}R&_&PR$S!xwXOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wQ#P!PQ#Q!QQ#R!RQ#S!SQ#T!TQ#U!UQ&r&xQ&s&yQ&t&zQ&u&{Q&v&|R&w&}h!}!P!Q!R!S!T!U&x&y&z&{&|&}R$]#OQ$Z!|Q%b$[R&T%cR%_$YQ%`$YR&`&R",nodeNames:"\u26A0 Json Logfmt Unpack Pattern Regexp Unwrap LabelFormat LineFormat LabelReplace Vector Offset Bool On Ignoring GroupLeft GroupRight Decolorize Drop Keep By Without And Or Unless Sum Avg Count Max Min Stddev Stdvar Bottomk Topk Sort Sort_Desc LineComment LogQL Expr LogExpr Selector Matchers Matcher Identifier Eq String Neq Re Nre PipelineExpr PipelineStage LineFilters LineFilter Filter PipeExact PipeMatch PipePattern Npa FilterOp Ip OrFilter Pipe LogfmtParser LogfmtParserFlags ParserFlag LabelParser JsonExpressionParser LabelExtractionExpressionList LabelExtractionExpression LogfmtExpressionParser LabelFilter IpLabelFilter UnitFilter DurationFilter Gtr Duration Gte Lss Lte Eql BytesFilter Bytes NumberFilter LiteralExpr Number Add Sub LineFormatExpr LabelFormatExpr LabelsFormat LabelFormatMatcher DecolorizeExpr DropLabelsExpr DropLabels DropLabel KeepLabelsExpr KeepLabels KeepLabel MetricExpr RangeAggregationExpr RangeOp CountOverTime Rate RateCounter BytesOverTime BytesRate AvgOverTime SumOverTime MinOverTime MaxOverTime StddevOverTime StdvarOverTime QuantileOverTime FirstOverTime LastOverTime AbsentOverTime LogRangeExpr Range OffsetExpr UnwrapExpr ConvOp BytesConv DurationConv DurationSecondsConv Grouping Labels VectorAggregationExpr VectorOp BinOpExpr BinOpModifier OnOrIgnoringModifier GroupingLabels GroupingLabelList GroupingLabel LabelName Mul Div Mod Pow LabelReplaceExpr VectorExpr",maxTerm:169,skippedNodes:[0,36],repeatNodeCount:0,tokenData:"5r~RvX^#ipq#iqr$^rs$yst%kuv%vxy%{yz&Qz{&V{|&[|}&a}!O&f!O!P(t!P!Q)t!Q!R)y!R![+a![!]2a!^!_2u!_!`3S!`!a3i!c!}3v!}#O4^#P#Q4c#Q#R4h#R#S3v#S#T4m#T#o3v#o#p4y#p#q5O#q#r5m#y#z#i$f$g#i#BY#BZ#i$IS$I_#i$I|$JO#i$JT$JU#i$KV$KW#i&FU&FV#i~#nY$T~X^#ipq#i#y#z#i$f$g#i#BY#BZ#i$IS$I_#i$I|$JO#i$JT$JU#i$KV$KW#i&FU&FV#i~$aR!_!`$j!`!a$o#r#s$t~$oO!O~~$tO!Z~~$yO!Q~~$|UOY$yZr$yrs%`s#O$y#O#P%e#P~$y~%eO}~~%hPO~$y~%pQt~OY%kZ~%k~%{O#}~~&QO$Y~~&VO$Z~~&[O#{~~&aO!w~~&fO$V~~&kP!x~}!O&n~&qQ#_#`&w#g#h(U~&zP#X#Y&}~'QP#X#Y'T~'WP#d#e'Z~'^P}!O'a~'dP#X#Y'g~'jP#a#b'm~'pP#d#e's~'vP#h#i'y~'|P#m#n(P~(UO!b~~(XP#h#i([~(_P#f#g(b~(eP#]#^(h~(kP#V#W(n~(qP#h#i(P~(wP!Q![(z~)PR!v~!Q![(z!g!h)Y#X#Y)Y~)]R{|)f}!O)f!Q![)l~)iP!Q![)l~)qP!v~!Q![)l~)yO#|~~*Oe!v~!O!P(z!Q![+a!g!h,t!i!j-c!m!n-c!o!p-c!r!s-c!v!w-c#U#V-W#W#X-l#X#Y/n#Z#[0Q#[#].T#_#`0Q#a#b0Z#d#e0Q#g#h/]#h#i0Q#k#l0l#l#m1u#m#n1W~+fd!v~!O!P(z!Q![+a!g!h,t!i!j-c!m!n-c!o!p-c!r!s-c!v!w-c#U#V-W#W#X-l#X#Y/n#Z#[0Q#[#].T#_#`0Q#a#b0Z#d#e0Q#g#h/]#h#i0Q#k#l0l#m#n1W~,wT{|)f}!O)f!Q![)l!d!e-W#]#^-]~-]O!s~~-`P#U#V-W~-fQ!d!e-W#]#^-]~-qP!m~!Q![-t~-wS!Q![-t#[#].T#a#b.i#g#h/]~.YP!m~!Q![.]~.`R!Q![.]#a#b.i#g#h/]~.nQ!m~!Q![.t#g#h/W~.wR!Q![.t#a#b/Q#g#h/]~/TP#g#h/W~/]O!m~~/bP!m~!Q![/e~/hQ!Q![/e#a#b/Q~/qT{|)f}!O)f!Q![)l#U#V-W#]#^-]~0TQ#U#V-W#]#^-]~0`S!m~!Q![.t#U#V-W#]#^-]#g#h/W~0qP!m~!Q![0t~0wT!Q![0t#W#X-l#[#].T#a#b.i#g#h/]~1]P!m~!Q![1`~1cU!Q![1`#W#X-l#[#].T#a#b.i#g#h/]#k#l0l~1xR!Q![2R!c!i2R#T#Z2R~2WR!v~!Q![2R!c!i2R#T#Z2RP2fT{P!Q![2a![!]2a!c!}2a#R#S2a#T#o2a~2zP!o~!_!`2}~3SO!p~~3XQ|~!_!`3_#r#s3d~3dO!q~~3iO!P~~3nP!l~!_!`3q~3vO!n~R3}T{P#zQ!Q![3v![!]2a!c!}3v#R#S3v#T#o3v~4cO$k~~4hO$l~~4mO$O~~4pRO#S4m#S#T%`#T~4m~5OO$U~~5TR!_~!_!`5^!`!a5c#r#s5h~5cO!W~~5hO!Y~~5mO!X~~5rO$W~",tokenizers:[0,1],topRules:{LogQL:[0,37]},specialized:[{term:43,get:(Pt,Er)=>J(Pt)<<1},{term:43,get:(Pt,Er)=>$(Pt)<<1|1},{term:43,get:Pt=>O[Pt]||-1}],tokenPrec:0}),_=1,ae=2,ye=3,ie=4,Ne=5,Ue=6,tt=7,dt=8,Ot=9,Ct=10,Bt=11,Wt=12,Dt=13,Qr=14,Tr=15,wa=16,pr=17,Je=18,Fa=19,Yr=20,Jr=21,qr=22,ea=23,Ca=24,Da=25,lt=26,At=27,wr=28,Fr=29,Mt=30,Aa=31,Ma=32,ta=33,jt=34,It=35,yt=36,ct=37,ra=38,Ae=39,ft=40,Ye=41,Cr=42,aa=43,ja=44,mt=45,qt=46,er=47,na=48,sa=49,Dr=50,ia=51,oa=52,Ar=53,Vt=54,Xt=55,hr=56,tr=57,la=58,gr=59,ca=60,ua=61,rr=62,ke=63,Mr=64,Qt=65,da=66,it=67,bt=68,nt=69,mr=70,Tt=71,ar=72,kt=73,zt=74,vr=75,Nt=76,jr=77,Ia=78,Na=79,xt=80,wt=81,Ir=82,Et=83,Or=84,_a=85,Ua=86,yr=87,nr=88,Nr=89,Kt=90,Ba=91,_r=92,fa=93,Ht=94,ot=95,pt=96,ht=97,rt=98,sr=99,Gt=100,Zt=101,ir=102,Ur=103,pa=104,Yt=105,Wa=106,ha=107,or=108,Va=109,Xa=110,ka=111,ga=112,ma=113,za=114,Ka=115,Br=116,va=117,Ha=118,Oa=119,ya=120,Ga=121,ba=122,xa=123,Wr=124,Za=125,Ya=126,lr=127,Ea=128,Pa=129,vt=130,St=131,Vr=132,br=133,La=134,Xr=135,Sa=136,$a=137,Ra=138,Qa=139,xr=140}}]);

//# sourceMappingURL=7049.14f2acbbdf538c5a95ca.js.map