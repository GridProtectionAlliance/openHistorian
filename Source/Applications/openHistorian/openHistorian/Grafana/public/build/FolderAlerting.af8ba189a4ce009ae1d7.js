"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1324],{75678:(e,n,r)=>{r.d(n,{Kd:()=>u,Zo:()=>o});var a=r(68404),t=r(19462),l=r(86647),s=r(33899);function o(e){const n=(0,s._)((e=>e.promRules)),r=(0,s._)((e=>e.rulerRules)),o=(0,a.useRef)({}),u=(0,a.useMemo)((()=>{if(e){const n=(0,t.o_)(e);if(!n)throw new Error(`Unknown rules source: ${e}`);return[n]}return(0,t.h_)()}),[e]);return(0,a.useMemo)((()=>u.map((e=>{var a,s;const u=(0,t.jq)(e)?e.name:e,d=null===(a=n[u])||void 0===a?void 0:a.result,m=null===(s=r[u])||void 0===s?void 0:s.result,g=o.current[u];if(g&&g.promRules===d&&g.rulerRules===m)return g.result;const p={};Object.entries(m||{}).forEach((n=>{let[r,a]=n;const t={rulesSource:e,name:r,groups:[]};p[r]=t,function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e.groups=n.map((n=>{const r={name:n.name,interval:n.interval,source_tenants:n.source_tenants,rules:[]};return r.rules=n.rules.map((n=>i(n,e,r))),r}))}(t,a)})),null==d||d.forEach((n=>{let{name:r,groups:a}=n;!function(e,n){n.forEach((n=>{var r;let a=e.groups.find((e=>e.name===n.name));a||(a={name:n.name,rules:[]},e.groups.push(a)),(null!==(r=n.rules)&&void 0!==r?r:[]).forEach((n=>{const r=function(e,n,r){var a;if((0,t.HY)(r))return n.rules.find((n=>n.name===e.name));return null!==(a=n.rules.find((n=>!n.promRule&&c(n,e,!0))))&&void 0!==a?a:n.rules.find((n=>!n.promRule&&c(n,e,!1)))}(n,a,e.rulesSource);r?r.promRule=n:a.rules.push(function(e,n,r){return{name:e.name,query:e.query,labels:e.labels||{},annotations:(0,l.x_)(e)&&e.annotations||{},promRule:e,namespace:n,group:r}}(n,e,a))}))}))}(p[r]=p[r]||{rulesSource:e,name:r,groups:[]},a)}));const f=Object.values(p);return o.current[u]={promRules:d,rulerRules:m,result:f},f})).flat()),[n,r,u])}function u(e){return e.map((e=>{const n=Object.assign({},e,{groups:[]});var r;return n.groups.push({name:"default",rules:(r=e.groups.flatMap((e=>e.rules)),r.sort(((e,n)=>e.name.localeCompare(n.name))))}),n}))}function i(e,n,r){return(0,l.cG)(e)?{name:e.alert,query:e.expr,labels:e.labels||{},annotations:e.annotations||{},rulerRule:e,namespace:n,group:r}:(0,l.yF)(e)?{name:e.record,query:e.expr,labels:e.labels||{},annotations:{},rulerRule:e,namespace:n,group:r}:{name:e.grafana_alert.title,query:"",labels:e.labels||{},annotations:e.annotations||{},rulerRule:e,namespace:n,group:r}}function c(e,n){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e.name===n.name&&JSON.stringify([r?d(e.query):"",e.labels,e.annotations])===JSON.stringify([r?d(n.query):"",n.labels||{},(0,l.x_)(n)&&n.annotations||{}])}function d(e){return e.length>1&&"("===e[0]&&")"===e[e.length-1]&&(e=e.slice(1,-1)),(e=e.replace(/\s|\n/g,"")).split("").sort().join("")}},28410:(e,n,r)=>{r.d(n,{j:()=>s});var a=r(68404),t=r(42326),l=r(90923);function s(){const{search:e}=(0,t.TH)();return[(0,a.useMemo)((()=>new URLSearchParams(e)),[e]),(0,a.useCallback)(((e,n)=>{l.locationService.partial(e,n)}),[])]}},95766:(e,n,r)=>{r.r(n),r.d(n,{default:()=>q});var a,t,l=r(68404),s=r(18745),o=r(17614),u=r(69371),i=r(8674),c=r(36636),d=r(82897),m=r(93368),g=r(8072),p=r(3490),f=r(65747),h=r(65184),b=r(75678),v=r(72965),j=r(28410),x=r(83809),S=r(82139),C=r(19462),y=r(39357),F=r(45916);!function(e){e.Ascending="alpha-asc",e.Descending="alpha-desc"}(t||(t={}));const R=[{label:"Alphabetically [A-Z]",value:t.Ascending},{label:"Alphabetically [Z-A]",value:t.Descending}],w=e=>{var n;let{folder:r}=e;const o=(0,p.useStyles2)(O),u=(0,s.useDispatch)(),i=e=>{const n=(0,S.Zh)(k),r=(0,S.tC)(e),a=(0,d.uniqWith)([...n,r],d.isEqual),t=(0,S.oI)(a);I(t)};(0,l.useEffect)((()=>{u((0,x.y6)({rulesSourceName:C.GC})),u((0,x.UR)({rulesSourceName:C.GC}))}),[u]);const c=(0,b.Zo)(C.GC),{nameFilter:w,labelFilter:k,sortOrder:A,setNameFilter:q,setLabelFilter:I,setSortOrder:L}=function(){var e,n;const[r,a]=(0,j.j)(),[s,o]=(0,l.useState)(null!==(e=r.get(N.nameFilter))&&void 0!==e?e:""),[u,i]=(0,l.useState)(null!==(n=r.get(N.labelFilter))&&void 0!==n?n:""),c=r.get(N.sortOrder),[d,g]=(0,l.useState)(c===t.Ascending?t.Ascending:c===t.Descending?t.Descending:void 0);return(0,m.Z)((()=>a({[N.nameFilter]:(0,h.sB)(s),[N.labelFilter]:(0,h.sB)(u),[N.sortOrder]:(0,h.sB)(d)},!0)),400,[s,u,d]),{nameFilter:s,labelFilter:u,sortOrder:d,setNameFilter:o,setLabelFilter:i,setSortOrder:g}}(),_=c.find((e=>e.name===r.title)),P=null!==(n=null==_?void 0:_.groups.flatMap((e=>e.rules)))&&void 0!==n?n:[],Z=function(e,n,r,a){const l=(0,S.Zh)(r);let s=e.filter((e=>e.name.toLowerCase().includes(n.toLowerCase())&&(0,S.eD)(e.labels,l)));return(0,d.orderBy)(s,(e=>e.name.toLowerCase()),[a===t.Ascending?"asc":"desc"])}(P,w,k,null!=A?A:t.Ascending),D=0===P.length||0===Z.length,{page:E,numberOfPages:$,onPageChange:M,pageItems:T}=(0,v.h)(Z,1,f.gN);return(0,F.jsx)("div",{className:o.container,children:(0,F.jsxs)(g.Stack,{direction:"column",gap:3,children:[(0,F.jsx)(p.FilterInput,{value:w,onChange:q,placeholder:"Search alert rules by name","data-testid":"name-filter"}),(0,F.jsxs)(g.Stack,{direction:"row",children:[(0,F.jsx)(p.Select,{value:A,onChange:e=>{let{value:n}=e;return n&&L(n)},options:R,width:25,"aria-label":"Sort",placeholder:"Sort (Default A-Z)",prefix:(0,F.jsx)(p.Icon,{name:A===t.Ascending?"sort-amount-up":"sort-amount-down"})}),(0,F.jsx)(p.FilterInput,{value:k,onChange:I,placeholder:"Search alerts by labels",className:o.filterLabelsInput,"data-testid":"label-filter"})]}),(0,F.jsx)(g.Stack,{gap:1,children:T.map((e=>(0,F.jsxs)(p.Card,{href:(0,y.V2)("grafana",e,""),className:o.card,"data-testid":"alert-card-row",children:[(0,F.jsx)(p.Card.Heading,{children:e.name}),(0,F.jsx)(p.Card.Tags,{children:(0,F.jsx)(p.TagList,{onClick:i,tags:Object.entries(e.labels).map((e=>{let[n,r]=e;return`${n}=${r}`}))})}),(0,F.jsx)(p.Card.Meta,{children:(0,F.jsxs)("div",{children:[a||(a=(0,F.jsx)(p.Icon,{name:"folder"}))," ",r.title]})})]},e.name)))}),D&&(0,F.jsx)("div",{className:o.noResults,children:"No alert rules found"}),(0,F.jsx)("div",{className:o.pagination,children:(0,F.jsx)(p.Pagination,{currentPage:E,numberOfPages:$,onNavigate:M,hideWhenSinglePage:!0})})]})})};var N;!function(e){e.nameFilter="nameFilter",e.labelFilter="labelFilter",e.sortOrder="sort"}(N||(N={}));const O=e=>({container:c.css`
    padding: ${e.spacing(1)};
  `,card:c.css`
    grid-template-columns: auto 1fr 2fr;
    margin: 0;
  `,pagination:c.css`
    align-self: center;
  `,filterLabelsInput:c.css`
    flex: 1;
    width: auto;
    min-width: 240px;
  `,noResults:c.css`
    padding: ${e.spacing(2)};
    background-color: ${e.colors.background.secondary};
    font-style: italic;
  `});var k=r(87413),A=r(49545);const q=e=>{let{match:n}=e;const r=(0,s.useDispatch)(),a=(0,s.useSelector)((e=>e.navIndex)),t=(0,s.useSelector)((e=>e.folder)),l=n.params.uid,c=(0,i.h)(a,`folder-alerting-${l}`,(0,A._)(1)),{loading:d}=(0,o.Z)((async()=>r((0,k.Pb)(l))),[k.Pb,l]);return(0,F.jsx)(u.T,{navId:"dashboards/browse",pageNav:c.main,children:(0,F.jsx)(u.T.Contents,{isLoading:d,children:(0,F.jsx)(w,{folder:t})})})}}}]);
//# sourceMappingURL=FolderAlerting.af8ba189a4ce009ae1d7.js.map