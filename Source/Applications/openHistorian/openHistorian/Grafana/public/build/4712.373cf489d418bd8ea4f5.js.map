{"version":3,"file":"4712.373cf489d418bd8ea4f5.js","mappings":"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","sources":["webpack://grafana/./public/app/plugins/datasource/loki/components/monaco-query-field/MonacoQueryFieldLazy.tsx","webpack://grafana/./public/app/plugins/datasource/loki/components/monaco-query-field/MonacoQueryFieldWrapper.tsx","webpack://grafana/./public/app/plugins/datasource/loki/components/LokiQueryField.tsx","webpack://grafana/./public/app/plugins/datasource/loki/languageUtils.ts","webpack://grafana/./public/app/plugins/datasource/loki/components/LokiCheatSheet.tsx","webpack://grafana/./public/app/plugins/datasource/loki/components/LokiLabelBrowser.tsx","webpack://grafana/./public/app/plugins/datasource/loki/querybuilder/components/LabelBrowserModal.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/shared/LabelFilterItem.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/shared/LabelFilters.tsx","webpack://grafana/./public/app/plugins/datasource/loki/querybuilder/components/LokiQueryBuilderExplained.tsx","webpack://grafana/./public/app/plugins/datasource/loki/querybuilder/components/NestedQuery.tsx","webpack://grafana/./public/app/plugins/datasource/loki/querybuilder/components/NestedQueryList.tsx","webpack://grafana/./public/app/plugins/datasource/loki/querybuilder/components/LokiQueryBuilder.tsx","webpack://grafana/./public/app/plugins/datasource/loki/querybuilder/components/QueryPreview.tsx","webpack://grafana/./public/app/plugins/datasource/loki/querybuilder/components/LokiQueryBuilderContainer.tsx","webpack://grafana/./public/app/plugins/datasource/loki/querybuilder/components/LokiQueryBuilderOptions.tsx","webpack://grafana/./public/app/plugins/datasource/loki/components/stats.ts","webpack://grafana/./public/app/plugins/datasource/loki/querybuilder/components/LokiQueryCodeEditor.tsx","webpack://grafana/./public/app/plugins/datasource/loki/querybuilder/components/QueryPattern.tsx","webpack://grafana/./public/app/plugins/datasource/loki/querybuilder/components/QueryPatternsModal.tsx","webpack://grafana/./public/app/plugins/datasource/loki/querybuilder/state.ts","webpack://grafana/./public/app/plugins/datasource/loki/components/LokiQueryEditor.tsx","webpack://grafana/./public/app/plugins/datasource/loki/components/LokiQueryEditorForAlerting.tsx","webpack://grafana/./public/app/plugins/datasource/loki/components/LokiQueryEditorByApp.tsx","webpack://grafana/./public/app/plugins/datasource/loki/configuration/DebugSection.tsx","webpack://grafana/./public/app/plugins/datasource/loki/configuration/DerivedField.tsx","webpack://grafana/./public/app/plugins/datasource/loki/configuration/DerivedFields.tsx","webpack://grafana/./public/app/plugins/datasource/loki/configuration/MaxLinesField.tsx","webpack://grafana/./public/app/plugins/datasource/loki/configuration/ConfigEditor.tsx","webpack://grafana/./public/app/plugins/datasource/loki/module.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/shared/OperationExplainedBox.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/shared/OperationListExplained.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/shared/RawQuery.tsx"],"sourcesContent":["import React, { Suspense } from 'react';\n\nimport { Props } from './MonacoQueryFieldProps';\n\nconst Field = React.lazy(() => import(/* webpackChunkName: \"loki-query-field\" */ './MonacoQueryField'));\n\nexport const MonacoQueryFieldLazy = (props: Props) => {\n  return (\n    <Suspense fallback={null}>\n      <Field {...props} />\n    </Suspense>\n  );\n};\n","import React, { useRef } from 'react';\n\nimport { MonacoQueryFieldLazy } from './MonacoQueryFieldLazy';\nimport { Props as MonacoProps } from './MonacoQueryFieldProps';\n\nexport type Props = Omit<MonacoProps, 'onRunQuery' | 'onBlur'> & {\n  onChange: (query: string) => void;\n  onRunQuery: () => void;\n  onQueryType?: (query: string) => void;\n};\n\nexport const MonacoQueryFieldWrapper = (props: Props) => {\n  const lastRunValueRef = useRef<string | null>(null);\n  const { onRunQuery, onChange, ...rest } = props;\n\n  const handleRunQuery = (value: string) => {\n    lastRunValueRef.current = value;\n    onChange(value);\n    onRunQuery();\n  };\n\n  const handleBlur = (value: string) => {\n    onChange(value);\n  };\n\n  return <MonacoQueryFieldLazy onRunQuery={handleRunQuery} onBlur={handleBlur} {...rest} />;\n};\n","import React, { ReactNode } from 'react';\n\nimport { QueryEditorProps } from '@grafana/data';\n\nimport { LokiDatasource } from '../datasource';\nimport { shouldRefreshLabels } from '../languageUtils';\nimport { LokiQuery, LokiOptions } from '../types';\n\nimport { MonacoQueryFieldWrapper } from './monaco-query-field/MonacoQueryFieldWrapper';\n\nexport interface LokiQueryFieldProps extends QueryEditorProps<LokiDatasource, LokiQuery, LokiOptions> {\n  ExtraFieldElement?: ReactNode;\n  placeholder?: string;\n  'data-testid'?: string;\n  onQueryType?: (query: string) => void;\n}\n\ninterface LokiQueryFieldState {\n  labelsLoaded: boolean;\n}\n\nexport class LokiQueryField extends React.PureComponent<LokiQueryFieldProps, LokiQueryFieldState> {\n  _isMounted = false;\n\n  constructor(props: LokiQueryFieldProps) {\n    super(props);\n\n    this.state = { labelsLoaded: false };\n  }\n\n  async componentDidMount() {\n    this._isMounted = true;\n    await this.props.datasource.languageProvider.start();\n    if (this._isMounted) {\n      this.setState({ labelsLoaded: true });\n    }\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n\n  componentDidUpdate(prevProps: LokiQueryFieldProps) {\n    const {\n      range,\n      datasource: { languageProvider },\n    } = this.props;\n    const refreshLabels = shouldRefreshLabels(range, prevProps.range);\n    // We want to refresh labels when range changes (we round up intervals to a minute)\n    if (refreshLabels) {\n      languageProvider.fetchLabels();\n    }\n  }\n\n  onChangeQuery = (value: string, override?: boolean) => {\n    // Send text change to parent\n    const { query, onChange, onRunQuery } = this.props;\n    if (onChange) {\n      const nextQuery = { ...query, expr: value };\n      onChange(nextQuery);\n\n      if (override && onRunQuery) {\n        onRunQuery();\n      }\n    }\n  };\n\n  render() {\n    const { ExtraFieldElement, query, datasource, history, onRunQuery, onQueryType } = this.props;\n    const placeholder = this.props.placeholder ?? 'Enter a Loki query (run with Shift+Enter)';\n\n    return (\n      <>\n        <div\n          className=\"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1\"\n          data-testid={this.props['data-testid']}\n        >\n          <div className=\"gf-form gf-form--grow flex-shrink-1 min-width-15\">\n            <MonacoQueryFieldWrapper\n              datasource={datasource}\n              history={history ?? []}\n              onChange={this.onChangeQuery}\n              onRunQuery={onRunQuery}\n              initialValue={query.expr ?? ''}\n              placeholder={placeholder}\n              onQueryType={onQueryType}\n            />\n          </div>\n        </div>\n        {ExtraFieldElement}\n      </>\n    );\n  }\n}\n","import { TimeRange } from '@grafana/data';\n\nfunction roundMsToMin(milliseconds: number): number {\n  return roundSecToMin(milliseconds / 1000);\n}\n\nfunction roundSecToMin(seconds: number): number {\n  return Math.floor(seconds / 60);\n}\n\nexport function shouldRefreshLabels(range?: TimeRange, prevRange?: TimeRange): boolean {\n  if (range && prevRange) {\n    const sameMinuteFrom = roundMsToMin(range.from.valueOf()) === roundMsToMin(prevRange.from.valueOf());\n    const sameMinuteTo = roundMsToMin(range.to.valueOf()) === roundMsToMin(prevRange.to.valueOf());\n    // If both are same, don't need to refresh\n    return !(sameMinuteFrom && sameMinuteTo);\n  }\n  return false;\n}\n\n// Loki regular-expressions use the RE2 syntax (https://github.com/google/re2/wiki/Syntax),\n// so every character that matches something in that list has to be escaped.\n// the list of meta characters is: *+?()|\\.[]{}^$\n// we make a javascript regular expression that matches those characters:\nconst RE2_METACHARACTERS = /[*+?()|\\\\.\\[\\]{}^$]/g;\nfunction escapeLokiRegexp(value: string): string {\n  return value.replace(RE2_METACHARACTERS, '\\\\$&');\n}\n\n// based on the openmetrics-documentation, the 3 symbols we have to handle are:\n// - \\n ... the newline character\n// - \\  ... the backslash character\n// - \"  ... the double-quote character\nexport function escapeLabelValueInExactSelector(labelValue: string): string {\n  return labelValue.replace(/\\\\/g, '\\\\\\\\').replace(/\\n/g, '\\\\n').replace(/\"/g, '\\\\\"');\n}\n\nexport function unescapeLabelValue(labelValue: string): string {\n  return labelValue.replace(/\\\\n/g, '\\n').replace(/\\\\\"/g, '\"').replace(/\\\\\\\\/g, '\\\\');\n}\n\nexport function escapeLabelValueInRegexSelector(labelValue: string): string {\n  return escapeLabelValueInExactSelector(escapeLokiRegexp(labelValue));\n}\n\nexport function escapeLabelValueInSelector(labelValue: string, selector?: string): string {\n  return isRegexSelector(selector)\n    ? escapeLabelValueInRegexSelector(labelValue)\n    : escapeLabelValueInExactSelector(labelValue);\n}\n\nexport function isRegexSelector(selector?: string) {\n  if (selector && (selector.includes('=~') || selector.includes('!~'))) {\n    return true;\n  }\n  return false;\n}\n\nexport function isBytesString(string: string) {\n  const BYTES_KEYWORDS = [\n    'b',\n    'kib',\n    'Kib',\n    'kb',\n    'KB',\n    'mib',\n    'Mib',\n    'mb',\n    'MB',\n    'gib',\n    'Gib',\n    'gb',\n    'GB',\n    'tib',\n    'Tib',\n    'tb',\n    'TB',\n    'pib',\n    'Pib',\n    'pb',\n    'PB',\n    'eib',\n    'Eib',\n    'eb',\n    'EB',\n  ];\n  const regex = new RegExp(`^(?:-?\\\\d+(?:\\\\.\\\\d+)?)(?:${BYTES_KEYWORDS.join('|')})$`);\n  const match = string.match(regex);\n  return !!match;\n}\n","import { shuffle } from 'lodash';\nimport React, { PureComponent } from 'react';\n\nimport { QueryEditorHelpProps } from '@grafana/data';\nimport { reportInteraction } from '@grafana/runtime';\n\nimport LokiLanguageProvider from '../LanguageProvider';\nimport { LokiQuery } from '../types';\n\nconst DEFAULT_EXAMPLES = ['{job=\"default/prometheus\"}'];\nconst PREFERRED_LABELS = ['job', 'app', 'k8s_app'];\nconst EXAMPLES_LIMIT = 5;\n\nconst LOGQL_EXAMPLES = [\n  {\n    title: 'Log pipeline',\n    expression: '{job=\"mysql\"} |= \"metrics\" | logfmt | duration > 10s',\n    label:\n      'This query targets the MySQL job, keeps logs that contain the substring \"metrics\", and then parses and filters the logs further.',\n  },\n  {\n    title: 'Count over time',\n    expression: 'count_over_time({job=\"mysql\"}[5m])',\n    label: 'This query counts all the log lines within the last five minutes for the MySQL job.',\n  },\n  {\n    title: 'Rate',\n    expression: 'rate(({job=\"mysql\"} |= \"error\" != \"timeout\")[10s])',\n    label:\n      'This query gets the per-second rate of all non-timeout errors within the last ten seconds for the MySQL job.',\n  },\n  {\n    title: 'Aggregate, count, and group',\n    expression: 'sum(count_over_time({job=\"mysql\"}[5m])) by (level)',\n    label: 'Get the count of logs during the last five minutes, grouping by level.',\n  },\n];\n\nexport default class LokiCheatSheet extends PureComponent<QueryEditorHelpProps<LokiQuery>, { userExamples: string[] }> {\n  declare userLabelTimer: ReturnType<typeof setTimeout>;\n  state = {\n    userExamples: [],\n  };\n\n  componentDidMount() {\n    this.scheduleUserLabelChecking();\n    reportInteraction('grafana_loki_cheatsheet_opened', {});\n  }\n\n  componentWillUnmount() {\n    clearTimeout(this.userLabelTimer);\n  }\n\n  scheduleUserLabelChecking() {\n    this.userLabelTimer = setTimeout(this.checkUserLabels, 1000);\n  }\n\n  checkUserLabels = async () => {\n    // Set example from user labels\n    const provider: LokiLanguageProvider = this.props.datasource?.languageProvider;\n    if (provider.started) {\n      const labels = provider.getLabelKeys() || [];\n      const preferredLabel = PREFERRED_LABELS.find((l) => labels.includes(l));\n      if (preferredLabel) {\n        const values = await provider.getLabelValues(preferredLabel);\n        const userExamples = shuffle(values)\n          .slice(0, EXAMPLES_LIMIT)\n          .map((value) => `{${preferredLabel}=\"${value}\"}`);\n        this.setState({ userExamples });\n      }\n    } else {\n      this.scheduleUserLabelChecking();\n    }\n  };\n\n  renderExpression(expr: string) {\n    const { onClickExample } = this.props;\n    const onClick = (query: LokiQuery) => {\n      onClickExample(query);\n      reportInteraction('grafana_loki_cheatsheet_example_clicked', {});\n    };\n\n    return (\n      <button\n        type=\"button\"\n        className=\"cheat-sheet-item__example\"\n        key={expr}\n        onClick={(e) => onClick({ refId: 'A', expr })}\n      >\n        <code>{expr}</code>\n      </button>\n    );\n  }\n\n  render() {\n    const { userExamples } = this.state;\n    const hasUserExamples = userExamples.length > 0;\n\n    return (\n      <div>\n        <h2>Loki Cheat Sheet</h2>\n        <div className=\"cheat-sheet-item\">\n          <div className=\"cheat-sheet-item__title\">See your logs</div>\n          <div className=\"cheat-sheet-item__label\">\n            Start by selecting a log stream from the Label browser, or alternatively you can write a stream selector\n            into the query field.\n          </div>\n          {hasUserExamples ? (\n            <div>\n              <div className=\"cheat-sheet-item__label\">Here are some example streams from your logs:</div>\n              {userExamples.map((example) => this.renderExpression(example))}\n            </div>\n          ) : (\n            <div>\n              <div className=\"cheat-sheet-item__label\">Here is an example of a log stream:</div>\n              {this.renderExpression(DEFAULT_EXAMPLES[0])}\n            </div>\n          )}\n        </div>\n        <div className=\"cheat-sheet-item\">\n          <div className=\"cheat-sheet-item__title\">Combine stream selectors</div>\n          {this.renderExpression('{app=\"cassandra\",namespace=\"prod\"}')}\n          <div className=\"cheat-sheet-item__label\">Returns all log lines from streams that have both labels.</div>\n        </div>\n\n        <div className=\"cheat-sheet-item\">\n          <div className=\"cheat-sheet-item__title\">Filtering for search terms.</div>\n          {this.renderExpression('{app=\"cassandra\"} |~ \"(duration|latency)s*(=|is|of)s*[d.]+\"')}\n          {this.renderExpression('{app=\"cassandra\"} |= \"exact match\"')}\n          {this.renderExpression('{app=\"cassandra\"} != \"do not match\"')}\n          <div className=\"cheat-sheet-item__label\">\n            <a href=\"https://grafana.com/docs/loki/latest/logql/#log-pipeline\" target=\"logql\">\n              LogQL\n            </a>{' '}\n            supports exact and regular expression filters.\n          </div>\n        </div>\n        {LOGQL_EXAMPLES.map((item) => (\n          <div className=\"cheat-sheet-item\" key={item.expression}>\n            <div className=\"cheat-sheet-item__title\">{item.title}</div>\n            {this.renderExpression(item.expression)}\n            <div className=\"cheat-sheet-item__label\">{item.label}</div>\n          </div>\n        ))}\n      </div>\n    );\n  }\n}\n","import { css, cx } from '@emotion/css';\nimport { sortBy } from 'lodash';\nimport React, { ChangeEvent } from 'react';\nimport { FixedSizeList } from 'react-window';\n\nimport { CoreApp, GrafanaTheme2 } from '@grafana/data';\nimport { reportInteraction } from '@grafana/runtime';\nimport {\n  Button,\n  HighlightPart,\n  HorizontalGroup,\n  Input,\n  Label,\n  LoadingPlaceholder,\n  withTheme2,\n  BrowserLabel as LokiLabel,\n  fuzzyMatch,\n} from '@grafana/ui';\n\nimport PromQlLanguageProvider from '../../prometheus/language_provider';\nimport LokiLanguageProvider from '../LanguageProvider';\nimport { escapeLabelValueInExactSelector, escapeLabelValueInRegexSelector } from '../languageUtils';\n\n// Hard limit on labels to render\nconst MAX_LABEL_COUNT = 1000;\nconst MAX_VALUE_COUNT = 10000;\nconst MAX_AUTO_SELECT = 4;\nconst EMPTY_SELECTOR = '{}';\n\nexport interface BrowserProps {\n  // TODO #33976: Is it possible to use a common interface here? For example: LabelsLanguageProvider\n  languageProvider: LokiLanguageProvider | PromQlLanguageProvider;\n  onChange: (selector: string) => void;\n  theme: GrafanaTheme2;\n  app?: CoreApp;\n  autoSelect?: number;\n  hide?: () => void;\n  lastUsedLabels: string[];\n  storeLastUsedLabels: (labels: string[]) => void;\n  deleteLastUsedLabels: () => void;\n}\n\ninterface BrowserState {\n  labels: SelectableLabel[];\n  searchTerm: string;\n  status: string;\n  error: string;\n  validationStatus: string;\n}\n\ninterface FacettableValue {\n  name: string;\n  selected?: boolean;\n  highlightParts?: HighlightPart[];\n  order?: number;\n}\n\nexport interface SelectableLabel {\n  name: string;\n  selected?: boolean;\n  loading?: boolean;\n  values?: FacettableValue[];\n  hidden?: boolean;\n  facets?: number;\n}\n\nexport function buildSelector(labels: SelectableLabel[]): string {\n  const selectedLabels = [];\n  for (const label of labels) {\n    if (label.selected && label.values && label.values.length > 0) {\n      const selectedValues = label.values.filter((value) => value.selected).map((value) => value.name);\n      if (selectedValues.length > 1) {\n        selectedLabels.push(`${label.name}=~\"${selectedValues.map(escapeLabelValueInRegexSelector).join('|')}\"`);\n      } else if (selectedValues.length === 1) {\n        selectedLabels.push(`${label.name}=\"${escapeLabelValueInExactSelector(selectedValues[0])}\"`);\n      }\n    }\n  }\n  return ['{', selectedLabels.join(','), '}'].join('');\n}\n\nexport function facetLabels(\n  labels: SelectableLabel[],\n  possibleLabels: Record<string, string[]>,\n  lastFacetted?: string\n): SelectableLabel[] {\n  return labels.map((label) => {\n    const possibleValues = possibleLabels[label.name];\n    if (possibleValues) {\n      let existingValues: FacettableValue[];\n      if (label.name === lastFacetted && label.values) {\n        // Facetting this label, show all values\n        existingValues = label.values;\n      } else {\n        // Keep selection in other facets\n        const selectedValues: Set<string> = new Set(\n          label.values?.filter((value) => value.selected).map((value) => value.name) || []\n        );\n        // Values for this label have not been requested yet, let's use the facetted ones as the initial values\n        existingValues = possibleValues.map((value) => ({ name: value, selected: selectedValues.has(value) }));\n      }\n      return { ...label, loading: false, values: existingValues, facets: existingValues.length };\n    }\n\n    // Label is facetted out, hide all values\n    return { ...label, loading: false, hidden: !possibleValues, values: undefined, facets: 0 };\n  });\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  wrapper: css`\n    background-color: ${theme.colors.background.secondary};\n    padding: ${theme.spacing(2)};\n    width: 100%;\n  `,\n  list: css`\n    margin-top: ${theme.spacing(1)};\n    display: flex;\n    flex-wrap: wrap;\n    max-height: 200px;\n    overflow: auto;\n  `,\n  section: css`\n    & + & {\n      margin: ${theme.spacing(2, 0)};\n    }\n    position: relative;\n  `,\n  selector: css`\n    font-family: ${theme.typography.fontFamilyMonospace};\n    margin-bottom: ${theme.spacing(1)};\n  `,\n  status: css`\n    margin-bottom: ${theme.spacing(1)};\n    color: ${theme.colors.text.secondary};\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    transition: opacity 100ms linear;\n    opacity: 0;\n  `,\n  statusShowing: css`\n    opacity: 1;\n  `,\n  error: css`\n    color: ${theme.colors.error.main};\n  `,\n  valueList: css`\n    margin-right: ${theme.spacing(1)};\n    resize: horizontal;\n  `,\n  valueListWrapper: css`\n    border-left: 1px solid ${theme.colors.border.medium};\n    margin: ${theme.spacing(1, 0)};\n    padding: ${theme.spacing(1, 0, 1, 1)};\n  `,\n  valueListArea: css`\n    display: flex;\n    flex-wrap: wrap;\n    margin-top: ${theme.spacing(1)};\n  `,\n  valueTitle: css`\n    margin-left: -${theme.spacing(0.5)};\n    margin-bottom: ${theme.spacing(1)};\n  `,\n  validationStatus: css`\n    padding: ${theme.spacing(0.5)};\n    margin-bottom: ${theme.spacing(1)};\n    color: ${theme.colors.text.maxContrast};\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  `,\n});\n\nexport class UnthemedLokiLabelBrowser extends React.Component<BrowserProps, BrowserState> {\n  state: BrowserState = {\n    labels: [] as SelectableLabel[],\n    searchTerm: '',\n    status: 'Ready',\n    error: '',\n    validationStatus: '',\n  };\n\n  onChangeSearch = (event: ChangeEvent<HTMLInputElement>) => {\n    this.setState({ searchTerm: event.target.value });\n  };\n\n  onClickRunLogsQuery = () => {\n    reportInteraction('grafana_loki_label_browser_closed', {\n      app: this.props.app,\n      closeType: 'showLogsButton',\n    });\n    const selector = buildSelector(this.state.labels);\n    this.props.onChange(selector);\n  };\n\n  onClickRunMetricsQuery = () => {\n    reportInteraction('grafana_loki_label_browser_closed', {\n      app: this.props.app,\n      closeType: 'showLogsRateButton',\n    });\n    const selector = buildSelector(this.state.labels);\n    const query = `rate(${selector}[$__interval])`;\n    this.props.onChange(query);\n  };\n\n  onClickClear = () => {\n    this.setState((state) => {\n      const labels: SelectableLabel[] = state.labels.map((label) => ({\n        ...label,\n        values: undefined,\n        selected: false,\n        loading: false,\n        hidden: false,\n        facets: undefined,\n      }));\n      return { labels, searchTerm: '', status: '', error: '', validationStatus: '' };\n    });\n    this.props.deleteLastUsedLabels();\n  };\n\n  onClickLabel = (name: string, value: string | undefined, event: React.MouseEvent<HTMLElement>) => {\n    const label = this.state.labels.find((l) => l.name === name);\n    if (!label) {\n      return;\n    }\n    // Toggle selected state\n    const selected = !label.selected;\n    let nextValue: Partial<SelectableLabel> = { selected };\n    if (label.values && !selected) {\n      // Deselect all values if label was deselected\n      const values = label.values.map((value) => ({ ...value, selected: false }));\n      nextValue = { ...nextValue, facets: 0, values };\n    }\n    // Resetting search to prevent empty results\n    this.setState({ searchTerm: '' });\n    this.updateLabelState(name, nextValue, '', () => this.doFacettingForLabel(name));\n  };\n\n  onClickValue = (name: string, value: string | undefined, event: React.MouseEvent<HTMLElement>) => {\n    const label = this.state.labels.find((l) => l.name === name);\n    if (!label || !label.values) {\n      return;\n    }\n    // Resetting search to prevent empty results\n    this.setState({ searchTerm: '' });\n    // Toggling value for selected label, leaving other values intact\n    const values = label.values.map((v) => ({ ...v, selected: v.name === value ? !v.selected : v.selected }));\n    this.updateLabelState(name, { values }, '', () => this.doFacetting(name));\n  };\n\n  onClickValidate = () => {\n    const selector = buildSelector(this.state.labels);\n    this.validateSelector(selector);\n  };\n\n  updateLabelState(name: string, updatedFields: Partial<SelectableLabel>, status = '', cb?: () => void) {\n    this.setState((state) => {\n      const labels: SelectableLabel[] = state.labels.map((label) => {\n        if (label.name === name) {\n          return { ...label, ...updatedFields };\n        }\n        return label;\n      });\n      // New status overrides errors\n      const error = status ? '' : state.error;\n      return { labels, status, error, validationStatus: '' };\n    }, cb);\n  }\n\n  componentDidMount() {\n    const { languageProvider, autoSelect = MAX_AUTO_SELECT, lastUsedLabels } = this.props;\n    if (languageProvider) {\n      const selectedLabels: string[] = lastUsedLabels;\n      languageProvider.start().then(() => {\n        let rawLabels: string[] = languageProvider.getLabelKeys();\n        if (rawLabels.length > MAX_LABEL_COUNT) {\n          const error = `Too many labels found (showing only ${MAX_LABEL_COUNT} of ${rawLabels.length})`;\n          rawLabels = rawLabels.slice(0, MAX_LABEL_COUNT);\n          this.setState({ error });\n        }\n        // Auto-select all labels if label list is small enough\n        const labels: SelectableLabel[] = rawLabels.map((label, i, arr) => ({\n          name: label,\n          selected: (arr.length <= autoSelect && selectedLabels.length === 0) || selectedLabels.includes(label),\n          loading: false,\n        }));\n        // Pre-fetch values for selected labels\n        this.setState({ labels }, () => {\n          this.state.labels.forEach((label) => {\n            if (label.selected) {\n              this.fetchValues(label.name, EMPTY_SELECTOR);\n            }\n          });\n        });\n      });\n    }\n  }\n\n  doFacettingForLabel(name: string) {\n    const label = this.state.labels.find((l) => l.name === name);\n    if (!label) {\n      return;\n    }\n    const selectedLabels = this.state.labels.filter((label) => label.selected).map((label) => label.name);\n    this.props.storeLastUsedLabels(selectedLabels);\n    if (label.selected) {\n      // Refetch values for newly selected label...\n      if (!label.values) {\n        this.fetchValues(name, buildSelector(this.state.labels));\n      }\n    } else {\n      // Only need to facet when deselecting labels\n      this.doFacetting();\n    }\n  }\n\n  doFacetting = (lastFacetted?: string) => {\n    const selector = buildSelector(this.state.labels);\n    if (selector === EMPTY_SELECTOR) {\n      // Clear up facetting\n      const labels: SelectableLabel[] = this.state.labels.map((label) => {\n        return { ...label, facets: 0, values: undefined, hidden: false };\n      });\n      this.setState({ labels }, () => {\n        // Get fresh set of values\n        this.state.labels.forEach((label) => label.selected && this.fetchValues(label.name, selector));\n      });\n    } else {\n      // Do facetting\n      this.fetchSeries(selector, lastFacetted);\n    }\n  };\n\n  async fetchValues(name: string, selector: string) {\n    const { languageProvider } = this.props;\n    this.updateLabelState(name, { loading: true }, `Fetching values for ${name}`);\n    try {\n      let rawValues = await languageProvider.getLabelValues(name);\n      // If selector changed, clear loading state and discard result by returning early\n      if (selector !== buildSelector(this.state.labels)) {\n        this.updateLabelState(name, { loading: false }, '');\n        return;\n      }\n      if (rawValues.length > MAX_VALUE_COUNT) {\n        const error = `Too many values for ${name} (showing only ${MAX_VALUE_COUNT} of ${rawValues.length})`;\n        rawValues = rawValues.slice(0, MAX_VALUE_COUNT);\n        this.setState({ error });\n      }\n      const values: FacettableValue[] = rawValues.map((value) => ({ name: value }));\n      this.updateLabelState(name, { values, loading: false });\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  async fetchSeries(selector: string, lastFacetted?: string) {\n    const { languageProvider } = this.props;\n    if (lastFacetted) {\n      this.updateLabelState(lastFacetted, { loading: true }, `Loading labels for ${selector}`);\n    }\n    try {\n      const possibleLabels = await languageProvider.fetchSeriesLabels(selector, true);\n      // If selector changed, clear loading state and discard result by returning early\n      if (selector !== buildSelector(this.state.labels)) {\n        if (lastFacetted) {\n          this.updateLabelState(lastFacetted, { loading: false });\n        }\n        return;\n      }\n      if (Object.keys(possibleLabels).length === 0) {\n        this.setState({ error: `Empty results, no matching label for ${selector}` });\n        return;\n      }\n      const labels: SelectableLabel[] = facetLabels(this.state.labels, possibleLabels, lastFacetted);\n      this.setState({ labels, error: '' });\n      if (lastFacetted) {\n        this.updateLabelState(lastFacetted, { loading: false });\n      }\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  async validateSelector(selector: string) {\n    const { languageProvider } = this.props;\n    this.setState({ validationStatus: `Validating selector ${selector}`, error: '' });\n    const streams = await languageProvider.fetchSeries(selector);\n    this.setState({ validationStatus: `Selector is valid (${streams.length} streams found)` });\n  }\n\n  render() {\n    const { theme } = this.props;\n    const { labels, searchTerm, status, error, validationStatus } = this.state;\n    if (labels.length === 0) {\n      return <LoadingPlaceholder text=\"Loading labels...\" />;\n    }\n    const styles = getStyles(theme);\n    const selector = buildSelector(this.state.labels);\n    const empty = selector === EMPTY_SELECTOR;\n\n    let selectedLabels = labels.filter((label) => label.selected && label.values);\n    if (searchTerm) {\n      selectedLabels = selectedLabels.map((label) => {\n        const searchResults = label.values!.filter((value) => {\n          // Always return selected values\n          if (value.selected) {\n            value.highlightParts = undefined;\n            return true;\n          }\n          const fuzzyMatchResult = fuzzyMatch(value.name.toLowerCase(), searchTerm.toLowerCase());\n          if (fuzzyMatchResult.found) {\n            value.highlightParts = fuzzyMatchResult.ranges;\n            value.order = fuzzyMatchResult.distance;\n            return true;\n          } else {\n            return false;\n          }\n        });\n        return {\n          ...label,\n          values: sortBy(searchResults, (value) => (value.selected ? -Infinity : value.order)),\n        };\n      });\n    } else {\n      // Clear highlight parts when searchTerm is cleared\n      selectedLabels = this.state.labels\n        .filter((label) => label.selected && label.values)\n        .map((label) => ({\n          ...label,\n          values: label?.values ? label.values.map((value) => ({ ...value, highlightParts: undefined })) : [],\n        }));\n    }\n\n    return (\n      <div className={styles.wrapper}>\n        <div className={styles.section}>\n          <Label description=\"Which labels would you like to consider for your search?\">\n            1. Select labels to search in\n          </Label>\n          <div className={styles.list}>\n            {labels.map((label) => (\n              <LokiLabel\n                key={label.name}\n                name={label.name}\n                loading={label.loading}\n                active={label.selected}\n                hidden={label.hidden}\n                facets={label.facets}\n                onClick={this.onClickLabel}\n              />\n            ))}\n          </div>\n        </div>\n        <div className={styles.section}>\n          <Label description=\"Choose the label values that you would like to use for the query. Use the search field to find values across selected labels.\">\n            2. Find values for the selected labels\n          </Label>\n          <div>\n            <Input\n              onChange={this.onChangeSearch}\n              aria-label=\"Filter expression for values\"\n              value={searchTerm}\n              placeholder={'Enter a label value'}\n            />\n          </div>\n          <div className={styles.valueListArea}>\n            {selectedLabels.map((label) => (\n              <div role=\"list\" key={label.name} className={styles.valueListWrapper}>\n                <div className={styles.valueTitle} aria-label={`Values for ${label.name}`}>\n                  <LokiLabel\n                    name={label.name}\n                    loading={label.loading}\n                    active={label.selected}\n                    hidden={label.hidden}\n                    //If no facets, we want to show number of all label values\n                    facets={label.facets || label.values?.length}\n                    onClick={this.onClickLabel}\n                  />\n                </div>\n                <FixedSizeList\n                  height={200}\n                  itemCount={label.values?.length || 0}\n                  itemSize={28}\n                  itemKey={(i) => (label.values as FacettableValue[])[i].name}\n                  width={200}\n                  className={styles.valueList}\n                >\n                  {({ index, style }) => {\n                    const value = label.values?.[index];\n                    if (!value) {\n                      return null;\n                    }\n                    return (\n                      <div style={style}>\n                        <LokiLabel\n                          name={label.name}\n                          value={value?.name}\n                          active={value?.selected}\n                          highlightParts={value?.highlightParts}\n                          onClick={this.onClickValue}\n                          searchTerm={searchTerm}\n                        />\n                      </div>\n                    );\n                  }}\n                </FixedSizeList>\n              </div>\n            ))}\n          </div>\n        </div>\n        <div className={styles.section}>\n          <Label>3. Resulting selector</Label>\n          <div aria-label=\"selector\" className={styles.selector}>\n            {selector}\n          </div>\n          {validationStatus && <div className={styles.validationStatus}>{validationStatus}</div>}\n          <div className={cx(styles.status, (status || error) && styles.statusShowing)}>\n            <span className={error ? styles.error : ''}>{error || status}</span>\n          </div>\n          <HorizontalGroup>\n            <Button aria-label=\"Use selector as logs button\" disabled={empty} onClick={this.onClickRunLogsQuery}>\n              Show logs\n            </Button>\n            <Button\n              aria-label=\"Use selector as metrics button\"\n              variant=\"secondary\"\n              disabled={empty}\n              onClick={this.onClickRunMetricsQuery}\n            >\n              Show logs rate\n            </Button>\n            <Button\n              aria-label=\"Validate submit button\"\n              variant=\"secondary\"\n              disabled={empty}\n              onClick={this.onClickValidate}\n            >\n              Validate selector\n            </Button>\n            <Button aria-label=\"Selector clear button\" variant=\"secondary\" onClick={this.onClickClear}>\n              Clear\n            </Button>\n          </HorizontalGroup>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport const LokiLabelBrowser = withTheme2(UnthemedLokiLabelBrowser);\n","import { css } from '@emotion/css';\nimport React, { useState, useEffect } from 'react';\n\nimport { CoreApp, GrafanaTheme2 } from '@grafana/data';\nimport { reportInteraction } from '@grafana/runtime';\nimport { LoadingPlaceholder, Modal, useStyles2 } from '@grafana/ui';\nimport { LocalStorageValueProvider } from 'app/core/components/LocalStorageValueProvider';\n\nimport { LokiLabelBrowser } from '../../components/LokiLabelBrowser';\nimport { LokiDatasource } from '../../datasource';\nimport { LokiQuery } from '../../types';\n\nexport interface Props {\n  isOpen: boolean;\n  datasource: LokiDatasource;\n  query: LokiQuery;\n  app?: CoreApp;\n  onClose: () => void;\n  onChange: (query: LokiQuery) => void;\n  onRunQuery: () => void;\n}\n\nexport const LabelBrowserModal = (props: Props) => {\n  const { isOpen, onClose, datasource, app } = props;\n  const [labelsLoaded, setLabelsLoaded] = useState(false);\n  const [hasLogLabels, setHasLogLabels] = useState(false);\n  const LAST_USED_LABELS_KEY = 'grafana.datasources.loki.browser.labels';\n\n  const styles = useStyles2(getStyles);\n\n  useEffect(() => {\n    if (!isOpen) {\n      return;\n    }\n\n    datasource.languageProvider.fetchLabels().then((labels) => {\n      setLabelsLoaded(true);\n      setHasLogLabels(labels.length > 0);\n    });\n  }, [datasource, isOpen]);\n\n  const changeQuery = (value: string) => {\n    const { query, onChange, onRunQuery } = props;\n    const nextQuery = { ...query, expr: value };\n    onChange(nextQuery);\n    onRunQuery();\n  };\n\n  const onChange = (selector: string) => {\n    changeQuery(selector);\n    onClose();\n  };\n\n  const reportInteractionAndClose = () => {\n    reportInteraction('grafana_loki_label_browser_closed', {\n      app,\n      closeType: 'modalClose',\n    });\n    onClose();\n  };\n\n  return (\n    <Modal isOpen={isOpen} title=\"Label browser\" onDismiss={reportInteractionAndClose} className={styles.modal}>\n      {!labelsLoaded && <LoadingPlaceholder text=\"Loading labels...\" />}\n      {labelsLoaded && !hasLogLabels && <p>No labels found.</p>}\n      {labelsLoaded && hasLogLabels && (\n        <LocalStorageValueProvider<string[]> storageKey={LAST_USED_LABELS_KEY} defaultValue={[]}>\n          {(lastUsedLabels, onLastUsedLabelsSave, onLastUsedLabelsDelete) => {\n            return (\n              <LokiLabelBrowser\n                languageProvider={datasource.languageProvider}\n                onChange={onChange}\n                lastUsedLabels={lastUsedLabels}\n                storeLastUsedLabels={onLastUsedLabelsSave}\n                deleteLastUsedLabels={onLastUsedLabelsDelete}\n                app={app}\n              />\n            );\n          }}\n        </LocalStorageValueProvider>\n      )}\n    </Modal>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    modal: css`\n      width: 85vw;\n      ${theme.breakpoints.down('md')} {\n        width: 100%;\n      }\n    `,\n  };\n};\n","import { uniqBy } from 'lodash';\nimport React, { useState } from 'react';\n\nimport { SelectableValue, toOption } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { AccessoryButton, InputGroup } from '@grafana/experimental';\nimport { InlineField, Select } from '@grafana/ui';\nimport { lokiOperators } from 'app/plugins/datasource/loki/querybuilder/types';\n\nimport { isConflictingSelector } from './operationUtils';\nimport { QueryBuilderLabelFilter } from './types';\n\nexport interface Props {\n  defaultOp: string;\n  item: Partial<QueryBuilderLabelFilter>;\n  items: Array<Partial<QueryBuilderLabelFilter>>;\n  onChange: (value: QueryBuilderLabelFilter) => void;\n  onGetLabelNames: (forLabel: Partial<QueryBuilderLabelFilter>) => Promise<SelectableValue[]>;\n  onGetLabelValues: (forLabel: Partial<QueryBuilderLabelFilter>) => Promise<SelectableValue[]>;\n  onDelete: () => void;\n  invalidLabel?: boolean;\n  invalidValue?: boolean;\n}\n\nexport function LabelFilterItem({\n  item,\n  items,\n  defaultOp,\n  onChange,\n  onDelete,\n  onGetLabelNames,\n  onGetLabelValues,\n  invalidLabel,\n  invalidValue,\n}: Props) {\n  const [state, setState] = useState<{\n    labelNames?: SelectableValue[];\n    labelValues?: SelectableValue[];\n    isLoadingLabelNames?: boolean;\n    isLoadingLabelValues?: boolean;\n  }>({});\n  const CONFLICTING_LABEL_FILTER_ERROR_MESSAGE = 'You have conflicting label filters';\n\n  const isMultiSelect = (operator = item.op) => {\n    return operators.find((op) => op.label === operator)?.isMultiValue;\n  };\n\n  const getSelectOptionsFromString = (item?: string): string[] => {\n    if (item) {\n      if (item.indexOf('|') > 0) {\n        return item.split('|');\n      }\n      return [item];\n    }\n    return [];\n  };\n\n  const getOptions = (): SelectableValue[] => {\n    const labelValues = state.labelValues ? [...state.labelValues] : [];\n    const selectedOptions = getSelectOptionsFromString(item?.value).map(toOption);\n\n    // Remove possible duplicated values\n    return uniqBy([...selectedOptions, ...labelValues], 'value');\n  };\n\n  const isConflicting = isConflictingSelector(item, items);\n\n  return (\n    <div data-testid=\"prometheus-dimensions-filter-item\">\n      <InlineField error={CONFLICTING_LABEL_FILTER_ERROR_MESSAGE} invalid={isConflicting ? true : undefined}>\n        <InputGroup>\n          <Select\n            placeholder=\"Select label\"\n            aria-label={selectors.components.QueryBuilder.labelSelect}\n            inputId=\"prometheus-dimensions-filter-item-key\"\n            width=\"auto\"\n            value={item.label ? toOption(item.label) : null}\n            allowCustomValue\n            onOpenMenu={async () => {\n              setState({ isLoadingLabelNames: true });\n              const labelNames = await onGetLabelNames(item);\n              setState({ labelNames, isLoadingLabelNames: undefined });\n            }}\n            isLoading={state.isLoadingLabelNames}\n            options={state.labelNames}\n            onChange={(change) => {\n              if (change.label) {\n                onChange({\n                  ...item,\n                  op: item.op ?? defaultOp,\n                  label: change.label,\n                } as unknown as QueryBuilderLabelFilter);\n              }\n            }}\n            invalid={isConflicting || invalidLabel}\n          />\n\n          <Select\n            aria-label={selectors.components.QueryBuilder.matchOperatorSelect}\n            value={toOption(item.op ?? defaultOp)}\n            options={operators}\n            width=\"auto\"\n            onChange={(change) => {\n              if (change.value != null) {\n                onChange({\n                  ...item,\n                  op: change.value,\n                  value: isMultiSelect(change.value) ? item.value : getSelectOptionsFromString(item?.value)[0],\n                } as unknown as QueryBuilderLabelFilter);\n              }\n            }}\n            invalid={isConflicting}\n          />\n\n          <Select\n            placeholder=\"Select value\"\n            aria-label={selectors.components.QueryBuilder.valueSelect}\n            inputId=\"prometheus-dimensions-filter-item-value\"\n            width=\"auto\"\n            value={\n              isMultiSelect()\n                ? getSelectOptionsFromString(item?.value).map(toOption)\n                : getSelectOptionsFromString(item?.value).map(toOption)[0]\n            }\n            allowCustomValue\n            onOpenMenu={async () => {\n              setState({ isLoadingLabelValues: true });\n              const labelValues = await onGetLabelValues(item);\n              setState({\n                ...state,\n                labelValues,\n                isLoadingLabelValues: undefined,\n              });\n            }}\n            isMulti={isMultiSelect()}\n            isLoading={state.isLoadingLabelValues}\n            options={getOptions()}\n            onChange={(change) => {\n              if (change.value) {\n                onChange({\n                  ...item,\n                  value: change.value,\n                  op: item.op ?? defaultOp,\n                } as unknown as QueryBuilderLabelFilter);\n              } else {\n                const changes = change\n                  .map((change: any) => {\n                    return change.label;\n                  })\n                  .join('|');\n                onChange({ ...item, value: changes, op: item.op ?? defaultOp } as unknown as QueryBuilderLabelFilter);\n              }\n            }}\n            invalid={isConflicting || invalidValue}\n          />\n          <AccessoryButton aria-label=\"remove\" icon=\"times\" variant=\"secondary\" onClick={onDelete} />\n        </InputGroup>\n      </InlineField>\n    </div>\n  );\n}\n\nconst operators = [\n  lokiOperators.equals,\n  lokiOperators.doesNotEqual,\n  lokiOperators.matchesRegex,\n  lokiOperators.doesNotMatchRegex,\n];\n","import { isEqual } from 'lodash';\nimport React, { useEffect, useState } from 'react';\n\nimport { SelectableValue } from '@grafana/data';\nimport { EditorFieldGroup, EditorField, EditorList } from '@grafana/experimental';\n\nimport { QueryBuilderLabelFilter } from '../shared/types';\n\nimport { LabelFilterItem } from './LabelFilterItem';\n\nexport const MISSING_LABEL_FILTER_ERROR_MESSAGE = 'Select at least 1 label filter (label and value)';\n\nexport interface Props {\n  labelsFilters: QueryBuilderLabelFilter[];\n  onChange: (labelFilters: QueryBuilderLabelFilter[]) => void;\n  onGetLabelNames: (forLabel: Partial<QueryBuilderLabelFilter>) => Promise<SelectableValue[]>;\n  onGetLabelValues: (forLabel: Partial<QueryBuilderLabelFilter>) => Promise<SelectableValue[]>;\n  /** If set to true, component will show error message until at least 1 filter is selected */\n  labelFilterRequired?: boolean;\n}\n\nexport function LabelFilters({\n  labelsFilters,\n  onChange,\n  onGetLabelNames,\n  onGetLabelValues,\n  labelFilterRequired,\n}: Props) {\n  const defaultOp = '=';\n  const [items, setItems] = useState<Array<Partial<QueryBuilderLabelFilter>>>([{ op: defaultOp }]);\n\n  useEffect(() => {\n    if (labelsFilters.length > 0) {\n      setItems(labelsFilters);\n    } else {\n      setItems([{ op: defaultOp }]);\n    }\n  }, [labelsFilters]);\n\n  const onLabelsChange = (newItems: Array<Partial<QueryBuilderLabelFilter>>) => {\n    setItems(newItems);\n\n    // Extract full label filters with both label & value\n    const newLabels = newItems.filter((x) => x.label != null && x.value != null);\n    if (!isEqual(newLabels, labelsFilters)) {\n      onChange(newLabels as QueryBuilderLabelFilter[]);\n    }\n  };\n\n  const hasLabelFilter = items.some((item) => item.label && item.value);\n\n  return (\n    <EditorFieldGroup>\n      <EditorField\n        label=\"Label filters\"\n        error={MISSING_LABEL_FILTER_ERROR_MESSAGE}\n        invalid={labelFilterRequired && !hasLabelFilter}\n      >\n        <EditorList\n          items={items}\n          onChange={onLabelsChange}\n          renderItem={(item: Partial<QueryBuilderLabelFilter>, onChangeItem, onDelete) => (\n            <LabelFilterItem\n              item={item}\n              items={items}\n              defaultOp={defaultOp}\n              onChange={onChangeItem}\n              onDelete={onDelete}\n              onGetLabelNames={onGetLabelNames}\n              onGetLabelValues={onGetLabelValues}\n              invalidLabel={labelFilterRequired && !item.label}\n              invalidValue={labelFilterRequired && !item.value}\n            />\n          )}\n        />\n      </EditorField>\n    </EditorFieldGroup>\n  );\n}\n","import React from 'react';\n\nimport { Stack } from '@grafana/experimental';\nimport { OperationExplainedBox } from 'app/plugins/datasource/prometheus/querybuilder/shared/OperationExplainedBox';\nimport { OperationListExplained } from 'app/plugins/datasource/prometheus/querybuilder/shared/OperationListExplained';\nimport { RawQuery } from 'app/plugins/datasource/prometheus/querybuilder/shared/RawQuery';\n\nimport { lokiGrammar } from '../../syntax';\nimport { lokiQueryModeller } from '../LokiQueryModeller';\nimport { buildVisualQueryFromString } from '../parsing';\nimport { LokiVisualQuery } from '../types';\n\nexport const EXPLAIN_LABEL_FILTER_CONTENT = 'Fetch all log lines matching label filters.';\n\nexport interface Props {\n  query: string;\n}\n\nexport const LokiQueryBuilderExplained = React.memo<Props>(({ query }) => {\n  const visQuery = buildVisualQueryFromString(query || '').query;\n  const lang = { grammar: lokiGrammar, name: 'lokiql' };\n\n  return (\n    <Stack gap={0} direction=\"column\">\n      <OperationExplainedBox\n        stepNumber={1}\n        title={<RawQuery query={`${lokiQueryModeller.renderLabels(visQuery.labels)}`} lang={lang} />}\n      >\n        {EXPLAIN_LABEL_FILTER_CONTENT}\n      </OperationExplainedBox>\n      <OperationListExplained<LokiVisualQuery>\n        stepNumber={2}\n        queryModeller={lokiQueryModeller}\n        query={visQuery}\n        lang={lang}\n      />\n    </Stack>\n  );\n});\n\nLokiQueryBuilderExplained.displayName = 'LokiQueryBuilderExplained';\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { GrafanaTheme2, toOption } from '@grafana/data';\nimport { EditorRows, FlexItem } from '@grafana/experimental';\nimport { AutoSizeInput, IconButton, Select, useStyles2 } from '@grafana/ui';\n\nimport { LokiDatasource } from '../../datasource';\nimport { binaryScalarDefs } from '../binaryScalarOperations';\nimport { LokiVisualQueryBinary } from '../types';\n\nimport { LokiQueryBuilder } from './LokiQueryBuilder';\n\nexport interface Props {\n  nestedQuery: LokiVisualQueryBinary;\n  datasource: LokiDatasource;\n  index: number;\n  showExplain: boolean;\n  onChange: (index: number, update: LokiVisualQueryBinary) => void;\n  onRemove: (index: number) => void;\n  onRunQuery: () => void;\n}\n\nexport const NestedQuery = React.memo<Props>(\n  ({ nestedQuery, index, datasource, onChange, onRemove, onRunQuery, showExplain }) => {\n    const styles = useStyles2(getStyles);\n\n    return (\n      <div className={styles.card}>\n        <div className={styles.header}>\n          <div className={styles.name}>Operator</div>\n          <Select\n            aria-label=\"Select operator\"\n            width=\"auto\"\n            options={operators}\n            value={toOption(nestedQuery.operator)}\n            onChange={(value) => {\n              onChange(index, {\n                ...nestedQuery,\n                operator: value.value!,\n              });\n            }}\n          />\n          <div className={styles.name}>Vector matches</div>\n          <div className={styles.vectorMatchWrapper}>\n            <Select<LokiVisualQueryBinary['vectorMatchesType']>\n              width=\"auto\"\n              value={nestedQuery.vectorMatchesType || 'on'}\n              allowCustomValue\n              options={[\n                { value: 'on', label: 'on' },\n                { value: 'ignoring', label: 'ignoring' },\n              ]}\n              onChange={(val) => {\n                onChange(index, {\n                  ...nestedQuery,\n                  vectorMatchesType: val.value,\n                });\n              }}\n            />\n            <AutoSizeInput\n              className={styles.vectorMatchInput}\n              minWidth={20}\n              defaultValue={nestedQuery.vectorMatches}\n              onCommitChange={(evt) => {\n                onChange(index, {\n                  ...nestedQuery,\n                  vectorMatches: evt.currentTarget.value,\n                  vectorMatchesType: nestedQuery.vectorMatchesType || 'on',\n                });\n              }}\n            />\n          </div>\n          <FlexItem grow={1} />\n          <IconButton ariaLabel=\"Remove nested query\" name=\"times\" size=\"sm\" onClick={() => onRemove(index)} />\n        </div>\n        <div className={styles.body}>\n          <EditorRows>\n            <LokiQueryBuilder\n              showExplain={showExplain}\n              query={nestedQuery.query}\n              datasource={datasource}\n              onRunQuery={onRunQuery}\n              onChange={(update) => {\n                onChange(index, { ...nestedQuery, query: update });\n              }}\n            />\n          </EditorRows>\n        </div>\n      </div>\n    );\n  }\n);\n\nconst operators = binaryScalarDefs.map((def) => ({ label: def.sign, value: def.sign }));\n\nNestedQuery.displayName = 'NestedQuery';\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    card: css({\n      label: 'card',\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(0.5),\n    }),\n    header: css({\n      label: 'header',\n      padding: theme.spacing(0.5, 0.5, 0.5, 1),\n      gap: theme.spacing(1),\n      display: 'flex',\n      alignItems: 'center',\n    }),\n    name: css({\n      label: 'name',\n      whiteSpace: 'nowrap',\n    }),\n    body: css({\n      label: 'body',\n      paddingLeft: theme.spacing(2),\n    }),\n    vectorMatchInput: css({\n      label: 'vectorMatchInput',\n      marginLeft: -1,\n    }),\n    vectorMatchWrapper: css({\n      label: 'vectorMatchWrapper',\n      display: 'flex',\n    }),\n  };\n};\n","import React from 'react';\n\nimport { Stack } from '@grafana/experimental';\n\nimport { LokiDatasource } from '../../datasource';\nimport { LokiVisualQuery, LokiVisualQueryBinary } from '../types';\n\nimport { NestedQuery } from './NestedQuery';\n\nexport interface Props {\n  query: LokiVisualQuery;\n  datasource: LokiDatasource;\n  showExplain: boolean;\n  onChange: (query: LokiVisualQuery) => void;\n  onRunQuery: () => void;\n}\n\nexport function NestedQueryList({ query, datasource, onChange, onRunQuery, showExplain }: Props) {\n  const nestedQueries = query.binaryQueries ?? [];\n\n  const onNestedQueryUpdate = (index: number, update: LokiVisualQueryBinary) => {\n    const updatedList = [...nestedQueries];\n    updatedList.splice(index, 1, update);\n    onChange({ ...query, binaryQueries: updatedList });\n  };\n\n  const onRemove = (index: number) => {\n    const updatedList = [...nestedQueries.slice(0, index), ...nestedQueries.slice(index + 1)];\n    onChange({ ...query, binaryQueries: updatedList });\n  };\n\n  return (\n    <Stack direction=\"column\" gap={1}>\n      {nestedQueries.map((nestedQuery, index) => (\n        <NestedQuery\n          key={index.toString()}\n          nestedQuery={nestedQuery}\n          index={index}\n          onChange={onNestedQueryUpdate}\n          datasource={datasource}\n          onRemove={onRemove}\n          onRunQuery={onRunQuery}\n          showExplain={showExplain}\n        />\n      ))}\n    </Stack>\n  );\n}\n","import React, { useEffect, useMemo, useState } from 'react';\n\nimport { DataSourceApi, getDefaultTimeRange, LoadingState, PanelData, SelectableValue } from '@grafana/data';\nimport { EditorRow } from '@grafana/experimental';\nimport { LabelFilters } from 'app/plugins/datasource/prometheus/querybuilder/shared/LabelFilters';\nimport { OperationExplainedBox } from 'app/plugins/datasource/prometheus/querybuilder/shared/OperationExplainedBox';\nimport { OperationList } from 'app/plugins/datasource/prometheus/querybuilder/shared/OperationList';\nimport { OperationListExplained } from 'app/plugins/datasource/prometheus/querybuilder/shared/OperationListExplained';\nimport { OperationsEditorRow } from 'app/plugins/datasource/prometheus/querybuilder/shared/OperationsEditorRow';\nimport { QueryBuilderHints } from 'app/plugins/datasource/prometheus/querybuilder/shared/QueryBuilderHints';\nimport { RawQuery } from 'app/plugins/datasource/prometheus/querybuilder/shared/RawQuery';\nimport {\n  QueryBuilderLabelFilter,\n  QueryBuilderOperation,\n} from 'app/plugins/datasource/prometheus/querybuilder/shared/types';\n\nimport { testIds } from '../../components/LokiQueryEditor';\nimport { LokiDatasource } from '../../datasource';\nimport { escapeLabelValueInSelector } from '../../languageUtils';\nimport logqlGrammar from '../../syntax';\nimport { lokiQueryModeller } from '../LokiQueryModeller';\nimport { buildVisualQueryFromString } from '../parsing';\nimport { LokiOperationId, LokiVisualQuery } from '../types';\n\nimport { EXPLAIN_LABEL_FILTER_CONTENT } from './LokiQueryBuilderExplained';\nimport { NestedQueryList } from './NestedQueryList';\n\nexport interface Props {\n  query: LokiVisualQuery;\n  datasource: LokiDatasource;\n  showExplain: boolean;\n  onChange: (update: LokiVisualQuery) => void;\n  onRunQuery: () => void;\n}\nexport const LokiQueryBuilder = React.memo<Props>(({ datasource, query, onChange, onRunQuery, showExplain }) => {\n  const [sampleData, setSampleData] = useState<PanelData>();\n  const [highlightedOp, setHighlightedOp] = useState<QueryBuilderOperation | undefined>(undefined);\n\n  const onChangeLabels = (labels: QueryBuilderLabelFilter[]) => {\n    onChange({ ...query, labels });\n  };\n\n  const withTemplateVariableOptions = async (optionsPromise: Promise<string[]>): Promise<SelectableValue[]> => {\n    const options = await optionsPromise;\n    return [...datasource.getVariables(), ...options].map((value) => ({ label: value, value }));\n  };\n\n  const onGetLabelNames = async (forLabel: Partial<QueryBuilderLabelFilter>): Promise<string[]> => {\n    const labelsToConsider = query.labels.filter((x) => x !== forLabel);\n\n    if (labelsToConsider.length === 0) {\n      return await datasource.languageProvider.fetchLabels();\n    }\n\n    const expr = lokiQueryModeller.renderLabels(labelsToConsider);\n    const series = await datasource.languageProvider.fetchSeriesLabels(expr);\n    const labelsNamesToConsider = labelsToConsider.map((l) => l.label);\n\n    const labelNames = Object.keys(series)\n      // Filter out label names that are already selected\n      .filter((name) => !labelsNamesToConsider.includes(name))\n      .sort();\n\n    return labelNames;\n  };\n\n  const onGetLabelValues = async (forLabel: Partial<QueryBuilderLabelFilter>) => {\n    if (!forLabel.label) {\n      return [];\n    }\n\n    let values;\n    const labelsToConsider = query.labels.filter((x) => x !== forLabel);\n    if (labelsToConsider.length === 0) {\n      values = await datasource.languageProvider.fetchLabelValues(forLabel.label);\n    } else {\n      const expr = lokiQueryModeller.renderLabels(labelsToConsider);\n      const result = await datasource.languageProvider.fetchSeriesLabels(expr);\n      values = result[datasource.interpolateString(forLabel.label)];\n    }\n\n    return values ? values.map((v) => escapeLabelValueInSelector(v, forLabel.op)) : []; // Escape values in return\n  };\n\n  const labelFilterRequired: boolean = useMemo(() => {\n    const { labels, operations: op } = query;\n    if (!labels.length && op.length) {\n      // Filter is required when operations are present (empty line contains operation is exception)\n      if (op.length === 1 && op[0].id === LokiOperationId.LineContains && op[0].params[0] === '') {\n        return false;\n      }\n      return true;\n    }\n    return false;\n  }, [query]);\n\n  useEffect(() => {\n    const onGetSampleData = async () => {\n      const lokiQuery = { expr: lokiQueryModeller.renderQuery(query), refId: 'data-samples' };\n      const series = await datasource.getDataSamples(lokiQuery);\n      const sampleData = { series, state: LoadingState.Done, timeRange: getDefaultTimeRange() };\n      setSampleData(sampleData);\n    };\n\n    onGetSampleData().catch(console.error);\n  }, [datasource, query]);\n\n  const lang = { grammar: logqlGrammar, name: 'logql' };\n  return (\n    <div data-testid={testIds.editor}>\n      <EditorRow>\n        <LabelFilters\n          onGetLabelNames={(forLabel: Partial<QueryBuilderLabelFilter>) =>\n            withTemplateVariableOptions(onGetLabelNames(forLabel))\n          }\n          onGetLabelValues={(forLabel: Partial<QueryBuilderLabelFilter>) =>\n            withTemplateVariableOptions(onGetLabelValues(forLabel))\n          }\n          labelsFilters={query.labels}\n          onChange={onChangeLabels}\n          labelFilterRequired={labelFilterRequired}\n        />\n      </EditorRow>\n      {showExplain && (\n        <OperationExplainedBox\n          stepNumber={1}\n          title={<RawQuery query={`${lokiQueryModeller.renderLabels(query.labels)}`} lang={lang} />}\n        >\n          {EXPLAIN_LABEL_FILTER_CONTENT}\n        </OperationExplainedBox>\n      )}\n      <OperationsEditorRow>\n        <OperationList\n          queryModeller={lokiQueryModeller}\n          query={query}\n          onChange={onChange}\n          onRunQuery={onRunQuery}\n          datasource={datasource as DataSourceApi}\n          highlightedOp={highlightedOp}\n        />\n        <QueryBuilderHints<LokiVisualQuery>\n          datasource={datasource}\n          query={query}\n          onChange={onChange}\n          data={sampleData}\n          queryModeller={lokiQueryModeller}\n          buildVisualQueryFromString={buildVisualQueryFromString}\n        />\n      </OperationsEditorRow>\n      {showExplain && (\n        <OperationListExplained<LokiVisualQuery>\n          stepNumber={2}\n          queryModeller={lokiQueryModeller}\n          query={query}\n          lang={lang}\n          onMouseEnter={(op) => {\n            setHighlightedOp(op);\n          }}\n          onMouseLeave={() => {\n            setHighlightedOp(undefined);\n          }}\n        />\n      )}\n      {query.binaryQueries && query.binaryQueries.length > 0 && (\n        <NestedQueryList\n          query={query}\n          datasource={datasource}\n          onChange={onChange}\n          onRunQuery={onRunQuery}\n          showExplain={showExplain}\n        />\n      )}\n    </div>\n  );\n});\n\nLokiQueryBuilder.displayName = 'LokiQueryBuilder';\n","import React from 'react';\n\nimport { EditorRow, EditorFieldGroup } from '@grafana/experimental';\n\nimport { RawQuery } from '../../../prometheus/querybuilder/shared/RawQuery';\nimport { lokiGrammar } from '../../syntax';\n\nexport interface Props {\n  query: string;\n}\n\nexport function QueryPreview({ query }: Props) {\n  return (\n    <EditorRow>\n      <EditorFieldGroup>\n        <RawQuery query={query} lang={{ grammar: lokiGrammar, name: 'lokiql' }} />\n      </EditorFieldGroup>\n    </EditorRow>\n  );\n}\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport React, { useEffect, useReducer } from 'react';\n\nimport { testIds } from '../../components/LokiQueryEditor';\nimport { LokiDatasource } from '../../datasource';\nimport { LokiQuery } from '../../types';\nimport { lokiQueryModeller } from '../LokiQueryModeller';\nimport { buildVisualQueryFromString } from '../parsing';\nimport { LokiVisualQuery } from '../types';\n\nimport { LokiQueryBuilder } from './LokiQueryBuilder';\nimport { QueryPreview } from './QueryPreview';\n\nexport interface Props {\n  query: LokiQuery;\n  datasource: LokiDatasource;\n  onChange: (update: LokiQuery) => void;\n  onRunQuery: () => void;\n  showExplain: boolean;\n}\n\nexport interface State {\n  visQuery?: LokiVisualQuery;\n  expr: string;\n}\n\n/**\n * This component is here just to contain the translation logic between string query and the visual query builder model.\n */\nexport function LokiQueryBuilderContainer(props: Props) {\n  const { query, onChange, onRunQuery, datasource, showExplain } = props;\n  const [state, dispatch] = useReducer(stateSlice.reducer, {\n    expr: query.expr,\n    // Use initial visual query only if query.expr is empty string\n    visQuery:\n      query.expr === ''\n        ? {\n            labels: [],\n            operations: [{ id: '__line_contains', params: [''] }],\n          }\n        : undefined,\n  });\n\n  // Only rebuild visual query if expr changes from outside\n  useEffect(() => {\n    dispatch(exprChanged(query.expr));\n  }, [query.expr]);\n\n  const onVisQueryChange = (visQuery: LokiVisualQuery) => {\n    const expr = lokiQueryModeller.renderQuery(visQuery);\n    dispatch(visualQueryChange({ visQuery, expr }));\n    onChange({ ...props.query, expr: expr });\n  };\n\n  if (!state.visQuery) {\n    return null;\n  }\n\n  return (\n    <>\n      <LokiQueryBuilder\n        query={state.visQuery}\n        datasource={datasource}\n        onChange={onVisQueryChange}\n        onRunQuery={onRunQuery}\n        showExplain={showExplain}\n        data-testid={testIds.editor}\n      />\n      {query.expr !== '' && <QueryPreview query={query.expr} />}\n    </>\n  );\n}\n\nconst initialState: State = { expr: '' };\n\nconst stateSlice = createSlice({\n  name: 'loki-builder-container',\n  initialState,\n  reducers: {\n    visualQueryChange: (state, action: PayloadAction<{ visQuery: LokiVisualQuery; expr: string }>) => {\n      state.expr = action.payload.expr;\n      state.visQuery = action.payload.visQuery;\n    },\n    exprChanged: (state, action: PayloadAction<string>) => {\n      if (!state.visQuery || state.expr !== action.payload) {\n        state.expr = action.payload;\n        const parseResult = buildVisualQueryFromString(action.payload);\n        state.visQuery = parseResult.query;\n      }\n    },\n  },\n});\n\nconst { visualQueryChange, exprChanged } = stateSlice.actions;\n","import React, { useState } from 'react';\n\nimport { CoreApp, isValidDuration, SelectableValue } from '@grafana/data';\nimport { EditorField, EditorRow } from '@grafana/experimental';\nimport { config, reportInteraction } from '@grafana/runtime';\nimport { AutoSizeInput, RadioButtonGroup, Select } from '@grafana/ui';\nimport { QueryOptionGroup } from 'app/plugins/datasource/prometheus/querybuilder/shared/QueryOptionGroup';\n\nimport { preprocessMaxLines, queryTypeOptions, RESOLUTION_OPTIONS } from '../../components/LokiOptionFields';\nimport { LokiDatasource } from '../../datasource';\nimport { isLogsQuery } from '../../queryUtils';\nimport { LokiQuery, LokiQueryType, QueryStats } from '../../types';\n\nexport interface Props {\n  query: LokiQuery;\n  onChange: (update: LokiQuery) => void;\n  onRunQuery: () => void;\n  maxLines: number;\n  app?: CoreApp;\n  datasource: LokiDatasource;\n  queryStats: QueryStats | undefined;\n}\n\nexport const LokiQueryBuilderOptions = React.memo<Props>(\n  ({ app, query, onChange, onRunQuery, maxLines, datasource, queryStats }) => {\n    const [splitDurationValid, setsplitDurationValid] = useState(true);\n\n    const onQueryTypeChange = (value: LokiQueryType) => {\n      onChange({ ...query, queryType: value });\n      onRunQuery();\n    };\n\n    const onResolutionChange = (option: SelectableValue<number>) => {\n      reportInteraction('grafana_loki_resolution_clicked', {\n        app,\n        resolution: option.value,\n      });\n      onChange({ ...query, resolution: option.value });\n      onRunQuery();\n    };\n\n    const onChunkRangeChange = (evt: React.FormEvent<HTMLInputElement>) => {\n      const value = evt.currentTarget.value;\n      if (!isValidDuration(value)) {\n        setsplitDurationValid(false);\n        return;\n      }\n      setsplitDurationValid(true);\n      onChange({ ...query, splitDuration: value });\n      onRunQuery();\n    };\n\n    const onLegendFormatChanged = (evt: React.FormEvent<HTMLInputElement>) => {\n      onChange({ ...query, legendFormat: evt.currentTarget.value });\n      onRunQuery();\n    };\n\n    function onMaxLinesChange(e: React.SyntheticEvent<HTMLInputElement>) {\n      const newMaxLines = preprocessMaxLines(e.currentTarget.value);\n      if (query.maxLines !== newMaxLines) {\n        onChange({ ...query, maxLines: newMaxLines });\n        onRunQuery();\n      }\n    }\n\n    let queryType = query.queryType ?? (query.instant ? LokiQueryType.Instant : LokiQueryType.Range);\n    let showMaxLines = isLogsQuery(query.expr);\n\n    return (\n      <EditorRow>\n        <QueryOptionGroup\n          title=\"Options\"\n          collapsedInfo={getCollapsedInfo(query, queryType, showMaxLines, maxLines)}\n          queryStats={queryStats}\n        >\n          <EditorField\n            label=\"Legend\"\n            tooltip=\"Series name override or template. Ex. {{hostname}} will be replaced with label value for hostname.\"\n          >\n            <AutoSizeInput\n              placeholder=\"{{label}}\"\n              id=\"loki-query-editor-legend-format\"\n              type=\"string\"\n              minWidth={14}\n              defaultValue={query.legendFormat}\n              onCommitChange={onLegendFormatChanged}\n            />\n          </EditorField>\n          <EditorField label=\"Type\">\n            <RadioButtonGroup options={queryTypeOptions} value={queryType} onChange={onQueryTypeChange} />\n          </EditorField>\n          {showMaxLines && (\n            <EditorField label=\"Line limit\" tooltip=\"Upper limit for number of log lines returned by query.\">\n              <AutoSizeInput\n                className=\"width-4\"\n                placeholder={maxLines.toString()}\n                type=\"number\"\n                min={0}\n                defaultValue={query.maxLines?.toString() ?? ''}\n                onCommitChange={onMaxLinesChange}\n              />\n            </EditorField>\n          )}\n          <EditorField label=\"Resolution\">\n            <Select\n              isSearchable={false}\n              onChange={onResolutionChange}\n              options={RESOLUTION_OPTIONS}\n              value={query.resolution || 1}\n              aria-label=\"Select resolution\"\n            />\n          </EditorField>\n          {config.featureToggles.lokiQuerySplittingConfig && config.featureToggles.lokiQuerySplitting && (\n            <EditorField\n              label=\"Split Duration\"\n              tooltip=\"Defines the duration of a single query when query splitting is enabled.\"\n            >\n              <AutoSizeInput\n                minWidth={14}\n                type=\"string\"\n                min={0}\n                defaultValue={query.splitDuration ?? '1d'}\n                onCommitChange={onChunkRangeChange}\n                invalid={!splitDurationValid}\n              />\n            </EditorField>\n          )}\n        </QueryOptionGroup>\n      </EditorRow>\n    );\n  }\n);\n\nfunction getCollapsedInfo(\n  query: LokiQuery,\n  queryType: LokiQueryType,\n  showMaxLines: boolean,\n  maxLines: number\n): string[] {\n  const queryTypeLabel = queryTypeOptions.find((x) => x.value === queryType);\n  const resolutionLabel = RESOLUTION_OPTIONS.find((x) => x.value === (query.resolution ?? 1));\n\n  const items: string[] = [];\n\n  if (query.legendFormat) {\n    items.push(`Legend: ${query.legendFormat}`);\n  }\n\n  if (query.resolution) {\n    items.push(`Resolution: ${resolutionLabel?.label}`);\n  }\n\n  items.push(`Type: ${queryTypeLabel?.label}`);\n\n  if (showMaxLines) {\n    items.push(`Line limit: ${query.maxLines ?? maxLines}`);\n  }\n\n  return items;\n}\n\nLokiQueryBuilderOptions.displayName = 'LokiQueryBuilderOptions';\n","import { DateTime, isDateTime, TimeRange } from '@grafana/data';\n\nimport { LokiDatasource } from '../datasource';\nimport { QueryStats } from '../types';\n\nexport async function getStats(datasource: LokiDatasource, query: string): Promise<QueryStats | undefined> {\n  if (!query) {\n    return undefined;\n  }\n\n  const response = await datasource.getQueryStats(query);\n  return Object.values(response).every((v) => v === 0) ? undefined : response;\n}\n\n/**\n * This function compares two time values. If the first is absolute, it compares them using `DateTime.isSame`.\n *\n * @param {(DateTime | string)} time1\n * @param {(DateTime | string | undefined)} time2\n */\nfunction compareTime(time1: DateTime | string, time2: DateTime | string | undefined) {\n  const isAbsolute = isDateTime(time1);\n\n  if (isAbsolute) {\n    return time1.isSame(time2);\n  }\n\n  return time1 === time2;\n}\n\nexport function shouldUpdateStats(\n  query: string,\n  prevQuery: string | undefined,\n  timerange: TimeRange,\n  prevTimerange: TimeRange | undefined\n): boolean {\n  if (query !== prevQuery) {\n    return true;\n  }\n\n  if (\n    compareTime(timerange.raw.from, prevTimerange?.raw.from) &&\n    compareTime(timerange.raw.to, prevTimerange?.raw.to)\n  ) {\n    return false;\n  }\n\n  return true;\n}\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\n\nimport { testIds } from '../../components/LokiQueryEditor';\nimport { LokiQueryField } from '../../components/LokiQueryField';\nimport { getStats } from '../../components/stats';\nimport { LokiQueryEditorProps } from '../../components/types';\nimport { QueryStats } from '../../types';\n\nimport { LokiQueryBuilderExplained } from './LokiQueryBuilderExplained';\n\ntype Props = LokiQueryEditorProps & {\n  showExplain: boolean;\n  setQueryStats: React.Dispatch<React.SetStateAction<QueryStats | undefined>>;\n};\n\nexport function LokiQueryCodeEditor({\n  query,\n  datasource,\n  range,\n  onRunQuery,\n  onChange,\n  data,\n  app,\n  showExplain,\n  history,\n  setQueryStats,\n}: Props) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.wrapper}>\n      <LokiQueryField\n        datasource={datasource}\n        query={query}\n        range={range}\n        onRunQuery={onRunQuery}\n        onChange={onChange}\n        history={history}\n        data={data}\n        app={app}\n        data-testid={testIds.editor}\n        onQueryType={async (query: string) => {\n          const stats = await getStats(datasource, query);\n          setQueryStats(stats);\n        }}\n      />\n      {showExplain && <LokiQueryBuilderExplained query={query.expr} />}\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    wrapper: css`\n      max-width: 100%;\n      .gf-form {\n        margin-bottom: 0.5;\n      }\n    `,\n  };\n};\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, Card, useStyles2 } from '@grafana/ui';\nimport { RawQuery } from 'app/plugins/datasource/prometheus/querybuilder/shared/RawQuery';\n\nimport logqlGrammar from '../../syntax';\nimport { lokiQueryModeller } from '../LokiQueryModeller';\nimport { LokiQueryPattern } from '../types';\n\ntype Props = {\n  pattern: LokiQueryPattern;\n  hasNewQueryOption: boolean;\n  hasPreviousQuery: boolean;\n  selectedPatternName: string | null;\n  setSelectedPatternName: (name: string | null) => void;\n  onPatternSelect: (pattern: LokiQueryPattern, selectAsNewQuery?: boolean) => void;\n};\n\nexport const QueryPattern = (props: Props) => {\n  const { pattern, onPatternSelect, hasNewQueryOption, hasPreviousQuery, selectedPatternName, setSelectedPatternName } =\n    props;\n\n  const styles = useStyles2(getStyles);\n  const lang = { grammar: logqlGrammar, name: 'logql' };\n\n  return (\n    <Card className={styles.card}>\n      <Card.Heading>{pattern.name}</Card.Heading>\n      <div className={styles.rawQueryContainer}>\n        <RawQuery\n          query={lokiQueryModeller.renderQuery({ labels: [], operations: pattern.operations })}\n          lang={lang}\n          className={styles.rawQuery}\n        />\n      </div>\n      <Card.Actions>\n        {selectedPatternName !== pattern.name ? (\n          <Button\n            size=\"sm\"\n            onClick={() => {\n              if (hasPreviousQuery) {\n                // If user has previous query, we need to confirm that they want to replace it\n                setSelectedPatternName(pattern.name);\n              } else {\n                onPatternSelect(pattern);\n              }\n            }}\n          >\n            Use this query\n          </Button>\n        ) : (\n          <>\n            <div className={styles.spacing}>\n              {`If you would like to use this query, ${\n                hasNewQueryOption\n                  ? 'you can either replace your current query or create a new query'\n                  : 'your current query will be replaced'\n              }.`}\n            </div>\n            <Button size=\"sm\" fill=\"outline\" onClick={() => setSelectedPatternName(null)}>\n              Back\n            </Button>\n            <Button\n              size=\"sm\"\n              onClick={() => {\n                onPatternSelect(pattern);\n              }}\n            >\n              Replace query\n            </Button>\n            {hasNewQueryOption && (\n              <Button\n                size=\"sm\"\n                onClick={() => {\n                  onPatternSelect(pattern, true);\n                }}\n              >\n                Create new query\n              </Button>\n            )}\n          </>\n        )}\n      </Card.Actions>\n    </Card>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    card: css`\n      width: 49.5%;\n      display: flex;\n      flex-direction: column;\n    `,\n    rawQueryContainer: css`\n      flex-grow: 1;\n    `,\n    rawQuery: css`\n      background-color: ${theme.colors.background.primary};\n      padding: ${theme.spacing(1)};\n      margin-top: ${theme.spacing(1)};\n    `,\n    spacing: css`\n      margin-bottom: ${theme.spacing(1)};\n    `,\n  };\n};\n","import { css } from '@emotion/css';\nimport { capitalize } from 'lodash';\nimport React, { useMemo, useState } from 'react';\n\nimport { CoreApp, DataQuery, GrafanaTheme2 } from '@grafana/data';\nimport { reportInteraction } from '@grafana/runtime';\nimport { Button, Collapse, Modal, useStyles2 } from '@grafana/ui';\nimport { getNextRefIdChar } from 'app/core/utils/query';\n\nimport { LokiQuery } from '../../types';\nimport { lokiQueryModeller } from '../LokiQueryModeller';\nimport { buildVisualQueryFromString } from '../parsing';\nimport { LokiQueryPattern, LokiQueryPatternType } from '../types';\n\nimport { QueryPattern } from './QueryPattern';\n\ntype Props = {\n  isOpen: boolean;\n  query: LokiQuery;\n  queries: DataQuery[] | undefined;\n  app?: CoreApp;\n  onClose: () => void;\n  onChange: (query: LokiQuery) => void;\n  onAddQuery?: (query: LokiQuery) => void;\n};\n\nexport const QueryPatternsModal = (props: Props) => {\n  const { isOpen, onClose, onChange, onAddQuery, query, queries, app } = props;\n  const [openTabs, setOpenTabs] = useState<string[]>([]);\n  const [selectedPatternName, setSelectedPatternName] = useState<string | null>(null);\n\n  const styles = useStyles2(getStyles);\n  const hasNewQueryOption = !!onAddQuery;\n  const hasPreviousQuery = useMemo(\n    () => buildVisualQueryFromString(query.expr).query.operations.length > 0,\n    [query.expr]\n  );\n\n  const onPatternSelect = (pattern: LokiQueryPattern, selectAsNewQuery = false) => {\n    const visualQuery = buildVisualQueryFromString(selectAsNewQuery ? '' : query.expr);\n    reportInteraction('grafana_loki_query_patterns_selected', {\n      version: 'v2',\n      app: app ?? '',\n      editorMode: query.editorMode,\n      selectedPattern: pattern.name,\n      preSelectedOperationsCount: visualQuery.query.operations.length,\n      preSelectedLabelsCount: visualQuery.query.labels.length,\n      createNewQuery: hasNewQueryOption && selectAsNewQuery,\n    });\n\n    visualQuery.query.operations = pattern.operations;\n    if (hasNewQueryOption && selectAsNewQuery) {\n      onAddQuery({\n        ...query,\n        refId: getNextRefIdChar(queries ?? [query]),\n        expr: lokiQueryModeller.renderQuery(visualQuery.query),\n      });\n    } else {\n      onChange({\n        ...query,\n        expr: lokiQueryModeller.renderQuery(visualQuery.query),\n      });\n    }\n    setSelectedPatternName(null);\n    onClose();\n  };\n\n  return (\n    <Modal isOpen={isOpen} title=\"Kick start your query\" onDismiss={onClose} className={styles.modal}>\n      <div className={styles.spacing}>\n        Kick start your query by selecting one of these queries. You can then continue to complete your query.\n      </div>\n      {Object.values(LokiQueryPatternType).map((patternType) => {\n        return (\n          <Collapse\n            key={patternType}\n            label={`${capitalize(patternType)} query starters`}\n            isOpen={openTabs.includes(patternType)}\n            collapsible={true}\n            onToggle={() =>\n              setOpenTabs((tabs) =>\n                // close tab if it's already open, otherwise open it\n                tabs.includes(patternType) ? tabs.filter((t) => t !== patternType) : [...tabs, patternType]\n              )\n            }\n          >\n            <div className={styles.cardsContainer}>\n              {lokiQueryModeller\n                .getQueryPatterns()\n                .filter((pattern) => pattern.type === patternType)\n                .map((pattern) => (\n                  <QueryPattern\n                    key={pattern.name}\n                    pattern={pattern}\n                    hasNewQueryOption={hasNewQueryOption}\n                    hasPreviousQuery={hasPreviousQuery}\n                    onPatternSelect={onPatternSelect}\n                    selectedPatternName={selectedPatternName}\n                    setSelectedPatternName={setSelectedPatternName}\n                  />\n                ))}\n            </div>\n          </Collapse>\n        );\n      })}\n      <Button variant=\"secondary\" onClick={onClose}>\n        Close\n      </Button>\n    </Modal>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    cardsContainer: css`\n      display: flex;\n      flex-direction: row;\n      flex-wrap: wrap;\n      justify-content: space-between;\n    `,\n    spacing: css`\n      margin-bottom: ${theme.spacing(1)};\n    `,\n    modal: css`\n      width: 85vw;\n      ${theme.breakpoints.down('md')} {\n        width: 100%;\n      }\n    `,\n  };\n};\n","import store from 'app/core/store';\n\nimport { QueryEditorMode } from '../../prometheus/querybuilder/shared/types';\nimport { LokiQuery, LokiQueryType } from '../types';\n\nconst queryEditorModeDefaultLocalStorageKey = 'LokiQueryEditorModeDefault';\n\nexport function changeEditorMode(query: LokiQuery, editorMode: QueryEditorMode, onChange: (query: LokiQuery) => void) {\n  // If empty query store new mode as default\n  if (query.expr === '') {\n    store.set(queryEditorModeDefaultLocalStorageKey, editorMode);\n  }\n\n  onChange({ ...query, editorMode });\n}\n\nexport function getDefaultEditorMode(expr: string) {\n  // If we already have an expression default to code view\n  if (expr != null && expr !== '') {\n    return QueryEditorMode.Code;\n  }\n\n  const value: string | undefined = store.get(queryEditorModeDefaultLocalStorageKey);\n  switch (value) {\n    case 'code':\n      return QueryEditorMode.Code;\n\n    case 'builder':\n    default:\n      return QueryEditorMode.Builder;\n  }\n}\n\n/**\n * Returns query with defaults, and boolean true/false depending on change was required\n */\nexport function getQueryWithDefaults(query: LokiQuery): LokiQuery {\n  // If no expr (ie new query) then default to builder\n  let result = query;\n\n  if (!query.editorMode) {\n    result = { ...query, editorMode: getDefaultEditorMode(query.expr) };\n  }\n\n  if (query.expr == null) {\n    result = { ...result, expr: '' };\n  }\n\n  if (query.queryType == null) {\n    // Default to range query\n    result = { ...result, queryType: LokiQueryType.Range };\n  }\n\n  return result;\n}\n","import { isEqual } from 'lodash';\nimport React, { SyntheticEvent, useCallback, useEffect, useState } from 'react';\nimport { usePrevious } from 'react-use';\n\nimport { CoreApp, LoadingState } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { EditorHeader, EditorRows, FlexItem, Space, Stack } from '@grafana/experimental';\nimport { reportInteraction } from '@grafana/runtime';\nimport { Button, ConfirmModal } from '@grafana/ui';\nimport { QueryEditorModeToggle } from 'app/plugins/datasource/prometheus/querybuilder/shared/QueryEditorModeToggle';\nimport { QueryHeaderSwitch } from 'app/plugins/datasource/prometheus/querybuilder/shared/QueryHeaderSwitch';\nimport { QueryEditorMode } from 'app/plugins/datasource/prometheus/querybuilder/shared/types';\n\nimport { lokiQueryEditorExplainKey, useFlag } from '../../prometheus/querybuilder/shared/hooks/useFlag';\nimport { LabelBrowserModal } from '../querybuilder/components/LabelBrowserModal';\nimport { LokiQueryBuilderContainer } from '../querybuilder/components/LokiQueryBuilderContainer';\nimport { LokiQueryBuilderOptions } from '../querybuilder/components/LokiQueryBuilderOptions';\nimport { LokiQueryCodeEditor } from '../querybuilder/components/LokiQueryCodeEditor';\nimport { QueryPatternsModal } from '../querybuilder/components/QueryPatternsModal';\nimport { buildVisualQueryFromString } from '../querybuilder/parsing';\nimport { changeEditorMode, getQueryWithDefaults } from '../querybuilder/state';\nimport { LokiQuery, QueryStats } from '../types';\n\nimport { getStats, shouldUpdateStats } from './stats';\nimport { LokiQueryEditorProps } from './types';\n\nexport const testIds = {\n  editor: 'loki-editor',\n};\n\nexport const LokiQueryEditor = React.memo<LokiQueryEditorProps>((props) => {\n  const { onChange, onRunQuery, onAddQuery, data, app, queries, datasource } = props;\n  const [parseModalOpen, setParseModalOpen] = useState(false);\n  const [queryPatternsModalOpen, setQueryPatternsModalOpen] = useState(false);\n  const [dataIsStale, setDataIsStale] = useState(false);\n  const [labelBrowserVisible, setLabelBrowserVisible] = useState(false);\n  const [queryStats, setQueryStats] = useState<QueryStats>();\n  const { flag: explain, setFlag: setExplain } = useFlag(lokiQueryEditorExplainKey);\n\n  const timerange = datasource.getTimeRange();\n  const previousTimerange = usePrevious(timerange);\n\n  const query = getQueryWithDefaults(props.query);\n  const previousQuery = usePrevious(query.expr);\n\n  // This should be filled in from the defaults by now.\n  const editorMode = query.editorMode!;\n\n  const onExplainChange = (event: SyntheticEvent<HTMLInputElement>) => {\n    setExplain(event.currentTarget.checked);\n  };\n\n  const onEditorModeChange = useCallback(\n    (newEditorMode: QueryEditorMode) => {\n      reportInteraction('grafana_loki_editor_mode_clicked', {\n        newEditor: newEditorMode,\n        previousEditor: query.editorMode ?? '',\n        newQuery: !query.expr,\n        app: app ?? '',\n      });\n\n      if (newEditorMode === QueryEditorMode.Builder) {\n        const result = buildVisualQueryFromString(query.expr || '');\n        // If there are errors, give user a chance to decide if they want to go to builder as that can lose some data.\n        if (result.errors.length) {\n          setParseModalOpen(true);\n          return;\n        }\n      }\n      changeEditorMode(query, newEditorMode, onChange);\n    },\n    [onChange, query, app]\n  );\n\n  useEffect(() => {\n    setDataIsStale(false);\n  }, [data]);\n\n  const onChangeInternal = (query: LokiQuery) => {\n    if (!isEqual(query, props.query)) {\n      setDataIsStale(true);\n    }\n    onChange(query);\n  };\n\n  const onClickLabelBrowserButton = () => {\n    reportInteraction('grafana_loki_label_browser_opened', {\n      app: app,\n    });\n\n    setLabelBrowserVisible((visible) => !visible);\n  };\n\n  useEffect(() => {\n    const update = shouldUpdateStats(query.expr, previousQuery, timerange, previousTimerange);\n    if (update) {\n      const makeAsyncRequest = async () => {\n        const stats = await getStats(datasource, query.expr);\n        setQueryStats(stats);\n      };\n      makeAsyncRequest();\n    }\n  }, [datasource, timerange, previousTimerange, query, previousQuery, setQueryStats]);\n\n  return (\n    <>\n      <ConfirmModal\n        isOpen={parseModalOpen}\n        title=\"Query parsing\"\n        body=\"There were errors while trying to parse the query. Continuing to visual builder may lose some parts of the query.\"\n        confirmText=\"Continue\"\n        onConfirm={() => {\n          onChange({ ...query, editorMode: QueryEditorMode.Builder });\n          setParseModalOpen(false);\n        }}\n        onDismiss={() => setParseModalOpen(false)}\n      />\n      <QueryPatternsModal\n        isOpen={queryPatternsModalOpen}\n        onClose={() => setQueryPatternsModalOpen(false)}\n        query={query}\n        queries={queries}\n        app={app}\n        onChange={onChange}\n        onAddQuery={onAddQuery}\n      />\n      <LabelBrowserModal\n        isOpen={labelBrowserVisible}\n        datasource={datasource}\n        query={query}\n        app={app}\n        onClose={() => setLabelBrowserVisible(false)}\n        onChange={onChangeInternal}\n        onRunQuery={onRunQuery}\n      />\n      <EditorHeader>\n        <Stack gap={1}>\n          <Button\n            aria-label={selectors.components.QueryBuilder.queryPatterns}\n            variant=\"secondary\"\n            size=\"sm\"\n            onClick={() => {\n              setQueryPatternsModalOpen((prevValue) => !prevValue);\n\n              const visualQuery = buildVisualQueryFromString(query.expr || '');\n              reportInteraction('grafana_loki_query_patterns_opened', {\n                version: 'v2',\n                app: app ?? '',\n                editorMode: query.editorMode,\n                preSelectedOperationsCount: visualQuery.query.operations.length,\n                preSelectedLabelsCount: visualQuery.query.labels.length,\n              });\n            }}\n          >\n            Kick start your query\n          </Button>\n          <Button variant=\"secondary\" size=\"sm\" onClick={onClickLabelBrowserButton} data-testid=\"label-browser-button\">\n            Label browser\n          </Button>\n        </Stack>\n        <QueryHeaderSwitch label=\"Explain query\" value={explain} onChange={onExplainChange} />\n        <FlexItem grow={1} />\n        {app !== CoreApp.Explore && app !== CoreApp.Correlations && (\n          <Button\n            variant={dataIsStale ? 'primary' : 'secondary'}\n            size=\"sm\"\n            onClick={onRunQuery}\n            icon={data?.state === LoadingState.Loading ? 'fa fa-spinner' : undefined}\n            disabled={data?.state === LoadingState.Loading}\n          >\n            Run queries\n          </Button>\n        )}\n        <QueryEditorModeToggle mode={editorMode!} onChange={onEditorModeChange} />\n      </EditorHeader>\n      <Space v={0.5} />\n      <EditorRows>\n        {editorMode === QueryEditorMode.Code && (\n          <LokiQueryCodeEditor\n            {...props}\n            query={query}\n            onChange={onChangeInternal}\n            showExplain={explain}\n            setQueryStats={setQueryStats}\n          />\n        )}\n        {editorMode === QueryEditorMode.Builder && (\n          <LokiQueryBuilderContainer\n            datasource={props.datasource}\n            query={query}\n            onChange={onChangeInternal}\n            onRunQuery={props.onRunQuery}\n            showExplain={explain}\n          />\n        )}\n        <LokiQueryBuilderOptions\n          query={query}\n          onChange={onChange}\n          onRunQuery={onRunQuery}\n          app={app}\n          maxLines={datasource.maxLines}\n          datasource={datasource}\n          queryStats={queryStats}\n        />\n      </EditorRows>\n    </>\n  );\n});\n\nLokiQueryEditor.displayName = 'LokiQueryEditor';\n","import React from 'react';\n\nimport { LokiQueryField } from './LokiQueryField';\nimport { LokiQueryEditorProps } from './types';\n\nexport function LokiQueryEditorForAlerting(props: LokiQueryEditorProps) {\n  const { query, data, datasource, onChange, onRunQuery, history } = props;\n\n  return (\n    <LokiQueryField\n      datasource={datasource}\n      query={query}\n      onChange={onChange}\n      onRunQuery={onRunQuery}\n      history={history}\n      data={data}\n      placeholder=\"Enter a Loki query\"\n      data-testid={testIds.editor}\n    />\n  );\n}\n\nexport const testIds = {\n  editor: 'loki-editor-cloud-alerting',\n};\n","import React, { memo } from 'react';\n\nimport { CoreApp } from '@grafana/data';\n\nimport { LokiQueryEditor } from './LokiQueryEditor';\nimport { LokiQueryEditorForAlerting } from './LokiQueryEditorForAlerting';\nimport { LokiQueryEditorProps } from './types';\n\nexport function LokiQueryEditorByApp(props: LokiQueryEditorProps) {\n  const { app } = props;\n\n  switch (app) {\n    case CoreApp.CloudAlerting:\n      return <LokiQueryEditorForAlerting {...props} />;\n    default:\n      return <LokiQueryEditor {...props} />;\n  }\n}\n\nexport default memo(LokiQueryEditorByApp);\n\nexport const testIds = {\n  editor: 'loki-editor',\n};\n","import { css } from '@emotion/css';\nimport cx from 'classnames';\nimport React, { ReactNode, useState } from 'react';\n\nimport { ArrayVector, Field, FieldType, LinkModel } from '@grafana/data';\nimport { LegacyForms } from '@grafana/ui';\n\nimport { getFieldLinksForExplore } from '../../../../features/explore/utils/links';\nimport { DerivedFieldConfig } from '../types';\n\nconst { FormField } = LegacyForms;\n\ntype Props = {\n  derivedFields?: DerivedFieldConfig[];\n  className?: string;\n};\nexport const DebugSection = (props: Props) => {\n  const { derivedFields, className } = props;\n  const [debugText, setDebugText] = useState('');\n\n  let debugFields: DebugField[] = [];\n  if (debugText && derivedFields) {\n    debugFields = makeDebugFields(derivedFields, debugText);\n  }\n\n  return (\n    <div className={className}>\n      <FormField\n        labelWidth={12}\n        label={'Debug log message'}\n        inputEl={\n          <textarea\n            placeholder={'Paste an example log line here to test the regular expressions of your derived fields'}\n            className={cx(\n              'gf-form-input gf-form-textarea',\n              css`\n                width: 100%;\n              `\n            )}\n            value={debugText}\n            onChange={(event) => setDebugText(event.currentTarget.value)}\n          />\n        }\n      />\n      {!!debugFields.length && <DebugFields fields={debugFields} />}\n    </div>\n  );\n};\n\ntype DebugFieldItemProps = {\n  fields: DebugField[];\n};\nconst DebugFields = ({ fields }: DebugFieldItemProps) => {\n  return (\n    <table className={'filter-table'}>\n      <thead>\n        <tr>\n          <th>Name</th>\n          <th>Value</th>\n          <th>Url</th>\n        </tr>\n      </thead>\n      <tbody>\n        {fields.map((field) => {\n          let value: ReactNode = field.value;\n          if (field.error && field.error instanceof Error) {\n            value = field.error.message;\n          } else if (field.href) {\n            value = <a href={field.href}>{value}</a>;\n          }\n          return (\n            <tr key={`${field.name}=${field.value}`}>\n              <td>{field.name}</td>\n              <td>{value}</td>\n              <td>{field.href ? <a href={field.href}>{field.href}</a> : ''}</td>\n            </tr>\n          );\n        })}\n      </tbody>\n    </table>\n  );\n};\n\ntype DebugField = {\n  name: string;\n  error?: unknown;\n  value?: string;\n  href?: string;\n};\n\nfunction makeDebugFields(derivedFields: DerivedFieldConfig[], debugText: string): DebugField[] {\n  return derivedFields\n    .filter((field) => field.name && field.matcherRegex)\n    .map((field) => {\n      try {\n        const testMatch = debugText.match(field.matcherRegex);\n        const value = testMatch && testMatch[1];\n        let link: LinkModel<Field> | null = null;\n\n        if (field.url && value) {\n          link = getFieldLinksForExplore({\n            field: {\n              name: '',\n              type: FieldType.string,\n              values: new ArrayVector([value]),\n              config: {\n                links: [{ title: '', url: field.url }],\n              },\n            },\n            rowIndex: 0,\n            range: {} as any,\n          })[0];\n        }\n\n        const result: DebugField = {\n          name: field.name,\n          value: value || '<no match>',\n          href: link ? link.href : undefined,\n        };\n        return result;\n      } catch (error) {\n        const result: DebugField = {\n          name: field.name,\n          error,\n        };\n        return result;\n      }\n    });\n}\n","import { css } from '@emotion/css';\nimport React, { useEffect, useState } from 'react';\nimport { usePrevious } from 'react-use';\n\nimport { GrafanaTheme2, VariableSuggestion } from '@grafana/data';\nimport { DataSourcePicker } from '@grafana/runtime';\nimport { Button, DataLinkInput, LegacyForms, useStyles2 } from '@grafana/ui';\n\nimport { DerivedFieldConfig } from '../types';\n\nconst { Switch, FormField } = LegacyForms;\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  row: css`\n    display: flex;\n    align-items: baseline;\n  `,\n  nameField: css`\n    flex: 2;\n  `,\n  regexField: css`\n    flex: 3;\n  `,\n  urlField: css`\n    flex: 1;\n    margin-right: ${theme.spacing(0.5)};\n  `,\n  urlDisplayLabelField: css`\n    flex: 1;\n  `,\n});\n\ntype Props = {\n  value: DerivedFieldConfig;\n  onChange: (value: DerivedFieldConfig) => void;\n  onDelete: () => void;\n  suggestions: VariableSuggestion[];\n  className?: string;\n};\nexport const DerivedField = (props: Props) => {\n  const { value, onChange, onDelete, suggestions, className } = props;\n  const styles = useStyles2(getStyles);\n  const [showInternalLink, setShowInternalLink] = useState(!!value.datasourceUid);\n  const previousUid = usePrevious(value.datasourceUid);\n\n  // Force internal link visibility change if uid changed outside of this component.\n  useEffect(() => {\n    if (!previousUid && value.datasourceUid && !showInternalLink) {\n      setShowInternalLink(true);\n    }\n    if (previousUid && !value.datasourceUid && showInternalLink) {\n      setShowInternalLink(false);\n    }\n  }, [previousUid, value.datasourceUid, showInternalLink]);\n\n  const handleChange = (field: keyof typeof value) => (event: React.ChangeEvent<HTMLInputElement>) => {\n    onChange({\n      ...value,\n      [field]: event.currentTarget.value,\n    });\n  };\n\n  return (\n    <div className={className} data-testid=\"derived-field\">\n      <div className=\"gf-form\">\n        <FormField\n          labelWidth={10}\n          className={styles.nameField}\n          // A bit of a hack to prevent using default value for the width from FormField\n          inputWidth={null}\n          label=\"Name\"\n          type=\"text\"\n          value={value.name}\n          onChange={handleChange('name')}\n        />\n        <FormField\n          labelWidth={10}\n          className={styles.regexField}\n          inputWidth={null}\n          label=\"Regex\"\n          type=\"text\"\n          value={value.matcherRegex}\n          onChange={handleChange('matcherRegex')}\n          tooltip={\n            'Use to parse and capture some part of the log message. You can use the captured groups in the template.'\n          }\n        />\n        <Button\n          variant=\"destructive\"\n          title=\"Remove field\"\n          icon=\"times\"\n          onClick={(event) => {\n            event.preventDefault();\n            onDelete();\n          }}\n        />\n      </div>\n\n      <div className=\"gf-form\">\n        <FormField\n          labelWidth={10}\n          label={showInternalLink ? 'Query' : 'URL'}\n          inputEl={\n            <DataLinkInput\n              placeholder={showInternalLink ? '${__value.raw}' : 'http://example.com/${__value.raw}'}\n              value={value.url || ''}\n              onChange={(newValue) =>\n                onChange({\n                  ...value,\n                  url: newValue,\n                })\n              }\n              suggestions={suggestions}\n            />\n          }\n          className={styles.urlField}\n        />\n        <FormField\n          className={styles.urlDisplayLabelField}\n          labelWidth={10}\n          inputWidth={null}\n          label=\"URL Label\"\n          type=\"text\"\n          value={value.urlDisplayLabel}\n          onChange={handleChange('urlDisplayLabel')}\n          tooltip={'Use to override the button label when this derived field is found in a log.'}\n        />\n      </div>\n\n      <div className={styles.row}>\n        <Switch\n          label=\"Internal link\"\n          checked={showInternalLink}\n          onChange={() => {\n            if (showInternalLink) {\n              onChange({\n                ...value,\n                datasourceUid: undefined,\n              });\n            }\n            setShowInternalLink(!showInternalLink);\n          }}\n        />\n\n        {showInternalLink && (\n          <DataSourcePicker\n            tracing={true}\n            onChange={(ds) =>\n              onChange({\n                ...value,\n                datasourceUid: ds.uid,\n              })\n            }\n            current={value.datasourceUid}\n          />\n        )}\n      </div>\n    </div>\n  );\n};\n","import { css } from '@emotion/css';\nimport React, { useState } from 'react';\n\nimport { GrafanaTheme2, VariableOrigin, DataLinkBuiltInVars } from '@grafana/data';\nimport { Button, useTheme2 } from '@grafana/ui';\n\nimport { DerivedFieldConfig } from '../types';\n\nimport { DebugSection } from './DebugSection';\nimport { DerivedField } from './DerivedField';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  infoText: css`\n    padding-bottom: ${theme.spacing(2)};\n    color: ${theme.colors.text.secondary};\n  `,\n  derivedField: css`\n    margin-bottom: ${theme.spacing(1)};\n  `,\n});\n\ntype Props = {\n  value?: DerivedFieldConfig[];\n  onChange: (value: DerivedFieldConfig[]) => void;\n};\n\nexport const DerivedFields = ({ value = [], onChange }: Props) => {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n\n  const [showDebug, setShowDebug] = useState(false);\n\n  return (\n    <>\n      <h3 className=\"page-heading\">Derived fields</h3>\n\n      <div className={styles.infoText}>\n        Derived fields can be used to extract new fields from a log message and create a link from its value.\n      </div>\n\n      <div className=\"gf-form-group\">\n        {value.map((field, index) => {\n          return (\n            <DerivedField\n              className={styles.derivedField}\n              key={index}\n              value={field}\n              onChange={(newField) => {\n                const newDerivedFields = [...value];\n                newDerivedFields.splice(index, 1, newField);\n                onChange(newDerivedFields);\n              }}\n              onDelete={() => {\n                const newDerivedFields = [...value];\n                newDerivedFields.splice(index, 1);\n                onChange(newDerivedFields);\n              }}\n              suggestions={[\n                {\n                  value: DataLinkBuiltInVars.valueRaw,\n                  label: 'Raw value',\n                  documentation: 'Exact string captured by the regular expression',\n                  origin: VariableOrigin.Value,\n                },\n              ]}\n            />\n          );\n        })}\n        <div>\n          <Button\n            variant=\"secondary\"\n            className={css`\n              margin-right: 10px;\n            `}\n            icon=\"plus\"\n            onClick={(event) => {\n              event.preventDefault();\n              const newDerivedFields = [...value, { name: '', matcherRegex: '' }];\n              onChange(newDerivedFields);\n            }}\n          >\n            Add\n          </Button>\n\n          {value.length > 0 && (\n            <Button variant=\"secondary\" type=\"button\" onClick={() => setShowDebug(!showDebug)}>\n              {showDebug ? 'Hide example log message' : 'Show example log message'}\n            </Button>\n          )}\n        </div>\n      </div>\n\n      {showDebug && (\n        <div className=\"gf-form-group\">\n          <DebugSection\n            className={css`\n              margin-bottom: 10px;\n            `}\n            derivedFields={value}\n          />\n        </div>\n      )}\n    </>\n  );\n};\n","import React from 'react';\n\nimport { LegacyForms } from '@grafana/ui';\nconst { FormField } = LegacyForms;\n\ntype Props = {\n  value: string;\n  onChange: (value: string) => void;\n};\n\nexport const MaxLinesField = (props: Props) => {\n  const { value, onChange } = props;\n  return (\n    <FormField\n      label=\"Maximum lines\"\n      labelWidth={11}\n      inputWidth={20}\n      inputEl={\n        <input\n          type=\"number\"\n          className=\"gf-form-input width-8 gf-form-input--has-help-icon\"\n          value={value}\n          onChange={(event) => onChange(event.currentTarget.value)}\n          spellCheck={false}\n          placeholder=\"1000\"\n        />\n      }\n      tooltip={\n        <>\n          Loki queries must contain a limit of the maximum number of lines returned (default: 1000). Increase this limit\n          to have a bigger result set for ad-hoc analysis. Decrease this limit if your browser becomes sluggish when\n          displaying the log results.\n        </>\n      }\n    />\n  );\n};\n","import React from 'react';\n\nimport { DataSourcePluginOptionsEditorProps, DataSourceSettings } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { AlertingSettings, DataSourceHttpSettings, SecureSocksProxySettings } from '@grafana/ui';\n\nimport { LokiOptions } from '../types';\n\nimport { DerivedFields } from './DerivedFields';\nimport { MaxLinesField } from './MaxLinesField';\n\nexport type Props = DataSourcePluginOptionsEditorProps<LokiOptions>;\n\nconst makeJsonUpdater =\n  <T extends any>(field: keyof LokiOptions) =>\n  (options: DataSourceSettings<LokiOptions>, value: T): DataSourceSettings<LokiOptions> => {\n    return {\n      ...options,\n      jsonData: {\n        ...options.jsonData,\n        [field]: value,\n      },\n    };\n  };\n\nconst setMaxLines = makeJsonUpdater('maxLines');\nconst setDerivedFields = makeJsonUpdater('derivedFields');\n\nexport const ConfigEditor = (props: Props) => {\n  const { options, onOptionsChange } = props;\n\n  return (\n    <>\n      <DataSourceHttpSettings\n        defaultUrl={'http://localhost:3100'}\n        dataSourceConfig={options}\n        showAccessOptions={false}\n        onChange={onOptionsChange}\n      />\n\n      {config.featureToggles.secureSocksDatasourceProxy && (\n        <SecureSocksProxySettings options={options} onOptionsChange={onOptionsChange} />\n      )}\n\n      <AlertingSettings<LokiOptions> options={options} onOptionsChange={onOptionsChange} />\n\n      <div className=\"gf-form-group\">\n        <div className=\"gf-form-inline\">\n          <div className=\"gf-form\">\n            <MaxLinesField\n              value={options.jsonData.maxLines || ''}\n              onChange={(value) => onOptionsChange(setMaxLines(options, value))}\n            />\n          </div>\n        </div>\n      </div>\n\n      <DerivedFields\n        value={options.jsonData.derivedFields}\n        onChange={(value) => onOptionsChange(setDerivedFields(options, value))}\n      />\n    </>\n  );\n};\n","import { DashboardLoadedEvent, DataSourcePlugin } from '@grafana/data';\nimport { getAppEvents } from '@grafana/runtime';\n\nimport LokiCheatSheet from './components/LokiCheatSheet';\nimport LokiQueryEditorByApp from './components/LokiQueryEditorByApp';\nimport { ConfigEditor } from './configuration/ConfigEditor';\nimport { LokiDatasource } from './datasource';\nimport { onDashboardLoadedHandler } from './tracking';\nimport { LokiQuery } from './types';\n\nexport const plugin = new DataSourcePlugin(LokiDatasource)\n  .setQueryEditor(LokiQueryEditorByApp)\n  .setConfigEditor(ConfigEditor)\n  .setQueryEditorHelp(LokiCheatSheet);\n\n// Subscribe to on dashboard loaded event so that we can track plugin adoption\ngetAppEvents().subscribe<DashboardLoadedEvent<LokiQuery>>(DashboardLoadedEvent, onDashboardLoadedHandler);\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { GrafanaTheme2, renderMarkdown } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\n\nexport interface Props {\n  title?: React.ReactNode;\n  children?: React.ReactNode;\n  markdown?: string;\n  stepNumber?: number;\n}\n\nexport function OperationExplainedBox({ title, stepNumber, markdown, children }: Props) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.box}>\n      {stepNumber !== undefined && <div className={styles.stepNumber}>{stepNumber}</div>}\n      <div className={styles.boxInner}>\n        {title && (\n          <div className={styles.header}>\n            <span>{title}</span>\n          </div>\n        )}\n        <div className={styles.body}>\n          {markdown && <div dangerouslySetInnerHTML={{ __html: renderMarkdown(markdown) }}></div>}\n          {children}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    box: css({\n      background: theme.colors.background.secondary,\n      padding: theme.spacing(1),\n      borderRadius: theme.shape.borderRadius(),\n      position: 'relative',\n    }),\n    boxInner: css({\n      marginLeft: theme.spacing(4),\n    }),\n    stepNumber: css({\n      fontWeight: theme.typography.fontWeightMedium,\n      background: theme.colors.secondary.main,\n      width: '20px',\n      height: '20px',\n      borderRadius: '50%',\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      position: 'absolute',\n      top: '10px',\n      left: '11px',\n      fontSize: theme.typography.bodySmall.fontSize,\n    }),\n    header: css({\n      paddingBottom: theme.spacing(0.5),\n      display: 'flex',\n      alignItems: 'center',\n      fontFamily: theme.typography.fontFamilyMonospace,\n    }),\n    body: css({\n      color: theme.colors.text.secondary,\n      'p:last-child': {\n        margin: 0,\n      },\n      a: {\n        color: theme.colors.text.link,\n        textDecoration: 'underline',\n      },\n    }),\n  };\n};\n","import { Grammar } from 'prismjs';\nimport React from 'react';\n\nimport { OperationExplainedBox } from './OperationExplainedBox';\nimport { RawQuery } from './RawQuery';\nimport { QueryBuilderOperation, QueryWithOperations, VisualQueryModeller } from './types';\n\nexport interface Props<T extends QueryWithOperations> {\n  query: T;\n  queryModeller: VisualQueryModeller;\n  explainMode?: boolean;\n  stepNumber: number;\n  lang: {\n    grammar: Grammar;\n    name: string;\n  };\n  onMouseEnter?: (op: QueryBuilderOperation, index: number) => void;\n  onMouseLeave?: (op: QueryBuilderOperation, index: number) => void;\n}\n\nexport function OperationListExplained<T extends QueryWithOperations>({\n  query,\n  queryModeller,\n  stepNumber,\n  lang,\n  onMouseEnter,\n  onMouseLeave,\n}: Props<T>) {\n  return (\n    <>\n      {query.operations.map((op, index) => {\n        const def = queryModeller.getOperationDef(op.id);\n        if (!def) {\n          return `Operation ${op.id} not found`;\n        }\n        const title = def.renderer(op, def, '<expr>');\n        const body = def.explainHandler ? def.explainHandler(op, def) : def.documentation ?? 'no docs';\n\n        return (\n          <div\n            key={index}\n            onMouseEnter={() => onMouseEnter?.(op, index)}\n            onMouseLeave={() => onMouseLeave?.(op, index)}\n          >\n            <OperationExplainedBox\n              stepNumber={index + stepNumber}\n              title={<RawQuery query={title} lang={lang} />}\n              markdown={body}\n            />\n          </div>\n        );\n      })}\n    </>\n  );\n}\n","import { css, cx } from '@emotion/css';\nimport Prism, { Grammar } from 'prismjs';\nimport React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data/src';\nimport { useTheme2 } from '@grafana/ui/src';\n\nexport interface Props {\n  query: string;\n  lang: {\n    grammar: Grammar;\n    name: string;\n  };\n  className?: string;\n}\nexport function RawQuery({ query, lang, className }: Props) {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  const highlighted = Prism.highlight(query, lang.grammar, lang.name);\n\n  return (\n    <div\n      className={cx(styles.editorField, 'prism-syntax-highlight', className)}\n      aria-label=\"selector\"\n      dangerouslySetInnerHTML={{ __html: highlighted }}\n    />\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    editorField: css({\n      fontFamily: theme.typography.fontFamilyMonospace,\n      fontSize: theme.typography.bodySmall.fontSize,\n    }),\n  };\n};\n"],"names":["Field","MonacoQueryFieldLazy","props","MonacoQueryFieldWrapper","lastRunValueRef","onRunQuery","onChange","rest","handleRunQuery","value","handleBlur","LokiQueryField","override","query","nextQuery","prevProps","range","languageProvider","ExtraFieldElement","datasource","history","onQueryType","placeholder","roundMsToMin","milliseconds","roundSecToMin","seconds","shouldRefreshLabels","prevRange","sameMinuteFrom","sameMinuteTo","RE2_METACHARACTERS","escapeLokiRegexp","escapeLabelValueInExactSelector","labelValue","unescapeLabelValue","escapeLabelValueInRegexSelector","escapeLabelValueInSelector","selector","isRegexSelector","isBytesString","string","BYTES_KEYWORDS","regex","DEFAULT_EXAMPLES","PREFERRED_LABELS","EXAMPLES_LIMIT","LOGQL_EXAMPLES","LokiCheatSheet","provider","labels","preferredLabel","l","values","userExamples","expr","onClickExample","onClick","e","hasUserExamples","example","item","MAX_LABEL_COUNT","MAX_VALUE_COUNT","MAX_AUTO_SELECT","EMPTY_SELECTOR","buildSelector","selectedLabels","label","selectedValues","facetLabels","possibleLabels","lastFacetted","possibleValues","existingValues","getStyles","theme","UnthemedLokiLabelBrowser","event","state","name","selected","nextValue","v","updatedFields","status","cb","error","autoSelect","lastUsedLabels","rawLabels","i","arr","rawValues","streams","searchTerm","validationStatus","LoadingPlaceholder","styles","empty","searchResults","fuzzyMatchResult","fuzzy","Label","Input","index","style","Button","LokiLabelBrowser","LabelBrowserModal","isOpen","onClose","app","labelsLoaded","setLabelsLoaded","hasLogLabels","setHasLogLabels","LAST_USED_LABELS_KEY","changeQuery","reportInteractionAndClose","Modal","LocalStorageValueProvider","onLastUsedLabelsSave","onLastUsedLabelsDelete","LabelFilterItem","items","defaultOp","onDelete","onGetLabelNames","onGetLabelValues","invalidLabel","invalidValue","setState","CONFLICTING_LABEL_FILTER_ERROR_MESSAGE","isMultiSelect","operator","operators","op","getSelectOptionsFromString","getOptions","labelValues","selectedOptions","isConflicting","InlineField","Select","selectors","labelNames","change","changes","MISSING_LABEL_FILTER_ERROR_MESSAGE","LabelFilters","labelsFilters","labelFilterRequired","setItems","onLabelsChange","newItems","newLabels","x","hasLabelFilter","onChangeItem","EXPLAIN_LABEL_FILTER_CONTENT","LokiQueryBuilderExplained","visQuery","lang","OperationExplainedBox","RawQuery","OperationListExplained","NestedQuery","nestedQuery","onRemove","showExplain","val","AutoSizeInput","evt","IconButton","LokiQueryBuilder","update","def","NestedQueryList","nestedQueries","onNestedQueryUpdate","updatedList","sampleData","setSampleData","highlightedOp","setHighlightedOp","onChangeLabels","withTemplateVariableOptions","optionsPromise","options","forLabel","labelsToConsider","series","labelsNamesToConsider","lokiQuery","testIds","OperationsEditorRow","OperationList","QueryBuilderHints","QueryPreview","LokiQueryBuilderContainer","dispatch","stateSlice","exprChanged","onVisQueryChange","visualQueryChange","initialState","action","parseResult","LokiQueryBuilderOptions","maxLines","queryStats","splitDurationValid","setsplitDurationValid","onQueryTypeChange","onResolutionChange","option","onChunkRangeChange","onLegendFormatChanged","onMaxLinesChange","newMaxLines","queryType","showMaxLines","QueryOptionGroup","getCollapsedInfo","RadioButtonGroup","config","queryTypeLabel","resolutionLabel","getStats","response","compareTime","time1","time2","shouldUpdateStats","prevQuery","timerange","prevTimerange","LokiQueryCodeEditor","data","setQueryStats","stats","QueryPattern","pattern","onPatternSelect","hasNewQueryOption","hasPreviousQuery","selectedPatternName","setSelectedPatternName","Card","QueryPatternsModal","onAddQuery","queries","openTabs","setOpenTabs","selectAsNewQuery","visualQuery","patternType","Collapse","tabs","t","queryEditorModeDefaultLocalStorageKey","changeEditorMode","editorMode","store","getDefaultEditorMode","getQueryWithDefaults","result","LokiQueryEditor","parseModalOpen","setParseModalOpen","queryPatternsModalOpen","setQueryPatternsModalOpen","dataIsStale","setDataIsStale","labelBrowserVisible","setLabelBrowserVisible","explain","setExplain","useFlag","previousTimerange","usePrevious","previousQuery","onExplainChange","onEditorModeChange","newEditorMode","onChangeInternal","onClickLabelBrowserButton","visible","ConfirmModal","prevValue","QueryHeaderSwitch","QueryEditorModeToggle","LokiQueryEditorForAlerting","LokiQueryEditorByApp","FormField","DebugSection","derivedFields","className","debugText","setDebugText","debugFields","makeDebugFields","DebugFields","fields","field","testMatch","link","ArrayVector","Switch","DerivedField","suggestions","showInternalLink","setShowInternalLink","previousUid","handleChange","DataLinkInput","newValue","DataSourcePicker","ds","DerivedFields","showDebug","setShowDebug","newField","newDerivedFields","MaxLinesField","makeJsonUpdater","setMaxLines","setDerivedFields","ConfigEditor","onOptionsChange","DataSourceHttpSettings","SecureSocksProxySettings","AlertingSettings","title","stepNumber","markdown","children","queryModeller","onMouseEnter","onMouseLeave","body","highlighted"],"sourceRoot":""}