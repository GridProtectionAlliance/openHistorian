(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[500],{75888:(S,v,c)=>{"use strict";S.exports=function(n,a){var u=this,T=u.constructor;return u.options=Object.assign({storeInstancesGlobally:!0},a||{}),u.callbacks={},u.directMap={},u.sequenceLevels={},u.resetTimer=null,u.ignoreNextKeyup=!1,u.ignoreNextKeypress=!1,u.nextExpectedAction=!1,u.element=n,u.addEvents(),u.options.storeInstancesGlobally&&T.instances.push(u),u},S.exports.prototype.bind=c(61210),S.exports.prototype.bindMultiple=c(74382),S.exports.prototype.unbind=c(43709),S.exports.prototype.trigger=c(43149),S.exports.prototype.reset=c(26726),S.exports.prototype.stopCallback=c(84446),S.exports.prototype.handleKey=c(94320),S.exports.prototype.addEvents=c(96687),S.exports.prototype.bindSingle=c(99833),S.exports.prototype.getKeyInfo=c(84174),S.exports.prototype.pickBestAction=c(16004),S.exports.prototype.getReverseMap=c(95193),S.exports.prototype.getMatches=c(19132),S.exports.prototype.resetSequences=c(55610),S.exports.prototype.fireCallback=c(7922),S.exports.prototype.bindSequence=c(90875),S.exports.prototype.resetSequenceTimer=c(80602),S.exports.prototype.detach=c(93502),S.exports.instances=[],S.exports.reset=c(6255),S.exports.REVERSE_MAP=null},96687:(S,v,c)=>{"use strict";S.exports=function(){var n=this,a=c(12904),u=n.element;n.eventHandler=c(88178).bind(n),a(u,"keypress",n.eventHandler),a(u,"keydown",n.eventHandler),a(u,"keyup",n.eventHandler)}},61210:S=>{"use strict";S.exports=function(v,c,n){var a=this;return v=v instanceof Array?v:[v],a.bindMultiple(v,c,n),a}},74382:S=>{"use strict";S.exports=function(v,c,n){for(var a=this,u=0;u<v.length;++u)a.bindSingle(v[u],c,n)}},90875:(S,v,c)=>{"use strict";S.exports=function(n,a,u,T){var N=this;N.sequenceLevels[n]=0;function b(B){return function(){N.nextExpectedAction=B,++N.sequenceLevels[n],N.resetSequenceTimer()}}function I(B){var W;N.fireCallback(u,B,n),T!=="keyup"&&(W=c(23970),N.ignoreNextKeyup=W(B)),setTimeout(function(){N.resetSequences()},10)}for(var p=0;p<a.length;++p){var H=p+1===a.length,$=H?I:b(T||N.getKeyInfo(a[p+1]).action);N.bindSingle(a[p],$,T,n,p)}}},99833:S=>{"use strict";S.exports=function(v,c,n,a,u){var T=this;T.directMap[v+":"+n]=c,v=v.replace(/\s+/g," ");var N=v.split(" "),b;if(N.length>1){T.bindSequence(v,N,c,n);return}b=T.getKeyInfo(v,n),T.callbacks[b.key]=T.callbacks[b.key]||[],T.getMatches(b.key,b.modifiers,{type:b.action},a,v,u),T.callbacks[b.key][a?"unshift":"push"]({callback:c,modifiers:b.modifiers,action:b.action,seq:a,level:u,combo:v})}},93502:(S,v,c)=>{var n=c(12904).off;S.exports=function(){var a=this,u=a.element;n(u,"keypress",a.eventHandler),n(u,"keydown",a.eventHandler),n(u,"keyup",a.eventHandler)}},12904:S=>{S.exports=v,S.exports.on=v,S.exports.off=c;function v(n,a,u,T){return!n.addEventListener&&(a="on"+a),(n.addEventListener||n.attachEvent).call(n,a,u,T),u}function c(n,a,u,T){return!n.removeEventListener&&(a="on"+a),(n.removeEventListener||n.detachEvent).call(n,a,u,T),u}},7922:(S,v,c)=>{"use strict";S.exports=function(n,a,u,T){var N=this,b,I;N.stopCallback(a,a.target||a.srcElement,u,T)||n(a,u)===!1&&(b=c(12156),b(a),I=c(31849),I(a))}},84174:(S,v,c)=>{"use strict";S.exports=function(n,a){var u=this,T,N,b,I,p=[],H,$,B;for(T=c(27486),N=T(n),H=c(7641),$=c(57984),B=c(95962),I=0;I<N.length;++I)b=N[I],H[b]&&(b=H[b]),a&&a!=="keypress"&&$[b]&&(b=$[b],p.push("shift")),B(b)&&p.push(b);return a=u.pickBestAction(b,p,a),{key:b,modifiers:p,action:a}}},19132:(S,v,c)=>{"use strict";S.exports=function(n,a,u,T,N,b){var I=this,p,H,$=[],B=u.type,W,z;if(B==="keypress"&&!(u.code&&u.code.slice(0,5)==="Arrow")){var te=I.callbacks["any-character"]||[];te.forEach(function(Ee){$.push(Ee)})}if(!I.callbacks[n])return $;for(W=c(95962),B==="keyup"&&W(n)&&(a=[n]),p=0;p<I.callbacks[n].length;++p)if(H=I.callbacks[n][p],!(!T&&H.seq&&I.sequenceLevels[H.seq]!==H.level)&&B===H.action&&(z=c(4857),B==="keypress"&&!u.metaKey&&!u.ctrlKey||z(a,H.modifiers))){var de=!T&&H.combo===N,pe=T&&H.seq===T&&H.level===b;(de||pe)&&I.callbacks[n].splice(p,1),$.push(H)}return $}},95193:(S,v,c)=>{"use strict";S.exports=function(){var n=this,a=n.constructor,u;if(!a.REVERSE_MAP){a.REVERSE_MAP={},u=c(56814);for(var T in u)T>95&&T<112||u.hasOwnProperty(T)&&(a.REVERSE_MAP[u[T]]=T)}return a.REVERSE_MAP}},94320:(S,v,c)=>{"use strict";S.exports=function(n,a,u){var T=this,N,b,I={},p=0,H=!1,$,B;for(N=T.getMatches(n,a,u),b=0;b<N.length;++b)N[b].seq&&(p=Math.max(p,N[b].level));for(b=0;b<N.length;++b){if(N[b].seq){if(N[b].level!==p)continue;H=!0,I[N[b].seq]=1,T.fireCallback(N[b].callback,u,N[b].combo,N[b].seq);continue}H||T.fireCallback(N[b].callback,u,N[b].combo)}B=u.type==="keypress"&&T.ignoreNextKeypress,$=c(95962),u.type===T.nextExpectedAction&&!$(n)&&!B&&T.resetSequences(I),T.ignoreNextKeypress=H&&u.type==="keydown"}},88178:(S,v,c)=>{"use strict";S.exports=function(n){var a=this,u,T;typeof n.which!="number"&&(n.which=n.keyCode),u=c(23970);var N=u(n);if(N!==void 0){if(n.type==="keyup"&&a.ignoreNextKeyup===N){a.ignoreNextKeyup=!1;return}T=c(25273),a.handleKey(N,T(n),n)}}},4857:S=>{"use strict";S.exports=function(v,c){return v.sort().join(",")===c.sort().join(",")}},16004:S=>{"use strict";S.exports=function(v,c,n){var a=this;return n||(n=a.getReverseMap()[v]?"keydown":"keypress"),n==="keypress"&&c.length&&(n="keydown"),n}},26726:S=>{"use strict";S.exports=function(){var v=this;return v.callbacks={},v.directMap={},this}},80602:S=>{"use strict";S.exports=function(){var v=this;clearTimeout(v.resetTimer),v.resetTimer=setTimeout(function(){v.resetSequences()},1e3)}},55610:S=>{"use strict";S.exports=function(v){var c=this;v=v||{};var n=!1,a;for(a in c.sequenceLevels){if(v[a]){n=!0;continue}c.sequenceLevels[a]=0}n||(c.nextExpectedAction=!1)}},84446:S=>{"use strict";S.exports=function(v,c){if((" "+c.className+" ").indexOf(" combokeys ")>-1)return!1;var n=c.tagName.toLowerCase();return n==="input"||n==="select"||n==="textarea"||c.isContentEditable}},43149:S=>{"use strict";S.exports=function(v,c){var n=this;return n.directMap[v+":"+c]&&n.directMap[v+":"+c]({},v),this}},43709:S=>{"use strict";S.exports=function(v,c){var n=this;return n.bind(v,function(){},c)}},6255:S=>{"use strict";S.exports=function(){var v=this;v.instances.forEach(function(c){c.reset()})}},23970:(S,v,c)=>{"use strict";S.exports=function(n){var a,u;if(a=c(56814),u=c(14082),n.type==="keypress"){var T=String.fromCharCode(n.which);return n.shiftKey||(T=T.toLowerCase()),T}return a[n.which]!==void 0?a[n.which]:u[n.which]!==void 0?u[n.which]:String.fromCharCode(n.which).toLowerCase()}},25273:S=>{"use strict";S.exports=function(v){var c=[];return v.shiftKey&&c.push("shift"),v.altKey&&c.push("alt"),v.ctrlKey&&c.push("ctrl"),v.metaKey&&c.push("meta"),c}},95962:S=>{"use strict";S.exports=function(v){return v==="shift"||v==="ctrl"||v==="alt"||v==="meta"}},27486:S=>{"use strict";S.exports=function(v){return v==="+"?["+"]:v.split("+")}},12156:S=>{"use strict";S.exports=function(v){if(v.preventDefault){v.preventDefault();return}v.returnValue=!1}},57984:S=>{"use strict";S.exports={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"}},7641:S=>{"use strict";S.exports={option:"alt",command:"meta",return:"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"}},14082:S=>{"use strict";S.exports={106:"*",107:"plus",109:"minus",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"}},56814:S=>{"use strict";S.exports={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",173:"minus",187:"plus",189:"minus",224:"meta"};for(var v=1;v<20;++v)S.exports[111+v]="f"+v;for(v=0;v<=9;++v)S.exports[v+96]=v},31849:S=>{"use strict";S.exports=function(v){if(v.stopPropagation){v.stopPropagation();return}v.cancelBubble=!0}},92599:(S,v,c)=>{"use strict";c.d(v,{V:()=>ks});var n=c(74848),a=c(32196),u=c(96540),T=c(42941),N=c(41987),b=c(6709);function I(h){if(h?.tracesToLogsV2)return h.tracesToLogsV2;if(!h?.tracesToLogs)return;const m={customQuery:!1};return m.datasourceUid=h.tracesToLogs.datasourceUid,m.tags=h.tracesToLogs.mapTagNamesEnabled?h.tracesToLogs.mappedTags:h.tracesToLogs.tags?.map(x=>({key:x})),m.filterByTraceID=h.tracesToLogs.filterByTraceID,m.filterBySpanID=h.tracesToLogs.filterBySpanID,m.spanStartTimeShift=h.tracesToLogs.spanStartTimeShift,m.spanEndTimeShift=h.tracesToLogs.spanEndTimeShift,m}function p({options:h,onOptionsChange:m}){const x=["loki","elasticsearch","grafana-splunk-datasource","grafana-opensearch-datasource","grafana-falconlogscale-datasource","googlecloud-logging-datasource"],y=useMemo(()=>I(h.jsonData)||{customQuery:!1},[h.jsonData]),{query:C="",tags:L,customQuery:D}=y,j=useCallback(A=>{m({...h,jsonData:{...h.jsonData,tracesToLogsV2:{...y,...A},tracesToLogs:void 0}})},[m,h,y]);return jsxs("div",{className:css({width:"100%"}),children:[jsx(InlineFieldRow,{children:jsx(InlineField,{tooltip:"The logs data source the trace is going to navigate to",label:"Data source",labelWidth:26,children:jsx(DataSourcePicker,{inputId:"trace-to-logs-data-source-picker",filter:A=>x.includes(A.type),current:y.datasourceUid,noDefault:!0,width:40,onChange:A=>j({datasourceUid:A.uid})})})}),jsx(InlineFieldRow,{children:jsx(IntervalInput,{label:$("start"),tooltip:B("start","0"),value:y.spanStartTimeShift||"",onChange:A=>{j({spanStartTimeShift:A})},isInvalidError:W})}),jsx(InlineFieldRow,{children:jsx(IntervalInput,{label:$("end"),tooltip:B("end","0"),value:y.spanEndTimeShift||"",onChange:A=>{j({spanEndTimeShift:A})},isInvalidError:W})}),jsx(InlineFieldRow,{children:jsx(InlineField,{tooltip:"Tags that will be used in the query. Default tags: 'cluster', 'hostname', 'namespace', 'pod', 'service.name', 'service.namespace'",label:"Tags",labelWidth:26,children:jsx(TagMappingInput,{values:L??[],onChange:A=>j({tags:A})})})}),jsx(H,{disabled:D,type:"trace",id:"filterByTraceID",value:!!y.filterByTraceID,onChange:A=>j({filterByTraceID:A})}),jsx(H,{disabled:D,type:"span",id:"filterBySpanID",value:!!y.filterBySpanID,onChange:A=>j({filterBySpanID:A})}),jsx(InlineFieldRow,{children:jsx(InlineField,{tooltip:"Use a custom query with the possibility to interpolate variables from the trace or span",label:"Use custom query",labelWidth:26,children:jsx(InlineSwitch,{id:"customQuerySwitch",value:D,onChange:A=>j({customQuery:A.currentTarget.checked})})})}),D&&jsx(InlineField,{label:"Query",labelWidth:26,tooltip:"The query that will run when navigating from a trace to logs data source. Interpolate tags using the `$__tags` keyword",grow:!0,children:jsx(Input,{label:"Query",type:"text",allowFullScreen:!0,value:C,onChange:A=>j({query:A.currentTarget.value})})})]})}function H(h){return jsx(InlineFieldRow,{children:jsx(InlineField,{disabled:h.disabled,label:`Filter by ${h.type} ID`,labelWidth:26,grow:!0,tooltip:`Filters logs by ${h.type} ID, where the ${h.type} ID should be part of the log line`,children:jsx(InlineSwitch,{id:h.id,value:h.value,onChange:m=>h.onChange(m.currentTarget.checked)})})})}const $=h=>`Span ${h} time shift`,B=(h,m)=>`Shifts the ${h} time of the span. Default: ${m} (Time units can be used here, for example: 5s, -1m, 3h)`,W="Invalid time shift. See tooltip for examples.",z=({options:h,onOptionsChange:m})=>{let x=h.type;return x+=h.type==="tempo"?"/configure-tempo-data-source/#trace-to-logs":"/#trace-to-logs",jsx(ConfigSection,{title:"Trace to logs",description:jsx(ConfigDescriptionLink,{description:"Navigate from a trace span to the selected data source's logs.",suffix:x,feature:"trace to logs"}),isCollapsible:!0,isInitiallyOpen:!0,children:jsx(p,{options:h,onOptionsChange:m})})};var te=c(72574),de=c(40845),pe=c(31193),Ee=c(32901),q=c(31678),Be=c(62256),be=c(70673),Se=c(41811);const We=(h,m,x)=>{let y;return x?y=m?.childSpanIds.find(C=>h.has(C)&&h.get(C).startTime+h.get(C).duration<x):y=m.childSpanIds[0],y?h.get(y):void 0},lt=h=>{const m=[],x=[];h.forEach(L=>{if(L.references[0]?.refType==="FOLLOWS_FROM"){m.push(L.spanID);const D=h.get(L.references[0].spanID);D.childSpanIds=D.childSpanIds.filter(j=>j!==L.spanID),h.set(D.spanID,{...D})}});const y=L=>{L.forEach(D=>{const j=h.get(D);j.hasChildren&&(x.push(...j.childSpanIds),y(j.childSpanIds))})};return y(m),[...m,...x].forEach(L=>h.delete(L)),h},xt=h=>{let m=[...h.keys()];return m.forEach(x=>{const y=h.get(x);if(!(y&&y.references.length&&y.depth))return;const C=h.get(y.references[0].spanID);if(!C){h.delete(y.spanID);return}const L=y.startTime+y.duration,D=C.startTime+C.duration;if(y.startTime>=C.startTime){if(y.startTime>=D){h.delete(y.spanID),C.childSpanIds=C.childSpanIds.filter(j=>j!==y.spanID);return}if(L>D){h.set(y.spanID,{...y,duration:D-y.startTime});return}return}L<=C.startTime?(h.delete(y.spanID),C.childSpanIds=C.childSpanIds.filter(j=>j!==y.spanID)):L<=D?h.set(y.spanID,{...y,startTime:C.startTime,duration:L-C.startTime}):h.set(y.spanID,{...y,startTime:C.startTime,duration:D-C.startTime})}),m=[...h.keys()],m.forEach(x=>{const y=h.get(x);if(y.references.length){const C=h.get(y.references[0].spanID);y.references[0].span=C,h.set(x,{...y})}}),h},K=(h,m,x,y)=>{const C=h.get(m);if(!C)return x;const L=We(h,C,y);let D;if(L)D={spanId:C.spanID,section_start:L.startTime+L.duration,section_end:y||C.startTime+C.duration},D.section_start!==D.section_end&&x.push(D),K(h,L.spanID,x);else if(D={spanId:C.spanID,section_start:C.startTime,section_end:y||C.startTime+C.duration},D.section_start!==D.section_end&&x.push(D),C.references.length){const j=C.references.filter(A=>A.refType==="CHILD_OF")[0].spanID;K(h,j,x,C.startTime)}return x};function ee(h){let m=[];const x=h?.spans[0].spanID;if(x){const y=h.spans.reduce((C,L)=>(C.set(L.spanID,L),C),new Map);try{const C=lt(y),L=xt(C);m=K(L,x,m)}catch(C){console.log("error while computing critical path for a trace",C)}}return m}const X=(0,Se.A)(ee);var ae=c(3911),ie=c(71656),Y=c(30700);const ze=.8,_e=2,Lt=200,oe=10,je=60,Re=6;function Ne(h,m,x,y,C){const L=new Map,D=m.length<je?je:Math.min(m.length,Lt),j=window.innerWidth*2;h.width=j,h.height=D;const A=Math.min(Re,Math.max(_e,D/m.length)),re=D/m.length,he=h.getContext("2d",{alpha:!1});if(he){he.fillStyle=C,he.fillRect(0,0,j,D);for(let ve=0;ve<m.length;ve++){const{valueWidth:Ie,valueOffset:Ae,serviceName:tt}=m[ve],Oe=Ae/x*j;let Xe=Ie/x*j;Xe<oe&&(Xe=oe);let Me=L.get(tt);Me||(Me=`rgba(${y(tt).concat(ze).join()})`,L.set(tt,Me)),he.fillStyle=Me,he.fillRect(Oe,ve*re,Xe,A)}}}const Ke=(0,ae.N)(h=>({CanvasSpanGraph:(0,a.css)({label:"CanvasSpanGraph",background:(0,ie.R)(h,"#fafafa"),height:"60px",position:"absolute",width:"100%"})}));class me extends u.PureComponent{constructor(m){super(m),this.getColor=x=>(0,Y.rY)(x,this.props.theme),this._setCanvasRef=x=>{this._canvasElm=x},this._canvasElm=void 0}componentDidMount(){this._draw()}componentDidUpdate(){this._draw()}_draw(){if(this._canvasElm){const{valueWidth:m,items:x}=this.props;Ne(this._canvasElm,x,m,this.getColor,(0,ie.R)(this.props.theme,"#fff"))}}render(){return(0,n.jsx)("canvas",{className:Ke(this.props.theme).CanvasSpanGraph,ref:this._setCanvasRef,"data-testid":"CanvasSpanGraph"})}}const we=(0,de.cV)(me);var Ge=c(6389);const Ue=()=>({TickLabels:(0,a.css)({label:"TickLabels",height:"1rem",position:"relative"}),TickLabelsLabel:(0,a.css)({label:"TickLabelsLabel",color:"#717171",fontSize:"0.7rem",position:"absolute",userSelect:"none"})});function yt(h){const{numTicks:m,duration:x}=h,y=(0,de.of)(Ue),C=[];for(let L=0;L<m+1;L++){const D=L/m,j=D===1?{right:"0%"}:{left:`${D*100}%`};C.push((0,n.jsx)("div",{className:y.TickLabelsLabel,style:j,"data-testid":"tick",children:(0,Ge.a3)(x*D)},D))}return(0,n.jsx)("div",{className:y.TickLabels,"data-testid":"TickLabels",children:C})}var Fe=c(46942),Ze=c.n(Fe),ms=c(55852),ct=c(92151);const vs=()=>({GraphTick:(0,a.css)({label:"GraphTick",stroke:"#aaa",strokeWidth:"1px"})});function xs(h){const{numTicks:m}=h,x=(0,de.of)(vs),y=[];for(let C=1;C<m;C++){const L=`${C/m*100}%`;y.push((0,n.jsx)("line",{className:x.GraphTick,x1:L,y1:"0%",x2:L,y2:"100%"},C/m))}return(0,n.jsx)("g",{"data-testid":"ticks","aria-hidden":"true",children:y})}const ys=()=>({ScrubberHandleExpansion:Ze()((0,a.css)({label:"ScrubberHandleExpansion",cursor:"col-resize",fillOpacity:0,fill:"#44f"}),"scrubber-handle-expansion"),ScrubberHandle:Ze()((0,a.css)({label:"ScrubberHandle",cursor:"col-resize",fill:"#555"}),"scrubber-handle"),ScrubberLine:Ze()((0,a.css)({label:"ScrubberLine",pointerEvents:"none",stroke:"#555"}),"scrubber-line"),ScrubberDragging:(0,a.css)({label:"ScrubberDragging","& .scrubber-handle-expansion":{fillOpacity:1},"& .scrubber-handle":{fill:"#44f"},"& > .scrubber-line":{stroke:"#44f"}}),ScrubberHandles:(0,a.css)({label:"ScrubberHandles","&:hover > .scrubber-handle-expansion":{fillOpacity:1},"&:hover > .scrubber-handle":{fill:"#44f"},"&:hover + .scrubber.line":{stroke:"#44f"}})});function xe({isDragging:h,onMouseDown:m,onMouseEnter:x,onMouseLeave:y,position:C}){const L=`${C*100}%`,D=(0,de.of)(ys),j=Ze()({[D.ScrubberDragging]:h});return(0,n.jsxs)("g",{className:j,"data-testid":"scrubber-component",children:[(0,n.jsxs)("g",{"data-testid":"scrubber-component-g",className:D.ScrubberHandles,onMouseDown:m,onMouseEnter:x,onMouseLeave:y,children:[(0,n.jsx)("rect",{"data-testid":"scrubber-component-rect-1",x:L,className:D.ScrubberHandleExpansion,style:{transform:"translate(-4.5px)"},width:"9",height:"20"}),(0,n.jsx)("rect",{"data-testid":"scrubber-component-rect-2",x:L,className:D.ScrubberHandle,style:{transform:"translate(-1.5px)"},width:"3",height:"20"})]}),(0,n.jsx)("line",{className:D.ScrubberLine,y2:"100%",x1:L,x2:L,"data-testid":"scrubber-component-line"})]})}const bt=(0,ae.N)(h=>{const m="JaegerUiComponents__ViewingLayerResetZoomHoverClassName",x=(0,a.css)({label:"ViewingLayerResetZoom",display:"none",position:"absolute",right:"1%",top:"10%",zIndex:1});return{ViewingLayer:(0,a.css)({label:"ViewingLayer",cursor:"vertical-text",position:"relative",zIndex:1,[`&:hover > .${m}`]:{display:"unset"}}),ViewingLayerGraph:(0,a.css)({label:"ViewingLayerGraph",border:`1px solid ${(0,ie.R)(h,"#999")}`,overflow:"visible !important",position:"relative",transformOrigin:"0 0",width:"100%"}),ViewingLayerInactive:(0,a.css)({label:"ViewingLayerInactive",fill:(0,ie.R)(h,"rgba(214, 214, 214, 0.5)")}),ViewingLayerCursorGuide:(0,a.css)({label:"ViewingLayerCursorGuide",stroke:(0,ie.R)(h,"#f44"),strokeWidth:1}),ViewingLayerDraggedShift:(0,a.css)({label:"ViewingLayerDraggedShift",fillOpacity:.2}),ViewingLayerDrag:(0,a.css)({label:"ViewingLayerDrag",fill:(0,ie.R)(h,"#44f")}),ViewingLayerFullOverlay:(0,a.css)({label:"ViewingLayerFullOverlay",bottom:0,cursor:"col-resize",left:0,position:"fixed",right:0,top:0,userSelect:"none"}),ViewingLayerResetZoom:x,ViewingLayerResetZoomHoverClassName:m}}),qe={SHIFT_END:"SHIFT_END",SHIFT_START:"SHIFT_START",REFRAME:"REFRAME"};function bs(h,m){const[x,y]=h<m?[h,m]:[m,h];return{x:`${x*100}%`,width:`${(y-x)*100}%`,leadingX:`${m*100}%`}}class Ft extends u.PureComponent{constructor(m){super(m),this._setRoot=x=>{this._root=x},this._getDraggingBounds=x=>{if(!this._root)throw new Error("invalid state");const{left:y,width:C}=this._root.getBoundingClientRect(),[L,D]=this.props.viewRange.time.current;let j=1,A=0;return x===qe.SHIFT_START?j=D:x===qe.SHIFT_END&&(A=L),{clientXLeft:y,maxValue:j,minValue:A,width:C}},this._handleReframeMouseMove=({value:x})=>{this.props.updateNextViewRangeTime({cursor:x})},this._handleReframeMouseLeave=()=>{this._draggerReframe.resetBounds(),this.props.updateNextViewRangeTime({cursor:null})},this._handleReframeDragUpdate=({value:x})=>{const y=x,{time:C}=this.props.viewRange,D={reframe:{anchor:C.reframe?C.reframe.anchor:y,shift:y}};this.props.updateNextViewRangeTime(D)},this._handleReframeDragEnd=({manager:x,value:y})=>{const{time:C}=this.props.viewRange,L=C.reframe?C.reframe.anchor:y,[D,j]=y<L?[y,L]:[L,y];x.resetBounds(),this.props.updateViewRangeTime(D,j,"minimap")},this._handleScrubberEnterLeave=({type:x})=>{const y=x===ct.EUpdateTypes.MouseEnter;this.setState({preventCursorLine:y})},this._handleScrubberDragUpdate=({event:x,tag:y,type:C,value:L})=>{C===ct.EUpdateTypes.DragStart&&x.stopPropagation(),y===qe.SHIFT_START?this.props.updateNextViewRangeTime({shiftStart:L}):y===qe.SHIFT_END&&this.props.updateNextViewRangeTime({shiftEnd:L})},this._handleScrubberDragEnd=({manager:x,tag:y,value:C})=>{const[L,D]=this.props.viewRange.time.current;let j;if(y===qe.SHIFT_START)j=[C,D];else if(y===qe.SHIFT_END)j=[L,C];else throw new Error("bad state");x.resetBounds(),this.setState({preventCursorLine:!1}),this.props.updateViewRangeTime(j[0],j[1],"minimap")},this._resetTimeZoomClickHandler=()=>{this.props.updateViewRangeTime(0,1)},this._draggerReframe=new ct.default({getBounds:this._getDraggingBounds,onDragEnd:this._handleReframeDragEnd,onDragMove:this._handleReframeDragUpdate,onDragStart:this._handleReframeDragUpdate,onMouseMove:this._handleReframeMouseMove,onMouseLeave:this._handleReframeMouseLeave,tag:qe.REFRAME}),this._draggerStart=new ct.default({getBounds:this._getDraggingBounds,onDragEnd:this._handleScrubberDragEnd,onDragMove:this._handleScrubberDragUpdate,onDragStart:this._handleScrubberDragUpdate,onMouseEnter:this._handleScrubberEnterLeave,onMouseLeave:this._handleScrubberEnterLeave,tag:qe.SHIFT_START}),this._draggerEnd=new ct.default({getBounds:this._getDraggingBounds,onDragEnd:this._handleScrubberDragEnd,onDragMove:this._handleScrubberDragUpdate,onDragStart:this._handleScrubberDragUpdate,onMouseEnter:this._handleScrubberEnterLeave,onMouseLeave:this._handleScrubberEnterLeave,tag:qe.SHIFT_END}),this._root=void 0,this.state={preventCursorLine:!1}}componentWillUnmount(){this._draggerReframe.dispose(),this._draggerEnd.dispose(),this._draggerStart.dispose()}_getMarkers(m,x){const y=bt(this.props.theme),C=bs(m,x);return[(0,n.jsx)("rect",{className:Ze()(y.ViewingLayerDraggedShift,y.ViewingLayerDrag),x:C.x,y:"0",width:C.width,height:this.props.height-2},"fill"),(0,n.jsx)("rect",{className:Ze()(y.ViewingLayerDrag),x:C.leadingX,y:"0",width:"1",height:this.props.height-2},"edge")]}render(){const{height:m,viewRange:x,numTicks:y,theme:C}=this.props,{preventCursorLine:L}=this.state,{current:D,cursor:j,shiftStart:A,shiftEnd:re,reframe:he}=x.time,ve=A!=null||re!=null||he!=null,[Ie,Ae]=D;let tt=0;Ie&&(tt=Ie*100);let Oe=100;Ae&&(Oe=100-Ae*100);let Xe;!ve&&j!=null&&!L&&(Xe=`${j*100}%`);const Me=bt(C);return(0,n.jsxs)("div",{"aria-hidden":!0,className:Me.ViewingLayer,style:{height:m},children:[(Ie!==0||Ae!==1)&&(0,n.jsx)(ms.$n,{onClick:this._resetTimeZoomClickHandler,className:Ze()(Me.ViewingLayerResetZoom,Me.ViewingLayerResetZoomHoverClassName),type:"button",variant:"secondary",children:"Reset Selection"}),(0,n.jsxs)("svg",{height:m,className:Me.ViewingLayerGraph,ref:this._setRoot,onMouseDown:this._draggerReframe.handleMouseDown,onMouseLeave:this._draggerReframe.handleMouseLeave,onMouseMove:this._draggerReframe.handleMouseMove,children:[tt>0&&(0,n.jsx)("rect",{x:0,y:0,height:"100%",width:`${tt}%`,className:Me.ViewingLayerInactive,"data-testid":"left-ViewingLayerInactive"}),Oe>0&&(0,n.jsx)("rect",{x:`${100-Oe}%`,y:0,height:"100%",width:`${Oe}%`,className:Me.ViewingLayerInactive,"data-testid":"right-ViewingLayerInactive"}),(0,n.jsx)(xs,{numTicks:y}),Xe&&(0,n.jsx)("line",{className:Me.ViewingLayerCursorGuide,x1:Xe,y1:"0",x2:Xe,y2:m-2,strokeWidth:"1","data-testid":"ViewingLayerCursorGuide"}),A!=null&&this._getMarkers(Ie,A),re!=null&&this._getMarkers(Ae,re),(0,n.jsx)(xe,{isDragging:A!=null,onMouseDown:this._draggerStart.handleMouseDown,onMouseEnter:this._draggerStart.handleMouseEnter,onMouseLeave:this._draggerStart.handleMouseLeave,position:Ie||0}),(0,n.jsx)(xe,{isDragging:re!=null,position:Ae||1,onMouseDown:this._draggerEnd.handleMouseDown,onMouseEnter:this._draggerEnd.handleMouseEnter,onMouseLeave:this._draggerEnd.handleMouseLeave}),he!=null&&this._getMarkers(he.anchor,he.shift)]}),ve&&(0,n.jsx)("div",{className:Me.ViewingLayerFullOverlay})]})}}const Ss=(0,de.cV)(Ft),Kt=()=>({container:(0,a.css)({padding:"0 0.5rem 0.5rem 0.5rem"}),canvasContainer:(0,a.css)({position:"relative"})}),Gt=60,_t=4;function Ut(h){return{valueOffset:h.relativeStartTime,valueWidth:h.duration,serviceName:h.process.serviceName}}function Ht(h){return h.spans.map(Ut)}const Is=(0,Se.A)(Ht);class an extends u.PureComponent{static{this.defaultProps={height:Gt}}render(){const{height:m,trace:x,viewRange:y,updateNextViewRangeTime:C,updateViewRangeTime:L}=this.props,D=Kt();if(!x)return(0,n.jsx)("div",{});const j=Is(x);return(0,n.jsxs)("div",{className:D.container,children:[(0,n.jsx)(yt,{numTicks:_t,duration:x.duration}),(0,n.jsxs)("div",{className:D.canvasContainer,children:[(0,n.jsx)(we,{valueWidth:x.duration,items:j}),(0,n.jsx)(Ss,{viewRange:y,numTicks:_t,height:m||Gt,updateViewRangeTime:L,updateNextViewRangeTime:C})]})]})}}var ws=c(28114);function ye(){const[h,m]=(0,u.useState)(new Set),x=(0,u.useCallback)(function(A){if(h.size===0)return;let re=-1,he=!0;const ve=A.reduce((Ie,Ae)=>(Ae.depth<=re&&(he=!0),he&&Ie.has(Ae.spanID)&&(Ie.delete(Ae.spanID),he=!1,re=Ae.depth),Ie),new Set(h));m(ve)},[h]),y=(0,u.useCallback)(function(A){if(Zt(A,h))return;let re;const he=A.reduce((ve,Ie)=>(re&&Ie.depth<=re.depth?(ve.add(re.spanID),Ie.hasChildren&&(re=Ie)):Ie.hasChildren&&!ve.has(Ie.spanID)&&(re=Ie),ve),new Set(h));re&&he.add(re.spanID),m(he)},[h]),C=(0,u.useCallback)(function(){m(new Set)},[]),L=(0,u.useCallback)(function(A){if(Zt(A,h))return;const re=A.reduce((he,ve)=>(ve.hasChildren&&he.add(ve.spanID),he),new Set);m(re)},[h]),D=(0,u.useCallback)(function(A){const re=new Set(h);h.has(A)?re.delete(A):re.add(A),m(re)},[h]);return{childrenHiddenIDs:h,expandOne:x,collapseOne:y,expandAll:C,collapseAll:L,childrenToggle:D}}function Zt(h,m){return h.filter(y=>y.hasChildren).length===m.size}function dt(h){const[m,x]=(0,u.useState)(new Map);(0,u.useEffect)(()=>{x(new Map)},[h,x]);const y=(0,u.useCallback)(function(j){const A=new Map(m);A.has(j)?A.delete(j):A.set(j,new be.DetailState),x(A)},[m]),C=(0,u.useCallback)(function(j,A){const re=m.get(j);if(!re)return;const he=re.toggleLogItem(A),ve=new Map(m);return ve.set(j,he),x(ve)},[m]),L=(0,u.useCallback)(function(j,A){const re=m.get(j);if(!re)return;const he=re.toggleReferenceItem(A),ve=new Map(m);return ve.set(j,he),x(ve)},[m]);return{detailStates:m,toggleDetail:y,detailLogItemToggle:C,detailLogsToggle:(0,u.useCallback)(D=>St("logs",m,x)(D),[m]),detailWarningsToggle:(0,u.useCallback)(D=>St("warnings",m,x)(D),[m]),detailStackTracesToggle:(0,u.useCallback)(D=>St("stackTraces",m,x)(D),[m]),detailReferenceItemToggle:L,detailReferencesToggle:(0,u.useCallback)(D=>St("references",m,x)(D),[m]),detailProcessToggle:(0,u.useCallback)(D=>St("process",m,x)(D),[m]),detailTagsToggle:(0,u.useCallback)(D=>St("tags",m,x)(D),[m])}}function St(h,m,x){return y=>{const C=m.get(y);if(!C)return;let L;h==="tags"?L=C.toggleTags():h==="process"?L=C.toggleProcess():h==="warnings"?L=C.toggleWarnings():h==="references"?L=C.toggleReferences():h==="stackTraces"?L=C.toggleStackTraces():L=C.toggleLogs();const D=new Map(m);D.set(y,L),x(D)}}function Ts(){const[h,m]=(0,u.useState)(new Set),x=(0,u.useCallback)(function(L){m(D=>{const j=new Set(D);return j.add(L),j})},[]),y=(0,u.useCallback)(function(L){m(D=>{const j=new Set(D);return j.delete(L),j})},[]);return{hoverIndentGuideIds:h,addHoverIndentGuideId:x,removeHoverIndentGuideId:y}}var Cs=c(15583);function Ds(){const[h,m]=(0,u.useState)({time:{current:[0,1]}}),x=(0,u.useCallback)(function(L){m(D=>{const j={...D.time,...L};return{...D,time:j}})},[]),y=(0,u.useCallback)(function(L,D){const A={current:[L,D]};m(re=>({...re,time:A}))},[]);return{viewRange:h,updateViewRangeTime:y,updateNextViewRangeTime:x}}const et=h=>({noDataMsg:(0,a.css)({height:"100%",width:"100%",display:"grid",placeItems:"center",fontSize:h.typography.h4.fontSize,color:h.colors.text.secondary})});function ks(h){const{traceProp:m,datasource:x,topOfViewRef:y,exploreId:C,createSpanLink:L,focusedSpanId:D,createFocusSpanLink:j}=h,{detailStates:A,toggleDetail:re,detailLogItemToggle:he,detailLogsToggle:ve,detailProcessToggle:Ie,detailReferencesToggle:Ae,detailReferenceItemToggle:tt,detailTagsToggle:Oe,detailWarningsToggle:Xe,detailStackTracesToggle:Me}=dt(h.dataFrames[0]),{removeHoverIndentGuideId:It,addHoverIndentGuideId:wt,hoverIndentGuideIds:ut}=Ts(),{viewRange:ht,updateViewRangeTime:gt,updateNextViewRangeTime:pt}=Ds(),{expandOne:Et,collapseOne:Tt,childrenToggle:Ls,collapseAll:Qt,childrenHiddenIDs:Yt,expandAll:Es}=ye(),{search:js,setSearch:Ns,spanFilterMatches:Xt}=(0,Cs.SQ)(m?.spans),[Ms,Fs]=(0,u.useState)(""),[Jt,As]=(0,T.A)(!1),[qt,es]=(0,u.useState)(!1),[ts,Os]=(0,u.useState)(!1),[Vs,Bs]=(0,u.useState)(100),[ss,_s]=(0,u.useState)({}),[Hs,Ps]=(0,u.useState)({}),Ct=(0,de.of)(et),[ns,$s]=(0,u.useState)(.4),[Pt,Ws]=Rs({refId:h.dataFrames[0]?.refId,exploreId:h.exploreId,datasource:x,splitOpenFn:h.splitOpenFn}),At=D??Pt,$t=j??Ws,rs=(0,u.useMemo)(()=>({childrenHiddenIDs:Yt,detailStates:A,hoverIndentGuideIds:ut,spanNameColumnWidth:ns,traceID:h.traceProp?.traceID}),[Yt,A,ut,ns,h.traceProp?.traceID]),Ot=(0,pe.tR)().getInstanceSettings(x?.name),Dt=I(Ot?.jsonData),as=Ot?.jsonData?.tracesToMetrics,Wt=Ot?.jsonData?.tracesToProfiles,Ks=Ot?.jsonData,Gs=(0,u.useMemo)(()=>L??(0,ws.lU)({splitOpenFn:h.splitOpenFn,traceToLogsOptions:Dt,traceToMetricsOptions:as,traceToProfilesOptions:Wt,dataFrame:h.dataFrames[0],createFocusSpanLink:$t,trace:m}),[h.splitOpenFn,Dt,as,Wt,h.dataFrames,$t,m,L]),is=(0,q.useSelector)(Zs=>(0,Ee.O)(Zs.user)),os=x?x?.type:"unknown",ls=h.scrollElement?h.scrollElement:document.getElementsByClassName(h.scrollElementClass??"")[0],Us=X(m);return(0,n.jsx)(n.Fragment,{children:h.dataFrames?.length&&m?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(be.TracePageHeader,{trace:m,data:h.dataFrames[0],timeZone:is,search:js,setSearch:Ns,showSpanFilters:Jt,setShowSpanFilters:As,showSpanFilterMatchesOnly:qt,setShowSpanFilterMatchesOnly:es,showCriticalPathSpansOnly:ts,setShowCriticalPathSpansOnly:Os,setFocusedSpanIdForSearch:Fs,spanFilterMatches:Xt,datasourceType:os,setHeaderHeight:Bs,app:C?N.Jk.Explore:N.Jk.Unknown}),(0,n.jsx)(an,{trace:m,viewRange:ht,updateNextViewRangeTime:pt,updateViewRangeTime:gt}),(0,n.jsx)(be.TraceTimelineViewer,{findMatchesIDs:Xt,trace:m,traceToProfilesOptions:Wt,datasourceType:os,spanBarOptions:Ks?.spanBar,traceTimeline:rs,updateNextViewRangeTime:pt,updateViewRangeTime:gt,viewRange:ht,timeZone:is,setSpanNameColumnWidth:$s,collapseAll:Qt,collapseOne:Tt,expandAll:Es,expandOne:Et,childrenToggle:Ls,detailLogItemToggle:he,detailLogsToggle:ve,detailWarningsToggle:Xe,detailStackTracesToggle:Me,detailReferencesToggle:Ae,detailReferenceItemToggle:tt,detailProcessToggle:Ie,detailTagsToggle:Oe,detailToggle:re,addHoverIndentGuideId:wt,removeHoverIndentGuideId:It,linksGetter:()=>[],createSpanLink:Gs,scrollElement:ls,focusedSpanId:At,focusedSpanIdForSearch:Ms,showSpanFilterMatchesOnly:qt,showCriticalPathSpansOnly:ts,createFocusSpanLink:$t,topOfViewRef:y,headerHeight:Vs,criticalPath:Us,traceFlameGraphs:ss,setTraceFlameGraphs:_s,redrawListView:Hs,setRedrawListView:Ps})]}):(0,n.jsx)("div",{className:Ct.noDataMsg,children:"No data"})})}function Rs(h){const m=(0,q.useSelector)(j=>j.explore.panes[h.exploreId]?.panelsState.trace),x=m?.spanId,y=(0,q.useDispatch)(),C=j=>y((0,Be.EA)(h.exploreId,"trace",{...m,spanId:j})),L=(0,q.useSelector)(j=>j.explore.panes[h.exploreId]?.queries.find(A=>A.refId===h.refId));return[x,(j,A)=>{const re={title:"Deep link to this span",url:"",internal:{datasourceUid:h.datasource?.uid,datasourceName:h.datasource?.name,query:{...L,query:j},panelsState:{trace:{spanId:A}}}},he=L?.queryType==="traceql"&&L.query===j;return(0,b.u)({link:re,internalLink:re.internal,scopedVars:{},field:{},onClickFn:he?()=>C(x===A?void 0:A):h.splitOpenFn?()=>h.splitOpenFn({datasourceUid:h.datasource?.uid,queries:[{...L,query:j}],panelsState:{trace:{spanId:A}}}):void 0,replaceVariables:(0,te.w)().replace.bind((0,te.w)())})}]}},71656:(S,v,c)=>{"use strict";c.d(v,{R:()=>a});var n=c(84140);function a(u,T,N){if(u.isLight)return T;{if(N){const p=(0,n.A)(T);return n.A.mostReadable(N,[p.clone().lighten(25),p.clone().lighten(10),p,p.clone().darken(10),p.clone().darken(25)],{includeFallbackColors:!1}).toHex8String()}const b=(0,n.A)(T).toHsl();b.l=1-b.l;const I=(0,n.A)(b);return I.isLight()?I.darken(5).toHex8String():I.lighten(5).toHex8String()}}},70673:(S,v,c)=>{"use strict";c.d(v,{DetailState:()=>nt,TracePageHeader:()=>kn,TraceTimelineViewer:()=>qn,filterSpans:()=>Pr,transformTraceData:()=>la});var n=c(74848),a=c(32196),u=c(96540),T=c(14110),N=c(32264),b=c(3911),I=c(40845),p=c(71656),H=c(75888),$=c.n(H);const W={scrollPageDown:{binding:"s",label:"Scroll down"},scrollPageUp:{binding:"w",label:"Scroll up"},scrollToNextVisibleSpan:{binding:"f",label:"Scroll to the next visible span"},scrollToPrevVisibleSpan:{binding:"b",label:"Scroll to the previous visible span"},panLeft:{binding:["a","left"],label:"Pan left"},panLeftFast:{binding:["shift+a","shift+left"],label:"Pan left \u2014 Large"},panRight:{binding:["d","right"],label:"Pan right"},panRightFast:{binding:["shift+d","shift+right"],label:"Pan right \u2014 Large"},zoomIn:{binding:"up",label:"Zoom in"},zoomInFast:{binding:"shift+up",label:"Zoom in \u2014 Large"},zoomOut:{binding:"down",label:"Zoom out"},zoomOutFast:{binding:"shift+down",label:"Zoom out \u2014 Large"},collapseAll:{binding:"]",label:"Collapse All"},expandAll:{binding:"[",label:"Expand All"},collapseOne:{binding:"p",label:"Collapse One Level"},expandOne:{binding:"o",label:"Expand One Level"},searchSpans:{binding:"ctrl+b",label:"Search Spans"},clearSearch:{binding:"escape",label:"Clear Search"}};let z;function te(){if(z)return z;const e=new($())(document.body);return z=e,e}function de(e){const t=te();Object.keys(e).forEach(s=>{const r=e[s];r&&t.bind(W[s].binding,r)})}function pe(){te().reset()}var Ee=c(46942),q=c.n(Ee),Be=c(6389);function be(e){const{min:t,max:s,viewStart:r,viewEnd:i}=e,o=s-t,l=t+r*o,g=s-(1-i)*o-l;return(f,w)=>({start:(f-l)/g,end:(w-l)/g})}function Se(e,t,s){return!Array.isArray(s.tags)||!s.tags.length?!1:s.tags.some(r=>r.key===e&&r.value===t)}const st=e=>e.kind==="client",We=Se.bind(null,"span.kind","client"),ot=e=>st(e)||We(e),lt=e=>e.kind==="server",vt=Se.bind(null,"span.kind","server"),xt=e=>lt(e)||vt(e),K=e=>e.statusCode===2,ee=Se.bind(null,"error",!0),Z=Se.bind(null,"error","true"),X=e=>K(e)||ee(e)||Z(e);function ae(e,t){const{depth:s}=e[t];let r=t+1;for(;r<e.length&&e[r].depth>s;r++)if(X(e[r]))return!0;return!1}function ie(e){if(e.length<=1||!ot(e[0]))return!1;const s=e[0].depth+1;let r=1;for(;r<e.length&&e[r].depth===s;){if(xt(e[r]))return e[r];r++}return null}const Y=e=>e.kind?e.kind==="client":e.tags.some(({key:t,value:s})=>t==="span.kind"&&s==="client"),ze=e=>({Ticks:(0,a.css)({label:"Ticks",pointerEvents:"none"}),TicksTick:(0,a.css)({label:"TicksTick",position:"absolute",height:"100%",width:"1px",background:(0,p.R)(e,"#d8d8d8"),"&:last-child":{width:0}}),TicksTickLabel:(0,a.css)({label:"TicksTickLabel",left:"0.25rem",position:"absolute"}),TicksTickLabelEndAnchor:(0,a.css)({label:"TicksTickLabelEndAnchor",left:"initial",right:"0.25rem"})});function _e({endTime:e=null,numTicks:t,showLabels:s=null,startTime:r=null}){let i;if(s){i=[];const d=(e||0)-(r||0);for(let g=0;g<t;g++){const f=(r||0)+g/(t-1)*d;i.push((0,Be.a3)(f))}}const o=(0,I.of)(ze),l=[];for(let d=0;d<t;d++){const g=d/(t-1);l.push((0,n.jsx)("div",{"data-testid":"TicksID",className:o.TicksTick,style:{left:`${g*100}%`},children:i&&(0,n.jsx)("span",{className:q()(o.TicksTickLabel,{[o.TicksTickLabelEndAnchor]:g>=1}),children:i[d]})},g))}return(0,n.jsx)("div",{className:o.Ticks,children:l})}const Lt=()=>({row:(0,a.css)({display:"flex",flex:"0 1 auto",flexDirection:"row"}),rowCell:(0,a.css)({position:"relative"})});function oe({children:e,className:t="",...s}){const r=(0,I.of)(Lt);return(0,n.jsx)("div",{className:q()(r.row,t),...s,children:e})}function je({children:e,className:t="",width:s,style:r={},...i}){const o=`${s*100}%`,l={...r,flexBasis:o,maxWidth:o},d=(0,I.of)(Lt);return(0,n.jsx)("div",{className:q()(d.rowCell,t),style:l,"data-testid":"TimelineRowCell",...i,children:e})}oe.Cell=je;var Re=c(29158);const Ne=()=>({TimelineCollapser:(0,a.css)({alignItems:"center",display:"flex",flex:"none",justifyContent:"center",marginRight:"0.5rem"})});function Ke(e){const{onExpandAll:t,onExpandOne:s,onCollapseAll:r,onCollapseOne:i}=e,o=(0,I.of)(Ne);return(0,n.jsxs)("div",{className:o.TimelineCollapser,"data-testid":"TimelineCollapser",children:[(0,n.jsx)(Re.K,{tooltip:"Expand +1",size:"xl",tooltipPlacement:"top",name:"angle-down",onClick:s}),(0,n.jsx)(Re.K,{tooltip:"Collapse +1",size:"xl",tooltipPlacement:"top",name:"angle-right",onClick:i}),(0,n.jsx)(Re.K,{tooltip:"Expand All",size:"xl",tooltipPlacement:"top",name:"angle-double-down",onClick:t}),(0,n.jsx)(Re.K,{tooltip:"Collapse All",size:"xl",tooltipPlacement:"top",name:"angle-double-right",onClick:r})]})}var me=c(92151);const we=()=>({TimelineColumnResizer:(0,a.css)({left:0,position:"absolute",right:0,top:0}),wrapper:(0,a.css)({bottom:0,position:"absolute",top:0}),dragger:(0,a.css)({borderLeft:"2px solid transparent",cursor:"col-resize",height:"5000px",marginLeft:"-1px",position:"absolute",top:0,width:"1px",zIndex:10,"&:hover":{borderLeft:"2px solid rgba(0, 0, 0, 0.3)"},"&::before":{position:"absolute",top:0,bottom:0,left:"-8px",right:0,content:'" "'}}),draggerDragging:(0,a.css)({background:"rgba(136, 0, 136, 0.05)",width:"unset","&::before":{left:-2e3,right:-2e3}}),draggerDraggingLeft:(0,a.css)({borderLeft:"2px solid #808",borderRight:"1px solid #999"}),draggerDraggingRight:(0,a.css)({borderLeft:"1px solid #999",borderRight:"2px solid #808"}),gripIcon:(0,a.css)({position:"absolute",top:0,bottom:0,"&::before, &::after":{borderRight:"1px solid #ccc",content:'" "',height:"9px",position:"absolute",right:"9px",top:"25px"},"&::after":{right:"5px"}}),gripIconDragging:(0,a.css)({"&::before, &::after":{borderRight:"1px solid rgba(136, 0, 136, 0.5)"}})});class Ge extends u.PureComponent{constructor(t){super(t),this._setRootElm=s=>{this._rootElm=s},this._getDraggingBounds=()=>{if(!this._rootElm)throw new Error("invalid state");const{left:s,width:r}=this._rootElm.getBoundingClientRect(),{min:i,max:o}=this.props;return{clientXLeft:s,width:r,maxValue:o,minValue:i}},this._handleDragUpdate=({value:s})=>{this.setState({dragPosition:s})},this._handleDragEnd=({manager:s,value:r})=>{s.resetBounds(),this.setState({dragPosition:null}),this.props.onChange(r)},this._dragManager=new me.default({getBounds:this._getDraggingBounds,onDragEnd:this._handleDragEnd,onDragMove:this._handleDragUpdate,onDragStart:this._handleDragUpdate}),this._rootElm=void 0,this.state={dragPosition:null}}componentWillUnmount(){this._dragManager.dispose()}render(){let t,s;const{position:r,columnResizeHandleHeight:i}=this.props,{dragPosition:o}=this.state;t=`${r*100}%`;const l={left:t};let d=!1,g=!1;const f=we();if(this._dragManager.isDragging()&&this._rootElm&&o!=null){d=o<r,g=o>r;const R=`${Math.min(r,o)*100}%`,k=`calc(${(1-Math.max(r,o))*100}% - 1px)`;s={left:R,right:k}}else s=l;s.height=i;const w=d||g;return(0,n.jsxs)("div",{className:f.TimelineColumnResizer,ref:this._setRootElm,"data-testid":"TimelineColumnResizer",children:[(0,n.jsx)("div",{className:q()(f.gripIcon,w&&f.gripIconDragging),style:l,"data-testid":"TimelineColumnResizer--gripIcon"}),(0,n.jsx)("div",{"aria-hidden":!0,className:q()(f.dragger,w&&f.draggerDragging,g&&f.draggerDraggingRight,d&&f.draggerDraggingLeft),onMouseDown:this._dragManager.handleMouseDown,style:s,"data-testid":"TimelineColumnResizer--dragger"})]})}}const Ue=(0,b.N)(()=>({TimelineViewingLayer:(0,a.css)({label:"TimelineViewingLayer",bottom:0,cursor:"vertical-text",left:0,position:"absolute",right:0,top:0}),TimelineViewingLayerCursorGuide:(0,a.css)({label:"TimelineViewingLayerCursorGuide",position:"absolute",top:0,bottom:0,left:0,width:"1px",backgroundColor:"red"}),TimelineViewingLayerDragged:(0,a.css)({label:"TimelineViewingLayerDragged",position:"absolute",top:0,bottom:0}),TimelineViewingLayerDraggedDraggingLeft:(0,a.css)({label:"TimelineViewingLayerDraggedDraggingLeft",borderLeft:"1px solid"}),TimelineViewingLayerDraggedDraggingRight:(0,a.css)({label:"TimelineViewingLayerDraggedDraggingRight",borderRight:"1px solid"}),TimelineViewingLayerDraggedShiftDrag:(0,a.css)({label:"TimelineViewingLayerDraggedShiftDrag",backgroundColor:"rgba(68, 68, 255, 0.2)",borderColor:"#44f"}),TimelineViewingLayerDraggedReframeDrag:(0,a.css)({label:"TimelineViewingLayerDraggedReframeDrag",backgroundColor:"rgba(255, 68, 68, 0.2)",borderColor:"#f44"}),TimelineViewingLayerFullOverlay:(0,a.css)({label:"TimelineViewingLayerFullOverlay",bottom:0,cursor:"col-resize",left:0,position:"fixed",right:0,top:0,userSelect:"none"})}));function yt(e){return Reflect.has(e,"isOutOfView")}function Fe(e,t,s){return e+s*(t-e)}function Ze(e,t,s){return(s-e)/(t-e)}function ms(e,t){let[s,r]=e<t?[e,t]:[t,e];return s>=1||r<=0?{isOutOfView:!0}:(s<0&&(s=0),r>1&&(r=1),{isDraggingLeft:e>t,left:`${s*100}%`,width:`${(r-s)*100}%`})}function ct(e,t,s,r,i){const o=Ze(e,t,s),l=Ze(e,t,r),d=ms(o,l);if(yt(d))return null;const{isDraggingLeft:g,left:f,width:w}=d,R=Ue(),k=(0,a.cx)({[R.TimelineViewingLayerDraggedDraggingRight]:!g,[R.TimelineViewingLayerDraggedReframeDrag]:!i,[R.TimelineViewingLayerDraggedShiftDrag]:i});return(0,n.jsx)("div",{className:(0,a.cx)(R.TimelineViewingLayerDragged,R.TimelineViewingLayerDraggedDraggingLeft,k),style:{left:f,width:w},"data-testid":"Dragged"})}class vs extends u.PureComponent{constructor(t){super(t),this._setRoot=s=>{this._root=s},this._getDraggingBounds=()=>{if(!this._root)throw new Error("invalid state");const{left:s,width:r}=this._root.getBoundingClientRect();return{clientXLeft:s,width:r}},this._handleReframeMouseMove=({value:s})=>{const[r,i]=this.props.viewRangeTime.current,o=Fe(r,i,s);this.props.updateNextViewRangeTime({cursor:o})},this._handleReframeMouseLeave=()=>{this.props.updateNextViewRangeTime({cursor:void 0})},this._handleReframeDragUpdate=({value:s})=>{const{current:r,reframe:i}=this.props.viewRangeTime,[o,l]=r,d=Fe(o,l,s),f={reframe:{anchor:i?i.anchor:d,shift:d}};this.props.updateNextViewRangeTime(f)},this._handleReframeDragEnd=({manager:s,value:r})=>{const{current:i,reframe:o}=this.props.viewRangeTime,[l,d]=i,g=Fe(l,d,r),f=o?o.anchor:g,[w,R]=g<f?[g,f]:[f,g];s.resetBounds(),this.props.updateViewRangeTime(w,R,"timeline-header")},this._draggerReframe=new me.default({getBounds:this._getDraggingBounds,onDragEnd:this._handleReframeDragEnd,onDragMove:this._handleReframeDragUpdate,onDragStart:this._handleReframeDragUpdate,onMouseLeave:this._handleReframeMouseLeave,onMouseMove:this._handleReframeMouseMove}),this._root=void 0}UNSAFE_componentWillReceiveProps(t){const{boundsInvalidator:s}=this.props;s!==t.boundsInvalidator&&this._draggerReframe.resetBounds()}componentWillUnmount(){this._draggerReframe.dispose()}render(){const{viewRangeTime:t}=this.props,{current:s,cursor:r,reframe:i,shiftEnd:o,shiftStart:l}=t,[d,g]=s,f=i!=null||o!=null||l!=null;let w;!f&&r!=null&&r>=d&&r<=g&&(w=`${Ze(d,g,r)*100}%`);const R=Ue();return(0,n.jsxs)("div",{"aria-hidden":!0,className:R.TimelineViewingLayer,ref:this._setRoot,onMouseDown:this._draggerReframe.handleMouseDown,onMouseLeave:this._draggerReframe.handleMouseLeave,onMouseMove:this._draggerReframe.handleMouseMove,"data-testid":"TimelineViewingLayer",children:[w!=null&&(0,n.jsx)("div",{className:R.TimelineViewingLayerCursorGuide,style:{left:w},"data-testid":"TimelineViewingLayer--cursorGuide"}),i!=null&&ct(d,g,i.anchor,i.shift,!1),o!=null&&ct(d,g,g,o,!0),l!=null&&ct(d,g,d,l,!0)]})}}const xs=e=>({TimelineHeaderRow:(0,a.css)({label:"TimelineHeaderRow",background:(0,p.R)(e,"#ececec"),borderBottom:`1px solid ${(0,p.R)(e,"#ccc")}`,height:"38px",lineHeight:"38px",width:"100%",zIndex:4,position:"relative"}),TimelineHeaderRowTitle:(0,a.css)({label:"TimelineHeaderRowTitle",flex:1,overflow:"hidden",margin:0,textOverflow:"ellipsis",whiteSpace:"nowrap"}),TimelineHeaderWrapper:(0,a.css)({label:"TimelineHeaderWrapper",alignItems:"center",display:"flex",paddingLeft:e.spacing(1),paddingRight:e.spacing(1)})});function ys(e){const{duration:t,nameColumnWidth:s,numTicks:r,onCollapseAll:i,onCollapseOne:o,onColummWidthChange:l,onExpandAll:d,onExpandOne:g,updateViewRangeTime:f,updateNextViewRangeTime:w,viewRangeTime:R,columnResizeHandleHeight:k}=e,[M,P]=R.current,O=(0,I.of)(xs);return(0,n.jsxs)(oe,{className:O.TimelineHeaderRow,"data-testid":"TimelineHeaderRow",children:[(0,n.jsxs)(oe.Cell,{className:O.TimelineHeaderWrapper,width:s,children:[(0,n.jsx)("h4",{className:O.TimelineHeaderRowTitle,children:"Service & Operation"}),(0,n.jsx)(Ke,{onCollapseAll:i,onExpandAll:d,onCollapseOne:o,onExpandOne:g})]}),(0,n.jsxs)(oe.Cell,{width:1-s,children:[(0,n.jsx)(vs,{boundsInvalidator:s,updateNextViewRangeTime:w,updateViewRangeTime:f,viewRangeTime:R}),(0,n.jsx)(_e,{numTicks:r,startTime:M*t,endTime:P*t,showLabels:!0})]}),(0,n.jsx)(Ge,{columnResizeHandleHeight:k,position:s,onChange:l,min:.2,max:.85})]})}var xe=c(2543),bt=c(41811),qe=c(27746);const bs="peer.service";var Ft=c(30700);class Ss{constructor(t){this.ys=[],this.heights=[],this.bufferLen=t,this.dataLen=-1,this.lastI=-1}profileData(t){t!==this.dataLen&&(this.dataLen=t,this.ys.length=t,this.heights.length=t,this.lastI>=t&&(this.lastI=t-1))}calcHeights(t,s,r){r!=null&&(this.lastI=r);let i=t+this.bufferLen;if(i<=this.lastI)return;i>=this.heights.length&&(i=this.heights.length-1);let o=this.lastI;for(this.lastI===-1&&(o=0,this.ys[0]=0);o<=i;){const l=this.heights[o]=s(o);this.ys[o+1]=this.ys[o]+l,o++}this.lastI=i}calcYs(t,s){for(;(this.ys[this.lastI]==null||t>this.ys[this.lastI])&&this.lastI<this.dataLen-1;)this.calcHeights(this.lastI,s)}confirmHeight(t,s){let r=t;if(r>this.lastI){this.calcHeights(r,s);return}const i=s(r);if(i===this.heights[r])return;const o=i-this.heights[r];for(this.heights[r]=i;++r<=this.lastI;)this.ys[r]+=o;this.ys[this.lastI+1]!=null&&(this.ys[this.lastI+1]+=o)}findFloorIndex(t,s){this.calcYs(t,s);let r=0,i=this.lastI;if(this.ys.length<2||t<this.ys[1])return 0;if(t>this.ys[i])return i;let o;for(;r<i;)if(o=r+.5*(i-r)|0,t>this.ys[o]){if(t<=this.ys[o+1])return o;r=o}else if(t<this.ys[o]){if(t>=this.ys[o-1])return o-1;i=o}else return o;throw new Error(`unable to find floor index for y=${t}`)}getRowPosition(t,s){return this.confirmHeight(t,s),{height:this.heights[t],y:this.ys[t]}}getEstimatedHeight(){const t=this.ys[this.lastI]+this.heights[this.lastI];return this.lastI>=this.dataLen-1?t|0:t/(this.lastI+1)*this.heights.length|0}}const Kt=100;class Gt extends u.Component{constructor(t){super(t),this.getViewHeight=()=>this._viewHeight,this.getBottomVisibleIndex=()=>{const s=this._scrollTop+this._viewHeight;return this._yPositions.findFloorIndex(s,this._getHeight)},this.getTopVisibleIndex=()=>this._yPositions.findFloorIndex(this._scrollTop,this._getHeight),this.getRowPosition=s=>this._yPositions.getRowPosition(s,this._getHeight),this.scrollToIndex=(s,r)=>{const{scrollElement:i}=this.props,o=i?.getBoundingClientRect().top||0,d=(i?.scrollTop||0)+(this._itemHolderElm?.getBoundingClientRect().top||0)-o,g=this.getRowPosition(s).y;this.props.scrollElement?.scrollTo({top:g+d-r-80})},this._onScroll=()=>{this._isScrolledOrResized||(this._isScrolledOrResized=!0,window.requestAnimationFrame(this._positionList))},this._positionList=()=>{if(this._isScrolledOrResized=!1,!this._wrapperElm)return;this._calcViewIndexes();const s=this.props.viewBufferMin>this._startIndex?0:this._startIndex-this.props.viewBufferMin,r=this.props.viewBufferMin<this.props.dataLength-this._endIndex?this._endIndex+this.props.viewBufferMin:this.props.dataLength-1;(s<this._startIndexDrawn||r>this._endIndexDrawn)&&this.forceUpdate()},this._initWrapper=s=>{this.props.windowScroller&&(this._wrapperElm=s,s&&(this._viewHeight=s.clientHeight))},this._initItemHolder=s=>{this._itemHolderElm=s,this._scanItemHeights()},this._scanItemHeights=()=>{const s=this.props.getIndexFromKey;if(!this._itemHolderElm)return;let r=null,i=null,o=!1;const l=this._itemHolderElm.childNodes,d=l.length;for(let g=0;g<d;g++){const f=l[g];if(f instanceof HTMLElement){const w=f.getAttribute("data-item-key");if(!w){console.warn("itemKey not found");continue}const k=(f.firstElementChild||f).clientHeight,M=this._knownHeights.get(w);k!==M&&(this._knownHeights.set(w,k),o?i=w:(o=!0,r=i=w))}}if(r!=null&&i!=null){const g=s(r),f=i===r?g:s(i);this._yPositions.calcHeights(f,this._getHeight,g),this.forceUpdate()}},this._getHeight=s=>{const r=this.props.getKeyFromIndex(s),i=this._knownHeights.get(r);return i!=null&&i===i?i:this.props.itemHeightGetter(s,r)},this._yPositions=new Ss(200),this._knownHeights=new Map,this._startIndexDrawn=2**20,this._endIndexDrawn=-(2**20),this._startIndex=0,this._endIndex=0,this._viewHeight=-1,this._scrollTop=-1,this._isScrolledOrResized=!1,this._htmlTopOffset=-1,this._windowScrollListenerAdded=!1,this._htmlElm=document.documentElement,this._wrapperElm=void 0,this._itemHolderElm=void 0}static{this.defaultProps={initialDraw:Kt,itemsWrapperClassName:"",windowScroller:!1}}componentDidMount(){if(this.props.windowScroller){if(this._wrapperElm){const{top:t}=this._wrapperElm.getBoundingClientRect();this._htmlTopOffset=t+this._htmlElm.scrollTop}window.addEventListener("scroll",this._onScroll),this._windowScrollListenerAdded=!0}else this._wrapperElm=this.props.scrollElement,this._wrapperElm?.addEventListener("scroll",this._onScroll)}componentDidUpdate(t){this._itemHolderElm&&this._scanItemHeights(),!this.props.windowScroller&&t.scrollElement!==this.props.scrollElement&&(t.scrollElement?.removeEventListener("scroll",this._onScroll),this._wrapperElm=this.props.scrollElement,this._wrapperElm?.addEventListener("scroll",this._onScroll))}componentWillUnmount(){this._windowScrollListenerAdded?window.removeEventListener("scroll",this._onScroll):this._wrapperElm?.removeEventListener("scroll",this._onScroll)}_isViewChanged(){if(!this._wrapperElm)return!1;const t=this.props.windowScroller,s=t?this._htmlElm.clientHeight:this._wrapperElm.clientHeight,r=t?this._htmlElm.scrollTop:this._wrapperElm.scrollTop;return s!==this._viewHeight||r!==this._scrollTop}_calcViewIndexes(){if(this.props.windowScroller)this._viewHeight=window.innerHeight-this._htmlTopOffset,this._scrollTop=window.scrollY;else{if(!this._wrapperElm){this._viewHeight=-1,this._startIndex=0,this._endIndex=0;return}this._viewHeight=this._wrapperElm.clientHeight,this._scrollTop=this._wrapperElm.scrollTop}const s=this._scrollTop,r=this._scrollTop+this._viewHeight;this._startIndex=this._yPositions.findFloorIndex(s,this._getHeight),this._endIndex=this._yPositions.findFloorIndex(r,this._getHeight)}render(){const{dataLength:t,getKeyFromIndex:s,initialDraw:r=Kt,itemRenderer:i,viewBuffer:o,viewBufferMin:l}=this.props,d=this._getHeight,g=[];let f,w;if(this._yPositions.profileData(t),!this._wrapperElm)f=0,w=(r<t?r:t)-1;else{this._isViewChanged()&&this._calcViewIndexes();const M=l>this._startIndex?0:this._startIndex-l,P=l<t-this._endIndex?this._endIndex+l:t-1;M<this._startIndexDrawn||P>this._endIndexDrawn?(f=o>this._startIndex?0:this._startIndex-o,w=this._endIndex+o,w>=t&&(w=t-1)):(f=this._startIndexDrawn>t-1?0:this._startIndexDrawn,w=this._endIndexDrawn>t-1?t-1:this._endIndexDrawn)}this._yPositions.calcHeights(w,d,f||-1),this._startIndexDrawn=f,this._endIndexDrawn=w,g.length=w-f+1;for(let M=f;M<=w;M++){const{y:P,height:O}=this._yPositions.getRowPosition(M,d),U={height:O,top:P,position:"absolute"},F=s(M),G={"data-item-key":F};g.push(i(F,U,M,G))}const R={style:{position:"relative"},ref:this._initWrapper};this.props.windowScroller||(R.onScroll=this._onScroll,R.style.height="100%",R.style.overflowY="auto");const k={position:"relative",height:this._yPositions.getEstimatedHeight()};return(0,n.jsx)("div",{...R,"data-testid":"ListView",children:(0,n.jsx)("div",{style:k,children:(0,n.jsx)("div",{style:{position:"absolute",top:0,margin:0,padding:0},className:this.props.itemsWrapperClassName,ref:this._initItemHolder,children:g})})})}}const _t="None",Ut="Duration",Ht="Tag";function Is({options:e,onOptionsChange:t}){const s=useStyles2(ws),r=[_t,Ut,Ht].map(toOption);return jsxs("div",{className:css({width:"100%"}),children:[jsx(InlineFieldRow,{className:s.row,children:jsx(InlineField,{label:"Label",labelWidth:26,tooltip:"Default: duration",grow:!0,children:jsx(Select,{inputId:"label",options:r,value:e.jsonData.spanBar?.type||"",onChange:i=>{updateDatasourcePluginJsonDataOption({onOptionsChange:t,options:e},"spanBar",{...e.jsonData.spanBar,type:i?.value??""})},placeholder:"Duration",isClearable:!0,"aria-label":"select-label-name",width:40})})}),e.jsonData.spanBar?.type===Ht&&jsx(InlineFieldRow,{className:s.row,children:jsx(InlineField,{label:"Tag key",labelWidth:26,tooltip:"Tag key which will be used to get the tag value. A span's attributes and resources will be searched for the tag key",children:jsx(Input,{type:"text",placeholder:"Enter tag key",onChange:i=>updateDatasourcePluginJsonDataOption({onOptionsChange:t,options:e},"spanBar",{...e.jsonData.spanBar,tag:i.currentTarget.value}),value:e.jsonData.spanBar?.tag||"",width:40})})})]})}const an=({options:e,onOptionsChange:t})=>{let s=e.type;return s+=e.type==="tempo"?"/configure-tempo-data-source/#span-bar":"/#span-bar",jsx(ConfigSubSection,{title:"Span bar",description:jsx(ConfigDescriptionLink,{description:"Add additional info next to the service and operation on a span bar row in the trace view.",suffix:s,feature:"the span bar"}),children:jsx(Is,{options:e,onOptionsChange:t})})},ws=e=>({infoText:css({label:"infoText",paddingBottom:e.spacing(2),color:e.colors.text.secondary}),row:css({label:"row",alignItems:"baseline"})});var ye=c(14578),Zt=c(13544),dt=c(56034),St=c(95868),Ts=c(13840);function Cs({children:e,content:t,overlayClassName:s}){const r=(0,u.useRef)(null);return(0,n.jsx)(St.I,{content:t,hideAfter:300,children:(i,o,l)=>(0,n.jsxs)(n.Fragment,{children:[r.current&&(0,n.jsx)(Ts.A,{...l,referenceElement:r.current,wrapperClassName:s,onMouseLeave:o,onMouseEnter:i}),(0,u.cloneElement)(e,{ref:r,onMouseEnter:i,onMouseLeave:o})]})})}const Ds="label";var et=c(55852);const ks=()=>({CopyIcon:(0,a.css)({backgroundColor:"transparent",border:"none",color:"inherit",height:"100%",overflow:"hidden","&:focus":{backgroundColor:"rgba(255, 255, 255, 0.25)",color:"inherit"}})});function Rs({copyText:e,icon:t="copy",tooltipTitle:s}){const r=(0,I.of)(ks),[i,o]=(0,u.useState)(!1),l=()=>{navigator.clipboard.writeText(e),o(!0)};return(0,n.jsx)(dt.m,{content:i?"Copied":s,children:(0,n.jsx)(et.$n,{className:q()(r.CopyIcon),type:"button",icon:t,onClick:l})})}var h=c(72834),m=c.n(h);const x="copyIcon",y=e=>({KeyValueTable:(0,a.css)({label:"KeyValueTable",background:(0,p.R)(e,"#fff"),border:`1px solid ${(0,p.R)(e,"#ddd")}`,marginBottom:"0.5rem",maxHeight:"450px",overflow:"auto"}),table:(0,a.css)({width:"100%"}),body:(0,a.css)({label:"body",verticalAlign:"baseline"}),row:(0,a.css)({label:"row","& > td":{padding:"0.5rem 0.5rem",height:"30px"},"&:nth-child(2n) > td":{background:(0,p.R)(e,"#f5f5f5")},[`&:not(:hover) .${x}`]:{visibility:"hidden"}}),keyColumn:(0,a.css)({label:"keyColumn",color:(0,p.R)(e,"#888"),whiteSpace:"pre",width:"125px",verticalAlign:"top"}),copyColumn:(0,a.css)({label:"copyColumn",textAlign:"right"}),linkIcon:(0,a.css)({label:"linkIcon",verticalAlign:"middle",fontWeight:"bold"}),jsonTable:(0,a.css)({display:"inline-block"})}),C=/^(\[|\{)/;function L(e){if(typeof e=="string"&&C.test(e))try{return JSON.parse(e)}catch{}return e}const D=({href:e,title:t="",children:s})=>(0,n.jsxs)("a",{href:e,title:t,target:"_blank",rel:"noopener noreferrer",children:[s," ",(0,n.jsx)(ye.I,{name:"external-link-alt"})]});function j(e){const{data:t,linksGetter:s}=e,r=(0,I.of)(y);return(0,n.jsx)("div",{className:q()(r.KeyValueTable),"data-testid":"KeyValueTable",children:(0,n.jsx)("table",{className:r.table,children:(0,n.jsx)("tbody",{className:r.body,children:t.map((i,o)=>{const l={__html:m()(L(i.value))},d=(0,n.jsx)("div",{className:r.jsonTable,dangerouslySetInnerHTML:l}),g=s?s(t,o):null;let f;return g&&g.length?f=(0,n.jsx)("div",{children:(0,n.jsx)(D,{href:g[0].url,title:g[0].text,children:d})}):f=d,(0,n.jsxs)("tr",{className:r.row,children:[(0,n.jsx)("td",{className:r.keyColumn,"data-testid":"KeyValueTable--keyColumn",children:i.key}),(0,n.jsx)("td",{children:f}),(0,n.jsx)("td",{className:r.copyColumn,children:(0,n.jsx)(Rs,{className:x,copyText:JSON.stringify(i,null,2),tooltipTitle:"Copy JSON"})})]},`${i.key}-${o}`)})})})})}var A=c(11908),re=c(72724),he=c(39601),ve=c(14689),Ie=c(25994),Ae=c(21744),tt=c(19071),Oe=c(28114);const Xe=e=>t=>({LabeledList:(0,a.css)({label:"LabeledList",listStyle:"none",margin:0,padding:0,...e?{marginRight:"-8px",display:"flex",flexWrap:"wrap",justifyContent:"flex-end"}:{}}),LabeledListItem:(0,a.css)({label:"LabeledListItem",display:"inline-block",...e?{borderRight:`1px solid ${(0,p.R)(t,"#ddd")}`,padding:"0 8px"}:{}}),LabeledListLabel:(0,a.css)({label:"LabeledListLabel",color:t.isLight?"#999":"#666",marginRight:"0.25rem"}),LabeledListValue:(0,a.css)({label:"LabeledListValue",marginRight:e?void 0:"0.55rem"})});function Me(e){const{className:t,divider:s=!1,items:r}=e,i=(0,I.of)(Xe(s));return(0,n.jsx)("ul",{className:q()(i.LabeledList,t),children:r.map(({key:o,label:l,value:d})=>(0,n.jsxs)("li",{className:i.LabeledListItem,children:[(0,n.jsx)("span",{className:i.LabeledListLabel,children:l}),(0,n.jsx)("strong",{className:i.LabeledListValue,children:d})]},`${o}`))})}const It="kind",wt="status",ut="status.message",ht="library.name",gt="library.version",pt="trace.state",Et="id";var Tt=c(92102);function Ls(e){const{reference:t,children:s,createFocusSpanLink:r}=e,i=r(t.traceID,t.spanID);return(0,n.jsx)("a",{href:i.href,target:i.target,rel:"noopener noreferrer",onClick:i.onClick?o=>{o.preventDefault(),i.onClick(o)}:void 0,children:s})}const Qt=e=>({AccordianReferenceItem:(0,a.css)({borderBottom:`1px solid ${(0,p.R)(e,"#d8d8d8")}`}),AccordianKeyValues:(0,a.css)({marginLeft:"10px"}),AccordianReferences:(0,a.css)({label:"AccordianReferences",border:`1px solid ${(0,p.R)(e,"#d8d8d8")}`,position:"relative",marginBottom:"0.25rem"}),AccordianReferencesHeader:(0,a.css)({label:"AccordianReferencesHeader",background:(0,p.R)(e,"#e4e4e4"),color:"inherit",display:"block",padding:"0.25rem 0.5rem","&:hover":{background:(0,p.R)(e,"#dadada")}}),AccordianReferencesContent:(0,a.css)({label:"AccordianReferencesContent",background:(0,p.R)(e,"#f0f0f0"),borderTop:`1px solid ${(0,p.R)(e,"#d8d8d8")}`,padding:"0.5rem 0.5rem 0.25rem 0.5rem"}),AccordianReferencesFooter:(0,a.css)({label:"AccordianReferencesFooter",color:(0,p.R)(e,"#999")}),AccordianKeyValuesItem:(0,a.css)({marginBottom:e.spacing(.5)}),ReferencesList:(0,a.css)({background:"#fff",border:"1px solid #ddd",marginBottom:"0.7em",maxHeight:"450px",overflow:"auto"}),list:(0,a.css)({width:"100%",listStyle:"none",padding:0,margin:0,background:"#fff"}),itemContent:(0,a.css)({padding:"0.25rem 0.5rem",display:"flex",width:"100%",justifyContent:"space-between"}),item:(0,a.css)({"&:nth-child(2n)":{background:"#f5f5f5"}}),debugInfo:(0,a.css)({letterSpacing:"0.25px",margin:"0.5em 0 0",flexWrap:"wrap",display:"flex",justifyContent:"flex-end"}),debugLabel:(0,a.css)({margin:"0 5px 0 5px","&::before":{color:"#bbb",content:"attr(data-label)"}}),serviceName:(0,a.css)({marginRight:"8px"}),title:(0,a.css)({display:"flex",alignItems:"center",gap:"4px"})});function Yt(e){const{data:t,createFocusSpanLink:s,openedItems:r,onItemToggle:i,interactive:o}=e,l=(0,I.of)(Qt);return(0,n.jsx)("div",{className:l.AccordianReferencesContent,children:t.map((d,g)=>(0,n.jsxs)("div",{className:g<t.length-1?l.AccordianReferenceItem:void 0,children:[(0,n.jsx)("div",{className:l.item,children:(0,n.jsx)(Ls,{reference:d,createFocusSpanLink:s,children:(0,n.jsxs)("span",{className:l.itemContent,children:[d.span?(0,n.jsxs)("span",{children:[(0,n.jsx)("span",{className:(0,a.cx)("span-svc-name",l.serviceName),children:d.span.process.serviceName}),(0,n.jsx)("small",{className:"endpoint-name",children:d.span.operationName})]}):(0,n.jsxs)("span",{className:(0,a.cx)("span-svc-name",l.title),children:["View Linked Span ",(0,n.jsx)(ye.I,{name:"external-link-alt"})]}),(0,n.jsxs)("small",{className:l.debugInfo,children:[(0,n.jsx)("span",{className:l.debugLabel,"data-label":"TraceID:",children:d.traceID}),(0,n.jsx)("span",{className:l.debugLabel,"data-label":"SpanID:",children:d.spanID})]})]})})},`${d.spanID}`),!!d.tags?.length&&(0,n.jsx)("div",{className:l.AccordianKeyValues,children:(0,n.jsx)(At,{className:g<t.length-1?l.AccordianKeyValuesItem:null,data:d.tags||[],highContrast:!0,interactive:o,isOpen:r?r.has(d):!1,label:"attributes",linksGetter:null,onToggle:o&&i?()=>i(d):null})})]},g))})}const Es=({data:e,interactive:t=!0,isOpen:s,onToggle:r,onItemToggle:i,openedItems:o,createFocusSpanLink:l})=>{const d=!Array.isArray(e)||!e.length;let g=null,f="span",w=null;t&&(g=s?(0,n.jsx)(ye.I,{name:"angle-down",className:Ct}):(0,n.jsx)(ye.I,{name:"angle-right",className:Ct}),f="a",w={"aria-checked":s,onClick:d?null:r,role:"switch"});const R=(0,I.of)(Qt);return(0,n.jsxs)("div",{className:R.AccordianReferences,children:[(0,n.jsxs)(f,{className:R.AccordianReferencesHeader,...w,children:[g,(0,n.jsx)("strong",{children:(0,n.jsx)("span",{children:"References"})})," ","(",e.length,")"]}),s&&(0,n.jsx)(Yt,{data:e,openedItems:o,createFocusSpanLink:l,onItemToggle:i,interactive:t})]})},js=u.memo(Es),Ns=()=>({TextList:(0,a.css)({maxHeight:"450px",overflow:"auto"}),List:(0,a.css)({width:"100%",listStyle:"none",padding:0,margin:0}),item:(0,a.css)({padding:"0.25rem 0.5rem",verticalAlign:"top","&:nth-child(2n)":{background:"#f5f5f5"}})});function Xt(e){const{data:t}=e,s=(0,I.of)(Ns);return(0,n.jsx)("div",{className:q()(s.TextList),"data-testid":"TextList",children:(0,n.jsx)("ul",{className:s.List,children:t.map((r,i)=>(0,n.jsx)("li",{className:s.item,children:r},`${i}`))})})}const Ms=e=>({header:(0,a.css)({cursor:"pointer",overflow:"hidden",padding:"0.25em 0.1em",textOverflow:"ellipsis",whiteSpace:"nowrap","&:hover":{background:(0,p.R)(e,"#e8e8e8")}})});function Fs({data:e}){return(0,n.jsx)(Xt,{data:e})}function Jt({className:e=null,data:t,headerClassName:s,highContrast:r=!1,interactive:i=!0,isOpen:o,label:l,onToggle:d=null,TextComponent:g=Fs}){const f=!Array.isArray(t)||!t.length,w=(0,I.of)(Pt),R=q()(Ct,{[w.emptyIcon]:f});let k=null,M=null;i&&(k=o?(0,n.jsx)(ye.I,{name:"angle-down",className:R}):(0,n.jsx)(ye.I,{name:"angle-right",className:R}),M={"aria-checked":o,onClick:f?null:d,role:"switch"});const P=(0,I.of)(Ms);return(0,n.jsxs)("div",{className:e||"",children:[(0,n.jsxs)("div",{className:q()(P.header,s),...M,"data-testid":"AccordianText--header",children:[k,(0,n.jsx)("strong",{children:l})," (",t.length,")"]}),o&&(0,n.jsx)(g,{data:t})]})}var As=c(49185),qt=c(75505),es=c(47232),ts=c(41987),Os=c(85194),Vs=c(26657),Bs=c(72574),ss=c(31193);function _s(e){const{span:t,traceToProfilesOptions:s,timeZone:r,traceFlameGraphs:i,setTraceFlameGraphs:o,setRedrawListView:l,traceDuration:d,traceName:g}=e,[f,{height:w}]=(0,As.A)(),R=(0,I.of)(Hs),k=t.tags.filter(F=>F.key===Oe.QW),M=k.length>0?k[0].value:void 0,P=(0,u.useCallback)(()=>{const F=Math.floor(t.startTime/1e3)-3e4,G=(t.startTime+t.duration)/1e3+3e4,J=(0,es.KQ)(G),V=(0,es.KQ)(F);return{from:V,to:J,raw:{from:V,to:J}}},[t.duration,t.startTime]),O=async(F,G)=>{const J=await(0,ss.tR)().get(G);if(J instanceof Vs.iy){const se=(await(0,qt.s)(J.query(F))).data.find(ce=>ce.name==="response");if(se&&se.length>1)return se}},U=(0,u.useCallback)(async(F,G,J)=>{let V="{}";if(G.customQuery&&G.query){const fe={...(0,Oe.gt)(d,g,J.traceID),...(0,Oe.hv)(J),...(0,Oe.Cr)(J,G)};V=(0,Bs.w)().replace(G.query,fe)}else{const fe=G.tags&&G.tags.length>0?G.tags:Oe.i0;V=`{${(0,Oe._o)(J,fe)}}`}const se={requestId:"span-flamegraph-requestId",interval:"2s",intervalMs:2e3,range:P(),scopedVars:{},app:ts.Jk.Unknown,timezone:r,startTime:J.startTime,targets:[{labelSelector:V,groupBy:[],profileTypeId:G.profileTypeId??"",queryType:"profile",spanSelector:[M],refId:"span-flamegraph-refId",datasource:{type:F.type,uid:F.uid}}]},ce=await O(se,F.uid);ce&&ce.length>0&&o({...i,[M]:ce})},[P,M,o,r,d,i,g]);return(0,u.useEffect)(()=>{if(!Object.keys(i).includes(M)){let F;s&&s?.datasourceUid&&(F=(0,ss.tR)().getInstanceSettings(s.datasourceUid)),s&&F&&U(F,s,t)}},[o,t,i,s,P,r,U,M]),(0,u.useEffect)(()=>{l({})},[w,l]),i[M]?(0,n.jsxs)("div",{className:R.flameGraph,ref:f,children:[(0,n.jsx)("div",{className:R.flameGraphTitle,children:"Flame graph"}),(0,n.jsx)(Os.A,{data:i[M],getTheme:()=>N.$.theme2,showFlameGraphOnly:!0,disableCollapsing:!0})]}):(0,n.jsx)(n.Fragment,{})}const Hs=()=>({flameGraph:(0,a.css)({label:"flameGraphInSpan",margin:"5px"}),flameGraphTitle:(0,a.css)({label:"flameGraphTitleInSpan",marginBottom:"5px",fontWeight:"bold"})}),Ps=e=>({header:(0,a.css)({display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:"0 1rem",marginBottom:"0.25rem"}),listWrapper:(0,a.css)({overflow:"hidden"}),list:(0,a.css)({textAlign:"right"}),operationName:(0,a.css)({margin:0}),debugInfo:(0,a.css)({label:"debugInfo",display:"block",letterSpacing:"0.25px",margin:"0.5em 0 -0.75em",textAlign:"right"}),debugLabel:(0,a.css)({label:"debugLabel","&::before":{color:(0,p.R)(e,"#bbb"),content:"attr(data-label)"}}),debugValue:(0,a.css)({label:"debugValue",backgroundColor:"inherit",border:"none",color:(0,p.R)(e,"#888"),cursor:"pointer","&:hover":{color:(0,p.R)(e,"#333")}}),AccordianWarnings:(0,a.css)({label:"AccordianWarnings",background:(0,p.R)(e,"#fafafa"),border:`1px solid ${(0,p.R)(e,"#e4e4e4")}`,marginBottom:"0.25rem"}),AccordianWarningsHeader:(0,a.css)({label:"AccordianWarningsHeader",background:(0,p.R)(e,"#fff7e6"),padding:"0.25rem 0.5rem","&:hover":{background:(0,p.R)(e,"#ffe7ba")}}),AccordianWarningsHeaderOpen:(0,a.css)({label:"AccordianWarningsHeaderOpen",borderBottom:`1px solid ${(0,p.R)(e,"#e8e8e8")}`}),AccordianWarningsLabel:(0,a.css)({label:"AccordianWarningsLabel",color:(0,p.R)(e,"#d36c08")}),AccordianKeyValuesItem:(0,a.css)({marginBottom:e.spacing(.5)}),Textarea:(0,a.css)({wordBreak:"break-all",whiteSpace:"pre"}),LinkIcon:(0,a.css)({fontSize:"1.5em"}),linkList:(0,a.css)({display:"flex",flexWrap:"wrap",gap:"10px"})}),Ct=(0,a.css)({margin:"-0.2rem 0.25rem 0 0"});function ns(e){const{detailState:t,linksGetter:s,logItemToggle:r,logsToggle:i,processToggle:o,span:l,tagsToggle:d,traceStartTime:g,traceDuration:f,traceName:w,warningsToggle:R,stackTracesToggle:k,referencesToggle:M,referenceItemToggle:P,createSpanLink:O,createFocusSpanLink:U,datasourceType:F,traceFlameGraphs:G,setTraceFlameGraphs:J,traceToProfilesOptions:V,setRedrawListView:se}=e,{isTagsOpen:ce,isProcessOpen:fe,logs:Te,isWarningsOpen:Le,references:ge,isStackTracesOpen:Qe}=t,{operationName:Pe,process:Ce,duration:Ye,relativeStartTime:at,startTime:Je,traceID:it,spanID:De,logs:E,tags:_,warnings:Q,references:ne,stackTraces:$e}=l,{timeZone:ke}=e;let He=[{key:"svc",label:"Service:",value:Ce.serviceName},{key:"duration",label:"Duration:",value:(0,Be.a3)(Ye)},{key:"start",label:"Start Time:",value:(0,Be.a3)(at)+$s(Je,ke)},...l.childSpanCount>0?[{key:"child_count",label:"Child Count:",value:l.childSpanCount}]:[]];const le=(0,I.of)(Ps);l.kind&&He.push({key:It,label:"Kind:",value:l.kind}),l.statusCode!==void 0&&He.push({key:wt,label:"Status:",value:A.s[l.statusCode].toLowerCase()}),l.statusMessage&&He.push({key:ut,label:"Status Message:",value:l.statusMessage}),l.instrumentationLibraryName&&He.push({key:ht,label:"Library Name:",value:l.instrumentationLibraryName}),l.instrumentationLibraryVersion&&He.push({key:gt,label:"Library Version:",value:l.instrumentationLibraryVersion}),l.traceState&&He.push({key:pt,label:"Trace State:",value:l.traceState});const kt=(ue,mt,Nt,Mt)=>(0,n.jsx)(ve.R,{link:{...ue,title:Nt,target:"_blank",origin:ue.field,onClick:Rt=>{(0,T.rR)("grafana_traces_trace_view_span_link_clicked",{datasourceType:F,grafana_version:N.$.buildInfo.version,type:mt,location:"spanDetails"}),ue.onClick?ue.onClick?.(Rt):he.Ny.push(ue.href)}},buttonProps:{icon:Mt}});let Bt=null,En=null,jn=null;if(O){const ue=O(l),mt=ue?.filter(Rt=>Rt.type===Tt.N.Logs);ue&&mt&&mt.length>0&&(Bt=kt(mt[0],Tt.N.Logs,"Logs for this span","gf-logs"));const Nt=ue?.filter(Rt=>Rt.type===Tt.N.Profiles&&Rt.title===tt.cd);ue&&Nt&&Nt.length>0&&(En=kt(Nt[0],Tt.N.Profiles,"Profiles for this span","link"));const Mt=ue?.filter(Rt=>Rt.type===Tt.N.Session);ue&&Mt&&Mt.length>0&&(jn=kt(Mt[0],Tt.N.Session,"Session for this span","frontend-observability"))}const rn=U(it,De);return(0,n.jsxs)("div",{"data-testid":"span-detail-component",children:[(0,n.jsxs)("div",{className:le.header,children:[(0,n.jsx)("h2",{className:le.operationName,children:Pe}),(0,n.jsx)("div",{className:le.listWrapper,children:(0,n.jsx)(Me,{className:le.list,divider:!0,items:He})})]}),(0,n.jsxs)("div",{className:le.linkList,children:[Bt,En,jn]}),(0,n.jsx)(Ie.c,{spacing:1}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(At,{data:_,label:"Span Attributes",linksGetter:s,isOpen:ce,onToggle:()=>d(De)}),Ce.tags&&(0,n.jsx)(At,{className:le.AccordianKeyValuesItem,data:Ce.tags,label:"Resource Attributes",linksGetter:s,isOpen:fe,onToggle:()=>o(De)})]}),E&&E.length>0&&(0,n.jsx)(rs,{linksGetter:s,logs:E,isOpen:Te.isOpen,openedItems:Te.openedItems,onToggle:()=>i(De),onItemToggle:ue=>r(De,ue),timestamp:g}),Q&&Q.length>0&&(0,n.jsx)(Jt,{className:le.AccordianWarnings,headerClassName:le.AccordianWarningsHeader,label:(0,n.jsx)("span",{className:le.AccordianWarningsLabel,children:"Warnings"}),data:Q,isOpen:Le,onToggle:()=>R(De)}),$e?.length?(0,n.jsx)(Jt,{label:"Stack trace",data:$e,isOpen:Qe,TextComponent:ue=>{let mt;return ue.data?.length>1?mt=ue.data.map((Nt,Mt)=>`StackTrace ${Mt+1}:
${Nt}`).join(`
`):mt=ue.data?.[0],(0,n.jsx)(Ae.f,{className:le.Textarea,style:{cursor:"unset"},readOnly:!0,cols:10,rows:10,value:mt})},onToggle:()=>k(De)}):null,ne&&ne.length>0&&(ne.length>1||ne[0].refType!=="CHILD_OF")&&(0,n.jsx)(js,{data:ne,isOpen:ge.isOpen,openedItems:ge.openedItems,onToggle:()=>M(De),onItemToggle:ue=>P(De,ue),createFocusSpanLink:U}),l.tags.some(ue=>ue.key===Oe.QW)&&(0,n.jsx)(_s,{span:l,timeZone:ke,traceFlameGraphs:G,setTraceFlameGraphs:J,traceToProfilesOptions:V,setRedrawListView:se,traceDuration:f,traceName:w}),(0,n.jsxs)("small",{className:le.debugInfo,children:[(0,n.jsx)("a",{...rn,onClick:ue=>{rn.onClick&&ue.button===0&&(!ue.currentTarget.target||ue.currentTarget.target==="_self")&&!(ue.metaKey||ue.altKey||ue.ctrlKey||ue.shiftKey)&&(ue.preventDefault(),rn.onClick(ue))},children:(0,n.jsx)(ye.I,{name:"link",className:q()(Ct,le.LinkIcon)})}),(0,n.jsx)("span",{className:le.debugLabel,"data-label":"SpanID:"})," ",De]})]})]})}const $s=(e,t)=>{const s=(0,re.LE)(e/1e3,{timeZone:t,defaultWithMS:!0}),r=s.split(" ");return` (${r[1]?r[1]:s})`},Pt=e=>({container:(0,a.css)({textOverflow:"ellipsis"}),header:(0,a.css)({label:"header",cursor:"pointer",overflow:"hidden",padding:"0.25em 0.1em",textOverflow:"ellipsis",whiteSpace:"nowrap","&:hover":{background:(0,p.R)(e,"#e8e8e8")}}),headerEmpty:(0,a.css)({label:"headerEmpty",background:"none",cursor:"initial"}),headerHighContrast:(0,a.css)({label:"headerHighContrast","&:hover":{background:(0,p.R)(e,"#ddd")}}),emptyIcon:(0,a.css)({label:"emptyIcon",color:(0,p.R)(e,"#aaa")}),summary:(0,a.css)({label:"summary",display:"inline",listStyle:"none",padding:0}),summaryItem:(0,a.css)({label:"summaryItem",display:"inline",paddingRight:"0.5rem",borderRight:`1px solid ${(0,p.R)(e,"#ddd")}`,"&:last-child":{paddingRight:0,borderRight:"none"}}),summaryLabel:(0,a.css)({label:"summaryLabel",color:(0,p.R)(e,"#777")}),summaryDelim:(0,a.css)({label:"summaryDelim",color:(0,p.R)(e,"#bbb"),padding:"0 0.2em"})});function Ws({data:e=null}){const t=(0,I.of)(Pt);return!Array.isArray(e)||!e.length?null:(0,n.jsx)("ul",{className:t.summary,children:e.map((s,r)=>(0,n.jsxs)("li",{className:t.summaryItem,children:[(0,n.jsx)("span",{className:t.summaryLabel,children:s.key}),(0,n.jsx)("span",{className:t.summaryDelim,children:"="}),String(s.value)]},`${s.key}-${r}`))})}function At({className:e=null,data:t,logName:s,highContrast:r=!1,interactive:i=!0,isOpen:o,label:l,linksGetter:d,onToggle:g=null}){const f=(!Array.isArray(t)||!t.length)&&!s,w=(0,I.of)(Pt),R=q()(Ct,{[w.emptyIcon]:f});let k=null,M=null;const P=s?[{key:"event name",value:s},...t]:t;i&&(k=o?(0,n.jsx)(ye.I,{name:"angle-down",className:R}):(0,n.jsx)(ye.I,{name:"angle-right",className:R}),M={"aria-checked":o,onClick:f?null:g,role:"switch"});const O=t.length>0&&!o;return(0,n.jsxs)("div",{className:q()(e,w.container),children:[(0,n.jsxs)("div",{className:q()(w.header,{[w.headerEmpty]:f,[w.headerHighContrast]:r&&!f}),...M,"data-testid":"AccordianKeyValues--header",children:[k,(0,n.jsxs)("strong",{"data-test":Ds,children:[l,O&&":"]}),O&&(0,n.jsx)("span",{className:(0,a.css)({marginLeft:"0.7em"}),children:(0,n.jsx)(Ws,{data:t})})]}),o&&(0,n.jsx)(j,{data:P,linksGetter:d})]})}const $t=e=>({AccordianLogs:(0,a.css)({label:"AccordianLogs",border:`1px solid ${(0,p.R)(e,"#d8d8d8")}`,position:"relative",marginBottom:"0.25rem"}),AccordianLogsHeader:(0,a.css)({label:"AccordianLogsHeader",background:(0,p.R)(e,"#e4e4e4"),color:"inherit",display:"block",padding:"0.25rem 0.5rem","&:hover":{background:(0,p.R)(e,"#dadada")}}),AccordianLogsContent:(0,a.css)({label:"AccordianLogsContent",background:(0,p.R)(e,"#f0f0f0"),borderTop:`1px solid ${(0,p.R)(e,"#d8d8d8")}`,padding:"0.5rem 0.5rem 0.25rem 0.5rem"}),AccordianLogsFooter:(0,a.css)({label:"AccordianLogsFooter",color:(0,p.R)(e,"#999")}),AccordianKeyValuesItem:(0,a.css)({marginBottom:e.spacing(.5)}),parenthesis:(0,a.css)({color:`${(0,p.R)(e,"#777")}`})});function rs({interactive:e=!0,isOpen:t,linksGetter:s,logs:r,openedItems:i,onItemToggle:o,onToggle:l,timestamp:d}){let g=null,f="span",w=null;e&&(g=t?(0,n.jsx)(ye.I,{name:"angle-down",className:Ct}):(0,n.jsx)(ye.I,{name:"angle-right",className:"u-align-icon"}),f="a",w={"aria-checked":t,onClick:l,role:"switch"});const R=(0,I.of)($t);return(0,n.jsxs)("div",{className:R.AccordianLogs,children:[(0,n.jsxs)(f,{className:R.AccordianLogsHeader,...w,children:[g," ",(0,n.jsx)("strong",{children:"Events"})," (",r.length,")"]}),t&&(0,n.jsxs)("div",{className:R.AccordianLogsContent,children:[(0,xe.sortBy)(r,"timestamp").map((k,M)=>{const P=(0,Be.a3)(k.timestamp-d),O=k.name&&k.name.length>20,U=k.name&&O?k.name.slice(0,20)+"...":k.name,F=U?(0,n.jsxs)("span",{children:[P," ",(0,n.jsxs)("span",{children:["(",U,")"]})]}):P;return(0,n.jsx)(At,{className:M<r.length-1?R.AccordianKeyValuesItem:null,data:k.fields||[],logName:O?k.name:void 0,highContrast:!0,interactive:e,isOpen:i?i.has(k):!1,label:F,linksGetter:s,onToggle:e&&o?()=>o(k):null},`${k.timestamp}-${M}`)}),(0,n.jsx)("small",{className:R.AccordianLogsFooter,children:"Event timestamps are relative to the start time of the full trace."})]})]})}const Ot=e=>({wrapper:(0,a.css)({label:"wrapper",bottom:0,left:0,position:"absolute",right:0,top:0,overflow:"hidden",zIndex:0}),bar:(0,a.css)({label:"bar",borderRadius:e.shape.radius.default,minWidth:"2px",position:"absolute",height:"36%",top:"32%"}),rpc:(0,a.css)({label:"rpc",position:"absolute",top:"35%",bottom:"35%",zIndex:1}),label:(0,a.css)({label:"label",color:"#aaa",fontSize:"12px",fontFamily:"'Helvetica Neue', Helvetica, Arial, sans - serif",lineHeight:"1em",whiteSpace:"nowrap",padding:"0 0.5em",position:"absolute"}),logMarker:(0,a.css)({label:"logMarker",backgroundColor:(0,p.R)(e,"#2c3235"),cursor:"pointer",height:"60%",minWidth:"1px",position:"absolute",top:"20%","&:hover":{backgroundColor:(0,p.R)(e,"#464c54")},"&::before, &::after":{content:"''",position:"absolute",top:0,bottom:0,right:0,border:"1px solid transparent"},"&::after":{left:0}}),criticalPath:(0,a.css)({position:"absolute",top:"45%",height:"11%",zIndex:2,overflow:"hidden",background:(0,p.R)(e,"#f1f1f1"),borderLeft:`1px solid ${(0,p.R)(e,"#2c3235")}`,borderRight:`1px solid ${(0,p.R)(e,"#2c3235")}`})});function Dt(e){return`${(e*100).toFixed(1)}%`}function zs(e){return`${e*100}%`}function as({criticalPath:e,viewEnd:t,viewStart:s,getViewedBounds:r,color:i,shortLabel:o,longLabel:l,onClick:d,rpc:g,traceStartTime:f,span:w,className:R,labelClassName:k}){const[M,P]=(0,u.useState)(o),O=()=>P(o),U=()=>P(l),F=(0,xe.groupBy)(w.logs,J=>{const V=r(J.timestamp,J.timestamp).start;return Dt(Math.round(V*500)/500)}),G=(0,I.of)(Ot);return(0,n.jsxs)("div",{className:q()(G.wrapper,R),onBlur:O,onClick:d,onFocus:U,onMouseOut:O,onMouseOver:U,"aria-hidden":!0,"data-testid":Zt.Tp.components.TraceViewer.spanBar,children:[(0,n.jsx)("div",{"aria-label":M,className:q()(G.bar),style:{background:i,left:Dt(s),width:Dt(t-s)},children:(0,n.jsx)("div",{className:q()(G.label,k),"data-testid":"SpanBar--label",children:M})}),(0,n.jsx)("div",{children:Object.keys(F).map(J=>(0,n.jsx)(Cs,{content:(0,n.jsx)(rs,{interactive:!1,isOpen:!0,logs:F[J],timestamp:f}),children:(0,n.jsx)("div",{"data-testid":"SpanBar--logMarker",className:q()(G.logMarker),style:{left:J}})},J))}),g&&(0,n.jsx)("div",{className:q()(G.rpc),style:{background:g.color,left:Dt(g.viewStart),width:Dt(g.viewEnd-g.viewStart)}}),e?.map((J,V)=>{const se=r(J.section_start,J.section_end),ce=se.start,fe=se.end,Te=`${J.spanId}-${V}`;return(0,n.jsx)(dt.m,{placement:"top",content:(0,n.jsxs)("div",{children:["A segment on the ",(0,n.jsx)("em",{children:"critical path"})," of the overall trace / request / workflow."]}),children:(0,n.jsx)("div",{"data-testid":"SpanBar--criticalPath",className:G.criticalPath,style:{left:zs(ce),width:zs(fe-ce)}})},Te)})]})}const on=u.memo(as);var Wt=c(64539),Ks=c(28122);const Gs=(e,t,s,r)=>(e.sort(function(i,o){return(i.title||"link").toLowerCase().localeCompare((o.title||"link").toLowerCase())}),e.map((i,o)=>(0,n.jsx)(Wt.D,{label:i.title||"Link",onClick:i.onClick?l=>{(0,T.rR)("grafana_traces_trace_view_span_link_clicked",{datasourceType:r,grafana_version:N.$.buildInfo.version,type:i.type,location:"menu"}),l?.preventDefault(),i.onClick(l),s()}:void 0,url:i.href,target:i.target,className:t.menuItem},o))),is=({links:e,datasourceType:t,color:s})=>{const r=(0,I.of)(()=>os(s)),[i,o]=(0,u.useState)(!1),[l,d]=(0,u.useState)({x:0,y:0}),g=()=>o(!1);return(0,n.jsxs)("div",{"data-testid":"SpanLinksMenu",className:r.wrapper,children:[(0,n.jsx)("button",{onClick:f=>{o(!0),d({x:f.pageX,y:f.pageY})},className:r.button,children:(0,n.jsx)(ye.I,{name:"link",className:r.icon})}),i?(0,n.jsx)(Ks.t,{onClose:()=>o(!1),renderMenuItems:()=>Gs(e,r,g,t),focusOnOpen:!1,x:l.x,y:l.y}):null]})},os=e=>({wrapper:(0,a.css)({border:"none",background:`${e}10`,borderBottom:`1px solid ${e}CF`,paddingRight:"4px"}),button:(0,a.css)({background:"transparent",border:"none",padding:0}),icon:(0,a.css)({background:"transparent",border:"none",padding:0}),menuItem:(0,a.css)({maxWidth:"60ch",overflow:"hidden"})});function ls(e){return(0,xe.get)((0,xe.find)(e.references,({span:t,refType:s})=>t&&t.spanID&&(s==="CHILD_OF"||s==="FOLLOWS_FROM")),"span")}function Us(e){const t=[];if(!e)return t;let s=ls(e);for(;s;)t.push(s.spanID),s=ls(s);return t}const Zs=(0,b.N)(e=>({SpanTreeOffset:(0,a.css)({label:"SpanTreeOffset",color:(0,p.R)(e,"#000"),position:"relative"}),SpanTreeOffsetParent:(0,a.css)({label:"SpanTreeOffsetParent","&:hover":{cursor:"pointer"}}),indentGuide:(0,a.css)({label:"indentGuide",paddingRight:"1rem",height:"100%",display:"inline-flex",[e.transitions.handleMotion("no-preference")]:{transition:"padding 300ms ease-out"},"&::before":{content:'""',paddingLeft:"1px",backgroundColor:(0,p.R)(e,"lightgrey")}}),indentGuideActive:(0,a.css)({label:"indentGuideActive","&::before":{backgroundColor:(0,p.R)(e,"#777")}}),indentGuideThin:(0,a.css)({paddingRight:"0.3rem"}),iconWrapper:(0,a.css)({label:"iconWrapper",position:"absolute",right:0})}));class Nn extends u.PureComponent{constructor(t){super(t),this.handleMouseLeave=(s,r)=>{(!(s.relatedTarget instanceof HTMLSpanElement)||(0,xe.get)(s,"relatedTarget.dataset.ancestorId")!==r)&&this.props.removeHoverIndentGuideId(r)},this.handleMouseEnter=(s,r)=>{(!(s.relatedTarget instanceof HTMLSpanElement)||(0,xe.get)(s,"relatedTarget.dataset.ancestorId")!==r)&&this.props.addHoverIndentGuideId(r)},this.ancestorIds=Us(t.span),this.ancestorIds.push("root"),this.ancestorIds.reverse()}static{this.displayName="UnthemedSpanTreeOffset"}static{this.defaultProps={childrenVisible:!1,showChildrenIcon:!0}}render(){const{childrenVisible:t,onClick:s,showChildrenIcon:r,span:i,theme:o,visibleSpanIds:l}=this.props,{hasChildren:d,spanID:g}=i,f=d?{onClick:s,role:"switch","aria-checked":t}:null,w=r&&d&&(t?(0,n.jsx)(ye.I,{name:"angle-down","data-testid":"icon-arrow-down",size:"sm"}):(0,n.jsx)(ye.I,{name:"angle-right","data-testid":"icon-arrow-right",size:"sm"})),R=Zs(o);return(0,n.jsxs)("span",{className:q()(R.SpanTreeOffset,{[R.SpanTreeOffsetParent]:d}),...f,children:[this.ancestorIds.map((k,M)=>(0,n.jsx)("span",{className:q()(R.indentGuide,{[R.indentGuideActive]:this.props.hoverIndentGuideIds.has(k),[R.indentGuideThin]:M!==this.ancestorIds.length-1&&k!=="root"&&!l.includes(k)}),"data-ancestor-id":k,"data-testid":"SpanTreeOffset--indentGuide",onMouseEnter:P=>this.handleMouseEnter(P,k),onMouseLeave:P=>this.handleMouseLeave(P,k)},k)),w&&(0,n.jsx)("span",{className:R.iconWrapper,onMouseEnter:k=>this.handleMouseEnter(k,g),onMouseLeave:k=>this.handleMouseLeave(k,g),"data-testid":"icon-wrapper",children:w})]})}}const ln=(0,I.cV)(Nn),cs="spanBar",ds="spanBarLabel",Vt="nameWrapper",cn="nameWrapperMatchingFilter",jt="jaegerView",dn="nameColumn",Mn=(0,b.N)((e,t)=>{const s={label:"flash",flash:(0,a.keyframes)`
    from {
      background-color: ${(0,p.R)(e,"#68b9ff")};
    }
    to {
      background-color: 'default';
    }
  `},r=t?"":(0,p.R)(e,"#fffce4");return{nameWrapper:(0,a.css)({label:"nameWrapper",lineHeight:"27px",overflow:"hidden",display:"flex"}),nameWrapperMatchingFilter:(0,a.css)({label:"nameWrapperMatchingFilter",backgroundColor:r}),nameColumn:(0,a.css)({label:"nameColumn",position:"relative",whiteSpace:"nowrap",zIndex:1,"&:hover":{zIndex:1}}),endpointName:(0,a.css)({label:"endpointName",color:(0,p.R)(e,"#484848"),fontSize:"0.9em"}),view:(0,a.css)({label:"view",position:"relative"}),viewExpanded:(0,a.css)({label:"viewExpanded",background:(0,p.R)(e,"#f8f8f8"),outline:`1px solid ${(0,p.R)(e,"#ddd")}`}),viewExpandedAndMatchingFilter:(0,a.css)({label:"viewExpandedAndMatchingFilter",background:(0,p.R)(e,"#fff3d7"),outline:`1px solid ${(0,p.R)(e,"#ddd")}`}),row:(0,a.css)({label:"row",fontSize:"0.9em",[`&:hover .${cs}`]:{opacity:1},[`&:hover .${ds}`]:{color:(0,p.R)(e,"#000")},[`&:hover .${Vt}`]:{background:`linear-gradient(
          90deg,
          ${(0,p.R)(e,"#fafafa")},
          ${(0,p.R)(e,"#f8f8f8")} 75%,
          ${(0,p.R)(e,"#eee")}
        )`},[`&:hover .${jt}`]:{backgroundColor:(0,p.R)(e,"#f5f5f5"),outline:`1px solid ${(0,p.R)(e,"#ddd")}`}}),rowClippingLeft:(0,a.css)({label:"rowClippingLeft",[`& .${dn}::before`]:{content:'" "',height:"100%",position:"absolute",width:"6px",backgroundImage:`linear-gradient(
          to right,
          ${(0,p.R)(e,"rgba(25, 25, 25, 0.25)")},
          ${(0,p.R)(e,"rgba(32, 32, 32, 0)")}
        )`,left:"100%",zIndex:-1}}),rowClippingRight:(0,a.css)({label:"rowClippingRight",[`& .${jt}::before`]:{content:'" "',height:"100%",position:"absolute",width:"6px",backgroundImage:`linear-gradient(
          to left,
          ${(0,p.R)(e,"rgba(25, 25, 25, 0.25)")},
          ${(0,p.R)(e,"rgba(25, 25, 25, 0.25)")}
        )`,right:"0%",zIndex:1}}),rowExpanded:(0,a.css)({label:"rowExpanded",[`& .${cs}`]:{opacity:1},[`& .${ds}`]:{color:(0,p.R)(e,"#000")},[`& .${Vt}, &:hover .${Vt}`]:{background:(0,p.R)(e,"#f0f0f0"),boxShadow:`0 1px 0 ${(0,p.R)(e,"#ddd")}`},[`& .${cn}`]:{background:(0,p.R)(e,"#fff3d7")},[`&:hover .${jt}`]:{background:(0,p.R)(e,"#eee")}}),rowMatchingFilter:(0,a.css)({label:"rowMatchingFilter",[`&:hover .${Vt}`]:{background:`linear-gradient(
          90deg,
          ${(0,p.R)(e,"#fffbde")},
          ${(0,p.R)(e,"#fffbde")} 75%,
          ${(0,p.R)(e,"#f7f1c6")}
        )`},[`&:hover .${jt}`]:{backgroundColor:(0,p.R)(e,"#f7f1c6"),outline:`1px solid ${(0,p.R)(e,"#ddd")}`}}),rowFocused:(0,a.css)({label:"rowFocused",backgroundColor:(0,p.R)(e,"#cbe7ff"),[e.transitions.handleMotion("no-preference","reduce")]:{animation:`${s.flash} 1s cubic-bezier(0.12, 0, 0.39, 0)`},[`& .${Vt}, .${jt}, .${cn}`]:{backgroundColor:(0,p.R)(e,"#cbe7ff"),animation:`${s.flash} 1s cubic-bezier(0.12, 0, 0.39, 0)`},[`& .${cs}`]:{opacity:1},[`& .${ds}`]:{color:(0,p.R)(e,"#000")},"&:hover .${nameWrapperClassName}, :hover .${viewClassName}":{background:(0,p.R)(e,"#d5ebff"),boxShadow:`0 1px 0 ${(0,p.R)(e,"#ddd")}`}}),rowExpandedAndMatchingFilter:(0,a.css)({label:"rowExpandedAndMatchingFilter",[`&:hover .${jt}`]:{background:(0,p.R)(e,"#ffeccf")}}),name:(0,a.css)({label:"name",color:(0,p.R)(e,"#000"),cursor:"pointer",flex:"1 1 auto",outline:"none",overflowY:"hidden",overflowX:"auto",paddingLeft:"4px",paddingRight:"0.25em",position:"relative","-ms-overflow-style":"none",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"},"&:focus":{textDecoration:"none"},"&:hover > span":{color:(0,p.R)(e,"#000")},textAlign:"left",background:"transparent",border:"none",borderBottomWidth:"1px",borderBottomStyle:"solid"}),nameDetailExpanded:(0,a.css)({label:"nameDetailExpanded","&::before":{bottom:0}}),svcName:(0,a.css)({label:"svcName",fontSize:"0.9em",fontWeight:"bold",marginRight:"0.25rem"}),svcNameChildrenCollapsed:(0,a.css)({label:"svcNameChildrenCollapsed",fontWeight:"bold",fontStyle:"italic"}),errorIcon:(0,a.css)({label:"errorIcon",borderRadius:"6.5px",color:(0,p.R)(e,"#fff"),fontSize:"0.85em",marginRight:"0.25rem",padding:"1px"}),rpcColorMarker:(0,a.css)({label:"rpcColorMarker",borderRadius:"6.5px",display:"inline-block",fontSize:"0.85em",height:"1em",marginRight:"0.25rem",padding:"1px",width:"1em",verticalAlign:"middle"}),labelRight:(0,a.css)({label:"labelRight",left:"100%"}),labelLeft:(0,a.css)({label:"labelLeft",right:"100%"})}});class Fn extends u.PureComponent{constructor(){super(...arguments),this._detailToggle=()=>{this.props.onDetailToggled(this.props.span.spanID)},this._childrenToggle=()=>{this.props.onChildrenToggled(this.props.span.spanID)},this.getSpanBarLabel=(t,s,r)=>{const i=s?.type??"";if(i===_t)return"";if(i===""||i===Ut)return`(${r})`;if(i===Ht){const o=s?.tag?.trim()??"";if(o!==""&&t.tags){const l=t.tags?.find(g=>g.key===o);if(l)return`(${l.value})`;const d=t.process?.tags?.find(g=>g.key===o);if(d)return`(${d.value})`}}return""}}static{this.displayName="UnthemedSpanBarRow"}static{this.defaultProps={className:"",rpc:null}}render(){const{className:t,color:s,spanBarOptions:r,columnDivision:i,isChildrenExpanded:o,isDetailExpanded:l,isMatchingFilter:d,showSpanFilterMatchesOnly:g,isFocused:f,numTicks:w,rpc:R,noInstrumentedServer:k,showErrorIcon:M,getViewedBounds:P,traceStartTime:O,span:U,hoverIndentGuideIds:F,addHoverIndentGuideId:G,removeHoverIndentGuideId:J,clippingLeft:V,clippingRight:se,theme:ce,createSpanLink:fe,datasourceType:Te,showServiceName:Le,visibleSpanIds:ge,criticalPath:Qe}=this.props,{duration:Pe,hasChildren:Ce,operationName:Ye,process:{serviceName:at}}=U,Je=(0,Be.a3)(Pe),it=P(U.startTime,U.startTime+U.duration),De=it.start,E=it.end,_=Mn(ce,g),Q=`${at}::${Ye}`;let ne,$e;return De>1-E?(ne=`${Q} | ${Je}`,$e=_.labelLeft):(ne=`${Je} | ${Q}`,$e=_.labelRight),(0,n.jsxs)(oe,{className:q()(_.row,{[_.rowExpanded]:l,[_.rowMatchingFilter]:d,[_.rowExpandedAndMatchingFilter]:d&&l,[_.rowFocused]:f,[_.rowClippingLeft]:V,[_.rowClippingRight]:se},t),children:[(0,n.jsx)(oe.Cell,{className:q()(_.nameColumn,dn),width:i,children:(0,n.jsxs)("div",{className:q()(_.nameWrapper,Vt,{[_.nameWrapperMatchingFilter]:d,nameWrapperMatchingFilter:d}),children:[(0,n.jsx)(ln,{onClick:Ce?this._childrenToggle:void 0,childrenVisible:o,span:U,hoverIndentGuideIds:F,addHoverIndentGuideId:G,removeHoverIndentGuideId:J,visibleSpanIds:ge}),(0,n.jsxs)("button",{type:"button",className:q()(_.name,{[_.nameDetailExpanded]:l}),"aria-checked":l,title:Q,onClick:this._detailToggle,role:"switch",style:{background:`${s}10`,borderBottomColor:`${s}CF`},tabIndex:0,children:[M&&(0,n.jsx)(ye.I,{name:"exclamation-circle",style:{backgroundColor:U.errorIconColor?(0,p.R)(ce,U.errorIconColor):(0,p.R)(ce,"#db2828")},className:_.errorIcon}),Le&&(0,n.jsx)("span",{className:q()(_.svcName,{[_.svcNameChildrenCollapsed]:Ce&&!o}),children:`${at} `}),R&&(0,n.jsxs)("span",{children:[(0,n.jsx)(ye.I,{name:"arrow-right"})," ",(0,n.jsx)("i",{className:_.rpcColorMarker,style:{background:R.color}}),R.serviceName]}),k&&(0,n.jsxs)("span",{children:[(0,n.jsx)(ye.I,{name:"arrow-right"})," ",(0,n.jsx)("i",{className:_.rpcColorMarker,style:{background:k.color}}),k.serviceName]}),(0,n.jsx)("span",{className:_.endpointName,children:R?R.operationName:Ye}),(0,n.jsxs)("span",{className:_.endpointName,children:[" ",this.getSpanBarLabel(U,r,Je)]})]}),fe&&(()=>{const ke=fe(U),He=ke?.length||0;return ke&&He===1?ke[0]?(0,n.jsx)("a",{href:ke[0].href,target:"_blank",style:{background:`${s}10`,borderBottom:`1px solid ${s}CF`,paddingRight:"4px"},rel:"noopener noreferrer",onClick:ke[0].onClick?le=>{!(le.ctrlKey||le.metaKey||le.shiftKey)&&ke[0].onClick&&(le.preventDefault(),ke[0].onClick(le))}:void 0,children:ke[0].content}):null:ke&&He>1?(0,n.jsx)(is,{links:ke,datasourceType:Te,color:s}):null})()]})}),(0,n.jsxs)(oe.Cell,{className:q()(_.view,jt,{[_.viewExpanded]:l,[_.viewExpandedAndMatchingFilter]:d&&l}),"data-testid":"span-view",style:{cursor:"pointer"},width:1-i,onClick:this._detailToggle,children:[(0,n.jsx)(_e,{numTicks:w}),(0,n.jsx)(on,{criticalPath:Qe,rpc:R,viewStart:De,viewEnd:E,getViewedBounds:P,color:s,shortLabel:Je,longLabel:ne,traceStartTime:O,span:U,labelClassName:`${ds} ${$e}`,className:cs})]})]})}}const An=(0,I.cV)(Fn),On=(0,b.N)(e=>({expandedAccent:(0,a.css)({cursor:"pointer",height:"100%",overflow:"hidden",position:"absolute",width:"100%","&::before":{borderLeft:"1px solid",pointerEvents:"none",width:"1000px"},"&::after":{borderRight:"1000px solid",borderColor:"inherit",cursor:"pointer",opacity:.2},"&::before, &::after":{borderColor:"inherit",content:'" "',position:"absolute",height:"100%"},"&:hover::after":{opacity:.35}}),infoWrapper:(0,a.css)({label:"infoWrapper",border:`1px solid ${(0,p.R)(e,"#d3d3d3")}`,borderTop:"3px solid",padding:"0.75rem"})}));class Vn extends u.PureComponent{constructor(){super(...arguments),this._detailToggle=()=>{this.props.onDetailToggled(this.props.span.spanID)},this._linksGetter=(t,s)=>{const{linksGetter:r,span:i}=this.props;return r(i,t,s)}}render(){const{color:t,columnDivision:s,detailState:r,logItemToggle:i,logsToggle:o,processToggle:l,referenceItemToggle:d,referencesToggle:g,warningsToggle:f,stackTracesToggle:w,span:R,traceToProfilesOptions:k,timeZone:M,tagsToggle:P,traceStartTime:O,traceDuration:U,traceName:F,hoverIndentGuideIds:G,addHoverIndentGuideId:J,removeHoverIndentGuideId:V,theme:se,createSpanLink:ce,focusedSpanId:fe,createFocusSpanLink:Te,datasourceType:Le,visibleSpanIds:ge,traceFlameGraphs:Qe,setTraceFlameGraphs:Pe,setRedrawListView:Ce}=this.props,Ye=On(se);return(0,n.jsxs)(oe,{children:[(0,n.jsxs)(oe.Cell,{width:s,style:{overflow:"hidden"},children:[(0,n.jsx)(ln,{span:R,showChildrenIcon:!1,hoverIndentGuideIds:G,addHoverIndentGuideId:J,removeHoverIndentGuideId:V,visibleSpanIds:ge}),(0,n.jsx)(et.$n,{fill:"text",onClick:this._detailToggle,className:q()(Ye.expandedAccent,(0,et.my)(se)),style:{borderColor:t},"data-testid":"detail-row-expanded-accent"})]}),(0,n.jsx)(oe.Cell,{width:1-s,children:(0,n.jsx)("div",{className:Ye.infoWrapper,style:{borderTopColor:t},children:(0,n.jsx)(ns,{detailState:r,linksGetter:this._linksGetter,logItemToggle:i,logsToggle:o,processToggle:l,referenceItemToggle:d,referencesToggle:g,warningsToggle:f,stackTracesToggle:w,span:R,traceToProfilesOptions:k,timeZone:M,tagsToggle:P,traceStartTime:O,traceDuration:U,traceName:F,createSpanLink:ce,focusedSpanId:fe,createFocusSpanLink:Te,datasourceType:Le,traceFlameGraphs:Qe,setTraceFlameGraphs:Pe,setRedrawListView:Ce})})})]})}}const Bn=(0,I.cV)(Vn),Qs=(0,b.N)(()=>({rowsWrapper:(0,a.css)({width:"100%"}),row:(0,a.css)({width:"100%"}),scrollToTopButton:(0,a.css)({display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"40px",height:"40px",position:"absolute",bottom:"30px",right:"30px",zIndex:1})})),Ys={bar:28,detail:161,detailWithLogs:197},_n=5,us=33;function Hn(e,t,s,r,i,o,l){if(!e)return[];i&&r&&(e=e.filter(f=>r.has(f.spanID))),o&&l&&(e=e.filter(f=>l.find(w=>w.spanId===f.spanID)));let d=null;const g=[];for(let f=0;f<e.length;f++){const w=e[f],{spanID:R,depth:k}=w;let M=!1;d!=null&&(k>=d?M=!0:d=null),!M&&(t.has(R)&&(d=k+1),g.push({span:w,isDetail:!1,spanIndex:f}),s.has(R)&&g.push({span:w,isDetail:!0,spanIndex:f}))}return g}function Pn(e){const[t,s]=e;return{left:t>0,right:s<1}}function $n(e,t,s,r,i,o,l){return e?Hn(e.spans,t,s,r,i,o,l):[]}function Wn(e){const t=new Map;return e&&e.spans.forEach(s=>{s.childSpanIds.length&&t.set(s.spanID,s.childSpanIds)}),t}const zn=(0,bt.A)($n),Kn=(0,bt.A)(be,xe.isEqual),Gn=(0,bt.A)(Pn,xe.isEqual),Un=(0,bt.A)(Wn);class Zn extends u.Component{constructor(){super(...arguments),this.hasScrolledToSpan=!1,this.getViewRange=()=>this.props.currentViewRangeTime,this.getSearchedSpanIDs=()=>this.props.findMatchesIDs,this.getCollapsedChildren=()=>this.props.childrenHiddenIDs,this.mapRowIndexToSpanIndex=t=>this.getRowStates()[t].spanIndex,this.mapSpanIndexToRowIndex=t=>{const s=this.getRowStates().length;for(let r=0;r<s;r++){const{spanIndex:i}=this.getRowStates()[r];if(i===t)return r}throw new Error(`unable to find row for span index: ${t}`)},this.setListView=t=>{this.listView=t},this.getKeyFromIndex=t=>{const{isDetail:s,span:r}=this.getRowStates()[t];return`${r.traceID}--${r.spanID}--${s?"detail":"bar"}`},this.getIndexFromKey=t=>{const s=t.split("--"),r=s[0],i=s[1],o=s[2]==="detail",l=this.getRowStates().length;for(let d=0;d<l;d++){const{span:g,isDetail:f}=this.getRowStates()[d];if(g.spanID===i&&g.traceID===r&&f===o)return d}return-1},this.getRowHeight=t=>{const{span:s,isDetail:r}=this.getRowStates()[t];return r?Array.isArray(s.logs)&&s.logs.length?Ys.detailWithLogs:Ys.detail:Ys.bar},this.renderRow=(t,s,r,i)=>{const{isDetail:o,span:l,spanIndex:d}=this.getRowStates()[r],g=Math.max((this.listView?.getTopVisibleIndex()||0)-us,0),f=(this.listView?.getBottomVisibleIndex()||0)+us,w=this.getVisibleSpanIds(g,f);return o?this.renderSpanDetailRow(l,t,s,i,w):this.renderSpanBarRow(l,d,t,s,i,w)},this.scrollToSpan=(t,s)=>{if(s==null)return;const r=this.getRowStates().findIndex(i=>i.span.spanID===s);r>=0&&this.listView?.scrollToIndex(r,t)},this.scrollToTop=()=>{const{topOfViewRef:t,datasourceType:s,trace:r}=this.props;t?.current?.scrollIntoView({behavior:"smooth"}),(0,T.rR)("grafana_traces_trace_view_scroll_to_top_clicked",{datasourceType:s,grafana_version:N.$.buildInfo.version,numServices:r.services.length,numSpans:r.spans.length})},this.getVisibleSpanIds=(0,bt.A)((t,s)=>{const r=[];for(let i=t;i<s;i++){const o=this.getRowStates()[i];o?.span&&r.push(o.span.spanID)}return r})}componentDidMount(){this.scrollToSpan(this.props.headerHeight,this.props.focusedSpanId)}shouldComponentUpdate(t){let s;for(s in t)if(t[s]!==this.props[s])return!0;return!1}componentDidUpdate(t){const{headerHeight:s,focusedSpanId:r,focusedSpanIdForSearch:i}=this.props;this.hasScrolledToSpan||(this.scrollToSpan(s,r),this.hasScrolledToSpan=!0),r!==t.focusedSpanId&&this.scrollToSpan(s,r),i!==t.focusedSpanIdForSearch&&this.scrollToSpan(s,i)}getRowStates(){const{childrenHiddenIDs:t,detailStates:s,trace:r,findMatchesIDs:i,showSpanFilterMatchesOnly:o,showCriticalPathSpansOnly:l,criticalPath:d}=this.props;return zn(r,t,s,i,o,l,d)}getClipping(){const{currentViewRangeTime:t}=this.props;return Gn(t)}getViewedBounds(){const{currentViewRangeTime:t,trace:s}=this.props,[r,i]=t;return Kn({min:s.startTime,max:s.endTime,viewStart:r,viewEnd:i})}getChildSpansMap(){return Un(this.props.trace)}getAccessors(){const t=this.listView;if(!t)throw new Error("ListView unavailable");return{getViewRange:this.getViewRange,getSearchedSpanIDs:this.getSearchedSpanIDs,getCollapsedChildren:this.getCollapsedChildren,getViewHeight:t.getViewHeight,getBottomRowIndexVisible:t.getBottomVisibleIndex,getTopRowIndexVisible:t.getTopVisibleIndex,getRowPosition:t.getRowPosition,mapRowIndexToSpanIndex:this.mapRowIndexToSpanIndex,mapSpanIndexToRowIndex:this.mapSpanIndexToRowIndex}}renderSpanBarRow(t,s,r,i,o,l){const{spanID:d,childSpanIds:g}=t,{serviceName:f}=t.process,{childrenHiddenIDs:w,childrenToggle:R,detailStates:k,detailToggle:M,findMatchesIDs:P,spanNameColumnWidth:O,trace:U,spanBarOptions:F,hoverIndentGuideIds:G,addHoverIndentGuideId:J,removeHoverIndentGuideId:V,createSpanLink:se,focusedSpanId:ce,focusedSpanIdForSearch:fe,showSpanFilterMatchesOnly:Te,theme:Le,datasourceType:ge,criticalPath:Qe}=this.props;if(!U)return null;const Pe=(0,Ft.Kv)(f,Le),Ce=w.has(d),Ye=k.has(d),at=P?P.has(d):!1,Je=d===ce||d===fe,it=X(t)||Ce&&ae(U.spans,s);let De=null;if(Ce){const le=ie(U.spans.slice(s));if(le){const kt=this.getViewedBounds()(le.startTime,le.startTime+le.duration);De={color:(0,Ft.Kv)(le.process.serviceName,Le),operationName:le.operationName,serviceName:le.process.serviceName,viewEnd:kt.end,viewStart:kt.start}}}const E=t.tags.find(le=>le.key===bs);let _=null;!t.hasChildren&&E&&Y(t)&&(_={serviceName:E.value,color:(0,Ft.Kv)(E.value,Le)});const Q=s>0?U.spans[s-1]:null,ne=[d,...g],$e=le=>{le.forEach(kt=>{const Bt=this.getChildSpansMap().get(kt);Bt?.length&&(ne.push(...Bt),$e(Bt))})};$e(g);const ke=Qe?.filter(le=>Ce?ne.includes(le.spanId):le.spanId===d),He=Qs();return(0,n.jsx)("div",{className:He.row,style:i,...o,children:(0,n.jsx)(An,{clippingLeft:this.getClipping().left,clippingRight:this.getClipping().right,color:Pe,spanBarOptions:F,columnDivision:O,isChildrenExpanded:!Ce,isDetailExpanded:Ye,isMatchingFilter:at,isFocused:Je,showSpanFilterMatchesOnly:Te,numTicks:_n,onDetailToggled:M,onChildrenToggled:R,rpc:De,noInstrumentedServer:_,showErrorIcon:it,getViewedBounds:this.getViewedBounds(),traceStartTime:U.startTime,span:t,hoverIndentGuideIds:G,addHoverIndentGuideId:J,removeHoverIndentGuideId:V,createSpanLink:se,datasourceType:ge,showServiceName:Q===null||Q.process.serviceName!==t.process.serviceName,visibleSpanIds:l,criticalPath:ke})},r)}renderSpanDetailRow(t,s,r,i,o){const{spanID:l}=t,{serviceName:d}=t.process,{detailLogItemToggle:g,detailLogsToggle:f,detailProcessToggle:w,detailReferencesToggle:R,detailReferenceItemToggle:k,detailWarningsToggle:M,detailStackTracesToggle:P,detailStates:O,detailTagsToggle:U,detailToggle:F,spanNameColumnWidth:G,trace:J,traceToProfilesOptions:V,timeZone:se,hoverIndentGuideIds:ce,addHoverIndentGuideId:fe,removeHoverIndentGuideId:Te,linksGetter:Le,createSpanLink:ge,focusedSpanId:Qe,createFocusSpanLink:Pe,theme:Ce,datasourceType:Ye,traceFlameGraphs:at,setTraceFlameGraphs:Je,setRedrawListView:it}=this.props,De=O.get(l);if(!J||!De)return null;const E=(0,Ft.Kv)(d,Ce),_=Qs();return(0,n.jsx)("div",{className:_.row,style:{...r,zIndex:1},...i,children:(0,n.jsx)(Bn,{color:E,columnDivision:G,onDetailToggled:F,detailState:De,linksGetter:Le,logItemToggle:g,logsToggle:f,processToggle:w,referenceItemToggle:k,referencesToggle:R,warningsToggle:M,stackTracesToggle:P,span:t,traceToProfilesOptions:V,timeZone:se,tagsToggle:U,traceStartTime:J.startTime,traceDuration:J.duration,traceName:J.traceName,hoverIndentGuideIds:ce,addHoverIndentGuideId:fe,removeHoverIndentGuideId:Te,createSpanLink:ge,focusedSpanId:Qe,createFocusSpanLink:Pe,datasourceType:Ye,visibleSpanIds:o,traceFlameGraphs:at,setTraceFlameGraphs:Je,setRedrawListView:it})},s)}render(){const t=Qs(),{scrollElement:s,redrawListView:r}=this.props;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Gt,{ref:this.setListView,dataLength:this.getRowStates().length,itemHeightGetter:this.getRowHeight,itemRenderer:this.renderRow,viewBuffer:us,viewBufferMin:us,itemsWrapperClassName:t.rowsWrapper,getKeyFromIndex:this.getKeyFromIndex,getIndexFromKey:this.getIndexFromKey,windowScroller:!1,scrollElement:s,redraw:r}),this.props.topOfViewRef&&(0,n.jsx)(qe.I,{className:t.scrollToTopButton,onClick:this.scrollToTop,title:"Scroll to top",icon:"arrow-up"})]})}}const Qn=(0,I.cV)(Zn),Yn=(0,b.N)(e=>({TraceTimelineViewer:(0,a.css)({label:"TraceTimelineViewer",borderBottom:`1px solid ${(0,p.R)(e,"#bbb")}`,"& .json-markup":{lineHeight:"17px",fontSize:"13px",fontFamily:"monospace",whiteSpace:"pre-wrap"},"& .json-markup-key":{fontWeight:"bold"},"& .json-markup-bool":{color:(0,p.R)(e,"firebrick")},"& .json-markup-string":{color:(0,p.R)(e,"teal")},"& .json-markup-null":{color:(0,p.R)(e,"teal")},"& .json-markup-number":{color:(0,p.R)(e,"blue","black")}})})),Xn=5;class Jn extends u.PureComponent{constructor(t){super(t),this.collapseAll=()=>{this.props.collapseAll(this.props.trace.spans),(0,T.rR)("grafana_traces_traceID_expand_collapse_clicked",{datasourceType:this.props.datasourceType,grafana_version:N.$.buildInfo.version,type:"collapseAll"})},this.collapseOne=()=>{this.props.collapseOne(this.props.trace.spans),(0,T.rR)("grafana_traces_traceID_expand_collapse_clicked",{datasourceType:this.props.datasourceType,grafana_version:N.$.buildInfo.version,type:"collapseOne"})},this.expandAll=()=>{this.props.expandAll(),(0,T.rR)("grafana_traces_traceID_expand_collapse_clicked",{datasourceType:this.props.datasourceType,grafana_version:N.$.buildInfo.version,type:"expandAll"})},this.expandOne=()=>{this.props.expandOne(this.props.trace.spans),(0,T.rR)("grafana_traces_traceID_expand_collapse_clicked",{datasourceType:this.props.datasourceType,grafana_version:N.$.buildInfo.version,type:"expandOne"})},this.state={height:0}}componentDidMount(){de({collapseAll:this.collapseAll,expandAll:this.expandAll,collapseOne:this.collapseOne,expandOne:this.expandOne})}render(){const{setSpanNameColumnWidth:t,updateNextViewRangeTime:s,updateViewRangeTime:r,viewRange:i,traceTimeline:o,theme:l,topOfViewRef:d,focusedSpanIdForSearch:g,...f}=this.props,{trace:w}=f,R=Yn(l);return(0,n.jsxs)("div",{className:R.TraceTimelineViewer,ref:k=>k&&this.setState({height:k.getBoundingClientRect().height}),children:[(0,n.jsx)(ys,{duration:w.duration,nameColumnWidth:o.spanNameColumnWidth,numTicks:Xn,onCollapseAll:this.collapseAll,onCollapseOne:this.collapseOne,onColummWidthChange:t,onExpandAll:this.expandAll,onExpandOne:this.expandOne,viewRangeTime:i.time,updateNextViewRangeTime:s,updateViewRangeTime:r,columnResizeHandleHeight:this.state.height}),(0,n.jsx)(Qn,{...f,...o,setSpanNameColumnWidth:t,currentViewRangeTime:i.time.current,topOfViewRef:d,focusedSpanIdForSearch:g,datasourceType:this.props.datasourceType})]})}}const qn=(0,I.cV)(Jn);var un=c(39938);const er=()=>({NewWindowIconLarge:(0,a.css)({label:"NewWindowIconLarge",fontSize:"1.5em"})});function tr({isLarge:e=!1,className:t}){const s=(0,I.of)(er),r=q()({[s.NewWindowIconLarge]:e},t);return(0,n.jsx)(ye.I,{className:r,name:"anchor"})}const sr=e=>(0,n.jsxs)("a",{href:e.href,title:e.title,target:"_blank",rel:"noopener noreferrer",className:e.className,children:[e.children," ",(0,n.jsx)(tr,{})]});function nr(e){const{links:t}=e;return(0,n.jsx)(sr,{href:t[0].url,title:t[0].text,className:e.className})}const rr=100,ar="<trace-without-root-span>",ir=()=>({BreakableText:(0,a.css)({label:"BreakableText",display:"inline-block",whiteSpace:"pre"})}),or=/\W*\w+\W*/g;function lr({text:e,className:t,wordRegexp:s=or}){const r=(0,I.of)(ir);if(!e)return null;const i=[];s.exec("");let o=s.exec(e)||[e];for(;o;)i.push((0,n.jsx)("span",{className:t||r.BreakableText,children:o[0]},`${e}-${i.length}`)),o=s.exec(e);return(0,n.jsx)(n.Fragment,{children:i})}const cr=e=>({TraceName:(0,a.css)({label:"TraceName",fontSize:e.typography.size.lg})});function dr(e){const{className:t,traceName:s}=e,r=(0,I.of)(cr),i=String(s||ar),o=(0,n.jsx)(lr,{text:i});return(0,n.jsx)("span",{className:q()(r.TraceName,t),children:o})}var hn=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)};function ur(e,t){function s(r,i){if(e(r,i))return!0;if(Array.isArray(r))return!(!Array.isArray(i)||r.length!==i.length||!r.every(function(w,R){return s(w,i[R])}));if(Array.isArray(i))return!1;if(typeof r=="object"){if(typeof i!="object")return!1;var o=r===null,l=i===null;if(o||l)return o===l;var d=Object.keys(r),g=Object.keys(i);if(d.length!==g.length)return!1;var f=t?s:e;return!!d.every(function(w){return hn(r,w)&&hn(i,w)&&f(r[w],i[w])})}return!1}return s}var hr=function(t,s){for(var r=0;r<t.length;r++)if(s(t[r]))return r;return-1};function gr(e,t){var s=[];function r(o){var l=hr(s,function(g){return t(o,g.key)});if(l>-1){var d=s[l];return l>0&&(s.splice(l,1),s.unshift(d)),d.value}}function i(o,l){r(o)||(s.unshift({key:o,value:l}),s.length>e&&s.pop())}return{get:r,put:i}}function pr(e){var t;return{get:function(r){if(t&&e(r,t.key))return t.value},put:function(r,i){t={key:r,value:i}}}}function fr(e,t){return e===1?pr(t):gr(e,t)}function mr(e,t){var s=t?ur(e,t):e;return function(r,i){if(r.length!==i.length)return!1;for(var o=0;o<r.length;o+=1)if(!s(r[o],i[o]))return!1;return!0}}function vr(){for(var e=1,t=function(g,f){return g===f},s=!1,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];typeof i[0]=="number"&&(e=i.shift()),typeof i[0]=="function"?t=i.shift():typeof i[0]>"u"&&i.shift(),typeof i[0]=="boolean"&&(s=i[0]);var l=fr(e,mr(t,s));return function(d){return function(){for(var g=arguments.length,f=new Array(g),w=0;w<g;w++)f[w]=arguments[w];var R=l.get(f);return R===void 0&&(R=d.apply(d,f),l.put(f,R)),R}}}const xr=vr,yr=Object.defineProperty({archiveEnabled:!1,dependencies:{dagMaxNumServices:rr,menuEnabled:!0},linkPatterns:[],search:{maxLookback:{label:"2 Days",value:"2d"},maxLimit:1500},tracking:{gaID:null,trackErrors:!0}},"__mergeFields",{value:["dependencies","search","tracking"]});function br(){return yr}function gn(e){return(0,xe.get)(br(),e)}const pn=/#\{([^{}]*)\}/g;function Sr(e){const t=new Set;return e.replace(pn,(s,r)=>(t.add(r),s)),Array.from(t)}function Ir(e,t,s){return e.replace(pn,(r,i)=>{const o=s[i];return o==null?"":t(o)})}function fn(e,t){if(typeof e!="string")throw new Error("Invalid template");return{parameters:Sr(e),template:Ir.bind(null,e,t)}}function Xs(e){if(typeof e=="string")return t=>t===e;if(Array.isArray(e))return t=>e.indexOf(t)>-1;if(e==null)return()=>!0;throw new Error(`Invalid value: ${e}`)}const wr=e=>e;function Tr(e){try{const t=fn(e.url,encodeURIComponent),s=fn(e.text,wr);return{object:e,type:Xs(e.type),key:Xs(e.key),value:Xs(e.value),url:t,text:s,parameters:(0,xe.uniq)(t.parameters.concat(s.parameters))}}catch(t){return console.error(`Ignoring invalid link pattern: ${t}`,e),null}}function mn(e,t){return e.template(t)}function Cr(e,t){const s=[],r=Object.keys(t).filter(i=>typeof t[i]=="string"||typeof t[i]=="number");return e?.filter(i=>i?.type("traces")).forEach(i=>{const o={};i?.parameters.every(d=>{const g=d;return r.includes(g)?(o[d]=t[g],!0):!1})&&s.push({url:mn(i.url,o),text:mn(i.text,o)})}),s}const Dr=(gn("linkPatterns")||[]).map(Tr).filter(e=>!!e),kr=xr(10)(e=>{const t=[];return e?Cr(Dr,e):t});function Rr(e){let t;const s=new Set(e.map(({spanID:r})=>r));for(let r=0;r<e.length;r++){if(e[r].references&&e[r].references.some(({traceID:d,spanID:g})=>d===e[r].traceID&&s.has(g)))continue;if(!t){t=e[r];continue}const o=e[r].references&&e[r].references.length||0,l=t.references&&t.references.length||0;(o<l||o===l&&e[r].startTime<t.startTime)&&(t=e[r])}return t?`${t.process.serviceName}: ${t.operationName}`:""}const vn=(0,xe.memoize)(Rr,e=>e.length?e[0].traceID:0);function Lr(e){for(let t=0;t<e.length;t++){const s=e[t].tags.filter(o=>o.key==="http.request.method"),r=e[t].tags.filter(o=>o.key==="http.response.status_code"),i=e[t].tags.filter(o=>o.key==="http.route");if(s.length>0||r.length>0||i.length>0)return{method:s,status:r,url:i}}for(let t=0;t<e.length;t++){const s=e[t].tags.filter(o=>o.key==="http.method"),r=e[t].tags.filter(o=>o.key==="http.status_code"),i=e[t].tags.filter(o=>o.key==="http.url"||o.key==="http.target"||o.key==="http.path");if(s.length>0||r.length>0||i.length>0)return{method:s,status:r,url:i}}return{}}const Er=(0,xe.memoize)(Lr,e=>e.length?e[0].traceID:0);var jr=c(2913),Nr=c(18358);const Mr=e=>({ActionButton:(0,a.css)({label:"ActionButton",overflow:"hidden",position:"relative","&:after":{content:'""',background:e.colors.primary.main,display:"block",position:"absolute",right:0,width:"100%",height:"100%",opacity:0,transition:"all 0.8s"},"&:active:after":{margin:0,opacity:.3,transition:"0s"}})});function xn(e){const{onClick:t,ariaLabel:s,label:r,icon:i}=e,o=(0,I.of)(Mr);return(0,n.jsx)(et.$n,{className:o.ActionButton,size:"sm",variant:"secondary",fill:"outline",type:"button",icon:i,"aria-label":s,onClick:t,children:r})}const Fr=e=>({TracePageActions:(0,a.css)({label:"TracePageActions",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",marginBottom:"10px"}),feedbackContainer:(0,a.css)({color:e.colors.text.link}),feedback:(0,a.css)({margin:"6px",color:e.colors.text.link,fontSize:e.typography.bodySmall.fontSize,"&:hover":{textDecoration:"underline"}})});function Ar(e){const{traceId:t,data:s,app:r}=e,i=(0,I.$j)(),o=Fr(i),[l,d]=(0,u.useState)(!1),g=()=>{navigator.clipboard.writeText(t),d(!0),setTimeout(()=>{d(!1)},5e3)},f=()=>{const w=(0,Nr.ek)(s,"Trace-"+t.substring(t.length-6));(0,T.rR)("grafana_traces_download_traces_clicked",{app:r,grafana_version:jr.$W.buildInfo.version,trace_format:w,location:"trace-view"})};return(0,n.jsxs)("div",{className:o.TracePageActions,children:[(0,n.jsxs)("div",{className:o.feedbackContainer,children:[(0,n.jsx)(ye.I,{name:"comment-alt-message"}),(0,n.jsx)("a",{href:"https://forms.gle/RZDEx8ScyZNguDoC8",className:o.feedback,title:"Share your thoughts about tracing in Grafana.",target:"_blank",rel:"noreferrer noopener",children:"Give feedback"})]}),(0,n.jsx)(xn,{onClick:g,ariaLabel:"Copy Trace ID",label:l?"Copied!":"Trace ID",icon:"copy"}),(0,n.jsx)(xn,{onClick:f,ariaLabel:"Export Trace",label:"Export",icon:"save"})]})}var Ve=c(50877),yn=c(3721),Or=c(40996),zt=c(14186),Js=c(10354);const Vr=/^(-?\d+(?:\.\d+)?)(ms|[Mwdhmsy])$/,bn=(e,t)=>!(e.match(t)||!e),Sn=e=>{const t=e.validationRegex||Vr,[s,r]=(0,u.useState)(()=>e.value?bn(e.value,t):!1);(0,Or.A)(()=>{r(bn(e.value,t))},500,[e.value]);const i={labelWidth:26,disabled:e.disabled??!1,invalid:s,error:e.isInvalidError};return e.label&&(i.label=e.label,i.tooltip=e.tooltip||""),(0,n.jsx)(zt.I,{...i,children:(0,n.jsx)(Js.p,{type:"text",placeholder:e.placeholder||"0",width:e.width||40,onChange:o=>{e.onChange(o.currentTarget.value)},value:e.value,"aria-label":e.ariaLabel||"interval input"})})};var Br=c(82762),hs=c(39268),gs=c(66864),ft=c(90182),qs=c(15583);class _r extends u.PureComponent{constructor(){super(...arguments),this.clearUiFind=()=>{this.props.onChange("")}}static{this.defaultProps={value:void 0}}render(){const{value:t}=this.props,s=(0,n.jsx)(n.Fragment,{children:t&&t.length&&(0,n.jsx)(Re.K,{name:"times",onClick:this.clearUiFind,tooltip:"Clear input"})});return(0,n.jsx)("div",{style:{width:"200px"},children:(0,n.jsx)(Js.p,{placeholder:"Find...",onChange:r=>this.props.onChange(r.currentTarget.value),suffix:s,value:t})})}}const In=(0,u.memo)(function(t){const{trace:s,spanFilterMatches:r,setFocusedSpanIdForSearch:i,focusedSpanIndexForSearch:o,setFocusedSpanIndexForSearch:l,datasourceType:d,showSpanFilters:g}=t,f=Hr((0,I.$j)(),g);(0,u.useEffect)(()=>{if(r&&o!==-1){const V=Array.from(r);i(V[o])}},[o,i,r]);const w=(V,se)=>{if(V.preventDefault(),V.stopPropagation(),se){if((0,T.rR)("grafana_traces_trace_view_find_next_prev_clicked",{datasourceType:d,grafana_version:N.$.buildInfo.version,direction:"next"}),o===-1||r&&o===r.size-1){l(0);return}l(o+1)}},R=(V,se)=>{if(V.preventDefault(),V.stopPropagation(),se){if((0,T.rR)("grafana_traces_trace_view_find_next_prev_clicked",{datasourceType:d,grafana_version:N.$.buildInfo.version,direction:"prev"}),r&&(o===-1||o===0)){l(r.size-1);return}l(o-1)}},k=(V,se)=>{V.key==="Enter"&&w(V,se)},M=(V,se)=>{V.key==="Enter"&&R(V,se)},P=(r&&r?.size>0)??!1,O=P?f.button:(0,a.cx)(f.button,f.buttonDisabled),U=(0,u.useCallback)(V=>(0,n.jsx)(dt.m,{content:V,placement:"top",children:(0,n.jsx)("span",{className:f.tooltip,children:(0,n.jsx)(ye.I,{name:"info-circle",size:"md"})})}),[f.tooltip]),F=(0,u.useCallback)((V,se)=>{let ce=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:`${s.spans.length} spans`}),U((0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:["Services: ",se]}),(0,n.jsxs)("div",{children:["Depth: ",V]})]}))]});if(r)if(r.size===0)ce=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:"0 matches"}),U("There are 0 span matches for the filters selected. Please try removing some of the selected filters.")]});else{const fe=r.size===1?"match":"matches",Te=o!==-1?`${o+1}/${r.size} ${fe}`:`${r.size} ${fe}`,Le=[];r.forEach(ge=>{s.processes[ge]&&Le.push(s.processes[ge].serviceName)}),ce=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:Te}),U((0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:["Services: ",new Set(Le).size,"/",se]}),(0,n.jsxs)("div",{children:["Depth: ",V]})]}))]})}return ce},[o,U,r,s.processes,s.spans]),G=new Set((0,xe.values)(s.processes).map(V=>V.serviceName)).size,J=(0,xe.get)((0,xe.maxBy)(s.spans,"depth"),"depth",0)+1;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:f.matches,children:F(J,G)}),(0,n.jsxs)("div",{className:P?f.buttons:(0,a.cx)(f.buttons,f.buttonsDisabled),children:[(0,n.jsx)("div",{"aria-label":"Prev result button",className:O,onClick:V=>R(V,P),onKeyDown:V=>M(V,P),role:"button",tabIndex:P?0:-1,children:"Prev"}),(0,n.jsx)("div",{"aria-label":"Next result button",className:O,onClick:V=>w(V,P),onKeyDown:V=>k(V,P),role:"button",tabIndex:P?0:-1,children:"Next"})]})]})}),Hr=(e,t)=>{const s=(0,et.hs)({theme:e,variant:"secondary",size:t?"md":"sm",iconOnly:!1,fill:"outline"});return{buttons:(0,a.css)({display:"inline-flex",gap:"4px"}),buttonsDisabled:(0,a.css)({cursor:"not-allowed"}),button:s.button,buttonDisabled:(0,a.css)(s.disabled,{pointerEvents:"none"}),matches:(0,a.css)({marginRight:e.spacing(2),textWrap:"nowrap"}),tooltip:(0,a.css)({color:"#aaa",margin:"0 0 0 5px"})}};var wn=c(15292);function Pr(e,t){if(!t)return;let s=!1;e.serviceName&&(t=zr(t,e),s=!0),e.spanName&&(t=Kr(t,e),s=!0),(e.from||e.to)&&(t=Gr(t,e),s=!0);const r=Wr(t,e.tags);if(r&&(t=r,s=!0),e.query){const i=$r(e.query,t);i&&(t=i,s=!0)}return s?new Set(t.map(i=>i.spanID)):void 0}function $r(e,t){if(!t)return;const s=[];e.split(/\s+/).filter(Boolean).forEach(l=>{s.push(l.toLowerCase())});const r=(l,d)=>l.some(g=>d.toLowerCase().includes(g)),i=l=>l?l.some(d=>r(s,d.key)||r(s,nn(d.value))):!1,o=l=>r(s,l.operationName)||r(s,l.process.serviceName)||i(l.tags)||l.kind&&r(s,l.kind)||l.statusCode!==void 0&&r(s,A.s[l.statusCode])||l.statusMessage&&r(s,l.statusMessage)||l.instrumentationLibraryName&&r(s,l.instrumentationLibraryName)||l.instrumentationLibraryVersion&&r(s,l.instrumentationLibraryVersion)||l.traceState&&r(s,l.traceState)||l.logs!==null&&l.logs.some(d=>d.name&&r(s,d.name)||i(d.fields))||i(l.process.tags)||s.some(d=>d===l.spanID);return t.filter(o)}const Wr=(e,t)=>{if(t=t.filter(s=>s.key&&s.key!==""||s.value),t.length>0)return e.filter(s=>t.every(r=>r.key&&r.value?!!(r.operator==="="&&Cn(r,s)||r.operator==="=~"&&Tn(r,s)||r.operator==="!="&&!Cn(r,s)||r.operator==="!~"&&!Tn(r,s)):r.key?s.tags.some(i=>en(r.key,i.key))||s.process.tags.some(i=>en(r.key,i.key))||s.logs&&s.logs.some(i=>i.fields.some(o=>en(r.key,o.key)))||s.kind&&r.key===It||s.statusCode!==void 0&&r.key===wt||s.statusMessage&&r.key===ut||s.instrumentationLibraryName&&r.key===ht||s.instrumentationLibraryVersion&&r.key===gt||s.traceState&&r.key===pt||r.key===Et?r.operator==="="||r.operator==="=~":!(r.operator==="="||r.operator==="=~"):!1))},Tn=(e,t)=>t.tags.some(s=>sn(e,s))||t.process.tags.some(s=>sn(e,s))||t.logs&&t.logs.some(s=>s.fields.some(r=>sn(e,r)))||t.kind&&e.key===It&&e.value?.includes(t.kind)||t.statusCode!==void 0&&e.key===wt&&e.value?.includes(A.s[t.statusCode].toLowerCase())||t.statusMessage&&e.key===ut&&e.value?.includes(t.statusMessage)||t.instrumentationLibraryName&&e.key===ht&&e.value?.includes(t.instrumentationLibraryName)||t.instrumentationLibraryVersion&&e.key===gt&&e.value?.includes(t.instrumentationLibraryVersion)||t.traceState&&e.key===pt&&e.value?.includes(t.traceState)||e.key===Et&&e.value?.includes(t.spanID),Cn=(e,t)=>t.tags.some(s=>tn(e,s))||t.process.tags.some(s=>tn(e,s))||t.logs&&t.logs.some(s=>s.fields.some(r=>tn(e,r)))||t.kind&&e.key===It&&e.value===t.kind||t.statusCode!==void 0&&e.key===wt&&e.value===A.s[t.statusCode].toLowerCase()||t.statusMessage&&e.key===ut&&e.value===t.statusMessage||t.instrumentationLibraryName&&e.key===ht&&e.value===t.instrumentationLibraryName||t.instrumentationLibraryVersion&&e.key===gt&&e.value===t.instrumentationLibraryVersion||t.traceState&&e.key===pt&&e.value===t.traceState||e.key===Et&&e.value===t.spanID,en=(e,t)=>e===t.toString(),tn=(e,t)=>e.key===t.key&&e.value===nn(t.value),sn=(e,t)=>t.key.includes(e.key||"")&&nn(t.value).includes(e.value||""),nn=e=>e?e.toString():"",zr=(e,t)=>e.filter(s=>t.serviceNameOperator==="="?s.process.serviceName===t.serviceName:s.process.serviceName!==t.serviceName),Kr=(e,t)=>e.filter(s=>t.spanNameOperator==="="?s.operationName===t.spanName:s.operationName!==t.spanName),Gr=(e,t)=>{const s=ps(t?.from||""),r=ps(t?.to||"");let i=[];if(s&&(i=e.filter(o=>t.fromOperator===">"?o.duration>s:o.duration>=s)),r){const o=l=>t.toOperator==="<"?l.duration<r:l.duration<=r;i=i.length>0?i.filter(l=>o(l)):e.filter(l=>o(l))}return i},ps=e=>{if(e.includes("ns"))return parseFloat(e.split("ns")[0])/1e3;if(e.includes("us"))return parseFloat(e.split("us")[0]);if(e.includes("\xB5s"))return parseFloat(e.split("\xB5s")[0]);if(e.includes("ms"))return parseFloat(e.split("ms")[0])*1e3;if(e.includes("s"))return parseFloat(e.split("s")[0])*1e3*1e3;if(e.includes("m"))return parseFloat(e.split("m")[0])*1e3*1e3*60;if(e.includes("h"))return parseFloat(e.split("h")[0])*1e3*1e3*60*60},Ur=(0,u.memo)(function(t){const{trace:s,search:r,spanFilterMatches:i,showSpanFilterMatchesOnly:o,setShowSpanFilterMatchesOnly:l,showCriticalPathSpansOnly:d,setShowCriticalPathSpansOnly:g,focusedSpanIndexForSearch:f,setFocusedSpanIndexForSearch:w,setFocusedSpanIdForSearch:R,datasourceType:k,clear:M,showSpanFilters:P}=t,O=(0,I.of)(Zr),U=(0,u.useMemo)(()=>r.serviceName&&r.serviceName!==""||r.spanName&&r.spanName!==""||ps(r.from||"")||ps(r.to||"")||r.tags.length>1||r.tags.some(F=>F.key)||r.query&&r.query!==""||o,[r.serviceName,r.spanName,r.from,r.to,r.tags,r.query,o]);return(0,n.jsx)("div",{className:O.container,children:(0,n.jsx)("div",{className:O.controls,children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(et.$n,{variant:"destructive",disabled:!U,type:"button",fill:"outline","aria-label":"Clear filters button",onClick:M,children:"Clear"}),(0,n.jsxs)("div",{className:O.matchesOnly,children:[(0,n.jsx)(wn.d,{value:o,onChange:F=>l(F.currentTarget.checked??!1),label:"Show matches only switch",disabled:!i?.size}),(0,n.jsx)(et.$n,{onClick:()=>l(!o),className:O.clearMatchesButton,variant:"secondary",fill:"text",disabled:!i?.size,children:"Show matches only"})]}),(0,n.jsxs)("div",{className:O.matchesOnly,children:[(0,n.jsx)(wn.d,{value:d,onChange:F=>g(F.currentTarget.checked??!1),label:"Show critical path only switch"}),(0,n.jsx)(et.$n,{onClick:()=>g(!d),className:O.clearMatchesButton,variant:"secondary",fill:"text",children:"Show critical path only"})]})]}),(0,n.jsx)("div",{className:O.nextPrevResult,children:(0,n.jsx)(In,{trace:s,spanFilterMatches:i,setFocusedSpanIdForSearch:R,focusedSpanIndexForSearch:f,setFocusedSpanIndexForSearch:w,datasourceType:k,showSpanFilters:P})})]})})})}),Zr=e=>{const t=(0,et.hs)({theme:e,variant:"secondary",size:"md",iconOnly:!1,fill:"outline"});return{button:(0,a.css)(t.button),buttonDisabled:(0,a.css)(t.disabled,{pointerEvents:"none",cursor:"not-allowed"}),container:(0,a.css)({display:"inline"}),controls:(0,a.css)({display:"flex",justifyContent:"flex-end",margin:"5px 0 0 0"}),matchesOnly:(0,a.css)({display:"inline-flex",margin:"0 0 0 25px",verticalAlign:"middle",alignItems:"center"}),clearMatchesButton:(0,a.css)({color:e.colors.text.primary,"&:hover":{background:"inherit"}}),nextPrevResult:(0,a.css)({marginLeft:"auto",display:"flex",alignItems:"center"})}},Dn=(0,u.memo)(e=>{const{trace:t,search:s,setSearch:r,showSpanFilters:i,setShowSpanFilters:o,showSpanFilterMatchesOnly:l,setShowSpanFilterMatchesOnly:d,showCriticalPathSpansOnly:g,setShowCriticalPathSpansOnly:f,setFocusedSpanIdForSearch:w,spanFilterMatches:R,datasourceType:k}=e,M={...(0,I.of)(Qr)},[P,O]=(0,u.useState)(),[U,F]=(0,u.useState)(),[G,J]=(0,u.useState)(),[V,se]=(0,u.useState)({}),[ce,fe]=(0,u.useState)(-1),Te=/^\d+(?:\.\d)?\d*(?:ns|us|µs|ms|s|m|h)$/,Le=(0,u.useCallback)(()=>{O(void 0),F(void 0),J(void 0),se({}),r(qs.Ji),d(!1)},[r,d]);if((0,u.useEffect)(()=>{Le()},[Le,t]),!t)return null;const ge=E=>{fe(-1),w(""),r(E)},Qe=()=>{if(!P){const E=t.spans.map(_=>_.process.serviceName);O((0,xe.uniq)(E).sort().map(Ve.z))}},Pe=()=>{if(!U){const E=t.spans.map(_=>_.operationName);F((0,xe.uniq)(E).sort().map(Ve.z))}},Ce=()=>{if(!G){let E=[],_=[];t.spans.forEach(Q=>{Q.tags.forEach(ne=>{E.push(ne.key)}),Q.process.tags.forEach(ne=>{E.push(ne.key)}),Q.logs!==null&&Q.logs.forEach(ne=>{ne.fields.forEach($e=>{_.push($e.key)})}),Q.kind&&E.push(It),Q.statusCode!==void 0&&E.push(wt),Q.statusMessage&&E.push(ut),Q.instrumentationLibraryName&&E.push(ht),Q.instrumentationLibraryVersion&&E.push(gt),Q.traceState&&E.push(pt),E.push(Et)}),E=(0,xe.uniq)(E).sort(),_=(0,xe.uniq)(_).sort(),J([...E,..._].map(Ve.z))}},Ye=async E=>{const _=[];return t.spans.forEach(Q=>{const ne=Q.tags.find(ke=>ke.key===E)?.value;ne&&_.push(ne.toString());const $e=Q.process.tags.find(ke=>ke.key===E)?.value;switch($e&&_.push($e.toString()),Q.logs!==null&&Q.logs.forEach(ke=>{const He=ke.fields.find(le=>le.key===E)?.value;He&&_.push(He.toString())}),E){case It:Q.kind&&_.push(Q.kind);break;case wt:Q.statusCode!==void 0&&_.push(A.s[Q.statusCode].toLowerCase());break;case ut:Q.statusMessage&&_.push(Q.statusMessage);break;case ht:Q.instrumentationLibraryName&&_.push(Q.instrumentationLibraryName);break;case gt:Q.instrumentationLibraryVersion&&_.push(Q.instrumentationLibraryVersion);break;case pt:Q.traceState&&_.push(Q.traceState);break;case Et:_.push(Q.spanID);break;default:break}}),(0,xe.uniq)(_).sort().map(Ve.z)},at=(E,_)=>{r({...s,tags:s.tags?.map(ne=>ne.id===E.id?{...ne,key:_?.value||"",value:void 0}:ne)}),(async()=>{if(_?.value)se({...V,[E.id]:await Ye(_.value)});else{const ne={...V};ne[E.id]&&delete ne[E.id],se(ne)}})()},Je=()=>{const E={id:(0,qs.zE)(),operator:"="};r({...s,tags:[...s.tags,E]})},it=E=>{let _=s.tags.filter(Q=>Q.id!==E);_.length===0&&(_=[{id:(0,qs.zE)(),operator:"="}]),r({...s,tags:_})},De=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(dt.m,{content:"Filter your spans below. You can continue to apply filters until you have narrowed down your resulting spans to the select few you are most interested in.",placement:"right",children:(0,n.jsxs)("span",{className:M.collapseLabel,children:["Span Filters",(0,n.jsx)(ye.I,{size:"md",name:"info-circle"})]})}),!i&&(0,n.jsx)("div",{className:M.nextPrevResult,children:(0,n.jsx)(In,{trace:t,spanFilterMatches:R,setFocusedSpanIdForSearch:w,focusedSpanIndexForSearch:ce,setFocusedSpanIndexForSearch:fe,datasourceType:k,showSpanFilters:i})})]});return(0,n.jsx)("div",{className:M.container,children:(0,n.jsxs)(Br.S,{label:De,collapsible:!0,isOpen:i,onToggle:o,children:[(0,n.jsxs)(hs.C,{className:M.flexContainer,children:[(0,n.jsx)(zt.I,{label:"Service Name",labelWidth:16,children:(0,n.jsxs)(gs.Gy,{spacing:"xs",children:[(0,n.jsx)(ft.l6,{"aria-label":"Select service name operator",onChange:E=>ge({...s,serviceNameOperator:E.value}),options:[(0,Ve.z)("="),(0,Ve.z)("!=")],value:s.serviceNameOperator}),(0,n.jsx)(ft.l6,{"aria-label":"Select service name",isClearable:!0,onChange:E=>ge({...s,serviceName:E?.value||""}),onOpenMenu:Qe,options:P,placeholder:"All service names",value:s.serviceName||null})]})}),(0,n.jsx)(_r,{onChange:E=>{ge({...s,query:E}),E===""&&d(!1)},value:s.query||""})]}),(0,n.jsx)(hs.C,{children:(0,n.jsx)(zt.I,{label:"Span Name",labelWidth:16,children:(0,n.jsxs)(gs.Gy,{spacing:"xs",children:[(0,n.jsx)(ft.l6,{"aria-label":"Select span name operator",onChange:E=>ge({...s,spanNameOperator:E.value}),options:[(0,Ve.z)("="),(0,Ve.z)("!=")],value:s.spanNameOperator}),(0,n.jsx)(ft.l6,{"aria-label":"Select span name",isClearable:!0,onChange:E=>ge({...s,spanName:E?.value||""}),onOpenMenu:Pe,options:U,placeholder:"All span names",value:s.spanName||null})]})})}),(0,n.jsx)(hs.C,{children:(0,n.jsx)(zt.I,{label:"Duration",labelWidth:16,tooltip:"Filter by duration. Accepted units are ns, us, ms, s, m, h",children:(0,n.jsxs)(gs.Gy,{spacing:"xs",align:"flex-start",children:[(0,n.jsx)(ft.l6,{"aria-label":"Select min span operator",onChange:E=>ge({...s,fromOperator:E.value}),options:[(0,Ve.z)(">"),(0,Ve.z)(">=")],value:s.fromOperator}),(0,n.jsx)("div",{className:M.intervalInput,children:(0,n.jsx)(Sn,{ariaLabel:"Select min span duration",onChange:E=>ge({...s,from:E}),isInvalidError:"Invalid duration",placeholder:"e.g. 100ms, 1.2s",width:18,value:s.from||"",validationRegex:Te})}),(0,n.jsx)(ft.l6,{"aria-label":"Select max span operator",onChange:E=>ge({...s,toOperator:E.value}),options:[(0,Ve.z)("<"),(0,Ve.z)("<=")],value:s.toOperator}),(0,n.jsx)(Sn,{ariaLabel:"Select max span duration",onChange:E=>ge({...s,to:E}),isInvalidError:"Invalid duration",placeholder:"e.g. 100ms, 1.2s",width:18,value:s.to||"",validationRegex:Te})]})})}),(0,n.jsx)(hs.C,{className:M.tagsRow,children:(0,n.jsx)(zt.I,{label:"Tags",labelWidth:16,tooltip:"Filter by tags, process tags or log fields in your spans.",children:(0,n.jsx)("div",{children:s.tags.map((E,_)=>(0,n.jsx)("div",{children:(0,n.jsxs)(gs.Gy,{spacing:"xs",width:"auto",children:[(0,n.jsx)(ft.l6,{"aria-label":"Select tag key",isClearable:!0,onChange:Q=>at(E,Q),onOpenMenu:Ce,options:G,placeholder:"Select tag",value:E.key||null},E.key),(0,n.jsx)(ft.l6,{"aria-label":"Select tag operator",onChange:Q=>{ge({...s,tags:s.tags?.map(ne=>ne.id===E.id?{...ne,operator:Q.value}:ne)})},options:[(0,Ve.z)("="),(0,Ve.z)("!="),(0,Ve.z)("=~"),(0,Ve.z)("!~")],value:E.operator}),(0,n.jsxs)("span",{className:M.tagValues,children:[(E.operator==="="||E.operator==="!=")&&(0,n.jsx)(ft.l6,{"aria-label":"Select tag value",isClearable:!0,onChange:Q=>{ge({...s,tags:s.tags?.map(ne=>ne.id===E.id?{...ne,value:Q?.value||""}:ne)})},options:V[E.id]?V[E.id]:[],placeholder:"Select value",value:E.value},E.value),(E.operator==="=~"||E.operator==="!~")&&(0,n.jsx)(Js.p,{"aria-label":"Input tag value",onChange:Q=>{ge({...s,tags:s.tags?.map(ne=>ne.id===E.id?{...ne,value:Q?.currentTarget?.value||""}:ne)})},placeholder:"Tag value",width:18,value:E.value||""})]}),(E.key||E.value||s.tags.length>1)&&(0,n.jsx)(yn.Z,{"aria-label":"Remove tag",variant:"secondary",icon:"times",onClick:()=>it(E.id),tooltip:"Remove tag"}),(E.key||E.value)&&_===s.tags.length-1&&(0,n.jsx)("span",{className:M.addTag,children:(0,n.jsx)(yn.Z,{"aria-label":"Add tag",variant:"secondary",icon:"plus",onClick:Je,tooltip:"Add tag"})})]})},_))})})}),(0,n.jsx)(Ur,{trace:t,search:s,spanFilterMatches:R,showSpanFilterMatchesOnly:l,setShowSpanFilterMatchesOnly:d,showCriticalPathSpansOnly:g,setShowCriticalPathSpansOnly:f,setFocusedSpanIdForSearch:w,focusedSpanIndexForSearch:ce,setFocusedSpanIndexForSearch:fe,datasourceType:k,clear:Le,showSpanFilters:i})]})})});Dn.displayName="SpanFilters";const Qr=e=>({container:(0,a.css)({label:"SpanFilters",margin:`0.5em 0 -${e.spacing(1)} 0`,zIndex:5,"& > div":{borderLeft:"none",borderRight:"none"}}),collapseLabel:(0,a.css)({svg:{color:"#aaa",margin:"-2px 0 0 10px"}}),flexContainer:(0,a.css)({display:"flex",justifyContent:"space-between"}),addTag:(0,a.css)({marginLeft:e.spacing(1)}),intervalInput:(0,a.css)({margin:"0 -4px 0 0"}),tagsRow:(0,a.css)({margin:"-4px 0 0 0"}),tagValues:(0,a.css)({maxWidth:"200px"}),nextPrevResult:(0,a.css)({flex:1,alignItems:"center",display:"flex",justifyContent:"flex-end",marginRight:e.spacing(1)})}),kn=(0,u.memo)(e=>{const{trace:t,data:s,app:r,timeZone:i,search:o,setSearch:l,showSpanFilters:d,setShowSpanFilters:g,showSpanFilterMatchesOnly:f,setShowSpanFilterMatchesOnly:w,showCriticalPathSpansOnly:R,setShowCriticalPathSpansOnly:k,setFocusedSpanIdForSearch:M,spanFilterMatches:P,datasourceType:O,setHeaderHeight:U}=e,F=(0,I.of)(Yr);(0,u.useEffect)(()=>{U(document.querySelector("."+F.header)?.scrollHeight??0)},[U,d,F.header]);const G=(0,u.useMemo)(()=>t?kr(t):[],[t]);if(!t)return null;const J=(ge,Qe)=>{const Pe=(0,re.LE)(ge.startTime/1e3,{timeZone:Qe,defaultWithMS:!0}),Ce=Pe.match(/^(.+)(:\d\d\.\d+)$/);return Ce?(0,n.jsxs)("span",{className:F.TracePageHeaderOverviewItemValue,children:[Ce[1],(0,n.jsx)("span",{className:F.TracePageHeaderOverviewItemValueDetail,children:Ce[2]})]}):Pe},V=(0,n.jsxs)("h1",{className:q()(F.title),children:[(0,n.jsx)(dr,{traceName:vn(t.spans)}),(0,n.jsx)("small",{className:F.duration,children:(0,Be.a3)(t.duration)})]}),{method:se,status:ce,url:fe}=Er(t.spans);let Te="green";ce&&ce.length>0&&(ce[0].value.toString().charAt(0)==="4"?Te="orange":ce[0].value.toString().charAt(0)==="5"&&(Te="red"));const Le=ge=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{children:"http.url or http.target or http.path"}),(0,n.jsxs)("div",{children:["(",ge,")"]})]});return(0,n.jsxs)("header",{className:F.header,children:[(0,n.jsxs)("div",{className:F.titleRow,children:[G&&G.length>0&&(0,n.jsx)(nr,{links:G,className:F.TracePageHeaderBack}),V,(0,n.jsx)(Ar,{traceId:t.traceID,data:s,app:r})]}),(0,n.jsxs)("div",{className:F.subtitle,children:[(0,n.jsx)("span",{className:F.timestamp,children:J(t,i)}),(0,n.jsxs)("span",{className:F.tagMeta,children:[se&&se.length>0&&(0,n.jsx)(dt.m,{content:"http.method",interactive:!0,children:(0,n.jsx)("span",{className:F.tag,children:(0,n.jsx)(un.E,{text:se[0].value,color:"blue"})})}),ce&&ce.length>0&&(0,n.jsx)(dt.m,{content:"http.status_code",interactive:!0,children:(0,n.jsx)("span",{className:F.tag,children:(0,n.jsx)(un.E,{text:ce[0].value,color:Te})})}),fe&&fe.length>0&&(0,n.jsx)(dt.m,{content:Le(fe[0].value),interactive:!0,children:(0,n.jsx)("span",{className:F.url,children:fe[0].value})})]})]}),(0,n.jsx)(Dn,{trace:t,showSpanFilters:d,setShowSpanFilters:g,showSpanFilterMatchesOnly:f,setShowSpanFilterMatchesOnly:w,showCriticalPathSpansOnly:R,setShowCriticalPathSpansOnly:k,search:o,setSearch:l,spanFilterMatches:P,setFocusedSpanIdForSearch:M,datasourceType:O})]})});kn.displayName="TracePageHeader";const Yr=e=>({TracePageHeaderBack:(0,a.css)({label:"TracePageHeaderBack",alignItems:"center",alignSelf:"stretch",backgroundColor:"#fafafa",borderBottom:"1px solid #ddd",borderRight:"1px solid #ddd",color:"inherit",display:"flex",fontSize:"1.4rem",padding:"0 1rem",marginBottom:"-1px","&:hover":{backgroundColor:"#f0f0f0",borderColor:"#ccc"}}),TracePageHeaderOverviewItemValueDetail:q()((0,a.css)({label:"TracePageHeaderOverviewItemValueDetail",color:"#aaa"}),"trace-item-value-detail"),TracePageHeaderOverviewItemValue:(0,a.css)({label:"TracePageHeaderOverviewItemValue","&:hover > .trace-item-value-detail":{color:"unset"}}),header:(0,a.css)({label:"TracePageHeader",backgroundColor:e.colors.background.primary,padding:"0.5em 0 0 0",position:"sticky",top:0,zIndex:5,textAlign:"left"}),titleRow:(0,a.css)({alignItems:"flex-start",display:"flex",padding:"0 8px",flexWrap:"wrap"}),title:(0,a.css)({color:"inherit",flex:1,fontSize:"1.7em",lineHeight:"1em",marginBottom:0,minWidth:"200px"}),subtitle:(0,a.css)({flex:1,lineHeight:"1em",margin:"-0.5em 0.5em 0.75em 0.5em"}),tag:(0,a.css)({margin:"0 0.5em 0 0"}),duration:(0,a.css)({color:"#aaa",margin:"0 0.75em"}),timestamp:(0,a.css)({verticalAlign:"middle"}),tagMeta:(0,a.css)({margin:"0 0.75em",verticalAlign:"text-top"}),url:(0,a.css)({margin:"-2.5px 0.3em",height:"15px",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"700px",display:"inline-block"}),TracePageHeaderTraceId:(0,a.css)({label:"TracePageHeaderTraceId",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"30%",display:"inline-block"})}),Xr="None",Jr="Duration",Rn="Tag";function qr({options:e,onOptionsChange:t}){const s=useStyles2(ea),r=[Xr,Jr,Rn].map(toOption);return jsxs("div",{className:css({width:"100%"}),children:[jsx(InlineFieldRow,{className:s.row,children:jsx(InlineField,{label:"Label",labelWidth:26,tooltip:"Default: duration",grow:!0,children:jsx(Select,{inputId:"label",options:r,value:e.jsonData.spanBar?.type||"",onChange:i=>{updateDatasourcePluginJsonDataOption({onOptionsChange:t,options:e},"spanBar",{...e.jsonData.spanBar,type:i?.value??""})},placeholder:"Duration",isClearable:!0,"aria-label":"select-label-name",width:40})})}),e.jsonData.spanBar?.type===Rn&&jsx(InlineFieldRow,{className:s.row,children:jsx(InlineField,{label:"Tag key",labelWidth:26,tooltip:"Tag key which will be used to get the tag value. A span's attributes and resources will be searched for the tag key",children:jsx(Input,{type:"text",placeholder:"Enter tag key",onChange:i=>updateDatasourcePluginJsonDataOption({onOptionsChange:t,options:e},"spanBar",{...e.jsonData.spanBar,tag:i.currentTarget.value}),value:e.jsonData.spanBar?.tag||"",width:40})})})]})}const ca=({options:e,onOptionsChange:t})=>{let s=e.type;return s+=e.type==="tempo"?"/configure-tempo-data-source/#span-bar":"/#span-bar",jsx(ConfigSubSection,{title:"Span bar",description:jsx(ConfigDescriptionLink,{description:"Add additional info next to the service and operation on a span bar row in the trace view.",suffix:s,feature:"the span bar"}),children:jsx(qr,{options:e,onOptionsChange:t})})},ea=e=>({infoText:css({label:"infoText",paddingBottom:e.spacing(2),color:e.colors.text.secondary}),row:css({label:"row",alignItems:"baseline"})});class nt{constructor(t){const{isTagsOpen:s,isProcessOpen:r,isReferencesOpen:i,isWarningsOpen:o,isStackTracesOpen:l,logs:d,references:g}=t||{};this.isTagsOpen=!!s,this.isProcessOpen=!!r,this.isReferencesOpen=!!i,this.isWarningsOpen=!!o,this.isStackTracesOpen=!!l,this.logs={isOpen:!!(d&&d.isOpen),openedItems:d&&d.openedItems?new Set(d.openedItems):new Set},this.references={isOpen:!!(g&&g.isOpen),openedItems:g&&g.openedItems?new Set(g.openedItems):new Set}}toggleTags(){const t=new nt(this);return t.isTagsOpen=!this.isTagsOpen,t}toggleProcess(){const t=new nt(this);return t.isProcessOpen=!this.isProcessOpen,t}toggleReferences(){const t=new nt(this);return t.references.isOpen=!this.references.isOpen,t}toggleReferenceItem(t){const s=new nt(this);return s.references.openedItems.has(t)?s.references.openedItems.delete(t):s.references.openedItems.add(t),s}toggleWarnings(){const t=new nt(this);return t.isWarningsOpen=!this.isWarningsOpen,t}toggleStackTraces(){const t=new nt(this);return t.isStackTracesOpen=!this.isStackTracesOpen,t}toggleLogs(){const t=new nt(this);return t.logs.isOpen=!this.logs.isOpen,t}toggleLogItem(t){const s=new nt(this);return s.logs.openedItems.has(t)?s.logs.openedItems.delete(t):s.logs.openedItems.add(t),s}}var fs=c(25508);class rt{static iterFunction(t,s=0){return r=>t(r.value,r,s)}static searchFunction(t){return typeof t=="function"?t:(s,r)=>t instanceof rt?r===t:s===t}constructor(t,s=[]){this.value=t,this.children=s}get depth(){return this.children.reduce((t,s)=>Math.max(s.depth+1,t),1)}get size(){let t=0;return this.walk(()=>t++),t}addChild(t){return this.children.push(t instanceof rt?t:new rt(t)),this}find(t){if(rt.iterFunction(rt.searchFunction(t))(this))return this;for(let r=0;r<this.children.length;r++){const i=this.children[r].find(t);if(i)return i}return null}getPath(t){const s=rt.iterFunction(rt.searchFunction(t)),r=(i,o)=>{const l=o.concat([i]);if(s(i))return l;for(let d=0;d<i.children.length;d++){const g=i.children[d],f=r(g,l);if(f)return f}return null};return r(this,[])}walk(t,s=0){const r=[];let i=s;for(r.push({node:this,depth:i});r.length;){const o=r[r.length-1];r.pop();const{node:l,depth:d}=o;t(l.value,l,d),i=d+1;let g=l.children.length-1;for(;g>=0;)r.push({node:l.children[g],depth:i}),g--}}paths(t){const s=[];s.push({node:this,childIndex:0});const r=[];for(;s.length;){const{node:i,childIndex:o}=s[s.length-1];if(i.children.length>=o+1)s[s.length-1].childIndex++,s.push({node:i.children[o],childIndex:0});else{if(i.children.length===0){const l=s.map(d=>d.node.value);t(l)}s.pop()}}return r}}const ta=e=>e.spanID,sa=e=>e.references||[],na=(0,fs.Mz)((0,fs.Mz)(({span:e})=>e,sa),({type:e})=>e,(e,t)=>e.find(s=>s.refType===t)),da=(0,fs.Mz)(e=>na({span:e,type:"CHILD_OF"}),e=>e?e.spanID:null),ra=e=>e.spans,ua=(0,fs.Mz)(ra,e=>e.reduce((t,s)=>t.set(ta(s),s),new Map)),aa="__root__";function ia(e,t=null){const s=new Map(e.spans.map(l=>[l.spanID,new rt(l.spanID)])),r=t??new Map(e.spans.map(l=>[l.spanID,l])),i=new rt(aa);e.spans.forEach(l=>{const d=s.get(l.spanID);if(Array.isArray(l.references)&&l.references.length){const{refType:g,spanID:f}=l.references[0];if(g==="CHILD_OF"||g==="FOLLOWS_FROM")(s.get(f)||i).children?.push(d);else throw new Error(`Unrecognized ref type: ${g}`)}else i.children.push(d)});const o=(l,d)=>{const g=l?.value?r.get(l.value.toString()):void 0,f=d?.value?r.get(d.value.toString()):void 0;return+(g?.startTime>f?.startTime)||+(g?.startTime===f?.startTime)-1};return e.spans.forEach(l=>{const d=s.get(l.spanID);d.children.length>1&&d?.children.sort(o)}),i.children.sort(o),i}function oa(e){const t=new Map,s=e.reduce((i,o)=>(i.some(l=>l.key===o.key&&l.value===o.value)?t.set(`${o.key}:${o.value}`,`Duplicate tag "${o.key}:${o.value}"`):i.push(o),i),[]),r=Array.from(t.values());return{dedupedTags:s,warnings:r}}function Ln(e,t){const s=e?.slice()??[],r=(t||[]).map(i=>i.toLowerCase());return s.sort((i,o)=>{const l=i.key.toLowerCase(),d=o.key.toLowerCase();for(let g=0;g<r.length;g++){const f=r[g];if(l.startsWith(f)&&!d.startsWith(f))return-1;if(!l.startsWith(f)&&d.startsWith(f))return 1}return l>d?1:l<d?-1:0}),s}function la(e){if(!e?.traceID)return null;const t=e.traceID.toLowerCase();let s=0,r=Number.MAX_SAFE_INTEGER;const i=new Map,o=new Map;e.spans=e.spans.filter(k=>!!k.startTime),e.processes=Object.entries(e.processes).reduce((k,[M,P])=>(k[M]={...P,tags:Ln(P.tags)},k),{});const l=e.spans.length;for(let k=0;k<l;k++){const M=e.spans[k],{startTime:P,duration:O,processID:U}=M;let F=M.spanID;P<r&&(r=P),P+O>s&&(s=P+O);const G=i.get(F);G!=null?(console.warn(`Dupe spanID, ${G+1} x ${F}`,M,o.get(F)),(0,xe.isEqual)(M,o.get(F))&&console.warn("	 two spans with same ID have `isEqual(...) === true`"),i.set(F,G+1),F=`${F}_${G}`,M.spanID=F):i.set(F,1),M.process=e.processes[U],o.set(F,M)}const d=ia(e,o),g=[],f={};d.walk((k,M,P=0)=>{if(k==="__root__"||typeof k!="string")return;const O=o.get(k);if(!O)return;const{serviceName:U}=O.process;f[U]=(f[U]||0)+1,O.relativeStartTime=O.startTime-r,O.depth=P-1,O.hasChildren=M.children.length>0,O.childSpanCount=M.children.length,O.warnings=O.warnings||[],O.tags=O.tags||[],O.references=O.references||[],O.childSpanIds=M.children.slice().sort((G,J)=>{const V=o.get(G.value),se=o.get(J.value);return se.startTime+se.duration-(V.startTime+V.duration)}).map(G=>G.value);const F=oa(O.tags);O.tags=Ln(F.dedupedTags,gn("topTagPrefixes")),O.warnings=O.warnings.concat(F.warnings),O.references.forEach((G,J)=>{const V=o.get(G.spanID);V&&(G.span=V,J>0&&(V.subsidiarilyReferencedBy=V.subsidiarilyReferencedBy||[],V.subsidiarilyReferencedBy.push({spanID:k,traceID:t,span:O,refType:G.refType})))}),g.push(O)});const w=vn(g);return{services:Object.keys(f).map(k=>({name:k,numberOfSpans:f[k]})),spans:g,traceID:t,traceName:w,processes:e.processes,duration:s-r,startTime:r,endTime:s}}},92102:(S,v,c)=>{"use strict";c.d(v,{N:()=>n});var n=(a=>(a.Logs="log",a.Traces="trace",a.Metrics="metric",a.Profiles="profile",a.Session="session",a.Unknown="unknown",a))(n||{})},92151:(S,v,c)=>{"use strict";c.d(v,{EUpdateTypes:()=>a,default:()=>N});var n=(b=>(b.DragEnd="DragEnd",b.DragMove="DragMove",b.DragStart="DragStart",b.MouseEnter="MouseEnter",b.MouseLeave="MouseLeave",b.MouseMove="MouseMove",b))(n||{});const a=n;var u=c(2543);const T=0;class N{constructor({getBounds:I,tag:p,resetBoundsOnResize:H=!0,...$}){this.resetBounds=()=>{this._bounds=void 0},this._handleMinorMouseEvent=B=>{const{button:W,clientX:z,type:te}=B;if(this._isDragging||W!==T)return;let de=null,pe;if(te==="mouseenter")de=a.MouseEnter,pe=this._onMouseEnter;else if(te==="mouseleave")de=a.MouseLeave,pe=this._onMouseLeave;else if(te==="mousemove")de=a.MouseMove,pe=this._onMouseMove;else throw new Error(`invalid event type: ${te}`);if(!pe)return;const{value:Ee,x:q}=this._getPosition(z);pe({event:B,type:de,value:Ee,x:q,manager:this,tag:this.tag})},this._handleDragEvent=B=>{const{button:W,clientX:z,type:te}=B;let de=null,pe;if(te==="mousedown"){if(this._isDragging||W!==T)return;window.addEventListener("mousemove",this._handleDragEvent),window.addEventListener("mouseup",this._handleDragEvent);const Be=(0,u.get)(document,"body.style");Be&&(Be.userSelect="none"),this._isDragging=!0,de=a.DragStart,pe=this._onDragStart}else if(te==="mousemove"){if(!this._isDragging)return;de=a.DragMove,pe=this._onDragMove}else if(te==="mouseup"){if(!this._isDragging)return;this._stopDragging(),de=a.DragEnd,pe=this._onDragEnd}else throw new Error(`invalid event type: ${te}`);if(!pe)return;const{value:Ee,x:q}=this._getPosition(z);pe({event:B,type:de,value:Ee,x:q,manager:this,tag:this.tag})},this.handleMouseDown=this._handleDragEvent,this.handleMouseEnter=this._handleMinorMouseEvent,this.handleMouseMove=this._handleMinorMouseEvent,this.handleMouseLeave=this._handleMinorMouseEvent,this.getBounds=I,this.tag=p,this._isDragging=!1,this._bounds=void 0,this._resetBoundsOnResize=!!H,this._resetBoundsOnResize&&window.addEventListener("resize",this.resetBounds),this._onMouseEnter=$.onMouseEnter,this._onMouseLeave=$.onMouseLeave,this._onMouseMove=$.onMouseMove,this._onDragStart=$.onDragStart,this._onDragMove=$.onDragMove,this._onDragEnd=$.onDragEnd}_getBounds(){return this._bounds||(this._bounds=this.getBounds(this.tag)),this._bounds}_getPosition(I){const{clientXLeft:p,maxValue:H,minValue:$,width:B}=this._getBounds();let W=I-p,z=W/B;return $!=null&&z<$?(z=$,W=$*B):H!=null&&z>H&&(z=H,W=H*B),{value:z,x:W}}_stopDragging(){window.removeEventListener("mousemove",this._handleDragEvent),window.removeEventListener("mouseup",this._handleDragEvent);const I=(0,u.get)(document,"body.style");I&&(I.userSelect="auto"),this._isDragging=!1}isDragging(){return this._isDragging}dispose(){this._isDragging&&this._stopDragging(),this._resetBoundsOnResize&&window.removeEventListener("resize",this.resetBounds),this._bounds=void 0,this._onMouseEnter=void 0,this._onMouseLeave=void 0,this._onMouseMove=void 0,this._onDragStart=void 0,this._onDragMove=void 0,this._onDragEnd=void 0}}},30700:(S,v,c)=>{"use strict";c.d(v,{Kv:()=>p,rY:()=>H});var n=c(41811),a=c(84140),u=c(24284);function T(B){if(B.length!==7)return[0,0,0];const W=B.slice(1,3),z=B.slice(3,5),te=B.slice(5);return[parseInt(W,16),parseInt(z,16),parseInt(te,16)]}class N{constructor(W,z){const te=$(W,z);this.colorsHex=te,this.colorsRgb=te.map(T),this.cache=new Map,this.prevColorIndex=void 0}_getColorIndex(W){let z=this.cache.get(W);if(z==null){const te=this.hashCode(W?W.toLowerCase():"");if(z=Math.abs(te%this.colorsHex.length),this.prevColorIndex!==void 0){this.prevColorIndex===z&&(z=this.getNextIndex(z));const de=this.colorsHex[this.prevColorIndex];if(a.A.readability(de,this.colorsHex[z])<1.5){let pe=z;for(let Ee=0;Ee<this.colorsHex.length;Ee++)if(pe=this.getNextIndex(pe),a.A.readability(de,this.colorsHex[pe])>1.5){z=pe;break}}}this.cache.set(W,z),this.prevColorIndex=z}return z}getNextIndex(W){return W+1<this.colorsHex.length?W+1:0}hashCode(W){let z=0,te,de;for(te=0;te<W.length;te++)de=W.charCodeAt(te),z=(z<<5)-z+de;return z}getColorByKey(W){const z=this._getColorIndex(W);return this.colorsHex[z]}getRgbColorByKey(W){const z=this._getColorIndex(W);return this.colorsRgb[z]}clear(){this.cache.clear()}}const b=(0,n.A)((B,W)=>new N(B,W));function I(B){b([],B)}function p(B,W){return b(u.Tj,W).getColorByKey(B)}function H(B,W){return b(u.Tj,W).getRgbColorByKey(B)}function $(B,W){const z=[...B],te=z.indexOf("#E24D42");te>-1&&z.splice(te,1);const de=B.indexOf("#BF1B00");de>-1&&z.splice(de,1);let pe=[];for(const Ee of z)a.A.readability(W.colors.background.primary,Ee)>=3&&pe.push(Ee);return pe}},6389:(S,v,c)=>{"use strict";c.d(v,{a3:()=>Be});var n=c(2543),a=c.n(n),u=c(84743),T=c.n(u);const N="YYYY-MM-DD",b="HH:mm",I=1e3,p=1e3*I,H=60*p,$=60*H,B=24*$,W=Math.log10(I),z=[{unit:"d",microseconds:B,ofPrevious:24},{unit:"h",microseconds:$,ofPrevious:60},{unit:"m",microseconds:H,ofPrevious:60},{unit:"s",microseconds:p,ofPrevious:1e3},{unit:"ms",microseconds:I,ofPrevious:1e3},{unit:"\u03BCs",microseconds:1,ofPrevious:1e3}],te=(be,Se,st)=>toFloatPrecision(be/st,Se)*st;function de(be){return moment(be/I).format(N)}function pe(be){return moment(be/I).format(b)}function Ee(be){const Se=te(be,W,I);return`${moment.duration(Se/I).asMilliseconds()}ms`}function q(be){const Se=te(be,W,p);return`${moment.duration(Se/I).asSeconds()}s`}function Be(be){const[Se,st]=(0,n.dropWhile)(z,({microseconds:xt},K)=>K<z.length-1&&xt>be);if(Se.ofPrevious===1e3)return`${(0,n.round)(be/Se.microseconds,2)}${Se.unit}`;const ot=`${Math.floor(be/Se.microseconds)}${Se.unit}`,lt=Math.round(be/st.microseconds%Se.ofPrevious),vt=`${lt}${st.unit}`;return lt===0?ot:`${ot} ${vt}`}},28114:(S,v,c)=>{"use strict";c.d(v,{Cr:()=>xt,QW:()=>te,_o:()=>We,gt:()=>lt,hv:()=>vt,i0:()=>z,lU:()=>$});var n=c(74848),a=c(6709),u=c(65879),T=c(47232),N=c(72574),b=c(14578),I=c(31193),p=c(96192),H=c(92102);function $({splitOpenFn:K,traceToLogsOptions:ee,traceToMetricsOptions:Z,traceToProfilesOptions:X,dataFrame:ae,createFocusSpanLink:ie,trace:Y}){if(!ae)return;let ze=lt(Y.duration,Y.traceName,Y.traceID);const _e=ae.fields.some(oe=>!!oe.config.links?.length),Lt=pe(K,ae.fields[0],ee,Z,ie,ze);return function(je){let Re=Lt(je);if(_e){ze={...ze,...vt(je),...xt(je,X)};const Ne=ae.fields.filter(Ke=>!!Ke.config.links?.length);try{let Ke;X?.datasourceUid&&(Ke=(0,I.tR)().getInstanceSettings(X.datasourceUid));const me=Ke?.type==="grafana-pyroscope-datasource",we=je.tags.some(Fe=>Fe.key===te),Ge=me&&we;let Ue=[];Ne.forEach(Fe=>{const Ze=(0,p.QL)({field:Fe,rowIndex:je.dataFrameRowIndex,splitOpenFn:K,range:ot(je,void 0,void 0,Ge),dataFrame:ae,vars:ze});Ue=Ue.concat(Ze)});const yt=Ue.map(Fe=>({title:Fe.title,href:Fe.href,onClick:Fe.onClick,content:(0,n.jsx)(b.I,{name:"link",title:Fe.title||"Link"}),field:Fe.origin,type:Ge?H.N.Profiles:H.N.Unknown,target:Fe.target}));Re.push.apply(Re,yt)}catch(Ke){return console.error(Ke),Re}}return Re}}const B=K=>K.map(ee=>({key:ee,value:ee.includes(".")?ee.replace(".","_"):void 0})),W=B(["cluster","hostname","namespace","pod","service.name","service.namespace"]),z=B(["service.name","service.namespace"]),te="pyroscope.profile.id",de="gf.feo11y.app.id";function pe(K,ee,Z,X,ae,ie){let Y;Z?.datasourceUid&&(Y=(0,I.tR)().getInstanceSettings(Z.datasourceUid));const ze=Y?.type==="grafana-splunk-datasource";let _e;return X?.datasourceUid&&(_e=(0,I.tR)().getInstanceSettings(X.datasourceUid)),function(oe){ie={...ie,...vt(oe)};const je=[];let Re,Ne="";if(Y&&Z){const me=Z.customQuery?Z.query:void 0,we=Z.tags&&Z.tags.length>0?Z.tags:W;switch(Y?.type){case"loki":Ne=We(oe,we),Re=Ee(oe,Z,Ne,me);break;case"grafana-splunk-datasource":Ne=We(oe,we,{joinBy:" "}),Re=be(oe,Z,Ne,me);break;case"elasticsearch":case"grafana-opensearch-datasource":Ne=We(oe,we,{labelValueSign:":",joinBy:" AND "}),Re=Be(oe,Z,Ne,me);break;case"grafana-falconlogscale-datasource":Ne=We(oe,we,{joinBy:" OR "}),Re=st(oe,Z,Ne,me);break;case"googlecloud-logging-datasource":Ne=We(oe,we,{joinBy:" AND "}),Re=Se(oe,Z,Ne,me)}if(Re){const Ge={title:Y.name,url:"",internal:{datasourceUid:Y.uid,datasourceName:Y.name,query:Re}};if(ie={...ie,__tags:{text:"Tags",value:Ne}},(0,p.O1)(Ge.internal.query,ie).allVariablesDefined){const Ue=(0,a.u)({link:Ge,internalLink:Ge.internal,scopedVars:ie,range:ot(oe,{startMs:Z.spanStartTimeShift?u.intervalToMs(Z.spanStartTimeShift):0,endMs:Z.spanEndTimeShift?u.intervalToMs(Z.spanEndTimeShift):0},ze),field:{},onClickFn:K,replaceVariables:(0,N.w)().replace.bind((0,N.w)())});je.push({href:Ue.href,title:"Related logs",onClick:Ue.onClick,content:(0,n.jsx)(b.I,{name:"gf-logs",title:"Explore the logs for this in split view"}),field:ee,type:H.N.Logs})}}}if(_e&&X?.queries)for(const me of X.queries){const we=me.query||`histogram_quantile(0.5, sum(rate(traces_spanmetrics_latency_bucket{service="${oe.process.serviceName}"}[5m])) by (le))`,Ge={title:_e.name,url:"",internal:{datasourceUid:_e.uid,datasourceName:_e.name,query:{expr:we,refId:"A"}}},Ue=X.tags&&X.tags.length>0?X.tags:W;ie={...ie,__tags:{text:"Tags",value:We(oe,Ue)}};const yt=(0,a.u)({link:Ge,internalLink:Ge.internal,scopedVars:ie,range:ot(oe,{startMs:X.spanStartTimeShift?u.intervalToMs(X.spanStartTimeShift):-12e4,endMs:X.spanEndTimeShift?u.intervalToMs(X.spanEndTimeShift):12e4}),field:{},onClickFn:K,replaceVariables:(0,N.w)().replace.bind((0,N.w)())});je.push({title:me?.name,href:yt.href,onClick:yt.onClick,content:(0,n.jsx)(b.I,{name:"chart-line",title:"Explore metrics for this span"}),field:ee,type:H.N.Metrics})}if(oe.references&&ae)for(const me of oe.references){if(me.refType==="CHILD_OF")continue;const we=ae(me.traceID,me.spanID);je.push({href:we.href,title:me.span?me.span.operationName:"View linked span",content:(0,n.jsx)(b.I,{name:"link",title:"View linked span"}),onClick:we.onClick,field:we.origin,type:H.N.Traces})}if(oe.subsidiarilyReferencedBy&&ae)for(const me of oe.subsidiarilyReferencedBy){const we=ae(me.traceID,me.spanID);je.push({href:we.href,title:me.span?me.span.operationName:"View linked span",content:(0,n.jsx)(b.I,{name:"link",title:"View linked span"}),onClick:we.onClick,field:we.origin,type:H.N.Traces})}const Ke=q(oe);return Ke&&je.push({title:"Session for this span",href:Ke,content:(0,n.jsx)(b.I,{name:"frontend-observability",title:"Session for this span"}),field:ee,type:H.N.Session}),je}}function Ee(K,ee,Z,X){const{filterByTraceID:ae,filterBySpanID:ie}=ee;if(X)return{expr:X,refId:""};if(!Z)return;let Y="{${__tags}}";return ae&&K.traceID&&(Y+=' | label_format log_line_contains_trace_id=`{{ contains "${__span.traceId}" __line__  }}` | log_line_contains_trace_id="true" OR trace_id="${__span.traceId}"'),ie&&K.spanID&&(Y+=' | label_format log_line_contains_span_id=`{{ contains "${__span.spanId}" __line__  }}` | log_line_contains_span_id="true" OR span_id="${__span.spanId}"'),{expr:Y,refId:""}}function q(K){const ee=K.process.tags.find(X=>X.key===de)?.value,Z=K.tags.find(X=>X.key==="session_id"||X.key==="session.id")?.value;return ee&&Z?`/a/grafana-kowalski-app/apps/${ee}/sessions/${Z}`:void 0}function Be(K,ee,Z,X){const{filterByTraceID:ae,filterBySpanID:ie}=ee;if(X)return{query:X,refId:"",metrics:[{id:"1",type:"logs"}]};let Y=[];return ie&&K.spanID&&Y.push('"${__span.spanId}"'),ae&&K.traceID&&Y.push('"${__span.traceId}"'),Z&&Y.push("${__tags}"),{query:Y.join(" AND "),refId:"",metrics:[{id:"1",type:"logs"}]}}function be(K,ee,Z,X){const{filterByTraceID:ae,filterBySpanID:ie}=ee;if(X)return{query:X,refId:""};let Y="";return Z&&(Y+="${__tags}"),ae&&K.traceID&&(Y+=' "${__span.traceId}"'),ie&&K.spanID&&(Y+=' "${__span.spanId}"'),{query:Y,refId:""}}function Se(K,ee,Z,X){const{filterByTraceID:ae,filterBySpanID:ie}=ee;if(X)return{query:X,refId:""};let Y=[];return ie&&K.spanID&&Y.push('"${__span.spanId}"'),ae&&K.traceID&&Y.push('"${__span.traceId}"'),Z&&Y.push("${__tags}"),{query:Y.join(" AND "),refId:""}}function st(K,ee,Z,X){const{filterByTraceID:ae,filterBySpanID:ie}=ee;if(X)return{lsql:X,refId:""};if(!Z)return;let Y="${__tags}";return ae&&K.traceID&&(Y+=' or "${__span.traceId}"'),ie&&K.spanID&&(Y+=' or "${__span.spanId}"'),{lsql:Y,refId:""}}function We(K,ee,{labelValueSign:Z="=",joinBy:X=", "}={}){return[...K.process.tags,...K.tags,{key:"spanId",value:K.spanID},{key:"traceId",value:K.traceID},{key:"name",value:K.operationName},{key:"duration",value:K.duration}].map(ae=>{const ie=ee.find(Y=>Y.key===ae.key);if(ie)return`${ie.value?ie.value:ie.key}${Z}"${ae.value}"`}).filter(ae=>!!ae).join(X)}function ot(K,ee={startMs:0,endMs:0},Z=!1,X=!1){let ae=Math.floor(K.startTime/1e3+ee.startMs);const ie=(K.startTime+K.duration)/1e3;let Y=Math.floor(ie+ee.endMs);Z&&Y-ae<1e3?Y=ae+1e3:X?(ae=ae-6e4,Y=Y+6e4):ae===Y&&Y++;const ze=(0,T.KQ)(Y),_e=(0,T.KQ)(ae);return{from:_e,to:ze,raw:{from:_e,to:ze}}}function lt(K,ee,Z){return{__trace:{text:"Trace",value:{duration:K,name:ee,traceId:Z}}}}function vt(K){const ee={};for(const Z of K.process.tags)ee[Z.key]=Z.value;for(const Z of K.tags)ee[Z.key]=Z.value;return{__span:{text:"Span",value:{spanId:K.spanID,traceId:K.traceID,duration:K.duration,name:K.operationName,tags:ee}}}}function xt(K,ee){let Z={};if(ee){const X=ee.tags&&ee.tags.length>0?ee.tags:z;Z={__tags:{text:"Tags",value:We(K,X)}}}return Z}},15583:(S,v,c)=>{"use strict";c.d(v,{Ji:()=>b,SQ:()=>I,zE:()=>T});var n=c(96540),a=c(62938),u=c(70673);const T=()=>(0,a.A)().slice(0,12),b={spanNameOperator:"=",serviceNameOperator:"=",fromOperator:">",toOperator:"<",tags:[{id:T(),operator:"="}]};function I(p){const[H,$]=(0,n.useState)(b),B=(0,n.useMemo)(()=>p&&(0,u.filterSpans)(H,p),[H,p]);return{search:H,setSearch:$,spanFilterMatches:B}}},35090:(S,v,c)=>{"use strict";c.d(v,{L:()=>u});var n=c(78368),a=c(70673);function u(N){if(!N)return null;let b=N.fields.length===1?N.fields[0].values[0]:T(N);return b?(0,a.transformTraceData)(b):null}function T(N){const b=new n.R(N),I={};for(let p=0;p<b.length;p++){const H=b.get(p);if(!H.spanID)return null;I[H.spanID]||(I[H.spanID]={serviceName:H.serviceName,tags:H.serviceTags})}return{traceID:b.get(0).traceID,processes:I,spans:b.toArray().map((p,H)=>{const $=[];return p.parentSpanID&&$.push({refType:"CHILD_OF",spanID:p.parentSpanID,traceID:p.traceID}),p.references&&$.push(...p.references.map(B=>({refType:"FOLLOWS_FROM",...B}))),{...p,duration:p.duration*1e3,startTime:p.startTime*1e3,processID:p.spanID,flags:0,references:$,logs:p.logs?.map(B=>({...B,timestamp:B.timestamp*1e3}))||[],dataFrameRowIndex:H}})}}},72834:S=>{const v="    ";function c(T){let N="";return T&&Object.keys(T).forEach(function(b){N+=b+":"+T[b]+";"}),N}function n(T){function N(I){return'class="'+I+'"'}function b(I){return'style="'+c(T["."+I])+'"'}return T?b:N}function a(T){return T===null?"null":Array.isArray(T)?"array":typeof T=="string"&&/^https?:/.test(T)?"link":typeof T=="object"&&typeof T.toISOString=="function"?"date":typeof T}function u(T){return T.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}S.exports=function(T,N){let b="";const I=n(N);let p=function($,B,W,z){if(!$.length)return B+" "+W;let te=B+`
`;return b+=v,$.forEach(function(de,pe){te+=b+z(de)+(pe<$.length-1?",":"")+`
`}),b=b.slice(0,-v.length),te+b+W};function H($){if($===void 0)return"";switch(a($)){case"boolean":return"<span "+I("json-markup-bool")+">"+$+"</span>";case"number":return"<span "+I("json-markup-number")+">"+$+"</span>";case"date":return'<span class="json-markup-string">"'+u($.toISOString())+'"</span>';case"null":return"<span "+I("json-markup-null")+">null</span>";case"string":return"<span "+I("json-markup-string")+'>"'+u($.replace(/\n/g,`
`+b))+'"</span>';case"link":return"<span "+I("json-markup-string")+'>"<a href="'+encodeURI($)+'">'+u($)+'</a>"</span>';case"array":return p($,"[","]",H);case"object":const B=Object.keys($).filter(function(W){return $[W]!==void 0});return p(B,"{","}",function(W){return"<span "+I("json-markup-key")+'>"'+u(W)+'":</span> '+H($[W])})}return""}return"<div "+I("json-markup")+">"+H(T)+"</div>"}}}]);

//# sourceMappingURL=500.e3b769358f48206e0bed.js.map