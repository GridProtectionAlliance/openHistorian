{"version":3,"sources":["webpack:///./public/app/features/users/UsersTable.tsx","webpack:///./public/app/features/admin/AdminEditOrgPage.tsx"],"names":["UsersTable","props","users","onRoleChange","onRemoveUser","useState","showRemoveModal","setShowRemoveModal","className","style","width","map","user","index","key","userId","src","avatarUrl","title","login","email","name","lastSeenAtAge","value","role","onChange","newRole","size","variant","onClick","icon","body","confirmText","onDismiss","isOpen","onConfirm","getOrg","orgId","getBackendSrv","get","getOrgUsers","updateOrgUserRole","orgUser","patch","removeOrgUser","delete","AdminEditOrgPage","navIndex","useSelector","state","navModel","getNavModel","location","routeParams","id","setUsers","useAsyncFn","orgState","fetchOrg","fetchOrgUsers","useEffect","then","res","updateOrgName","put","Contents","defaultValues","orgName","onSubmit","values","register","errors","label","invalid","error","ref","required","css","length","filter"],"mappings":"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","file":"AdminEditOrgPage.591ee81e63053ad31983.js","sourcesContent":["import React, { FC, useState } from 'react';\nimport { OrgUser } from 'app/types';\nimport { OrgRolePicker } from '../admin/OrgRolePicker';\nimport { Button, ConfirmModal } from '@grafana/ui';\nimport { OrgRole } from '@grafana/data';\n\nexport interface Props {\n  users: OrgUser[];\n  onRoleChange: (role: OrgRole, user: OrgUser) => void;\n  onRemoveUser: (user: OrgUser) => void;\n}\n\nconst UsersTable: FC<Props> = props => {\n  const { users, onRoleChange, onRemoveUser } = props;\n\n  const [showRemoveModal, setShowRemoveModal] = useState<string | boolean>(false);\n  return (\n    <table className=\"filter-table form-inline\">\n      <thead>\n        <tr>\n          <th />\n          <th>Login</th>\n          <th>Email</th>\n          <th>Name</th>\n          <th>Seen</th>\n          <th>Role</th>\n          <th style={{ width: '34px' }} />\n        </tr>\n      </thead>\n      <tbody>\n        {users.map((user, index) => {\n          return (\n            <tr key={`${user.userId}-${index}`}>\n              <td className=\"width-2 text-center\">\n                <img className=\"filter-table__avatar\" src={user.avatarUrl} />\n              </td>\n              <td className=\"max-width-6\">\n                <span className=\"ellipsis\" title={user.login}>\n                  {user.login}\n                </span>\n              </td>\n\n              <td className=\"max-width-5\">\n                <span className=\"ellipsis\" title={user.email}>\n                  {user.email}\n                </span>\n              </td>\n              <td className=\"max-width-5\">\n                <span className=\"ellipsis\" title={user.name}>\n                  {user.name}\n                </span>\n              </td>\n              <td className=\"width-1\">{user.lastSeenAtAge}</td>\n\n              <td className=\"width-8\">\n                <OrgRolePicker value={user.role} onChange={newRole => onRoleChange(newRole, user)} />\n              </td>\n\n              <td>\n                <Button size=\"sm\" variant=\"destructive\" onClick={() => setShowRemoveModal(user.login)} icon=\"times\" />\n                <ConfirmModal\n                  body={`Are you sure you want to delete user ${user.login}?`}\n                  confirmText=\"Delete\"\n                  title=\"Delete\"\n                  onDismiss={() => setShowRemoveModal(false)}\n                  isOpen={user.login === showRemoveModal}\n                  onConfirm={() => {\n                    onRemoveUser(user);\n                  }}\n                />\n              </td>\n            </tr>\n          );\n        })}\n      </tbody>\n    </table>\n  );\n};\n\nexport default UsersTable;\n","import React, { FC, useState, useEffect } from 'react';\nimport Page from 'app/core/components/Page/Page';\nimport { useSelector } from 'react-redux';\nimport { StoreState, OrgUser } from 'app/types';\nimport { getNavModel } from 'app/core/selectors/navModel';\nimport UsersTable from '../users/UsersTable';\nimport { useAsyncFn } from 'react-use';\nimport { getBackendSrv } from '@grafana/runtime';\nimport { UrlQueryValue } from '@grafana/data';\nimport { Form, Field, Input, Button, Legend } from '@grafana/ui';\nimport { css } from 'emotion';\n\ninterface OrgNameDTO {\n  orgName: string;\n}\n\nconst getOrg = async (orgId: UrlQueryValue) => {\n  return await getBackendSrv().get('/api/orgs/' + orgId);\n};\n\nconst getOrgUsers = async (orgId: UrlQueryValue) => {\n  return await getBackendSrv().get('/api/orgs/' + orgId + '/users');\n};\n\nconst updateOrgUserRole = async (orgUser: OrgUser, orgId: UrlQueryValue) => {\n  await getBackendSrv().patch('/api/orgs/' + orgId + '/users/' + orgUser.userId, orgUser);\n};\n\nconst removeOrgUser = async (orgUser: OrgUser, orgId: UrlQueryValue) => {\n  return await getBackendSrv().delete('/api/orgs/' + orgId + '/users/' + orgUser.userId);\n};\n\nexport const AdminEditOrgPage: FC = () => {\n  const navIndex = useSelector((state: StoreState) => state.navIndex);\n  const navModel = getNavModel(navIndex, 'global-orgs');\n\n  const orgId = useSelector((state: StoreState) => state.location.routeParams.id);\n\n  const [users, setUsers] = useState<OrgUser[]>([]);\n\n  const [orgState, fetchOrg] = useAsyncFn(() => getOrg(orgId), []);\n  const [, fetchOrgUsers] = useAsyncFn(() => getOrgUsers(orgId), []);\n\n  useEffect(() => {\n    fetchOrg();\n    fetchOrgUsers().then(res => setUsers(res));\n  }, []);\n\n  const updateOrgName = async (name: string) => {\n    return await getBackendSrv().put('/api/orgs/' + orgId, { ...orgState.value, name });\n  };\n\n  return (\n    <Page navModel={navModel}>\n      <Page.Contents>\n        <>\n          <Legend>Edit Organization</Legend>\n\n          {orgState.value && (\n            <Form\n              defaultValues={{ orgName: orgState.value.name }}\n              onSubmit={async (values: OrgNameDTO) => await updateOrgName(values.orgName)}\n            >\n              {({ register, errors }) => (\n                <>\n                  <Field label=\"Name\" invalid={!!errors.orgName} error=\"Name is required\">\n                    <Input name=\"orgName\" ref={register({ required: true })} />\n                  </Field>\n                  <Button>Update</Button>\n                </>\n              )}\n            </Form>\n          )}\n\n          <div\n            className={css`\n              margin-top: 20px;\n            `}\n          >\n            <Legend>Organization Users</Legend>\n            {!!users.length && (\n              <UsersTable\n                users={users}\n                onRoleChange={(role, orgUser) => {\n                  updateOrgUserRole({ ...orgUser, role }, orgId);\n                  setUsers(\n                    users.map(user => {\n                      if (orgUser.userId === user.userId) {\n                        return { ...orgUser, role };\n                      }\n                      return user;\n                    })\n                  );\n                  fetchOrgUsers();\n                }}\n                onRemoveUser={orgUser => {\n                  removeOrgUser(orgUser, orgId);\n                  setUsers(users.filter(user => orgUser.userId !== user.userId));\n                  fetchOrgUsers();\n                }}\n              />\n            )}\n          </div>\n        </>\n      </Page.Contents>\n    </Page>\n  );\n};\n\nexport default AdminEditOrgPage;\n"],"sourceRoot":""}