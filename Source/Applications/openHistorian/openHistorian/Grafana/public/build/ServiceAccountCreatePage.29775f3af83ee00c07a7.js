"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9738],{20374:(e,s,a)=>{a.r(s),a.d(s,{ServiceAccountCreatePage:()=>m,default:()=>p});var t,n,i=a(68404),r=a(90923),o=a(3490),l=a(69371),c=a(57497),d=a(77058),u=a(98163),g=a(47570),h=a(8936),b=a(45916);const m=e=>{let{}=e;const[s,a]=(0,i.useState)([]),[m,p]=(0,i.useState)({}),[v,j]=(0,i.useState)([]),x=u.Vt.user.orgId,[C,I]=(0,i.useState)({id:0,orgId:u.Vt.user.orgId,role:g.B5.Viewer,tokens:0,name:"",login:"",isDisabled:!1,createdAt:"",teams:[]});(0,i.useEffect)((()=>{u.Vt.licensedAccessControlEnabled()&&async function(){try{if(u.Vt.hasPermission(g.bW.ActionRolesList)){let e=await(0,d.ul)(x);a(e)}if(u.Vt.accessControlBuiltInRoleAssignmentEnabled()&&u.Vt.hasPermission(g.bW.ActionBuiltinRolesList)){const e=await(0,d.fh)(x);p(e)}}catch(e){console.error("Error loading options",e)}}()}),[x]);const R=(0,i.useCallback)((async e=>{e.role=C.role;const s=await(async e=>{const s=await(0,r.getBackendSrv)().post("/api/serviceaccounts/",e);return await u.Vt.fetchUserPermissions(),s})(e);try{const a={avatarUrl:s.avatarUrl,id:s.id,isDisabled:s.isDisabled,login:s.login,name:s.name,orgId:s.orgId,role:s.role,tokens:s.tokens};await(async(e,s)=>(0,r.getBackendSrv)().patch(`/api/serviceaccounts/${e}`,s))(s.id,e),u.Vt.licensedAccessControlEnabled()&&u.Vt.hasPermission(g.bW.ActionUserRolesAdd)&&u.Vt.hasPermission(g.bW.ActionUserRolesRemove)&&await(0,d.hB)(v,a.id,a.orgId)}catch(e){console.error(e)}r.locationService.push(`/org/serviceaccounts/${s.id}`)}),[C.role,v]),y=e=>{I(Object.assign({},C,{role:e}))},A=(e,s,a)=>{j(e)};return(0,b.jsx)(l.T,{navId:"serviceaccounts",pageNav:{text:"Create service account"},children:(0,b.jsxs)(l.T.Contents,{children:[t||(t=(0,b.jsx)(l.T.OldNavOnly,{children:(0,b.jsx)("h3",{className:"page-sub-heading",children:"Create service account"})})),(0,b.jsx)(o.Form,{onSubmit:R,validateOn:"onSubmit",children:e=>{let{register:a,errors:t}=e;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(o.FieldSet,{children:[(0,b.jsx)(o.Field,{label:"Display name",required:!0,invalid:!!t.name,error:t.name?"Display name is required":void 0,children:(0,b.jsx)(o.Input,Object.assign({id:"display-name-input"},a("name",{required:!0}),{autoFocus:!0}))}),(0,b.jsx)(o.Field,{label:"Role",children:u.Vt.licensedAccessControlEnabled()?(0,b.jsx)(c.R,{apply:!0,userId:C.id||0,orgId:C.orgId,builtInRole:C.role,builtInRoles:m,onBuiltinRoleChange:y,roleOptions:s,onApplyRoles:A,pendingRoles:v}):(0,b.jsx)(h.A,{"aria-label":"Role",value:C.role,onChange:y})})]}),n||(n=(0,b.jsx)(o.Button,{type:"submit",children:"Create"}))]})}})]})})},p=m}}]);
//# sourceMappingURL=ServiceAccountCreatePage.29775f3af83ee00c07a7.js.map