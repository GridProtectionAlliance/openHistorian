{"version":3,"sources":["webpack:///./public/app/plugins/datasource/mssql/response_parser.ts","webpack:///./public/app/plugins/datasource/mssql/datasource.ts","webpack:///./public/app/plugins/datasource/mssql/query_ctrl.ts","webpack:///./public/app/plugins/datasource/mssql/config_ctrl.ts","webpack:///./public/app/plugins/datasource/mssql/module.ts"],"names":["ResponseParser","$q","this","prototype","processQueryResult","res","data","results","key","queryRes","series","_c","e_1","tslib_es6","_d","next","done","value","push","target","name","datapoints","points","refId","meta","tables","_e","e_2","_f","table","type","parseMetricFindQueryResult","length","rowCount","columns","rows","textColIndex","findColIndex","valueColIndex","transformToKeyValueList","transformToSimpleList","i","containsKey","text","j","indexOf","lodash_default","a","map","colName","transformAnnotationResponse","options","annotation","timeColumnIndex","textColumnIndex","tagsColumnIndex","reject","message","list","row","time","Math","floor","tags","trim","split","datasource_MssqlDatasource","MssqlDatasource","instanceSettings","backendSrv","templateSrv","timeSrv","id","responseParser","response_parser","interval","jsonData","timeInterval","$inject","interpolateVariable","variable","multi","includeAll","replace","val","join","query","_this","queries","filter","targets","item","hide","intervalMs","maxDataPoints","datasourceId","rawSql","scopedVars","format","when","datasourceRequest","url","method","from","range","valueOf","toString","to","then","annotationQuery","rawQuery","metricFindQuery","optionalOptions","interpolatedQuery","timeRange","testDatasource","status","catch","err","console","log","targetContainsTemplate","variableExists","defaultQuery","query_ctrl_MssqlQueryCtrl","_super","MssqlQueryCtrl","$scope","$injector","call","alias","formats","panelCtrl","panel","events","on","onDataError","bind","onDataReceived","dataList","lastQueryMeta","lastQueryError","anySeriesFromQuery","find","error","templateUrl","config_ctrl_MssqlConfigCtrl","MssqlConfigCtrl","current","encrypt","onPasswordReset","Object","passwordHandlers","Password","onPasswordChange","__webpack_require__","d","__webpack_exports__","MssqlAnnotationsQueryCtrl","module_defaultQuery"],"mappings":"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","file":"mssqlPlugin.3932bda029d2299a9d96.js","sourcesContent":["import _ from 'lodash';\nimport { IQService } from 'angular';\n\nexport default class ResponseParser {\n  constructor(private $q: IQService) {}\n\n  processQueryResult(res: any) {\n    const data: any[] = [];\n\n    if (!res.data.results) {\n      return { data };\n    }\n\n    for (const key in res.data.results) {\n      const queryRes = res.data.results[key];\n\n      if (queryRes.series) {\n        for (const series of queryRes.series) {\n          data.push({\n            target: series.name,\n            datapoints: series.points,\n            refId: queryRes.refId,\n            meta: queryRes.meta,\n          });\n        }\n      }\n\n      if (queryRes.tables) {\n        for (const table of queryRes.tables) {\n          table.type = 'table';\n          table.refId = queryRes.refId;\n          table.meta = queryRes.meta;\n          data.push(table);\n        }\n      }\n    }\n\n    return { data: data };\n  }\n\n  parseMetricFindQueryResult(refId: string, results: any) {\n    if (!results || results.data.length === 0 || results.data.results[refId].meta.rowCount === 0) {\n      return [];\n    }\n\n    const columns = results.data.results[refId].tables[0].columns;\n    const rows = results.data.results[refId].tables[0].rows;\n    const textColIndex = this.findColIndex(columns, '__text');\n    const valueColIndex = this.findColIndex(columns, '__value');\n\n    if (columns.length === 2 && textColIndex !== -1 && valueColIndex !== -1) {\n      return this.transformToKeyValueList(rows, textColIndex, valueColIndex);\n    }\n\n    return this.transformToSimpleList(rows);\n  }\n\n  transformToKeyValueList(rows: any, textColIndex: number, valueColIndex: number) {\n    const res = [];\n\n    for (let i = 0; i < rows.length; i++) {\n      if (!this.containsKey(res, rows[i][textColIndex])) {\n        res.push({ text: rows[i][textColIndex], value: rows[i][valueColIndex] });\n      }\n    }\n\n    return res;\n  }\n\n  transformToSimpleList(rows: any) {\n    const res = [];\n\n    for (let i = 0; i < rows.length; i++) {\n      for (let j = 0; j < rows[i].length; j++) {\n        const value = rows[i][j];\n        if (res.indexOf(value) === -1) {\n          res.push(value);\n        }\n      }\n    }\n\n    return _.map(res, value => {\n      return { text: value };\n    });\n  }\n\n  findColIndex(columns: any[], colName: string) {\n    for (let i = 0; i < columns.length; i++) {\n      if (columns[i].text === colName) {\n        return i;\n      }\n    }\n\n    return -1;\n  }\n\n  containsKey(res: any[], key: any) {\n    for (let i = 0; i < res.length; i++) {\n      if (res[i].text === key) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  transformAnnotationResponse(options: any, data: any) {\n    const table = data.data.results[options.annotation.name].tables[0];\n\n    let timeColumnIndex = -1;\n    let textColumnIndex = -1;\n    let tagsColumnIndex = -1;\n\n    for (let i = 0; i < table.columns.length; i++) {\n      if (table.columns[i].text === 'time') {\n        timeColumnIndex = i;\n      } else if (table.columns[i].text === 'text') {\n        textColumnIndex = i;\n      } else if (table.columns[i].text === 'tags') {\n        tagsColumnIndex = i;\n      }\n    }\n\n    if (timeColumnIndex === -1) {\n      return this.$q.reject({ message: 'Missing mandatory time column (with time column alias) in annotation query.' });\n    }\n\n    const list = [];\n    for (let i = 0; i < table.rows.length; i++) {\n      const row = table.rows[i];\n      list.push({\n        annotation: options.annotation,\n        time: Math.floor(row[timeColumnIndex]),\n        text: row[textColumnIndex],\n        tags: row[tagsColumnIndex] ? row[tagsColumnIndex].trim().split(/\\s*,\\s*/) : [],\n      });\n    }\n\n    return list;\n  }\n}\n","import _ from 'lodash';\nimport ResponseParser from './response_parser';\nimport { BackendSrv } from 'app/core/services/backend_srv';\nimport { IQService } from 'angular';\nimport { TemplateSrv } from 'app/features/templating/template_srv';\nimport { TimeSrv } from 'app/features/dashboard/services/TimeSrv';\n\nexport class MssqlDatasource {\n  id: any;\n  name: any;\n  responseParser: ResponseParser;\n  interval: string;\n\n  /** @ngInject */\n  constructor(\n    instanceSettings: any,\n    private backendSrv: BackendSrv,\n    private $q: IQService,\n    private templateSrv: TemplateSrv,\n    private timeSrv: TimeSrv\n  ) {\n    this.name = instanceSettings.name;\n    this.id = instanceSettings.id;\n    this.responseParser = new ResponseParser(this.$q);\n    this.interval = (instanceSettings.jsonData || {}).timeInterval || '1m';\n  }\n\n  interpolateVariable(value: any, variable: any) {\n    if (typeof value === 'string') {\n      if (variable.multi || variable.includeAll) {\n        return \"'\" + value.replace(/'/g, `''`) + \"'\";\n      } else {\n        return value;\n      }\n    }\n\n    if (typeof value === 'number') {\n      return value;\n    }\n\n    const quotedValues = _.map(value, val => {\n      if (typeof value === 'number') {\n        return value;\n      }\n\n      return \"'\" + val.replace(/'/g, `''`) + \"'\";\n    });\n    return quotedValues.join(',');\n  }\n\n  query(options: any) {\n    const queries = _.filter(options.targets, item => {\n      return item.hide !== true;\n    }).map(item => {\n      return {\n        refId: item.refId,\n        intervalMs: options.intervalMs,\n        maxDataPoints: options.maxDataPoints,\n        datasourceId: this.id,\n        rawSql: this.templateSrv.replace(item.rawSql, options.scopedVars, this.interpolateVariable),\n        format: item.format,\n      };\n    });\n\n    if (queries.length === 0) {\n      return this.$q.when({ data: [] });\n    }\n\n    return this.backendSrv\n      .datasourceRequest({\n        url: '/api/tsdb/query',\n        method: 'POST',\n        data: {\n          from: options.range.from.valueOf().toString(),\n          to: options.range.to.valueOf().toString(),\n          queries: queries,\n        },\n      })\n      .then(this.responseParser.processQueryResult);\n  }\n\n  annotationQuery(options: any) {\n    if (!options.annotation.rawQuery) {\n      return this.$q.reject({ message: 'Query missing in annotation definition' });\n    }\n\n    const query = {\n      refId: options.annotation.name,\n      datasourceId: this.id,\n      rawSql: this.templateSrv.replace(options.annotation.rawQuery, options.scopedVars, this.interpolateVariable),\n      format: 'table',\n    };\n\n    return this.backendSrv\n      .datasourceRequest({\n        url: '/api/tsdb/query',\n        method: 'POST',\n        data: {\n          from: options.range.from.valueOf().toString(),\n          to: options.range.to.valueOf().toString(),\n          queries: [query],\n        },\n      })\n      .then((data: any) => this.responseParser.transformAnnotationResponse(options, data));\n  }\n\n  metricFindQuery(query: string, optionalOptions: { variable: { name: string } }) {\n    let refId = 'tempvar';\n    if (optionalOptions && optionalOptions.variable && optionalOptions.variable.name) {\n      refId = optionalOptions.variable.name;\n    }\n\n    const interpolatedQuery = {\n      refId: refId,\n      datasourceId: this.id,\n      rawSql: this.templateSrv.replace(query, {}, this.interpolateVariable),\n      format: 'table',\n    };\n\n    const range = this.timeSrv.timeRange();\n    const data = {\n      queries: [interpolatedQuery],\n      from: range.from.valueOf().toString(),\n      to: range.to.valueOf().toString(),\n    };\n\n    return this.backendSrv\n      .datasourceRequest({\n        url: '/api/tsdb/query',\n        method: 'POST',\n        data: data,\n      })\n      .then((data: any) => this.responseParser.parseMetricFindQueryResult(refId, data));\n  }\n\n  testDatasource() {\n    return this.backendSrv\n      .datasourceRequest({\n        url: '/api/tsdb/query',\n        method: 'POST',\n        data: {\n          from: '5m',\n          to: 'now',\n          queries: [\n            {\n              refId: 'A',\n              intervalMs: 1,\n              maxDataPoints: 1,\n              datasourceId: this.id,\n              rawSql: 'SELECT 1',\n              format: 'table',\n            },\n          ],\n        },\n      })\n      .then((res: any) => {\n        return { status: 'success', message: 'Database Connection OK' };\n      })\n      .catch((err: any) => {\n        console.log(err);\n        if (err.data && err.data.message) {\n          return { status: 'error', message: err.data.message };\n        } else {\n          return { status: 'error', message: err.status };\n        }\n      });\n  }\n\n  targetContainsTemplate(target: any) {\n    const rawSql = target.rawSql.replace('$__', '');\n    return this.templateSrv.variableExists(rawSql);\n  }\n}\n","import _ from 'lodash';\nimport { QueryCtrl } from 'app/plugins/sdk';\nimport { auto } from 'angular';\n\nexport interface MssqlQuery {\n  refId: string;\n  format: string;\n  alias: string;\n  rawSql: string;\n}\n\nexport interface QueryMeta {\n  sql: string;\n}\n\nconst defaultQuery = `SELECT\n  $__timeEpoch(<time_column>),\n  <value column> as value,\n  <series name column> as metric\nFROM\n  <table name>\nWHERE\n  $__timeFilter(time_column)\nORDER BY\n  <time_column> ASC`;\n\nexport class MssqlQueryCtrl extends QueryCtrl {\n  static templateUrl = 'partials/query.editor.html';\n\n  showLastQuerySQL: boolean;\n  formats: any[];\n  target: MssqlQuery;\n  lastQueryMeta: QueryMeta;\n  lastQueryError: string;\n  showHelp: boolean;\n\n  /** @ngInject */\n  constructor($scope: any, $injector: auto.IInjectorService) {\n    super($scope, $injector);\n\n    this.target.format = this.target.format || 'time_series';\n    this.target.alias = '';\n    this.formats = [{ text: 'Time series', value: 'time_series' }, { text: 'Table', value: 'table' }];\n\n    if (!this.target.rawSql) {\n      // special handling when in table panel\n      if (this.panelCtrl.panel.type === 'table') {\n        this.target.format = 'table';\n        this.target.rawSql = 'SELECT 1';\n      } else {\n        this.target.rawSql = defaultQuery;\n      }\n    }\n\n    this.panelCtrl.events.on('data-received', this.onDataReceived.bind(this), $scope);\n    this.panelCtrl.events.on('data-error', this.onDataError.bind(this), $scope);\n  }\n\n  onDataReceived(dataList: any) {\n    this.lastQueryMeta = null;\n    this.lastQueryError = null;\n\n    const anySeriesFromQuery: any = _.find(dataList, { refId: this.target.refId });\n    if (anySeriesFromQuery) {\n      this.lastQueryMeta = anySeriesFromQuery.meta;\n    }\n  }\n\n  onDataError(err: any) {\n    if (err.data && err.data.results) {\n      const queryRes = err.data.results[this.target.refId];\n      if (queryRes) {\n        this.lastQueryMeta = queryRes.meta;\n        this.lastQueryError = queryRes.error;\n      }\n    }\n  }\n}\n","import {\n  createChangeHandler,\n  createResetHandler,\n  PasswordFieldEnum,\n} from '../../../features/datasources/utils/passwordHandlers';\n\nexport class MssqlConfigCtrl {\n  static templateUrl = 'partials/config.html';\n\n  current: any;\n  onPasswordReset: ReturnType<typeof createResetHandler>;\n  onPasswordChange: ReturnType<typeof createChangeHandler>;\n\n  /** @ngInject */\n  constructor($scope: any) {\n    this.current.jsonData.encrypt = this.current.jsonData.encrypt || 'false';\n    this.onPasswordReset = createResetHandler(this, PasswordFieldEnum.Password);\n    this.onPasswordChange = createChangeHandler(this, PasswordFieldEnum.Password);\n  }\n}\n","import { MssqlDatasource } from './datasource';\nimport { MssqlQueryCtrl } from './query_ctrl';\nimport { MssqlConfigCtrl } from './config_ctrl';\n\nconst defaultQuery = `SELECT\n    <time_column> as time,\n    <text_column> as text,\n    <tags_column> as tags\n  FROM\n    <table name>\n  WHERE\n    $__timeFilter(time_column)\n  ORDER BY\n    <time_column> ASC`;\n\nclass MssqlAnnotationsQueryCtrl {\n  static templateUrl = 'partials/annotations.editor.html';\n\n  annotation: any;\n\n  /** @ngInject */\n  constructor() {\n    this.annotation.rawQuery = this.annotation.rawQuery || defaultQuery;\n  }\n}\n\nexport {\n  MssqlDatasource,\n  MssqlDatasource as Datasource,\n  MssqlQueryCtrl as QueryCtrl,\n  MssqlConfigCtrl as ConfigCtrl,\n  MssqlAnnotationsQueryCtrl as AnnotationsQueryCtrl,\n};\n"],"sourceRoot":""}