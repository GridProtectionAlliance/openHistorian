"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6788],{26788:(s,n,a)=>{a.r(n),a.d(n,{ChangePasswordPage:()=>m,default:()=>v});a(68404);var e,r,o=a(18745),i=a(69578),d=a(69371),t=a(36636),c=a(3490),l=a(78837),u=a(45653),w=a(45916);const h=s=>{var n,a;let{user:o,onChangePassword:i,isSaving:d}=s;const{ldapEnabled:h,authProxyEnabled:p,disableLoginForm:g}=l.ZP,f=(null===(n=o.authLabels)||void 0===n?void 0:n.length)&&o.authLabels[0];return h||p?e||(e=(0,w.jsx)("p",{children:"You cannot change password when LDAP or auth proxy authentication is enabled."})):f&&g?r||(r=(0,w.jsx)("p",{children:"Password cannot be changed here."})):(0,w.jsx)("div",{className:t.css`
        max-width: 400px;
      `,children:(0,w.jsx)(c.Form,{onSubmit:i,children:s=>{var n,e,r;let{register:o,errors:i,getValues:t}=s;return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(c.Field,{label:"Old password",invalid:!!i.oldPassword,error:null==i||null===(n=i.oldPassword)||void 0===n?void 0:n.message,children:(0,w.jsx)(u.Z,Object.assign({id:"current-password",autoComplete:"current-password"},o("oldPassword",{required:"Old password is required"})))}),(0,w.jsx)(c.Field,{label:"New password",invalid:!!i.newPassword,error:null==i||null===(e=i.newPassword)||void 0===e?void 0:e.message,children:(0,w.jsx)(u.Z,Object.assign({id:"new-password",autoComplete:"new-password"},o("newPassword",{required:"New password is required",validate:{confirm:s=>s===t().confirmNew||"Passwords must match",old:s=>s!==t().oldPassword||"New password can't be the same as the old one."}})))}),(0,w.jsx)(c.Field,{label:"Confirm password",invalid:!!i.confirmNew,error:null==i||null===(r=i.confirmNew)||void 0===r?void 0:r.message,children:(0,w.jsx)(u.Z,Object.assign({id:"confirm-new-password",autoComplete:"new-password"},o("confirmNew",{required:"New password confirmation is required",validate:s=>s===t().newPassword||"Passwords must match"})))}),(0,w.jsxs)(c.HorizontalGroup,{children:[a||(a=(0,w.jsx)(c.Button,{variant:"primary",disabled:d,type:"submit",children:"Change Password"})),(0,w.jsx)(c.LinkButton,{variant:"secondary",href:`${l.ZP.appSubUrl}/profile`,fill:"outline",children:"Cancel"})]})]})}})})};var p,g=a(86706);const f={loadUser:g.II,changePassword:g.Cp};function m(s){let{loadUser:n,isUpdating:a,user:e,changePassword:r}=s;return(0,i.Z)((()=>n())),(0,w.jsx)(d.T,{navId:"profile/password",children:(0,w.jsx)(d.T.Contents,{isLoading:!Boolean(e),children:e?(0,w.jsxs)(w.Fragment,{children:[p||(p=(0,w.jsx)(d.T.OldNavOnly,{children:(0,w.jsx)("h3",{className:"page-sub-heading",children:"Change Your Password"})})),(0,w.jsx)(h,{user:e,onChangePassword:r,isSaving:a})]}):null})})}const v=(0,o.connect)((function(s){const n=s.user,{isUpdating:a,user:e}=n;return{isUpdating:a,user:e}}),f)(m)},86706:(s,n,a)=>{a.d(n,{Cp:()=>i,II:()=>t,Lj:()=>u,PA:()=>d,cc:()=>c,hz:()=>l});var e=a(90923),r=a(67220),o=a(10603);function i(s){return async function(n){n((0,o.zc)({updating:!0})),await r.h.changePassword(s),n((0,o.zc)({updating:!1}))}}function d(){return async function(s){await s(t()),s((async function(s){s((0,o.qD)());const n=await r.h.loadTeams();s((0,o.PL)({teams:n}))})),s((async function(s){s((0,o.$S)());const n=await r.h.loadOrgs();s((0,o.Ns)({orgs:n}))})),s((async function(s){s((0,o.Uk)());const n=await r.h.loadSessions();s((0,o.z0)({sessions:n}))}))}}function t(){return async function(s){const n=await r.h.loadUser();s((0,o.aw)({user:n}))}}function c(s){return async function(n){n((0,o.zc)({updating:!0})),await r.h.revokeUserSession(s),n((0,o.p$)({tokenId:s}))}}function l(s){return async function(n){n((0,o.zc)({updating:!0})),await r.h.setUserOrg(s),window.location.href=e.config.appSubUrl+"/profile"}}function u(s){return async function(n){n((0,o.zc)({updating:!0})),await r.h.updateUserProfile(s),await n(t()),n((0,o.zc)({updating:!1}))}}},69578:(s,n,a)=>{a.d(n,{Z:()=>r});var e=a(76687);const r=function(s){(0,e.Z)((function(){s()}))}}}]);
//# sourceMappingURL=6788.687a217b61f5d2ab5246.js.map