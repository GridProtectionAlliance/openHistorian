"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3511],{77253:(Re,A,s)=>{s.r(A),s.d(A,{default:()=>Ks});var e=s(74848),n=s(96540),M=s(32264),x=s(54148),C=s(41053),R=s(10940),D=s(76885),E=s(67061),y=s(55852),u=s(66602),m=s(83277),f=s(31678),h=s(25027),L=s(24608),F=s(19073),xe=s(9518),Ee=s(14285),$=s(61410),z=s(26627),pe=s(55740),p=s(57220),Be=s(37959),Me=s(5598),Ae=s(45058),fe=s(75648),ie=s(67381),B=s(64853),d=s(32196),Je=s(55127),Ne=s.n(Je),ee=s(40845),ce=s(94753),N=s(39558),H=s(62930),Ce=s(19384),de=s(8484),as=s(15054),be=s(98439),ns=s(22620),Ue=s(88467),is=s(13544),Qe=s(39938),cs=s(96374),rs=s(56034),V=s(14578),Ke=s(99140),Oe=s(79938),ds=s(77583),os=s(6833),ms=s(43482);const{useDeleteRuleGroupFromNamespaceMutation:us}=Oe.hK,{useLazyDiscoverDsFeaturesQuery:v}=ds.L;function K(){const[t]=us(),[a]=v();return(0,os.Yb)(async r=>{const{dataSourceName:o,namespaceName:l,groupName:c}=r,{rulerConfig:i}=await a({rulesSourceName:o}).unwrap();if(!i)throw(0,ms._)(o);const U=await t({rulerConfig:i,namespace:l,group:c}).unwrap();return await(0,Ke.JD)((0,z.Lc)({rulesSourceName:o})),U})}var Te=s(11167),we=s(83903),Xe=s(41520),S=s(78742),w=s(23662),ye=s(64047),Le=s(82437),X=s(16293),Se=s(76648),De=s(84029);function Ze({folder:t,onClose:a}){const[r,o]=(0,n.useState)("yaml");return(0,e.jsx)(Se.m,{title:`Export ${t.title} rules`,activeTab:r,onTabChange:o,onClose:a,formatProviders:Object.values(De.sl),children:(0,e.jsx)(ke,{folder:t,exportFormat:r,onClose:a})})}function ke({folder:t,exportFormat:a,onClose:r}){const{currentData:o="",isFetching:l}=Oe.hK.endpoints.exportRules.useQuery({folderUid:t.uid,format:a});if(l)return(0,e.jsx)(N._,{text:"Loading...."});const c=`${t.title}-${t.uid}`;return(0,e.jsx)(X.J,{format:a,textDefinition:o,downloadFileName:c,onClose:r})}function Ge({folderUid:t,groupName:a,onClose:r}){const[o,l]=(0,n.useState)("yaml");return(0,e.jsx)(Se.m,{title:`Export ${a} rules`,activeTab:o,onTabChange:l,onClose:r,formatProviders:Object.values(De.sl),children:(0,e.jsx)(qe,{folderUid:t,groupName:a,exportFormat:o,onClose:r})})}function qe({folderUid:t,groupName:a,exportFormat:r,onClose:o}){const{currentData:l="",isFetching:c}=Oe.hK.endpoints.exportRules.useQuery({folderUid:t,group:a,format:r});return c?(0,e.jsx)(N._,{text:"Loading...."}):(0,e.jsx)(X.J,{format:r,textDefinition:l,downloadFileName:a,onClose:o})}var Fe=s(99106),Y=s(72275),_e=s(46479),O=s(91076),Z=s(46942),ve=s.n(Z),se=s(1932),W=s(37390),J=s(30531),We=s(48070),es=s(18461);const ss=t=>{const a=(0,ee.of)(Pe),{group:r,namespace:o,onClose:l,folderUid:c}=t,[i,U]=(0,n.useState)([]),[k,ue]=(0,J.ts)(),q=(0,os.VP)(ue),ge=(0,w.y1)(o.rulesSource),me=(0,z.Qt)(Ke.Gu,ge),{currentData:ae,isLoading:_}=Oe.hK.endpoints.getRuleGroupForNamespace.useQuery({rulerConfig:me,namespace:c??o.name,group:r.name},{refetchOnMountOrArgChange:!0}),[b,I]=(0,n.useState)([]);(0,n.useEffect)(()=>{ae&&I(ae?.rules)},[ae]);const he=(0,n.useCallback)(j=>{if(!j.destination)return;const G=[j.source.index,j.destination.index];U((0,se.jM)(i,ne=>{ne.push(G)}));const P=(0,se.jM)(b,ne=>{(0,We.Ct)(ne,G)});I(P)},[b,i]),Ie=(0,n.useCallback)(async()=>{const j={dataSourceName:(0,w.y1)(o.rulesSource),groupName:r.name,namespaceName:c??o.name};await k.execute(j,i),await(0,Ke.JD)((0,z.eB)({rulesSourceName:ge})),l()},[o.rulesSource,o.name,r.name,c,k,i,ge,l]),je=b.map(j=>({...j,uid:(0,es.Ns)(j)}));return(0,e.jsxs)(W.a,{className:a.modal,isOpen:!0,title:(0,e.jsx)(ts,{namespace:o,group:r}),onDismiss:l,onClickBackdrop:l,children:[_&&"Loading...",je.length>0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(O.JY,{onDragEnd:he,children:(0,e.jsx)(O.gL,{droppableId:"alert-list",mode:"standard",renderClone:(j,G,P)=>(0,e.jsx)($e,{provided:j,rule:je[P.source.index],isClone:!0}),children:j=>(0,e.jsxs)("div",{ref:j.innerRef,className:ve()(a.listContainer,q&&a.disabled),...j.droppableProps,children:[je.map((G,P)=>(0,e.jsx)(O.sx,{draggableId:G.uid,index:P,isDragDisabled:q,children:ne=>(0,e.jsx)($e,{provided:ne,rule:G},G.uid)},G.uid)),j.placeholder]})})}),(0,e.jsxs)(W.a.ButtonRow,{children:[(0,e.jsx)(y.$n,{variant:"secondary",fill:"outline",onClick:l,children:(0,e.jsx)(de.x6,{i18nKey:"common.cancel",children:"Cancel"})}),(0,e.jsx)(y.$n,{onClick:()=>Ie(),disabled:q,children:(0,e.jsx)(de.x6,{i18nKey:"common.save",children:"Save"})})]})]})]})},$e=({provided:t,rule:a,isClone:r=!1,isDragging:o=!1})=>{const l=(0,ee.of)(Pe);return(0,e.jsxs)("div",{"data-testid":"reorder-alert-rule",className:ve()(l.listItem,r&&"isClone",o&&"isDragging"),ref:t.innerRef,...t.draggableProps,...t.dragHandleProps,children:[(0,w.lT)(a)&&(0,e.jsx)("div",{className:l.listItemName,children:a.grafana_alert.title}),(0,w.i7)(a)&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:l.listItemName,children:a.record}),(0,e.jsx)(Qe.E,{text:"Recording",color:"purple"})]}),(0,w.$y)(a)&&(0,e.jsx)("div",{className:l.listItemName,children:a.alert}),(0,e.jsx)(V.I,{name:"draggabledots"})]})},ts=({namespace:t,group:a})=>{const r=(0,ee.of)(Pe);return(0,e.jsxs)("div",{className:r.header,children:[(0,e.jsx)(V.I,{name:"folder"}),(0,p.Eb)(t.rulesSource)&&(0,e.jsx)(rs.m,{content:t.rulesSource.name,placement:"top",children:(0,e.jsx)("img",{alt:t.rulesSource.meta.name,className:r.dataSourceIcon,src:t.rulesSource.meta.info.logos.small})}),(0,e.jsx)("span",{children:t.name}),(0,e.jsx)(V.I,{name:"angle-right"}),(0,e.jsx)("span",{children:a.name})]})},Pe=t=>({modal:(0,d.css)({maxWidth:"640px",maxHeight:"80%",overflow:"hidden"}),listItem:(0,d.css)({display:"flex",flexDirection:"row",alignItems:"center",gap:t.spacing(),background:t.colors.background.primary,color:t.colors.text.secondary,borderBottom:`solid 1px ${t.colors.border.medium}`,padding:`${t.spacing(1)} ${t.spacing(2)}`,"&:last-child":{borderBottom:"none"},"&.isClone":{border:`solid 1px ${t.colors.primary.shade}`}}),listContainer:(0,d.css)({userSelect:"none",border:`solid 1px ${t.colors.border.medium}`}),disabled:(0,d.css)({opacity:"0.5",pointerEvents:"none"}),listItemName:(0,d.css)({flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),header:(0,d.css)({display:"flex",alignItems:"center",gap:t.spacing(1)}),dataSourceIcon:(0,d.css)({width:t.spacing(2),height:t.spacing(2)})});var g=s(92467),ze=s(80215);const He=n.memo(({group:t,namespace:a,expandAll:r,viewMode:o})=>{const{rulesSource:l}=a,[c]=K(),i=(0,ee.of)(xs),[U,k]=(0,n.useState)(!1),[ue,q]=(0,n.useState)(!1),[ge,me]=(0,n.useState)(!1),[ae,_]=(0,n.useState)(void 0),[b,I]=(0,n.useState)(!r),{canEditRules:he}=(0,Xe.V)();(0,n.useEffect)(()=>{I(!r)},[r]);const{hasRuler:Ie,rulerRulesLoaded:je}=(0,we.y)(a.rulesSource),j=t.rules[0]?.rulerRule,G=j&&(0,w.lT)(j)&&j.grafana_alert.namespace_uid||void 0,{folder:P}=(0,Te.a)(G),ne=Ie&&je&&!t.rules.find(le=>!!le.rulerRule),Ve=(0,w.YN)(t),ls=t.rules.some(le=>(0,w.lT)(le.rulerRule)&&le.rulerRule.grafana_alert.provenance),Ye=o==="list",re=o==="grouped",Q=async()=>{const le=(0,Fe.EL)(a).name,Gs=t.name,Ws=(0,p.EV)(a.rulesSource),$s={namespaceName:le,groupName:Gs,dataSourceName:Ws};await c.execute($s),q(!1)},oe=[];if(ne)oe.push((0,e.jsxs)(E.B,{children:[(0,e.jsx)(H.y,{}),"deleting"]},"is-deleting"));else if(l===p.hY){if(G){const le=(0,S.NH)(G);P?.canSave&&(re&&!ls&&(oe.push((0,e.jsx)(Y.M,{"aria-label":"edit rule group","data-testid":"edit-group",icon:"pen",tooltip:"edit rule group",onClick:()=>k(!0)},"edit")),oe.push((0,e.jsx)(Y.M,{"data-testid":"reorder-group",icon:"exchange-alt",tooltip:"reorder rules",className:i.rotate90,onClick:()=>me(!0)},"reorder"))),Ye&&(oe.push((0,e.jsx)(Y.M,{"aria-label":"go to folder",icon:"folder-open",tooltip:"go to folder",to:le,target:"__blank"},"goto")),P?.canAdmin&&oe.push((0,e.jsx)(Y.M,{"aria-label":"manage permissions",icon:"lock",tooltip:"manage permissions",to:le+"/permissions",target:"__blank"},"manage-perms")))),P&&(Ye?oe.push((0,e.jsx)(Y.M,{"aria-label":"export rule folder","data-testid":"export-folder",icon:"download-alt",tooltip:"Export rules folder",onClick:()=>_("folder")},"export-folder")):re&&oe.push((0,e.jsx)(Y.M,{"aria-label":"export rule group","data-testid":"export-group",icon:"download-alt",tooltip:"Export rule group",onClick:()=>_("group")},"export-group")))}}else he(l.name)&&Ie&&(Ve||(oe.push((0,e.jsx)(Y.M,{"aria-label":"edit rule group","data-testid":"edit-group",icon:"pen",tooltip:"edit rule group",onClick:()=>k(!0)},"edit")),oe.push((0,e.jsx)(Y.M,{"data-testid":"reorder-group",icon:"exchange-alt",tooltip:"reorder rules",className:i.rotate90,onClick:()=>me(!0)},"reorder"))),oe.push((0,e.jsx)(Y.M,{"aria-label":"delete rule group","data-testid":"delete-group",icon:"trash-alt",tooltip:"delete rule group",onClick:()=>q(!0)},"delete-group")));const js=Ye?(0,e.jsx)(Le.c,{namespace:(0,Fe.EL)(a).name}):(0,e.jsx)(Le.c,{namespace:(0,Fe.EL)(a).name,group:t.name}),Rs=(le=!1)=>{le||(0,h.fH)(h.le.leavingRuleGroupEdit),k(!1)};return(0,e.jsxs)("div",{className:i.wrapper,"data-testid":"rule-group",children:[(0,e.jsxs)("div",{className:i.header,"data-testid":"rule-group-header",children:[(0,e.jsx)(ye.e,{size:"sm",className:i.collapseToggle,isCollapsed:b,onToggle:I,"data-testid":is.Tp.components.AlertRules.groupToggle}),(0,e.jsx)(hs,{isCollapsed:b}),(0,e.jsx)(T,{rulesSource:l}),(0,e.jsxs)("div",{className:i.groupName,onClick:()=>I(!b),children:[Ve&&(0,e.jsx)(Qe.E,{color:"purple",text:"Federated"})," ",js]}),(0,e.jsx)("div",{className:i.spacer}),(0,e.jsx)("div",{className:i.headerStats,children:(0,e.jsx)(g.j7,{group:t})}),ls&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:i.actionsSeparator,children:"|"}),(0,e.jsx)("div",{className:i.actionIcons,children:(0,e.jsx)(Qe.E,{color:"purple",text:"Provisioned"})})]}),!!oe.length&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:i.actionsSeparator,children:"|"}),(0,e.jsx)("div",{className:i.actionIcons,children:(0,e.jsx)(E.B,{gap:.5,children:oe})})]})]}),!b&&(0,e.jsx)(ze.s,{showSummaryColumn:!0,className:i.rulesTable,showGuidelines:!0,showNextEvaluationColumn:!!t.interval,rules:t.rules}),U&&(0,e.jsx)(_e.u5,{namespace:a,group:t,onClose:()=>Rs(),folderUrl:P?.canEdit?(0,S.qN)(P.uid):void 0,folderUid:G}),ge&&(0,e.jsx)(ss,{group:t,folderUid:G,namespace:a,onClose:()=>me(!1)}),(0,e.jsx)(cs.u,{isOpen:ue,title:"Delete group",body:(0,e.jsxs)("div",{children:[(0,e.jsxs)("p",{children:['Deleting "',(0,e.jsx)("strong",{children:t.name}),'" will permanently remove the group and'," ",t.rules.length," alert ",Ne()("rule",t.rules.length)," belonging to it."]}),(0,e.jsx)("p",{children:"Are you sure you want to delete this group?"})]}),onConfirm:Q,onDismiss:()=>q(!1),confirmText:"Delete"}),P&&ae==="folder"&&(0,e.jsx)(Ze,{folder:P,onClose:()=>_(void 0)}),P&&ae==="group"&&(0,e.jsx)(Ge,{folderUid:P.uid,groupName:t.name,onClose:()=>_(void 0)})]})});He.displayName="RulesGroup";const T=n.memo(({rulesSource:t})=>{const a=(0,ee.of)(xs);return(0,p.Eb)(t)?(0,e.jsx)(rs.m,{content:t.name,placement:"top",children:(0,e.jsx)("img",{alt:t.meta.name,className:a.dataSourceIcon,src:t.meta.info.logos.small})}):null});T.displayName="CloudSourceLogo";const hs=n.memo(({isCollapsed:t})=>(0,e.jsx)(V.I,{name:t?"folder":"folder-open"}));hs.displayName="FolderIcon";const xs=t=>({wrapper:(0,d.css)({}),header:(0,d.css)({display:"flex",flexDirection:"row",alignItems:"center",padding:`${t.spacing(1)} ${t.spacing(1)} ${t.spacing(1)} 0`,flexWrap:"nowrap",borderBottom:`1px solid ${t.colors.border.weak}`,"&:hover":{backgroundColor:t.components.table.rowHoverBackground}}),headerStats:(0,d.css)({flexShrink:0,span:{verticalAlign:"middle"},[t.breakpoints.down("sm")]:{order:2,width:"100%",paddingLeft:t.spacing(1)}}),groupName:(0,d.css)({marginLeft:t.spacing(1),marginBottom:0,cursor:"pointer",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}),spacer:(0,d.css)({flex:1}),collapseToggle:(0,d.css)({background:"none",border:"none",marginTop:`-${t.spacing(1)}`,marginBottom:`-${t.spacing(1)}`,svg:{marginBottom:0}}),dataSourceIcon:(0,d.css)({width:t.spacing(2),height:t.spacing(2),marginLeft:t.spacing(2)}),dataSourceOrigin:(0,d.css)({marginRight:"1em",color:t.colors.text.disabled}),actionsSeparator:(0,d.css)({margin:`0 ${t.spacing(2)}`}),actionIcons:(0,d.css)({width:"80px",alignItems:"center",flexShrink:0}),rulesTable:(0,d.css)({margin:t.spacing(2,0)}),rotate90:(0,d.css)({transform:"rotate(90deg)"})});function fs(t){return(0,n.useMemo)(()=>t.flatMap(a=>a.groups.map(r=>({namespace:a,group:r}))),[t])}const Es=({namespaces:t,expandAll:a})=>{const r=(0,ee.of)(Cs),o=(0,$.$)(I=>I.dataSources),l=(0,$.$)(I=>I.promRules),c=(0,n.useMemo)(p.qi,[]),i=fs(t),U=(0,n.useMemo)(()=>c.filter(I=>(0,Ue.ML)(l[I.name])||(0,Ue.ML)(o[I.name])),[l,o,c]),k=c.some(I=>!!l[I.name]?.result?.length),ue=c.length>0,q=U.length>0,ge=t.length>0,{numberOfPages:me,onPageChange:ae,page:_,pageItems:b}=(0,be.W)(i,1,as.FG);return(0,e.jsxs)("section",{className:r.wrapper,children:[(0,e.jsx)("div",{className:r.sectionHeader,children:(0,e.jsxs)("div",{className:r.headerRow,children:[(0,e.jsx)(ce.E,{element:"h2",variant:"h5",children:(0,e.jsx)(de.x6,{i18nKey:"alerting.list-view.section.dataSourceManaged.title",children:"Data source-managed"})}),U.length?(0,e.jsx)(N._,{className:r.loader,text:`Loading rules from ${U.length} ${Ne()("source",U.length)}`}):(0,e.jsx)("div",{}),(0,e.jsx)(ys,{})]})}),b.map(({group:I,namespace:he})=>(0,e.jsx)(He,{group:I,namespace:he,expandAll:a,viewMode:"grouped"},`${(0,p.v0)(he.rulesSource)}-${he.name}-${I.name}`)),!ue&&(0,e.jsx)("p",{children:"There are no Prometheus or Loki data sources configured."}),ue&&!q&&!ge&&(0,e.jsx)("p",{children:"No rules found."}),!k&&q&&(0,e.jsx)(H.y,{size:"xl",className:r.spinner}),(0,e.jsx)(Ce.d,{className:r.pagination,currentPage:_,numberOfPages:me,onNavigate:ae,hideWhenSinglePage:!0})]})},Cs=t=>({loader:(0,d.css)({marginBottom:0}),sectionHeader:(0,d.css)({display:"flex",justifyContent:"space-between"}),wrapper:(0,d.css)({marginBottom:t.spacing(4)}),spinner:(0,d.css)({textAlign:"center",padding:t.spacing(2)}),pagination:(0,ns.H)(t),headerRow:(0,d.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",marginBottom:t.spacing(1)})});function ys(){const[t,a]=(0,F.Ej)(F.RY.CreateExternalAlertRule),r=(0,x.zy)();return t&&a?(0,e.jsx)(y.z9,{href:D.kM.renderUrl("alerting/new/recording",{returnTo:r.pathname+r.search}),tooltip:"Create new Data source-managed recording rule",icon:"plus",variant:"secondary",children:"New recording rule"},"new-recording-rule"):null}var Ss=s(42941),Ds=s(3704);function Ps({onClose:t}){const[a,r]=(0,n.useState)("yaml");return(0,e.jsx)(Se.m,{activeTab:a,onTabChange:r,onClose:t,formatProviders:Object.values(De.sl),children:(0,e.jsx)(Is,{exportFormat:a,onClose:t})})}function Is({exportFormat:t,onClose:a}){const{currentData:r="",isFetching:o}=Oe.hK.endpoints.exportRules.useQuery({format:t}),l=`alert-rules-${new Date().getTime()}`;return o?(0,e.jsx)(N._,{text:"Loading...."}):(0,e.jsx)(X.J,{format:t,textDefinition:r,downloadFileName:l,onClose:a})}const Ms=({namespaces:t,expandAll:a})=>{const r=(0,ee.of)(As),[o]=(0,m.s)(),{prom:l,ruler:c}=(0,$.$)(P=>({prom:P.promRules[p.hY]||Ue.jA,ruler:P.rulerRules[p.hY]||Ue.jA})),i=l.loading||c.loading,U=!!l.result||!!c.result,k=o.view==="list",ue=k?(0,xe.Jr)(t):t,q=fs(ue),{numberOfPages:ge,onPageChange:me,page:ae,pageItems:_}=(0,be.W)(q,1,as.FG),[b,I]=(0,F.Ej)(F.RY.ExportGrafanaManagedRules),he=b&&I,[Ie,je]=(0,Ss.A)(!1),j=t.length>0,G=M.$.featureToggles.grafanaManagedRecordingRules;return(0,e.jsxs)("section",{className:r.wrapper,children:[(0,e.jsx)("div",{className:r.sectionHeader,children:(0,e.jsxs)("div",{className:r.headerRow,children:[(0,e.jsx)(ce.E,{element:"h2",variant:"h5",children:(0,e.jsx)(de.x6,{i18nKey:"alerting.list-view.section.grafanaManaged.title",children:"Grafana-managed"})}),i?(0,e.jsx)(N._,{className:r.loader,text:(0,de.t)("alerting.list-view.section.grafanaManaged.loading","Loading...")}):(0,e.jsx)("div",{}),(0,e.jsxs)(E.B,{direction:"row",alignItems:"center",justifyContent:"flex-end",children:[j&&he&&(0,e.jsx)(y.$n,{"aria-label":"export all grafana rules","data-testid":"export-all-grafana-rules",icon:"download-alt",tooltip:"Export all Grafana-managed rules",onClick:je,variant:"secondary",children:(0,e.jsx)(de.x6,{i18nKey:"alerting.list-view.section.grafanaManaged.export-rules",children:"Export rules"})}),G&&(0,e.jsx)(y.z9,{href:(0,Ds.G)("/alerting/new/grafana-recording",{returnTo:"/alerting/list"+location.search}),icon:"plus",variant:"secondary",tooltip:"Create new Grafana-managed recording rule",onClick:()=>(0,h.fH)(h.le.grafanaRecording),children:(0,e.jsx)(de.x6,{i18nKey:"alerting.list-view.section.grafanaManaged.new-recording-rule",children:"New recording rule"})})]})]})}),_.map(({group:P,namespace:ne})=>(0,e.jsx)(He,{group:P,namespace:ne,expandAll:a,viewMode:k?"list":"grouped"},`${ne.name}-${P.name}`)),U&&ue?.length===0&&(0,e.jsx)("p",{children:"No rules found."}),!U&&i&&(0,e.jsx)(H.y,{size:"xl",className:r.spinner}),(0,e.jsx)(Ce.d,{className:r.pagination,currentPage:ae,numberOfPages:ge,onNavigate:me,hideWhenSinglePage:!0}),he&&Ie&&(0,e.jsx)(Ps,{onClose:je})]})},As=t=>({loader:(0,d.css)({marginBottom:0}),sectionHeader:(0,d.css)({display:"flex",justifyContent:"space-between",marginBottom:t.spacing(1)}),wrapper:(0,d.css)({marginBottom:t.spacing(4)}),spinner:(0,d.css)({textAlign:"center",padding:t.spacing(2)}),pagination:(0,ns.H)(t),headerRow:(0,d.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",flexDirection:"row"})}),Ns=({namespaces:t,expandAll:a})=>{const[r,o]=(0,n.useMemo)(()=>{const l=t.map(c=>({...c,groups:c.groups.sort((i,U)=>i.name.localeCompare(U.name))})).sort((c,i)=>c.name.localeCompare(i.name));return[l.filter(c=>(0,p.z2)(c.rulesSource)),l.filter(c=>(0,p.Eb)(c.rulesSource))]},[t]);return(0,n.useEffect)(()=>{(0,h.fH)(h.le.loadedList)},[]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(B._,{actions:[F.RY.ViewAlertRule],children:(0,e.jsx)(Ms,{namespaces:r,expandAll:a})}),(0,e.jsx)(B._,{actions:[F.RY.ViewExternalAlertRule],children:(0,e.jsx)(Es,{namespaces:o,expandAll:a})})]})};var te=s(94822);const gs=({rules:t,state:a,defaultCollapsed:r=!1})=>{const[o,l]=(0,n.useState)(r),c=(0,ee.of)(Os);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("h4",{className:c.header,children:[(0,e.jsx)(ye.e,{className:c.collapseToggle,size:"xxl",isCollapsed:o,onToggle:()=>l(!o)}),(0,w.XI)(a)," (",t.length,")"]}),!o&&(0,e.jsx)(ze.s,{className:c.rulesTable,rules:t,showGroupColumn:!0})]})},Os=t=>({collapseToggle:(0,d.css)({verticalAlign:"middle"}),header:(0,d.css)({marginTop:t.spacing(2)}),rulesTable:(0,d.css)({marginTop:t.spacing(3)})}),ps={groups:Ns,state:({namespaces:t})=>{const a=(0,S.Ht)((0,m.s)()[0]),r=(0,n.useMemo)(()=>{const o={[te.cF.Firing]:[],[te.cF.Inactive]:[],[te.cF.Pending]:[]};return t.forEach(l=>l.groups.forEach(c=>c.rules.forEach(i=>{i.promRule&&(0,w.Z8)(i.promRule)&&i.promRule.state&&o[i.promRule.state].push(i)}))),Object.values(o).forEach(l=>l.sort((c,i)=>c.name.localeCompare(i.name))),o},[t]);return(0,e.jsxs)(e.Fragment,{children:[(!a.alertState||a.alertState===te.cF.Firing)&&(0,e.jsx)(gs,{state:te.cF.Firing,rules:r[te.cF.Firing]}),(!a.alertState||a.alertState===te.cF.Pending)&&(0,e.jsx)(gs,{state:te.cF.Pending,rules:r[te.cF.Pending]}),(!a.alertState||a.alertState===te.cF.Inactive)&&(0,e.jsx)(gs,{defaultCollapsed:a.alertState!==te.cF.Inactive,state:te.cF.Inactive,rules:r[te.cF.Inactive]})]})}},Ts=fe.Ys+1,vs=(0,L.w)(),Ls=()=>{const t=(0,f.useDispatch)(),a=(0,n.useMemo)(p.gR,[]),[r,o]=(0,n.useState)(!1),l=(0,n.useCallback)(()=>o(!1),[]),[c]=(0,m.s)(),{filterState:i,hasActiveFilters:U}=(0,Ee.dI)(),k=c.view,ue=ps[k]?k:"groups",q=ps[ue],ge=(0,$.$)(re=>re.promRules),me=(0,$.$)(re=>re.rulerRules),ae=a.some(re=>ge[re]?.loading||me[re]?.loading),_=Object.entries(ge),b=Object.entries(me),I=_.every(([re,Q])=>Q.dispatched&&(Q?.result!==void 0||Q?.error!==void 0)),he=b.every(([re,Q])=>Q.dispatched&&(Q?.result!==void 0||Q?.error!==void 0)),Ie=_.every(([re,Q])=>Q.dispatched&&Q?.result?.length===0),je=b.every(([re,Q])=>Object.entries(Q?.result??{}).every(([Rs,le])=>le?.length===0)&&Q.dispatched),j=U?void 0:Ts,[G,P]=(0,C.A)(async()=>{ae||(vs?(await t((0,z.eB)({rulesSourceName:p.hY})),await t((0,z.nV)(!1,{limitAlerts:j}))):await t((0,z.yo)(!1,{limitAlerts:j})))},[ae,j,t]);(0,n.useEffect)(()=>{(0,h.Sq)().catch(()=>{})},[]),(0,n.useEffect)(()=>{vs?(t((0,z.eB)({rulesSourceName:p.hY})),t((0,z.nV)(!1,{limitAlerts:j}))):t((0,z.yo)(!1,{limitAlerts:j}))},[t,j]),(0,R.A)(P,pe.HH);const ne=I&&Ie&&_.length>0&&je&&he,Ve=!ne,ls=(0,xe.dy)(),Ye=(0,Ee.i7)(ls,i);return(0,e.jsxs)(Be.d,{navId:"alert-list",isLoading:!1,actions:Ve&&(0,e.jsx)(Bs,{}),children:[(0,e.jsx)(ie.o,{}),(0,e.jsx)(Me.A,{onClear:l}),Ve&&(0,e.jsxs)(E.B,{direction:"row",alignItems:"center",children:[ue==="groups"&&U&&(0,e.jsx)(y.$n,{icon:r?"angle-double-up":"angle-double-down",variant:"secondary",onClick:()=>o(!r),children:r?"Collapse all":"Expand all"}),(0,e.jsx)(g.M_,{namespaces:Ye})]}),ne&&(0,e.jsx)(Ae.w,{}),Ve&&(0,e.jsx)(q,{expandAll:r,namespaces:Ye})]})},Fs=(0,u.Xc)(Ls,{style:"page"});function Bs(){const[t,a]=(0,F.Ej)(F.RY.CreateAlertRule),[r,o]=(0,F.Ej)(F.RY.CreateExternalAlertRule),l=(0,x.zy)();return t&&a||r&&o?(0,e.jsx)(y.z9,{href:D.kM.renderUrl("alerting/new/alerting",{returnTo:l.pathname+l.search}),icon:"plus",onClick:()=>(0,h.fH)(h.le.alertRuleFromScratch),children:"New alert rule"}):null}const Us=(0,n.lazy)(()=>s.e(2042).then(s.bind(s,82042))),Ks=()=>{const t=M.$.featureToggles.alertingListViewV2;return(0,e.jsx)(n.Suspense,{children:t?(0,e.jsx)(Us,{}):(0,e.jsx)(Fs,{})})}},64853:(Re,A,s)=>{s.d(A,{_:()=>C});var e=s(74848),n=s(2543),M=s.n(n),x=s(19073);const C=({actions:m,children:f})=>{const h=(0,n.filter)(m,y),L=(0,n.filter)(m,u);return h.length?(0,e.jsx)(R,{actions:h,children:f}):L.length?(0,e.jsx)(D,{actions:L,children:f}):null},R=({actions:m,children:f})=>{const h=(0,x.iI)();return E(h,m)?(0,e.jsx)(e.Fragment,{children:f}):null},D=({actions:m,children:f})=>{const h=(0,x.e2)();return E(h,m)?(0,e.jsx)(e.Fragment,{children:f}):null};function E(m,f){return(0,n.chain)(m).pick(f).values().value().some(([h,L])=>L===!0)}function y(m){return Object.values(x.QI).includes(m)}function u(m){return Object.values(x.RY).includes(m)}},19338:(Re,A,s)=>{s.d(A,{G:()=>E});var e=s(74848),n=s(32196),M=s(40845),x=s(60782),C=s(67061),R=s(14578),D=s(94753);function E({contentText:u,externalLink:m,linkText:f,title:h="Need help?"}){const L=(0,M.of)(y);return(0,e.jsx)(x.G,{content:(0,e.jsx)("div",{className:L.mutedText,children:u}),title:(0,e.jsxs)(C.B,{gap:.5,direction:"row",alignItems:"center",children:[(0,e.jsx)(R.I,{name:"question-circle"}),h]}),footer:m?(0,e.jsx)("a",{href:m,target:"_blank",rel:"noreferrer",children:(0,e.jsx)(C.B,{direction:"row",gap:.5,alignItems:"center",children:(0,e.jsxs)(D.E,{color:"link",children:[f," ",(0,e.jsx)(R.I,{size:"sm",name:"external-link-alt"})]})})}):void 0,closeButton:!0,placement:"bottom-start",children:(0,e.jsx)("div",{className:L.helpInfo,children:(0,e.jsxs)(C.B,{direction:"row",alignItems:"center",gap:.5,children:[(0,e.jsx)(R.I,{name:"question-circle",size:"sm"}),(0,e.jsx)(D.E,{variant:"bodySmall",color:"primary",children:"Need help?"})]})})})}const y=u=>({mutedText:(0,n.css)({color:u.colors.text.secondary,fontSize:u.typography.size.sm}),helpInfo:(0,n.css)({cursor:"pointer",textDecoration:"underline"})})},271:(Re,A,s)=>{s.d(A,{P:()=>E});var e=s(74848),n=s(32196),M=s(40845),x=s(84167),C=s(67061),R=s(94753),D=s(15292);const E=({title:u,stepNo:m,children:f,fullWidth:h=!1,description:L,switchMode:F})=>{const xe=(0,M.of)(y);return(0,e.jsx)("div",{className:xe.parent,children:(0,e.jsx)(x.n,{className:(0,n.cx)(h&&xe.fullWidth),label:(0,e.jsxs)(C.B,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,e.jsxs)(R.E,{variant:"h3",children:[m,". ",u]}),F&&(0,e.jsx)(R.E,{variant:"bodySmall",children:(0,e.jsx)(D.K,{id:"query-and-expressions-advanced-options",value:F.isAdvancedMode,onChange:Ee=>{F.setAdvancedMode(Ee.currentTarget.checked)},label:"Advanced options",showLabel:!0,transparent:!0,className:xe.reverse})})]}),children:(0,e.jsxs)(C.B,{direction:"column",children:[L&&(0,e.jsx)("div",{className:xe.description,children:L}),f]})})})},y=u=>({parent:(0,n.css)({display:"flex",flexDirection:"row",border:`solid 1px ${u.colors.border.weak}`,borderRadius:u.shape.radius.default,padding:`${u.spacing(2)} ${u.spacing(3)}`}),description:(0,n.css)({marginTop:`-${u.spacing(2)}`}),fullWidth:(0,n.css)({width:"100%"}),reverse:(0,n.css)({flexDirection:"row-reverse",gap:u.spacing(1)})})},72275:(Re,A,s)=>{s.d(A,{M:()=>x});var e=s(74848),n=s(56034),M=s(55852);const x=({tooltip:C,icon:R,to:D,target:E,onClick:y,className:u,tooltipPlacement:m="top",...f})=>{const h=typeof C=="string"?C:void 0;return(0,e.jsx)(n.m,{content:C,placement:m,children:D?(0,e.jsx)(M.z9,{variant:"secondary",fill:"text",icon:R,href:D,size:"sm",target:E,...f,"aria-label":h}):(0,e.jsx)(M.$n,{className:u,variant:"secondary",fill:"text",size:"sm",icon:R,type:"button",onClick:y,...f,"aria-label":h})})}},5598:(Re,A,s)=>{s.d(A,{A:()=>us});var e=s(74848),n=s(96540),M=s(32264),x=s(32196),C=s(49785),R=s(40845),D=s(14578),E=s(67061),y=s(88575),u=s(60029),m=s(56034),f=s(94354),h=s(10354),L=s(55852),F=s(59429),xe=s(10096),Ee=s(8484),$=s(39184),z=s(31678),pe=s(94822),p=s(25027),Be=s(14285),Me=s(39964),Ae=s(86171),fe=s(28475),ie=s(70383),B=s(57220),d=s(23662),Je=s(35108),Ne=s(22391),ee=s(51527),ce=s(13544),N=s(19347),H=s(26657),Ce=s(90182),de=s(98624);const as=v=>{const K=(0,N.l)(),[Te,we]=(0,n.useState)(),Xe=(O,Z)=>{if(Z.action==="clear"&&v.onClear){v.onClear();return}const ve=O[O.length-1];let se,W;Z.action==="pop-value"||Z.action==="remove-value"?(se=Z.removedValue?.value,W="remove"):(se=ve.value,W="add");const J=K.getInstanceSettings(se);J&&(v.onChange(J,W),we({error:void 0}))},S=()=>{const{current:O,hideTextValue:Z,noDefault:ve}=v;if(!(!O&&ve))return O?.map(se=>{const W=K.getInstanceSettings(se);if(W)return{label:W.name.slice(0,37),value:W.name,imgUrl:W.meta.info.logos.small,hideText:Z,meta:W.meta};const J=(0,Ne.Iz)(se);return J===H.dR.uid||J===H.dR.name?{label:J,value:J,hideText:Z}:{label:(J??"no name")+" - not found",value:J??void 0,imgUrl:"",hideText:Z}})},w=()=>{const{alerting:O,tracing:Z,metrics:ve,mixed:se,dashboard:W,variables:J,annotations:We,pluginId:es,type:ss,filter:$e,logs:ts}=v,Pe=K.getList({alerting:O,tracing:Z,metrics:ve,logs:ts,dashboard:W,mixed:se,variables:J,annotations:We,pluginId:es,filter:$e,type:ss}),g=Pe.filter(B.hP).map(T=>({value:T.name,label:`${T.name}${T.isDefault?" (default)":""}`,imgUrl:T.meta.info.logos.small,meta:T.meta})),ze=Pe.filter(T=>!(0,B.hP)(T)).map(T=>({value:T.name,label:`${T.name}${T.isDefault?" (default)":""}`,imgUrl:T.meta.info.logos.small,meta:T.meta}));return[{label:"Data sources with configured alert rules",options:g,expanded:!0},{label:"Other data sources",options:ze,expanded:!0}]},{autoFocus:ye,onBlur:Le,onClear:X,openMenuOnFocus:Se,placeholder:De,width:Ze,inputId:ke,disabled:Ge=!1,isLoading:qe=!1}=v,Fe=w(),Y=S(),_e=typeof X=="function";return(0,e.jsx)("div",{"data-testid":ce.Tp.components.DataSourcePicker.container,children:(0,e.jsx)(Ce.KF,{isLoading:qe,disabled:Ge,"data-testid":ce.Tp.components.DataSourcePicker.inputV2,inputId:ke||"data-source-picker",className:"ds-picker select-container",isClearable:_e,backspaceRemovesValue:!0,onChange:Xe,options:Fe,autoFocus:ye,onBlur:Le,width:Ze,openMenuOnFocus:Se,maxMenuHeight:500,placeholder:De,noOptionsMessage:"No datasources found",value:Y??[],invalid:!!Te?.error||!!v.invalid,getOptionLabel:O=>O.meta&&(0,ee.x)(O.meta.signature)&&O!==Y?(0,e.jsxs)(E.B,{alignItems:"center",justifyContent:"space-between",children:[(0,e.jsx)("span",{children:O.label})," ",(0,e.jsx)(de.B,{status:O.meta.signature})]}):O.label||""})})},be=[{icon:"folder",label:"Grouped",value:"grouped"},{icon:"list-ul",label:"List",value:"list"},{icon:"heart-rate",label:"State",value:"state"}],ns=[{label:"Alert ",value:pe.JS.Alerting},{label:"Recording ",value:pe.JS.Recording}],Ue=[{label:"Ok",value:fe.Jc.Ok},{label:"No Data",value:fe.Jc.NoData},{label:"Error",value:fe.Jc.Error}],is=Object.entries(pe.cF).map(([v,K])=>({label:(0,d.XI)(K),value:K})),Qe=({onClear:v=()=>{}})=>{const K=(0,R.of)(cs),[Te,we]=(0,Me.l)(),{pluginsFilterEnabled:Xe}=Oe(),{filterState:S,hasActiveFilters:w,searchQuery:ye,setSearchQuery:Le,updateFilters:X}=(0,Be.dI)(),[Se,De]=(0,n.useState)(Math.floor(Math.random()*100)),Ze=`dataSource-${Se}`,ke=`queryString-${Se}`,Ge=(0,n.useRef)(null),{handleSubmit:qe,register:Fe,setValue:Y}=(0,C.mN)({defaultValues:{searchQuery:ye}}),{ref:_e,...O}=Fe("searchQuery");(0,n.useEffect)(()=>{Y("searchQuery",ye)},[ye,Y]);const Z=(g,ze)=>{const He=ze==="add"?[...S.dataSourceNames].concat([g.name]):S.dataSourceNames.filter(T=>T!==g.name);X({...S,dataSourceNames:He}),De(T=>T+1),(0,p.Sn)("dataSourceNames")},ve=g=>{X({...S,dashboardUid:g}),(0,p.Sn)("dashboardUid")},se=()=>{X({...S,dataSourceNames:[]}),De(g=>g+1)},W=g=>{(0,p.fH)(p.le.clickingAlertStateFilters),X({...S,ruleState:g}),(0,p.Sn)("ruleState")},J=g=>{X({...S,ruleType:g}),(0,p.Sn)("ruleType")},We=g=>{X({...S,ruleHealth:g}),(0,p.Sn)("ruleHealth")},es=()=>{Le(void 0),v(),setTimeout(()=>De(Se+1),100)},ss=g=>{we({view:g}),(0,p.aL)({view:g})},$e=g=>{X({...S,contactPoint:g}),(0,p.Sn)("contactPoint")},ts=(xe.TP.hasPermission(z.AccessControlAction.AlertingReceiversRead)&&M.$.featureToggles.alertingSimplifiedRouting)??!1,Pe=(0,e.jsx)(D.I,{name:"search"});return(0,e.jsx)("div",{className:K.container,children:(0,e.jsxs)(E.B,{direction:"column",gap:1,children:[(0,e.jsxs)(E.B,{direction:"row",gap:1,wrap:"wrap",children:[(0,e.jsx)(y.D,{className:K.dsPickerContainer,label:(0,e.jsx)(u.J,{htmlFor:"data-source-picker",children:(0,e.jsxs)(E.B,{gap:.5,alignItems:"center",children:[(0,e.jsx)("span",{children:"Search by data sources"}),(0,e.jsx)(m.m,{content:(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{children:"Data sources containing configured alert rules are Mimir or Loki data sources where alert rules are stored and evaluated in the data source itself."}),(0,e.jsx)("p",{children:"In these data sources, you can select Manage alerts via Alerting UI to be able to manage these alert rules in the Grafana UI as well as in the data source where they were configured."})]}),children:(0,e.jsx)(D.I,{id:"data-source-picker-inline-help",name:"info-circle",size:"sm",title:"Search by data sources help"})})]})}),children:(0,e.jsx)(as,{alerting:!0,noDefault:!0,placeholder:"All data sources",current:S.dataSourceNames,onChange:Z,onClear:se},Ze)}),(0,e.jsx)(y.D,{className:K.dashboardPickerContainer,label:(0,e.jsx)(u.J,{htmlFor:"filters-dashboard-picker",children:"Dashboard"}),children:(0,e.jsx)(F.b,{inputId:"filters-dashboard-picker",value:S.dashboardUid,onChange:g=>ve(g?.uid),isClearable:!0,cacheOptions:!0},S.dashboardUid?"dashboard-defined":"dashboard-not-defined")}),(0,e.jsxs)("div",{children:[(0,e.jsx)(u.J,{children:"State"}),(0,e.jsx)(f.z,{options:is,value:S.ruleState,onChange:W})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(u.J,{children:"Rule type"}),(0,e.jsx)(f.z,{options:ns,value:S.ruleType,onChange:J})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(u.J,{children:"Health"}),(0,e.jsx)(f.z,{options:Ue,value:S.ruleHealth,onChange:We})]}),ts&&(0,e.jsx)(ie.b9,{accessType:"notification",alertmanagerSourceName:B.hY,children:(0,e.jsx)(E.B,{direction:"column",gap:0,children:(0,e.jsx)(y.D,{label:(0,e.jsx)(u.J,{htmlFor:"contactPointFilter",children:(0,e.jsx)(Ee.x6,{i18nKey:"alerting.contactPointFilter.label",children:"Contact point"})}),children:(0,e.jsx)($.u,{selectedContactPointName:S.contactPoint,selectProps:{inputId:"contactPointFilter",width:40,onChange:g=>{$e(g?.value?.name)},isClearable:!0}})})})}),Xe&&(0,e.jsxs)("div",{children:[(0,e.jsx)(u.J,{children:"Plugin rules"}),(0,e.jsx)(f.z,{options:[{label:"Show",value:void 0},{label:"Hide",value:"hide"}],value:S.plugins,onChange:g=>X({...S,plugins:g})})]})]}),(0,e.jsxs)(E.B,{direction:"column",gap:1,children:[(0,e.jsxs)(E.B,{direction:"row",gap:1,children:[(0,e.jsxs)("form",{className:K.searchInput,onSubmit:qe(g=>{Le(g.searchQuery),Ge.current?.blur(),(0,p.zs)({oldQuery:ye,newQuery:g.searchQuery})}),children:[(0,e.jsx)(y.D,{label:(0,e.jsx)(u.J,{htmlFor:"rulesSearchInput",children:(0,e.jsxs)(E.B,{gap:.5,alignItems:"center",children:[(0,e.jsx)("span",{children:"Search"}),(0,e.jsx)(Je.B,{content:(0,e.jsx)(rs,{}),children:(0,e.jsx)(D.I,{name:"info-circle",size:"sm",tabIndex:0,title:"Search help"})})]})}),children:(0,e.jsx)(h.p,{id:"rulesSearchInput",prefix:Pe,ref:g=>{_e(g),Ge.current=g},...O,placeholder:"Search","data-testid":"search-query-input"},ke)}),(0,e.jsx)("input",{type:"submit",hidden:!0})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(u.J,{children:"View as"}),(0,e.jsx)(f.z,{options:be,value:Te.get("view")??be[0].value,onChange:ss})]})]}),w&&(0,e.jsx)("div",{children:(0,e.jsx)(L.$n,{fullWidth:!1,icon:"times",variant:"secondary",onClick:es,children:"Clear filters"})})]})]})})},cs=v=>({container:(0,x.css)({marginBottom:v.spacing(1)}),dsPickerContainer:(0,x.css)({width:v.spacing(60),flexGrow:0,margin:0}),dashboardPickerContainer:(0,x.css)({minWidth:v.spacing(50)}),searchInput:(0,x.css)({flex:1,margin:0})});function rs(){const v=(0,R.of)(Ke);return(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:"Search syntax allows to query alert rules by the parameters defined below."}),(0,e.jsx)("hr",{}),(0,e.jsxs)("div",{className:v.grid,children:[(0,e.jsx)("div",{children:"Filter type"}),(0,e.jsx)("div",{children:"Expression"}),(0,e.jsx)(V,{title:"Datasources",expr:"datasource:mimir datasource:prometheus"}),(0,e.jsx)(V,{title:"Folder/Namespace",expr:"namespace:global"}),(0,e.jsx)(V,{title:"Group",expr:"group:cpu-usage"}),(0,e.jsx)(V,{title:"Rule",expr:'rule:"cpu 80%"'}),(0,e.jsx)(V,{title:"Labels",expr:"label:team=A label:cluster=a1"}),(0,e.jsx)(V,{title:"State",expr:"state:firing|normal|pending"}),(0,e.jsx)(V,{title:"Type",expr:"type:alerting|recording"}),(0,e.jsx)(V,{title:"Health",expr:"health:ok|nodata|error"}),(0,e.jsx)(V,{title:"Dashboard UID",expr:"dashboard:eadde4c7-54e6-4964-85c0-484ab852fd04"}),(0,e.jsx)(V,{title:"Contact point",expr:"contactPoint:slack"})]})]})}function V({title:v,expr:K}){const Te=(0,R.of)(Ke);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:v}),(0,e.jsx)("code",{className:Te.code,children:K})]})}const Ke=v=>({grid:(0,x.css)({display:"grid",gridTemplateColumns:"max-content auto",gap:v.spacing(1),alignItems:"center"}),code:(0,x.css)({display:"block",textAlign:"center"})});function Oe(){const{components:v}=(0,Ae.u)();return{pluginsFilterEnabled:v.length>0}}const ds=Qe,os=(0,n.lazy)(()=>s.e(1810).then(s.bind(s,91810))),us=v=>{const K=M.$.featureToggles.alertingFilterV2;return(0,e.jsx)(n.Suspense,{children:K?(0,e.jsx)(os,{...v}):(0,e.jsx)(ds,{...v})})}},45058:(Re,A,s)=>{s.d(A,{w:()=>E});var e=s(74848),n=s(69529),M=s(67061),x=s(55852),C=s(72109),R=s(8484),D=s(41520);const E=()=>{const{canCreateGrafanaRules:y,canCreateCloudRules:u}=(0,D.V)(),m=y||u;return(0,e.jsx)("div",{children:(0,e.jsx)(n.p,{message:"You haven't created any rules yet",variant:"call-to-action",button:m?(0,e.jsxs)(M.B,{direction:"row",alignItems:"center",justifyContent:"center",children:[m&&(0,e.jsx)(x.z9,{variant:"primary",icon:"plus",size:"lg",href:"alerting/new/alerting",children:(0,e.jsx)(R.x6,{i18nKey:"alerting.list-view.empty.new-alert-rule",children:"New alert rule"})}),u&&(0,e.jsx)(x.z9,{variant:"primary",icon:"plus",size:"lg",href:"alerting/new/recording",children:(0,e.jsx)(R.x6,{i18nKey:"alerting.list-view.empty.new-recording-rule",children:"New recording rule"})})]}):null,children:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(R.x6,{i18nKey:"alerting.list-view.empty.provisioning",children:["You can also define rules through file provisioning or Terraform."," ",(0,e.jsx)(C.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/",external:!0,children:"Learn more"})]})})})})}},67381:(Re,A,s)=>{s.d(A,{o:()=>F});var e=s(74848),n=s(32196),M=s(55127),x=s.n(M),C=s(96540),R=s(78685),D=s(40845),E=s(42418),y=s(55852),u=s(56034),m=s(61410),f=s(57220),h=s(78742),L=s(23662);function F(){const[$,z]=(0,C.useState)(!1),[pe,p]=(0,R.A)("grafana.unifiedalerting.hideErrors",!1),Be=(0,m.$)(B=>B.dataSources),Me=(0,m.$)(B=>B.promRules),Ae=(0,m.$)(B=>B.rulerRules),fe=(0,D.of)(Ee),ie=(0,C.useMemo)(()=>{const[B,d,Je]=[Be,Me,Ae].map(N=>(0,f.qi)().reduce((H,Ce)=>{const de=N[Ce.name]?.error;return N[Ce.name]&&de&&!(0,L.$7)(N[Ce.name])?[...H,{dataSource:Ce,error:de}]:H},[])),Ne=Me[f.hY]?.error,ee=Ae[f.hY]?.error,ce=[];return Ne&&ce.push((0,e.jsxs)(e.Fragment,{children:["Failed to load Grafana rules state: ",Ne.message||"Unknown error."]})),ee&&ce.push((0,e.jsxs)(e.Fragment,{children:["Failed to load Grafana rules config: ",ee.message||"Unknown error."]})),B.forEach(({dataSource:N,error:H})=>{ce.push((0,e.jsxs)(e.Fragment,{children:["Failed to load the data source configuration for"," ",(0,e.jsx)("a",{href:(0,h.GD)(N.uid),className:fe.dsLink,children:N.name}),": ",H.message||"Unknown error."]}))}),d.forEach(({dataSource:N,error:H})=>ce.push((0,e.jsxs)(e.Fragment,{children:["Failed to load rules state from"," ",(0,e.jsx)("a",{href:(0,h.GD)(N.uid),className:fe.dsLink,children:N.name}),": ",H.message||"Unknown error."]}))),Je.forEach(({dataSource:N,error:H})=>ce.push((0,e.jsxs)(e.Fragment,{children:["Failed to load rules config from"," ",(0,e.jsx)("a",{href:(0,h.GD)(N.uid),className:fe.dsLink,children:N.name}),": ",H.message||"Unknown error."]}))),ce},[Be,Me,Ae,fe.dsLink]);return(0,e.jsxs)(e.Fragment,{children:[!!ie.length&&pe&&(0,e.jsx)(xe,{count:ie.length,onClick:()=>p(B=>!B)}),!!ie.length&&!pe&&(0,e.jsxs)(E.F,{"data-testid":"cloud-rulessource-errors",title:"Errors loading rules",severity:"error",onRemove:()=>p(!0),children:[$&&ie.map((B,d)=>(0,e.jsx)("div",{children:B},d)),!$&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:ie[0]}),ie.length>=2&&(0,e.jsxs)(y.$n,{className:fe.moreButton,fill:"text",icon:"angle-right",size:"sm",onClick:()=>z(!0),children:[ie.length-1," more ",x()("error",ie.length-1)]})]})]})]})}const xe=({count:$,onClick:z})=>{const pe=(0,D.of)(Ee);return(0,e.jsx)("div",{className:pe.floatRight,children:(0,e.jsx)(u.m,{content:"Show all errors",placement:"bottom",children:(0,e.jsx)(y.$n,{fill:"text",variant:"destructive",icon:"exclamation-triangle",onClick:z,children:$>1?(0,e.jsxs)(e.Fragment,{children:[$," errors"]}):(0,e.jsx)(e.Fragment,{children:"1 error"})})})})},Ee=$=>({moreButton:(0,n.css)({padding:0}),floatRight:(0,n.css)({display:"flex",justifyContent:"flex-end"}),dsLink:(0,n.css)({fontWeight:$.typography.fontWeightBold})})},86171:(Re,A,s)=>{s.d(A,{u:()=>M});var e=s(74135),n=s(7299);function M(){return(0,n.f)({extensionPointId:e.S.AlertingHomePage,limitPerPlugin:1})}},10940:(Re,A,s)=>{s.d(A,{A:()=>M});var e=s(96540),n=function(x,C){var R=(0,e.useRef)(function(){});(0,e.useEffect)(function(){R.current=x}),(0,e.useEffect)(function(){if(C!==null){var D=setInterval(function(){return R.current()},C||0);return function(){return clearInterval(D)}}},[C])};const M=n}}]);

//# sourceMappingURL=AlertRuleListIndex.455b029341e61b605050.js.map