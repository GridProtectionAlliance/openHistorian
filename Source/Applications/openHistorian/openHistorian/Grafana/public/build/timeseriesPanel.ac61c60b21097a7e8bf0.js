"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[563],{32307:(Ue,j,s)=>{s.r(j),s.d(j,{plugin:()=>we});var ee=s(65158),te=s(89654),ie=s(22680),g=s(74848),A=s(96540),se=s(41260),H=s(94624),oe=s(97152),t=s(52622),ne=s(79041),ae=s(23117),le=s(68268),R=s(38761),re=s(95168),de=s(2913),fe=s(22731),ce=s(62567),k=s(86889),me=s(7874),ue=s(59965),M=s(24293),he=s(18282),b=s(14792),x=s(38824);class ge{getSuggestionsForData(o){const{dataSummary:i}=o;if(!i.hasTimeField||!i.hasNumberField||i.rowCountTotal<2)return;const d=o.getListAppender({name:x.m.LineChart,pluginId:"timeseries",options:{legend:{calcs:[],displayMode:t.lm.Hidden,placement:"right",showLegend:!1}},fieldConfig:{defaults:{custom:{}},overrides:[]},cardOptions:{previewModifier:n=>{n.fieldConfig?.defaults.custom?.drawStyle!==t.GR.Bars&&(n.fieldConfig.defaults.custom.lineWidth=Math.max(n.fieldConfig.defaults.custom.lineWidth??1,2))}}}),f=100;if(d.append({name:x.m.LineChart}),i.rowCountMax<200&&d.append({name:x.m.LineChartSmooth,fieldConfig:{defaults:{custom:{lineInterpolation:t.dx.Smooth}},overrides:[]}}),i.numberFieldCount===1){d.append({name:x.m.AreaChart,fieldConfig:{defaults:{custom:{fillOpacity:25}},overrides:[]}}),d.append({name:x.m.LineChartGradientColorScheme,fieldConfig:{defaults:{color:{mode:M.Y.ContinuousGrYlRd},custom:{gradientMode:t.on.Scheme,lineInterpolation:t.dx.Smooth,lineWidth:3,fillOpacity:20}},overrides:[]}}),i.rowCountMax<f&&(d.append({name:x.m.BarChart,fieldConfig:{defaults:{custom:{drawStyle:t.GR.Bars,fillOpacity:100,lineWidth:1,gradientMode:t.on.Hue}},overrides:[]}}),d.append({name:x.m.BarChartGradientColorScheme,fieldConfig:{defaults:{color:{mode:M.Y.ContinuousGrYlRd},custom:{drawStyle:t.GR.Bars,fillOpacity:90,lineWidth:1,gradientMode:t.on.Scheme}},overrides:[]}}));return}d.append({name:x.m.AreaChartStacked,fieldConfig:{defaults:{custom:{fillOpacity:25,stacking:{mode:t.gs.Normal,group:"A"}}},overrides:[]}}),d.append({name:x.m.AreaChartStackedPercent,fieldConfig:{defaults:{custom:{fillOpacity:25,stacking:{mode:t.gs.Percent,group:"A"}}},overrides:[]}}),i.rowCountTotal/i.numberFieldCount<f&&(d.append({name:x.m.BarChartStacked,fieldConfig:{defaults:{custom:{drawStyle:t.GR.Bars,fillOpacity:100,lineWidth:1,gradientMode:t.on.Hue,stacking:{mode:t.gs.Normal,group:"A"}}},overrides:[]}}),d.append({name:x.m.BarChartStackedPercent,fieldConfig:{defaults:{custom:{drawStyle:t.GR.Bars,fillOpacity:100,lineWidth:1,gradientMode:t.on.Hue,stacking:{mode:t.gs.Percent,group:"A"}}},overrides:[]}}))}}function pe(e){const o=(0,b.UA)().getCurrent()?.getPanelById(e);if(o){const i=o.transformations?[...o.transformations]:[];return i.push({id:he.F.prepareTimeSeries,options:{format:"wide"}}),{name:"Transform to wide time series format",pluginId:"timeseries",transformations:i}}}var E=s(82915);const ve=({data:e,timeRange:o,timeZone:i,width:d,height:f,options:n,fieldConfig:u,onChangeTimeRange:a,replaceVariables:h,id:S})=>{const{sync:O,eventsScope:m,canAddAnnotations:l,onThresholdsChange:r,canEditThresholds:p,showThresholds:T,dataLinkPostProcessor:c,eventBus:v}=(0,ne.d2)(),L=n.orientation===t.wV.Vertical,N=(0,A.useMemo)(()=>(0,E.B_)(e.series,de.$W.theme2,o),[e.series,o]),je=(0,A.useMemo)(()=>(0,E.Fg)(n.timezone,i),[n.timezone,i]),z=(0,A.useMemo)(()=>{if(N?.length&&N.every(C=>C.meta?.type===se.m.TimeSeriesLong)){const C=pe(S);return{message:"Long data must be converted to wide",suggestions:C?[C]:void 0}}},[N,S]),Z=!!(l&&l()),[He,I]=(0,A.useState)(null),w=O?.()??H.y.Off;return!N||z?(0,g.jsx)(oe.a,{panelId:S,message:z?.message,fieldConfig:u,data:e,needsTimeField:!0,needsNumberField:!0,suggestions:z?.suggestions}):(0,g.jsx)(re.Z,{frames:N,structureRev:e.structureRev,timeRange:o,timeZone:je,width:d,height:f,legend:n.legend,options:n,replaceVariables:h,dataLinkPostProcessor:c,cursorSync:w,children:(C,J)=>(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(ae.Z,{config:C}),w!==H.y.Off&&(0,g.jsx)(le.K,{config:C,eventBus:v,frame:J}),n.tooltip.mode!==t.$N.None&&(0,g.jsx)(R.xl,{config:C,hoverMode:n.tooltip.mode===t.$N.Single?R.b3.xOne:R.b3.xAll,queryZoom:a,clientZoom:!0,syncMode:w,syncScope:m,render:(Q,ke,be,Ee=!1,X,q,Ve)=>{if(Z&&q!=null){I(q),X();return}const Ye=()=>{let _=Q.posToVal(Q.cursor.left,"x");I({from:_,to:_}),X()};return(0,g.jsx)(fe.k,{series:J,dataIdxs:ke,seriesIdx:be,mode:Ve?t.$N.Multi:n.tooltip.mode,sortOrder:n.tooltip.sort,isPinned:Ee,annotate:Z?Ye:void 0,maxHeight:n.tooltip.maxHeight,replaceVariables:h})},maxWidth:n.tooltip.maxWidth}),!L&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(ce.W,{annotations:e.annotations??[],config:C,timeZone:i,newRange:He,setNewRange:I}),(0,g.jsx)(me.U,{config:C,onChangeTimeRange:a}),e.annotations&&(0,g.jsx)(k.z,{visibleSeries:(0,k.e)(C,N),config:C,exemplars:e.annotations,timeZone:i}),(p&&r||T)&&(0,g.jsx)(ue.p,{config:C,fieldConfig:u,onThresholdsChange:p?r:void 0})]})]})})};var V=s(32196),F=s(91410),ye=s(40845),Ce=s(20333),Y=s(29158);const xe=({value:e,onChange:o})=>{const i=(0,ye.of)(Se);(!e||e.length<1)&&(e=[""]);const d=()=>{o([...e,F.g$.default])},f=u=>{const a=e.slice();a.splice(u,1),o(a)},n=(u,a)=>{const h=e.slice();h[u]=a??F.g$.default,h.length===0||h.length===1&&h[0]===""?o(void 0):o(h)};return(0,g.jsx)("div",{children:e.map((u,a)=>(0,g.jsxs)("div",{className:i.wrapper,children:[(0,g.jsx)("span",{className:i.first,children:(0,g.jsx)(Ce.U,{onChange:h=>n(a,h),includeInternal:!0,value:u??F.g$.default})}),a===e.length-1?(0,g.jsx)(Y.K,{name:"plus",onClick:d,tooltip:"Add timezone"}):(0,g.jsx)(Y.K,{name:"times",onClick:()=>f(a),tooltip:"Remove timezone"})]},`${a}.${u}`))})},Se=e=>({wrapper:(0,V.css)`
    width: 100%;
    display: flex;
    flex-direction: rows;
    align-items: center;
  `,first:(0,V.css)`
    margin-right: 8px;
    flex-grow: 2;
  `});var B=s(41706),y=s(2543),P=s(1173),Te=s(37055),Oe=s(39070),G=s(75059),Le=s(50082),Ne=s(11261),Pe=s(74856),Ae=s(38477),Me=s(55600),Be=s(32023),Re=s(68706);let W=null;const Fe=(e,o,i,d)=>{if(o==="graph"&&i.angular){const{fieldConfig:f,options:n,annotations:u}=Ge({...i.angular,fieldConfig:d,panel:e});return u?.length>0&&Ie(u),e.fieldConfig=f,e.alert=i.angular.alert,n}return $e(e),{}};function Ge(e){let o=[];const i=e.fieldConfig?.overrides??[],d=e.yaxes??[];let f=U(d[0]);e.fieldConfig?.defaults&&(f={...e.fieldConfig?.defaults,...f});const n={fill:e.dashes?"dash":"solid",dash:[e.dashLength??10,e.spaceLength??10]};if(e.aliasColors)for(const m of Object.keys(e.aliasColors)){const l=e.aliasColors[m];l&&i.push({matcher:{id:P.Ct.byName,options:m},properties:[{id:Te.uo.Color,value:{mode:M.Y.Fixed,fixedColor:l}}]})}let u=!1;if(e.seriesOverrides?.length)for(const m of e.seriesOverrides){if(!m.alias)continue;const r={matcher:{id:/^([/~@;%#'])(.*?)\1([gimsuy]*)$/.test(m.alias)?P.Ct.byRegexp:P.Ct.byName,options:m.alias},properties:[]};let p;for(const T of Object.keys(m)){const c=m[T];switch(T){case"alias":case"$$hashKey":break;case"yaxis":if(c===2){const v=U(d[1]);We(f,v,r.properties)}break;case"fill":r.properties.push({id:"custom.fillOpacity",value:c*10});break;case"fillBelowTo":u=!0,r.properties.push({id:"custom.fillBelowTo",value:c});break;case"fillGradient":c&&(r.properties.push({id:"custom.fillGradient",value:"opacity"}),r.properties.push({id:"custom.fillOpacity",value:c*10}));break;case"points":r.properties.push({id:"custom.showPoints",value:c?t.yL.Always:t.yL.Never});break;case"bars":c?(r.properties.push({id:"custom.drawStyle",value:t.GR.Bars}),r.properties.push({id:"custom.fillOpacity",value:100})):r.properties.push({id:"custom.drawStyle",value:t.GR.Line});break;case"lines":c?r.properties.push({id:"custom.drawStyle",value:"line"}):r.properties.push({id:"custom.lineWidth",value:0});break;case"linewidth":r.properties.push({id:"custom.lineWidth",value:c});break;case"pointradius":r.properties.push({id:"custom.pointSize",value:2+c*2});break;case"dashLength":case"spaceLength":case"dashes":switch(p||(p={fill:n.fill,dash:[...n.dash]}),T){case"dashLength":p.dash[0]=c;break;case"spaceLength":p.dash[1]=c;break;case"dashes":p.fill=c?"dash":"solid";break}break;case"stack":r.properties.push({id:"custom.stacking",value:ze(c)});break;case"color":r.properties.push({id:"color",value:{fixedColor:c,mode:M.Y.Fixed}});break;case"transform":r.properties.push({id:"custom.transform",value:c==="negative-Y"?t.NU.NegativeY:t.NU.Constant});break;default:console.log("Ignore override migration:",m.alias,T,c)}}p&&r.properties.push({id:"custom.lineStyle",value:p}),r.properties.length&&i.push(r)}const a=f.custom??{};a.drawStyle=e.bars?t.GR.Bars:e.lines?t.GR.Line:t.GR.Points,e.points?(a.showPoints=t.yL.Always,(0,y.isNumber)(e.pointradius)&&(a.pointSize=2+e.pointradius*2)):a.drawStyle!==t.GR.Points&&(a.showPoints=t.yL.Never),a.lineWidth=e.linewidth,n.fill!=="solid"&&(a.lineStyle=n),u?a.fillOpacity=35:(0,y.isNumber)(e.fill)&&(a.fillOpacity=e.fill*10),(0,y.isNumber)(e.fillGradient)&&e.fillGradient>0&&(a.gradientMode=t.on.Opacity,a.fillOpacity=e.fillGradient*10),a.spanNulls=e.nullPointMode===Oe.UW.Ignore,e.steppedLine&&(a.lineInterpolation=t.dx.StepAfter),a.drawStyle===t.GR.Bars&&(a.fillOpacity=100),e.stack&&(a.stacking={mode:e.percentage?t.gs.Percent:t.gs.Normal,group:B.S.stacking.group},e.percentage&&e.yaxis&&(delete f.min,delete f.max,f.decimals===0&&delete f.decimals)),f.custom=(0,y.omitBy)(a,y.isNil),f.nullValueMode=e.nullPointMode;const h={legend:{displayMode:t.lm.List,showLegend:!0,placement:"bottom",calcs:[]},tooltip:{mode:t.$N.Single,sort:t.xB.None}},S=e.legend;if(S){if(S.show?h.legend.displayMode=S.alignAsTable?t.lm.Table:t.lm.List:h.legend.showLegend=!1,S.rightSide&&(h.legend.placement="right"),e.legend.values){const m=(0,y.pickBy)(e.legend);h.legend.calcs=De(m)}e.legend.sideWidth&&(h.legend.width=e.legend.sideWidth),S.hideZero&&i.push(K(G.gy.allIsZero)),S.hideEmpty&&i.push(K(G.gy.allIsNull))}e.timeRegions?.length&&e.timeRegions.map((l,r)=>({name:`T${r}`,color:l.colorMode!=="custom"?l.colorMode:l.fillColor,line:l.line,fill:l.fill,fromDayOfWeek:l.fromDayOfWeek,toDayOfWeek:l.toDayOfWeek,from:l.from,to:l.to})).forEach((l,r)=>{const p={datasource:{type:"datasource",uid:"grafana"},enable:!0,hide:!0,filter:{exclude:!1,ids:[e.panel.id]},iconColor:l.fillColor??l.color,name:`Time region for panel ${e.panel.title}${r>0?` ${r}`:""}`,target:{queryType:Re.nj.TimeRegions,refId:"Anno",timeRegion:{fromDayOfWeek:l.fromDayOfWeek,toDayOfWeek:l.toDayOfWeek,from:l.from,to:l.to,timezone:"utc"}}};l.fill?o.push(p):l.line&&(p.iconColor=l.lineColor??"white",o.push(p))});const O=e.tooltip;if(O&&(O.shared!==void 0&&(h.tooltip.mode=O.shared?t.$N.Multi:t.$N.Single),O.sort!==void 0&&O.shared))switch(O.sort){case 1:h.tooltip.sort=t.xB.Ascending;break;case 2:h.tooltip.sort=t.xB.Descending;break;default:h.tooltip.sort=t.xB.None}if(e.thresholds&&e.thresholds.length>0){let m=[],l=!1,r=!1;const p=e.thresholds.sort((c,v)=>c.value>v.value?1:-1);for(let c=0;c<p.length;c++){const v=p[c],L=p.length>c+1?p[c+1]:null;v.fill&&(l=!0),v.line&&(r=!0),v.op==="gt"&&m.push({value:v.value,color:D(v)}),v.op==="lt"&&(m.length===0&&m.push({value:-1/0,color:D(v)}),L&&L.op==="gt"&&L.value>v.value?m.push({value:v.value,color:"transparent"}):L&&L.op==="lt"?m.push({value:v.value,color:D(L)}):m.push({value:v.value,color:"transparent"}))}m.length>0&&m[0].value!==-1/0&&m.unshift({color:"transparent",value:-1/0});let T=l?t.Ly.Area:t.Ly.Line;r&&l&&(T=t.Ly.LineAndArea),f.custom.thresholdsStyle={mode:T},f.thresholds={mode:Le.O.Absolute,steps:m}}return e.xaxis&&e.xaxis.show===!1&&e.xaxis.mode==="time"&&i.push({matcher:{id:P.Ct.byType,options:Ne.PU.time},properties:[{id:"custom.axisPlacement",value:t.vM.Hidden}]}),{fieldConfig:{defaults:(0,y.omitBy)(f,y.isNil),overrides:i},options:h,annotations:o}}function D(e){return e.colorMode==="critical"?"red":e.colorMode==="warning"?"orange":e.colorMode==="custom"?e.fillColor||e.lineColor:"red"}function U(e){if(!e)return{};const o={axisPlacement:e.show?t.vM.Auto:t.vM.Hidden};if(e.label&&(o.axisLabel=e.label),e.logBase){const i=e.logBase;(i===2||i===10)&&(o.scaleDistribution={type:t.L4.Log,log:i})}return(0,y.omitBy)({unit:e.format,decimals:$(e.decimals),min:$(e.min),max:$(e.max),custom:o},y.isNil)}function We(e,o,i){for(const[n,u]of Object.entries(o))n!=="custom"&&u!==e[n]&&i.push({id:n,value:u});i.push({id:"custom.axisPlacement",value:t.vM.Right});const d=e.custom??{},f=o.custom??{};for(const[n,u]of Object.entries(f))u!==d[n]&&i.push({id:`custom.${n}`,value:u})}function $(e){if((0,y.isNumber)(e))return e;if((0,y.isString)(e)){const o=Number(e);if(!isNaN(o))return o}}function De(e){const o=[];for(const i in e){const d=G.AS.getIfExists(i);d&&o.push(d.id)}return o}function $e(e){e.fieldConfig?.defaults?.custom?.hideFrom?.graph!==void 0&&(e.fieldConfig.defaults.custom.hideFrom.viz=e.fieldConfig.defaults.custom.hideFrom.graph,delete e.fieldConfig.defaults.custom.hideFrom.graph),e.fieldConfig?.overrides&&(e.fieldConfig.overrides=e.fieldConfig.overrides.map(o=>(o.properties=o.properties.map(i=>(i.id==="custom.hideFrom"&&i.value.graph&&(i.value.viz=i.value.graph,delete i.value.graph),i)),o)))}function K(e){return{matcher:{id:P.Ct.byValue,options:{reducer:e,op:t.zT.GTE,value:0}},properties:[{id:"custom.hideFrom",value:{tooltip:!0,viz:!1,legend:!0}}]}}function ze(e){const o=B.S.stacking?.group;return{mode:e?t.gs.Normal:t.gs.None,group:(0,y.isString)(e)?e:o}}function Ie(e){const o=window.__grafanaSceneContext;if(o instanceof Me.H$){const d=Be.b4.getDataLayers(o),f=[...d.state.annotationLayers];for(let n of e){const u=new Ae.g({key:`annotations-${n.name}`,query:n,name:n.name,isEnabled:n.enable,isHidden:n.hide});f.push(u)}d.setState({annotationLayers:f});return}const i=(0,b.UA)().getCurrent();i&&(i.annotations.list=[...i.annotations.list,...e],W==null&&(W=setTimeout(()=>{W=null,(0,Pe.jG)().refreshTimeModel()})))}const we=new ee.m(ve).setPanelChangeHandler(Fe).useFieldConfig((0,B.V)(B.S)).setPanelOptions(e=>{te.D(e,!1,!0),ie.H(e),e.addCustomEditor({id:"timezone",name:"Time zone",path:"timezone",category:["Axis"],editor:xe,defaultValue:void 0})}).setSuggestionsSupplier(new ge).setDataSupport({annotations:!0,alertStates:!0})}}]);

//# sourceMappingURL=timeseriesPanel.ac61c60b21097a7e8bf0.js.map