"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8232],{44927:(re,k,o)=>{o.d(k,{E:()=>e,z:()=>m});const m=()=>({type:"query",query:{params:["A","5m","now"]},reducer:{type:"avg",params:[]},evaluator:{type:"gt",params:[null]},operator:{type:"and"}}),e=async(w,B,A,K)=>{if(B.length===0)return"Could not find any metric queries";if(w&&w.length)return"Transformations are not supported in alert queries";let N=0,L=0;for(const V of B){const b=V.datasource||K,h=await A.get(b);h.meta.alerting?h.targetContainsTemplate&&h.targetContainsTemplate(V)&&L++:N++}return N===B.length?"The datasource does not support alerting queries":L===B.length?"Template variables are not supported in alert queries":""}},98695:(re,k,o)=>{o.r(k),o.d(k,{DashboardPage:()=>et,UnthemedDashboardPage:()=>_e,default:()=>Qs,mapStateToProps:()=>rn});var m=o(9892),e=o(68404),w=o(91134),B=o(47469),A=o(36635),K=o(70006),N=o(20112),L=o(24844),V=o(83383),b=o(68183),h=o(37932),f=o(35645),T=o(39904),y=o(72648),F=o(659),M=o(44407),he=o(79396),on=o(34177),$e=o(60499),ln=o(96694),cn=o(86245),ee=o(63755),tt=o(30992),Xs=o(63163);function qs(n){const t=n.match.params.slug??"",a=useAsync(()=>getGrafanaStorage().list("content/"+t),[t]),r=t.length>0?`g/${t}/`:"g/",s=nt(t),i=()=>a.value?a.value.fields[0].values.toArray().map(c=>{let p=c;const u=p.indexOf(".")<0,g=!u&&p.endsWith(".json"),E=`${r}${p}`;return React.createElement(Card,{key:p,href:u||g?E:void 0},React.createElement(Card.Heading,null,p),React.createElement(Card.Figure,null,React.createElement(Icon,{name:u?"folder":g?"gf-grid":"file-alt",size:"sm"})))}):a.loading?React.createElement(Spinner,null):React.createElement("div",null,"?"),l=at();return React.createElement(Page,{navModel:l,pageNav:s},!config.featureToggles.topnav&&React.createElement("div",null,React.createElement(Alert,{title:"Enable the topnav feature toggle"},"This page is designed assuming topnav is enabled")),i())}function nt(n){const t=n.split("/");let a=[],r="g",s;for(let i=0;i<t.length;i++)r+=`/${t[i]}`,a.push({text:t[i],url:r,parentItem:s}),s=a[a.length-1];return s}function at(){return{main:{text:"C:"},node:{text:"Content",url:"/g"}}}const _s=null;var dn=o(7832),z=o(81168),j=o(45984),rt=o(85803),un=o(92624),pn=o(30014),mn=o(31460),gn=o(77839),Y=o(82897),Ae=o(70356),st=o(5191),hn=o(18271),X=o(82002),fe=o(22350),fn=o(70197),te=o(35029),ve=o(46967),D=o(31403),vn=o(86648),En=o(74391),bn=o(2313);const ot=({panel:n,folderUid:t,isUnsavedPrompt:a,onDismiss:r,onConfirm:s,onDiscard:i})=>{const[l,d]=(0,e.useState)(""),c=(0,fe.Z)(async()=>{const C=await(0,vn.E8)(n.libraryPanel.uid);return C.length>0?C.map(O=>O.title):[]},[n.libraryPanel.uid]),[p,u]=(0,e.useState)([]);(0,fn.Z)(()=>c.value?u(c.value.filter(C=>C.toLowerCase().includes(l.toLowerCase()))):u([]),300,[c.value,l]);const{saveLibraryPanel:g}=(0,bn.E)(),E=(0,y.wW)(En.J),v=(0,e.useCallback)(()=>{i()},[i]),P=a?"Unsaved library panel changes":"Save library panel";return e.createElement(te.u,{title:P,icon:"save",onDismiss:r,isOpen:!0},e.createElement("div",null,e.createElement("p",{className:E.textInfo},"This update will affect ",e.createElement("strong",null,n.libraryPanel.meta?.connectedDashboards," ",n.libraryPanel.meta?.connectedDashboards===1?"dashboard":"dashboards","."),"The following dashboards using the panel will be affected:"),e.createElement(ve.I,{className:E.dashboardSearch,prefix:e.createElement(T.J,{name:"search"}),placeholder:"Search affected dashboards",value:l,onChange:C=>d(C.currentTarget.value)}),c.loading?e.createElement("p",null,"Loading connected dashboards..."):e.createElement("table",{className:E.myTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Dashboard name"))),e.createElement("tbody",null,p.map((C,O)=>e.createElement("tr",{key:`dashrow-${O}`},e.createElement("td",null,C))))),e.createElement(te.u.ButtonRow,null,e.createElement(D.zx,{variant:"secondary",onClick:r,fill:"outline"},"Cancel"),a&&e.createElement(D.zx,{variant:"destructive",onClick:v},"Discard"),e.createElement(D.zx,{onClick:()=>{g(n,t).then(()=>{s()})}},"Update all"))))};var yn=o(82302),Le=o(58379),Ee=o(32294),it=o(46732),Z=o(36281);function Pn(n,t){return async a=>{const r=t.initEditPanel(n);a((0,Z.Hl)({panel:r,sourcePanel:n}))}}function lt(){return async(n,t)=>{const{getPanel:a}=t().panelEditor;a().configRev=0,n((0,Z.yi)(!0))}}function Cn(n,t){return a=>{if(n.libraryPanel?.uid===void 0||!t)return;const r=n.getSaveModel();for(const s of t.panels){if(Sn(n,s))continue;s.restoreModel({...r,...(0,Y.pick)(s,"gridPos","id")});const i=s.plugin?.meta.id!==n.plugin?.meta.id;s.plugin=n.plugin,s.configRev++,i&&(s.generateNewKey(),a((0,it.bc)({key:s.key,plugin:s.plugin}))),setTimeout(()=>{s.getQueryRunner().useLastResultFrom(n.getQueryRunner())},20)}n.repeat&&setTimeout(()=>t.processRepeats(),20)}}function Sn(n,t){return!!(t.libraryPanel?.uid!==n.libraryPanel.uid||t.id&&t.id===n.id||t.repeatPanelId)}function Tn(){return async(n,t)=>{const a=t().dashboard.getModel(),{getPanel:r,getSourcePanel:s,shouldDiscardChanges:i}=t().panelEditor,l=r();if(a&&a.exitPanelEditor(),xn(l)&&!i){const d=l.getSaveModel(),c=s(),p=c.type!==l.type;n(Cn(l,a)),c.restoreModel(d),c.configRev++,p&&(c.plugin=l.plugin,c.generateNewKey(),await n((0,it.bc)({key:c.key,plugin:l.plugin}))),setTimeout(()=>{c.getQueryRunner().useLastResultFrom(l.getQueryRunner()),c.render(),l.hasSavedPanelEditChange&&!l.hasChanged&&(c.configRev=0)},20)}n((0,Ee.qj)(l.key)),n((0,Z.my)())}}function xn(n){return n.hasChanged||n.hasSavedPanelEditChange||n.isAngularPlugin()}function Fe(n){return(t,a)=>{const r={...a().panelEditor.ui,...n};t((0,Z.K9)(r));try{Le.Z.setObject(Z.jy,r)}catch(s){console.error(s)}}}var Dn=o(84135);const On=({dashboard:n,onSaveSuccess:t,onDiscard:a,onDismiss:r})=>e.createElement(te.u,{isOpen:!0,title:"Unsaved changes",onDismiss:r,icon:"exclamation-triangle",className:m.css`
        width: 500px;
      `},e.createElement("h5",null,"Do you want to save your changes?"),e.createElement(te.u.ButtonRow,null,e.createElement(D.zx,{variant:"secondary",onClick:r,fill:"outline"},"Cancel"),e.createElement(D.zx,{variant:"destructive",onClick:a},"Discard"),e.createElement(Dn.i,{dashboard:n,onSaveSuccess:t}))),ct=e.memo(({dashboard:n})=>{const[t,a]=(0,e.useState)({original:null}),r=(0,z.useDispatch)(),{original:s,originalPath:i}=t,{showModal:l,hideModal:d}=(0,e.useContext)(st.kr);(0,e.useEffect)(()=>{const p=setTimeout(()=>{const g=h.E1.getLocation().pathname,E=n.getSaveModelClone();a({originalPath:g,original:E})},1e3),u=hn.h.subscribe(j.Jd,()=>{const g=n.getSaveModelClone();a({originalPath:i,original:g})});return()=>{clearTimeout(p),u.unsubscribe()}},[n,i]),(0,e.useEffect)(()=>{const p=u=>{dt(n,s)||pt(n,s)&&(u.preventDefault(),u.returnValue="")};return window.addEventListener("beforeunload",p),()=>window.removeEventListener("beforeunload",p)},[n,s]);const c=p=>{const u=n.panelInEdit,g=new URLSearchParams(p.search);return u&&u.libraryPanel&&u.hasChanged&&!g.has("editPanel")?(l(ot,{isUnsavedPrompt:!0,panel:n.panelInEdit,folderUid:n.meta.folderUid??"",onConfirm:()=>{d(),be(p)},onDiscard:()=>{r(lt()),be(p),d()},onDismiss:d}),!1):i===p.pathname||!s?(u&&!g.has("editPanel")&&r(Tn()),!0):dt(n,s)||!pt(n,s)?!0:(l(On,{dashboard:n,onSaveSuccess:()=>{d(),be(p)},onDiscard:()=>{a({...t,original:null}),d(),be(p)},onDismiss:d}),!1)};return e.createElement(Ae.NL,{when:!0,message:c})});ct.displayName="DashboardPrompt";function be(n){n&&setTimeout(()=>h.E1.push(n),10)}function dt(n,t){if(!t||!X.Vt.isSignedIn||!n)return!0;const{canSave:a,fromScript:r,fromFile:s}=n.meta;return!X.Vt.isEditor&&!a?!0:!a||r||s}function ut(n){const t=new yn.f(n);t.expandRows();const a=t.getSaveModelClone();return a.time=0,a.refresh="",a.schemaVersion=0,a.timezone=0,a.panels=[],(0,Y.each)(a.getVariables(),r=>{r.current=null,r.options=null,r.filters=null}),a}function pt(n,t){if(n.hasUnsavedChanges())return!0;const a=ut(n.getSaveModelClone()),r=ut(t),s=(0,Y.find)(a.nav,{type:"timepicker"}),i=(0,Y.find)(r.nav,{type:"timepicker"});s&&i&&(s.now=i.now);const l=JSON.stringify(a,null),d=JSON.stringify(r,null);return l!==d}var wn=o(82557),U=o(39653),ye=o(73952),Pe=o(89050),mt=o(40400),Ce=o(26418),gt=o(30979),In=o(26338),ze=o(72142),se=o(79841),Rn=o(67487),q=o(45253),oe=o(24799),ht=o(53217),Ue=o(94599),Nn=o(9405),W=o(52081),ne=o(8944),Mn=o(3574),$n=o.n(Mn),An=o(38849),Ln=o(38535),ie=o(19349),Se=o(87464),ft=o(78197),le=(n=>(n[n.Support=0]="Support",n[n.Data=1]="Data",n))(le||{}),Te=(n=>(n[n.PanelSnapshot=0]="PanelSnapshot",n[n.GithubComment=1]="GithubComment",n))(Te||{});class Fn extends Ln.b{constructor(t){super({panel:t,panelTitle:t.replaceVariables(t.title,void 0,"text")||"Panel",currentTab:0,showMessage:1,snapshotText:"",markdownText:"",randomize:{},snapshotUpdate:0,options:[{label:"GitHub comment",description:"Copy and paste this message into a GitHub issue or comment",value:1},{label:"Panel support snapshot",description:"Dashboard JSON used to help troubleshoot visualization issues",value:0}]}),this.onCurrentTabChange=a=>{this.setState({currentTab:a})},this.onShowMessageChange=a=>{this.setState({showMessage:a.value})},this.onGetMarkdownForClipboard=()=>{const{markdownText:a}=this.state,r=Math.pow(1024,2)*1.5;return a.length>r?(this.setState({error:{title:"Copy to clipboard failed",message:"Snapshot is too large, consider download and attaching a file instead"}}),""):a},this.onDownloadDashboard=()=>{const{snapshotText:a,panelTitle:r}=this.state,s=new Blob([a],{type:"text/plain"}),i=`debug-${r}-${(0,An.dq)(new Date)}.json.txt`;$n()(s,i)},this.onSetSnapshotText=a=>{this.setState({snapshotText:a})},this.onToggleRandomize=a=>{const{randomize:r}=this.state;this.setState({randomize:{...r,[a]:!r[a]}})},this.onPreviewDashboard=()=>{const{snapshot:a}=this.state;a&&((0,Se.$M)({meta:{},dashboard:a}),o.g.open(f.v.appUrl+"dashboard/new","_blank"))}}async buildDebugDashboard(){const{panel:t,randomize:a,snapshotUpdate:r,iframeLoading:s,currentTab:i}=this.state,l=await(0,ft.$R)(t,a,(0,ie.$t)().timeRange()),d=JSON.stringify(l,null,2),c=(0,ft.S$)(t,d),p=(0,N.zc)((0,N.Cf)("bytes")(d?.length??0));s&&i===0&&(0,Se.$M)({meta:{},dashboard:l}),this.setState({snapshot:l,snapshotText:d,markdownText:c,snapshotSize:p,snapshotUpdate:r+1})}subscribeToIframeLoadingMessage(){const t=a=>{a.data==="GrafanaAppInit"&&((0,Se.$M)({meta:{},dashboard:this.state.snapshot}),this.setState({iframeLoading:!0}))};return window.addEventListener("message",t,!1),function(){window.removeEventListener("message",t)}}}function zn({panel:n,plugin:t,onClose:a}){const r=(0,y.wW)(Un),s=(0,e.useMemo)(()=>new Fn(n),[n]),{currentTab:i,loading:l,error:d,iframeLoading:c,options:p,showMessage:u,snapshotSize:g,markdownText:E,snapshotText:v,randomize:P,panelTitle:C,snapshotUpdate:O}=s.useState();if((0,e.useEffect)(()=>{s.buildDebugDashboard()},[s,t,P]),(0,e.useEffect)(()=>s.subscribeToIframeLoadingMessage(),[s]),!t)return null;const $=[{label:"Snapshot",value:le.Support},{label:"Data",value:le.Data}],S=f.v.supportBundlesEnabled&&X.Vt.hasAccess(z.AccessControlAction.ActionSupportBundlesCreate,X.Vt.isGrafanaAdmin);return e.createElement(gt.d,{title:"Get help with this panel",width:"90%",onClose:a,expandable:!0,scrollableContent:!0,subtitle:e.createElement(Ce.Stack,{direction:"column",gap:1},e.createElement(Ce.Stack,{direction:"row",gap:1},e.createElement(In.a,{featureState:mt.CQ.beta}),e.createElement("a",{href:"https://grafana.com/docs/grafana/latest/troubleshooting/",target:"blank",className:"external-link",rel:"noopener noreferrer"},"Troubleshooting docs ",e.createElement(T.J,{name:"external-link-alt"}))),e.createElement("span",{className:"muted"},"To request troubleshooting help, send a snapshot of this panel to Grafana Labs Technical Support. The snapshot contains query response data and panel settings."),S&&e.createElement("span",{className:"muted"},"You can also retrieve a support bundle containing information concerning your Grafana instance and configured datasources in the ",e.createElement("a",{href:"/support-bundles"},"support bundles section"),".")),tabs:e.createElement(ze.J,null,$.map((x,R)=>e.createElement(se.O,{key:`${x.value}-${R}`,label:x.label,active:x.value===i,onChangeTab:()=>s.onCurrentTabChange(x.value)})))},l&&e.createElement(Rn.$,null),d&&e.createElement(q.b,{title:d.title},d.message),i===le.Data&&e.createElement("div",{className:r.code},e.createElement("div",{className:r.opts},e.createElement(oe.g,{label:"Template",className:r.field},e.createElement(ht.Ph,{options:p,value:u,onChange:s.onShowMessageChange})),u===Te.GithubComment?e.createElement(Ue.m,{icon:"copy",getText:s.onGetMarkdownForClipboard},"Copy to clipboard"):e.createElement(D.zx,{icon:"download-alt",onClick:s.onDownloadDashboard},"Download (",g,")")),e.createElement(Pe.Z,{disableWidth:!0},({height:x})=>e.createElement(Nn.p,{width:"100%",height:x,language:u===Te.GithubComment?"markdown":"json",showLineNumbers:!0,showMiniMap:!0,value:u===Te.GithubComment?E:v,readOnly:!1,onBlur:s.onSetSnapshotText}))),i===le.Support&&e.createElement(e.Fragment,null,e.createElement(oe.g,{label:"Randomize data",description:"Modify the original data to hide sensitve information.  Note the lengths will stay the same, and duplicate values will be equal."},e.createElement(W.Lh,null,e.createElement(ne.x,{label:"Labels",id:"randomize-labels",showLabel:!0,value:Boolean(P.labels),onChange:()=>s.onToggleRandomize("labels")}),e.createElement(ne.x,{label:"Field names",id:"randomize-field-names",showLabel:!0,value:Boolean(P.names),onChange:()=>s.onToggleRandomize("names")}),e.createElement(ne.x,{label:"String values",id:"randomize-string-values",showLabel:!0,value:Boolean(P.values),onChange:()=>s.onToggleRandomize("values")}))),e.createElement(oe.g,{label:"Support snapshot",description:`Panel: ${C}`},e.createElement(Ce.Stack,null,e.createElement(D.zx,{icon:"download-alt",onClick:s.onDownloadDashboard},"Dashboard (",g,")"),e.createElement(Ue.m,{icon:"github",getText:s.onGetMarkdownForClipboard,title:"Copy a complete GitHub comment to the clipboard"},"Copy to clipboard"),e.createElement(D.zx,{onClick:s.onPreviewDashboard,variant:"secondary",title:"Open support snapshot dashboard in a new tab"},"Preview"))),e.createElement(Pe.Z,{disableWidth:!0},({height:x})=>e.createElement(e.Fragment,null,e.createElement("iframe",{title:"Support snapshot preview",src:`${f.v.appUrl}dashboard/new?orgId=${X.Vt.user.orgId}&kiosk&${O}`,width:"100%",height:x-100,frameBorder:"0",style:{display:c?"block":"none",marginTop:16}}),!c&&e.createElement("div",null,"\xA0")))))}const Un=n=>({code:m.css`
    flex-grow: 1;
    height: 100%;
    overflow: scroll;
  `,field:m.css`
    width: 100%;
  `,opts:m.css`
    display: flex;
    display: flex;
    width: 100%;
    flex-grow: 0;
    align-items: center;
    justify-content: flex-end;

    button {
      margin-left: 8px;
    }
  `});var Bn=o(49922);const Be=(n,t,a)=>{const r=(0,e.useRef)(),[s,i]=(0,e.useState)();return(0,e.useEffect)(()=>{let l=-1,d=0;return r.current=n.getQueryRunner().getData(t).subscribe({next:c=>{if(a){if(l===c.structureRev){const p=Date.now();if(p-d<1e4)return;d=p}l=c.structureRev??-1}i(c)}}),()=>{r.current&&r.current.unsubscribe()}},[n,t.withFieldConfig,t.withTransforms]),{data:s,error:s&&s.error,isLoading:s?s.state===Bn.Gu.Loading:!0,hasSeries:s?!!s.series:!1}};var Vn=o(20308),J=o(35287),Wn=o(21957),kn=o(46835),Hn=o(18893);const Kn=({data:n,metadataDatasource:t})=>!t||!t.components?.MetadataInspector?e.createElement(J.cC,{i18nKey:"dashboard.inspect-meta.no-inspector"},"No Metadata Inspector"):e.createElement(t.components.MetadataInspector,{datasource:t,data:n.series});var Gn=o(82090),jn=o(72062);const Zn=({panel:n,plugin:t,dashboard:a,tabs:r,data:s,isDataLoading:i,dataOptions:l,metadataDatasource:d,defaultTab:c,onDataOptionsChange:p,onClose:u})=>{const[g,E]=(0,e.useState)(c??U.q.Data);if(!t)return null;let v=s?.errors;!v?.length&&s?.error&&(v=[s.error]);let P=g;r.find($=>$.value===g)||(P=U.q.JSON);const C=(0,Vn.J)().replace(n.title,n.scopedVars,"text")||"Panel",O=(0,J.t)("dashboard.inspect.title","Inspect: {{panelTitle}}",{panelTitle:C});return e.createElement(gt.d,{title:O,subtitle:s&&Jn(s),width:"50%",onClose:u,expandable:!0,scrollableContent:!0,tabs:e.createElement(ze.J,null,r.map(($,S)=>e.createElement(se.O,{key:`${$.value}-${S}`,label:$.label,active:$.value===P,onChangeTab:()=>E($.value||U.q.Data)})))},P===U.q.Data&&e.createElement(Wn.E,{panel:n,data:s&&s.series,isLoading:i,options:l,onOptionsChange:p,timeZone:a.timezone,app:mt.zj.Dashboard}),s&&P===U.q.Meta&&e.createElement(Kn,{data:s,metadataDatasource:d}),P===U.q.JSON&&e.createElement(Hn.W,{panel:n,dashboard:a,data:s,onClose:u}),P===U.q.Error&&e.createElement(kn.l,{errors:v}),s&&P===U.q.Stats&&e.createElement(Gn.f,{data:s,timeZone:a.getTimezone()}),s&&P===U.q.Query&&e.createElement(jn.D,{panel:n,data:s.series,onRefreshQuery:()=>n.refresh()}))};function Jn(n){const{request:t}=n;if(!t)return"";const a=t.targets.length,r=t.endTime?t.endTime-t.startTime:0,s=(0,N.zc)((0,N.Cf)("ms")(r));return e.createElement(J.cC,{i18nKey:"dashboard.inspect.subtitle"},{queryCount:a}," queries with total query time of ",{formatted:s})}var Qn=o(50700),vt=o(86647),Ve=o(13505);const Yn=n=>(0,Qn.Z)(async()=>{const a=n?.request?.targets||[];if(n&&n.series&&a.length){for(const r of n.series)if(r.meta&&r.meta.custom){const s=await(0,vt.F)().get(a[0].datasource);if(s&&s.components?.MetadataInspector)return s}}},[n]).value,Xn=(n,t,a,r,s)=>(0,e.useMemo)(()=>{const i=[];return(0,Ve.sY)(a)&&(i.push({label:(0,J.t)("dashboard.inspect.data-tab","Data"),value:U.q.Data}),i.push({label:(0,J.t)("dashboard.inspect.stats-tab","Stats"),value:U.q.Stats})),s&&i.push({label:(0,J.t)("dashboard.inspect.meta-tab","Meta Data"),value:U.q.Meta}),i.push({label:(0,J.t)("dashboard.inspect.json-tab","JSON"),value:U.q.JSON}),r&&r.message&&i.push({label:(0,J.t)("dashboard.inspect.error-tab","Error"),value:U.q.Error}),t.meta.canEdit&&(0,Ve.sY)(a)&&i.push({label:(0,J.t)("dashboard.inspect.query-tab","Query"),value:U.q.Query}),i},[a,s,t,r]),qn=({panel:n,dashboard:t,plugin:a})=>{const[r,s]=(0,e.useState)({withTransforms:!1,withFieldConfig:!0}),i=(0,Ae.TH)(),{data:l,isLoading:d,error:c}=Be(n,r,!0),p=Yn(l),u=Xn(n,t,a,c,p),g=new URLSearchParams(i.search).get("inspectTab"),E=()=>{h.E1.partial({inspect:null,inspectTab:null})};return a?g===U.q.Help?e.createElement(zn,{panel:n,plugin:a,onClose:E}):e.createElement(Zn,{dashboard:t,panel:n,plugin:a,defaultTab:g,tabs:u,data:l,isDataLoading:d,dataOptions:r,onDataOptionsChange:s,metadataDatasource:p,onClose:E}):null},_n=(n,t)=>{const a=(0,ye.i)(n,t.panel);return a?{plugin:a.plugin}:{plugin:null}},ea=(0,A.connect)(_n)(qn);var Et=o(53376),xe=o(2594),De=o(64319),ta=o(8125),na=o(35224),aa=o(7804),ra=o(95379),bt=o(80177),sa=o(77582),ce=o(6554),oa=o(22323),ia=o(82253),We=o(10672);const la=n=>{const t=(0,e.useMemo)(()=>oa.z.get(n.variable.type).picker,[n.variable]);return n.variable?e.createElement("div",{className:"gf-form"},e.createElement(ca,{variable:n.variable}),n.variable.hide!==We.bU.hideVariable&&t&&e.createElement(t,{variable:n.variable,readOnly:n.readOnly??!1})):e.createElement("div",null,"Couldn't load variable")};function ca({variable:n}){const t=(0,e.useMemo)(()=>n.label||n.name,[n]);if(n.hide!==We.bU.dontHide)return null;const a=ia.IG+n.id;return n.description?e.createElement(ce.u,{content:n.description,placement:"bottom"},e.createElement("label",{className:"gf-form-label gf-form-label--variable","data-testid":b.wl.pages.Dashboard.SubMenu.submenuItemLabels(t),htmlFor:a},t)):e.createElement("label",{className:"gf-form-label gf-form-label--variable","data-testid":b.wl.pages.Dashboard.SubMenu.submenuItemLabels(t),htmlFor:a},t)}const yt=({variables:n,readOnly:t})=>{const[a,r]=(0,e.useState)([]);return(0,e.useEffect)(()=>{r(n.filter(s=>s.hide!==We.bU.hideVariable))},[n]),a.length===0?null:e.createElement(e.Fragment,null,a.map(s=>e.createElement("div",{key:s.id,className:"submenu-item gf-form-inline","data-testid":b.wl.pages.Dashboard.SubMenu.submenuItem},e.createElement(la,{variable:s,readOnly:t}))))};var da=o(54294),ua=o(81283),de=o(6297),ke=o(87095),pa=o(61802),ma=o(37877),ga=o(63205),Pt=o(14747),ue=o(68226),Ct=o(11484);function ha(n,t){Le.Z.set(`panel-edit-section-${n}`,t?"true":"false")}function fa(n,t){return Le.Z.getBool(`panel-edit-section-${n}`,t)}const St=(n,t)=>({angularPanelComponent:(0,ye.i)(n,t.panel)?.angularComponent}),Tt={changePanelPlugin:Ee.Kc},eo=(0,A.connect)(St,Tt);class va extends e.PureComponent{constructor(t){super(t)}componentDidMount(){this.loadAngularOptions()}componentDidUpdate(t){(this.props.plugin!==t.plugin||this.props.angularPanelComponent!==t.angularPanelComponent)&&this.cleanUpAngularOptions(),this.loadAngularOptions()}componentWillUnmount(){this.cleanUpAngularOptions()}cleanUpAngularOptions(){this.angularOptions&&(this.angularOptions.destroy(),this.angularOptions=null)}loadAngularOptions(){const{panel:t,angularPanelComponent:a,changePanelPlugin:r}=this.props;if(!this.element||!a||this.angularOptions)return;const s=a.getScope();if(!s.$$childHead){setTimeout(()=>{this.forceUpdate()});return}const i=s.$$childHead.ctrl;i.initEditMode(),i.onPluginTypeChange=p=>{r({panel:t,pluginId:p.id})};let l="";for(let p=0;p<i.editorTabs.length;p++){const u=i.editorTabs[p];u.isOpen=fa(u.title,p===0),l+=`
      <div class="panel-options-group" ng-cloak>
        <div class="panel-options-group__header" ng-click="toggleOptionGroup(${p})" aria-label="${u.title} section">
          <div class="panel-options-group__icon">
            <icon name="ctrl.editorTabs[${p}].isOpen ? 'angle-down' : 'angle-right'"></icon>
          </div>
          <div class="panel-options-group__title">${u.title}</div>
        </div>
        <div class="panel-options-group__body" ng-if="ctrl.editorTabs[${p}].isOpen">
          <panel-editor-tab editor-tab="ctrl.editorTabs[${p}]" ctrl="ctrl"></panel-editor-tab>
        </div>
      </div>
      `}const d=(0,Ct.w)(),c={ctrl:i,toggleOptionGroup:p=>{const u=i.editorTabs[p];u.isOpen=!u.isOpen,ha(u.title,Boolean(u.isOpen))}};this.angularOptions=d.load(this.element,c,l),this.angularOptions.digest()}render(){return e.createElement("div",{ref:t=>this.element=t})}}const Ea=(0,A.connect)(St,Tt)(va);var He=o(91183),xt=o(3249),Oe=o(68061),Dt=o(37676),Ot=o(15670),we=o(64703),ba=o(14677),ya=o.n(ba),Pa=o(64353),Ca=o(51275),Ie=o(8180);const Sa=({property:n,context:t,registry:a,onChange:r,onRemove:s,isSystemOverride:i,searchQuery:l})=>{const d=(0,y.wW)(Ta),c=a?.getIfExists(n.id);if(!c)return null;const p=Array.isArray(n.value)||n.id===Oe.qb.Thresholds||n.id===Oe.qb.Links||n.id===Oe.qb.Mappings,u=c.category?.filter(v=>v!==c.name);let g;const E=(v=!0,P=!1)=>(C=!1)=>e.createElement(W.Lh,{justify:"space-between"},e.createElement(Pa._,{category:u,description:v?c.description:void 0},e.createElement(ya(),{textToHighlight:c.name,searchWords:[l],highlightClassName:"search-fragment-highlight"}),!C&&P&&c.getItemsCount&&e.createElement(Ca.A,{value:c.getItemsCount(n.value)})),!i&&e.createElement("div",null,e.createElement(Ie.h,{name:"times",onClick:s})));return p?g=e.createElement(He.u,{id:c.name,renderTitle:E(!1,!0),className:m.css`
          padding-left: 0;
          padding-right: 0;
        `,isNested:!0,isOpenDefault:n.value!==void 0},e.createElement(c.override,{value:n.value,onChange:v=>{r(v)},item:c,context:t})):g=e.createElement("div",null,e.createElement(oe.g,{label:E()(),description:c.description},e.createElement(c.override,{value:n.value,onChange:v=>{r(v)},item:c,context:t}))),e.createElement("div",{className:(0,m.cx)(p&&d.collapsibleOverrideEditor,!p&&"dynamicConfigValueEditor--nonCollapsible")},g)},Ta=n=>({collapsibleOverrideEditor:m.css`
      label: collapsibleOverrideEditor;
      & + .dynamicConfigValueEditor--nonCollapsible {
        margin-top: ${n.spacing(1)};
      }
    `});var _=o(91752),H=o(66352);const wt=({isExpanded:n,registry:t,matcherUi:a,overrideName:r,override:s,onOverrideRemove:i})=>{const l=(0,y.wW)(xa),c=s.properties.map(u=>t.getIfExists(u.id)).filter(u=>!!u).map(u=>u?.name).join(", "),p=a.optionsToLabel(s.matcher.options);return e.createElement("div",null,e.createElement(W.Lh,{justify:"space-between"},e.createElement("div",null,r),e.createElement(Ie.h,{name:"trash-alt",onClick:i,title:"Remove override"})),!n&&e.createElement("div",{className:l.overrideDetails},e.createElement("div",{className:l.options,title:p},p," ",e.createElement(T.J,{name:"angle-right"})," ",c)))};wt.displayName="OverrideTitle";const xa=n=>({matcherUi:m.css`
      padding: ${n.spacing(1)};
    `,propertyPickerWrapper:m.css`
      margin-top: ${n.spacing(2)};
    `,overrideDetails:m.css`
      font-size: ${n.typography.bodySmall.fontSize};
      color: ${n.colors.text.secondary};
      font-weight: ${n.typography.fontWeightRegular};
    `,options:m.css`
      overflow: hidden;
      padding-right: ${n.spacing(4)};
    `,unknownLabel:m.css`
      margin-bottom: 0;
    `});function Da(n,t){const a=[],r=n.panel.fieldConfig,s=n.plugin.fieldConfigRegistry,i=n.data?.series??[];if(s.isEmpty())return[];const l=(u,g)=>{let E=(0,Y.cloneDeep)(r.overrides);E[u]=g,n.onFieldConfigsChange({...r,overrides:E})},d=u=>{let g=(0,Y.cloneDeep)(r.overrides);g.splice(u,1),n.onFieldConfigsChange({...r,overrides:g})},c=u=>{const g=xt.Ls.get(u.value);g&&n.onFieldConfigsChange({...r,overrides:[...r.overrides,{matcher:{id:g.id,options:g.defaultOptions},properties:[]}]})},p={data:i,getSuggestions:u=>(0,we.PW)(i,u),isOverride:!0};for(let u=0;u<r.overrides.length;u++){const g=r.overrides[u],E=`Override ${u+1}`,v=Dt.i.get(g.matcher.id),P=Oa(s),C=(0,Oe.v3)(g),O=g.properties.length===0?1:0,$=new _.j({title:E,id:E,forceOpen:O,renderTitle:function(G){return e.createElement(wt,{override:g,isExpanded:G,registry:s,overrideName:E,matcherUi:v,onOverrideRemove:()=>d(u)})}}),S=R=>{g.matcher.options=R,l(u,g)},x=(R,G)=>{const ge=s.get(G.value),Me={id:ge.id,value:ge.defaultValue};g.properties?R.properties.push(Me):R.properties=[Me],l(u,R)};$.addItem(new H.a({title:v.name,render:function(){return e.createElement(v.component,{id:`${v.matcher.id}-${u}`,matcher:v.matcher,data:n.data?.series??[],options:g.matcher.options,onChange:S})}}));for(let R=0;R<g.properties.length;R++){const G=g.properties[R],ge=s.getIfExists(G.id);if(!ge)continue;const Me=sn=>{g.properties[R].value=sn,l(u,g)},Ys=()=>{g.properties.splice(R,1),l(u,g)};$.addItem(new H.a({title:ge.name,skipField:!0,render:function(){return e.createElement(Sa,{key:`${G.id}/${R}`,isSystemOverride:C,onChange:Me,onRemove:Ys,property:G,registry:s,context:p,searchQuery:t})}}))}!C&&g.matcher.options&&$.addItem(new H.a({title:"----------",skipField:!0,render:function(){return e.createElement(Ot.b,{key:"Add override property",label:"Add override property",variant:"secondary",isFullWidth:!0,icon:"plus",menuPlacement:"auto",options:P,onChange:G=>x(g,G)})}})),a.push($)}return a.push(new _.j({title:"add button",id:"add button",customRender:function(){return e.createElement(wa,{key:"Add override"},e.createElement(Ot.b,{icon:"plus",label:"Add field override",variant:"secondary",menuPlacement:"auto",isFullWidth:!0,size:"md",options:Dt.i.list().filter(g=>!g.excludeFromPicker).map(g=>({label:g.name,value:g.id,description:g.description})),onChange:g=>c(g)}))}})),a}function Oa(n){return n.list().filter(t=>!t.hideFromOverrides).map(t=>{let a=t.name;return t.category&&(a=[...t.category,t.name].join(" > ")),{label:a,value:t.id,description:t.description}})}function wa({children:n}){const t=(0,y.wW)(Ia);return e.createElement("div",{className:t},n)}function Ia(n){return(0,m.css)({borderTop:`1px solid ${n.colors.border.weak}`,padding:`${n.spacing(2)}`,display:"flex"})}const Ra=({panel:n,formatDate:t})=>{const a=(0,y.wW)(Na),r=n.libraryPanel?.meta;return r?e.createElement("div",{className:a.info},e.createElement("div",{className:a.libraryPanelInfo},`Used on ${r.connectedDashboards} `,r.connectedDashboards===1?"dashboard":"dashboards"),e.createElement("div",{className:a.libraryPanelInfo},"Last edited on ",t?.(r.updated,"L")??r.updated," by",r.updatedBy.avatarUrl&&e.createElement("img",{width:"22",height:"22",className:a.userAvatar,src:r.updatedBy.avatarUrl,alt:`Avatar for ${r.updatedBy.name}`}),r.updatedBy.name)):null},Na=n=>({info:m.css`
      line-height: 1;
    `,libraryPanelInfo:m.css`
      color: ${n.colors.text.secondary};
      font-size: ${n.typography.bodySmall.fontSize};
    `,userAvatar:m.css`
      border-radius: 50%;
      box-sizing: content-box;
      width: 22px;
      height: 22px;
      padding-left: ${n.spacing(1)};
      padding-right: ${n.spacing(1)};
    `});function Ma(n){const{panel:t,onPanelConfigChange:a,dashboard:r}=n,s=new _.j({title:"Library panel options",id:"Library panel options",isOpenDefault:!0});return(0,de.V)(t)&&s.addItem(new H.a({title:"Name",value:t.libraryPanel.name,popularRank:1,render:function(){return e.createElement(ve.I,{id:"LibraryPanelFrameName",defaultValue:t.libraryPanel.name,onBlur:l=>a("libraryPanel",{...t.libraryPanel,name:l.currentTarget.value})})}})).addItem(new H.a({title:"Information",render:function(){return e.createElement(Ra,{panel:t,formatDate:r.formatDate})}})),s}var $a=o(97379),Aa=o(68037),La=o(21599);function Fa(n){const{panel:t,onPanelConfigChange:a}=n;return new _.j({title:"Panel options",id:"Panel options",isOpenDefault:!0}).addItem(new H.a({title:"Title",value:t.title,popularRank:1,render:function(){return e.createElement(ve.I,{id:"PanelFrameTitle",defaultValue:t.title,onBlur:i=>a("title",i.currentTarget.value)})}})).addItem(new H.a({title:"Description",description:t.description,value:t.description,render:function(){return e.createElement($a.K,{id:"description-text-area",defaultValue:t.description,onBlur:i=>a("description",i.currentTarget.value)})}})).addItem(new H.a({title:"Transparent background",render:function(){return e.createElement(ne.r,{value:t.transparent,id:"transparent-background",onChange:i=>a("transparent",i.currentTarget.checked)})}})).addCategory(new _.j({title:"Panel links",id:"Panel links",isOpenDefault:!1,itemsCount:t.links?.length}).addItem(new H.a({title:"Panel links",render:function(){return e.createElement(Aa.d,{links:t.links,onChange:i=>a("links",i),getSuggestions:we.PR,data:[]})}}))).addCategory(new _.j({title:"Repeat options",id:"Repeat options",isOpenDefault:!1}).addItem(new H.a({title:"Repeat by variable",description:"Repeat this panel for each value in the selected variable. This is not visible while in edit mode. You need to go back to dashboard and then update the variable or reload the dashboard.",render:function(){return e.createElement(La.X,{id:"repeat-by-variable-select",repeat:t.repeat,onChange:i=>{a("repeat",i)}})}})).addItem(new H.a({title:"Repeat direction",showIf:()=>!!t.repeat,render:function(){const i=[{label:"Horizontal",value:"h"},{label:"Vertical",value:"v"}];return e.createElement(xe.S,{options:i,value:t.repeatDirection||"h",onChange:l=>a("repeatDirection",l)})}})).addItem(new H.a({title:"Max per row",showIf:()=>Boolean(t.repeat&&t.repeatDirection==="h"),render:function(){const i=[2,3,4,6,8,12].map(l=>({label:l.toString(),value:l}));return e.createElement(ht.Ph,{options:i,value:t.maxPerRow,onChange:l=>a("maxPerRow",l.value)})}})))}var za=o(57054);class Ua{constructor(t,a){this.categories=t,this.overrides=a}search(t){const a=new RegExp(t,"i"),s=this.collectHits(this.categories,a,[]).sort(It).map(d=>d.item),l=this.collectHits(this.overrides,a,[]).sort(It).map(d=>d.item);return{optionHits:s,overrideHits:this.buildOverrideHitCategories(l),totalCount:this.getAllOptionsCount(this.categories)}}collectHits(t,a,r){for(const s of t){const i=a.test(s.props.title);for(const l of s.items){if(a.test(l.props.title)){r.push({item:l,rank:1});continue}if(l.props.description&&a.test(l.props.description)){r.push({item:l,rank:2});continue}i&&r.push({item:l,rank:3})}s.categories.length>0&&this.collectHits(s.categories,a,r)}return r}getAllOptionsCount(t){let a=0;for(const r of t)a+=r.items.length,r.categories.length>0&&(a+=this.getAllOptionsCount(r.categories));return a}buildOverrideHitCategories(t){const a={};for(const r of t){let s=a[r.parent.props.title];s||(s=a[r.parent.props.title]=new _.j(r.parent.props),s.addItem(r.parent.items[0])),s.items[0].props.title!==r.props.title&&s.addItem(r)}return Object.values(a)}}function It(n,t){return n.rank-t.rank}function Ba(n){const t=[];for(const a of n)for(const r of a.items)r.props.title==="Unit"&&(r.props.popularRank=2),r.props.title==="Min"&&(r.props.popularRank=3),r.props.title==="Max"&&(r.props.popularRank=4),r.props.title==="Display name"&&(r.props.popularRank=5),r.props.popularRank&&t.push(r);return t.sort((a,r)=>a.props.popularRank-r.props.popularRank)}const Va=n=>{const{plugin:t,dashboard:a,panel:r}=n,[s,i]=(0,e.useState)(""),[l,d]=(0,e.useState)(Q.All),c=(0,y.wW)(Ha),[p,u,g]=(0,e.useMemo)(()=>[Fa(n),(0,za.AL)(n),Ma(n)],[r.configRev,n.data,n.instanceState,s]),E=(0,e.useMemo)(()=>Da(n,s),[r.configRev,n.data,n.instanceState,s]),v=[],P=s.length>0,C=(0,e.useMemo)(Wa,[]),O=(0,de.V)(r)?[g,p,...u]:[p,...u];if(P)v.push(ka(O,E,s)),n.plugin.angularPanelCtrl&&v.push(e.createElement("div",{className:c.searchNotice,key:"Search notice"},"This is an old visualization type that does not support searching all options."));else switch(l){case Q.All:(0,de.V)(r)&&v.push(g.render()),v.push(p.render()),n.plugin.angularPanelCtrl&&v.push(e.createElement(Ea,{plugin:t,dashboard:a,panel:r,key:"AngularOptions"}));for(const S of u)v.push(S.render());for(const S of E)v.push(S.render());break;case Q.Overrides:for(const S of E)v.push(S.render());break;case Q.Recent:v.push(e.createElement(He.u,{id:"Recent options",title:"Recent options",key:"Recent options",forceOpen:1},Ba(O).map(S=>S.render())));break}const $=!P&&!t.fieldConfigRegistry.isEmpty();return e.createElement("div",{className:c.wrapper},e.createElement("div",{className:c.formBox},e.createElement("div",{className:c.formRow},e.createElement(Pt.H,{width:0,value:s,onChange:i,placeholder:"Search options"})),$&&e.createElement("div",{className:c.formRow},e.createElement(xe.S,{options:C,value:l,fullWidth:!0,onChange:d}))),e.createElement("div",{className:c.scrollWrapper},e.createElement(ue.$,{autoHeightMin:"100%"},e.createElement("div",{className:c.mainBox},v))))};function Wa(){return[{label:Q.All,value:Q.All},{label:Q.Overrides,value:Q.Overrides}]}var Q=(n=>(n.All="All",n.Overrides="Overrides",n.Recent="Recent",n))(Q||{});function ka(n,t,a){const r=new Ua(n,t),{optionHits:s,totalCount:i,overrideHits:l}=r.search(a);return e.createElement("div",{key:"search results"},e.createElement(He.u,{id:"Found options",title:`Matched ${s.length}/${i} options`,key:"Normal options",forceOpen:1},s.map(d=>d.render(a))),l.map(d=>d.render(a)))}const Ha=n=>({wrapper:m.css`
    height: 100%;
    display: flex;
    flex-direction: column;
    flex: 1 1 0;

    .search-fragment-highlight {
      color: ${n.colors.warning.text};
      background: transparent;
    }
  `,searchBox:m.css`
    display: flex;
    flex-direction: column;
    min-height: 0;
  `,formRow:m.css`
    margin-bottom: ${n.spacing(1)};
  `,formBox:m.css`
    padding: ${n.spacing(1)};
    background: ${n.colors.background.primary};
    border: 1px solid ${n.components.panel.borderColor};
    border-top-left-radius: ${n.shape.borderRadius(1.5)};
    border-bottom: none;
  `,closeButton:m.css`
    margin-left: ${n.spacing(1)};
  `,searchHits:m.css`
    padding: ${n.spacing(1,1,0,1)};
  `,scrollWrapper:m.css`
    flex-grow: 1;
    min-height: 0;
  `,searchNotice:m.css`
    font-size: ${n.typography.size.sm};
    color: ${n.colors.text.secondary};
    padding: ${n.spacing(1)};
    text-align: center;
  `,mainBox:m.css`
    background: ${n.colors.background.primary};
    border: 1px solid ${n.components.panel.borderColor};
    border-top: none;
    flex-grow: 1;
  `});var Ka=o(26202),Ga=o(35974);const Rt=n=>t=>t.plugins.panels[n]||(0,Ga.X)(`Panel plugin not found (${n})`,!0),Ke=({panel:n})=>{const t=(0,z.useDispatch)(),a=(0,z.useSelector)(Rt(n.type)),r=(0,z.useSelector)(d=>d.panelEditor.ui.isPanelOptionsVisible),s=(0,z.useSelector)(d=>d.panelEditor.isVizPickerOpen),i=()=>{t((0,Z.g_)(!s))},l=()=>{t(Fe({isPanelOptionsVisible:!r}))};return a?e.createElement("div",{className:Nt.wrapper},e.createElement(Ka.h,null,e.createElement(De.h,{className:Nt.vizButton,tooltip:"Click to change visualization",imgSrc:a.meta.info.logos.small,isOpen:s,onClick:i,"aria-label":b.wl.components.PanelEditor.toggleVizPicker,variant:"canvas",fullWidth:!0},a.meta.name),e.createElement(De.h,{tooltip:r?"Close options pane":"Show options pane",icon:r?"angle-right":"angle-left",onClick:l,variant:"canvas","aria-label":b.wl.components.PanelEditor.toggleVizOptions}))):null};Ke.displayName="VisualizationTab";const Nt={wrapper:m.css`
    display: flex;
    flex-direction: column;
  `,vizButton:m.css`
    text-align: left;
  `};var ja=o(24664),Za=o(84952),Ja=o(9398),Qa=o(53708),Ya=o(76647),Mt=o(98102);const Xa=({onConfirm:n,onDismiss:t,panel:a})=>{const r=(0,de.V)(a),s=`${r?"Changing":"Replace with"} library panel`,i=`${r?"Changing":"Replacing with a"} library panel will remove any changes since last save.`;return e.createElement(Mt.s,{onConfirm:n,onDismiss:t,confirmText:r?"Change":"Replace",title:s,body:i,dismissText:"Cancel",isOpen:!0})};var qa=o(18027);const _a=({panel:n,searchQuery:t})=>{const[a,r]=(0,e.useState)(!1),[s,i]=(0,e.useState)(void 0),[l,d]=(0,e.useState)([]),c=(0,e.useCallback)(P=>{d(P.map(C=>C.id))},[d]),p=(0,Ja.h4)().getCurrent(),u=(0,z.useDispatch)(),g=async()=>{s&&(i(void 0),u((0,Ee.ih)(n,s)))},E=()=>r(!0),v=()=>i(void 0);return e.createElement(W.wc,{spacing:"md"},!n.libraryPanel&&e.createElement(W.wc,{align:"center"},e.createElement(D.zx,{icon:"plus",onClick:E,variant:"secondary",fullWidth:!0},"Create new library panel")),e.createElement(Qa.j,{onChange:c}),e.createElement("div",{className:er.libraryPanelsView},e.createElement(qa.u,{currentPanelId:n.libraryPanel?.uid,searchString:t,panelFilter:l,onClickCard:i,showSecondaryActions:!0})),a&&e.createElement(Ya.c,{panel:n,onDismiss:()=>r(!1),initialFolderUid:p?.meta.folderUid,isOpen:a}),s&&e.createElement(Xa,{panel:n,onDismiss:v,onConfirm:g}))},er={libraryPanelsView:m.css`
    width: 100%;
  `};var Ge=o(20251),tr=o(38490);const nr=["timeseries","barchart","gauge","stat","piechart","bargauge","table","state-timeline","status-history","logs","candlestick"];async function ar(n,t){const a=new Ge.mi(n,t);for(const s of nr){const l=(await(0,tr.Ub)(s)).getSuggestionsSupplier();l&&l.getSuggestionsForData(a)}const r=a.getList();if(a.dataSummary.fieldCount===0)for(const s of Object.values(f.v.panels))!s.skipDataQuery||s.hideFromList||r.push({name:s.name,pluginId:s.id,description:s.info.description,cardOptions:{imgSrc:s.info.logos.small}});return r.sort((s,i)=>(i.score??Ge._.OK)-(s.score??Ge._.OK))}var $t=o(98141);function rr({data:n,suggestion:t,onChange:a,width:r}){const s=(0,y.wW)(sr),{innerStyles:i,outerStyles:l,renderWidth:d,renderHeight:c}=or(r),p=t.cardOptions??{},u={"aria-label":t.name,className:s.vizBox,"data-testid":b.wl.components.VisualizationPreview.card(t.name),style:l,onClick:()=>{a({pluginId:t.pluginId,options:t.options,fieldConfig:t.fieldConfig})}};if(p.imgSrc)return e.createElement(ce.u,{content:t.description??t.name},e.createElement("button",{...u,className:(0,m.cx)(s.vizBox,s.imgBox)},e.createElement("div",{className:s.name},t.name),e.createElement("img",{className:s.img,src:p.imgSrc,alt:t.name})));let g=t;return t.cardOptions?.previewModifier&&(g=(0,Y.cloneDeep)(t),t.cardOptions.previewModifier(g)),e.createElement("button",{...u},e.createElement(ce.u,{content:t.name},e.createElement("div",{style:i,className:s.renderContainer},e.createElement($t.$,{title:"",data:n,pluginId:t.pluginId,width:d,height:c,options:g.options,fieldConfig:g.fieldConfig}),e.createElement("div",{className:s.hoverPane}))))}const sr=n=>({hoverPane:(0,m.css)({position:"absolute",top:0,right:0,left:0,borderRadius:n.spacing(2),bottom:0}),vizBox:m.css`
      position: relative;
      background: none;
      border-radius: ${n.shape.borderRadius(1)};
      cursor: pointer;
      border: 1px solid ${n.colors.border.medium};

      transition: ${n.transitions.create(["background"],{duration:n.transitions.duration.short})};

      &:hover {
        background: ${n.colors.background.secondary};
      }
    `,imgBox:m.css`
      display: flex;
      flex-direction: column;
      height: 100%;

      justify-self: center;
      color: ${n.colors.text.primary};
      width: 100%;
      display: flex;

      justify-content: center;
      align-items: center;
      text-align: center;
    `,name:m.css`
      padding-bottom: ${n.spacing(.5)};
      margin-top: ${n.spacing(-1)};
      font-size: ${n.typography.bodySmall.fontSize};
      white-space: nowrap;
      overflow: hidden;
      color: ${n.colors.text.secondary};
      font-weight: ${n.typography.fontWeightMedium};
      text-overflow: ellipsis;
    `,img:m.css`
      max-width: ${n.spacing(8)};
      max-height: ${n.spacing(8)};
    `,renderContainer:m.css`
      position: absolute;
      transform-origin: left top;
      top: 6px;
      left: 6px;
    `});function or(n){const a=n,r=n*(1/1.6),s=350,i=s*(1/1.6),l=6,d=(a-l*2)/s,c=(r-l*2)/i;return{renderHeight:i,renderWidth:s,outerStyles:{width:a,height:r},innerStyles:{width:s,height:i,transform:`scale(${d}, ${c})`}}}function ir({onChange:n,data:t,panel:a,searchQuery:r}){const s=(0,y.wW)(cr),{value:i}=(0,fe.Z)(()=>ar(t,a),[t,a]),l=lr(r,i);return e.createElement(Pe.Z,{disableHeight:!0,style:{width:"100%",height:"100%"}},({width:d})=>{if(!d)return null;const c=Math.floor(d/170),p=8*(c-1),u=(d-p)/c;return e.createElement("div",null,e.createElement("div",{className:s.filterRow},e.createElement("div",{className:s.infoText},"Based on current data")),e.createElement("div",{className:s.grid,style:{gridTemplateColumns:`repeat(auto-fill, ${u-1}px)`}},l.map((g,E)=>e.createElement(rr,{key:E,data:t,suggestion:g,onChange:n,width:u})),r&&l.length===0&&e.createElement("div",{className:s.infoText},"No results matched your query")))})}function lr(n,t){if(!n||!t)return t||[];const a=new RegExp(n,"i");return t.filter(r=>a.test(r.name)||a.test(r.pluginId))}const cr=n=>({heading:(0,m.css)({...n.typography.h5,margin:n.spacing(0,.5,1)}),filterRow:(0,m.css)({display:"flex",flexDirection:"row",justifyContent:"space-around",alignItems:"center",paddingBottom:"8px"}),infoText:(0,m.css)({fontSize:n.typography.bodySmall.fontSize,color:n.colors.text.secondary,fontStyle:"italic"}),grid:(0,m.css)({display:"grid",gridGap:n.spacing(1),gridTemplateColumns:"repeat(auto-fill, 144px)",marginBottom:n.spacing(1),justifyContent:"space-evenly"})});var dr=o(69097),At=o(13440),ur=o(89710);const Lt=({isCurrent:n,plugin:t,onClick:a,disabled:r})=>e.createElement(ur.X,{title:t.name,plugin:t,description:t.info.description,onClick:a,isCurrent:n,disabled:r,showBadge:!0});Lt.displayName="VizTypePickerPlugin";function pr({searchQuery:n,onChange:t,current:a,data:r}){const s=(0,y.wW)(mr),i=(0,e.useMemo)(()=>(0,At.x)(),[]),l=(0,e.useMemo)(()=>(0,At.r)(i,n,a),[a,i,n]);return l.length===0?e.createElement(dr.K,null,"Could not find anything matching your query"):e.createElement("div",{className:s.grid},l.map((d,c)=>e.createElement(Lt,{disabled:!1,key:d.id,isCurrent:d.id===a.id,plugin:d,onClick:p=>t({pluginId:d.id,withModKey:Boolean(p.metaKey||p.ctrlKey||p.altKey)})})))}const mr=n=>({grid:m.css`
      max-width: 100%;
      display: grid;
      grid-gap: ${n.spacing(.5)};
    `,heading:(0,m.css)({...n.typography.h5,margin:n.spacing(0,.5,1)})});var I=o(16200);const Ft=({panel:n,data:t})=>{const a=(0,z.useSelector)(Rt(n.type)),[r,s]=(0,e.useState)(""),[i,l]=(0,ja.Z)(Za.FL,I.Ok.Visualizations),d=(0,z.useDispatch)(),c=(0,y.wW)(gr),p=(0,e.useRef)(null),u=(0,e.useCallback)(v=>{d((0,Ee.Kc)({panel:n,...v})),v.withModKey||d((0,Z.g_)(!1))},[d,n]),g=()=>{d((0,Z.g_)(!1))};if(!a)return null;const E=[{label:"Visualizations",value:I.Ok.Visualizations},{label:"Suggestions",value:I.Ok.Suggestions},{label:"Library panels",value:I.Ok.LibraryPanels,description:"Reusable panels you can share between multiple dashboards."}];return e.createElement("div",{className:c.openWrapper},e.createElement("div",{className:c.formBox},e.createElement("div",{className:c.searchRow},e.createElement(Pt.H,{value:r,onChange:s,ref:p,autoFocus:!0,placeholder:"Search for..."}),e.createElement(D.zx,{title:"Close",variant:"secondary",icon:"angle-up",className:c.closeButton,"aria-label":b.wl.components.PanelEditor.toggleVizPicker,onClick:g})),e.createElement(oe.g,{className:c.customFieldMargin},e.createElement(xe.S,{options:E,value:i,onChange:l,fullWidth:!0}))),e.createElement("div",{className:c.scrollWrapper},e.createElement(ue.$,{autoHeightMin:"100%"},e.createElement("div",{className:c.scrollContent},i===I.Ok.Visualizations&&e.createElement(pr,{current:a.meta,onChange:u,searchQuery:r,data:t,onClose:()=>{}}),i===I.Ok.Suggestions&&e.createElement(ir,{current:a.meta,onChange:u,searchQuery:r,panel:n,data:t,onClose:()=>{}}),i===I.Ok.LibraryPanels&&e.createElement(_a,{searchQuery:r,panel:n,key:"Panel Library"})))))};Ft.displayName="VisualizationSelectPane";const gr=n=>({icon:m.css`
      color: ${n.v1.palette.gray33};
    `,wrapper:m.css`
      display: flex;
      flex-direction: column;
      flex: 1 1 0;
      height: 100%;
    `,vizButton:m.css`
      text-align: left;
    `,scrollWrapper:m.css`
      flex-grow: 1;
      min-height: 0;
    `,scrollContent:m.css`
      padding: ${n.spacing(1)};
    `,openWrapper:m.css`
      display: flex;
      flex-direction: column;
      flex: 1 1 100%;
      height: 100%;
      background: ${n.colors.background.primary};
      border: 1px solid ${n.colors.border.weak};
    `,searchRow:m.css`
      display: flex;
      margin-bottom: ${n.spacing(1)};
    `,closeButton:m.css`
      margin-left: ${n.spacing(1)};
    `,customFieldMargin:m.css`
      margin-bottom: ${n.spacing(1)};
    `,formBox:m.css`
      padding: ${n.spacing(1)};
      padding-bottom: 0;
    `}),hr=({plugin:n,panel:t,onFieldConfigsChange:a,onPanelOptionsChanged:r,onPanelConfigChange:s,dashboard:i,instanceState:l})=>{const d=(0,y.wW)(fr),c=(0,z.useSelector)(u=>u.panelEditor.isVizPickerOpen),{data:p}=Be(t,{withTransforms:!0,withFieldConfig:!1},!0);return e.createElement("div",{className:d.wrapper,"aria-label":b.wl.components.PanelEditor.OptionsPane.content},!c&&e.createElement(e.Fragment,null,e.createElement("div",{className:d.vizButtonWrapper},e.createElement(Ke,{panel:t})),e.createElement("div",{className:d.optionsWrapper},e.createElement(Va,{panel:t,dashboard:i,plugin:n,instanceState:l,data:p,onFieldConfigsChange:a,onPanelOptionsChanged:r,onPanelConfigChange:s}))),c&&e.createElement(Ft,{panel:t,data:p}))},fr=n=>({wrapper:m.css`
      height: 100%;
      width: 100%;
      display: flex;
      flex: 1 1 0;
      flex-direction: column;
      padding: 0;
    `,optionsWrapper:m.css`
      flex-grow: 1;
      min-height: 0;
    `,vizButtonWrapper:m.css`
      padding: 0 ${n.spacing(2,2)} 0;
    `,legacyOptions:m.css`
      label: legacy-options;
      .panel-options-grid {
        display: flex;
        flex-direction: column;
      }
      .panel-options-group {
        margin-bottom: 0;
      }
      .panel-options-group__body {
        padding: ${n.spacing(2)} 0;
      }

      .section {
        display: block;
        margin: ${n.spacing(2)} 0;

        &:first-child {
          margin-top: 0;
        }
      }
    `});var zt=o(82378),vr=o(38208),Ut=o(2476),Er=o(53821);function br({width:n,height:t,panel:a,dashboard:r}){const{data:s}=Be(a,{withTransforms:!0,withFieldConfig:!1},!1),[i,l]=(0,e.useState)({frameIndex:0,showHeader:!0,showTypeIcons:!0});if((0,e.useEffect)(()=>{const c=(0,ie.$t)(),p=a.events.subscribe(zt.U5,()=>{const u=(0,Ut.W1)(a,c.timeRange());a.runAllPanelQueries({dashboardId:r.id,dashboardUID:r.uid,dashboardTimezone:r.getTimezone(),timeData:u,width:n})});return()=>{p.unsubscribe()}},[a,r,n]),!s)return null;const d=s?.errors?s.errors.length>1?"Multiple errors found. Click for more details":s.errors[0].message:s?.error?.message;return e.createElement(vr.fm,{width:n,height:t,padding:"none"},(c,p)=>e.createElement(e.Fragment,null,e.createElement(Er.Z,{panel:a,error:d}),e.createElement($t.$,{title:"Raw data",pluginId:"table",width:c,height:p,data:s,options:i,onOptionsChange:l})))}var pe=o(41818),Bt=o(32434),je=o(40419),yr=o(94893),Pr=o(85081),Cr=o(69142);function Vt({message:n}){const t=(0,e.useCallback)(()=>{h.E1.partial({tab:I.Ip.Query})},[]);return e.createElement(W.Ar,{justify:"center",style:{marginTop:"100px"}},e.createElement(W.wc,{spacing:"md"},e.createElement("h2",null,n),e.createElement("div",null,e.createElement(D.zx,{size:"md",variant:"secondary",icon:"arrow-left",onClick:t},"Go back to Queries"))))}var Ze=o(54899),Sr=o(71657),Wt=o(67162);class Tr extends e.PureComponent{constructor(){super(...arguments),this.state={stateHistoryItems:[]},this.clearHistory=async()=>{const{dashboard:t,panelId:a,onRefresh:r}=this.props;await(0,Ze.i)().post("/api/annotations/mass-delete",{dashboardId:t.id,panelId:a}),this.setState({stateHistoryItems:[]}),r()}}componentDidMount(){const{dashboard:t,panelId:a}=this.props;(0,Ze.i)().get(`/api/annotations?dashboardId=${t.id}&panelId=${a}&limit=50&type=alert`,{},`state-history-${t.id}-${a}`).then(r=>{const s=r.map(i=>({stateModel:Wt.Z.getStateDisplayModel(i.newState),time:t.formatDate(i.time,"MMM D, YYYY HH:mm:ss"),info:Wt.Z.getAlertAnnotationInfo(i)}));this.setState({stateHistoryItems:s})})}render(){const{stateHistoryItems:t}=this.state;return e.createElement("div",null,t.length>0&&e.createElement("div",{className:"p-b-1"},e.createElement("span",{className:"muted"},"Last 50 state changes"),e.createElement(Sr.p,{onConfirm:this.clearHistory,confirmVariant:"destructive",confirmText:"Clear"},e.createElement(D.zx,{className:m.css`
                  direction: ltr;
                `,variant:"destructive",icon:"trash-alt"},"Clear history"))),e.createElement("ol",{className:"alert-rule-list"},t.length>0?t.map((a,r)=>e.createElement("li",{className:"alert-rule-item",key:`${a.time}-${r}`},e.createElement("div",{className:`alert-rule-item__icon ${a.stateModel.stateClass}`},e.createElement(T.J,{name:a.stateModel.iconClass,size:"xl"})),e.createElement("div",{className:"alert-rule-item__body"},e.createElement("div",{className:"alert-rule-item__header"},e.createElement("p",{className:"alert-rule-item__name"},a.alertName),e.createElement("div",{className:"alert-rule-item__text"},e.createElement("span",{className:`${a.stateModel.stateClass}`},a.stateModel.text))),a.info),e.createElement("div",{className:"alert-rule-item__time"},a.time))):e.createElement("i",null,"No state changes recorded")))}}const xr=Tr;var kt=o(61744),Je=o(16065);class Dr extends e.PureComponent{constructor(){super(...arguments),this.state={isLoading:!1,allNodesExpanded:null,testRuleResponse:{}},this.setFormattedJson=t=>{this.formattedJson=t},this.getTextForClipboard=()=>JSON.stringify(this.formattedJson,null,2),this.onToggleExpand=()=>{this.setState(t=>({...t,allNodesExpanded:!this.state.allNodesExpanded}))},this.getNrOfOpenNodes=()=>this.state.allNodesExpanded===null?3:this.state.allNodesExpanded?20:1,this.renderExpandCollapse=()=>{const{allNodesExpanded:t}=this.state,a=e.createElement(e.Fragment,null,e.createElement(T.J,{name:"minus-circle"})," Collapse All"),r=e.createElement(e.Fragment,null,e.createElement(T.J,{name:"plus-circle"})," Expand All");return t?a:r}}componentDidMount(){this.testRule()}async testRule(){const{dashboard:t,panel:a}=this.props,r=t.getSaveModelClone();r.panels=r.panels.map(l=>l.id===a.id?a.getSaveModel():l);const s={dashboard:r,panelId:a.id};this.setState({isLoading:!0});const i=await(0,Ze.i)().post("/api/alerts/test",s);this.setState({isLoading:!1,testRuleResponse:i})}render(){const{testRuleResponse:t,isLoading:a}=this.state,r=(0,D.gN)(this.props.theme);if(a===!0)return e.createElement(kt.u,{text:"Evaluating rule"});const s=this.getNrOfOpenNodes();return e.createElement(e.Fragment,null,e.createElement("div",{className:"pull-right"},e.createElement(W.Lh,{spacing:"md"},e.createElement("button",{type:"button",className:r,onClick:this.onToggleExpand},this.renderExpandCollapse()),e.createElement(Ue.m,{getText:this.getTextForClipboard,icon:"copy"},"Copy to Clipboard"))),e.createElement(Je.g,{json:t,open:s,onDidRender:this.setFormattedJson}))}}const Or=(0,y.HE)(Dr);var wr=o(44927);class Ir extends e.PureComponent{constructor(){super(...arguments),this.state={validationMessage:"",showStateHistory:!1,showDeleteConfirmation:!1,showTestRule:!1},this.onAngularPanelUpdated=()=>{this.forceUpdate()},this.onAddAlert=()=>{this.panelCtrl?._enableAlert(),this.component?.digest(),this.forceUpdate()},this.onToggleModal=t=>{const a=this.state[t];this.setState({...this.state,[t]:!a})},this.renderTestRule=()=>{if(!this.state.showTestRule)return null;const{panel:t,dashboard:a}=this.props,r=()=>this.onToggleModal("showTestRule");return e.createElement(te.u,{isOpen:!0,icon:"bug",title:"Testing rule",onDismiss:r,onClickBackdrop:r},e.createElement(Or,{panel:t,dashboard:a}))},this.renderDeleteConfirmation=()=>{if(!this.state.showDeleteConfirmation)return null;const{panel:t}=this.props,a=()=>this.onToggleModal("showDeleteConfirmation");return e.createElement(Mt.s,{isOpen:!0,icon:"trash-alt",title:"Delete",body:e.createElement("div",null,"Are you sure you want to delete this alert rule?",e.createElement("br",null),e.createElement("small",null,"You need to save dashboard for the delete to take effect.")),confirmText:"Delete alert",onDismiss:a,onConfirm:()=>{delete t.alert,t.thresholds=[],this.panelCtrl&&(this.panelCtrl.alertState=null,this.panelCtrl.render()),this.component?.digest(),a()}})},this.renderStateHistory=()=>{if(!this.state.showStateHistory)return null;const{panel:t,dashboard:a}=this.props,r=()=>this.onToggleModal("showStateHistory");return e.createElement(te.u,{isOpen:!0,icon:"history",title:"State history",onDismiss:r,onClickBackdrop:r},e.createElement(xr,{dashboard:a,panelId:t.id,onRefresh:()=>this.panelCtrl?.refresh()}))}}async componentDidMount(){f.v.angularSupportEnabled?(await Promise.all([o.e(6093),o.e(5718)]).then(o.bind(o,30789)),this.loadAlertTab()):alert("Angular support disabled, legacy alerting cannot function without angular support")}componentDidUpdate(t){this.loadAlertTab()}componentWillUnmount(){this.component&&this.component.destroy()}async loadAlertTab(){const{panel:t,angularPanelComponent:a}=this.props;if(!this.element||this.component)return;if(a){const d=a.getScope();if(!d.$$childHead){setTimeout(()=>{this.forceUpdate()});return}this.panelCtrl=d.$$childHead.ctrl}else this.panelCtrl=this.getReactAlertPanelCtrl();const r=(0,Ct.w)(),s="<alert-tab />",i={ctrl:this.panelCtrl};this.component=r.load(this.element,i,s);const l=await(0,wr.E)(t.transformations,t.targets,(0,vt.F)(),t.datasource);l&&this.setState({validationMessage:l})}getReactAlertPanelCtrl(){return{panel:this.props.panel,events:new Pr.F,render:()=>{this.props.panel.render()}}}render(){const{alert:t,transformations:a}=this.props.panel,{validationMessage:r}=this.state,s=a&&a.length>0;if(!t&&r)return e.createElement(Vt,{message:r});const i={title:"Panel has no alert rule defined",buttonIcon:"bell",onClick:this.onAddAlert,buttonTitle:"Create Alert"};return e.createElement(e.Fragment,null,e.createElement(ue.$,{autoHeightMin:"100%"},e.createElement(W.W2,{padding:"md"},e.createElement("div",{"aria-label":b.wl.components.AlertTab.content},t&&s&&e.createElement(q.b,{severity:z.AppNotificationSeverity.Error,title:"Transformations are not supported in alert queries"}),e.createElement("div",{ref:l=>this.element=l}),t&&e.createElement(W.Lh,null,e.createElement(D.zx,{onClick:()=>this.onToggleModal("showStateHistory"),variant:"secondary"},"State history"),e.createElement(D.zx,{onClick:()=>this.onToggleModal("showTestRule"),variant:"secondary"},"Test rule"),e.createElement(D.zx,{onClick:()=>this.onToggleModal("showDeleteConfirmation"),variant:"destructive"},"Delete")),!t&&!r&&e.createElement(Cr.Z,{...i})))),this.renderTestRule(),this.renderDeleteConfirmation(),this.renderStateHistory())}}const Rr=(n,t)=>({angularPanelComponent:(0,ye.i)(n,t.panel)?.angularComponent}),Nr={},Mr=(0,A.connect)(Rr,Nr)(Ir);var $r=o(27677),Ar=o(54408),Lr=o(41904),Fr=o(21767);const Ht=({dashboard:n,panel:t,className:a})=>{const r=(0,z.useSelector)(c=>c.templating),s=(0,Ae.TH)(),{loading:i,value:l}=(0,fe.Z)(()=>(0,Fr.aR)(t,n),[t,n,r]);if(i)return e.createElement(D.zx,{disabled:!0},"Create alert rule from this panel");if(!l)return e.createElement(q.b,{severity:"info",title:"No alerting capable query found"},"Cannot create alerts from this panel because no query to an alerting capable datasource is found.");const d=$r.Cj.renderUrl("alerting/new",{defaults:JSON.stringify(l),returnTo:s.pathname+s.search});return e.createElement(D.Qj,{icon:"bell",onClick:()=>(0,Ar.PN)(Lr.z7.alertRuleFromPanel),href:d,className:a,"data-testid":"create-alert-rule-button"},"Create alert rule from this panel")};var zr=o(62019),Kt=o(72004),Qe=o(37190),ae=o(45849),Gt=o(46818),Ur=o(61627),jt=o(69945);function Zt({dashboard:n,panel:t,poll:a=!1}){const r=(0,z.useDispatch)(),s=(0,jt._)(u=>u.promRules[ae.GC])??Gt.oq,i=(0,jt._)(u=>u.rulerRules[ae.GC])??Gt.oq;(0,e.useEffect)(()=>{const u=()=>{r((0,Kt.y6)({rulesSourceName:ae.GC,filter:{dashboardUID:n.uid,panelId:t.id}})),r((0,Kt.UR)({rulesSourceName:ae.GC,filter:{dashboardUID:n.uid,panelId:t.id}}))};if(u(),a){const g=setInterval(u,Qe.p4);return()=>{clearInterval(g)}}return()=>{}},[r,a,t.id,n.uid]);const l=s.loading||i.loading,d=[s.error,i.error].filter(u=>!!u),c=(0,Ur.Zo)(ae.GC);return{rules:(0,e.useMemo)(()=>c.flatMap(u=>u.groups).flatMap(u=>u.rules).filter(u=>u.annotations[Qe.q6.dashboardUID]===n.uid&&u.annotations[Qe.q6.panelID]===String(t.id)),[c,n,t]),errors:d,loading:l}}var Jt=o(97953);const Br=({dashboard:n,panel:t})=>{const a=(0,y.wW)(Vr),{errors:r,loading:s,rules:i}=Zt({dashboard:n,panel:t,poll:!0}),l=(0,Jt.Bz)("grafana"),d=X.Vt.hasPermission(l.create),c=r.length?e.createElement(q.b,{title:"Errors loading rules",severity:"error"},r.map((p,u)=>e.createElement("div",{key:u},"Failed to load Grafana rules state: ",p.message||"Unknown error."))):null;return s&&!i.length?e.createElement("div",{className:a.innerWrapper},c,e.createElement(kt.u,{text:"Loading rules..."})):i.length?e.createElement(ue.$,{autoHeightMin:"100%"},e.createElement("div",{className:a.innerWrapper},c,e.createElement(zr.i,{rules:i}),!!n.meta.canSave&&d&&e.createElement(Ht,{className:a.newButton,panel:t,dashboard:n}))):e.createElement("div",{"aria-label":b.wl.components.PanelAlertTabContent.content,className:a.noRulesWrapper},c,!!n.uid&&e.createElement(e.Fragment,null,e.createElement("p",null,"There are no alert rules linked to this panel."),!!n.meta.canSave&&d&&e.createElement(Ht,{panel:t,dashboard:n})),!n.uid&&!!n.meta.canSave&&e.createElement(q.b,{severity:"info",title:"Dashboard not saved"},"Dashboard must be saved before alerts can be added."))},Vr=n=>({newButton:m.css`
    margin-top: ${n.spacing(3)};
  `,innerWrapper:m.css`
    padding: ${n.spacing(2)};
  `,noRulesWrapper:m.css`
    margin: ${n.spacing(2)};
    background-color: ${n.colors.background.secondary};
    padding: ${n.spacing(3)};
  `}),Wr=f.v.unifiedAlertingEnabled?Br:Mr,kr=({panel:n,dashboard:t,...a})=>{const{rules:r,loading:s}=Zt({panel:n,dashboard:t});return e.createElement(se.O,{...a,counter:s?null:r.length})};var Qt=o(19677),Ye=o(20256),Re=o(80548),Ne=o(72948),Hr=o(59796);const Kr={[Re.x.Transformations]:"https://grafana.com/docs/grafana/latest/panels/transformations",[Re.x.FieldConfig]:"https://grafana.com/docs/grafana/latest/panels/field-configuration-options/",[Re.x.FieldConfigOverrides]:"https://grafana.com/docs/grafana/latest/panels/field-configuration-options/#override-a-field"},Gr=n=>Kr[n];var Yt=o(81731),Xt=o(86253),jr=o(85854),Zr=o(19117),me=o(1029),Jr=o(67254),Qr=o(39859),Xe=o(79720);const Yr=({debugMode:n,index:t,data:a,uiConfig:r,configs:s,onChange:i})=>{const l=(0,y.wW)(Xr),[d,c]=(0,e.useState)([]),[p,u]=(0,e.useState)([]),g=(0,e.useMemo)(()=>s[t],[s,t]);(0,e.useEffect)(()=>{const v=s[t].transformation,P=v.filter?.options?(0,xt.b9)(v.filter):void 0,C=s.slice(0,t).map(x=>x.transformation),O=s.slice(t,t+1).map(x=>x.transformation),$=(0,Xe.H)(C,a).subscribe(x=>{P&&(x=a.filter(R=>P(R))),c(x)}),S=(0,Xe.H)(C,a).pipe((0,Qr.z)(x=>(0,Xe.H)(O,x))).subscribe(u);return function(){$.unsubscribe(),S.unsubscribe()}},[t,a,s]);const E=(0,e.useMemo)(()=>e.createElement(r.editor,{options:{...r.transformation.defaultOptions,...g.transformation.options},input:d,onChange:v=>{i(t,{...g.transformation,options:v})}}),[r.editor,r.transformation.defaultOptions,g.transformation,d,i,t]);return e.createElement("div",{className:l.editor,"aria-label":b.wl.components.TransformTab.transformationEditor(r.name)},E,n&&e.createElement("div",{className:l.debugWrapper,"aria-label":b.wl.components.TransformTab.transformationEditorDebugger(r.name)},e.createElement("div",{className:l.debug},e.createElement("div",{className:l.debugTitle},"Transformation input data"),e.createElement("div",{className:l.debugJson},e.createElement(Je.g,{json:d}))),e.createElement("div",{className:l.debugSeparator},e.createElement(T.J,{name:"arrow-right"})),e.createElement("div",{className:l.debug},e.createElement("div",{className:l.debugTitle},"Transformation output data"),e.createElement("div",{className:l.debugJson},p&&e.createElement(Je.g,{json:p})))))},Xr=n=>{const t=n.isLight?n.v1.palette.gray85:n.v1.palette.gray15;return{title:m.css`
      display: flex;
      padding: 4px 8px 4px 8px;
      position: relative;
      height: 35px;
      border-radius: 4px 4px 0 0;
      flex-wrap: nowrap;
      justify-content: space-between;
      align-items: center;
    `,name:m.css`
      font-weight: ${n.typography.fontWeightMedium};
      color: ${n.colors.primary.text};
    `,iconRow:m.css`
      display: flex;
    `,icon:m.css`
      background: transparent;
      border: none;
      box-shadow: none;
      cursor: pointer;
      color: ${n.colors.text.secondary};
      margin-left: ${n.spacing(1)};
      &:hover {
        color: ${n.colors.text};
      }
    `,editor:m.css``,debugWrapper:m.css`
      display: flex;
      flex-direction: row;
    `,debugSeparator:m.css`
      width: 48px;
      min-height: 300px;
      display: flex;
      align-items: center;
      align-self: stretch;
      justify-content: center;
      margin: 0 ${n.spacing(.5)};
      color: ${n.colors.primary.text};
    `,debugTitle:m.css`
      padding: ${n.spacing(1)} ${n.spacing(.25)};
      font-family: ${n.typography.fontFamilyMonospace};
      font-size: ${n.typography.bodySmall.fontSize};
      color: ${n.colors.text};
      border-bottom: 1px solid ${t};
      flex-grow: 0;
      flex-shrink: 1;
    `,debug:m.css`
      margin-top: ${n.spacing(1)};
      padding: 0 ${n.spacing(1,1,1)};
      border: 1px solid ${t};
      background: ${n.isLight?n.v1.palette.white:n.v1.palette.gray05};
      border-radius: ${n.shape.borderRadius(1)};
      width: 100%;
      min-height: 300px;
      display: flex;
      flex-direction: column;
      align-self: stretch;
    `,debugJson:m.css`
      flex-grow: 1;
      height: 100%;
      overflow: hidden;
      padding: ${n.spacing(.5)};
    `}};var qr=o(92465);const _r=({index:n,data:t,config:a,onChange:r})=>{const s=(0,y.wW)(es),i=(0,e.useMemo)(()=>({data:t}),[t]);return e.createElement("div",{className:s.wrapper},e.createElement("h5",null,"Apply tranformation to"),e.createElement(qr.M,{value:a.filter,context:i,item:{},onChange:l=>r(n,{...a,filter:l})}))},es=n=>{const t=n.shape.borderRadius();return{wrapper:m.css`
      padding: ${n.spacing(2)};
      border: 2px solid ${n.colors.background.secondary};
      border-top: none;
      border-radius: 0 0 ${t} ${t};
      position: relative;
      top: -4px;
    `}},ts=({onRemove:n,index:t,id:a,data:r,configs:s,uiConfig:i,onChange:l})=>{const[d,c]=(0,Xt.Z)(!1),[p,u]=(0,Xt.Z)(!1),g=s[t].transformation.disabled,E=s[t].transformation.filter!=null,v=E||r.length>1,P=(0,e.useCallback)(S=>{const x=s[S].transformation;l(S,{...x,disabled:x.disabled?void 0:!0})},[l,s]),C=(0,e.useCallback)(()=>{let S={...s[t].transformation};S.filter?delete S.filter:S.filter={id:jr.E4.byRefId,options:""},l(t,S)},[l,t,s]),O=(0,e.useCallback)((S,x,R)=>G=>{(0,pe.ff)("panel_editor_tabs_transformations_toggle",{action:R?"off":"on",toggleId:x,transformationId:s[t].transformation.id}),S(G)},[s,t]),$=({isOpen:S})=>e.createElement(W.Lh,{align:"center",width:"auto"},i.state&&e.createElement(Yt.u,{state:i.state}),e.createElement(me.y,{title:"Show/hide transform help",icon:"info-circle",onClick:O(u,"help",p),active:p}),v&&e.createElement(me.y,{title:"Filter",icon:"filter",onClick:O(C,"filter",E),active:E}),e.createElement(me.y,{title:"Debug",disabled:!S,icon:"bug",onClick:O(c,"debug",d),active:d}),e.createElement(me.y,{title:"Disable/Enable transformation",icon:g?"eye-slash":"eye",onClick:O(()=>P(t),"disabled",g),active:g}),e.createElement(me.y,{title:"Remove",icon:"trash-alt",onClick:()=>n(t)}));return e.createElement(Jr.t,{id:a,index:t,title:i.name,draggable:!0,actions:$,disabled:g},p&&e.createElement(Zr.h,{markdown:ns(i)}),E&&e.createElement(_r,{index:t,config:s[t].transformation,data:r,onChange:l}),e.createElement(Yr,{debugMode:d,index:t,data:r,configs:s,uiConfig:i,onChange:l}))};function ns(n){return`
${n.help??n.description}

Go the <a href="https://grafana.com/docs/grafana/latest/panels/transformations/?utm_source=grafana" target="_blank" rel="noreferrer">
transformation documentation
</a> for more.
`}const as=({data:n,onChange:t,onRemove:a,configs:r})=>e.createElement(e.Fragment,null,r.map((s,i)=>{const l=Ye.Z.getIfExists(s.transformation.id);return l?e.createElement(ts,{index:i,id:`${s.id}`,key:`${s.id}`,data:n,configs:r,uiConfig:l,onRemove:a,onChange:t}):null})),rs="dashboard.components.TransformationEditor.featureInfoBox.isDismissed";class ss extends e.PureComponent{constructor(t){super(t),this.onSearchChange=s=>{this.setState({search:s.target.value})},this.onSearchKeyDown=s=>{if(s.key==="Enter"){const{search:i}=this.state;if(i){const l=i.toLowerCase(),d=Ye.Z.list().filter(c=>(c.name+c.description).toLowerCase().indexOf(l)>=0);d.length>0&&this.onTransformationAdd({value:d[0].id})}}else s.keyCode===27&&(this.setState({search:"",showPicker:!1}),s.stopPropagation())},this.getTransformationNextId=s=>{const{transformations:i}=this.state;let l=0;const d=i.filter(c=>c.id.startsWith(s)).map(c=>c.id);return d.length!==0&&(l=Math.max(...d.map(c=>parseInt(c.match(/\d+/)[0],10)))+1),`${s}-${l}`},this.onTransformationAdd=s=>{(0,pe.ff)("panel_editor_tabs_transformations_management",{action:"add",transformationId:s.value});const{transformations:i}=this.state,l=this.getTransformationNextId(s.value);this.setState({search:"",showPicker:!1}),this.onChange([...i,{id:l,transformation:{id:s.value,options:{}}}])},this.onTransformationChange=(s,i)=>{const{transformations:l}=this.state,d=Array.from(l);(0,pe.ff)("panel_editor_tabs_transformations_management",{action:"change",transformationId:d[s].transformation.id}),d[s].transformation=i,this.onChange(d)},this.onTransformationRemove=s=>{const{transformations:i}=this.state,l=Array.from(i);(0,pe.ff)("panel_editor_tabs_transformations_management",{action:"remove",transformationId:l[s].transformation.id}),l.splice(s,1),this.onChange(l)},this.onDragEnd=s=>{const{transformations:i}=this.state;if(!s||!s.destination)return;const l=s.source.index,d=s.destination.index;if(l===d)return;const c=Array.from(i),[p]=c.splice(l,1);c.splice(d,0,p),this.onChange(c)},this.renderTransformationEditors=()=>{const{data:s,transformations:i}=this.state;return e.createElement(Qt.Z5,{onDragEnd:this.onDragEnd},e.createElement(Qt.bK,{droppableId:"transformations-list",direction:"vertical"},l=>e.createElement("div",{ref:l.innerRef,...l.droppableProps},e.createElement(as,{configs:i,data:s,onRemove:this.onTransformationRemove,onChange:this.onTransformationChange}),l.placeholder)))};const a=t.panel.transformations||[],r=this.buildTransformationIds(a);this.state={transformations:a.map((s,i)=>({transformation:s,id:r[i]})),data:[],search:""}}buildTransformationIds(t){const a={},r=[];for(let s=0;s<t.length;s++){const i=t[s];a[i.id]===void 0?a[i.id]=0:a[i.id]+=1,r.push(`${t[s].id}-${a[t[s].id]}`)}return r}componentDidMount(){this.subscription=this.props.panel.getQueryRunner().getData({withTransforms:!1,withFieldConfig:!1}).subscribe({next:t=>this.setState({data:t.series})})}componentWillUnmount(){this.subscription&&this.subscription.unsubscribe()}onChange(t){this.setState({transformations:t}),this.props.panel.setTransformations(t.map(a=>a.transformation))}renderTransformsPicker(){const{transformations:t,search:a}=this.state;let r=null,s=Ye.Z.list().sort((d,c)=>d.name>c.name?1:c.name>d.name?-1:0);if(a){const d=a.toLowerCase(),c=s.filter(p=>(p.name+p.description).toLowerCase().indexOf(d)>=0);r=e.createElement(e.Fragment,null,c.length," / ",s.length," \xA0\xA0",e.createElement(Ie.h,{name:"times",onClick:()=>{this.setState({search:""})}})),s=c}const i=!t?.length,l=i||this.state.showPicker;return!r&&l&&!i&&(r=e.createElement(Ie.h,{name:"times",onClick:()=>{this.setState({showPicker:!1})}})),e.createElement(e.Fragment,null,i&&e.createElement(W.W2,{grow:1},e.createElement(Hr.G,{storageKey:rs,defaultValue:!1},(d,c)=>d?null:e.createElement(q.b,{title:"Transformations",severity:"info",onRemove:()=>{c(!0)}},e.createElement("p",null,"Transformations allow you to join, calculate, re-order, hide, and rename your query results before they are visualized. ",e.createElement("br",null),"Many transforms are not suitable if you're using the Graph visualization, as it currently only supports time series data. ",e.createElement("br",null),"It can help to switch to the Table visualization to understand what a transformation is doing."," "),e.createElement("a",{href:Gr(Re.x.Transformations),className:"external-link",target:"_blank",rel:"noreferrer"},"Read more")))),l?e.createElement(W.wc,null,e.createElement(ve.I,{"aria-label":b.wl.components.Transforms.searchInput,value:a??"",autoFocus:!i,placeholder:"Add transformation",onChange:this.onSearchChange,onKeyDown:this.onSearchKeyDown,suffix:r}),s.map(d=>e.createElement(os,{key:d.name,transform:d,onClick:()=>{this.onTransformationAdd({value:d.id})}}))):e.createElement(D.zx,{icon:"plus",variant:"secondary",onClick:()=>{this.setState({showPicker:!0})}},"Add transformation"))}render(){const{panel:{alert:t}}=this.props,{transformations:a}=this.state,r=a.length>0;return!r&&t?e.createElement(Vt,{message:"Transformations can't be used on a panel with existing alerts"}):e.createElement(ue.$,{autoHeightMin:"100%"},e.createElement(W.W2,{padding:"md"},e.createElement("div",{"aria-label":b.wl.components.TransformTab.content},r&&t?e.createElement(q.b,{severity:z.AppNotificationSeverity.Error,title:"Transformations can't be used on a panel with alerts"}):null,r&&this.renderTransformationEditors(),this.renderTransformsPicker())))}}function os({transform:n,onClick:t}){const a=(0,y.wW)(is);return e.createElement(Ne.Z,{className:a.card,"aria-label":b.wl.components.TransformTab.newTransform(n.name),onClick:t},e.createElement(Ne.Z.Heading,null,n.name),e.createElement(Ne.Z.Description,null,n.description),n.state&&e.createElement(Ne.Z.Tags,null,e.createElement(Yt.u,{state:n.state})))}const is=n=>({card:m.css`
      margin: 0;
      padding: ${n.spacing(1)};
    `}),ls=(0,y.Zz)(ss);var cs=o(5916),qt=o(91162),ds=o(62533);class us extends e.PureComponent{constructor(t){super(t),this.onRunQueries=()=>{this.props.panel.refresh()},this.onOpenQueryInspector=()=>{h.E1.partial({inspect:this.props.panel.id,inspectTab:"query"})},this.onOptionsChange=a=>{const{panel:r}=this.props;r.updateQueries(a),a.dataSource.uid!==r.datasource?.uid&&setTimeout(this.onRunQueries,10),this.forceUpdate()}}buildQueryOptions(t){const a=t.datasource??{default:!0},r=(0,qt.ak)().getInstanceSettings(a);return{cacheTimeout:r?.meta.queryOptions?.cacheTimeout?t.cacheTimeout:void 0,dataSource:{default:r?.isDefault,type:r?.type,uid:r?.uid},queryCachingTTL:r?.cachingConfig?.enabled?t.queryCachingTTL:void 0,queries:t.targets,maxDataPoints:t.maxDataPoints,minInterval:t.interval,timeRange:{from:t.timeFrom,shift:t.timeShift,hide:t.hideTimeOverride}}}async componentDidMount(){const{panel:t}=this.props;if(!t.datasource){const a=(0,qt.ak)().getInstanceSettings(null);t.datasource=(0,cs.iU)(a),this.forceUpdate()}}render(){const{panel:t}=this.props;if(!t.datasource)return null;const a=this.buildQueryOptions(t);return e.createElement(ds.D,{options:a,queryRunner:t.getQueryRunner(),onRunQueries:this.onRunQueries,onOpenQueryInspector:this.onOpenQueryInspector,onOptionsChange:this.onOptionsChange})}}const _t=e.memo(({panel:n,dashboard:t,tabs:a,onChangeTab:r})=>{const s=(0,Bt.N)(),i=(0,y.wW)(ms),l=(0,e.useCallback)(c=>{c.active||(0,pe.ff)("panel_editor_tabs_changed",{tab_id:c.id}),r(c)},[r]);(0,e.useEffect)(()=>{const c=new Et.w0;return c.add(n.events.subscribe(j.pO,s)),c.add(n.events.subscribe(j.Xw,s)),()=>c.unsubscribe()},[n,t,s]);const d=a.find(c=>c.active);return a.length===0?null:e.createElement("div",{className:i.wrapper},e.createElement(ze.J,{className:i.tabBar,hideBorder:!0},a.map(c=>c.id===I.Ip.Alert?ps(c,n,t,l):e.createElement(se.O,{key:c.id,label:c.text,active:c.active,onChangeTab:()=>l(c),icon:(0,je.toIconName)(c.icon),counter:en(n,c)}))),e.createElement(yr.I,{className:i.tabContent},d.id===I.Ip.Query&&e.createElement(us,{panel:n,queries:n.targets}),d.id===I.Ip.Alert&&e.createElement(Wr,{panel:n,dashboard:t}),d.id===I.Ip.Transform&&e.createElement(ls,{panel:n})))});_t.displayName="PanelEditorTabs";function en(n,t){switch(t.id){case I.Ip.Query:return n.targets.length;case I.Ip.Alert:return n.alert?1:0;case I.Ip.Transform:return(n.getTransformations()??[]).length}return null}function ps(n,t,a,r){return!f.v.alertingEnabled&&!f.v.unifiedAlertingEnabled?null:f.v.unifiedAlertingEnabled?e.createElement(kr,{key:n.id,label:n.text,active:n.active,onChangeTab:()=>r(n),icon:(0,je.toIconName)(n.icon),panel:t,dashboard:a}):f.v.alertingEnabled?e.createElement(se.O,{key:n.id,label:n.text,active:n.active,onChangeTab:()=>r(n),icon:(0,je.toIconName)(n.icon),counter:en(t,n)}):null}const ms=n=>({wrapper:m.css`
      display: flex;
      flex-direction: column;
      height: 100%;
    `,tabBar:m.css`
      padding-left: ${n.spacing(2)};
    `,tabContent:m.css`
      padding: 0;
      display: flex;
      flex-direction: column;
      flex-grow: 1;
      min-height: 0;
      background: ${n.colors.background.primary};
      border: 1px solid ${n.components.panel.borderColor};
      border-left: none;
      border-bottom: none;
      border-top-right-radius: ${n.shape.borderRadius(1.5)};
    `});var gs=o(58635),hs=o(47694);const fs=(0,gs.Z)((n,t)=>{const a=[];if(!t)return a;let r=I.Ip.Visualize;if(t.meta.skipDataQuery)return[];t.meta.skipDataQuery||(r=I.Ip.Query,a.push({id:I.Ip.Query,text:"Query",icon:"database",active:!1}),a.push({id:I.Ip.Transform,text:"Transform",icon:"process",active:!1}));const{alertingEnabled:s,unifiedAlertingEnabled:i}=(0,hs.iE)(),l=X.Vt.hasPermission((0,Jt.Bz)(ae.GC).read),d=s||i&&l,c=t.meta.id==="graph",p=t.meta.id==="timeseries";(d&&c||p)&&a.push({id:I.Ip.Alert,text:"Alert",icon:"bell",active:!1});const u=a.find(g=>g.id===(n||r))??a[0];return u.active=!0,a}),vs=(n,t)=>{const a=n.panelEditor.getPanel(),r=(0,ye.i)(n,a);return{panel:a,plugin:r?.plugin,instanceState:r?.instanceState,initDone:n.panelEditor.initDone,uiState:n.panelEditor.ui,tableViewEnabled:n.panelEditor.tableViewEnabled,variables:(0,ke.gt)(t.dashboard.uid,n)}},Es={initPanelEditor:Pn,discardPanelChanges:lt,updatePanelEditorUIState:Fe,updateTimeZoneForSession:da.YT,toggleTableView:Z.OT,notifyApp:F.$l},bs=(0,A.connect)(vs,Es);class ys extends e.PureComponent{constructor(){super(...arguments),this.state={showSaveLibraryPanelModal:!1},this.triggerForceUpdate=()=>{this.forceUpdate()},this.onBack=()=>{h.E1.partial({editPanel:null,tab:null,showCategory:null})},this.onDiscard=()=>{this.props.discardPanelChanges(),this.onBack()},this.onSaveDashboard=()=>{sa.h$.publish(new j.Dn({component:ga.d,props:{dashboard:this.props.dashboard}}))},this.onSaveLibraryPanel=async()=>{(0,de.V)(this.props.panel)&&this.setState({showSaveLibraryPanelModal:!0})},this.onChangeTab=t=>{h.E1.partial({tab:t.id})},this.onFieldConfigChange=t=>{this.props.panel.updateFieldConfig({...t})},this.onPanelOptionsChanged=t=>{this.props.panel.updateOptions(t)},this.onPanelConfigChanged=(t,a)=>{this.props.panel.setProperty(t,a),this.props.panel.render(),this.forceUpdate()},this.onDisplayModeChange=t=>{const{updatePanelEditorUIState:a}=this.props;this.props.tableViewEnabled&&this.props.toggleTableView(),a({mode:t})},this.onToggleTableView=()=>{this.props.toggleTableView()},this.onGoBackToDashboard=()=>{h.E1.partial({editPanel:null,tab:null,showCategory:null})},this.onConfirmAndDismissLibarayPanelModel=()=>{this.setState({showSaveLibraryPanelModal:!1})}}componentDidMount(){this.props.initPanelEditor(this.props.sourcePanel,this.props.dashboard)}componentDidUpdate(){const{panel:t,initDone:a}=this.props;a&&!this.eventSubs&&(this.eventSubs=new Et.w0,this.eventSubs.add(t.events.subscribe(j.Wj,this.triggerForceUpdate)))}componentWillUnmount(){this.eventSubs?.unsubscribe()}renderPanel(t,a){const{dashboard:r,panel:s,uiState:i,tableViewEnabled:l,theme:d}=this.props;return e.createElement("div",{className:t.mainPaneWrapper,key:"panel"},this.renderPanelToolbar(t),e.createElement("div",{className:t.panelWrapper},e.createElement(Pe.Z,null,({width:c,height:p})=>{if(c<3||p<3)return null;if(a&&(p-=d.spacing.gridSize*2),l)return e.createElement(br,{width:c,height:p,panel:s,dashboard:r});const u=(0,Ve.jF)(i.mode,c,p,s);return e.createElement("div",{className:t.centeringContainer,style:{width:c,height:p}},e.createElement("div",{style:u,"data-panelid":s.id},e.createElement(pa.l,{key:s.key,stateKey:s.key,dashboard:r,panel:s,isEditing:!0,isViewing:!1,lazy:!1,width:u.width,height:u.height})))})))}renderPanelAndEditor(t,a){const{panel:r,dashboard:s,plugin:i,tab:l}=this.props,d=fs(l,i),c=d.length===0,p=this.renderPanel(a,c);return d.length===0?e.createElement("div",{className:a.onlyPanel},p):e.createElement(bt.U,{splitOrientation:"horizontal",maxSize:-200,paneSize:t.topPaneSize,primary:"first",secondaryPaneStyle:{minHeight:0},onDragFinished:u=>{u&&Fe({topPaneSize:u/window.innerHeight})}},p,e.createElement("div",{className:a.tabsWrapper,"aria-label":b.wl.components.PanelEditor.DataPane.content,key:"panel-editor-tabs"},e.createElement(_t,{key:r.key,panel:r,dashboard:s,tabs:d,onChangeTab:this.onChangeTab})))}renderTemplateVariables(t){const{variables:a}=this.props;return a.length?e.createElement("div",{className:t.variablesWrapper},e.createElement(yt,{variables:a})):null}renderPanelToolbar(t){const{dashboard:a,uiState:r,variables:s,updateTimeZoneForSession:i,panel:l,tableViewEnabled:d}=this.props;return e.createElement("div",{className:t.panelToolbar},e.createElement(W.Lh,{justify:s.length>0?"space-between":"flex-end",align:"flex-start"},this.renderTemplateVariables(t),e.createElement(Ce.Stack,{gap:1},e.createElement(ne.x,{label:"Table view",showLabel:!0,id:"table-view",value:d,onClick:this.onToggleTableView,"aria-label":b.wl.components.PanelEditor.toggleTableView}),e.createElement(xe.S,{value:r.mode,options:I.d7,onChange:this.onDisplayModeChange}),e.createElement(ma.C,{dashboard:a,onChangeTimeZone:i,isOnCanvas:!0}),!r.isPanelOptionsVisible&&e.createElement(Ke,{panel:l}))))}renderEditorActions(){const t=f.v.featureToggles.topnav?"sm":"md";let a=[e.createElement(D.zx,{onClick:this.onDiscard,title:"Undo all changes",key:"discard",size:t,variant:"destructive",fill:"outline"},"Discard"),this.props.panel.libraryPanel?e.createElement(D.zx,{onClick:this.onSaveLibraryPanel,variant:"primary",size:t,title:"Apply changes and save library panel",key:"save-panel"},"Save library panel"):e.createElement(D.zx,{onClick:this.onSaveDashboard,title:"Apply changes and save dashboard",key:"save",size:t,variant:"secondary"},"Save"),e.createElement(D.zx,{onClick:this.onBack,variant:"primary",title:"Apply changes and go back to dashboard","data-testid":b.wl.components.PanelEditor.applyButton,key:"apply",size:t},"Apply")];return this.props.panel.libraryPanel&&(a.splice(1,0,e.createElement(st.JY,{key:"unlink-controller"},({showModal:r,hideModal:s})=>e.createElement(De.h,{onClick:()=>{r(ua.i,{onConfirm:()=>{this.props.panel.unlinkLibraryPanel(),this.forceUpdate()},onDismiss:s,isOpen:!0})},title:"Disconnects this panel from the library panel so that you can edit it regularly.",key:"unlink"},"Unlink"))),a.pop()),a}renderOptionsPane(){const{plugin:t,dashboard:a,panel:r,instanceState:s}=this.props;return t?e.createElement(hr,{plugin:t,dashboard:a,panel:r,instanceState:s,onFieldConfigsChange:this.onFieldConfigChange,onPanelOptionsChanged:this.onPanelOptionsChanged,onPanelConfigChange:this.onPanelConfigChanged}):e.createElement("div",null)}renderToolbar(){return f.v.featureToggles.topnav?e.createElement(ra.A,{actions:e.createElement(ta.R,{alignment:"right"},this.renderEditorActions())}):e.createElement(na.X,{title:this.props.dashboard.title,section:"Edit Panel",onGoBack:this.onGoBackToDashboard},this.renderEditorActions())}render(){const{initDone:t,uiState:a,theme:r,sectionNav:s,pageNav:i,className:l,updatePanelEditorUIState:d}=this.props,c=Cs(r,this.props);return t?e.createElement(he.T,{navModel:s,pageNav:i,"aria-label":b.wl.components.PanelEditor.General.content,layout:L.Qz.Custom,toolbar:this.renderToolbar(),className:l},e.createElement("div",{className:c.wrapper},e.createElement("div",{className:c.verticalSplitPanesWrapper},a.isPanelOptionsVisible?e.createElement(bt.U,{splitOrientation:"vertical",maxSize:-300,paneSize:a.rightPaneSize,primary:"second",onDragFinished:p=>{p&&d({rightPaneSize:p/window.innerWidth})}},this.renderPanelAndEditor(a,c),this.renderOptionsPane()):this.renderPanelAndEditor(a,c)),this.state.showSaveLibraryPanelModal&&e.createElement(ot,{panel:this.props.panel,folderUid:this.props.dashboard.meta.folderUid??"",onConfirm:this.onConfirmAndDismissLibarayPanelModel,onDiscard:this.onDiscard,onDismiss:this.onConfirmAndDismissLibarayPanelModel}))):null}}const Ps=(0,y.HE)(bs(ys)),Cs=(0,aa.B)((n,t)=>{const{uiState:a}=t,r=n.spacing(2);return{wrapper:(0,m.css)({width:"100%",flexGrow:1,minHeight:0,display:"flex",paddingTop:f.v.featureToggles.topnav?n.spacing(2):0}),verticalSplitPanesWrapper:m.css`
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      position: relative;
    `,mainPaneWrapper:m.css`
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      padding-right: ${a.isPanelOptionsVisible?0:r};
    `,variablesWrapper:m.css`
      label: variablesWrapper;
      display: flex;
      flex-grow: 1;
      flex-wrap: wrap;
      gap: ${n.spacing(1,2)};
    `,panelWrapper:m.css`
      flex: 1 1 0;
      min-height: 0;
      width: 100%;
      padding-left: ${r};
    `,tabsWrapper:m.css`
      height: 100%;
      width: 100%;
    `,panelToolbar:m.css`
      display: flex;
      padding: 0 0 ${r} ${r};
      justify-content: space-between;
      flex-wrap: wrap;
    `,toolbarLeft:m.css`
      padding-left: ${n.spacing(1)};
    `,centeringContainer:m.css`
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      flex-direction: column;
    `,onlyPanel:m.css`
      height: 100%;
      position: absolute;
      overflow: hidden;
      width: 100%;
    `}});var Ss=o(11543),Ts=o(81764),xs=o(8861),Ds=o(87865);const Os=({annotation:n,events:t,onEnabledChanged:a})=>{const[r,s]=(0,e.useState)(!1),i=(0,y.wW)(ws),l=()=>(0,Ds.kt)().cancel(n);return(0,e.useEffect)(()=>{const d=t.getStream(j.z).subscribe({next:p=>{p.payload===n&&s(!0)}}),c=t.getStream(j.RB).subscribe({next:p=>{p.payload===n&&s(!1)}});return()=>{d.unsubscribe(),c.unsubscribe()}}),e.createElement("div",{key:n.name,className:i.annotation},e.createElement(Ss.Z,null,e.createElement(Ts._,{label:n.name,disabled:r},e.createElement(ne.x,{value:n.enable,onChange:()=>a(n),disabled:r})),e.createElement("div",{className:i.indicator},e.createElement(xs.T,{loading:r,onCancel:l}))))};function ws(n){return{annotation:m.css`
      display: inline-block;
      margin-right: ${n.spacing(1)};

      .fa-caret-down {
        font-size: 75%;
        padding-left: ${n.spacing(1)};
      }

      .gf-form-inline .gf-form {
        margin-bottom: 0;
      }
    `,indicator:m.css`
      align-self: center;
      padding: 0 ${n.spacing(.5)};
    `}}const Is=({annotations:n,onAnnotationChanged:t,events:a})=>{const[r,s]=(0,e.useState)([]);return(0,e.useEffect)(()=>{s(n.filter(i=>i.hide!==!0))},[n]),r.length===0?null:e.createElement(e.Fragment,null,r.map(i=>e.createElement(Os,{events:a,annotation:i,onEnabledChanged:t,key:i.name})))};var Rs=o(58252),qe=o(68004),Ns=o(18428),Ms=o(29930);const $s=n=>{const{link:t,linkInfo:a}=n,r=(0,e.useRef)(null),[s,i]=(0,e.useState)("invisible"),[l,d]=(0,e.useState)(0),c=As(n,l),p=(0,y.wW)(Us);return(0,e.useLayoutEffect)(()=>{i(zs(r.current))},[c]),t.asDropdown?e.createElement(tn,{link:t,key:"dashlinks-dropdown","data-testid":b.wl.components.DashboardLinks.dropDown},e.createElement(e.Fragment,null,e.createElement(De.h,{onClick:()=>d(Date.now()),className:(0,m.cx)("gf-form-label gf-form-label--dashlink",p.button),"data-placement":"bottom","data-toggle":"dropdown","aria-expanded":!!l,"aria-controls":"dropdown-list","aria-haspopup":"menu"},e.createElement(T.J,{"aria-hidden":!0,name:"bars",className:p.iconMargin}),e.createElement("span",null,a.title)),e.createElement("ul",{id:"dropdown-list",className:`dropdown-menu ${p.dropdown} ${s}`,role:"menu",ref:r},c.length>0&&c.map((u,g)=>e.createElement("li",{role:"none",key:`dashlinks-dropdown-item-${u.uid}-${g}`},e.createElement("a",{role:"menuitem",href:u.url,target:t.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":b.wl.components.DashboardLinks.link,"aria-label":`${u.title} dashboard`},u.title)))))):e.createElement(e.Fragment,null,c.length>0&&c.map((u,g)=>e.createElement(tn,{link:t,key:`dashlinks-list-item-${u.uid}-${g}`,"data-testid":b.wl.components.DashboardLinks.container},e.createElement("a",{className:"gf-form-label gf-form-label--dashlink",href:u.url,target:t.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":b.wl.components.DashboardLinks.link,"aria-label":`${u.title} dashboard`},e.createElement(T.J,{"aria-hidden":!0,name:"apps",style:{marginRight:"4px"}}),e.createElement("span",null,u.title)))))},tn=n=>{const{link:t,children:a,...r}=n;return e.createElement("div",{...r,className:"gf-form"},t.tooltip&&e.createElement(ce.u,{content:t.tooltip},a),!t.tooltip&&e.createElement(e.Fragment,null,a))},As=({link:n,dashboardUID:t},a)=>{const{tags:r}=n,s=(0,fe.Z)(()=>Ls(r),[r,a]);return s.value?Fs(t,n,s.value):[]};async function Ls(n,t={getBackendSrv:Ms.i}){return await t.getBackendSrv().search({tag:n,limit:100})}function Fs(n,t,a,r={getLinkSrv:we.Bq,sanitize:qe.Nw,sanitizeUrl:qe.Nm}){return a.filter(s=>s.uid!==n).map(s=>{const i=s.uid,l=r.sanitize(s.title),d=r.getLinkSrv().getLinkUrl({...t,url:s.url}),c=r.sanitizeUrl(d);return{uid:i,title:l,url:c}})}function zs(n){if(!n)return"invisible";const t=n.parentElement.getBoundingClientRect(),a=n.getBoundingClientRect();return a.width===0?"invisible":t.left+a.width+10>window.innerWidth?"pull-left":"pull-right"}function Us(n){return{iconMargin:(0,m.css)({marginRight:n.spacing(.5)}),dropdown:(0,m.css)({maxWidth:"max(30vw, 300px)",maxHeight:"70vh",overflowY:"auto",a:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}),button:(0,m.css)({color:n.colors.text.primary})}}const Bs=({dashboard:n,links:t})=>{const a=(0,Bt.N)();return(0,Rs.Z)(()=>{const r=n.events.subscribe(zt.md,a);return()=>r.unsubscribe()}),t.length?e.createElement(e.Fragment,null,t.map((r,s)=>{const i=(0,we.Bq)().getAnchorInfo(r),l=`${r.title}-$${s}`;if(r.type==="dashboards")return e.createElement($s,{key:l,link:r,linkInfo:i,dashboardUID:n.uid});const d=Ns.xy[r.icon],c=e.createElement("a",{className:"gf-form-label gf-form-label--dashlink",href:(0,qe.Nm)(i.href),target:r.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":b.wl.components.DashboardLinks.link},d&&e.createElement(T.J,{"aria-hidden":!0,name:d,style:{marginRight:"4px"}}),e.createElement("span",null,i.title));return e.createElement("div",{key:l,className:"gf-form","data-testid":b.wl.components.DashboardLinks.container},r.tooltip?e.createElement(ce.u,{content:i.tooltip},c):c)})):null};class Vs extends e.PureComponent{constructor(){super(...arguments),this.onAnnotationStateChanged=t=>{for(let a=0;a<this.props.dashboard.annotations.list.length;a++){const r=this.props.dashboard.annotations.list[a];if(r.name===t.name){r.enable=!r.enable;break}}this.props.dashboard.startRefresh(),this.forceUpdate()}}render(){const{dashboard:t,variables:a,links:r,annotations:s}=this.props;if(!t.isSubMenuVisible())return null;const i=t.meta.isSnapshot??!1;return e.createElement("div",{className:"submenu-controls"},e.createElement("form",{"aria-label":"Template variables",className:ks},e.createElement(yt,{variables:a,readOnly:i})),e.createElement(Is,{annotations:s,onAnnotationChanged:this.onAnnotationStateChanged,events:t.events}),e.createElement("div",{className:"gf-form gf-form--grow"}),t&&e.createElement(Bs,{dashboard:t,links:r}))}}const Ws=(n,t)=>{const{uid:a}=t.dashboard,r=(0,ke.AE)(a,n);return{variables:(0,ke.IV)(a,r.variables)}},ks=m.css`
  display: flex;
  flex-wrap: wrap;
  display: contents;
`,nn=(0,A.connect)(Ws)(Vs);nn.displayName="SubMenu";var an=o(33088),Hs=o(6911),Ks=o(86977);const rn=n=>({initPhase:n.dashboard.initPhase,initError:n.dashboard.initError,dashboard:n.dashboard.getModel(),navIndex:n.navIndex}),Gs={initDashboard:Se.mV,cleanUpDashboardAndVariables:Ks.lw,notifyApp:F.$l,cancelVariables:rt.wX,templateVarsChangedInUrl:rt.xs},js=(0,A.connect)(rn,Gs);class _e extends e.PureComponent{constructor(){super(...arguments),this.forceRouteReloadCounter=0,this.state=this.getCleanState(),this.onFileDrop=(t,a,r)=>{const s={type:"grafana",uid:"grafana"};ee.eM(t).subscribe(i=>{const l=[];i.dataFrames.forEach(d=>{const c=(0,K.Y)(d);l.push(c)}),this.props.dashboard?.addPanel({type:"table",gridPos:{x:0,y:0,w:12,h:8},title:i.file.name,datasource:s,targets:[{queryType:dn.hR.Snapshot,snapshot:l,file:{name:i.file.name,size:i.file.size},datasource:s}]})}),a.forEach(i=>{const l=i.errors.map(d=>{switch(d.code){case w.jK.FileTooLarge:const c=(0,N.Cf)("decbytes")(ee.dg);return`File size must be less than ${(0,N.zc)(c)}.`;case w.jK.FileInvalidType:return`File type must be one of the following types ${ee._H(ee.DK)}.`;default:return d.message}});this.props.notifyApp((0,$e.t_)(`Failed to load ${i.file.name}`,void 0,void 0,e.createElement("ul",null,l.map(d=>e.createElement("li",{key:d},d)))))})},this.updateLiveTimer=()=>{let t;this.props.dashboard?.liveNow&&(t=(0,ie.$t)().timeRange()),Hs.A.setLiveTimeRange(t)},this.onAddPanel=()=>{const{dashboard:t}=this.props;t&&(t.panels.length>0&&t.panels[0].type==="add-panel"||(t.addPanel({type:"add-panel",gridPos:(0,Ut.lg)(t),title:"Panel Title"}),this.setState({updateScrollTop:0})))},this.setScrollRef=t=>{this.setState({scrollElement:t})}}getCleanState(){return{editPanel:null,viewPanel:null,showLoadingState:!1,panelNotFound:!1,editPanelAccessDenied:!1}}componentDidMount(){this.initDashboard(),this.forceRouteReloadCounter=this.props.history.location.state?.routeReloadCounter||0}componentWillUnmount(){this.closeDashboard()}closeDashboard(){this.props.cleanUpDashboardAndVariables(),this.setState(this.getCleanState())}initDashboard(){const{dashboard:t,match:a,queryParams:r}=this.props;t&&this.closeDashboard(),this.props.initDashboard({urlSlug:a.params.slug,urlUid:a.params.uid,urlType:a.params.type,urlFolderUid:r.folderUid,panelType:r.panelType,routeName:this.props.route.routeName,fixUrl:!0,accessToken:a.params.accessToken,keybindingSrv:this.context.keybindings}),setTimeout(this.updateLiveTimer,250)}componentDidUpdate(t,a){const{dashboard:r,match:s,templateVarsChangedInUrl:i}=this.props,l=this.props.history.location.state?.routeReloadCounter;if(r){if(t.match.params.uid!==s.params.uid||l!==void 0&&this.forceRouteReloadCounter!==l){this.initDashboard(),this.forceRouteReloadCounter=l;return}if(t.location.search!==this.props.location.search){const d=t.queryParams,c=this.props.queryParams;(c?.from!==d?.from||c?.to!==d?.to)&&((0,ie.$t)().updateTimeRangeFromUrl(),this.updateLiveTimer()),!d?.refresh&&c?.refresh&&(0,ie.$t)().setAutoRefresh(c.refresh);const p=(0,un.xT)(this.props.queryParams,t.queryParams);p&&i(r.uid,p)}this.state.editPanel&&!a.editPanel&&(tt.H.setEditingState(!0),this.props.dashboard?.events.publish(new j.xF(this.state.editPanel.id))),!this.state.editPanel&&a.editPanel&&(tt.H.setEditingState(!1),this.props.dashboard?.events.publish(new j.Yr(a.editPanel.id))),this.state.editPanelAccessDenied&&(this.props.notifyApp((0,$e.t_)("Permission to edit panel denied")),h.E1.partial({editPanel:null})),this.state.panelNotFound&&(this.props.notifyApp((0,$e.t_)("Panel not found")),h.E1.partial({editPanel:null,viewPanel:null}))}}static getDerivedStateFromProps(t,a){const{dashboard:r,queryParams:s}=t,i=s.editPanel,l=s.viewPanel;if(!r)return a;const d={...a};if(!a.editPanel&&i){const c=r.getPanelByUrlId(i);c?r.canEditPanel(c)?(d.editPanel=c,d.rememberScrollTop=a.scrollElement?.scrollTop):d.editPanelAccessDenied=!0:d.panelNotFound=!0}else a.editPanel&&!i&&(d.editPanel=null,d.updateScrollTop=a.rememberScrollTop);if(!a.viewPanel&&l){const c=r.getPanelByUrlId(l);c?(r.initViewPanel(c),d.viewPanel=c,d.rememberScrollTop=a.scrollElement?.scrollTop,d.updateScrollTop=0):d.panelNotFound=!0}else a.viewPanel&&!l&&(r.exitViewPanel(a.viewPanel),d.viewPanel=null,d.updateScrollTop=a.rememberScrollTop);return(a.panelNotFound||a.editPanelAccessDenied&&!i)&&(d.panelNotFound=!1,d.editPanelAccessDenied=!1),Zs(t,d)}getInspectPanel(){const{dashboard:t,queryParams:a}=this.props,r=a.inspect;if(!t||!r)return null;const s=t.getPanelById(parseInt(r,10));return s||null}render(){const{dashboard:t,initError:a,queryParams:r}=this.props,{editPanel:s,viewPanel:i,updateScrollTop:l,pageNav:d,sectionNav:c}=this.state,p=(0,ln.U)(this.props.queryParams);if(!t||!d||!c)return e.createElement(gn.B,{initPhase:this.props.initPhase});const u=this.getInspectPanel(),g=!s&&!p&&!this.props.queryParams.editview,E=p!==z.KioskMode.Full&&!r.editview&&e.createElement("header",{"data-testid":b.wl.pages.Dashboard.DashNav.navV2},e.createElement(pn.t,{dashboard:t,title:t.title,folderTitle:t.meta.folderTitle,isFullscreen:!!i,onAddPanel:this.onAddPanel,kioskMode:p,hideTimePicker:t.timepicker.hidden,shareModalActiveTab:this.props.queryParams.shareView})),v=(0,m.cx)({"panel-in-fullscreen":Boolean(i),"page-hidden":Boolean(r.editview||s)});return e.createElement(e.Fragment,null,e.createElement(he.T,{navModel:c,pageNav:d,layout:L.Qz.Canvas,toolbar:E,className:v,scrollRef:this.setScrollRef,scrollTop:l},e.createElement(ct,{dashboard:t}),a&&e.createElement(mn.u,null),t.meta.dashboardNotFound?e.createElement(M.Z,null):e.createElement(e.Fragment,null,g&&e.createElement("section",{"aria-label":b.wl.pages.Dashboard.SubMenu.submenu},e.createElement(nn,{dashboard:t,annotations:t.annotations.list,links:t.links})),f.v.featureToggles.editPanelCSVDragAndDrop?e.createElement(B.ZP,{onDrop:this.onFileDrop,accept:ee.DK,maxSize:ee.dg,noClick:!0},({getRootProps:P,isDragActive:C})=>{const O=Js(this.props.theme,C);return e.createElement("div",{...P({className:O.dropZone})},e.createElement("div",{className:O.dropOverlay},e.createElement("div",{className:O.dropHint},e.createElement(T.J,{name:"upload",size:"xxxl"}),e.createElement("h3",null,"Create tables from spreadsheets"))),e.createElement(an.Z,{dashboard:t,isEditable:!!t.meta.canEdit,viewPanel:i,editPanel:s}))}):e.createElement(an.Z,{dashboard:t,isEditable:!!t.meta.canEdit,viewPanel:i,editPanel:s}),u&&e.createElement(ea,{dashboard:t,panel:u}))),s&&e.createElement(Ps,{dashboard:t,sourcePanel:s,tab:this.props.queryParams.tab,sectionNav:c,pageNav:d}),r.editview&&e.createElement(wn.D,{dashboard:t,editview:r.editview,pageNav:d,sectionNav:c}))}}_e.contextType=on.h;function Zs(n,t){const{dashboard:a}=n;if(!a)return t;let r=t.pageNav,s=t.sectionNav;(!r||a.title!==r.text)&&(r={text:a.title,url:V.u.getUrlForPartial(n.history.location,{editview:null,editPanel:null,viewPanel:null})});const{folderTitle:i,folderUid:l}=a.meta;if(i&&l&&r&&r.parentItem?.text!==i&&(r={...r,parentItem:{text:i,url:`/dashboards/f/${a.meta.folderUid}`}}),n.route.routeName===z.DashboardRoutes.Path){s=at();const d=nt(n.match.params.slug);d?.parentItem&&(d.parentItem=d.parentItem)}else s=(0,cn.ht)(n.navIndex,f.v.featureToggles.topnav?"dashboards/browse":"dashboards");return(t.editPanel||t.viewPanel)&&(r={...r,text:`${t.editPanel?"Edit":"View"} panel`,parentItem:r,url:void 0}),t.pageNav===r&&t.sectionNav===s?t:{...t,pageNav:r,sectionNav:s}}function Js(n,t){return{dropZone:m.css`
      height: 100%;
    `,dropOverlay:m.css`
      background-color: ${t?n.colors.action.hover:"inherit"};
      border: ${t?`2px dashed ${n.colors.border.medium}`:0};
      position: absolute;
      display: ${t?"flex":"none"};
      z-index: ${n.zIndex.modal};
      top: 0px;
      left: 0px;
      height: 100%;
      width: 100%;
      align-items: center;
      justify-content: center;
    `,dropHint:m.css`
      align-items: center;
      display: flex;
      flex-direction: column;
    `}}const et=(0,y.HE)(_e);et.displayName="DashboardPage";const Qs=js(et)},66959:(re,k,o)=>{o.r(k),o.d(k,{default:()=>L});var m=o(68404),e=o(35645),w=o(35287),B=o(87513),A=o(25e3),K=o(81168),N=o(98695);function L(V){const{isLoading:b}=(0,A.zJ)(),{hasDatasource:h}=(0,K.useSelector)(F=>({hasDatasource:F.dataSources.dataSourcesCount>0})),[f,T]=(0,m.useState)(!1);return h||f||!e.v.featureToggles.datasourceOnboarding?m.createElement(N.default,{...V}):m.createElement(B.O,{onCTAClick:()=>T(!0),loading:b,title:(0,w.t)("datasource-onboarding.welcome","Welcome to Grafana dashboards!"),CTAText:(0,w.t)("datasource-onboarding.sampleData","Or set up a new dashboard with sample data"),navId:"dashboards/browse",pageNav:{text:(0,w.t)("datasource-onboarding.new-dashboard","New dashboard"),url:"/dashboard/new"}})}},81704:(re,k,o)=>{o.r(k),o.d(k,{default:()=>K});var m=o(68404),e=o(86647),w=o(37932),B=o(79396),A=o(87464);function K(N){const[L,V]=(0,m.useState)(null),{datasourceUid:b}=N.match.params;return(0,m.useEffect)(()=>{const h=(0,e.F)().getInstanceSettings(b);if(!h){V("Data source not found");return}const f=(0,A.ZQ)(),{dashboard:T}=f;T.panels[0]={...T.panels[0],datasource:{uid:h.uid,type:h.type}},(0,A.$M)(f),w.E1.replace("/dashboard/new")},[b]),L?m.createElement(B.T,{navId:"dashboards"},m.createElement(B.T.Contents,null,m.createElement("div",null,'Data source with UID "',b,'" not found.'))):null}},63163:(re,k,o)=>{o.d(k,{$:()=>V,J:()=>N});var m=o(70006),e=o(36512),w=o(54899),B=o(35645),A=o(29930);class K{constructor(){}async get(h){const f=`api/storage/read/${h}`.replace("//","/");return(0,w.i)().get(f)}async list(h){let f="api/storage/list/";h&&(f+=h+"/");const T=await(0,w.i)().get(f);if(T?.data){const y=(0,m.vP)(T);for(const F of y.fields)F.display=(0,e.U_)({field:F,theme:B.v.theme2});return y}}async createFolder(h){const f=await(0,w.i)().post("/api/storage/createFolder",JSON.stringify({path:h}));return f.success?{}:{error:f.message??"unknown error"}}async deleteFolder(h){const f=await(0,w.i)().post("/api/storage/deleteFolder",JSON.stringify(h));return f.success?{}:{error:f.message??"unknown error"}}async deleteFile(h){const f=await(0,w.i)().post(`/api/storage/delete/${h.path}`);return f.success?{}:{error:f.message??"unknown error"}}async delete(h){return h.isFolder?this.deleteFolder({path:h.path,force:!0}):this.deleteFile({path:h.path})}async upload(h,f,T){const y=new FormData;y.append("folder",h),y.append("file",f),y.append("overwriteExistingFile",String(T));const F=await fetch("/api/storage/upload",{method:"POST",body:y});let M=await F.json();return M||(M={}),M.status=F.status,M.statusText=F.statusText,F.status!==200&&!M.err&&(M.err=!0),M}async write(h,f){return A.ae.post(`/api/storage/write/${h}`,f)}async getConfig(){return(0,w.i)().get("/api/storage/config")}async getOptions(h){return(0,w.i)().get(`/api/storage/options/${h}`)}}function N(b,h){const T=b.toLowerCase().trim();return h.map(F=>F.trim().toLowerCase()).includes(T)}let L;function V(){return L||(L=new K),L}},92465:(re,k,o)=>{o.d(k,{M:()=>K});var m=o(68404),e=o(89890),w=o(85854),B=o(53217);const A=(N,L,V)=>{if(!V)return;let b=N.find(h=>!L.some(f=>h===f));if(b)return b},K=({value:N,context:L,onChange:V,item:b})=>{const h=(0,m.useMemo)(()=>L.data.map(M=>({value:M.refId,label:`Query: ${M.refId} (size: ${M.length})`,description:M.fields.map(he=>(0,e.C)(he)).join(", ")})),[L.data]),[f,T]=(0,m.useState)({refIds:[],value:void 0}),y=(0,m.useMemo)(()=>h.find(M=>M.value===N?.options)??A(h,f.refIds,f.value),[N,h,f]),F=(0,m.useCallback)(M=>{V(M?.value?{id:w.E4.byRefId,options:M.value}:void 0)},[V]);return(h!==f.refIds||y?.value!==f.value)&&T({refIds:h,value:y?.value}),m.createElement(B.Ph,{options:h,onChange:F,isClearable:!0,placeholder:"Change filter",value:y})}}}]);

//# sourceMappingURL=8232.2825cd18d84351aa1151.js.map