(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{sl8e:function(e,t,r){"use strict";r.r(t);var a=r("mrSG"),n=r("LvDl"),s=r.n(n),i=r("Obii"),o=r("iZOS"),u=function(){function e(e){this.series=e.series,this.alias=e.alias,this.annotation=e.annotation}return e.prototype.getTimeSeries=function(){var e,t,r=this,a=[];return 0===this.series.length?a:(s.a.each(this.series,function(n){var i=n.columns.length,o=s.a.map(n.tags,function(e,t){return t+": "+e});for(t=1;t<i;t++){var u=n.name,l=n.columns[t];"value"!==l&&(u=u+"."+l),r.alias?u=r._getSeriesName(n,t):n.tags&&(u=u+" {"+o.join(", ")+"}");var p=[];if(n.values)for(e=0;e<n.values.length;e++)p[e]=[n.values[e][t],n.values[e][0]];a.push({target:u,datapoints:p})}}),a)},e.prototype._getSeriesName=function(e,t){var r=e.name.split(".");return this.alias.replace(/\$(\w+)|\[\[([\s\S]+?)\]\]/g,function(a,n,s){var i=n||s,o=parseInt(i,10);if("m"===i||"measurement"===i)return e.name;if("col"===i)return e.columns[t];if(!isNaN(o))return r[o];if(0!==i.indexOf("tag_"))return a;var u=i.replace("tag_","");return e.tags?e.tags[u]:a})},e.prototype.getAnnotations=function(){var e=this,t=[];return s.a.each(this.series,function(r){var a=null,n=null,i=[],o=null;s.a.each(r.columns,function(t,r){"time"!==t?"sequence_number"!==t&&(t!==e.annotation.titleColumn?s.a.includes((e.annotation.tagsColumn||"").replace(" ","").split(","),t)?i.push(r):t!==e.annotation.textColumn?a||o===r||(a=r):o=r:a=r):n=r}),s.a.each(r.values,function(r){var u={annotation:e.annotation,time:+new Date(r[n]),title:r[a],tags:s.a.flatten(i.filter(function(e){return r[e]}).map(function(e){return r[e].split(",")})),text:r[o]};t.push(u)})}),t},e.prototype.getTable=function(){var e,t,r=new o.a;return 0===this.series.length?r:(s.a.each(this.series,function(a,n){if(0===n)for(t=0,"time"===a.columns[0]&&(r.columns.push({text:"Time",type:i.FieldType.time}),t++),s.a.each(s.a.keys(a.tags),function(e){r.columns.push({text:e})});t<a.columns.length;t++)r.columns.push({text:a.columns[t]});if(a.values)for(e=0;e<a.values.length;e++){var o=a.values[e],u=[o[0]];if(a.tags)for(var l in a.tags)a.tags.hasOwnProperty(l)&&u.push(a.tags[l]);for(t=1;t<o.length;t++)u.push(o[t]);r.rows.push(u)}}),r)},e}(),l=r("QNPh"),p=[],c={Aggregations:[],Selectors:[],Transformations:[],Predictors:[],Math:[],Aliasing:[],Fields:[]};function m(e){var t=p[e.type];if(!t)throw{message:"Could not find query part "+e.type};return new l.a(e,t)}function d(e){p[e.type]=new l.b(e),e.category.push(p[e.type])}var h=[];function g(e,t){return"*"===e.params[0]?"*":'"'+e.params[0]+'"'}function f(e,t){for(var r=0;r<e.length;r++){var a=e[r];if(a.def.category===c.Aggregations){if(a.def.type===t.def.type)return;if("count"===a.def.type&&"distinct"===t.def.type)break;if("distinct"===a.def.type){var n=e.length>=r+2;if("count"!==t.def.type&&n)e[r+1].def.category===c.Aggregations&&e.splice(r+1,1);else if("count"===t.def.type)return void(n&&"count"===e[r+1].def.type||e.splice(r+1,0,t))}return void(e[r]=t)}if(a.def.category===c.Selectors)return void(e[r]=t)}e.splice(1,0,t)}function y(e,t){var r;for(r=0;r<e.length;r++){var a=e[r];if(a.def.category===c.Math||a.def.category===c.Aliasing)break}e.splice(r,0,t)}d({type:"field",addStrategy:function(e,t,r){var a=s.a.map(e,function(e){return m({type:e.def.type,params:s.a.clone(e.params)})});r.selectModels.push(a)},category:c.Fields,params:[{type:"field",dynamicLookup:!0}],defaultParams:["value"],renderer:g}),d({type:"count",addStrategy:f,category:c.Aggregations,params:[],defaultParams:[],renderer:l.c}),d({type:"distinct",addStrategy:f,category:c.Aggregations,params:[],defaultParams:[],renderer:l.c}),d({type:"integral",addStrategy:f,category:c.Aggregations,params:[],defaultParams:[],renderer:l.c}),d({type:"mean",addStrategy:f,category:c.Aggregations,params:[],defaultParams:[],renderer:l.c}),d({type:"median",addStrategy:f,category:c.Aggregations,params:[],defaultParams:[],renderer:l.c}),d({type:"mode",addStrategy:f,category:c.Aggregations,params:[],defaultParams:[],renderer:l.c}),d({type:"sum",addStrategy:f,category:c.Aggregations,params:[],defaultParams:[],renderer:l.c}),d({type:"derivative",addStrategy:y,category:c.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:l.c}),d({type:"spread",addStrategy:y,category:c.Transformations,params:[],defaultParams:[],renderer:l.c}),d({type:"non_negative_derivative",addStrategy:y,category:c.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:l.c}),d({type:"difference",addStrategy:y,category:c.Transformations,params:[],defaultParams:[],renderer:l.c}),d({type:"non_negative_difference",addStrategy:y,category:c.Transformations,params:[],defaultParams:[],renderer:l.c}),d({type:"moving_average",addStrategy:y,category:c.Transformations,params:[{name:"window",type:"int",options:[5,10,20,30,40]}],defaultParams:[10],renderer:l.c}),d({type:"cumulative_sum",addStrategy:y,category:c.Transformations,params:[],defaultParams:[],renderer:l.c}),d({type:"stddev",addStrategy:y,category:c.Transformations,params:[],defaultParams:[],renderer:l.c}),d({type:"time",category:h,params:[{name:"interval",type:"time",options:["$__interval","1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["$__interval"],renderer:l.c}),d({type:"fill",category:h,params:[{name:"fill",type:"string",options:["none","null","0","previous","linear"]}],defaultParams:["null"],renderer:l.c}),d({type:"elapsed",addStrategy:y,category:c.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:l.c}),d({type:"holt_winters",addStrategy:y,category:c.Predictors,params:[{name:"number",type:"int",options:[5,10,20,30,40]},{name:"season",type:"int",options:[0,1,2,5,10]}],defaultParams:[10,2],renderer:l.c}),d({type:"holt_winters_with_fit",addStrategy:y,category:c.Predictors,params:[{name:"number",type:"int",options:[5,10,20,30,40]},{name:"season",type:"int",options:[0,1,2,5,10]}],defaultParams:[10,2],renderer:l.c}),d({type:"bottom",addStrategy:f,category:c.Selectors,params:[{name:"count",type:"int"}],defaultParams:[3],renderer:l.c}),d({type:"first",addStrategy:f,category:c.Selectors,params:[],defaultParams:[],renderer:l.c}),d({type:"last",addStrategy:f,category:c.Selectors,params:[],defaultParams:[],renderer:l.c}),d({type:"max",addStrategy:f,category:c.Selectors,params:[],defaultParams:[],renderer:l.c}),d({type:"min",addStrategy:f,category:c.Selectors,params:[],defaultParams:[],renderer:l.c}),d({type:"percentile",addStrategy:f,category:c.Selectors,params:[{name:"nth",type:"int"}],defaultParams:[95],renderer:l.c}),d({type:"top",addStrategy:f,category:c.Selectors,params:[{name:"count",type:"int"}],defaultParams:[3],renderer:l.c}),d({type:"tag",category:h,params:[{name:"tag",type:"string",dynamicLookup:!0}],defaultParams:["tag"],renderer:g}),d({type:"math",addStrategy:function(e,t){var r=e.length;if(r>0){if("math"===e[r-1].def.type)return void(e[r-1]=t);if(r>1&&"math"===e[r-2].def.type)return void(e[r-2]=t);if("alias"===e[r-1].def.type)return void e.splice(r-1,0,t)}e.push(t)},category:c.Math,params:[{name:"expr",type:"string"}],defaultParams:[" / 100"],renderer:l.d}),d({type:"alias",addStrategy:function(e,t){var r=e.length;r>0&&"alias"===e[r-1].def.type?e[r-1]=t:e.push(t)},category:c.Aliasing,params:[{name:"name",type:"string",quote:"double"}],defaultParams:["alias"],renderMode:"suffix",renderer:function(e,t){return t+' AS "'+e.params[0]+'"'}});var v={create:m,getCategories:function(){return c},replaceAggregationAdd:f},S=r("PbtU"),b=function(){function e(e,t,r){this.target=e,this.templateSrv=t,this.scopedVars=r,e.policy=e.policy||"default",e.resultFormat=e.resultFormat||"time_series",e.orderByTime=e.orderByTime||"ASC",e.tags=e.tags||[],e.groupBy=e.groupBy||[{type:"time",params:["$__interval"]},{type:"fill",params:["null"]}],e.select=e.select||[[{type:"field",params:["value"]},{type:"mean",params:[]}]],this.updateProjection()}return e.$inject=["target","templateSrv","scopedVars"],e.prototype.updateProjection=function(){this.selectModels=s.a.map(this.target.select,function(e){return s.a.map(e,v.create)}),this.groupByParts=s.a.map(this.target.groupBy,v.create)},e.prototype.updatePersistedParts=function(){this.target.select=s.a.map(this.selectModels,function(e){return s.a.map(e,function(e){return{type:e.def.type,params:e.params}})})},e.prototype.hasGroupByTime=function(){return s.a.find(this.target.groupBy,function(e){return"time"===e.type})},e.prototype.hasFill=function(){return s.a.find(this.target.groupBy,function(e){return"fill"===e.type})},e.prototype.addGroupBy=function(e){var t=e.match(/^(\w+)\((.*)\)$/),r=t[1],a=t[2],n=v.create({type:r,params:[a]}),s=this.target.groupBy.length;0===s?this.target.groupBy.push(n.part):"time"===r?this.target.groupBy.splice(0,0,n.part):"tag"===r&&"fill"===this.target.groupBy[s-1].type?this.target.groupBy.splice(s-1,0,n.part):this.target.groupBy.push(n.part),this.updateProjection()},e.prototype.removeGroupByPart=function(e,t){var r=v.getCategories();"time"===e.def.type&&(this.target.groupBy=s.a.filter(this.target.groupBy,function(e){return"fill"!==e.type}),this.target.select=s.a.map(this.target.select,function(e){return s.a.filter(e,function(e){var t=v.create(e);return t.def.category!==r.Aggregations&&t.def.category!==r.Selectors})})),this.target.groupBy.splice(t,1),this.updateProjection()},e.prototype.removeSelect=function(e){this.target.select.splice(e,1),this.updateProjection()},e.prototype.removeSelectPart=function(e,t){if("field"===t.def.type){if(this.selectModels.length>1){var r=s.a.indexOf(this.selectModels,e);this.selectModels.splice(r,1)}}else{var a=s.a.indexOf(e,t);e.splice(a,1)}this.updatePersistedParts()},e.prototype.addSelectPart=function(e,t){var r=v.create({type:t});r.def.addStrategy(e,r,this),this.updatePersistedParts()},e.prototype.renderTagCondition=function(e,t,r){var a="",n=e.operator,s=e.value;return t>0&&(a=(e.condition||"AND")+" "),n||(n=/^\/.*\/$/.test(s)?"=~":"="),"=~"!==n&&"!~"!==n?(r&&(s=this.templateSrv.replace(s,this.scopedVars)),">"!==n&&"<"!==n&&(s="'"+s.replace(/\\/g,"\\\\").replace(/\'/g,"\\'")+"'")):r&&(s=this.templateSrv.replace(s,this.scopedVars,"regex")),a+'"'+e.key+'" '+n+" "+s},e.prototype.getMeasurementAndPolicy=function(e){var t=this.target.policy,r=this.target.measurement||"measurement";return r.match("^/.*/$")?e&&(r=this.templateSrv.replace(r,this.scopedVars,"regex")):r='"'+r+'"',(t="default"!==t?'"'+this.target.policy+'".':"")+r},e.prototype.interpolateQueryStr=function(e,t,r){return t.multi||t.includeAll?"string"==typeof e?S.a.regexEscape(e):"("+s.a.map(e,S.a.regexEscape).join("|")+")":e},e.prototype.render=function(e){var t=this,r=this.target;if(r.rawQuery)return e?this.templateSrv.replace(r.query,this.scopedVars,this.interpolateQueryStr):r.query;var a,n,i="SELECT ";for(a=0;a<this.selectModels.length;a++){var o=this.selectModels[a],u="";for(n=0;n<o.length;n++){u=(c=o[n]).render(u)}a>0&&(i+=", "),i+=u}i+=" FROM "+this.getMeasurementAndPolicy(e)+" WHERE ";var l=s.a.map(r.tags,function(r,a){return t.renderTagCondition(r,a,e)});l.length>0&&(i+="("+l.join(" ")+") AND "),i+="$timeFilter";var p="";for(a=0;a<this.groupByParts.length;a++){var c=this.groupByParts[a];a>0&&(p+="fill"===c.def.type?" ":", "),p+=c.render("")}return p.length&&(i+=" GROUP BY "+p),r.fill&&(i+=" fill("+r.fill+")"),"DESC"===r.orderByTime&&(i+=" ORDER BY time DESC"),r.limit&&(i+=" LIMIT "+r.limit),r.slimit&&(i+=" SLIMIT "+r.slimit),r.tz&&(i+=" tz('"+r.tz+"')"),i},e.prototype.renderAdhocFilters=function(e){var t=this;return s.a.map(e,function(e,r){return t.renderTagCondition(e,r,!0)}).join(" ")},e}(),w=function(){function e(){}return e.prototype.parse=function(e,t){if(!t||0===t.results.length)return[];var r=t.results[0];if(!r.series)return[];var a=e.toLowerCase(),n=a.indexOf("show field keys")>=0||a.indexOf("show retention policies")>=0,i={};return s.a.each(r.series,function(e){s.a.each(e.values,function(e){s.a.isArray(e)?n?E(i,e[0]):void 0!==e[1]?E(i,e[1]):E(i,e[0]):E(i,e)})}),s.a.map(i,function(e){return{text:e.toString()}})},e}();function E(e,t){e[t]=t}var T,x=function(){function e(e,t){this.target=e,this.database=t}return e.prototype.buildExploreQuery=function(e,t,r){var a,n,i;if("TAG_KEYS"===e)a="SHOW TAG KEYS",n=this.target.measurement,i=this.target.policy;else if("TAG_VALUES"===e)a="SHOW TAG VALUES",n=this.target.measurement,i=this.target.policy;else if("MEASUREMENTS"===e)a="SHOW MEASUREMENTS",r&&(a+=" WITH MEASUREMENT =~ /"+S.a.regexEscape(r)+"/");else{if("FIELDS"===e)return n=this.target.measurement,i=this.target.policy,n.match("^/.*/")||(n='"'+n+'"',i&&"default"!==i&&(n=(i='"'+i+'"')+"."+n)),"SHOW FIELD KEYS FROM "+n;if("RETENTION POLICIES"===e)return a='SHOW RETENTION POLICIES on "'+this.database+'"'}if(n&&(n.match("^/.*/")||n.match(/^merge\(.*\)/)||(n='"'+n+'"'),i&&"default"!==i&&(n=(i='"'+i+'"')+"."+n),a+=" FROM "+n),t&&(a+=' WITH KEY = "'+t+'"'),this.target.tags&&this.target.tags.length>0){var o=s.a.reduce(this.target.tags,function(e,r){return r.key===t?e:(e.push(function(e,t){var r="",a=e.operator,n=e.value;return t>0&&(r=(e.condition||"AND")+" "),a||(a=/^\/.*\/$/.test(e.value)?"=~":"="),"=~"!==a&&"!~"!==a&&isNaN(+n)&&(n="'"+n+"'"),r+'"'+e.key+'" '+a+" "+n}(r,e.length)),e)},[]);o.length>0&&(a+=" WHERE "+o.join(" "))}return"MEASUREMENTS"===e&&(a+=" LIMIT 100"),a},e}(),P=r("kDLi"),C=function(e){function t(t,r,a,n){var i=e.call(this,t)||this;i.$q=r,i.backendSrv=a,i.templateSrv=n,i.type="influxdb",i.urls=s.a.map(t.url.split(","),function(e){return e.trim()}),i.username=t.username,i.password=t.password,i.name=t.name,i.database=t.database,i.basicAuth=t.basicAuth,i.withCredentials=t.withCredentials;var o=t.jsonData||{};return i.interval=o.timeInterval,i.httpMode=o.httpMode||"GET",i.responseParser=new w,i}return t.$inject=["instanceSettings","$q","backendSrv","templateSrv"],a.c(t,e),t.prototype.query=function(e){var t,r,a,n=this,i=this.getTimeFilter(e),o=e.scopedVars,l=s.a.cloneDeep(e.targets),p=[],c=s.a.map(l,function(e){return e.hide?"":(p.push(e),o.interval=o.__interval,(t=new b(e,n.templateSrv,o)).render(!0))}).reduce(function(e,t){return""!==t&&(e+=";"+t),e});if(""===c)return this.$q.when({data:[]});var m=this.templateSrv.getAdhocFilters(this.name);return m.length>0&&(i+=" AND "+t.renderAdhocFilters(m)),o.timeFilter={value:i},c=this.templateSrv.replace(c,o),this._seriesQuery(c,e).then(function(t){if(!t||!t.results)return[];var s=[];for(r=0;r<t.results.length;r++){var i=t.results[r];if(i&&i.series){var o=p[r],l=o.alias;l&&(l=n.templateSrv.replace(o.alias,e.scopedVars));var c=new u({series:t.results[r].series,alias:l});switch(o.resultFormat){case"table":s.push(c.getTable());break;default:var m=c.getTimeSeries();for(a=0;a<m.length;a++)s.push(m[a])}}}return{data:s}})},t.prototype.annotationQuery=function(e){if(!e.annotation.query)return this.$q.reject({message:"Query missing in annotation definition"});var t=this.getTimeFilter({rangeRaw:e.rangeRaw,timezone:e.timezone}),r=e.annotation.query.replace("$timeFilter",t);return r=this.templateSrv.replace(r,null,"regex"),this._seriesQuery(r,e).then(function(t){if(!t||!t.results||!t.results[0])throw{message:"No results in response from InfluxDB"};return new u({series:t.results[0].series,annotation:e.annotation}).getAnnotations()})},t.prototype.targetContainsTemplate=function(e){var t,r,n,s;try{for(var i=a.i(e.groupBy),o=i.next();!o.done;o=i.next()){var u=o.value;try{for(var l=(n=void 0,a.i(u.params)),p=l.next();!p.done;p=l.next()){var c=p.value;if(this.templateSrv.variableExists(c))return!0}}catch(e){n={error:e}}finally{try{p&&!p.done&&(s=l.return)&&s.call(l)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}for(var m in e.tags)if(this.templateSrv.variableExists(e.tags[m].value))return!0;return!1},t.prototype.metricFindQuery=function(e,t){var r=this.templateSrv.replace(e,null,"regex");return this._seriesQuery(r,t).then(s.a.curry(this.responseParser.parse)(e))},t.prototype.getTagKeys=function(e){void 0===e&&(e={});var t=new x({measurement:e.measurement||"",tags:[]},this.database).buildExploreQuery("TAG_KEYS");return this.metricFindQuery(t,e)},t.prototype.getTagValues=function(e){void 0===e&&(e={});var t=new x({measurement:e.measurement||"",tags:[]},this.database).buildExploreQuery("TAG_VALUES",e.key);return this.metricFindQuery(t,e)},t.prototype._seriesQuery=function(e,t){if(!e)return this.$q.when({results:[]});if(t&&t.range){var r=this.getTimeFilter({rangeRaw:t.range,timezone:t.timezone});e=e.replace("$timeFilter",r)}return this._influxRequest(this.httpMode,"/query",{q:e,epoch:"ms"},t)},t.prototype.serializeParams=function(e){return e?s.a.reduce(e,function(e,t,r){return null==t?e:(e.push(encodeURIComponent(r)+"="+encodeURIComponent(t)),e)},[]).join("&"):""},t.prototype.testDatasource=function(){var e=new x({measurement:"",tags:[]},this.database).buildExploreQuery("RETENTION POLICIES");return this._seriesQuery(e).then(function(e){var t=s.a.get(e,"results[0].error");return t?{status:"error",message:t}:{status:"success",message:"Data source is working"}}).catch(function(e){return{status:"error",message:e.message}})},t.prototype._influxRequest=function(e,t,r,a){var n=this.urls.shift();this.urls.push(n);var i={};this.username&&(i.u=this.username,i.p=this.password),a&&a.database?i.db=a.database:this.database&&(i.db=this.database),"POST"===e&&s.a.has(r,"q")?(s.a.extend(i,s.a.omit(r,["q"])),r=this.serializeParams(s.a.pick(r,["q"]))):"GET"!==e&&"POST"!==e||(s.a.extend(i,r),r=null);var o={method:e,url:n+t,params:i,data:r,precision:"ms",inspect:{type:"influxdb"},paramSerializer:this.serializeParams};return o.headers=o.headers||{},(this.basicAuth||this.withCredentials)&&(o.withCredentials=!0),this.basicAuth&&(o.headers.Authorization=this.basicAuth),"POST"===e&&(o.headers["Content-type"]="application/x-www-form-urlencoded"),this.backendSrv.datasourceRequest(o).then(function(e){return e.data},function(e){if(0!==e.status||e.status>=300)throw e.data&&e.data.error?{message:"InfluxDB Error: "+e.data.error,data:e.data,config:e.config}:{message:"Network Error: "+e.statusText+"("+e.status+")",data:e.data,config:e.config}})},t.prototype.getTimeFilter=function(e){var t=this.getInfluxTime(e.rangeRaw.from,!1,e.timezone),r=this.getInfluxTime(e.rangeRaw.to,!0,e.timezone),a="ms"===t[t.length-1];return"now()"!==r||a?"time >= "+t+" and time <= "+r:"time >= "+t},t.prototype.getInfluxTime=function(e,t,r){if(s.a.isString(e)){if("now"===e)return"now()";var a=/^now-(\d+)([dhms])$/.exec(e);if(a)return"now() - "+parseInt(a[1],10)+a[2];e=i.dateMath.parse(e,t,r)}return e.valueOf()+"ms"},t}(P.DataSourceApi),k=r("KHwQ"),A=r.n(k),M=function(e){function t(t,r,n,s,i){var o,u,l=e.call(this,t,r)||this;l.templateSrv=n,l.$q=s,l.uiSegmentSrv=i,l.target=l.target,l.queryModel=new b(l.target,n,l.panel.scopedVars),l.queryBuilder=new x(l.target,l.datasource.database),l.groupBySegment=l.uiSegmentSrv.newPlusButton(),l.resultFormats=[{text:"Time series",value:"time_series"},{text:"Table",value:"table"}],l.policySegment=i.newSegment(l.target.policy),l.target.measurement?l.measurementSegment=i.newSegment(l.target.measurement):l.measurementSegment=i.newSelectMeasurement(),l.tagSegments=[];try{for(var p=a.i(l.target.tags),c=p.next();!c.done;c=p.next()){var m=c.value;m.operator||(/^\/.*\/$/.test(m.value)?m.operator="=~":m.operator="="),m.condition&&l.tagSegments.push(i.newCondition(m.condition)),l.tagSegments.push(i.newKey(m.key)),l.tagSegments.push(i.newOperator(m.operator)),l.tagSegments.push(i.newKeyValue(m.value))}}catch(e){o={error:e}}finally{try{c&&!c.done&&(u=p.return)&&u.call(p)}finally{if(o)throw o.error}}return l.fixTagSegments(),l.buildSelectMenu(),l.removeTagFilterSegment=i.newSegment({fake:!0,value:"-- remove tag filter --"}),l}return t.$inject=["$scope","$injector","templateSrv","$q","uiSegmentSrv"],a.c(t,e),t.prototype.removeOrderByTime=function(){this.target.orderByTime="ASC"},t.prototype.buildSelectMenu=function(){var e=v.getCategories();this.selectMenu=s.a.reduce(e,function(e,t,r){var a={text:r,submenu:t.map(function(e){return{text:e.type,value:e.type}})};return e.push(a),e},[])},t.prototype.getGroupByOptions=function(){var e=this,t=this.queryBuilder.buildExploreQuery("TAG_KEYS");return this.datasource.metricFindQuery(t).then(function(t){var r,n,s=[];e.queryModel.hasFill()||s.push(e.uiSegmentSrv.newSegment({value:"fill(null)"})),e.target.limit||s.push(e.uiSegmentSrv.newSegment({value:"LIMIT"})),e.target.slimit||s.push(e.uiSegmentSrv.newSegment({value:"SLIMIT"})),e.target.tz||s.push(e.uiSegmentSrv.newSegment({value:"tz"})),"ASC"===e.target.orderByTime&&s.push(e.uiSegmentSrv.newSegment({value:"ORDER BY time DESC"})),e.queryModel.hasGroupByTime()||s.push(e.uiSegmentSrv.newSegment({value:"time($interval)"}));try{for(var i=a.i(t),o=i.next();!o.done;o=i.next()){var u=o.value;s.push(e.uiSegmentSrv.newSegment({value:"tag("+u.text+")"}))}}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s}).catch(this.handleQueryError.bind(this))},t.prototype.groupByAction=function(){switch(this.groupBySegment.value){case"LIMIT":this.target.limit=10;break;case"SLIMIT":this.target.slimit=10;break;case"tz":this.target.tz="UTC";break;case"ORDER BY time DESC":this.target.orderByTime="DESC";break;default:this.queryModel.addGroupBy(this.groupBySegment.value)}var e=this.uiSegmentSrv.newPlusButton();this.groupBySegment.value=e.value,this.groupBySegment.html=e.html,this.panelCtrl.refresh()},t.prototype.addSelectPart=function(e,t,r){this.queryModel.addSelectPart(e,r.value),this.panelCtrl.refresh()},t.prototype.handleSelectPartEvent=function(e,t,r){switch(r.name){case"get-param-options":var a=this.queryBuilder.buildExploreQuery("FIELDS");return this.datasource.metricFindQuery(a).then(this.transformToSegments(!0)).catch(this.handleQueryError.bind(this));case"part-param-changed":this.panelCtrl.refresh();break;case"action":this.queryModel.removeSelectPart(e,t),this.panelCtrl.refresh();break;case"get-part-actions":return this.$q.when([{text:"Remove",value:"remove-part"}])}},t.prototype.handleGroupByPartEvent=function(e,t,r){switch(r.name){case"get-param-options":var a=this.queryBuilder.buildExploreQuery("TAG_KEYS");return this.datasource.metricFindQuery(a).then(this.transformToSegments(!0)).catch(this.handleQueryError.bind(this));case"part-param-changed":this.panelCtrl.refresh();break;case"action":this.queryModel.removeGroupByPart(e,t),this.panelCtrl.refresh();break;case"get-part-actions":return this.$q.when([{text:"Remove",value:"remove-part"}])}},t.prototype.fixTagSegments=function(){var e=this.tagSegments.length,t=this.tagSegments[Math.max(e-1,0)];t&&"plus-button"===t.type||this.tagSegments.push(this.uiSegmentSrv.newPlusButton())},t.prototype.measurementChanged=function(){this.target.measurement=this.measurementSegment.value,this.panelCtrl.refresh()},t.prototype.getPolicySegments=function(){var e=this.queryBuilder.buildExploreQuery("RETENTION POLICIES");return this.datasource.metricFindQuery(e).then(this.transformToSegments(!1)).catch(this.handleQueryError.bind(this))},t.prototype.policyChanged=function(){this.target.policy=this.policySegment.value,this.panelCtrl.refresh()},t.prototype.toggleEditorMode=function(){try{this.target.query=this.queryModel.render(!1)}catch(e){console.log("query render error")}this.target.rawQuery=!this.target.rawQuery},t.prototype.getMeasurements=function(e){var t=this.queryBuilder.buildExploreQuery("MEASUREMENTS",void 0,e);return this.datasource.metricFindQuery(t).then(this.transformToSegments(!0)).catch(this.handleQueryError.bind(this))},t.prototype.handleQueryError=function(e){return this.error=e.message||"Failed to issue metric query",[]},t.prototype.transformToSegments=function(e){var t=this;return function(r){var n,i,o=s.a.map(r,function(e){return t.uiSegmentSrv.newSegment({value:e.text,expandable:e.expandable})});if(e)try{for(var u=a.i(t.templateSrv.variables),l=u.next();!l.done;l=u.next()){var p=l.value;o.unshift(t.uiSegmentSrv.newSegment({type:"value",value:"/^$"+p.name+"$/",expandable:!0}))}}catch(e){n={error:e}}finally{try{l&&!l.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}return o}},t.prototype.getTagsOrValues=function(e,t){var r,a,n=this;if("condition"===e.type)return this.$q.when([this.uiSegmentSrv.newSegment("AND"),this.uiSegmentSrv.newSegment("OR")]);if("operator"===e.type){var s=this.tagSegments[t+1].value;return/^\/.*\/$/.test(s)?this.$q.when(this.uiSegmentSrv.newOperators(["=~","!~"])):this.$q.when(this.uiSegmentSrv.newOperators(["=","!=","<>","<",">"]))}return"key"===e.type||"plus-button"===e.type?(r=this.queryBuilder.buildExploreQuery("TAG_KEYS"),a=!1):"value"===e.type&&(r=this.queryBuilder.buildExploreQuery("TAG_VALUES",this.tagSegments[t-2].value),a=!0),this.datasource.metricFindQuery(r).then(this.transformToSegments(a)).then(function(t){return"key"===e.type&&t.splice(0,0,A.a.copy(n.removeTagFilterSegment)),t}).catch(this.handleQueryError.bind(this))},t.prototype.getFieldSegments=function(){var e=this.queryBuilder.buildExploreQuery("FIELDS");return this.datasource.metricFindQuery(e).then(this.transformToSegments(!1)).catch(this.handleQueryError)},t.prototype.tagSegmentUpdated=function(e,t){this.tagSegments[t]=e,e.value===this.removeTagFilterSegment.value?(this.tagSegments.splice(t,3),0===this.tagSegments.length?this.tagSegments.push(this.uiSegmentSrv.newPlusButton()):this.tagSegments.length>2&&(this.tagSegments.splice(Math.max(t-1,0),1),"plus-button"!==this.tagSegments[this.tagSegments.length-1].type&&this.tagSegments.push(this.uiSegmentSrv.newPlusButton()))):("plus-button"===e.type&&(t>2&&this.tagSegments.splice(t,0,this.uiSegmentSrv.newCondition("AND")),this.tagSegments.push(this.uiSegmentSrv.newOperator("=")),this.tagSegments.push(this.uiSegmentSrv.newFake("select tag value","value","query-segment-value")),e.type="key",e.cssClass="query-segment-key"),t+1===this.tagSegments.length&&this.tagSegments.push(this.uiSegmentSrv.newPlusButton())),this.rebuildTargetTagConditions()},t.prototype.rebuildTargetTagConditions=function(){var e=this,t=[],r=0,a="";s.a.each(this.tagSegments,function(n,s){"key"===n.type?(0===t.length&&t.push({}),t[r].key=n.value):"value"===n.type?((a=e.getTagValueOperator(n.value,t[r].operator))&&(e.tagSegments[s-1]=e.uiSegmentSrv.newOperator(a),t[r].operator=a),t[r].value=n.value):"condition"===n.type?(t.push({condition:n.value}),r+=1):"operator"===n.type&&(t[r].operator=n.value)}),this.target.tags=t,this.panelCtrl.refresh()},t.prototype.getTagValueOperator=function(e,t){return"=~"!==t&&"!~"!==t&&/^\/.*\/$/.test(e)?"=~":"=~"!==t&&"!~"!==t||!/^(?!\/.*\/$)/.test(e)?null:"="},t.prototype.getCollapsedText=function(){return this.queryModel.render(!1)},t.templateUrl="partials/query.editor.html",t}(r("LzXI").QueryCtrl),O=r("q1tI"),B=r.n(O),q=r("RxwV"),F=r("PAeb");!function(e){e.Key="key",e.Value="value",e.Operator="operator"}(T||(T={}));var Q,I=function(e){Object(O.useContext)(P.ThemeContext);var t={keyValueContainer:Object(F.css)(Q||(Q=a.e(["\n    label: key-value-container;\n    display: flex;\n    flex-flow: row nowrap;\n  "],["\n    label: key-value-container;\n    display: flex;\n    flex-flow: row nowrap;\n  "])))},r=function(t){return function(r){var a=e.onKeyChanged,n=e.onValueChanged,s=e.onOperatorChanged;switch(t){case T.Key:a(r.value);break;case T.Operator:s(r.value);break;case T.Value:n(r.value)}}},n=function(e){return{label:e,value:e}},s=e.keys,i=e.initialKey,o=e.keysPlaceHolder,u=e.initialOperator,l=e.values,p=e.initialValue,c=e.valuesPlaceHolder,m=s?s.map(n):[],d=i?m.filter(function(e){return e.value===i}):null,h=l?l.map(n):[],g=p?h.filter(function(e){return e.value===p}):null,f=["=","!="].map(n),y=u?f.filter(function(e){return e.value===u}):null;return B.a.createElement("div",{className:Object(F.cx)([t.keyValueContainer])},B.a.createElement(P.Select,{options:m,isSearchable:!0,value:d,onChange:r(T.Key),placeholder:o}),B.a.createElement(P.Select,{options:f,value:y,onChange:r(T.Operator)}),B.a.createElement(P.Select,{options:h,isSearchable:!0,value:g,onChange:r(T.Value),placeholder:c}))},_="-- remove filter --",N=function(e){return B.a.createElement("button",{className:"gf-form-label gf-form-label--btn query-part",onClick:e},B.a.createElement("i",{className:"fa fa-plus"}))},R=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={pairs:[]},t.loadTagKeys=function(){return a.b(t,void 0,void 0,function(){var e,t,r,n,s;return a.d(this,function(a){switch(a.label){case 0:return e=this.props,t=e.datasource,r=e.extendedOptions,n=r||{},t.getTagKeys?[4,t.getTagKeys(n)]:[3,2];case 1:return s=a.sent(),[3,3];case 2:s=[],a.label=3;case 3:return[2,s.map(function(e){return e.text})]}})})},t.loadTagValues=function(e){return a.b(t,void 0,void 0,function(){var t,r,n,s,i;return a.d(this,function(o){switch(o.label){case 0:return t=this.props,r=t.datasource,n=t.extendedOptions,s=n||{},r.getTagValues?[4,r.getTagValues(a.a({},s,{key:e}))]:[3,2];case 1:return i=o.sent(),[3,3];case 2:i=[],o.label=3;case 3:return[2,i.map(function(e){return e.text})]}})})},t.onKeyChanged=function(e){return function(r){return a.b(t,void 0,void 0,function(){var t,n,s;return a.d(this,function(a){switch(a.label){case 0:return r===_?[3,2]:(t=this.props.onPairsChanged,[4,this.loadTagValues(r)]);case 1:return n=a.sent(),s=this.updatePairs(this.state.pairs,e,{key:r,values:n}),this.setState({pairs:s},function(){return t(s)}),[3,3];case 2:this.onRemoveFilter(e),a.label=3;case 3:return[2]}})})}},t.onValueChanged=function(e){return function(r){var a=t.updatePairs(t.state.pairs,e,{value:r});t.setState({pairs:a},function(){return t.props.onPairsChanged(a)})}},t.onOperatorChanged=function(e){return function(r){var a=t.updatePairs(t.state.pairs,e,{operator:r});t.setState({pairs:a},function(){return t.props.onPairsChanged(a)})}},t.onAddFilter=function(){return a.b(t,void 0,void 0,function(){var e,t,r=this;return a.d(this,function(a){switch(a.label){case 0:return[4,this.loadTagKeys()];case 1:return e=a.sent(),t=this.state.pairs.concat(this.updatePairs([],0,{keys:e})),this.setState({pairs:t},function(){return r.props.onPairsChanged(t)}),[2]}})})},t.onRemoveFilter=function(e){return a.b(t,void 0,void 0,function(){var t;return a.d(this,function(r){return t=this.state.pairs.reduce(function(t,r,a){return a===e?t:t.concat(r)},[]),this.setState({pairs:t}),[2]})})},t}return a.c(t,e),t.prototype.componentDidUpdate=function(e){var t=this;if(!1===s.a.isEqual(e.extendedOptions,this.props.extendedOptions)){var r=[];this.setState({pairs:r},function(){return t.props.onPairsChanged(r)})}},t.prototype.updatePairs=function(e,t,r){if(0===e.length)return[{key:r.key||"",keys:r.keys||[],operator:r.operator||"",value:r.value||"",values:r.values||[]}];for(var n=[],s=0;s<e.length;s++){var i=e[s];t!==s?n.push(i):n.push(a.a({},i,{key:r.key||i.key,value:r.value||i.value,operator:r.operator||i.operator,keys:r.keys||i.keys,values:r.values||i.values}))}return n},t.prototype.render=function(){var e=this,t=this.state.pairs;return B.a.createElement(B.a.Fragment,null,t.length<1&&N(this.onAddFilter),t.map(function(r,a){var n="adhoc-filter-"+a+"-"+r.key+"-"+r.value;return B.a.createElement("div",{className:"align-items-center flex-grow-1",key:n},B.a.createElement(I,{keys:[_].concat(r.keys),values:r.values,initialKey:r.key,initialOperator:r.operator,initialValue:r.value,onKeyChanged:e.onKeyChanged(a),onOperatorChanged:e.onOperatorChanged(a),onValueChanged:e.onValueChanged(a)}),a<t.length-1&&B.a.createElement("span",null," AND "),a===t.length-1&&N(e.onAddFilter))}))},t}(B.a.PureComponent),D=r("5kRJ");var $=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.templateSrv=new D.a,t.state={measurements:[],measurement:null,field:null},t.onMeasurementsChange=function(e){return a.b(t,void 0,void 0,function(){var t,r,n,s=this;return a.d(this,function(a){return t=this.props.query,r=e[0],n=e[1],this.setState({measurement:r,field:n},function(){s.onPairsChanged(t.tags)}),[2]})})},t.onPairsChanged=function(e){var r=t.props.query,n=t.state,s=n.measurement,i=n.field,o=new b(a.a({},r,{resultFormat:"table",groupBy:[],select:[[{type:"field",params:[i]}]],tags:e,limit:"1000",measurement:s}),t.templateSrv);t.props.onChange(o.target),s&&i&&function(e){return!e||e.every(function(e){var t=!!(e.key&&e.operator&&e.value),r=void 0===e.key&&void 0===e.operator&&void 0===e.value;return t||r})}(e)&&t.props.onRunQuery()},t}return a.c(t,e),t.prototype.componentDidMount=function(){return a.b(this,void 0,void 0,function(){var e,t,r,n,s,i,o,u,l,p,c;return a.d(this,function(a){switch(a.label){case 0:return e=this.props.datasource,t=new x({measurement:"",tags:[]},e.database),r=t.buildExploreQuery("MEASUREMENTS"),[4,e.metricFindQuery(r)];case 1:n=a.sent(),s=[],i=0,a.label=2;case 2:return i<n.length?(o=n[i],u=new x({measurement:o.text,tags:[]},e.database),l=u.buildExploreQuery("FIELDS"),[4,e.metricFindQuery(l)]):[3,5];case 3:p=a.sent(),c=p.map(function(e){return{label:e.text,value:e.text,children:[]}}),s.push({label:o.text,value:o.text,children:c}),a.label=4;case 4:return i++,[3,2];case 5:return this.setState({measurements:s}),[2]}})})},t.prototype.componentDidUpdate=function(e){e.query.measurement&&!this.props.query.measurement&&this.setState({measurement:null,field:null})},t.prototype.render=function(){var e=this.props.datasource,t=this.state,r=t.measurements,a=t.measurement,n=t.field,s=a?"Measurements ("+a+"/"+n+")":"Measurements";return B.a.createElement("div",{className:"gf-form-inline gf-form-inline--nowrap"},B.a.createElement("div",{className:"gf-form flex-shrink-0"},B.a.createElement(q.a,{options:r,value:[a,n],onChange:this.onMeasurementsChange,expandIcon:null},B.a.createElement("button",{className:"gf-form-label gf-form-label--btn"},s," ",B.a.createElement("i",{className:"fa fa-caret-down"})))),B.a.createElement("div",{className:"flex-shrink-1 flex-flow-column-nowrap"},a&&B.a.createElement(R,{onPairsChanged:this.onPairsChanged,datasource:e,extendedOptions:{measurement:a}})))},t}(B.a.PureComponent),V=[{title:"Getting started",label:"Start by selecting a measurement and field from the dropdown above. You can then use the tag selector to further narrow your search."}],L=function(e){return B.a.createElement("div",null,B.a.createElement("h2",null,"InfluxDB Cheat Sheet"),V.map(function(e){return B.a.createElement("div",{className:"cheat-sheet-item",key:e.title},B.a.createElement("div",{className:"cheat-sheet-item__title"},e.title),B.a.createElement("div",{className:"cheat-sheet-item__label"},e.label))}))},G=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.c(t,e),t.prototype.render=function(){return B.a.createElement("div",{className:"grafana-info-box grafana-info-box--max-lg"},B.a.createElement(L,{onClickExample:this.props.onClickExample}))},t}(O.PureComponent),j=r("QjE0");r.d(t,"plugin",function(){return z});var K=function(){function e(){this.httpMode=[{name:"GET",value:"GET"},{name:"POST",value:"POST"}],this.onPasswordReset=Object(j.c)(this,j.a.Password),this.onPasswordChange=Object(j.b)(this,j.a.Password),this.current.jsonData.httpMode=this.current.jsonData.httpMode||"GET"}return e.templateUrl="partials/config.html",e}(),U=function(){function e(){}return e.templateUrl="partials/annotations.editor.html",e}(),z=new P.DataSourcePlugin(C).setConfigCtrl(K).setQueryCtrl(M).setAnnotationQueryCtrl(U).setExploreLogsQueryField($).setExploreStartPage(G)}}]);
//# sourceMappingURL=influxdbPlugin.3932bda029d2299a9d96.js.map