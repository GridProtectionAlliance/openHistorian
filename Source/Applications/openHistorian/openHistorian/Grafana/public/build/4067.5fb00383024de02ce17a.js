"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4067],{76242:(H,M,t)=>{t.d(M,{E3:()=>m,vj:()=>c});const e=`{{ define "__subject" }}[{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ if gt (.Alerts.Resolved | len) 0 }}, RESOLVED:{{ .Alerts.Resolved | len }}{{ end }}{{ end }}] {{ .GroupLabels.SortedPairs.Values | join " " }} {{ if gt (len .CommonLabels) (len .GroupLabels) }}({{ with .CommonLabels.Remove .GroupLabels.Names }}{{ .Values | join " " }}{{ end }}){{ end }}{{ end }}

{{ define "__text_values_list" }}{{ if len .Values }}{{ $first := true }}{{ range $refID, $value := .Values -}}
{{ if $first }}{{ $first = false }}{{ else }}, {{ end }}{{ $refID }}={{ $value }}{{ end -}}
{{ else }}[no value]{{ end }}{{ end }}

{{ define "__text_alert_list" }}{{ range . }}
Value: {{ template "__text_values_list" . }}
Labels:
{{ range .Labels.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}Annotations:
{{ range .Annotations.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}{{ if gt (len .GeneratorURL) 0 }}Source: {{ .GeneratorURL }}
{{ end }}{{ if gt (len .SilenceURL) 0 }}Silence: {{ .SilenceURL }}
{{ end }}{{ if gt (len .DashboardURL) 0 }}Dashboard: {{ .DashboardURL }}
{{ end }}{{ if gt (len .PanelURL) 0 }}Panel: {{ .PanelURL }}
{{ end }}{{ end }}{{ end }}

{{ define "default.title" }}{{ template "__subject" . }}{{ end }}

{{ define "default.message" }}{{ if gt (len .Alerts.Firing) 0 }}**Firing**
{{ template "__text_alert_list" .Alerts.Firing }}{{ if gt (len .Alerts.Resolved) 0 }}

{{ end }}{{ end }}{{ if gt (len .Alerts.Resolved) 0 }}**Resolved**
{{ template "__text_alert_list" .Alerts.Resolved }}{{ end }}{{ end }}

{{ define "__teams_text_alert_list" }}{{ range . }}
Value: {{ template "__text_values_list" . }}
Labels:
{{ range .Labels.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}
Annotations:
{{ range .Annotations.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}
{{ if gt (len .GeneratorURL) 0 }}Source: [{{ .GeneratorURL }}]({{ .GeneratorURL }})

{{ end }}{{ if gt (len .SilenceURL) 0 }}Silence: [{{ .SilenceURL }}]({{ .SilenceURL }})

{{ end }}{{ if gt (len .DashboardURL) 0 }}Dashboard: [{{ .DashboardURL }}]({{ .DashboardURL }})

{{ end }}{{ if gt (len .PanelURL) 0 }}Panel: [{{ .PanelURL }}]({{ .PanelURL }})

{{ end }}
{{ end }}{{ end }}

{{ define "teams.default.message" }}{{ if gt (len .Alerts.Firing) 0 }}**Firing**
{{ template "__teams_text_alert_list" .Alerts.Firing }}{{ if gt (len .Alerts.Resolved) 0 }}

{{ end }}{{ end }}{{ if gt (len .Alerts.Resolved) 0 }}**Resolved**
{{ template "__teams_text_alert_list" .Alerts.Resolved }}{{ end }}{{ end }}`;var v=t(22153),A=t(49962);const L=["TemplateGroup"],s=A.H.enhanceEndpoints({addTagTypes:L}).injectEndpoints({endpoints:f=>({listNamespacedTemplateGroup:f.query({query:n=>({url:`/apis/notifications.alerting.grafana.app/v0alpha1/namespaces/${n.namespace}/templategroups`,params:{pretty:n.pretty,allowWatchBookmarks:n.allowWatchBookmarks,continue:n.continue,fieldSelector:n.fieldSelector,labelSelector:n.labelSelector,limit:n.limit,resourceVersion:n.resourceVersion,resourceVersionMatch:n.resourceVersionMatch,sendInitialEvents:n.sendInitialEvents,timeoutSeconds:n.timeoutSeconds,watch:n.watch}}),providesTags:["TemplateGroup"]}),createNamespacedTemplateGroup:f.mutation({query:n=>({url:`/apis/notifications.alerting.grafana.app/v0alpha1/namespaces/${n.namespace}/templategroups`,method:"POST",body:n.comGithubGrafanaGrafanaPkgApisAlertingNotificationsV0Alpha1TemplateGroup,params:{pretty:n.pretty,dryRun:n.dryRun,fieldManager:n.fieldManager,fieldValidation:n.fieldValidation}}),invalidatesTags:["TemplateGroup"]}),readNamespacedTemplateGroup:f.query({query:n=>({url:`/apis/notifications.alerting.grafana.app/v0alpha1/namespaces/${n.namespace}/templategroups/${n.name}`,params:{pretty:n.pretty}}),providesTags:["TemplateGroup"]}),replaceNamespacedTemplateGroup:f.mutation({query:n=>({url:`/apis/notifications.alerting.grafana.app/v0alpha1/namespaces/${n.namespace}/templategroups/${n.name}`,method:"PUT",body:n.comGithubGrafanaGrafanaPkgApisAlertingNotificationsV0Alpha1TemplateGroup,params:{pretty:n.pretty,dryRun:n.dryRun,fieldManager:n.fieldManager,fieldValidation:n.fieldValidation}}),invalidatesTags:["TemplateGroup"]}),deleteNamespacedTemplateGroup:f.mutation({query:n=>({url:`/apis/notifications.alerting.grafana.app/v0alpha1/namespaces/${n.namespace}/templategroups/${n.name}`,method:"DELETE",body:n.ioK8SApimachineryPkgApisMetaV1DeleteOptions,params:{pretty:n.pretty,dryRun:n.dryRun,gracePeriodSeconds:n.gracePeriodSeconds,orphanDependents:n.orphanDependents,propagationPolicy:n.propagationPolicy}}),invalidatesTags:["TemplateGroup"]})}),overrideExisting:!1}),p="/api/alertmanager/grafana/config/api/v1/templates/test";s.enhanceEndpoints({endpoints:{readNamespacedTemplateGroup:f=>{const n={hideErrorMessage:!0};f.extraOptions=n}}});const m=s.injectEndpoints({endpoints:f=>({previewTemplate:f.mutation({query:({template:n,alerts:i,name:T})=>({url:p,data:{template:n,alerts:i,name:T},method:"POST"})}),getDefaultTemplates:f.query({queryFn:async()=>({data:(0,v.D)(e)})})})}),{usePreviewTemplateMutation:c}=m},64853:(H,M,t)=>{t.d(M,{_:()=>s});var e=t(74848),v=t(2543),A=t.n(v),L=t(19073);const s=({actions:i,children:T})=>{const d=(0,v.filter)(i,f),S=(0,v.filter)(i,n);return d.length?(0,e.jsx)(p,{actions:d,children:T}):S.length?(0,e.jsx)(m,{actions:S,children:T}):null},p=({actions:i,children:T})=>{const d=(0,L.iI)();return c(d,i)?(0,e.jsx)(e.Fragment,{children:T}):null},m=({actions:i,children:T})=>{const d=(0,L.e2)();return c(d,i)?(0,e.jsx)(e.Fragment,{children:T}):null};function c(i,T){return(0,v.chain)(i).pick(T).values().value().some(([d,S])=>S===!0)}function f(i){return Object.values(L.QI).includes(i)}function n(i){return Object.values(L.RY).includes(i)}},57895:(H,M,t)=>{t.d(M,{M:()=>f});var e=t(74848),v=t(32196),A=t(40845),L=t(42418),s=t(60021),p=t(82843),m=t(19073),c=t(57220);function f({currentAlertmanager:i}){const T=(0,A.of)(n),d=i!==c.hY,[S,O]=(0,m.Ej)(m.RY.ReadConfigurationStatus),o=S&&O,{currentData:l}=p.m.endpoints.getGrafanaAlertingConfigurationStatus.useQuery(void 0,{skip:d||!o});if(!(l?.alertmanagersChoice&&[s.nA.External,s.nA.All].includes(l?.alertmanagersChoice))||d)return null;const C=l.numExternalAlertmanagers>0;return l.alertmanagersChoice===s.nA.External?(0,e.jsxs)(L.F,{title:"Grafana alerts are not delivered to Grafana Alertmanager",children:["Grafana is configured to send alerts to external Alertmanagers only. Changing Grafana Alertmanager configuration will not affect delivery of your alerts.",(0,e.jsx)("div",{className:T.adminHint,children:"To change your Alertmanager setup, go to the Alerting Admin page. If you do not have access, contact your Administrator."})]}):l.alertmanagersChoice===s.nA.All&&C?(0,e.jsxs)(L.F,{title:"You have additional Alertmanagers to configure",severity:"warning",children:["Ensure you make configuration changes in the correct Alertmanagers; both internal and external. Changing one will not affect the others.",(0,e.jsx)("div",{className:T.adminHint,children:"To change your Alertmanager setup, go to the Alerting Admin page. If you do not have access, contact your Administrator."})]}):null}const n=i=>({adminHint:(0,v.css)({fontSize:i.typography.bodySmall.fontSize,fontWeight:i.typography.bodySmall.fontWeight})})},94067:(H,M,t)=>{t.r(M),t.d(M,{ActiveTab:()=>ae,default:()=>be});var e=t(74848),v=t(96540),A=t(39558),L=t(69529),s=t(55852),p=t(67061),m=t(42418),c=t(94753),f=t(63021),n=t(40675),i=t(40980),T=t(19384),d=t(10096),S=t(8484),O=t(51703),o=t(78742),l=t(31678),a=t(19073),C=t(98439),x=t(39964),y=t(70383),E=t(57220),$=t(57895),W=t(79633),q=t(34867),k=t(40845),ee=t(96374),u=t(3169),h=t(64853),G=t(4554),B=t(64047),D=t(84396),w=t(48205),V=t(33302),g=t(72275),U=t(96615);const z=({alertManagerName:r,templates:b})=>{const R=(0,u._2)(),F=(0,V._3)({alertmanager:r}),P=(0,k.of)(G.L),[j,K]=(0,v.useState)(),I=async()=>{if(j)try{await F({uid:j.uid}),R.success("Template deleted",`Template ${j.title} has been deleted`)}catch(N){R.error("Error deleting template",`Error deleting template ${j.title}`);const Q=N instanceof Error?N:new Error((0,o.JZ)(N));(0,q.vV)(Q)}K(void 0)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("table",{className:P.table,"data-testid":"templates-table",children:[(0,e.jsxs)("colgroup",{children:[(0,e.jsx)("col",{className:P.colExpand}),(0,e.jsx)("col",{}),(0,e.jsx)("col",{})]}),(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{}),(0,e.jsx)("th",{children:"Template"}),(0,e.jsx)(h._,{actions:[a.QI.CreateNotificationTemplate,a.QI.UpdateNotificationTemplate,a.QI.DeleteNotificationTemplate],children:(0,e.jsx)("th",{children:"Actions"})})]})}),(0,e.jsxs)("tbody",{children:[!b.length&&(0,e.jsx)("tr",{className:P.evenRow,children:(0,e.jsx)("td",{colSpan:3,children:"No templates defined."})}),b.map((N,Q)=>(0,e.jsx)(J,{notificationTemplate:N,idx:Q,alertManagerName:r,onDeleteClick:K},N.uid))]})]}),!!j&&(0,e.jsx)(ee.u,{isOpen:!0,title:"Delete template",body:`Are you sure you want to delete template "${j.title}"?`,confirmText:"Yes, delete",onConfirm:I,onDismiss:()=>K(void 0)})]})};function J({notificationTemplate:r,idx:b,alertManagerName:R,onDeleteClick:F}){const P=(0,k.of)(G.L),[j,K]=(0,v.useState)(!1),{isProvisioned:I}=(0,V.OA)(r),{uid:N,title:Q,content:_}=r;return(0,e.jsxs)(v.Fragment,{children:[(0,e.jsxs)("tr",{className:b%2===0?P.evenRow:void 0,children:[(0,e.jsx)("td",{children:(0,e.jsx)(B.e,{isCollapsed:!j,onToggle:()=>K(!j)})}),(0,e.jsxs)("td",{children:[Q," ",I&&(0,e.jsx)(w.rS,{})]}),(0,e.jsxs)("td",{className:P.actionsCell,children:[I&&(0,e.jsx)(g.M,{to:(0,o.nL)(`/alerting/notifications/templates/${encodeURIComponent(N)}/edit`,R),tooltip:"view template",icon:"file-alt"}),!I&&(0,e.jsx)(h._,{actions:[a.QI.UpdateNotificationTemplate],children:(0,e.jsx)(g.M,{to:(0,o.nL)(`/alerting/notifications/templates/${encodeURIComponent(N)}/edit`,R),tooltip:"edit template",icon:"pen"})}),(0,e.jsx)(h._,{actions:[a.QI.CreateContactPoint],children:(0,e.jsx)(g.M,{to:(0,o.nL)(`/alerting/notifications/templates/${encodeURIComponent(N)}/duplicate`,R),tooltip:"Copy template",icon:"copy"})}),!I&&(0,e.jsx)(h._,{actions:[a.QI.DeleteNotificationTemplate],children:(0,e.jsx)(g.M,{onClick:()=>F(r),tooltip:"delete template",icon:"trash-alt"})})]})]}),j&&(0,e.jsxs)("tr",{className:b%2===0?P.evenRow:void 0,children:[(0,e.jsx)("td",{}),(0,e.jsx)("td",{colSpan:2,children:(0,e.jsx)(D.X,{label:"Description",horizontal:!0,children:(0,e.jsx)(U.K,{width:"auto",height:"auto",autoHeight:!0,value:_,showLineNumbers:!1,monacoOptions:{readOnly:!0,scrollBeyondLastLine:!1}})})})]})]},N)}const Y=()=>{const{selectedAlertmanager:r}=(0,y.VI)(),{data:b,isLoading:R,error:F}=(0,V.cC)({alertmanager:r??""});return F?(0,e.jsx)(m.F,{title:"Failed to fetch notification templates",children:(0,o.JZ)(F)}):R?(0,e.jsx)(A._,{text:"Loading notification templates"}):b?(0,e.jsx)(z,{alertManagerName:r,templates:b}):null};var X=t(32196),te=t(40996),Z=t(46819),ne=t(88575),re=t(10354),ce=t(14578);const de=()=>{const r=(0,k.of)(ue),[b,R]=(0,x.l)(),F=b.get("search")??"",[P,j]=(0,v.useState)(F),[K,I]=(0,te.A)(()=>{R({search:P},!0)},300,[R,P]),N=(0,v.useCallback)(()=>{I(),j(""),R({search:""},!0)},[I,R]),Q=!!F;return(0,e.jsxs)(Z.B,{direction:"row",alignItems:"end",gap:.5,children:[(0,e.jsx)(ne.D,{className:r.noBottom,label:"Search by name or type",children:(0,e.jsx)(re.p,{"aria-label":"search contact points",placeholder:"Search",width:46,prefix:(0,e.jsx)(ce.I,{name:"search"}),onChange:_=>{j(_.currentTarget.value)},value:P})}),(0,e.jsx)(s.$n,{variant:"secondary",icon:"times",onClick:()=>N(),disabled:!Q,"aria-label":"clear",children:"Clear"})]})},ue=()=>({noBottom:(0,X.css)({marginBottom:0})}),pe=({alertManagerName:r})=>{const b=(0,E.AL)(r);return(0,e.jsx)(h._,{actions:[a.QI.UpdateExternalConfiguration],children:(0,e.jsxs)(m.F,{severity:"info",title:"Global config for contact points",children:[(0,e.jsx)("p",{children:"For each external Alertmanager you can define global settings, like server addresses, usernames and password, for all the supported contact points."}),(0,e.jsx)(s.z9,{href:(0,o.nL)("alerting/notifications/global-config",r),variant:"secondary",children:b?"View global config":"Edit global config"})]})})};var oe=t(93667),me=t(53076),ge=t(2543),fe=t(21308);const se=new me.A({intraMode:1,intraIns:1,intraSub:1,intraDel:1,intraTrn:1}),he=(r,b)=>{const R=(0,v.useMemo)(()=>r.map(I=>I.name),[r]),F=(0,v.useMemo)(()=>r.map(I=>I.grafana_managed_receiver_configs.map(N=>N[fe.MX].name).join(" ")),[r]);if(!b)return r;const P=se.filter(R,b)??[],j=se.filter(F,b)??[],K=[...P,...j];return(0,ge.uniq)(K).map(I=>r[I])??[]};var ie=t(29554),ae=(r=>(r.ContactPoints="contact_points",r.NotificationTemplates="templates",r))(ae||{});const le=10,ve=()=>{const{selectedAlertmanager:r}=(0,y.VI)(),[b]=(0,x.l)(),R=!(0,O.dM)(r),F=d.TP.hasPermission(l.AccessControlAction.AlertingNotificationsRead),{isLoading:P,error:j,contactPoints:K}=(0,oe.dK)({alertmanager:r,fetchPolicies:R,fetchStatuses:F}),[I,N]=(0,a.L7)(a.QI.CreateContactPoint),[Q,_]=(0,a.L7)(a.QI.ExportContactPoint),[Ee,Le]=(0,ie.G)(),Se=b.get("search");if(P)return(0,e.jsx)(A._,{text:"Loading..."});const Pe=r===E.hY;return K.length===0?(0,e.jsx)(L.p,{variant:N?"call-to-action":"not-found",button:N&&(0,e.jsx)(s.z9,{href:(0,o.nL)("/alerting/notifications/receivers/new",r),icon:"plus",size:"lg",children:(0,e.jsx)(S.x6,{i18nKey:"alerting.contact-points.create",children:"Create contact point"})}),message:(0,S.t)("alerting.contact-points.empty-state.title","You don't have any contact points yet")}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(p.B,{direction:"row",alignItems:"end",justifyContent:"space-between",children:[(0,e.jsx)(de,{}),(0,e.jsxs)(p.B,{direction:"row",gap:1,children:[I&&(0,e.jsx)(s.z9,{icon:"plus","aria-label":"add contact point",variant:"primary",href:"/alerting/notifications/receivers/new",disabled:!N,children:(0,e.jsx)(S.x6,{i18nKey:"alerting.contact-points.create",children:"Create contact point"})}),Q&&(0,e.jsx)(s.$n,{icon:"download-alt",variant:"secondary","aria-label":"export all",disabled:!_,onClick:()=>Le(ie.B),children:"Export all"})]})]}),j&&(0,e.jsx)(m.F,{title:"Failed to fetch contact points",children:(0,o.JZ)(j)}),!j&&(0,e.jsx)(Ce,{contactPoints:K,search:Se,pageSize:le}),!Pe&&(0,e.jsx)(pe,{alertManagerName:r}),Ee]})},Ae=()=>{const[r,b]=(0,a.L7)(a.QI.CreateNotificationTemplate);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(p.B,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,e.jsx)(c.E,{variant:"body",color:"secondary",children:"Create notification templates to customize your notifications."}),r&&(0,e.jsx)(s.z9,{icon:"plus",variant:"primary",href:"/alerting/notifications/templates/new",disabled:!b,children:"Add notification template"})]}),(0,e.jsx)(Y,{})]})},xe=()=>{const[r,b]=(0,x.l)();return[(0,v.useMemo)(()=>{const P=r.get("tab");return!P||!Object.values(ae).map(String).includes(P)?"contact_points":P||"contact_points"},[r]),P=>b({tab:P})]},Te=()=>{const{selectedAlertmanager:r}=(0,y.VI)(),[b,R]=xe(),{contactPoints:F}=(0,oe.dK)({alertmanager:r}),[P,j]=(0,a.L7)(a.QI.ViewNotificationTemplate),K=b==="contact_points",I=b==="templates";return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)($.M,{currentAlertmanager:r}),(0,e.jsxs)(p.B,{direction:"column",children:[(0,e.jsxs)(f.U,{children:[(0,e.jsx)(n.o,{label:"Contact Points",active:K,counter:F.length,onChangeTab:()=>R("contact_points")}),j&&(0,e.jsx)(n.o,{label:"Notification Templates",active:I,onChangeTab:()=>R("templates")})]}),(0,e.jsx)(i.J,{children:(0,e.jsxs)(p.B,{direction:"column",children:[K&&(0,e.jsx)(ve,{}),I&&(0,e.jsx)(Ae,{})]})})]})]})},Ce=({contactPoints:r,search:b,pageSize:R=le})=>{const F=he(r,b),{page:P,pageItems:j,numberOfPages:K,onPageChange:I}=(0,C.W)(F,1,R);return(0,e.jsxs)(e.Fragment,{children:[j.map((N,Q)=>{const _=`${N.name}-${Q}`;return(0,e.jsx)(W.z8,{contactPoint:N},_)}),(0,e.jsx)(T.d,{currentPage:P,numberOfPages:K,onNavigate:I,hideWhenSinglePage:!0})]})},be=Te},33302:(H,M,t)=>{t.d(M,{A1:()=>W,J2:()=>y,OA:()=>ee,_3:()=>q,cC:()=>l,lx:()=>k,xW:()=>$});var e=t(1932),v=t(96540),A=t(31678),L=t(82843),s=t(76242),p=t(26627),m=t(2859),c=t(51703),f=t(5586);const{useGetAlertmanagerConfigurationQuery:n,useLazyGetAlertmanagerConfigurationQuery:i}=L.m,{useListNamespacedTemplateGroupQuery:T,useLazyReadNamespacedTemplateGroupQuery:d,useCreateNamespacedTemplateGroupMutation:S,useReplaceNamespacedTemplateGroupMutation:O,useDeleteNamespacedTemplateGroupMutation:o}=s.E3;function l({alertmanager:u}){const h=(0,c.dM)(u),G=T({namespace:(0,c.kb)()},{skip:!h,selectFromResult:D=>({...D,data:D.data?a(D.data):void 0,currentData:D.currentData?a(D.currentData):void 0})}),B=n(u,{skip:h,selectFromResult:D=>({...D,data:D.data?x(D.data):void 0,currentData:D.currentData?x(D.currentData):void 0})});return h?G:B}function a(u){return u.items.map(h=>C(h))}function C(u){const h=(0,c.gw)(u,m.T.Provenance)??m.rh;return{uid:u.metadata.name??u.spec.title,title:u.spec.title,content:u.spec.content,provenance:h}}function x(u){return Object.entries(u.template_files).map(([h,G])=>({uid:h,title:h,content:G,provenance:(u.template_file_provenances??{})[h]||m.rh}))}function y({alertmanager:u,uid:h}){const[G,B]=i({selectFromResult:g=>({...g,data:g.data?E(g.data,h):void 0,currentData:g.currentData?E(g.currentData,h):void 0})}),[D,w]=d({selectFromResult:g=>({...g,data:g.data?C(g.data):void 0,currentData:g.currentData?C(g.currentData):void 0})}),V=(0,c.dM)(u);return(0,v.useEffect)(()=>{V?D({namespace:(0,c.kb)(),name:h}):G(u)},[u,h,V,G,D]),V?w:B}function E(u,h){return x(u).find(B=>B.title===h)}function $({alertmanager:u}){const h=(0,A.useDispatch)(),[G]=i(),[B]=S(),D=(0,c.dM)(u);async function w({templateValues:g}){const U=await G(u).unwrap(),z=(0,f.o)(g.title,g.content);if(U.template_files?.[g.title]!==void 0)throw new Error("target template already exists");const Y=(0,e.jM)(U,X=>{X.template_files[g.title]=z,X.alertmanager_config.templates=[...X.alertmanager_config.templates??[],g.title]});return h((0,p.RW)({alertManagerSourceName:u,newConfig:Y,oldConfig:U})).unwrap()}async function V({templateValues:g}){const U=(0,f.o)(g.title,g.content);return B({namespace:(0,c.kb)(),comGithubGrafanaGrafanaPkgApisAlertingNotificationsV0Alpha1TemplateGroup:{spec:{title:g.title,content:U},metadata:{}}}).unwrap()}return D?V:w}function W({alertmanager:u}){const h=(0,A.useDispatch)(),[G]=i(),[B]=O(),D=(0,c.dM)(u);async function w({template:g,patch:U}){const z=await G(u).unwrap(),J=(0,f.o)(U.title,U.content),Y=g.title,X=Y!==U.title,te=(0,e.jM)(z,Z=>{X&&(delete Z.template_files[Y],Z.alertmanager_config.templates=Z.alertmanager_config.templates?.filter(ne=>ne!==Y)),Z.template_files[U.title]=J,Z.alertmanager_config.templates=[...Z.alertmanager_config.templates??[],U.title]});return h((0,p.RW)({alertManagerSourceName:u,newConfig:te,oldConfig:z})).unwrap()}async function V({template:g,patch:U}){const z=(0,f.o)(U.title,U.content);return B({namespace:(0,c.kb)(),name:g.uid,comGithubGrafanaGrafanaPkgApisAlertingNotificationsV0Alpha1TemplateGroup:{spec:{title:U.title,content:z},metadata:{name:g.uid}}}).unwrap()}return D?V:w}function q({alertmanager:u}){const h=(0,A.useDispatch)(),[G]=i(),[B]=o();async function D({uid:g}){const U=await G(u).unwrap(),z=(0,e.jM)(U,J=>{delete J.template_files[g],J.alertmanager_config.templates=J.alertmanager_config.templates?.filter(Y=>Y!==g)});return h((0,p.RW)({alertManagerSourceName:u,newConfig:z,oldConfig:U})).unwrap()}async function w({uid:g}){return B({namespace:(0,c.kb)(),name:g,ioK8SApimachineryPkgApisMetaV1DeleteOptions:{}}).unwrap()}return(0,c.dM)(u)?w:D}function k({alertmanager:u,originalTemplate:h}){const{useLazyGetAlertmanagerConfigurationQuery:G}=L.m,[B]=G();return{titleIsUnique:async w=>{if((0,c.dM)(u)||h?.title===w)return!0;const g=await B(u).unwrap();return x(g).some(J=>J.title===w)?"Another template with this name already exists":!0}}}function ee(u){return u?{isProvisioned:!!u.provenance&&u.provenance!==m.rh}:{isProvisioned:!1}}},96615:(H,M,t)=>{t.d(M,{K:()=>o});var e=t(74848),v=t(96540),A=t(32372),L=t(2543),s=t(83225);function p(l){const a=l.languages.CompletionItemKind.Function;return[{label:s.AlertmanagerTemplateFunction.toUpper,detail:"function(s string)",kind:a},{label:s.AlertmanagerTemplateFunction.toLower,detail:"function(s string)",kind:a},{label:s.AlertmanagerTemplateFunction.title,documentation:"Capitalizes the first letter of each word",detail:"function(s string)",kind:a},{label:s.AlertmanagerTemplateFunction.join,documentation:{value:"Joins an array of strings using the separator provided."},detail:"function(separator string, s []string)",kind:a},{label:s.AlertmanagerTemplateFunction.match,detail:"function",kind:a},{label:s.AlertmanagerTemplateFunction.safeHtml,detail:"function(pattern, repl, text)",kind:a},{label:s.AlertmanagerTemplateFunction.reReplaceAll,detail:"function(pattern, repl, text)",kind:a},{label:s.AlertmanagerTemplateFunction.stringSlice,detail:"function(s ...string)",kind:a}]}var m=t(57954);function c(l){const a={triggerCharacters:["."],provideCompletionItems(C,x,y){const E=C.getWordUntilPosition(x),$={startLineNumber:x.lineNumber,endLineNumber:x.lineNumber,startColumn:E.startColumn,endColumn:E.endColumn},W=new n(l,$);if(!f(C,x))return W.getSnippetsSuggestions();if(y.triggerKind===l.languages.CompletionTriggerKind.Invoke&&!y.triggerCharacter)return W.getFunctionsSuggestions();const k=C.getWordUntilPosition({lineNumber:x.lineNumber,column:x.column-1});return W.getTemplateDataSuggestions(k.word)}};return l.languages.registerCompletionItemProvider("go-template",a)}function f(l,a){const C={startLineNumber:a.lineNumber,endLineNumber:a.lineNumber,startColumn:l.getLineMinColumn(a.lineNumber),endColumn:l.getLineMaxColumn(a.lineNumber)};return l.findMatches('\\{\\{[a-zA-Z0-9._() "]+\\}\\}',C,!0,!1,null,!0).some(E=>E.range.containsPosition(a))}class n{constructor(a,C){this.monaco=a,this.range=C,this.getSnippetsSuggestions=()=>this.getCompletionsFromDefinitions((0,m.Mq)(this.monaco)),this.getFunctionsSuggestions=()=>this.getCompletionsFromDefinitions(p(this.monaco)),this.getTemplateDataSuggestions=x=>{switch(x){case"":return this.getCompletionsFromDefinitions((0,m.Xt)(this.monaco),(0,m.So)(this.monaco));case"Alerts":return this.getCompletionsFromDefinitions((0,m.J2)(this.monaco));case"GroupLabels":case"CommonLabels":case"CommonAnnotations":case"Labels":case"Annotations":return this.getCompletionsFromDefinitions((0,m.KS)(this.monaco));default:return{suggestions:[]}}},this.getCompletionsFromDefinitions=(...x)=>({suggestions:(0,L.concat)(...x).map(E=>i(E,this.range))})}}function i({label:l,detail:a,documentation:C,kind:x,insertText:y},E){const $=typeof l=="string"?l:l.label,W=typeof l=="string"?{label:l,description:a}:{...l};return W.description??=a,{label:W,kind:x,insertText:y??$,range:E,documentation:C,detail:a}}const T="go-template",S={id:T,extensions:[],aliases:[],mimetypes:[],loader:()=>Promise.resolve().then(t.bind(t,83225))},O=(l,a)=>{const{id:C,loader:x}=a;l.languages.getLanguages().find(E=>E.id===C)||(l.languages.register({id:C}),x().then(E=>{l.languages.setMonarchTokensProvider(C,E.language),l.languages.setLanguageConfiguration(C,E.conf)}))},o=l=>{const a=!!l.autoHeight,C=(0,v.useRef)(null),x=y=>{if(a){const E=y.getContentHeight();try{y.layout({height:E,width:NaN})}catch{}}};return(0,v.useEffect)(()=>()=>{C.current?.dispose()},[]),(0,e.jsx)(A.B,{showLineNumbers:!0,showMiniMap:!1,...l,monacoOptions:{scrollBeyondLastLine:!1},onEditorDidMount:x,onBeforeEditorMount:y=>{O(y,S),C.current=c(y)},language:T})}},57954:(H,M,t)=>{t.d(M,{So:()=>n,J2:()=>i,Xt:()=>f,KS:()=>T,Mq:()=>S,L:()=>d});const e=`
{{ range .Alerts }}
  Status: {{ .Status }}
  Starts at: {{ .StartsAt }}
{{ end }}
`,v=`
[{{.Status}}] {{ .Labels.alertname }}

Labels:
{{ range .Labels.SortedPairs }}
  {{ .Name }}: {{ .Value }}
{{ end }}

{{ if gt (len .Annotations) 0 }}
Annotations:
{{ range .Annotations.SortedPairs }}
  {{ .Name }}: {{ .Value }}
{{ end }}
{{ end }}

{{ if gt (len .SilenceURL ) 0 }}
  Silence alert: {{ .SilenceURL }}
{{ end }}
{{ if gt (len .DashboardURL ) 0 }}
  Go to dashboard: {{ .DashboardURL }}
{{ end }}
`,A=c("GroupLabels.SortedPairs"),L=c("CommonLabels.SortedPairs"),s=c("CommonAnnotations.SortedPairs"),p=c("Labels.SortedPairs"),m=c("Annotations.SortedPairs");function c(O){return`
{{ range .${O} }}
  {{ .Name }} = {{ .Value }}
{{ end }}`}function f(O){const o=O.languages.CompletionItemKind.Field;return[{label:"Alerts",kind:o,detail:"Alert[]",documentation:{value:"An Array containing all alerts"}},{label:"Receiver",kind:o,detail:"string"},{label:"Status",kind:o,detail:"string"},{label:"GroupLabels",kind:o,detail:"[]KeyValue"},{label:"CommonLabels",kind:o,detail:"[]KeyValue"},{label:"CommonAnnotations",kind:o,detail:"[]KeyValue"},{label:"ExternalURL",kind:o,detail:"string"}]}function n(O){const o=O.languages.CompletionItemKind.Field;return[{label:{label:"Status",detail:"(Alert)",description:"string"},kind:o,detail:"string",documentation:{value:"Status of the alert. It can be `firing` or `resolved`"}},{label:{label:"Labels",detail:"(Alert)"},kind:o,detail:"[]KeyValue",documentation:{value:"A set of labels attached to the alert."}},{label:{label:"Annotations",detail:"(Alert)"},kind:o,detail:"[]KeyValue",documentation:"A set of annotations attached to the alert."},{label:{label:"StartsAt",detail:"(Alert)"},kind:o,detail:"time.Time",documentation:"Time the alert started firing."},{label:{label:"EndsAt",detail:"(Alert)"},kind:o,detail:"time.Time",documentation:"Only set if the end time of an alert is known. Otherwise set to a configurable timeout period from the time since the last alert was received."},{label:{label:"GeneratorURL",detail:"(Alert)"},kind:o,detail:"string",documentation:"Back link to Grafana or external Alertmanager."},{label:{label:"SilenceURL",detail:"(Alert)"},kind:o,detail:"string",documentation:"Link to Grafana silence for with labels for this alert pre-filled. Only for Grafana managed alerts."},{label:{label:"DashboardURL",detail:"(Alert)"},kind:o,detail:"string",documentation:"Link to Grafana dashboard, if alert rule belongs to one. Only for Grafana managed alerts."},{label:{label:"PanelURL",detail:"(Alert)"},kind:o,detail:"string",documentation:"Link to Grafana dashboard panel, if alert rule belongs to one. Only for Grafana managed alerts."},{label:{label:"Fingerprint",detail:"(Alert)"},kind:o,detail:"string",documentation:"Fingerprint that can be used to identify the alert."},{label:{label:"ValueString",detail:"(Alert)"},kind:o,detail:"string",documentation:"String that contains labels and values of each reduced expression in the alert."}]}function i(O){const o=O.languages.CompletionItemKind.Field;return[{label:"Firing",kind:o,detail:"Alert[]"},{label:"Resolved",kind:o,detail:"Alert[]"}]}function T(O){const o=O.languages.CompletionItemKind.Field;return[{label:"SortedPairs",kind:o,detail:"[]KeyValue"},{label:"Names",kind:o,detail:"[]string"},{label:"Values",kind:o,detail:"[]string"},{label:"Remove",detail:"KeyValue[] function(keys []string)",kind:O.languages.CompletionItemKind.Method}]}const d={alerts:{label:"alertsloop",description:"Renders a loop through alerts",snippet:e},alertDetails:{label:"alertdetails",description:"Renders all information available about the alert",snippet:v},groupLabels:{label:"grouplabelsloop",description:"Renders a loop through group labels",snippet:A},commonLabels:{label:"commonlabelsloop",description:"Renders a loop through common labels",snippet:L},commonAnnotations:{label:"commonannotationsloop",description:"Renders a loop through common annotations",snippet:s},labels:{label:"labelsloop",description:"Renders a loop through labels",snippet:p},annotations:{label:"annotationsloop",description:"Renders a loop through annotations",snippet:m}};function S(O){const o=O.languages.CompletionItemKind.Snippet,l=O.languages.CompletionItemInsertTextRule.InsertAsSnippet,{alerts:a,alertDetails:C,groupLabels:x,commonLabels:y,commonAnnotations:E,labels:$,annotations:W}=d;return[{label:a.label,documentation:a.description,kind:o,insertText:a.snippet,insertTextRules:l},{label:{label:C.label,detail:"(Alert)"},documentation:C.description,kind:o,insertText:C.snippet,insertTextRules:l},{label:x.label,documentation:x.description,kind:o,insertText:x.snippet,insertTextRules:l},{label:y.label,documentation:y.description,kind:o,insertText:y.snippet,insertTextRules:l},{label:E.label,documentation:E.description,kind:o,insertText:E.snippet,insertTextRules:l},{label:{label:$.label,detail:"(Alert)"},documentation:$.description,kind:o,insertText:$.snippet,insertTextRules:l},{label:{label:W.label,detail:"(Alert)"},documentation:W.description,kind:o,insertText:W.snippet,insertTextRules:l}]}},22153:(H,M,t)=>{t.d(M,{D:()=>e,G7:()=>L,Jl:()=>v,gY:()=>A});function e(s){const p={},m=[],c=/{{(-?\s*)(define|end|if|range|else|with|template)(\s*.*?)?(-?\s*)}}/gs;let f,n=0;for(;(f=c.exec(s))!==null;){const[,,i,T]=f;if(n=f.index,i==="define"){const d=T?.match(/"([^"]+)"/);d&&m.push({type:"define",startIndex:n,name:d[1]})}else if(i==="end"){let d=m.pop();for(;d&&d.type!=="define"&&d.type!=="if"&&d.type!=="range"&&d.type!=="with";)d=m.pop();if(d){const S=c.lastIndex;d.type==="define"&&!d.name?.startsWith("__")&&(p[d.name]={name:d.name,content:s.slice(d.startIndex,S)})}}else(i==="if"||i==="range"||i==="else"||i==="with")&&m.push({type:i,startIndex:n})}for(const i of Object.values(p)){const T=/{{ template "([^"]+)" }}/g;let d;for(;(d=T.exec(i.content))!==null;){const S=d[1];p[S]?.content&&(i.content+=`
`+p[S]?.content,delete p[S])}}return Object.values(p)}function v(s){return`{{ template "${s}" . }}`}function A(s){const p=s.match(/\{\{\s*template\s*"(.*)"\s*\.\s*\}\}/);return p?p[1]:""}function L(s){const p=/\{\{\s*template\s*".*?"\s*\.\s*\}\}/g;if(s.match(p)?.length!==1)return!1;const c=s.split(p);for(const f of c)if(f.trim()!=="")return!1;return!0}},72275:(H,M,t)=>{t.d(M,{M:()=>L});var e=t(74848),v=t(56034),A=t(55852);const L=({tooltip:s,icon:p,to:m,target:c,onClick:f,className:n,tooltipPlacement:i="top",...T})=>{const d=typeof s=="string"?s:void 0;return(0,e.jsx)(v.m,{content:s,placement:i,children:m?(0,e.jsx)(A.z9,{variant:"secondary",fill:"text",icon:p,href:m,size:"sm",target:c,...T,"aria-label":d}):(0,e.jsx)(A.$n,{className:n,variant:"secondary",fill:"text",size:"sm",icon:p,type:"button",onClick:f,...T,"aria-label":d})})}},4554:(H,M,t)=>{t.d(M,{L:()=>v});var e=t(32196);const v=A=>({table:(0,e.css)({width:"100%",borderRadius:A.shape.radius.default,border:`solid 1px ${A.colors.border.weak}`,backgroundColor:A.colors.background.secondary,th:{padding:A.spacing(1)},td:{padding:`0 ${A.spacing(1)}`},tr:{height:"38px"}}),evenRow:(0,e.css)({backgroundColor:A.colors.background.primary}),colExpand:(0,e.css)({width:"36px"}),nameCell:(0,e.css)({gap:A.spacing(1)}),actionsCell:(0,e.css)({textAlign:"right",width:"1%",whiteSpace:"nowrap","& > * + *":{marginLeft:A.spacing(.5)}})})},5586:(H,M,t)=>{t.d(M,{a:()=>L,o:()=>A});var e=t(2543),v=t.n(e);function A(s,p){let m=p.trim();if(!m.match(/\{\{\s*define/)){const c=m.split(`
`).map(f=>"  "+f).join(`
`);m=`{{ define "${s}" }}
${c}
{{ end }}`}return m}function L(s){const p=(m,c)=>`{{ define "${c}_NEW_${(0,e.now)()}" }}`;return s.replace(/\{\{\s*define\s*\"(?<defineName>.*)\"\s*\}\}/g,p)}}}]);

//# sourceMappingURL=4067.5fb00383024de02ce17a.js.map