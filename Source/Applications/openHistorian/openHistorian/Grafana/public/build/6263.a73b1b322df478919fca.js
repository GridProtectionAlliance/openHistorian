"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6263],{72235:(L,b,t)=>{t.d(b,{l:()=>f});var s=t(74848),u=t(32196),m=t(96540),p=t(49785);function f({defaultValues:P,onSubmit:w,validateOnMount:c=!1,validateFieldsOnMount:D,children:h,validateOn:x="onSubmit",maxWidth:y=600,...E}){const{handleSubmit:d,trigger:j,formState:R,...O}=(0,p.mN)({mode:x,defaultValues:P});return(0,m.useEffect)(()=>{c&&j(D)},[j,D,c]),(0,s.jsx)("form",{className:(0,u.css)({maxWidth:y!=="none"?y+"px":y,width:"100%"}),onSubmit:d(w),...E,children:h({errors:R.errors,formState:R,trigger:j,...O})})}},82138:(L,b,t)=>{t.d(b,{y:()=>P});var s=t(74848),u=t(32196),m=t(42418),p=t(94954),f=t(31678);const P=({initError:c})=>c?(0,s.jsx)("div",{className:w.dashboardLoading,children:(0,s.jsx)(m.F,{severity:f.AppNotificationSeverity.Error,title:c.message,children:(0,p.q)(c.error)})}):null,w={dashboardLoading:(0,u.css)({height:"60vh",display:"flex",alignItems:"center",justifyContent:"center"})}},9980:(L,b,t)=>{t.d(b,{P:()=>c});var s=t(74848),u=t(32196),m=t(39601),p=t(40845),f=t(66864),P=t(62930),w=t(55852);const c=({initPhase:h})=>{const x=(0,p.of)(D),y=()=>{m.Ny.push("/")};return(0,s.jsx)("div",{className:x.dashboardLoading,children:(0,s.jsx)("div",{className:x.dashboardLoadingText,children:(0,s.jsxs)(f.gW,{spacing:"md",children:[(0,s.jsxs)(f.Gy,{align:"center",justify:"center",spacing:"xs",children:[(0,s.jsx)(P.y,{inline:!0})," ",h]})," ",(0,s.jsx)(f.Gy,{align:"center",justify:"center",children:(0,s.jsx)(w.$n,{variant:"secondary",size:"md",icon:"repeat",onClick:y,children:"Cancel loading dashboard"})})]})})})},D=h=>{const x="0.5s",y=(0,u.keyframes)`
    0% { opacity: 0%; }
    100% { opacity: 100%; }
  `;return{dashboardLoading:(0,u.css)({height:"60vh",display:"flex",opacity:"0%",alignItems:"center",justifyContent:"center",[h.transitions.handleMotion("no-preference","reduce")]:{animation:`${y} 0s step-end ${x} 1 normal forwards`}}),dashboardLoadingText:(0,u.css)({fontSize:h.typography.h4.fontSize})}}},2118:(L,b,t)=>{t.d(b,{N:()=>ct});var s=t(74848),u=t(46942),m=t.n(u),p=t(96540),f=t(66816),P=t.n(f),w=t(64423),c=t(32264),D=t(28138),h=t(15054),x=t(16233),y=t(80484),E=t(28444),d=t(32196),j=t(84140),R=t(40845),O=t(29158),H=t(8484),A=t(16678);const Y=({panel:o,dashboard:e})=>{const a=r=>{r.preventDefault(),e.removePanel(o)},i=r=>{const{gridPos:l}=o,g={...r.model,gridPos:l,libraryPanel:r};e.addPanel(g),e.removePanel(o)},n=(0,R.of)(Q);return(0,s.jsx)("div",{className:n.wrapper,children:(0,s.jsxs)("div",{className:n.callToAction,children:[(0,s.jsxs)("div",{className:(0,d.cx)(n.headerRow,"grid-drag-handle"),children:[(0,s.jsx)("span",{children:(0,s.jsx)(H.x6,{i18nKey:"library-panel.add-widget.title",children:"Add panel from panel library"})}),(0,s.jsx)("div",{className:"flex-grow-1"}),(0,s.jsx)(O.K,{"aria-label":"Close 'Add Panel' widget",name:"times",onClick:a,tooltip:"Close widget"})]}),(0,s.jsx)(A.j,{onClick:i,variant:A.s.Tight,showPanelFilter:!0})]})})},Q=o=>{const e=(0,d.keyframes)({"0%":{boxShadow:`0 0 0 2px ${o.colors.background.canvas}, 0 0 0px 4px ${o.colors.primary.main}`},"50%":{boxShadow:`0 0 0 2px ${o.components.dashboard.background}, 0 0 0px 4px ${(0,j.A)(o.colors.primary.main).darken(20).toHexString()}`},"100%":{boxShadow:`0 0 0 2px ${o.components.dashboard.background}, 0 0 0px 4px  ${o.colors.primary.main}`}});return{wrapper:(0,d.css)({height:"100%",paddingTop:`${o.spacing(.5)}`}),headerRow:(0,d.css)({display:"flex",alignItems:"center",height:"38px",flexShrink:0,width:"100%",fontSize:o.typography.fontSize,fontWeight:o.typography.fontWeightMedium,paddingLeft:`${o.spacing(1)}`,[o.transitions.handleMotion("no-preference","reduce")]:{transition:"background-color 0.1s ease-in-out"},cursor:"move","&:hover":{background:`${o.colors.background.secondary}`}}),callToAction:(0,d.css)({backgroundColor:o.components.panel.background,border:`1px solid ${o.components.panel.borderColor}`,borderRadius:o.shape.radius.default,display:"flex",flex:"1 1 0",flexDirection:"column",height:"100%",position:"relative",width:"100%",outline:"2px dotted transparent",outlineOffset:"2px",overflow:"hidden",[o.transitions.handleMotion("no-preference","reduce")]:{animation:`${e} 2s ease infinite`}})}};var k=t(2543),I=t(13544),J=t(3591),X=t(72574),Z=t(72109),T=t(14578),z=t(45994),q=t(71678),B=t(37390),N=t(88575),_=t(10354),tt=t(42418),$=t(55852),st=t(72235),et=t(92378);const at=({repeat:o,title:e,warning:a,onUpdate:i,onCancel:n})=>{const[r,l]=(0,p.useState)(o),g=(0,p.useCallback)(v=>l(v),[l]);return(0,s.jsx)(st.l,{defaultValues:{title:e},onSubmit:v=>{i(v.title,r)},children:({register:v})=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(N.D,{label:"Title",children:(0,s.jsx)(_.p,{...v("title"),type:"text"})}),(0,s.jsx)(N.D,{label:"Repeat for",children:(0,s.jsx)(et.G,{repeat:r,onChange:g})}),a&&(0,s.jsx)(tt.F,{"data-testid":I.Tp.pages.Dashboard.Rows.Repeated.ConfigSection.warningMessage,severity:"warning",title:"",topSpacing:3,bottomSpacing:0,children:a}),(0,s.jsxs)(B.a.ButtonRow,{children:[(0,s.jsx)($.$n,{type:"button",variant:"secondary",onClick:n,fill:"outline",children:"Cancel"}),(0,s.jsx)($.$n,{type:"submit",children:"Update"})]})]})})},ot=({repeat:o,title:e,onDismiss:a,onUpdate:i,warning:n})=>{const r=(0,R.of)(nt);return(0,s.jsx)(B.a,{isOpen:!0,title:"Row options",icon:"copy",onDismiss:a,className:r.modal,children:(0,s.jsx)(at,{repeat:o,title:e,onCancel:a,onUpdate:i,warning:n})})},nt=()=>({modal:(0,d.css)({label:"RowOptionsModal",width:"500px"})}),F=({repeat:o,title:e,onUpdate:a,warning:i})=>{const n=r=>(l,g)=>{a(l,g),r()};return(0,s.jsx)(q.$s,{children:({showModal:r,hideModal:l})=>(0,s.jsx)("button",{type:"button",className:"pointer","aria-label":"Row options",onClick:()=>{r(ot,{title:e,repeat:o,onDismiss:l,onUpdate:n(l),warning:i})},children:(0,s.jsx)(T.I,{name:"cog"})})})};F.displayName="RowOptionsButton";class it extends p.Component{constructor(){super(...arguments),this.onVariableUpdated=()=>{this.forceUpdate()},this.onToggle=()=>{this.props.dashboard.toggleRow(this.props.panel)},this.getWarning=()=>{if((this.props.panel.panels?.length?this.props.panel.panels:this.props.dashboard.getRowPanels((0,k.indexOf)(this.props.dashboard.panels,this.props.panel))).some(i=>i.datasource?.uid===z.K))return(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{children:["Panels in this row use the ",z.K," data source. These panels will reference the panel in the original row, not the ones in the repeated rows."]}),(0,s.jsx)(Z.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/dashboards/build-dashboards/create-dashboard/#configure-repeating-rows",children:"Learn more"})]})},this.onUpdate=(e,a)=>{this.props.panel.setProperty("title",e),this.props.panel.setProperty("repeat",a??void 0),this.props.panel.render(),this.props.dashboard.processRepeats(),this.forceUpdate()},this.onDelete=()=>{D.A.publish(new E.bY({title:"Delete row",text:"Are you sure you want to remove this row and all its panels?",altActionText:"Delete row only",icon:"trash-alt",onConfirm:()=>{this.props.dashboard.removeRow(this.props.panel,!0)},onAltAction:()=>{this.props.dashboard.removeRow(this.props.panel,!1)}}))}}componentDidMount(){this.sub=this.props.dashboard.events.subscribe(J._,this.onVariableUpdated)}componentWillUnmount(){this.sub&&this.sub.unsubscribe()}render(){const e=(0,X.w)().replace(this.props.panel.title,this.props.panel.scopedVars,"text"),a=this.props.panel.panels?this.props.panel.panels.length:0,i=a===1?"panel":"panels",n=this.props.dashboard.meta.canEdit===!0,r=this.props.panel.collapsed,l=lt(this.props.theme);return(0,s.jsxs)("div",{className:(0,d.cx)(l.dashboardRow,{[l.dashboardRowCollapsed]:r}),"data-testid":"dashboard-row-container",children:[(0,s.jsxs)("button",{"aria-expanded":!r,className:(0,d.cx)(l.title,"pointer"),type:"button","data-testid":I.Tp.components.DashboardRow.title(e),onClick:this.onToggle,children:[(0,s.jsx)(T.I,{name:r?"angle-right":"angle-down"}),e,(0,s.jsxs)("span",{className:(0,d.cx)(l.count,{[l.countCollapsed]:r}),children:["(",a," ",i,")"]})]}),n&&(0,s.jsxs)("div",{className:l.actions,children:[(0,s.jsx)(F,{title:this.props.panel.title,repeat:this.props.panel.repeat,onUpdate:this.onUpdate,warning:this.getWarning()}),(0,s.jsx)("button",{type:"button",className:"pointer",onClick:this.onDelete,"aria-label":"Delete row",children:(0,s.jsx)(T.I,{name:"trash-alt"})})]}),r===!0&&(0,s.jsx)("div",{className:(0,d.cx)({[l.toggleTargetCollapsed]:r}),onClick:this.onToggle,children:"\xA0"}),n&&(0,s.jsx)("div",{"data-testid":"dashboard-row-drag",className:(0,d.cx)(l.dragHandle,"grid-drag-handle",{[l.dragHandleCollapsed]:r})})]})}}const rt=(0,R.cV)(it),lt=o=>{const e=(0,d.css)({color:o.colors.text.secondary,opacity:0,[o.transitions.handleMotion("no-preference","reduce")]:{transition:"200ms opacity ease-in 200ms"},button:{color:o.colors.text.secondary,paddingLeft:o.spacing(2),background:"transparent",border:"none","&:hover":{color:o.colors.text.maxContrast}}});return{dashboardRow:(0,d.css)({display:"flex",alignItems:"center",height:"100%","&:hover, &:focus-within":{[`.${e}`]:{opacity:1}}}),dashboardRowCollapsed:(0,d.css)({background:o.components.panel.background}),toggleTargetCollapsed:(0,d.css)({flex:1,cursor:"pointer",marginRight:"15px"}),title:(0,d.css)({flexGrow:0,fontSize:o.typography.h5.fontSize,fontWeight:o.typography.fontWeightMedium,color:o.colors.text.primary,background:"transparent",border:"none",".fa":{color:o.colors.text.secondary,fontSize:o.typography.size.xs,padding:o.spacing(0,1)}}),actions:e,count:(0,d.css)({paddingLeft:o.spacing(2),color:o.colors.text.secondary,fontStyle:"italic",fontSize:o.typography.size.sm,fontWeight:"normal",display:"none"}),countCollapsed:(0,d.css)({display:"inline-block"}),dragHandle:(0,d.css)({cursor:"move",width:"16px",height:"100%",background:'url("public/img/grab_dark.svg") no-repeat 50% 50%',backgroundSize:"8px",visibility:"hidden",position:"absolute",top:0,right:0}),dragHandleCollapsed:(0,d.css)({visibility:"visible",opacity:1})}};var dt=t(68064),ht=t(39569);const K="systemPanelFilterVar";class ct extends p.PureComponent{constructor(e){super(e),this.panelMap={},this.eventSubs=new w.yU,this.windowHeight=1200,this.windowWidth=1920,this.gridWidth=0,this.lastPanelBottom=0,this.isLayoutInitialized=!1,this.onLayoutChange=a=>{if(!this.state.panelFilter){for(const i of a)this.panelMap[i.i].updateGridPos(i,this.isLayoutInitialized);this.isLayoutInitialized&&(this.isLayoutInitialized=!0),this.props.dashboard.sortPanelsByGridPos(),this.forceUpdate()}},this.triggerForceUpdate=()=>{this.forceUpdate()},this.updateGridPos=(a,i)=>{this.panelMap[a.i].updateGridPos(a)},this.onResize=(a,i,n)=>{this.panelMap[n.i].updateGridPos(n)},this.onResizeStop=(a,i,n)=>{this.updateGridPos(n,a)},this.onDragStop=(a,i,n)=>{this.updateGridPos(n,a)},this.onGetWrapperDivRef=a=>{a&&x.TP.user.authenticatedBy!=="render"&&setTimeout(()=>{a.classList.add("react-grid-layout--enable-move-animations")},50)},this.rootEl=null,this.onMeasureRef=a=>{if(!a){this.rootEl&&this.resizeObserver&&this.resizeObserver.unobserve(this.rootEl);return}this.rootEl=a,this.resizeObserver=new ResizeObserver(i=>{i.forEach(n=>{this.setState({width:n.contentRect.width})})}),this.resizeObserver.observe(a)},this.state={panelFilter:void 0,width:document.body.clientWidth}}componentDidMount(){const{dashboard:e}=this.props;if(c.$.featureToggles.panelFilterVariable){for(const a of e.getVariables())if(a.id===K){"query"in a&&this.setPanelFilter(a.query);break}this.eventSubs.add(D.A.subscribe(y.og,a=>{if(a.payload.variable?.id===K&&"current"in a.payload.variable){let i=a.payload.variable.current;"value"in i&&typeof i.value=="string"&&this.setPanelFilter(i.value)}}))}this.eventSubs.add(e.events.subscribe(E.Q$,this.triggerForceUpdate))}componentWillUnmount(){this.eventSubs.unsubscribe()}setPanelFilter(e){let a;e.length>0&&(a=new RegExp(e,"i")),this.setState({panelFilter:a})}buildLayout(){const e=[];this.panelMap={};const{panelFilter:a}=this.state;let i=0;for(const n of this.props.dashboard.panels){if(n.key||(n.key=`panel-${n.id}-${Date.now()}`),this.panelMap[n.key]=n,!n.gridPos){console.log("panel without gridpos");continue}const r={i:n.key,x:n.gridPos.x,y:n.gridPos.y,w:n.gridPos.w,h:n.gridPos.h};n.type==="row"&&(r.w=h.cV,r.h=1,r.isResizable=!1,r.isDraggable=n.collapsed),a?a.test(n.title)&&(r.isResizable=!1,r.isDraggable=!1,r.x=i%2*h.cV,r.y=Math.floor(i/2),e.push(r),i++):e.push(r)}return e}getPanelScreenPos(e,a){let i=0;return a<c.$.theme2.breakpoints.values.md?i=this.lastPanelBottom+h.dU:i=U(e.gridPos.y)+h.dU,this.lastPanelBottom=i+U(e.gridPos.h),{top:i,bottom:this.lastPanelBottom}}renderPanels(e,a){const{panelFilter:i}=this.state,n=[];this.lastPanelBottom=0,this.gridWidth!==e&&(this.windowHeight=window.innerHeight??1e3,this.windowWidth=window.innerWidth,this.gridWidth=e);for(const r of this.props.dashboard.panels){const l=m()({"react-grid-item--fullscreen":r.isViewing}),g=(0,s.jsx)(V,{className:l,"data-panelid":r.id,gridPos:r.gridPos,gridWidth:e,windowHeight:this.windowHeight,windowWidth:this.windowWidth,isViewing:r.isViewing,children:(v,W)=>this.renderPanel(r,v,W,a)},r.key);i?i.test(r.title)&&n.push(g):n.push(g)}return n}renderPanel(e,a,i,n){return e.type==="row"?(0,s.jsx)(rt,{panel:e,dashboard:this.props.dashboard},e.key):e.type==="add-library-panel"?(0,s.jsx)(Y,{panel:e,dashboard:this.props.dashboard},e.key):(0,s.jsx)(ht.L,{stateKey:e.key,panel:e,dashboard:this.props.dashboard,isEditing:e.isEditing,isViewing:e.isViewing,isDraggable:n,width:a,height:i,hideMenu:this.props.hidePanelMenus},e.key)}render(){const{isEditable:e,dashboard:a}=this.props,{width:i}=this.state;if(a.panels.length===0)return(0,s.jsx)(dt.A,{dashboard:a,canCreate:e});const n=i<=c.$.theme2.breakpoints.values.md?!1:e;return(0,s.jsx)("div",{ref:this.onMeasureRef,style:{flex:"1 1 auto",position:"relative",zIndex:1,display:this.props.editPanel?"none":void 0},children:(0,s.jsx)("div",{style:{width:i,height:"100%"},ref:this.onGetWrapperDivRef,children:(0,s.jsx)(P(),{width:i,isDraggable:n,isResizable:e,containerPadding:[0,0],useCSSTransforms:!0,margin:[h.dU,h.dU],cols:h.cV,rowHeight:h.sD,draggableHandle:".grid-drag-handle",draggableCancel:".grid-drag-cancel",layout:this.buildLayout(),onDragStop:this.onDragStop,onResize:this.onResize,onResizeStop:this.onResizeStop,onLayoutChange:this.onLayoutChange,children:this.renderPanels(i,n)})})})}}const V=p.forwardRef((o,e)=>{const a=c.$.theme2;let i=100,n=100;const{gridWidth:r,gridPos:l,isViewing:g,windowHeight:v,windowWidth:W,...G}=o,C=o.style??{};if(g)i=r,n=v*.85,C.height=n,C.width="100%";else if(W<a.breakpoints.values.md)i=o.gridWidth,n=U(l.h),C.height=n,C.width="100%";else if(o.style){const{width:M,height:S}=o.style;M!=null&&(i=typeof M=="number"?M:parseFloat(M)),S!=null&&(n=typeof S=="number"?S:parseFloat(S))}return(0,s.jsx)("div",{...G,style:{...G.style},ref:e,children:[o.children[0](i,n),o.children.slice(1)]})});function U(o){return o*(h.sD+h.dU)-h.dU}V.displayName="GridItemWithDimensions"}}]);

//# sourceMappingURL=6263.a73b1b322df478919fca.js.map