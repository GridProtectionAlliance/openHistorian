"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3128],{21056:(W,d,S)=>{S.d(d,{R:()=>L});var R=S(40503),v=S(57027),h=S(78038),a=S(924),l=S(62626),T=S(75118),_=S(84946),n=S(46528),u=S(9471),g=S(49922),p=S(77599),j=S(28625),x=S(14035);const N=O=>f=>new _.y(b=>{let m=[],y=!0;const U=()=>{b.next(m),m=[]},c=O.subscribe({next:k=>{y=k,y&&m.length&&U()}}),E=f.subscribe({next(k){y?m.length?U():b.next([k]):m.push(k)},error(k){b.error(k)},complete(){b.complete()}});return()=>{E.unsubscribe(),c.unsubscribe()}});var F=(O=>(O[O.Error=0]="Error",O[O.NewValuesSameSchema=1]="NewValuesSameSchema",O[O.ChangedSchema=2]="ChangedSchema",O))(F||{});const e=O=>({values:O.reduce((f,{values:b})=>{for(let m=0;m<b.length;m++){f[m]||(f[m]=[]);for(let y=0;y<b[m].length;y++)f[m].push(b[m][y])}return f},[]),type:1}),t=(O,f)=>O.filter(b=>b.type===f);class i{constructor(f){this.deps=f,this.stream=new n.t(1),this.shutdown=()=>{this.stream.complete(),this.liveEventsSubscription.unsubscribe(),this.deps.onShutdown()},this.shutdownIfNoSubscribers=()=>{this.stream.observed||this.shutdown()},this.onError=b=>{console.log("LiveQuery [error]",{err:b},this.deps.channelId),this.stream.next({type:0,error:(0,p.P)(b)}),this.shutdown()},this.onComplete=()=>{console.log("LiveQuery [complete]",this.deps.channelId),this.shutdown()},this.onNext=b=>{if((0,l.RL)(b)){this.process(b.message);return}const m=(0,l.se)(b);if(m&&b.error){this.stream.next({type:0,error:{...(0,p.P)(b.error),message:`Streaming channel error: ${b.error.message}`}});return}m&&(b.state===l.yS.Connected||b.state===l.yS.Pending)&&b.message&&this.process(b.message)},this.process=b=>{this.frameBuffer.push(b).schemaChanged?this.stream.next({type:2}):this.stream.next({type:1,values:this.frameBuffer.getValuesFromLastPacket()})},this.resizeBuffer=b=>{b&&this.frameBuffer.needsResizing(b)&&this.frameBuffer.resize(b)},this.prepareInternalStreamForNewSubscription=b=>{!this.frameBuffer.hasAtLeastOnePacket()&&b.frame&&this.process(b.frame)},this.clearShutdownTimeout=()=>{this.shutdownTimeoutId&&(clearTimeout(this.shutdownTimeoutId),this.shutdownTimeoutId=void 0)},this.get=(b,m)=>{this.clearShutdownTimeout();const y=(0,j._A)(b.buffer);this.resizeBuffer(y),this.prepareInternalStreamForNewSubscription(b);const U=b?.buffer?.action===T.T0.Replace,c=b.filter?.fields,k=c?.length?({name:D})=>c.includes(D):void 0;let B;const A=(D,M)=>(B=k?this.frameBuffer.getMatchingFieldIndexes(k):void 0,U?M?{key:m,state:g.Gu.Error,data:[{type:x.g0.FullFrame,frame:this.frameBuffer.serialize(k,y,{maxLength:0})}],error:M}:D.length?{key:m,state:g.Gu.Streaming,data:[{type:x.g0.FullFrame,frame:this.frameBuffer.serialize(k,y,{maxLength:this.frameBuffer.packetInfo.length})}],error:M}:(console.warn(`expected to find at least one non error message ${D.map(({type:I})=>I)}`),{key:m,state:g.Gu.Streaming,data:[{type:x.g0.FullFrame,frame:this.frameBuffer.serialize(k,y,{maxLength:0})}],error:M}):{key:m,state:M?g.Gu.Error:g.Gu.Streaming,data:[{type:x.g0.FullFrame,frame:this.frameBuffer.serialize(k,y)}],error:M}),$=D=>{const M=D.length?D[D.length-1]:void 0,I=U&&M?M.values:e(D).values,H=B?I.filter((V,G)=>B.includes(G)):I;return{key:m,state:g.Gu.Streaming,data:[{type:x.g0.NewValuesSameSchema,values:H}]}};let z=!0;const J=this.stream.pipe(N(this.deps.subscriberReadiness),(0,u.U)((D,M)=>{const I=t(D,0),H=I.length?I[I.length-1].error:void 0;if(z)return z=!1,A(D,H);if(I.length)return A(D,H);if(D.some(K=>K.type===2))return A(D,void 0);const G=t(D,1);return G.length!==D.length&&console.warn(`unsupported message type ${D.map(({type:K})=>K)}`),$(G)}));return new _.y(D=>{const M=J.subscribe({next:I=>{D.next(I)},error:I=>{D.error(I)},complete:()=>{D.complete()}});return()=>{M.unsubscribe(),this.stream.observed||(this.clearShutdownTimeout(),this.shutdownTimeoutId=setTimeout(this.shutdownIfNoSubscribers,this.deps.shutdownDelayInMs))}})},this.frameBuffer=j.Av.empty(f.defaultStreamingFrameOptions),this.liveEventsSubscription=f.liveEventsObservable.subscribe({error:this.onError,complete:this.onComplete,next:this.onNext})}}var s=S(91017);class r{constructor(f,b){this.opened=Date.now(),this.stream=new s.x,this.disconnectIfNoListeners=()=>{this.stream.observers.length===0&&this.disconnect()},this.id=f,this.addr=b,this.currentStatus={type:l.FU.Status,id:f,timestamp:this.opened,state:l.yS.Pending},(0,l.nU)(b)||(this.currentStatus.state=l.yS.Invalid,this.currentStatus.error="invalid channel address")}initalize(){if(this.initalized)throw new Error("Channel already initalized: "+this.id);this.initalized=!0,this.subscription.on("publication",f=>{try{f.data&&(f.data.schema&&(this.lastMessageWithSchema=f.data),this.stream.next({type:l.FU.Message,message:f.data})),this.currentStatus.error&&(this.currentStatus.timestamp=Date.now(),delete this.currentStatus.error,this.sendStatus())}catch(b){console.log("publish error",this.addr,b),this.currentStatus.error=b,this.currentStatus.timestamp=Date.now(),this.sendStatus()}}).on("error",f=>{this.currentStatus.timestamp=Date.now(),this.currentStatus.error=f.error.message,this.sendStatus()}).on("subscribed",f=>{this.currentStatus.timestamp=Date.now(),this.currentStatus.state=l.yS.Connected,delete this.currentStatus.error,f.data?.schema&&(this.lastMessageWithSchema=f.data),this.sendStatus(f.data)}).on("unsubscribed",()=>{this.currentStatus.timestamp=Date.now(),this.currentStatus.state=l.yS.Disconnected,this.sendStatus()}).on("subscribing",()=>{this.currentStatus.timestamp=Date.now(),this.currentStatus.state=l.yS.Connecting,this.sendStatus()}).on("join",f=>{this.stream.next({type:l.FU.Join,user:f.info.user})}).on("leave",f=>{this.stream.next({type:l.FU.Leave,user:f.info.user})})}sendStatus(f){const b={...this.currentStatus};f&&(b.message=f),this.stream.next(b)}getStream(){return new _.y(f=>{const b={...this.currentStatus};this.lastMessageWithSchema?.schema&&(b.message={schema:this.lastMessageWithSchema?.schema}),f.next({...this.currentStatus,message:this.lastMessageWithSchema});const m=this.stream.subscribe(f);return()=>{m.unsubscribe(),this.stream.observers.length===0&&setTimeout(this.disconnectIfNoListeners,250)}})}async getPresence(){return this.subscription?this.subscription.presence().then(f=>({users:Object.keys(f.clients)})):Promise.reject("not subscribed")}disconnect(){this.currentStatus.state=l.yS.Shutdown,this.currentStatus.timestamp=Date.now(),this.subscription&&(this.subscription.unsubscribe(),this.subscription.removeAllListeners(),this.subscription=void 0),this.stream.complete(),this.stream.next({...this.currentStatus}),this.stream.complete(),this.shutdownCallback&&this.shutdownCallback()}shutdownWithError(f){this.currentStatus.error=f,this.sendStatus(),this.disconnect()}}function o(O,f,b){return{id:f,opened:Date.now(),addr:b,getStream:()=>of({type:LiveChannelEventType.Status,id:f,timestamp:Date.now(),state:LiveChannelConnectionState.Invalid,error:O}),disconnect:()=>{}}}const w={maxLength:100,maxDelta:1/0,action:T.T0.Append},C=5e3;class L{constructor(f){this.deps=f,this.open=new Map,this.liveDataStreamByChannelId={},this.onConnect=y=>{this.connectionState.next(!0)},this.onDisconnect=y=>{this.connectionState.next(!1)},this.onServerSideMessage=y=>{console.log("Publication from server-side channel",y)},this.getConnectionState=()=>this.connectionState.asObservable(),this.getStream=y=>this.getChannel(y).getStream(),this.createSubscriptionKey=y=>y.key??`xstr/${P++}`,this.getLiveDataStream=y=>{const U=(0,l.Aj)(y.addr),c=this.liveDataStreamByChannelId[U];if(c)return c;const E=this.getChannel(y.addr);return this.liveDataStreamByChannelId[U]=new i({channelId:U,onShutdown:()=>{delete this.liveDataStreamByChannelId[U]},liveEventsObservable:E.getStream(),subscriberReadiness:this.dataStreamSubscriberReadiness,defaultStreamingFrameOptions:w,shutdownDelayInMs:C}),this.liveDataStreamByChannelId[U]},this.getDataStream=y=>{const U=this.createSubscriptionKey(y);return this.getLiveDataStream(y).get(y,U)},this.getQueryData=async y=>(this.centrifuge.state!==R.State.Connected&&await this.connectionBlocker,this.centrifuge.rpc("grafana.query",y.body)),this.getPresence=y=>this.getChannel(y).getPresence(),this.dataStreamSubscriberReadiness=f.dataStreamSubscriberReadiness.pipe((0,v.B)(),(0,h.O)(!0));let b=`${f.appUrl.replace(/^http/,"ws")}/api/live/ws`;const m=f.grafanaAuthToken;m!==null&&m!==""&&(b+="?auth_token="+m),this.centrifuge=new R.Centrifuge(b,{timeout:3e4}),f.liveEnabled&&f.orgRole!==""&&this.centrifuge.connect(),this.connectionState=new a.X(this.centrifuge.state===R.State.Connected),this.connectionBlocker=new Promise(y=>{if(this.centrifuge.state===R.State.Connected)return y();const U=()=>{y(),this.centrifuge.removeListener("connected",U)};this.centrifuge.addListener("connected",U)}),this.centrifuge.on("connected",this.onConnect),this.centrifuge.on("connecting",this.onDisconnect),this.centrifuge.on("disconnected",this.onDisconnect),this.centrifuge.on("publication",this.onServerSideMessage)}getChannel(f){const b=`${this.deps.orgId}/${f.scope}/${f.namespace}/${f.path}`;let m=this.open.get(b);return m!=null||(m=new r(b,f),m.currentStatus.state===l.yS.Invalid)||(m.shutdownCallback=()=>{this.open.delete(b),this.centrifuge.removeSubscription(this.centrifuge.getSubscription(b))},this.open.set(b,m),this.initChannel(m).catch(y=>{m&&(m.currentStatus.state=l.yS.Invalid,m.shutdownWithError(y)),this.open.delete(b)})),m}async initChannel(f){this.centrifuge.state!==R.State.Connected&&await this.connectionBlocker;const b=this.centrifuge.newSubscription(f.id,{data:f.addr.data});f.subscription=b,f.initalize(),b.subscribe()}}let P=0},88214:(W,d,S)=>{var R=S(40333),v=S(84261);const h={canHandle(a){return a&&a instanceof v.Lv},serialize(a){const l=R.sj(a),{port1:T,port2:_}=new MessageChannel;return R.Jj(l,T),[_,[_]]},deserialize(a){return a.start(),R.Ud(a)}};R.Y6.set("SubscriberHandler",h)},47155:function(W,d,S){var R=this&&this.__importDefault||function(F){return F&&F.__esModule?F:{default:F}};Object.defineProperty(d,"__esModule",{value:!0}),d.Centrifuge=void 0;const v=S(46203),h=S(36836),a=S(96417),l=S(47278),T=S(38740),_=S(12377),n=S(70351),u=S(47914),g=S(31846),p=S(61654),j=R(S(3988)),x={protocol:"json",token:null,getToken:null,data:null,debug:!1,name:"js",version:"",fetch:null,readableStream:null,websocket:null,eventsource:null,sockjs:null,sockjsOptions:{},emulationEndpoint:"/emulation",minReconnectDelay:500,maxReconnectDelay:2e4,timeout:5e3,maxServerPingDelay:1e4,networkEventTarget:null};class N extends j.default{constructor(e,t){super(),this._reconnectTimeout=null,this._refreshTimeout=null,this._serverPingTimeout=null,this.state=p.State.Disconnected,this._endpoint=e,this._emulation=!1,this._transports=[],this._currentTransportIndex=0,this._triedAllTransports=!1,this._transportWasOpen=!1,this._transport=null,this._transportClosed=!0,this._encoder=null,this._decoder=null,this._reconnecting=!1,this._reconnectTimeout=null,this._reconnectAttempts=0,this._client=null,this._session="",this._node="",this._subs={},this._serverSubs={},this._commandId=0,this._commands=[],this._batching=!1,this._refreshRequired=!1,this._refreshTimeout=null,this._callbacks={},this._token=void 0,this._dispatchPromise=Promise.resolve(),this._serverPing=0,this._serverPingTimeout=null,this._sendPong=!1,this._promises={},this._promiseId=0,this._debugEnabled=!1,this._config=Object.assign(Object.assign({},x),t),this._configure(),this._debugEnabled?(this.on("state",i=>{this._debug("client state",i.oldState,"->",i.newState)}),this.on("error",i=>{this._debug("client error",i)})):this.on("error",function(){Function.prototype()})}newSubscription(e,t){if(this.getSubscription(e)!==null)throw new Error("Subscription to the channel "+e+" already exists");const i=new v.Subscription(this,e,t);return this._subs[e]=i,i}getSubscription(e){return this._getSub(e)}removeSubscription(e){e&&(e.state!==p.SubscriptionState.Unsubscribed&&e.unsubscribe(),this._removeSubscription(e))}subscriptions(){return this._subs}ready(e){return this.state===p.State.Disconnected?Promise.reject({code:h.errorCodes.clientDisconnected,message:"client disconnected"}):this.state===p.State.Connected?Promise.resolve():new Promise((t,i)=>{const s={resolve:t,reject:i};e&&(s.timeout=setTimeout(function(){i({code:h.errorCodes.timeout,message:"timeout"})},e)),this._promises[this._nextPromiseId()]=s})}connect(){if(this._isConnected()){this._debug("connect called when already connected");return}if(this._isConnecting()){this._debug("connect called when already connecting");return}this._reconnectAttempts=0,this._startConnecting()}disconnect(){this._disconnect(h.disconnectedCodes.disconnectCalled,"disconnect called",!1)}send(e){const t={send:{data:e}},i=this;return this._methodCall().then(function(){return i._transportSendCommands([t])?Promise.resolve():Promise.reject(i._createErrorObject(h.errorCodes.transportWriteError,"transport write error"))})}rpc(e,t){const i={rpc:{method:e,data:t}},s=this;return this._methodCall().then(function(){return s._callPromise(i,function(r){return{data:r.rpc.data}})})}publish(e,t){const i={publish:{channel:e,data:t}},s=this;return this._methodCall().then(function(){return s._callPromise(i,function(){return{}})})}history(e,t){const i={history:this._getHistoryRequest(e,t)},s=this;return this._methodCall().then(function(){return s._callPromise(i,function(r){const o=r.history,w=[];if(o.publications)for(let C=0;C<o.publications.length;C++)w.push(s._getPublicationContext(e,o.publications[C]));return{publications:w,epoch:o.epoch||"",offset:o.offset||0}})})}presence(e){const t={presence:{channel:e}},i=this;return this._methodCall().then(function(){return i._callPromise(t,function(s){return{clients:s.presence.presence}})})}presenceStats(e){const t={presence_stats:{channel:e}},i=this;return this._methodCall().then(function(){return i._callPromise(t,function(s){const r=s.presence_stats;return{numUsers:r.num_users,numClients:r.num_clients}})})}startBatching(){this._batching=!0}stopBatching(){const e=this;Promise.resolve().then(function(){Promise.resolve().then(function(){e._batching=!1,e._flush()})})}_debug(...e){this._debugEnabled&&(0,g.log)("debug",e)}_setFormat(e){if(!this._formatOverride(e)){if(e==="protobuf")throw new Error("not implemented by JSON-only Centrifuge client, use client with Protobuf support");this._encoder=new u.JsonEncoder,this._decoder=new u.JsonDecoder}}_formatOverride(e){return!1}_configure(){if(!("Promise"in globalThis))throw new Error("Promise polyfill required");if(!this._endpoint)throw new Error("endpoint configuration required");if(this._config.protocol!=="json"&&this._config.protocol!=="protobuf")throw new Error("unsupported protocol "+this._config.protocol);if(this._config.token!==null&&(this._token=this._config.token),this._setFormat("json"),this._config.protocol==="protobuf"&&this._setFormat("protobuf"),(this._config.debug===!0||typeof localStorage<"u"&&localStorage.getItem("centrifuge.debug"))&&(this._debugEnabled=!0),this._debug("config",this._config),typeof this._endpoint!="string")if(typeof this._endpoint=="object"&&this._endpoint instanceof Array){this._transports=this._endpoint,this._emulation=!0;for(const e in this._transports){const t=this._transports[e];if(!t.endpoint||!t.transport)throw new Error("malformed transport configuration");const i=t.transport;if(["websocket","http_stream","sse","sockjs","webtransport"].indexOf(i)<0)throw new Error("unsupported transport name: "+i)}}else throw new Error("unsupported url configuration type: only string or array of objects are supported")}_setState(e){if(this.state!==e){this._reconnecting=!1;const t=this.state;return this.state=e,this.emit("state",{newState:e,oldState:t}),!0}return!1}_isDisconnected(){return this.state===p.State.Disconnected}_isConnecting(){return this.state===p.State.Connecting}_isConnected(){return this.state===p.State.Connected}_nextCommandId(){return++this._commandId}_setNetworkEvents(){let e=null;this._config.networkEventTarget!==null?e=this._config.networkEventTarget:typeof globalThis.addEventListener<"u"&&(e=globalThis),e&&(e.addEventListener("offline",()=>{this._debug("offline event triggered"),this.state===p.State.Connected&&this._transport&&!this._transportClosed&&(this._transportClosed=!0,this._transport.close())}),e.addEventListener("online",()=>{this._debug("online event triggered"),this.state===p.State.Connecting&&(this._clearReconnectTimeout(),this._startReconnecting())}))}_getReconnectDelay(){const e=(0,g.backoff)(this._reconnectAttempts,this._config.minReconnectDelay,this._config.maxReconnectDelay);return this._reconnectAttempts+=1,e}_clearOutgoingRequests(){for(const e in this._callbacks)if(this._callbacks.hasOwnProperty(e)){const t=this._callbacks[e];clearTimeout(t.timeout);const i=t.errback;if(!i)continue;i({error:this._createErrorObject(h.errorCodes.connectionClosed,"connection closed")})}this._callbacks={}}_clearConnectedState(){this._client=null,this._clearServerPingTimeout(),this._clearRefreshTimeout();for(const e in this._subs){if(!this._subs.hasOwnProperty(e))continue;const t=this._subs[e];t.state===p.SubscriptionState.Subscribed&&t._setSubscribing(h.subscribingCodes.transportClosed,"transport closed")}for(const e in this._serverSubs)this._serverSubs.hasOwnProperty(e)&&this.emit("subscribing",{channel:e})}_handleWriteError(e){for(const t of e){const i=t.id;if(!(i in this._callbacks))continue;const s=this._callbacks[i];clearTimeout(this._callbacks[i].timeout),delete this._callbacks[i];const r=s.errback;r({error:this._createErrorObject(h.errorCodes.transportWriteError,"transport write error")})}}_transportSendCommands(e){if(!e.length)return!0;if(!this._transport)return!1;try{this._transport.send(this._encoder.encodeCommands(e),this._session,this._node)}catch(t){return this._debug("error writing commands",t),this._handleWriteError(e),!1}return!0}_initializeTransport(){let e;this._config.websocket!==null?e=this._config.websocket:typeof globalThis.WebSocket!="function"&&typeof globalThis.WebSocket!="object"||(e=globalThis.WebSocket);let t=null;this._config.sockjs!==null?t=this._config.sockjs:typeof globalThis.SockJS<"u"&&(t=globalThis.SockJS);let i=null;this._config.eventsource!==null?i=this._config.eventsource:typeof globalThis.EventSource<"u"&&(i=globalThis.EventSource);let s=null;this._config.fetch!==null?s=this._config.fetch:typeof globalThis.fetch<"u"&&(s=globalThis.fetch);let r=null;if(this._config.readableStream!==null?r=this._config.readableStream:typeof globalThis.ReadableStream<"u"&&(r=globalThis.ReadableStream),this._emulation){this._currentTransportIndex>=this._transports.length&&(this._triedAllTransports=!0,this._currentTransportIndex=0);let f=0;for(;;){if(f>=this._transports.length)throw new Error("no supported transport found");const b=this._transports[this._currentTransportIndex],m=b.transport,y=b.endpoint;if(m==="websocket"){if(this._debug("trying websocket transport"),this._transport=new l.WebsocketTransport(y,{websocket:e}),!this._transport.supported()){this._debug("websocket transport not available"),this._currentTransportIndex++,f++;continue}}else if(m==="webtransport"){if(this._debug("trying webtransport transport"),this._transport=new n.WebtransportTransport(y,{webtransport:globalThis.WebTransport,decoder:this._decoder,encoder:this._encoder}),!this._transport.supported()){this._debug("webtransport transport not available"),this._currentTransportIndex++,f++;continue}}else if(m==="http_stream"){if(this._debug("trying http_stream transport"),this._transport=new T.HttpStreamTransport(y,{fetch:s,readableStream:r,emulationEndpoint:this._config.emulationEndpoint,decoder:this._decoder,encoder:this._encoder}),!this._transport.supported()){this._debug("http_stream transport not available"),this._currentTransportIndex++,f++;continue}}else if(m==="sse"){if(this._debug("trying sse transport"),this._transport=new _.SseTransport(y,{eventsource:i,fetch:s,emulationEndpoint:this._config.emulationEndpoint}),!this._transport.supported()){this._debug("sse transport not available"),this._currentTransportIndex++,f++;continue}}else if(m==="sockjs"){if(this._debug("trying sockjs"),this._transport=new a.SockjsTransport(y,{sockjs:t,sockjsOptions:this._config.sockjsOptions}),!this._transport.supported()){this._debug("sockjs transport not available"),this._currentTransportIndex++,f++;continue}}else throw new Error("unknown transport "+m);break}}else{if((0,g.startsWith)(this._endpoint,"http"))throw new Error("Provide explicit transport endpoints configuration in case of using HTTP (i.e. using array of TransportEndpoint instead of a single string), or use ws(s):// scheme in an endpoint if you aimed using WebSocket transport");if(this._debug("client will use websocket"),this._transport=new l.WebsocketTransport(this._endpoint,{websocket:e}),!this._transport.supported())throw new Error("WebSocket not available")}const o=this;let w,C=!1,L=!0;this._transport.name()==="sse"&&(L=!1);const P=[];if(this._transport.emulation()){const f=o._sendConnect(!0);if(P.push(f),L){const b=o._sendSubscribeCommands(!0,!0);for(const m in b)P.push(b[m])}}const O=this._encoder.encodeCommands(P);this._transport.initialize(this._config.protocol,{onOpen:function(){C=!0,w=o._transport.subName(),o._debug(w,"transport open"),o._transportWasOpen=!0,o._transportClosed=!1,!o._transport.emulation()&&(o.startBatching(),o._sendConnect(!1),L&&o._sendSubscribeCommands(!0,!1),o.stopBatching())},onError:function(f){o._debug("transport level error",f)},onClose:function(f){o._debug(o._transport.name(),"transport closed"),o._transportClosed=!0;let b="connection closed",m=!0,y=0;if(f&&"code"in f&&f.code&&(y=f.code),f&&f.reason)try{const c=JSON.parse(f.reason);b=c.reason,m=c.reconnect}catch{b=f.reason,(y>=3500&&y<4e3||y>=4500&&y<5e3)&&(m=!1)}y<3e3?(y===1009?(y=h.disconnectedCodes.messageSizeLimit,b="message size limit exceeded",m=!1):(y=h.connectingCodes.transportClosed,b="transport closed"),o._emulation&&!o._transportWasOpen&&(o._currentTransportIndex++,o._currentTransportIndex>=o._transports.length&&(o._triedAllTransports=!0,o._currentTransportIndex=0))):o._transportWasOpen=!0;let U=!1;if(o._emulation&&!o._transportWasOpen&&!o._triedAllTransports&&(U=!0),o._isConnecting()&&!C&&o.emit("error",{type:"transport",error:{code:h.errorCodes.transportClosed,message:"transport closed"},transport:o._transport.name()}),o._disconnect(y,b,m),o._isConnecting()){let c=o._getReconnectDelay();U&&(c=0),o._debug("reconnect after "+c+" milliseconds"),o._reconnecting=!1,o._reconnectTimeout=setTimeout(()=>{o._startReconnecting()},c)}},onMessage:function(f){o._dataReceived(f)}},O)}_sendConnect(e){const t=this._constructConnectCommand(),i=this;return this._call(t,e).then(s=>{const r=s.reply.connect;i._connectResponse(r),s.next&&s.next()},s=>{i._connectError(s.error),s.next&&s.next()}),t}_startReconnecting(){if(!this._isConnecting()||this._reconnecting)return;if(this._reconnecting=!0,!(this._refreshRequired||!this._token&&this._config.getToken!==null)){this._initializeTransport();return}const t=this;this._getToken().then(function(i){if(t._isConnecting()){if(!i){t._failUnauthorized();return}t._token=i,t._debug("connection token refreshed"),t._initializeTransport()}}).catch(function(i){if(!t._isConnecting())return;t.emit("error",{type:"connectToken",error:{code:h.errorCodes.clientConnectToken,message:i!==void 0?i.toString():""}});const s=t._getReconnectDelay();t._debug("error on connection token refresh, reconnect after "+s+" milliseconds",i),t._reconnecting=!1,t._reconnectTimeout=setTimeout(()=>{t._startReconnecting()},s)})}_connectError(e){this.state===p.State.Connecting&&(e.code===109&&(this._refreshRequired=!0),e.code<100||e.temporary===!0||e.code===109?(this.emit("error",{type:"connect",error:e}),this._transport&&!this._transportClosed&&(this._transportClosed=!0,this._transport.close())):this._disconnect(e.code,e.message,!1))}_constructConnectCommand(){const e={};this._token&&(e.token=this._token),this._config.data&&(e.data=this._config.data),this._config.name&&(e.name=this._config.name),this._config.version&&(e.version=this._config.version);const t={};let i=!1;for(const s in this._serverSubs)if(this._serverSubs.hasOwnProperty(s)&&this._serverSubs[s].recoverable){i=!0;const r={recover:!0};this._serverSubs[s].offset&&(r.offset=this._serverSubs[s].offset),this._serverSubs[s].epoch&&(r.epoch=this._serverSubs[s].epoch),t[s]=r}return i&&(e.subs=t),{connect:e}}_getHistoryRequest(e,t){const i={channel:e};return t!==void 0&&(t.since&&(i.since={offset:t.since.offset},t.since.epoch&&(i.since.epoch=t.since.epoch)),t.limit!==void 0&&(i.limit=t.limit),t.reverse===!0&&(i.reverse=!0)),i}_methodCall(){return this._isConnected()?Promise.resolve():new Promise((e,t)=>{const i=setTimeout(function(){t({code:h.errorCodes.timeout,message:"timeout"})},this._config.timeout);this._promises[this._nextPromiseId()]={timeout:i,resolve:e,reject:t}})}_callPromise(e,t){return new Promise((i,s)=>{this._call(e,!1).then(r=>{i(t(r.reply)),r.next&&r.next()},r=>{s(r.error),r.next&&r.next()})})}_dataReceived(e){this._serverPing>0&&this._waitServerPing();const t=this._decoder.decodeReplies(e);this._dispatchPromise=this._dispatchPromise.then(()=>{let i;this._dispatchPromise=new Promise(s=>{i=s}),this._dispatchSynchronized(t,i)})}_dispatchSynchronized(e,t){let i=Promise.resolve();for(const s in e)e.hasOwnProperty(s)&&(i=i.then(()=>this._dispatchReply(e[s])));i=i.then(()=>{t()})}_dispatchReply(e){let t;const i=new Promise(r=>{t=r});if(e==null)return this._debug("dispatch: got undefined or null reply"),t(),i;const s=e.id;return s&&s>0?this._handleReply(e,t):e.push?this._handlePush(e.push,t):this._handleServerPing(t),i}_call(e,t){return new Promise((i,s)=>{e.id=this._nextCommandId(),this._registerCall(e.id,i,s),t||this._addCommand(e)})}_startConnecting(){this._debug("start connecting"),this._setState(p.State.Connecting)&&this.emit("connecting",{code:h.connectingCodes.connectCalled,reason:"connect called"}),this._client=null,this._startReconnecting()}_disconnect(e,t,i){if(this._isDisconnected())return;const s=this.state,r={code:e,reason:t};let o=!1;i?o=this._setState(p.State.Connecting):(o=this._setState(p.State.Disconnected),this._rejectPromises({code:h.errorCodes.clientDisconnected,message:"disconnected"})),this._clearOutgoingRequests(),s===p.State.Connecting&&this._clearReconnectTimeout(),s===p.State.Connected&&this._clearConnectedState(),o&&(this._isConnecting()?this.emit("connecting",r):this.emit("disconnected",r)),this._transport&&!this._transportClosed&&(this._transportClosed=!0,this._transport.close())}_failUnauthorized(){this._disconnect(h.disconnectedCodes.unauthorized,"unauthorized",!1)}_getToken(){if(this._debug("get connection token"),!this._config.getToken)throw new Error("provide a function to get connection token");return this._config.getToken({})}_refresh(){const e=this._client,t=this;this._getToken().then(function(i){if(e!==t._client)return;if(!i){t._failUnauthorized();return}if(t._token=i,t._debug("connection token refreshed"),!t._isConnected())return;const s={refresh:{token:t._token}};t._call(s,!1).then(r=>{const o=r.reply.refresh;t._refreshResponse(o),r.next&&r.next()},r=>{t._refreshError(r.error),r.next&&r.next()})}).catch(function(i){t.emit("error",{type:"refreshToken",error:{code:h.errorCodes.clientRefreshToken,message:i!==void 0?i.toString():""}}),t._refreshTimeout=setTimeout(()=>t._refresh(),t._getRefreshRetryDelay())})}_refreshError(e){e.code<100||e.temporary===!0?(this.emit("error",{type:"refresh",error:e}),this._refreshTimeout=setTimeout(()=>this._refresh(),this._getRefreshRetryDelay())):this._disconnect(e.code,e.message,!1)}_getRefreshRetryDelay(){return(0,g.backoff)(0,5e3,1e4)}_refreshResponse(e){this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null),e.expires&&(this._client=e.client,this._refreshTimeout=setTimeout(()=>this._refresh(),(0,g.ttlMilliseconds)(e.ttl)))}_removeSubscription(e){e!==null&&delete this._subs[e.channel]}_unsubscribe(e){if(!this._isConnected())return;const i={unsubscribe:{channel:e.channel}},s=this;this._call(i,!1).then(r=>{r.next&&r.next()},r=>{r.next&&r.next(),s._disconnect(h.connectingCodes.unsubscribeError,"unsubscribe error",!0)})}_getSub(e){const t=this._subs[e];return t||null}_isServerSub(e){return this._serverSubs[e]!==void 0}_sendSubscribeCommands(e,t){const i=[];for(const s in this._subs){if(!this._subs.hasOwnProperty(s))continue;const r=this._subs[s];if(r._inflight!==!0&&r.state===p.SubscriptionState.Subscribing){const o=r._subscribe(e,t);o&&i.push(o)}}return i}_connectResponse(e){if(this._transportWasOpen=!0,this._reconnectAttempts=0,this._refreshRequired=!1,this._isConnected())return;this._client=e.client,this._setState(p.State.Connected),this._setNetworkEvents(),this._refreshTimeout&&clearTimeout(this._refreshTimeout),e.expires&&(this._refreshTimeout=setTimeout(()=>this._refresh(),(0,g.ttlMilliseconds)(e.ttl))),this._session=e.session,this._node=e.node,this.startBatching(),this._sendSubscribeCommands(!1,!1),this.stopBatching();const t={client:e.client,transport:this._transport.subName()};e.data&&(t.data=e.data),this.emit("connected",t),this._resolvePromises(),this._processServerSubs(e.subs||{}),e.ping&&e.ping>0?(this._serverPing=e.ping*1e3,this._sendPong=e.pong===!0,this._waitServerPing()):this._serverPing=0}_processServerSubs(e){for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t];this._serverSubs[t]={offset:i.offset,epoch:i.epoch,recoverable:i.recoverable||!1};const s=this._getSubscribeContext(t,i);this.emit("subscribed",s)}for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t];if(i.recovered){const s=i.publications;if(s&&s.length>0)for(const r in s)s.hasOwnProperty(r)&&this._handlePublication(t,s[r])}}for(const t in this._serverSubs)this._serverSubs.hasOwnProperty(t)&&(e[t]||(this.emit("unsubscribed",{channel:t}),delete this._serverSubs[t]))}_clearRefreshTimeout(){this._refreshTimeout!==null&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null)}_clearReconnectTimeout(){this._reconnectTimeout!==null&&(clearTimeout(this._reconnectTimeout),this._reconnectTimeout=null)}_clearServerPingTimeout(){this._serverPingTimeout!==null&&(clearTimeout(this._serverPingTimeout),this._serverPingTimeout=null)}_waitServerPing(){this._config.maxServerPingDelay!==0&&this._isConnected()&&(this._clearServerPingTimeout(),this._serverPingTimeout=setTimeout(()=>{this._isConnected()&&this._disconnect(h.connectingCodes.noPing,"no ping",!0)},this._serverPing+this._config.maxServerPingDelay))}_getSubscribeContext(e,t){const i={channel:e,positioned:!1,recoverable:!1,wasRecovering:!1,recovered:!1};t.recovered&&(i.recovered=!0),t.positioned&&(i.positioned=!0),t.recoverable&&(i.recoverable=!0),t.was_recovering&&(i.wasRecovering=!0);let s="";"epoch"in t&&(s=t.epoch);let r=0;return"offset"in t&&(r=t.offset),(i.positioned||i.recoverable)&&(i.streamPosition={offset:r,epoch:s}),t.data&&(i.data=t.data),i}_handleReply(e,t){const i=e.id;if(!(i in this._callbacks)){t();return}const s=this._callbacks[i];if(clearTimeout(this._callbacks[i].timeout),delete this._callbacks[i],(0,g.errorExists)(e)){const r=s.errback;if(!r){t();return}const o=e.error;r({error:o,next:t})}else{const r=s.callback;if(!r)return;r({reply:e,next:t})}}_handleJoin(e,t){const i=this._getSub(e);if(!i){if(this._isServerSub(e)){const s={channel:e,info:this._getJoinLeaveContext(t.info)};this.emit("join",s)}return}i._handleJoin(t)}_handleLeave(e,t){const i=this._getSub(e);if(!i){if(this._isServerSub(e)){const s={channel:e,info:this._getJoinLeaveContext(t.info)};this.emit("leave",s)}return}i._handleLeave(t)}_handleUnsubscribe(e,t){const i=this._getSub(e);if(!i){this._isServerSub(e)&&(delete this._serverSubs[e],this.emit("unsubscribed",{channel:e}));return}t.code<2500?i._setUnsubscribed(t.code,t.reason,!1):i._setSubscribing(t.code,t.reason)}_handleSubscribe(e,t){this._serverSubs[e]={offset:t.offset,epoch:t.epoch,recoverable:t.recoverable||!1},this.emit("subscribed",this._getSubscribeContext(e,t))}_handleDisconnect(e){const t=e.code;let i=!0;(t>=3500&&t<4e3||t>=4500&&t<5e3)&&(i=!1),this._disconnect(t,e.reason,i)}_getPublicationContext(e,t){const i={channel:e,data:t.data};return t.offset&&(i.offset=t.offset),t.info&&(i.info=this._getJoinLeaveContext(t.info)),t.tags&&(i.tags=t.tags),i}_getJoinLeaveContext(e){const t={client:e.client,user:e.user};return e.conn_info&&(t.connInfo=e.conn_info),e.chan_info&&(t.chanInfo=e.chan_info),t}_handlePublication(e,t){const i=this._getSub(e);if(!i){if(this._isServerSub(e)){const s=this._getPublicationContext(e,t);this.emit("publication",s),t.offset!==void 0&&(this._serverSubs[e].offset=t.offset)}return}i._handlePublication(t)}_handleMessage(e){this.emit("message",{data:e.data})}_handleServerPing(e){if(this._sendPong){const t={};this._transportSendCommands([t])}e()}_handlePush(e,t){const i=e.channel;e.pub?this._handlePublication(i,e.pub):e.message?this._handleMessage(e.message):e.join?this._handleJoin(i,e.join):e.leave?this._handleLeave(i,e.leave):e.unsubscribe?this._handleUnsubscribe(i,e.unsubscribe):e.subscribe?this._handleSubscribe(i,e.subscribe):e.disconnect&&this._handleDisconnect(e.disconnect),t()}_flush(){const e=this._commands.slice(0);this._commands=[],this._transportSendCommands(e)}_createErrorObject(e,t,i){const s={code:e,message:t};return i&&(s.temporary=!0),s}_registerCall(e,t,i){this._callbacks[e]={callback:t,errback:i,timeout:null},this._callbacks[e].timeout=setTimeout(()=>{delete this._callbacks[e],(0,g.isFunction)(i)&&i({error:this._createErrorObject(h.errorCodes.timeout,"timeout")})},this._config.timeout)}_addCommand(e){this._batching?this._commands.push(e):this._transportSendCommands([e])}_nextPromiseId(){return++this._promiseId}_resolvePromises(){for(const e in this._promises)this._promises[e].timeout&&clearTimeout(this._promises[e].timeout),this._promises[e].resolve(),delete this._promises[e]}_rejectPromises(e){for(const t in this._promises)this._promises[t].timeout&&clearTimeout(this._promises[t].timeout),this._promises[t].reject(e),delete this._promises[t]}}d.Centrifuge=N,N.SubscriptionState=p.SubscriptionState,N.State=p.State},36836:(W,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.unsubscribedCodes=d.subscribingCodes=d.disconnectedCodes=d.connectingCodes=d.errorCodes=void 0,d.errorCodes={timeout:1,transportClosed:2,clientDisconnected:3,clientClosed:4,clientConnectToken:5,clientRefreshToken:6,subscriptionUnsubscribed:7,subscriptionSubscribeToken:8,subscriptionRefreshToken:9,transportWriteError:10,connectionClosed:11},d.connectingCodes={connectCalled:0,transportClosed:1,noPing:2,subscribeTimeout:3,unsubscribeError:4},d.disconnectedCodes={disconnectCalled:0,unauthorized:1,badProtocol:2,messageSizeLimit:3},d.subscribingCodes={subscribeCalled:0,transportClosed:1},d.unsubscribedCodes={unsubscribeCalled:0,unauthorized:1,clientClosed:2}},40503:function(W,d,S){var R=this&&this.__createBinding||(Object.create?function(l,T,_,n){n===void 0&&(n=_);var u=Object.getOwnPropertyDescriptor(T,_);(!u||("get"in u?!T.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return T[_]}}),Object.defineProperty(l,n,u)}:function(l,T,_,n){n===void 0&&(n=_),l[n]=T[_]}),v=this&&this.__exportStar||function(l,T){for(var _ in l)_!=="default"&&!Object.prototype.hasOwnProperty.call(T,_)&&R(T,l,_)};Object.defineProperty(d,"__esModule",{value:!0}),d.Subscription=d.Centrifuge=void 0;const h=S(47155);Object.defineProperty(d,"Centrifuge",{enumerable:!0,get:function(){return h.Centrifuge}});const a=S(46203);Object.defineProperty(d,"Subscription",{enumerable:!0,get:function(){return a.Subscription}}),v(S(61654),d)},47914:(W,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.JsonDecoder=d.JsonEncoder=void 0;class S{encodeCommands(h){return h.map(a=>JSON.stringify(a)).join(`
`)}}d.JsonEncoder=S;class R{decodeReplies(h){return h.trim().split(`
`).map(a=>JSON.parse(a))}}d.JsonDecoder=R},46203:function(W,d,S){var R=this&&this.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(d,"__esModule",{value:!0}),d.Subscription=void 0;const v=R(S(3988)),h=S(36836),a=S(61654),l=S(31846);class T extends v.default{constructor(n,u,g){super(),this._resubscribeTimeout=null,this._refreshTimeout=null,this.channel=u,this.state=a.SubscriptionState.Unsubscribed,this._centrifuge=n,this._token=null,this._getToken=null,this._data=null,this._recover=!1,this._offset=null,this._epoch=null,this._recoverable=!1,this._positioned=!1,this._joinLeave=!1,this._minResubscribeDelay=500,this._maxResubscribeDelay=2e4,this._resubscribeTimeout=null,this._resubscribeAttempts=0,this._promises={},this._promiseId=0,this._inflight=!1,this._refreshTimeout=null,this._setOptions(g),this._centrifuge._debugEnabled?(this.on("state",p=>{this._centrifuge._debug("subscription state",u,p.oldState,"->",p.newState)}),this.on("error",p=>{this._centrifuge._debug("subscription error",u,p)})):this.on("error",function(){Function.prototype()})}ready(n){return this.state===a.SubscriptionState.Unsubscribed?Promise.reject({code:h.errorCodes.subscriptionUnsubscribed,message:this.state}):this.state===a.SubscriptionState.Subscribed?Promise.resolve():new Promise((u,g)=>{const p={resolve:u,reject:g};n&&(p.timeout=setTimeout(function(){g({code:h.errorCodes.timeout,message:"timeout"})},n)),this._promises[this._nextPromiseId()]=p})}subscribe(){this._isSubscribed()||(this._resubscribeAttempts=0,this._setSubscribing(h.subscribingCodes.subscribeCalled,"subscribe called"))}unsubscribe(){this._setUnsubscribed(h.unsubscribedCodes.unsubscribeCalled,"unsubscribe called",!0)}publish(n){const u=this;return this._methodCall().then(function(){return u._centrifuge.publish(u.channel,n)})}presence(){const n=this;return this._methodCall().then(function(){return n._centrifuge.presence(n.channel)})}presenceStats(){const n=this;return this._methodCall().then(function(){return n._centrifuge.presenceStats(n.channel)})}history(n){const u=this;return this._methodCall().then(function(){return u._centrifuge.history(u.channel,n)})}_methodCall(){return this._isSubscribed()?Promise.resolve():this._isUnsubscribed()?Promise.reject({code:h.errorCodes.subscriptionUnsubscribed,message:this.state}):new Promise((n,u)=>{const g=setTimeout(function(){u({code:h.errorCodes.timeout,message:"timeout"})},this._centrifuge._config.timeout);this._promises[this._nextPromiseId()]={timeout:g,resolve:n,reject:u}})}_nextPromiseId(){return++this._promiseId}_needRecover(){return this._recover===!0}_isUnsubscribed(){return this.state===a.SubscriptionState.Unsubscribed}_isSubscribing(){return this.state===a.SubscriptionState.Subscribing}_isSubscribed(){return this.state===a.SubscriptionState.Subscribed}_setState(n){if(this.state!==n){const u=this.state;return this.state=n,this.emit("state",{newState:n,oldState:u,channel:this.channel}),!0}return!1}_usesToken(){return this._token!==null||this._getToken!==null}_clearSubscribingState(){this._resubscribeAttempts=0,this._clearResubscribeTimeout()}_clearSubscribedState(){this._clearRefreshTimeout()}_setSubscribed(n){if(!this._isSubscribing())return;this._clearSubscribingState(),n.recoverable&&(this._recover=!0,this._offset=n.offset||0,this._epoch=n.epoch||""),this._setState(a.SubscriptionState.Subscribed);const u=this._centrifuge._getSubscribeContext(this.channel,n);this.emit("subscribed",u),this._resolvePromises();const g=n.publications;if(g&&g.length>0)for(const p in g)g.hasOwnProperty(p)&&this._handlePublication(g[p]);n.expires===!0&&(this._refreshTimeout=setTimeout(()=>this._refresh(),(0,l.ttlMilliseconds)(n.ttl)))}_setSubscribing(n,u){this._isSubscribing()||(this._isSubscribed()&&this._clearSubscribedState(),this._setState(a.SubscriptionState.Subscribing)&&this.emit("subscribing",{channel:this.channel,code:n,reason:u}),this._subscribe(!1,!1))}_subscribe(n,u){if(this._centrifuge._debug("subscribing on",this.channel),this._centrifuge.state!==a.State.Connected&&!n)return this._centrifuge._debug("delay subscribe on",this.channel,"till connected"),null;if(this._usesToken()){if(this._token)return this._sendSubscribe(this._token,u);{if(n)return null;const g=this;return this._getSubscriptionToken().then(function(p){if(g._isSubscribing()){if(!p){g._failUnauthorized();return}g._token=p,g._sendSubscribe(p,!1)}}).catch(function(p){g._isSubscribing()&&(g.emit("error",{type:"subscribeToken",channel:g.channel,error:{code:h.errorCodes.subscriptionSubscribeToken,message:p!==void 0?p.toString():""}}),g._scheduleResubscribe())}),null}}else return this._sendSubscribe("",u)}_sendSubscribe(n,u){const p={channel:this.channel};if(n&&(p.token=n),this._data&&(p.data=this._data),this._positioned&&(p.positioned=!0),this._recoverable&&(p.recoverable=!0),this._joinLeave&&(p.join_leave=!0),this._needRecover()){p.recover=!0;const x=this._getOffset();x&&(p.offset=x);const N=this._getEpoch();N&&(p.epoch=N)}const j={subscribe:p};return this._inflight=!0,this._centrifuge._call(j,u).then(x=>{this._inflight=!1;const N=x.reply.subscribe;this._handleSubscribeResponse(N),x.next&&x.next()},x=>{this._inflight=!1,this._handleSubscribeError(x.error),x.next&&x.next()}),j}_handleSubscribeError(n){if(this._isSubscribing()){if(n.code===h.errorCodes.timeout){this._centrifuge._disconnect(h.connectingCodes.subscribeTimeout,"subscribe timeout",!0);return}this._subscribeError(n)}}_handleSubscribeResponse(n){this._isSubscribing()&&this._setSubscribed(n)}_setUnsubscribed(n,u,g){this._isUnsubscribed()||(this._isSubscribed()&&(g&&this._centrifuge._unsubscribe(this),this._clearSubscribedState()),this._isSubscribing()&&this._clearSubscribingState(),this._setState(a.SubscriptionState.Unsubscribed)&&this.emit("unsubscribed",{channel:this.channel,code:n,reason:u}),this._rejectPromises({code:h.errorCodes.subscriptionUnsubscribed,message:this.state}))}_handlePublication(n){const u=this._centrifuge._getPublicationContext(this.channel,n);this.emit("publication",u),n.offset&&(this._offset=n.offset)}_handleJoin(n){const u=this._centrifuge._getJoinLeaveContext(n.info);this.emit("join",{channel:this.channel,info:u})}_handleLeave(n){const u=this._centrifuge._getJoinLeaveContext(n.info);this.emit("leave",{channel:this.channel,info:u})}_resolvePromises(){for(const n in this._promises)this._promises[n].timeout&&clearTimeout(this._promises[n].timeout),this._promises[n].resolve(),delete this._promises[n]}_rejectPromises(n){for(const u in this._promises)this._promises[u].timeout&&clearTimeout(this._promises[u].timeout),this._promises[u].reject(n),delete this._promises[u]}_scheduleResubscribe(){const n=this,u=this._getResubscribeDelay();this._resubscribeTimeout=setTimeout(function(){n._isSubscribing()&&n._subscribe(!1,!1)},u)}_subscribeError(n){if(this._isSubscribing())if(n.code<100||n.code===109||n.temporary===!0){n.code===109&&(this._token=null);const u={channel:this.channel,type:"subscribe",error:n};this._centrifuge.state===a.State.Connected&&this.emit("error",u),this._scheduleResubscribe()}else this._setUnsubscribed(n.code,n.message,!1)}_getResubscribeDelay(){const n=(0,l.backoff)(this._resubscribeAttempts,this._minResubscribeDelay,this._maxResubscribeDelay);return this._resubscribeAttempts++,n}_setOptions(n){n&&(n.since&&(this._offset=n.since.offset,this._epoch=n.since.epoch,this._recover=!0),n.data&&(this._data=n.data),n.minResubscribeDelay!==void 0&&(this._minResubscribeDelay=n.minResubscribeDelay),n.maxResubscribeDelay!==void 0&&(this._maxResubscribeDelay=n.maxResubscribeDelay),n.token&&(this._token=n.token),n.getToken&&(this._getToken=n.getToken),n.positioned===!0&&(this._positioned=!0),n.recoverable===!0&&(this._recoverable=!0),n.joinLeave===!0&&(this._joinLeave=!0))}_getOffset(){const n=this._offset;return n!==null?n:0}_getEpoch(){const n=this._epoch;return n!==null?n:""}_clearRefreshTimeout(){this._refreshTimeout!==null&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null)}_clearResubscribeTimeout(){this._resubscribeTimeout!==null&&(clearTimeout(this._resubscribeTimeout),this._resubscribeTimeout=null)}_getSubscriptionToken(){this._centrifuge._debug("get subscription token for channel",this.channel);const n={channel:this.channel},u=this._getToken;if(u===null)throw new Error("provide a function to get channel subscription token");return u(n)}_refresh(){this._clearRefreshTimeout();const n=this;this._getSubscriptionToken().then(function(u){if(!n._isSubscribed())return;if(!u){n._failUnauthorized();return}n._token=u;const p={sub_refresh:{channel:n.channel,token:u}};n._centrifuge._call(p).then(j=>{const x=j.reply.sub_refresh;n._refreshResponse(x),j.next&&j.next()},j=>{n._refreshError(j.error),j.next&&j.next()})}).catch(function(u){n.emit("error",{type:"refreshToken",channel:n.channel,error:{code:h.errorCodes.subscriptionRefreshToken,message:u!==void 0?u.toString():""}}),n._refreshTimeout=setTimeout(()=>n._refresh(),n._getRefreshRetryDelay())})}_refreshResponse(n){this._isSubscribed()&&(this._centrifuge._debug("subscription token refreshed, channel",this.channel),this._clearRefreshTimeout(),n.expires===!0&&(this._refreshTimeout=setTimeout(()=>this._refresh(),(0,l.ttlMilliseconds)(n.ttl))))}_refreshError(n){this._isSubscribed()&&(n.code<100||n.temporary===!0?(this.emit("error",{type:"refresh",channel:this.channel,error:n}),this._refreshTimeout=setTimeout(()=>this._refresh(),this._getRefreshRetryDelay())):this._setUnsubscribed(n.code,n.message,!0))}_getRefreshRetryDelay(){return(0,l.backoff)(0,1e4,2e4)}_failUnauthorized(){this._setUnsubscribed(h.unsubscribedCodes.unauthorized,"unauthorized",!0)}}d.Subscription=T},38740:(W,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.HttpStreamTransport=void 0;class S{constructor(v,h){this.endpoint=v,this.options=h,this._abortController=null,this._utf8decoder=new TextDecoder,this._protocol="json"}name(){return"http_stream"}subName(){return"http_stream"}emulation(){return!0}_handleErrors(v){if(!v.ok)throw new Error(v.status);return v}_fetchEventTarget(v,h,a){const l=new EventTarget,T=v.options.fetch;return T(h,a).then(v._handleErrors).then(_=>{l.dispatchEvent(new Event("open"));let n="",u=0,g=new Uint8Array;const p=_.body.getReader();return new v.options.readableStream({start(j){function x(){return p.read().then(({done:N,value:F})=>{if(N){l.dispatchEvent(new Event("close")),j.close();return}try{if(v._protocol==="json")for(n+=v._utf8decoder.decode(F);u<n.length;)if(n[u]===`
`){const e=n.substring(0,u);l.dispatchEvent(new MessageEvent("message",{data:e})),n=n.substring(u+1),u=0}else++u;else{const e=new Uint8Array(g.length+F.length);for(e.set(g),e.set(F,g.length),g=e;;){const t=v.options.decoder.decodeReply(g);if(t.ok){const i=g.slice(0,t.pos);l.dispatchEvent(new MessageEvent("message",{data:i})),g=g.slice(t.pos);continue}break}}}catch(e){l.dispatchEvent(new Event("error",{detail:e})),l.dispatchEvent(new Event("close")),j.close();return}x()}).catch(function(N){l.dispatchEvent(new Event("error",{detail:N})),l.dispatchEvent(new Event("close")),j.close()})}return x()}})}).catch(_=>{l.dispatchEvent(new Event("error",{detail:_})),l.dispatchEvent(new Event("close"))}),l}supported(){return this.options.fetch!==null&&this.options.readableStream!==null&&typeof TextDecoder<"u"&&typeof AbortController<"u"&&typeof EventTarget<"u"&&typeof Event<"u"&&typeof MessageEvent<"u"&&typeof Error<"u"}initialize(v,h,a){this._protocol=v,this._abortController=new AbortController;let l,T;v==="json"?(l={Accept:"application/json","Content-Type":"application/json"},T=a):(l={Accept:"application/octet-stream","Content-Type":"application/octet-stream"},T=a);const _={method:"POST",headers:l,body:T,mode:"cors",credentials:"same-origin",cache:"no-cache",signal:this._abortController.signal},n=this._fetchEventTarget(this,this.endpoint,_);n.addEventListener("open",()=>{h.onOpen()}),n.addEventListener("error",u=>{this._abortController.abort(),h.onError(u)}),n.addEventListener("close",()=>{this._abortController.abort(),h.onClose({code:4,reason:"connection closed"})}),n.addEventListener("message",u=>{h.onMessage(u.data)})}close(){this._abortController.abort()}send(v,h,a){let l,T;const _={session:h,node:a,data:v};this._protocol==="json"?(l={"Content-Type":"application/json"},T=JSON.stringify(_)):(l={"Content-Type":"application/octet-stream"},T=this.options.encoder.encodeEmulationRequest(_));const n=this.options.fetch,u={method:"POST",headers:l,body:T,mode:"cors",credentials:"same-origin",cache:"no-cache"};n(this.options.emulationEndpoint,u)}}d.HttpStreamTransport=S},96417:(W,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.SockjsTransport=void 0;class S{constructor(v,h){this.endpoint=v,this.options=h,this._transport=null}name(){return"sockjs"}subName(){return"sockjs-"+this._transport.transport}emulation(){return!1}supported(){return this.options.sockjs!==null}initialize(v,h){this._transport=new this.options.sockjs(this.endpoint,null,this.options.sockjsOptions),this._transport.onopen=()=>{h.onOpen()},this._transport.onerror=a=>{h.onError(a)},this._transport.onclose=a=>{h.onClose(a)},this._transport.onmessage=a=>{h.onMessage(a.data)}}close(){this._transport.close()}send(v){this._transport.send(v)}}d.SockjsTransport=S},12377:(W,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.SseTransport=void 0;class S{constructor(v,h){this.endpoint=v,this.options=h,this._protocol="json",this._transport=null,this._onClose=null}name(){return"sse"}subName(){return"sse"}emulation(){return!0}supported(){return this.options.eventsource!==null&&this.options.fetch!==null}initialize(v,h,a){let l;globalThis&&globalThis.document&&globalThis.document.baseURI?l=new URL(this.endpoint,globalThis.document.baseURI):l=new URL(this.endpoint),l.searchParams.append("cf_connect",a);const T={},_=new this.options.eventsource(l.toString(),T);this._transport=_;const n=this;_.onopen=function(){h.onOpen()},_.onerror=function(u){_.close(),h.onError(u),h.onClose({code:4,reason:"connection closed"})},_.onmessage=function(u){h.onMessage(u.data)},n._onClose=function(){h.onClose({code:4,reason:"connection closed"})}}close(){this._transport.close(),this._onClose!==null&&this._onClose()}send(v,h,a){const l={session:h,node:a,data:v},T={"Content-Type":"application/json"},_=JSON.stringify(l),n=this.options.fetch,u={method:"POST",headers:T,body:_,mode:"cors",credentials:"same-origin",cache:"no-cache"};n(this.options.emulationEndpoint,u)}}d.SseTransport=S},47278:(W,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.WebsocketTransport=void 0;class S{constructor(v,h){this.endpoint=v,this.options=h,this._transport=null}name(){return"websocket"}subName(){return"websocket"}emulation(){return!1}supported(){return this.options.websocket!==void 0&&this.options.websocket!==null}initialize(v,h){let a="";v==="protobuf"&&(a="centrifuge-protobuf"),a!==""?this._transport=new this.options.websocket(this.endpoint,a):this._transport=new this.options.websocket(this.endpoint),v==="protobuf"&&(this._transport.binaryType="arraybuffer"),this._transport.onopen=()=>{h.onOpen()},this._transport.onerror=l=>{h.onError(l)},this._transport.onclose=l=>{h.onClose(l)},this._transport.onmessage=l=>{h.onMessage(l.data)}}close(){this._transport.close()}send(v){this._transport.send(v)}}d.WebsocketTransport=S},70351:function(W,d){var S=this&&this.__awaiter||function(v,h,a,l){function T(_){return _ instanceof a?_:new a(function(n){n(_)})}return new(a||(a=Promise))(function(_,n){function u(j){try{p(l.next(j))}catch(x){n(x)}}function g(j){try{p(l.throw(j))}catch(x){n(x)}}function p(j){j.done?_(j.value):T(j.value).then(u,g)}p((l=l.apply(v,h||[])).next())})};Object.defineProperty(d,"__esModule",{value:!0}),d.WebtransportTransport=void 0;class R{constructor(h,a){this.endpoint=h,this.options=a,this._transport=null,this._stream=null,this._writer=null,this._utf8decoder=new TextDecoder,this._protocol="json"}name(){return"webtransport"}subName(){return"webtransport"}emulation(){return!1}supported(){return this.options.webtransport!==void 0&&this.options.webtransport!==null}initialize(h,a){return S(this,void 0,void 0,function*(){let l;globalThis&&globalThis.document&&globalThis.document.baseURI?l=new URL(this.endpoint,globalThis.document.baseURI):l=new URL(this.endpoint),h==="protobuf"&&l.searchParams.append("cf_protocol","protobuf"),this._protocol=h;const T=new EventTarget;this._transport=new this.options.webtransport(l.toString()),this._transport.closed.then(()=>{a.onClose({code:4,reason:"connection closed"})}).catch(()=>{a.onClose({code:4,reason:"connection closed"})});try{yield this._transport.ready}catch{this.close();return}let _;try{_=yield this._transport.createBidirectionalStream()}catch{this.close();return}this._stream=_,this._writer=this._stream.writable.getWriter(),T.addEventListener("close",()=>{a.onClose({code:4,reason:"connection closed"})}),T.addEventListener("message",n=>{a.onMessage(n.data)}),this._startReading(T),a.onOpen()})}_startReading(h){return S(this,void 0,void 0,function*(){const a=this._stream.readable.getReader();let l="",T=0,_=new Uint8Array;try{for(;;){const{done:n,value:u}=yield a.read();if(u.length>0)if(this._protocol==="json")for(l+=this._utf8decoder.decode(u);T<l.length;)if(l[T]===`
`){const g=l.substring(0,T);h.dispatchEvent(new MessageEvent("message",{data:g})),l=l.substring(T+1),T=0}else++T;else{const g=new Uint8Array(_.length+u.length);for(g.set(_),g.set(u,_.length),_=g;;){const p=this.options.decoder.decodeReply(_);if(p.ok){const j=_.slice(0,p.pos);h.dispatchEvent(new MessageEvent("message",{data:j})),_=_.slice(p.pos);continue}break}}if(n)break}}catch{h.dispatchEvent(new Event("close"))}})}close(){return S(this,void 0,void 0,function*(){try{this._writer&&(yield this._writer.close()),this._transport.close()}catch{}})}send(h){return S(this,void 0,void 0,function*(){let a;this._protocol==="json"?a=new TextEncoder().encode(h+`
`):a=h;try{yield this._writer.write(a)}catch{this.close()}})}}d.WebtransportTransport=R},61654:(W,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.SubscriptionState=d.State=void 0;var S;(function(v){v.Disconnected="disconnected",v.Connecting="connecting",v.Connected="connected"})(S=d.State||(d.State={}));var R;(function(v){v.Unsubscribed="unsubscribed",v.Subscribing="subscribing",v.Subscribed="subscribed"})(R=d.SubscriptionState||(d.SubscriptionState={}))},31846:(W,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.ttlMilliseconds=d.errorExists=d.backoff=d.log=d.isFunction=d.startsWith=void 0;function S(_,n){return _.lastIndexOf(n,0)===0}d.startsWith=S;function R(_){return _==null?!1:typeof _=="function"}d.isFunction=R;function v(_,n){if(globalThis.console){const u=globalThis.console[_];R(u)&&u.apply(globalThis.console,n)}}d.log=v;function h(_,n){return Math.floor(Math.random()*(n-_+1)+_)}function a(_,n,u){_>31&&(_=31);const g=h(0,Math.min(u,n*Math.pow(2,_)));return Math.min(u,n+g)}d.backoff=a;function l(_){return"error"in _&&_.error!==null}d.errorExists=l;function T(_){return Math.min(_*1e3,2147483647)}d.ttlMilliseconds=T},3988:W=>{var d=typeof Reflect=="object"?Reflect:null,S=d&&typeof d.apply=="function"?d.apply:function(r,o,w){return Function.prototype.apply.call(r,o,w)},R;d&&typeof d.ownKeys=="function"?R=d.ownKeys:Object.getOwnPropertySymbols?R=function(r){return Object.getOwnPropertyNames(r).concat(Object.getOwnPropertySymbols(r))}:R=function(r){return Object.getOwnPropertyNames(r)};function v(s){console&&console.warn&&console.warn(s)}var h=Number.isNaN||function(r){return r!==r};function a(){a.init.call(this)}W.exports=a,W.exports.once=e,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var l=10;function T(s){if(typeof s!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(s){if(typeof s!="number"||s<0||h(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");l=s}}),a.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(r){if(typeof r!="number"||r<0||h(r))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+r+".");return this._maxListeners=r,this};function _(s){return s._maxListeners===void 0?a.defaultMaxListeners:s._maxListeners}a.prototype.getMaxListeners=function(){return _(this)},a.prototype.emit=function(r){for(var o=[],w=1;w<arguments.length;w++)o.push(arguments[w]);var C=r==="error",L=this._events;if(L!==void 0)C=C&&L.error===void 0;else if(!C)return!1;if(C){var P;if(o.length>0&&(P=o[0]),P instanceof Error)throw P;var O=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw O.context=P,O}var f=L[r];if(f===void 0)return!1;if(typeof f=="function")S(f,this,o);else for(var b=f.length,m=x(f,b),w=0;w<b;++w)S(m[w],this,o);return!0};function n(s,r,o,w){var C,L,P;if(T(o),L=s._events,L===void 0?(L=s._events=Object.create(null),s._eventsCount=0):(L.newListener!==void 0&&(s.emit("newListener",r,o.listener?o.listener:o),L=s._events),P=L[r]),P===void 0)P=L[r]=o,++s._eventsCount;else if(typeof P=="function"?P=L[r]=w?[o,P]:[P,o]:w?P.unshift(o):P.push(o),C=_(s),C>0&&P.length>C&&!P.warned){P.warned=!0;var O=new Error("Possible EventEmitter memory leak detected. "+P.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit");O.name="MaxListenersExceededWarning",O.emitter=s,O.type=r,O.count=P.length,v(O)}return s}a.prototype.addListener=function(r,o){return n(this,r,o,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(r,o){return n(this,r,o,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function g(s,r,o){var w={fired:!1,wrapFn:void 0,target:s,type:r,listener:o},C=u.bind(w);return C.listener=o,w.wrapFn=C,C}a.prototype.once=function(r,o){return T(o),this.on(r,g(this,r,o)),this},a.prototype.prependOnceListener=function(r,o){return T(o),this.prependListener(r,g(this,r,o)),this},a.prototype.removeListener=function(r,o){var w,C,L,P,O;if(T(o),C=this._events,C===void 0)return this;if(w=C[r],w===void 0)return this;if(w===o||w.listener===o)--this._eventsCount===0?this._events=Object.create(null):(delete C[r],C.removeListener&&this.emit("removeListener",r,w.listener||o));else if(typeof w!="function"){for(L=-1,P=w.length-1;P>=0;P--)if(w[P]===o||w[P].listener===o){O=w[P].listener,L=P;break}if(L<0)return this;L===0?w.shift():N(w,L),w.length===1&&(C[r]=w[0]),C.removeListener!==void 0&&this.emit("removeListener",r,O||o)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(r){var o,w,C;if(w=this._events,w===void 0)return this;if(w.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):w[r]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete w[r]),this;if(arguments.length===0){var L=Object.keys(w),P;for(C=0;C<L.length;++C)P=L[C],P!=="removeListener"&&this.removeAllListeners(P);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(o=w[r],typeof o=="function")this.removeListener(r,o);else if(o!==void 0)for(C=o.length-1;C>=0;C--)this.removeListener(r,o[C]);return this};function p(s,r,o){var w=s._events;if(w===void 0)return[];var C=w[r];return C===void 0?[]:typeof C=="function"?o?[C.listener||C]:[C]:o?F(C):x(C,C.length)}a.prototype.listeners=function(r){return p(this,r,!0)},a.prototype.rawListeners=function(r){return p(this,r,!1)},a.listenerCount=function(s,r){return typeof s.listenerCount=="function"?s.listenerCount(r):j.call(s,r)},a.prototype.listenerCount=j;function j(s){var r=this._events;if(r!==void 0){var o=r[s];if(typeof o=="function")return 1;if(o!==void 0)return o.length}return 0}a.prototype.eventNames=function(){return this._eventsCount>0?R(this._events):[]};function x(s,r){for(var o=new Array(r),w=0;w<r;++w)o[w]=s[w];return o}function N(s,r){for(;r+1<s.length;r++)s[r]=s[r+1];s.pop()}function F(s){for(var r=new Array(s.length),o=0;o<r.length;++o)r[o]=s[o].listener||s[o];return r}function e(s,r){return new Promise(function(o,w){function C(P){s.removeListener(r,L),w(P)}function L(){typeof s.removeListener=="function"&&s.removeListener("error",C),o([].slice.call(arguments))}i(s,r,L,{once:!0}),r!=="error"&&t(s,C,{once:!0})})}function t(s,r,o){typeof s.on=="function"&&i(s,"error",r,o)}function i(s,r,o,w){if(typeof s.on=="function")w.once?s.once(r,o):s.on(r,o);else if(typeof s.addEventListener=="function")s.addEventListener(r,function C(L){w.once&&s.removeEventListener(r,C),o(L)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof s)}},40333:(W,d,S)=>{S.d(d,{Jj:()=>p,Ud:()=>N,Y6:()=>u,sj:()=>O});/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const R=Symbol("Comlink.proxy"),v=Symbol("Comlink.endpoint"),h=Symbol("Comlink.releaseProxy"),a=Symbol("Comlink.finalizer"),l=Symbol("Comlink.thrown"),T=c=>typeof c=="object"&&c!==null||typeof c=="function",_={canHandle:c=>T(c)&&c[R],serialize(c){const{port1:E,port2:k}=new MessageChannel;return p(c,E),[k,[k]]},deserialize(c){return c.start(),N(c)}},n={canHandle:c=>T(c)&&l in c,serialize({value:c}){let E;return c instanceof Error?E={isError:!0,value:{message:c.message,name:c.name,stack:c.stack}}:E={isError:!1,value:c},[E,[]]},deserialize(c){throw c.isError?Object.assign(new Error(c.value.message),c.value):c.value}},u=new Map([["proxy",_],["throw",n]]);function g(c,E){for(const k of c)if(E===k||k==="*"||k instanceof RegExp&&k.test(E))return!0;return!1}function p(c,E=globalThis,k=["*"]){E.addEventListener("message",function B(A){if(!A||!A.data)return;if(!g(k,A.origin)){console.warn(`Invalid origin '${A.origin}' for comlink proxy`);return}const{id:$,type:z,path:J}=Object.assign({path:[]},A.data),D=(A.data.argumentList||[]).map(m);let M;try{const I=J.slice(0,-1).reduce((V,G)=>V[G],c),H=J.reduce((V,G)=>V[G],c);switch(z){case"GET":M=H;break;case"SET":I[J.slice(-1)[0]]=m(A.data.value),M=!0;break;case"APPLY":M=H.apply(I,D);break;case"CONSTRUCT":{const V=new H(...D);M=O(V)}break;case"ENDPOINT":{const{port1:V,port2:G}=new MessageChannel;p(c,G),M=P(V,[V])}break;case"RELEASE":M=void 0;break;default:return}}catch(I){M={value:I,[l]:0}}Promise.resolve(M).catch(I=>({value:I,[l]:0})).then(I=>{const[H,V]=b(I);E.postMessage(Object.assign(Object.assign({},H),{id:$}),V),z==="RELEASE"&&(E.removeEventListener("message",B),x(E),a in c&&typeof c[a]=="function"&&c[a]())}).catch(I=>{const[H,V]=b({value:new TypeError("Unserializable return value"),[l]:0});E.postMessage(Object.assign(Object.assign({},H),{id:$}),V)})}),E.start&&E.start()}function j(c){return c.constructor.name==="MessagePort"}function x(c){j(c)&&c.close()}function N(c,E){return o(c,[],E)}function F(c){if(c)throw new Error("Proxy has been released and is not useable")}function e(c){return y(c,{type:"RELEASE"}).then(()=>{x(c)})}const t=new WeakMap,i="FinalizationRegistry"in globalThis&&new FinalizationRegistry(c=>{const E=(t.get(c)||0)-1;t.set(c,E),E===0&&e(c)});function s(c,E){const k=(t.get(E)||0)+1;t.set(E,k),i&&i.register(c,E,c)}function r(c){i&&i.unregister(c)}function o(c,E=[],k=function(){}){let B=!1;const A=new Proxy(k,{get($,z){if(F(B),z===h)return()=>{r(A),e(c),B=!0};if(z==="then"){if(E.length===0)return{then:()=>A};const J=y(c,{type:"GET",path:E.map(D=>D.toString())}).then(m);return J.then.bind(J)}return o(c,[...E,z])},set($,z,J){F(B);const[D,M]=b(J);return y(c,{type:"SET",path:[...E,z].map(I=>I.toString()),value:D},M).then(m)},apply($,z,J){F(B);const D=E[E.length-1];if(D===v)return y(c,{type:"ENDPOINT"}).then(m);if(D==="bind")return o(c,E.slice(0,-1));const[M,I]=C(J);return y(c,{type:"APPLY",path:E.map(H=>H.toString()),argumentList:M},I).then(m)},construct($,z){F(B);const[J,D]=C(z);return y(c,{type:"CONSTRUCT",path:E.map(M=>M.toString()),argumentList:J},D).then(m)}});return s(A,c),A}function w(c){return Array.prototype.concat.apply([],c)}function C(c){const E=c.map(b);return[E.map(k=>k[0]),w(E.map(k=>k[1]))]}const L=new WeakMap;function P(c,E){return L.set(c,E),c}function O(c){return Object.assign(c,{[R]:!0})}function f(c,E=globalThis,k="*"){return{postMessage:(B,A)=>c.postMessage(B,k,A),addEventListener:E.addEventListener.bind(E),removeEventListener:E.removeEventListener.bind(E)}}function b(c){for(const[E,k]of u)if(k.canHandle(c)){const[B,A]=k.serialize(c);return[{type:"HANDLER",name:E,value:B},A]}return[{type:"RAW",value:c},L.get(c)||[]]}function m(c){switch(c.type){case"HANDLER":return u.get(c.name).deserialize(c.value);case"RAW":return c.value}}function y(c,E,k){return new Promise(B=>{const A=U();c.addEventListener("message",function $(z){!z.data||!z.data.id||z.data.id!==A||(c.removeEventListener("message",$),B(z.data))}),c.start&&c.start(),c.postMessage(Object.assign({id:A},E),k)})}function U(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}}}]);

//# sourceMappingURL=3128.f46babc47764ad7108eb.js.map