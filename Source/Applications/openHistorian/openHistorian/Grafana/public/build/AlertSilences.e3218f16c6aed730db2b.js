"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9347],{69645:(b,E,t)=>{t.r(E),t.d(E,{default:()=>Ge});var e=t(74848),x=t(24180),h=t(54148),j=t(66602),A=t(17272),P=t(55740),C=t(32642),T=t(37959),B=t(57895),M=t(98569),r=t(32196),d=t(96540),m=t(85858),f=t(40845),$=t(39558),F=t(42418),D=t(67061),O=t(55852),Q=t(57418),Y=t(14578),ne=t(25994),se=t(50720),G=t(83277),p=t(8484),J=t(91540),ae=t(77583),H=t(57220),N=t(60021),re=t(82843),U=t(19073),I=t(78742),le=t(64853),ie=t(75591),oe=t(64149),ce=t(98164);const de=({matchers:n})=>{const l=(0,f.of)(ue);return(0,e.jsx)("div",{children:(0,e.jsx)(oe.L,{className:l.tags,tags:n.map(a=>`${a.name}${(0,ce.MN)(a)}${a.value}`)})})},ue=()=>({tags:(0,r.css)({justifyContent:"flex-start"})});var ge=t(69529),he=t(76442),xe=t(16233),me=t(75471);const fe=({alertManagerSourceName:n})=>{const l=(0,me.jy)(n);return xe.TP.hasPermission(l.create)?(0,e.jsx)(ge.p,{variant:"call-to-action",button:(0,e.jsx)(O.z9,{href:(0,I.nL)("alerting/silence/new",n),icon:"bell-slash",size:"lg",children:(0,e.jsx)(p.x6,{i18nKey:"silences.empty-state.button-title",children:"Create silence"})}),message:(0,p.t)("silences.empty-state.title","You haven't created any silences yet")}):(0,e.jsx)(he.c,{callToActionElement:(0,e.jsx)("div",{}),message:"No silences found."})};var Z=t(70416),ve=t(4554),je=t(69087),ye=t(64047),Ae=t(97754);const pe=({alert:n,className:l})=>{const[a,o]=(0,d.useState)(!0),i=(0,Z.dU)({start:new Date(n.startsAt),end:new Date(n.endsAt)}),u=Object.entries(n.labels).reduce((c,[g,s])=>((g==="alertname"||g==="__alert_rule_title__")&&(c=s),c),"");return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("tr",{className:l,children:[(0,e.jsx)("td",{children:(0,e.jsx)(ye.e,{isCollapsed:a,onToggle:c=>o(c)})}),(0,e.jsx)("td",{children:(0,e.jsx)(Ae.y,{state:n.status.state})}),(0,e.jsxs)("td",{children:["for ",i]}),(0,e.jsx)("td",{children:u})]}),!a&&(0,e.jsxs)("tr",{className:l,children:[(0,e.jsx)("td",{}),(0,e.jsx)("td",{colSpan:5,children:(0,e.jsx)(je.m,{labels:n.labels,size:"sm"})})]})]})},Se=({silencedAlerts:n})=>{const l=(0,f.of)(ve.L),a=(0,f.of)(Ee);return n.length?(0,e.jsxs)("table",{className:(0,r.cx)(l.table,a.tableMargin),children:[(0,e.jsxs)("colgroup",{children:[(0,e.jsx)("col",{className:l.colExpand}),(0,e.jsx)("col",{className:a.colState}),(0,e.jsx)("col",{}),(0,e.jsx)("col",{className:a.colName})]}),(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{}),(0,e.jsx)("th",{children:(0,e.jsx)(p.x6,{i18nKey:"silences-table.header.state",children:"State"})}),(0,e.jsx)("th",{}),(0,e.jsx)("th",{children:(0,e.jsx)(p.x6,{i18nKey:"silences-table.header.alert-name",children:"Alert name"})})]})}),(0,e.jsx)("tbody",{children:n.map((o,i)=>(0,e.jsx)(pe,{alert:o,className:i%2===0?l.evenRow:""},o.fingerprint))})]}):null},Ee=n=>({tableMargin:(0,r.css)({marginBottom:n.spacing(1)}),colState:(0,r.css)({width:"110px"}),colName:(0,r.css)({width:"65%"})}),Ce=Se,De=({silence:n})=>{const{startsAt:l,endsAt:a,comment:o,createdBy:i,silencedAlerts:u}=n,c=(0,f.of)(Pe),g="YYYY-MM-DD HH:mm",s=m.parse(l),v=m.parse(a),y=(0,Z.dU)({start:new Date(l),end:new Date(a)});return(0,e.jsxs)("div",{className:c.container,children:[(0,e.jsx)("div",{className:c.title,children:"Comment"}),(0,e.jsx)("div",{children:o}),(0,e.jsx)("div",{className:c.title,children:"Schedule"}),(0,e.jsx)("div",{children:`${s?.format(g)} - ${v?.format(g)}`}),(0,e.jsx)("div",{className:c.title,children:"Duration"}),(0,e.jsx)("div",{children:y}),(0,e.jsx)("div",{className:c.title,children:"Created by"}),(0,e.jsx)("div",{children:i}),Array.isArray(u)&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:c.title,children:"Affected alerts"}),(0,e.jsx)(Ce,{silencedAlerts:u})]})]})},Pe=n=>({container:(0,r.css)({display:"grid",gridTemplateColumns:"1fr 9fr",gridRowGap:"1rem",paddingBottom:n.spacing(2)}),title:(0,r.css)({color:n.colors.text.primary}),row:(0,r.css)({margin:n.spacing(1,0)})});var Ie=t(65415);const Te={[N.RC.Active]:"good",[N.RC.Expired]:"neutral",[N.RC.Pending]:"neutral"},Me=({state:n})=>(0,e.jsx)(Ie.O,{state:Te[n],children:n});var X=t(2543),Re=t(88575),Le=t(60029),Oe=t(56034),Ne=t(10354);const w=()=>(0,X.uniqueId)("query-string-"),ze=()=>{const[n,l]=(0,d.useState)(w()),[a,o]=(0,G.s)(),{queryString:i}=(0,I.qy)(a),u=(0,f.of)(Be),c=(0,X.debounce)(v=>{const y=v.target;o({queryString:y.value||null})},400),g=()=>{o({queryString:null,silenceState:null}),setTimeout(()=>l(w()))};let s=i&&i.length>3;try{i?(0,C.S6)(i):s=!0}catch{s=!1}return(0,e.jsxs)("div",{className:u.flexRow,children:[(0,e.jsx)(Re.D,{className:u.rowChild,label:(0,e.jsx)(Le.J,{children:(0,e.jsxs)(D.B,{gap:.5,children:[(0,e.jsx)("span",{children:"Search by matchers"}),(0,e.jsx)(Oe.m,{content:(0,e.jsxs)("div",{children:["Filter silences by using a comma separated list of matchers, e.g.:",(0,e.jsx)("pre",{children:"severity=critical, env=production"})]}),children:(0,e.jsx)(Y.I,{name:"info-circle",size:"sm"})})]})}),invalid:!s,error:s?null:"Query must use valid matcher syntax",children:(0,e.jsx)(Ne.p,{className:u.searchInput,prefix:(0,e.jsx)(Y.I,{name:"search"}),onChange:c,defaultValue:i??"",placeholder:"Search","data-testid":"search-query-input"},n)}),i&&(0,e.jsx)("div",{className:u.rowChild,children:(0,e.jsx)(O.$n,{variant:"secondary",icon:"times",onClick:g,children:"Clear filters"})})]})},Be=n=>({searchInput:(0,r.css)({width:"360px"}),flexRow:(0,r.css)({display:"flex",flexDirection:"row",alignItems:"flex-end",paddingBottom:n.spacing(3),borderBottom:`1px solid ${n.colors.border.medium}`}),rowChild:(0,r.css)({marginRight:n.spacing(1),marginBottom:0,maxHeight:"52px"}),fieldLabel:(0,r.css)({fontSize:"12px",fontWeight:500})}),k={pollingInterval:P.wG,refetchOnFocus:!0},Ue=({alertManagerSourceName:n})=>{const[l,a]=(0,U.L7)(U.QI.PreviewSilencedInstances),o=l&&a,{data:i=[],isLoading:u}=re.m.endpoints.getAlertmanagerAlerts.useQuery({amSourceName:n,filter:{silenced:!0,active:!0,inhibited:!0}},{...k,skip:!o}),{data:c=[],isLoading:g,error:s}=J.F.endpoints.getSilences.useQuery({datasourceUid:(0,H.w5)(n),ruleMetadata:!0,accessControl:!0},k),{currentData:v}=ae.L.useDiscoverAmFeaturesQuery({amSourceName:n??""},{skip:!n}),y=(0,I.JZ)(s).includes("the Alertmanager is not configured")&&v?.lazyConfigInit,R=(0,f.of)(Ke),[L]=(0,G.s)(),W=_(c,!1),te=_(c,!0),{silenceState:Ve}=(0,I.qy)(L),Je=Ve===N.RC.Expired,Ze=(0,d.useMemo)(()=>{const K=S=>i.filter(z=>z.status.silencedBy.includes(S));return W.map(S=>{const z=o?K(S.id):void 0;return{id:S.id,data:{...S,silencedAlerts:z}}})},[W,i,o]),V=(0,d.useMemo)(()=>{const K=S=>i.filter(z=>z.status.silencedBy.includes(S));return te.map(S=>{const z=o?K(S.id):void 0;return{id:S.id,data:{...S,silencedAlerts:z}}})},[te,i,o]);if(g||u)return(0,e.jsx)($._,{text:"Loading silences..."});if(y)return(0,e.jsx)(F.F,{title:"The selected Alertmanager has no configuration",severity:"warning",children:(0,e.jsx)(p.x6,{i18nKey:"silences.table.noConfig",children:"Create a new contact point to create a configuration using the default values or contact your administrator to set up the Alertmanager."})});if(s){const K=(0,I.JZ)(s)||"Unknown error.";return(0,e.jsx)(F.F,{severity:"error",title:"Error loading silences",children:K})}return(0,e.jsxs)("div",{"data-testid":"silences-table",children:[!!c.length&&(0,e.jsxs)(D.B,{direction:"column",children:[(0,e.jsx)(ze,{}),(0,e.jsx)(le._,{actions:[U.QI.CreateSilence],children:(0,e.jsx)(D.B,{justifyContent:"end",children:(0,e.jsx)(O.z9,{href:(0,I.nL)("/alerting/silence/new",n),icon:"plus",children:(0,e.jsx)(p.x6,{i18nKey:"silences.table.add-silence-button",children:"Add Silence"})})})}),(0,e.jsx)(q,{items:Ze,alertManagerSourceName:n,dataTestId:"not-expired-table"}),V.length>0&&(0,e.jsxs)(Q.M,{label:`Expired silences (${V.length})`,isOpen:Je,children:[(0,e.jsxs)("div",{className:R.callout,children:[(0,e.jsx)(Y.I,{className:R.calloutIcon,name:"info-circle"}),(0,e.jsx)("span",{children:(0,e.jsx)(p.x6,{i18nKey:"silences.table.expired-silences",children:"Expired silences are automatically deleted after 5 days."})})]}),(0,e.jsx)(q,{items:V,alertManagerSourceName:n,dataTestId:"expired-table"})]})]}),!c.length&&(0,e.jsx)(fe,{alertManagerSourceName:n})]})};function q({items:n,alertManagerSourceName:l,dataTestId:a}){const o=be(l);return n.length?(0,e.jsx)(ie.E,{pagination:{itemsPerPage:25},items:n,cols:o,isExpandable:!0,dataTestId:a,renderExpandedContent:({data:i})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ne.c,{}),(0,e.jsx)(De,{silence:i})]})}):(0,e.jsx)(p.x6,{i18nKey:"silences.table.no-matching-silences",children:"No matching silences found;"})}const _=(n,l=!1)=>{const[a]=(0,G.s)();return(0,d.useMemo)(()=>{const{queryString:o}=(0,I.qy)(a),i=a?.silenceIds;return n.filter(u=>typeof i=="string"&&!i.split(",").includes(u.id)||o&&!(0,C.Zc)(o).every(s=>u.matchers?.some(({name:v,value:y,isEqual:R,isRegex:L})=>s.name===v&&s.value===y&&s.isEqual===R&&s.isRegex===L))?!1:l?u.status.state===N.RC.Expired:u.status.state!==N.RC.Expired)},[a,n,l])},Ke=n=>({callout:(0,r.css)({backgroundColor:n.colors.background.secondary,borderTop:`3px solid ${n.colors.info.border}`,borderRadius:n.shape.radius.default,height:"62px",display:"flex",flexDirection:"row",alignItems:"center","& > *":{marginLeft:n.spacing(1)}}),calloutIcon:(0,r.css)({color:n.colors.info.text})});function be(n){const[l,a]=(0,U.L7)(U.QI.UpdateSilence),[o]=J.F.endpoints.expireSilence.useMutation(),i=n===H.hY;return(0,d.useMemo)(()=>{const u=g=>{o({datasourceUid:(0,H.w5)(n),silenceId:g})},c=[{id:"state",label:"State",renderCell:function({data:{status:s}}){return(0,e.jsx)(Me,{state:s.state})},size:3},{id:"alert-rule",label:"Alert rule targeted",renderCell:function({data:{metadata:s}}){return s?.rule_title?(0,e.jsx)(se.N,{href:`/alerting/grafana/${s?.rule_uid}/view?returnTo=${encodeURIComponent("/alerting/silences")}`,children:s.rule_title}):"None"},size:8},{id:"matchers",label:"Matching labels",renderCell:function({data:{matchers:s}}){const v=s?.filter(y=>y.name!==P.kW)||[];return(0,e.jsx)(de,{matchers:v})},size:7},{id:"alerts",label:"Alerts silenced",renderCell:function({data:{silencedAlerts:s}}){return(0,e.jsx)("span",{"data-testid":"alerts",children:Array.isArray(s)?s.length:"-"})},size:2},{id:"schedule",label:"Schedule",renderCell:function({data:{startsAt:s,endsAt:v}}){const y=m.parse(s),R=m.parse(v),L="YYYY-MM-DD HH:mm";return`${y?.format(L)} - ${R?.format(L)}`},size:7}];return l&&c.push({id:"actions",label:"Actions",renderCell:function({data:s}){const v=s.status.state===N.RC.Expired,y=s?.accessControl?.create,R=s?.accessControl?.write,L=v&&(i?y:a),W=!v&&(i?R:a);return(0,e.jsxs)(D.B,{gap:.5,wrap:"wrap",children:[L&&(0,e.jsx)(O.z9,{title:"Recreate",size:"sm",variant:"secondary",icon:"sync",href:(0,I.nL)(`/alerting/silence/${s.id}/edit`,n),children:(0,e.jsx)(p.x6,{i18nKey:"silences.table.recreate-button",children:"Recreate"})}),W&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(O.z9,{title:"Unsilence",size:"sm",variant:"secondary",icon:"bell",onClick:()=>u(s.id),children:(0,e.jsx)(p.x6,{i18nKey:"silences.table.unsilence-button",children:"Unsilence"})}),(0,e.jsx)(O.z9,{title:"Edit",size:"sm",variant:"secondary",icon:"pen",href:(0,I.nL)(`/alerting/silence/${s.id}/edit`,n),children:(0,e.jsx)(p.x6,{i18nKey:"silences.table.edit-button",children:"Edit"})})]})]})},size:5}),c},[n,o,i,a,l])}const Fe=Ue,ee={icon:"bell-slash"};function We(){const[n,l]=(0,d.useState)(),a=(0,h.RQ)("/alerting/silence/new"),o=(0,h.RQ)("/alerting/silence/:id/edit");return(0,d.useEffect)(()=>{a?l({...ee,id:"silence-new",text:"Silence alert rule",subTitle:"Configure silences to stop notifications from a particular alert rule"}):o&&l({...ee,id:"silence-edit",text:"Edit silence",subTitle:"Recreate existing silence to stop notifications from a particular alert rule"})},[o,a]),n}var $e=t(70383);const Qe=()=>{const{selectedAlertmanager:n}=(0,$e.VI)();return n?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(B.M,{currentAlertmanager:n}),(0,e.jsxs)(x.dO,{children:[(0,e.jsx)(x.qh,{exact:!0,path:"/alerting/silences",children:(0,e.jsx)(Fe,{alertManagerSourceName:n})}),(0,e.jsx)(x.qh,{exact:!0,path:"/alerting/silence/new",children:(0,e.jsx)(He,{selectedAlertmanager:n})}),(0,e.jsx)(x.qh,{exact:!0,path:"/alerting/silence/:id/edit",children:(0,e.jsx)(M.A,{alertManagerSourceName:n})})]})]}):null};function Ye(){const n=We();return(0,e.jsx)(T.y,{navId:"silences",pageNav:n,accessType:"instance",children:(0,e.jsx)(Qe,{})})}const Ge=(0,j.Xc)(Ye,{style:"page"}),He=({selectedAlertmanager:n})=>{const l=(0,h.zy)(),a=new URLSearchParams(l.search),i=(0,C.ou)(a.getAll("matcher")).find(c=>c.name===P.kW)?.value,u=(0,A.Di)((0,A.LP)(a));return(0,e.jsx)(M.G,{formValues:u,alertManagerSourceName:n,ruleUid:i})}},64853:(b,E,t)=>{t.d(E,{_:()=>A});var e=t(74848),x=t(2543),h=t.n(x),j=t(19073);const A=({actions:r,children:d})=>{const m=(0,x.filter)(r,B),f=(0,x.filter)(r,M);return m.length?(0,e.jsx)(P,{actions:m,children:d}):f.length?(0,e.jsx)(C,{actions:f,children:d}):null},P=({actions:r,children:d})=>{const m=(0,j.iI)();return T(m,r)?(0,e.jsx)(e.Fragment,{children:d}):null},C=({actions:r,children:d})=>{const m=(0,j.e2)();return T(m,r)?(0,e.jsx)(e.Fragment,{children:d}):null};function T(r,d){return(0,x.chain)(r).pick(d).values().value().some(([m,f])=>f===!0)}function B(r){return Object.values(j.QI).includes(r)}function M(r){return Object.values(j.RY).includes(r)}},64047:(b,E,t)=>{t.d(E,{e:()=>h});var e=t(74848),x=t(55852);const h=({isCollapsed:j,onToggle:A,idControlled:P,className:C,text:T,size:B="xl",...M})=>(0,e.jsx)(x.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!j,"aria-controls":P,className:C,icon:j?"angle-right":"angle-down",onClick:()=>A(!j),...M,children:T})},57895:(b,E,t)=>{t.d(E,{M:()=>B});var e=t(74848),x=t(32196),h=t(40845),j=t(42418),A=t(60021),P=t(82843),C=t(19073),T=t(57220);function B({currentAlertmanager:r}){const d=(0,h.of)(M),m=r!==T.hY,[f,$]=(0,C.Ej)(C.RY.ReadConfigurationStatus),F=f&&$,{currentData:D}=P.m.endpoints.getGrafanaAlertingConfigurationStatus.useQuery(void 0,{skip:m||!F});if(!(D?.alertmanagersChoice&&[A.nA.External,A.nA.All].includes(D?.alertmanagersChoice))||m)return null;const Q=D.numExternalAlertmanagers>0;return D.alertmanagersChoice===A.nA.External?(0,e.jsxs)(j.F,{title:"Grafana alerts are not delivered to Grafana Alertmanager",children:["Grafana is configured to send alerts to external Alertmanagers only. Changing Grafana Alertmanager configuration will not affect delivery of your alerts.",(0,e.jsx)("div",{className:d.adminHint,children:"To change your Alertmanager setup, go to the Alerting Admin page. If you do not have access, contact your Administrator."})]}):D.alertmanagersChoice===A.nA.All&&Q?(0,e.jsxs)(j.F,{title:"You have additional Alertmanagers to configure",severity:"warning",children:["Ensure you make configuration changes in the correct Alertmanagers; both internal and external. Changing one will not affect the others.",(0,e.jsx)("div",{className:d.adminHint,children:"To change your Alertmanager setup, go to the Alerting Admin page. If you do not have access, contact your Administrator."})]}):null}const M=r=>({adminHint:(0,x.css)({fontSize:r.typography.bodySmall.fontSize,fontWeight:r.typography.bodySmall.fontWeight})})},4554:(b,E,t)=>{t.d(E,{L:()=>x});var e=t(32196);const x=h=>({table:(0,e.css)({width:"100%",borderRadius:h.shape.radius.default,border:`solid 1px ${h.colors.border.weak}`,backgroundColor:h.colors.background.secondary,th:{padding:h.spacing(1)},td:{padding:`0 ${h.spacing(1)}`},tr:{height:"38px"}}),evenRow:(0,e.css)({backgroundColor:h.colors.background.primary}),colExpand:(0,e.css)({width:"36px"}),nameCell:(0,e.css)({gap:h.spacing(1)}),actionsCell:(0,e.css)({textAlign:"right",width:"1%",whiteSpace:"nowrap","& > * + *":{marginLeft:h.spacing(.5)}})})}}]);

//# sourceMappingURL=AlertSilences.e3218f16c6aed730db2b.js.map