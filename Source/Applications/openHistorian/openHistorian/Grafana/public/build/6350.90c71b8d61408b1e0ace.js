"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6350],{66350:(e,r,t)=>{t.r(r),t.d(r,{plugin:()=>nt});var s=t(43215),o=t(90923),i=t(68404),a=t(3490),n=t(82897),c=t.n(n);class u{static createISO8601Duration(e,r){return(0,n.includes)(["hour","minute","h","m"],r)?`PT${e}${r[0].toUpperCase()}`:`P${e}${r[0].toUpperCase()}`}static createISO8601DurationFromInterval(e){const r=+e.slice(0,e.length-1),t=e[e.length-1];if(e.indexOf("ms")>-1)return u.createISO8601Duration(1,"m");if("s"===e[e.length-1]){let e=60*r%60;return e<1&&(e=1),u.createISO8601Duration(e,"m")}return u.createISO8601Duration(r,t)}static findClosestTimeGrain(e,r){const t=(0,n.filter)(r,(e=>"auto"!==e));let o=t[0];const i=s.rangeUtil.intervalToMs(e);for(let e=0;e<t.length;e++)i>s.rangeUtil.intervalToMs(t[e])&&(o=e+1<t.length?t[e+1]:t[e]);return o}static createTimeGrainFromISO8601Duration(e){let r=1;"PT"===e.substring(0,2)&&(r=2);const t=e.substring(r,e.length-1),s=e.substring(e.length-1);return t+" "+u.timeUnitToText(+t,s)}static timeUnitToText(e,r){let t="";return"S"===r&&(t="second"),"M"===r&&(t="minute"),"H"===r&&(t="hour"),"D"===r&&(t="day"),e>1?t+"s":t}static createKbnUnitFromISO8601Duration(e){if("auto"===e)return"auto";let r=1;"PT"===e.substring(0,2)&&(r=2);const t=e.substring(r,e.length-1),s=e.substring(e.length-1);return t+u.timeUnitToKbn(+t,s)}static timeUnitToKbn(e,r){return"S"===r?"s":"M"===r?"m":"H"===r?"h":"D"===r?"d":""}}class l{static parseResponseValues(e,r,t){const s=[];if(!e)return s;for(let o=0;o<e.value.length;o++)if(!(0,n.find)(s,["value",(0,n.get)(e.value[o],t)])){const i=(0,n.get)(e.value[o],t),a=(0,n.get)(e.value[o],r,i);s.push({text:a,value:i})}return s}static parseResourceNames(e,r){const t=[];if(!e)return t;for(let s=0;s<e.value.length;s++)"string"!=typeof e.value[s].type||r&&e.value[s].type.toLocaleLowerCase()!==r.toLocaleLowerCase()||t.push({text:e.value[s].name,value:e.value[s].name});return t}static parseMetadata(e,r){var t,s;const o=["None","Average","Minimum","Maximum","Total","Count"],i=null==e?void 0:e.value.find((e=>e.name.value===r));return i?{primaryAggType:i.primaryAggregationType,supportedAggTypes:i.supportedAggregationTypes||o,supportedTimeGrains:[{label:"Auto",value:"auto"},...l.parseTimeGrains(null!==(t=i.metricAvailabilities)&&void 0!==t?t:[])],dimensions:l.parseDimensions(null!==(s=i.dimensions)&&void 0!==s?s:[])}:{primaryAggType:"",supportedAggTypes:o,supportedTimeGrains:[],dimensions:[]}}static parseTimeGrains(e){const r=[];return e?(e.forEach((e=>{e.timeGrain&&r.push({label:u.createTimeGrainFromISO8601Duration(e.timeGrain),value:e.timeGrain})})),r):r}static parseDimensions(e){return e.map((e=>({label:e.localizedValue||e.value,value:e.value})))}static parseSubscriptions(e){const r=[];if(!e)return r;const t="subscriptionId";for(let s=0;s<e.value.length;s++)(0,n.find)(r,["value",(0,n.get)(e.value[s],t)])||r.push({text:`${(0,n.get)(e.value[s],"displayName")}`,value:(0,n.get)(e.value[s],t)});return r}static parseSubscriptionsForSelect(e){const r=[];if(!e)return r;const t="subscriptionId";for(let s=0;s<e.data.value.length;s++)(0,n.find)(r,["value",(0,n.get)(e.data.value[s],t)])||r.push({label:`${(0,n.get)(e.data.value[s],"displayName")} - ${(0,n.get)(e.data.value[s],t)}`,value:(0,n.get)(e.data.value[s],t)});return r}static parseWorkspacesForSelect(e){const r=[];if(!e)return r;const t="customerId";for(let s=0;s<e.data.value.length;s++)(0,n.find)(r,["value",(0,n.get)(e.data.value[s].properties,t)])||r.push({label:(0,n.get)(e.data.value[s],"name"),value:(0,n.get)(e.data.value[s].properties,t)});return r}}const p=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(0===r.length)return[];const t=r.reduce(((e,r)=>(e.add(r),e)),new Set);return e.filter((e=>t.has(e.value)))},m=e=>({value:e.value,label:e.text});const d="azuremonitor",f="loganalytics",g="resourcegraph";function h(e,r){if("string"==typeof e)return r.multi||r.includeAll&&!r.allValue?"'"+e+"'":e;if("number"==typeof e)return e;return(0,n.map)(e,(r=>"number"==typeof e?e:"'"+r+"'")).join(",")}let v,b;!function(e){e.AzureMonitor="Azure Monitor",e.LogAnalytics="Azure Log Analytics",e.AzureResourceGraph="Azure Resource Graph",e.SubscriptionsQuery="Azure Subscriptions",e.ResourceGroupsQuery="Azure Resource Groups",e.NamespacesQuery="Azure Namespaces",e.ResourceNamesQuery="Azure Resource Names",e.MetricNamesQuery="Azure Metric Names",e.WorkspacesQuery="Azure Workspaces",e.GrafanaTemplateVariableFn="Grafana Template Variable Function"}(v||(v={})),function(e){e.Public="AzureCloud",e.China="AzureChinaCloud",e.USGovernment="AzureUSGovernment",e.Germany="AzureGermanCloud",e.None=""}(b||(b={}));const y=Symbol("Concealed client secret");function w(e){return e.jsonData.azureAuthType?e.jsonData.azureAuthType:e.jsonData.tenantId&&e.jsonData.clientId?"clientsecret":o.config.azure.managedIdentityEnabled?"msi":"clientsecret"}function S(){switch(o.config.azure.cloud){case b.Public:case b.None:case void 0:return"azuremonitor";case b.China:return"chinaazuremonitor";case b.USGovernment:return"govazuremonitor";case b.Germany:return"germanyazuremonitor";default:throw new Error(`The cloud '${o.config.azure.cloud}' not supported.`)}}function k(e){switch(e){case"azuremonitor":return"https://portal.azure.com";case"chinaazuremonitor":return"https://portal.azure.cn";case"govazuremonitor":return"https://portal.azure.us";case"germanyazuremonitor":return"https://portal.microsoftazure.de";default:throw new Error("The cloud not supported.")}}function N(e){switch(w(e)){case"msi":return S();case"clientsecret":return e.jsonData.cloudName||S()}}function M(e){if(e.secureJsonFields.clientSecret)return y;{var r;const t=null===(r=e.secureJsonData)||void 0===r?void 0:r.clientSecret;return"string"==typeof t&&t.length>0?t:void 0}}var j,A,z,x,C,G,I,T=t(45916);const{Input:R}=a.LegacyForms,D=[{value:"msi",label:"Managed Identity"},{value:"clientsecret",label:"App Registration"}],L=e=>{const{credentials:r,azureCloudOptions:t,onCredentialsChange:s,getSubscriptions:o,disabled:n}=e,c=function(e){switch(e.authType){case"msi":return!0;case"clientsecret":return!!(e.azureCloud&&e.tenantId&&e.clientId&&e.clientSecret)}}(r),[u,l]=(0,i.useState)([]),[p,m]=(0,i.useReducer)((e=>e+1),0);(0,i.useEffect)((()=>{if(!o||!c)return void d([]);let e=!1;return o().then((r=>{e||d(r,p)})),()=>{e=!0}}),[p]);const d=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(l(e),o)if(t&&!r.defaultSubscriptionId&&e.length>0)f(e[0]);else if(r.defaultSubscriptionId){e.find((e=>e.value===r.defaultSubscriptionId))||f(void 0)}},f=e=>{if(s){const t=Object.assign({},r,{defaultSubscriptionId:null==e?void 0:e.value});s(t)}};return(0,T.jsxs)("div",{className:"gf-form-group",children:[e.managedIdentityEnabled&&(0,T.jsx)("div",{className:"gf-form-inline",children:(0,T.jsxs)("div",{className:"gf-form",children:[j||(j=(0,T.jsx)(a.InlineFormLabel,{className:"width-12",tooltip:"Choose the type of authentication to Azure services",children:"Authentication"})),(0,T.jsx)(a.Select,{className:"width-15",value:D.find((e=>e.value===r.authType)),options:D,onChange:e=>{if(s){l([]);const t=Object.assign({},r,{authType:e.value||"msi",defaultSubscriptionId:void 0});s(t)}},disabled:n})]})}),"clientsecret"===r.authType&&(0,T.jsxs)(T.Fragment,{children:[t&&(0,T.jsx)("div",{className:"gf-form-inline",children:(0,T.jsxs)("div",{className:"gf-form",children:[A||(A=(0,T.jsx)(a.InlineFormLabel,{className:"width-12",tooltip:"Choose an Azure Cloud",children:"Azure Cloud"})),(0,T.jsx)(a.Select,{"aria-label":"Azure Cloud",className:"width-15",value:t.find((e=>e.value===r.azureCloud)),options:t,onChange:e=>{if(s&&"clientsecret"===r.authType){l([]);const t=Object.assign({},r,{azureCloud:e.value,defaultSubscriptionId:void 0});s(t)}},disabled:n})]})}),(0,T.jsx)("div",{className:"gf-form-inline",children:(0,T.jsxs)("div",{className:"gf-form",children:[z||(z=(0,T.jsx)(a.InlineFormLabel,{className:"width-12",children:"Directory (tenant) ID"})),(0,T.jsx)("div",{className:"width-15",children:(0,T.jsx)(R,{className:"width-30",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:r.tenantId||"",onChange:e=>{if(s&&"clientsecret"===r.authType){l([]);const t=Object.assign({},r,{tenantId:e.target.value,defaultSubscriptionId:void 0});s(t)}},disabled:n})})]})}),(0,T.jsx)("div",{className:"gf-form-inline",children:(0,T.jsxs)("div",{className:"gf-form",children:[x||(x=(0,T.jsx)(a.InlineFormLabel,{className:"width-12",children:"Application (client) ID"})),(0,T.jsx)("div",{className:"width-15",children:(0,T.jsx)(R,{className:"width-30",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:r.clientId||"",onChange:e=>{if(s&&"clientsecret"===r.authType){l([]);const t=Object.assign({},r,{clientId:e.target.value,defaultSubscriptionId:void 0});s(t)}},disabled:n})})]})}),!n&&("symbol"==typeof r.clientSecret?(0,T.jsxs)("div",{className:"gf-form-inline",children:[C||(C=(0,T.jsxs)("div",{className:"gf-form",children:[(0,T.jsx)(a.InlineFormLabel,{className:"width-12",children:"Client Secret"}),(0,T.jsx)(R,{"data-testid":"client-secret",className:"width-25",placeholder:"configured",disabled:!0})]})),(0,T.jsx)("div",{className:"gf-form",children:(0,T.jsx)("div",{className:"max-width-30 gf-form-inline",children:(0,T.jsx)(a.Button,{variant:"secondary",type:"button",onClick:()=>{if(s&&"clientsecret"===r.authType){l([]);const e=Object.assign({},r,{clientSecret:"",defaultSubscriptionId:void 0});s(e)}},disabled:n,children:"reset"})})})]}):(0,T.jsx)("div",{className:"gf-form-inline",children:(0,T.jsxs)("div",{className:"gf-form",children:[G||(G=(0,T.jsx)(a.InlineFormLabel,{className:"width-12",children:"Client Secret"})),(0,T.jsx)("div",{className:"width-15",children:(0,T.jsx)(R,{className:"width-30",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:r.clientSecret||"",onChange:e=>{if(s&&"clientsecret"===r.authType){l([]);const t=Object.assign({},r,{clientSecret:e.target.value,defaultSubscriptionId:void 0});s(t)}},disabled:n})})]})}))]}),o&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("div",{className:"gf-form-inline",children:(0,T.jsxs)("div",{className:"gf-form",children:[I||(I=(0,T.jsx)(a.InlineFormLabel,{className:"width-12",children:"Default Subscription"})),(0,T.jsx)("div",{className:"width-30",children:(0,T.jsx)(a.Select,{"aria-label":"Default Subscription",value:r.defaultSubscriptionId?u.find((e=>e.value===r.defaultSubscriptionId)):void 0,options:u,onChange:f,disabled:n})})]})}),!n&&(0,T.jsx)("div",{className:"gf-form-inline",children:(0,T.jsx)("div",{className:"gf-form",children:(0,T.jsx)("div",{className:"max-width-30 gf-form-inline",children:(0,T.jsx)(a.Button,{variant:"secondary",size:"sm",type:"button",onClick:m,disabled:!c,children:"Load Subscriptions"})})})})]}),e.children]})};var O;const q=[{value:"azuremonitor",label:"Azure"},{value:"govazuremonitor",label:"Azure US Government"},{value:"germanyazuremonitor",label:"Azure Germany"},{value:"chinaazuremonitor",label:"Azure China"}],P=e=>{const{updateOptions:r,getSubscriptions:t}=e,s=(0,i.useMemo)((()=>function(e){switch(w(e)){case"msi":return o.config.azure.managedIdentityEnabled?{authType:"msi",defaultSubscriptionId:e.jsonData.subscriptionId}:{authType:"clientsecret",azureCloud:S()};case"clientsecret":return{authType:"clientsecret",azureCloud:e.jsonData.cloudName||S(),tenantId:e.jsonData.tenantId,clientId:e.jsonData.clientId,clientSecret:M(e),defaultSubscriptionId:e.jsonData.subscriptionId}}}(e.options)),[e.options]);return(0,T.jsxs)(T.Fragment,{children:[O||(O=(0,T.jsx)("h3",{className:"page-heading",children:"Authentication"})),(0,T.jsx)(L,{managedIdentityEnabled:o.config.azure.managedIdentityEnabled,credentials:s,azureCloudOptions:q,onCredentialsChange:e=>{r((r=>function(e,r){switch(r.authType){case"msi":if(!o.config.azure.managedIdentityEnabled)throw new Error("Managed Identity authentication is not enabled in Grafana config.");return Object.assign({},e,{jsonData:Object.assign({},e.jsonData,{azureAuthType:"msi",subscriptionId:r.defaultSubscriptionId})});case"clientsecret":return Object.assign({},e,{jsonData:Object.assign({},e.jsonData,{azureAuthType:"clientsecret",cloudName:r.azureCloud||S(),tenantId:r.tenantId,clientId:r.clientId,subscriptionId:r.defaultSubscriptionId}),secureJsonData:Object.assign({},e.secureJsonData,{clientSecret:"string"==typeof r.clientSecret?r.clientSecret:void 0}),secureJsonFields:Object.assign({},e.secureJsonFields,{clientSecret:"symbol"==typeof r.clientSecret})})}}(r,e)))},getSubscriptions:t,disabled:e.options.readOnly})]})};function F(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}class E extends i.PureComponent{constructor(e){super(e),F(this,"templateSrv",(0,o.getTemplateSrv)()),F(this,"baseURL",void 0),F(this,"updateOptions",(e=>{const r=e(this.props.options);this.props.onOptionsChange(r),this.setState({unsaved:!0})})),F(this,"saveOptions",(async()=>{this.state.unsaved&&(await(0,o.getBackendSrv)().put(`/api/datasources/${this.props.options.id}`,this.props.options).then((e=>{(0,s.updateDatasourcePluginOption)(this.props,"version",e.datasource.version)})),this.setState({unsaved:!1}))})),F(this,"getSubscriptions",(async()=>{await this.saveOptions();try{const e=await(0,o.getBackendSrv)().fetch({url:this.baseURL+"?api-version=2019-03-01",method:"GET"}).toPromise();return this.setState({error:void 0}),l.parseSubscriptionsForSelect(e)}catch(r){var e;if((0,o.isFetchError)(r))this.setState({error:{title:"Error requesting subscriptions",description:"Could not request subscriptions from Azure. Check your credentials and try again.",details:null==r||null===(e=r.data)||void 0===e?void 0:e.message}});return Promise.resolve([])}})),this.state={unsaved:!1},this.baseURL=`/api/datasources/${this.props.options.id}/resources/${d}/subscriptions`}render(){const{options:e}=this.props,{error:r}=this.state;return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(P,{options:e,updateOptions:this.updateOptions,getSubscriptions:this.getSubscriptions}),r&&(0,T.jsxs)(a.Alert,{severity:"error",title:r.title,children:[(0,T.jsx)("p",{children:r.description}),r.details&&(0,T.jsx)("details",{style:{whiteSpace:"pre-wrap"},children:r.details})]})]})}}var Q=t(48427);function V(){const[e,r]=(0,i.useState)([]),t=(0,i.useCallback)(((e,t)=>{r((r=>{const s=[...r],o=r.findIndex((r=>{let[t]=r;return t===e}));return o>-1&&s.splice(o,1),t&&s.unshift([e,t]),s}))}),[]);return[(0,i.useMemo)((()=>{const r=e[0];return r&&(0,Q.O)(r[1])}),[e]),t]}var W=t(8072);const $=["labelWidth","inlineField"];const U=e=>{const{labelWidth:r,inlineField:t}=e,s=function(e,r){if(null==e)return{};var t,s,o={},i=Object.keys(e);for(s=0;s<i.length;s++)t=i[s],r.indexOf(t)>=0||(o[t]=e[t]);return o}(e,$);return t?(0,T.jsx)(a.InlineField,Object.assign({labelWidth:r||18},s)):(0,T.jsx)(W.EditorField,Object.assign({width:r||18},s))},X=e=>{let{query:r,subscriptions:t,variableOptionGroup:s,onQueryChange:o,multiSelect:n=!1}=e;const c=(0,i.useCallback)((e=>{if(!e.value)return;let t=Object.assign({},r,{subscription:e.value});r.queryType===v.AzureMonitor&&(t.azureMonitor=Object.assign({},t.azureMonitor,{resourceGroup:void 0,metricNamespace:void 0,resourceName:void 0,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})),o(t)}),[r,o]),u=(0,i.useCallback)((e=>{e&&(r.subscriptions=e.map((e=>{var r;return null!==(r=e.value)&&void 0!==r?r:""})),o(r))}),[r,o]),l=(0,i.useMemo)((()=>[...t,s]),[t,s]);return n?(0,T.jsx)(U,{label:"Subscriptions",children:(0,T.jsx)(a.MultiSelect,{isClearable:!0,value:p([...t,...s.options],r.subscriptions),inputId:"azure-monitor-subscriptions-field",onChange:u,options:l,width:38})}):(0,T.jsx)(U,{label:"Subscription",children:(0,T.jsx)(a.Select,{value:r.subscription,inputId:"azure-monitor-subscriptions-field",onChange:c,options:l,width:38,allowCustomValue:!0})})},B=e=>{var r,t;let{query:s,onQueryChange:o}=e;const n=(0,i.useCallback)((e=>{o(Object.assign({},s,{azureResourceGraph:Object.assign({},s.azureResourceGraph,{query:e})}))}),[o,s]);return(0,T.jsx)(a.CodeEditor,{value:null!==(r=null===(t=s.azureResourceGraph)||void 0===t?void 0:t.query)&&void 0!==r?r:"",language:"kusto",height:200,width:"100%",showMiniMap:!1,onBlur:n,onSave:n})},_="arg-subscriptions",H=e=>{let{query:r,datasource:t,subscriptionId:s,variableOptionGroup:o,onChange:a,setError:n}=e;const c=(0,i.useRef)(!1),[u,l]=(0,i.useState)([]);return(0,i.useEffect)((()=>{c.current||(c.current=!0,t.getSubscriptions().then((e=>{var t;const s=e.map((e=>({label:e.text,value:e.value,description:e.value})));var o;(l(s),n(_,void 0),null!==(t=r.subscriptions)&&void 0!==t&&t.length||null==s||!s.length)||a(Object.assign({},r,{subscriptions:[null!==(o=r.subscription)&&void 0!==o?o:s[0].value]}))})).catch((e=>n(_,e))))}),[t,a,r,n]),(0,T.jsxs)("span",{"data-testid":"azure-monitor-arg-query-editor-with-experimental-ui",children:[(0,T.jsx)(W.EditorRows,{children:(0,T.jsx)(W.EditorRow,{children:(0,T.jsx)(W.EditorFieldGroup,{children:(0,T.jsx)(X,{multiSelect:!0,subscriptions:u,query:r,datasource:t,subscriptionId:s,variableOptionGroup:o,onQueryChange:a,setError:n})})})}),(0,T.jsx)(B,{query:r,datasource:t,subscriptionId:s,variableOptionGroup:o,onQueryChange:a,setError:n})]})};var K=t(36636),J=t(76687);const Z=e=>{const r=(0,a.useTheme2)(),t=Y(r,e);return(0,T.jsx)("span",{className:(0,K.cx)(t.wrapper)})};Z.defaultProps={v:0,h:0,layout:"block"};const Y=(0,a.stylesFactory)(((e,r)=>{var t,s;return{wrapper:(0,K.css)([{paddingRight:e.spacing(null!==(t=r.h)&&void 0!==t?t:0),paddingBottom:e.spacing(null!==(s=r.v)&&void 0!==s?s:0)},"inline"===r.layout&&{display:"inline-block"},"block"===r.layout&&{display:"block"}])}}));var ee,re;const te=e=>{var r,t,s,o;let{resource:n,onChange:c}=e;const[u,l]=(0,i.useState)(!!n&&JSON.stringify(n).includes("$"));return(0,T.jsx)("div",{children:(0,T.jsxs)(a.Collapse,{collapsible:!0,label:"Advanced",isOpen:u,onToggle:()=>l(!u),children:["string"==typeof n?(0,T.jsxs)(T.Fragment,{children:[" ",ee||(ee=(0,T.jsx)(a.Label,{htmlFor:"input-advanced-resource-picker",children:(0,T.jsxs)("h6",{children:["Resource URI"," ",(0,T.jsx)(a.Tooltip,{content:(0,T.jsxs)(T.Fragment,{children:["Manually edit the"," ",(0,T.jsxs)("a",{href:"https://docs.microsoft.com/en-us/azure/azure-monitor/logs/log-standard-columns#_resourceid",rel:"noopener noreferrer",target:"_blank",children:["resource uri."," "]}),"Supports the use of multiple template variables (ex: /subscriptions/$subId/resourceGroups/$rg)"]}),placement:"right",interactive:!0,children:(0,T.jsx)(a.Icon,{name:"info-circle"})})]})})),(0,T.jsx)(a.Input,{id:"input-advanced-resource-picker",value:n,onChange:e=>c(e.currentTarget.value),placeholder:"ex: /subscriptions/$subId"})]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(a.InlineField,{label:"Subscription",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-subscription",labelWidth:15,children:(0,T.jsx)(a.Input,{id:"input-advanced-resource-picker-subscription",value:null!==(r=null==n?void 0:n.subscription)&&void 0!==r?r:"",onChange:e=>c(Object.assign({},n,{subscription:e.currentTarget.value})),placeholder:"aaaaaaaa-bbbb-cccc-dddd-eeeeeeee"})}),(0,T.jsx)(a.InlineField,{label:"Resource Group",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-resourceGroup",labelWidth:15,children:(0,T.jsx)(a.Input,{id:"input-advanced-resource-picker-resourceGroup",value:null!==(t=null==n?void 0:n.resourceGroup)&&void 0!==t?t:"",onChange:e=>c(Object.assign({},n,{resourceGroup:e.currentTarget.value})),placeholder:"resource-group"})}),(0,T.jsx)(a.InlineField,{label:"Metric Namespace",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-metricNamespace",labelWidth:15,children:(0,T.jsx)(a.Input,{id:"input-advanced-resource-picker-metricNamespace",value:null!==(s=null==n?void 0:n.metricNamespace)&&void 0!==s?s:"",onChange:e=>c(Object.assign({},n,{metricNamespace:e.currentTarget.value})),placeholder:"Microsoft.Insights/metricNamespaces"})}),(0,T.jsx)(a.InlineField,{label:"Resource Name",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-resourceName",labelWidth:15,children:(0,T.jsx)(a.Input,{id:"input-advanced-resource-picker-resourceName",value:null!==(o=null==n?void 0:n.resourceName)&&void 0!==o?o:"",onChange:e=>c(Object.assign({},n,{resourceName:e.currentTarget.value})),placeholder:"name"})})]}),re||(re=(0,T.jsx)(Z,{v:2}))]})})};let se;var oe,ie,ae,ne;!function(e){e.Subscription="Subscription",e.ResourceGroup="ResourceGroup",e.Resource="Resource",e.VariableGroup="TemplateVariableGroup",e.Variable="TemplateVariable"}(se||(se={}));const ce=e=>{let{isOpen:r,entry:{type:t}}=e;switch(t){case se.Subscription:return oe||(oe=(0,T.jsx)(a.Icon,{name:"layer-group"}));case se.ResourceGroup:return(0,T.jsx)(a.Icon,{name:r?"folder-open":"folder"});case se.Resource:return ie||(ie=(0,T.jsx)(a.Icon,{name:"cube"}));case se.VariableGroup:return ae||(ae=(0,T.jsx)(a.Icon,{name:"x"}));case se.Variable:return ne||(ne=(0,T.jsx)(a.Icon,{name:"x"}));default:return null}},ue=e=>({table:(0,K.css)({width:"100%",tableLayout:"fixed"}),tableScroller:(0,K.css)({maxHeight:"50vh",overflow:"auto"}),header:(0,K.css)({background:e.colors.background.secondary}),row:(0,K.css)({borderBottom:`1px solid ${e.colors.border.weak}`,"&:last-of-type":{borderBottomColor:e.colors.border.medium}}),disabledRow:(0,K.css)({opacity:.5}),cell:(0,K.css)({padding:e.spacing(1,1,1,0),width:"25%",overflow:"hidden",textOverflow:"ellipsis","&:first-of-type":{width:"50%",padding:e.spacing(1,1,1,2)}}),collapseButton:(0,K.css)({margin:0}),loadingCell:(0,K.css)({textAlign:"center"}),spinner:(0,K.css)({marginBottom:0}),nestedEntry:(0,K.css)({display:"flex",alignItems:"center"}),entryContentItem:(0,K.css)({margin:e.spacing(0,1,0,0)}),truncated:(0,K.css)({minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),resourceField:(0,K.css)({maxWidth:e.spacing(36),overflow:"hidden"}),resourceFieldButton:(0,K.css)({padding:"7px",textAlign:"left"}),nestedRowCheckbox:(0,K.css)({zIndex:0}),selectionFooter:(0,K.css)({position:"sticky",bottom:0,background:e.colors.background.primary,paddingTop:e.spacing(2)}),loadingWrapper:(0,K.css)({textAlign:"center",paddingTop:e.spacing(2),paddingBottom:e.spacing(2),color:e.colors.text.secondary}),resultLimit:(0,K.css)({margin:"4px 0",fontStyle:"italic"}),modal:(0,K.css)({width:e.breakpoints.values.lg})});var le,pe,me,de;const fe=e=>{let{entry:r,isSelected:t,isDisabled:s,isOpen:o,isSelectable:n,level:c,scrollIntoView:u,onToggleCollapse:l,onSelectedChange:p}=e;const m=(0,a.useTheme2)(),d=(0,a.useStyles2)(ue),f=!!r.children,g=(0,i.useCallback)((()=>{l(r)}),[l,r]),h=(0,i.useCallback)((e=>{const t=e.target.checked;p(r,t)}),[r,p]),v=`${u?"table":"summary"}_checkbox_${r.uri}`;return(0,i.useEffect)((()=>{var e;t&&u&&(null===(e=document.getElementById(v))||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center"}))}),[]),(0,T.jsxs)("div",{className:d.nestedEntry,style:{marginLeft:c*(3*m.spacing.gridSize)},children:[f?(0,T.jsx)(a.IconButton,{className:d.collapseButton,name:o?"angle-down":"angle-right","aria-label":o?`Collapse ${r.name}`:`Expand ${r.name}`,onClick:g,id:r.id}):le||(le=(0,T.jsx)(Z,{layout:"inline",h:2})),pe||(pe=(0,T.jsx)(Z,{layout:"inline",h:2})),n&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(a.Checkbox,{id:v,onChange:h,disabled:s,value:t,className:d.nestedRowCheckbox}),me||(me=(0,T.jsx)(Z,{layout:"inline",h:2}))]}),(0,T.jsx)(ce,{entry:r,isOpen:o}),de||(de=(0,T.jsx)(Z,{layout:"inline",h:1})),(0,T.jsx)("label",{htmlFor:v,className:(0,K.cx)(d.entryContentItem,d.truncated),children:r.name})]})};var ge=t(28953);class he{static buildResourceUri(e,r){const t=[],{subscription:s,resourceGroup:o,metricNamespace:i,resourceName:a}=r;if(s&&(t.push("/subscriptions",s),o&&(t.push("resourceGroups",o),i&&a))){const r=e.replace(i),s=i.split("/"),o=e.replace(a),n=a.split("/"),c=s.shift();if(c&&t.push("providers",c),r.toLowerCase().startsWith("microsoft.storage/storageaccounts/")&&!o.endsWith("default")&&n.push("default"),n.length>s.length){const e=n.shift();e&&t.push(e)}for(const e in s)t.push(s[e]),t.push(n[e])}return t.join("/")}static buildAzureMonitorGetMetricNamespacesUrl(e,r,t,s,o){let i;if("resourceUri"in t)i=t.resourceUri;else{const{subscription:e,resourceGroup:r,metricNamespace:s,resourceName:a}=t;i=he.buildResourceUri(o,{subscription:e,resourceGroup:r,metricNamespace:s,resourceName:a})}return`${e}${i}/providers/microsoft.insights/metricNamespaces?api-version=${r}${s?"&region=global":""}`}static buildAzureMonitorGetMetricNamesUrl(e,r,t,s){let o;const{customNamespace:i}=t;if("resourceUri"in t)o=t.resourceUri;else{const{subscription:e,resourceGroup:r,metricNamespace:i,resourceName:a}=t;o=he.buildResourceUri(s,{subscription:e,resourceGroup:r,metricNamespace:i,resourceName:a})}let a=`${e}${o}/providers/microsoft.insights/metricdefinitions?api-version=${r}`;return i&&(a+=`&metricnamespace=${encodeURIComponent(i)}`),a}}const ve=/\/subscriptions\/(?<subscription>[^/]+)(?:\/resourceGroups\/(?<resourceGroup>[^/]+)(?:\/providers\/(?<metricNamespaceAndResource>.+))?)?/;function be(e){var r;const t=ve.exec(e),s=null!==(r=null==t?void 0:t.groups)&&void 0!==r?r:{},{subscription:o,resourceGroup:i,metricNamespaceAndResource:a}=s,{metricNamespace:n,resourceName:c}=function(e){if(!e)return{};const r=e.split("/"),t=r.splice(0,2),s=r.splice(0,1);for(;r.length;){const e=r.shift();r.length%2==0?s.push(e):t.push(e)}return{metricNamespace:t.join("/"),resourceName:s.join("/")}}(a);return{subscription:o,resourceGroup:i,metricNamespace:n,resourceName:c}}function ye(e){return"string"==typeof e?be(e):e}function we(e){return!!e.match(/^[A-Z0-9]+/i)}function Se(e,r){var t,s,o,i,a,n;const c=ye(r),u=ye(e);return(null==u?void 0:u.subscription)===(null==c?void 0:c.subscription)&&(null==u||null===(t=u.resourceGroup)||void 0===t?void 0:t.toLowerCase())===(null==c||null===(s=c.resourceGroup)||void 0===s?void 0:s.toLowerCase())&&(null==u||null===(o=u.metricNamespace)||void 0===o?void 0:o.toLowerCase().split("/")[0])===(null==c||null===(i=c.metricNamespace)||void 0===i?void 0:i.toLowerCase().split("/")[0])&&(null==u||null===(a=u.resourceName)||void 0===a?void 0:a.split("/")[0])===(null==c||null===(n=c.resourceName)||void 0===n?void 0:n.split("/")[0])}function ke(e,r){for(const t of e){if(Se(t.uri,r))return t;if(t.children){const e=ke(t.children,r);if(e)return e}}}function Ne(e,r,t){return(0,ge.ZP)(e,(e=>{const s=ke(e,r);s&&(s.children=t)}))}const Me=e=>{var r;let{row:t,selectedRows:s,level:o,requestNestedRows:n,onRowSelectedChange:c,selectableEntryTypes:u,scrollIntoView:l}=e;const p=(0,a.useStyles2)(ue),[m,d]=(0,i.useState)("closed"),f=!!s.find((e=>e.uri===t.uri)),g=s.length>0&&!f,h="open"===m;return(0,i.useEffect)((()=>{var e;const r=s[0];r&&!!ke(null!==(e=t.children)&&void 0!==e?e:[],r.uri)&&d("open")}),[s,t]),(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("tr",{className:(0,K.cx)(p.row,g&&p.disabledRow),children:[(0,T.jsx)("td",{className:p.cell,children:(0,T.jsx)(fe,{level:o,isSelected:f,isDisabled:g,isOpen:h,entry:t,onToggleCollapse:async()=>{"open"!==m?(d("loading"),n(t).then((()=>d("open"))).catch((()=>d("closed")))):d("closed")},onSelectedChange:c,isSelectable:u.some((e=>e===t.type)),scrollIntoView:l})}),(0,T.jsx)("td",{className:p.cell,children:t.typeLabel}),(0,T.jsx)("td",{className:p.cell,children:null!==(r=t.location)&&void 0!==r?r:"-"})]},t.id),h&&t.children&&Object.keys(t.children).length>0&&t.children.map((e=>(0,T.jsx)(Me,{row:e,selectedRows:s,level:o+1,requestNestedRows:n,onRowSelectedChange:c,selectableEntryTypes:u,scrollIntoView:l},e.uri))),(0,T.jsx)(a.FadeTransition,{visible:"loading"===m,children:(0,T.jsx)("tr",{children:(0,T.jsx)("td",{className:(0,K.cx)(p.cell,p.loadingCell),colSpan:3,children:(0,T.jsx)(a.LoadingPlaceholder,{text:"Loading...",className:p.spinner})})})})]})},je=Me;var Ae;const ze=e=>{let{searchFn:r}=e;const[t,s]=(0,i.useState)(""),o=(0,i.useMemo)((()=>(0,n.debounce)(r,600)),[r]);return(0,i.useEffect)((()=>()=>{o.cancel()}),[o]),(0,T.jsx)(a.Input,{"aria-label":"resource search",prefix:Ae||(Ae=(0,T.jsx)(a.Icon,{name:"search"})),value:t,onChange:e=>{const r=e.currentTarget.value;s(r),o(r)},placeholder:"search for a resource"})};var xe,Ce,Ge,Ie,Te,Re,De;const Le=e=>{let{resourcePickerData:r,resource:t,onApply:s,onCancel:n,selectableEntryTypes:c,queryType:u}=e;const l=(0,a.useStyles2)(ue),[p,m]=(0,i.useState)(!1),[d,f]=(0,i.useState)([]),[g,h]=(0,i.useState)([]),[v,b]=(0,i.useState)(t),[y,w]=(0,i.useState)(void 0),[S,k]=(0,i.useState)(!1);(0,i.useEffect)((()=>{b(t)}),[t]);const N=(0,i.useCallback)((async()=>{if(!p){try{m(!0);const e=await r.fetchInitialRows(u,ye(null!=v?v:{}));f(e)}catch(e){w((0,Q.Z)(e))}m(!1)}}),[v,p,r,u]);(0,J.Z)((()=>{N()})),(0,i.useEffect)((()=>{v||h([]);const e=v&&ke(d,function(e){return e?"string"==typeof e?e:he.buildResourceUri((0,o.getTemplateSrv)(),e):""}(v));return h(e?[Object.assign({},e,{children:void 0})]:[])}),[v,d]);const M=(0,i.useCallback)((async e=>{var t;if(w(void 0),null===(t=e.children)||void 0===t||!t.length)try{const t=await r.fetchAndAppendNestedRow(d,e,u);f(t)}catch(e){throw w((0,Q.Z)(e)),e}}),[r,d,u]),j="string"==typeof t,A=(0,i.useCallback)(((e,r)=>{b(r?j?e.uri:ye(e.uri):j?"":{})}),[j]),z=(0,i.useCallback)((()=>{v&&s(j?v:ye(v))}),[j,v,s]),x=(0,i.useCallback)((async e=>{if(w(void 0),k(!1),e){try{m(!0);const t=await r.search(e,u);f(t),t.length>=r.resultLimit&&k(!0)}catch(e){w((0,Q.Z)(e))}m(!1)}else N()}),[N,r,u]);return(0,T.jsxs)("div",{children:[(0,T.jsx)(ze,{searchFn:x}),S?(0,T.jsxs)("p",{className:l.resultLimit,children:["Showing first ",r.resultLimit," results"]}):xe||(xe=(0,T.jsx)(Z,{v:2})),(0,T.jsx)("table",{className:l.table,children:(0,T.jsx)("thead",{children:(0,T.jsxs)("tr",{className:(0,K.cx)(l.row,l.header),children:[(0,T.jsx)("td",{className:l.cell,children:"Scope"}),(0,T.jsx)("td",{className:l.cell,children:"Type"}),(0,T.jsx)("td",{className:l.cell,children:"Location"})]})})}),(0,T.jsx)("div",{className:l.tableScroller,children:(0,T.jsx)("table",{className:l.table,children:(0,T.jsxs)("tbody",{children:[p&&(0,T.jsx)("tr",{className:(0,K.cx)(l.row),children:(0,T.jsx)("td",{className:l.cell,children:Ce||(Ce=(0,T.jsx)(a.LoadingPlaceholder,{text:"Loading..."}))})}),!p&&0===d.length&&(0,T.jsx)("tr",{className:(0,K.cx)(l.row),children:(0,T.jsx)("td",{className:l.cell,"aria-live":"polite",children:"No resources found"})}),!p&&d.map((e=>(0,T.jsx)(je,{row:e,selectedRows:g,level:0,requestNestedRows:M,onRowSelectedChange:A,selectableEntryTypes:c,scrollIntoView:!0},e.uri)))]})})}),(0,T.jsxs)("div",{className:l.selectionFooter,children:[g.length>0&&(0,T.jsxs)(T.Fragment,{children:[Ge||(Ge=(0,T.jsx)("h5",{children:"Selection"})),(0,T.jsx)("div",{className:l.tableScroller,children:(0,T.jsx)("table",{className:l.table,children:(0,T.jsx)("tbody",{children:g.map((e=>(0,T.jsx)(je,{row:e,selectedRows:g,level:0,requestNestedRows:M,onRowSelectedChange:A,selectableEntryTypes:c},e.uri)))})})}),Ie||(Ie=(0,T.jsx)(Z,{v:2}))]}),(0,T.jsx)(te,{resource:v,onChange:e=>b(e)}),Te||(Te=(0,T.jsx)(Z,{v:2})),(0,T.jsx)(a.Button,{disabled:!!y,onClick:z,children:"Apply"}),Re||(Re=(0,T.jsx)(Z,{layout:"inline",h:1})),(0,T.jsx)(a.Button,{onClick:n,variant:"secondary",children:"Cancel"})]}),y&&(0,T.jsxs)(T.Fragment,{children:[De||(De=(0,T.jsx)(Z,{v:2})),(0,T.jsx)(a.Alert,{severity:"error",title:"An error occurred while requesting resources from Azure Monitor",children:y})]})]})};var Oe,qe,Pe;const Fe=e=>{let{resource:r,datasource:t}=e;const[s,o]=(0,i.useState)(ye(null!=r?r:""));return(0,i.useEffect)((()=>{r&&ye(r)?"string"==typeof r?t.resourcePickerData.getResourceURIDisplayProperties(r).then(o):o(r):o({})}),[t.resourcePickerData,r]),!r||"object"==typeof r&&!r.subscription?(0,T.jsx)(T.Fragment,{children:"Select a resource"}):s?(0,T.jsx)(Ee,{resource:s}):(0,T.jsx)(T.Fragment,{children:r})},Ee=e=>{let{resource:r}=e;const t=(0,a.useStyles2)(ue);return r.resourceName?(0,T.jsxs)("span",{className:(0,K.cx)(t.truncated,t.resourceField),children:[Oe||(Oe=(0,T.jsx)(a.Icon,{name:"cube"}))," ",r.resourceName.split("/")[0]]}):r.resourceGroup?(0,T.jsxs)("span",{children:[qe||(qe=(0,T.jsx)(a.Icon,{name:"folder"}))," ",r.resourceGroup]}):(0,T.jsxs)("span",{children:[Pe||(Pe=(0,T.jsx)(a.Icon,{name:"layer-group"}))," ",r.subscription]})},Qe=e=>{let{query:r,datasource:t,onQueryChange:s,selectableEntryTypes:o,queryType:n,resource:c,inlineField:u,labelWidth:l}=e;const p=(0,a.useStyles2)(ue),[m,d]=(0,i.useState)(!1),f=(0,i.useCallback)((()=>{d(!0)}),[]),g=(0,i.useCallback)((()=>{d(!1)}),[]),h=(0,i.useCallback)((e=>{s(function(e,r){var t;return"string"==typeof r?Object.assign({},e,{azureLogAnalytics:Object.assign({},e.azureLogAnalytics,{resource:r})}):Object.assign({},e,{subscription:null==r?void 0:r.subscription,azureMonitor:Object.assign({},e.azureMonitor,{resourceGroup:null==r?void 0:r.resourceGroup,metricNamespace:null==r||null===(t=r.metricNamespace)||void 0===t?void 0:t.toLocaleLowerCase(),resourceName:null==r?void 0:r.resourceName,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}(r,e)),g()}),[g,s,r]);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(a.Modal,{className:p.modal,title:"Select a resource",isOpen:m,onDismiss:g,trapFocus:!1,children:(0,T.jsx)(Le,{resourcePickerData:t.resourcePickerData,resource:c,onApply:h,onCancel:g,selectableEntryTypes:o,queryType:n})}),(0,T.jsx)(U,{label:"Resource",inlineField:u,labelWidth:l,children:(0,T.jsx)(a.Button,{className:p.resourceFieldButton,variant:"secondary",onClick:f,type:"button",children:(0,T.jsx)(Fe,{resource:c,datasource:t})})})]})};function Ve(e,r){return Object.assign({},e,{azureLogAnalytics:Object.assign({},e.azureLogAnalytics,{query:r})})}const We=[{label:"Time series",value:"time_series"},{label:"Table",value:"table"}],$e=e=>{var r;let{query:t,variableOptionGroup:s,onQueryChange:o}=e;const n=(0,i.useMemo)((()=>[...We,s]),[s]),c=(0,i.useCallback)((e=>{const{value:r}=e;if(!r)return;const s=function(e,r){return Object.assign({},e,{azureLogAnalytics:Object.assign({},e.azureLogAnalytics,{resultFormat:r})})}(t,r);o(s)}),[o,t]);return(0,T.jsx)(U,{label:"Format as",children:(0,T.jsx)(a.Select,{inputId:"azure-monitor-logs-workspaces-field",value:null===(r=t.azureLogAnalytics)||void 0===r?void 0:r.resultFormat,onChange:c,options:n,width:38})})};function Ue(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}class Xe{constructor(){Ue(this,"resolve",void 0),Ue(this,"reject",void 0),Ue(this,"promise",void 0),this.resolve=void 0,this.reject=void 0,this.promise=new Promise(((e,r)=>{this.resolve=e,this.reject=r})),Object.freeze(this)}}const Be=e=>{var r,t,s;let{query:o,datasource:n,onQueryChange:c}=e;const u=(0,i.useRef)();(0,i.useEffect)((()=>{var e;if(null===(e=o.azureLogAnalytics)||void 0===e||!e.resource)return;const r=[n.azureLogAnalyticsDatasource.getKustoSchema(o.azureLogAnalytics.resource),(u.current||(u.current=new Xe),u.current.promise)];Promise.all(r).then((e=>{let[r,{monaco:t,editor:s}]=e;t.languages.kusto.getKustoWorker().then((e=>{const r=s.getModel();return r&&e(r.uri)})).then((e=>{null==e||e.setSchema(r,"https://help.kusto.windows.net","Samples")}))}))}),[n.azureLogAnalyticsDatasource,null===(r=o.azureLogAnalytics)||void 0===r?void 0:r.resource]);const l=(0,i.useCallback)(((e,r)=>{var t,s;null===(t=u.current)||void 0===t||null===(s=t.resolve)||void 0===s||s.call(t,{editor:e,monaco:r})}),[]),p=(0,i.useCallback)((e=>{c(Ve(o,e))}),[c,o]);return(0,T.jsx)(a.CodeEditor,{value:null!==(t=null===(s=o.azureLogAnalytics)||void 0===s?void 0:s.query)&&void 0!==t?t:"",language:"kusto",height:200,width:"100%",showMiniMap:!1,onBlur:p,onSave:p,onEditorDidMount:l})};function _e(e,r,t){const[s,o]=(0,i.useState)();return(0,i.useEffect)((()=>{(async function(e,r,t){var s;if(void 0!==(null===(s=r.azureLogAnalytics)||void 0===s?void 0:s.workspace)&&!r.azureLogAnalytics.resource){let s;s=we(r.azureLogAnalytics.workspace)?await e.resourcePickerData.getResourceURIFromWorkspace(r.azureLogAnalytics.workspace):r.azureLogAnalytics.workspace;const o=Object.assign({},r,{azureLogAnalytics:Object.assign({},r.azureLogAnalytics,{resource:s,workspace:void 0})});delete o.azureLogAnalytics.workspace,t(o)}})(e,r,t).catch((e=>o({title:"Unable to migrate workspace as a resource",message:e.message})))}),[e,r,t]),s}const He=e=>{var r,t;let{query:s,datasource:o,subscriptionId:i,variableOptionGroup:n,onChange:c,setError:u,hideFormatAs:l}=e;const p=_e(o,s,c);return(0,T.jsx)("span",{"data-testid":"azure-monitor-logs-query-editor-with-experimental-ui",children:(0,T.jsxs)(W.EditorRows,{children:[(0,T.jsx)(W.EditorRow,{children:(0,T.jsx)(W.EditorFieldGroup,{children:(0,T.jsx)(Qe,{query:s,datasource:o,inlineField:!0,labelWidth:10,subscriptionId:i,variableOptionGroup:n,onQueryChange:c,setError:u,selectableEntryTypes:[se.Subscription,se.ResourceGroup,se.Resource,se.Variable],resource:null!==(r=null===(t=s.azureLogAnalytics)||void 0===t?void 0:t.resource)&&void 0!==r?r:"",queryType:"logs"})})}),(0,T.jsx)(Be,{query:s,datasource:o,subscriptionId:i,variableOptionGroup:n,onQueryChange:c,setError:u}),(0,T.jsx)(W.EditorRow,{children:(0,T.jsxs)(W.EditorFieldGroup,{children:[!l&&(0,T.jsx)($e,{query:s,datasource:o,subscriptionId:i,variableOptionGroup:n,onQueryChange:c,setError:u}),p&&(0,T.jsx)(a.Alert,{title:p.title,children:p.message})]})})]})})};function Ke(e,r){var t;if((null===(t=e.azureMonitor)||void 0===t?void 0:t.customNamespace)===r)return e;const s=null!=r&&r.toLowerCase().startsWith("microsoft.storage/storageaccounts/")?"":r;return Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{customNamespace:s,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}function Je(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.timeGrain)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{timeGrain:r})})}function Ze(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.dimensionFilters)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{dimensionFilters:r})})}const Ye=e=>{var r;let{query:t,variableOptionGroup:s,onQueryChange:o,aggregationOptions:n,isLoading:c}=e;const u=(0,i.useCallback)((e=>{if(!e.value)return;const r=function(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.aggregation)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{aggregation:r})})}(t,e.value);o(r)}),[o,t]),l=(0,i.useMemo)((()=>[...n,s]),[n,s]);return(0,T.jsx)(U,{label:"Aggregation",children:(0,T.jsx)(a.Select,{inputId:"azure-monitor-metrics-aggregation-field",value:(null===(r=t.azureMonitor)||void 0===r?void 0:r.aggregation)||null,onChange:u,options:l,isLoading:c})})},er=e=>{var r;let{data:t,query:s,dimensionOptions:o,onQueryChange:n}=e;const c=(0,i.useMemo)((()=>{var e,r;return null!==(e=null===(r=s.azureMonitor)||void 0===r?void 0:r.dimensionFilters)&&void 0!==e?e:[]}),[null===(r=s.azureMonitor)||void 0===r?void 0:r.dimensionFilters]),u=((e,r)=>{const[t,s]=(0,i.useState)({});return(0,i.useEffect)((()=>{var t;let o={};if(null!=e&&null!==(t=e.series)&&void 0!==t&&t.length){const t=e.series.flat().filter((e=>e.refId===r.refId)).flatMap((e=>e.fields)).map((e=>e.labels)).flat().filter((e=>null!=e));for(const e of t)for(const[r,t]of Object.entries(e))o[r]?o[r].add(t):o[r]=new Set([t])}s((e=>{const r={},t=Object.keys(o);if(0===t.length)return e;for(const s of t)e[s]&&o[s].size<e[s].size?r[s]=e[s]:r[s]=o[s];return r}))}),[null==e?void 0:e.series,r.refId]),t})(t,s),l=[{label:"==",value:"eq"},{label:"!=",value:"ne"},{label:"starts with",value:"sw"}],p=(0,i.useMemo)((()=>{let e=o;return c.length&&(e=o.filter((e=>!c.some((r=>r.dimension===e.value))))),e}),[c,o]),m=(e,r,t,s)=>{r[e]=t,s(r)},d=(e,r)=>{var t;const s=Array.from(null!==(t=u[r.toLowerCase()])&&void 0!==t?t:[]);return s.find((r=>r===e))?s.map((e=>({value:e,label:e}))):[...s,...e&&"*"!==e?[e]:[]].map((e=>({value:e,label:e})))},f=(e,r)=>{const t=d(void 0,r);if(e)for(const r of e)t.find((e=>e.value===r))||t.push({value:r,label:r});return t};return(0,T.jsx)(U,{label:"Dimensions",children:(0,T.jsx)(W.EditorList,{items:c,onChange:e=>{const r=e.map((e=>{var r,t,s;return{dimension:null!==(r=e.dimension)&&void 0!==r?r:"",operator:null!==(t=e.operator)&&void 0!==t?t:"eq",filters:null!==(s=e.filters)&&void 0!==s?s:[]}}));n(Ze(s,r))},renderItem:(e,r,t)=>{var s,i,n,c;return(0,T.jsxs)(a.HorizontalGroup,{spacing:"none",children:[(0,T.jsx)(a.Select,{menuShouldPortal:!0,placeholder:"Field",value:e.dimension,options:(c=e.dimension||"",p.concat(o.filter((e=>e.value===c)))),onChange:t=>{var s;return m("dimension",e,null!==(s=t.value)&&void 0!==s?s:"",r)}}),(0,T.jsx)(a.Select,{menuShouldPortal:!0,placeholder:"Operation",value:e.operator,options:(n=e.operator||"eq",l.find((e=>e.value===n))?l:[...l,...n?[{label:n,value:n}]:[]]),onChange:t=>{var s;return m("operator",e,null!==(s=t.value)&&void 0!==s?s:"",r)},allowCustomValue:!0}),"eq"===e.operator||"ne"===e.operator?(0,T.jsx)(a.MultiSelect,{menuShouldPortal:!0,placeholder:"Select value(s)",value:e.filters,options:f(e.filters,null!==(s=e.dimension)&&void 0!==s?s:""),onChange:t=>m("filters",e,t.map((e=>{var r;return null!==(r=e.value)&&void 0!==r?r:""})),r),"aria-label":"dimension-labels-select",allowCustomValue:!0}):(0,T.jsx)(a.Select,{menuShouldPortal:!0,placeholder:"Select value",value:e.filters?e.filters[0]:"",allowCustomValue:!0,options:d(e.filters?e.filters[0]:"",null!==(i=e.dimension)&&void 0!==i?i:""),onChange:t=>{var s;return m("filters",e,[null!==(s=null==t?void 0:t.value)&&void 0!==s?s:""],r)},isClearable:!0}),(0,T.jsx)(W.AccessoryButton,{"aria-label":"Remove",icon:"times",variant:"secondary",onClick:t,type:"button"})]})}})})},rr=e=>{var r,t;let{onQueryChange:s,query:o}=e;const[n,c]=(0,i.useState)(null!==(r=null===(t=o.azureMonitor)||void 0===t?void 0:t.alias)&&void 0!==r?r:""),u=(0,i.useCallback)((e=>{e.target instanceof HTMLInputElement&&c(e.target.value)}),[]),l=(0,i.useCallback)((()=>{const e=function(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.alias)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{alias:r})})}(o,n);s(e)}),[s,o,n]);return(0,T.jsx)(U,{label:"Legend format",children:(0,T.jsx)(a.Input,{id:"azure-monitor-metrics-legend-field",placeholder:"Alias patterns",value:n,onChange:u,onBlur:l,width:38})})},tr=e=>{var r,t;let{metricNames:s,query:o,variableOptionGroup:n,onQueryChange:c}=e;const u=(0,i.useCallback)((e=>{if(!e.value)return;const r=function(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.metricName)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{metricName:r,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}(o,e.value);c(r)}),[c,o]),l=(0,i.useMemo)((()=>[...s,n]),[s,n]);return(0,T.jsx)(U,{label:"Metric",children:(0,T.jsx)(a.Select,{inputId:"azure-monitor-metrics-metric-field",value:null!==(r=null===(t=o.azureMonitor)||void 0===t?void 0:t.metricName)&&void 0!==r?r:null,onChange:u,options:l,allowCustomValue:!0})})},sr=e=>{var r,t;let{metricNamespaces:s,query:o,variableOptionGroup:n,onQueryChange:c}=e;const u=(0,i.useCallback)((e=>{if(!e.value)return;const r=Ke(o,e.value);c(r)}),[c,o]),l=(0,i.useMemo)((()=>[...s,n]),[s,n]),p=s.map((e=>e.value.toLowerCase())).concat(n.options.map((e=>e.value))),m=(null===(r=o.azureMonitor)||void 0===r?void 0:r.customNamespace)||(null===(t=o.azureMonitor)||void 0===t?void 0:t.metricNamespace);return m&&!p.includes(m.toLowerCase())&&l.push({label:m,value:m}),(0,T.jsx)(U,{label:"Metric namespace",children:(0,T.jsx)(a.Select,{inputId:"azure-monitor-metrics-metric-namespace-field",value:m||null,onChange:u,options:l,allowCustomValue:!0})})},or=e=>{var r;let{query:t,timeGrainOptions:s,variableOptionGroup:o,onQueryChange:n}=e;const c=(0,i.useCallback)((e=>{if(!e.value)return;const r=Je(t,e.value);n(r)}),[n,t]),l=(0,i.useMemo)((()=>{const e=u.findClosestTimeGrain("1m",s.map((e=>u.createKbnUnitFromISO8601Duration(e.value)))||["1m","5m","15m","30m","1h","6h","12h","1d"]);return[...s.map((r=>"auto"===r.value?Object.assign({},r,{description:e}):r)),o]}),[s,o]);return(0,T.jsx)(U,{label:"Time grain",children:(0,T.jsx)(a.Select,{inputId:"azure-monitor-metrics-time-grain-field",value:null===(r=t.azureMonitor)||void 0===r?void 0:r.timeGrain,onChange:c,options:l})})},ir=e=>{var r,t;let{onQueryChange:s,query:o}=e;const[n,c]=(0,i.useState)(null!==(r=null===(t=o.azureMonitor)||void 0===t?void 0:t.top)&&void 0!==r?r:""),u=(0,i.useCallback)((e=>{e.target instanceof HTMLInputElement&&c(e.target.value)}),[]),l=(0,i.useCallback)((()=>{const e=function(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.top)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{top:r})})}(o,n);s(e)}),[s,o,n]);return(0,T.jsx)(U,{label:"Top",children:(0,T.jsx)(a.Input,{id:"azure-monitor-metrics-top-field",value:n,onChange:u,onBlur:l,width:16})})};function ar(e,r,t){const[s]=(0,i.useState)((()=>Math.random())),[o,a]=(0,i.useState)(),n=(0,i.useMemo)((()=>null!=o?o:[]),[o]);return(0,i.useEffect)((()=>{e().then((e=>{a(e),r(s,void 0)})).catch((e=>{r(s,e)}))}),t),n}const nr={aggOptions:[],timeGrains:[],dimensions:[],isLoading:!1,supportedAggTypes:[],primaryAggType:void 0};function cr(e,r){const t=e.map(m);return r&&!t.find((e=>e.value===r.toLowerCase()))&&t.push({label:r,value:r}),t}const ur=e=>{var r,t,o,a,n,c;let{data:l,query:p,datasource:m,variableOptionGroup:d,onChange:f,setError:g}=e;const h=((e,r,t)=>{var o;const[a,n]=(0,i.useState)(nr),{subscription:c}=e,{resourceGroup:l,resourceName:p,metricNamespace:m,metricName:d,aggregation:f,timeGrain:g,customNamespace:h}=null!==(o=e.azureMonitor)&&void 0!==o?o:{};return(0,i.useEffect)((()=>{c&&l&&p&&m&&d?r.azureMonitorDatasource.getMetricMetadata({subscription:c,resourceGroup:l,resourceName:p,metricNamespace:m,metricName:d,customNamespace:h}).then((e=>{var r;const t=(e.supportedAggTypes||[e.primaryAggType]).map((e=>({label:e,value:e})));n({aggOptions:t,timeGrains:e.supportedTimeGrains,dimensions:e.dimensions,isLoading:!1,supportedAggTypes:null!==(r=e.supportedAggTypes)&&void 0!==r?r:[],primaryAggType:e.primaryAggType})})):n(nr)}),[r,c,l,p,m,d,h]),(0,i.useEffect)((()=>{const r=f||a.primaryAggType,o=g||"auto";r===f&&o===g||t(Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{aggregation:r,timeGrain:o,allowedTimeGrainsMs:a.timeGrains.filter((e=>"auto"!==e.value)).map((e=>s.rangeUtil.intervalToMs(u.createKbnUnitFromISO8601Duration(e.value))))})}))}),[t,a,f,g,e]),a})(p,m,f),v=((e,r,t,s)=>{var o;const{subscription:i}=e,{metricNamespace:a,resourceGroup:n,resourceName:c}=null!==(o=e.azureMonitor)&&void 0!==o?o:{};return ar((async()=>{if(!i||!n||!c)return;const s=cr(await r.azureMonitorDatasource.getMetricNamespaces({subscription:i,metricNamespace:a,resourceGroup:n,resourceName:c},!1),a);return!a&&s.length&&t(Ke(e,s[0].value)),s}),s,[i,a,n,c])})(p,m,f,g),b=((e,r,t,s)=>{var o;const{subscription:i}=e,{metricNamespace:a,metricName:n,resourceGroup:c,resourceName:u,customNamespace:l}=null!==(o=e.azureMonitor)&&void 0!==o?o:{};return ar((async()=>{if(i&&a&&c&&u)return cr(await r.azureMonitorDatasource.getMetricNames({subscription:i,resourceGroup:c,resourceName:u,metricNamespace:a,customNamespace:l}),n)}),s,[i,c,u,a,l])})(p,m,0,g),y={subscription:p.subscription,resourceGroup:null===(r=p.azureMonitor)||void 0===r?void 0:r.resourceGroup,metricNamespace:null===(t=p.azureMonitor)||void 0===t?void 0:t.metricNamespace,resourceName:null===(o=p.azureMonitor)||void 0===o?void 0:o.resourceName};return(0,T.jsx)("span",{"data-testid":"azure-monitor-metrics-query-editor-with-experimental-ui",children:(0,T.jsxs)(W.EditorRows,{children:[(0,T.jsx)(W.EditorRow,{children:(0,T.jsxs)(W.EditorFieldGroup,{children:[(0,T.jsx)(Qe,{query:p,datasource:m,variableOptionGroup:d,onQueryChange:f,setError:g,selectableEntryTypes:[se.Resource],resource:y,queryType:"metrics"}),(0,T.jsx)(sr,{metricNamespaces:v,query:p,datasource:m,variableOptionGroup:d,onQueryChange:f,setError:g}),(0,T.jsx)(tr,{metricNames:b,query:p,datasource:m,variableOptionGroup:d,onQueryChange:f,setError:g}),(0,T.jsx)(Ye,{query:p,datasource:m,variableOptionGroup:d,onQueryChange:f,setError:g,aggregationOptions:null!==(a=null==h?void 0:h.aggOptions)&&void 0!==a?a:[],isLoading:h.isLoading}),(0,T.jsx)(or,{query:p,datasource:m,variableOptionGroup:d,onQueryChange:f,setError:g,timeGrainOptions:null!==(n=null==h?void 0:h.timeGrains)&&void 0!==n?n:[]})]})}),(0,T.jsx)(W.EditorRow,{children:(0,T.jsx)(W.EditorFieldGroup,{children:(0,T.jsx)(er,{data:l,query:p,datasource:m,variableOptionGroup:d,onQueryChange:f,setError:g,dimensionOptions:null!==(c=null==h?void 0:h.dimensions)&&void 0!==c?c:[]})})}),(0,T.jsx)(W.EditorRow,{children:(0,T.jsxs)(W.EditorFieldGroup,{children:[(0,T.jsx)(ir,{query:p,datasource:m,variableOptionGroup:d,onQueryChange:f,setError:g}),(0,T.jsx)(rr,{query:p,datasource:m,variableOptionGroup:d,onQueryChange:f,setError:g})]})})]})})},lr=e=>{let{query:r,onQueryChange:t}=e;const s=[{value:v.AzureMonitor,label:"Metrics"},{value:v.LogAnalytics,label:"Logs"},{value:v.AzureResourceGraph,label:"Azure Resource Graph"}],o=(0,i.useCallback)((e=>{e.value&&t(Object.assign({},r,{queryType:e.value}))}),[t,r]);return(0,T.jsx)("span",{"data-testid":"azure-monitor-experimental-header",children:(0,T.jsx)(W.EditorHeader,{children:(0,T.jsx)(W.InlineSelect,{label:"Service",value:r.queryType,placeholder:"Service...",allowCustomValue:!0,options:s,onChange:o})})})};var pr=t(10322),mr=t.n(pr);const dr="select";function fr(e){let r=e;return r.queryType||(r=Object.assign({},r,{queryType:v.AzureMonitor})),r=function(e){var r,t,s,o;let i=e;null!==(r=i.azureLogAnalytics)&&void 0!==r&&null!==(t=r.query)&&void 0!==t&&t.match(/\$__from\s/gi)&&(i=Ve(i,i.azureLogAnalytics.query.replace(/\$__from\s/gi,"$__timeFrom() ")));null!==(s=i.azureLogAnalytics)&&void 0!==s&&null!==(o=s.query)&&void 0!==o&&o.match(/\$__to\s/gi)&&(i=Ve(i,i.azureLogAnalytics.query.replace(/\$__to\s/gi,"$__timeTo() ")));return i}(r),r.queryType===v.AzureMonitor&&r.azureMonitor&&(r=function(e){var r;let t=e;if(null!==(r=t.azureMonitor)&&void 0!==r&&r.timeGrainUnit&&"auto"!==t.azureMonitor.timeGrain){var s,o;t=Je(t,u.createISO8601Duration(null!==(s=t.azureMonitor.timeGrain)&&void 0!==s?s:"auto",t.azureMonitor.timeGrainUnit)),null===(o=t.azureMonitor)||void 0===o||delete o.timeGrainUnit}return t}(r),r=function(e){var r,t;if((!(null===(r=e.azureMonitor)||void 0===r?void 0:r.metricNamespace)||e.azureMonitor.metricNamespace===dr)&&null!==(t=e.azureMonitor)&&void 0!==t&&t.metricDefinition)return Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{metricNamespace:e.azureMonitor.metricDefinition,metricDefinition:void 0})});return e}(r),r=function(e){var r;let t=e;const s=null===(r=t.azureMonitor)||void 0===r?void 0:r.dimension;var o;s&&"None"!==s&&(t=function(e){var r,t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"eq",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const a=null!==(r=null===(t=e.azureMonitor)||void 0===t?void 0:t.dimensionFilters)&&void 0!==r?r:[];return Ze(e,[...a,{dimension:s,operator:o,filters:i}])}(t,s,"eq",[(null===(o=t.azureMonitor)||void 0===o?void 0:o.dimensionFilter)||""]));return t}(r),r=function(e){const r=e.azureMonitor;if(!r)return e;const t=[],s=r.dimensionFilters;if(s&&s.length>0&&(s.forEach((e=>{const r={dimension:e.dimension,operator:e.operator};if(!e.filters&&e.filter)t.push(Object.assign({},r,{filters:[e.filter]}));else{let s=!1;if(e.filters&&e.filter){for(const r of e.filters)if(e.filter===r){s=!0;break}s||"*"===e.filter||e.filters.push(e.filter),t.push(Object.assign({},r,{filters:e.filters}))}}})),t.length>0))return Object.assign({},e,{azureMonitor:Object.assign({},r,{dimensionFilters:t})});return e}(r),r=function(e){var r;if(null!==(r=e.azureMonitor)&&void 0!==r&&r.resourceUri){const r=ye(e.azureMonitor.resourceUri);return Object.assign({},e,{subscription:null==r?void 0:r.subscription,azureMonitor:Object.assign({},e.azureMonitor,{resourceGroup:null==r?void 0:r.resourceGroup,metricNamespace:null==r?void 0:r.metricNamespace,resourceName:null==r?void 0:r.resourceName,resourceUri:void 0})})}return e}(r)),r}const gr={queryType:v.AzureMonitor},hr=(e,r)=>{const t=(0,i.useMemo)((()=>(e=>{const r=fr((0,n.defaults)({},e,gr));return mr()(r,e)?e:r})(e)),[e]);return(0,i.useEffect)((()=>{t!==e&&r(t)}),[t,e,r]),t};var vr,br;const yr=e=>{let{data:r,subscriptionId:t,query:s,datasource:o,variableOptionGroup:i,onChange:n,setError:c}=e;switch(s.queryType){case v.AzureMonitor:return(0,T.jsx)(ur,{data:r,query:s,datasource:o,onChange:n,variableOptionGroup:i,setError:c});case v.LogAnalytics:return(0,T.jsx)(He,{subscriptionId:t,query:s,datasource:o,onChange:n,variableOptionGroup:i,setError:c});case v.AzureResourceGraph:return(0,T.jsx)(H,{subscriptionId:t,query:s,datasource:o,onChange:n,variableOptionGroup:i,setError:c});default:const e=s.queryType;return(0,T.jsx)(a.Alert,{title:"Unknown query type",children:("Application Insights"===e||"Insights Analytics"===e)&&(0,T.jsxs)(T.Fragment,{children:[e," was deprecated in Grafana 9. See the"," ",br||(br=(0,T.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/datasources/azuremonitor/deprecated-application-insights/",target:"_blank",rel:"noreferrer",children:"deprecation notice"}))," ","to get more information about how to migrate your queries. This is the current query definition:",(0,T.jsx)(a.CodeEditor,{height:"200px",readOnly:!0,language:"json",value:JSON.stringify(s,null,4)})]})})}},wr=e=>{let{query:r,datasource:t,onChange:s,onRunQuery:o,data:c}=e;const[u,l]=V(),p=(0,i.useMemo)((()=>(0,n.debounce)(o,500)),[o]),m=(0,i.useCallback)((e=>{s(e),p()}),[s,p]),d=hr(r,m),f=d.subscription||t.azureMonitorDatasource.defaultSubscriptionId,g={label:"Template Variables",options:t.getVariables().map((e=>({label:e,value:e})))};return(0,T.jsxs)("div",{"data-testid":"azure-monitor-query-editor",children:[(0,T.jsx)(lr,{query:d,onQueryChange:m}),(0,T.jsx)(yr,{data:c,subscriptionId:f,query:d,datasource:t,onChange:m,variableOptionGroup:g,setError:l}),u&&(0,T.jsxs)(T.Fragment,{children:[vr||(vr=(0,T.jsx)(Z,{v:2})),(0,T.jsx)(a.Alert,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor",children:u})]})]})};var Sr=t(13146),kr=t(71808),Nr=t(35778),Mr=t(7166),jr=t(94396),Ar=t(71114);class zr{constructor(e,r,t){this.rawQueryString=e,this.options=r,this.defaultTimeField=t}generate(){let e=this.rawQueryString;const r=/\$__([_a-zA-Z0-9]+)\(([^()]*)\)/gi;e=e.replace(r,((e,r,t)=>"contains"===r?this.getMultiContains(t):e)),e=e.replace(/\$__escapeMulti\(('[^]*')\)/gi,((e,r)=>this.escape(r))),this.options&&(e=e.replace(r,((e,r,t)=>"timeFilter"===r?this.getTimeFilter(t,this.options):"timeFrom"===r?this.getFrom(this.options):"timeTo"===r?this.getUntil(this.options):e)),e=e.replace(/\$__interval/gi,this.options.interval));const t=e;e=encodeURIComponent(e);return{uriString:`query=${e}`,rawQuery:t}}getFrom(e){const r=e.range.from;return`datetime(${(0,s.dateTime)(r).startOf("minute").toISOString()})`}getUntil(e){var r;if("now"===(null===(r=e.rangeRaw)||void 0===r?void 0:r.to)){const e=Date.now();return`datetime(${(0,s.dateTime)(e).startOf("minute").toISOString()})`}{const r=e.range.to;return`datetime(${(0,s.dateTime)(r).startOf("minute").toISOString()})`}}getTimeFilter(e,r){var t;const s=e||this.defaultTimeField;return"now"===(null===(t=r.rangeRaw)||void 0===t?void 0:t.to)?`${s} >= ${this.getFrom(r)}`:`${s}  >= ${this.getFrom(r)} and ${s} <= ${this.getUntil(r)}`}getMultiContains(e){const r=e.indexOf(","),t=e.substring(0,r),s=e.substring(e.indexOf(",")+1);return s&&"all"===s.toLowerCase().trim()?"1 == 1":`${t.trim()} in (${s.trim()})`}escape(e){return e.substring(1,e.length-1).split("','").map((e=>`@'${e}'`)).join(", ")}}class xr{constructor(e){this.results=e}parseQueryResult(){let e=[],r=[];for(let t=0;t<this.results.length;t++){if(0===this.results[t].result.tables.length)continue;r=this.results[t].result.tables[0].columns;const s=this.results[t].result.tables[0].rows;e="time_series"===this.results[t].query.resultFormat?(0,n.concat)(e,this.parseTimeSeriesResult(this.results[t].query,r,s)):(0,n.concat)(e,this.parseTableResult(this.results[t].query,r,s))}return e}parseTimeSeriesResult(e,r,t){const s=[];let o=-1,i=-1,a=-1;for(let e=0;e<r.length;e++)-1===o&&"datetime"===r[e].type&&(o=e),-1===i&&"string"===r[e].type&&(i=e),-1===a&&["int","long","real","double"].indexOf(r[e].type)>-1&&(a=e);if(-1===o)throw new Error("No datetime column found in the result. The Time Series format requires a time column.");return(0,n.forEach)(t,(t=>{const n=xr.dateTimeToEpoch(t[o]),c=i>-1?t[i]:r[a].name,u=xr.findOrCreateBucket(s,c);u.datapoints.push([t[a],n]),u.refId=e.refId,u.meta={executedQueryString:e.query}})),s}parseTableResult(e,r,t){return{type:"table",columns:(0,n.map)(r,(e=>({text:e.name,type:e.type}))),rows:t,refId:e.refId,meta:{executedQueryString:e.query}}}parseToVariables(){const e=this.parseQueryResult(),r=[];return(0,n.forEach)(e,(e=>{(0,n.forEach)((0,n.flattenDeep)(e.rows),(e=>{r.push({text:e,value:e})}))})),r}transformToAnnotations(e){const r=this.parseQueryResult(),t=[];return(0,n.forEach)(r,(r=>{let s=-1,o=-1,i=-1;for(let e=0;e<r.columns.length;e++)-1===s&&"datetime"===r.columns[e].type&&(s=e),-1===o&&"text"===r.columns[e].text.toLowerCase()&&(o=e),-1===i&&"tags"===r.columns[e].text.toLowerCase()&&(i=e);(0,n.forEach)(r.rows,(r=>{t.push({annotation:e.annotation,time:Math.floor(xr.dateTimeToEpoch(r[s])),text:r[o]?r[o].toString():"",tags:r[i]?r[i].trim().split(/\s*,\s*/):[]})}))})),t}static findOrCreateBucket(e,r){let t=(0,n.find)(e,["target",r]);return t||(t={target:r,datapoints:[],refId:"",query:""},e.push(t)),t}static dateTimeToEpoch(e){return(0,s.dateTime)(e).valueOf()}static parseSubscriptions(e){const r=[];if(!e)return r;const t="subscriptionId";for(let s=0;s<e.value.length;s++)(0,n.find)(r,["value",(0,n.get)(e.value[s],t)])||r.push({text:`${(0,n.get)(e.value[s],"displayName")}`,value:(0,n.get)(e.value[s],t)});return r}}const Cr=/([\w\W]+):([\w]+)(?:\s?=\s?([\w\W]+))?/;function Gr(e){return e.functions?e.functions.map((e=>{const r=e.parameters&&e.parameters.split(", ").map((e=>{const r=e.match(Cr);if(!r)return;const[,t,s,o]=r;return{name:t,type:s,defaultValue:o,cslDefaultValue:o}})).filter((e=>!!e));return{name:e.name,body:e.body,inputParameters:r||[]}})):[]}function Ir(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}class Tr extends o.DataSourceWithBackend{constructor(e){super(e),Ir(this,"resourcePath",void 0),Ir(this,"azurePortalUrl",void 0),Ir(this,"defaultSubscriptionId",void 0),Ir(this,"azureMonitorPath",void 0),Ir(this,"firstWorkspace",void 0),Ir(this,"cache",void 0),this.instanceSettings=e,this.cache=new Map,this.resourcePath=`${f}`,this.azureMonitorPath=`${d}/subscriptions`;const r=N(e);this.azurePortalUrl=k(r),this.defaultSubscriptionId=this.instanceSettings.jsonData.subscriptionId||""}isConfigured(){return!this.validateDatasource()}filterQuery(e){var r;return!(!0===e.hide||null===(r=e.azureLogAnalytics)||void 0===r||!r.query||!e.azureLogAnalytics.resource&&!e.azureLogAnalytics.workspace)}async getSubscriptions(){if(!this.isConfigured())return[];const e=`${this.azureMonitorPath}?api-version=2019-03-01`;return await this.getResource(e).then((e=>xr.parseSubscriptions(e)))}async getWorkspaces(e){const r=await this.getWorkspaceList(e);return(0,n.map)(r.value,(e=>({text:e.name,value:e.id})))||[]}getWorkspaceList(e){const r=(0,o.getTemplateSrv)().replace(e||this.defaultSubscriptionId),t=this.azureMonitorPath+`/${r}/providers/Microsoft.OperationalInsights/workspaces?api-version=2017-04-26-preview`;return this.getResource(t)}async getMetadata(e){const r=`${this.resourcePath}/v1${e}/metadata`;return await this.getResource(r)}async getKustoSchema(e){const r=(0,o.getTemplateSrv)(),t=r.replace(e,{},h);return function(e,r,t){const s={name:r,tables:e.tables,functions:Gr(e),majorVersion:0,minorVersion:0};return s.functions.push({name:"$__timeFilter",body:"{ true }",inputParameters:[{name:"timeColumn",type:"System.String",defaultValue:'""',cslDefaultValue:'""'}]},{name:"$__timeFrom",body:"{ datetime(2018-06-05T18:09:58.907Z) }",inputParameters:[]},{name:"$__timeTo",body:"{ datetime(2018-06-05T20:09:58.907Z) }",inputParameters:[]},{name:"$__escapeMulti",body:"{ @'\\grafana-vmNetwork(eth0)Total', @'\\hello!'}",inputParameters:[{name:"$myVar",type:"System.String",defaultValue:"$myVar",cslDefaultValue:"$myVar"}]},{name:"$__contains",body:"{ colName in ('value1','value2') }",inputParameters:[{name:"colName",type:"System.String",defaultValue:"colName",cslDefaultValue:"colName"},{name:"$myVar",type:"System.String",defaultValue:"$myVar",cslDefaultValue:"$myVar"}]}),{clusterType:"Engine",cluster:{connectionString:r,databases:[s]},database:s,globalParameters:t.map((e=>({name:`$${e.name}`,type:"dynamic"})))}}(await this.getMetadata(t),t,r.getVariables())}applyTemplateVariables(e,r){const t=e.azureLogAnalytics;if(!t)return e;const s=(0,o.getTemplateSrv)(),i=s.replace(t.resource,r);let a=s.replace(t.workspace,r);a||i||!this.firstWorkspace||(a=this.firstWorkspace);const n=s.replace(t.query,r,h);return Object.assign({},e,{queryType:v.LogAnalytics,azureLogAnalytics:{resultFormat:t.resultFormat,query:n,resource:i,workspace:a}})}query(e){return super.query(e).pipe((0,Ar.z)((e=>(0,jr.D)(this.processResponse(e)))))}async processResponse(e){if(e.data)for(const s of e.data){var r,t;const e=null===(r=s.meta)||void 0===r||null===(t=r.custom)||void 0===t?void 0:t.encodedQuery;if(e&&e.length>0){const e=await this.buildDeepLink(s.meta.custom);if(null!=e&&e.length)for(const r of s.fields)r.config.links=[{url:e,title:"View in Azure Portal",targetBlank:!0}]}}return e}async buildDeepLink(e){const r=encodeURIComponent(e.encodedQuery),t=e.workspace,s=e.subscription,o=await this.getWorkspaceDetails(t);if(!o.workspace||!o.resourceGroup)return"";return`${this.azurePortalUrl}/#blade/Microsoft_OperationsManagementSuite_Workspace/AnalyticsBlade/initiator/AnalyticsShareLinkToQuery/isQueryEditorVisible/true/scope/%7B%22resources%22%3A%5B%7B%22resourceId%22%3A%22%2Fsubscriptions%2F${s}%2Fresourcegroups%2F${o.resourceGroup}%2Fproviders%2Fmicrosoft.operationalinsights%2Fworkspaces%2F${o.workspace}%22%7D%5D%7D/query/${r}/isQueryBase64Compressed/true/timespanInIsoFormat/P1D`}async getWorkspaceDetails(e){if(!this.defaultSubscriptionId)return{};const r=(await this.getWorkspaceList(this.defaultSubscriptionId)).value.find((r=>r.properties.customerId===e));if(!r)return{};const t=/.*resourcegroups\/(.*)\/providers.*/.exec(r.id);return!t||t.length<2?{}:{workspace:r.name,resourceGroup:t[1]}}getDeprecatedDefaultWorkSpace(){return this.instanceSettings.jsonData.logAnalyticsDefaultWorkspace}buildQuery(e,r,t){const s=new zr((0,o.getTemplateSrv)().replace(e,{},h),r,"TimeGenerated").generate().uriString,i=we(t)?`${this.resourcePath}/v1/workspaces/${t}/query?${s}`:`${this.resourcePath}/v1${t}/query?${s}`;return[{datasource:this.getRef(),path:i,resultFormat:"table"}]}async getDefaultOrFirstSubscription(){var e;if(this.defaultSubscriptionId)return this.defaultSubscriptionId;return null===(e=(await this.getSubscriptions())[0])||void 0===e?void 0:e.value}async getFirstWorkspace(){var e;if(this.firstWorkspace)return this.firstWorkspace;const r=await this.getDefaultOrFirstSubscription();if(!r)return;const t=null===(e=(await this.getWorkspaces(r))[0])||void 0===e?void 0:e.value;return t&&(this.firstWorkspace=t),t}annotationQuery(e){if(!e.annotation.rawQuery)return Promise.reject({message:"Query missing in annotation definition"});const r=this.buildQuery(e.annotation.rawQuery,e,e.annotation.workspace),t=this.doQueries(r);return Promise.all(t).then((r=>new xr(r).transformToAnnotations(e)))}doQueries(e){return(0,n.map)(e,(e=>this.getResource(e.path).then((r=>({result:r,query:e}))).catch((r=>{throw{error:r,query:e}}))))}validateDatasource(){if("clientsecret"===w(this.instanceSettings)){if(!this.isValidConfigField(this.instanceSettings.jsonData.tenantId))return{status:"error",message:"The Tenant Id field is required."};if(!this.isValidConfigField(this.instanceSettings.jsonData.clientId))return{status:"error",message:"The Client Id field is required."}}}isValidConfigField(e){return"string"==typeof e&&e.length>0}}var Rr=t(75478);function Dr(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function Lr(e){return!(!e||"select"===e)}class Or extends o.DataSourceWithBackend{constructor(e){super(e),Dr(this,"apiVersion","2018-01-01"),Dr(this,"apiPreviewVersion","2017-12-01-preview"),Dr(this,"listByResourceGroupApiVersion","2021-04-01"),Dr(this,"defaultSubscriptionId",void 0),Dr(this,"resourcePath",void 0),Dr(this,"azurePortalUrl",void 0),Dr(this,"timeSrv",void 0),Dr(this,"templateSrv",void 0),this.instanceSettings=e,this.timeSrv=(0,Rr.$t)(),this.templateSrv=(0,o.getTemplateSrv)(),this.defaultSubscriptionId=e.jsonData.subscriptionId;const r=N(e);this.resourcePath=d,this.azurePortalUrl=k(r)}isConfigured(){return!this.validateDatasource()}filterQuery(e){var r,t,s,o,i,a;const n=Lr(null==e||null===(r=e.azureMonitor)||void 0===r?void 0:r.resourceGroup)&&Lr(null==e||null===(t=e.azureMonitor)||void 0===t?void 0:t.resourceName)&&Lr((null==e||null===(s=e.azureMonitor)||void 0===s?void 0:s.metricDefinition)||(null==e||null===(o=e.azureMonitor)||void 0===o?void 0:o.metricNamespace));return!!(!0!==e.hide&&n&&Lr(null==e||null===(i=e.azureMonitor)||void 0===i?void 0:i.metricName)&&Lr(null==e||null===(a=e.azureMonitor)||void 0===a?void 0:a.aggregation))}applyTemplateVariables(e,r){var t;const s=e.azureMonitor;if(!s)throw new Error("Query is not a valid Azure Monitor Metrics query");s.timeGrain&&s.timeGrainUnit&&"auto"!==s.timeGrain&&(s.timeGrain=u.createISO8601Duration(s.timeGrain,s.timeGrainUnit));const i=(0,o.getTemplateSrv)(),a=i.replace(e.subscription||this.defaultSubscriptionId,r),n=i.replace(s.resourceGroup,r),c=i.replace(s.resourceName,r),l=i.replace(s.metricNamespace,r),p=i.replace(s.customNamespace,r),m=i.replace((s.timeGrain||"").toString(),r),d=i.replace(s.aggregation,r),f=i.replace(s.top||"",r),g=(null!==(t=s.dimensionFilters)&&void 0!==t?t:[]).filter((e=>e.dimension&&"None"!==e.dimension)).map((e=>{var t;const s=null===(t=e.filters)||void 0===t?void 0:t.map((e=>i.replace(null!=e?e:"",r)));return{dimension:i.replace(e.dimension,r),operator:e.operator||"eq",filters:s||[]}})),h={resourceGroup:n,metricNamespace:l,customNamespace:p,resourceName:c,timeGrain:m,allowedTimeGrainsMs:s.allowedTimeGrainsMs,metricName:i.replace(s.metricName,r),aggregation:d,dimensionFilters:g,top:f||"10",alias:s.alias};return s.metricDefinition&&(h.metricDefinition=i.replace(s.metricDefinition,r)),s.resourceUri&&(h.resourceUri=i.replace(s.resourceUri,r)),fr(Object.assign({},e,{subscription:a,queryType:v.AzureMonitor,azureMonitor:h}))}async getSubscriptions(){return this.isConfigured()?this.getResource(`${this.resourcePath}/subscriptions?api-version=2019-03-01`).then((e=>l.parseSubscriptions(e))):[]}getResourceGroups(e){return this.getResource(`${this.resourcePath}/subscriptions/${e}/resourceGroups?api-version=${this.listByResourceGroupApiVersion}`).then((e=>l.parseResponseValues(e,"name","name")))}getResourceNames(e,r,t,s){const o=(0,n.startsWith)(null==t?void 0:t.toLowerCase(),"microsoft.storage/storageaccounts/")?"microsoft.storage/storageaccounts":t;let i=`${this.resourcePath}/subscriptions/${e}`;return r&&(i+=`/resourceGroups/${r}`),i+=`/resources?api-version=${this.listByResourceGroupApiVersion}`,o&&(i+=`&$filter=resourceType eq '${o}'`),s&&(i+=`&$skiptoken=${s}`),this.getResource(i).then((async s=>{let o=[];if((0,n.startsWith)(null==t?void 0:t.toLowerCase(),"microsoft.storage/storageaccounts/")){o=l.parseResourceNames(s,"microsoft.storage/storageaccounts");for(let e=0;e<o.length;e++)o[e].text+="/default",o[e].value+="/default"}else o=l.parseResourceNames(s,t);if(s.nextLink){const i=new URL(s.nextLink).searchParams.get("$skiptoken");if(!i)throw Error("unable to request the next page of resources");const a=await this.getResourceNames(e,r,t,i);o=o.concat(a)}return o}))}getMetricNamespaces(e,r){const t=he.buildAzureMonitorGetMetricNamespacesUrl(this.resourcePath,this.apiPreviewVersion,this.replaceTemplateVariables(e),r,this.templateSrv);return this.getResource(t).then((e=>l.parseResponseValues(e,"properties.metricNamespaceName","properties.metricNamespaceName"))).then((e=>{if(t.toLowerCase().includes("microsoft.storage/storageaccounts")){const r=["microsoft.storage/storageaccounts","microsoft.storage/storageaccounts/blobservices","microsoft.storage/storageaccounts/fileservices","microsoft.storage/storageaccounts/tableservices","microsoft.storage/storageaccounts/queueservices"];for(const t of r)(0,n.find)(e,["value",t.toLowerCase()])||e.push({value:t,text:t})}return e}))}getMetricNames(e){const r=he.buildAzureMonitorGetMetricNamesUrl(this.resourcePath,this.apiVersion,this.replaceTemplateVariables(e),this.templateSrv);return this.getResource(r).then((e=>l.parseResponseValues(e,"name.localizedValue","name.value")))}getMetricMetadata(e){const{metricName:r}=e,t=he.buildAzureMonitorGetMetricNamesUrl(this.resourcePath,this.apiVersion,this.replaceTemplateVariables(e),this.templateSrv);return this.getResource(t).then((e=>l.parseMetadata(e,r)))}validateDatasource(){if("clientsecret"===w(this.instanceSettings)){if(!this.isValidConfigField(this.instanceSettings.jsonData.tenantId))return{status:"error",message:"The Tenant Id field is required."};if(!this.isValidConfigField(this.instanceSettings.jsonData.clientId))return{status:"error",message:"The Client Id field is required."}}}isValidConfigField(e){return"string"==typeof e&&e.length>0}replaceTemplateVariables(e){const r=(0,o.getTemplateSrv)(),t=Object.assign({},e);return Object.keys(e).forEach((e=>{t[e]=r.replace(t[e])})),t}}class qr extends o.DataSourceWithBackend{filterQuery(e){var r;return!(null===(r=e.azureResourceGraph)||void 0===r||!r.query)}applyTemplateVariables(e,r){const t=e.azureResourceGraph;if(!t)return e;const s=(0,o.getTemplateSrv)(),i=s.getVariables().map((e=>`$${e.name}`)),a=c().find(e.subscriptions,(e=>c().includes(i,e))),n=[...s.replace(a,r,(e=>e)).split(",").filter((e=>e.length>0)),...c().filter(e.subscriptions,(e=>!c().includes(i,e)))],u=s.replace(t.query,r,h);return Object.assign({},e,{queryType:v.AzureResourceGraph,subscriptions:n,azureResourceGraph:{resultFormat:"table",query:u}})}}const Pr=[{location:"eastus",displayName:"East US",supportsLogs:!0},{location:"eastus2",displayName:"East US 2",supportsLogs:!0},{location:"southcentralus",displayName:"South Central US",supportsLogs:!0},{location:"westus2",displayName:"West US 2",supportsLogs:!0},{location:"westus3",displayName:"West US 3",supportsLogs:!0},{location:"australiaeast",displayName:"Australia East",supportsLogs:!0},{location:"southeastasia",displayName:"Southeast Asia",supportsLogs:!0},{location:"northeurope",displayName:"North Europe",supportsLogs:!0},{location:"uksouth",displayName:"UK South",supportsLogs:!0},{location:"westeurope",displayName:"West Europe",supportsLogs:!0},{location:"centralus",displayName:"Central US",supportsLogs:!0},{location:"northcentralus",displayName:"North Central US",supportsLogs:!0},{location:"westus",displayName:"West US",supportsLogs:!0},{location:"southafricanorth",displayName:"South Africa North",supportsLogs:!0},{location:"centralindia",displayName:"Central India",supportsLogs:!0},{location:"eastasia",displayName:"East Asia",supportsLogs:!0},{location:"japaneast",displayName:"Japan East",supportsLogs:!0},{location:"jioindiawest",displayName:"Jio India West",supportsLogs:!0},{location:"koreacentral",displayName:"Korea Central",supportsLogs:!0},{location:"canadacentral",displayName:"Canada Central",supportsLogs:!0},{location:"francecentral",displayName:"France Central",supportsLogs:!0},{location:"germanywestcentral",displayName:"Germany West Central",supportsLogs:!0},{location:"norwayeast",displayName:"Norway East",supportsLogs:!0},{location:"switzerlandnorth",displayName:"Switzerland North",supportsLogs:!0},{location:"uaenorth",displayName:"UAE North",supportsLogs:!0},{location:"brazilsouth",displayName:"Brazil South",supportsLogs:!0},{location:"centralusstage",displayName:"Central US (Stage)",supportsLogs:!0},{location:"eastusstage",displayName:"East US (Stage)",supportsLogs:!0},{location:"eastus2stage",displayName:"East US 2 (Stage)",supportsLogs:!0},{location:"northcentralusstage",displayName:"North Central US (Stage)",supportsLogs:!0},{location:"southcentralusstage",displayName:"South Central US (Stage)",supportsLogs:!0},{location:"westusstage",displayName:"West US (Stage)",supportsLogs:!0},{location:"westus2stage",displayName:"West US 2 (Stage)",supportsLogs:!0},{location:"asia",displayName:"Asia",supportsLogs:!0},{location:"asiapacific",displayName:"Asia Pacific",supportsLogs:!0},{location:"australia",displayName:"Australia",supportsLogs:!0},{location:"brazil",displayName:"Brazil",supportsLogs:!0},{location:"canada",displayName:"Canada",supportsLogs:!0},{location:"europe",displayName:"Europe",supportsLogs:!0},{location:"global",displayName:"Global",supportsLogs:!0},{location:"india",displayName:"India",supportsLogs:!0},{location:"japan",displayName:"Japan",supportsLogs:!0},{location:"uk",displayName:"United Kingdom",supportsLogs:!0},{location:"unitedstates",displayName:"United States",supportsLogs:!0},{location:"eastasiastage",displayName:"East Asia (Stage)",supportsLogs:!0},{location:"southeastasiastage",displayName:"Southeast Asia (Stage)",supportsLogs:!0},{location:"westcentralus",displayName:"West Central US",supportsLogs:!0},{location:"southafricawest",displayName:"South Africa West",supportsLogs:!0},{location:"australiacentral",displayName:"Australia Central",supportsLogs:!0},{location:"australiacentral2",displayName:"Australia Central 2",supportsLogs:!0},{location:"australiasoutheast",displayName:"Australia Southeast",supportsLogs:!0},{location:"japanwest",displayName:"Japan West",supportsLogs:!0},{location:"koreasouth",displayName:"Korea South",supportsLogs:!0},{location:"southindia",displayName:"South India",supportsLogs:!0},{location:"westindia",displayName:"West India",supportsLogs:!0},{location:"canadaeast",displayName:"Canada East",supportsLogs:!0},{location:"francesouth",displayName:"France South",supportsLogs:!0},{location:"germanynorth",displayName:"Germany North",supportsLogs:!0},{location:"norwaywest",displayName:"Norway West",supportsLogs:!0},{location:"switzerlandwest",displayName:"Switzerland West",supportsLogs:!0},{location:"ukwest",displayName:"UK West",supportsLogs:!0},{location:"uaecentral",displayName:"UAE Central",supportsLogs:!0},{location:"brazilsoutheast",displayName:"Brazil Southeast",supportsLogs:!0},{location:"chinaeast",displayName:"China Eest",supportsLogs:!0},{location:"chinaeast2",displayName:"China Eest 2",supportsLogs:!0},{location:"chinanorth",displayName:"China North",supportsLogs:!0},{location:"chinanorth2",displayName:"China North 2",supportsLogs:!0},{location:"chinanorth3",displayName:"China North 3",supportsLogs:!0}],Fr=Pr.filter((e=>e.supportsLogs)).map((e=>`"${e.location}"`)).join(","),Er=Pr.reduce(((e,r)=>Object.assign({},e,{[r.location]:r.displayName})),{}),Qr={"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems":"Backup Items","microsoft.resources/subscriptions":"Subscriptions","microsoft.resources/subscriptions/resourcegroups":"Resource groups","citrix.services/xenappessentials":"Citrix Virtual Apps Essentials","citrix.services/xendesktopessentials":"Citrix Virtual Desktops Essentials","dynatrace.observability/monitors":"Dynatrace","github.enterprise/accounts":"GitHub AE","microsoft.aad/domainservices":"Azure AD Domain Services","microsoft.aadiam/privatelinkforazuread":"Private Link for Azure AD","microsoft.agfoodplatform/farmbeats":"Azure FarmBeats","microsoft.analysisservices/servers":"Analysis Services","microsoft.anybuild/clusters":"AnyBuild clusters","microsoft.apimanagement/service":"API Management services","microsoft.appconfiguration/configurationstores":"App Configuration","microsoft.appplatform/spring":"Azure Spring Cloud","microsoft.attestation/attestationproviders":"Attestation providers","microsoft.authorization/resourcemanagementprivatelinks":"Resource management private links","microsoft.automation/automationaccounts":"Automation Accounts","microsoft.automation/automationaccounts/runbooks":"Runbook","microsoft.autonomoussystems/workspaces":"Bonsai","microsoft.avs/privateclouds":"AVS Private clouds","microsoft.azureactivedirectory/b2cdirectories":"B2C Tenants","microsoft.azureactivedirectory/guestusages":"Guest Usages","microsoft.azurearcdata/datacontrollers":"Azure Arc data controllers","microsoft.azurearcdata/postgresinstances":"Azure Arc-enabled PostgreSQL Hyperscale server groups","microsoft.azurearcdata/sqlmanagedinstances":"SQL managed instances - Azure Arc","microsoft.azurearcdata/sqlserverinstances":"SQL Server - Azure Arc","microsoft.azuredata/sqlserverregistrations":"SQL Server registries","microsoft.azurepercept/accounts":"Azure Percept accounts","microsoft.azurestackhci/clusters":"Azure Stack HCI","microsoft.azurestackhci/virtualmachines":"Azure Stack HCI virtual machine - Azure Arc","microsoft.baremetal/crayservers":"Cray Servers","microsoft.baremetal/monitoringservers":"Monitoring Servers","microsoft.baremetalinfrastructure/baremetalinstances":"BareMetal Instances","microsoft.batch/batchaccounts":"Batch accounts","microsoft.bing/accounts":"Bing Resources","microsoft.botservice/botservices":"Bot Services","microsoft.cache/redis":"Azure Cache for Redis","microsoft.cache/redisenterprise":"Redis Enterprise","microsoft.cdn/cdnwebapplicationfirewallpolicies":"Content Delivery Network WAF policies","microsoft.cdn/profiles (front doors standard/premium":"Preview)","microsoft.cdn/profiles/afdendpoints":"Endpoints","microsoft.cdn/profiles/endpoints":"Endpoints","microsoft.certificateregistration/certificateorders":"App Service Certificates","microsoft.chaos/chaosexperiments":"Chaos Experiments (Classic)","microsoft.chaos/experiments":"Chaos Experiments","microsoft.classiccompute/domainnames":"Cloud services (classic)","microsoft.classiccompute/virtualmachines":"Virtual machines (classic)","microsoft.classicnetwork/networksecuritygroups":"Network security groups (classic)","microsoft.classicnetwork/reservedips":"Reserved IP addresses (classic)","microsoft.classicnetwork/virtualnetworks":"Virtual networks (classic)","microsoft.classicstorage/storageaccounts":"Storage accounts (classic)","microsoft.cloudtest/accounts":"CloudTest Accounts","microsoft.cloudtest/hostedpools":"1ES Hosted Pools","microsoft.cloudtest/images":"CloudTest Images","microsoft.cloudtest/pools":"CloudTest Pools","microsoft.clusterstor/nodes":"ClusterStors","microsoft.cognitiveservices/accounts":"Cognitive Services","microsoft.compute/availabilitysets":"Availability sets","microsoft.compute/capacityreservationgroups":"Capacity Reservation Groups","microsoft.compute/cloudservices":"Cloud services (extended support)","microsoft.compute/diskaccesses":"Disk Accesses","microsoft.compute/diskencryptionsets":"Disk Encryption Sets","microsoft.compute/disks":"Disks","microsoft.compute/galleries":"Azure compute galleries","microsoft.compute/galleries/applications":"VM application definitions","microsoft.compute/galleries/applications/versions":"VM application versions","microsoft.compute/galleries/images":"VM image definitions","microsoft.compute/galleries/images/versions":"VM image versions","microsoft.compute/hostgroups":"Host groups","microsoft.compute/hostgroups/hosts":"Hosts","microsoft.compute/images":"Images","microsoft.compute/proximityplacementgroups":"Proximity placement groups","microsoft.compute/restorepointcollections":"Restore Point Collections","microsoft.compute/snapshots":"Snapshots","microsoft.compute/sshpublickeys":"SSH keys","microsoft.compute/virtualmachines":"Virtual machines","microsoft.compute/virtualmachinescalesets":"Virtual machine scale sets","microsoft.confidentialledger/ledgers":"Confidential Ledgers","microsoft.confluent/organizations":"Confluent organizations","microsoft.connectedcache/cachenodes":"Connected Cache Resources","microsoft.connectedcache/enterprisecustomers":"Connected Cache Resources","microsoft.connectedvehicle/platformaccounts":"Connected Vehicle Platforms","microsoft.connectedvmwarevsphere/vcenters":"VMware vCenters","microsoft.connectedvmwarevsphere/virtualmachines":"VMware + AVS virtual machines","microsoft.containerinstance/containergroups":"Container instances","microsoft.containerregistry/registries":"Container registries","microsoft.containerregistry/registries/replications":"Container registry replications","microsoft.containerregistry/registries/webhooks":"Container registry webhooks","microsoft.containerservice/managedclusters":"Kubernetes services","microsoft.dashboard/grafana":"Grafana Workspaces","microsoft.databox/jobs":"Azure Data Box","microsoft.databoxedge/databoxedgedevices":"Azure Stack Edge / Data Box Gateway","microsoft.databricks/workspaces":"Azure Databricks Services","microsoft.datacatalog/catalogs":"Data Catalog","microsoft.datacollaboration/workspaces":"Project CI","microsoft.datadog/monitors":"Datadog","microsoft.datafactory/datafactories":"Data factories","microsoft.datafactory/factories":"Data factories (V2)","microsoft.datalakeanalytics/accounts":"Data Lake Analytics","microsoft.datalakestore/accounts":"Data Lake Storage Gen1","microsoft.datamigration/services":"Azure Database Migration Services","microsoft.datamigration/services/projects":"Azure Database Migration Projects","microsoft.datamigration/sqlmigrationservices":"Azure Database Migration Services","microsoft.dataprotection/backupvaults":"Backup vaults","microsoft.dataprotection/resourceguards":"Resource Guards (Preview)","microsoft.datareplication/replicationvaults":"Site Recovery Vaults","microsoft.datashare/accounts":"Data Shares","microsoft.dbformariadb/servers":"Azure Database for MariaDB servers","microsoft.dbformysql/flexibleservers":"Azure Database for MySQL flexible servers","microsoft.dbformysql/servers":"Azure Database for MySQL servers","microsoft.dbforpostgresql/flexibleservers":"Azure Database for PostgreSQL flexible servers","microsoft.dbforpostgresql/servergroups":"Azure Database for PostgreSQL server groups","microsoft.dbforpostgresql/servergroupsv2":"Azure Database for PostgreSQL server groups","microsoft.dbforpostgresql/servers":"Azure Database for PostgreSQL servers","microsoft.dbforpostgresql/serversv2":"Azure Database for PostgreSQL servers v2","microsoft.deploymentmanager/rollouts":"Rollouts","microsoft.desktopvirtualization/applicationgroups":"Application groups","microsoft.desktopvirtualization/hostpools":"Host pools","microsoft.desktopvirtualization/scalingplans":"Scaling plans","microsoft.desktopvirtualization/workspaces":"Workspaces","microsoft.devices/iothubs":"IoT Hub","microsoft.devices/provisioningservices":"Device Provisioning Services","microsoft.deviceupdate/accounts":"Device Update for IoT Hubs","microsoft.devops/pipelines":"DevOps Starter","microsoft.devtestlab/labs":"DevTest Labs","microsoft.devtestlab/labs/virtualmachines":"Virtual machines","microsoft.digitaltwins/digitaltwinsinstances":"Azure Digital Twins","microsoft.documentdb/cassandraclusters":"Azure Managed Instance for Apache Cassandra","microsoft.documentdb/databaseaccounts":"Azure Cosmos DB accounts","microsoft.domainregistration/domains":"App Service Domains","microsoft.edgeorder/addresses":"Azure Edge Hardware Center Address","microsoft.edgeorder/orderitems":"Azure Edge Hardware Center","microsoft.elastic/monitors":"Elasticsearch (Elastic Cloud)","microsoft.eventgrid/domains":"Event Grid Domains","microsoft.eventgrid/partnernamespaces":"Event Grid Partner Namespaces","microsoft.eventgrid/partnerregistrations":"Event Grid Partner Registrations","microsoft.eventgrid/partnertopics":"Event Grid Partner Topics","microsoft.eventgrid/systemtopics":"Event Grid System Topics","microsoft.eventgrid/topics":"Event Grid Topics","microsoft.eventhub/clusters":"Event Hubs Clusters","microsoft.eventhub/namespaces":"Event Hubs Namespaces","microsoft.experimentation/experimentworkspaces":"Experiment Workspaces","microsoft.extendedlocation/customlocations":"Custom locations","microsoft.fidalgo/devcenters":"Fidalgo DevCenters","microsoft.fidalgo/networksettings":"Network Configurations","microsoft.fidalgo/projects":"Fidalgo Projects","microsoft.fidalgo/projects/environments":"Fidalgo Environments","microsoft.fluidrelay/fluidrelayservers":"Fluid Relay","microsoft.genomics/accounts":"Genomics accounts","microsoft.hanaonazure/hanainstances":"SAP HANA on Azure","microsoft.hanaonazure/sapmonitors":"Azure Monitors for SAP Solutions","microsoft.hdinsight/clusterpools":"HDInsight cluster pools","microsoft.hdinsight/clusterpools/clusters":"HDInsight gen2 clusters","microsoft.hdinsight/clusterpools/clusters/sessionclusters":"HDInsight session clusters","microsoft.hdinsight/clusters":"HDInsight clusters","microsoft.healthbot/healthbots":"Azure Health Bot","microsoft.healthcareapis/services":"Azure API for FHIR","microsoft.healthcareapis/workspaces":"Healthcare APIs Workspaces","microsoft.healthcareapis/workspaces/dicomservices":"DICOM services","microsoft.healthcareapis/workspaces/fhirservices":"FHIR services","microsoft.healthcareapis/workspaces/iotconnectors":"IoT connectors","microsoft.hpcworkbench/instances":"HPC Workbenches (preview)","microsoft.hpcworkbench/instances/chambers":"Chambers (preview)","microsoft.hpcworkbench/instances/chambers/accessprofiles":"Chamber Profiles (preview)","microsoft.hpcworkbench/instances/chambers/workloads":"Chamber VMs (preview)","microsoft.hpcworkbench/instances/consortiums":"Consortiums (preview)","microsoft.hybridcompute/machines":"Servers - Azure Arc","microsoft.hybridcompute/privatelinkscopes":"Azure Arc Private Link Scopes","microsoft.hybriddata/datamanagers":"StorSimple Data Managers","microsoft.hybridnetwork/devices":"Azure Network Function Manager  Devices","microsoft.hybridnetwork/networkfunctions":"Azure Network Function Manager  Network Functions","microsoft.importexport/jobs":"Import/export jobs","microsoft.insights/components":"Application Insights","microsoft.insights/datacollectionendpoints":"Data collection endpoints","microsoft.insights/datacollectionrules":"Data collection rules","microsoft.insights/privatelinkscopes":"Azure Monitor Private Link Scopes","microsoft.insights/webtests":"Availability tests","microsoft.insights/workbooks":"Azure Workbooks","microsoft.insights/workbooktemplates":"Azure Workbook Templates","microsoft.iotcentral/iotapps":"IoT Central Applications","microsoft.keyvault/vaults":"Key vaults","microsoft.kubernetes/connectedclusters":"Kubernetes - Azure Arc","microsoft.kusto/clusters":"Azure Data Explorer Clusters","microsoft.kusto/clusters/databases":"Azure Data Explorer Databases","microsoft.labservices/labaccounts":"Lab accounts","microsoft.labservices/labplans":"Lab plans","microsoft.labservices/labs":"Labs","microsoft.loadtestservice/loadtests":"Azure Load Testing","microsoft.logic/integrationaccounts":"Integration accounts","microsoft.logic/integrationserviceenvironments":"Integration Service Environments","microsoft.logic/integrationserviceenvironments/managedapis":"Managed Connector","microsoft.logic/workflows":"Logic apps","microsoft.logz/monitors":"Logz main account","microsoft.logz/monitors/accounts":"Logz sub account","microsoft.logz/monitors/metricssource":"Logz metrics data source","microsoft.machinelearning/commitmentplans":"Machine Learning Studio (classic) web service plans","microsoft.machinelearning/webservices":"Machine Learning Studio (classic) web services","microsoft.machinelearning/workspaces":"Machine Learning Studio (classic) workspaces","microsoft.machinelearningservices/workspaces":"Machine learning","microsoft.machinelearningservices/workspaces/onlineendpoints":"Machine learning online endpoints","microsoft.machinelearningservices/workspaces/onlineendpoints/deployments":"Machine learning online deployments","microsoft.maintenance/maintenanceconfigurations":"Maintenance Configurations","microsoft.managedidentity/userassignedidentities":"Managed Identities","microsoft.maps/accounts":"Azure Maps Accounts","microsoft.maps/accounts/creators":"Azure Maps Creator Resources","microsoft.media/mediaservices":"Media Services","microsoft.media/mediaservices/liveevents":"Live events","microsoft.media/mediaservices/streamingendpoints":"Streaming Endpoints","microsoft.media/videoanalyzers":"Video Analyzers","microsoft.migrate/projects":"Migration projects","microsoft.mixedreality/objectanchorsaccounts":"Object Anchors Accounts","microsoft.mixedreality/objectunderstandingaccounts":"Object Understanding Accounts","microsoft.mixedreality/remoterenderingaccounts":"Remote Rendering Accounts","microsoft.mixedreality/spatialanchorsaccounts":"Spatial Anchors Accounts","microsoft.mobilenetwork/mobilenetworks":"Mobile Networks","microsoft.mobilenetwork/mobilenetworks/datanetworks":"Data Networks","microsoft.mobilenetwork/mobilenetworks/services":"Services","microsoft.mobilenetwork/mobilenetworks/simpolicies":"Sim Policies","microsoft.mobilenetwork/mobilenetworks/sites":"Mobile Network Sites","microsoft.mobilenetwork/mobilenetworks/slices":"Slices","microsoft.mobilenetwork/packetcorecontrolplanes":"Packet Core Control Planes","microsoft.mobilenetwork/packetcorecontrolplanes/packetcoredataplanes":"Packet Core Data Planes","microsoft.mobilenetwork/packetcorecontrolplanes/packetcoredataplanes/attacheddatanetworks":"Attached Data Networks","microsoft.mobilenetwork/sims":"Sims","microsoft.netapp/netappaccounts":"NetApp accounts","microsoft.netapp/netappaccounts/capacitypools":"Capacity pools","microsoft.netapp/netappaccounts/capacitypools/volumes":"Volumes","microsoft.netapp/netappaccounts/capacitypools/volumes/snapshots":"Snapshots","microsoft.netapp/netappaccounts/snapshotpolicies":"Snapshot policies","microsoft.network/applicationgateways":"Application gateways","microsoft.network/applicationgatewaywebapplicationfirewallpolicies":"Application Gateway WAF policies","microsoft.network/applicationsecuritygroups":"Application security groups","microsoft.network/azurefirewalls":"Firewalls","microsoft.network/bastionhosts":"Bastions","microsoft.network/connections":"Connections","microsoft.network/customipprefixes":"Custom IP Prefixes","microsoft.network/ddosprotectionplans":"DDoS protection plans","microsoft.network/dnsforwardingrulesets":"Dns Forwarding Rulesets","microsoft.network/dnsresolvers":"DNS Private Resolvers","microsoft.network/dnszones":"DNS zones","microsoft.network/expressroutecircuits":"ExpressRoute circuits","microsoft.network/expressrouteports":"ExpressRoute Direct","microsoft.network/firewallpolicies":"Firewall Policies","microsoft.network/frontdoors":"Front Doors","microsoft.network/frontdoorwebapplicationfirewallpolicies":"Web Application Firewall policies (WAF)","microsoft.network/ipgroups":"IP Groups","microsoft.network/loadbalancers":"Load balancers","microsoft.network/localnetworkgateways":"Local network gateways","microsoft.network/natgateways":"NAT gateways","microsoft.network/networkexperimentprofiles":"Internet Analyzer profiles","microsoft.network/networkinterfaces":"Network interfaces","microsoft.network/networkmanagers":"Network Managers","microsoft.network/networksecuritygroups":"Network security groups","microsoft.network/networkwatchers":"Network Watchers","microsoft.network/networkwatchers/flowlogs":"NSG Flow Logs","microsoft.network/privatednszones":"Private DNS zones","microsoft.network/privateendpoints":"Private endpoints","microsoft.network/privatelinkservices":"Private link services","microsoft.network/publicipaddresses":"Public IP addresses","microsoft.network/publicipprefixes":"Public IP Prefixes","microsoft.network/routefilters":"Route filters","microsoft.network/routetables":"Route tables","microsoft.network/serviceendpointpolicies":"Service endpoint policies","microsoft.network/trafficmanagerprofiles":"Traffic Manager profiles","microsoft.network/virtualnetworkgateways":"Virtual network gateways","microsoft.network/virtualnetworks":"Virtual networks","microsoft.network/virtualwans":"Virtual WANs","microsoft.notificationhubs/namespaces":"Notification Hub Namespaces","microsoft.notificationhubs/namespaces/notificationhubs":"Notification Hubs","microsoft.openenergyplatform/energyservices":"Project Oak Forest","microsoft.openlogisticsplatform/workspaces":"Open Supply Chain Platform","microsoft.operationalinsights/querypacks":"Log Analytics query packs","microsoft.operationalinsights/workspaces":"Log Analytics workspaces","microsoft.operationsmanagement/solutions":"Solutions","microsoft.orbital/contactprofiles":"Contact Profiles","microsoft.orbital/edgesites":"Edge Sites","microsoft.orbital/groundstations":"Ground Stations","microsoft.orbital/l2connections":"L2 Connections","microsoft.orbital/spacecrafts":"Spacecrafts","microsoft.peering/peerings":"Peerings","microsoft.peering/peeringservices":"Peering Services","microsoft.playfab/playeraccountpools":"PlayFab player account pools","microsoft.playfab/titles":"PlayFab titles","microsoft.portal/dashboards":"Shared dashboards","microsoft.powerbidedicated/capacities":"Power BI Embedded","microsoft.purview/accounts":"Microsoft Purview accounts","microsoft.quantum/workspaces":"Quantum Workspaces","microsoft.recommendationsservice/accounts":"Intelligent Recommendations Accounts","microsoft.recommendationsservice/accounts/modeling":"Modeling","microsoft.recommendationsservice/accounts/serviceendpoints":"Service Endpoints","microsoft.recoveryservices/vaults":"Recovery Services vaults","microsoft.redhatopenshift/openshiftclusters":"Azure Red Hat OpenShift","microsoft.relay/namespaces":"Relays","microsoft.resourceconnector/appliances":"Resource bridges","microsoft.resourcegraph/queries":"Resource Graph queries","microsoft.resources/deploymentscripts":"Deployment Scripts","microsoft.resources/templatespecs":"Template specs","microsoft.saas/applications":"Software as a Service (classic)","microsoft.saas/resources":"SaaS","microsoft.scom/managedinstances":"Aquila Instances","microsoft.scvmm/virtualmachines":"SCVMM virtual machine - Azure Arc","microsoft.scvmm/vmmservers":"SCVMM management servers","microsoft.search/searchservices":"Search services","microsoft.securitydetonation/chambers":"Security Detonation Chambers","microsoft.servicebus/namespaces":"Service Bus Namespaces","microsoft.servicefabric/clusters":"Service Fabric clusters","microsoft.servicefabric/managedclusters":"Service Fabric managed clusters","microsoft.serviceshub/connectors":"Services Hub Connectors","microsoft.signalrservice/signalr":"SignalR","microsoft.signalrservice/webpubsub":"Web PubSub Service","microsoft.solutions/applicationdefinitions":"Service catalog managed application definitions","microsoft.solutions/applications":"Managed applications","microsoft.sql/instancepools":"Instance pools","microsoft.sql/managedinstances":"SQL managed instances","microsoft.sql/managedinstances/databases":"Managed databases","microsoft.sql/servers":"SQL servers","microsoft.sql/servers/databases":"SQL databases","microsoft.sql/servers/elasticpools":"SQL elastic pools","microsoft.sql/servers/jobagents":"Elastic Job agents","microsoft.sql/virtualclusters":"Virtual clusters","microsoft.sqlvirtualmachine/sqlvirtualmachines":"SQL virtual machines","microsoft.storage/storageaccounts":"Storage accounts","microsoft.storagecache/amlfilesystems":"Lustre File Systems","microsoft.storagecache/caches":"HPC caches","microsoft.storagepool/diskpools":"Disk Pools","microsoft.storagesync/storagesyncservices":"Storage Sync Services","microsoft.storagesyncdev/storagesyncservices":"Storage Sync Services","microsoft.storagesyncint/storagesyncservices":"Storage Sync Services","microsoft.storsimple/managers":"StorSimple Device Managers","microsoft.streamanalytics/clusters":"Stream Analytics clusters","microsoft.streamanalytics/streamingjobs":"Stream Analytics jobs","microsoft.synapse/privatelinkhubs":"Azure Synapse Analytics (private link hubs)","microsoft.synapse/workspaces":"Azure Synapse Analytics","microsoft.synapse/workspaces/bigdatapools":"Apache Spark pools","microsoft.synapse/workspaces/kustopools":"Data Explorer pools (preview)","microsoft.synapse/workspaces/sqlpools":"Dedicated SQL pools","microsoft.testbase/testbaseaccounts":"Test Base Accounts","microsoft.testbase/testbaseaccounts/packages":"Test Base Packages","microsoft.timeseriesinsights/environments":"Time Series Insights environments","microsoft.timeseriesinsights/environments/eventsources":"Time Series Insights event sources","microsoft.timeseriesinsights/environments/referencedatasets":"Time Series Insights reference data sets","microsoft.videoindexer/accounts":"Video Analyzer for Media","microsoft.virtualmachineimages/imagetemplates":"Image Templates","microsoft.visualstudio/account":"Azure DevOps organizations","microsoft.visualstudio/account/project":"DevOps Starter","microsoft.vmwarecloudsimple/dedicatedcloudnodes":"CloudSimple Nodes","microsoft.vmwarecloudsimple/dedicatedcloudservices":"CloudSimple Services","microsoft.vmwarecloudsimple/virtualmachines":"CloudSimple Virtual Machines","microsoft.vsonline/plans":"Visual Studio Online Plans","microsoft.web/connectiongateways":"On-premises data gateways","microsoft.web/connections":"API Connections","microsoft.web/containerapps":"Container Apps","microsoft.web/customapis":"Logic Apps Custom Connector","microsoft.web/hostingenvironments":"App Service Environments","microsoft.web/kubeenvironments":"App Service Kubernetes Environments","microsoft.web/serverfarms":"App Service plans","microsoft.web/sites":"App Services","microsoft.web/sites/slots":"App Service (Slots)","microsoft.web/staticsites":"Static Web Apps","microsoft.windowsesu/multipleactivationkeys":"Windows Multiple Activation Keys","microsoft.windowsiot/deviceservices":"Windows 10 IoT Core Services","microsoft.workloads/monitors":"Azure Monitors for SAP Solutions (v2)","microsoft.workloads/phpworkloads":"Scalable WordPress on Linux","microsoft.workloads/sapvirtualinstances":"SAP Virtual Instances","microsoft.workloads/sapvirtualinstances/applicationinstances":"SAP app server instances","microsoft.workloads/sapvirtualinstances/centralinstances":"SAP central server instances","microsoft.workloads/sapvirtualinstances/databaseinstances":"SAP database server instances","nginx.nginxplus/nginxdeployments":"NGINX Deployment","providers.test/statefulibizaengines":"VLCentral Help","wandisco.fusion/fusiongroups":"LiveData Planes","wandisco.fusion/fusiongroups/azurezones":"Azure Zones","wandisco.fusion/fusiongroups/azurezones/plugins":"Plugins","wandisco.fusion/fusiongroups/hivereplicationrules":"Hive Replication Rules","wandisco.fusion/fusiongroups/managedonpremzones":"On-premises Zones","wandisco.fusion/fusiongroups/replicationrules":"Replication Rules","wandisco.fusion/migrators":"LiveData Migrators","wandisco.fusion/migrators/exclusiontemplates":"Exclusions","wandisco.fusion/migrators/livedatamigrations":"Migrations","wandisco.fusion/migrators/metadatamigrations":"Metadata Migrations","wandisco.fusion/migrators/metadatatargets":"Metadata Targets","wandisco.fusion/migrators/pathmappings":"Path Mappings","wandisco.fusion/migrators/targets":"Targets","microsoft.security/insights/classification":"Data Sensitivity Security Insights (Preview)","microsoft.security/locations/alerts":"Security Alerts"};function Vr(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}const Wr=["microsoft.aad/domainservices","microsoft.aadiam/azureadmetrics","microsoft.aadiam/tenants","microsoft.agfoodplatform/farmbeats","microsoft.analysisservices/servers","microsoft.apimanagement/service","microsoft.appconfiguration/configurationstores","microsoft.appplatform/spring","microsoft.attestation/attestationproviders","microsoft.automation/automationaccounts","microsoft.autonomousdevelopmentplatform/accounts","microsoft.autonomousdevelopmentplatform/datapools","microsoft.autonomousdevelopmentplatform/workspaces","microsoft.avs/privateclouds","microsoft.azurestackresourcemonitor/storageaccountmonitor","microsoft.batch/batchaccounts","microsoft.batchai/workspaces","microsoft.blockchain/blockchainmembers","microsoft.blockchain/cordamembers","microsoft.botservice/botservices","microsoft.cache/redis","microsoft.cache/redisenterprise","microsoft.cdn/cdnwebapplicationfirewallpolicies","microsoft.cdn/profiles","microsoft.cdn/profiles/endpoints","microsoft.classiccompute/domainnames","microsoft.classiccompute/virtualmachines","microsoft.classicnetwork/networksecuritygroups","microsoft.classicstorage/storageaccounts","microsoft.cognitiveservices/accounts","microsoft.communication/communicationservices","microsoft.compute/disks","microsoft.compute/virtualmachines","microsoft.compute/virtualmachinescalesets","microsoft.connectedcache/cachenodes","microsoft.connectedvehicle/platformaccounts","microsoft.containerinstance/containergroups","microsoft.containerregistry/registries","microsoft.containerservice/managedclusters","microsoft.customerinsights/hubs","microsoft.customproviders/resourceproviders","microsoft.d365customerinsights/instances","microsoft.dashboard/grafana","microsoft.databoxedge/databoxedgedevices","microsoft.databricks/workspaces","microsoft.datacollaboration/workspaces","microsoft.datafactory/datafactories","microsoft.datafactory/factories","microsoft.datalakeanalytics/accounts","microsoft.datalakestore/accounts","microsoft.datashare/accounts","microsoft.dbformariadb/servers","microsoft.dbformysql/flexibleservers","microsoft.dbformysql/servers","microsoft.dbforpostgresql/flexibleservers","microsoft.dbforpostgresql/servergroupsv2","microsoft.dbforpostgresql/servers","microsoft.dbforpostgresql/serversv2","microsoft.desktopvirtualization/applicationgroups","microsoft.desktopvirtualization/hostpools","microsoft.desktopvirtualization/scalingplans","microsoft.desktopvirtualization/workspaces","microsoft.devices/elasticpools/iothubtenants","microsoft.devices/iothubs","microsoft.devices/provisioningservices","microsoft.digitaltwins/digitaltwinsinstances","microsoft.documentdb/cassandraclusters","microsoft.documentdb/databaseaccounts","microsoft.eventgrid/domains","microsoft.eventgrid/partnernamespaces","microsoft.eventgrid/partnertopics","microsoft.eventgrid/systemtopics","microsoft.eventgrid/topics","microsoft.eventhub/clusters","microsoft.eventhub/namespaces","microsoft.experimentation/experimentworkspaces","microsoft.fabric.admin/fabriclocations","microsoft.hdinsight/clusters","microsoft.healthcareapis/services","microsoft.healthcareapis/workspaces/dicomservices","microsoft.healthcareapis/workspaces/fhirservices","microsoft.insights/autoscalesettings","microsoft.insights/components","microsoft.insights/qos","microsoft.iotcentral/iotapps","microsoft.keyvault/managedhsms","microsoft.keyvault/vaults","microsoft.kubernetes/connectedclusters","microsoft.kusto/clusters","microsoft.loadtestservice/loadtests","microsoft.logic/integrationaccounts","microsoft.logic/integrationserviceenvironments","microsoft.logic/workflows","microsoft.machinelearningservices/workspaces","microsoft.media/mediaservices","microsoft.media/mediaservices/liveevents","microsoft.media/mediaservices/streamingendpoints","microsoft.media/videoanalyzers","microsoft.netapp/netappaccounts/capacitypools","microsoft.netapp/netappaccounts/capacitypools/volumes","microsoft.network/applicationgateways","microsoft.network/azurefirewalls","microsoft.network/bastionhosts","microsoft.network/connections","microsoft.network/dnszones","microsoft.network/expressroutecircuits","microsoft.network/expressroutegateways","microsoft.network/expressrouteports","microsoft.network/frontdoors","microsoft.network/loadbalancers","microsoft.network/natgateways","microsoft.network/networkinterfaces","microsoft.network/networksecuritygroups","microsoft.network/networksecurityperimeters","microsoft.network/networkvirtualappliances","microsoft.network/networkwatchers","microsoft.network/networkwatchers/connectionmonitors","microsoft.network/p2svpngateways","microsoft.network/privateendpoints","microsoft.network/privatelinkservices","microsoft.network/publicipaddresses","microsoft.network/trafficmanagerprofiles","microsoft.network/virtualnetworkgateways","microsoft.network/virtualnetworks","microsoft.network/vpngateways","microsoft.networkfunction/azuretrafficcollectors","microsoft.notificationhubs/namespaces","microsoft.notificationhubs/namespaces/notificationhubs","microsoft.openlogisticsplatform/workspaces","microsoft.operationalinsights/workspaces","microsoft.operationsmanagement/solutions","microsoft.peering/peeringservices","microsoft.powerbi/tenants","microsoft.powerbi/tenants/workspaces","microsoft.powerbidedicated/capacities","microsoft.purview/accounts","microsoft.recoveryservices/vaults","microsoft.relay/namespaces","microsoft.resources/subscriptions","microsoft.resources/subscriptions/resourcegroups","microsoft.search/searchservices","microsoft.security/antimalwaresettings","microsoft.securityinsights/settings","microsoft.servicebus/namespaces","microsoft.signalrservice/signalr","microsoft.signalrservice/webpubsub","microsoft.singularity/accounts","microsoft.sql/managedinstances","microsoft.sql/managedinstances/databases","microsoft.sql/servers/databases","microsoft.sql/servers/elasticpools","microsoft.storage/storageaccounts","microsoft.storage/storageaccounts/blobservices","microsoft.storage/storageaccounts/fileservices","microsoft.storage/storageaccounts/queueservices","microsoft.storage/storageaccounts/tableservices","microsoft.storagecache/caches","microsoft.storagesync/storagesyncservices","microsoft.streamanalytics/streamingjobs","microsoft.synapse/workspaces","microsoft.synapse/workspaces/bigdatapools","microsoft.synapse/workspaces/kustopools","microsoft.synapse/workspaces/scopepools","microsoft.synapse/workspaces/sqlpools","microsoft.timeseriesinsights/environments","microsoft.timeseriesinsights/environments/eventsources","microsoft.videoindexer/accounts","microsoft.vmwarecloudsimple/virtualmachines","microsoft.web/hostingenvironments","microsoft.web/hostingenvironments/workerpools","microsoft.web/serverfarms","microsoft.web/sites","microsoft.web/sites/slots"].map((e=>`"${e}"`)).join(","),$r=["Microsoft.AAD/DomainServices","microsoft.aadiam/azureADMetrics","Microsoft.AnalysisServices/servers","Microsoft.ApiManagement/service","Microsoft.App/containerapps","Microsoft.AppConfiguration/configurationStores","Microsoft.AppPlatform/Spring","Microsoft.Automation/automationAccounts","microsoft.avs/privateClouds","Microsoft.Batch/batchAccounts","Microsoft.BatchAI/workspaces","microsoft.bing/accounts","Microsoft.Blockchain/blockchainMembers","microsoft.botservice/botservices","Microsoft.Cache/redis","Microsoft.Cache/redisEnterprise","Microsoft.Cdn/cdnwebapplicationfirewallpolicies","Microsoft.Cdn/profiles","Microsoft.ClassicCompute/domainNames/slots/roles","Microsoft.ClassicCompute/virtualMachines","Microsoft.ClassicStorage/storageAccounts","Microsoft.ClassicStorage/storageAccounts/blobServices","Microsoft.ClassicStorage/storageAccounts/fileServices","Microsoft.ClassicStorage/storageAccounts/queueServices","Microsoft.ClassicStorage/storageAccounts/tableServices","Microsoft.Cloudtest/hostedpools","Microsoft.Cloudtest/pools","Microsoft.ClusterStor/nodes","Microsoft.CognitiveServices/accounts","Microsoft.Communication/CommunicationServices","Microsoft.Compute/cloudServices","Microsoft.Compute/cloudServices/roles","microsoft.compute/disks","Microsoft.Compute/virtualMachines","Microsoft.Compute/virtualMachineScaleSets","Microsoft.Compute/virtualMachineScaleSets/virtualMachines","Microsoft.ConnectedCache/CacheNodes","Microsoft.ConnectedVehicle/platformAccounts","Microsoft.ContainerInstance/containerGroups","Microsoft.ContainerRegistry/registries","Microsoft.ContainerService/managedClusters","Microsoft.CustomProviders/resourceproviders","Microsoft.DataBoxEdge/dataBoxEdgeDevices","Microsoft.DataCollaboration/workspaces","Microsoft.DataFactory/datafactories","Microsoft.DataFactory/factories","Microsoft.DataLakeAnalytics/accounts","Microsoft.DataLakeStore/accounts","Microsoft.DataProtection/BackupVaults","Microsoft.DataShare/accounts","Microsoft.DBforMariaDB/servers","Microsoft.DBforMySQL/flexibleServers","Microsoft.DBforMySQL/servers","Microsoft.DBforPostgreSQL/flexibleServers","Microsoft.DBForPostgreSQL/serverGroupsv2","Microsoft.DBforPostgreSQL/servers","Microsoft.DBforPostgreSQL/serversv2","Microsoft.Devices/ElasticPools","Microsoft.Devices/ElasticPools/IotHubTenants","Microsoft.Devices/IotHubs","Microsoft.Devices/provisioningServices","Microsoft.DigitalTwins/digitalTwinsInstances","Microsoft.DocumentDB/cassandraClusters","Microsoft.DocumentDB/DatabaseAccounts","microsoft.edgezones/edgezones","Microsoft.EventGrid/domains","Microsoft.EventGrid/eventSubscriptions","Microsoft.EventGrid/extensionTopics","Microsoft.EventGrid/partnerNamespaces","Microsoft.EventGrid/partnerTopics","Microsoft.EventGrid/systemTopics","Microsoft.EventGrid/topics","Microsoft.EventHub/clusters","Microsoft.EventHub/Namespaces","Microsoft.HDInsight/clusters","Microsoft.HealthcareApis/services","Microsoft.HealthcareApis/workspaces/fhirservices","Microsoft.HealthcareApis/workspaces/iotconnectors","microsoft.hybridnetwork/networkfunctions","microsoft.hybridnetwork/virtualnetworkfunctions","microsoft.insights/autoscalesettings","Microsoft.Insights/Components","Microsoft.IoTCentral/IoTApps","microsoft.keyvault/managedhsms","Microsoft.KeyVault/vaults","microsoft.kubernetes/connectedClusters","Microsoft.Kusto/Clusters","Microsoft.Logic/integrationServiceEnvironments","Microsoft.Logic/Workflows","Microsoft.MachineLearningServices/workspaces","Microsoft.Maps/accounts","Microsoft.Media/mediaservices","Microsoft.Media/mediaservices/liveEvents","Microsoft.Media/mediaservices/streamingEndpoints","Microsoft.Media/videoanalyzers","Microsoft.MixedReality/remoteRenderingAccounts","Microsoft.MixedReality/spatialAnchorsAccounts","Microsoft.NetApp/netAppAccounts/capacityPools","Microsoft.NetApp/netAppAccounts/capacityPools/volumes","Microsoft.Network/applicationgateways","Microsoft.Network/azureFirewalls","microsoft.network/bastionHosts","Microsoft.Network/connections","Microsoft.Network/dnsForwardingRulesets","Microsoft.Network/dnsResolvers","Microsoft.Network/dnszones","Microsoft.Network/expressRouteCircuits","Microsoft.Network/expressRouteCircuits/peerings","Microsoft.Network/expressRouteGateways","Microsoft.Network/expressRoutePorts","Microsoft.Network/frontdoors","Microsoft.Network/loadBalancers","Microsoft.Network/natGateways","Microsoft.Network/networkInterfaces","Microsoft.Network/networkWatchers/connectionMonitors","microsoft.network/p2svpngateways","Microsoft.Network/privateDnsZones","Microsoft.Network/privateEndpoints","Microsoft.Network/privateLinkServices","Microsoft.Network/publicIPAddresses","Microsoft.Network/trafficManagerProfiles","Microsoft.Network/virtualHubs","microsoft.network/virtualnetworkgateways","Microsoft.Network/virtualNetworks","Microsoft.Network/virtualRouters","microsoft.network/vpngateways","Microsoft.NotificationHubs/Namespaces/NotificationHubs","Microsoft.OperationalInsights/workspaces","Microsoft.Peering/peerings","Microsoft.Peering/peeringServices","Microsoft.PowerBIDedicated/capacities","microsoft.purview/accounts","Microsoft.RecoveryServices/Vaults","Microsoft.Relay/namespaces","microsoft.resources/subscriptions","Microsoft.Search/searchServices","microsoft.securitydetonation/chambers","Microsoft.ServiceBus/Namespaces","Microsoft.SignalRService/SignalR","Microsoft.SignalRService/WebPubSub","Microsoft.Sql/managedInstances","Microsoft.Sql/servers/databases","Microsoft.Sql/servers/elasticPools","Microsoft.Storage/storageAccounts","Microsoft.Storage/storageAccounts/blobServices","Microsoft.Storage/storageAccounts/fileServices","Microsoft.Storage/storageAccounts/queueServices","Microsoft.Storage/storageAccounts/tableServices","Microsoft.StorageCache/caches","microsoft.storagesync/storageSyncServices","Microsoft.StreamAnalytics/streamingjobs","Microsoft.Synapse/workspaces","Microsoft.Synapse/workspaces/bigDataPools","Microsoft.Synapse/workspaces/kustoPools","Microsoft.Synapse/workspaces/sqlPools","Microsoft.TimeSeriesInsights/environments","Microsoft.TimeSeriesInsights/environments/eventsources","Microsoft.VMwareCloudSimple/virtualMachines","Microsoft.Web/connections","Microsoft.Web/containerapps","Microsoft.Web/hostingEnvironments","Microsoft.Web/hostingEnvironments/multiRolePools","Microsoft.Web/hostingEnvironments/workerPools","Microsoft.Web/serverfarms","Microsoft.Web/sites","Microsoft.Web/sites/slots","Microsoft.Web/staticSites","Wandisco.Fusion/migrators"].map((e=>`"${e.toLocaleLowerCase()}"`)).join(",");class Ur extends o.DataSourceWithBackend{constructor(e){super(e),Vr(this,"resourcePath",void 0),Vr(this,"resultLimit",200),Vr(this,"search",(async(e,r)=>{let t="resources";"logs"===r&&(t+="\n      | union resourcecontainers"),t+=`\n        | where id contains "${e}"\n        ${this.filterByType(r)}\n        | order by tolower(name) asc\n        | limit ${this.resultLimit}\n      `;const{data:s}=await this.makeResourceGraphRequest(t);return s.map((e=>{var r;const t=be(e.id);if(!t||!(t.resourceName||t.resourceGroup||t.subscription))throw new Error("unable to fetch resource details");let s=null!==(r=t.subscription)&&void 0!==r?r:"",o=se.Subscription;return t.resourceName?(s=t.resourceName,o=se.Resource):t.resourceGroup&&(s=t.resourceGroup,o=se.ResourceGroup),{name:e.name,id:s,uri:e.id,resourceGroupName:e.resourceGroup,type:o,typeLabel:Qr[e.type]||e.type,location:Er[e.location]||e.location}}))})),Vr(this,"filterByType",(e=>"logs"===e?`| where type in (${Wr})`:`| where type in (${$r})`)),this.resourcePath=`${g}`}async fetchInitialRows(e,r){const t=await this.getSubscriptions();if(!r)return t;let s=t;if(r.subscription){const t=`/subscriptions/${r.subscription}/resourceGroups/${r.resourceGroup}`;if(r.resourceGroup){const t=await this.getResourceGroupsBySubscriptionId(r.subscription,e);s=Ne(s,`/subscriptions/${r.subscription}`,t)}if(r.resourceName){s=Ne(s,t,await this.getResourcesForResourceGroup(t,e))}}return s}async fetchAndAppendNestedRow(e,r,t){const s=r.type===se.Subscription?await this.getResourceGroupsBySubscriptionId(r.id,t):await this.getResourcesForResourceGroup(r.id,t);return Ne(e,r.uri,s)}async getSubscriptions(){let e,r=[],t=!1;for(;!t;){let s={};e&&(s={$skipToken:e});const o=await this.makeResourceGraphRequest("\n    resources\n    | join kind=inner (\n              ResourceContainers\n                | where type == 'microsoft.resources/subscriptions'\n                | project subscriptionName=name, subscriptionURI=id, subscriptionId\n              ) on subscriptionId\n    | summarize count() by subscriptionName, subscriptionURI, subscriptionId\n    | order by subscriptionName desc\n  ",1,s);if(!o.data.length)throw new Error("No subscriptions were found");r=r.concat(o.data),e=o.$skipToken,t=!e}return r.map((e=>({name:e.subscriptionName,id:e.subscriptionId,uri:`/subscriptions/${e.subscriptionId}`,typeLabel:"Subscription",type:se.Subscription,children:[]})))}async getResourceGroupsBySubscriptionId(e,r){const t=`\n    resources\n     | join kind=inner (\n       ResourceContainers\n       | where type == 'microsoft.resources/subscriptions/resourcegroups'\n       | project resourceGroupURI=id, resourceGroupName=name, resourceGroup, subscriptionId\n     ) on resourceGroup, subscriptionId\n\n     ${this.filterByType(r)}\n     | where subscriptionId == '${e}'\n     | summarize count() by resourceGroupName, resourceGroupURI\n     | order by resourceGroupURI asc`;let s,o=[],i=!1;for(;!i;){let e={};s&&(e={$skipToken:s});const r=await this.makeResourceGraphRequest(t,1,e);o=o.concat(r.data),s=r.$skipToken,i=!s}return o.map((e=>{const r=be(e.resourceGroupURI);if(!r||!r.resourceGroup)throw new Error("unable to fetch resource groups");return{name:e.resourceGroupName,uri:e.resourceGroupURI,id:r.resourceGroup,type:se.ResourceGroup,typeLabel:"Resource Group",children:[]}}))}async getResourcesForResourceGroup(e,r){const{data:t}=await this.makeResourceGraphRequest(`\n      resources\n      | where id hasprefix "${e}"\n      ${this.filterByType(r)} and location in (${Fr})\n    `);return t.map((e=>{const r=be(e.id);if(!r||!r.resourceName)throw new Error("unable to fetch resource details");return{name:e.name,id:r.resourceName,uri:e.id,resourceGroupName:e.resourceGroup,type:se.Resource,typeLabel:Qr[e.type]||e.type,location:Er[e.location]||e.location}}))}async getResourceURIDisplayProperties(e){var r;const{subscription:t,resourceGroup:s,resourceName:o}=null!==(r=ye(e))&&void 0!==r?r:{};if(!t)throw new Error("Invalid resource URI passed");const i=`/subscriptions/${t}`,a=`\n    resourcecontainers\n    | where type == "microsoft.resources/subscriptions"\n    | where id =~ "${i}"\n    | project subscriptionName=name, subscriptionId\n\n    | join kind=leftouter (\n      resourcecontainers            \n            | where type == "microsoft.resources/subscriptions/resourcegroups"\n            | where id =~ "${`${i}/resourceGroups/${s}`}"\n            | project resourceGroupName=name, resourceGroup, subscriptionId\n        ) on subscriptionId\n\n        | join kind=leftouter (\n          resources\n            | where id =~ "${e}"\n            | project resourceName=name, subscriptionId\n        ) on subscriptionId\n\n        | project subscriptionName, resourceGroupName, resourceName\n    `,{data:n}=await this.makeResourceGraphRequest(a);if(!n.length)throw new Error("unable to fetch resource details");const{subscriptionName:c,resourceGroupName:u,resourceName:l}=n[0];return{subscription:c||t,resourceGroup:u||s,resourceName:l||o}}async getResourceURIFromWorkspace(e){const{data:r}=await this.makeResourceGraphRequest(`\n      resources\n      | where properties['customerId'] == "${e}"\n      | project id\n    `);if(!r.length)throw new Error("unable to find resource for workspace "+e);return r[0].id}async makeResourceGraphRequest(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=arguments.length>2?arguments[2]:void 0;try{return await this.postResource(this.resourcePath+"/providers/Microsoft.ResourceGraph/resources?api-version=2021-03-01",{query:e,options:Object.assign({resultFormat:"objectArray"},t)})}catch(t){if(r>0)return this.makeResourceGraphRequest(e,r-1);throw t}}}function Xr(e){var r,t,s,o,i;const a="string"==typeof e.rawQuery?e.rawQuery:null,n="string"==typeof e.workspace?e.workspace:null;if(!a||!n||null!==(r=e.target)&&void 0!==r&&null!==(t=r.azureLogAnalytics)&&void 0!==t&&t.query)return e;const c=Object.assign({},null!==(s=e.target)&&void 0!==s?s:{},{refId:null!==(o=null===(i=e.target)||void 0===i?void 0:i.refId)&&void 0!==o?o:"Anno",queryType:v.LogAnalytics,azureLogAnalytics:{query:a,resource:n}});return Object.assign({},e,{rawQuery:void 0,workspace:void 0,subscription:void 0,queryType:void 0,target:c})}var Br=t(58799);const _r=e=>({subscriptions:e.match(/^Subscriptions\(\)/i),resourceGroups:e.match(/^ResourceGroups\(\)/i),resourceGroupsWithSub:e.match(/^ResourceGroups\(([^\)]+?)(,\s?([^,]+?))?\)/i),namespaces:e.match(/^Namespaces\(([^\)]+?)(,\s?([^,]+?))?\)/i),namespacesWithSub:e.match(/^Namespaces\(([^,]+?),\s?([^,]+?)\)/i),resourceNames:e.match(/^ResourceNames\(([^,]+?),\s?([^,]+?)\)/i),resourceNamesWithSub:e.match(/^ResourceNames\(([^,]+?),\s?([^,]+?),\s?(.+?)\)/i),metricNamespace:e.match(/^MetricNamespace\(([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNamespaceWithSub:e.match(/^metricnamespace\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNames:e.match(/^MetricNames\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNamesWithSub:e.match(/^MetricNames\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?(.+?)\)/i),appInsightsMetricNameQuery:e.match(/^AppInsightsMetricNames\(\)/i),appInsightsGroupByQuery:e.match(/^AppInsightsGroupBys\(([^\)]+?)(,\s?([^,]+?))?\)/i),workspacesQuery:e.match(/^workspaces\(\)/i),workspacesQueryWithSub:e.match(/^workspaces\(["']?([^\)]+?)["']?\)/i)}),Hr=async(e,r)=>"string"!=typeof e?e:(e=>{const r=_r(e);return Object.keys(r).some((e=>!!r[e]))})(e)?((e,r)=>{const t=_r(e),s=r.azureMonitorDatasource.defaultSubscriptionId;return{refId:"A",queryType:v.GrafanaTemplateVariableFn,grafanaTemplateVariableFn:t.appInsightsMetricNameQuery?{rawQuery:e,kind:"AppInsightsMetricNameQuery"}:t.appInsightsGroupByQuery?{kind:"AppInsightsGroupByQuery",rawQuery:e,metricName:t.appInsightsGroupByQuery[1]}:t.subscriptions?{kind:"SubscriptionsQuery",rawQuery:e}:t.resourceGroupsWithSub?{kind:"ResourceGroupsQuery",rawQuery:e,subscription:t.resourceGroupsWithSub[1]}:t.resourceGroups&&s?{kind:"ResourceGroupsQuery",rawQuery:e,subscription:s}:t.namespacesWithSub?{kind:"MetricNamespaceQuery",rawQuery:e,subscription:t.namespacesWithSub[1],resourceGroup:t.namespacesWithSub[2]}:t.namespaces&&s?{kind:"MetricNamespaceQuery",rawQuery:e,subscription:s,resourceGroup:t.namespaces[1]}:t.resourceNamesWithSub?{kind:"ResourceNamesQuery",rawQuery:e,subscription:t.resourceNamesWithSub[1],resourceGroup:t.resourceNamesWithSub[2],metricNamespace:t.resourceNamesWithSub[3]}:t.resourceNames&&s?{kind:"ResourceNamesQuery",rawQuery:e,subscription:s,resourceGroup:t.resourceNames[1],metricNamespace:t.resourceNames[2]}:t.metricNamespaceWithSub?{kind:"MetricNamespaceQuery",rawQuery:e,subscription:t.metricNamespaceWithSub[1],resourceGroup:t.metricNamespaceWithSub[2],metricNamespace:t.metricNamespaceWithSub[3],resourceName:t.metricNamespaceWithSub[4]}:t.metricNamespace&&s?{kind:"MetricNamespaceQuery",rawQuery:e,subscription:s,resourceGroup:t.metricNamespace[1],metricNamespace:t.metricNamespace[2],resourceName:t.metricNamespace[3]}:t.metricNames&&s&&-1===t.metricNames[3].indexOf(",")?{kind:"MetricNamesQuery",rawQuery:e,subscription:s,resourceGroup:t.metricNames[1],metricNamespace:t.metricNames[2],resourceName:t.metricNames[3]}:t.metricNamesWithSub?{kind:"MetricNamesQuery",rawQuery:e,subscription:t.metricNamesWithSub[1],resourceGroup:t.metricNamesWithSub[2],metricNamespace:t.metricNamesWithSub[3],resourceName:t.metricNamesWithSub[4]}:t.workspacesQueryWithSub?{kind:"WorkspacesQuery",rawQuery:e,subscription:(t.workspacesQueryWithSub[1]||"").trim()}:t.workspacesQuery&&s?{kind:"WorkspacesQuery",rawQuery:e,subscription:s}:{kind:"SubscriptionsQuery",rawQuery:e},subscription:s}})(e,r.datasource):(async(e,r)=>{const t=r.azureMonitorDatasource.defaultSubscriptionId;let s="";if(e){const e=r.azureLogAnalyticsDatasource.getDeprecatedDefaultWorkSpace();s=e?we(e)?await r.resourcePickerData.getResourceURIFromWorkspace(e):e:await r.azureLogAnalyticsDatasource.getFirstWorkspace()||""}return{refId:"A",queryType:v.LogAnalytics,azureLogAnalytics:{query:e,resource:s},subscription:t}})(e,r.datasource),Kr=async(e,r)=>{let t=await Hr(e,r);return o.config.featureToggles.azLegacyTemplateVariables||t.queryType!==v.GrafanaTemplateVariableFn||(t=(e=>{const{queryType:r,grafanaTemplateVariableFn:t}=e;if(r!==v.GrafanaTemplateVariableFn||!t)return e;const s=Object.assign({},e);switch("subscription"in t&&(s.subscription=t.subscription),"resourceGroup"in t&&(s.resourceGroup=t.resourceGroup),"metricNamespace"in t&&(s.namespace=t.metricNamespace),"resourceName"in t&&(s.resource=t.resourceName),t.kind){case"SubscriptionsQuery":s.queryType=v.SubscriptionsQuery;break;case"ResourceGroupsQuery":s.queryType=v.ResourceGroupsQuery;break;case"ResourceNamesQuery":s.queryType=v.ResourceNamesQuery;break;case"MetricNamespaceQuery":s.queryType=v.NamespacesQuery;break;case"MetricNamesQuery":s.queryType=v.MetricNamesQuery;break;case"WorkspacesQuery":s.queryType=v.WorkspacesQuery}return s})(t)),t},Jr=e=>{var r;let{query:t,updateQuery:s,datasource:o}=e;const[n,c]=(0,i.useState)("");(0,i.useEffect)((()=>{var e;c((null===(e=t.grafanaTemplateVariableFn)||void 0===e?void 0:e.rawQuery)||"")}),[null===(r=t.grafanaTemplateVariableFn)||void 0===r?void 0:r.rawQuery]);const u=(0,i.useCallback)((e=>{Hr(e,{datasource:o}).then((r=>{r.queryType===v.GrafanaTemplateVariableFn?s(r):s(Object.assign({},t,{grafanaTemplateVariableFn:{kind:"UnknownQuery",rawQuery:e}}))}))}),[o,t,s]);return(0,T.jsx)(a.InlineField,{label:"Grafana template variable function",children:(0,T.jsx)(a.Input,{placeholder:"type a grafana template variable function, ex: Subscriptions()",value:n,onChange:e=>{c(e.target.value)},onBlur:()=>u(n)})})};var Zr,Yr;const et={label:"-",value:""},rt=e=>{const{query:r,onChange:t,datasource:s}=e,o=[{label:"Subscriptions",value:v.SubscriptionsQuery},{label:"Resource Groups",value:v.ResourceGroupsQuery},{label:"Namespaces",value:v.NamespacesQuery},{label:"Resource Names",value:v.ResourceNamesQuery},{label:"Metric Names",value:v.MetricNamesQuery},{label:"Workspaces",value:v.WorkspacesQuery},{label:"Resource Graph",value:v.AzureResourceGraph},{label:"Logs",value:v.LogAnalytics}];"object"==typeof e.query&&e.query.queryType===v.GrafanaTemplateVariableFn&&o.push({label:"Grafana Query Function",value:v.GrafanaTemplateVariableFn});const[c,u]=(0,i.useState)({label:"Template Variables",options:[]}),[l,p]=(0,i.useState)(!1),[m,d]=(0,i.useState)(!1),[f,g]=(0,i.useState)(!1),[h,b]=(0,i.useState)(!1),[y,w]=(0,i.useState)(!1),[S,k]=(0,i.useState)(!1),[N,M]=(0,i.useState)([]),[j,A]=(0,i.useState)([]),[z,x]=(0,i.useState)([]),[C,G]=(0,i.useState)([]),[I,R]=V(),D="string"==typeof r?"":r.queryType;(0,i.useEffect)((()=>{Kr(r,{datasource:s}).then((e=>{t(e)}))}),[r,s,t]),(0,i.useEffect)((()=>{switch(p(!1),d(!1),g(!1),b(!1),w(!1),k(!1),D){case v.ResourceGroupsQuery:case v.WorkspacesQuery:p(!0);break;case v.NamespacesQuery:p(!0),d(!0);break;case v.ResourceNamesQuery:p(!0),d(!0),g(!0);break;case v.MetricNamesQuery:p(!0),b(!0),w(!0),k(!0)}}),[D]),(0,i.useEffect)((()=>{const e=[];s.getVariablesRaw().forEach((r=>{(0,n.get)(r,"query.queryType")!==D&&e.push({label:r.label||r.name,value:`$${r.name}`})})),u({label:"Template Variables",options:e})}),[s,D]),(0,J.Z)((()=>{s.getSubscriptions().then((e=>{M(e.map((e=>({label:e.text,value:e.value}))))}))}));const L="object"==typeof r&&r.subscription;(0,i.useEffect)((()=>{L&&s.getResourceGroups(L).then((e=>{A(e.map((e=>({label:e.text,value:e.value}))))}))}),[s,L]);const O="object"==typeof r&&r.resourceGroup||"";(0,i.useEffect)((()=>{L&&s.getMetricNamespaces(L,O).then((e=>{x(e.map((e=>({label:e.text,value:e.value}))))}))}),[s,L,O]);const q="object"==typeof r&&r.namespace||"";if((0,i.useEffect)((()=>{L&&s.getResourceNames(L,O,q).then((e=>{G(e.map((e=>({label:e.text,value:e.value}))))}))}),[s,L,O,q]),"string"==typeof r)return null;const P=e=>{t(e)};return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(a.InlineField,{label:"Select query type",labelWidth:20,children:(0,T.jsx)(a.Select,{"aria-label":"select query type",onChange:e=>{e.value&&t(Object.assign({},r,{queryType:e.value,subscription:void 0,resourceGroup:void 0,namespace:void 0,resource:void 0}))},options:o,width:25,value:D})}),r.queryType===v.LogAnalytics&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(He,{subscriptionId:r.subscription,query:r,datasource:s,onChange:P,variableOptionGroup:c,setError:R,hideFormatAs:!0}),I&&(0,T.jsxs)(T.Fragment,{children:[Zr||(Zr=(0,T.jsx)(Z,{v:2})),(0,T.jsx)(a.Alert,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor",children:I})]})]}),r.queryType===v.GrafanaTemplateVariableFn&&(0,T.jsx)(Jr,{query:r,updateQuery:e.onChange,datasource:s}),l&&(0,T.jsx)(a.InlineField,{label:"Select subscription",labelWidth:20,children:(0,T.jsx)(a.Select,{"aria-label":"select subscription",onChange:e=>{e.value&&t(Object.assign({},r,{subscription:e.value,resourceGroup:void 0,namespace:void 0,resource:void 0}))},options:N.concat(c),width:25,value:r.subscription||null})}),(h||m)&&(0,T.jsx)(a.InlineField,{label:"Select resource group",labelWidth:20,children:(0,T.jsx)(a.Select,{"aria-label":"select resource group",onChange:e=>{t(Object.assign({},r,{resourceGroup:e.value,namespace:void 0,resource:void 0}))},options:h?j.concat(c):j.concat(c,et),width:25,value:r.resourceGroup||null,placeholder:h?void 0:"Optional"})}),(y||f)&&(0,T.jsx)(a.InlineField,{label:"Select namespace",labelWidth:20,children:(0,T.jsx)(a.Select,{"aria-label":"select namespace",onChange:e=>{t(Object.assign({},r,{namespace:e.value,resource:void 0}))},options:y?z.concat(c):z.concat(c,et),width:25,value:r.namespace||null,placeholder:y?void 0:"Optional"})}),S&&(0,T.jsx)(a.InlineField,{label:"Select resource",labelWidth:20,children:(0,T.jsx)(a.Select,{"aria-label":"select resource",onChange:e=>{t(Object.assign({},r,{resource:e.value}))},options:C.concat(c),width:25,value:r.resource||null})}),r.queryType===v.AzureResourceGraph&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(H,{subscriptionId:s.azureLogAnalyticsDatasource.defaultSubscriptionId,query:r,datasource:s,onChange:P,variableOptionGroup:c,setError:R}),I&&(0,T.jsxs)(T.Fragment,{children:[Yr||(Yr=(0,T.jsx)(Z,{v:2})),(0,T.jsx)(a.Alert,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor",children:I})]})]})]})};class tt extends s.CustomVariableSupport{constructor(e){var r,t,s;super(),s=rt,(t="editor")in(r=this)?Object.defineProperty(r,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[t]=s,this.datasource=e,this.datasource=e,this.query=this.query.bind(this)}query(e){return(0,jr.D)((async()=>{const r=await Kr(e.targets[0],{datasource:this.datasource});try{switch(r.queryType){case v.SubscriptionsQuery:const t=await this.datasource.getSubscriptions();return{data:null!=t&&t.length?[(0,s.toDataFrame)(t)]:[]};case v.ResourceGroupsQuery:if(r.subscription){const e=await this.datasource.getResourceGroups(r.subscription);return{data:null!=e&&e.length?[(0,s.toDataFrame)(e)]:[]}}case v.NamespacesQuery:if(r.subscription){const e=await this.datasource.getMetricNamespaces(r.subscription,r.resourceGroup);return{data:null!=e&&e.length?[(0,s.toDataFrame)(e)]:[]}}case v.ResourceNamesQuery:if(r.subscription){const e=await this.datasource.getResourceNames(r.subscription,r.resourceGroup,r.namespace);return{data:null!=e&&e.length?[(0,s.toDataFrame)(e)]:[]}}case v.MetricNamesQuery:if(r.subscription&&r.resourceGroup&&r.namespace&&r.resource){const e=await this.datasource.getMetricNames(r.subscription,r.resourceGroup,r.namespace,r.resource);return{data:null!=e&&e.length?[(0,s.toDataFrame)(e)]:[]}}case v.WorkspacesQuery:if(r.subscription){const e=await this.datasource.getAzureLogAnalyticsWorkspaces(r.subscription);return{data:null!=e&&e.length?[(0,s.toDataFrame)(e)]:[]}}case v.GrafanaTemplateVariableFn:if(r.grafanaTemplateVariableFn){const e=await this.callGrafanaTemplateVariableFn(r.grafanaTemplateVariableFn);return{data:null!=e&&e.length?[(0,s.toDataFrame)(e)]:[]}}default:e.targets[0]=r;return{data:(await(0,Br.n)(this.datasource.query(e))).data}}}catch(e){return{data:[],error:new Error((0,Q.Z)(e))}}})())}callGrafanaTemplateVariableFn(e){return"SubscriptionsQuery"===e.kind?this.datasource.getSubscriptions():"ResourceGroupsQuery"===e.kind?this.datasource.getResourceGroups(this.replaceVariable(e.subscription)):"ResourceNamesQuery"===e.kind?this.datasource.getResourceNames(this.replaceVariable(e.subscription),this.replaceVariable(e.resourceGroup),this.replaceVariable(e.metricNamespace)):"MetricNamespaceQuery"===e.kind?this.datasource.azureMonitorDatasource.getMetricNamespaces(e,!0):"MetricNamesQuery"===e.kind?this.datasource.azureMonitorDatasource.getMetricNames(e):"WorkspacesQuery"===e.kind?this.datasource.azureLogAnalyticsDatasource.getWorkspaces(this.replaceVariable(e.subscription)):null}replaceVariable(e){return(0,o.getTemplateSrv)().replace((e||"").trim())}}function st(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}class ot extends o.DataSourceWithBackend{constructor(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,Mr.J)();super(e),st(this,"annotations",{prepareAnnotation:Xr}),st(this,"azureMonitorDatasource",void 0),st(this,"azureLogAnalyticsDatasource",void 0),st(this,"resourcePickerData",void 0),st(this,"azureResourceGraphDatasource",void 0),st(this,"pseudoDatasource",{}),this.templateSrv=r,this.azureMonitorDatasource=new Or(e),this.azureLogAnalyticsDatasource=new Tr(e),this.azureResourceGraphDatasource=new qr(e),this.resourcePickerData=new Ur(e),this.pseudoDatasource={[v.AzureMonitor]:this.azureMonitorDatasource,[v.LogAnalytics]:this.azureLogAnalyticsDatasource,[v.AzureResourceGraph]:this.azureResourceGraphDatasource},this.variables=new tt(this)}filterQuery(e){var r,t;if(!e.queryType)return!0;const s=this.pseudoDatasource[e.queryType];return null===(r=null==s||null===(t=s.filterQuery)||void 0===t?void 0:t.call(s,e))||void 0===r||r}query(e){const r=new Map;for(const t of e.targets){const s=fr(t);if(!s.queryType||s.hide||!it(s))continue;if(!r.has(s.queryType)){const t=(0,n.cloneDeep)(e);t.requestId=`${t.requestId}-${s.refId}`,t.targets=[],r.set(s.queryType,t)}const o=r.get(s.queryType);null==o||o.targets.push(s)}const t=Array.from(r.entries()).map((e=>{let[r,t]=e;const s=this.pseudoDatasource[r];if(!s)throw new Error("Data source not created for query type "+r);return s.query(t)}));return 1===t.length?t[0]:t.length>1?(0,Sr.D)(t).pipe((0,Nr.U)((e=>{const r=[];for(const t of e)for(const e of t.data)r.push(e);return{state:s.LoadingState.Done,data:r}}))):(0,kr.of)({state:s.LoadingState.Done,data:[]})}targetContainsTemplate(e){if(e.subscription&&this.templateSrv.containsTemplate(e.subscription))return!0;let r;return e.queryType===v.AzureMonitor?r=JSON.stringify(e.azureMonitor):e.queryType===v.LogAnalytics?r=JSON.stringify(e.azureLogAnalytics):e.queryType===v.AzureResourceGraph&&(r=JSON.stringify([e.azureResourceGraph,e.subscriptions])),!!r&&this.templateSrv.containsTemplate(r)}async annotationQuery(e){return this.azureLogAnalyticsDatasource.annotationQuery(e)}getResourceGroups(e){return this.azureMonitorDatasource.getResourceGroups(this.templateSrv.replace(e))}getMetricNamespaces(e,r){let t=`/subscriptions/${e}`;return r&&(t+=`/resourceGroups/${r};`),this.azureMonitorDatasource.getMetricNamespaces({resourceUri:t},!0)}getResourceNames(e,r,t){return this.azureMonitorDatasource.getResourceNames(this.templateSrv.replace(e),this.templateSrv.replace(r),this.templateSrv.replace(t))}getMetricNames(e,r,t,s){return this.azureMonitorDatasource.getMetricNames({subscription:e,resourceGroup:r,metricNamespace:t,resourceName:s})}getAzureLogAnalyticsWorkspaces(e){return this.azureLogAnalyticsDatasource.getWorkspaces(e)}getSubscriptions(){return this.azureMonitorDatasource.getSubscriptions()}interpolateVariablesInQueries(e,r){return e.map((e=>{var t;if(!e.queryType)return e;const s=this.pseudoDatasource[e.queryType];return Object.assign({datasource:null==s?void 0:s.getRef()},null!==(t=null==s?void 0:s.applyTemplateVariables(e,r))&&void 0!==t?t:e)}))}getVariables(){return this.templateSrv.getVariables().map((e=>`$${e.name}`))}getVariablesRaw(){return this.templateSrv.getVariables()}}function it(e){switch(e.queryType){case v.AzureMonitor:return!!e.azureMonitor;case v.LogAnalytics:return!!e.azureLogAnalytics;case v.AzureResourceGraph:return!!e.azureResourceGraph;case v.GrafanaTemplateVariableFn:return!!e.grafanaTemplateVariableFn;default:return!1}}var at=t(14285);const nt=new s.DataSourcePlugin(ot).setConfigEditor(E).setQueryEditor(wr);(0,o.getAppEvents)().subscribe(s.DashboardLoadedEvent,(e=>{let{payload:{dashboardId:r,orgId:t,userId:s,grafanaVersion:i,queries:a}}=e;const n=a[at.id];let c={[v.AzureMonitor]:{hidden:0,visible:0},[v.LogAnalytics]:{hidden:0,visible:0},[v.AzureResourceGraph]:{hidden:0,visible:0}};var u;n.forEach((e=>{e.queryType!==v.AzureMonitor&&e.queryType!==v.LogAnalytics&&e.queryType!==v.AzureResourceGraph||c[e.queryType][e.hide?"hidden":"visible"]++})),n&&n.length>0&&(u={grafana_version:i,dashboard_id:r,org_id:t,azure_monitor_queries:c[v.AzureMonitor].visible,azure_log_analytics_queries:c[v.LogAnalytics].visible,azure_resource_graph_queries:c[v.AzureResourceGraph].visible,azure_monitor_queries_hidden:c[v.AzureMonitor].hidden,azure_log_analytics_queries_hidden:c[v.LogAnalytics].hidden,azure_resource_graph_queries_hidden:c[v.AzureResourceGraph].hidden},(0,o.reportInteraction)("grafana_ds_azuremonitor_dashboard_loaded",u))}))},28953:(e,r,t)=>{function s(e){for(var r=arguments.length,t=Array(r>1?r-1:0),s=1;s<r;s++)t[s-1]=arguments[s];throw Error("[Immer] minified error nr: "+e+(t.length?" "+t.map((function(e){return"'"+e+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function o(e){return!!e&&!!e[U]}function i(e){return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var r=Object.getPrototypeOf(e);if(null===r)return!0;var t=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return t===Object||"function"==typeof t&&Function.toString.call(t)===X}(e)||Array.isArray(e)||!!e[$]||!!e.constructor[$]||m(e)||d(e))}function a(e,r,t){void 0===t&&(t=!1),0===n(e)?(t?Object.keys:B)(e).forEach((function(s){t&&"symbol"==typeof s||r(s,e[s],e)})):e.forEach((function(t,s){return r(s,t,e)}))}function n(e){var r=e[U];return r?r.i>3?r.i-4:r.i:Array.isArray(e)?1:m(e)?2:d(e)?3:0}function c(e,r){return 2===n(e)?e.has(r):Object.prototype.hasOwnProperty.call(e,r)}function u(e,r){return 2===n(e)?e.get(r):e[r]}function l(e,r,t){var s=n(e);2===s?e.set(r,t):3===s?(e.delete(r),e.add(t)):e[r]=t}function p(e,r){return e===r?0!==e||1/e==1/r:e!=e&&r!=r}function m(e){return E&&e instanceof Map}function d(e){return Q&&e instanceof Set}function f(e){return e.o||e.t}function g(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var r=_(e);delete r[U];for(var t=B(r),s=0;s<t.length;s++){var o=t[s],i=r[o];!1===i.writable&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(r[o]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[o]})}return Object.create(Object.getPrototypeOf(e),r)}function h(e,r){return void 0===r&&(r=!1),b(e)||o(e)||!i(e)||(n(e)>1&&(e.set=e.add=e.clear=e.delete=v),Object.freeze(e),r&&a(e,(function(e,r){return h(r,!0)}),!0)),e}function v(){s(2)}function b(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function y(e){var r=H[e];return r||s(18,e),r}function w(){return P}function S(e,r){r&&(y("Patches"),e.u=[],e.s=[],e.v=r)}function k(e){N(e),e.p.forEach(j),e.p=null}function N(e){e===P&&(P=e.l)}function M(e){return P={p:[],l:P,h:e,m:!0,_:0}}function j(e){var r=e[U];0===r.i||1===r.i?r.j():r.O=!0}function A(e,r){r._=r.p.length;var t=r.p[0],o=void 0!==e&&e!==t;return r.h.g||y("ES5").S(r,e,o),o?(t[U].P&&(k(r),s(4)),i(e)&&(e=z(r,e),r.l||C(r,e)),r.u&&y("Patches").M(t[U].t,e,r.u,r.s)):e=z(r,t,[]),k(r),r.u&&r.v(r.u,r.s),e!==W?e:void 0}function z(e,r,t){if(b(r))return r;var s=r[U];if(!s)return a(r,(function(o,i){return x(e,s,r,o,i,t)}),!0),r;if(s.A!==e)return r;if(!s.P)return C(e,s.t,!0),s.t;if(!s.I){s.I=!0,s.A._--;var o=4===s.i||5===s.i?s.o=g(s.k):s.o;a(3===s.i?new Set(o):o,(function(r,i){return x(e,s,o,r,i,t)})),C(e,o,!1),t&&e.u&&y("Patches").R(s,t,e.u,e.s)}return s.o}function x(e,r,t,s,a,n){if(o(a)){var u=z(e,a,n&&r&&3!==r.i&&!c(r.D,s)?n.concat(s):void 0);if(l(t,s,u),!o(u))return;e.m=!1}if(i(a)&&!b(a)){if(!e.h.F&&e._<1)return;z(e,a),r&&r.A.l||C(e,a)}}function C(e,r,t){void 0===t&&(t=!1),e.h.F&&e.m&&h(r,t)}function G(e,r){var t=e[U];return(t?f(t):e)[r]}function I(e,r){if(r in e)for(var t=Object.getPrototypeOf(e);t;){var s=Object.getOwnPropertyDescriptor(t,r);if(s)return s;t=Object.getPrototypeOf(t)}}function T(e){e.P||(e.P=!0,e.l&&T(e.l))}function R(e){e.o||(e.o=g(e.t))}function D(e,r,t){var s=m(r)?y("MapSet").N(r,t):d(r)?y("MapSet").T(r,t):e.g?function(e,r){var t=Array.isArray(e),s={i:t?1:0,A:r?r.A:w(),P:!1,I:!1,D:{},l:r,t:e,k:null,o:null,j:null,C:!1},o=s,i=K;t&&(o=[s],i=J);var a=Proxy.revocable(o,i),n=a.revoke,c=a.proxy;return s.k=c,s.j=n,c}(r,t):y("ES5").J(r,t);return(t?t.A:w()).p.push(s),s}function L(e){return o(e)||s(22,e),function e(r){if(!i(r))return r;var t,s=r[U],o=n(r);if(s){if(!s.P&&(s.i<4||!y("ES5").K(s)))return s.t;s.I=!0,t=O(r,o),s.I=!1}else t=O(r,o);return a(t,(function(r,o){s&&u(s.t,r)===o||l(t,r,e(o))})),3===o?new Set(t):t}(e)}function O(e,r){switch(r){case 2:return new Map(e);case 3:return Array.from(e)}return g(e)}t.d(r,{ZP:()=>re});var q,P,F="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),E="undefined"!=typeof Map,Q="undefined"!=typeof Set,V="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,W=F?Symbol.for("immer-nothing"):((q={})["immer-nothing"]=!0,q),$=F?Symbol.for("immer-draftable"):"__$immer_draftable",U=F?Symbol.for("immer-state"):"__$immer_state",X=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),B="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,_=Object.getOwnPropertyDescriptors||function(e){var r={};return B(e).forEach((function(t){r[t]=Object.getOwnPropertyDescriptor(e,t)})),r},H={},K={get:function(e,r){if(r===U)return e;var t=f(e);if(!c(t,r))return function(e,r,t){var s,o=I(r,t);return o?"value"in o?o.value:null===(s=o.get)||void 0===s?void 0:s.call(e.k):void 0}(e,t,r);var s=t[r];return e.I||!i(s)?s:s===G(e.t,r)?(R(e),e.o[r]=D(e.A.h,s,e)):s},has:function(e,r){return r in f(e)},ownKeys:function(e){return Reflect.ownKeys(f(e))},set:function(e,r,t){var s=I(f(e),r);if(null==s?void 0:s.set)return s.set.call(e.k,t),!0;if(!e.P){var o=G(f(e),r),i=null==o?void 0:o[U];if(i&&i.t===t)return e.o[r]=t,e.D[r]=!1,!0;if(p(t,o)&&(void 0!==t||c(e.t,r)))return!0;R(e),T(e)}return e.o[r]===t&&"number"!=typeof t&&(void 0!==t||r in e.o)||(e.o[r]=t,e.D[r]=!0,!0)},deleteProperty:function(e,r){return void 0!==G(e.t,r)||r in e.t?(e.D[r]=!1,R(e),T(e)):delete e.D[r],e.o&&delete e.o[r],!0},getOwnPropertyDescriptor:function(e,r){var t=f(e),s=Reflect.getOwnPropertyDescriptor(t,r);return s?{writable:!0,configurable:1!==e.i||"length"!==r,enumerable:s.enumerable,value:t[r]}:s},defineProperty:function(){s(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){s(12)}},J={};a(K,(function(e,r){J[e]=function(){return arguments[0]=arguments[0][0],r.apply(this,arguments)}})),J.deleteProperty=function(e,r){return J.set.call(this,e,r,void 0)},J.set=function(e,r,t){return K.set.call(this,e[0],r,t,e[0])};var Z=function(){function e(e){var r=this;this.g=V,this.F=!0,this.produce=function(e,t,o){if("function"==typeof e&&"function"!=typeof t){var a=t;t=e;var n=r;return function(e){var r=this;void 0===e&&(e=a);for(var s=arguments.length,o=Array(s>1?s-1:0),i=1;i<s;i++)o[i-1]=arguments[i];return n.produce(e,(function(e){var s;return(s=t).call.apply(s,[r,e].concat(o))}))}}var c;if("function"!=typeof t&&s(6),void 0!==o&&"function"!=typeof o&&s(7),i(e)){var u=M(r),l=D(r,e,void 0),p=!0;try{c=t(l),p=!1}finally{p?k(u):N(u)}return"undefined"!=typeof Promise&&c instanceof Promise?c.then((function(e){return S(u,o),A(e,u)}),(function(e){throw k(u),e})):(S(u,o),A(c,u))}if(!e||"object"!=typeof e){if(void 0===(c=t(e))&&(c=e),c===W&&(c=void 0),r.F&&h(c,!0),o){var m=[],d=[];y("Patches").M(e,c,m,d),o(m,d)}return c}s(21,e)},this.produceWithPatches=function(e,t){if("function"==typeof e)return function(t){for(var s=arguments.length,o=Array(s>1?s-1:0),i=1;i<s;i++)o[i-1]=arguments[i];return r.produceWithPatches(t,(function(r){return e.apply(void 0,[r].concat(o))}))};var s,o,i=r.produce(e,t,(function(e,r){s=e,o=r}));return"undefined"!=typeof Promise&&i instanceof Promise?i.then((function(e){return[e,s,o]})):[i,s,o]},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var r=e.prototype;return r.createDraft=function(e){i(e)||s(8),o(e)&&(e=L(e));var r=M(this),t=D(this,e,void 0);return t[U].C=!0,N(r),t},r.finishDraft=function(e,r){var t=(e&&e[U]).A;return S(t,r),A(void 0,t)},r.setAutoFreeze=function(e){this.F=e},r.setUseProxies=function(e){e&&!V&&s(20),this.g=e},r.applyPatches=function(e,r){var t;for(t=r.length-1;t>=0;t--){var s=r[t];if(0===s.path.length&&"replace"===s.op){e=s.value;break}}t>-1&&(r=r.slice(t+1));var i=y("Patches").$;return o(e)?i(e,r):this.produce(e,(function(e){return i(e,r)}))},e}(),Y=new Z,ee=Y.produce;Y.produceWithPatches.bind(Y),Y.setAutoFreeze.bind(Y),Y.setUseProxies.bind(Y),Y.applyPatches.bind(Y),Y.createDraft.bind(Y),Y.finishDraft.bind(Y);const re=ee}}]);
//# sourceMappingURL=6350.90c71b8d61408b1e0ace.js.map