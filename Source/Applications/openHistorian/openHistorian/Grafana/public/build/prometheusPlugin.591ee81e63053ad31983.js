(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{EaOu:function(e,t,r){"use strict";r.r(t);var n=r("Obii"),a=r("t8hP"),o=r("m257"),i=r("NPB1"),u=r("5kRJ"),s=r("BkRI"),c=r.n(s),l=r("la6v"),f=r.n(l),p=r("HyWp"),m=r.n(p),h=r("F/XL"),d=r("y3By"),g=r("p0ib"),v=r("VNr4"),y=r("XlPw"),b=r("xMyE"),O=r("VnD/"),w=r("67Y/"),x=r("9Z1F"),j=r("eqT+"),E=r("LvDl"),P=r.n(E),S=r("ceQ3"),_=r("itod");function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function T(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function I(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function R(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){I(o,n,a,i,u,"next",e)}function u(e){I(o,n,a,i,u,"throw",e)}i(void 0)}))}}function q(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach((function(t){M(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function M(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var F=["job","instance"],N=function(e){return{label:e}},V=function(e){return e.kind="function",e};var U=/(="|!="|=~"|!~"|\{|\[|\(|\+|-|\/|\*|%|\^|\band\b|\bor\b|\bunless\b|==|>=|!=|<=|>|<|=|~|,)/,H=function(e){function t(e,r){var a,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,i=C(t).call(this),(a=!i||"object"!==k(i)&&"function"!=typeof i?D(o):i).labelsCache=new m.a(10),a.request=function(){var e=R(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.datasource.metadataRequest(t);case 3:return n=e.sent,e.abrupt("return",n.data.data);case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),a.start=R(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.datasource.lookupsDisabled){e.next=2;break}return e.abrupt("return",[]);case 2:return t=a.datasource.getTimeRange(),r=new URLSearchParams({start:t.start.toString(),end:t.end.toString()}),n="/api/v1/label/__name__/values?".concat(r.toString()),e.next=7,a.request(n,[]);case 7:return a.metrics=e.sent,a.lookupsDisabled=a.metrics.length>a.lookupMetricsThreshold,e.t0=S.b,e.next=12,a.request("/api/v1/metadata",{});case 12:return e.t1=e.sent,a.metricsMetadata=(0,e.t0)(e.t1),a.processHistogramMetrics(a.metrics),e.abrupt("return",[]);case 16:case"end":return e.stop()}}),e)}))),a.processHistogramMetrics=function(e){var t=Object(S.e)(e).values;t&&t.__name__&&(a.histogramMetrics=t.__name__.slice().sort())},a.provideCompletionItems=function(){var e=R(regeneratorRuntime.mark((function e(t){var r,n,o,i,u,s,c,l,f,p,m,h,d,g,v,y,b,O=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.prefix,n=t.text,o=t.value,i=t.labelKey,u=t.wrapperClasses,s=O.length>1&&void 0!==O[1]?O[1]:{history:[]},c={suggestions:[]},o){e.next=5;break}return e.abrupt("return",c);case 5:if(l=0===o.document.text.length,f=o.document.getTextsAtRange(o.selection),p=1===f.size?f.first().getText():null,m=p?p[o.selection.anchor.offset]:null,h=u.length>3,d=r&&!h,g=!m||")"===m,v=r&&!n.match(/^[\]})\s]+$/)&&g,y=/[+\-*/^%]/,b=n.match(y),!u.includes("context-range")){e.next=19;break}return e.abrupt("return",a.getRangeCompletionItems());case 19:if(!u.includes("context-labels")){e.next=23;break}return e.abrupt("return",a.getLabelCompletionItems({prefix:r,text:n,value:o,labelKey:i,wrapperClasses:u}));case 23:if(!u.includes("context-aggregation")){e.next=27;break}return e.abrupt("return",a.getAggregationCompletionItems(o));case 27:if(!l){e.next=31;break}return e.abrupt("return",a.getEmptyCompletionItems(s));case 31:if(!d||!g||b){e.next=35;break}return e.abrupt("return",a.getBeginningCompletionItems(s));case 35:if(!d||!v){e.next=37;break}return e.abrupt("return",a.getTermCompletionItems());case 37:return e.abrupt("return",c);case 38:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.getBeginningCompletionItems=function(e){return{suggestions:[].concat(T(a.getEmptyCompletionItems(e).suggestions),T(a.getTermCompletionItems().suggestions))}},a.getEmptyCompletionItems=function(e){var t=e.history,r=[];if(t&&t.length){var a=P.a.chain(t).map((function(e){return e.query.expr})).filter().uniq().take(5).map(N).map((function(e){return function(e,t){var r=Date.now()-864e5,a=t.filter((function(t){return t.ts>r&&t.query===e.label})),o=a.length,i=a[0],u="Queried ".concat(o," times in the last 24h.");if(i){var s=Object(n.dateTime)(i.ts).fromNow();u="".concat(u," Last queried ").concat(s,".")}return Q({},e,{documentation:u})}(e,t)})).value();r.push({prefixMatch:!0,skipSort:!0,label:"History",items:a})}return{suggestions:r}},a.getTermCompletionItems=function(){var e=D(a),t=e.metrics,r=e.metricsMetadata,n=[];return n.push({prefixMatch:!0,label:"Functions",items:_.a.map(V)}),t&&t.length&&n.push({label:"Metrics",items:t.map((function(e){return function(e,t){var r={label:e};if(t&&t[e]){var n=t[e][0],a=n.type,o=n.help;r.documentation="".concat(a.toUpperCase(),": ").concat(o)}return r}(e,r)}))}),{suggestions:n}},a.getAggregationCompletionItems=function(){var e=R(regeneratorRuntime.mark((function e(t){var r,n,o,i,u,s,c,l,f,p,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],o=t.document.getBlocks().reduce((function(e,r){if(!r)return e;var a=null==r?void 0:r.getText();return t.anchorBlock.key===r.key&&(n=t.selection.anchor.offset+e.length),e+a}),""),i=o.lastIndexOf("(",n),u=o.lastIndexOf("(",i-1),s=o.indexOf(")",u),-1===u&&(c=o.indexOf(")",n),s=o.indexOf(")",c+1),u=o.lastIndexOf("(",s)),l={suggestions:r,context:"context-aggregation"},-1!==u){e.next=9;break}return e.abrupt("return",l);case 9:return f=o.slice(u+1,s).replace(/\[[^\]]+\]$/,""),p=Object(S.d)(f,f.length-2).selector,e.next=13,a.getLabelValues(p);case 13:return(m=e.sent)&&r.push({label:"Labels",items:Object.keys(m).map(N)}),e.abrupt("return",l);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.getLabelCompletionItems=function(){var e=R(regeneratorRuntime.mark((function e(t){var r,n,o,i,u,s,c,l,f,p,m,h,d,g,v,y,b,O,w,x,j,E,_;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.text,n=t.wrapperClasses,o=t.labelKey,i=t.value){e.next=3;break}return e.abrupt("return",{suggestions:[]});case 3:if(u=[],s=i.anchorBlock.getText(),c=i.selection.anchor.offset,l=s.substr(c),f=s.substr(0,c),p=r.match(/^(=|=~|!=|!~)/),m=l.match(/^"?[,}]/),h=f.match(/(=|=~|!=|!~)$/)&&l.match(/^"/),d=m&&!p,(p&&m||d)&&!h){e.next=15;break}return e.abrupt("return",{suggestions:u});case 15:try{v=Object(S.d)(s,c),g=v.selector}catch(e){g="{}"}if(y=g.includes("__name__="),b=v?v.labelKeys:[],!g){e.next=22;break}return e.next=21,a.getLabelValues(g,!y);case 21:O=e.sent;case 22:if(O){e.next=25;break}return console.warn("Server did not return any values for selector = ".concat(g)),e.abrupt("return",{suggestions:u});case 25:return r&&p||n.includes("attr-value")?o&&O[o]&&(w="context-label-values",u.push({label:'Label values for "'.concat(o,'"'),items:O[o].map(N)})):(x=O?Object.keys(O):y?null:F)&&(j=P.a.difference(x,b)).length&&(w="context-labels",E=j.map((function(e){return{label:e}})),_={label:"Labels",items:E},u.push(_)),e.abrupt("return",{context:w,suggestions:u});case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.fetchLabelValues=function(){var e=R(regeneratorRuntime.mark((function e(t){var r,n,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.datasource.getTimeRange(),n=new URLSearchParams({start:r.start.toString(),end:r.end.toString()}),o="/api/v1/label/".concat(t,"/values?").concat(n.toString()),e.next=5,a.request(o,[]);case 5:return i=e.sent,e.abrupt("return",M({},t,i));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.fetchSeriesLabels=function(){var e=R(regeneratorRuntime.mark((function e(t,r){var n,o,i,u,s,c,l,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.datasource.getTimeRange(),o=new URLSearchParams({"match[]":t,start:n.start.toString(),end:n.end.toString()}),i="/api/v1/series?".concat(o.toString()),o.set("start",a.roundToMinutes(n.start).toString()),o.set("end",a.roundToMinutes(n.end).toString()),o.append("withName",r?"true":"false"),u="/api/v1/series?".concat(o.toString()),s=a.labelsCache.get(u)){e.next=15;break}return e.next=11,a.request(i,[]);case 11:c=e.sent,l=Object(S.f)(c,r),f=l.values,s=f,a.labelsCache.set(u,s);case 15:return e.abrupt("return",s);case 16:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),a.fetchDefaultLabels=P.a.once(R(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(F.map((function(e){return a.fetchLabelValues(e)})));case 2:return t=e.sent,e.abrupt("return",t.reduce((function(e,t){return Q({},e,{},t)}),{}));case 4:case"end":return e.stop()}}),e)})))),a.datasource=e,a.histogramMetrics=[],a.timeRange={start:0,end:0},a.metrics=[],a.lookupMetricsThreshold=1e4,a.lookupsDisabled=!0,Object.assign(D(a),r),a}var r,a,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(t,e),r=t,(a=[{key:"cleanText",value:function(e){return e.split(U).pop().trimLeft().replace(/"$/,"").replace(/^"/,"")}},{key:"getRangeCompletionItems",value:function(){return{context:"context-range",suggestions:[{label:"Range vector",items:T(_.b)}]}}},{key:"getLabelValues",value:(i=R(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.lookupsDisabled){e.next=2;break}return e.abrupt("return",void 0);case 2:if(e.prev=2,"{}"!==t){e.next=9;break}return e.next=6,this.fetchDefaultLabels();case 6:return e.abrupt("return",e.sent);case 9:return e.next=11,this.fetchSeriesLabels(t,r);case 11:return e.abrupt("return",e.sent);case 12:e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(2),console.error(e.t0),e.abrupt("return",void 0);case 18:case"end":return e.stop()}}),e,this,[[2,14]])}))),function(e,t){return i.apply(this,arguments)})},{key:"roundToMinutes",value:function(e){return Math.floor(e/60)}},{key:"syntax",get:function(){return _.c}}])&&q(r.prototype,a),o&&q(r,o),t}(n.LanguageProvider);function B(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var $=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.datasource=t,this.query=r,this.datasource=t,this.query=r,this.range=Object(i.a)().timeRange()}var t,r,n;return t=e,(r=[{key:"process",value:function(){if(this.query.match(/^label_names\(\)\s*$/))return this.labelNamesQuery();var e=this.query.match(/^label_values\((?:(.+),\s*)?([a-zA-Z_][a-zA-Z0-9_]*)\)\s*$/);if(e)return e[1]?this.labelValuesQuery(e[2],e[1]):this.labelValuesQuery(e[2]);var t=this.query.match(/^metrics\((.+)\)\s*$/);if(t)return this.metricNameQuery(t[1]);var r=this.query.match(/^query_result\((.+)\)\s*$/);return r?this.queryResultQuery(r[1]).toPromise():this.metricNameAndLabelsQuery(this.query)}},{key:"labelNamesQuery",value:function(){var e=this.datasource.getPrometheusTime(this.range.from,!1),t=this.datasource.getPrometheusTime(this.range.to,!0),r=new URLSearchParams({start:e.toString(),end:t.toString()}),n="/api/v1/labels?".concat(r.toString());return this.datasource.metadataRequest(n).then((function(e){return P.a.map(e.data.data,(function(e){return{text:e}}))}))}},{key:"labelValuesQuery",value:function(e,t){var r,n=this.datasource.getPrometheusTime(this.range.from,!1),a=this.datasource.getPrometheusTime(this.range.to,!0);if(t){var o=new URLSearchParams({"match[]":t,start:n.toString(),end:a.toString()});return r="/api/v1/series?".concat(o.toString()),this.datasource.metadataRequest(r).then((function(t){var r=P.a.map(t.data.data,(function(t){return t[e]||""})).filter((function(e){return""!==e}));return P.a.uniq(r).map((function(e){return{text:e,expandable:!0}}))}))}var i=new URLSearchParams({start:n.toString(),end:a.toString()});return r="/api/v1/label/".concat(e,"/values?").concat(i.toString()),this.datasource.metadataRequest(r).then((function(e){return P.a.map(e.data.data,(function(e){return{text:e}}))}))}},{key:"metricNameQuery",value:function(e){var t=this.datasource.getPrometheusTime(this.range.from,!1),r=this.datasource.getPrometheusTime(this.range.to,!0),n=new URLSearchParams({start:t.toString(),end:r.toString()}),a="/api/v1/label/__name__/values?".concat(n.toString());return this.datasource.metadataRequest(a).then((function(t){return P.a.chain(t.data.data).filter((function(t){return new RegExp(e).test(t)})).map((function(e){return{text:e,expandable:!0}})).value()}))}},{key:"queryResultQuery",value:function(e){var t=this.datasource.getPrometheusTime(this.range.to,!0),r={expr:e};return this.datasource.performInstantQuery(r,t).pipe(Object(w.a)((function(e){return P.a.map(e.data.data.result,(function(e){var t=e.metric.__name__||"";return delete e.metric.__name__,t+="{"+P.a.map(e.metric,(function(e,t){return t+'="'+e+'"'})).join(",")+"}",{text:t+=" "+e.value[1]+" "+1e3*e.value[0],expandable:!0}}))})))}},{key:"metricNameAndLabelsQuery",value:function(e){var t=this.datasource.getPrometheusTime(this.range.from,!1),r=this.datasource.getPrometheusTime(this.range.to,!0),n=new URLSearchParams({"match[]":e,start:t.toString(),end:r.toString()}),a="/api/v1/series?".concat(n.toString()),o=this;return this.datasource.metadataRequest(a).then((function(e){return P.a.map(e.data.data,(function(e){return{text:o.datasource.getOriginalMetricName(e),expandable:!0}}))}))}}])&&B(t.prototype,r),n&&B(t,n),e}();function G(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function K(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function W(e,t,r){var n=[];if(e.trim().match(/^\w+_bucket$/)){n.push({type:"HISTOGRAM_QUANTILE",label:"Time series has buckets, you probably wanted a histogram.",fix:{label:"Fix by adding histogram_quantile().",action:{type:"ADD_HISTOGRAM_QUANTILE",query:e}}})}if(-1===e.indexOf("rate(")&&-1===e.indexOf("increase(")){var a,o,i,u=e.match(/\b(\w+_(total|sum|count))\b/),s=u?u[1]:"",c=null!==(a=null==r?void 0:null===(o=r.languageProvider)||void 0===o?void 0:o.metricsMetadata)&&void 0!==a?a:{},l=Object.keys(c),f=!1;if(l.length>0)s=null!==(i=l.find((function(t){if("counter"===c[t][0].type.toLowerCase()){var r=new RegExp("\\b".concat(t,"\\b"));if(e.match(r))return f=!0,!0}return!1})))&&void 0!==i?i:"";if(s){var p,m=e.trim().match(/^\w+$/),h=f?"is":"looks like",d="Metric ".concat(s," ").concat(h," a counter.");m?p={label:"Fix by adding rate().",action:{type:"ADD_RATE",query:e}}:d="".concat(d," Try applying a rate() function."),n.push({type:"APPLY_RATE",label:d,fix:p})}}if(r&&r.ruleMappings){var g=r.ruleMappings,v=Object.keys(g).reduce((function(t,r){return e.search(r)>-1?function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?G(Object(r),!0).forEach((function(t){K(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t,K({},r,g[r])):t}),{});if(P.a.size(v)>0){n.push({type:"EXPAND_RULES",label:"Query contains recording rules.",fix:{label:"Expand rules",action:{type:"EXPAND_RULES",query:e,mapping:v}}})}}t&&t.length>=20&&(e.trim().match(/^\w+$/)&&n.push({type:"ADD_SUM",label:"Many time series results returned.",fix:{label:"Consider aggregating with sum().",action:{type:"ADD_SUM",query:e,preventSubmit:!0}}}));return n}function z(e){return"cancelled"in e}function X(e){return"values"in e}function Y(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function J(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ee(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function te(e,t){var r={format:t.target.format,step:t.query.step,legendFormat:t.target.legendFormat,start:t.query.start,end:t.query.end,query:t.query.expr,responseListLength:t.responseListLength,scopedVars:t.scopedVars,refId:t.target.refId,valueWithRefId:t.target.valueWithRefId,meta:{preferredVisualisationType:re(t.query.instant,t.mixedQueries)}},a=e.data.data;if(!a.result)return[];if("scalar"===a.resultType)return[{meta:r.meta,refId:r.refId,length:1,fields:[ae([a.result]),oe({data:[a.result]})]}];if("table"===r.format)return[function(e,t){if(!e||0===e.length)return{meta:t.meta,refId:t.refId,length:0,fields:[]};var r=t.responseListLength>1||t.valueWithRefId?"Value #".concat(t.refId):"Value",a=ae([]),o=Object.keys(e.reduce((function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(r),!0).forEach((function(t){ee(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e,{},t.metric)}),{})).sort().map((function(e){return{name:e,config:{filterable:!0},type:n.FieldType.other,values:new n.ArrayVector}})),i=oe({data:[],valueName:r});return e.forEach((function(e){X(e)?e.values.forEach((function(t){a.values.add(1e3*t[0]),o.forEach((function(t){return t.values.add(ne(e.metric,t.name))})),i.values.add(se(t[1]))})):(a.values.add(1e3*e.value[0]),o.forEach((function(t){return t.values.add(ne(e.metric,t.name))})),i.values.add(se(e.value[1])))})),{meta:t.meta,refId:t.refId,length:a.values.length,fields:[a].concat(J(o),[i])}}(a.result,r)];var o=[];return a.result.forEach((function(e){return o.push(function(e,t){var r=function(e,t){if(null==t?void 0:t.legendFormat){return{name:ie(Object(u.a)().replace(t.legendFormat,null==t?void 0:t.scopedVars),e),labels:e}}var r=e.__name__,a=Y(e,["__name__"]),o=Object(n.formatLabels)(a);return{name:"".concat(null!=r?r:"").concat(o),labels:a}}(e.metric,t),a=r.name,o=r.labels,i=[];if(X(e)){var s=t.step?1e3*t.step:NaN,c=1e3*t.start,l=[],f=!0,p=!1,m=void 0;try{for(var h,d=e.values[Symbol.iterator]();!(f=(h=d.next()).done);f=!0){var g=h.value,v=se(g[1]);isNaN(v)&&(v=null);for(var y=1e3*g[0],b=c;b<y;b+=s)l.push([b,null]);c=y+s,l.push([y,v])}}catch(e){p=!0,m=e}finally{try{f||null==d.return||d.return()}finally{if(p)throw m}}for(var O=1e3*t.end,w=c;w<=O;w+=s)l.push([w,null]);i.push(ae(l,!0)),i.push(oe({data:l,parseValue:!1,labels:o,displayName:a}))}else i.push(ae([e.value])),i.push(oe({data:[e.value],labels:o,displayName:a}));return{meta:t.meta,refId:t.refId,length:i[0].values.length,fields:i,name:a}}(e,r))})),"heatmap"===r.format?(o.sort(ue),function(e){for(var t=e.length-1;t>0;t--){var r=e[t].fields.find((function(e){return e.name===n.TIME_SERIES_VALUE_FIELD_NAME})),a=e[t-1].fields.find((function(e){return e.name===n.TIME_SERIES_VALUE_FIELD_NAME}));if(!r||!a)throw new Error("Prometheus heatmap transform error: data should be a time series");for(var o=0;o<r.values.length;o++){var i=a.values.get(o)||[0];r.values.toArray()[o]-=i}}return e}(o)):o}function re(e,t){return e?"table":t?"graph":void 0}function ne(e,t){return e.hasOwnProperty(t)?"le"===t?se(e[t]):e[t]:""}function ae(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{name:n.TIME_SERIES_TIME_FIELD_NAME,type:n.FieldType.time,config:{},values:new n.ArrayVector(e.map((function(e){return t?e[0]:1e3*e[0]})))}}function oe(e){var t=e.data,r=e.valueName,a=void 0===r?n.TIME_SERIES_VALUE_FIELD_NAME:r,o=e.parseValue,i=void 0===o||o,u=e.labels,s=e.displayName;return{name:a,type:n.FieldType.number,config:{displayName:s},labels:u,values:new n.ArrayVector(t.map((function(e){return i?se(e[1]):e[1]})))}}function ie(e,t){return e.replace(/\{\{\s*(.+?)\s*\}\}/g,(function(e,r){return t[r]?t[r]:""}))}function ue(e,t){var r,n;try{var a,o;r=se(null!==(a=e.name)&&void 0!==a?a:""),n=se(null!==(o=t.name)&&void 0!==o?o:"")}catch(e){return console.error(e),0}return r>n?1:r<n?-1:0}function se(e){switch(e){case"+Inf":return Number.POSITIVE_INFINITY;case"-Inf":return Number.NEGATIVE_INFINITY;default:return parseFloat(e)}}function ce(e){return(ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function le(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function fe(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){le(o,n,a,i,u,"next",e)}function u(e){le(o,n,a,i,u,"throw",e)}i(void 0)}))}}function pe(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function me(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function he(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function de(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?he(Object(r),!0).forEach((function(t){ge(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):he(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ge(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ve(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ye(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function be(e,t){return!t||"object"!==ce(t)&&"function"!=typeof t?we(e):t}function Oe(e){return(Oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function we(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xe(e,t){return(xe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var je=function(e){function t(e){var r,a,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(u.a)(),l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(i.a)();return ve(this,t),(a=be(this,Oe(t).call(this,e))).templateSrv=s,a.timeSrv=l,a.metricsNameCache=new m.a(10),a.init=function(){a.loadRules()},a.prepareTargets=function(e,t,r){var o=[],i=[],u=!0,s=!1,l=void 0;try{for(var f,p=e.targets[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){var m=f.value;if(m.expr&&!m.hide)if(m.requestId=e.panelId+m.refId,m.range&&m.instant){var h=c()(m);h.format="table",h.instant=!0,h.range=!1,h.valueWithRefId=!0,delete h.maxDataPoints,h.requestId+="_instant";var d=c()(m);d.format="time_series",d.instant=!1,h.range=!0,i.push(h,d),o.push(a.createQuery(h,e,t,r),a.createQuery(d,e,t,r))}else if(m.instant&&e.app===n.CoreApp.Explore){var g=c()(m);g.format="table",o.push(a.createQuery(g,e,t,r)),i.push(g)}else o.push(a.createQuery(m,e,t,r)),i.push(m)}}catch(e){s=!0,l=e}finally{try{u||null==p.return||p.return()}finally{if(s)throw l}}return{queries:o,activeTargets:i}},a.handleErrors=function(e,t){var r={message:e&&e.statusText||"Unknown error during query transaction. Please check JS console logs.",refId:t.refId};return e.data?"string"==typeof e.data?r.message=e.data:e.data.error&&(r.message=Object(o.s)(e.data.error)):e.message?r.message=e.message:"string"==typeof e&&(r.message=e),r.status=e.status,r.statusText=e.statusText,r},a.createAnnotationQueryOptions=function(e){var t=e.annotation;return de({},e,{interval:t&&t.step&&"string"==typeof t.step?t.step:"60s"})},a.type="prometheus",a.editorSrc="app/features/prometheus/partials/query.editor.html",a.url=e.url,a.basicAuth=e.basicAuth,a.withCredentials=e.withCredentials,a.interval=e.jsonData.timeInterval||"15s",a.queryTimeout=e.jsonData.queryTimeout,a.httpMethod=e.jsonData.httpMethod||"GET",a.directUrl=e.jsonData.directUrl,a.ruleMappings={},a.languageProvider=new H(we(a)),a.lookupsDisabled=null!==(r=e.jsonData.disableMetricsLookup)&&void 0!==r&&r,a.customQueryParameters=new URLSearchParams(e.jsonData.customQueryParameters),a}var r,s,l,p,E,P,_,k;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xe(e,t)}(t,e),r=t,(s=[{key:"getQueryDisplayText",value:function(e){return e.expr}},{key:"_addTracingHeaders",value:function(e,t){e.headers={},!this.url.match(/^http/)&&(e.headers["X-Dashboard-Id"]=t.dashboardId,e.headers["X-Panel-Id"]=t.panelId)}},{key:"_request",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=f()(r,{url:this.url+e,method:this.httpMethod,headers:{}});return"GET"===n.method?t&&Object.keys(t).length&&(n.url=n.url+"?"+Object.entries(t).map((function(e){var t=me(e,2),r=t[0],n=t[1];return"".concat(encodeURIComponent(r),"=").concat(encodeURIComponent(n))})).join("&")):(n.headers["Content-Type"]="application/x-www-form-urlencoded",n.data=t),(this.basicAuth||this.withCredentials)&&(n.withCredentials=!0),this.basicAuth&&(n.headers.Authorization=this.basicAuth),Object(a.getBackendSrv)().fetch(n)}},{key:"metadataRequest",value:function(e){return this._request(e,null,{method:"GET",hideFromInspector:!0}).toPromise()}},{key:"interpolateQueryExpr",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(!t.multi&&!t.includeAll)return Pe(e);if("string"==typeof e)return Se(e);var r=e.map((function(e){return Se(e)}));return 1===r.length?r[0]:"("+r.join("|")+")"}},{key:"targetContainsTemplate",value:function(e){return this.templateSrv.variableExists(e.expr)}},{key:"query",value:function(e){var t=this.getPrometheusTime(e.range.from,!1),r=this.getPrometheusTime(e.range.to,!0),a=this.prepareTargets(e,t,r),o=a.queries,i=a.activeTargets;return o&&o.length?e.app===n.CoreApp.Explore?this.exploreQuery(o,i,r):this.panelsQuery(o,i,r,e.requestId,e.scopedVars):Object(h.a)({data:[],state:n.LoadingState.Done})}},{key:"exploreQuery",value:function(e,t,r){var a=this,o=e.length,i=t.some((function(e){return e.range}))&&t.some((function(e){return e.instant})),u=e.map((function(u,s){var c=t[s],l=Object(d.a)(Object(b.a)((function(){return o--})),Object(O.a)((function(e){return!e.cancelled})),Object(w.a)((function(t){return{data:te(t,{query:u,target:c,responseListLength:e.length,mixedQueries:i}),key:u.requestId,state:0===o?n.LoadingState.Done:n.LoadingState.Loading}})));return u.instant?a.performInstantQuery(u,r).pipe(l):a.performTimeSeriesQuery(u,u.start,u.end).pipe(l)}));return g.a.apply(void 0,pe(u))}},{key:"panelsQuery",value:function(e,t,r,a,o){var i=this,u=e.map((function(n,a){var u=t[a],s=Object(d.a)(Object(O.a)((function(e){return!e.cancelled})),Object(w.a)((function(t){return te(t,{query:n,target:u,responseListLength:e.length,scopedVars:o})})));return n.instant?i.performInstantQuery(n,r).pipe(s):i.performTimeSeriesQuery(n,n.start,n.end).pipe(s)}));return Object(v.a)(u).pipe(Object(w.a)((function(e){return{data:e.reduce((function(e,t){return[].concat(pe(e),pe(t))}),[]),key:a,state:n.LoadingState.Done}})))}},{key:"createQuery",value:function(e,t,r,a){var o={hinting:e.hinting,instant:e.instant,step:0,expr:"",requestId:e.requestId,refId:e.refId,start:0,end:0},i=Math.ceil(a-r),u=n.rangeUtil.intervalToSeconds(t.interval),s=n.rangeUtil.intervalToSeconds(this.templateSrv.replace(e.interval||t.interval,t.scopedVars)),c=e.interval?n.rangeUtil.intervalToSeconds(this.templateSrv.replace(e.interval,t.scopedVars)):n.rangeUtil.intervalToSeconds(this.interval),l=e.intervalFactor||1,f=this.adjustInterval(u,s,i,l),p=de({},t.scopedVars,{},this.getRangeScopedVars(t.range),{},this.getRateIntervalScopedVariable(f,c));u!==f&&(u=f,p=Object.assign({},t.scopedVars,de({__interval:{text:u+"s",value:u+"s"},__interval_ms:{text:1e3*u,value:1e3*u}},this.getRateIntervalScopedVariable(u,c),{},this.getRangeScopedVars(t.range)))),o.step=u;var m=e.expr;m=this.templateSrv.getAdhocFilters(this.name).reduce((function(e,t){var r=t.key,n=t.operator,a=t.value;return"=~"!==n&&"!~"!==n||(a=Pe(a)),Object(j.b)(e,r,a,n)}),m),o.expr=this.templateSrv.replace(m,p,this.interpolateQueryExpr);var h=function(e,t,r,n){var a=Math.floor((t+n)/r)*r-n,o=Math.floor((e+n)/r)*r-n;return{end:a,start:o}}(r,a,o.step,60*this.timeSrv.timeRange().to.utcOffset());return o.start=h.start,o.end=h.end,this._addTracingHeaders(o,t),o}},{key:"getRateIntervalScopedVariable",value:function(e,t){0===t&&(t=15);var r=Math.max(e+t,4*t);return{__rate_interval:{text:r+"s",value:r+"s"}}}},{key:"adjustInterval",value:function(e,t,r,n){var a=r/11e3;return a>1&&(a=Math.ceil(a)),Math.max(e*n,t,a)}},{key:"performTimeSeriesQuery",value:function(e,t,r){var n=this;if(t>r)throw{message:"Invalid time range"};var a={query:e.expr,start:t,end:r,step:e.step};this.queryTimeout&&(a.timeout=this.queryTimeout);var o=!0,i=!1,u=void 0;try{for(var s,c=this.customQueryParameters[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var l=me(s.value,2),f=l[0],p=l[1];null==a[f]&&(a[f]=p)}}catch(e){i=!0,u=e}finally{try{o||null==c.return||c.return()}finally{if(i)throw u}}return this._request("/api/v1/query_range",a,{requestId:e.requestId,headers:e.headers}).pipe(Object(x.a)((function(t){return t.cancelled?Object(h.a)(t):Object(y.a)(n.handleErrors(t,e))})))}},{key:"performInstantQuery",value:function(e,t){var r=this,n={query:e.expr,time:t};this.queryTimeout&&(n.timeout=this.queryTimeout);var a=!0,o=!1,i=void 0;try{for(var u,s=this.customQueryParameters[Symbol.iterator]();!(a=(u=s.next()).done);a=!0){var c=me(u.value,2),l=c[0],f=c[1];null==n[l]&&(n[l]=f)}}catch(e){o=!0,i=e}finally{try{a||null==s.return||s.return()}finally{if(o)throw i}}return this._request("/api/v1/query",n,{requestId:e.requestId,headers:e.headers}).pipe(Object(x.a)((function(t){return t.cancelled?Object(h.a)(t):Object(y.a)(r.handleErrors(t,e))})))}},{key:"metricFindQuery",value:function(e){if(!e)return Promise.resolve([]);var t=de({__interval:{text:this.interval,value:this.interval},__interval_ms:{text:n.rangeUtil.intervalToMs(this.interval),value:n.rangeUtil.intervalToMs(this.interval)}},this.getRangeScopedVars(this.timeSrv.timeRange())),r=this.templateSrv.replace(e,t,this.interpolateQueryExpr),a=new $(this,r);return a.process()}},{key:"getRangeScopedVars",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeSrv.timeRange(),t=e.to.diff(e.from),r=Math.round(t/1e3);return{__range_ms:{text:t,value:t},__range_s:{text:r,value:r},__range:{text:r+"s",value:r+"s"}}}},{key:"annotationQuery",value:(k=fe(regeneratorRuntime.mark((function e(t){var r,n,a,o,i,u,s,c,l,f,p,m,h,d,g,v,y,b,O,w,x,j;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.annotation,u=i.expr,s=void 0===u?"":u,c=i.tagKeys,l=void 0===c?"":c,f=i.titleFormat,p=void 0===f?"":f,m=i.textFormat,h=void 0===m?"":m,s){e.next=4;break}return e.abrupt("return",Promise.resolve([]));case 4:return d=this.getPrometheusTime(t.range.from,!1),g=this.getPrometheusTime(t.range.to,!0),v=this.createAnnotationQueryOptions(t),y={expr:s,interval:"1s",refId:"X",requestId:"prom-query-".concat(i.name)},b=this.createQuery(y,v,d,g),e.next=12,this.performTimeSeriesQuery(b,b.start,b.end).toPromise();case 12:if(O=e.sent,w=[],x=l.split(","),!z(O)||!O.cancelled){e.next=17;break}return e.abrupt("return",[]);case 17:return j=1e3*Math.floor(null!==(r=b.step)&&void 0!==r?r:15),null==O||null===(n=O.data)||void 0===n||null===(a=n.data)||void 0===a||null===(o=a.result)||void 0===o||o.forEach((function(e){var t=Object.entries(e.metric).filter((function(e){var t=me(e,1)[0];return x.includes(t)})).map((function(e){var t=me(e,2);return t[0],t[1]}));e.values.forEach((function(e){var t;i.useValueForTime?(t=Math.floor(parseFloat(e[1])),e[1]=1):t=1e3*Math.floor(parseFloat(e[0])),e[0]=t}));var r=e.values.filter((function(e){return parseFloat(e[1])>=1})).map((function(e){return e[0]})),n=null,a=!0,o=!1,u=void 0;try{for(var s,c=r[Symbol.iterator]();!(a=(s=c.next()).done);a=!0){var l,f=s.value;n&&(null!==(l=n.timeEnd)&&void 0!==l?l:0)+j>=f?n.timeEnd=f:(n&&w.push(n),n={time:f,timeEnd:f,annotation:i,title:ie(p,e.metric),tags:t,text:ie(h,e.metric)})}}catch(e){o=!0,u=e}finally{try{a||null==c.return||c.return()}finally{if(o)throw u}}n&&(n.timeEnd=r[r.length-1],w.push(n))})),e.abrupt("return",w);case 20:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"getTagKeys",value:(_=fe(regeneratorRuntime.mark((function e(){var t,r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.metadataRequest("/api/v1/labels");case 2:return a=e.sent,e.abrupt("return",null!==(t=null==a?void 0:null===(r=a.data)||void 0===r?void 0:null===(n=r.data)||void 0===n?void 0:n.map((function(e){return{text:e}})))&&void 0!==t?t:[]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)})},{key:"getTagValues",value:(P=fe(regeneratorRuntime.mark((function e(){var t,r,n,a,o,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.length>0&&void 0!==i[0]?i[0]:{},e.next=3,this.metadataRequest("/api/v1/label/".concat(a.key,"/values"));case 3:return o=e.sent,e.abrupt("return",null!==(t=null==o?void 0:null===(r=o.data)||void 0===r?void 0:null===(n=r.data)||void 0===n?void 0:n.map((function(e){return{text:e}})))&&void 0!==t?t:[]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return P.apply(this,arguments)})},{key:"testDatasource",value:(E=fe(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(new Date).getTime(),r={expr:"1+1"},e.next=4,this.performInstantQuery(r,t/1e3).toPromise();case 4:return n=e.sent,e.abrupt("return","success"===n.data.status?{status:"success",message:"Data source is working"}:{status:"error",message:n.data.error});case 6:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"interpolateVariablesInQueries",value:function(e,t){var r=this,n=e;return e&&e.length&&(n=e.map((function(e){return de({},e,{datasource:r.name,expr:r.templateSrv.replace(e.expr,t,r.interpolateQueryExpr)})}))),n}},{key:"getQueryHints",value:function(e,t){var r;return W(null!==(r=e.expr)&&void 0!==r?r:"",t,this)}},{key:"loadRules",value:(p=fe(regeneratorRuntime.mark((function e(){var t,r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.metadataRequest("/api/v1/rules");case 3:n=e.sent,(a=null===(t=n.data)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:r.groups)&&(this.ruleMappings=Ee(a)),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log("Rules API is experimental. Ignore next error."),console.error(e.t0);case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return p.apply(this,arguments)})},{key:"modifyQuery",value:function(e,t){var r,n=null!==(r=e.expr)&&void 0!==r?r:"";switch(t.type){case"ADD_FILTER":n=Object(j.b)(n,t.key,t.value);break;case"ADD_FILTER_OUT":n=Object(j.b)(n,t.key,t.value,"!=");break;case"ADD_HISTOGRAM_QUANTILE":n="histogram_quantile(0.95, sum(rate(".concat(n,"[5m])) by (le))");break;case"ADD_RATE":n="rate(".concat(n,"[5m])");break;case"ADD_SUM":n="sum(".concat(n.trim(),") by ($1)");break;case"EXPAND_RULES":t.mapping&&(n=Object(S.a)(n,t.mapping))}return de({},e,{expr:n})}},{key:"getPrometheusTime",value:function(e,t){return"string"==typeof e&&(e=n.dateMath.parse(e,t)),Math.ceil(e.valueOf()/1e3)}},{key:"getTimeRange",value:function(){var e=this.timeSrv.timeRange();return{start:this.getPrometheusTime(e.from,!1),end:this.getPrometheusTime(e.to,!0)}}},{key:"getOriginalMetricName",value:function(e){return function(e){var t=e.__name__||"";delete e.__name__;var r=Object.entries(e).map((function(e){return"".concat(e[0],'="').concat(e[1],'"')})).join(",");return"".concat(t,"{").concat(r,"}")}(e)}}])&&ye(r.prototype,s),l&&ye(r,l),t}(n.DataSourceApi);function Ee(e){return e.reduce((function(e,t){return t.rules.filter((function(e){return"recording"===e.type})).reduce((function(e,t){return de({},e,ge({},t.name,t.query))}),e)}),{})}function Pe(e){return"string"==typeof e?e.replace(/\\/g,"\\\\").replace(/'/g,"\\\\'"):e}function Se(e){return"string"==typeof e?e.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]\'+?.()|]/g,"\\\\$&"):e}var _e=r("q1tI"),ke=r.n(_e),Te=r("kDLi"),Ie=r("wZee"),Re=r.n(Ie),qe=r("sGFA");function Ce(e){return(Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function De(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Le(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ae(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function Qe(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Ae(o,n,a,i,u,"next",e)}function u(e){Ae(o,n,a,i,u,"throw",e)}i(void 0)}))}}function Me(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Fe(e,t){return!t||"object"!==Ce(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ne(e){return(Ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ve(e,t){return(Ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ue(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var He="__histograms__";function Be(e,t){var r=t.typeaheadContext,n=t.typeaheadText;switch(r){case"context-labels":var a=Te.DOMUtil.getNextCharacter();a&&"}"!==a&&","!==a||(e+="=");break;case"context-label-values":n.match(/^(!?=~?"|")/)||(e='"'.concat(e)),'"'!==Te.DOMUtil.getNextCharacter()&&(e="".concat(e,'"'))}return e}var $e=function(e){function t(e,r){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=Fe(this,Ne(t).call(this,e,r))).refreshHint=function(){var e=a.props,t=e.datasource,r=e.query,o=e.data;if(o&&0!==o.series.length){var i=Object(n.isDataFrame)(o.series[0])?o.series.map(n.toLegacyResponseData):o.series,u=t.getQueryHints(r,i),s=u.length>0?u[0]:null;s||t.lookupsDisabled||!t.languageProvider.lookupsDisabled||(s={label:"Dynamic label lookup is disabled for datasources with more than ".concat(t.languageProvider.lookupMetricsThreshold," metrics."),type:"INFO"}),a.setState({hint:s})}else a.setState({hint:null})},a.refreshMetrics=Qe(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props.datasource.languageProvider,Re.a.languages.promql=t.syntax,a.languageProviderInitializationPromise=Object(qe.a)(t.start()),e.prev=3,e.next=6,a.languageProviderInitializationPromise.promise;case 6:return r=e.sent,e.next=9,Promise.all(r);case 9:a.onUpdateLanguage(),e.next=16;break;case 12:if(e.prev=12,e.t0=e.catch(3),e.t0.isCanceled){e.next=16;break}throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[3,12]])}))),a.onChangeMetrics=function(e,t){var r;if(1===t.length){var n=t[0];if(n.children&&0!==n.children.length)return;r=n.value}else{var o=t[0].value,i=t[1].value;r=o===He?"histogram_quantile(0.95, sum(rate(".concat(i,"[5m])) by (le))"):i}a.onChangeQuery(r,!0)},a.onChangeQuery=function(e,t){var r=a.props,n=r.query,o=r.onChange,i=r.onRunQuery;o&&(o(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?De(Object(r),!0).forEach((function(t){Le(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):De(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},n,{expr:e})),t&&i&&i())},a.onClickHintFix=function(){var e=a.props,t=e.datasource,r=e.query,n=e.onChange,o=e.onRunQuery,i=a.state.hint;n(t.modifyQuery(r,i.fix.action)),o()},a.onUpdateLanguage=function(){var e=a.props.datasource.languageProvider,t=e.histogramMetrics,r=e.metrics,n=e.metricsMetadata;if(r){var o=function(e,t){var r=/:\w+:/,n=e.filter((function(e){return r.test(e)})),a={label:"Recording rules",value:"__recording_rules__",children:n.slice().sort().map((function(e){return{label:e,value:e}}))},o=n.length>0?[a]:[],i=P.a.chain(e).filter((function(e){return!r.test(e)})).groupBy((function(e){return e.split("_")[0]})).map((function(e,r){return{children:1===e.length&&e[0]===r?[]:e.sort().map((function(e){return function(e,t){var r={label:e,value:e};if(t&&t[e]){var n=t[e][0],a=n.type,o=void 0===a?"":a,i=n.help;r.title=[e,o.toUpperCase(),i].join("\n")}return r}(e,t)})),label:r,value:r}})).sortBy("label").value();return[].concat(o,Ue(i))}(r,n),i=t.map((function(e){return{label:e,value:e}})),u=t.length>0?[{label:"Histograms",value:He,children:i,isLeaf:!1}].concat(Ue(o)):o;a.setState({metricsOptions:u,syntaxLoaded:!0})}},a.onTypeahead=function(){var e=Qe(regeneratorRuntime.mark((function e(t){var r,n,o,i,u,s,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.props.datasource.languageProvider){e.next=3;break}return e.abrupt("return",{suggestions:[]});case 3:return n=a.props.history,o=t.prefix,i=t.text,u=t.value,s=t.wrapperClasses,c=t.labelKey,e.next=7,r.provideCompletionItems({text:i,value:u,prefix:o,wrapperClasses:s,labelKey:c},{history:n});case 7:return l=e.sent,e.abrupt("return",l);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.plugins=[Object(Te.BracesPlugin)(),Object(Te.SlatePrism)({onlyIn:function(e){return"code_block"===e.type},getSyntax:function(e){return"promql"}})],a.state={metricsOptions:[],syntaxLoaded:!1,hint:null},a}var r,a,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ve(e,t)}(t,e),r=t,(a=[{key:"componentDidMount",value:function(){this.props.datasource.languageProvider&&this.refreshMetrics(),this.refreshHint()}},{key:"componentWillUnmount",value:function(){this.languageProviderInitializationPromise&&this.languageProviderInitializationPromise.cancel()}},{key:"componentDidUpdate",value:function(e){var t=this.props,r=t.data,n=t.datasource.languageProvider,a=t.range,o=a&&e.range&&!P.a.isEqual({from:a.from.valueOf(),to:a.to.valueOf()},{from:e.range.from.valueOf(),to:e.range.to.valueOf()});n!==e.datasource.languageProvider&&this.setState({metricsOptions:[],syntaxLoaded:!1}),(n!==e.datasource.languageProvider||o)&&this.refreshMetrics(),r&&e.data&&e.data.series!==r.series&&this.refreshHint()}},{key:"render",value:function(){var e,t,r,n=this.props,a=n.datasource,o=n.datasource.languageProvider,i=n.query,u=n.ExtraFieldElement,s=this.state,c=s.metricsOptions,l=s.syntaxLoaded,f=s.hint,p=o?o.cleanText:void 0,m=(e=a.lookupsDisabled,t=l,r=c,e?"(Disabled)":t?r&&0===r.length?"(No metrics found)":"Metrics":"Loading metrics..."),h=!(l&&c&&c.length>0);return ke.a.createElement(ke.a.Fragment,null,ke.a.createElement("div",{className:"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1"},ke.a.createElement("div",{className:"gf-form flex-shrink-0 min-width-5"},ke.a.createElement(Te.ButtonCascader,{options:c,disabled:h,onChange:this.onChangeMetrics},m)),ke.a.createElement("div",{className:"gf-form gf-form--grow flex-shrink-1 min-width-15"},ke.a.createElement(Te.QueryField,{additionalPlugins:this.plugins,cleanText:p,query:i.expr,onTypeahead:this.onTypeahead,onWillApplySuggestion:Be,onBlur:this.props.onBlur,onChange:this.onChangeQuery,onRunQuery:this.props.onRunQuery,placeholder:"Enter a PromQL query (run with Shift+Enter)",portalOrigin:"prometheus",syntaxLoaded:l}))),u,f?ke.a.createElement("div",{className:"query-row-break"},ke.a.createElement("div",{className:"prom-query-field-info text-warning"},f.label," ",f.fix?ke.a.createElement("a",{className:"text-link muted",onClick:this.onClickHintFix},f.fix.label):null)):null)}}])&&Me(r.prototype,a),o&&Me(r,o),t}(ke.a.PureComponent);function Ge(e){return(Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ke(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function We(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Ke(o,n,a,i,u,"next",e)}function u(e){Ke(o,n,a,i,u,"throw",e)}i(void 0)}))}}function ze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Xe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ye(e,t){return!t||"object"!==Ge(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Je(e){return(Je=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ze(e,t){return(Ze=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var et=function(e){function t(){var e,r;ze(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(r=Ye(this,(e=Je(t)).call.apply(e,[this].concat(a)))).state={href:""},r}var r,n,a,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ze(e,t)}(t,e),r=t,(n=[{key:"componentDidUpdate",value:(i=We(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this.props.panelData)||!r.request||t.panelData===r){e.next=6;break}return e.next=4,this.getExternalLink(r);case 4:n=e.sent,this.setState({href:n});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getExternalLink",value:(o=We(regeneratorRuntime.mark((function e(t){var r,n,a,o,i,u,s,c,l,f,p,m,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.props,n=r.query,a=r.datasource,o=t.request){e.next=4;break}return e.abrupt("return","");case 4:return i=o.range,u=a.getPrometheusTime(i.from,!1),s=a.getPrometheusTime(i.to,!0),c=Math.ceil(s-u),l=i.to.utc().format("YYYY-MM-DD HH:mm"),f={interval:o.interval},p=a.createQuery(n,f,u,s),m={"g0.expr":p.expr,"g0.range_input":c+"s","g0.end_input":l,"g0.step_input":p.step,"g0.tab":0},h=P.a.map(m,(function(e,t){return t+"="+encodeURIComponent(e)})).join("&"),e.abrupt("return","".concat(a.directUrl,"/graph?").concat(h));case 14:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"render",value:function(){var e=this.state.href;return ke.a.createElement("a",{href:e,target:"_blank",rel:"noopener"},"Prometheus")}}])&&Xe(r.prototype,n),a&&Xe(r,a),t}(_e.Component);function tt(e){return(tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function nt(e){return(nt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function at(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ot(e,t){return(ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var it=Te.LegacyForms.Switch,ut=[{label:"Time series",value:"time_series"},{label:"Table",value:"table"},{label:"Heatmap",value:"heatmap"}],st=P.a.map([1,2,3,4,5,10],(function(e){return{value:e,label:"1/"+e}})),ct=function(e){function t(e){var r,n,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,a=nt(t).call(this,e),(r=!a||"object"!==tt(a)&&"function"!=typeof a?at(n):a).onFieldChange=function(e,t){r.query.expr=e.expr},r.onFormatChange=function(e){r.query.format=e.value,r.setState({formatOption:e},r.onRunQuery)},r.onInstantChange=function(e){var t=e.target.checked;r.query.instant=t,r.setState({instant:t},r.onRunQuery)},r.onIntervalChange=function(e){var t=e.currentTarget.value;r.query.interval=t,r.setState({interval:t})},r.onIntervalFactorChange=function(e){r.query.intervalFactor=e.value,r.setState({intervalFactorOption:e},r.onRunQuery)},r.onLegendChange=function(e){var t=e.currentTarget.value;r.query.legendFormat=t,r.setState({legendFormat:t})},r.onRunQuery=function(){var e=at(r).query;r.props.onChange(e),r.props.onRunQuery()};var o=Object.assign({},{expr:"",legendFormat:"",interval:""},e.query);return r.query=o,r.state={interval:o.interval,legendFormat:o.legendFormat,formatOption:ut.find((function(e){return e.value===o.format}))||ut[0],intervalFactorOption:st.find((function(e){return e.value===o.intervalFactor}))||st[0],instant:Boolean(o.instant)},r}var r,n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ot(e,t)}(t,e),r=t,(n=[{key:"render",value:function(){var e=this.props,t=e.datasource,r=e.query,n=e.range,a=e.data,o=this.state,i=o.formatOption,u=o.instant,s=o.interval,c=o.intervalFactorOption,l=o.legendFormat;return ke.a.createElement("div",null,ke.a.createElement($e,{datasource:t,query:r,range:n,onRunQuery:this.onRunQuery,onChange:this.onFieldChange,history:[],data:a}),ke.a.createElement("div",{className:"gf-form-inline"},ke.a.createElement("div",{className:"gf-form"},ke.a.createElement(Te.InlineFormLabel,{width:7,tooltip:"Controls the name of the time series, using name or pattern. For example {{hostname}} will be replaced with label value for the label hostname."},"Legend"),ke.a.createElement("input",{type:"text",className:"gf-form-input",placeholder:"legend format",value:l,onChange:this.onLegendChange,onBlur:this.onRunQuery})),ke.a.createElement("div",{className:"gf-form"},ke.a.createElement(Te.InlineFormLabel,{width:7,tooltip:ke.a.createElement(ke.a.Fragment,null,"An additional lower limit for the step parameter of the Prometheus query and for the"," ",ke.a.createElement("code",null,"$__interval")," and ",ke.a.createElement("code",null,"$__rate_interval"),' variables. The limit is absolute and not modified by the "Resolution" setting.')},"Min step"),ke.a.createElement("input",{type:"text",className:"gf-form-input width-8",placeholder:s,onChange:this.onIntervalChange,onBlur:this.onRunQuery,value:s})),ke.a.createElement("div",{className:"gf-form"},ke.a.createElement("div",{className:"gf-form-label"},"Resolution"),ke.a.createElement(Te.Select,{isSearchable:!1,menuPlacement:"bottom",options:st,onChange:this.onIntervalFactorChange,value:c})),ke.a.createElement("div",{className:"gf-form"},ke.a.createElement("div",{className:"gf-form-label width-7"},"Format"),ke.a.createElement(Te.Select,{width:16,isSearchable:!1,options:ut,onChange:this.onFormatChange,value:i}),ke.a.createElement(it,{label:"Instant",checked:u,onChange:this.onInstantChange}),ke.a.createElement(Te.InlineFormLabel,{width:10,tooltip:"Link to Graph in Prometheus"},ke.a.createElement(et,{datasource:t,query:this.query,panelData:a})))))}}])&&rt(r.prototype,n),a&&rt(r,a),t}(_e.PureComponent),lt=[{title:"Request Rate",expression:"rate(http_request_total[5m])",label:"Given an HTTP request counter, this query calculates the per-second average request rate over the last 5 minutes."},{title:"95th Percentile of Request Latencies",expression:"histogram_quantile(0.95, sum(rate(prometheus_http_request_duration_seconds_bucket[5m])) by (le))",label:"Calculates the 95th percentile of HTTP request rate over 5 minute windows."},{title:"Alerts Firing",expression:'sort_desc(sum(sum_over_time(ALERTS{alertstate="firing"}[24h])) by (alertname))',label:"Sums up the alerts that have been firing over the last 24 hours."},{title:"Step",label:"Defines the graph resolution using a duration format (15s, 1m, 3h, ...). Small steps create high-resolution graphs but can be slow over larger time ranges. Using a longer step lowers the resolution and smooths the graph by producing fewer datapoints. If no step is given the resolution is calculated automatically."}],ft=r("kDDq");function pt(){var e=ht(["\n              flex-wrap: nowrap;\n            "]);return pt=function(){return e},e}function mt(){var e=ht(["\n              flex-wrap: nowrap;\n            "]);return mt=function(){return e},e}function ht(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var dt=Object(_e.memo)((function(e){var t=e.queryType,r=e.stepValue,n=e.onStepChange,a=e.onQueryTypeChange,o=e.onKeyDownFunc;return ke.a.createElement("div",{"aria-label":"Prometheus extra field",className:"gf-form-inline"},ke.a.createElement("div",{"data-testid":"queryTypeField",className:Object(ft.cx)("gf-form explore-input-margin",Object(ft.css)(mt())),"aria-label":"Query type field"},ke.a.createElement(Te.InlineFormLabel,{width:5},"Query type"),ke.a.createElement(Te.RadioButtonGroup,{options:[{value:"range",label:"Range"},{value:"instant",label:"Instant"},{value:"both",label:"Both"}],value:t,onChange:a})),ke.a.createElement("div",{"data-testid":"stepField",className:Object(ft.cx)("gf-form",Object(ft.css)(pt())),"aria-label":"Step field"},ke.a.createElement(Te.InlineFormLabel,{width:5,tooltip:"Time units can be used here, for example: 5s, 1m, 3h, 1d, 1y (Default if no unit is specified: s)"},"Step"),ke.a.createElement("input",{type:"text",className:"gf-form-input width-4",placeholder:"auto",onChange:n,onKeyDown:o,value:r})))}));function gt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function vt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?gt(Object(r),!0).forEach((function(t){yt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function yt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var bt=Object(_e.memo)((function(e){var t=e.range,r=e.query,n=e.data,a=e.datasource,o=e.history,i=e.onChange,u=e.onRunQuery;return ke.a.createElement($e,{datasource:a,query:r,range:t,onRunQuery:u,onChange:i,onBlur:function(){},history:o,data:n,ExtraFieldElement:ke.a.createElement(dt,{queryType:r.range&&r.instant?"both":r.instant?"instant":"range",stepValue:r.interval||"",onQueryTypeChange:function(t){var r=e.query;(0,e.onChange)(vt({},r,"instant"===t?{instant:!0,range:!1}:"range"===t?{instant:!1,range:!0}:{instant:!0,range:!0}))},onStepChange:function(t){t.currentTarget.value!==r.interval&&function(t){var r=e.query;(0,e.onChange)(vt({},r,{interval:t}))}(t.currentTarget.value)},onKeyDownFunc:function(e){"Enter"===e.key&&(e.shiftKey||e.ctrlKey)&&u()}})})}));function Ot(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function wt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ot(Object(r),!0).forEach((function(t){xt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ot(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function xt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var jt=Te.LegacyForms.Select,Et=Te.LegacyForms.Input,Pt=Te.LegacyForms.FormField,St=Te.LegacyForms.Switch,_t=[{value:"GET",label:"GET"},{value:"POST",label:"POST"}],kt=function(e){var t,r=e.options,a=e.onOptionsChange;return ke.a.createElement(ke.a.Fragment,null,ke.a.createElement("div",{className:"gf-form-group"},ke.a.createElement("div",{className:"gf-form-inline"},ke.a.createElement("div",{className:"gf-form"},ke.a.createElement(Pt,{label:"Scrape interval",labelWidth:13,inputEl:ke.a.createElement(Et,{className:"width-6",value:r.jsonData.timeInterval,spellCheck:!1,placeholder:"15s",onChange:Rt("timeInterval",r,a),validationEvents:Tt}),tooltip:"Set this to the typical scrape and evaluation interval configured in Prometheus. Defaults to 15s."}))),ke.a.createElement("div",{className:"gf-form-inline"},ke.a.createElement("div",{className:"gf-form"},ke.a.createElement(Pt,{label:"Query timeout",labelWidth:13,inputEl:ke.a.createElement(Et,{className:"width-6",value:r.jsonData.queryTimeout,onChange:Rt("queryTimeout",r,a),spellCheck:!1,placeholder:"60s",validationEvents:Tt}),tooltip:"Set the Prometheus query timeout."}))),ke.a.createElement("div",{className:"gf-form"},ke.a.createElement(Te.InlineFormLabel,{width:13,tooltip:"Specify the HTTP Method to query Prometheus. (POST is only available in Prometheus >= v2.1.0)"},"HTTP Method"),ke.a.createElement(jt,{options:_t,value:_t.find((function(e){return e.value===r.jsonData.httpMethod})),onChange:Rt("httpMethod",r,a),width:7}))),ke.a.createElement("h3",{className:"page-heading"},"Misc"),ke.a.createElement("div",{className:"gf-form-group"},ke.a.createElement("div",{className:"gf-form"},ke.a.createElement(St,{checked:null!==(t=r.jsonData.disableMetricsLookup)&&void 0!==t&&t,label:"Disable metrics lookup",labelClass:"width-14",onChange:Object(n.onUpdateDatasourceJsonDataOptionChecked)(e,"disableMetricsLookup"),tooltip:"Checking this option will disable the metrics chooser and metric/label support in the query field's autocomplete. This helps if you have performance issues with bigger Prometheus instances."})),ke.a.createElement("div",{className:"gf-form-inline"},ke.a.createElement("div",{className:"gf-form max-width-30"},ke.a.createElement(Pt,{label:"Custom query parameters",labelWidth:14,tooltip:"Add Custom parameters to Prometheus or Thanos queries.",inputEl:ke.a.createElement(Et,{className:"width-25",value:r.jsonData.customQueryParameters,onChange:Rt("customQueryParameters",r,a),spellCheck:!1,placeholder:"Example: max_source_resolution=5m&timeout=10"})})))))},Tt=xt({},Te.EventsWithValidation.onBlur,[Object(Te.regexValidation)(/^$|^\d+(ms|[Mwdhmsy])$/,"Value is not valid, you can use number with time unit specifier: y, M, w, d, h, m, s")]),It=function(e){return e?e.hasOwnProperty("currentTarget")?e.currentTarget.value:e.value:""},Rt=function(e,t,r){return function(n){r(wt({},t,{jsonData:wt({},t.jsonData,xt({},e,It(n)))}))}},qt=r("ZFWI");r.d(t,"plugin",(function(){return Dt}));var Ct=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.stepDefaultValuePlaceholder="60s"};Ct.templateUrl="partials/annotations.editor.html";var Dt=new n.DataSourcePlugin(je).setQueryEditor(ct).setConfigEditor((function(e){var t=e.options,r=e.onOptionsChange;return ke.a.createElement(ke.a.Fragment,null,ke.a.createElement(Te.DataSourceHttpSettings,{defaultUrl:"http://localhost:9090",dataSourceConfig:t,showAccessOptions:!0,onChange:r,sigV4AuthToggleEnabled:qt.a.sigV4AuthEnabled}),ke.a.createElement(kt,{options:t,onOptionsChange:r}))})).setExploreMetricsQueryField(bt).setAnnotationQueryCtrl(Ct).setExploreStartPage((function(e){return ke.a.createElement("div",null,ke.a.createElement("h2",null,"PromQL Cheat Sheet"),lt.map((function(t,r){return ke.a.createElement("div",{className:"cheat-sheet-item",key:r},ke.a.createElement("div",{className:"cheat-sheet-item__title"},t.title),t.expression?ke.a.createElement("div",{className:"cheat-sheet-item__example",onClick:function(r){return e.onClickExample({refId:"A",expr:t.expression})}},ke.a.createElement("code",null,t.expression)):null,ke.a.createElement("div",{className:"cheat-sheet-item__label"},t.label))})))}))},sGFA:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n=function(e){var t=!1;return{promise:new Promise((function(r,n){e.then((function(e){return t?n({isCanceled:!0}):r(e)})),e.catch((function(e){return n(t?{isCanceled:!0}:e)}))})),cancel:function(){t=!0}}}}}]);
//# sourceMappingURL=prometheusPlugin.591ee81e63053ad31983.js.map