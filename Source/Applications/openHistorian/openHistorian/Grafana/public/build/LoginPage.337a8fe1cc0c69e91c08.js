"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3883],{53153:(B,x,s)=>{s.d(x,{S:()=>m});var o=s(74848),t=s(96540),h=s(49785),l=s(13544),c=s(32264),E=s(40845),f=s(42418),_=s(88575),g=s(67061),d=s(55852),i=s(56034),u=s(4691),r=s(78361),n=s(35043);const m=({onSubmit:P,onSkip:a,showDefaultPasswordWarning:M})=>{const p=(0,E.of)(u.$),[D,y]=(0,t.useState)(!1),[L,A]=(0,t.useState)(!0),{handleSubmit:v,register:T,getValues:U,formState:{errors:e},watch:C}=(0,h.mN)({defaultValues:{newPassword:"",confirmNew:""}}),j=C("newPassword"),I=O=>{P(O.newPassword)};return(0,o.jsxs)("form",{onSubmit:v(I),children:[M&&(0,o.jsx)(f.F,{severity:"info",title:"Continuing to use the default password exposes you to security risks."}),(0,o.jsx)(_.D,{label:"New password",invalid:!!e.newPassword,error:e?.newPassword?.message,children:(0,o.jsx)(r.s,{onFocus:()=>y(!0),...T("newPassword",{required:"New Password is required",onBlur:()=>A(!1),validate:{strongPasswordValidationRegister:n.DP}}),id:"new-password",autoFocus:!0,autoComplete:"new-password"})}),D&&(0,o.jsx)(n.zJ,{pristine:L,password:j,strongPasswordValidations:n.NQ}),(0,o.jsx)(_.D,{label:"Confirm new password",invalid:!!e.confirmNew,error:e?.confirmNew?.message,children:(0,o.jsx)(r.s,{...T("confirmNew",{required:"Confirmed Password is required",validate:O=>O===U().newPassword||"Passwords must match!"}),id:"confirm-new-password",autoComplete:"new-password"})}),(0,o.jsxs)(g.B,{direction:"column",children:[(0,o.jsx)(d.$n,{type:"submit",className:p.submitButton,children:"Submit"}),!c.$.auth.basicAuthStrongPasswordPolicy&&a&&(0,o.jsx)(i.m,{content:"If you skip you will be prompted to change password next time you log in.",placement:"bottom",children:(0,o.jsx)(d.$n,{className:p.skipButton,fill:"text",onClick:a,type:"button","data-testid":l.Tp.pages.Login.skip,children:"Skip"})})]})]})}},87570:(B,x,s)=>{s.d(x,{A:()=>_});var o=s(74848),t=s(96540),h=s(17172),l=s(2913),c=s(8484);const E=()=>!!l.Ay.oauth&&Object.keys(l.Ay.oauth).length>0;class f extends t.PureComponent{constructor(u){super(u),this.changePassword=r=>{const n={newPassword:r,confirmNew:r,oldPassword:"admin"};if(this.props.resetCode){const m={code:this.props.resetCode,newPassword:r,confirmPassword:r};(0,h.AI)().post("/api/user/password/reset",m).then(()=>{this.toGrafana()})}else(0,h.AI)().put("/api/user/password",n).then(()=>{this.toGrafana()}).catch(m=>console.error(m))},this.login=r=>{this.setState({loginErrorMessage:void 0,isLoggingIn:!0}),(0,h.AI)().post("/login",r,{showErrorAlert:!1}).then(n=>{if(this.result=n,r.password!=="admin"||l.Ay.ldapEnabled||l.Ay.authProxyEnabled){this.toGrafana();return}else this.changeView(r.password==="admin")}).catch(n=>{const m=(0,h.NF)(n)?g(n):void 0;this.setState({isLoggingIn:!1,loginErrorMessage:m||(0,c.t)("login.error.unknown","Unknown error occurred")})})},this.changeView=r=>{this.setState({isChangingPassword:!0,showDefaultPasswordWarning:r})},this.toGrafana=()=>{if(l.Ay.featureToggles.useSessionStorageForRedirection){window.location.assign(l.Ay.appSubUrl+"/");return}this.result?.redirectUrl?l.Ay.appSubUrl!==""&&!this.result.redirectUrl.startsWith(l.Ay.appSubUrl)?window.location.assign(l.Ay.appSubUrl+this.result.redirectUrl):window.location.assign(this.result.redirectUrl):window.location.assign(l.Ay.appSubUrl+"/")},this.state={isLoggingIn:!1,isChangingPassword:!1,showDefaultPasswordWarning:!1,loginErrorMessage:d(l.Ay.loginError)}}render(){const{children:u}=this.props,{isLoggingIn:r,isChangingPassword:n,showDefaultPasswordWarning:m,loginErrorMessage:P}=this.state,{login:a,toGrafana:M,changePassword:p}=this,{loginHint:D,passwordHint:y,disableLoginForm:L,disableUserSignUp:A}=l.Ay;return(0,o.jsx)(o.Fragment,{children:u({isOauthEnabled:E(),loginHint:D,passwordHint:y,disableLoginForm:L,disableUserSignUp:A,login:a,isLoggingIn:r,changePassword:p,skipPasswordChange:M,isChangingPassword:n,showDefaultPasswordWarning:m,loginErrorMessage:P})})}}const _=f;function g(i){switch(i.data?.messageId){case"password-auth.empty":case"password-auth.failed":case"password-auth.invalid":return(0,c.t)("login.error.invalid-user-or-password","Invalid username or password");case"login-attempt.blocked":return(0,c.t)("login.error.blocked","You have exceeded the number of login attempts for this user. Please try again later.");default:return i.data?.message}}function d(i){switch(i){case"oauth.login.error":return(0,c.t)("oauth.login.error","Login provider denied login request");default:return i}}},4691:(B,x,s)=>{s.d(x,{$:()=>r,Q:()=>u});var o=s(74848),t=s(32196),h=s(96540),l=s(49785),c=s(13544),E=s(40845),f=s(88575),_=s(10354),g=s(55852),d=s(8484),i=s(78361);const u=({children:n,onSubmit:m,isLoggingIn:P,passwordHint:a,loginHint:M})=>{const p=(0,E.of)(r),D=(0,h.useId)(),y=(0,h.useId)(),{handleSubmit:L,register:A,formState:{errors:v}}=(0,l.mN)({mode:"onChange"});return(0,o.jsx)("div",{className:p.wrapper,children:(0,o.jsxs)("form",{onSubmit:L(m),children:[(0,o.jsx)(f.D,{label:(0,d.t)("login.form.username-label","Email or username"),invalid:!!v.user,error:v.user?.message,children:(0,o.jsx)(_.p,{...A("user",{required:(0,d.t)("login.form.username-required","Email or username is required")}),id:D,autoFocus:!0,autoCapitalize:"none",placeholder:M||(0,d.t)("login.form.username-placeholder","email or username"),"data-testid":c.Tp.pages.Login.username})}),(0,o.jsx)(f.D,{label:(0,d.t)("login.form.password-label","Password"),invalid:!!v.password,error:v.password?.message,children:(0,o.jsx)(i.s,{...A("password",{required:(0,d.t)("login.form.password-required","Password is required")}),id:y,autoComplete:"current-password",placeholder:a||(0,d.t)("login.form.password-placeholder","password")})}),(0,o.jsx)(g.$n,{type:"submit","data-testid":c.Tp.pages.Login.submit,className:p.submitButton,disabled:P,children:P?(0,d.t)("login.form.submit-loading-label","Logging in..."):(0,d.t)("login.form.submit-label","Log in")}),n]})})},r=n=>({wrapper:(0,t.css)({width:"100%",paddingBottom:n.spacing(2)}),submitButton:(0,t.css)({justifyContent:"center",width:"100%"}),skipButton:(0,t.css)({alignSelf:"flex-start"})})},20851:(B,x,s)=>{s.d(x,{GU:()=>_,YO:()=>d,qm:()=>f});var o=s(74848),t=s(32196),h=s(96540),l=s(40845),c=s(19361),E=s(38645);const f=({children:i,enterAnimation:u=!0})=>{const r=(0,l.of)(d);return(0,o.jsx)("div",{className:(0,t.cx)(r.loginInnerBox,u&&r.enterAnimation),children:i})},_=({children:i,branding:u,isChangingPassword:r})=>{const n=(0,l.of)(d),[m,P]=(0,h.useState)(!1),a=u?.loginSubtitle??c.M.GetLoginSubTitle(),M=u?.loginTitle??c.M.LoginTitle,p=u?.loginBoxBackground||c.M.LoginBoxBackground(),D=u?.loginLogo,y=u?.hideEdition??c.M.HideEdition;return(0,h.useEffect)(()=>P(!0),[]),(0,o.jsxs)(c.M.LoginBackground,{className:(0,t.cx)(n.container,m&&n.loginAnim,u?.loginBackground),children:[(0,o.jsx)("div",{className:n.loginMain,children:(0,o.jsxs)("div",{className:(0,t.cx)(n.loginContent,p,"login-content-box"),children:[(0,o.jsxs)("div",{className:n.loginLogoWrapper,children:[(0,o.jsx)(c.M.LoginLogo,{className:n.loginLogo,logo:D}),(0,o.jsx)("div",{className:n.titleWrapper,children:r?(0,o.jsx)("h1",{className:n.mainTitle,children:"Update your password"}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h1",{className:n.mainTitle,children:M}),a&&(0,o.jsx)("h3",{className:n.subTitle,children:a})]})})]}),(0,o.jsx)("div",{className:n.loginOuterBox,children:i})]})}),u?.hideFooter?(0,o.jsx)(o.Fragment,{}):(0,o.jsx)(E.wi,{hideEdition:y,customLinks:u?.footerLinks})]})},g=(0,t.keyframes)`
from{
  opacity: 0;
  transform: translate(-60px, 0px);
}

to{
  opacity: 1;
  transform: translate(0px, 0px);
}`,d=i=>({loginMain:(0,t.css)({flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minWidth:"100%"}),container:(0,t.css)({minHeight:"100%",backgroundPosition:"center",backgroundRepeat:"no-repeat",flex:1,minWidth:"100%",marginLeft:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}),loginAnim:(0,t.css)({"&:before":{opacity:1},".login-content-box":{opacity:1}}),submitButton:(0,t.css)({justifyContent:"center",width:"100%"}),loginLogo:(0,t.css)({width:"100%",maxWidth:60,marginBottom:i.spacing(2),[i.breakpoints.up("sm")]:{maxWidth:100}}),loginLogoWrapper:(0,t.css)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",padding:i.spacing(3)}),titleWrapper:(0,t.css)({textAlign:"center"}),mainTitle:(0,t.css)({fontSize:22,[i.breakpoints.up("sm")]:{fontSize:32}}),subTitle:(0,t.css)({fontSize:i.typography.size.md,color:i.colors.text.secondary}),loginContent:(0,t.css)({maxWidth:478,width:"calc(100% - 2rem)",display:"flex",alignItems:"stretch",flexDirection:"column",position:"relative",justifyContent:"flex-start",zIndex:1,minHeight:320,borderRadius:i.shape.radius.default,padding:i.spacing(2,0),opacity:0,[i.transitions.handleMotion("no-preference","reduce")]:{transition:"opacity 0.5s ease-in-out"},[i.breakpoints.up("sm")]:{minHeight:i.spacing(40),justifyContent:"center"}}),loginOuterBox:(0,t.css)({display:"flex",overflowY:"hidden",alignItems:"center",justifyContent:"center"}),loginInnerBox:(0,t.css)({padding:i.spacing(0,2,2,2),display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flexGrow:1,maxWidth:415,width:"100%",transform:"translate(0px, 0px)",[i.transitions.handleMotion("no-preference")]:{transition:"0.25s ease"}}),enterAnimation:(0,t.css)({[i.transitions.handleMotion("no-preference")]:{animation:`${g} ease-out 0.2s`}})})},57041:(B,x,s)=>{s.r(x),s.d(x,{default:()=>T});var o=s(74848),t=s(32196),h=s(32264),l=s(40845),c=s(42418),E=s(67061),f=s(55852),_=s(19361),g=s(8484),d=s(53153),i=s(87570),u=s(4691),r=s(20851),n=s(2543),m=s(58649),P=s(14578),a=s(2913);const M=()=>{const e=!!a.Ay.oauth;return{saml:{bgColor:"#464646",enabled:a.Ay.samlEnabled,name:a.Ay.samlName||m.En,icon:"key-skeleton-alt"},google:{bgColor:"#e84d3c",enabled:e&&!!a.Ay.oauth.google,name:a.Ay.oauth?.google?.name||"Google",icon:a.Ay.oauth?.google?.icon||"google"},azuread:{bgColor:"#2f2f2f",enabled:e&&!!a.Ay.oauth.azuread,name:a.Ay.oauth?.azuread?.name||"Microsoft",icon:a.Ay.oauth?.azuread?.icon||"microsoft"},github:{bgColor:"#464646",enabled:e&&!!a.Ay.oauth.github,name:a.Ay.oauth?.github?.name||"GitHub",icon:a.Ay.oauth?.github?.icon||"github"},gitlab:{bgColor:"#fc6d26",enabled:e&&!!a.Ay.oauth.gitlab,name:a.Ay.oauth?.gitlab?.name||"GitLab",icon:a.Ay.oauth?.gitlab?.icon||"gitlab"},grafanacom:{bgColor:"#262628",enabled:e&&!!a.Ay.oauth.grafana_com,name:a.Ay.oauth?.grafana_com?.name||"Grafana.com",icon:a.Ay.oauth?.grafana_com?.icon||"grafana",hrefName:"grafana_com"},okta:{bgColor:"#2f2f2f",enabled:e&&!!a.Ay.oauth.okta,name:a.Ay.oauth?.okta?.name||"Okta",icon:a.Ay.oauth?.okta?.icon||"okta"},oauth:{bgColor:"#262628",enabled:e&&!!a.Ay.oauth.generic_oauth,name:a.Ay.oauth?.generic_oauth?.name||"OAuth",icon:a.Ay.oauth?.generic_oauth?.icon||"signin",hrefName:"generic_oauth"}}},p=e=>({button:(0,t.css)({color:"#d8d9da",position:"relative"}),buttonIcon:(0,t.css)({position:"absolute",left:e.spacing(1),top:"50%",transform:"translateY(-50%)"}),divider:{base:(0,t.css)({color:e.colors.text.primary,display:"flex",marginBottom:e.spacing(1),justifyContent:"space-between",textAlign:"center",width:"100%"}),line:(0,t.css)({width:100,height:10,borderBottom:`1px solid ${e.colors.text}`})}}),D=()=>{const e=(0,l.of)(p);return(0,o.jsxs)("div",{className:e.divider.base,children:[(0,o.jsx)("div",{children:(0,o.jsx)("div",{className:e.divider.line})}),(0,o.jsx)("div",{children:(0,o.jsx)("span",{children:!a.Ay.disableLoginForm&&(0,o.jsx)("span",{children:"or"})})}),(0,o.jsx)("div",{children:(0,o.jsx)("div",{className:e.divider.line})})]})};function y(e,C,j){return(0,t.cx)(C.button,(0,t.css)({backgroundColor:e.bgColor,color:j.colors.getContrastText(e.bgColor),"&:hover":{backgroundColor:j.colors.emphasize(e.bgColor,.15),boxShadow:j.shadows.z1}}))}const L=()=>{const e=(0,n.pickBy)(M(),O=>O.enabled),C=Object.keys(e).length>0,j=(0,l.$j)(),I=(0,l.of)(p);return C?(0,o.jsxs)(E.B,{direction:"column",width:"100%",children:[(0,o.jsx)(D,{}),Object.entries(e).map(([O,w])=>{const W=w.name;return(0,o.jsxs)(f.z9,{className:y(w,I,j),href:`login/${w.hrefName?w.hrefName:O}`,target:"_self",fullWidth:!0,children:[(0,o.jsx)(P.I,{className:I.buttonIcon,name:w.icon}),(0,o.jsxs)(g.x6,{i18nKey:"login.services.sing-in-with-prefix",children:["Sign in with ",{serviceName:W}]})]},O)})]}):null},A=()=>{const e=(0,a.zj)().verifyEmailEnabled?`${(0,a.zj)().appSubUrl}/verify`:`${(0,a.zj)().appSubUrl}/signup`,C=(0,t.css)({paddingTop:"16px"});return(0,o.jsxs)(E.B,{direction:"column",children:[(0,o.jsx)("div",{className:C,children:(0,o.jsx)(g.x6,{i18nKey:"login.signup.new-to-question",children:"New to Grafana?"})}),(0,o.jsx)(f.z9,{className:(0,t.css)({width:"100%",justifyContent:"center"}),href:e,variant:"secondary",fill:"outline",children:(0,o.jsx)(g.x6,{i18nKey:"login.signup.button-label",children:"Sign up"})})]})},T=()=>{const e=(0,l.of)(U);return document.title=_.M.AppTitle,(0,o.jsx)(i.A,{children:({loginHint:C,passwordHint:j,disableLoginForm:I,disableUserSignUp:O,login:w,isLoggingIn:W,changePassword:R,skipPasswordChange:K,isChangingPassword:b,showDefaultPasswordWarning:N,loginErrorMessage:S})=>(0,o.jsxs)(r.GU,{isChangingPassword:b,children:[!b&&(0,o.jsxs)(r.qm,{children:[S&&(0,o.jsx)(c.F,{className:e.alert,severity:"error",title:(0,g.t)("login.error.title","Login failed"),children:S}),!I&&(0,o.jsx)(u.Q,{onSubmit:w,loginHint:C,passwordHint:j,isLoggingIn:W,children:(0,o.jsx)(E.B,{justifyContent:"flex-end",children:!h.$.auth.disableLogin&&(0,o.jsx)(f.z9,{className:e.forgottenPassword,fill:"text",href:`${h.$.appSubUrl}/user/password/send-reset-email`,children:(0,o.jsx)(g.x6,{i18nKey:"login.forgot-password",children:"Forgot your password?"})})})}),(0,o.jsx)(L,{}),!O&&(0,o.jsx)(A,{})]}),b&&(0,o.jsx)(r.qm,{children:(0,o.jsx)(d.S,{showDefaultPasswordWarning:N,onSubmit:R,onSkip:()=>K()})})]})})},U=e=>({forgottenPassword:(0,t.css)({padding:0,marginTop:e.spacing(.5)}),alert:(0,t.css)({width:"100%"})})},78361:(B,x,s)=>{s.d(x,{s:()=>E});var o=s(74848),t=s(96540),h=s(13544),l=s(10354),c=s(29158);const E=(0,t.forwardRef)((f,_)=>{const[g,d]=(0,t.useState)(!1);return(0,o.jsx)(l.p,{...f,type:g?"text":"password","data-testid":h.Tp.pages.Login.password,ref:_,suffix:(0,o.jsx)(c.K,{name:g?"eye-slash":"eye","aria-controls":f.id,role:"switch","aria-checked":g,onClick:()=>{d(!g)},tooltip:g?"Hide password":"Show password"})})});E.displayName="PasswordField"},35043:(B,x,s)=>{s.d(x,{DP:()=>d,NQ:()=>g,zJ:()=>i});var o=s(74848),t=s(32196),h=s(90613),l=s(40845),c=s(14578),E=s(94753),f=s(2913),_=s(8484);const g=[{message:"At least 12 characters",validation:n=>n.length>=12},{message:"One uppercase letter",validation:n=>/[A-Z]+/.test(n)},{message:"One lowercase letter",validation:n=>/[a-z]+/.test(n)},{message:"One number",validation:n=>/[0-9]+/.test(n)},{message:"One symbol",validation:n=>/[\W]/.test(n)}],d=n=>!f.Ay.auth.basicAuthStrongPasswordPolicy||g.every(m=>m.validation(n))||(0,_.t)("profile.change-password.strong-password-validation-register","Password does not comply with the strong password policy"),i=({strongPasswordValidations:n,password:m,pristine:P})=>(0,o.jsx)(h.a,{marginBottom:2,children:n.map(a=>(0,o.jsx)(u,{strongPasswordValidation:a,password:m,pristine:P},a.message))}),u=({strongPasswordValidation:n,password:m,pristine:P})=>{const a=(0,l.of)(r),{basicAuthStrongPasswordPolicy:M}=f.Ay.auth;if(!M)return null;const{message:p,validation:D}=n,y=m.length>0&&D(m),L=y||P?"check":"exclamation-triangle",A=y?"secondary":P?"primary":"error";let v;return y?v=a.icon.valid:P?v=a.icon.pending:v=a.icon.error,(0,o.jsxs)(h.a,{display:"flex",alignItems:"center",marginTop:1,children:[(0,o.jsx)(c.I,{className:(0,t.cx)(a.icon.style,v),name:L}),(0,o.jsx)(E.E,{color:A,children:p})]},p)},r=n=>({icon:{style:(0,t.css)({marginRight:n.spacing(1)}),valid:(0,t.css)({color:n.colors.success.text}),pending:(0,t.css)({color:n.colors.secondary.text}),error:(0,t.css)({color:n.colors.error.text})}})}}]);

//# sourceMappingURL=LoginPage.337a8fe1cc0c69e91c08.js.map