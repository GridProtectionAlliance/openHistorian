"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4333],{30027:(U,O,a)=>{a.r(O),a.d(O,{BrowseFolderAlertingPage:()=>Z,default:()=>w});var s=a(74848),c=a(96540),r=a(54148),n=a(21780),A=a(71101),D=a(31678),e=a(32196),g=a(2543),h=a(40996),E=a(40845),f=a(67061),x=a(67647),j=a(90182),d=a(14578),m=a(10860),B=a(64149),M=a(19384),F=a(15054),b=a(21969),C=a(9518),v=a(98439),K=a(39964),L=a(26627),y=a(98164),T=a(57220),z=a(32642),V=a(78742),G=(t=>(t.Ascending="alpha-asc",t.Descending="alpha-desc",t))(G||{});const p=[{label:"Alphabetically [A-Z]",value:"alpha-asc"},{label:"Alphabetically [Z-A]",value:"alpha-desc"}],S=({folder:t})=>{const o=(0,E.of)(Q),l=(0,D.useDispatch)(),I=P=>{const k=(0,y.EU)(i,P);Y(k)};(0,c.useEffect)(()=>{l((0,L.mB)({rulesSourceName:T.hY})),l((0,L.eB)({rulesSourceName:T.hY}))},[l]);const _=(0,C.dy)(T.hY),{nameFilter:R,labelFilter:i,sortOrder:u,setNameFilter:W,setLabelFilter:Y,setSortOrder:sa}=N(),q=_.find(P=>P.uid===t.uid)?.groups.flatMap(P=>P.rules)??[],aa=J(q,R,i,u??"alpha-asc"),ea=q.length===0||aa.length===0,{page:ta,numberOfPages:na,onPageChange:oa,pageItems:ra}=(0,v.W)(aa,1,F.FG);return(0,s.jsx)("div",{className:o.container,children:(0,s.jsxs)(f.B,{direction:"column",gap:3,children:[(0,s.jsx)(x.Z,{value:R,onChange:W,placeholder:"Search alert rules by name","data-testid":"name-filter"}),(0,s.jsxs)(f.B,{direction:"row",children:[(0,s.jsx)(j.l6,{value:u,onChange:({value:P})=>P&&sa(P),options:p,width:25,"aria-label":"Sort",placeholder:"Sort (Default A-Z)",prefix:(0,s.jsx)(d.I,{name:u==="alpha-asc"?"sort-amount-up":"sort-amount-down"})}),(0,s.jsx)(x.Z,{value:i,onChange:Y,placeholder:"Search alerts by labels",className:o.filterLabelsInput,"data-testid":"label-filter"})]}),(0,s.jsx)(f.B,{direction:"column",gap:1,children:ra.map(P=>(0,s.jsxs)(m.Z,{href:(0,V.w$)("grafana",P,""),className:o.card,"data-testid":"alert-card-row",children:[(0,s.jsx)(m.Z.Heading,{children:P.name}),(0,s.jsx)(m.Z.Tags,{children:(0,s.jsx)(B.L,{onClick:I,tags:Object.entries(P.labels).map(([k,la])=>`${k}=${la}`)})}),(0,s.jsx)(m.Z.Meta,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)(d.I,{name:"folder"})," ",t.title]})})]},P.name))}),ea&&(0,s.jsx)("div",{className:o.noResults,children:"No alert rules found"}),(0,s.jsx)("div",{className:o.pagination,children:(0,s.jsx)(M.d,{currentPage:ta,numberOfPages:na,onNavigate:oa,hideWhenSinglePage:!0})})]})})};var H=(t=>(t.nameFilter="nameFilter",t.labelFilter="labelFilter",t.sortOrder="sort",t))(H||{});function N(){const[t,o]=(0,K.l)(),[l,I]=(0,c.useState)(t.get("nameFilter")??""),[_,R]=(0,c.useState)(t.get("labelFilter")??""),i=t.get("sort"),[u,W]=(0,c.useState)(i==="alpha-asc"?"alpha-asc":i==="alpha-desc"?"alpha-desc":void 0);return(0,h.A)(()=>o({nameFilter:(0,b.fE)(l),labelFilter:(0,b.fE)(_),sort:(0,b.fE)(u)},!0),400,[l,_,u]),{nameFilter:l,labelFilter:_,sortOrder:u,setNameFilter:I,setLabelFilter:R,setSortOrder:W}}function J(t,o,l,I){const _=(0,z.Zc)(l),R=t.filter(i=>i.name.toLowerCase().includes(o.toLowerCase())&&(0,y.Av)(i.labels,_));return(0,g.orderBy)(R,i=>i.name.toLowerCase(),[I==="alpha-asc"?"asc":"desc"])}const Q=t=>({container:(0,e.css)({padding:t.spacing(1)}),card:(0,e.css)({gridTemplateColumns:"auto 1fr 2fr",margin:0}),pagination:(0,e.css)({alignSelf:"center"}),filterLabelsInput:(0,e.css)({flex:1,width:"auto",minWidth:"240px"}),noResults:(0,e.css)({padding:t.spacing(2),backgroundColor:t.colors.background.secondary,fontStyle:"italic"})});var $=a(55314),X=a(9134);function Z(){const{uid:t=""}=(0,r.g)(),{data:o}=(0,$.kH)(t),l=(0,D.useSelector)(i=>i.folder),[I]=(0,$.iB)(),_=(0,c.useMemo)(()=>{if(!o)return;const i=(0,A.R4)(o),u=(0,A.Fk)(o.uid),W=i.children?.find(Y=>Y.id===u);return W&&(W.active=!0),i},[o]),R=t?async i=>{if(o){const u=await I({...o,title:i});if("error"in u)throw u.error}}:void 0;return(0,s.jsx)(n.YW,{navId:"dashboards/browse",pageNav:_,onEditTitle:R,actions:(0,s.jsx)(s.Fragment,{children:o&&(0,s.jsx)(X.m,{folder:o})}),children:(0,s.jsx)(n.YW.Contents,{children:(0,s.jsx)(S,{folder:l})})})}const w=Z},18241:(U,O,a)=>{a.d(O,{T:()=>x});var s=a(74848),c=a(96540),r=a(14110),n=a(32264),A=a(96374),D=a(94753),e=a(68402),g=a(42418),h=a(8484),E=a(55314),f=a(43907);const x=({onConfirm:j,onDismiss:d,selectedItems:m,...B})=>{const{data:M}=(0,E.G2)(m),F=!!(M&&(M.alertRule||M.libraryPanel)),[b,C]=(0,c.useState)(!1),v=async()=>{(0,r.rR)("grafana_manage_dashboards_delete_clicked",{item_counts:{dashboard:Object.keys(m.dashboard).length,folder:Object.keys(m.folder).length},source:"browse_dashboards",restore_enabled:n.$.featureToggles.dashboardRestoreUI}),C(!0);try{await j(),C(!1),d()}catch{C(!1)}};return(0,s.jsx)(A.u,{body:(0,s.jsxs)(s.Fragment,{children:[n.$.featureToggles.dashboardRestore&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(D.E,{element:"p",children:(0,s.jsx)(h.x6,{i18nKey:"browse-dashboards.action.delete-modal-restore-dashboards-text",children:"This action will delete the selected folders immediately but the selected dashboards will be marked for deletion in 30 days. Your organization administrator can restore the dashboards anytime before the 30 days expire. Folders cannot be restored."})}),(0,s.jsx)(e.$,{v:2})]}),(0,s.jsx)(D.E,{element:"p",children:(0,s.jsx)(h.x6,{i18nKey:"browse-dashboards.action.delete-modal-text",children:"This action will delete the following content:"})}),(0,s.jsx)(f.x,{selectedItems:m}),(0,s.jsx)(e.$,{v:2})]}),description:(0,s.jsx)(s.Fragment,{children:F?(0,s.jsx)(g.F,{severity:"warning",title:(0,h.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder"),children:(0,s.jsx)(h.x6,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text",children:"One or more folders contain library panels or alert rules. Delete these first in order to proceed."})}):null}),confirmationText:(0,h.t)("browse-dashboards.action.confirmation-text","Delete"),confirmText:b?(0,h.t)("browse-dashboards.action.deleting","Deleting..."):(0,h.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:d,onConfirm:v,title:(0,h.t)("browse-dashboards.action.delete-modal-title","Delete"),...B,disabled:F})}},51887:(U,O,a)=>{a.d(O,{J:()=>x});var s=a(74848),c=a(96540),r=a(37390),n=a(42418),A=a(94753),D=a(68402),e=a(88575),g=a(55852),h=a(36607),E=a(8484),f=a(43907);const x=({onConfirm:j,onDismiss:d,selectedItems:m,...B})=>{const[M,F]=(0,c.useState)(),[b,C]=(0,c.useState)(!1),v=Object.keys(m.folder).filter(L=>m.folder[L]),K=async()=>{if(M!==void 0){C(!0);try{await j(M),C(!1),d()}catch{C(!1)}}};return(0,s.jsxs)(r.a,{title:(0,E.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:d,...B,children:[v.length>0&&(0,s.jsx)(n.F,{severity:"info",title:(0,E.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),(0,s.jsx)(A.E,{element:"p",children:(0,s.jsx)(E.x6,{i18nKey:"browse-dashboards.action.move-modal-text",children:"This action will move the following content:"})}),(0,s.jsx)(f.x,{selectedItems:m}),(0,s.jsx)(D.$,{v:3}),(0,s.jsx)(e.D,{label:(0,E.t)("browse-dashboards.action.move-modal-field-label","Folder name"),children:(0,s.jsx)(h.d,{value:M,excludeUIDs:v,onChange:F})}),(0,s.jsxs)(r.a.ButtonRow,{children:[(0,s.jsx)(g.$n,{onClick:d,variant:"secondary",fill:"outline",children:(0,s.jsx)(E.x6,{i18nKey:"browse-dashboards.action.cancel-button",children:"Cancel"})}),(0,s.jsx)(g.$n,{disabled:M===void 0||b,onClick:K,variant:"primary",children:b?(0,E.t)("browse-dashboards.action.moving","Moving..."):(0,E.t)("browse-dashboards.action.move-button","Move")})]})]})}},9134:(U,O,a)=>{a.d(O,{m:()=>C});var s=a(74848),c=a(96540),r=a(32264),n=a(14110),A=a(39601),D=a(38138),e=a(64539),g=a(83122),h=a(55852),E=a(14578),f=a(87978),x=a(5108),j=a(10096),d=a(8484),m=a(28444),B=a(55314),M=a(49904),F=a(18241),b=a(51887);function C({folder:v}){const[K,L]=(0,c.useState)(!1),[y,T]=(0,c.useState)(!1),[z]=(0,B.aF)(),[V]=(0,B.Ko)(),{canEditFolders:G,canDeleteFolders:p,canViewPermissions:S,canSetPermissions:H}=(0,M.N)(v),N=r.$.featureToggles.nestedFolders&&G,J=async l=>{await z({folder:v,destinationUID:l}),(0,n.rR)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},Q=async()=>{await V(v),(0,n.rR)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:l}=v,I=l&&l.length?l[l.length-1].url:"/dashboards";A.Ny.push(I)},$=()=>{j.lE.publish(new m.S8({component:b.J,props:{selectedItems:{folder:{[v.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:J}}))},X=()=>{j.lE.publish(new m.S8({component:F.T,props:{selectedItems:{folder:{[v.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:Q}}))},Z=(0,d.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),w=(0,d.t)("browse-dashboards.folder-actions-button.move","Move"),t=(0,d.t)("browse-dashboards.folder-actions-button.delete","Delete"),o=(0,s.jsxs)(D.W,{children:[S&&(0,s.jsx)(e.D,{onClick:()=>T(!0),label:Z}),N&&(0,s.jsx)(e.D,{onClick:$,label:w}),p&&(0,s.jsx)(e.D,{destructive:!0,onClick:X,label:t})]});return!S&&!N&&!p?null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.m,{overlay:o,onVisibleChange:L,children:(0,s.jsxs)(h.$n,{variant:"secondary",children:[(0,s.jsx)(d.x6,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions",children:"Folder actions"}),(0,s.jsx)(E.I,{name:K?"angle-up":"angle-down"})]})}),y&&(0,s.jsx)(f._,{title:(0,d.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:v.title,onClose:()=>T(!1),size:"md",children:(0,s.jsx)(x.x,{resource:"folders",resourceId:v.uid,canSetPermissions:H})})]})}},49904:(U,O,a)=>{a.d(O,{N:()=>D});var s=a(32264),c=a(10096),r=a(31678);function n(e,g){return g?c.TP.hasPermissionInMetadata(e,g):c.TP.hasPermission(e)}function A(e){return e&&e.uid!=="general"&&!s.$.featureToggles.nestedFolders?!1:s.$.featureToggles.accessActionSets?n(r.AccessControlAction.FoldersCreate,e):!e||e.uid==="general"?n(r.AccessControlAction.FoldersCreate):n(r.AccessControlAction.FoldersCreate)&&n(r.AccessControlAction.FoldersWrite,e)}function D(e){const g=n(r.AccessControlAction.DashboardsCreate,e),h=A(e),E=n(r.AccessControlAction.FoldersDelete,e),f=n(r.AccessControlAction.DashboardsWrite,e),x=n(r.AccessControlAction.FoldersWrite,e),j=n(r.AccessControlAction.FoldersPermissionsWrite,e),d=n(r.AccessControlAction.FoldersPermissionsRead,e);return{canCreateDashboards:g,canCreateFolders:h,canDeleteFolders:E,canEditDashboards:f,canEditFolders:x,canSetPermissions:j,canViewPermissions:d}}}}]);

//# sourceMappingURL=FolderAlerting.acb413647e3b8ab01f88.js.map