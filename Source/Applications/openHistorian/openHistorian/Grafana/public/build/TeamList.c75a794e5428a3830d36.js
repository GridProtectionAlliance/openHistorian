"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9671],{77830:(y,P,a)=>{a.d(P,{f:()=>T});var e=a(68404),A=a(671),r=a(77582),E=a(81168),g=a(17069),f=a(11630);const T=({teamId:i,roleOptions:c,disabled:n,onApplyRoles:o,pendingRoles:l,apply:d=!1,maxWidth:h})=>{const[{loading:C,value:p=[]},O]=(0,A.Z)(async()=>{try{if(d&&Boolean(l?.length))return l;if(r.Vt.hasPermission(E.AccessControlAction.ActionTeamsRolesList))return await(0,f._C)(i)}catch(v){console.error("Error loading options",v)}return[]},[i,l]);(0,e.useEffect)(()=>{O()},[i,O,l]);const U=async v=>{d?o&&o(v):(await(0,f.u7)(v,i),await O())},I=r.Vt.hasPermission(E.AccessControlAction.ActionTeamsRolesAdd)&&r.Vt.hasPermission(E.AccessControlAction.ActionTeamsRolesRemove);return e.createElement(g.I,{apply:d,onRolesChange:U,roleOptions:c,appliedRoles:p,isLoading:C,disabled:n,basicRoleDisabled:!0,canUpdateRoles:I,maxWidth:h})}},73635:(y,P,a)=>{a.d(P,{$:()=>T});var e=a(24420),A=a.n(e),r=a(68404),E=a(36635),g=a(81168),f=a(70431);const T=(i,c,n)=>o=>{const l=(0,E.connect)(i,c)(o),d=h=>{const C=(0,g.useDispatch)();return(0,r.useEffect)(()=>function(){C((0,f.e)({cleanupAction:n}))},[C]),r.createElement(l,{...h})};return d.displayName=`ConnectWithCleanUp(${l.displayName})`,A()(d,o),d}},77293:(y,P,a)=>{a.d(P,{Yb:()=>A,d5:()=>E});var e=a(35645);const A=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function r(){const g=e.v.licenseInfo?.trialExpiry;return!!(g&&g>0)}const E=()=>r()&&e.v.featureToggles.featureHighlights},17721:(y,P,a)=>{a.r(P),a.d(P,{TeamList:()=>I,default:()=>s});var e=a(68404),A=a(14747),r=a(31403),E=a(52081),g=a(78889),f=a(69142),T=a(79396),i=a(11630),c=a(47694),n=a(82002),o=a(81168),l=a(73635),d=a(13626),h=a(77830);const C=({team:t,roleOptions:m,isTeamAdmin:u,displayRolePicker:D,onDelete:L})=>{const M=`org/teams/edit/${t.id}`,R=n.Vt.hasAccessInMetadata(o.AccessControlAction.ActionTeamsDelete,t,u),_=n.Vt.hasAccessInMetadata(o.AccessControlAction.ActionTeamsRead,t,u),x=n.Vt.hasAccessInMetadata(o.AccessControlAction.ActionTeamsRolesList,t,!1);return e.createElement("tr",{key:t.id},e.createElement("td",{className:"width-4 text-center link-td"},_?e.createElement("a",{href:M},e.createElement("img",{className:"filter-table__avatar",src:t.avatarUrl,alt:"Team avatar"})):e.createElement("img",{className:"filter-table__avatar",src:t.avatarUrl,alt:"Team avatar"})),e.createElement("td",{className:"link-td"},_?e.createElement("a",{href:M},t.name):e.createElement("div",{style:{padding:"0px 8px"}},t.name)),e.createElement("td",{className:"link-td"},_?e.createElement("a",{href:M,"aria-label":t.email||"Empty email cell"},t.email):e.createElement("div",{style:{padding:"0px 8px"},"aria-label":t.email||"Empty email cell"},t.email)),e.createElement("td",{className:"link-td"},_?e.createElement("a",{href:M},t.memberCount):e.createElement("div",{style:{padding:"0px 8px"}},t.memberCount)),D&&e.createElement("td",null,x&&e.createElement(h.f,{teamId:t.id,roleOptions:m})),e.createElement("td",{className:"text-right"},e.createElement(d.m,{"aria-label":`Delete team ${t.name}`,size:"sm",disabled:!R,onConfirm:()=>L(t.id)})))};var p=a(13949),O=a(97189),U=a(3813);const I=({teams:t,page:m,query:u,noTeams:D,totalPages:L,hasFetched:M,loadTeams:R,deleteTeam:_,changeQuery:x,changePage:S,signedInUser:Z,editorsCanAdmin:V})=>{const[z,Q]=(0,e.useState)([]);(0,e.useEffect)(()=>{R(!0)},[R]),(0,e.useEffect)(()=>{n.Vt.licensedAccessControlEnabled()&&n.Vt.hasPermission(o.AccessControlAction.ActionRolesList)&&(0,i.ul)().then(B=>Q(B))},[]);const b=v(V),N=W();return e.createElement(T.T,{navId:"teams"},e.createElement(T.T.Contents,{isLoading:!M},D?e.createElement(f.Z,{title:"You haven't created any teams yet.",buttonIcon:"users-alt",buttonLink:"org/teams/new",buttonTitle:" New team",buttonDisabled:!n.Vt.hasPermission(o.AccessControlAction.ActionTeamsCreate),proTip:"Assign folder and dashboard permissions to teams instead of users to ease administration.",proTipLink:"",proTipLinkTitle:"",proTipTarget:"_blank"}):e.createElement(e.Fragment,null,e.createElement("div",{className:"page-action-bar"},e.createElement("div",{className:"gf-form gf-form--grow"},e.createElement(A.H,{placeholder:"Search teams",value:u,onChange:x})),e.createElement(r.Qj,{href:b?"org/teams/new":"#",disabled:!b},"New Team")),e.createElement("div",{className:"admin-list-table"},e.createElement(E.wc,{spacing:"md"},e.createElement("table",{className:"filter-table filter-table--hover form-inline"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null),e.createElement("th",null,"Name"),e.createElement("th",null,"Email"),e.createElement("th",null,"Members"),N&&e.createElement("th",null,"Roles"),e.createElement("th",{style:{width:"1%"}}))),e.createElement("tbody",null,t.map(B=>e.createElement(C,{key:B.id,team:B,roleOptions:z,displayRolePicker:N,isTeamAdmin:(0,U.kC)({permission:B.permission,editorsCanAdmin:V,signedInUser:Z}),onDelete:_})))),e.createElement(E.Lh,{justify:"flex-end"},e.createElement(g.t,{hideWhenSinglePage:!0,currentPage:m,numberOfPages:L,onNavigate:S})))))))};function v(t){const m=n.Vt.hasRole("Admin")||t&&n.Vt.hasRole("Editor");return n.Vt.hasAccess(o.AccessControlAction.ActionTeamsCreate,m)}function W(){return n.Vt.licensedAccessControlEnabled()&&n.Vt.hasPermission(o.AccessControlAction.ActionTeamsRolesList)&&n.Vt.hasPermission(o.AccessControlAction.ActionRolesList)}function K(t){return{teams:t.teams.teams,page:t.teams.page,query:t.teams.query,perPage:t.teams.perPage,noTeams:t.teams.noTeams,totalPages:t.teams.totalPages,hasFetched:t.teams.hasFetched,editorsCanAdmin:c.vc.editorsCanAdmin,signedInUser:n.Vt.user}}const $={loadTeams:p.jI,deleteTeam:p.fC,changePage:p.oO,changeQuery:p.R5},s=(0,l.$)(K,$,t=>t.teams=O.p3)(I)},13949:(y,P,a)=>{a.d(P,{A_:()=>W,Lt:()=>O,P5:()=>K,QX:()=>l,R5:()=>h,ei:()=>p,fC:()=>d,fs:()=>I,jI:()=>n,j_:()=>v,oO:()=>C,zT:()=>U,zZ:()=>$});var e=a(82897),A=a.n(e),r=a(54899),E=a(659),g=a(77582),f=a(95156),T=a(81168),i=a(87941),c=a(97189);function n(s=!1){return async(t,m)=>{const{query:u,page:D,perPage:L}=m().teams;if(!g.Vt.hasPermission(T.AccessControlAction.ActionTeamsRead)){t((0,c.PL)({teams:[],totalCount:0,page:1,perPage:L,noTeams:!0}));return}const M=await(0,r.i)().get("/api/teams/search",(0,f.y)({query:u,page:D,perpage:L}));let R=!1;s&&(R=M.teams.length===0),t((0,c.PL)({noTeams:R,...M}))}}const o=(0,e.debounce)(s=>s(n()),500);function l(s){return async t=>{const m=await(0,r.i)().get(`/api/teams/${s}`,(0,f.y)());t((0,c.y$)(m)),t((0,E.RL)((0,i.B)(m)))}}function d(s){return async t=>{await(0,r.i)().delete(`/api/teams/${s}`),await g.Vt.fetchUserPermissions(),t(n())}}function h(s){return async t=>{t((0,c.aj)(s)),o(t)}}function C(s){return async t=>{t((0,c.PJ)(s)),t(n())}}function p(){return async(s,t)=>{const m=t().team.team,u=await(0,r.i)().get(`/api/teams/${m.id}/members`);s((0,c.n2)(u))}}function O(s){return async(t,m)=>{const u=m().team.team;await(0,r.i)().post(`/api/teams/${u.id}/members`,{userId:s}),t(p())}}function U(s){return async(t,m)=>{const u=m().team.team;await(0,r.i)().delete(`/api/teams/${u.id}/members/${s}`),t(p())}}function I(s,t){return async(m,u)=>{const D=u().team.team;await(0,r.i)().put(`/api/teams/${D.id}`,{name:s,email:t}),m(l(D.id))}}function v(){return async(s,t)=>{const m=t().team.team,u=await(0,r.i)().get(`/api/teams/${m.id}/groups`);s((0,c.iI)(u))}}function W(s){return async(t,m)=>{const u=m().team.team;await(0,r.i)().post(`/api/teams/${u.id}/groups`,{groupId:s}),t(v())}}function K(s){return async(t,m)=>{const u=m().team.team;await(0,r.i)().delete(`/api/teams/${u.id}/groups?groupId=${encodeURIComponent(s)}`),t(v())}}function $(s){return async t=>{await(0,r.i)().put(`/api/teams/${s.teamId}/members/${s.userId}`,{permission:s.permission}),t(p())}}},87941:(y,P,a)=>{a.d(P,{B:()=>i,o:()=>c});var e=a(66121),A=a(73194),r=a(47694),E=a(82002),g=a(77293),f=a(81168);const T={avatarUrl:"public/img/user_profile.png",id:1,name:"Loading",email:"loading",memberCount:0,permission:f.TeamPermissionLevel.Member,accessControl:{isEditor:!1},created:"",orgId:0,updated:""};function i(n){const o={img:n.avatarUrl,id:"team-"+n.id,subTitle:"Manage members and settings",url:"",text:n.name,breadcrumbs:[{title:"Teams",url:"org/teams"}],children:[{active:!1,icon:"sliders-v-alt",id:`team-settings-${n.id}`,text:"Settings",url:`org/teams/edit/${n.id}/settings`}]};(n===T||E.Vt.hasPermissionInMetadata(f.AccessControlAction.ActionTeamsPermissionsRead,n))&&o.children.unshift({active:!1,icon:"users-alt",id:`team-members-${n.id}`,text:"Members",url:`org/teams/edit/${n.id}/members`});const l={active:!1,icon:"sync",id:`team-groupsync-${n.id}`,text:"External group sync",url:`org/teams/edit/${n.id}/groupsync`},d=n===T;return(0,g.d5)()&&(l.tabSuffix=()=>(0,A.Z)({experimentId:d?"":"feature-highlights-team-sync-badge",eventVariant:"trial"})),(0,e.v)("teamsync")?(d||E.Vt.hasPermissionInMetadata(f.AccessControlAction.ActionTeamsPermissionsRead,n))&&o.children.push(l):r.ZP.featureToggles.featureHighlights&&o.children.push({...l,tabSuffix:()=>(0,A.Z)({experimentId:d?"":"feature-highlights-team-sync-badge"})}),o}function c(n){const o=i(T);let l;for(const d of o.children)if(d.id.indexOf(n)>0){d.active=!0,l=d;break}return{main:o,node:l}}},3813:(y,P,a)=>{a.d(P,{JB:()=>r,VP:()=>E,YY:()=>g,kC:()=>T,vt:()=>f,xc:()=>A});var e=a(81168);const A=i=>i.searchMemberQuery,r=i=>i.groups,E=(i,c)=>i.team.id===parseInt(c,10)?i.team:null,g=i=>{const c=RegExp(i.searchMemberQuery,"i");return i.members.filter(n=>c.test(n.login)||c.test(n.email)||c.test(n.name))},f=i=>{const{members:c,signedInUser:n,editorsCanAdmin:o}=i,l=c.find(h=>h.userId===n.id),d=l?l.permission:e.TeamPermissionLevel.Member;return T({permission:d,signedInUser:n,editorsCanAdmin:o})},T=i=>{const{permission:c,signedInUser:n,editorsCanAdmin:o}=i,l=n.isGrafanaAdmin||n.orgRole===e.OrgRole.Admin,d=c===e.TeamPermissionLevel.Admin;return l||d||!o}}}]);

//# sourceMappingURL=TeamList.c75a794e5428a3830d36.js.map