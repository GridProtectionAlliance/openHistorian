{"version":3,"file":"jaegerPlugin.b612cdc2bebf2a8781fc.js","mappings":"8JAKO,SAASA,EAA0BC,GACxCA,EAAOC,MAAK,CAACC,EAAGC,IAAMD,EAAE,GAAKC,EAAE,KAsB/B,OArBqBH,EAAOI,QAAO,CAACC,EAAKC,KACvC,IAAKD,EAAIE,OACP,MAAO,CAACD,GAEV,MAAME,EAAOH,EAAII,OAAO,GAAG,IACpBC,EAAWC,GAAWH,GACtBI,EAAOC,GAAOP,EACrB,OAAIO,EAAMF,EAEDN,EAGLO,EAAQD,EAEH,IAAIN,EAAKC,GAIX,IAAID,EAAII,MAAM,GAAI,GAAI,CAACC,EAAWG,MACxC,IAEiBT,QAAO,CAACC,EAAKC,IACxBD,GAAOC,EAAM,GAAKA,EAAM,KAC9B,GAQE,SAASQ,EAAeC,GAG7B,MAAMC,EAA8D,GAEpE,IAAIC,EACJ,IAAK,IAAIC,EAAQ,EAAID,EAAOF,EAAQG,GAAWD,EAAMC,IAAS,CACvDF,EAAQC,EAAKE,IAMhBH,EAAQC,EAAKE,IAAIF,KAAOA,EAAKA,KAL7BD,EAAQC,EAAKE,IAAM,CACjBF,KAAMA,EAAKA,KACXG,SAAU,IAMd,IAAK,MAAMC,KAAYJ,EAAKK,UACtBD,IACGL,EAAQK,GAMXL,EAAQK,GAAUD,SAASG,KAAKN,EAAKE,IALrCH,EAAQK,GAAY,CAClBJ,UAAMO,EACNJ,SAAU,CAACH,EAAKE,MAQ1B,OAAOH,EAGF,SAASS,EAASC,EAAkBC,EAAuBC,GAChE,MAAO,CACLC,KAAO,GAAEC,EAAuBJ,SAAgBI,EAAwBJ,EAAWC,EAAiB,SACpGI,UAAY,GAAED,EAAuBF,SAAoBE,EACtDF,EAAeF,EAAY,UAKlC,SAASI,EAAuBE,GAC9B,OAAOC,WAAWD,EAAEE,QAAQ,IAMvB,SAASC,IA8Bd,MAAO,CA7BY,IAAIC,EAAAA,iBAAiB,CACtCC,OAAQ,CACN,CAAEC,KAAMC,EAAAA,6BAAAA,GAAWC,KAAMC,EAAAA,UAAAA,QACzB,CAAEH,KAAMC,EAAAA,6BAAAA,MAAcC,KAAMC,EAAAA,UAAAA,QAC5B,CAAEH,KAAMC,EAAAA,6BAAAA,SAAiBC,KAAMC,EAAAA,UAAAA,QAC/B,CAAEH,KAAMC,EAAAA,6BAAAA,SAAiBC,KAAMC,EAAAA,UAAAA,OAAkBC,OAAQ,CAAEC,YAAa,4BACxE,CAAEL,KAAMC,EAAAA,6BAAAA,cAAsBC,KAAMC,EAAAA,UAAAA,OAAkBC,OAAQ,CAAEC,YAAa,2BAC7E,CACEL,KAAMC,EAAAA,6BAAAA,MACNC,KAAMC,EAAAA,UAAAA,OACNC,OAAQ,CAAEE,MAAO,CAAEC,KAAM,qBAAuBF,YAAa,gCAGjEG,KAAM,CACJC,2BAA4B,eAIb,IAAIX,EAAAA,iBAAiB,CACtCC,OAAQ,CACN,CAAEC,KAAMC,EAAAA,6BAAAA,GAAWC,KAAMC,EAAAA,UAAAA,QACzB,CAAEH,KAAMC,EAAAA,6BAAAA,OAAeC,KAAMC,EAAAA,UAAAA,QAC7B,CAAEH,KAAMC,EAAAA,6BAAAA,OAAeC,KAAMC,EAAAA,UAAAA,SAE/BK,KAAM,CACJC,2BAA4B,kB,mOC9G3B,SAASC,EAAkBC,GAChC,IAAKA,EACH,MAAO,GAET,MAAMC,EAAYC,IAAAA,MAAaF,GAO/B,OANAG,OAAOC,KAAKH,GAAMI,SAASC,IACzB,MAAMC,EAAQN,EAAKK,GACE,iBAAVC,IACTN,EAAKK,GAAOE,OAAOD,OAGhBE,KAAKC,UAAUT,GAGjB,SAASU,EAAkBX,GAChC,IAAKA,EACH,MAAO,GAET,IACE,OAAOE,IAAAA,UAAiBO,KAAKG,MAAMZ,IACnC,MACA,OAAOA,G,eCdX,MAAMa,EAAsB,0BAOrB,SAASC,EAAT,GAAqD,IAA5B,MAAEC,EAAF,SAASC,GAAmB,EAC1D,MAAOC,EAAqBC,IAA0BC,EAAAA,EAAAA,WAAS,GACzDC,GAASC,EAAAA,EAAAA,WAAUC,GAEzB,OACE,4BACE,SAAC,EAAAC,eAAD,WACE,gBAAKC,UAAWJ,EAAOK,yBAA0BC,QAAS,IAAMR,GAAwBD,GAAxF,UACE,UAAC,EAAAU,YAAD,CAAaC,GAAG,MAAhB,6BACmB,KACjB,SAAC,EAAAC,KAAD,CAAML,UAAWP,EAAsBG,EAAOU,QAAUV,EAAOW,UAAW1C,KAAK,uBAIrF,SAAC2C,EAAA,EAAD,CACEC,GAAIhB,EACJiB,cAAc,EACdC,eAAe,EACfC,QAAS,IACTC,WAAYjB,EALd,UAOE,4BACE,SAAC,EAAAG,eAAD,WACE,SAAC,EAAAe,YAAD,CAAaC,MAAM,eAAeC,WAAY,GAAIC,MAAI,EAAtD,UACE,SAAC,EAAAC,MAAD,CACExE,GAAG,cACHmB,KAAK,cACLkB,MAAOQ,EAAM4B,aAAe,GAC5BC,YAAa/B,EACbG,SAAW6B,GACT7B,EAAS,OAAD,UACHD,EADG,CAEN4B,YAAaE,EAAEC,cAAcvC,gBAMvC,SAAC,EAAAgB,eAAD,WACE,SAAC,EAAAe,YAAD,CAAaC,MAAM,eAAeC,WAAY,GAAIC,MAAI,EAAtD,UACE,SAAC,EAAAC,MAAD,CACExE,GAAG,cACHmB,KAAK,cACLkB,MAAOQ,EAAMgC,aAAe,GAC5BH,YAAa/B,EACbG,SAAW6B,GACT7B,EAAS,OAAD,UACHD,EADG,CAENgC,YAAaF,EAAEC,cAAcvC,gBAMvC,SAAC,EAAAgB,eAAD,WACE,SAAC,EAAAe,YAAD,CAAaC,MAAM,QAAQC,WAAY,GAAIC,MAAI,EAACO,QAAQ,sCAAxD,UACE,SAAC,EAAAN,MAAD,CACExE,GAAG,QACHmB,KAAK,QACLkB,MAAOQ,EAAMkC,OAAS,GACtB1D,KAAK,SACLyB,SAAW6B,GACT7B,EAAS,OAAD,UACHD,EADG,CAENkC,MAAOJ,EAAEC,cAAcvC,MAAQ2C,SAASL,EAAEC,cAAcvC,MAAO,SAAMhC,mBAYzF,SAAS+C,EAAU6B,GACjB,MAAO,CACL1B,yBAA0B2B,EAAAA,GAAI;kBAChBD,EAAME,QAAQC,MAAMH,EAAME,QAAQC;;;MAIhDC,MAAOH,EAAAA,GAAI;;;;MAKXI,YAAaJ,EAAAA,GAAI;;;;;MAMjBK,KAAML,EAAAA,GAAI;;;;MAKVM,WAAYN,EAAAA,GAAI;;;;;MAMhBtB,QAASsB,EAAAA,GAAI;;;MAIbrB,UAAWqB,EAAAA,GAAI;;;OCvGZ,MACDO,EAA+C,CACnDpB,MAFgC,MAGhChC,WAAOhC,GAGF,SAASqF,EAAT,GAA4D,IAAxC,WAAEC,EAAF,MAAc9C,EAAd,SAAqBC,GAAmB,EACjE,MAAO8C,EAAgBC,IAAqB5C,EAAAA,EAAAA,aACrC6C,EAAkBC,IAAuB9C,EAAAA,EAAAA,aACzC+C,EAAWC,IAAgBhD,EAAAA,EAAAA,UAG/B,CACDiD,UAAU,EACVC,YAAY,IAGRC,GAAcC,EAAAA,EAAAA,cAClBC,eAAOC,EAAaC,GAA8E,IAAxD3D,EAAwD,uDAAhD,GAChDoD,GAAcQ,GAAD,iBAAqBA,EAArB,CAAgC,CAACD,IAAe,MAE7D,IACE,MAAME,QAAgCf,EAAWgB,gBAAgBJ,GACjE,IAAKG,EACH,MAAO,CAAC,CAAErC,MAAQ,MAAKmC,UAAsBnE,MAAQ,MAAKmE,YAG5D,MAAMI,EAA6BF,EAAO5H,OAAO+H,KAAKC,IAAD,CACnDzC,MAAOyC,EACPzE,MAAOyE,MAIT,OADwBF,EAAQG,QAAQC,KAAUA,EAAK3E,QAAQ4E,EAAAA,EAAAA,YAAWD,EAAK3E,MAAOQ,GAAOqE,QAE7F,MAAOC,GAIP,OAHIA,aAAiBC,QACnBC,EAAAA,EAAAA,KAASC,EAAAA,EAAAA,KAAUC,EAAAA,EAAAA,IAAwB,QAASJ,KAE/C,GAjBT,QAmBElB,GAAcQ,GAAD,iBAAqBA,EAArB,CAAgC,CAACD,IAAe,SAGjE,CAACb,IA8BH,OA3BA6B,EAAAA,EAAAA,YAAU,KACYlB,WAClB,MAAMJ,QAAiBE,EAAY,gBAAiB,YAChDvD,EAAM4E,UAAWC,EAAAA,EAAAA,kBAAiBC,iBAAiB9E,EAAM4E,UAC3DvB,EAAS9F,MAAKwH,EAAAA,EAAAA,UAAS/E,EAAM4E,UAE/B5B,EAAkBK,IAEpB2B,KACC,CAAClC,EAAYS,EAAavD,EAAM4E,WAEnCD,EAAAA,EAAAA,YAAU,KAWJ3E,EAAM4E,SAVYnB,WACpB,MAAMH,QAAmBC,EACtB,iBAAgB0B,oBAAmBJ,EAAAA,EAAAA,kBAAiBK,QAAQlF,EAAM4E,uBACnE,cAEE5E,EAAMmF,YAAaN,EAAAA,EAAAA,kBAAiBC,iBAAiB9E,EAAMmF,YAC7D7B,EAAW/F,MAAKwH,EAAAA,EAAAA,UAAS/E,EAAMmF,YAEjCjC,EAAoB,CAACN,KAAwBU,KAG7C8B,KAED,CAACtC,EAAY9C,EAAM4E,QAASrB,EAAavD,EAAMmF,aAGhD,iBAAK1E,WAAW4B,EAAAA,EAAAA,KAAI,CAAEgD,SAAU,UAAhC,WACE,SAAC,EAAA7E,eAAD,WACE,SAAC,EAAAe,YAAD,CAAaC,MAAM,UAAUC,WAAY,GAAIC,MAAI,EAAjD,UACE,SAAC,EAAA4D,OAAD,CACEC,QAAQ,UACRxB,QAAShB,EACTyC,WAAY,IAAMjC,EAAY,gBAAiB,YAC/CJ,UAAWA,EAAUE,SACrB7D,OAAOuD,MAAAA,OAAA,EAAAA,EAAgB0C,MAAM3D,IAAMA,MAAAA,OAAA,EAAAA,EAAGtC,SAAUQ,EAAM4E,iBAAYpH,EAClEyC,SAAW6B,GACT7B,EAAS,OAAD,UACHD,EADG,CAEN4E,QAAS9C,MAAAA,OAAF,EAAEA,EAAGtC,MACZ2F,UAAWnF,EAAM4E,WAAY9C,MAAAA,OAAlB,EAAkBA,EAAGtC,YAAQhC,EAAYwC,EAAMmF,aAG9DO,cAAc,SACdC,aAAW,EACX,aAAY,sBACZC,kBAAkB,SAIxB,SAAC,EAAApF,eAAD,WACE,SAAC,EAAAe,YAAD,CAAaC,MAAM,YAAYC,WAAY,GAAIC,MAAI,EAACmE,UAAW7F,EAAM4E,QAArE,UACE,SAAC,EAAAU,OAAD,CACEC,QAAQ,YACRxB,QAASd,EACTuC,WAAY,IACVjC,EACG,iBAAgB0B,oBAAmBJ,EAAAA,EAAAA,kBAAiBK,QAAQlF,EAAM4E,uBACnE,cAGJzB,UAAWA,EAAUG,WACrB9D,OAAOyD,MAAAA,OAAA,EAAAA,EAAkBwC,MAAM3D,GAAMA,EAAEtC,QAAUQ,EAAMmF,cAAc,KACrElF,SAAW6B,GACT7B,EAAS,OAAD,UACHD,EADG,CAENmF,WAAWrD,MAAAA,OAAA,EAAAA,EAAGtC,aAAUhC,KAG5BkI,cAAc,SACdC,aAAW,EACX,aAAY,wBACZC,kBAAkB,SAIxB,SAAC,EAAApF,eAAD,WACE,SAAC,EAAAe,YAAD,CAAaC,MAAM,OAAOC,WAAY,GAAIC,MAAI,EAA9C,UACE,SAAC,EAAAC,MAAD,CACExE,GAAG,OACHqC,MAAOI,EAAkBI,EAAMf,MAC/B4C,YAAY,kCACZ5B,SAAW6B,GACT7B,EAAS,OAAD,UACHD,EADG,CAENf,KAAM6C,EAAEC,cAAcvC,gBAMhC,SAACO,EAAD,CAAiBC,MAAOA,EAAOC,SAAUA,O,4FC3IxC,SAAS6F,EAAkB5G,GAChC,MAAM,MAAE6G,EAAF,MAASC,GAcjB,SAA6B9G,GAC3B,MAAM6G,EAAgB,GAChBC,EAAgB,GAEhBrI,EAoDR,SAA2BsI,GACzB,IAAIC,EAAe,EACfC,EAAiBC,EAAAA,EAErB,IAAK,MAAMnJ,KAAQgJ,EACbhJ,EAAKoJ,UAAYF,IACnBA,EAAiBlJ,EAAKoJ,WAGpBpJ,EAAKoJ,UAAYpJ,EAAKS,SAAWwI,IACnCA,EAAejJ,EAAKoJ,UAAYpJ,EAAKS,UAIzC,OAAOwI,EAAeC,EAlEAG,CAAkBpH,EAAK+G,OAEvCjJ,GAAUF,EAAAA,EAAAA,KAAaI,IAAU,MACrC,GAAIA,GAASgC,EAAK+G,MAAM1J,OACtB,OAEF,MAAMU,EAAOiC,EAAK+G,MAAM/I,GACxB,MAAO,CACLD,KAAAA,EACAE,GAAIF,EAAKsJ,OACTjJ,WAAW,UAAAL,EAAKuJ,kBAAL,eAAiBtC,QAAQuC,GAAoB,aAAdA,EAAEC,UAAwB1C,KAAKyC,GAAMA,EAAEF,WAAW,OAIhG,IAAK,MAAMtJ,KAAQiC,EAAK+G,MAAO,WAC7B,MAAMU,EAAUzH,EAAK0H,UAAU3J,EAAK4J,WAE9B7K,EAAkCgB,EAAQC,EAAKsJ,QAAQnJ,SAAS4G,KAAK8C,IACzE,MAAM7J,EAAOD,EAAQ8J,GAAG7J,KACxB,MAAO,CAACA,EAAKoJ,UAAWpJ,EAAKoJ,UAAYpJ,EAAKS,aAE1CqJ,GAAmBhL,EAAAA,EAAAA,IAA0BC,GAC7C4B,EAAeX,EAAKS,SAAWqJ,EAC/BC,GAAQvJ,EAAAA,EAAAA,IAASR,EAAKS,SAAW,IAAMC,EAAgB,IAAMC,EAAe,KAElFmI,EAAMxI,KAAK,CACT,CAACgB,EAAAA,6BAAAA,IAAYtB,EAAKsJ,OAClB,CAAChI,EAAAA,6BAAAA,OAAD,UAAgBoI,MAAAA,OAAhB,EAAgBA,EAASM,mBAAzB,QAAwC,GACxC,CAAC1I,EAAAA,6BAAAA,UAAkBtB,EAAKiK,cACxB,CAAC3I,EAAAA,6BAAAA,UAAkByI,EAAMnJ,KACzB,CAACU,EAAAA,6BAAAA,eAAuByI,EAAMjJ,UAC9B,CAACQ,EAAAA,6BAAAA,OAAeX,EAAeD,IAGjC,MAAMwJ,EAAY,UAAGlK,EAAKuJ,kBAAR,iBAAG,EAAiBf,MAAMgB,GAAoB,aAAdA,EAAEC,iBAAlC,aAAG,EAAwDH,OAEzEY,GAAgBnK,EAAQmK,GAAclK,MACxC+I,EAAMzI,KAAK,CACT,CAACgB,EAAAA,6BAAAA,IAAY4I,EAAe,KAAOlK,EAAKsJ,OACxC,CAAChI,EAAAA,6BAAAA,QAAgBtB,EAAKsJ,OACtB,CAAChI,EAAAA,6BAAAA,QAAgB4I,IAKvB,MAAO,CAAEpB,MAAAA,EAAOC,MAAAA,GA/DSoB,CAAoBlI,IACtCmI,EAAYC,IAAcnJ,EAAAA,EAAAA,MAEjC,IAAK,MAAMoJ,KAAQxB,EACjBsB,EAAWG,IAAID,GAGjB,IAAK,MAAME,KAAQzB,EACjBsB,EAAWE,IAAIC,GAGjB,MAAO,CAACJ,EAAYC,G,uICDf,MAAMI,UAAyBC,EAAAA,cAIpCC,YACUC,GAGR,IAFiBC,EAEjB,wDAFoCC,EAAAA,EAAAA,MACnBC,EACjB,wDAD4CnD,EAAAA,EAAAA,kBAE5CoD,MAAMJ,GADN,sBAP0C,MAO1C,yDAHQA,iBAAAA,EAGR,KAFiBC,QAAAA,EAEjB,KADiBE,YAAAA,EAGjBE,KAAKC,UAAYN,EAAiBO,SAASD,UAGxB,sBAACzE,EAAa2E,GAEjC,aADkBC,EAAAA,EAAAA,GAAcJ,KAAKK,SAAS7E,EAAK2E,EAAQ,CAAEG,mBAAmB,MACrEtJ,KAAKA,KAGlBc,MAAM+D,GAGJ,MAAM0E,EAAsB1E,EAAQ2E,QAAQ,GAC5C,IAAKD,EACH,OAAOE,EAAAA,EAAAA,IAAG,CAAEzJ,KAAM,CAAC0J,KAGrB,GAAyB,WAArBH,EAAOI,WAA0BJ,EAAOzI,MAC1C,OAAOkI,KAAKK,SACT,eAActD,mBAAmBiD,KAAKF,YAAY9C,QAAQuD,EAAOzI,MAAO+D,EAAQ+E,gBACjFC,MACA/E,EAAAA,EAAAA,IAAKgF,IAAa,UAChB,MAAMC,EAAYD,MAAAA,GAAH,UAAGA,EAAU9J,YAAb,iBAAG,EAAgBA,YAAnB,aAAG,EAAuB,GACzC,IAAK+J,EACH,MAAO,CAAE/J,KAAM,CAAC0J,IAElB,IAAI1J,EAAO,EAACgK,EAAAA,EAAAA,IAAiBD,IAI7B,OAHA,UAAIf,KAAKC,iBAAT,OAAI,EAAgBgB,SAClBjK,EAAK3B,QAAQuI,EAAkBmD,IAE1B,CACL/J,KAAAA,OAMR,GAAyB,WAArBuJ,EAAOI,UAAwB,CACjC,IAAKX,KAAKkB,aACR,OAAOT,EAAAA,EAAAA,IAAG,CAAEzJ,KAAM,KAGpB,IAAI,MACF,MAAM+J,EAAYvJ,KAAKG,MAAMqI,KAAKkB,cAAwBlK,KAAK,GAC/D,IAAIA,EAAO,EAACgK,EAAAA,EAAAA,IAAiBD,IAI7B,OAHA,UAAIf,KAAKC,iBAAT,OAAI,EAAgBgB,SAClBjK,EAAK3B,QAAQuI,EAAkBmD,KAE1BN,EAAAA,EAAAA,IAAG,CAAEzJ,KAAAA,IACZ,MAAOoF,GACP,OAAOqE,EAAAA,EAAAA,IAAG,CAAErE,MAAO,CAAE+E,QAAS,mCAAqCnK,KAAM,MAI7E,IAAIoK,GAAqBC,EAAAA,EAAAA,MAAKrB,KAAKsB,eAAef,EAAQ1E,EAAQ+E,YAAa,CAC7E,UACA,YACA,OACA,cACA,cACA,UAGEW,GAAcC,EAAAA,EAAAA,QAAOJ,EAAoBK,EAAAA,UAc7C,MFhG8B,QEoF1BF,EAAYtE,YACdsE,GAAcG,EAAAA,EAAAA,MAAKH,EAAa,cAG9BA,EAAYxK,OACdwK,EAAc,OAAH,UACNA,EADM,CAETxK,KAAMD,EAAkByK,EAAYxK,KAAK4K,eAKtC3B,KAAKK,SAAU,cAAf,iBACFkB,EACAvB,KAAK4B,eAFH,CAGLC,SAAU,YACThB,MACD/E,EAAAA,EAAAA,IAAKgF,IACI,CACL9J,KAAM,EAAC8K,EAAAA,EAAAA,IAAiBhB,EAAS9J,KAAKA,KAAMgJ,KAAKL,wBAMzDoC,8BAA8BC,EAAwBpB,GACpD,OAAKoB,GAA8B,IAAnBA,EAAQ3N,OAIjB2N,EAAQlG,KAAKhE,GACX,OAAP,UACKA,EADL,CAEE8C,WAAYoF,KAAKiC,UACdjC,KAAKsB,eAAexJ,EAAO8I,MAPzB,GAYXU,eAAexJ,EAAoB8I,GAAwB,YACzD,IAAIsB,EAAgB,OAAH,UAAQpK,GASzB,OAPIA,EAAMf,MAAQiJ,KAAKF,YAAYlD,iBAAiB9E,EAAMf,QACxDmL,EAAgB,OAAH,UACRpK,EADQ,CAEXf,KAAMiJ,KAAKF,YAAY9C,QAAQlF,EAAMf,KAAM6J,MAIxC,OAAP,UACKsB,EADL,CAEExF,QAASsD,KAAKF,YAAY9C,QAAjB,UAAyBlF,EAAM4E,eAA/B,QAA0C,GAAIkE,GACvD3D,UAAW+C,KAAKF,YAAY9C,QAAjB,UAAyBlF,EAAMmF,iBAA/B,QAA4C,GAAI2D,GAC3DlH,YAAasG,KAAKF,YAAY9C,QAAjB,UAAyBlF,EAAM4B,mBAA/B,QAA8C,GAAIkH,GAC/D9G,YAAakG,KAAKF,YAAY9C,QAAjB,UAAyBlF,EAAMgC,mBAA/B,QAA8C,GAAI8G,KAI/C,uBAClB,OAAOR,EAAAA,EAAAA,GACLJ,KAAKK,SAAS,iBAAiBQ,MAC7B/E,EAAAA,EAAAA,IAAKqG,IAAQ,MAUX,QATsBA,MAAAA,GAAA,UAAAA,EAAKnL,YAAL,eAAWA,OAAQ,IAEhC3C,OAAS,EACZ,CAAE+N,OAAQ,UAAWjB,QAAS,6CAC9B,CACEiB,OAAQ,QACRjB,QACE,mGAIZkB,EAAAA,EAAAA,IAAYC,IACV,IAAInB,EAAU,WAgBd,OAfImB,EAAIC,WACNpB,GAAWmB,EAAIC,WAEfpB,GAAW,2BAGTmB,EAAIF,SACNjB,GAAY,KAAImB,EAAIF,UAGlBE,EAAItL,MAAQsL,EAAItL,KAAKmK,QACvBA,GAAY,KAAImB,EAAItL,KAAKmK,UAChBmB,EAAItL,OACbmK,GAAY,KAAI3J,KAAKC,UAAU6K,EAAItL,UAE9ByJ,EAAAA,EAAAA,IAAG,CAAE2B,OAAQ,QAASjB,QAASA,SAM9CS,eACE,MAAMxN,EAAQ4L,KAAKJ,QAAQ4C,YAC3B,MAAO,CACL9N,MAAO+N,EAAQrO,EAAMsO,MAAM,GAC3B/N,IAAK8N,EAAQrO,EAAMuO,IAAI,IAI3BC,oBAAoB9K,GAClB,OAAOA,EAAMA,OAAS,GAGhBuI,SAASwC,EAAgB7L,EAAY6E,GAC3C,MAAMsE,EAASnJ,GAAO8L,EAAAA,EAAAA,IAAgB9L,GAAQ,GACxCwE,EAAO,GAAEwE,KAAKL,iBAAiBnE,MAAMqH,IAAS1C,EAAO9L,OAAU,IAAG8L,IAAW,KAC7E4C,EAAM,OAAH,UACJlH,EADI,CAEPL,IAAAA,IAGF,OAAOwH,EAAAA,EAAAA,iBAAgBC,MAAMF,IAIjC,SAASN,EAAQS,EAAyBC,GAIxC,MAHoB,iBAATD,IACTA,EAAOE,EAAAA,SAAAA,MAAeF,EAAMC,IAEN,IAAjBD,EAAKG,UAGd,MAAM3C,EAAsB,IAAIxK,EAAAA,iBAAiB,CAC/CC,OAAQ,CACN,CACEC,KAAM,QACNE,KAAMC,EAAAA,UAAAA,MACNoF,OAAQ,KAGZ/E,KAAM,CACJC,2BAA4B,QAC5ByM,OAAQ,CACNC,YAAa,aC9ONC,EAAS,IAAIC,EAAAA,iBAAiBjE,GAAkBkE,iBCMhB,IAAkC,IAAjC,QAAE7H,EAAF,gBAAW8H,GAAsB,EAC7E,OACE,iCACE,SAAC,EAAAC,uBAAD,CACEC,WAAW,yBACXC,iBAAkBjI,EAClBkI,mBAAmB,EACnBhM,SAAU4L,KAGZ,gBAAKpL,UAAU,gBAAf,UACE,SAACyL,EAAA,EAAD,CAAqBnI,QAASA,EAAS8H,gBAAiBA,MAGzDnN,EAAAA,OAAAA,eAAAA,gBACC,gBAAK+B,UAAU,gBAAf,UACE,SAAC0L,EAAA,EAAD,CAAwBpI,QAASA,EAAS8H,gBAAiBA,MAE3D,MAEJ,gBAAKpL,UAAU,gBAAf,UACE,SAAC2L,EAAA,EAAD,CAAmBrI,QAASA,EAAS8H,gBAAiBA,OAGxD,gBAAKpL,UAAU,gBAAf,UACE,SAAC,KAAD,CAAiBsD,QAASA,EAAS8H,gBAAiBA,YD/B+BQ,gBEOpF,YAAyE,UAApD,WAAEvJ,EAAF,MAAc9C,EAAd,SAAqBC,EAArB,WAA+BqM,GAAqB,EAC9E,MAAMlK,GAAQmK,EAAAA,EAAAA,aAERC,EAAiBhN,IACrB,MAAMiN,EAAyB,OAAH,UAAQzM,EAAR,CAAeA,MAAOR,IAClDS,EAASwM,IAqCX,OACE,+BACE,iBAAKhM,WAAW4B,EAAAA,EAAAA,KAAI,CAAEqK,MAAO,SAA7B,WACE,SAAC,EAAAlM,eAAD,WACE,SAAC,EAAAe,YAAD,CAAaC,MAAM,aAAnB,UACE,SAAC,EAAAmL,iBAAD,CACE5I,QAAS,CACP,CAAEvE,MAAO,SAAUgC,MAAO,UAC1B,CAAEhC,WAAOhC,EAAWgE,MAAO,WAC3B,CAAEhC,MAAO,SAAUgC,MAAO,cAE5BhC,MAAOQ,EAAM6I,UACb5I,SAAW6B,GACT7B,EAAS,OAAD,UACHD,EADG,CAEN6I,UAAW/G,KAGf8K,KAAK,WApDQ,MACvB,OAAQ5M,EAAM6I,WACZ,IAAK,SACH,OAAO,IAAP,GAAO,SAAChG,EAAD,CAAYC,WAAYA,EAAY9C,MAAOA,EAAOC,SAAUA,KACrE,IAAK,SACH,OACE,gBAAKQ,WAAW4B,EAAAA,EAAAA,KAAI,CAAEwK,QAASzK,EAAME,QAAQ,KAA7C,UACE,SAAC,EAAAwK,aAAD,CACE/I,QAAS,CAAEgJ,UAAU,GACrBC,OAASC,IACPnK,EAAWsG,aAAe6D,EAC1BX,SAKV,QACE,OACE,SAAC,EAAA9L,eAAD,WACE,SAAC,EAAAe,YAAD,CAAaC,MAAM,WAAWC,WAAY,GAAIC,MAAI,EAAlD,UACE,SAAC,EAAAwL,WAAD,CACElN,MAAOA,EAAMA,MACbC,SAAUuM,EACVF,WAAYA,EACZa,OAAQ,OACRtL,YAAa,0CACbuL,aAAa,iBA8BpBC,Y,2FCjEF,SAASnE,EAAiBhK,GAC/B,MAAM+G,EAAQ/G,EAAK+G,MAAMjC,KAAKsJ,IAAMC,OAgCnBtQ,EAhC6BqQ,EAgCjB1G,EAhCoB1H,EAAK0H,UAiC/C,CACLL,OAAQtJ,EAAKsJ,OACbiH,QAASvQ,EAAKuQ,QACdrG,aAAY,UAAElK,EAAKuJ,kBAAP,iBAAE,EAAiBf,MAAMgB,GAAoB,aAAdA,EAAEC,iBAAjC,aAAE,EAAwDH,OACtEW,cAAejK,EAAKiK,cAEpBb,UAAWpJ,EAAKoJ,UAAY,IAC5B3I,SAAUT,EAAKS,SAAW,IAC1B+P,KAAMxQ,EAAKwQ,KAAKzJ,KAAK0J,GAAD,iBACfA,EADe,CAElBC,UAAWD,EAAEC,UAAY,QAE3B1O,KAAMhC,EAAKgC,KACX2O,SAAQ,UAAE3Q,EAAK2Q,gBAAP,aAAmBpQ,EAC3BqQ,YAAa5Q,EAAK4Q,YAClB5G,YAAaL,EAAU3J,EAAK4J,WAAWI,YACvC6G,YAAalH,EAAU3J,EAAK4J,WAAW5H,MAjB3C,IAAmBhC,EAAY2J,EAAuD,SA9B9EmH,EAAQ,IAAI3P,EAAAA,iBAAiB,CACjCC,OAAQ,CACN,CAAEC,KAAM,UAAWE,KAAMC,EAAAA,UAAAA,QACzB,CAAEH,KAAM,SAAUE,KAAMC,EAAAA,UAAAA,QACxB,CAAEH,KAAM,eAAgBE,KAAMC,EAAAA,UAAAA,QAC9B,CAAEH,KAAM,gBAAiBE,KAAMC,EAAAA,UAAAA,QAC/B,CAAEH,KAAM,cAAeE,KAAMC,EAAAA,UAAAA,QAC7B,CAAEH,KAAM,cAAeE,KAAMC,EAAAA,UAAAA,OAC7B,CAAEH,KAAM,YAAaE,KAAMC,EAAAA,UAAAA,QAC3B,CAAEH,KAAM,WAAYE,KAAMC,EAAAA,UAAAA,QAC1B,CAAEH,KAAM,OAAQE,KAAMC,EAAAA,UAAAA,OACtB,CAAEH,KAAM,OAAQE,KAAMC,EAAAA,UAAAA,OACtB,CAAEH,KAAM,WAAYE,KAAMC,EAAAA,UAAAA,OAC1B,CAAEH,KAAM,cAAeE,KAAMC,EAAAA,UAAAA,QAE/BK,KAAM,CACJC,2BAA4B,QAC5ByM,OAAQ,CACNC,YAAa,aAKnB,IAAK,MAAMxO,KAAQgJ,EACjB8H,EAAMvG,IAAIvK,GAGZ,OAAO8Q,EAwBF,SAAS/D,EAAiB9K,EAAuB2I,GACtD,MAAMkG,EAAQ,IAAI3P,EAAAA,iBAAiB,CACjCC,OAAQ,CACN,CACEC,KAAM,UACNE,KAAMC,EAAAA,UAAAA,OACNC,OAAQ,CACNsP,KAAM,SACNC,kBAAmB,WACnBC,MAAO,CACL,CACEC,MAAO,wBACPzK,IAAK,GACL0K,SAAU,CACRC,cAAexG,EAAiByG,IAChCC,eAAgB1G,EAAiBvJ,KACjC0B,MAAO,CACLA,MAAO,uBAOnB,CAAE1B,KAAM,YAAaE,KAAMC,EAAAA,UAAAA,OAAkBC,OAAQ,CAAEuP,kBAAmB,eAC1E,CAAE3P,KAAM,YAAaE,KAAMC,EAAAA,UAAAA,KAAgBC,OAAQ,CAAEuP,kBAAmB,eACxE,CAAE3P,KAAM,WAAYE,KAAMC,EAAAA,UAAAA,OAAkBC,OAAQ,CAAEuP,kBAAmB,WAAYD,KAAM,QAE7FlP,KAAM,CACJC,2BAA4B,WAI1BkK,EAAY/J,EAAK8E,IAAIwK,GAAsBvS,MAAK,CAACC,EAAGC,KAAMA,MAAAA,OAAA,EAAAA,EAAGkK,YAAanK,MAAAA,OAAhB,EAAgBA,EAAGmK,aAEnF,IAAK,MAAMoI,KAASxF,EAClB8E,EAAMvG,IAAIiH,GAGZ,OAAOV,EAGT,SAASS,EAAqBtP,GAC5B,MAAM+J,GAAYyF,EAAAA,EAAAA,IAAmBxP,GACrC,GAAK+J,EAIL,MAAO,CACLuE,QAASvE,EAAUuE,QACnBnH,UAAW4C,EAAU5C,UAAY,IACjC3I,SAAUuL,EAAUvL,SACpBiR,UAAW1F,EAAU0F,WAIlB,SAASC,EAAkB1P,GAChC,IAAI2P,EAA+B,CACjCrB,QAAS,GACTvH,MAAO,GACPW,UAAW,GACXgH,SAAU,MAERhH,EAAsB,GAE1B,IAAK,IAAIkI,EAAI,EAAGA,EAAI5P,EAAK3C,OAAQuS,IAAK,CACpC,MAAM7R,EAAOiC,EAAK6P,IAAID,GAGjBD,EAAcrB,UACjBqB,EAAcrB,QAAUvQ,EAAKuQ,SAI1B5G,EAAUnB,MAAMuJ,GAAMA,IAAM/R,EAAKgK,gBACpCL,EAAUrJ,KAAKN,EAAKgK,aACpB4H,EAAcjI,UAAW,IAAGA,EAAUrK,UAAY,CAChD0K,YAAahK,EAAKgK,YAClBhI,KAAMhC,EAAK6Q,cAKfe,EAAc5I,MAAM1I,KAAK,CACvBiQ,QAASvQ,EAAKuQ,QACdjH,OAAQtJ,EAAKsJ,OACb7I,SAA0B,IAAhBT,EAAKS,SACf8I,WAAYvJ,EAAKkK,aACb,CACE,CACET,QAAS,WACTH,OAAQtJ,EAAKkK,aACbqG,QAASvQ,EAAKuQ,UAGlB,GACJyB,MAAO,EACPxB,KAAMxQ,EAAKwQ,KAAKzJ,KAAK0J,GAAD,iBACfA,EADe,CAElBC,UAAyB,IAAdD,EAAEC,cAEfzG,cAAejK,EAAKiK,cACpBL,UACEzH,OAAOC,KAAKwP,EAAcjI,WAAWnB,MAClClG,GAAQsP,EAAcjI,UAAUrH,GAAK0H,cAAgBhK,EAAKgK,eACxD,GACPZ,UAA4B,IAAjBpJ,EAAKoJ,UAChBpH,KAAMhC,EAAKgC,KACX2O,SAAU3Q,EAAK2Q,SAAW3Q,EAAK2Q,SAAW,OAI9C,MAAO,CAAE1O,KAAM,CAAC2P,GAAgBK,MAAO,EAAGhN,MAAO,EAAGiN,OAAQ,EAAGC,OAAQ,Q,cC/J/DC,EAAOC,QAAU,SAASvL,GAIlC,OAFe,MAAXA,IAAiBA,EAAU,IAExB,SAASkH,EAAKZ,EAAKkF,GACxB,OAAItE,EAAIuE,MAAcD,IACRtE,EAAIwE,OAAO,kBAAoB1L,EAAQ2L,aAErDzE,EAAIuE,OAAQ,EACZvE,EAAI0E,KAAO1E,EAAI0E,MAAQ,GAEvBC,EAAM,GACN3E,EAAI4E,YAAY,QAChB5E,EAAI6E,GAAG,QAAQ,SAASC,GACtB,OAAOH,GAAOG,UAEhB9E,EAAI6E,GAAG,OAAO,WACZ,IACE,IAAIE,EAAQ,GACZJ,EAAIK,OAAOC,MAAM,MAAM5Q,SAAQ,SAAS6Q,GACtCH,EAAMzS,KAAKwG,EAAQqM,OAAOD,OAE5BlF,EAAI0E,KAAOK,EACX,MAAOxF,GAGP,OAFAA,EAAImF,KAAOC,EACXpF,EAAIF,OAAS,IACNiF,EAAK/E,GAEd,OAAO+E,QArBYA,IADrB,IAIIK,K,gBC7BI,EAAQ,OACN,EAAQ,OACP,kBAFf,IAGIS,EAAc,qBACdlR,EAAW,EAAQ,OAEbkQ,EAAOC,QAAU,SAASvL,GACpB,MAAXA,IAAiBA,EAAU,IAC9B,IAAIuM,EAAOvM,EAAQ2L,aAAe,wBAElC,OAAO,SAASzE,EAAKZ,EAAKkF,GAGxB,OAAItE,EAAIuE,MAAcD,IAGRtE,EAAIwE,OAAO,kBAAoBa,GAE7CrF,EAAIuE,OAAQ,EACZvE,EAAI0E,KAAO,IAAIU,EAAY,CAACE,YAAY,IACxCtF,EAAIlC,KAAK5J,EAAOqR,gBAAgBzH,KAAKkC,EAAI0E,MAElCJ,KALcA,O,cCjBzBD,EAAQmB,OAAQ,EAEhBnB,EAAQzP,MAAQ,SAASsQ,GACvB,IAAI5Q,EAAM,GACNC,EAAQ,GAERkR,GAAY,EACZC,GAAY,EACZC,GAAY,EACZC,GAAY,EACZC,EAAY,GACZL,EAAYnB,EAAQmB,MAEI,MAAzBN,EAAKA,EAAK5T,OAAS,KACpB4T,EAAOA,EAAK1T,MAAM,EAAE0T,EAAK5T,OAAS,IAGpC,IAAI,IAAIuS,EAAE,EAAGA,GAAKqB,EAAK5T,OAAQuS,IAAI,CAEjC,GAAe,KAAXqB,EAAKrB,KAAc8B,GAAa9B,GAAKqB,EAAK5T,OAAO,CAWnD,GAVGmU,GAAUnR,EAAIhD,OAAS,EACxBuU,EAAOvR,IAAO,EACPoR,IACK,QAATnR,EAAiBA,GAAQ,EACX,SAATA,EAAkBA,GAAQ,EAChB,KAAVA,GAAiBqR,IAAWrR,EAAQ,MAC5CsR,EAAOvR,GAAOC,EACdA,EAAQ,IAGPsP,GAAKqB,EAAK5T,OAAQ,MAEnBmU,GAAW,EACXC,GAAW,EACXC,GAAW,EACXC,GAAY,EAIF,KAAXV,EAAKrB,IAAc8B,EAMH,MAAXT,EAAKrB,IAEXtP,GAAS2Q,IADTrB,GAEG2B,GAAOM,QAAQC,IAAI,WAAab,EAAKrB,KAEvB,KAAXqB,EAAKrB,IACX+B,GAAY,EACZD,GAAYA,EACTH,GAAOM,QAAQC,IAAI,aAAeJ,IAEpB,KAAXT,EAAKrB,IAAc6B,GAAaD,EAKhCA,GACHD,GAAOM,QAAQC,IAAI,eAAiBb,EAAKrB,IAC5CvP,GAAO4Q,EAAKrB,IAEN6B,IACHF,GAAOM,QAAQC,IAAI,iBAAmBb,EAAKrB,IAC9CtP,GAAS2Q,EAAKrB,KAVX2B,GAAOM,QAAQC,IAAI,mBAAqBb,EAAKrB,IAChD4B,GAAS,EACTnR,EAAM4Q,EAAKrB,KAlBR2B,GAAOM,QAAQC,IAAI,SAEtBN,GAAS,EACTC,GAAW,GA2Bf,OAAOG,I,gBCtETxB,EAAQ0B,IAAM,SAAS9R,EAAM+R,GAC3B/I,KAAK+I,OAAS/I,KAAK+I,QAAUtK,QAAQuK,OACxB1T,MAAVyT,IAAqBA,EAAS/I,KAAK+I,QAEtC,IAAIE,EAAU/R,OAAOgS,OAAO,GAAIlJ,KAAKmJ,YAAanS,GAElD,GAAGgJ,KAAKoJ,OACN,IAAI,IAAI/R,KAAO2I,KAAKoJ,OAAO,CACzB,IAAIC,GAAM,IAAKC,MAAQ7G,UACvBwG,EAAQ5R,IAAQgS,EAAMrJ,KAAKoJ,OAAO/R,IAAMsK,WAAa,KAIzDoH,EAAOQ,MAAMvJ,KAAKvI,UAAUwR,GAAW,OAGzC7B,EAAQoC,KAAO,SAASlQ,GACtB,IAAIrC,EAAS,EAAQ,OACjBkH,GAAY,IAAKmL,MAAQ7G,UAEzBgH,GADAnQ,EAASA,GAAS,UACT,IAAIrC,GAKjB,OAJAwS,EAAMV,OAAS/I,KAAK+I,OACpBU,EAAMN,YAAcnJ,KAAKmJ,YACzBM,EAAML,OAASlS,OAAOgS,OAAO,GAAIlJ,KAAKoJ,QACtCK,EAAML,OAAO9P,GAAS6E,EACfsL,GAGTrC,EAAQsC,UAAY,SAASd,GAC3B,IACIe,EAAa,IADJ,EAAQ,QAEjBD,EAAaxS,OAAOgS,OAAO,GAAIlJ,KAAKmJ,YAAaP,GAIrD,OAHAe,EAAWZ,OAAS/I,KAAK+I,OACzBY,EAAWR,YAAcO,EACzBC,EAAWP,OAASpJ,KAAKoJ,OAClBO,GAGTvC,EAAQhL,MAAQ,SAASkG,EAAKrN,GAC5B+K,KAAK4J,cAAgB5J,KAAK4J,eAAiB,QAChCtU,IAAPL,IACFA,EAAK4U,KAAKC,SAASnI,WAAWpN,MAAM,EAAG,KAEzC,IAAIwV,EAAc/J,KAAK0J,UAAU,CAC/BtN,OAAO,EACPnH,GAAGA,EACHoU,KAAK,IAAKC,MAAQU,gBAGpB,GADAD,EAAYjB,IAAI,CAAE3H,QAAQmB,EAAInB,UAC1BmB,EAAI2H,MAAO,CACb,IAAIA,EAAQ3H,EAAI2H,MAAMjC,MAAM,MAC5B,IAAK,IAAIC,KAAQgC,EAAO,CACtB,GAAIhC,GAAQjI,KAAK4J,cAAe,MAChCG,EAAYjB,IAAI,CAAEb,KAAKA,EAAM1B,MAAM0D,EAAMhC,S,cCrD/C,IAAIiC,EAAkB,SAASnH,EAAKZ,GAClC,GAAwB,mBAAbY,EAAIoH,KAEb,IAAIA,EAAOpH,EAAIoH,YAIXA,EAAOpH,EAAIqH,aAAerH,EAAIoH,MAAQpH,EAAIvH,IAGhD,IAAI6O,EAAatH,EAAIwE,QAAUxE,EAAIwE,OAAO,mBACtC+C,EAAavH,EAAIwE,QAAUxE,EAAIwE,OAAO,gBAKtCgD,EAAe,CACjBC,GAJOzH,EAAIyH,IAAMH,GACAtH,EAAI0H,WAAWC,cAIhClB,MAAM,IAAKF,MAAQU,cACnBW,OAAQ5H,EAAI4H,OACZR,KAAMA,EACN,OAAUhI,EAAIyI,YAWhB,OARIN,IACFC,EAAYM,WAAaP,GAGxBnI,EAAI0E,MACL0D,EAAYO,eAAiB3I,EAAI0E,IAAI,kBACrC0D,EAAYQ,aAAe5I,EAAI0E,IAAI,iBAE9B0D,GA0BTnD,EAAQ4D,KAAO,SAASC,EAAQpP,EAASqP,GAiBvC,OAhBAlL,KAAKiL,OAASA,EAEVC,GAAcrP,EAITqP,IACc,mBAAXrP,GACRqP,EAAYrP,EACZA,EAAU,IAEVqP,EAAYhB,IARdgB,EAAYhB,EACZrO,EAAU,KAUZA,EAAUA,GAAW,IAEVsP,UAxCS,SAASF,EAAQpP,EAASqP,GAC9C,OAAO,SAASnI,EAAKZ,EAAKkF,GACxB,IAAIrQ,EAAOkU,EAAUnI,EAAKZ,GAC1B8I,EAAOnC,IAAI9R,GACXqQ,KAqCO+D,CAAgBH,EAAQpP,EAASqP,GAjCzB,SAASD,EAAQpP,EAASqP,GAC3C,OAAO,SAASnI,EAAKZ,EAAKkF,GACxB,IAAIgE,EAAUxP,EAAQwP,SAAW,UAC7B5B,EAAUwB,EAAOzB,KAAK6B,GACtB1W,EAAMwN,EAAIxN,IACdwN,EAAIxN,IAAM,SAASkT,EAAOyD,GACxB,IAAItU,EAAOkU,EAAUnI,EAAKZ,GAC1BA,EAAIxN,IAAMA,EACVwN,EAAIxN,IAAIkT,EAAOyD,GACf7B,EAAMX,IAAI9R,IAEZqQ,KAwBOkE,CAAaN,EAAQpP,EAASqP,IAIzC9D,EAAQ8C,gBAAkBA,G,gBClF1B,IAAIlC,EAAc,EAAQ,OACtBwD,EAAc,EAAQ,OACtBrD,EAAc,qBAGlBf,EAAQkB,aAAe,SAASzM,GAC9B,IAEIyM,EAAe,IAAIH,EACnBsD,EAAOzL,KAEP0L,EAAeF,GAAQ,SAASvD,GACtB,KAATA,GAAajI,KAAK2L,MAAMF,EAAK9T,MAAMsQ,OAgBxC,OAXAK,EAAaV,GAAG,QAAQ,SAASgE,GAC5BA,EAAOC,QAAQD,EAAOC,OAAO7L,MAChCA,KAAK8L,gBAAkBF,EAAO/K,KAAKmH,KAASnH,KAAK6K,MAKnDpD,EAAazH,KAAO,SAASkL,EAAalQ,GACxC,OAAOmE,KAAK8L,gBAAgBjL,KAAKkL,EAAalQ,IAGzCyM,GAITlB,EAAQ4E,gBAAkB,SAASnQ,GACjC,IAAI4P,EAAOzL,KAEX,IADInE,EAAUA,GAAW,IACdoQ,eAAe,aACxB,IAAIC,EAAQrQ,EAAQsQ,eAEhBD,EAAQ,KAGd,OAAOV,GAAQ,SAASxU,GACtBgJ,KAAK2L,MAAMF,EAAKhU,UAAUT,GAAQkV,MACjC,WACDlM,KAAK2L,MAAM,W,cC5CfvE,EAAQ3P,UAAY,SAAST,GAC3B,IAAIiR,EAAO,GAEX,IAAI,IAAI5Q,KAAOL,EAAM,CACnB,IAAIM,EAAQN,EAAKK,GACb+U,GAAU,EACF,MAAT9U,GACD8U,GAAU,EACV9U,EAAQ,IAELA,EAAQA,EAAMqK,WAEnB,IAAI0K,EAAiB/U,EAAMgV,QAAQ,MAAQ,GAAKhV,EAAMgV,QAAQ,MAAQ,GACjDhV,EAAMgV,QAAQ,MAAQ,GAAKhV,EAAMgV,QAAQ,OAAS,KAEpDhV,EAAQA,EAAM0F,QAAQ,SAAU,SAChDqP,IAAe/U,EAAQ,IAAMA,EAAQ,KAC3B,KAAVA,GAAiB8U,IAAS9U,EAAQ,MAErC2Q,GAAQ5Q,EAAM,IAAMC,EAAQ,IAI9B,OAAO2Q,EAAKsE,UAAU,EAAEtE,EAAK5T,OAAO,K,gBCtBtC,SAAS4C,KAETkQ,EAAOC,QAAUnQ,EAEjB,IAAIuV,EAAmB,EAAQ,OAC3BC,EAAmB,EAAQ,OAC3BC,EAAmB,EAAQ,OAC3BC,EAAmB,EAAQ,OAC3B1B,EAAmB,EAAQ,OAC3B2B,EAAmB,EAAQ,OAC3BC,EAAmB,EAAQ,OAG/B3V,OAAOgS,OAAOjS,EAAO6V,UAAW7B,GAChC/T,OAAOgS,OAAOjS,EAAO6V,UAAWN,GAEhCvV,EAAO6V,UAAUrV,UAAYoV,EAAWpV,UACxCR,EAAO6V,UAAUnV,MAAQgV,EAAahV,MAGtCV,EAAO6V,UAAUL,WAAa,SAAS5Q,GACrCA,IAAYA,EAAU,IACtB,IAAIuM,EAAOvM,EAAQ2L,aAAe,wBAClC,OAAOiF,EAAW,CAAEjF,YAAaY,EAAMF,OAAQlI,KAAKrI,SAItDV,EAAO6V,UAAUJ,iBAAmB,SAAS7Q,GAC3CA,IAAYA,EAAU,IACtB,IAAIuM,EAAOvM,EAAQ2L,aAAe,wBAClC,OAAOkF,EAAiB,CAAElF,YAAaY,KAGzCnR,EAAO6V,UAAUF,cAAgB,SAAS/Q,EAASqP,GACjD,OAAO0B,EAAc5B,KAAKhL,KAAMnE,EAASqP,IAG3CjU,EAAO6V,UAAUF,cAAc1C,gBAAkB0C,EAAc1C,gBAE/DhT,OAAOgS,OAAOjS,EAAQA,EAAO6V,Y,gBCjC7B,IAAItB,EAAU,EAAQ,OAClBuB,EAAU,uBAEd5F,EAAOC,QAIP,SAAgB4F,EAASC,GACvB,IAAIC,EAAU,IAAIH,EACdI,EAAQ,GACT,mBAAsBH,IACvBC,EAASD,EAASA,EAAU,MACzBA,IACHA,EAAU,SAEZ,SAASI,EAAKrE,EAAQsE,GACpB,GAAGJ,EAAQ,CACT,IACEI,EAAQJ,EAAOI,GAEjB,MAAO/K,GACL,OAAOyG,EAAOqE,KAAK,QAAS9K,QAE3B,IAAuB+K,GACxBtE,EAAO4C,MAAM0B,QAGftE,EAAO4C,MAAM0B,GAGjB,SAAShG,EAAM0B,EAAQuE,GACrB,IAAIC,GAAUJ,EAAQG,GAAQtF,MAAMgF,GACpCG,EAAQI,EAAOC,MAEf,IAAK,IAAI5G,EAAI,EAAGA,EAAI2G,EAAOlZ,OAAQuS,IAAK,CAEtCwG,EAAKrE,EADOwE,EAAO3G,KAKvB,OAAO4E,GAAQ,SAAUvX,GACvBoT,EAAKrH,KAAMkN,EAAQ3D,MAAMtV,OAE3B,WACKiZ,EAAQvY,KACT0S,EAAKrH,KAAMkN,EAAQvY,OACT,MAATwY,GACDC,EAAKpN,KAAMmN,GACbnN,KAAK2L,MAAM,W,gBCvDf,IAAI8B,EAAS,EAAQ,OAYrB,SAASjC,EAASjC,EAAO5U,EAAK+Y,GAC5BnE,EAAQA,GAAS,SAAUvS,GAAQgJ,KAAK2L,MAAM3U,IAC9CrC,EAAMA,GAAO,WAAcqL,KAAK2L,MAAM,OAEtC,IAAIgC,GAAQ,EAAOC,GAAY,EAAON,EAAS,GAAIO,GAAS,EACxD9E,EAAS,IAAI0E,EAYjB,SAASK,IACP,KAAMR,EAAOjZ,SAAW0U,EAAOgF,QAAQ,CACrC,IAAI/W,EAAOsW,EAAOU,QAClB,GAAG,OAAShX,EACV,OAAO+R,EAAOqE,KAAK,OAEnBrE,EAAOqE,KAAK,OAAQpW,IA2B1B,SAASiX,IACPlF,EAAOmF,UAAW,EAClBvZ,EAAIwZ,KAAKpF,IACLA,EAAOqF,UAAYrF,EAAOsF,aAC5BtF,EAAOuF,UAuCX,OAvFAvF,EAAOqF,SAAWrF,EAAOmF,UAAW,EACpCnF,EAAOgF,QAAS,EAGhBhF,EAAOsF,cAAgBX,IAA6B,IAArBA,EAAKW,aAEpCtF,EAAOQ,MAAQ,SAAUvS,GAEvB,OADAuS,EAAM4E,KAAKnO,KAAMhJ,IACT+R,EAAOgF,QAajBhF,EAAO4C,MAAQ5C,EAAO1T,KAAO,SAAU2B,GAErC,OAAG6W,IACS,OAAT7W,IAAe6W,GAAS,GAC3BP,EAAOjY,KAAK2B,GACZ8W,KAHkB/E,GAapBA,EAAOnB,GAAG,OAAO,WACfmB,EAAOqF,UAAW,GACdrF,EAAOmF,UAAYnF,EAAOsF,aAC5B5P,QAAQ8P,UAAS,WACfxF,EAAOuF,gBAWbvF,EAAOpU,IAAM,SAAUqC,GACrB,IAAG2W,EAIH,OAHAA,GAAQ,EACLa,UAAUna,QAAQ0U,EAAOQ,MAAMvS,GAClCiX,IACOlF,GAGTA,EAAOuF,QAAU,WACf,IAAGV,EAMH,OALAA,GAAY,EACZD,GAAQ,EACRL,EAAOjZ,OAAS,EAChB0U,EAAOmF,SAAWnF,EAAOqF,UAAW,EACpCrF,EAAOqE,KAAK,SACLrE,GAGTA,EAAO0F,MAAQ,WACb,IAAG1F,EAAOgF,OAEV,OADAhF,EAAOgF,QAAS,EACThF,GAGTA,EAAO2F,OAAS,WAUd,OATG3F,EAAOgF,SACRhF,EAAOgF,QAAS,EAChBhF,EAAOqE,KAAK,WAEdU,IAGI/E,EAAOgF,QACThF,EAAOqE,KAAK,SACPrE,GAEFA,EAlGC5B,EAAOC,QAAUoE,EAC3BA,EAAQA,QAAUA,G","sources":["webpack://grafana/./public/app/core/utils/tracing.ts","webpack://grafana/./public/app/plugins/datasource/jaeger/util.ts","webpack://grafana/./public/app/plugins/datasource/jaeger/components/AdvancedOptions.tsx","webpack://grafana/./public/app/plugins/datasource/jaeger/components/SearchForm.tsx","webpack://grafana/./public/app/plugins/datasource/jaeger/graphTransform.ts","webpack://grafana/./public/app/plugins/datasource/jaeger/datasource.ts","webpack://grafana/./public/app/plugins/datasource/jaeger/module.ts","webpack://grafana/./public/app/plugins/datasource/jaeger/components/ConfigEditor.tsx","webpack://grafana/./public/app/plugins/datasource/jaeger/components/QueryEditor.tsx","webpack://grafana/./public/app/plugins/datasource/jaeger/responseTransform.ts","webpack://grafana/../../opt/drone/yarncache/logfmt-npm-1.3.2-37fabee436-639d327c1e.zip/node_modules/logfmt/lib/body_parser.js","webpack://grafana/../../opt/drone/yarncache/logfmt-npm-1.3.2-37fabee436-639d327c1e.zip/node_modules/logfmt/lib/body_parser_stream.js","webpack://grafana/../../opt/drone/yarncache/logfmt-npm-1.3.2-37fabee436-639d327c1e.zip/node_modules/logfmt/lib/logfmt_parser.js","webpack://grafana/../../opt/drone/yarncache/logfmt-npm-1.3.2-37fabee436-639d327c1e.zip/node_modules/logfmt/lib/logger.js","webpack://grafana/../../opt/drone/yarncache/logfmt-npm-1.3.2-37fabee436-639d327c1e.zip/node_modules/logfmt/lib/request_logger.js","webpack://grafana/../../opt/drone/yarncache/logfmt-npm-1.3.2-37fabee436-639d327c1e.zip/node_modules/logfmt/lib/streaming.js","webpack://grafana/../../opt/drone/yarncache/logfmt-npm-1.3.2-37fabee436-639d327c1e.zip/node_modules/logfmt/lib/stringify.js","webpack://grafana/../../opt/drone/yarncache/logfmt-npm-1.3.2-37fabee436-639d327c1e.zip/node_modules/logfmt/logfmt.js","webpack://grafana/../../opt/drone/yarncache/split-npm-0.2.10-a950dc8c82-9eb1195608.zip/node_modules/split/index.js","webpack://grafana/../../opt/drone/yarncache/through-npm-2.3.8-df5f72a16e-a38c3e0598.zip/node_modules/through/index.js"],"sourcesContent":["/**\n * Get non overlapping duration of the ranges as they can overlap or have gaps.\n */\nimport { FieldType, MutableDataFrame, NodeGraphDataFrameFieldNames as Fields } from '@grafana/data';\n\nexport function getNonOverlappingDuration(ranges: Array<[number, number]>): number {\n  ranges.sort((a, b) => a[0] - b[0]);\n  const mergedRanges = ranges.reduce((acc, range) => {\n    if (!acc.length) {\n      return [range];\n    }\n    const tail = acc.slice(-1)[0];\n    const [prevStart, prevEnd] = tail;\n    const [start, end] = range;\n    if (end < prevEnd) {\n      // In this case the range is completely inside the prev range so we can just ignore it.\n      return acc;\n    }\n\n    if (start > prevEnd) {\n      // There is no overlap so we can just add it to stack\n      return [...acc, range];\n    }\n\n    // We know there is overlap and current range ends later than previous so we can just extend the range\n    return [...acc.slice(0, -1), [prevStart, end]] as Array<[number, number]>;\n  }, [] as Array<[number, number]>);\n\n  return mergedRanges.reduce((acc, range) => {\n    return acc + (range[1] - range[0]);\n  }, 0);\n}\n\n/**\n * Returns a map of the spans with children array for easier processing. It will also contain empty spans in case\n * span is missing but other spans are it's children. This is more generic because it needs to allow iterating over\n * both arrays and dataframe views.\n */\nexport function makeSpanMap<T>(getSpan: (index: number) => { span: T; id: string; parentIds: string[] } | undefined): {\n  [id: string]: { span: T; children: string[] };\n} {\n  const spanMap: { [id: string]: { span?: T; children: string[] } } = {};\n\n  let span;\n  for (let index = 0; (span = getSpan(index)), !!span; index++) {\n    if (!spanMap[span.id]) {\n      spanMap[span.id] = {\n        span: span.span,\n        children: [],\n      };\n    } else {\n      spanMap[span.id].span = span.span;\n    }\n\n    for (const parentId of span.parentIds) {\n      if (parentId) {\n        if (!spanMap[parentId]) {\n          spanMap[parentId] = {\n            span: undefined,\n            children: [span.id],\n          };\n        } else {\n          spanMap[parentId].children.push(span.id);\n        }\n      }\n    }\n  }\n  return spanMap as { [id: string]: { span: T; children: string[] } };\n}\n\nexport function getStats(duration: number, traceDuration: number, selfDuration: number) {\n  return {\n    main: `${toFixedNoTrailingZeros(duration)}ms (${toFixedNoTrailingZeros((duration / traceDuration) * 100)}%)`,\n    secondary: `${toFixedNoTrailingZeros(selfDuration)}ms (${toFixedNoTrailingZeros(\n      (selfDuration / duration) * 100\n    )}%)`,\n  };\n}\n\nfunction toFixedNoTrailingZeros(n: number) {\n  return parseFloat(n.toFixed(2));\n}\n\n/**\n * Create default frames used when returning data for node graph.\n */\nexport function makeFrames() {\n  const nodesFrame = new MutableDataFrame({\n    fields: [\n      { name: Fields.id, type: FieldType.string },\n      { name: Fields.title, type: FieldType.string },\n      { name: Fields.subTitle, type: FieldType.string },\n      { name: Fields.mainStat, type: FieldType.string, config: { displayName: 'Total time (% of trace)' } },\n      { name: Fields.secondaryStat, type: FieldType.string, config: { displayName: 'Self time (% of total)' } },\n      {\n        name: Fields.color,\n        type: FieldType.number,\n        config: { color: { mode: 'continuous-GrYlRd' }, displayName: 'Self time / Trace duration' },\n      },\n    ],\n    meta: {\n      preferredVisualisationType: 'nodeGraph',\n    },\n  });\n\n  const edgesFrame = new MutableDataFrame({\n    fields: [\n      { name: Fields.id, type: FieldType.string },\n      { name: Fields.target, type: FieldType.string },\n      { name: Fields.source, type: FieldType.string },\n    ],\n    meta: {\n      preferredVisualisationType: 'nodeGraph',\n    },\n  });\n\n  return [nodesFrame, edgesFrame];\n}\n","import logfmt from 'logfmt';\n\nexport function convertTagsLogfmt(tags: string | undefined) {\n  if (!tags) {\n    return '';\n  }\n  const data: any = logfmt.parse(tags);\n  Object.keys(data).forEach((key) => {\n    const value = data[key];\n    if (typeof value !== 'string') {\n      data[key] = String(value);\n    }\n  });\n  return JSON.stringify(data);\n}\n\nexport function transformToLogfmt(tags: string | undefined) {\n  if (!tags) {\n    return '';\n  }\n  try {\n    return logfmt.stringify(JSON.parse(tags));\n  } catch {\n    return tags;\n  }\n}\n","import { css } from '@emotion/css';\nimport React, { useState } from 'react';\nimport { CSSTransition } from 'react-transition-group';\n\nimport { GrafanaTheme } from '@grafana/data';\nimport { Icon, InlineField, InlineFieldRow, InlineLabel, Input, useStyles } from '@grafana/ui';\n\nimport { JaegerQuery } from '../types';\n\nconst durationPlaceholder = 'e.g. 1.2s, 100ms, 500us';\n\ntype Props = {\n  query: JaegerQuery;\n  onChange: (value: JaegerQuery) => void;\n};\n\nexport function AdvancedOptions({ query, onChange }: Props) {\n  const [showAdvancedOptions, setShowAdvancedOptions] = useState(false);\n  const styles = useStyles(getStyles);\n\n  return (\n    <div>\n      <InlineFieldRow>\n        <div className={styles.advancedOptionsContainer} onClick={() => setShowAdvancedOptions(!showAdvancedOptions)}>\n          <InlineLabel as=\"div\">\n            Advanced options{' '}\n            <Icon className={showAdvancedOptions ? styles.angleUp : styles.angleDown} name=\"angle-down\" />\n          </InlineLabel>\n        </div>\n      </InlineFieldRow>\n      <CSSTransition\n        in={showAdvancedOptions}\n        mountOnEnter={true}\n        unmountOnExit={true}\n        timeout={300}\n        classNames={styles}\n      >\n        <div>\n          <InlineFieldRow>\n            <InlineField label=\"Min Duration\" labelWidth={21} grow>\n              <Input\n                id=\"minDuration\"\n                name=\"minDuration\"\n                value={query.minDuration || ''}\n                placeholder={durationPlaceholder}\n                onChange={(v) =>\n                  onChange({\n                    ...query,\n                    minDuration: v.currentTarget.value,\n                  })\n                }\n              />\n            </InlineField>\n          </InlineFieldRow>\n          <InlineFieldRow>\n            <InlineField label=\"Max Duration\" labelWidth={21} grow>\n              <Input\n                id=\"maxDuration\"\n                name=\"maxDuration\"\n                value={query.maxDuration || ''}\n                placeholder={durationPlaceholder}\n                onChange={(v) =>\n                  onChange({\n                    ...query,\n                    maxDuration: v.currentTarget.value,\n                  })\n                }\n              />\n            </InlineField>\n          </InlineFieldRow>\n          <InlineFieldRow>\n            <InlineField label=\"Limit\" labelWidth={21} grow tooltip=\"Maximum numbers of returned results\">\n              <Input\n                id=\"limit\"\n                name=\"limit\"\n                value={query.limit || ''}\n                type=\"number\"\n                onChange={(v) =>\n                  onChange({\n                    ...query,\n                    limit: v.currentTarget.value ? parseInt(v.currentTarget.value, 10) : undefined,\n                  })\n                }\n              />\n            </InlineField>\n          </InlineFieldRow>\n        </div>\n      </CSSTransition>\n    </div>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme) {\n  return {\n    advancedOptionsContainer: css`\n      margin: 0 ${theme.spacing.xs} ${theme.spacing.xs} 0;\n      width: 100%;\n      cursor: pointer;\n    `,\n    enter: css`\n      label: enter;\n      height: 0;\n      opacity: 0;\n    `,\n    enterActive: css`\n      label: enterActive;\n      height: 108px;\n      opacity: 1;\n      transition: height 300ms ease, opacity 300ms ease;\n    `,\n    exit: css`\n      label: exit;\n      height: 108px;\n      opacity: 1;\n    `,\n    exitActive: css`\n      label: exitActive;\n      height: 0;\n      opacity: 0;\n      transition: height 300ms ease, opacity 300ms ease;\n    `,\n    angleUp: css`\n      transform: rotate(-180deg);\n      transition: transform 300ms;\n    `,\n    angleDown: css`\n      transform: rotate(0deg);\n      transition: transform 300ms;\n    `,\n  };\n}\n","import { css } from '@emotion/css';\nimport React, { useCallback, useEffect, useState } from 'react';\n\nimport { SelectableValue, toOption } from '@grafana/data';\nimport { getTemplateSrv } from '@grafana/runtime';\nimport { fuzzyMatch, InlineField, InlineFieldRow, Input, Select } from '@grafana/ui';\nimport { notifyApp } from 'app/core/actions';\nimport { createErrorNotification } from 'app/core/copy/appNotification';\nimport { dispatch } from 'app/store/store';\n\nimport { JaegerDatasource } from '../datasource';\nimport { JaegerQuery } from '../types';\nimport { transformToLogfmt } from '../util';\n\nimport { AdvancedOptions } from './AdvancedOptions';\n\ntype Props = {\n  datasource: JaegerDatasource;\n  query: JaegerQuery;\n  onChange: (value: JaegerQuery) => void;\n};\n\nexport const ALL_OPERATIONS_KEY = 'All';\nconst allOperationsOption: SelectableValue<string> = {\n  label: ALL_OPERATIONS_KEY,\n  value: undefined,\n};\n\nexport function SearchForm({ datasource, query, onChange }: Props) {\n  const [serviceOptions, setServiceOptions] = useState<Array<SelectableValue<string>>>();\n  const [operationOptions, setOperationOptions] = useState<Array<SelectableValue<string>>>();\n  const [isLoading, setIsLoading] = useState<{\n    services: boolean;\n    operations: boolean;\n  }>({\n    services: false,\n    operations: false,\n  });\n\n  const loadOptions = useCallback(\n    async (url: string, loaderOfType: string, query = ''): Promise<Array<SelectableValue<string>>> => {\n      setIsLoading((prevValue) => ({ ...prevValue, [loaderOfType]: true }));\n\n      try {\n        const values: string[] | null = await datasource.metadataRequest(url);\n        if (!values) {\n          return [{ label: `No ${loaderOfType} found`, value: `No ${loaderOfType} found` }];\n        }\n\n        const options: SelectableValue[] = values.sort().map((option) => ({\n          label: option,\n          value: option,\n        }));\n\n        const filteredOptions = options.filter((item) => (item.value ? fuzzyMatch(item.value, query).found : false));\n        return filteredOptions;\n      } catch (error) {\n        if (error instanceof Error) {\n          dispatch(notifyApp(createErrorNotification('Error', error)));\n        }\n        return [];\n      } finally {\n        setIsLoading((prevValue) => ({ ...prevValue, [loaderOfType]: false }));\n      }\n    },\n    [datasource]\n  );\n\n  useEffect(() => {\n    const getServices = async () => {\n      const services = await loadOptions('/api/services', 'services');\n      if (query.service && getTemplateSrv().containsTemplate(query.service)) {\n        services.push(toOption(query.service));\n      }\n      setServiceOptions(services);\n    };\n    getServices();\n  }, [datasource, loadOptions, query.service]);\n\n  useEffect(() => {\n    const getOperations = async () => {\n      const operations = await loadOptions(\n        `/api/services/${encodeURIComponent(getTemplateSrv().replace(query.service!))}/operations`,\n        'operations'\n      );\n      if (query.operation && getTemplateSrv().containsTemplate(query.operation)) {\n        operations.push(toOption(query.operation));\n      }\n      setOperationOptions([allOperationsOption, ...operations]);\n    };\n    if (query.service) {\n      getOperations();\n    }\n  }, [datasource, query.service, loadOptions, query.operation]);\n\n  return (\n    <div className={css({ maxWidth: '500px' })}>\n      <InlineFieldRow>\n        <InlineField label=\"Service\" labelWidth={14} grow>\n          <Select\n            inputId=\"service\"\n            options={serviceOptions}\n            onOpenMenu={() => loadOptions('/api/services', 'services')}\n            isLoading={isLoading.services}\n            value={serviceOptions?.find((v) => v?.value === query.service) || undefined}\n            onChange={(v) =>\n              onChange({\n                ...query,\n                service: v?.value!,\n                operation: query.service !== v?.value ? undefined : query.operation,\n              })\n            }\n            menuPlacement=\"bottom\"\n            isClearable\n            aria-label={'select-service-name'}\n            allowCustomValue={true}\n          />\n        </InlineField>\n      </InlineFieldRow>\n      <InlineFieldRow>\n        <InlineField label=\"Operation\" labelWidth={14} grow disabled={!query.service}>\n          <Select\n            inputId=\"operation\"\n            options={operationOptions}\n            onOpenMenu={() =>\n              loadOptions(\n                `/api/services/${encodeURIComponent(getTemplateSrv().replace(query.service!))}/operations`,\n                'operations'\n              )\n            }\n            isLoading={isLoading.operations}\n            value={operationOptions?.find((v) => v.value === query.operation) || null}\n            onChange={(v) =>\n              onChange({\n                ...query,\n                operation: v?.value! || undefined,\n              })\n            }\n            menuPlacement=\"bottom\"\n            isClearable\n            aria-label={'select-operation-name'}\n            allowCustomValue={true}\n          />\n        </InlineField>\n      </InlineFieldRow>\n      <InlineFieldRow>\n        <InlineField label=\"Tags\" labelWidth={14} grow>\n          <Input\n            id=\"tags\"\n            value={transformToLogfmt(query.tags)}\n            placeholder=\"http.status_code=200 error=true\"\n            onChange={(v) =>\n              onChange({\n                ...query,\n                tags: v.currentTarget.value,\n              })\n            }\n          />\n        </InlineField>\n      </InlineFieldRow>\n      <AdvancedOptions query={query} onChange={onChange} />\n    </div>\n  );\n}\n\nexport default SearchForm;\n","import { DataFrame, NodeGraphDataFrameFieldNames as Fields } from '@grafana/data';\n\nimport { getNonOverlappingDuration, getStats, makeFrames, makeSpanMap } from '../../../core/utils/tracing';\n\nimport { Span, TraceResponse } from './types';\n\ninterface Node {\n  [Fields.id]: string;\n  [Fields.title]: string;\n  [Fields.subTitle]: string;\n  [Fields.mainStat]: string;\n  [Fields.secondaryStat]: string;\n  [Fields.color]: number;\n}\n\ninterface Edge {\n  [Fields.id]: string;\n  [Fields.target]: string;\n  [Fields.source]: string;\n}\n\nexport function createGraphFrames(data: TraceResponse): DataFrame[] {\n  const { nodes, edges } = convertTraceToGraph(data);\n  const [nodesFrame, edgesFrame] = makeFrames();\n\n  for (const node of nodes) {\n    nodesFrame.add(node);\n  }\n\n  for (const edge of edges) {\n    edgesFrame.add(edge);\n  }\n\n  return [nodesFrame, edgesFrame];\n}\n\nfunction convertTraceToGraph(data: TraceResponse): { nodes: Node[]; edges: Edge[] } {\n  const nodes: Node[] = [];\n  const edges: Edge[] = [];\n\n  const traceDuration = findTraceDuration(data.spans);\n\n  const spanMap = makeSpanMap((index) => {\n    if (index >= data.spans.length) {\n      return undefined;\n    }\n    const span = data.spans[index];\n    return {\n      span,\n      id: span.spanID,\n      parentIds: span.references?.filter((r) => r.refType === 'CHILD_OF').map((r) => r.spanID) || [],\n    };\n  });\n\n  for (const span of data.spans) {\n    const process = data.processes[span.processID];\n\n    const ranges: Array<[number, number]> = spanMap[span.spanID].children.map((c) => {\n      const span = spanMap[c].span;\n      return [span.startTime, span.startTime + span.duration];\n    });\n    const childrenDuration = getNonOverlappingDuration(ranges);\n    const selfDuration = span.duration - childrenDuration;\n    const stats = getStats(span.duration / 1000, traceDuration / 1000, selfDuration / 1000);\n\n    nodes.push({\n      [Fields.id]: span.spanID,\n      [Fields.title]: process?.serviceName ?? '',\n      [Fields.subTitle]: span.operationName,\n      [Fields.mainStat]: stats.main,\n      [Fields.secondaryStat]: stats.secondary,\n      [Fields.color]: selfDuration / traceDuration,\n    });\n\n    const parentSpanID = span.references?.find((r) => r.refType === 'CHILD_OF')?.spanID;\n    // Sometimes some span can be missing. Don't add edges for those.\n    if (parentSpanID && spanMap[parentSpanID].span) {\n      edges.push({\n        [Fields.id]: parentSpanID + '--' + span.spanID,\n        [Fields.target]: span.spanID,\n        [Fields.source]: parentSpanID,\n      });\n    }\n  }\n\n  return { nodes, edges };\n}\n\n/**\n * Get the duration of the whole trace as it isn't a part of the response data.\n * Note: Seems like this should be the same as just longest span, but this is probably safer.\n */\nfunction findTraceDuration(spans: Span[]): number {\n  let traceEndTime = 0;\n  let traceStartTime = Infinity;\n\n  for (const span of spans) {\n    if (span.startTime < traceStartTime) {\n      traceStartTime = span.startTime;\n    }\n\n    if (span.startTime + span.duration > traceEndTime) {\n      traceEndTime = span.startTime + span.duration;\n    }\n  }\n\n  return traceEndTime - traceStartTime;\n}\n","import { identity, omit, pick, pickBy } from 'lodash';\nimport { lastValueFrom, Observable, of } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\n\nimport {\n  DataQueryRequest,\n  DataQueryResponse,\n  DataSourceApi,\n  DataSourceInstanceSettings,\n  DataSourceJsonData,\n  dateMath,\n  DateTime,\n  FieldType,\n  MutableDataFrame,\n  ScopedVars,\n} from '@grafana/data';\nimport { BackendSrvRequest, getBackendSrv, getTemplateSrv, TemplateSrv } from '@grafana/runtime';\nimport { SpanBarOptions } from '@jaegertracing/jaeger-ui-components';\nimport { NodeGraphOptions } from 'app/core/components/NodeGraphSettings';\nimport { serializeParams } from 'app/core/utils/fetch';\nimport { getTimeSrv, TimeSrv } from 'app/features/dashboard/services/TimeSrv';\n\nimport { ALL_OPERATIONS_KEY } from './components/SearchForm';\nimport { createGraphFrames } from './graphTransform';\nimport { createTableFrame, createTraceFrame } from './responseTransform';\nimport { JaegerQuery } from './types';\nimport { convertTagsLogfmt } from './util';\n\nexport interface JaegerJsonData extends DataSourceJsonData {\n  nodeGraph?: NodeGraphOptions;\n}\n\nexport class JaegerDatasource extends DataSourceApi<JaegerQuery, JaegerJsonData> {\n  uploadedJson: string | ArrayBuffer | null = null;\n  nodeGraph?: NodeGraphOptions;\n  spanBar?: SpanBarOptions;\n  constructor(\n    private instanceSettings: DataSourceInstanceSettings<JaegerJsonData>,\n    private readonly timeSrv: TimeSrv = getTimeSrv(),\n    private readonly templateSrv: TemplateSrv = getTemplateSrv()\n  ) {\n    super(instanceSettings);\n    this.nodeGraph = instanceSettings.jsonData.nodeGraph;\n  }\n\n  async metadataRequest(url: string, params?: Record<string, any>): Promise<any> {\n    const res = await lastValueFrom(this._request(url, params, { hideFromInspector: true }));\n    return res.data.data;\n  }\n\n  query(options: DataQueryRequest<JaegerQuery>): Observable<DataQueryResponse> {\n    // At this moment we expect only one target. In case we somehow change the UI to be able to show multiple\n    // traces at one we need to change this.\n    const target: JaegerQuery = options.targets[0];\n    if (!target) {\n      return of({ data: [emptyTraceDataFrame] });\n    }\n\n    if (target.queryType !== 'search' && target.query) {\n      return this._request(\n        `/api/traces/${encodeURIComponent(this.templateSrv.replace(target.query, options.scopedVars))}`\n      ).pipe(\n        map((response) => {\n          const traceData = response?.data?.data?.[0];\n          if (!traceData) {\n            return { data: [emptyTraceDataFrame] };\n          }\n          let data = [createTraceFrame(traceData)];\n          if (this.nodeGraph?.enabled) {\n            data.push(...createGraphFrames(traceData));\n          }\n          return {\n            data,\n          };\n        })\n      );\n    }\n\n    if (target.queryType === 'upload') {\n      if (!this.uploadedJson) {\n        return of({ data: [] });\n      }\n\n      try {\n        const traceData = JSON.parse(this.uploadedJson as string).data[0];\n        let data = [createTraceFrame(traceData)];\n        if (this.nodeGraph?.enabled) {\n          data.push(...createGraphFrames(traceData));\n        }\n        return of({ data });\n      } catch (error) {\n        return of({ error: { message: 'JSON is not valid Jaeger format' }, data: [] });\n      }\n    }\n\n    let jaegerInterpolated = pick(this.applyVariables(target, options.scopedVars), [\n      'service',\n      'operation',\n      'tags',\n      'minDuration',\n      'maxDuration',\n      'limit',\n    ]);\n    // remove empty properties\n    let jaegerQuery = pickBy(jaegerInterpolated, identity);\n\n    if (jaegerQuery.operation === ALL_OPERATIONS_KEY) {\n      jaegerQuery = omit(jaegerQuery, 'operation');\n    }\n\n    if (jaegerQuery.tags) {\n      jaegerQuery = {\n        ...jaegerQuery,\n        tags: convertTagsLogfmt(jaegerQuery.tags.toString()),\n      };\n    }\n\n    // TODO: this api is internal, used in jaeger ui. Officially they have gRPC api that should be used.\n    return this._request(`/api/traces`, {\n      ...jaegerQuery,\n      ...this.getTimeRange(),\n      lookback: 'custom',\n    }).pipe(\n      map((response) => {\n        return {\n          data: [createTableFrame(response.data.data, this.instanceSettings)],\n        };\n      })\n    );\n  }\n\n  interpolateVariablesInQueries(queries: JaegerQuery[], scopedVars: ScopedVars): JaegerQuery[] {\n    if (!queries || queries.length === 0) {\n      return [];\n    }\n\n    return queries.map((query) => {\n      return {\n        ...query,\n        datasource: this.getRef(),\n        ...this.applyVariables(query, scopedVars),\n      };\n    });\n  }\n\n  applyVariables(query: JaegerQuery, scopedVars: ScopedVars) {\n    let expandedQuery = { ...query };\n\n    if (query.tags && this.templateSrv.containsTemplate(query.tags)) {\n      expandedQuery = {\n        ...query,\n        tags: this.templateSrv.replace(query.tags, scopedVars),\n      };\n    }\n\n    return {\n      ...expandedQuery,\n      service: this.templateSrv.replace(query.service ?? '', scopedVars),\n      operation: this.templateSrv.replace(query.operation ?? '', scopedVars),\n      minDuration: this.templateSrv.replace(query.minDuration ?? '', scopedVars),\n      maxDuration: this.templateSrv.replace(query.maxDuration ?? '', scopedVars),\n    };\n  }\n\n  async testDatasource(): Promise<any> {\n    return lastValueFrom(\n      this._request('/api/services').pipe(\n        map((res) => {\n          const values: any[] = res?.data?.data || [];\n          const testResult =\n            values.length > 0\n              ? { status: 'success', message: 'Data source connected and services found.' }\n              : {\n                  status: 'error',\n                  message:\n                    'Data source connected, but no services received. Verify that Jaeger is configured properly.',\n                };\n          return testResult;\n        }),\n        catchError((err: any) => {\n          let message = 'Jaeger: ';\n          if (err.statusText) {\n            message += err.statusText;\n          } else {\n            message += 'Cannot connect to Jaeger';\n          }\n\n          if (err.status) {\n            message += `. ${err.status}`;\n          }\n\n          if (err.data && err.data.message) {\n            message += `. ${err.data.message}`;\n          } else if (err.data) {\n            message += `. ${JSON.stringify(err.data)}`;\n          }\n          return of({ status: 'error', message: message });\n        })\n      )\n    );\n  }\n\n  getTimeRange(): { start: number; end: number } {\n    const range = this.timeSrv.timeRange();\n    return {\n      start: getTime(range.from, false),\n      end: getTime(range.to, true),\n    };\n  }\n\n  getQueryDisplayText(query: JaegerQuery) {\n    return query.query || '';\n  }\n\n  private _request(apiUrl: string, data?: any, options?: Partial<BackendSrvRequest>): Observable<Record<string, any>> {\n    const params = data ? serializeParams(data) : '';\n    const url = `${this.instanceSettings.url}${apiUrl}${params.length ? `?${params}` : ''}`;\n    const req = {\n      ...options,\n      url,\n    };\n\n    return getBackendSrv().fetch(req);\n  }\n}\n\nfunction getTime(date: string | DateTime, roundUp: boolean) {\n  if (typeof date === 'string') {\n    date = dateMath.parse(date, roundUp)!;\n  }\n  return date.valueOf() * 1000;\n}\n\nconst emptyTraceDataFrame = new MutableDataFrame({\n  fields: [\n    {\n      name: 'trace',\n      type: FieldType.trace,\n      values: [],\n    },\n  ],\n  meta: {\n    preferredVisualisationType: 'trace',\n    custom: {\n      traceFormat: 'jaeger',\n    },\n  },\n});\n","import { DataSourcePlugin } from '@grafana/data';\n\nimport { ConfigEditor } from './components/ConfigEditor';\nimport { QueryEditor } from './components/QueryEditor';\nimport { JaegerDatasource } from './datasource';\n\nexport const plugin = new DataSourcePlugin(JaegerDatasource).setConfigEditor(ConfigEditor).setQueryEditor(QueryEditor);\n","import React from 'react';\n\nimport { DataSourcePluginOptionsEditorProps } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { DataSourceHttpSettings } from '@grafana/ui';\nimport { SpanBarSettings } from '@jaegertracing/jaeger-ui-components';\nimport { NodeGraphSettings } from 'app/core/components/NodeGraphSettings';\nimport { TraceToLogsSettings } from 'app/core/components/TraceToLogs/TraceToLogsSettings';\nimport { TraceToMetricsSettings } from 'app/core/components/TraceToMetrics/TraceToMetricsSettings';\n\nexport type Props = DataSourcePluginOptionsEditorProps;\n\nexport const ConfigEditor: React.FC<Props> = ({ options, onOptionsChange }) => {\n  return (\n    <>\n      <DataSourceHttpSettings\n        defaultUrl=\"http://localhost:16686\"\n        dataSourceConfig={options}\n        showAccessOptions={false}\n        onChange={onOptionsChange}\n      />\n\n      <div className=\"gf-form-group\">\n        <TraceToLogsSettings options={options} onOptionsChange={onOptionsChange} />\n      </div>\n\n      {config.featureToggles.traceToMetrics ? (\n        <div className=\"gf-form-group\">\n          <TraceToMetricsSettings options={options} onOptionsChange={onOptionsChange} />\n        </div>\n      ) : null}\n\n      <div className=\"gf-form-group\">\n        <NodeGraphSettings options={options} onOptionsChange={onOptionsChange} />\n      </div>\n\n      <div className=\"gf-form-group\">\n        <SpanBarSettings options={options} onOptionsChange={onOptionsChange} />\n      </div>\n    </>\n  );\n};\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { QueryEditorProps } from '@grafana/data';\nimport { FileDropzone, InlineField, InlineFieldRow, QueryField, RadioButtonGroup, useTheme2 } from '@grafana/ui';\n\nimport { JaegerDatasource } from '../datasource';\nimport { JaegerQuery, JaegerQueryType } from '../types';\n\nimport { SearchForm } from './SearchForm';\n\ntype Props = QueryEditorProps<JaegerDatasource, JaegerQuery>;\n\nexport function QueryEditor({ datasource, query, onChange, onRunQuery }: Props) {\n  const theme = useTheme2();\n\n  const onChangeQuery = (value: string) => {\n    const nextQuery: JaegerQuery = { ...query, query: value };\n    onChange(nextQuery);\n  };\n\n  const renderEditorBody = () => {\n    switch (query.queryType) {\n      case 'search':\n        return <SearchForm datasource={datasource} query={query} onChange={onChange} />;\n      case 'upload':\n        return (\n          <div className={css({ padding: theme.spacing(2) })}>\n            <FileDropzone\n              options={{ multiple: false }}\n              onLoad={(result) => {\n                datasource.uploadedJson = result;\n                onRunQuery();\n              }}\n            />\n          </div>\n        );\n      default:\n        return (\n          <InlineFieldRow>\n            <InlineField label=\"Trace ID\" labelWidth={14} grow>\n              <QueryField\n                query={query.query}\n                onChange={onChangeQuery}\n                onRunQuery={onRunQuery}\n                onBlur={() => {}}\n                placeholder={'Enter a Trace ID (run with Shift+Enter)'}\n                portalOrigin=\"jaeger\"\n              />\n            </InlineField>\n          </InlineFieldRow>\n        );\n    }\n  };\n\n  return (\n    <>\n      <div className={css({ width: '100%' })}>\n        <InlineFieldRow>\n          <InlineField label=\"Query type\">\n            <RadioButtonGroup<JaegerQueryType>\n              options={[\n                { value: 'search', label: 'Search' },\n                { value: undefined, label: 'TraceID' },\n                { value: 'upload', label: 'JSON file' },\n              ]}\n              value={query.queryType}\n              onChange={(v) =>\n                onChange({\n                  ...query,\n                  queryType: v,\n                })\n              }\n              size=\"md\"\n            />\n          </InlineField>\n        </InlineFieldRow>\n        {renderEditorBody()}\n      </div>\n    </>\n  );\n}\n","import {\n  DataFrame,\n  DataSourceInstanceSettings,\n  FieldType,\n  MutableDataFrame,\n  TraceLog,\n  TraceSpanRow,\n} from '@grafana/data';\nimport { transformTraceData } from '@jaegertracing/jaeger-ui-components';\n\nimport { JaegerResponse, Span, TraceProcess, TraceResponse } from './types';\n\nexport function createTraceFrame(data: TraceResponse): DataFrame {\n  const spans = data.spans.map((s) => toSpanRow(s, data.processes));\n\n  const frame = new MutableDataFrame({\n    fields: [\n      { name: 'traceID', type: FieldType.string },\n      { name: 'spanID', type: FieldType.string },\n      { name: 'parentSpanID', type: FieldType.string },\n      { name: 'operationName', type: FieldType.string },\n      { name: 'serviceName', type: FieldType.string },\n      { name: 'serviceTags', type: FieldType.other },\n      { name: 'startTime', type: FieldType.number },\n      { name: 'duration', type: FieldType.number },\n      { name: 'logs', type: FieldType.other },\n      { name: 'tags', type: FieldType.other },\n      { name: 'warnings', type: FieldType.other },\n      { name: 'stackTraces', type: FieldType.other },\n    ],\n    meta: {\n      preferredVisualisationType: 'trace',\n      custom: {\n        traceFormat: 'jaeger',\n      },\n    },\n  });\n\n  for (const span of spans) {\n    frame.add(span);\n  }\n\n  return frame;\n}\n\nfunction toSpanRow(span: Span, processes: Record<string, TraceProcess>): TraceSpanRow {\n  return {\n    spanID: span.spanID,\n    traceID: span.traceID,\n    parentSpanID: span.references?.find((r) => r.refType === 'CHILD_OF')?.spanID,\n    operationName: span.operationName,\n    // from micro to millis\n    startTime: span.startTime / 1000,\n    duration: span.duration / 1000,\n    logs: span.logs.map((l) => ({\n      ...l,\n      timestamp: l.timestamp / 1000,\n    })),\n    tags: span.tags,\n    warnings: span.warnings ?? undefined,\n    stackTraces: span.stackTraces,\n    serviceName: processes[span.processID].serviceName,\n    serviceTags: processes[span.processID].tags,\n  };\n}\n\nexport function createTableFrame(data: TraceResponse[], instanceSettings: DataSourceInstanceSettings): DataFrame {\n  const frame = new MutableDataFrame({\n    fields: [\n      {\n        name: 'traceID',\n        type: FieldType.string,\n        config: {\n          unit: 'string',\n          displayNameFromDS: 'Trace ID',\n          links: [\n            {\n              title: 'Trace: ${__value.raw}',\n              url: '',\n              internal: {\n                datasourceUid: instanceSettings.uid,\n                datasourceName: instanceSettings.name,\n                query: {\n                  query: '${__value.raw}',\n                },\n              },\n            },\n          ],\n        },\n      },\n      { name: 'traceName', type: FieldType.string, config: { displayNameFromDS: 'Trace name' } },\n      { name: 'startTime', type: FieldType.time, config: { displayNameFromDS: 'Start time' } },\n      { name: 'duration', type: FieldType.number, config: { displayNameFromDS: 'Duration', unit: 's' } },\n    ],\n    meta: {\n      preferredVisualisationType: 'table',\n    },\n  });\n  // Show the most recent traces\n  const traceData = data.map(transformToTraceData).sort((a, b) => b?.startTime! - a?.startTime!);\n\n  for (const trace of traceData) {\n    frame.add(trace);\n  }\n\n  return frame;\n}\n\nfunction transformToTraceData(data: TraceResponse) {\n  const traceData = transformTraceData(data);\n  if (!traceData) {\n    return;\n  }\n\n  return {\n    traceID: traceData.traceID,\n    startTime: traceData.startTime / 1000,\n    duration: traceData.duration,\n    traceName: traceData.traceName,\n  };\n}\n\nexport function transformToJaeger(data: MutableDataFrame): JaegerResponse {\n  let traceResponse: TraceResponse = {\n    traceID: '',\n    spans: [],\n    processes: {},\n    warnings: null,\n  };\n  let processes: string[] = [];\n\n  for (let i = 0; i < data.length; i++) {\n    const span = data.get(i);\n\n    // Set traceID\n    if (!traceResponse.traceID) {\n      traceResponse.traceID = span.traceID;\n    }\n\n    // Create process if doesn't exist\n    if (!processes.find((p) => p === span.serviceName)) {\n      processes.push(span.serviceName);\n      traceResponse.processes[`p${processes.length}`] = {\n        serviceName: span.serviceName,\n        tags: span.serviceTags,\n      };\n    }\n\n    // Create span\n    traceResponse.spans.push({\n      traceID: span.traceID,\n      spanID: span.spanID,\n      duration: span.duration * 1000,\n      references: span.parentSpanID\n        ? [\n            {\n              refType: 'CHILD_OF',\n              spanID: span.parentSpanID,\n              traceID: span.traceID,\n            },\n          ]\n        : [],\n      flags: 0,\n      logs: span.logs.map((l: TraceLog) => ({\n        ...l,\n        timestamp: l.timestamp * 1000,\n      })),\n      operationName: span.operationName,\n      processID:\n        Object.keys(traceResponse.processes).find(\n          (key) => traceResponse.processes[key].serviceName === span.serviceName\n        ) || '',\n      startTime: span.startTime * 1000,\n      tags: span.tags,\n      warnings: span.warnings ? span.warnings : null,\n    });\n  }\n\n  return { data: [traceResponse], total: 0, limit: 0, offset: 0, errors: null };\n}\n","\n/*\nModule dependencies.\n*/\n\n/*\nJSON:\n\nParse logplex request bodies, providing the\nparsed object as `req.body`.\n\nOptions: none\n\n@param content_type {String} use when Content-Type matches this string\n@param parser {Function} parsing function takes String body and returns new body\n@return {Function}\n@api public\n*/\n\nexports = module.exports = function(options) {\n  var limit;\n  if (options == null) options = {};\n\n  return function(req, res, next) {\n    if (req._body) return next();\n    var is_mime = req.header('content-type') === options.contentType;\n    if (!is_mime) return next();\n    req._body = true;\n    req.body = req.body || {};\n    var buf;\n    buf = \"\";\n    req.setEncoding(\"utf8\");\n    req.on(\"data\", function(chunk) {\n      return buf += chunk;\n    });\n    req.on(\"end\", function() {\n      try {\n        var lines = []\n        buf.trim().split(\"\\n\").forEach(function(line){\n          lines.push(options.parser(line))\n        })\n        req.body = lines;\n      } catch (err) {\n        err.body = buf;\n        err.status = 400;\n        return next(err);\n      }\n      return next();\n    });\n  };\n};\n","var split = require('split');\nvar through = require('through');\nvar Readable = require('stream').Readable;\nvar PassThrough = require('stream').PassThrough;\nvar logfmt   = require('../logfmt');\n\nexports = module.exports = function(options){\n  if(options == null) options = {};\n  var mime = options.contentType || \"application/logplex-1\";\n\n  return function(req, res, next) {\n\n    //honor already parsed bodies\n    if (req._body) return next();\n\n    //mime-type check\n    var is_mime = req.header('content-type') === mime;\n    if (!is_mime) return next();\n    req._body = true;\n    req.body = new PassThrough({objectMode: true});\n    req.pipe(logfmt.streamParser()).pipe(req.body);\n\n    return next();\n  }\n}\n\n","exports.debug = false;\n\nexports.parse = function(line) {\n  var key = '';\n  var value = '';\n  var is_number = true;\n  var in_key    = false;\n  var in_value  = false;\n  var in_quote  = false;\n  var had_quote = false;\n  var object    = {};\n  var debug     = exports.debug;\n\n  if(line[line.length - 1] == '\\n'){\n    line = line.slice(0,line.length - 1)\n  }\n\n  for(var i=0; i <= line.length; i++){\n\n    if((line[i] == ' ' && !in_quote) || i == line.length){\n      if(in_key && key.length > 0){\n        object[key] = true;\n      }else if(in_value){\n        if(value == 'true') value = true;\n        else if(value == 'false') value = false;\n        else if(value === '' && !had_quote) value = null;\n        object[key] = value;\n        value = '';\n      }\n\n      if(i == line.length) break;\n      else {\n        in_key   = false;\n        in_value = false;\n        in_quote = false;\n        had_quote = false;\n      }\n    }\n\n    if(line[i] == '=' && !in_quote){\n      if(debug) console.log('split')\n      //split\n      in_key = false;\n      in_value = true;\n    }\n    else if(line[i] == '\\\\'){\n      i ++ ;\n      value += line[i];\n      if(debug) console.log('escape: ' + line[i])\n    }\n    else if(line[i] == '\"'){\n      had_quote = true;\n      in_quote = !in_quote;\n      if(debug) console.log('in quote: ' + in_quote)\n    }\n    else if(line[i] != ' ' && !in_value && !in_key){\n      if(debug) console.log('start key with: ' + line[i])\n      in_key = true;\n      key = line[i];\n    }\n    else if(in_key){\n      if(debug) console.log('add to key: ' + line[i])\n      key += line[i]\n    }\n    else if(in_value){\n      if(debug) console.log('add to value: ' + line[i])\n      value += line[i];\n    }\n  }\n\n  return object;\n}\n","exports.log = function(data, stream) {\n  this.stream = this.stream || process.stdout;\n  if(stream == undefined) stream = this.stream;\n\n  var logData = Object.assign({}, this.defaultData, data);\n\n  if(this.timers){\n    for(var key in this.timers){\n      var now = (new Date()).getTime()\n      logData[key] = (now - this.timers[key]).toString() + 'ms' ;\n    }\n  }\n\n  stream.write(this.stringify(logData) + \"\\n\");\n}\n\nexports.time = function(label) {\n  var logfmt = require('../logfmt');\n  var startTime = (new Date()).getTime();\n  var label  = label || 'elapsed';\n  var timer  = new logfmt();\n  timer.stream = this.stream;\n  timer.defaultData = this.defaultData;\n  timer.timers = Object.assign({}, this.timers)\n  timer.timers[label] = startTime;\n  return timer;\n}\n\nexports.namespace = function(object) {\n  var logfmt = require('../logfmt');\n  var namespaced = new logfmt()\n  var namespace  = Object.assign({}, this.defaultData, object);\n  namespaced.stream = this.stream;\n  namespaced.defaultData = namespace\n  namespaced.timers = this.timers;\n  return namespaced;\n}\n\nexports.error = function(err, id) {\n  this.maxErrorLines = this.maxErrorLines || 10;\n  if (id === undefined) {\n    id = Math.random().toString().slice(2, 12);\n  }\n  var errorLogger = this.namespace({\n    error: true,\n    id:id,\n    now: (new Date()).toISOString()\n  })\n  errorLogger.log({ message:err.message });\n  if (err.stack) {\n    var stack = err.stack.split('\\n');\n    for (var line in stack) {\n      if (line >= this.maxErrorLines) break;\n      errorLogger.log({ line:line, trace:stack[line] });\n    }\n  }\n}\n","var commonFormatter = function(req, res){\n  if((typeof req.path) == 'function'){\n    //in restify path is a function\n    var path = req.path();\n  }\n  else{\n    //in express it is an attribute\n    var path = req.originalUrl || req.path || req.url;\n  }\n\n  var httpHeader = req.header && req.header('x-forwarded-for')\n  var requestID  = req.header && req.header('x-request-id')\n\n  var ip = req.ip || httpHeader\n                  || req.connection.remoteAddress;\n\n  var requestData =  {\n    ip: ip,\n    time: (new Date()).toISOString(),\n    method: req.method,\n    path: path,\n    \"status\": res.statusCode,\n  }\n\n  if (requestID) {\n    requestData.request_id = requestID;\n  }\n\n  if(res.get){\n    requestData.content_length = res.get('content-length');\n    requestData.content_type = res.get('content-type');\n  }\n  return requestData;\n}\n\nvar immediateLogger = function(logger, options, formatter){\n  return function(req, res, next){\n    var data = formatter(req, res);\n    logger.log(data);\n    next();\n  }\n}\n\nvar timingLogger = function(logger, options, formatter){\n  return function(req, res, next){\n    var elapsed = options.elapsed || 'elapsed';\n    var timer   = logger.time(elapsed);\n    var end = res.end;\n    res.end = function(chunk, encoding) {\n      var data = formatter(req, res);\n      res.end = end;\n      res.end(chunk, encoding);\n      timer.log(data);\n    };\n    next();\n  }\n}\n\nexports.init = function(logger, options, formatter) {\n  this.logger = logger;\n\n  if(!formatter && !options){\n    formatter = commonFormatter;\n    options = {};\n  }\n  else if(!formatter){\n    if(typeof options == 'function'){\n      formatter = options;\n      options = {};\n    }else{\n      formatter = commonFormatter;\n    }\n  }\n  options = options || {};\n\n  if(options.immediate){\n    return immediateLogger(logger, options, formatter);\n  }else{\n    return timingLogger(logger, options, formatter);\n  }\n}\n\nexports.commonFormatter = commonFormatter;\n","var split       = require('split')\nvar through     = require('through');\nvar PassThrough = require('stream').PassThrough;\n\n//returns a stream that splits and parses logfmt into objects\nexports.streamParser = function(options){\n  var options = options || {};\n\n  var streamParser = new PassThrough();\n  var self = this;\n\n  var logfmtStream = through(function(line){\n    if(line !== '') this.queue(self.parse(line))\n  })\n\n  // When a source stream is piped to us, undo that pipe, and save\n  // off the source stream piped into our internally managed streams.\n  streamParser.on('pipe', function(source) {\n    if(source.unpipe) source.unpipe(this);\n    this.transformStream = source.pipe(split()).pipe(logfmtStream);\n  });\n\n  // When we're piped to another stream, instead pipe our internal\n  // transform stream to that destination.\n  streamParser.pipe = function(destination, options) {\n    return this.transformStream.pipe(destination, options);\n  };\n\n  return streamParser;\n}\n\n// returns a stream that stringifies objects\nexports.streamStringify = function(options){\n  var self = this;\n  var options = options || {};\n  if(options.hasOwnProperty('delimiter')){\n    var delim = options.delimiter;\n  }else{\n    var delim = \"\\n\";\n  }\n\n  return through(function(data){\n    this.queue(self.stringify(data) + delim)\n  }, function(){\n    this.queue(null)\n  })\n}\n","exports.stringify = function(data){\n  var line = '';\n\n  for(var key in data) {\n    var value = data[key];\n    var is_null = false;\n    if(value == null) {\n      is_null = true;\n      value = '';\n    }\n    else value = value.toString();\n\n    var needs_quoting  = value.indexOf(' ') > -1 || value.indexOf('=') > -1;\n    var needs_escaping = value.indexOf('\"') > -1 || value.indexOf(\"\\\\\") > -1;\n\n    if(needs_escaping) value = value.replace(/[\"\\\\]/g, '\\\\$&');\n    if(needs_quoting) value = '\"' + value + '\"';\n    if(value === '' && !is_null) value = '\"\"';\n\n    line += key + '=' + value + ' ';\n  }\n\n  //trim traling space\n  return line.substring(0,line.length-1);\n}\n\n","//constructor\nfunction logfmt() {\n}\nmodule.exports = logfmt;\n\nvar streaming        = require('./lib/streaming');\nvar bodyParser       = require('./lib/body_parser');\nvar bodyParserStream = require('./lib/body_parser_stream');\nvar logfmtParser     = require('./lib/logfmt_parser');\nvar logger           = require('./lib/logger');\nvar requestLogger    = require('./lib/request_logger');\nvar serializer       = require('./lib/stringify');\n\n//Build up logfmt prototype\nObject.assign(logfmt.prototype, logger);\nObject.assign(logfmt.prototype, streaming);\n\nlogfmt.prototype.stringify = serializer.stringify;\nlogfmt.prototype.parse = logfmtParser.parse;\n\n// Synchronous body parser\nlogfmt.prototype.bodyParser = function(options) {\n  options || (options = {});\n  var mime = options.contentType || \"application/logplex-1\";\n  return bodyParser({ contentType: mime, parser: this.parse });\n};\n\n// Stream parser\nlogfmt.prototype.bodyParserStream = function(options) {\n  options || (options = {});\n  var mime = options.contentType || \"application/logplex-1\";\n  return bodyParserStream({ contentType: mime });\n};\n\nlogfmt.prototype.requestLogger = function(options, formatter) {\n  return requestLogger.init(this, options, formatter);\n};\n\nlogfmt.prototype.requestLogger.commonFormatter = requestLogger.commonFormatter;\n\nObject.assign(logfmt, logfmt.prototype);\n","//filter will reemit the data if cb(err,pass) pass is truthy\n\n// reduce is more tricky\n// maybe we want to group the reductions or emit progress updates occasionally\n// the most basic reduce just emits one 'data' event after it has recieved 'end'\n\n\nvar through = require('through')\nvar Decoder = require('string_decoder').StringDecoder\n\nmodule.exports = split\n\n//TODO pass in a function to map across the lines.\n\nfunction split (matcher, mapper) {\n  var decoder = new Decoder()\n  var soFar = ''\n  if('function' === typeof matcher)\n    mapper = matcher, matcher = null\n  if (!matcher)\n    matcher = /\\r?\\n/\n\n  function emit(stream, piece) {\n    if(mapper) {\n      try {\n        piece = mapper(piece)\n      }\n      catch (err) {\n        return stream.emit('error', err)\n      }\n      if('undefined' !== typeof piece)\n        stream.queue(piece)\n    }\n    else\n      stream.queue(piece)\n  }\n\n  function next (stream, buffer) { \n    var pieces = (soFar + buffer).split(matcher)\n    soFar = pieces.pop()\n\n    for (var i = 0; i < pieces.length; i++) {\n      var piece = pieces[i]\n      emit(stream, piece)\n    }\n  }\n\n  return through(function (b) {\n    next(this, decoder.write(b))\n  },\n  function () {\n    if(decoder.end) \n      next(this, decoder.end())\n    if(soFar != null)\n      emit(this, soFar)\n    this.queue(null)\n  })\n}\n\n","var Stream = require('stream')\n\n// through\n//\n// a stream that does nothing but re-emit the input.\n// useful for aggregating a series of changing but not ending streams into one stream)\n\nexports = module.exports = through\nthrough.through = through\n\n//create a readable writable stream.\n\nfunction through (write, end, opts) {\n  write = write || function (data) { this.queue(data) }\n  end = end || function () { this.queue(null) }\n\n  var ended = false, destroyed = false, buffer = [], _ended = false\n  var stream = new Stream()\n  stream.readable = stream.writable = true\n  stream.paused = false\n\n//  stream.autoPause   = !(opts && opts.autoPause   === false)\n  stream.autoDestroy = !(opts && opts.autoDestroy === false)\n\n  stream.write = function (data) {\n    write.call(this, data)\n    return !stream.paused\n  }\n\n  function drain() {\n    while(buffer.length && !stream.paused) {\n      var data = buffer.shift()\n      if(null === data)\n        return stream.emit('end')\n      else\n        stream.emit('data', data)\n    }\n  }\n\n  stream.queue = stream.push = function (data) {\n//    console.error(ended)\n    if(_ended) return stream\n    if(data === null) _ended = true\n    buffer.push(data)\n    drain()\n    return stream\n  }\n\n  //this will be registered as the first 'end' listener\n  //must call destroy next tick, to make sure we're after any\n  //stream piped from here.\n  //this is only a problem if end is not emitted synchronously.\n  //a nicer way to do this is to make sure this is the last listener for 'end'\n\n  stream.on('end', function () {\n    stream.readable = false\n    if(!stream.writable && stream.autoDestroy)\n      process.nextTick(function () {\n        stream.destroy()\n      })\n  })\n\n  function _end () {\n    stream.writable = false\n    end.call(stream)\n    if(!stream.readable && stream.autoDestroy)\n      stream.destroy()\n  }\n\n  stream.end = function (data) {\n    if(ended) return\n    ended = true\n    if(arguments.length) stream.write(data)\n    _end() // will emit or queue\n    return stream\n  }\n\n  stream.destroy = function () {\n    if(destroyed) return\n    destroyed = true\n    ended = true\n    buffer.length = 0\n    stream.writable = stream.readable = false\n    stream.emit('close')\n    return stream\n  }\n\n  stream.pause = function () {\n    if(stream.paused) return\n    stream.paused = true\n    return stream\n  }\n\n  stream.resume = function () {\n    if(stream.paused) {\n      stream.paused = false\n      stream.emit('resume')\n    }\n    drain()\n    //may have become paused again,\n    //as drain emits 'data'.\n    if(!stream.paused)\n      stream.emit('drain')\n    return stream\n  }\n  return stream\n}\n\n"],"names":["getNonOverlappingDuration","ranges","sort","a","b","reduce","acc","range","length","tail","slice","prevStart","prevEnd","start","end","makeSpanMap","getSpan","spanMap","span","index","id","children","parentId","parentIds","push","undefined","getStats","duration","traceDuration","selfDuration","main","toFixedNoTrailingZeros","secondary","n","parseFloat","toFixed","makeFrames","MutableDataFrame","fields","name","Fields","type","FieldType","config","displayName","color","mode","meta","preferredVisualisationType","convertTagsLogfmt","tags","data","logfmt","Object","keys","forEach","key","value","String","JSON","stringify","transformToLogfmt","parse","durationPlaceholder","AdvancedOptions","query","onChange","showAdvancedOptions","setShowAdvancedOptions","useState","styles","useStyles","getStyles","InlineFieldRow","className","advancedOptionsContainer","onClick","InlineLabel","as","Icon","angleUp","angleDown","CSSTransition","in","mountOnEnter","unmountOnExit","timeout","classNames","InlineField","label","labelWidth","grow","Input","minDuration","placeholder","v","currentTarget","maxDuration","tooltip","limit","parseInt","theme","css","spacing","xs","enter","enterActive","exit","exitActive","allOperationsOption","SearchForm","datasource","serviceOptions","setServiceOptions","operationOptions","setOperationOptions","isLoading","setIsLoading","services","operations","loadOptions","useCallback","async","url","loaderOfType","prevValue","values","metadataRequest","options","map","option","filter","item","fuzzyMatch","found","error","Error","dispatch","notifyApp","createErrorNotification","useEffect","service","getTemplateSrv","containsTemplate","toOption","getServices","encodeURIComponent","replace","operation","getOperations","maxWidth","Select","inputId","onOpenMenu","find","menuPlacement","isClearable","allowCustomValue","disabled","createGraphFrames","nodes","edges","spans","traceEndTime","traceStartTime","Infinity","startTime","findTraceDuration","spanID","references","r","refType","process","processes","processID","c","childrenDuration","stats","serviceName","operationName","parentSpanID","convertTraceToGraph","nodesFrame","edgesFrame","node","add","edge","JaegerDatasource","DataSourceApi","constructor","instanceSettings","timeSrv","getTimeSrv","templateSrv","super","this","nodeGraph","jsonData","params","lastValueFrom","_request","hideFromInspector","target","targets","of","emptyTraceDataFrame","queryType","scopedVars","pipe","response","traceData","createTraceFrame","enabled","uploadedJson","message","jaegerInterpolated","pick","applyVariables","jaegerQuery","pickBy","identity","omit","toString","getTimeRange","lookback","createTableFrame","interpolateVariablesInQueries","queries","getRef","expandedQuery","res","status","catchError","err","statusText","timeRange","getTime","from","to","getQueryDisplayText","apiUrl","serializeParams","req","getBackendSrv","fetch","date","roundUp","dateMath","valueOf","custom","traceFormat","plugin","DataSourcePlugin","setConfigEditor","onOptionsChange","DataSourceHttpSettings","defaultUrl","dataSourceConfig","showAccessOptions","TraceToLogsSettings","TraceToMetricsSettings","NodeGraphSettings","setQueryEditor","onRunQuery","useTheme2","onChangeQuery","nextQuery","width","RadioButtonGroup","size","padding","FileDropzone","multiple","onLoad","result","QueryField","onBlur","portalOrigin","renderEditorBody","s","toSpanRow","traceID","logs","l","timestamp","warnings","stackTraces","serviceTags","frame","unit","displayNameFromDS","links","title","internal","datasourceUid","uid","datasourceName","transformToTraceData","trace","transformTraceData","traceName","transformToJaeger","traceResponse","i","get","p","flags","total","offset","errors","module","exports","next","_body","header","contentType","body","buf","setEncoding","on","chunk","lines","trim","split","line","parser","PassThrough","mime","objectMode","streamParser","debug","in_key","in_value","in_quote","had_quote","object","console","log","stream","stdout","logData","assign","defaultData","timers","now","Date","write","time","timer","namespace","namespaced","maxErrorLines","Math","random","errorLogger","toISOString","stack","commonFormatter","path","originalUrl","httpHeader","requestID","requestData","ip","connection","remoteAddress","method","statusCode","request_id","content_length","content_type","init","logger","formatter","immediate","immediateLogger","elapsed","encoding","timingLogger","through","self","logfmtStream","queue","source","unpipe","transformStream","destination","streamStringify","hasOwnProperty","delim","delimiter","is_null","needs_quoting","indexOf","substring","streaming","bodyParser","bodyParserStream","logfmtParser","requestLogger","serializer","prototype","Decoder","matcher","mapper","decoder","soFar","emit","piece","buffer","pieces","pop","Stream","opts","ended","destroyed","_ended","drain","paused","shift","_end","writable","call","readable","autoDestroy","destroy","nextTick","arguments","pause","resume"],"sourceRoot":""}