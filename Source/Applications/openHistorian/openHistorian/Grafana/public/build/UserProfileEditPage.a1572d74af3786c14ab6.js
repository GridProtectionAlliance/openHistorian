"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2472],{72235:(X,U,s)=>{s.d(U,{l:()=>I});var e=s(74848),i=s(32196),b=s(96540),S=s(49785);function I({defaultValues:p,onSubmit:M,validateOnMount:T=!1,validateFieldsOnMount:C,children:j,validateOn:h="onSubmit",maxWidth:o=600,...L}){const{handleSubmit:K,trigger:a,formState:D,...v}=(0,S.mN)({mode:h,defaultValues:p});return(0,b.useEffect)(()=>{T&&a(C)},[a,C,T]),(0,e.jsx)("form",{className:(0,i.css)({maxWidth:o!=="none"?o+"px":o,width:"100%"}),onSubmit:K(M),...L,children:j({errors:D.errors,formState:D,trigger:a,...v})})}},39745:(X,U,s)=>{s.d(U,{A:()=>q,u:()=>Y});var e=s(74848),i=s(32196),b=s(96540),S=s(97594),I=s(41987),p=s(13544),M=s(14110),T=s(32264),C=s(84167),j=s(88575),h=s(60029),o=s(20333),L=s(15648),K=s(29678),a=s(55852),D=s(3911),v=s(55014),V=s(59429),l=s(8484),B=s(74513),R=s(65615),n=s(2769);function r(){const $=B.Yj.map(t=>({value:t.code,label:t.name})).sort((t,W)=>t.value===B.wi?1:W.value===B.wi?-1:t.label.localeCompare(W.label));return[{value:"",label:(0,l.t)("common.locale.default","Default")},...$]}class Y extends b.PureComponent{constructor(u){super(u),this.onSubmitForm=async t=>{if(t.preventDefault(),this.props.onConfirm?await this.props.onConfirm():!0){const{homeDashboardUID:H,theme:G,timezone:J,weekStart:N,language:_,queryHistory:Z,navbar:O}=this.state;await this.service.update({homeDashboardUID:H,theme:G,timezone:J,weekStart:N,language:_,queryHistory:Z,navbar:O}),window.location.reload()}},this.onThemeChanged=t=>{t&&(this.setState({theme:t.value}),t.value&&(0,n.K)(t.value,!0))},this.onTimeZoneChanged=t=>{typeof t=="string"&&this.setState({timezone:t})},this.onWeekStartChanged=t=>{this.setState({weekStart:t})},this.onHomeDashboardChanged=t=>{this.setState({homeDashboardUID:t})},this.onLanguageChanged=t=>{this.setState({language:t}),(0,M.rR)("grafana_preferences_language_changed",{toLanguage:t,preferenceType:this.props.preferenceType})},this.service=new R.W(u.resourceUri),this.state={theme:"",timezone:"",weekStart:"",language:"",queryHistory:{homeTab:""},navbar:{bookmarkUrls:[]}},this.themeOptions=(0,S.k)(T.$.featureToggles.extraThemes).map(t=>({value:t.id,label:w(t)})),this.themeOptions.unshift({value:"",label:(0,l.t)("shared-preferences.theme.default-label","Default")})}async componentDidMount(){const u=await this.service.load();this.setState({homeDashboardUID:u.homeDashboardUID,theme:u.theme,timezone:u.timezone,weekStart:u.weekStart,language:u.language,queryHistory:u.queryHistory,navbar:u.navbar})}render(){const{theme:u,timezone:t,weekStart:W,homeDashboardUID:H,language:G}=this.state,{disabled:J}=this.props,N=ee(),_=r(),Z=this.themeOptions.find(O=>O.value===u)??this.themeOptions[0];return(0,e.jsxs)("form",{onSubmit:this.onSubmitForm,className:N.form,children:[(0,e.jsxs)(C.n,{label:(0,e.jsx)(l.x6,{i18nKey:"shared-preferences.title",children:"Preferences"}),disabled:J,children:[(0,e.jsx)(j.D,{label:(0,l.t)("shared-preferences.fields.theme-label","Interface theme"),children:(0,e.jsx)(v.G,{options:this.themeOptions,value:Z.value,onChange:this.onThemeChanged,id:"shared-preferences-theme-select"})}),(0,e.jsx)(j.D,{label:(0,e.jsx)(h.J,{htmlFor:"home-dashboard-select",children:(0,e.jsx)("span",{className:N.labelText,children:(0,e.jsx)(l.x6,{i18nKey:"shared-preferences.fields.home-dashboard-label",children:"Home Dashboard"})})}),"data-testid":"User preferences home dashboard drop down",children:(0,e.jsx)(V.b,{value:H,onChange:O=>this.onHomeDashboardChanged(O?.uid??""),defaultOptions:!0,isClearable:!0,placeholder:(0,l.t)("shared-preferences.fields.home-dashboard-placeholder","Default dashboard"),inputId:"home-dashboard-select"})}),(0,e.jsx)(j.D,{label:(0,l.t)("shared-dashboard.fields.timezone-label","Timezone"),"data-testid":p.Tp.components.TimeZonePicker.containerV2,children:(0,e.jsx)(o.U,{includeInternal:!0,value:t,onChange:this.onTimeZoneChanged,inputId:"shared-preferences-timezone-picker"})}),(0,e.jsx)(j.D,{label:(0,l.t)("shared-preferences.fields.week-start-label","Week start"),"data-testid":p.Tp.components.WeekStartPicker.containerV2,children:(0,e.jsx)(L.l,{value:W||"",onChange:this.onWeekStartChanged,inputId:"shared-preferences-week-start-picker"})}),(0,e.jsx)(j.D,{label:(0,e.jsxs)(h.J,{htmlFor:"locale-select",children:[(0,e.jsx)("span",{className:N.labelText,children:(0,e.jsx)(l.x6,{i18nKey:"shared-preferences.fields.locale-label",children:"Language"})}),(0,e.jsx)(K.y,{featureState:I.Ay.beta})]}),"data-testid":"User preferences language drop down",children:(0,e.jsx)(v.G,{value:_.find(O=>O.value===G)?.value||"",onChange:O=>this.onLanguageChanged(O?.value??""),options:_,placeholder:(0,l.t)("shared-preferences.fields.locale-placeholder","Choose language"),id:"locale-select"})})]}),(0,e.jsx)(a.$n,{type:"submit",variant:"primary","data-testid":p.Tp.components.UserProfile.preferencesSaveButton,children:(0,e.jsx)(l.x6,{i18nKey:"common.save",children:"Save"})})]})}}const q=Y,ee=(0,D.N)(()=>({labelText:(0,i.css)({marginRight:"6px"}),form:(0,i.css)({width:"100%",maxWidth:"600px"})}));function w($){switch($.id){case"dark":return(0,l.t)("shared.preferences.theme.dark-label","Dark");case"light":return(0,l.t)("shared.preferences.theme.light-label","Light");case"system":return(0,l.t)("shared.preferences.theme.system-label","System preference");default:return $.name}}},48357:(X,U,s)=>{s.r(U),s.d(U,{UserProfileEditPage:()=>ae,default:()=>me});var e=s(74848),i=s(96540),b=s(71468),S=s(4392),I=s(74135),p=s(13544),M=s(3197),T=s(67061),C=s(63021),j=s(40675),h=s(40980),o=s(21780),L=s(39745),K=s(83277),a=s(8484),D=s(39558),v=s(55852);class V extends i.PureComponent{render(){const{isLoading:P,orgs:g,user:x}=this.props;return P?(0,e.jsx)(D._,{text:"Loading organizations..."}):g.length===0?null:(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"page-sub-heading",children:(0,e.jsx)(a.x6,{i18nKey:"user-orgs.title",children:"Organizations"})}),(0,e.jsxs)("table",{className:"filter-table form-inline","data-testid":p.Tp.components.UserProfile.orgsTable,children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(a.x6,{i18nKey:"user-orgs.name-column",children:"Name"})}),(0,e.jsx)("th",{children:(0,e.jsx)(a.x6,{i18nKey:"user-orgs.role-column",children:"Role"})}),(0,e.jsx)("th",{})]})}),(0,e.jsx)("tbody",{children:g.map((f,d)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:f.name}),(0,e.jsx)("td",{children:f.role}),(0,e.jsx)("td",{className:"text-right",children:f.orgId===x?.orgId?(0,e.jsx)(v.$n,{variant:"secondary",size:"sm",disabled:!0,children:(0,e.jsx)(a.x6,{i18nKey:"user-orgs.current-org-button",children:"Current"})}):(0,e.jsx)(v.$n,{variant:"secondary",size:"sm",onClick:()=>{this.props.setUserOrg(f)},children:(0,e.jsx)(a.x6,{i18nKey:"user-orgs.select-org-button",children:"Select organisation"})})})]},d))})]})]})}}const l=V;var B=s(84167),R=s(88575),n=s(10354),r=s(56034),Y=s(14578),q=s(72235),ee=s(2913);const{disableLoginForm:w}=ee.Ay,u=({user:m,isSavingUser:P,updateProfile:g})=>{const x=E=>{g(E)},f=(m&&m.isExternal)??!1,d=f&&m&&m.authLabels?m.authLabels[0]:"",y=d?` (Synced via ${d})`:"",A=w||f;return(0,e.jsx)(q.l,{onSubmit:x,validateOn:"onBlur",children:({register:E,errors:Q})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(B.n,{children:[(0,e.jsx)(R.D,{label:(0,a.t)("user-profile.fields.name-label","Name")+y,invalid:!!Q.name,error:(0,e.jsx)(a.x6,{i18nKey:"user-profile.fields.name-error",children:"Name is required"}),disabled:A,children:(0,e.jsx)(n.p,{...E("name",{required:!0}),id:"edit-user-profile-name",placeholder:(0,a.t)("user-profile.fields.name-label","Name"),defaultValue:m?.name??"",suffix:(0,e.jsx)(t,{})})}),(0,e.jsx)(R.D,{label:(0,a.t)("user-profile.fields.email-label","Email")+y,invalid:!!Q.email,error:(0,e.jsx)(a.x6,{i18nKey:"user-profile.fields.email-error",children:"Email is required"}),disabled:A,children:(0,e.jsx)(n.p,{...E("email",{required:!0}),id:"edit-user-profile-email",placeholder:(0,a.t)("user-profile.fields.email-label","Email"),defaultValue:m?.email??"",suffix:(0,e.jsx)(t,{})})}),(0,e.jsx)(R.D,{label:(0,a.t)("user-profile.fields.username-label","Username")+y,disabled:A,children:(0,e.jsx)(n.p,{...E("login"),id:"edit-user-profile-username",defaultValue:m?.login??"",placeholder:(0,a.t)("user-profile.fields.username-label","Username")+y,suffix:(0,e.jsx)(t,{})})})]}),(0,e.jsx)(v.$n,{variant:"primary",disabled:P||A,"data-testid":p.Tp.components.UserProfile.profileSaveButton,type:"submit",children:(0,e.jsx)(a.x6,{i18nKey:"common.save",children:"Save"})})]})})},t=()=>w?(0,e.jsx)(r.m,{content:"Login details locked because they are managed in another system.",children:(0,e.jsx)(Y.I,{name:"lock"})}):null;var W=s(32196),H=s(72635),G=s(84753);class J extends i.PureComponent{render(){const{isLoading:P,sessions:g,revokeUserSession:x}=this.props,f=N();return P?(0,e.jsx)(D._,{text:(0,e.jsx)(a.x6,{i18nKey:"user-sessions.loading",children:"Loading sessions..."})}):(0,e.jsx)("div",{className:f.wrapper,children:g.length>0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("h3",{className:"page-sub-heading",children:"Sessions"}),(0,e.jsxs)("table",{className:"filter-table form-inline","data-testid":p.Tp.components.UserProfile.sessionsTable,children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(a.x6,{i18nKey:"user-session.seen-at-column",children:"Last seen"})}),(0,e.jsx)("th",{children:(0,e.jsx)(a.x6,{i18nKey:"user-session.created-at-column",children:"Logged on"})}),(0,e.jsx)("th",{children:(0,e.jsx)(a.x6,{i18nKey:"user-session.ip-column",children:"IP address"})}),(0,e.jsx)("th",{children:(0,e.jsx)(a.x6,{i18nKey:"user-session.browser-column",children:"Browser & OS"})}),(0,e.jsx)("th",{})]})}),(0,e.jsx)("tbody",{children:g.map((d,y)=>(0,e.jsxs)("tr",{children:[d.isActive?(0,e.jsx)("td",{children:"Now"}):(0,e.jsx)("td",{children:d.seenAt}),(0,e.jsx)("td",{children:(0,G.Y)(d.createdAt,{dateStyle:"long"})}),(0,e.jsx)("td",{children:d.clientIp}),(0,e.jsxs)("td",{children:[d.browser," on ",d.os," ",d.osVersion]}),(0,e.jsx)("td",{children:(0,e.jsx)(v.$n,{size:"sm",variant:"destructive",tooltip:(0,H.t)("user-session.revoke","Revoke user session"),onClick:()=>x(d.id),"aria-label":(0,H.t)("user-session.revoke","Revoke user session"),children:(0,e.jsx)(Y.I,{name:"power"})})})]},y))})]})]})})}}const N=()=>({wrapper:(0,W.css)({maxWidth:"100%"})}),_=J;class Z extends i.PureComponent{render(){const{isLoading:P,teams:g}=this.props;return P?(0,e.jsx)(D._,{text:"Loading teams..."}):g.length===0?null:(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"page-sub-heading",children:"Teams"}),(0,e.jsxs)("table",{className:"filter-table form-inline","aria-label":"User teams table",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{}),(0,e.jsx)("th",{children:"Name"}),(0,e.jsx)("th",{children:"Email"}),(0,e.jsx)("th",{children:"Members"})]})}),(0,e.jsx)("tbody",{children:g.map((x,f)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"width-4 text-center",children:(0,e.jsx)("img",{className:"filter-table__avatar",src:x.avatarUrl,alt:""})}),(0,e.jsx)("td",{children:x.name}),(0,e.jsx)("td",{children:x.email}),(0,e.jsx)("td",{children:x.memberCount})]},f))})]})]})}}const O=null;var k=s(84969);const te="tab",se="general";function ce(m){const P=m.user,{user:g,teams:x,orgs:f,sessions:d,teamsAreLoading:y,orgsAreLoading:A,sessionsAreLoading:E,isUpdating:Q}=P;return{orgsAreLoading:A,sessionsAreLoading:E,teamsAreLoading:y,orgs:f,sessions:d,teams:x,isUpdating:Q,user:g}}const he={initUserProfilePage:k.Qe,revokeUserSession:k._O,changeUserOrg:k.Aj,updateUserProfile:k.eg},ue=(0,b.connect)(ce,he);function ae({orgsAreLoading:m,sessionsAreLoading:P,teamsAreLoading:g,initUserProfilePage:x,orgs:f,sessions:d,teams:y,isUpdating:A,user:E,revokeUserSession:Q,changeUserOrg:fe,updateUserProfile:ge}){const[xe,pe]=(0,K.s)(),re=xe[te],[ne,je]=(0,i.useState)(typeof re=="string"?re:se);(0,S.A)(()=>x());const{extensions:oe}=(0,M.kr)({extensionPointId:I.S.UserProfileTab}),ie=oe.reduce((c,z)=>{const{title:F}=z;return c[F]?c[F].push(z):c[F]=[z],c},{}),le=c=>c.toLowerCase(),ve=oe.length>0,Pe=[{id:se,title:(0,a.t)("user-profile.tabs.general","General")},...Object.keys(ie).map(c=>({id:le(c),title:c}))],de=()=>(0,e.jsxs)(T.B,{direction:"column",gap:2,children:[(0,e.jsx)(u,{updateProfile:ge,isSavingUser:A,user:E}),(0,e.jsx)(L.A,{resourceUri:"user",preferenceType:"user"}),(0,e.jsxs)(T.B,{direction:"column",gap:6,children:[(0,e.jsx)(Z,{isLoading:g,teams:y}),(0,e.jsx)(l,{isLoading:m,setUserOrg:fe,orgs:f,user:E}),(0,e.jsx)(_,{isLoading:P,revokeUserSession:Q,sessions:d})]})]}),Ee=()=>(0,e.jsx)("div",{"data-testid":p.Tp.components.UserProfile.extensionPointTabs,children:(0,e.jsxs)(T.B,{direction:"column",gap:2,children:[(0,e.jsx)(C.U,{children:Pe.map(({id:c,title:z})=>(0,e.jsx)(j.o,{label:z,active:ne===c,onChangeTab:()=>{je(c),pe({[te]:c})},"data-testid":p.Tp.components.UserProfile.extensionPointTab(c)},c))}),(0,e.jsxs)(h.J,{children:[ne===se&&(0,e.jsx)(de,{}),Object.entries(ie).map(([c,z])=>{const F=le(c);return ne===F?(0,e.jsx)(i.Fragment,{children:z.map(({component:Ue},Te)=>(0,e.jsx)(Ue,{},`${F}-${Te}`))},F):null})]})]})});return(0,e.jsx)(o.YW,{navId:"profile/settings",children:(0,e.jsx)(o.YW.Contents,{isLoading:!E,children:ve?(0,e.jsx)(Ee,{}):(0,e.jsx)(de,{})})})}const me=ue(ae)},84969:(X,U,s)=>{s.d(U,{ec:()=>L,Aj:()=>B,Qe:()=>K,YW:()=>a,_O:()=>l,eg:()=>R});var e=s(32264),i=s(17172);async function b(n){try{await(0,i.AI)().put("/api/user/password",n)}catch(r){console.error(r)}}function S(){return(0,i.AI)().get("/api/user")}function I(){return(0,i.AI)().get("/api/user/teams")}function p(){return(0,i.AI)().get("/api/user/orgs")}function M(){return(0,i.AI)().get("/api/user/auth-tokens")}async function T(n){await(0,i.AI)().post("/api/user/revoke-auth-token",{authTokenId:n})}async function C(n){await(0,i.AI)().post("/api/user/using/"+n.orgId,{})}async function j(n){try{await(0,i.AI)().put("/api/user",n)}catch(r){console.error(r)}}const h={changePassword:b,revokeUserSession:T,loadUser:S,loadSessions:M,loadOrgs:p,loadTeams:I,setUserOrg:C,updateUserProfile:j};var o=s(81862);function L(n){return async function(r){r((0,o.Nm)({updating:!0})),await h.changePassword(n),r((0,o.Nm)({updating:!1}))}}function K(){return async function(n){await n(a()),n(D()),n(v()),n(V())}}function a(){return async function(n){const r=await h.loadUser();n((0,o.HO)({user:r}))}}function D(){return async function(n){n((0,o.ri)());const r=await h.loadTeams();n((0,o.Q9)({teams:r}))}}function v(){return async function(n){n((0,o.Mj)());const r=await h.loadOrgs();n((0,o.ny)({orgs:r}))}}function V(){return async function(n){n((0,o.uh)());const r=await h.loadSessions();n((0,o.RS)({sessions:r}))}}function l(n){return async function(r){r((0,o.Nm)({updating:!0})),await h.revokeUserSession(n),r((0,o.g$)({tokenId:n}))}}function B(n){return async function(r){r((0,o.Nm)({updating:!0})),await h.setUserOrg(n),window.location.href=e.$.appSubUrl+"/profile"}}function R(n){return async function(r){r((0,o.Nm)({updating:!0})),await h.updateUserProfile(n),await r(a()),r((0,o.Nm)({updating:!1}))}}},4392:(X,U,s)=>{s.d(U,{A:()=>b});var e=s(94701),i=function(S){(0,e.A)(function(){S()})};const b=i}}]);

//# sourceMappingURL=UserProfileEditPage.a1572d74af3786c14ab6.js.map