"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[641],{53153:(C,m,s)=>{s.d(m,{S:()=>g});var o=s(74848),a=s(96540),d=s(49785),e=s(13544),i=s(32264),P=s(40845),u=s(42418),f=s(88575),E=s(67061),l=s(55852),n=s(56034),c=s(4691),r=s(78361),t=s(35043);const g=({onSubmit:h,onSkip:_,showDefaultPasswordWarning:O})=>{const p=(0,P.of)(c.$),[x,D]=(0,a.useState)(!1),[w,L]=(0,a.useState)(!0),{handleSubmit:M,register:y,getValues:B,formState:{errors:A},watch:I}=(0,d.mN)({defaultValues:{newPassword:"",confirmNew:""}}),T=I("newPassword"),U=v=>{h(v.newPassword)};return(0,o.jsxs)("form",{onSubmit:M(U),children:[O&&(0,o.jsx)(u.F,{severity:"info",title:"Continuing to use the default password exposes you to security risks."}),(0,o.jsx)(f.D,{label:"New password",invalid:!!A.newPassword,error:A?.newPassword?.message,children:(0,o.jsx)(r.s,{onFocus:()=>D(!0),...y("newPassword",{required:"New Password is required",onBlur:()=>L(!1),validate:{strongPasswordValidationRegister:t.DP}}),id:"new-password",autoFocus:!0,autoComplete:"new-password"})}),x&&(0,o.jsx)(t.zJ,{pristine:w,password:T,strongPasswordValidations:t.NQ}),(0,o.jsx)(f.D,{label:"Confirm new password",invalid:!!A.confirmNew,error:A?.confirmNew?.message,children:(0,o.jsx)(r.s,{...y("confirmNew",{required:"Confirmed Password is required",validate:v=>v===B().newPassword||"Passwords must match!"}),id:"confirm-new-password",autoComplete:"new-password"})}),(0,o.jsxs)(E.B,{direction:"column",children:[(0,o.jsx)(l.$n,{type:"submit",className:p.submitButton,children:"Submit"}),!i.$.auth.basicAuthStrongPasswordPolicy&&_&&(0,o.jsx)(n.m,{content:"If you skip you will be prompted to change password next time you log in.",placement:"bottom",children:(0,o.jsx)(l.$n,{className:p.skipButton,fill:"text",onClick:_,type:"button","data-testid":e.Tp.pages.Login.skip,children:"Skip"})})]})]})}},37344:(C,m,s)=>{s.r(m),s.d(m,{ChangePasswordPage:()=>i,default:()=>P});var o=s(74848),a=s(87570),d=s(20851),e=s(53153);const i=u=>(0,o.jsx)(d.GU,{isChangingPassword:!0,children:(0,o.jsx)(d.qm,{children:(0,o.jsx)(a.A,{resetCode:u.queryParams.code,children:({changePassword:f})=>(0,o.jsx)(e.S,{onSubmit:f})})})}),P=i},87570:(C,m,s)=>{s.d(m,{A:()=>f});var o=s(74848),a=s(96540),d=s(17172),e=s(2913),i=s(8484);const P=()=>!!e.Ay.oauth&&Object.keys(e.Ay.oauth).length>0;class u extends a.PureComponent{constructor(c){super(c),this.changePassword=r=>{const t={newPassword:r,confirmNew:r,oldPassword:"admin"};if(this.props.resetCode){const g={code:this.props.resetCode,newPassword:r,confirmPassword:r};(0,d.AI)().post("/api/user/password/reset",g).then(()=>{this.toGrafana()})}else(0,d.AI)().put("/api/user/password",t).then(()=>{this.toGrafana()}).catch(g=>console.error(g))},this.login=r=>{this.setState({loginErrorMessage:void 0,isLoggingIn:!0}),(0,d.AI)().post("/login",r,{showErrorAlert:!1}).then(t=>{if(this.result=t,r.password!=="admin"||e.Ay.ldapEnabled||e.Ay.authProxyEnabled){this.toGrafana();return}else this.changeView(r.password==="admin")}).catch(t=>{const g=(0,d.NF)(t)?E(t):void 0;this.setState({isLoggingIn:!1,loginErrorMessage:g||(0,i.t)("login.error.unknown","Unknown error occurred")})})},this.changeView=r=>{this.setState({isChangingPassword:!0,showDefaultPasswordWarning:r})},this.toGrafana=()=>{if(e.Ay.featureToggles.useSessionStorageForRedirection){window.location.assign(e.Ay.appSubUrl+"/");return}this.result?.redirectUrl?e.Ay.appSubUrl!==""&&!this.result.redirectUrl.startsWith(e.Ay.appSubUrl)?window.location.assign(e.Ay.appSubUrl+this.result.redirectUrl):window.location.assign(this.result.redirectUrl):window.location.assign(e.Ay.appSubUrl+"/")},this.state={isLoggingIn:!1,isChangingPassword:!1,showDefaultPasswordWarning:!1,loginErrorMessage:l(e.Ay.loginError)}}render(){const{children:c}=this.props,{isLoggingIn:r,isChangingPassword:t,showDefaultPasswordWarning:g,loginErrorMessage:h}=this.state,{login:_,toGrafana:O,changePassword:p}=this,{loginHint:x,passwordHint:D,disableLoginForm:w,disableUserSignUp:L}=e.Ay;return(0,o.jsx)(o.Fragment,{children:c({isOauthEnabled:P(),loginHint:x,passwordHint:D,disableLoginForm:w,disableUserSignUp:L,login:_,isLoggingIn:r,changePassword:p,skipPasswordChange:O,isChangingPassword:t,showDefaultPasswordWarning:g,loginErrorMessage:h})})}}const f=u;function E(n){switch(n.data?.messageId){case"password-auth.empty":case"password-auth.failed":case"password-auth.invalid":return(0,i.t)("login.error.invalid-user-or-password","Invalid username or password");case"login-attempt.blocked":return(0,i.t)("login.error.blocked","You have exceeded the number of login attempts for this user. Please try again later.");default:return n.data?.message}}function l(n){switch(n){case"oauth.login.error":return(0,i.t)("oauth.login.error","Login provider denied login request");default:return n}}},4691:(C,m,s)=>{s.d(m,{$:()=>r,Q:()=>c});var o=s(74848),a=s(32196),d=s(96540),e=s(49785),i=s(13544),P=s(40845),u=s(88575),f=s(10354),E=s(55852),l=s(8484),n=s(78361);const c=({children:t,onSubmit:g,isLoggingIn:h,passwordHint:_,loginHint:O})=>{const p=(0,P.of)(r),x=(0,d.useId)(),D=(0,d.useId)(),{handleSubmit:w,register:L,formState:{errors:M}}=(0,e.mN)({mode:"onChange"});return(0,o.jsx)("div",{className:p.wrapper,children:(0,o.jsxs)("form",{onSubmit:w(g),children:[(0,o.jsx)(u.D,{label:(0,l.t)("login.form.username-label","Email or username"),invalid:!!M.user,error:M.user?.message,children:(0,o.jsx)(f.p,{...L("user",{required:(0,l.t)("login.form.username-required","Email or username is required")}),id:x,autoFocus:!0,autoCapitalize:"none",placeholder:O||(0,l.t)("login.form.username-placeholder","email or username"),"data-testid":i.Tp.pages.Login.username})}),(0,o.jsx)(u.D,{label:(0,l.t)("login.form.password-label","Password"),invalid:!!M.password,error:M.password?.message,children:(0,o.jsx)(n.s,{...L("password",{required:(0,l.t)("login.form.password-required","Password is required")}),id:D,autoComplete:"current-password",placeholder:_||(0,l.t)("login.form.password-placeholder","password")})}),(0,o.jsx)(E.$n,{type:"submit","data-testid":i.Tp.pages.Login.submit,className:p.submitButton,disabled:h,children:h?(0,l.t)("login.form.submit-loading-label","Logging in..."):(0,l.t)("login.form.submit-label","Log in")}),t]})})},r=t=>({wrapper:(0,a.css)({width:"100%",paddingBottom:t.spacing(2)}),submitButton:(0,a.css)({justifyContent:"center",width:"100%"}),skipButton:(0,a.css)({alignSelf:"flex-start"})})},20851:(C,m,s)=>{s.d(m,{GU:()=>f,YO:()=>l,qm:()=>u});var o=s(74848),a=s(32196),d=s(96540),e=s(40845),i=s(19361),P=s(38645);const u=({children:n,enterAnimation:c=!0})=>{const r=(0,e.of)(l);return(0,o.jsx)("div",{className:(0,a.cx)(r.loginInnerBox,c&&r.enterAnimation),children:n})},f=({children:n,branding:c,isChangingPassword:r})=>{const t=(0,e.of)(l),[g,h]=(0,d.useState)(!1),_=c?.loginSubtitle??i.M.GetLoginSubTitle(),O=c?.loginTitle??i.M.LoginTitle,p=c?.loginBoxBackground||i.M.LoginBoxBackground(),x=c?.loginLogo,D=c?.hideEdition??i.M.HideEdition;return(0,d.useEffect)(()=>h(!0),[]),(0,o.jsxs)(i.M.LoginBackground,{className:(0,a.cx)(t.container,g&&t.loginAnim,c?.loginBackground),children:[(0,o.jsx)("div",{className:t.loginMain,children:(0,o.jsxs)("div",{className:(0,a.cx)(t.loginContent,p,"login-content-box"),children:[(0,o.jsxs)("div",{className:t.loginLogoWrapper,children:[(0,o.jsx)(i.M.LoginLogo,{className:t.loginLogo,logo:x}),(0,o.jsx)("div",{className:t.titleWrapper,children:r?(0,o.jsx)("h1",{className:t.mainTitle,children:"Update your password"}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h1",{className:t.mainTitle,children:O}),_&&(0,o.jsx)("h3",{className:t.subTitle,children:_})]})})]}),(0,o.jsx)("div",{className:t.loginOuterBox,children:n})]})}),c?.hideFooter?(0,o.jsx)(o.Fragment,{}):(0,o.jsx)(P.wi,{hideEdition:D,customLinks:c?.footerLinks})]})},E=(0,a.keyframes)`
from{
  opacity: 0;
  transform: translate(-60px, 0px);
}

to{
  opacity: 1;
  transform: translate(0px, 0px);
}`,l=n=>({loginMain:(0,a.css)({flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minWidth:"100%"}),container:(0,a.css)({minHeight:"100%",backgroundPosition:"center",backgroundRepeat:"no-repeat",flex:1,minWidth:"100%",marginLeft:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}),loginAnim:(0,a.css)({"&:before":{opacity:1},".login-content-box":{opacity:1}}),submitButton:(0,a.css)({justifyContent:"center",width:"100%"}),loginLogo:(0,a.css)({width:"100%",maxWidth:60,marginBottom:n.spacing(2),[n.breakpoints.up("sm")]:{maxWidth:100}}),loginLogoWrapper:(0,a.css)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",padding:n.spacing(3)}),titleWrapper:(0,a.css)({textAlign:"center"}),mainTitle:(0,a.css)({fontSize:22,[n.breakpoints.up("sm")]:{fontSize:32}}),subTitle:(0,a.css)({fontSize:n.typography.size.md,color:n.colors.text.secondary}),loginContent:(0,a.css)({maxWidth:478,width:"calc(100% - 2rem)",display:"flex",alignItems:"stretch",flexDirection:"column",position:"relative",justifyContent:"flex-start",zIndex:1,minHeight:320,borderRadius:n.shape.radius.default,padding:n.spacing(2,0),opacity:0,[n.transitions.handleMotion("no-preference","reduce")]:{transition:"opacity 0.5s ease-in-out"},[n.breakpoints.up("sm")]:{minHeight:n.spacing(40),justifyContent:"center"}}),loginOuterBox:(0,a.css)({display:"flex",overflowY:"hidden",alignItems:"center",justifyContent:"center"}),loginInnerBox:(0,a.css)({padding:n.spacing(0,2,2,2),display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flexGrow:1,maxWidth:415,width:"100%",transform:"translate(0px, 0px)",[n.transitions.handleMotion("no-preference")]:{transition:"0.25s ease"}}),enterAnimation:(0,a.css)({[n.transitions.handleMotion("no-preference")]:{animation:`${E} ease-out 0.2s`}})})},78361:(C,m,s)=>{s.d(m,{s:()=>P});var o=s(74848),a=s(96540),d=s(13544),e=s(10354),i=s(29158);const P=(0,a.forwardRef)((u,f)=>{const[E,l]=(0,a.useState)(!1);return(0,o.jsx)(e.p,{...u,type:E?"text":"password","data-testid":d.Tp.pages.Login.password,ref:f,suffix:(0,o.jsx)(i.K,{name:E?"eye-slash":"eye","aria-controls":u.id,role:"switch","aria-checked":E,onClick:()=>{l(!E)},tooltip:E?"Hide password":"Show password"})})});P.displayName="PasswordField"},35043:(C,m,s)=>{s.d(m,{DP:()=>l,NQ:()=>E,zJ:()=>n});var o=s(74848),a=s(32196),d=s(90613),e=s(40845),i=s(14578),P=s(94753),u=s(2913),f=s(8484);const E=[{message:"At least 12 characters",validation:t=>t.length>=12},{message:"One uppercase letter",validation:t=>/[A-Z]+/.test(t)},{message:"One lowercase letter",validation:t=>/[a-z]+/.test(t)},{message:"One number",validation:t=>/[0-9]+/.test(t)},{message:"One symbol",validation:t=>/[\W]/.test(t)}],l=t=>!u.Ay.auth.basicAuthStrongPasswordPolicy||E.every(g=>g.validation(t))||(0,f.t)("profile.change-password.strong-password-validation-register","Password does not comply with the strong password policy"),n=({strongPasswordValidations:t,password:g,pristine:h})=>(0,o.jsx)(d.a,{marginBottom:2,children:t.map(_=>(0,o.jsx)(c,{strongPasswordValidation:_,password:g,pristine:h},_.message))}),c=({strongPasswordValidation:t,password:g,pristine:h})=>{const _=(0,e.of)(r),{basicAuthStrongPasswordPolicy:O}=u.Ay.auth;if(!O)return null;const{message:p,validation:x}=t,D=g.length>0&&x(g),w=D||h?"check":"exclamation-triangle",L=D?"secondary":h?"primary":"error";let M;return D?M=_.icon.valid:h?M=_.icon.pending:M=_.icon.error,(0,o.jsxs)(d.a,{display:"flex",alignItems:"center",marginTop:1,children:[(0,o.jsx)(i.I,{className:(0,a.cx)(_.icon.style,M),name:w}),(0,o.jsx)(P.E,{color:L,children:p})]},p)},r=t=>({icon:{style:(0,a.css)({marginRight:t.spacing(1)}),valid:(0,a.css)({color:t.colors.success.text}),pending:(0,a.css)({color:t.colors.secondary.text}),error:(0,a.css)({color:t.colors.error.text})}})}}]);

//# sourceMappingURL=ChangePasswordPage.2091072dc68a849fdee8.js.map