{"version":3,"file":"FolderLibraryPanelsPage.068309e0fd7713c0af77.js","mappings":"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","sources":["webpack://grafana/./public/app/features/folders/FolderLibraryPanelsPage.tsx","webpack://grafana/./public/app/features/library-panels/components/OpenLibraryPanelModal/OpenLibraryPanelModal.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { useAsync } from 'react-use';\n\nimport { Page } from 'app/core/components/Page/Page';\n\nimport { GrafanaRouteComponentProps } from '../../core/navigation/types';\nimport { getNavModel } from '../../core/selectors/navModel';\nimport { StoreState } from '../../types';\nimport { LibraryPanelsSearch } from '../library-panels/components/LibraryPanelsSearch/LibraryPanelsSearch';\nimport { OpenLibraryPanelModal } from '../library-panels/components/OpenLibraryPanelModal/OpenLibraryPanelModal';\nimport { LibraryElementDTO } from '../library-panels/types';\n\nimport { getFolderByUid } from './state/actions';\nimport { getLoadingNav } from './state/navModel';\n\nexport interface OwnProps extends GrafanaRouteComponentProps<{ uid: string }> {}\n\nconst mapStateToProps = (state: StoreState, props: OwnProps) => {\n  const uid = props.match.params.uid;\n  return {\n    pageNav: getNavModel(state.navIndex, `folder-library-panels-${uid}`, getLoadingNav(1)),\n    folderUid: uid,\n  };\n};\n\nconst mapDispatchToProps = {\n  getFolderByUid,\n};\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\nexport type Props = OwnProps & ConnectedProps<typeof connector>;\n\nexport function FolderLibraryPanelsPage({ pageNav, getFolderByUid, folderUid }: Props): JSX.Element {\n  const { loading } = useAsync(async () => await getFolderByUid(folderUid), [getFolderByUid, folderUid]);\n  const [selected, setSelected] = useState<LibraryElementDTO | undefined>(undefined);\n\n  return (\n    <Page navId=\"dashboards/browse\" pageNav={pageNav.main}>\n      <Page.Contents isLoading={loading}>\n        <LibraryPanelsSearch\n          onClick={setSelected}\n          currentFolderUID={folderUid}\n          showSecondaryActions\n          showSort\n          showPanelFilter\n        />\n        {selected ? <OpenLibraryPanelModal onDismiss={() => setSelected(undefined)} libraryPanel={selected} /> : null}\n      </Page.Contents>\n    </Page>\n  );\n}\n\nexport default connector(FolderLibraryPanelsPage);\n","import { css } from '@emotion/css';\nimport debounce from 'debounce-promise';\nimport React, { MouseEvent, useCallback, useEffect, useMemo, useState } from 'react';\n\nimport { GrafanaTheme2, SelectableValue, urlUtil } from '@grafana/data';\nimport { locationService } from '@grafana/runtime';\nimport { AsyncSelect, Button, Modal, useStyles2 } from '@grafana/ui';\n\nimport { DashboardSearchItem } from '../../../search/types';\nimport { getConnectedDashboards, getLibraryPanelConnectedDashboards } from '../../state/api';\nimport { LibraryElementDTO } from '../../types';\n\nexport interface OpenLibraryPanelModalProps {\n  onDismiss: () => void;\n  libraryPanel: LibraryElementDTO;\n}\n\nexport function OpenLibraryPanelModal({ libraryPanel, onDismiss }: OpenLibraryPanelModalProps): JSX.Element {\n  const styles = useStyles2(getStyles);\n  const [loading, setLoading] = useState(false);\n  const [connected, setConnected] = useState(0);\n  const [option, setOption] = useState<SelectableValue<DashboardSearchItem> | undefined>(undefined);\n  useEffect(() => {\n    const getConnected = async () => {\n      const connectedDashboards = await getLibraryPanelConnectedDashboards(libraryPanel.uid);\n      setConnected(connectedDashboards.length);\n    };\n    getConnected();\n  }, [libraryPanel.uid]);\n  const loadOptions = useCallback(\n    (searchString: string) => loadOptionsAsync(libraryPanel.uid, searchString, setLoading),\n    [libraryPanel.uid]\n  );\n  const debouncedLoadOptions = useMemo(() => debounce(loadOptions, 300, { leading: true }), [loadOptions]);\n  const onViewPanel = (e: MouseEvent<HTMLButtonElement>) => {\n    e.preventDefault();\n    locationService.push(urlUtil.renderUrl(`/d/${option?.value?.uid}`, {}));\n  };\n\n  return (\n    <Modal title=\"View panel in dashboard\" onDismiss={onDismiss} onClickBackdrop={onDismiss} isOpen>\n      <div className={styles.container}>\n        {connected === 0 ? (\n          <span>Panel is not linked to a dashboard. Add the panel to a dashboard and retry.</span>\n        ) : null}\n        {connected > 0 ? (\n          <>\n            <p>\n              This panel is being used in{' '}\n              <strong>\n                {connected} {connected > 1 ? 'dashboards' : 'dashboard'}\n              </strong>\n              .Please choose which dashboard to view the panel in:\n            </p>\n            <AsyncSelect\n              isClearable\n              isLoading={loading}\n              defaultOptions={true}\n              loadOptions={debouncedLoadOptions}\n              onChange={setOption}\n              placeholder=\"Start typing to search for dashboard\"\n              noOptionsMessage=\"No dashboards found\"\n            />\n          </>\n        ) : null}\n      </div>\n      <Modal.ButtonRow>\n        <Button variant=\"secondary\" onClick={onDismiss} fill=\"outline\">\n          Cancel\n        </Button>\n        <Button onClick={onViewPanel} disabled={!Boolean(option)}>\n          {option ? `View panel in ${option?.label}...` : 'View panel in dashboard...'}\n        </Button>\n      </Modal.ButtonRow>\n    </Modal>\n  );\n}\n\nasync function loadOptionsAsync(uid: string, searchString: string, setLoading: (loading: boolean) => void) {\n  setLoading(true);\n  const searchHits = await getConnectedDashboards(uid);\n  const options = searchHits\n    .filter((d) => d.title.toLowerCase().includes(searchString.toLowerCase()))\n    .map((d) => ({ label: d.title, value: d }));\n  setLoading(false);\n\n  return options;\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css``,\n  };\n}\n"],"names":["mapStateToProps","state","props","uid","mapDispatchToProps","connector","FolderLibraryPanelsPage","pageNav","getFolderByUid","folderUid","loading","selected","setSelected","OpenLibraryPanelModal","libraryPanel","onDismiss","styles","getStyles","setLoading","connected","setConnected","option","setOption","connectedDashboards","loadOptions","searchString","loadOptionsAsync","debouncedLoadOptions","onViewPanel","e","options","d","theme"],"sourceRoot":""}