{"version":3,"file":"SupportBundles.7fdbc0821ace690e3a9e.js","mappings":"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","sources":["webpack://grafana/./public/app/features/support-bundles/SupportBundles.tsx","webpack://grafana/./public/app/features/support-bundles/state/actions.ts"],"sourcesContent":["import React, { useEffect } from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\n\nimport { dateTimeFormat } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { LinkButton, Spinner, IconButton } from '@grafana/ui';\nimport { Page } from 'app/core/components/Page/Page';\nimport { contextSrv } from 'app/core/core';\nimport { AccessControlAction, StoreState } from 'app/types';\n\nimport { loadBundles, removeBundle, checkBundles } from './state/actions';\n\nconst subTitle = (\n  <span>\n    Support bundles allow you to easily collect and share Grafana logs, configuration, and data with the Grafana Labs\n    team.\n  </span>\n);\n\nconst NewBundleButton = (\n  <LinkButton icon=\"plus\" href=\"support-bundles/create\" variant=\"primary\">\n    New support bundle\n  </LinkButton>\n);\n\nconst mapStateToProps = (state: StoreState) => {\n  return {\n    supportBundles: state.supportBundles.supportBundles,\n    isLoading: state.supportBundles.isLoading,\n  };\n};\n\nconst mapDispatchToProps = {\n  loadBundles,\n  removeBundle,\n  checkBundles,\n};\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\ntype Props = ConnectedProps<typeof connector>;\n\nconst SupportBundlesUnconnected = ({ supportBundles, isLoading, loadBundles, removeBundle, checkBundles }: Props) => {\n  const isPending = supportBundles.some((b) => b.state === 'pending');\n\n  useEffect(() => {\n    loadBundles();\n  }, [loadBundles]);\n\n  useEffect(() => {\n    if (isPending) {\n      checkBundles();\n    }\n  });\n\n  const hasAccess = contextSrv.hasAccess(AccessControlAction.ActionSupportBundlesCreate, contextSrv.isGrafanaAdmin);\n  const hasDeleteAccess = contextSrv.hasAccess(\n    AccessControlAction.ActionSupportBundlesDelete,\n    contextSrv.isGrafanaAdmin\n  );\n\n  const actions = config.featureToggles.topnav && hasAccess ? NewBundleButton : undefined;\n\n  return (\n    <Page navId=\"support-bundles\" subTitle={subTitle} actions={actions}>\n      <Page.Contents isLoading={isLoading}>\n        {!config.featureToggles.topnav && hasAccess && NewBundleButton}\n\n        <table className=\"filter-table form-inline\">\n          <thead>\n            <tr>\n              <th>Created on</th>\n              <th>Requested by</th>\n              <th>Expires</th>\n              <th style={{ width: '32px' }} />\n              <th style={{ width: '1%' }} />\n              <th style={{ width: '1%' }} />\n            </tr>\n          </thead>\n          <tbody>\n            {supportBundles?.map((bundle) => (\n              <tr key={bundle.uid}>\n                <th>{dateTimeFormat(bundle.createdAt * 1000)}</th>\n                <th>{bundle.creator}</th>\n                <th>{dateTimeFormat(bundle.expiresAt * 1000)}</th>\n                <th>{bundle.state === 'pending' && <Spinner />}</th>\n                <th>\n                  <LinkButton\n                    fill=\"outline\"\n                    disabled={bundle.state !== 'complete'}\n                    target={'_self'}\n                    href={`/api/support-bundles/${bundle.uid}`}\n                  >\n                    Download\n                  </LinkButton>\n                </th>\n                <th>\n                  {hasDeleteAccess && (\n                    <IconButton onClick={() => removeBundle(bundle.uid)} name=\"trash-alt\" variant=\"destructive\" />\n                  )}\n                </th>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </Page.Contents>\n    </Page>\n  );\n};\n\nexport default connector(SupportBundlesUnconnected);\n","import { throttle } from 'lodash';\n\nimport { getBackendSrv, locationService } from '@grafana/runtime';\nimport { SupportBundle, SupportBundleCollector, SupportBundleCreateRequest, ThunkResult } from 'app/types';\n\nimport {\n  collectorsFetchBegin,\n  collectorsFetchEnd,\n  fetchBegin,\n  fetchEnd,\n  setCreateBundleError,\n  setLoadBundleError,\n  supportBundleCollectorsLoaded,\n  supportBundlesLoaded,\n} from './reducers';\n\nexport function loadBundles(skipPageRefresh = false): ThunkResult<void> {\n  return async (dispatch) => {\n    try {\n      if (!skipPageRefresh) {\n        dispatch(fetchBegin());\n      }\n      const result = await getBackendSrv().get<SupportBundle[]>('/api/support-bundles');\n      dispatch(supportBundlesLoaded(result));\n    } finally {\n      dispatch(fetchEnd());\n    }\n  };\n}\n\nconst checkBundlesStatusThrottled = throttle(async (dispatch) => {\n  const result = await getBackendSrv().get<SupportBundle[]>('/api/support-bundles');\n  dispatch(supportBundlesLoaded(result));\n}, 1000);\n\nexport function checkBundles(): ThunkResult<void> {\n  return async (dispatch) => {\n    dispatch(checkBundlesStatusThrottled);\n  };\n}\n\nexport function removeBundle(uid: string): ThunkResult<void> {\n  return async (dispatch) => {\n    await getBackendSrv().delete(`/api/support-bundles/${uid}`);\n    dispatch(loadBundles(true));\n  };\n}\n\nexport function loadSupportBundleCollectors(): ThunkResult<void> {\n  return async (dispatch) => {\n    try {\n      dispatch(collectorsFetchBegin());\n      const result = await getBackendSrv().get<SupportBundleCollector[]>('/api/support-bundles/collectors');\n      dispatch(supportBundleCollectorsLoaded(result));\n    } catch (err) {\n      dispatch(setLoadBundleError('Error loading support bundles data collectors'));\n    } finally {\n      dispatch(collectorsFetchEnd());\n    }\n  };\n}\n\nexport function createSupportBundle(data: SupportBundleCreateRequest): ThunkResult<void> {\n  return async (dispatch) => {\n    try {\n      await getBackendSrv().post('/api/support-bundles', data);\n      locationService.push('/support-bundles');\n    } catch (err) {\n      dispatch(setCreateBundleError('Error creating support bundle'));\n    }\n  };\n}\n"],"names":["subTitle","NewBundleButton","mapStateToProps","state","mapDispatchToProps","supportBundles","isLoading","loadBundles","removeBundle","checkBundles","isPending","b","hasAccess","hasDeleteAccess","actions","bundle","skipPageRefresh","dispatch","result","checkBundlesStatusThrottled","uid","loadSupportBundleCollectors","createSupportBundle","data"],"sourceRoot":""}