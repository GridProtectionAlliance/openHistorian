"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6777],{89062:(w,L,t)=>{t.d(L,{y:()=>f});var e=t(74848),j=t(96540),l=t(41053),E=t(10096),r=t(31678),d=t(37425),o=t(85927);const f=({basicRole:U,roles:u,userId:C,orgId:m,onBasicRoleChange:S,roleOptions:J,disabled:A,basicRoleDisabled:W,basicRoleDisabledMessage:i,apply:v=!1,onApplyRoles:n,pendingRoles:a,maxWidth:$,width:R,isLoading:P})=>{const[{loading:K,value:N=u||[]},O]=(0,l.A)(async()=>{try{if(u)return u;if(v&&a?.length)return a;if(E.TP.hasPermission(r.AccessControlAction.ActionUserRolesList)&&C>0)return await(0,o.Xh)(C,m)}catch{console.error("Error loading options")}return[]},[m,C,a,u]);(0,j.useEffect)(()=>{m&&O()},[O,m]);const z=async T=>{v?n&&n(T,C,m):(await(0,o.eA)(T,C,m),await O())},F=E.TP.hasPermission(r.AccessControlAction.ActionUserRolesAdd)&&E.TP.hasPermission(r.AccessControlAction.ActionUserRolesRemove);return(0,e.jsx)(d.n,{appliedRoles:N,basicRole:U,onRolesChange:z,onBasicRoleChange:S,roleOptions:J,isLoading:K||P,disabled:A,basicRoleDisabled:W,basicRoleDisabledMessage:i,showBasicRole:!0,apply:v,canUpdateRoles:F,maxWidth:$,width:R})}},5133:(w,L,t)=>{t.d(L,{r:()=>d});var e=t(74848),j=t(62625),l=t(90182);const r=Object.values(j.X).filter(o=>o!==j.X.None).map(o=>({label:o,value:o}));function d({value:o,onChange:f,"aria-label":U,inputId:u,autoFocus:C,...m}){return(0,e.jsx)(l.l6,{inputId:u,value:o,options:r,onChange:S=>f(S.value??j.X.None),placeholder:"Choose role...","aria-label":U,autoFocus:C,...m})}},23645:(w,L,t)=>{t.r(L),t.d(L,{ServiceAccountsListPageUnconnected:()=>te,default:()=>ce});var e=t(74848),j=t(55127),l=t.n(j),E=t(96540),r=t(71468),d=t(55852),o=t(14186),f=t(67647),U=t(90613),u=t(94354),C=t(69529),m=t(96374),S=t(21780),J=t(2913),A=t(10096),W=t(8484),i=t(31678),v=t(70255),n=t(67061),a=t(48840),$=t(19384),R=t(12942),P=t(72109),K=t(14578),N=t(29158),O=t(89062),z=t(5133);const F=({services:s,onRoleChange:c,roleOptions:b,onRemoveButtonClick:g,onDisable:h,onEnable:y,onAddTokenClick:V,showPaging:Y,totalPages:ae,onChangePage:Z,currentPage:se,isLoading:k})=>{const H=(0,E.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:D},row:{original:B}})=>T(D,B,k,"avatarUrl")},{id:"name",header:"Account",cell:({cell:{value:D},row:{original:B}})=>T(D,B,k),sortType:"string"},{id:"id",header:"ID",cell:({cell:{value:D},row:{original:B}})=>T(D,B,k,"id")},{id:"role",header:"Roles",cell:({cell:{value:D},row:{original:B}})=>p(D,B,k,b,c)},{id:"tokens",header:"Tokens",cell:({cell:{value:D},row:{original:B}})=>T(D,B,k,"tokens")},{id:"actions",header:"",cell:({row:{original:D}})=>_(D,k,V,y,h,g)}],[k,V,h,y,g,c,b]);return(0,e.jsxs)(n.B,{direction:"column",gap:2,children:[(0,e.jsx)(a.j,{columns:H,data:s,getRowId:D=>String(D.id)}),Y&&ae>1&&(0,e.jsx)(n.B,{justifyContent:"flex-end",children:(0,e.jsx)($.d,{numberOfPages:ae,currentPage:se,onNavigate:Z})})]})},T=(s,c,b,g)=>{if(b)return g==="avatarUrl"?(0,e.jsx)(v.A,{circle:!0,width:24,height:24}):(0,e.jsx)(v.A,{width:100});const h=`/org/serviceaccounts/${c.id}`,y=`Edit service account's ${name} details`;switch(g){case"avatarUrl":return(0,e.jsx)("a",{"aria-label":y,href:h,children:(0,e.jsx)(R.e,{src:s,alt:"User avatar"})});case"id":return(0,e.jsx)(P.Y,{href:h,"aria-label":y,color:"secondary",inline:!1,children:c.login});case"tokens":return(0,e.jsxs)(n.B,{alignItems:"center",children:[(0,e.jsx)(K.I,{name:"key-skeleton-alt"}),(0,e.jsx)(P.Y,{href:h,"aria-label":y,color:"primary",inline:!1,children:s||"No tokens"})]});default:return(0,e.jsx)(P.Y,{href:h,"aria-label":y,color:"primary",inline:!1,children:s})}},p=(s,c,b,g,h)=>{const y=A.TP.hasPermission(i.AccessControlAction.ActionRolesList)&&A.TP.hasPermission(i.AccessControlAction.ActionUserRolesList),V=A.TP.hasPermissionInMetadata(i.AccessControlAction.ServiceAccountsWrite,c);return b?(0,e.jsx)(v.A,{width:100}):A.TP.licensedAccessControlEnabled()?y&&(0,e.jsx)(O.y,{userId:c.id,orgId:c.orgId,basicRole:s,roles:c.roles||[],onBasicRoleChange:Y=>h(Y,c),roleOptions:g,basicRoleDisabled:!V,disabled:c.isExternal||c.isDisabled,width:40}):(0,e.jsx)(z.r,{"aria-label":"Role",value:s,disabled:c.isExternal||!V||c.isDisabled,onChange:Y=>h(Y,c)})},_=(s,c,b,g,h,y)=>c?(0,e.jsx)(v.A,{width:100}):s.isExternal?(0,e.jsx)(n.B,{alignItems:"center",justifyContent:"flex-end",children:(0,e.jsx)(N.K,{disabled:!0,name:"lock",size:"md",tooltip:"This is a managed service account and cannot be modified."})}):(0,e.jsxs)(n.B,{alignItems:"center",justifyContent:"flex-end",children:[A.TP.hasPermission(i.AccessControlAction.ServiceAccountsWrite)&&!s.tokens&&(0,e.jsx)(d.$n,{onClick:()=>b(s),disabled:s.isDisabled,children:"Add token"}),A.TP.hasPermissionInMetadata(i.AccessControlAction.ServiceAccountsWrite,s)&&(s.isDisabled?(0,e.jsx)(d.$n,{variant:"secondary",size:"md",onClick:()=>g(s),children:"Enable"}):(0,e.jsx)(d.$n,{variant:"secondary",size:"md",onClick:()=>h(s),children:"Disable"})),A.TP.hasPermissionInMetadata(i.AccessControlAction.ServiceAccountsDelete,s)&&(0,e.jsx)(N.K,{name:"trash-alt","aria-label":`Delete service account ${s.name}`,variant:"secondary",onClick:()=>y(s)})]});F.displayName="ServiceAccountTable";var X=t(98788),I=t(12966);function oe(s){return{...s.serviceAccounts}}const q={changePage:I.yd,changeQuery:I.nM,fetchACOptions:I.pJ,fetchServiceAccounts:I.iJ,deleteServiceAccount:I.W4,updateServiceAccount:I.mV,changeStateFilter:I.qS,createServiceAccountToken:I.yC},Q=(0,r.connect)(oe,q),ee=[{label:"All",value:i.ServiceAccountStateFilter.All},{label:"With expired tokens",value:i.ServiceAccountStateFilter.WithExpiredTokens},{label:"Disabled",value:i.ServiceAccountStateFilter.Disabled}];J.Ay.featureToggles.externalServiceAccounts&&ee.push({label:"Managed",value:i.ServiceAccountStateFilter.External});const te=({page:s,changePage:c,totalPages:b,serviceAccounts:g,isLoading:h,roleOptions:y,query:V,serviceAccountStateFilter:Y,changeQuery:ae,fetchACOptions:Z,fetchServiceAccounts:se,deleteServiceAccount:k,updateServiceAccount:H,changeStateFilter:D,createServiceAccountToken:B})=>{const[he,ie]=(0,E.useState)(!1),[Ee,le]=(0,E.useState)(!1),[me,de]=(0,E.useState)(!1),[Pe,ue]=(0,E.useState)(""),[M,G]=(0,E.useState)(null);(0,E.useEffect)(()=>{se({withLoadingIndicator:!0}),A.TP.licensedAccessControlEnabled()&&Z()},[Z,se]);const re=g.length===0&&Y===i.ServiceAccountStateFilter.All&&!V,De=async(x,Ie)=>{const Be={...Ie,role:x};H(Be),A.TP.licensedAccessControlEnabled()&&Z()},xe=x=>{ae(x)},fe=x=>{D(x)},Ce=x=>{G(x),le(!0)},Te=async()=>{M&&k(M.id),ve()},ge=x=>{G(x),de(!0)},ye=()=>{M&&H({...M,isDisabled:!0}),Ae()},Me=x=>{H({...x,isDisabled:!1})},je=x=>{G(x),ie(!0)},Oe=async x=>{M&&B(M.id,x,ue)},Se=()=>{ie(!1),G(null),ue("")},ve=()=>{le(!1),G(null)},Ae=()=>{de(!1),G(null)},Re=(0,e.jsx)("a",{className:"external-link",href:"https://grafana.com/docs/grafana/latest/administration/service-accounts/",target:"_blank",rel:"noopener noreferrer",children:"documentation."}),pe=(0,e.jsxs)("span",{children:["Service accounts and their tokens can be used to authenticate against the Grafana API. Find out more in our"," ",Re]});return(0,e.jsx)(S.YW,{navId:"serviceaccounts",subTitle:pe,actions:(0,e.jsx)(e.Fragment,{children:!re&&A.TP.hasPermission(i.AccessControlAction.ServiceAccountsCreate)&&(0,e.jsx)(d.z9,{href:"org/serviceaccounts/create",variant:"primary",children:"Add service account"})}),children:(0,e.jsxs)(S.YW.Contents,{children:[(0,e.jsxs)("div",{className:"page-action-bar",children:[(0,e.jsx)(o.I,{grow:!0,children:(0,e.jsx)(f.Z,{placeholder:"Search service account by name",value:V,onChange:xe,width:50})}),(0,e.jsx)(U.a,{marginBottom:1,children:(0,e.jsx)(u.z,{options:ee,onChange:fe,value:Y})})]}),!h&&!re&&g.length===0&&(0,e.jsx)(C.p,{variant:"not-found",message:(0,W.t)("service-accounts.empty-state.message","No services accounts found")}),!h&&re&&(0,e.jsx)(C.p,{variant:"call-to-action",button:(0,e.jsx)(d.z9,{disabled:!A.TP.hasPermission(i.AccessControlAction.ServiceAccountsCreate),href:"org/serviceaccounts/create",icon:"key-skeleton-alt",size:"lg",children:(0,e.jsx)(W.x6,{i18nKey:"service-accounts.empty-state.button-title",children:"Add service account"})}),message:(0,W.t)("service-accounts.empty-state.title","You haven't created any service accounts yet"),children:(0,e.jsx)(W.x6,{i18nKey:"service-accounts.empty-state.more-info",children:"Remember, you can provide specific permissions for API access to other applications"})}),(h||g.length!==0)&&(0,e.jsx)(F,{services:g,showPaging:!0,totalPages:b,onChangePage:c,currentPage:s,onRoleChange:De,roleOptions:y,onRemoveButtonClick:Ce,onDisable:ge,onEnable:Me,onAddTokenClick:je,isLoading:h}),M&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(m.u,{isOpen:Ee,body:`Are you sure you want to delete '${M.name}'${M.tokens?` and ${M.tokens} accompanying ${l()("token",M.tokens)}`:""}?`,confirmText:"Delete",title:"Delete service account",onConfirm:Te,onDismiss:ve}),(0,e.jsx)(m.u,{isOpen:me,title:"Disable service account",body:`Are you sure you want to disable '${M.name}'?`,confirmText:"Disable service account",onConfirm:ye,onDismiss:Ae}),(0,e.jsx)(X.z,{isOpen:he,token:Pe,serviceAccountLogin:M.login,onCreateToken:Oe,onClose:Se})]})]})})},ce=Q(te)},98788:(w,L,t)=>{t.d(L,{z:()=>A});var e=t(74848),j=t(32196),l=t(96540),E=t(62938),r=t(32264),d=t(40845),o=t(37390),f=t(88575),U=t(10354),u=t(94354),C=t(98239),m=t(55852),S=t(10534);const J=[{label:"No expiration",value:!1},{label:"Set expiration date",value:!0}],A=({isOpen:v,token:n,serviceAccountLogin:a,onCreateToken:$,onClose:R})=>{const P=new Date;P.setDate(P.getDate()+1);const K=new Date;r.$.tokenExpirationDayLimit!==void 0&&r.$.tokenExpirationDayLimit>-1?K.setDate(K.getDate()+r.$.tokenExpirationDayLimit+1):K.setDate(864e13);const N=r.$.tokenExpirationDayLimit!==void 0&&r.$.tokenExpirationDayLimit>0,[O,z]=(0,l.useState)(""),[F,T]=(0,l.useState)(""),[p,_]=(0,l.useState)(N),[X,I]=(0,l.useState)(P),[oe,q]=(0,l.useState)(X!==""),Q=(0,d.of)(i);(0,l.useEffect)(()=>{v&&z(`${a}-${(0,E.A)()}`)},[a,v]);const ee=s=>{q(s!==""),I(s)},te=()=>{$({name:F||O,secondsToLive:p?W(X):void 0})},ne=()=>{T(""),z(""),_(N),I(P),q(X!==""),R()},ce=n?"Service account token created":"Add service account token";return(0,e.jsx)(o.a,{isOpen:v,title:ce,onDismiss:ne,className:Q.modal,children:n?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(f.D,{label:"Token",description:"Copy the token now as you will not be able to see it again. Losing a token requires creating a new one.",children:(0,e.jsxs)("div",{className:Q.modalTokenRow,children:[(0,e.jsx)(U.p,{name:"tokenValue",value:n,readOnly:!0}),(0,e.jsx)(S.b,{className:Q.modalCopyToClipboardButton,variant:"primary",size:"md",icon:"copy",getText:()=>n,children:"Copy clipboard"})]})}),(0,e.jsxs)(o.a.ButtonRow,{children:[(0,e.jsx)(S.b,{variant:"primary",getText:()=>n,onClipboardCopy:ne,children:"Copy to clipboard and close"}),(0,e.jsx)(m.$n,{variant:"secondary",onClick:ne,children:"Close"})]})]}):(0,e.jsxs)("div",{children:[(0,e.jsx)(f.D,{label:"Display name",description:"Name to easily identify the token",required:!0,children:(0,e.jsx)(U.p,{name:"tokenName",value:F,placeholder:O,onChange:s=>{T(s.currentTarget.value)}})}),(0,e.jsx)(f.D,{label:"Expiration",children:(0,e.jsx)(u.z,{options:J,value:p,onChange:_,size:"md"})}),p&&(0,e.jsx)(f.D,{label:"Expiration date",children:(0,e.jsx)(C.l,{onChange:ee,value:X,placeholder:"",minDate:P,maxDate:K})}),(0,e.jsx)(o.a.ButtonRow,{children:(0,e.jsx)(m.$n,{onClick:te,disabled:p&&!oe,children:"Generate token"})})]})})},W=v=>{const n=new Date(v),a=new Date;return Math.ceil((n.getTime()-a.getTime())/1e3)},i=v=>({modal:(0,j.css)({width:"550px"}),modalTokenRow:(0,j.css)({display:"flex"}),modalCopyToClipboardButton:(0,j.css)({marginLeft:v.spacing(.5)})})},12966:(w,L,t)=>{t.d(L,{W4:()=>S,iJ:()=>u,mV:()=>m,nM:()=>W,pJ:()=>U,qS:()=>i,yC:()=>J,yd:()=>v});var e=t(2543),j=t.n(e),l=t(17172),E=t(85927),r=t(16233),d=t(31678),o=t(1936);const f="/api/serviceaccounts";function U(){return async n=>{try{if(r.TP.licensedAccessControlEnabled()&&r.TP.hasPermission(d.AccessControlAction.ActionRolesList)){const a=await(0,E.RL)();n((0,o.ew)(a))}}catch(a){console.error(a)}}}function u({withLoadingIndicator:n}={withLoadingIndicator:!1}){return async(a,$)=>{try{if(r.TP.hasPermission(d.AccessControlAction.ServiceAccountsRead)){n&&a((0,o.FW)());const{perPage:R,page:P,query:K,serviceAccountStateFilter:N}=$().serviceAccounts,O=await(0,l.AI)().get(`/api/serviceaccounts/search?perpage=${R}&page=${P}&query=${K}${A(N)}&accesscontrol=true`);if(r.TP.licensedAccessControlEnabled()&&r.TP.hasPermission(d.AccessControlAction.ActionUserRolesList)){a((0,o.dJ)());const z=r.TP.user.orgId,F=O?.serviceAccounts.map(p=>p.id),T=await(0,l.AI)().post("/api/access-control/users/roles/search",{userIds:F,orgId:z});O.serviceAccounts.forEach(p=>{p.roles=T?T[p.id]||[]:[]}),a((0,o.jE)())}a((0,o.zh)(O))}}catch(R){console.error(R)}finally{a((0,o.Yh)())}}}const C=(0,e.debounce)(n=>n(u()),500,{leading:!0});function m(n){return async a=>{await(0,l.AI)().patch(`${f}/${n.id}?accesscontrol=true`,{...n}),a(u())}}function S(n){return async a=>{await(0,l.AI)().delete(`${f}/${n}`),a(u())}}function J(n,a,$){return async R=>{const P=await(0,l.AI)().post(`${f}/${n}/tokens`,a);$(P.key),R(u())}}const A=n=>{switch(n){case d.ServiceAccountStateFilter.WithExpiredTokens:return"&expiredTokens=true";case d.ServiceAccountStateFilter.Disabled:return"&disabled=true";case d.ServiceAccountStateFilter.External:return"&external=true";default:return""}};function W(n){return async a=>{a((0,o.L5)(n)),C(a)}}function i(n){return async a=>{a((0,o.c3)(n)),a(u())}}function v(n){return async a=>{a((0,o.EC)(n)),a(u())}}}}]);

//# sourceMappingURL=ServiceAccountsPage.f8347bcad76c386e9449.js.map