"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1260],{40344:(Q,F,h)=>{h.d(F,{O:()=>D});var N=h(99227),U=h(27677),E=h(37932);const P={http:80,https:443,ftp:21};class D{constructor(){this.absUrl=this.wrapInDeprecationWarning(this.absUrl),this.hash=this.wrapInDeprecationWarning(this.hash),this.host=this.wrapInDeprecationWarning(this.host),this.path=this.wrapInDeprecationWarning(this.path),this.port=this.wrapInDeprecationWarning(this.port,"window.location"),this.protocol=this.wrapInDeprecationWarning(this.protocol,"window.location"),this.replace=this.wrapInDeprecationWarning(this.replace),this.search=this.wrapInDeprecationWarning(this.search),this.state=this.wrapInDeprecationWarning(this.state),this.url=this.wrapInDeprecationWarning(this.url)}wrapInDeprecationWarning(f,O){let M=this;return function(){return(0,N.d)("$location",f.name,O||"locationService"),f.apply(M,arguments)}}absUrl(){return`${window.location.origin}${this.url()}`}hash(f){if((0,E.GQ)("AngularLocationWrapper",!1,"Angular compat layer: hash"),f)throw new Error("AngularLocationWrapper method not implemented.");return E.E1.getLocation().hash.slice(1)}host(){return new URL(window.location.href).hostname}path(f){(0,E.GQ)("AngularLocationWrapper",!1,"Angular compat layer: path");const O=E.E1.getLocation();if(f!=null){let M=String(f);M=M.startsWith("/")?M:`/${M}`;const c=new URL(`${window.location.origin}${M}`);return E.E1.push({pathname:c.pathname,search:c.search.length>0?c.search:O.search,hash:c.hash.length>0?c.hash:O.hash}),this}return f===null?(E.E1.push("/"),this):O.pathname}port(){const f=new URL(window.location.href);return parseInt(f.port,10)||P[f.protocol]||null}protocol(){return new URL(window.location.href).protocol.slice(0,-1)}replace(){throw new Error("AngularLocationWrapper method not implemented.")}search(f,O){if((0,E.GQ)("AngularLocationWrapper",!1,"Angular compat layer: search"),!f)return E.E1.getSearchObject();if(f&&arguments.length>1)return E.E1.partial({[f]:O}),this;if(f){let M;typeof f=="object"?M={...f}:M=(0,E.Ox)(f);for(const p of Object.keys(M))(M[p]===null||M[p]===void 0)&&delete M[p];const c=U.Cj.renderUrl(E.E1.getLocation().pathname,M);E.E1.push(c)}return this}state(f){throw(0,E.GQ)("AngularLocationWrapper",!1,"Angular compat layer: state"),new Error("AngularLocationWrapper method not implemented.")}url(f){if((0,E.GQ)("AngularLocationWrapper",!1,"Angular compat layer: url"),f!==void 0)return f.startsWith("#")?E.E1.push({...E.E1.getLocation(),hash:f}):f.startsWith("?")?E.E1.push({...E.E1.getLocation(),search:f}):f.trim().length===0?E.E1.push("/"):E.E1.push(f),E.E1;const O=E.E1.getLocation();return`${O.pathname}${O.search}${O.hash}`}}},69234:(Q,F,h)=>{h.d(F,{k:()=>O});var N=h(82897),U=h.n(N),E=h(49922),P=h(16911),D=h(25318),K=h(43390),f=h(2476);class O extends K.q{constructor(c,p){super(c,p),this.skipDataOnInit=!1,this.dataList=[],this.useDataFrames=!1,this.panelDataObserver={next:x=>{if(this.panelData=x,x.state===E.Gu.Error&&(this.loading=!1,this.processDataError(x.error)),x.state===E.Gu.Loading){this.loading=!0,this.angularDirtyCheck();return}if(x.request){const{timeInfo:S}=x.request;S&&(this.timeInfo=S)}if(x.timeRange&&(this.range=x.timeRange),this.useDataFrames)this.handleDataFrames(x.series);else{const S=x.series.map(W=>(0,P.Zr)(W));this.handleQueryResult({data:S})}this.angularDirtyCheck()}},this.contextSrv=p.get("contextSrv"),this.datasourceSrv=p.get("datasourceSrv"),this.timeSrv=p.get("timeSrv"),this.templateSrv=p.get("templateSrv"),this.panel.datasource=this.panel.datasource||null,this.events.on(D.Kh.refresh,this.onMetricsPanelRefresh.bind(this)),this.events.on(D.Kh.panelTeardown,this.onPanelTearDown.bind(this)),this.events.on(D.Kh.componentDidMount,this.onMetricsPanelMounted.bind(this))}onMetricsPanelMounted(){const c=this.panel.getQueryRunner();this.querySubscription=c.getData({withTransforms:!0,withFieldConfig:!0}).subscribe(this.panelDataObserver)}onPanelTearDown(){this.querySubscription&&(this.querySubscription.unsubscribe(),this.querySubscription=null)}onMetricsPanelRefresh(){if(!this.otherPanelInFullscreenMode()){if(this.panel.snapshotData){this.updateTimeRange();let c=this.panel.snapshotData;return(0,N.isArray)(c)||(c=c.data),this.panelData={state:E.Gu.Done,series:c,timeRange:this.range},this.$timeout(()=>{this.events.emit(D.Kh.dataSnapshotLoad,c)})}return delete this.error,this.loading=!0,this.datasourceSrv.get(this.panel.datasource,this.panel.scopedVars).then(this.issueQueries.bind(this)).catch(c=>{this.processDataError(c)})}}processDataError(c){if(c.cancelled){console.log("Panel request cancelled",c);return}this.error=c.message||"Request Error",c.data&&(c.data.message?this.error=c.data.message:c.data.error&&(this.error=c.data.error)),this.angularDirtyCheck()}angularDirtyCheck(){this.$scope.$root.$$phase||this.$scope.$digest()}updateTimeRange(c){this.datasource=c||this.datasource,this.range=this.timeSrv.timeRange();const p=(0,f.W1)(this.panel,this.range);this.timeInfo=p.timeInfo,this.range=p.timeRange}issueQueries(c){this.updateTimeRange(c),this.datasource=c;const p=this.panel;return p.getQueryRunner().run({datasource:p.datasource,queries:p.targets,panelId:p.id,dashboardId:this.dashboard.id,timezone:this.dashboard.getTimezone(),timeInfo:this.timeInfo,timeRange:this.range,maxDataPoints:p.maxDataPoints||this.width,minInterval:p.interval,publicDashboardAccessToken:this.dashboard.meta.publicDashboardAccessToken,scopedVars:p.scopedVars,cacheTimeout:p.cacheTimeout,queryCachingTTL:p.queryCachingTTL,transformations:p.transformations})}handleDataFrames(c){this.loading=!1,this.dashboard&&this.dashboard.snapshot&&(this.panel.snapshotData=c.map(p=>(0,P.og)(p)));try{this.events.emit(D.Kh.dataFramesReceived,c)}catch(p){this.processDataError(p)}}handleQueryResult(c){this.loading=!1,this.dashboard.snapshot&&(this.panel.snapshotData=c.data),(!c||!c.data)&&(console.log("Data source query result invalid, missing data field:",c),c={data:[]});try{this.events.emit(D.Kh.dataReceived,c.data)}catch(p){this.processDataError(p)}}}},43390:(Q,F,h)=>{h.d(F,{q:()=>O});var N=h(82897),U=h.n(N),E=h(85081),P=h(25318),D=h(40344),K=h(47694),f=h(77582);class O{constructor(c,p){this.pluginName="",this.pluginId="",this.editModeInitiated=!1,this.loading=!1,this.onPluginTypeChange=S=>{},this.panel=this.panel??c.$parent.panel,this.dashboard=this.dashboard??c.$parent.dashboard,this.$injector=p,this.$scope=c,this.$timeout=p.get("$timeout"),this.editorTabs=[],this.$location=new D.O,this.events=new E.F,this.timing={};const x=K.ZP.panels[this.panel.type];x&&(this.pluginId=x.id,this.pluginName=x.name),c.$on(P.Kh.componentDidMount.name,()=>this.panelDidMount())}panelDidMount(){this.events.emit(P.Kh.componentDidMount),this.events.emit(P.Kh.initialized),this.dashboard.panelInitialized(this.panel)}renderingCompleted(){f.rv.renderingCompleted()}refresh(){this.panel.refresh()}publishAppEvent(c,p){this.$scope.$root.appEvent(c,p)}initEditMode(){this.editModeInitiated||(this.editModeInitiated=!0,this.events.emit(P.Kh.editModeInitialized))}addEditorTab(c,p,x,S){const W={title:c,directiveFn:p,icon:S};(0,N.isString)(p)&&(W.directiveFn=()=>({templateUrl:p})),x?this.editorTabs.splice(x,0,W):this.editorTabs.push(W)}getExtendedMenu(){const c=[];return this.events.emit(P.Kh.initPanelActions,c),c}async getAdditionalMenuItems(){return[]}otherPanelInFullscreenMode(){return this.dashboard.otherPanelInFullscreen(this.panel)}render(c){this.events.emit(P.Kh.render,c)}}},64805:(Q,F,h)=>{h.d(F,{X:()=>E});var N=h(47694);const U=["percent_diff","percent_diff_abs"];class E{static alertToGraphThresholds(D){if(!D.alert||N.vc.unifiedAlertingEnabled)return!1;for(let f=0;f<D.alert.conditions.length;f++){const O=D.alert.conditions[f];if(O.type!=="query")continue;const M=O.evaluator,c=D.thresholds=[],p=U.indexOf(O.reducer?.type)===-1;switch(M.type){case"gt":{const x=M.params[0];c.push({value:x,op:"gt",visible:p});break}case"lt":{const x=M.params[0];c.push({value:x,op:"lt",visible:p});break}case"outside_range":{const x=M.params[0],S=M.params[1];x>S?(c.push({value:x,op:"gt",visible:p}),c.push({value:S,op:"lt",visible:p})):(c.push({value:x,op:"lt",visible:p}),c.push({value:S,op:"gt",visible:p}));break}case"within_range":{const x=M.params[0],S=M.params[1];x>S?(c.push({value:x,op:"lt",visible:p}),c.push({value:S,op:"gt",visible:p})):(c.push({value:x,op:"gt",visible:p}),c.push({value:S,op:"lt",visible:p}));break}}break}for(const f of D.thresholds)f.fill=D.options.alertThreshold,f.line=D.options.alertThreshold,f.colorMode="critical";return!0}}},57277:(Q,F,h)=>{h.d(F,{y:()=>c});var N=h(16911),U=h(69311),E=h(71398),P=h(49922),D=h(36998),K=h(47694),f=h(56422),O=h(19349),M=h(2476);function c(p,x){const S=(0,N.F9)(p.snapshotData),W=new f.g,J={dashboard:x,range:(0,U.JK)()},te=W.canWork(J)?W.getAnnotationsInSnapshot(x,p.id):[],ie=[new E.i(te)];return{timeRange:(0,M.W1)(p,(0,O.$t)().timeRange()).timeRange,state:P.Gu.Done,series:(0,D.SM)({data:S,fieldConfig:{defaults:{},overrides:[]},replaceVariables:p.replaceVariables,fieldConfigRegistry:p.plugin.fieldConfigRegistry,theme:K.vc.theme2,timeZone:x.getTimezone()}),annotations:ie}}},69600:(Q,F,h)=>{h.d(F,{H:()=>K,n:()=>D});var N=h(16911),U=h(20112),E=h(94847),P=h(64703);const D=f=>{const O=f.field.links;if(!(!O||O.length===0))return{getLinks:M=>{const c={};if(f.view){const{dataFrame:x}=f.view;c.__series={value:{name:x.name,refId:x.refId},text:"Series"};const S=f.colIndex!==void 0?x.fields[f.colIndex]:void 0;if(S){if(c.__field={value:{name:S.name,labels:S.labels},text:"Field"},f.rowIndex!==void 0&&f.rowIndex>=0){const{timeField:W}=(0,N.sV)(x);c.__value={value:{raw:S.values.get(f.rowIndex),numeric:f.display.numeric,text:(0,U.zc)(f.display),time:W?W.values.get(f.rowIndex):void 0},text:"Value"}}f.view&&(c.__data={value:{name:x.name,refId:x.refId,fields:(0,E.z)({frame:x,rowIndex:f.rowIndex})},text:"Data"})}else c.__value={value:{raw:f.display.numeric,numeric:f.display.numeric,text:(0,U.zc)(f.display),calc:f.name},text:"Value"}}else console.log("VALUE",f);const p=(x,S,W)=>{const J={...c,...S};return M(x,J,W)};return O.map(x=>(0,P.Bq)().getDataLinkUIModel(x,p,f))}}},K=f=>{const O=f.links;if(!(!O||O.length===0))return{getLinks:()=>O.map(M=>(0,P.Bq)().getDataLinkUIModel(M,f.replaceVariables,f))}}},35155:(Q,F,h)=>{h.r(F),h.d(F,{GraphCtrl:()=>ae,plugin:()=>Ne});var N=h(89377),U=h(4027),E=h(59554),P=h(65103),D=h(85095),K=h(28844),f=h(26189),O=h(47825),M=h(24259),c=h.n(M),p=h(82897),x=h(13426),S=h.n(x),W=h(70926);const J=(n,e,t)=>{const s=(0,W.V)(),i=document.createElement("div");i.innerHTML='<annotation-tooltip event="event" on-edit="onEdit()"></annotation-tooltip>',s.invoke(["$compile","$rootScope",(o,a)=>{const l=t.getOptions().events.manager,r=a.$new(!0);r.event=e,r.onEdit=()=>{l.editEvent(e)},o(i)(r),r.$digest(),r.$destroy();const d=new(S())({target:n[0],content:i,position:"bottom center",classes:"drop-popover drop-popover--annotation",openOn:"hover",hoverCloseDelay:200,tetherOptions:{constraints:[{to:"window",pin:!0,attachment:"both"}]}});d.open(),d.on("close",()=>{setTimeout(()=>{d.destroy()})})}])};let te=null;const ie=(n,e,t)=>{const s=t.getOptions().events.manager;if(s.editorOpen){te=n;return}s.editorOpened(),te=n,setTimeout(()=>{const i=(0,W.V)(),o=document.createElement("div");o.innerHTML='<event-editor panel-ctrl="panelCtrl" event="event" close="close()"></event-editor>',i.invoke(["$compile","$rootScope",(a,l)=>{const r=l.$new(!0);let d;r.event=e,r.panelCtrl=s.panelCtrl,r.close=()=>{d.close()},a(o)(r),r.$digest(),d=new(S())({target:te[0],content:o,position:"bottom center",classes:"drop-popover drop-popover--form",openOn:"click",tetherOptions:{constraints:[{to:"window",pin:!0,attachment:"both"}]}}),d.open(),s.editorOpened(),d.on("close",()=>{setTimeout(()=>{s.editorClosed(),r.$destroy(),d.destroy()})})}])},100)};class oe{constructor(e,t,s,i,o,a,l,r){this._object=e,this._drawFunc=t,this._clearFunc=s,this._moveFunc=i,this._position={left:o,top:a},this._width=l,this._height=r}width(){return this._width}height(){return this._height}position(){return this._position}draw(){this._drawFunc(this._object)}clear(){this._clearFunc(this._object)}getObject(){return this._object}moveTo(e){this._position=e,this._moveFunc(this._object,this._position)}}class ge{constructor(e,t){this._options=e,this._drawableEvent=t,this._hidden=!1}visual(){return this._drawableEvent}getOptions(){return this._options}getParent(){return this._parent}isHidden(){return this._hidden}hide(){this._hidden=!0}unhide(){this._hidden=!1}}class Be{constructor(e){this._events=[],this._types=[],this._plot=e,this.eventsEnabled=!1}getEvents(){return this._events}setTypes(e){return this._types=e}setupEvents(e){const t=(0,p.partition)(e,"isRegion"),s=t[0];e=t[1],c().each(e,(i,o)=>{const a=new ge(o,this._buildDiv(o));this._events.push(a)}),c().each(s,(i,o)=>{const a=new ge(o,this._buildRegDiv(o));this._events.push(a)}),this._events.sort((i,o)=>{const a=i.getOptions(),l=o.getOptions();return a.min>l.min?1:a.min<l.min?-1:0})}drawEvents(){c().each(this._events,(e,t)=>{const s=t.getOptions(),i=this._insidePlot(s.min)||this._insidePlot(s.timeEnd),o=this._overlapPlot(s.min,s.timeEnd);(i||o)&&!t.isHidden()?t.visual().draw():t.visual().getObject().hide()})}updateEvents(){const e=this._plot.getPlotOffset();let t,s;const i=this._plot.getXAxes()[this._plot.getOptions().events.xaxis-1];c().each(this._events,(o,a)=>{s=e.top+this._plot.height()-a.visual().height(),t=i.p2c(a.getOptions().min)+e.left-a.visual().width()/2,a.visual().moveTo({top:s,left:t})})}_clearEvents(){c().each(this._events,(e,t)=>{t.visual().clear()}),this._events=[]}_buildDiv(e){const t=this,s=this._plot.getPlaceholder(),i=this._plot.getPlotOffset(),o=this._plot.getXAxes()[this._plot.getOptions().events.xaxis-1];let a,l,r,d,u,m,g,v;const C=e.eventType;this._types===null||!this._types[C]||!this._types[C].color?r="#666":r=this._types[C].color,this._types===null||!this._types[C]||!this._types[C].markerSize?d=8:d=this._types[C].markerSize,this._types===null||!this._types[C]||this._types[C].markerShow===void 0?u=!0:u=this._types[C].markerShow,this._types===null||!this._types[C]||this._types[C].markerTooltip===void 0?v=!0:v=this._types[C].markerTooltip,this._types==null||!this._types[C]||!this._types[C].lineStyle?m="dashed":m=this._types[C].lineStyle.toLowerCase(),this._types==null||!this._types[C]||this._types[C].lineWidth===void 0?g=1:g=this._types[C].lineWidth;let T=o.options.eventSectionHeight||0;T=T/3,a=i.top+this._plot.height()+T,l=o.p2c(e.min)+i.left;const w=c()('<div class="events_line flot-temp-elem"></div>').css({position:"absolute",opacity:.8,left:l+"px",top:8,width:g+"px",height:this._plot.height()+T*.8,"border-left-width":g+"px","border-left-style":m,"border-left-color":r,color:r}).appendTo(s);if(u){const y=c()('<div class="events_marker"></div>').css({position:"absolute",left:-d-Math.round(g/2)+"px","font-size":0,"line-height":0,width:0,height:0,"border-left":d+"px solid transparent","border-right":d+"px solid transparent"});y.appendTo(w),this._types[C]&&this._types[C].position&&this._types[C].position.toUpperCase()==="BOTTOM"?y.css({top:a-d-8+"px","border-top":"none","border-bottom":d+"px solid "+r}):y.css({top:"0px","border-top":d+"px solid "+r,"border-bottom":"none"}),y.data({event:e});const L=function(){J(y,c()(this).data("event"),t._plot)};e.editModel&&ie(y,e.editModel,t._plot);const A=()=>{t._plot.clearSelection()};v&&(y.css({cursor:"help"}),y.hover(L,A))}return new oe(w,function(L){L.show()},y=>{y.remove()},(y,L)=>{y.css({top:L.top,left:L.left})},l,a,w.width()??1,w.height()??1)}_buildRegDiv(e){const t=this,s=this._plot.getPlaceholder(),i=this._plot.getPlotOffset(),o=this._plot.getXAxes()[this._plot.getOptions().events.xaxis-1];let a,l,r,d,u,m,g;const v=e.eventType;this._types===null||!this._types[v]||!this._types[v].color?m="#666":m=this._types[v].color,this._types===null||!this._types[v]||this._types[v].markerTooltip===void 0?g=!0:g=this._types[v].markerTooltip,this._types==null||!this._types[v]||this._types[v].lineWidth===void 0?r=1:r=this._types[v].lineWidth,this._types==null||!this._types[v]||!this._types[v].lineStyle?u="dashed":u=this._types[v].lineStyle.toLowerCase();const C=2;a=i.top+this._plot.height()+C;const T=Math.min(e.min,e.timeEnd),w=Math.max(e.min,e.timeEnd);l=o.p2c(T)+i.left;const k=o.p2c(w)+i.left,[y,L]=[i.left,i.left+this._plot.width()],A=Math.max(l,y),_=Math.min(k,L),$=k>L?0:r;d=_-A+$,(0,p.each)([l,k],R=>{y<=R&&R<L&&c()('<div class="events_line flot-temp-elem"></div>').css({position:"absolute",opacity:.8,left:R+"px",top:8,width:r+"px",height:this._plot.height()+C,"border-left-width":r+"px","border-left-style":u,"border-left-color":m,color:m}).appendTo(s)});const I=c()('<div class="events_marker region_marker flot-temp-elem"></div>').css({position:"absolute",opacity:.5,left:A+"px",top:a,width:d+"px",height:"0.5rem","border-left-color":m,color:m,"background-color":m});I.appendTo(s),I.data({event:e});const j=function(){J(I,c()(this).data("event"),t._plot)};e.editModel&&ie(I,e.editModel,t._plot);const V=()=>{t._plot.clearSelection()};return g&&(I.css({cursor:"help"}),I.hover(j,V)),new oe(I,function(Y){Y.show()},R=>{R.remove()},(R,Y)=>{R.css({top:Y.top,left:Y.left})},l,a,I.width()??1,I.height()??1)}_insidePlot(e){const t=this._plot.getXAxes()[this._plot.getOptions().events.xaxis-1],s=t.p2c(e);return s>0&&s<t.p2c(t.max)}_overlapPlot(e,t){const s=this._plot.getXAxes()[this._plot.getOptions().events.xaxis-1],[i,o]=[s.p2c(e),s.p2c(t)],[a,l]=[0,s.p2c(s.max)];return a<i&&o<l}}function Ve(n){const e=this,t=new Be(n);n.getEvents=()=>t._events,n.hideEvents=()=>{c().each(t._events,(s,i)=>{i.visual().getObject().hide()})},n.showEvents=()=>{n.hideEvents(),c().each(t._events,(s,i)=>{i.hide()}),e.eventMarkers.drawEvents()},n.setEvents=s=>{t.eventsEnabled&&t.setupEvents(s)},n.hooks.processOptions.push((s,i)=>{i.events.data!=null&&(t.eventsEnabled=!0)}),n.hooks.draw.push(s=>{const i=s.getOptions();t.eventsEnabled&&(t.getEvents().length<1?(t.setTypes(i.events.types),t.setupEvents(i.events.data)):t.updateEvents()),t.drawEvents()})}const Ue={events:{data:null,types:null,xaxis:1,position:"BOTTOM"}};c().plot.plugins.push({init:Ve,options:Ue,name:"events",version:"0.2.5"});var b=h(68404),re=h(97394),z=h(25318),le=h(55294),X=h(46519),ze=h(17128),_e=h(36512),he=h(14582),Ke=h(50235),de=h(16911),He=h(72788),ve=h(20112),xe=h(31438),q=h(96093),B=h(47694),ce=h(77582),Ge=h(92973),pe=h(97724),$e=h(69600),Xe=h(39904),je=h(68226),Ze=h(9085),Ye=h.n(Ze),Ce=h(68183),Qe=h(90208),Je=h(6264);const ye=["min","max","avg","current","total"];class ue extends b.PureComponent{constructor(e){super(e),this.onLabelClick=t=>this.props.onLabelClick(this.props.series,t),this.onToggleAxis=()=>{const t=this.state.yaxis===2?1:2,s={alias:this.props.series.alias,yaxis:t};this.setState({yaxis:t}),this.props.onToggleAxis(s)},this.onColorChange=t=>{this.props.onColorChange(this.props.series,t),this.forceUpdate()},this.state={yaxis:this.props.series.yaxis}}renderLegendValues(){const{series:e,asTable:t}=this.props,s=[];for(const i of ye)if(this.props[i]){const o=e.formatValue(e.stats[i]);s.push(b.createElement(qe,{key:i,valueName:i,value:o,asTable:t,onValueClick:this.onLabelClick}))}return s}render(){const{series:e,values:t,asTable:s,hidden:i}=this.props,o=Ye()({"graph-legend-series-hidden":i,"graph-legend-series--right-y":e.yaxis===2}),a=t?this.renderLegendValues():[],l=b.createElement(be,{label:e.alias,color:e.color,yaxis:this.state.yaxis,onLabelClick:this.onLabelClick,onColorChange:this.onColorChange,onToggleAxis:this.onToggleAxis});return s?b.createElement("tr",{className:`graph-legend-series ${o}`},b.createElement("td",{role:"gridcell"},b.createElement("div",{className:"graph-legend-series__table-name"},l)),a):b.createElement("div",{className:`graph-legend-series ${o}`},l,a)}}ue.defaultProps={asTable:!1,hidden:!1,onLabelClick:()=>{},onColorChange:()=>{},onToggleAxis:()=>{}};class be extends b.PureComponent{render(){const{label:e,color:t,yaxis:s}=this.props,{onColorChange:i,onToggleAxis:o}=this.props,a=this.props.onLabelClick?this.props.onLabelClick:()=>{};return[b.createElement(Ee,{key:"icon",color:t,yaxis:s,onColorChange:i,onToggleAxis:o}),b.createElement("button",{type:"button",className:"graph-legend-alias pointer",title:e,key:"label",onClick:a,"aria-label":Ce.wl.components.Panels.Visualization.Graph.Legend.legendItemAlias(e)},e)]}}be.defaultProps={yaxis:void 0,onLabelClick:()=>{}};class Ee extends b.PureComponent{constructor(){super(...arguments),this.onColorChange=e=>{const{onColorChange:t}=this.props;t&&t(e)}}render(){return b.createElement(Qe.sp,{yaxis:this.props.yaxis,color:this.props.color,onChange:this.onColorChange,onToggleAxis:this.props.onToggleAxis,enableNamedColors:!0},({ref:e,showColorPicker:t,hideColorPicker:s})=>b.createElement(Je.F,{color:this.props.color,ref:e,onClick:t,onMouseLeave:s,className:"graph-legend-icon"}))}}Ee.defaultProps={yaxis:void 0,onColorChange:()=>{},onToggleAxis:()=>{}};function qe({value:n,valueName:e,asTable:t,onValueClick:s}){return t?b.createElement("td",{role:"gridcell",className:`graph-legend-value ${e}`},n):b.createElement("div",{className:`graph-legend-value ${e}`},n)}class Te extends b.PureComponent{constructor(e){super(e),this.onToggleSeries=(t,s)=>{if(!this.props.onToggleSeries)return;let i={...this.state.hiddenSeries};s.ctrlKey||s.metaKey||s.shiftKey?i[t.alias]?delete i[t.alias]:i[t.alias]=!0:i=this.toggleSeriesExclusiveMode(t),this.setState({hiddenSeries:i}),this.props.onToggleSeries(i)},this.state={hiddenSeries:this.props.hiddenSeries}}sortLegend(){let e=[...this.props.seriesList];const t=this.props.sort;return t&&this.props[t]&&this.props.alignAsTable&&(e=(0,p.sortBy)(e,s=>{let i=s.stats[t];return i===null&&(i=-1/0),i}),this.props.sortDesc&&(e=e.reverse())),e}toggleSeriesExclusiveMode(e){const t={...this.state.hiddenSeries};return t[e.alias]&&delete t[e.alias],this.props.seriesList.every(i=>i.alias===e.alias?!0:t[i.alias])?this.props.seriesList.forEach(i=>{delete t[i.alias]}):this.props.seriesList.forEach(i=>{i.alias!==e.alias&&(t[i.alias]=!0)}),t}render(){const{optionalClass:e,rightSide:t,sideWidth:s,sort:i,sortDesc:o,hideEmpty:a,hideZero:l,values:r,min:d,max:u,avg:m,current:g,total:v}=this.props,C={values:r,min:d,max:u,avg:m,current:g,total:v},T=this.state.hiddenSeries,w={hideEmpty:a,hideZero:l},k={sort:i,sortDesc:o},y=this.sortLegend().filter(j=>!j.hideFromLegend(w)),L=`${this.props.alignAsTable?"graph-legend-table":""} ${e}`,A=t&&s?s:void 0,_=t&&s?s-1:void 0,$={minWidth:A,width:_},I={seriesList:y,hiddenSeries:T,onToggleSeries:this.onToggleSeries,onToggleAxis:this.props.onToggleAxis,onToggleSort:this.props.onToggleSort,onColorChange:this.props.onColorChange,...C,...k};return b.createElement("div",{className:`graph-legend-content ${L}`,style:$},this.props.alignAsTable?b.createElement(tt,{...I}):b.createElement(et,{...I}))}}Te.defaultProps={values:!1,min:!1,max:!1,avg:!1,current:!1,total:!1,alignAsTable:!1,rightSide:!1,sort:void 0,sortDesc:!1,optionalClass:"",onToggleSeries:()=>{},onToggleSort:()=>{},onToggleAxis:()=>{},onColorChange:()=>{}};class et extends b.PureComponent{render(){const{seriesList:e,hiddenSeries:t,values:s,min:i,max:o,avg:a,current:l,total:r}=this.props,d={values:s,min:i,max:o,avg:a,current:l,total:r};return e.map((u,m)=>b.createElement(ue,{key:`${u.id}-${m}`,series:u,hidden:t[u.alias],...d,onLabelClick:this.props.onToggleSeries,onColorChange:this.props.onColorChange,onToggleAxis:this.props.onToggleAxis}))}}class tt extends b.PureComponent{constructor(){super(...arguments),this.onToggleSort=e=>{if(!this.props.onToggleSort)return;let t=this.props.sortDesc,s=this.props.sort;e!==s&&(t=void 0),t===!1?(s=void 0,t=void 0):(t=!t,s=e),this.props.onToggleSort(s,t)}}render(){const e=this.props.seriesList,{values:t,min:s,max:i,avg:o,current:a,total:l,sort:r,sortDesc:d,hiddenSeries:u}=this.props,m={values:t,min:s,max:i,avg:o,current:a,total:l};return e?b.createElement("table",{role:"grid"},b.createElement("colgroup",null,b.createElement("col",{style:{width:"100%"}})),b.createElement("thead",null,b.createElement("tr",null,b.createElement("th",{style:{textAlign:"left"}}),ye.map(g=>m[g]&&b.createElement(st,{key:g,statName:g,sort:r,sortDesc:d,onClick:this.onToggleSort})))),b.createElement("tbody",null,e&&e.map((g,v)=>b.createElement(ue,{key:`${g.id}-${v}`,asTable:!0,series:g,hidden:u[g.alias],onLabelClick:this.props.onToggleSeries,onColorChange:this.props.onColorChange,onToggleAxis:this.props.onToggleAxis,...m})))):null}}class st extends b.PureComponent{constructor(){super(...arguments),this.onClick=()=>{this.props.onClick&&this.props.onClick(this.props.statName)}}render(){const{statName:e,sort:t,sortDesc:s}=this.props;return b.createElement("th",{className:"pointer",onClick:this.onClick},e,t===e&&b.createElement(Xe.J,{name:s?"angle-down":"angle-up"}))}}class it extends b.PureComponent{render(){return b.createElement(je.$,{hideHorizontalTrack:!0},b.createElement(Te,{...this.props}))}}const Jt=null;function nt(n,e){if(isNaN(e)||!lt(n))return;const[t,s]=n;ot(t,s,e),at(t,s);const i=t.min===0||s.min===0||t.max===0||s.max===0,o=Oe(t,s);if(i&&o)t.min=t.max>0?0:t.min,t.max=t.max>0?t.max:0,s.min=s.max>0?0:s.min,s.max=s.max>0?s.max:0;else if(ht(t,s))t.min>=0?(t.min=-t.max,s.max=-s.min):(t.max=-t.min,s.min=-s.max);else{const a=dt(t,s);o?t.min>0?(t.min=t.max/a,s.min=s.max/a):(t.max=t.min/a,s.max=s.min/a):Se(t,s)?(t.min=s.min?s.min*a:t.min,s.min=t.min?t.min/a:s.min,t.max=s.max?s.max*a:t.max,s.max=t.max?t.max/a:s.max):(t.min=t.min>0?s.min*a:t.min,s.min=s.min>0?t.min/a:s.min,t.max=t.max<0?s.max*a:t.max,s.max=s.max<0?t.max/a:s.max)}rt(t,s,e)}function at(n,e){n.max===n.min&&(n.min-=.25,n.max+=.25),e.max===e.min&&(e.min-=.25,e.max+=.25)}function ot(n,e,t){t!==0&&(n.min-=t,n.max-=t,e.min-=t,e.max-=t)}function rt(n,e,t){t!==0&&(n.min+=t,n.max+=t,e.min+=t,e.max+=t)}function lt(n){return n.length===2&&Me(n[0])&&Me(n[1])}function Me(n){return"min"in n&&"max"in n}function Oe(n,e){return n.min>=0&&e.min>=0||n.max<=0&&e.max<=0}function Se(n,e){return n.min<=0&&n.max>=0&&e.min<=0&&e.max>=0}function ht(n,e){return n.min>=0&&e.max<=0||n.max<=0&&e.min>=0}function dt(n,e){if(Se(n,e)){const t=e.min?n.min/e.min:0,s=e.max?n.max/e.max:0;return t>s?t:s}if(Oe(n,e)){const t=Math.abs(n.min),s=Math.abs(n.max),i=Math.abs(e.min),o=Math.abs(e.max),a=Math.max(t,s),l=Math.min(t,s),r=Math.max(i,o),d=Math.min(i,o),u=l!==0?a/l:a,m=d!==0?r/d:r;return u>m?u:m}return n.min>0||e.min>0?n.max/e.max:n.min/e.min}var me=h(28550),G=h(16514);class ct{constructor(e){this.panelCtrl=e,this.event=null,this.editorOpen=!1}editorClosed(){this.event=null,this.editorOpen=!1,this.panelCtrl.render()}editorOpened(){this.editorOpen=!0}updateTime(e){this.event||(this.event={},this.event.dashboardUID=this.panelCtrl.dashboard.uid,this.event.panelId=this.panelCtrl.panel.id),this.event.time=e.from,this.event.isRegion=!1,e.to&&(this.event.timeEnd=e.to,this.event.isRegion=!0),this.panelCtrl.render()}editEvent(e,t){this.event=e,this.panelCtrl.render()}addFlotEvents(e,t){if(!this.event&&e.length===0)return;const s={$__alerting:{color:G.ns,position:"BOTTOM",markerSize:5},$__ok:{color:G.te,position:"BOTTOM",markerSize:5},$__no_data:{color:G._V,position:"BOTTOM",markerSize:5},$__pending:{color:G.f7,position:"BOTTOM",markerSize:5},$__editing:{color:G.Jx,position:"BOTTOM",markerSize:5}};if(this.event)this.event.isRegion?e=[{isRegion:!0,min:this.event.time,timeEnd:this.event.timeEnd,text:this.event.text,eventType:"$__editing",editModel:this.event}]:e=[{min:this.event.time,text:this.event.text,editModel:this.event,eventType:"$__editing"}];else for(let l=0;l<e.length;l++){const r=e[l];if(r.min=r.time,r.max=r.time,r.eventType=r.type,r.newState){r.eventType="$__"+r.newState;continue}s[r.type]||(s[r.type]={color:r.color,position:"BOTTOM",markerSize:5})}const i=pt(e);ut(i,t);const o=20,a=7;t.grid.eventSectionHeight=a,t.xaxis.eventSectionHeight=o,t.events={levels:(0,p.keys)(s).length+1,data:e,types:s,manager:this}}}function pt(n){return(0,p.filter)(n,"isRegion")}function ut(n,e){const t=e.grid.markings,s=G.Jx;let i;(0,p.each)(n,o=>{o.source?i=o.color||s:i=s,i=mt(i,G.iV),t.push({xaxis:{from:o.min,to:o.timeEnd},color:i})})}function mt(n,e){const t=(0,me.Z)(n);return t.isValid()?(t.setAlpha(e),t.toRgbString()):n}var De=h(47513),ee=h(8928),Le=h(81168);function ft(n,e,t,s){const i=this,a=t.ctrl.panel,l=new z.IA({pos:{},point:{},panel:this.panel}),r=c()('<div class="graph-tooltip">');this.destroy=()=>{r.remove()},this.findHoverIndexFromDataPoints=(d,u,m)=>{const g=u.datapoints.pointsize,v=m*g,C=u.datapoints.points.length;let T;for(T=v;T<C;T+=g)if(!u.lines.steps&&u.datapoints.points[v]!=null&&u.datapoints.points[T]==null||u.datapoints.points[T]>d)return Math.max(T-g,0)/g;return T/g-1},this.findHoverIndexFromData=(d,u)=>{let m=0,g=u.data.length-1,v;for(;;){if(m>g)return Math.max(g,0);if(v=Math.floor((m+g)/2),u.data[v][0]===d)return v;u.data[v][0]<d?m=v+1:g=v-1}},this.renderAndShow=(d,u,m,g)=>{g==="time"&&(u='<div class="graph-tooltip-time">'+d+"</div>"+u),r.html(u).place_tt(m.pageX,m.pageY,{offset:10})},this.getMultiSeriesPlotHoverInfo=function(d,u){let m,g,v,C,T,w,k,y=[[],[],[]],L=0,A,_;for(g=0;g<d.length;g++){if(v=d[g],!v.data.length||a.legend.hideEmpty&&v.allIsNull){y[0].push({hidden:!0,value:0});continue}if(!v.data.length||a.legend.hideZero&&v.allIsZero){y[0].push({hidden:!0,value:0});continue}if(v.hideTooltip){y[0].push({hidden:!0,value:0});continue}C=this.findHoverIndexFromData(u.x,v),T=u.x-v.data[C][0],w=v.data[C][0],(!A||T>=0&&(T<A||A<0)||T<0&&T>A)&&(A=T,_=w),m=v.data[C][1],v.stack&&m!==null&&a.tooltip.value_type!=="individual"&&(L+=m,m=L),(v.lines.steps||v.stack)&&(C=this.findHoverIndexFromDataPoints(u.x,v,C)),k=0,v.yaxis&&(k=v.yaxis.n),y[k].push({value:m,hoverIndex:C,color:v.color,label:v.aliasEscaped,time:w,distance:T,index:g})}return y=y[0].concat(y[1],y[2]),y.time=_,y},n.mouseleave(()=>{if(a.tooltip?.shared){const d=n.data().plot;d&&(r.detach(),d.unhighlight())}e.events.publish(new z.oi),e.events.publish(new le.xH)}),n.bind("plothover",(d,u,m)=>{i.show(u,m),e.panelInEdit||(u.panelRelY=(u.pageY-n.offset().top)/n.height(),l.payload.pos=u,l.payload.panel=a,l.payload.point.time=u.x,e.events.publish(l))}),n.bind("plotclick",(d,u,m)=>{ce.h$.emit(Le.CoreEvents.xt,{pos:u,panel:a,item:m})}),n.bind("plotleave",()=>{if(!a.tooltip.shared)return;const d=n.data().plot;d&&(r.detach(),d.unhighlight())}),this.clear=d=>{r.detach(),d.clearCrosshair(),d.unhighlight()},this.show=(d,u)=>{const m=n.data().plot,g=m.getData(),C=m.getXAxes()[0].options.mode,T=s();let w=a.tooltip.shared,k,y,L,A,_,$,I,j;if(d.panelRelY){const V=m.pointOffset({x:d.x});if(Number.isNaN(V.left)||V.left<0||V.left>n.width()){i.clear(m);return}d.pageX=n.offset().left+V.left,d.pageY=n.offset().top+n.height()*d.panelRelY;const H=c()(window).scrollTop()??0;if(!(d.pageY>=H&&d.pageY<=c()(window).innerHeight()+H)){i.clear(m);return}if(m.setCrosshair(d),w=!0,e.sharedCrosshairModeOnly())return}if(T.length!==0)if(T[0].hasMsResolution?j=De.U6.fullDateMS:j=De.U6.fullDate,w){m.unhighlight();const V=i.getMultiSeriesPlotHoverInfo(g,d);for(I="",L=e.formatDate(V.time,j),a.tooltip.sort===2?V.sort((H,R)=>R.value-H.value):a.tooltip.sort===1&&V.sort((H,R)=>H.value-R.value),_=0;_<V.length;_++){if(A=V[_],A.hidden)continue;let H="";u&&A.index===u.seriesIndex&&(H="graph-tooltip-list-item--highlight"),$=T[A.index],y=ee.QX.sanitize($.formatValue(A.value));const R=ee.QX.sanitize(A.color),Y=ee.QX.sanitize(A.label);I+='<div class="graph-tooltip-list-item '+H+'"><div class="graph-tooltip-series-name">',I+='<i class="fa fa-minus" style="color:'+R+';"></i> '+Y+":</div>",I+='<div class="graph-tooltip-value">'+y+"</div></div>",m.highlight(A.index,A.hoverIndex)}i.renderAndShow(L,I,d,C)}else if(u){const V=ee.QX.sanitize(u.series.color);$=T[u.seriesIndex],k='<div class="graph-tooltip-list-item"><div class="graph-tooltip-series-name">',k+='<i class="fa fa-minus" style="color:'+V+';"></i> '+$.aliasEscaped+":</div>",a.stack&&a.tooltip.value_type==="individual"?y=u.datapoint[1]-u.datapoint[2]:y=u.datapoint[1],y=ee.QX.sanitize($.formatValue(y)),L=e.formatDate(u.datapoint[0],j),k+='<div class="graph-tooltip-value">'+y+"</div>",i.renderAndShow(L,k,d,C)}else r.detach()}}var gt=h(47700);function vt(n){const t=[];for(let s=0;s<n.length;s++){const o=n[s].datapoints;for(let a=0;a<o.length;a++)o[a][0]!==null&&t.push(o[a][0])}return t}function xt(n,e,t,s){const i=Ae(t,e),o=Ae(s,e);return(0,gt.histogram)().domain([i,o]).thresholds(Math.round(s-t)/e)(n).map(l=>[l.x0,l.length])}function Ct(n,e,t,s,i){return n.map(o=>{const a=vt([o]);if(o.histogram=!0,t[o.alias])o.data=[];else{const l=xt(a,e,s,i);o.data=l}return o})}function Ae(n,e){return Math.floor(n/e)*e}class yt{constructor(e){this.panelCtrl=e,this.needsCleanup=!1}getHandleHtml(e,t,s){let i=t.colorMode;return t.colorMode==="custom"&&(i="critical"),`
    <div class="alert-handle-wrapper alert-handle-wrapper--T${e}">
      <div class="alert-handle-line alert-handle-line--${i}">
      </div>
      <div class="alert-handle" data-handle-index="${e}">
        <i class="icon-gf icon-gf-${i} alert-state-${i}"></i>
        <span class="alert-handle-value">${s}<i class="alert-handle-grip"></i></span>
      </div>
    </div>`}initDragging(e){const t=c()(e.currentTarget).parents(".alert-handle-wrapper"),s=c()(e.currentTarget).data("handleIndex");let i=null,o;const a=this.plot,l=this.panelCtrl,r=this.thresholds[s];function d(m){if(i===null)i=m.clientY;else{const g=m.clientY-i;o=o+g,i=m.clientY,t.css({top:o+g})}}function u(){let m=a.c2p({left:0,top:o}).y;m=parseInt(m.toFixed(0),10),r.value=m,t.off("mousemove",d),document.removeEventListener("mouseup",u),l.$scope.$apply(()=>{l.render(),l.events.emit(Le.CoreEvents.GL,{threshold:r,handleIndex:s})})}i=null,o=t.position().top,t.on("mousemove",d),document.addEventListener("mouseup",u)}cleanUp(){this.placeholder.find(".alert-handle-wrapper").remove(),this.needsCleanup=!1}renderHandle(e,t){const s=this.thresholds[e];if(!s.visible&&this.panelCtrl.alert)return;const i=s.value;let o=i,a=0;if(!(0,p.isNumber)(i))o="",a=t;else{const r=this.plot.p2c({x:0,y:i});a=Math.round(Math.min(Math.max(r.top,0),this.height)-6)}const l=c()(this.getHandleHtml(e,s,o));this.placeholder.append(l),l.toggleClass("alert-handle-wrapper--no-value",o===""),l.css({top:a})}shouldDrawHandles(){return!this.hasSecondYAxis&&this.panelCtrl.editingThresholds&&this.panelCtrl.panel.thresholds.length>0}prepare(e,t){this.hasSecondYAxis=!1;for(let s=0;s<t.length;s++)if(t[s].yaxis>1){this.hasSecondYAxis=!0;break}if(this.shouldDrawHandles()){const s=this.panelCtrl.panel.thresholds.length>1?"220px":"110px";e.css("margin-right",s)}else this.needsCleanup&&e.css("margin-right","0")}draw(e){this.thresholds=this.panelCtrl.panel.thresholds,this.plot=e,this.placeholder=e.getPlaceholder(),this.needsCleanup&&this.cleanUp(),this.shouldDrawHandles()&&(this.height=e.height(),this.thresholds.length>0&&this.renderHandle(0,10),this.thresholds.length>1&&this.renderHandle(1,this.height-30),this.placeholder.off("mousedown",".alert-handle"),this.placeholder.on("mousedown",".alert-handle",this.initDragging.bind(this)),this.needsCleanup=!0)}addFlotOptions(e,t){if(!t.thresholds||t.thresholds.length===0)return;let s=1/0,i=-1/0,o,a,l;for(o=0;o<t.thresholds.length;o++){if(a=t.thresholds[o],!(0,p.isNumber)(a.value))continue;let r;switch(a.op){case"gt":{r=s,t.thresholds.length>o+1&&(l=t.thresholds[o+1],l.value>a.value&&(r=l.value,i=r));break}case"lt":{r=i,t.thresholds.length>o+1&&(l=t.thresholds[o+1],l.value<a.value&&(r=l.value,s=r));break}}let d,u;switch(a.colorMode){case"critical":{d="rgba(234, 112, 112, 0.12)",u="rgba(237, 46, 24, 0.60)";break}case"warning":{d="rgba(235, 138, 14, 0.12)",u="rgba(247, 149, 32, 0.60)";break}case"ok":{d="rgba(11, 237, 50, 0.090)",u="rgba(6,163,69, 0.60)";break}case"custom":{d=a.fillColor,u=a.lineColor;break}}a.fill&&(a.yaxis==="right"&&this.hasSecondYAxis?e.grid.markings.push({y2axis:{from:a.value,to:r},color:B.vc.theme2.visualization.getColorByName(d)}):e.grid.markings.push({yaxis:{from:a.value,to:r},color:B.vc.theme2.visualization.getColorByName(d)})),a.line&&(a.yaxis==="right"&&this.hasSecondYAxis?e.grid.markings.push({y2axis:{from:a.value,to:a.value},color:B.vc.theme2.visualization.getColorByName(u)}):e.grid.markings.push({yaxis:{from:a.value,to:a.value},color:B.vc.theme2.visualization.getColorByName(u)}))}}}function bt(n,e){if(!(n.fromDayOfWeek||n.from)&&!(n.toDayOfWeek||n.to))return[];const t={...n};t.from&&!t.to&&(t.to=t.from),!t.from&&t.to&&(t.from=t.to);const s={from:Pe(t.from),to:Pe(t.to)};if(!t.fromDayOfWeek&&t.toDayOfWeek&&(t.fromDayOfWeek=t.toDayOfWeek),!t.toDayOfWeek&&t.fromDayOfWeek&&(t.toDayOfWeek=t.fromDayOfWeek),t.fromDayOfWeek&&(s.from.dayOfWeek=Number(t.fromDayOfWeek)),t.toDayOfWeek&&(s.to.dayOfWeek=Number(t.toDayOfWeek)),s.from.dayOfWeek&&s.from.h==null&&s.from.m==null&&(s.from.h=0,s.from.m=0,s.from.s=0),s.to.dayOfWeek&&s.to.h==null&&s.to.m==null&&(s.to.h=23,s.to.m=59,s.to.s=59),!s.from||!s.to)return[];s.from.h==null&&(s.from.h=0),s.to.h==null&&(s.to.h=23);const i=[],o=(0,X.CQ)(e.from);for(o.set("hour",0),o.set("minute",0),o.set("second",0),o.add(s.from.h,"hours"),o.add(s.from.m,"minutes"),o.add(s.from.s,"seconds");o.unix()<=e.to.unix();){for(;s.from.dayOfWeek&&s.from.dayOfWeek!==o.isoWeekday();)o.add(24,"hours");if(o.unix()>e.to.unix())break;const a=(0,X.CQ)(o);if(a.hour)if(s.from.h<=s.to.h)a.add(s.to.h-s.from.h,"hours");else if(s.from.h>s.to.h)for(;a.hour()!==s.to.h;)a.add(1,"hours");else for(a.add(24-s.from.h,"hours");a.hour()!==s.to.h;)a.add(1,"hours");for(a.set("minute",s.to.m??0),a.set("second",s.to.s??0);s.to.dayOfWeek&&s.to.dayOfWeek!==a.isoWeekday();)a.add(24,"hours");o.unix()<e.from.unix()&&a.unix()<e.from.unix()||o.unix()>e.to.unix()&&a.unix()>e.to.unix()||i.push({from:o.valueOf(),to:a.valueOf()}),o.add(24,"hours")}return i}function Pe(n){const e={};if(!n?.length)return e;const s=/^([\d]+):?(\d{2})?/.exec(n);return s&&s.length>1&&(e.h=Number(s[1]),e.m=0,s.length>2&&s[2]!==void 0&&(e.m=Number(s[2])),e.h>23&&(e.h=23),e.m>59&&(e.m=59)),e}const ne={gray:{themeDependent:!0,title:"Gray",darkColor:{fill:"rgba(255, 255, 255, 0.09)",line:"rgba(255, 255, 255, 0.2)"},lightColor:{fill:"rgba(0, 0, 0, 0.09)",line:"rgba(0, 0, 0, 0.2)"}},red:{title:"Red",color:{fill:"rgba(234, 112, 112, 0.12)",line:"rgba(237, 46, 24, 0.60)"}},green:{title:"Green",color:{fill:"rgba(11, 237, 50, 0.090)",line:"rgba(6,163,69, 0.60)"}},blue:{title:"Blue",color:{fill:"rgba(11, 125, 238, 0.12)",line:"rgba(11, 125, 238, 0.60)"}},yellow:{title:"Yellow",color:{fill:"rgba(235, 138, 14, 0.12)",line:"rgba(247, 149, 32, 0.60)"}},custom:{title:"Custom"}};function Et(){return(0,p.map)(Object.keys(ne),n=>({key:n,value:ne[n].title}))}function Tt(n,e){if(Object.keys(ne).indexOf(n.colorMode)===-1&&(n.colorMode="red"),n.colorMode==="custom")return{fill:n.fill&&n.fillColor?e.visualization.getColorByName(n.fillColor):null,line:n.line&&n.lineColor?e.visualization.getColorByName(n.lineColor):null};const t=ne[n.colorMode];return t.themeDependent===!0?e.isLight?t.lightColor:t.darkColor:{fill:n.fill?e.visualization.getColorByName(t.color.fill):null,line:n.fill?e.visualization.getColorByName(t.color.line):null}}class Mt{constructor(e){this.panelCtrl=e}draw(e){this.timeRegions=this.panelCtrl.panel.timeRegions,this.plot=e}addFlotOptions(e,t){if(!t.timeRegions?.length)return;const s={from:(0,X.CQ)(this.panelCtrl.range.from).utc(),to:(0,X.CQ)(this.panelCtrl.range.to).utc(),raw:{from:"",to:""}};for(const i of t.timeRegions){const o=i,a=bt(i,s);if(a.length){const l=Tt(o,B.vc.theme2);for(let r=0;r<a.length;r++){const d=a[r];o.fill&&e.grid.markings.push({xaxis:{from:d.from,to:d.to},color:l.fill}),o.line&&(e.grid.markings.push({xaxis:{from:d.from,to:d.from},color:l.line}),e.grid.markings.push({xaxis:{from:d.to,to:d.to},color:l.line}))}}}}}var se=h(21760);function Ot(n){const e={from:Number.MAX_SAFE_INTEGER,to:Number.MIN_SAFE_INTEGER};let t=!1;const s=[se.gz.min,se.gz.max];for(const i of n)for(const o of i.fields)if(o.type===he.fS.time){const a=(0,se.Kx)({field:o,reducers:s});e.from=Math.min(e.from,a[se.gz.min]),e.to=Math.max(e.to,a[se.gz.max]),t=!0}return t?e:void 0}function St(n){return Boolean(n&&typeof n=="object"&&n.hasOwnProperty("pos"))}const Dt=(0,Ge.E)(it,B.ZP.theme2);class Lt{constructor(e,t,s){this.scope=e,this.elem=t,this.timeSrv=s,this.data=[],this.getContextMenuItemsSupplier=(i,o)=>()=>{const a=this.dashboard.canAddAnnotations()?[{items:[{label:"Add annotation",ariaLabel:"Add annotation",icon:"comment-alt",onClick:()=>this.eventManager.updateTime({from:i.x,to:null})}]}]:[];if(!o)return a;const l=[{items:o.getLinks(this.panel.replaceVariables).map(r=>({label:r.title,ariaLabel:r.title,url:r.href,target:r.target,icon:r.target==="_self"?"link":"external-link-alt",onClick:r.onClick}))}];return[...a,...l]},this.ctrl=e.ctrl,this.contextMenu=e.ctrl.contextMenuCtrl,this.dashboard=this.ctrl.dashboard,this.panel=this.ctrl.panel,this.annotations=[],this.panelWidth=0,this.eventManager=new ct(this.ctrl),this.thresholdManager=new yt(this.ctrl),this.timeRegionManager=new Mt(this.ctrl),this.tooltip=new ft(this.elem,this.ctrl.dashboard,this.scope,()=>this.sortedSeries),this.ctrl.events.on(z.Kh.panelTeardown,this.onPanelTeardown.bind(this)),this.ctrl.events.on(z.Kh.render,this.onRender.bind(this)),this.ctrl.dashboard.events.on(z.IA.type,this.onGraphHover.bind(this),this.scope),this.ctrl.dashboard.events.on(z.oi.type,this.onGraphHoverClear.bind(this),this.scope),this.ctrl.dashboard.events.on(le.es.type,this.onGraphHover.bind(this),this.scope),this.ctrl.dashboard.events.on(le.xH.type,this.onGraphHoverClear.bind(this),this.scope),this.elem.bind("plotselected",this.onPlotSelected.bind(this)),this.elem.bind("plotclick",this.onPlotClick.bind(this)),this.elem&&this.elem.parent&&(this.legendElem=this.elem.parent().find(".graph-legend")[0])}onRender(e){if(this.data=e||this.data,!this.data)return;this.annotations=this.ctrl.annotations||[],this.buildFlotPairs(this.data);const t=this.ctrl.height;if((0,ce.Wz)(this.data,this.panel,t),!this.panel.legend.show){this.legendElem.hasChildNodes()&&re.unmountComponentAtNode(this.legendElem),this.renderPanel();return}const{values:s,min:i,max:o,avg:a,current:l,total:r}=this.panel.legend,{alignAsTable:d,rightSide:u,sideWidth:m,sort:g,sortDesc:v,hideEmpty:C,hideZero:T}=this.panel.legend,w={alignAsTable:d,rightSide:u,sideWidth:m,sort:g,sortDesc:v,hideEmpty:C,hideZero:T},k={values:s,min:i,max:o,avg:a,current:l,total:r},y={seriesList:this.data,hiddenSeries:this.ctrl.hiddenSeries,...w,...k,onToggleSeries:this.ctrl.onToggleSeries,onToggleSort:this.ctrl.onToggleSort,onColorChange:this.ctrl.onColorChange,onToggleAxis:this.ctrl.onToggleAxis},L=b.createElement(Dt,y);re.render(L,this.legendElem,()=>this.renderPanel())}onGraphHover(e){if(this.dashboard.sharedTooltipModeEnabled()){if(St(e)){if(!this.plot||e.panel?.id===this.panel.id||this.ctrl.otherPanelInFullscreenMode())return;this.tooltip.show(e.pos)}e.point?.time&&this.tooltip.show({x:e.point.time,panelRelY:e.point.panelRelY??1})}}onPanelTeardown(){this.plot&&(this.plot.destroy(),this.plot=null),this.tooltip.destroy(),this.elem.off(),this.elem.remove(),re.unmountComponentAtNode(this.legendElem)}onGraphHoverClear(e){this.plot&&this.tooltip.clear(this.plot)}onPlotSelected(e,t){if(this.panel.xaxis.mode!=="time"){this.plot.clearSelection();return}(t.ctrlKey||t.metaKey)&&this.dashboard.canAddAnnotations()?setTimeout(()=>{this.eventManager.updateTime(t.xaxis)},100):this.scope.$apply(()=>{this.timeSrv.setTime({from:(0,X.zh)(t.xaxis.from),to:(0,X.zh)(t.xaxis.to)})})}onPlotClick(e,t,s){const i=this.elem.closest(".view")?this.elem.closest(".view").get()[0]:null,o=s;if(this.panel.xaxis.mode==="time")if(t.ctrlKey||t.metaKey){if(t.x!==t.x1||!this.dashboard.id||!this.dashboard.canAddAnnotations())return;setTimeout(()=>{this.eventManager.updateTime({from:t.x,to:null})},100);return}else{this.tooltip.clear(this.plot);let a;if(s){const l=this.panel.yaxes[s.series.yaxis.n===2?1:0],r=this.ctrl.dataList[s.series.dataFrameIndex],d=r.fields[s.series.fieldIndex],u=this.getDataIndexWithNullValuesCorrection(s,r);let m=this.panel.options.dataLinks||[];const g=(0,ze.gG)(d);g&&(m=[...m,...d.config.links]);const v={decimals:l.decimals,links:m},C=(0,_e.U_)({field:{config:v,type:he.fS.number},theme:B.ZP.theme2,timeZone:this.dashboard.getTimezone()})(d.values.get(u));a=m.length?(0,$e.n)({display:C,name:d.name,view:new Ke.U(r),rowIndex:u,colIndex:s.series.fieldIndex,field:v,hasLinks:g}):void 0}this.scope.$apply(()=>{this.contextMenu.setScrollContextElement(i),this.contextMenu.setSource(o),this.contextMenu.setMenuItemsSupplier(this.getContextMenuItemsSupplier(t,a)),this.contextMenu.toggleMenu(t)})}}getDataIndexWithNullValuesCorrection(e,t){const{datapoint:s,dataIndex:i}=e;if(!Array.isArray(s)||s.length===0)return i;const o=s[0],{timeField:a}=(0,de.sV)(t);if(!a||!a.values||a.values.get(i)===o)return i;const r=a.values.toArray().findIndex(d=>d===o);return r>-1?r:i}shouldAbortRender(){return!this.data||this.panelWidth===0}drawHook(e){this.panel.yaxes[0].label&&this.panel.yaxes[0].show&&c()("<div class='axisLabel left-yaxis-label flot-temp-elem'></div>").text(this.panel.yaxes[0].label).appendTo(this.elem),this.panel.yaxes[1].label&&this.panel.yaxes[1].show&&c()("<div class='axisLabel right-yaxis-label flot-temp-elem'></div>").text(this.panel.yaxes[1].label).appendTo(this.elem);const{dataWarning:t}=this.ctrl;if(t){const s=c()(`<div class="datapoints-warning flot-temp-elem">${t.title}</div>`);t.action&&c()(`<button class="btn btn-secondary">${t.actionText}</button>`).click(t.action).appendTo(s),s.appendTo(this.elem)}this.thresholdManager.draw(e),this.timeRegionManager.draw(e)}processOffsetHook(e,t){const s=this.panel.yaxes[0],i=this.panel.yaxes[1];s.show&&s.label&&(t.left=20),i.show&&i.label&&(t.right=20);const o=e.getYAxes();for(let a=0;a<o.length;a++){const l=o[a],r=this.panel.yaxes[a];l.options.max=l.options.max!==null?l.options.max:r.max,l.options.min=l.options.min!==null?l.options.min:r.min}}processRangeHook(e){const t=e.getYAxes(),s=this.panel.yaxis.align||!1;if(t.length>1&&s===!0){const i=this.panel.yaxis.alignLevel||0;nt(t,parseFloat(i))}}getMinTimeStepOfSeries(e){let t=Number.MAX_VALUE;for(let s=0;s<e.length;s++)if(e[s].stats.timeStep){if(this.panel.bars){if(e[s].bars&&e[s].bars.show===!1)continue}else if(typeof e[s].bars>"u"||typeof e[s].bars.show>"u"||!e[s].bars.show)continue;e[s].stats.timeStep<t&&(t=e[s].stats.timeStep)}return t}renderPanel(){if(this.panelWidth=this.elem.width()??0,this.shouldAbortRender())return;this.thresholdManager.prepare(this.elem,this.data),this.panel.dashes=this.panel.lines?this.panel.dashes:!1;const e=this.buildFlotOptions(this.panel);this.prepareXAxis(e,this.panel),this.configureYAxisOptions(this.data,e),this.thresholdManager.addFlotOptions(e,this.panel),this.timeRegionManager.addFlotOptions(e,this.panel),this.eventManager.addFlotEvents(this.annotations,e),this.sortedSeries=this.sortSeries(this.data,this.panel),this.callPlot(e,!0)}buildFlotPairs(e){for(let t=0;t<e.length;t++){const s=e[t];s.data=s.getFlotPairs(s.nullPointMode||this.panel.nullPointMode),s.transform==="constant"&&(s.data=(0,He.H)(s.data,this.ctrl.range)),this.ctrl.hiddenSeries[s.alias]&&(s.data=[],s.stack=!1)}}prepareXAxis(e,t){switch(t.xaxis.mode){case"series":{e.series.bars.barWidth=.7,e.series.bars.align="center";for(let s=0;s<this.data.length;s++){const i=this.data[s];i.data=[[s+1,i.stats[t.xaxis.values[0]]]]}this.addXSeriesAxis(e);break}case"histogram":{let s;if(this.data.length){let i=(0,p.min)((0,p.map)(this.data,l=>l.stats.min)),o=(0,p.max)((0,p.map)(this.data,l=>l.stats.max));const a=t.xaxis.buckets||this.panelWidth/50;t.xaxis.min!=null&&(i=(0,pe.tickStep)(t.xaxis.min,o,a)<=0?i:t.xaxis.min),t.xaxis.max!=null&&(o=(0,pe.tickStep)(i,t.xaxis.max,a)<=0?o:t.xaxis.max),s=(0,pe.tickStep)(i,o,a),e.series.bars.barWidth=s*.8,this.data=Ct(this.data,s,this.ctrl.hiddenSeries,i,o)}else s=0;this.addXHistogramAxis(e,s);break}case"table":{e.series.bars.barWidth=.7,e.series.bars.align="center",this.addXTableAxis(e);break}default:{e.series.bars.barWidth=this.getMinTimeStepOfSeries(this.data)/1.5,this.addTimeAxis(e);break}}}callPlot(e,t){try{this.plot=c().plot(this.elem,this.sortedSeries,e),this.ctrl.renderError&&delete this.ctrl.error}catch(s){console.error("flotcharts error",s),this.ctrl.error=s instanceof Error?s.message:"Render Error",this.ctrl.renderError=!0}t&&this.ctrl.renderingCompleted()}buildFlotOptions(e){let t="#c8c8c8";B.ZP.bootData.user.lightTheme===!0&&(t="#a1a1a1");const s=e.stack?!0:null;return{hooks:{draw:[this.drawHook.bind(this)],processOffset:[this.processOffsetHook.bind(this)],processRange:[this.processRangeHook.bind(this)]},legend:{show:!1},series:{stackpercent:e.stack?e.percentage:!1,stack:e.percentage?null:s,lines:{show:e.lines,zero:!1,fill:this.translateFillOption(e.fill),fillColor:this.getFillGradient(e.fillGradient),lineWidth:e.dashes?0:e.linewidth,steps:e.steppedLine},dashes:{show:e.dashes,lineWidth:e.linewidth,dashLength:[e.dashLength,e.spaceLength]},bars:{show:e.bars,fill:1,barWidth:1,zero:!1,lineWidth:0},points:{show:e.points,fill:1,fillColor:!1,radius:e.points?e.pointradius:2},shadowSize:0},yaxes:[],xaxis:{},grid:{minBorderMargin:0,markings:[],backgroundColor:null,borderWidth:0,hoverable:!0,clickable:!0,color:t,margin:{left:0,right:0},labelMarginX:0,mouseActiveRadius:30},selection:{mode:"x",color:"#666"},crosshair:{mode:"x"}}}sortSeries(e,t){const s=t.legend.sort,i=t.legend.sortDesc,o=s!=null&&t.legend[s],a=i!=null,l=t.stack&&o&&a&&t.legend.alignAsTable,r=t.legend.sortDesc===!0?-1:1;return l?(0,p.sortBy)(e,d=>d.stats[s]*r):(0,p.sortBy)(e,d=>d.zindex)}getFillGradient(e){return e?{colors:[{opacity:0},{opacity:e/10}]}:null}translateFillOption(e){return this.panel.percentage&&this.panel.stack&&e===0?.001:e/10}addTimeAxis(e){const t=this.panelWidth/100,s=(0,p.isUndefined)(this.ctrl.range.from)?null:this.ctrl.range.from.valueOf(),i=(0,p.isUndefined)(this.ctrl.range.to)?null:this.ctrl.range.to.valueOf();e.xaxis={timezone:this.dashboard.getTimezone(),show:this.panel.xaxis.show,mode:"time",min:s,max:i,label:"Datetime",ticks:t,timeformat:(0,xe.mc)(t,s,i),tickFormatter:xe.sV}}addXSeriesAxis(e){const t=(0,p.map)(this.data,(s,i)=>[i+1,s.alias]);e.xaxis={timezone:this.dashboard.getTimezone(),show:this.panel.xaxis.show,mode:null,min:0,max:t.length+1,label:"Datetime",ticks:t}}addXHistogramAxis(e,t){let s,i,o;const a=this.panelWidth/50;if(this.data.length&&t){const l=[];for(const u of this.data)for(const m of u.data)l[m[0]]=!0;s=Object.keys(l).map(u=>Number(u)),i=(0,p.min)(s),o=(0,p.max)(s);let r=t,d=Math.floor((o-i)/r);for(;d>a;)r=r*2,d=Math.ceil((o-i)/r);i=Math.floor(i/r)*r,o=Math.ceil(o*1.01/r)*r,s=[];for(let u=i;u<=o;u+=r)s.push(u)}else s=a/2,i=0,o=1;e.xaxis={timezone:this.dashboard.getTimezone(),show:this.panel.xaxis.show,mode:null,min:i,max:o,label:"Histogram",ticks:s},this.configureAxisMode(e.xaxis,"short",null)}addXTableAxis(e){let t=(0,p.map)(this.data,(s,i)=>(0,p.map)(s.datapoints,(o,a)=>[i*s.datapoints.length+a+1,o[1]]));t=(0,p.flatten)(t,!0),e.xaxis={timezone:this.dashboard.getTimezone(),show:this.panel.xaxis.show,mode:null,min:0,max:t.length+1,label:"Datetime",ticks:t}}configureYAxisOptions(e,t){const s={position:"left",show:this.panel.yaxes[0].show,index:1,logBase:this.panel.yaxes[0].logBase||1,min:this.parseNumber(this.panel.yaxes[0].min),max:this.parseNumber(this.panel.yaxes[0].max),tickDecimals:this.panel.yaxes[0].decimals};if(t.yaxes.push(s),(0,p.find)(e,{yaxis:2})){const i=(0,p.clone)(s);i.index=2,i.show=this.panel.yaxes[1].show,i.logBase=this.panel.yaxes[1].logBase||1,i.position="right",i.min=this.parseNumber(this.panel.yaxes[1].min),i.max=this.parseNumber(this.panel.yaxes[1].max),i.tickDecimals=this.panel.yaxes[1].decimals,t.yaxes.push(i),this.applyLogScale(t.yaxes[1],e),this.configureAxisMode(t.yaxes[1],this.panel.percentage&&this.panel.stack?"percent":this.panel.yaxes[1].format,this.panel.yaxes[1].decimals)}this.applyLogScale(t.yaxes[0],e),this.configureAxisMode(t.yaxes[0],this.panel.percentage&&this.panel.stack?"percent":this.panel.yaxes[0].format,this.panel.yaxes[0].decimals)}parseNumber(e){return e===null||typeof e>"u"?null:(0,p.toNumber)(e)}applyLogScale(e,t){if(e.logBase===1)return;const s=e.min===0;e.min<Number.MIN_VALUE&&(e.min=null),e.max<Number.MIN_VALUE&&(e.max=null);let i,o,a=e.max,l=e.min;for(o=0;o<t.length;o++)i=t[o],i.yaxis===e.index&&((!a||a<i.stats.max)&&(a=i.stats.max),(!l||l>i.stats.logmin)&&(l=i.stats.logmin));e.transform=r=>r<Number.MIN_VALUE?null:Math.log(r)/Math.log(e.logBase),e.inverseTransform=r=>Math.pow(e.logBase,r),!a&&!l?(a=e.inverseTransform(2),l=e.inverseTransform(-2)):a?l||(l=a*e.inverseTransform(-4)):a=l*e.inverseTransform(4),e.min?l=e.inverseTransform(Math.ceil(e.transform(e.min))):l=e.min=e.inverseTransform(Math.floor(e.transform(l))),e.max?a=e.inverseTransform(Math.floor(e.transform(e.max))):a=e.max=e.inverseTransform(Math.ceil(e.transform(a))),!(!l||l<Number.MIN_VALUE||!a||a<Number.MIN_VALUE)&&(Number.isFinite(l)&&Number.isFinite(a)?(s&&(e.min=.1,l=1),e.ticks=this.generateTicksForLogScaleYAxis(l,a,e.logBase),s&&e.ticks.unshift(.1),e.ticks[e.ticks.length-1]>e.max&&(e.max=e.ticks[e.ticks.length-1])):(e.ticks=[1,2],delete e.min,delete e.max))}generateTicksForLogScaleYAxis(e,t,s){let i=[],o;for(o=e;o<=t;o*=s)i.push(o);const a=Math.ceil(this.ctrl.height/25),l=i.length;if(l>a){const r=Math.ceil(l/a)*s;for(i=[],o=e;o<=t*r;o*=r)i.push(o)}return i}configureAxisMode(e,t,s){e.tickFormatter=(i,o)=>{const a=(0,ve.Cf)(t);if(!a)throw new Error(`Unit '${t}' is not supported`);return(0,ve.zc)(a(i,s))}}}q.hF.directive("grafanaGraph",["timeSrv","popoverSrv","contextSrv",At]);function At(n,e,t){return{restrict:"A",template:"",link:(s,i)=>new Lt(s,i,n)}}q.ZP.controller("SeriesOverridesCtrl",["$scope","$element","popoverSrv",Pt]);function Pt(n,e,t){n.overrideMenu=[],n.currentOverrides=[],n.override=n.override||{},n.colorPickerModel={},n.addOverrideOption=(s,i,o)=>{const a={text:s,propertyName:i,index:n.overrideMenu.length,values:o,submenu:(0,p.map)(o,l=>({text:String(l),value:l}))};n.overrideMenu.push(a)},n.setOverride=(s,i)=>{if(s.propertyName==="color"){n.openColorSelector(n.override.color);return}n.override[s.propertyName]=i.value,s.propertyName==="fillBelowTo"&&(n.override.lines=!1,n.ctrl.addSeriesOverride({alias:i.value,lines:!1})),n.updateCurrentOverrides(),n.ctrl.render()},n.colorSelected=s=>{n.override.color=s,n.updateCurrentOverrides(),n.ctrl.render(),n.colorPickerModel.series.color=s},n.openColorSelector=s=>{n.colorPickerModel={autoClose:!0,colorSelected:n.colorSelected,series:{color:s}},t.show({element:e.find(".dropdown")[0],position:"top center",openOn:"click",template:'<series-color-picker-popover color="series.color" onColorChange="colorSelected" />',classNames:"drop-popover drop-popover--transparent",model:n.colorPickerModel,onClose:()=>{n.ctrl.render()}})},n.removeOverride=s=>{delete n.override[s.propertyName],n.updateCurrentOverrides(),n.ctrl.refresh()},n.getSeriesNames=()=>(0,p.map)(n.ctrl.seriesList,s=>ee.QX.escapeHtml(s.alias)),n.updateCurrentOverrides=()=>{n.currentOverrides=[],(0,p.each)(n.overrideMenu,s=>{const i=n.override[s.propertyName];(0,p.isUndefined)(i)||n.currentOverrides.push({name:s.text,propertyName:s.propertyName,value:String(i)})})},n.addOverrideOption("Bars","bars",[!0,!1]),n.addOverrideOption("Lines","lines",[!0,!1]),n.addOverrideOption("Line fill","fill",[0,1,2,3,4,5,6,7,8,9,10]),n.addOverrideOption("Fill gradient","fillGradient",[0,1,2,3,4,5,6,7,8,9,10]),n.addOverrideOption("Line width","linewidth",[0,1,2,3,4,5,6,7,8,9,10]),n.addOverrideOption("Null point mode","nullPointMode",["connected","null","null as zero"]),n.addOverrideOption("Fill below to","fillBelowTo",n.getSeriesNames()),n.addOverrideOption("Staircase line","steppedLine",[!0,!1]),n.addOverrideOption("Dashes","dashes",[!0,!1]),n.addOverrideOption("Hidden Series","hiddenSeries",[!0,!1]),n.addOverrideOption("Dash Length","dashLength",[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]),n.addOverrideOption("Dash Space","spaceLength",[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]),n.addOverrideOption("Points","points",[!0,!1]),n.addOverrideOption("Points Radius","pointradius",[1,2,3,4,5]),n.addOverrideOption("Stack","stack",[!0,!1,"A","B","C","D"]),n.addOverrideOption("Color","color",["change"]),n.addOverrideOption("Y-axis","yaxis",[1,2]),n.addOverrideOption("Z-index","zindex",[-3,-2,-1,0,1,2,3]),n.addOverrideOption("Transform","transform",["constant","negative-Y"]),n.addOverrideOption("Legend","legend",[!0,!1]),n.addOverrideOption("Hide in tooltip","hideTooltip",[!0,!1]),n.updateCurrentOverrides()}class Ie{constructor(e){this.$scope=e,this.disabled=!1}$onInit(){this.panel=this.panelCtrl.panel,this.panel.alert&&!B.ZP.unifiedAlertingEnabled&&(this.disabled=!0);const e=this.$scope.$on("$destroy",()=>{this.panelCtrl.editingThresholds=!1,this.panelCtrl.render(),e()});this.panelCtrl.editingThresholds=!0}addThreshold(){this.panel.thresholds.push({value:void 0,colorMode:"critical",op:"gt",fill:!0,line:!0,yaxis:"left"}),this.panelCtrl.render()}removeThreshold(e){this.panel.thresholds.splice(e,1),this.panelCtrl.render()}render(){this.panelCtrl.render()}onFillColorChange(e){return t=>{this.panel.thresholds[e].fillColor=t,this.render()}}onLineColorChange(e){return t=>{this.panel.thresholds[e].lineColor=t,this.render()}}onThresholdTypeChange(e){this.panel.thresholds[e].colorMode==="custom"&&(this.panel.thresholds[e].fillColor=(0,me.Z)(B.ZP.theme2.v1.palette.blue85).setAlpha(.2).toRgbString(),this.panel.thresholds[e].lineColor=(0,me.Z)(B.ZP.theme2.v1.palette.blue77).setAlpha(.6).toRgbString()),this.panelCtrl.render()}}Ie.$inject=["$scope"],q.ZP.directive("graphThresholdForm",()=>({restrict:"E",templateUrl:"public/app/plugins/panel/graph/thresholds_form.html",controller:Ie,bindToController:!0,controllerAs:"ctrl",scope:{panelCtrl:"="}}));class we{constructor(e){this.$scope=e,this.disabled=!1}$onInit(){this.panel=this.panelCtrl.panel;const e=this.$scope.$on("$destroy",()=>{this.panelCtrl.editingTimeRegions=!1,this.panelCtrl.render(),e()});this.colorModes=Et(),this.panelCtrl.editingTimeRegions=!0}render(){this.panelCtrl.render()}addTimeRegion(){this.panel.timeRegions.push({op:"time",fromDayOfWeek:void 0,from:void 0,toDayOfWeek:void 0,to:void 0,colorMode:"background6",fill:!0,line:!1,fillColor:"rgba(234, 112, 112, 0.12)",lineColor:"rgba(237, 46, 24, 0.60)"}),this.panelCtrl.render()}removeTimeRegion(e){this.panel.timeRegions.splice(e,1),this.panelCtrl.render()}onFillColorChange(e){return t=>{this.panel.timeRegions[e].fillColor=t,this.render()}}onLineColorChange(e){return t=>{this.panel.timeRegions[e].lineColor=t,this.render()}}}we.$inject=["$scope"],q.ZP.directive("graphTimeRegionForm",()=>({restrict:"E",templateUrl:"public/app/plugins/panel/graph/time_regions_form.html",controller:we,bindToController:!0,controllerAs:"ctrl",scope:{panelCtrl:"="}}));var ke=h(67162);q.ZP.directive("annotationTooltip",["$sanitize","dashboardSrv","$compile",It]);function It(n,e,t){function s(i){try{return n(i)}catch{return console.log("Could not sanitize annotation string, html escaping instead"),(0,p.escape)(i)}}return{restrict:"E",scope:{event:"=",onEdit:"&"},link:(i,o)=>{const a=i.event;let l=a.title,r=a.text;const d=e.getCurrent();let u='<div class="graph-annotation">',m="";if(a.alertId!==void 0&&a.newState){const T=ke.Z.getStateDisplayModel(a.newState);m=T.stateClass,l=`<i class="${T.iconClass}"></i> ${T.text}`,r=ke.Z.getAlertAnnotationInfo(a),a.text&&(r=r+"<br />"+a.text)}else l&&(r=l+"<br />"+((0,p.isString)(r)?r:""),l="");let g='<div class="graph-annotation__header">';a.login&&a.avatarUrl&&(g+=`<div class="graph-annotation__user" bs-tooltip="'Created by ${a.login}'"><img src="${a.avatarUrl}" /></div>`),g+=`
          <span class="graph-annotation__title ${m}">${s(l)}</span>
          <span class="graph-annotation__time">${d?.formatDate(a.min)}</span>
      `,a.id&&d?.canEditAnnotations(a.dashboardId)&&(g+=`
          <span class="pointer graph-annotation__edit-icon" ng-click="onEdit()">
            <i class="fa fa-pencil-square"></i>
          </span>
        `),g+="</div>",u+=g,u+='<div class="graph-annotation__body">',r&&(u+="<div ng-non-bindable>"+s(r.replace(/\n/g,"<br>"))+"</div>");const v=a.tags;v&&v.length&&(i.tags=v,u+='<span class="label label-tag small" ng-repeat="tag in tags" tag-color-from-name="tag">{{tag}}</span><br/>'),u+="</div>",u+="</div>",c()(u).appendTo(o),t(o.contents())(i)}}}var wt=h(82002),fe=h(70659),We=h(87865);class kt{constructor(){}$onInit(){this.event.panelId=this.panelCtrl.panel.id,this.event.dashboardUID=this.panelCtrl.dashboard.uid,this.event.time=Re(this.event.time),this.event.isRegion&&(this.event.timeEnd=Re(this.event.timeEnd)),this.timeFormated=this.panelCtrl.dashboard.formatDate(this.event.time)}canDelete(){return wt.Vt.accessControlEnabled()?this.event.source.type==="dashboard"?!!this.panelCtrl.dashboard.meta.annotationsPermissions?.dashboard.canDelete:!!this.panelCtrl.dashboard.meta.annotationsPermissions?.organization.canDelete:!0}async save(){if(!this.form.$valid)return;const e=(0,p.cloneDeep)(this.event);if(e.time=e.time.valueOf(),e.timeEnd=0,e.isRegion&&(e.timeEnd=this.event.timeEnd.valueOf(),e.timeEnd<e.time)){console.log("invalid time");return}let t=fe.xD;e.id&&(t=fe._E);try{await t(e)}catch(s){console.log(s)}finally{this.close(),(0,We.kt)().run({dashboard:this.panelCtrl.dashboard,range:this.panelCtrl.range})}}async delete(){try{await(0,fe.Dl)(this.event)}catch(e){console.log(e)}finally{this.close(),(0,We.kt)().run({dashboard:this.panelCtrl.dashboard,range:this.panelCtrl.range})}}}function Re(n){if(n&&(0,p.isNumber)(n)){const e=Number(n);return(0,X.CQ)(e)}else return n}function Wt(){return{restrict:"E",controller:kt,bindToController:!0,controllerAs:"ctrl",templateUrl:"public/app/features/annotations/partials/event_editor.html",scope:{panelCtrl:"=",event:"=",close:"&"}}}q.hF.directive("eventEditor",Wt);var Rt=h(48513),Z=h(68061),Ft=h(37932),Nt=h(69234),Bt=h(64805),Vt=h(32294),Ut=h(3153),zt=h(57277),_t=h(55197),Kt=h(45984);class Ht{constructor(e){this.scrollContextElement=null,this.position={x:0,y:0},this.onClose=()=>{this.scrollContextElement&&this.scrollContextElement.removeEventListener("scroll",this.onClose),this.scope.$apply(()=>{this.isVisible=!1})},this.toggleMenu=t=>{this.isVisible=!this.isVisible,this.isVisible&&this.scrollContextElement&&this.scrollContextElement.addEventListener("scroll",this.onClose),this.source?this.position={x:this.source.pageX,y:this.source.pageY}:this.position={x:t?t.pageX:0,y:t?t.pageY:0}},this.setScrollContextElement=t=>{this.scrollContextElement=t},this.setSource=t=>{this.source=t},this.getSource=()=>this.source,this.setMenuItemsSupplier=t=>{this.menuItemsSupplier=t},this.isVisible=!1,this.scope=e}}const Gt=n=>{const e=n.fieldConfig??{defaults:{},overrides:[]},t=n.options||{};return t.dataLinks&&(e.defaults.links=t.dataLinks,delete t.dataLinks),n.options=t,n.fieldConfig=e,t};class Fe{constructor(e){this.$scope=e,this.panelCtrl=e.ctrl,this.panel=this.panelCtrl.panel,this.$scope.ctrl=this,this.logScales={linear:1,"log (base 2)":2,"log (base 10)":10,"log (base 32)":32,"log (base 1024)":1024},this.xAxisModes={Time:"time",Series:"series",Histogram:"histogram"},this.xAxisStatOptions=[{text:"Avg",value:"avg"},{text:"Min",value:"min"},{text:"Max",value:"max"},{text:"Total",value:"total"},{text:"Count",value:"count"},{text:"Current",value:"current"}],this.panel.xaxis.mode==="custom"&&(this.panel.xaxis.name||(this.panel.xaxis.name="specify field")),this.selectors=Ce.wl.components.Panels.Visualization.Graph.VisualizationTab}setUnitFormat(e){return t=>{e.format=t,this.panel.fieldConfig.defaults.unit?(this.panel.fieldConfig.defaults.unit=void 0,this.panelCtrl.refresh()):this.panelCtrl.render()}}render(){this.panelCtrl.render()}xAxisModeChanged(){this.panelCtrl.processor.setPanelDefaultsForNewXAxisMode(),this.panelCtrl.onDataFramesReceived(this.panelCtrl.dataList)}xAxisValueChanged(){this.panelCtrl.onDataFramesReceived(this.panelCtrl.dataList)}}Fe.$inject=["$scope"];function $t(){"use strict";return{restrict:"E",scope:!0,templateUrl:"public/app/plugins/panel/graph/axes_editor.html",controller:Fe}}var Xt=h(89890),jt=h(45778),Zt=h(4050);class Yt{constructor(e){this.panel=e}getSeriesList(e){const t=[],{dataList:s,range:i}=e;if(!s||!s.length)return t;for(let o=0;o<s.length;o++){let a=s[o],{timeField:l}=(0,de.sV)(a);if(l){a=(0,jt.w)({frame:a,refFieldName:l.name}),l=(0,de.sV)(a).timeField;for(let r=0;r<a.fields.length;r++){const d=a.fields[r];if(d.type!==he.fS.number)continue;const u=(0,Xt.C)(d,a,s),m=[];for(let g=0;g<a.length;g++)m.push([d.values.get(g),(0,X.CQ)(l.values.get(g)).valueOf()]);t.push(this.toTimeSeries(d,u,o,r,m,t.length,i))}}}if(this.panel.xaxis.mode==="histogram"&&!this.panel.stack&&t.length>1){const o=t[0];o.alias=o.aliasEscaped="Count";for(let a=1;a<t.length;a++)o.datapoints=o.datapoints.concat(t[a].datapoints);return[o]}return t}toTimeSeries(e,t,s,i,o,a,l){const r=a%G.O9.length,d=this.panel.aliasColors[t]||G.O9[r],u=new Zt.Z({datapoints:o||[],alias:t,color:B.ZP.theme2.visualization.getColorByName(d),unit:e.config?e.config.unit:void 0,dataFrameIndex:s,fieldIndex:i});if(o&&o.length>0&&l){const m=o[o.length-1][1],g=l.from;m-g.valueOf()<-1e4&&o[0][1]-g.valueOf()<-1e4&&(u.isOutsideRange=!0)}return u}setPanelDefaultsForNewXAxisMode(){switch(this.panel.xaxis.mode){case"time":{this.panel.bars=!1,this.panel.lines=!0,this.panel.points=!1,this.panel.legend.show=!0,this.panel.tooltip.shared=!0,this.panel.xaxis.values=[];break}case"series":{this.panel.bars=!0,this.panel.lines=!1,this.panel.points=!1,this.panel.stack=!1,this.panel.legend.show=!1,this.panel.tooltip.shared=!1,this.panel.xaxis.values=["total"];break}case"histogram":{this.panel.bars=!0,this.panel.lines=!1,this.panel.points=!1,this.panel.stack=!1,this.panel.legend.show=!1,this.panel.tooltip.shared=!1;break}}}validateXAxisSeriesValue(){switch(this.panel.xaxis.mode){case"series":{if(this.panel.xaxis.values.length===0){this.panel.xaxis.values=["total"];return}const e=this.getXAxisValueOptions({});(0,p.find)(e,{value:this.panel.xaxis.values[0]})||(this.panel.xaxis.values=["total"]);return}}}getXAxisValueOptions(e){switch(this.panel.xaxis.mode){case"series":return[{text:"Avg",value:"avg"},{text:"Min",value:"min"},{text:"Max",value:"max"},{text:"Total",value:"total"},{text:"Count",value:"count"}]}return[]}pluckDeep(e,t){const s=t.split(".");let i=e;for(let o=0;o<s.length;++o)if(i[s[o]])i=i[s[o]];else return;return i}}const Qt=`
<div class="graph-panel" ng-class="{'graph-panel--legend-right': ctrl.panel.legend.rightSide}">
  <div class="graph-panel__chart" grafana-graph ng-dblclick="ctrl.zoomOut()">
  </div>

  <div class="graph-legend">
    <div class="graph-legend-content" graph-legend></div>
  </div>
  <div ng-if="ctrl.contextMenuCtrl.isVisible">
    <graph-context-menu
      itemsGroup="ctrl.contextMenuCtrl.menuItemsSupplier()"
      on-close="ctrl.onContextMenuClose"
      getContextMenuSource="ctrl.contextMenuCtrl.getSource"
      timeZone="ctrl.getTimeZone()"
      x="ctrl.contextMenuCtrl.position.x"
      y="ctrl.contextMenuCtrl.position.y"
    ></graph-context-menu>
  </div>
</div>
`;class ae extends Nt.k{constructor(e,t){super(e,t),this.renderError=!1,this.hiddenSeries={},this.hiddenSeriesTainted=!1,this.seriesList=[],this.dataList=[],this.annotations=[],this.colors=[],this.subTabIndex=0,this.panelDefaults={datasource:null,renderer:"flot",yaxes:[{label:null,show:!0,logBase:1,min:null,max:null,format:"short"},{label:null,show:!0,logBase:1,min:null,max:null,format:"short"}],xaxis:{show:!0,mode:"time",name:null,values:[],buckets:null},yaxis:{align:!1,alignLevel:null},lines:!0,fill:1,fillGradient:0,linewidth:1,dashes:!1,hiddenSeries:!1,dashLength:10,spaceLength:10,points:!1,pointradius:2,bars:!1,stack:!1,percentage:!1,legend:{show:!0,values:!1,min:!1,max:!1,current:!1,total:!1,avg:!1},nullPointMode:"null",steppedLine:!1,tooltip:{value_type:"individual",shared:!0,sort:0},timeFrom:null,timeShift:null,targets:[{}],aliasColors:{},seriesOverrides:[],thresholds:[],timeRegions:[],options:{alertThreshold:!0}},this.onColorChange=(i,o)=>{i.setColor(B.ZP.theme2.visualization.getColorByName(o)),this.panel.aliasColors[i.alias]=o,this.render()},this.onToggleSeries=i=>{this.hiddenSeriesTainted=!0,this.hiddenSeries=i,this.render()},this.onToggleSort=(i,o)=>{this.panel.legend.sort=i,this.panel.legend.sortDesc=o,this.render()},this.onToggleAxis=i=>{let o=(0,p.find)(this.panel.seriesOverrides,{alias:i.alias});o||(o={alias:i.alias},this.panel.seriesOverrides.push(o)),o.yaxis=i.yaxis,this.render()},this.onContextMenuClose=()=>{this.contextMenuCtrl.toggleMenu()},this.getTimeZone=()=>this.dashboard.getTimezone(),this.getDataFrameByRefId=i=>this.dataList.filter(o=>o.refId===i)[0],(0,p.defaults)(this.panel,this.panelDefaults),(0,p.defaults)(this.panel.tooltip,this.panelDefaults.tooltip),(0,p.defaults)(this.panel.legend,this.panelDefaults.legend),(0,p.defaults)(this.panel.xaxis,this.panelDefaults.xaxis),(0,p.defaults)(this.panel.options,this.panelDefaults.options),this.useDataFrames=!0,this.processor=new Yt(this.panel),this.contextMenuCtrl=new Ht(e),this.events.on(z.Kh.render,this.onRender.bind(this)),this.events.on(z.Kh.dataFramesReceived,this.onDataFramesReceived.bind(this)),this.events.on(z.Kh.dataSnapshotLoad,this.onDataSnapshotLoad.bind(this)),this.events.on(z.Kh.editModeInitialized,this.onInitEditMode.bind(this)),this.events.on(z.Kh.initPanelActions,this.onInitPanelActions.bind(this));const s=this.panel.fieldConfig.defaults.unit;s&&(this.panel.yaxes[0].format=s)}onInitEditMode(){this.addEditorTab("Display","public/app/plugins/panel/graph/tab_display.html"),this.addEditorTab("Series overrides","public/app/plugins/panel/graph/tab_series_overrides.html"),this.addEditorTab("Axes",$t),this.addEditorTab("Legend","public/app/plugins/panel/graph/tab_legend.html"),this.addEditorTab("Thresholds","public/app/plugins/panel/graph/tab_thresholds.html"),this.addEditorTab("Time regions","public/app/plugins/panel/graph/tab_time_regions.html"),this.subTabIndex=0,this.hiddenSeriesTainted=!1}onInitPanelActions(e){e.push({text:"Toggle legend",click:"ctrl.toggleLegend()",shortcut:"p l"})}zoomOut(e){ce.h$.publish(new Kt.p8({scale:2}))}onDataSnapshotLoad(e){const{series:t,annotations:s}=(0,zt.y)(this.panel,this.dashboard);this.panelData.annotations=s,this.onDataFramesReceived(t)}onDataFramesReceived(e){this.dataList=e,this.seriesList=this.processor.getSeriesList({dataList:this.dataList,range:this.range}),this.dataWarning=this.getDataWarning(),this.alertState=void 0,this.seriesList.alertState=void 0,this.panelData.alertState&&(this.alertState=this.panelData.alertState,this.seriesList.alertState=this.alertState.state),this.annotations=[],this.panelData.annotations?.length&&(this.annotations=(0,_t.em)(this.panelData.annotations)),this.loading=!1,this.render(this.seriesList)}getDataWarning(){if(this.seriesList.reduce((i,o)=>i+o.datapoints.length,0)===0){if(this.dataList){for(const i of this.dataList)if(i.length&&i.fields?.length)return{title:"Unable to graph data",tip:"Data exists, but is not timeseries",actionText:"Switch to table view",action:()=>{(0,Ut.WI)((0,Vt.Kc)({panel:this.panel,pluginId:"table"}))}}}return{title:"No data",tip:"No data returned from query"}}for(const i of this.seriesList)if(!i.isOutsideRange)return;const t={title:"Data outside time range",tip:"Can be caused by timezone mismatch or missing time filter in query"},s=Ot(this.dataList);return s&&(t.actionText="Zoom to data",t.action=()=>{Ft.E1.partial({from:s.from,to:s.to})}),t}onRender(){if(this.seriesList){Bt.X.alertToGraphThresholds(this.panel);for(const e of this.seriesList)e.applySeriesOverrides(this.panel.seriesOverrides),e.unit&&(this.panel.yaxes[e.yaxis-1].format=e.unit),this.hiddenSeriesTainted===!1&&e.hiddenSeries===!0&&(this.hiddenSeries[e.alias]=!0)}}addSeriesOverride(e){this.panel.seriesOverrides.push(e||{})}removeSeriesOverride(e){this.panel.seriesOverrides=(0,p.without)(this.panel.seriesOverrides,e),this.render()}toggleLegend(){this.panel.legend.show=!this.panel.legend.show,this.render()}legendValuesOptionChanged(){const e=this.panel.legend;e.values=e.min||e.max||e.avg||e.current||e.total,this.render()}migrateToReact(){this.onPluginTypeChange(B.ZP.panels.timeseries)}}ae.template=Qt,ae.$inject=["$scope","$injector"];const Ne=new Rt.c(null).useFieldConfig({disableStandardOptions:[Z.qb.NoValue,Z.qb.Thresholds,Z.qb.Max,Z.qb.Min,Z.qb.Decimals,Z.qb.Color,Z.qb.Mappings]}).setDataSupport({annotations:!0,alertStates:!0}).setMigrationHandler(Gt);Ne.angularPanelCtrl=ae}}]);

//# sourceMappingURL=graphPlugin.b472c469c99d1c59b039.js.map