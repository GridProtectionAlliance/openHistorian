"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9782],{68793:(e,t,i)=>{i.d(t,{N:()=>a});var s=i(43215),o=i(3490);const r="hideSeriesFrom",n=(0,s.isSystemOverrideWithRef)(r);function a(e,t,i,s){const{overrides:r}=i,a=e,g=r.findIndex(n);if(g<0){if(t===o.SeriesVisibilityChangeMode.ToggleSelection){const e=l([a,...u(r,s)]);return Object.assign({},i,{overrides:[...i.overrides,e]})}const e=l(p(s,a));return Object.assign({},i,{overrides:[...i.overrides,e]})}const m=Array.from(r),[f]=m.splice(g,1);if(t===o.SeriesVisibilityChangeMode.ToggleSelection){let e=d(f);const t=u(m,s);if(t.length>0&&(e=e.filter((e=>t.indexOf(e)<0))),e[0]===a&&1===e.length)return Object.assign({},i,{overrides:m});const o=l([a,...t]);return Object.assign({},i,{overrides:[...m,o]})}const y=c(f,a);return h(y,s)?Object.assign({},i,{overrides:m}):Object.assign({},i,{overrides:[...m,y]})}function l(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.ByNamesMatcherMode.exclude,o=arguments.length>2?arguments[2]:void 0;return o=null!==(t=o)&&void 0!==t?t:{id:"custom.hideFrom",value:{viz:!0,legend:!1,tooltip:!1}},{__systemRef:r,matcher:{id:s.FieldMatcherID.byNames,options:{mode:i,names:e,prefix:i===s.ByNamesMatcherMode.exclude?"All except:":void 0,readOnly:!0}},properties:[Object.assign({},o,{value:{viz:!0,legend:!1,tooltip:!1}})]}}const c=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.ByNamesMatcherMode.exclude;const o=e.properties.find((e=>"custom.hideFrom"===e.id)),r=d(e),n=r.findIndex((e=>e===t));return n<0?r.push(t):r.splice(n,1),l(r,i,o)},d=e=>{var t;const i=null===(t=e.matcher.options)||void 0===t?void 0:t.names;return Array.isArray(i)?[...i]:[]},h=(e,t)=>d(e).length===p(t).length,p=(e,t)=>{const i=new Set;for(const o of e)for(const r of o.fields){if(r.type!==s.FieldType.number)continue;const n=(0,s.getFieldDisplayName)(r,o,e);n!==t&&i.add(n)}return Array.from(i)},u=(e,t)=>{let i=[];for(const r of e){var o;const e=r.properties.find((e=>"custom.hideFrom"===e.id));if(void 0!==e&&!0===(null===(o=e.value)||void 0===o?void 0:o.legend)){const e=s.fieldMatchers.get(r.matcher.id).get(r.matcher.options);for(const o of t)for(const r of o.fields){if(r.type!==s.FieldType.number)continue;const n=(0,s.getFieldDisplayName)(r,o,t);e(r,o,t)&&i.push(n)}}}return i}},1842:(e,t,i)=>{i.r(t),i.d(t,{default:()=>hs});var s=i(36636),o=i(68404),r=i(18745),n=i(90923),a=i(3490),l=i(24994),c=i(70064),d=i(8674),h=i(55560),p=i(72629),u=i(70229),g=i(16479);const m=e=>{let{exploreIdLeft:t,exploreIdRight:i}=e;const[s,n]=(0,o.useState)([]),{query:a}=(0,h.useKBar)(),l=(0,r.useDispatch)(),c=(0,r.useSelector)(g.p);return(0,o.useEffect)((()=>{const e={name:"Explore",priority:h.Priority.HIGH+1},s=[];c?(s.push({id:"explore/run-query-left",name:"Run query (left)",keywords:"query left",perform:()=>{l((0,u.aA)(t))},section:e}),i&&(s.push({id:"explore/run-query-right",name:"Run query (right)",keywords:"query right",perform:()=>{l((0,u.aA)(i))},section:e}),s.push({id:"explore/split-view-close-left",name:"Close split view left",keywords:"split",perform:()=>{l((0,p.YV)(t))},section:e}),s.push({id:"explore/split-view-close-right",name:"Close split view right",keywords:"split",perform:()=>{l((0,p.YV)(i))},section:e}))):(s.push({id:"explore/run-query",name:"Run query",keywords:"query",perform:()=>{l((0,u.aA)(t))},section:e}),s.push({id:"explore/split-view-open",name:"Open split view",keywords:"split",perform:()=>{l((0,p.bW)())},section:e})),n(s)}),[t,i,c,a,l]),(0,h.useRegisterActions)(a?s:[],[s,a]),null};var f=i(58635),y=i(43215),x=i(16695),v=i(17421),b=i(62236),w=i(78647),S=i(87723),R=i(31259),j=i(9239),C=i(5831),T=i(36314),I=i(30804),z=i(21169),F=i(82897),k=i(2675),O=i(97024),L=i(40325),D=i(68793),N=i(28953);var E=i(45916);function $(e){let{data:t,height:i,width:r,timeZone:l,absoluteRange:c,onChangeTime:d,loadingState:h,annotations:p,onHiddenSeriesChanged:u,splitOpenFn:g,graphStyle:m,tooltipDisplayMode:f=O.f3.Single}=e;const x=(0,a.useTheme2)(),[v,b]=(0,o.useState)(!1),[w,S]=(0,o.useState)(1),R=(0,k.Z)(t),j=(0,o.useRef)(0),T=w+j.current,I=(0,k.Z)(T),[z,$]=(0,o.useState)({defaults:{color:{mode:y.FieldColorModeId.PaletteClassic},custom:{drawStyle:O.l8.Line,fillOpacity:0,pointSize:5}},overrides:[]});t&&R&&!(0,y.compareArrayValues)(R,t,y.compareDataFrameStructures)&&(j.current++,I===T&&$(Object.assign({},z,{overrides:[]})));const P=(0,a.useStyles2)(H),A={from:(0,y.dateTime)(c.from),to:(0,y.dateTime)(c.to),raw:{from:(0,y.dateTime)(c.from),to:(0,y.dateTime)(c.to)}},B=(0,o.useMemo)((()=>{const e=(0,y.createFieldConfigRegistry)((0,L.F)(L.r),"Explore"),i=function(e,t){return(0,N.ZP)(e,(e=>{void 0===e.defaults.custom&&(e.defaults.custom={});const{custom:i}=e.defaults;switch(void 0===i.stacking&&(i.stacking={group:"A"}),t){case"lines":i.drawStyle=O.l8.Line,i.stacking.mode=O.o0.None,i.fillOpacity=0;break;case"bars":i.drawStyle=O.l8.Bars,i.stacking.mode=O.o0.None,i.fillOpacity=100;break;case"points":i.drawStyle=O.l8.Points,i.stacking.mode=O.o0.None,i.fillOpacity=0;break;case"stacked_lines":i.drawStyle=O.l8.Line,i.stacking.mode=O.o0.Normal,i.fillOpacity=100;break;case"stacked_bars":i.drawStyle=O.l8.Bars,i.stacking.mode=O.o0.Normal,i.fillOpacity=100;break;default:throw new Error(`Invalid graph-style: ${t}`)}}))}(z,m);return(0,y.applyFieldOverrides)({fieldConfig:i,data:t,timeZone:l,replaceVariables:e=>e,theme:x,fieldConfigRegistry:e})}),[z,m,t,l,x]);(0,o.useEffect)((()=>{if(u){const e=[];B.forEach((t=>{t.fields.map((e=>{var t,i,s;return null===(t=e.config)||void 0===t||null===(i=t.custom)||void 0===i||null===(s=i.hideFrom)||void 0===s?void 0:s.viz})).every(F.identity)&&e.push((0,y.getFrameDisplayName)(t))})),u(e)}}),[B,u]);const M=v?B:B.slice(0,20),q={eventBus:C.Z,onSplitOpen:g,onToggleSeriesVisibility(e,i){S((e=>e+1)),$((0,D.N)(e,i,z,t))}};return(0,E.jsxs)(a.PanelContextProvider,{value:q,children:[B.length>20&&!v&&(0,E.jsxs)("div",{className:(0,s.cx)([P.timeSeriesDisclaimer]),children:[(0,E.jsx)(a.Icon,{className:P.disclaimerIcon,name:"exclamation-triangle"}),"Showing only 20 time series. ",(0,E.jsx)("span",{className:(0,s.cx)([P.showAllTimeSeries]),onClick:()=>{j.current++,b(!0)},children:`Show all ${B.length}`})]}),(0,E.jsx)(n.PanelRenderer,{data:{series:M,timeRange:A,structureRev:T,state:h,annotations:p},pluginId:"timeseries",title:"",width:r,height:i,onChangeTimeRange:d,timeZone:l,options:{tooltip:{mode:f,sort:O.As.None},legend:{displayMode:O.jK.List,showLegend:!0,placement:"bottom",calcs:[]}}})]})}const H=e=>({timeSeriesDisclaimer:s.css`
    label: time-series-disclaimer;
    width: 300px;
    margin: ${e.spacing(1)} auto;
    padding: 10px 0;
    border-radius: ${e.spacing(2)};
    text-align: center;
    background-color: ${e.colors.background.primary};
  `,disclaimerIcon:s.css`
    label: disclaimer-icon;
    color: ${e.colors.warning.main};
    margin-right: ${e.spacing(.5)};
  `,showAllTimeSeries:s.css`
    label: show-all-time-series;
    cursor: pointer;
    color: ${e.colors.text.link};
  `});var P=i(47570);const A=P.f0.map((e=>({value:e,label:e[0].toUpperCase()+e.slice(1).replace(/_/," ")}))),B=(0,s.css)({display:"flex",justifyContent:"space-between"});function M(e){const{graphStyle:t,onChangeGraphStyle:i}=e;return(0,E.jsxs)("div",{className:B,children:["Graph",(0,E.jsx)(a.RadioButtonGroup,{size:"sm",options:A,value:t,onChange:i})]})}var q,W=i(87524),_=(q=function(e,t){return q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},q(e,t)},function(e,t){function i(){this.constructor=e}q(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Z=function(){return Z=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Z.apply(this,arguments)},Q={width:"100%",height:"10px",top:"0px",left:"0px",cursor:"row-resize"},V={width:"10px",height:"100%",top:"0px",left:"0px",cursor:"col-resize"},U={width:"20px",height:"20px",position:"absolute"},K={top:Z(Z({},Q),{top:"-5px"}),right:Z(Z({},V),{left:void 0,right:"-5px"}),bottom:Z(Z({},Q),{top:void 0,bottom:"-5px"}),left:Z(Z({},V),{left:"-5px"}),topRight:Z(Z({},U),{right:"-10px",top:"-10px",cursor:"ne-resize"}),bottomRight:Z(Z({},U),{right:"-10px",bottom:"-10px",cursor:"se-resize"}),bottomLeft:Z(Z({},U),{left:"-10px",bottom:"-10px",cursor:"sw-resize"}),topLeft:Z(Z({},U),{left:"-10px",top:"-10px",cursor:"nw-resize"})},G=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onMouseDown=function(e){t.props.onResizeStart(e,t.props.direction)},t.onTouchStart=function(e){t.props.onResizeStart(e,t.props.direction)},t}return _(t,e),t.prototype.render=function(){return o.createElement("div",{className:this.props.className||"",style:Z(Z({position:"absolute",userSelect:"none"},K[this.props.direction]),this.props.replaceStyles||{}),onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart},this.props.children)},t}(o.PureComponent),Y=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function s(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),X=function(){return X=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},X.apply(this,arguments)},J={width:"auto",height:"auto"},ee=function(e,t,i){return Math.max(Math.min(e,i),t)},te=function(e,t){return Math.round(e/t)*t},ie=function(e,t){return new RegExp(e,"i").test(t)},se=function(e){return Boolean(e.touches&&e.touches.length)},oe=function(e,t,i){void 0===i&&(i=0);var s=t.reduce((function(i,s,o){return Math.abs(s-e)<Math.abs(t[i]-e)?o:i}),0),o=Math.abs(t[s]-e);return 0===i||o<i?t[s]:e},re=function(e){return"auto"===(e=e.toString())||e.endsWith("px")||e.endsWith("%")||e.endsWith("vh")||e.endsWith("vw")||e.endsWith("vmax")||e.endsWith("vmin")?e:e+"px"},ne=function(e,t,i,s){if(e&&"string"==typeof e){if(e.endsWith("px"))return Number(e.replace("px",""));if(e.endsWith("%"))return t*(Number(e.replace("%",""))/100);if(e.endsWith("vw"))return i*(Number(e.replace("vw",""))/100);if(e.endsWith("vh"))return s*(Number(e.replace("vh",""))/100)}return e},ae=["as","style","className","grid","snap","bounds","boundsByDirection","size","defaultSize","minWidth","minHeight","maxWidth","maxHeight","lockAspectRatio","lockAspectRatioExtraWidth","lockAspectRatioExtraHeight","enable","handleStyles","handleClasses","handleWrapperStyle","handleWrapperClass","children","onResizeStart","onResize","onResizeStop","handleComponent","scale","resizeRatio","snapGap"],le="__resizable_base__",ce=function(e){function t(t){var i=e.call(this,t)||this;return i.ratio=1,i.resizable=null,i.parentLeft=0,i.parentTop=0,i.resizableLeft=0,i.resizableRight=0,i.resizableTop=0,i.resizableBottom=0,i.targetLeft=0,i.targetTop=0,i.appendBase=function(){if(!i.resizable||!i.window)return null;var e=i.parentNode;if(!e)return null;var t=i.window.document.createElement("div");return t.style.width="100%",t.style.height="100%",t.style.position="absolute",t.style.transform="scale(0, 0)",t.style.left="0",t.style.flex="0 0 100%",t.classList?t.classList.add(le):t.className+=le,e.appendChild(t),t},i.removeBase=function(e){var t=i.parentNode;t&&t.removeChild(e)},i.ref=function(e){e&&(i.resizable=e)},i.state={isResizing:!1,width:void 0===(i.propsSize&&i.propsSize.width)?"auto":i.propsSize&&i.propsSize.width,height:void 0===(i.propsSize&&i.propsSize.height)?"auto":i.propsSize&&i.propsSize.height,direction:"right",original:{x:0,y:0,width:0,height:0},backgroundStyle:{height:"100%",width:"100%",backgroundColor:"rgba(0,0,0,0)",cursor:"auto",opacity:0,position:"fixed",zIndex:9999,top:"0",left:"0",bottom:"0",right:"0"},flexBasis:void 0},i.onResizeStart=i.onResizeStart.bind(i),i.onMouseMove=i.onMouseMove.bind(i),i.onMouseUp=i.onMouseUp.bind(i),i}return Y(t,e),Object.defineProperty(t.prototype,"parentNode",{get:function(){return this.resizable?this.resizable.parentNode:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return this.resizable&&this.resizable.ownerDocument?this.resizable.ownerDocument.defaultView:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"propsSize",{get:function(){return this.props.size||this.props.defaultSize||J},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){var e=0,t=0;if(this.resizable&&this.window){var i=this.resizable.offsetWidth,s=this.resizable.offsetHeight,o=this.resizable.style.position;"relative"!==o&&(this.resizable.style.position="relative"),e="auto"!==this.resizable.style.width?this.resizable.offsetWidth:i,t="auto"!==this.resizable.style.height?this.resizable.offsetHeight:s,this.resizable.style.position=o}return{width:e,height:t}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sizeStyle",{get:function(){var e=this,t=this.props.size,i=function(t){if(void 0===e.state[t]||"auto"===e.state[t])return"auto";if(e.propsSize&&e.propsSize[t]&&e.propsSize[t].toString().endsWith("%")){if(e.state[t].toString().endsWith("%"))return e.state[t].toString();var i=e.getParentSize();return Number(e.state[t].toString().replace("px",""))/i[t]*100+"%"}return re(e.state[t])};return{width:t&&void 0!==t.width&&!this.state.isResizing?re(t.width):i("width"),height:t&&void 0!==t.height&&!this.state.isResizing?re(t.height):i("height")}},enumerable:!1,configurable:!0}),t.prototype.getParentSize=function(){if(!this.parentNode)return this.window?{width:this.window.innerWidth,height:this.window.innerHeight}:{width:0,height:0};var e=this.appendBase();if(!e)return{width:0,height:0};var t=!1,i=this.parentNode.style.flexWrap;"wrap"!==i&&(t=!0,this.parentNode.style.flexWrap="wrap"),e.style.position="relative",e.style.minWidth="100%",e.style.minHeight="100%";var s={width:e.offsetWidth,height:e.offsetHeight};return t&&(this.parentNode.style.flexWrap=i),this.removeBase(e),s},t.prototype.bindEvents=function(){this.window&&(this.window.addEventListener("mouseup",this.onMouseUp),this.window.addEventListener("mousemove",this.onMouseMove),this.window.addEventListener("mouseleave",this.onMouseUp),this.window.addEventListener("touchmove",this.onMouseMove,{capture:!0,passive:!1}),this.window.addEventListener("touchend",this.onMouseUp))},t.prototype.unbindEvents=function(){this.window&&(this.window.removeEventListener("mouseup",this.onMouseUp),this.window.removeEventListener("mousemove",this.onMouseMove),this.window.removeEventListener("mouseleave",this.onMouseUp),this.window.removeEventListener("touchmove",this.onMouseMove,!0),this.window.removeEventListener("touchend",this.onMouseUp))},t.prototype.componentDidMount=function(){if(this.resizable&&this.window){var e=this.window.getComputedStyle(this.resizable);this.setState({width:this.state.width||this.size.width,height:this.state.height||this.size.height,flexBasis:"auto"!==e.flexBasis?e.flexBasis:void 0})}},t.prototype.componentWillUnmount=function(){this.window&&this.unbindEvents()},t.prototype.createSizeForCssProperty=function(e,t){var i=this.propsSize&&this.propsSize[t];return"auto"!==this.state[t]||this.state.original[t]!==e||void 0!==i&&"auto"!==i?e:"auto"},t.prototype.calculateNewMaxFromBoundary=function(e,t){var i,s,o=this.props.boundsByDirection,r=this.state.direction,n=o&&ie("left",r),a=o&&ie("top",r);if("parent"===this.props.bounds){var l=this.parentNode;l&&(i=n?this.resizableRight-this.parentLeft:l.offsetWidth+(this.parentLeft-this.resizableLeft),s=a?this.resizableBottom-this.parentTop:l.offsetHeight+(this.parentTop-this.resizableTop))}else"window"===this.props.bounds?this.window&&(i=n?this.resizableRight:this.window.innerWidth-this.resizableLeft,s=a?this.resizableBottom:this.window.innerHeight-this.resizableTop):this.props.bounds&&(i=n?this.resizableRight-this.targetLeft:this.props.bounds.offsetWidth+(this.targetLeft-this.resizableLeft),s=a?this.resizableBottom-this.targetTop:this.props.bounds.offsetHeight+(this.targetTop-this.resizableTop));return i&&Number.isFinite(i)&&(e=e&&e<i?e:i),s&&Number.isFinite(s)&&(t=t&&t<s?t:s),{maxWidth:e,maxHeight:t}},t.prototype.calculateNewSizeFromDirection=function(e,t){var i=this.props.scale||1,s=this.props.resizeRatio||1,o=this.state,r=o.direction,n=o.original,a=this.props,l=a.lockAspectRatio,c=a.lockAspectRatioExtraHeight,d=a.lockAspectRatioExtraWidth,h=n.width,p=n.height,u=c||0,g=d||0;return ie("right",r)&&(h=n.width+(e-n.x)*s/i,l&&(p=(h-g)/this.ratio+u)),ie("left",r)&&(h=n.width-(e-n.x)*s/i,l&&(p=(h-g)/this.ratio+u)),ie("bottom",r)&&(p=n.height+(t-n.y)*s/i,l&&(h=(p-u)*this.ratio+g)),ie("top",r)&&(p=n.height-(t-n.y)*s/i,l&&(h=(p-u)*this.ratio+g)),{newWidth:h,newHeight:p}},t.prototype.calculateNewSizeFromAspectRatio=function(e,t,i,s){var o=this.props,r=o.lockAspectRatio,n=o.lockAspectRatioExtraHeight,a=o.lockAspectRatioExtraWidth,l=void 0===s.width?10:s.width,c=void 0===i.width||i.width<0?e:i.width,d=void 0===s.height?10:s.height,h=void 0===i.height||i.height<0?t:i.height,p=n||0,u=a||0;if(r){var g=(d-p)*this.ratio+u,m=(h-p)*this.ratio+u,f=(l-u)/this.ratio+p,y=(c-u)/this.ratio+p,x=Math.max(l,g),v=Math.min(c,m),b=Math.max(d,f),w=Math.min(h,y);e=ee(e,x,v),t=ee(t,b,w)}else e=ee(e,l,c),t=ee(t,d,h);return{newWidth:e,newHeight:t}},t.prototype.setBoundingClientRect=function(){if("parent"===this.props.bounds){var e=this.parentNode;if(e){var t=e.getBoundingClientRect();this.parentLeft=t.left,this.parentTop=t.top}}if(this.props.bounds&&"string"!=typeof this.props.bounds){var i=this.props.bounds.getBoundingClientRect();this.targetLeft=i.left,this.targetTop=i.top}if(this.resizable){var s=this.resizable.getBoundingClientRect(),o=s.left,r=s.top,n=s.right,a=s.bottom;this.resizableLeft=o,this.resizableRight=n,this.resizableTop=r,this.resizableBottom=a}},t.prototype.onResizeStart=function(e,t){if(this.resizable&&this.window){var i,s=0,o=0;if(e.nativeEvent&&function(e){return Boolean((e.clientX||0===e.clientX)&&(e.clientY||0===e.clientY))}(e.nativeEvent)?(s=e.nativeEvent.clientX,o=e.nativeEvent.clientY):e.nativeEvent&&se(e.nativeEvent)&&(s=e.nativeEvent.touches[0].clientX,o=e.nativeEvent.touches[0].clientY),this.props.onResizeStart)if(this.resizable)if(!1===this.props.onResizeStart(e,t,this.resizable))return;this.props.size&&(void 0!==this.props.size.height&&this.props.size.height!==this.state.height&&this.setState({height:this.props.size.height}),void 0!==this.props.size.width&&this.props.size.width!==this.state.width&&this.setState({width:this.props.size.width})),this.ratio="number"==typeof this.props.lockAspectRatio?this.props.lockAspectRatio:this.size.width/this.size.height;var r=this.window.getComputedStyle(this.resizable);if("auto"!==r.flexBasis){var n=this.parentNode;if(n){var a=this.window.getComputedStyle(n).flexDirection;this.flexDir=a.startsWith("row")?"row":"column",i=r.flexBasis}}this.setBoundingClientRect(),this.bindEvents();var l={original:{x:s,y:o,width:this.size.width,height:this.size.height},isResizing:!0,backgroundStyle:X(X({},this.state.backgroundStyle),{cursor:this.window.getComputedStyle(e.target).cursor||"auto"}),direction:t,flexBasis:i};this.setState(l)}},t.prototype.onMouseMove=function(e){var t=this;if(this.state.isResizing&&this.resizable&&this.window){if(this.window.TouchEvent&&se(e))try{e.preventDefault(),e.stopPropagation()}catch(e){}var i=this.props,s=i.maxWidth,o=i.maxHeight,r=i.minWidth,n=i.minHeight,a=se(e)?e.touches[0].clientX:e.clientX,l=se(e)?e.touches[0].clientY:e.clientY,c=this.state,d=c.direction,h=c.original,p=c.width,u=c.height,g=this.getParentSize(),m=function(e,t,i,s,o,r,n){return s=ne(s,e.width,t,i),o=ne(o,e.height,t,i),r=ne(r,e.width,t,i),n=ne(n,e.height,t,i),{maxWidth:void 0===s?void 0:Number(s),maxHeight:void 0===o?void 0:Number(o),minWidth:void 0===r?void 0:Number(r),minHeight:void 0===n?void 0:Number(n)}}(g,this.window.innerWidth,this.window.innerHeight,s,o,r,n);s=m.maxWidth,o=m.maxHeight,r=m.minWidth,n=m.minHeight;var f=this.calculateNewSizeFromDirection(a,l),y=f.newHeight,x=f.newWidth,v=this.calculateNewMaxFromBoundary(s,o);this.props.snap&&this.props.snap.x&&(x=oe(x,this.props.snap.x,this.props.snapGap)),this.props.snap&&this.props.snap.y&&(y=oe(y,this.props.snap.y,this.props.snapGap));var b=this.calculateNewSizeFromAspectRatio(x,y,{width:v.maxWidth,height:v.maxHeight},{width:r,height:n});if(x=b.newWidth,y=b.newHeight,this.props.grid){var w=te(x,this.props.grid[0]),S=te(y,this.props.grid[1]),R=this.props.snapGap||0;x=0===R||Math.abs(w-x)<=R?w:x,y=0===R||Math.abs(S-y)<=R?S:y}var j={width:x-h.width,height:y-h.height};if(p&&"string"==typeof p)if(p.endsWith("%"))x=x/g.width*100+"%";else if(p.endsWith("vw")){x=x/this.window.innerWidth*100+"vw"}else if(p.endsWith("vh")){x=x/this.window.innerHeight*100+"vh"}if(u&&"string"==typeof u)if(u.endsWith("%"))y=y/g.height*100+"%";else if(u.endsWith("vw")){y=y/this.window.innerWidth*100+"vw"}else if(u.endsWith("vh")){y=y/this.window.innerHeight*100+"vh"}var C={width:this.createSizeForCssProperty(x,"width"),height:this.createSizeForCssProperty(y,"height")};"row"===this.flexDir?C.flexBasis=C.width:"column"===this.flexDir&&(C.flexBasis=C.height),(0,W.flushSync)((function(){t.setState(C)})),this.props.onResize&&this.props.onResize(e,d,this.resizable,j)}},t.prototype.onMouseUp=function(e){var t=this.state,i=t.isResizing,s=t.direction,o=t.original;if(i&&this.resizable){var r={width:this.size.width-o.width,height:this.size.height-o.height};this.props.onResizeStop&&this.props.onResizeStop(e,s,this.resizable,r),this.props.size&&this.setState(this.props.size),this.unbindEvents(),this.setState({isResizing:!1,backgroundStyle:X(X({},this.state.backgroundStyle),{cursor:"auto"})})}},t.prototype.updateSize=function(e){this.setState({width:e.width,height:e.height})},t.prototype.renderResizer=function(){var e=this,t=this.props,i=t.enable,s=t.handleStyles,r=t.handleClasses,n=t.handleWrapperStyle,a=t.handleWrapperClass,l=t.handleComponent;if(!i)return null;var c=Object.keys(i).map((function(t){return!1!==i[t]?o.createElement(G,{key:t,direction:t,onResizeStart:e.onResizeStart,replaceStyles:s&&s[t],className:r&&r[t]},l&&l[t]?l[t]:null):null}));return o.createElement("div",{className:a,style:n},c)},t.prototype.render=function(){var e=this,t=Object.keys(this.props).reduce((function(t,i){return-1!==ae.indexOf(i)||(t[i]=e.props[i]),t}),{}),i=X(X(X({position:"relative",userSelect:this.state.isResizing?"none":"auto"},this.props.style),this.sizeStyle),{maxWidth:this.props.maxWidth,maxHeight:this.props.maxHeight,minWidth:this.props.minWidth,minHeight:this.props.minHeight,boxSizing:"border-box",flexShrink:0});this.state.flexBasis&&(i.flexBasis=this.state.flexBasis);var s=this.props.as||"div";return o.createElement(s,X({ref:this.ref,style:i,className:this.props.className},t),this.state.isResizing&&o.createElement("div",{style:this.state.backgroundStyle}),this.props.children,this.renderResizer())},t.defaultProps={as:"div",onResizeStart:function(){},onResize:function(){},onResizeStop:function(){},enable:{top:!0,right:!0,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},style:{},grid:[1,1],lockAspectRatio:!1,lockAspectRatioExtraWidth:0,lockAspectRatioExtraHeight:0,scale:1,resizeRatio:1,snapGap:0},t}(o.PureComponent);const de=e=>s.keyframes`
  0% {
    transform: translateY(${e.components.horizontalDrawer.defaultHeight}px);
  }

  100% {
    transform: translateY(0px);
  }
`,he=(0,a.stylesFactory)((e=>({container:s.css`
      position: fixed !important;
      bottom: 0;
      background: ${e.colors.background.primary};
      border-top: 1px solid ${e.colors.border.weak};
      margin: ${e.spacing(0,-2,0,-2)};
      box-shadow: ${e.shadows.z3};
      z-index: ${e.zIndex.sidemenu};
    `,drawerActive:s.css`
      opacity: 1;
      animation: 0.5s ease-out ${de(e)};
    `,rzHandle:s.css`
      background: ${e.colors.secondary.main};
      transition: 0.3s background ease-in-out;
      position: relative;
      width: 200px !important;
      height: 7px !important;
      left: calc(50% - 100px) !important;
      top: -4px !important;
      cursor: grab;
      border-radius: 4px;
      &:hover {
        background: ${e.colors.secondary.shade};
      }
    `})));function pe(e){const{width:t,children:i,onResize:o}=e,r=(0,a.useTheme2)(),n=he(r),l=`${t+31.5}px`;return(0,E.jsx)(ce,{className:(0,s.cx)(n.container,n.drawerActive),defaultSize:{width:l,height:`${r.components.horizontalDrawer.defaultHeight}px`},handleClasses:{top:n.rzHandle},enable:{top:!0,right:!1,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1},maxHeight:"100vh",maxWidth:l,minWidth:l,onResize:o,children:i})}var ue=i(16618),ge=i(77967),me=i(81669),fe=i(59970),ye=i(73723);const xe={runQueries:u.aA},ve=(0,r.connect)((function(e,t){let{exploreId:i}=t;const s=e.explore[i],{loading:o,queryResponse:r}=s;return{loading:o,queryResponse:r}}),xe)((function(e){var t;const{loading:i,width:s,onClose:o,queryResponse:r,timeZone:n}=e,l=(null==r?void 0:r.series)||[],c=null==r?void 0:r.error,d={label:"Stats",value:"stats",icon:"chart-line",content:(0,E.jsx)(fe.f,{data:r,timeZone:null==r||null===(t=r.request)||void 0===t?void 0:t.timezone})},h={label:"JSON",value:"json",icon:"brackets-curly",content:(0,E.jsx)(me.W,{data:r,onClose:o})},p={label:"Data",value:"data",icon:"database",content:(0,E.jsx)(ue.E,{data:l,isLoading:i,options:{withTransforms:!1,withFieldConfig:!1},timeZone:n,app:y.CoreApp.Explore})},u=[d,{label:"Query",value:"query",icon:"info-circle",content:(0,E.jsx)(ye.D,{data:l,onRefreshQuery:()=>e.runQueries(e.exploreId)})},h,p];if(c){const e={label:"Error",value:"error",icon:"exclamation-triangle",content:(0,E.jsx)(ge.l,{error:c})};u.push(e)}return(0,E.jsx)(pe,{width:s,children:(0,E.jsx)(a.TabbedContainer,{tabs:u,onClose:o,closeIconTooltip:"Close query inspector"})})}));var be=i(98163),we=i(74534),Se=i(16461),Re=i(75478),je=i(10603),Ce=i(43961),Te=i(10416);function Ie(e){const{onClick:t,isSynced:i}=e;return(0,E.jsx)(a.Tooltip,{content:()=>{const{isSynced:t}=e,i=t?"Unsync all views":"Sync all views to this time range";return(0,E.jsx)(E.Fragment,{children:i})},placement:"bottom",children:(0,E.jsx)(a.ToolbarButton,{icon:"link",variant:i?"active":"default","aria-label":i?"Synced times":"Unsynced times",onClick:t})})}function ze(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Fe extends o.Component{constructor(){super(...arguments),ze(this,"onMoveTimePicker",(e=>{const{range:t,onChangeTime:i,timeZone:s}=this.props,{from:o,to:r}=(0,Te.e)(e,t);i({from:(0,y.dateTimeForTimeZone)(s,o),to:(0,y.dateTimeForTimeZone)(s,r)})})),ze(this,"onMoveForward",(()=>this.onMoveTimePicker(1))),ze(this,"onMoveBack",(()=>this.onMoveTimePicker(-1))),ze(this,"onChangeTimePicker",(e=>{const t=y.dateMath.isMathString(e.raw.from)?e.raw.from:e.from,i=y.dateMath.isMathString(e.raw.to)?e.raw.to:e.to;this.props.onChangeTime({from:t,to:i})})),ze(this,"onZoom",(()=>{const{range:e,onChangeTime:t,timeZone:i}=this.props,{from:s,to:o}=(0,Te.h)(e,2);t({from:(0,y.dateTimeForTimeZone)(i,s),to:(0,y.dateTimeForTimeZone)(i,o)})}))}render(){const{range:e,timeZone:t,fiscalYearStartMonth:i,splitted:s,syncedTimes:o,onChangeTimeSync:r,hideText:n,onChangeTimeZone:a,onChangeFiscalYearStartMonth:l}=this.props,c=s?(0,E.jsx)(Ie,{onClick:r,isSynced:o}):void 0,d={value:e,timeZone:t,fiscalYearStartMonth:i,onMoveBackward:this.onMoveBack,onMoveForward:this.onMoveForward,onZoom:this.onZoom,hideText:n};return(0,E.jsx)(Ce.a,Object.assign({},d,{timeSyncButton:c,isSynced:o,widthOverride:s?window.innerWidth/2:void 0,onChange:this.onChangeTimePicker,onChangeTimeZone:a,onChangeFiscalYearStartMonth:l}))}}var ke=i(40284);function Oe(e){const{start:t,pause:i,resume:s,isLive:o,isPaused:r,stop:n,splitted:l}=e,c=o&&!r?"active":"default",d=o?r?s:i:t;return(0,E.jsxs)(a.ButtonGroup,{children:[(0,E.jsx)(a.Tooltip,{content:o&&!r?(0,E.jsx)(E.Fragment,{children:"Pause the live stream"}):(0,E.jsx)(E.Fragment,{children:"Start live stream your logs"}),placement:"bottom",children:(0,E.jsx)(a.ToolbarButton,{iconOnly:l,variant:c,icon:!o||r?"play":"pause",onClick:d,children:o&&r?"Paused":"Live"})}),(0,E.jsx)(ke.Z,{mountOnEnter:!0,unmountOnExit:!0,timeout:100,in:o,classNames:{enter:Le.stopButtonEnter,enterActive:Le.stopButtonEnterActive,exit:Le.stopButtonExit,exitActive:Le.stopButtonExitActive},children:(0,E.jsx)(a.Tooltip,{content:(0,E.jsx)(E.Fragment,{children:"Stop and exit the live stream"}),placement:"bottom",children:(0,E.jsx)(a.ToolbarButton,{variant:c,onClick:n,icon:"square-shape"})})})]})}const Le={stopButtonEnter:s.css`
    label: stopButtonEnter;
    width: 0;
    opacity: 0;
    overflow: hidden;
  `,stopButtonEnterActive:s.css`
    label: stopButtonEnterActive;
    opacity: 1;
    width: 32px;
  `,stopButtonExit:s.css`
    label: stopButtonExit;
    width: 32px;
    opacity: 1;
    overflow: hidden;
  `,stopButtonExitActive:s.css`
    label: stopButtonExitActive;
    opacity: 0;
    width: 0;
  `};var De=i(20120),Ne=i(77377);function Ee(e){const t=function(e){const t=(0,r.useDispatch)(),i=(0,o.useCallback)((()=>{t((0,u.sQ)({exploreId:e,isPaused:!0}))}),[e,t]),s=(0,o.useCallback)((()=>{t((0,u.sQ)({exploreId:e,isPaused:!1}))}),[e,t]),n=(0,o.useCallback)((()=>{i(),t((0,Ne.oz)(e,a.RefreshPicker.offOption.value)),t((0,u.aA)(e))}),[e,t,i]),l=(0,o.useCallback)((()=>{t((0,Ne.oz)(e,a.RefreshPicker.liveOption.value))}),[e,t]);return{pause:i,resume:s,stop:n,start:l}}(e.exploreId);return e.children(t)}function $e(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const He=(0,o.lazy)((()=>i.e(7885).then(i.bind(i,77885)).then((e=>{let{AddToDashboard:t}=e;return{default:t}}))));class Pe extends o.PureComponent{constructor(){var e;super(...arguments),e=this,$e(this,"onChangeDatasource",(async e=>{this.props.changeDatasource(this.props.exploreId,e.uid,{importQueries:!0})})),$e(this,"onRunQuery",(function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{runQueries:i,cancelQueries:s,exploreId:o}=e.props;return t?s(o):i(o)})),$e(this,"onChangeRefreshInterval",(e=>{const{changeRefreshInterval:t,exploreId:i}=this.props;t(i,e)})),$e(this,"onChangeTimeSync",(()=>{const{syncTimes:e,exploreId:t}=this.props;e(t)})),$e(this,"renderRefreshPicker",(e=>{const{loading:t,refreshInterval:i,isLive:s}=this.props;let o,r=t?"Cancel":"Run query",n="108px";return e&&(o=r,r=void 0,n="35px"),(0,E.jsx)(a.RefreshPicker,{onIntervalChanged:this.onChangeRefreshInterval,value:i,isLoading:t,text:r,tooltip:o,intervals:(0,Re.$t)().getValidIntervals(a.defaultIntervals),isLive:s,onRefresh:()=>this.onRunQuery(t),noIntervalPicker:s,primary:!0,width:n})}))}render(){const{datasourceMissing:e,closeSplit:t,exploreId:i,loading:s,range:r,timeZone:c,fiscalYearStartMonth:d,splitted:h,syncedTimes:p,refreshInterval:u,onChangeTime:g,split:m,hasLiveOption:f,isLive:y,isPaused:x,containerWidth:v,onChangeTimeZone:b,onChangeFiscalYearStartMonth:w,topOfViewRef:S}=this.props,R=(h?v<700:v<800)||!1,j=h||v<1210,C=be.Vt.hasAccess(P.bW.DashboardsCreate,be.Vt.isEditor)||be.Vt.hasAccess(P.bW.DashboardsWrite,be.Vt.isEditor);return(0,E.jsx)("div",{ref:S,children:(0,E.jsx)(a.PageToolbar,{"aria-label":"Explore toolbar",title:i===l.K.left?"Explore":void 0,pageIcon:i===l.K.left?"compass":void 0,leftItems:[i===l.K.left&&(0,E.jsx)(Se.u,{tooltip:"Copy shortened link",icon:"share-alt",onClick:()=>(0,we.L)(window.location.href),"aria-label":"Copy shortened link"},"share"),!e&&(0,E.jsx)(n.DataSourcePicker,{onChange:this.onChangeDatasource,current:this.props.datasourceRef,hideTextValue:R,width:R?8:void 0},`${i}-ds-picker`)].filter(Boolean),children:(0,E.jsxs)(a.ToolbarButtonRow,{children:[h?(0,E.jsx)(a.ToolbarButton,{title:"Close split pane",onClick:()=>t(i),icon:"times",children:"Close"}):(0,E.jsx)(a.ToolbarButton,{title:"Split",onClick:()=>m(),icon:"columns",disabled:y,children:"Split"}),n.config.featureToggles.explore2Dashboard&&C&&(0,E.jsx)(o.Suspense,{fallback:null,children:(0,E.jsx)(He,{exploreId:i})}),!y&&(0,E.jsx)(Fe,{exploreId:i,range:r,timeZone:c,fiscalYearStartMonth:d,onChangeTime:g,splitted:h,syncedTimes:p,onChangeTimeSync:this.onChangeTimeSync,hideText:j,onChangeTimeZone:b,onChangeFiscalYearStartMonth:w}),this.renderRefreshPicker(j),u&&(0,E.jsx)(a.SetInterval,{func:this.onRunQuery,interval:u,loading:s}),f&&(0,E.jsx)(Ee,{exploreId:i,children:e=>{const t=Object.assign({},e,{start:()=>{(0,n.reportInteraction)("grafana_explore_logs_live_tailing_clicked",{datasourceType:this.props.datasourceType}),e.start()}});return(0,E.jsx)(Oe,{splitted:h,isLive:y,isPaused:x,start:t.start,pause:t.pause,resume:t.resume,stop:t.stop})}})]})})})}}const Ae={changeDatasource:De.zU,changeRefreshInterval:Ne.oz,cancelQueries:u.ci,runQueries:u.aA,closeSplit:p.YV,split:p.bW,syncTimes:Ne.mG,onChangeTimeZone:je.YT,onChangeFiscalYearStartMonth:je.rf},Be=(0,r.connect)(((e,t)=>{var i;let{exploreId:s}=t;const{syncedTimes:o}=e.explore,r=e.explore[s],{datasourceInstance:n,datasourceMissing:a,range:l,refreshInterval:c,loading:d,isLive:h,isPaused:p,containerWidth:u}=r,m=!(null==n||null===(i=n.meta)||void 0===i||!i.streaming);return{datasourceMissing:a,datasourceRef:null==n?void 0:n.getRef(),datasourceType:null==n?void 0:n.type,loading:d,range:l,timeZone:(0,w.Z)(e.user),fiscalYearStartMonth:(0,w.i)(e.user),splitted:(0,g.p)(e),refreshInterval:c,hasLiveOption:m,isLive:h,isPaused:p,syncedTimes:o,containerWidth:u}}),Ae)(Pe);var Me=i(35008),qe=i.n(Me);const We=function(e,t){var i=(0,o.useRef)((function(){}));(0,o.useEffect)((function(){i.current=e})),(0,o.useEffect)((function(){if(null!==t){var e=setInterval((function(){return i.current()}),t||0);return function(){return clearInterval(e)}}}),[t])},_e=e=>{let{timeInMs:t,className:i,humanize:s}=e;return(0,E.jsx)("span",{className:i,children:Ze(t,s)})},Ze=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e/1e3;if(!t)return`${i.toFixed(1)}s`;const s=(0,y.toDuration)(i,"seconds"),o=s.hours(),r=s.minutes(),n=s.seconds();return o?`${o}h ${r}m ${n}s`:r?`${r}m ${n}s`:`${n}s`},Qe=e=>{let{resetKey:t,humanize:i,className:s}=e;const[r,n]=(0,o.useState)(0);return We((()=>n(r+150)),150),(0,o.useEffect)((()=>n(0)),[t]),(0,E.jsx)(_e,{timeInMs:r,className:s,humanize:i})};var Ve;function Ue(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Ke extends o.PureComponent{constructor(e){super(e),Ue(this,"liveEndDiv",null),Ue(this,"scrollContainerRef",o.createRef()),Ue(this,"onScroll",(e=>{const{isPaused:t,onPause:i}=this.props,{scrollTop:s,clientHeight:o,scrollHeight:r}=e.currentTarget;r-(s+o)>=5&&!t&&i()})),Ue(this,"rowsToRender",(()=>{const{isPaused:e}=this.props;let{logRowsToRender:t=[]}=this.state;return e||(t=t.slice(-100)),t})),this.state={logRowsToRender:e.logRows}}static getDerivedStateFromProps(e,t){return e.isPaused?null:{logRowsToRender:e.logRows}}render(){const{theme:e,timeZone:t,onPause:i,onResume:o,isPaused:r}=this.props,n=(e=>({logsRowsLive:s.css`
    label: logs-rows-live;
    font-family: ${e.typography.fontFamilyMonospace};
    font-size: ${e.typography.bodySmall.fontSize};
    display: flex;
    flex-flow: column nowrap;
    height: 60vh;
    overflow-y: scroll;
    :first-child {
      margin-top: auto !important;
    }
  `,logsRowFade:s.css`
    label: logs-row-fresh;
    color: ${e.colors.text};
    background-color: ${qe()(e.colors.info.transparent).setAlpha(.25).toString()};
    animation: fade 1s ease-out 1s 1 normal forwards;
    @keyframes fade {
      from {
        background-color: ${qe()(e.colors.info.transparent).setAlpha(.25).toString()};
      }
      to {
        background-color: transparent;
      }
    }
  `,logsRowsIndicator:s.css`
    font-size: ${e.typography.h6.fontSize};
    padding-top: ${e.spacing(1)};
    display: flex;
    align-items: center;
  `,button:s.css`
    margin-right: ${e.spacing(1)};
  `,fullWidth:s.css`
    width: 100%;
  `}))(e),{logsRow:l,logsRowLocalTime:c,logsRowMessage:d}=(0,a.getLogRowStyles)(e);return(0,E.jsxs)("div",{children:[(0,E.jsx)("table",{className:n.fullWidth,children:(0,E.jsxs)("tbody",{onScroll:r?void 0:this.onScroll,className:n.logsRowsLive,ref:this.scrollContainerRef,children:[this.rowsToRender().map((e=>(0,E.jsxs)("tr",{className:(0,s.cx)(l,n.logsRowFade),children:[(0,E.jsx)("td",{className:c,children:(0,y.dateTimeFormat)(e.timeEpochMs,{timeZone:t})}),(0,E.jsx)("td",{className:d,children:e.hasAnsi?(0,E.jsx)(a.LogMessageAnsi,{value:e.raw}):e.entry})]},e.uid))),(0,E.jsx)("tr",{ref:e=>{var t,i;(this.liveEndDiv=e,this.liveEndDiv&&null!==(t=this.scrollContainerRef.current)&&void 0!==t&&t.scrollTo&&!r)&&(null===(i=this.scrollContainerRef.current)||void 0===i||i.scrollTo(0,this.scrollContainerRef.current.scrollHeight))}})]})}),(0,E.jsxs)("div",{className:n.logsRowsIndicator,children:[(0,E.jsxs)(a.Button,{variant:"secondary",onClick:r?o:i,className:n.button,children:[(0,E.jsx)(a.Icon,{name:r?"play":"pause"})," ",r?"Resume":"Pause"]}),(0,E.jsxs)(a.Button,{variant:"secondary",onClick:this.props.stopLive,className:n.button,children:[Ve||(Ve=(0,E.jsx)(a.Icon,{name:"square-shape",size:"lg",type:"mono"})),"  Exit live mode"]}),r||(0,E.jsxs)("span",{children:["Last line received: ",(0,E.jsx)(Qe,{resetKey:this.props.logRows,humanize:!0})," ago"]})]})]})}}const Ge=(0,a.withTheme2)(Ke);var Ye=i(28783),Xe=i(88121);const Je=e=>({metaContainer:s.css`
    flex: 1;
    color: ${e.colors.text.secondary};
    margin-bottom: ${e.spacing(2)};
    min-width: 30%;
    display: flex;
    flex-wrap: wrap;
  `,metaItem:s.css`
    margin-right: ${e.spacing(2)};
    margin-top: ${e.spacing(.5)};
    display: flex;
    align-items: baseline;

    .logs-meta-item__error {
      color: ${e.colors.error.text};
    }
  `,metaLabel:s.css`
    margin-right: calc(${e.spacing(2)} / 2);
    font-size: ${e.typography.bodySmall.fontSize};
    font-weight: ${e.typography.fontWeightMedium};
  `,metaValue:s.css`
    font-family: ${e.typography.fontFamilyMonospace};
    font-size: ${e.typography.bodySmall.fontSize};
  `}),et=(0,o.memo)((function(e){const t=(0,a.useStyles2)(Je),{label:i,value:s}=e;return(0,E.jsxs)("div",{"data-testid":"meta-info-text-item",className:t.metaItem,children:[i&&(0,E.jsxs)("span",{className:t.metaLabel,children:[i,":"]}),(0,E.jsx)("span",{className:t.metaValue,children:s})]})})),tt=(0,o.memo)((function(e){const t=(0,a.useStyles2)(Je),{metaItems:i}=e;return(0,E.jsx)("div",{className:t.metaContainer,"data-testid":"meta-info-text",children:i.map(((e,t)=>(0,E.jsx)(et,{label:e.label,value:e.value},`${t}-${e.label}`)))})})),it=o.memo((e=>{let{meta:t,dedupStrategy:i,dedupCount:s,showDetectedFields:o,clearDetectedFields:r,hasUnescapedContent:n,forceEscape:l,onEscapeNewlines:c,logRows:d}=e;const h=[...t];return i!==y.LogsDedupStrategy.none&&h.push({label:"Dedup count",value:s,kind:y.LogsMetaKind.Number}),d.some((e=>e.entry.length>Xe.n))&&h.push({label:"Info",value:"Logs with more than 100,000 characters could not be parsed and highlighted",kind:y.LogsMetaKind.String}),(null==o?void 0:o.length)>0&&h.push({label:"Showing only detected fields",value:st(o,y.LogsMetaKind.LabelsMap)},{label:"",value:(0,E.jsx)(a.Button,{variant:"secondary",size:"sm",onClick:r,children:"Show original line"})}),n&&h.push({label:"Your logs might have incorrectly escaped content",value:(0,E.jsx)(a.Tooltip,{content:"Fix incorrectly escaped newline and tab sequences in log lines. Manually review the results to confirm that the replacements are correct.",placement:"right",children:(0,E.jsx)(a.Button,{variant:"secondary",size:"sm",onClick:c,children:l?"Remove escaping":"Escape newlines"})})}),(0,E.jsx)(E.Fragment,{children:h&&(0,E.jsx)(tt,{metaItems:h.map((e=>({label:e.label,value:"kind"in e?st(e.value,e.kind):e.value})))})})}));function st(e,t){return t===y.LogsMetaKind.LabelsMap?(0,E.jsx)(a.LogLabels,{labels:e}):t===y.LogsMetaKind.Error?(0,E.jsx)("span",{className:"logs-meta-item__error",children:e}):e}var ot;function rt(e){let{pages:t,currentPageIndex:i,oldestLogsFirst:o,timeZone:r,loading:l,changeTime:c}=e;const d=e=>`${(0,y.dateTimeFormat)(e,{format:y.systemDateFormats.interval.second,timeZone:r})}`,h=(e,t)=>{if(i===t&&l)return ot||(ot=(0,E.jsx)(a.Spinner,{}));return`${d(o?e.logsRange.from:e.logsRange.to)} — ${d(o?e.logsRange.to:e.logsRange.from)}`},p=(0,a.useTheme2)(),u=nt(p,l);return(0,E.jsx)(a.CustomScrollbar,{autoHide:!0,children:(0,E.jsx)("div",{className:u.pagesWrapper,"data-testid":"logsNavigationPages",children:(0,E.jsx)("div",{className:u.pagesContainer,children:t.map(((e,t)=>(0,E.jsxs)("div",{"data-testid":`page${t+1}`,className:u.page,onClick:()=>{(0,n.reportInteraction)("grafana_explore_logs_pagination_clicked",{pageType:"page",pageNumber:t+1}),!l&&c({from:e.queryRange.from,to:e.queryRange.to})},children:[(0,E.jsx)("div",{className:(0,s.cx)(u.line,{selectedBg:i===t})}),(0,E.jsx)("div",{className:(0,s.cx)(u.time,{selectedText:i===t}),children:h(e,t)})]},e.queryRange.to)))})})})}it.displayName="LogsMetaRow";const nt=(e,t)=>({pagesWrapper:s.css`
      height: 100%;
      padding-left: ${e.spacing(.5)};
      display: flex;
      flex-direction: column;
      overflow-y: scroll;
      &::after {
        content: '';
        display: block;
        background: repeating-linear-gradient(
          135deg,
          ${e.colors.background.primary},
          ${e.colors.background.primary} 5px,
          ${e.colors.background.secondary} 5px,
          ${e.colors.background.secondary} 15px
        );
        width: 3px;
        height: inherit;
        margin-bottom: 8px;
      }
    `,pagesContainer:s.css`
      display: flex;
      padding: 0;
      flex-direction: column;
    `,page:s.css`
      display: flex;
      margin: ${e.spacing(2)} 0;
      cursor: ${t?"auto":"pointer"};
      white-space: normal;
      .selectedBg {
        background: ${e.colors.primary.main};
      }
      .selectedText {
        color: ${e.colors.primary.main};
      }
    `,line:s.css`
      width: 3px;
      height: 100%;
      align-items: center;
      background: ${e.colors.text.secondary};
    `,time:s.css`
      width: 60px;
      min-height: 80px;
      font-size: ${e.v1.typography.size.sm};
      padding-left: ${e.spacing(.5)};
      display: flex;
      align-items: center;
    `});var at,lt,ct;function dt(e){let{absoluteRange:t,logsSortOrder:i,timeZone:s,loading:r,onChangeTime:l,scrollToTopLogs:c,visibleRange:d,queries:h,clearCache:p,addResultsToCache:u}=e;const[g,m]=(0,o.useState)([]),[f,x]=(0,o.useState)(0),v=(0,o.useRef)(),b=(0,o.useRef)(),w=(0,o.useRef)(0),S=i===y.LogsSortOrder.Ascending,R=S?f===g.length-1:0===f,j=S?0===f:f===g.length-1,C=(0,a.useTheme2)(),T=pt(C,S,r);(0,o.useEffect)((()=>{const e={logsRange:d,queryRange:t};let s=[];if((0,F.isEqual)(b.current,t)&&(0,F.isEqual)(v.current,h)){m((t=>(s=t.filter((t=>!(0,F.isEqual)(e.queryRange,t.queryRange))),s=[...s,e].sort(((e,t)=>z(e,t,i))),s)));const o=s.findIndex((e=>e.queryRange.to===t.to));x(o)}else p(),m([e]),x(0),v.current=h,w.current=t.to-t.from;u()}),[d,t,i,h,p,u]),(0,o.useEffect)((()=>{p()}),[]);const I=e=>{let{from:t,to:i}=e;b.current={from:t,to:i},l({from:t,to:i})},z=(e,t,i)=>i===y.LogsSortOrder.Ascending?e.queryRange.to>t.queryRange.to?1:-1:e.queryRange.to>t.queryRange.to?-1:1,k=(0,E.jsx)(a.Button,{"data-testid":"olderLogsButton",className:T.navButton,variant:"secondary",onClick:()=>{if((0,n.reportInteraction)("grafana_explore_logs_pagination_clicked",{pageType:"olderLogsButton"}),j)I({from:d.from-w.current,to:d.from});else{const e=S?-1:1;I({from:g[f+e].queryRange.from,to:g[f+e].queryRange.to})}},disabled:r,children:(0,E.jsxs)("div",{className:T.navButtonContent,children:[r?at||(at=(0,E.jsx)(a.Spinner,{})):(0,E.jsx)(a.Icon,{name:S?"angle-up":"angle-down",size:"lg"}),"Older logs"]})}),O=(0,E.jsx)(a.Button,{"data-testid":"newerLogsButton",className:T.navButton,variant:"secondary",onClick:()=>{if((0,n.reportInteraction)("grafana_explore_logs_pagination_clicked",{pageType:"newerLogsButton"}),!R){const e=S?1:-1;I({from:g[f+e].queryRange.from,to:g[f+e].queryRange.to})}},disabled:r||R,children:(0,E.jsxs)("div",{className:T.navButtonContent,children:[r&&(lt||(lt=(0,E.jsx)(a.Spinner,{}))),R||r?null:(0,E.jsx)(a.Icon,{name:S?"angle-down":"angle-up",size:"lg"}),R?"Start of range":"Newer logs"]})});return(0,E.jsxs)("div",{className:T.navContainer,children:[S?k:O,(0,E.jsx)(rt,{pages:g,currentPageIndex:f,oldestLogsFirst:S,timeZone:s,loading:r,changeTime:I}),S?O:k,(0,E.jsx)(a.Button,{"data-testid":"scrollToTop",className:T.scrollToTopButton,variant:"secondary",onClick:c,title:"Scroll to top",children:ct||(ct=(0,E.jsx)(a.Icon,{name:"arrow-up",size:"lg"}))})]})}const ht=(0,o.memo)(dt),pt=(e,t,i)=>({navContainer:s.css`
      max-height: 95vh;
      display: flex;
      flex-direction: column;
      justify-content: ${t?"flex-start":"space-between"};
      position: sticky;
      top: ${e.spacing(2)};
      right: 0;
    `,navButton:s.css`
      width: 58px;
      height: 68px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      line-height: 1;
    `,navButtonContent:s.css`
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 100%;
      white-space: normal;
    `,scrollToTopButton:s.css`
      width: 40px;
      height: 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin-top: ${e.spacing(1)};
    `});var ut,gt;function mt(e){var t;const[i,s]=(0,o.useState)(!1),r=e.error.message||(null===(t=e.error.data)||void 0===t?void 0:t.message)||"",n=!i&&r.length>100;return(0,E.jsx)(a.Alert,{title:"Failed to load log volume for this query",severity:"warning",children:n?(0,E.jsx)(a.Button,{variant:"secondary",size:"xs",onClick:()=>{s(!0)},children:"Show details"}):r})}function ft(e){const{width:t,timeZone:i,splitOpen:s,onUpdateTimeRange:o,onLoadLogsVolume:r,onHiddenSeriesChanged:n}=e,l=(0,a.useTheme2)(),c=(0,a.useStyles2)(yt),d=parseInt(l.spacing(2).slice(0,-2),10),h=function(e,t,i,s){return void 0!==i?{logsVolumeData:i,fullRangeData:!0,range:s}:void 0!==e?{logsVolumeData:e,fullRangeData:!1,range:t||s}:void 0}(e.logLinesBasedData,e.logLinesBasedDataVisibleRange,e.logsVolumeData,e.absoluteRange);if(void 0===h)return null;const{logsVolumeData:p,fullRangeData:u,range:g}=h;if(void 0!==p.error)return(0,E.jsx)(mt,{error:p.error});let m,f;if((null==p?void 0:p.state)===y.LoadingState.Loading?m=ut||(ut=(0,E.jsx)("span",{children:"Log volume is loading..."})):null!=p&&p.data&&(m=p.data.length>0?(0,E.jsx)($,{graphStyle:"lines",loadingState:y.LoadingState.Done,data:p.data,height:150,width:t-d,absoluteRange:g,onChangeTime:o,timeZone:i,splitOpenFn:s,tooltipDisplayMode:a.TooltipDisplayMode.Multi,onHiddenSeriesChanged:n}):gt||(gt=(0,E.jsx)("span",{children:"No volume data."}))),u){const e=function(e,t){var i,s;const o=e&&e.data[0]&&(null===(i=e.data[0].meta)||void 0===i||null===(s=i.custom)||void 0===s?void 0:s.absoluteRange);return o?(t.from-t.to)/(o.from-o.to):void 0}(p,g);void 0!==e&&e<1&&(f=(0,E.jsx)(a.InlineField,{label:"Reload log volume",transparent:!0,children:(0,E.jsx)(a.Button,{size:"xs",icon:"sync",variant:"secondary",onClick:r,id:"reload-volume"})}))}else f=(0,E.jsx)("div",{className:c.oldInfoText,children:"This datasource does not support full-range histograms. The graph is based on the logs seen in the response."});return(0,E.jsxs)(a.Collapse,{label:"",isOpen:!0,children:[(0,E.jsx)("div",{style:{height:150},className:c.contentContainer,children:m}),(0,E.jsx)("div",{className:c.extraInfoContainer,children:f})]})}const yt=e=>({extraInfoContainer:s.css`
      display: flex;
      justify-content: end;
      position: absolute;
      right: 5px;
      top: 5px;
    `,contentContainer:s.css`
      display: flex;
      align-items: center;
      justify-content: center;
    `,oldInfoText:s.css`
      font-size: ${e.typography.size.sm};
      color: ${e.colors.text.secondary};
    `});function xt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const vt="grafana.explore.logs.showLabels",bt="grafana.explore.logs.showTime",wt="grafana.explore.logs.wrapLogMessage",St="grafana.explore.logs.prettifyLogMessage",Rt="grafana.explore.logs.sortOrder";class jt extends o.PureComponent{constructor(){super(...arguments),xt(this,"flipOrderTimer",void 0),xt(this,"cancelFlippingTimer",void 0),xt(this,"topLogsRef",(0,o.createRef)()),xt(this,"state",{showLabels:v.Z.getBool(vt,!1),showTime:v.Z.getBool(bt,!0),wrapLogMessage:v.Z.getBool(wt,!0),prettifyLogMessage:v.Z.getBool(St,!1),dedupStrategy:y.LogsDedupStrategy.none,hiddenLogLevels:[],logsSortOrder:v.Z.get(Rt)||y.LogsSortOrder.Descending,isFlipping:!1,showDetectedFields:[],forceEscape:!1}),xt(this,"onChangeLogsSortOrder",(()=>{this.setState({isFlipping:!0}),this.flipOrderTimer=window.setTimeout((()=>{this.setState((e=>{const t=e.logsSortOrder===y.LogsSortOrder.Descending?y.LogsSortOrder.Ascending:y.LogsSortOrder.Descending;return v.Z.set(Rt,t),{logsSortOrder:t}}))}),0),this.cancelFlippingTimer=window.setTimeout((()=>this.setState({isFlipping:!1})),1e3)})),xt(this,"onEscapeNewlines",(()=>{this.setState((e=>({forceEscape:!e.forceEscape})))})),xt(this,"onChangeDedup",(e=>{(0,n.reportInteraction)("grafana_explore_logs_deduplication_clicked",{deduplicationType:e,datasourceType:this.props.datasourceType}),this.setState({dedupStrategy:e})})),xt(this,"onChangeLabels",(e=>{const{target:t}=e;if(t){const e=t.checked;this.setState({showLabels:e}),v.Z.set(vt,e)}})),xt(this,"onChangeTime",(e=>{const{target:t}=e;if(t){const e=t.checked;this.setState({showTime:e}),v.Z.set(bt,e)}})),xt(this,"onChangeWrapLogMessage",(e=>{const{target:t}=e;if(t){const e=t.checked;this.setState({wrapLogMessage:e}),v.Z.set(wt,e)}})),xt(this,"onChangePrettifyLogMessage",(e=>{const{target:t}=e;if(t){const e=t.checked;this.setState({prettifyLogMessage:e}),v.Z.set(St,e)}})),xt(this,"onToggleLogLevel",(e=>{const t=e.map((e=>y.LogLevel[e]));this.setState({hiddenLogLevels:t})})),xt(this,"onClickScan",(e=>{e.preventDefault(),this.props.onStartScanning&&this.props.onStartScanning()})),xt(this,"onClickStopScan",(e=>{e.preventDefault(),this.props.onStopScanning&&this.props.onStopScanning()})),xt(this,"showDetectedField",(e=>{-1===this.state.showDetectedFields.indexOf(e)&&this.setState((t=>({showDetectedFields:t.showDetectedFields.concat(e)})))})),xt(this,"hideDetectedField",(e=>{this.state.showDetectedFields.indexOf(e)>-1&&this.setState((t=>({showDetectedFields:t.showDetectedFields.filter((t=>e!==t))})))})),xt(this,"clearDetectedFields",(()=>{this.setState((e=>({showDetectedFields:[]})))})),xt(this,"checkUnescapedContent",(0,f.Z)((e=>!!e.some((e=>e.hasUnescapedContent))))),xt(this,"dedupRows",(0,f.Z)(((e,t)=>{const i=(0,Ye.UW)(e,t),s=i.reduce(((e,t)=>t.duplicates?e+t.duplicates:e),0);return{dedupedRows:i,dedupCount:s}}))),xt(this,"filterRows",(0,f.Z)(((e,t)=>(0,Ye.nu)(e,new Set(t))))),xt(this,"createNavigationRange",(0,f.Z)((e=>{if(!e||0===e.length)return;const t=e[0].timeEpochMs,i=e[e.length-1].timeEpochMs;return i<t?{from:i,to:t}:{from:t,to:i}}))),xt(this,"scrollToTopLogs",(()=>{var e;return null===(e=this.topLogsRef.current)||void 0===e?void 0:e.scrollIntoView()}))}componentWillUnmount(){this.flipOrderTimer&&window.clearTimeout(this.flipOrderTimer),this.cancelFlippingTimer&&window.clearTimeout(this.cancelFlippingTimer)}render(){const{width:e,splitOpen:t,logRows:i,logsMeta:s,logsSeries:o,visibleRange:r,logsVolumeData:n,loadLogsVolumeData:l,loading:c=!1,loadingState:d,onClickFilterLabel:h,onClickFilterOutLabel:p,timeZone:u,scanning:g,scanRange:m,showContextToggle:f,absoluteRange:x,onChangeTime:v,getFieldLinks:b,theme:w,logsQueries:S,clearCache:R,addResultsToCache:j,exploreId:C}=this.props,{showLabels:T,showTime:I,wrapLogMessage:z,prettifyLogMessage:k,dedupStrategy:O,hiddenLogLevels:L,logsSortOrder:D,isFlipping:N,showDetectedFields:$,forceEscape:H}=this.state,P=Tt(w,z),A=i&&i.length>0,B=this.checkUnescapedContent(i),M=this.filterRows(i,L),{dedupedRows:q,dedupCount:W}=this.dedupRows(M,O),_=this.createNavigationRange(i),Z=m?`Scanning ${y.rangeUtil.describeTimeRange(m)}`:"Scanning...";return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(ft,{absoluteRange:x,width:e,logsVolumeData:n,logLinesBasedData:o?{data:o,state:d}:void 0,logLinesBasedDataVisibleRange:r,onUpdateTimeRange:v,timeZone:u,splitOpen:t,onLoadLogsVolume:()=>l(C),onHiddenSeriesChanged:this.onToggleLogLevel}),(0,E.jsxs)("div",{className:P.logOptions,ref:this.topLogsRef,children:[(0,E.jsxs)(a.InlineFieldRow,{children:[(0,E.jsx)(a.InlineField,{label:"Time",className:P.horizontalInlineLabel,transparent:!0,children:(0,E.jsx)(a.InlineSwitch,{value:I,onChange:this.onChangeTime,className:P.horizontalInlineSwitch,transparent:!0,id:`show-time_${C}`})}),(0,E.jsx)(a.InlineField,{label:"Unique labels",className:P.horizontalInlineLabel,transparent:!0,children:(0,E.jsx)(a.InlineSwitch,{value:T,onChange:this.onChangeLabels,className:P.horizontalInlineSwitch,transparent:!0,id:`unique-labels_${C}`})}),(0,E.jsx)(a.InlineField,{label:"Wrap lines",className:P.horizontalInlineLabel,transparent:!0,children:(0,E.jsx)(a.InlineSwitch,{value:z,onChange:this.onChangeWrapLogMessage,className:P.horizontalInlineSwitch,transparent:!0,id:`wrap-lines_${C}`})}),(0,E.jsx)(a.InlineField,{label:"Prettify JSON",className:P.horizontalInlineLabel,transparent:!0,children:(0,E.jsx)(a.InlineSwitch,{value:k,onChange:this.onChangePrettifyLogMessage,className:P.horizontalInlineSwitch,transparent:!0,id:`prettify_${C}`})}),(0,E.jsx)(a.InlineField,{label:"Dedup",className:P.horizontalInlineLabel,transparent:!0,children:(0,E.jsx)(a.RadioButtonGroup,{options:Object.values(y.LogsDedupStrategy).map((e=>({label:(0,F.capitalize)(e),value:e,description:y.LogsDedupDescription[e]}))),value:O,onChange:this.onChangeDedup,className:P.radioButtons})})]}),(0,E.jsx)("div",{children:(0,E.jsx)(a.InlineField,{label:"Display results",className:P.horizontalInlineLabel,transparent:!0,children:(0,E.jsx)(a.RadioButtonGroup,{disabled:N,options:[{label:"Newest first",value:y.LogsSortOrder.Descending,description:"Show results newest to oldest"},{label:"Oldest first",value:y.LogsSortOrder.Ascending,description:"Show results oldest to newest"}],value:D,onChange:this.onChangeLogsSortOrder,className:P.radioButtons})})})]}),(0,E.jsx)(it,{logRows:i,meta:s||[],dedupStrategy:O,dedupCount:W,hasUnescapedContent:B,forceEscape:H,showDetectedFields:$,onEscapeNewlines:this.onEscapeNewlines,clearDetectedFields:this.clearDetectedFields}),(0,E.jsxs)("div",{className:P.logsSection,children:[(0,E.jsx)("div",{className:P.logRows,"data-testid":"logRows",children:(0,E.jsx)(a.LogRows,{logRows:i,deduplicatedRows:q,dedupStrategy:O,getRowContext:this.props.getRowContext,onClickFilterLabel:h,onClickFilterOutLabel:p,showContextToggle:f,showLabels:T,showTime:I,enableLogDetails:!0,forceEscape:H,wrapLogMessage:z,prettifyLogMessage:k,timeZone:u,getFieldLinks:b,logsSortOrder:D,showDetectedFields:$,onClickShowDetectedField:this.showDetectedField,onClickHideDetectedField:this.hideDetectedField})}),(0,E.jsx)(ht,{logsSortOrder:D,visibleRange:null!=_?_:x,absoluteRange:x,timeZone:u,onChangeTime:v,loading:c,queries:null!=S?S:[],scrollToTopLogs:this.scrollToTopLogs,addResultsToCache:j,clearCache:R})]}),!c&&!A&&!g&&(0,E.jsxs)("div",{className:P.noData,children:["No logs found.",(0,E.jsx)(a.Button,{size:"xs",fill:"text",onClick:this.onClickScan,children:"Scan for older logs"})]}),g&&(0,E.jsxs)("div",{className:P.noData,children:[(0,E.jsx)("span",{children:Z}),(0,E.jsx)(a.Button,{size:"xs",fill:"text",onClick:this.onClickStopScan,children:"Stop scan"})]})]})}}const Ct=(0,a.withTheme2)(jt),Tt=(e,t)=>({noData:s.css`
      > * {
        margin-left: 0.5em;
      }
    `,logOptions:s.css`
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      flex-wrap: wrap;
      background-color: ${e.colors.background.primary};
      padding: ${e.spacing(1,2)};
      border-radius: ${e.shape.borderRadius()};
      margin: ${e.spacing(2,0,1)};
      border: 1px solid ${e.colors.border.medium};
    `,headerButton:s.css`
      margin: ${e.spacing(.5,0,0,1)};
    `,horizontalInlineLabel:s.css`
      > label {
        margin-right: 0;
      }
    `,horizontalInlineSwitch:s.css`
      padding: 0 ${e.spacing(1)} 0 0;
    `,radioButtons:s.css`
      margin: 0;
    `,logsSection:s.css`
      display: flex;
      flex-direction: row;
      justify-content: space-between;
    `,logRows:s.css`
      overflow-x: ${t?"unset":"scroll"};
      overflow-y: visible;
      width: 100%;
    `}),It=(0,f.Z)((()=>({logsEnter:s.css`
      label: logsEnter;
      position: absolute;
      opacity: 0;
      height: auto;
      width: 100%;
    `,logsEnterActive:s.css`
      label: logsEnterActive;
      opacity: 1;
      transition: opacity ${500}ms ease-out ${100}ms;
    `,logsExit:s.css`
      label: logsExit;
      position: absolute;
      opacity: 1;
      height: auto;
      width: 100%;
    `,logsExitActive:s.css`
      label: logsExitActive;
      opacity: 0;
      transition: opacity ${500}ms ease-out ${100}ms;
    `})));function zt(e){const{visible:t,children:i}=e,s=It();return(0,E.jsx)(ke.Z,{in:t,mountOnEnter:!0,unmountOnExit:!0,timeout:600,classNames:{enter:s.logsEnter,enterActive:s.logsEnterActive,exit:s.logsExit,exitActive:s.logsExitActive},children:i})}var Ft=i(67892);function kt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Ot extends o.PureComponent{constructor(){super(...arguments),kt(this,"onChangeTime",(e=>{const{exploreId:t,updateTimeRange:i}=this.props;i({exploreId:t,absoluteRange:e})})),kt(this,"getLogRowContext",(async(e,t)=>{const{datasourceInstance:i,logsQueries:s}=this.props;if((0,y.hasLogsContextSupport)(i)){const o=(null!=s?s:[]).find((t=>t.refId===e.dataFrame.refId&&null!=t.datasource&&t.datasource.type===i.type));return i.getLogRowContext(e,t,o)}return[]})),kt(this,"showContextToggle",(e=>{const{datasourceInstance:t}=this.props;return!!(0,y.hasLogsContextSupport)(t)&&t.showContextToggle(e)})),kt(this,"getFieldLinks",((e,t)=>{const{splitOpen:i,range:s}=this.props;return(0,Ft.a)({field:e,rowIndex:t,splitOpenFn:i,range:s})}))}render(){var e;const{loading:t,loadingState:i,logRows:o,logsMeta:r,logsSeries:n,logsQueries:l,logsVolumeData:c,loadLogsVolumeData:d,onClickFilterLabel:h,onClickFilterOutLabel:p,onStartScanning:u,onStopScanning:g,absoluteRange:m,timeZone:f,visibleRange:y,scanning:x,range:v,width:b,splitOpen:w,isLive:S,exploreId:R,addResultsToCache:j,clearCache:C}=this.props;if(!o)return null;const T=s.css`
      & > div {
        overflow: visible;
        & > div {
          overflow: visible;
        }
      }
    `;return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(zt,{visible:S,children:(0,E.jsx)(a.Collapse,{label:"Logs",loading:!1,isOpen:!0,children:(0,E.jsx)(Ee,{exploreId:R,children:e=>(0,E.jsx)(Ge,{logRows:o,timeZone:f,stopLive:e.stop,isPaused:this.props.isPaused,onPause:e.pause,onResume:e.resume})})})}),(0,E.jsx)(zt,{visible:!S,children:(0,E.jsx)(a.Collapse,{label:"Logs",loading:t,isOpen:!0,className:T,children:(0,E.jsx)(Ct,{exploreId:R,datasourceType:null===(e=this.props.datasourceInstance)||void 0===e?void 0:e.type,logRows:o,logsMeta:r,logsSeries:n,logsVolumeData:c,logsQueries:l,width:b,splitOpen:w,loading:t,loadingState:i,loadLogsVolumeData:d,onChangeTime:this.onChangeTime,onClickFilterLabel:h,onClickFilterOutLabel:p,onStartScanning:u,onStopScanning:g,absoluteRange:m,visibleRange:y,timeZone:f,scanning:x,scanRange:v.raw,showContextToggle:this.showContextToggle,getRowContext:this.getLogRowContext,getFieldLinks:this.getFieldLinks,addResultsToCache:()=>j(R),clearCache:()=>C(R)})})})]})}}const Lt={updateTimeRange:Ne.cD,splitOpen:p.bW,addResultsToCache:u.K8,clearCache:u.LK,loadLogsVolumeData:u.QH},Dt=(0,r.connect)((function(e,t){let{exploreId:i}=t;const s=e.explore[i],{logsResult:o,loading:r,scanning:n,datasourceInstance:a,isLive:l,isPaused:c,range:d,absoluteRange:h,logsVolumeDataProvider:p,logsVolumeData:u}=s,g=(0,w.Z)(e.user);return{loading:r,logRows:null==o?void 0:o.rows,logsMeta:null==o?void 0:o.meta,logsSeries:null==o?void 0:o.series,logsQueries:null==o?void 0:o.queries,visibleRange:null==o?void 0:o.visibleRange,scanning:n,timeZone:g,datasourceInstance:a,isLive:l,isPaused:c,range:d,absoluteRange:h,logsVolumeDataProvider:p,logsVolumeData:u}}),Lt)(Ot),Nt=()=>{const e=(0,a.useStyles2)(Et);return(0,E.jsx)(E.Fragment,{children:(0,E.jsx)(a.PanelContainer,{"data-testid":"explore-no-data",className:e.wrapper,children:(0,E.jsx)("span",{className:e.message,children:"No data"})})})},Et=e=>({wrapper:s.css`
    label: no-data-card;
    padding: ${e.spacing(3)};
    background: ${e.colors.background.primary};
    border-radius: ${e.shape.borderRadius(2)};
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex-grow: 1;
  `,message:s.css`
    font-size: ${e.typography.h2.fontSize};
    padding: ${e.spacing(4)};
    color: ${e.colors.text.disabled};
  `});var $t,Ht;const Pt=()=>{const e=(0,a.useTheme2)(),t=be.Vt.hasPermission(P.bW.DataSourcesCreate)&&be.Vt.hasPermission(P.bW.DataSourcesWrite),i=(0,E.jsxs)(E.Fragment,{children:[$t||($t=(0,E.jsx)(a.Icon,{name:"rocket"})),(0,E.jsx)(E.Fragment,{children:" ProTip: You can also define data sources through configuration files. "}),Ht||(Ht=(0,E.jsx)("a",{href:"http://docs.grafana.org/administration/provisioning/#datasources?utm_source=explore",target:"_blank",rel:"noreferrer",className:"text-link",children:"Learn more"}))]}),o=(0,E.jsx)(a.LinkButton,{size:"lg",href:"datasources/new",icon:"database",disabled:!t,children:"Add data source"}),r=s.css`
    max-width: ${e.breakpoints.values.lg}px;
    margin-top: ${e.spacing(2)};
    align-self: center;
  `;return(0,E.jsx)(a.CallToActionCard,{callToActionElement:o,className:r,footer:i,message:"Explore requires at least one data source. Once you have added a data source, you can query it here."})};var At,Bt=i(50962),Mt=i(66767),qt=i(87900),Wt=i(41073);const _t=e=>({warningText:s.css`
    label: warningText;
    font-size: ${e.typography.bodySmall.fontSize};
    color: ${e.colors.text.secondary};
  `});const Zt={splitOpen:p.bW},Qt=(0,r.connect)((function(e,t){let{exploreId:i}=t;return{range:e.explore[i].range}}),Zt)((function(e){var t;const{dataFrames:i,range:s,splitOpen:r,withTraceView:l,datasourceType:c}=e,d=(0,Ft.u)(s,r),h=(0,a.useTheme2)(),p=(0,a.useStyles2)(_t),u=(0,y.applyFieldOverrides)({fieldConfig:{defaults:{},overrides:[]},data:i,replaceVariables:e=>e,theme:h}),{nodes:g}=(0,Wt.Y)(u),[m,f]=(0,Bt.Z)(!1),{height:x}=(0,Mt.Z)(),v=(0,o.useRef)(null),[b,w]=(0,o.useState)(250);(0,o.useEffect)((()=>{if(v.current){const{top:e}=v.current.getBoundingClientRect();w(e)}}),[v]);const S=x-b-32,R=l&&(null===(t=g[0])||void 0===t?void 0:t.length)>1e3?(0,E.jsxs)("span",{className:p.warningText,children:[" (",g[0].length," nodes, can be slow to load)"]}):null;return(0,E.jsx)(a.Collapse,{label:(0,E.jsxs)("span",{children:["Node graph",R," ",At||(At=(0,E.jsx)(a.Badge,{text:"Beta",color:"blue",icon:"rocket",tooltip:"This visualization is in beta"}))]}),collapsible:l,isOpen:!l||m,onToggle:l?()=>(f(),void(0,n.reportInteraction)("grafana_traces_node_graph_panel_clicked",{datasourceType:c,expanded:!m})):void 0,children:(0,E.jsx)("div",{ref:v,style:l?{height:500}:{minHeight:600,height:S},children:(0,E.jsx)(qt.E,{dataFrames:u,getLinks:d})})})}));var Vt=i(98335),Ut=i(65184),Kt=i(67436),Gt=i(56303);const Yt=e=>{let{exploreId:t}=e;const i=(0,r.useDispatch)(),{getQueries:s,getDatasourceInstanceSettings:n,getQueryResponse:a,getHistory:l,getEventBridge:c}=(0,o.useMemo)((()=>(e=>{const t=(0,g.F)(e);return{getQueries:(0,Vt.P1)(t,(e=>e.queries)),getQueryResponse:(0,Vt.P1)(t,(e=>e.queryResponse)),getHistory:(0,Vt.P1)(t,(e=>e.history)),getEventBridge:(0,Vt.P1)(t,(e=>e.eventBridge)),getDatasourceInstanceSettings:(0,Vt.P1)(t,(e=>{var t;return(0,Kt.ak)().getInstanceSettings(null===(t=e.datasourceInstance)||void 0===t?void 0:t.uid)}))}})(t)),[t]),d=(0,r.useSelector)(s),h=(0,r.useSelector)(n),p=(0,r.useSelector)(a),m=(0,r.useSelector)(l),f=(0,r.useSelector)(c),x=(0,o.useCallback)((()=>{i((0,u.aA)(t))}),[i,t]),v=(0,o.useCallback)((e=>{i((0,u.PM)({queries:e,exploreId:t})),e.length<d.length&&x()}),[i,t,x,d]),b=(0,o.useCallback)((e=>{v([...d,Object.assign({},e,{refId:(0,Ut.Hs)(d)})])}),[v,d]);return(0,E.jsx)(Gt.l,{dsSettings:h,queries:d,onQueriesChange:v,onAddQuery:b,onRunQueries:x,data:p,app:y.CoreApp.Explore,history:m,eventBus:f})};var Xt=i(88917);const Jt=e=>{const t={transition:`opacity ${e.duration}ms linear`,opacity:0},i={exited:{opacity:0,display:"none"},entering:{opacity:0},entered:{opacity:1},exiting:{opacity:0}};return(0,E.jsx)(Xt.ZP,{in:e.in,timeout:e.duration,unmountOnExit:e.unmountOnExit||!1,onExited:e.onExited,children:s=>(0,E.jsx)("div",{style:Object.assign({},t,i[s]),children:e.children})})},ei=e=>{var t;const{queryError:i}=e,s=!!i,o=s?100:10,r=i?"Query error":"Unknown error",n=(null==i?void 0:i.message)||(null==i||null===(t=i.data)||void 0===t?void 0:t.message)||null;return(0,E.jsx)(Jt,{in:s,duration:o,children:(0,E.jsx)(a.Alert,{severity:"error",title:r,topSpacing:2,children:n})})};function ti(e){const t=(0,r.useSelector)((t=>{var i;return null===(i=t.explore[e.exploreId])||void 0===i?void 0:i.queryResponse})),i=(null==t?void 0:t.state)===y.LoadingState.Error?null==t?void 0:t.error:void 0;return null!=i&&i.refId?null:(0,E.jsx)(ei,{queryError:i})}var ii=i(76223),si=i(17763),oi=i(36537),ri=i(58257),ni=i(56340);const ai={changeDatasource:De.zU,deleteHistoryItem:ii.NV,commentHistoryItem:ii.Ff,starHistoryItem:ii.ev,setQueries:u.KO},li=(0,r.connect)((function(e,t){let{exploreId:i}=t;const s=e.explore,{datasourceInstance:o}=s[i];return{exploreId:i,datasourceInstance:o}}),ai),ci=(0,a.stylesFactory)(((e,t)=>{const i="240px",o="170px",r=e.colors.bg2;return{queryCard:s.css`
      display: flex;
      flex-direction: column;
      border: 1px solid ${e.colors.border1};
      margin: ${e.spacing.sm} 0;
      background-color: ${r};
      border-radius: ${e.border.radius.sm};
      .starred {
        color: ${e.palette.orange};
      }
    `,cardRow:s.css`
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: ${e.spacing.sm};
      border-bottom: none;
      :first-of-type {
        border-bottom: 1px solid ${e.colors.border1};
        padding: ${e.spacing.xs} ${e.spacing.sm};
      }
      img {
        height: ${e.typography.size.base};
        max-width: ${e.typography.size.base};
        margin-right: ${e.spacing.sm};
      }
    `,datasourceContainer:s.css`
      display: flex;
      align-items: center;
      font-size: ${e.typography.size.sm};
      font-weight: ${e.typography.weight.semibold};
    `,queryActionButtons:s.css`
      max-width: ${o};
      display: flex;
      justify-content: flex-end;
      font-size: ${e.typography.size.base};
      button {
        margin-left: ${e.spacing.sm};
      }
    `,queryContainer:s.css`
      font-weight: ${e.typography.weight.semibold};
      width: calc(100% - ${i});
    `,queryRow:s.css`
      border-top: 1px solid ${e.colors.border1};
      word-break: break-all;
      padding: 4px 2px;
      :first-child {
        border-top: none;
        padding: 0 0 4px 0;
      }
    `,updateCommentContainer:s.css`
      width: calc(100% + ${i});
      margin-top: ${e.spacing.sm};
    `,comment:s.css`
      overflow-wrap: break-word;
      font-size: ${e.typography.size.sm};
      font-weight: ${e.typography.weight.regular};
      margin-top: ${e.spacing.xs};
    `,commentButtonRow:s.css`
      > * {
        margin-right: ${e.spacing.sm};
      }
    `,textArea:s.css`
      width: 100%;
    `,runButton:s.css`
      max-width: ${o};
      display: flex;
      justify-content: flex-end;
      button {
        height: auto;
        padding: ${e.spacing.xs} ${e.spacing.md};
        line-height: 1.4;
        span {
          white-space: normal !important;
        }
      }
    `}}));const di=li((function(e){var t;const{query:i,dsImg:r,isRemoved:l,commentHistoryItem:c,starHistoryItem:d,deleteHistoryItem:h,changeDatasource:p,exploreId:u,datasourceInstance:g,setQueries:m}=e,[f,y]=(0,o.useState)(!1),[x,v]=(0,o.useState)(i.comment),[w,S]=(0,o.useState)(void 0);(0,o.useEffect)((()=>{(async()=>{const e=await(0,n.getDataSourceSrv)().get(i.datasourceUid);S(e)})()}),[i.datasourceUid]);const R=(0,a.useTheme)(),j=ci(R,l),T=()=>{c(i.id,x),y(!1),(0,n.reportInteraction)("grafana_explore_query_history_commented",{queryHistoryEnabled:n.config.queryHistoryEnabled})},I=()=>{y(!1),v(i.comment)},F=(0,E.jsxs)("div",{className:j.updateCommentContainer,"aria-label":x?"Update comment form":"Add comment form",children:[(0,E.jsx)(a.TextArea,{value:x,placeholder:x?void 0:"An optional description of what the query does.",onChange:e=>v(e.currentTarget.value),className:j.textArea}),(0,E.jsxs)("div",{className:j.commentButtonRow,children:[(0,E.jsx)(a.Button,{onClick:T,"aria-label":"Submit button",children:"Save comment"}),(0,E.jsx)(a.Button,{variant:"secondary",onClick:I,children:"Cancel"})]})]}),k=(0,E.jsxs)("div",{className:j.queryActionButtons,children:[(0,E.jsx)(a.IconButton,{name:"comment-alt",onClick:()=>y(!f),title:(null===(t=i.comment)||void 0===t?void 0:t.length)>0?"Edit comment":"Add comment"}),(0,E.jsx)(a.IconButton,{name:"copy",onClick:()=>{const e=i.queries.map((e=>(0,si.OH)(e,w))).join("\n");(0,b.n9)(e),(0,ni.WI)((0,oi.$l)((0,ri.AT)("Query copied to clipboard")))},title:"Copy query to clipboard"}),!l&&(0,E.jsx)(a.IconButton,{name:"share-alt",onClick:async()=>{const e=(0,si.t2)(i);await(0,we.L)(e)},title:"Copy shortened link to clipboard"}),(0,E.jsx)(a.IconButton,{name:"trash-alt",title:"Delete query",onClick:()=>{const e=e=>{h(e),(0,ni.WI)((0,oi.$l)((0,ri.AT)("Query deleted"))),(0,n.reportInteraction)("grafana_explore_query_history_deleted",{queryHistoryEnabled:n.config.queryHistoryEnabled})};i.starred?C.Z.publish(new z.VJ({title:"Delete",text:"Are you sure you want to permanently delete your starred query?",yesText:"Delete",icon:"trash-alt",onConfirm:()=>e(i.id)})):e(i.id)}}),(0,E.jsx)(a.IconButton,{name:i.starred?"favorite":"star",iconType:i.starred?"mono":"default",onClick:()=>{d(i.id,!i.starred),(0,n.reportInteraction)("grafana_explore_query_history_starred",{queryHistoryEnabled:n.config.queryHistoryEnabled,newValue:!i.starred})},title:i.starred?"Unstar query":"Star query"})]});return(0,E.jsxs)("div",{className:j.queryCard,onKeyDown:e=>{"Enter"===e.key&&(e.shiftKey||e.ctrlKey)&&T(),"Escape"===e.key&&I()},children:[(0,E.jsxs)("div",{className:j.cardRow,children:[(0,E.jsxs)("div",{className:j.datasourceContainer,children:[(0,E.jsx)("img",{src:r,"aria-label":"Data source icon"}),(0,E.jsx)("div",{"aria-label":"Data source name",children:l?"Data source does not exist anymore":i.datasourceName})]}),k]}),(0,E.jsxs)("div",{className:(0,s.cx)(j.cardRow),children:[(0,E.jsxs)("div",{className:j.queryContainer,children:[i.queries.map(((e,t)=>{const i=(0,si.OH)(e,w);return(0,E.jsx)("div",{"aria-label":"Query text",className:j.queryRow,children:i},`${e}-${t}`)})),!f&&i.comment&&(0,E.jsx)("div",{"aria-label":"Query comment",className:j.comment,children:i.comment}),f&&F]}),!f&&(0,E.jsx)("div",{className:j.runButton,children:(0,E.jsx)(a.Button,{variant:"secondary",onClick:async()=>{const e=i.queries,t=i.datasourceUid!==(null==g?void 0:g.uid);t?(await p(u,i.datasourceUid,{importQueries:!0}),m(u,e)):m(u,e),(0,n.reportInteraction)("grafana_explore_query_history_run",{queryHistoryEnabled:n.config.queryHistoryEnabled,differentDataSource:t})},disabled:l,children:(null==g?void 0:g.uid)===i.datasourceUid?"Run query":"Switch data source and run query"})})]})]})}));var hi,pi;const ui=(0,a.stylesFactory)(((e,t)=>{const i=e.isLight?e.palette.gray5:e.palette.dark4;return{container:s.css`
      display: flex;
    `,labelSlider:s.css`
      font-size: ${e.typography.size.sm};
      &:last-of-type {
        margin-top: ${e.spacing.lg};
      }
      &:first-of-type {
        font-weight: ${e.typography.weight.semibold};
        margin-bottom: ${e.spacing.md};
      }
    `,containerContent:s.css`
      /* 134px is based on the width of the Query history tabs bar, so the content is aligned to right side of the tab */
      width: calc(100% - 134px);
    `,containerSlider:s.css`
      width: 129px;
      margin-right: ${e.spacing.sm};
    `,fixedSlider:s.css`
      position: fixed;
    `,slider:s.css`
      bottom: 10px;
      height: ${t-180}px;
      width: 129px;
      padding: ${e.spacing.sm} 0;
    `,selectors:s.css`
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    `,filterInput:s.css`
      margin-bottom: ${e.spacing.sm};
    `,multiselect:s.css`
      width: 100%;
      margin-bottom: ${e.spacing.sm};
      .gf-form-select-box__multi-value {
        background-color: ${i};
        padding: ${e.spacing.xxs} ${e.spacing.xs} ${e.spacing.xxs} ${e.spacing.sm};
        border-radius: ${e.border.radius.sm};
      }
    `,sort:s.css`
      width: 170px;
    `,sessionName:s.css`
      display: flex;
      align-items: flex-start;
      justify-content: flex-start;
      margin-top: ${e.spacing.lg};
      h4 {
        margin: 0 10px 0 0;
      }
    `,heading:s.css`
      font-size: ${e.typography.heading.h4};
      margin: ${e.spacing.md} ${e.spacing.xxs} ${e.spacing.sm} ${e.spacing.xxs};
    `,footer:s.css`
      height: 60px;
      margin: ${e.spacing.lg} auto;
      display: flex;
      justify-content: center;
      font-weight: ${e.typography.weight.light};
      font-size: ${e.typography.size.sm};
      a {
        font-weight: ${e.typography.weight.semibold};
        margin-left: ${e.spacing.xxs};
      }
    `,queries:s.css`
      font-size: ${e.typography.size.sm};
      font-weight: ${e.typography.weight.regular};
      margin-left: ${e.spacing.xs};
    `}}));function gi(e){const{queries:t,totalQueries:i,loading:s,richHistorySearchFilters:r,updateFilters:l,clearRichHistoryResults:c,loadMoreRichHistory:d,richHistorySettings:h,exploreId:p,height:u,activeDatasourceInstance:g}=e,m=(0,a.useTheme)(),f=ui(m,u),y=(0,si.DR)();if((0,o.useEffect)((()=>{const e=!h.activeDatasourceOnly&&h.lastUsedDatasourceFilters?h.lastUsedDatasourceFilters:[g],t={search:"",sortOrder:si.As.Descending,datasourceFilters:e,from:0,to:h.retentionPeriod,starred:!1};return l(t),()=>{c()}}),[]),!r)return hi||(hi=(0,E.jsx)("span",{children:"Loading..."}));const x=(0,si.k4)(t,r.sortOrder),v=Ci(),b=t.length&&t.length!==i;return(0,E.jsxs)("div",{className:f.container,children:[(0,E.jsx)("div",{className:f.containerSlider,children:(0,E.jsxs)("div",{className:f.fixedSlider,children:[(0,E.jsx)("div",{className:f.labelSlider,children:"Filter history"}),(0,E.jsx)("div",{className:f.labelSlider,children:(0,si.bQ)(r.from)}),(0,E.jsx)("div",{className:f.slider,children:(0,E.jsx)(a.RangeSlider,{tooltipAlwaysVisible:!1,min:0,max:h.retentionPeriod,value:[r.from,r.to],orientation:"vertical",formatTooltipResult:si.bQ,reverse:!0,onAfterChange:e=>{l({from:e[0],to:e[1]})}})}),(0,E.jsx)("div",{className:f.labelSlider,children:(0,si.bQ)(r.to)})]})}),(0,E.jsxs)("div",{className:f.containerContent,children:[(0,E.jsxs)("div",{className:f.selectors,children:[!h.activeDatasourceOnly&&(0,E.jsx)(a.MultiSelect,{className:f.multiselect,options:y.map((e=>({value:e.name,label:e.name}))),value:r.datasourceFilters,placeholder:"Filter queries for data sources(s)","aria-label":"Filter queries for data sources(s)",onChange:e=>{l({datasourceFilters:e.map((e=>e.value))})}}),(0,E.jsx)("div",{className:f.filterInput,children:(0,E.jsx)(a.FilterInput,{placeholder:"Search queries",value:r.search,onChange:e=>l({search:e})})}),(0,E.jsx)("div",{"aria-label":"Sort queries",className:f.sort,children:(0,E.jsx)(a.Select,{value:v.filter((e=>e.value===r.sortOrder)),options:v,placeholder:"Sort queries by",onChange:e=>l({sortOrder:e.value})})})]}),s&&(pi||(pi=(0,E.jsx)("span",{children:"Loading results..."}))),!s&&Object.keys(x).map((e=>(0,E.jsxs)("div",{children:[(0,E.jsxs)("div",{className:f.heading,children:[e," ",(0,E.jsxs)("span",{className:f.queries,children:[b?"Displaying ":"",x[e].length," queries"]})]}),x[e].map((e=>{const t=y.findIndex((t=>t.uid===e.datasourceUid));return(0,E.jsx)(di,{query:e,exploreId:p,dsImg:-1===t?"public/img/icn-datasource.svg":y[t].imgUrl,isRemoved:-1===t},e.id)}))]},e))),b?(0,E.jsxs)("div",{children:["Showing ",t.length," of ",i," ",(0,E.jsx)(a.Button,{onClick:d,children:"Load more"})]}):null,(0,E.jsx)("div",{className:f.footer,children:n.config.queryHistoryEnabled?"":"The history is local to your browser and is not shared with others."})]})]})}var mi=i(57969);const fi=(0,a.stylesFactory)((e=>({container:s.css`
      font-size: ${e.typography.size.sm};
    `,spaceBetween:s.css`
      margin-bottom: ${e.spacing.lg};
    `,input:s.css`
      max-width: 200px;
    `}))),yi=[{value:2,label:"2 days"},{value:5,label:"5 days"},{value:7,label:"1 week"},{value:14,label:"2 weeks"}];function xi(e){const{retentionPeriod:t,starredTabAsFirstTab:i,activeDatasourceOnly:o,onChangeRetentionPeriod:r,toggleStarredTabAsFirstTab:n,toggleactiveDatasourceOnly:l,deleteRichHistory:c}=e,d=(0,a.useTheme)(),h=fi(d),p=yi.find((e=>e.value===t));return(0,E.jsxs)("div",{className:h.container,children:[(0,T.X)().changeRetention?(0,E.jsx)(a.Field,{label:"History time span",description:`Select the period of time for which Grafana will save your query history. Up to ${mi.H6} entries will be stored.`,children:(0,E.jsx)("div",{className:h.input,children:(0,E.jsx)(a.Select,{value:p,options:yi,onChange:r})})}):(0,E.jsxs)(a.Alert,{severity:"info",title:"History time span",children:["Grafana will keep entries up to ",null==p?void 0:p.label,"."]}),(0,E.jsx)(a.InlineField,{label:"Change the default active tab from “Query history” to “Starred”",className:h.spaceBetween,children:(0,E.jsx)(a.InlineSwitch,{id:"explore-query-history-settings-default-active-tab",value:i,onChange:n})}),(0,T.X)().onlyActiveDataSource&&(0,E.jsx)(a.InlineField,{label:"Only show queries for data source currently active in Explore",className:h.spaceBetween,children:(0,E.jsx)(a.InlineSwitch,{id:"explore-query-history-settings-data-source-behavior",value:o,onChange:l})}),(0,T.X)().clearHistory&&(0,E.jsxs)("div",{children:[(0,E.jsx)("div",{className:s.css`
              font-weight: ${d.typography.weight.bold};
            `,children:"Clear query history"}),(0,E.jsx)("div",{className:s.css`
              margin-bottom: ${d.spacing.sm};
            `,children:"Delete all of your query history, permanently."}),(0,E.jsx)(a.Button,{variant:"destructive",onClick:()=>{C.Z.publish(new z.VJ({title:"Delete",text:"Are you sure you want to permanently delete your query history?",yesText:"Delete",icon:"trash-alt",onConfirm:()=>{c(),(0,ni.WI)((0,oi.$l)((0,ri.AT)("Query history deleted")))}}))},children:"Clear query history"})]})]})}var vi,bi;const wi=(0,a.stylesFactory)((e=>{const t=e.isLight?e.palette.gray5:e.palette.dark4;return{container:s.css`
      display: flex;
    `,containerContent:s.css`
      width: 100%;
    `,selectors:s.css`
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    `,multiselect:s.css`
      width: 100%;
      margin-bottom: ${e.spacing.sm};
      .gf-form-select-box__multi-value {
        background-color: ${t};
        padding: ${e.spacing.xxs} ${e.spacing.xs} ${e.spacing.xxs} ${e.spacing.sm};
        border-radius: ${e.border.radius.sm};
      }
    `,filterInput:s.css`
      margin-bottom: ${e.spacing.sm};
    `,sort:s.css`
      width: 170px;
    `,footer:s.css`
      height: 60px;
      margin-top: ${e.spacing.lg};
      display: flex;
      justify-content: center;
      font-weight: ${e.typography.weight.light};
      font-size: ${e.typography.size.sm};
      a {
        font-weight: ${e.typography.weight.semibold};
        margin-left: ${e.spacing.xxs};
      }
    `}}));function Si(e){const{updateFilters:t,clearRichHistoryResults:i,loadMoreRichHistory:s,activeDatasourceInstance:r,richHistorySettings:l,queries:c,totalQueries:d,loading:h,richHistorySearchFilters:p,exploreId:u}=e,g=(0,a.useTheme)(),m=wi(g),f=(0,si.DR)();if((0,o.useEffect)((()=>{const e=l.activeDatasourceOnly&&l.lastUsedDatasourceFilters?l.lastUsedDatasourceFilters:[r],s={search:"",sortOrder:si.As.Descending,datasourceFilters:e,from:0,to:l.retentionPeriod,starred:!0};return t(s),()=>{i()}}),[]),!p)return vi||(vi=(0,E.jsx)("span",{children:"Loading..."}));const y=Ci();return(0,E.jsx)("div",{className:m.container,children:(0,E.jsxs)("div",{className:m.containerContent,children:[(0,E.jsxs)("div",{className:m.selectors,children:[!l.activeDatasourceOnly&&(0,E.jsx)(a.MultiSelect,{className:m.multiselect,options:f.map((e=>({value:e.name,label:e.name}))),value:p.datasourceFilters,placeholder:"Filter queries for data sources(s)","aria-label":"Filter queries for data sources(s)",onChange:e=>{t({datasourceFilters:e.map((e=>e.value))})}}),(0,E.jsx)("div",{className:m.filterInput,children:(0,E.jsx)(a.FilterInput,{placeholder:"Search queries",value:p.search,onChange:e=>t({search:e})})}),(0,E.jsx)("div",{"aria-label":"Sort queries",className:m.sort,children:(0,E.jsx)(a.Select,{value:y.filter((e=>e.value===p.sortOrder)),options:y,placeholder:"Sort queries by",onChange:e=>t({sortOrder:e.value})})})]}),h&&(bi||(bi=(0,E.jsx)("span",{children:"Loading results..."}))),!h&&c.map((e=>{const t=f.findIndex((t=>t.uid===e.datasourceUid));return(0,E.jsx)(di,{query:e,exploreId:u,dsImg:-1===t?"public/img/icn-datasource.svg":f[t].imgUrl,isRemoved:-1===t},e.id)})),c.length&&c.length!==d?(0,E.jsxs)("div",{children:["Showing ",c.length," of ",d," ",(0,E.jsx)(a.Button,{onClick:s,children:"Load more"})]}):null,(0,E.jsx)("div",{className:m.footer,children:n.config.queryHistoryEnabled?"":"The history is local to your browser and is not shared with others."})]})})}function Ri(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}let ji;!function(e){e.RichHistory="Query history",e.Starred="Starred",e.Settings="Settings"}(ji||(ji={}));const Ci=()=>[{label:"Newest first",value:si.As.Descending},{label:"Oldest first",value:si.As.Ascending},{label:"Data source A-Z",value:si.As.DatasourceAZ},{label:"Data source Z-A",value:si.As.DatasourceZA}].filter((e=>(0,T.X)().availableFilters.includes(e.value)));class Ti extends o.PureComponent{constructor(){super(...arguments),Ri(this,"state",{loading:!1}),Ri(this,"updateSettings",(e=>{this.props.updateHistorySettings(Object.assign({},this.props.richHistorySettings,e))})),Ri(this,"updateFilters",(e=>{const t=Object.assign({},this.props.richHistorySearchFilters,e,{page:1});this.props.updateHistorySearchFilters(this.props.exploreId,t),this.loadRichHistory()})),Ri(this,"clearResults",(()=>{this.props.clearRichHistoryResults(this.props.exploreId)})),Ri(this,"loadRichHistory",(0,F.debounce)((()=>{this.props.loadRichHistory(this.props.exploreId),this.setState({loading:!0})}),300)),Ri(this,"onChangeRetentionPeriod",(e=>{void 0!==e.value&&this.updateSettings({retentionPeriod:e.value})})),Ri(this,"toggleStarredTabAsFirstTab",(()=>this.updateSettings({starredTabAsFirstTab:!this.props.richHistorySettings.starredTabAsFirstTab}))),Ri(this,"toggleActiveDatasourceOnly",(()=>this.updateSettings({activeDatasourceOnly:!this.props.richHistorySettings.activeDatasourceOnly})))}componentDidUpdate(e,t,i){e.richHistory!==this.props.richHistory&&this.setState({loading:!1})}render(){const{richHistory:e,richHistoryTotal:t,height:i,exploreId:s,deleteRichHistory:o,onClose:r,firstTab:n,activeDatasourceInstance:l}=this.props,{loading:c}=this.state;let d=[{label:"Query history",value:ji.RichHistory,content:(0,E.jsx)(gi,{queries:e,totalQueries:t||0,loading:c,updateFilters:this.updateFilters,clearRichHistoryResults:()=>this.props.clearRichHistoryResults(this.props.exploreId),loadMoreRichHistory:()=>this.props.loadMoreRichHistory(this.props.exploreId),activeDatasourceInstance:l,richHistorySettings:this.props.richHistorySettings,richHistorySearchFilters:this.props.richHistorySearchFilters,exploreId:s,height:i}),icon:"history"},{label:"Starred",value:ji.Starred,content:(0,E.jsx)(Si,{queries:e,totalQueries:t||0,loading:c,activeDatasourceInstance:l,updateFilters:this.updateFilters,clearRichHistoryResults:()=>this.props.clearRichHistoryResults(this.props.exploreId),loadMoreRichHistory:()=>this.props.loadMoreRichHistory(this.props.exploreId),richHistorySettings:this.props.richHistorySettings,richHistorySearchFilters:this.props.richHistorySearchFilters,exploreId:s}),icon:"star"},{label:"Settings",value:ji.Settings,content:(0,E.jsx)(xi,{retentionPeriod:this.props.richHistorySettings.retentionPeriod,starredTabAsFirstTab:this.props.richHistorySettings.starredTabAsFirstTab,activeDatasourceOnly:this.props.richHistorySettings.activeDatasourceOnly,onChangeRetentionPeriod:this.onChangeRetentionPeriod,toggleStarredTabAsFirstTab:this.toggleStarredTabAsFirstTab,toggleactiveDatasourceOnly:this.toggleActiveDatasourceOnly,deleteRichHistory:o}),icon:"sliders-v-alt"}];return(0,E.jsx)(a.TabbedContainer,{tabs:d,onClose:r,defaultTab:n,closeIconTooltip:"Close query history"})}}const Ii=(0,a.withTheme)(Ti);var zi;const Fi={initRichHistory:ii.sO,loadRichHistory:ii.TV,loadMoreRichHistory:ii.io,clearRichHistoryResults:ii.Cs,updateHistorySettings:ii.ch,updateHistorySearchFilters:ii.KZ,deleteRichHistory:ii.ik},ki=(0,r.connect)((function(e,t){let{exploreId:i}=t;const s=e.explore,o=s[i],r=o.richHistorySearchFilters,n=s.richHistorySettings,{datasourceInstance:a}=o,l=null!=n&&n.starredTabAsFirstTab?ji.Starred:ji.RichHistory,{richHistory:c,richHistoryTotal:d}=o;return{richHistory:c,richHistoryTotal:d,firstTab:l,activeDatasourceInstance:a.name,richHistorySettings:n,richHistorySearchFilters:r}}),Fi);const Oi=ki((function(e){const t=(0,a.useTheme2)(),[i,s]=(0,o.useState)(t.components.horizontalDrawer.defaultHeight),{richHistory:r,richHistoryTotal:l,width:c,firstTab:d,activeDatasourceInstance:h,exploreId:p,deleteRichHistory:u,initRichHistory:g,loadRichHistory:m,loadMoreRichHistory:f,clearRichHistoryResults:y,richHistorySettings:x,updateHistorySettings:v,richHistorySearchFilters:b,updateHistorySearchFilters:w,onClose:S}=e;return(0,o.useEffect)((()=>{g(),(0,n.reportInteraction)("grafana_explore_query_history_opened",{queryHistoryEnabled:n.config.queryHistoryEnabled})}),[g]),x?(0,E.jsx)(pe,{width:c,onResize:(e,t,i)=>{s(Number(i.style.height.slice(0,-2)))},children:(0,E.jsx)(Ii,{richHistory:r,richHistoryTotal:l,firstTab:d,activeDatasourceInstance:h,exploreId:p,onClose:S,height:i,deleteRichHistory:u,richHistorySettings:x,richHistorySearchFilters:b,updateHistorySettings:v,updateHistorySearchFilters:w,loadRichHistory:m,loadMoreRichHistory:f,clearRichHistoryResults:y})}):zi||(zi=(0,E.jsx)("span",{children:"Loading..."}))}));function Li(e){const t=(e=>({containerMargin:s.css`
      margin-top: ${e.spacing(2)};
    `}))((0,a.useTheme2)());return(0,E.jsx)("div",{className:t.containerMargin,children:(0,E.jsxs)(a.HorizontalGroup,{children:[!e.addQueryRowButtonHidden&&(0,E.jsx)(a.Button,{variant:"secondary","aria-label":"Add row button",onClick:e.onClickAddQueryRowButton,disabled:e.addQueryRowButtonDisabled,icon:"plus",children:"Add query"}),!e.richHistoryRowButtonHidden&&(0,E.jsx)(a.Button,{variant:"secondary","aria-label":"Rich history button",className:(0,s.cx)({"explore-active-button":e.richHistoryButtonActive}),onClick:e.onClickRichHistoryButton,icon:"history",children:"Query history"}),(0,E.jsx)(a.Button,{variant:"secondary","aria-label":"Query inspector button",className:(0,s.cx)({"explore-active-button":e.queryInspectorButtonActive}),onClick:e.onClickQueryInspectorButton,icon:"info-circle",children:"Inspector"})]})})}var Di=i(78837),Ni=i(65747);const Ei={splitOpen:p.bW},$i=(0,r.connect)((function(e,t){let{exploreId:i}=t;const s=e.explore[i],{loading:o,tableResult:r,range:n}=s;return{loading:!(r&&r.length>0)&&o,tableResult:r,range:n}}),Ei);class Hi extends o.PureComponent{getTableHeight(){const{tableResult:e}=this.props;return e&&0!==e.length?Math.max(Math.min(600,35*e.length)+35):200}render(){var e,t;const{loading:i,onCellFilterAdded:s,tableResult:o,width:r,splitOpen:n,range:l,ariaLabel:c,timeZone:d}=this.props,h=this.getTableHeight(),p=r-2*Di.vc.theme.panelPadding-Ni.QO;let u=o;if(null!==(e=u)&&void 0!==e&&e.length){u=(0,y.applyFieldOverrides)({data:[u],timeZone:d,theme:Di.vc.theme2,replaceVariables:e=>e,fieldConfig:{defaults:{},overrides:[]}})[0];for(const e of u.fields)e.getLinks=t=>(0,Ft.a)({field:e,rowIndex:t.valueRowIndex,splitOpenFn:n,range:l,dataFrame:u})}return(0,E.jsx)(a.Collapse,{label:"Table",loading:i,isOpen:!0,children:null!==(t=u)&&void 0!==t&&t.length?(0,E.jsx)(a.Table,{ariaLabel:c,data:u,width:p,height:h,onCellFilterAdded:s}):(0,E.jsx)(tt,{metaItems:[{value:"0 series returned"}]})})}}const Pi=$i(Hi);var Ai=i(31741),Bi=i(39306),Mi=i(12579),qi=i(61597),Wi=i(91079);function _i(e){const t=e.dataFrames[0],{dataFrames:i,splitOpenFn:s,exploreId:n,scrollElement:l,topOfViewRef:c,queryResponse:d}=e,h=(0,o.useMemo)((()=>(0,Wi.N)(t)),[t]),{search:p,setSearch:u,spanFindMatches:g}=(0,qi.R)(null==h?void 0:h.spans),[m,f]=(0,o.useState)(""),[y,x]=(0,o.useState)(""),v=(0,r.useSelector)((t=>{var i,s;return null!==(i=null===(s=t.explore[e.exploreId])||void 0===s?void 0:s.datasourceInstance)&&void 0!==i?i:void 0}));return h?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(Ai.Z,{navigable:!0,searchValue:p,setSearch:u,spanFindMatches:g,searchBarSuffix:y,setSearchBarSuffix:x,focusedSpanIdForSearch:m,setFocusedSpanIdForSearch:f}),(0,E.jsx)(a.Collapse,{label:"Trace View",isOpen:!0,children:(0,E.jsx)(Mi.m,{exploreId:n,dataFrames:i,splitOpenFn:s,scrollElement:l,traceProp:h,spanFindMatches:g,search:p,focusedSpanIdForSearch:m,queryResponse:d,datasource:v,topOfViewRef:c,topOfViewRefType:Bi.l4.Explore})})]}):null}var Zi,Qi,Vi=i(52765);function Ui(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Ki;!function(e){e[e.RichHistory=0]="RichHistory",e[e.QueryInspector=1]="QueryInspector"}(Ki||(Ki={}));class Gi extends o.PureComponent{constructor(e){super(e),Ui(this,"scrollElement",void 0),Ui(this,"absoluteTimeUnsubsciber",void 0),Ui(this,"topOfViewRef",(0,o.createRef)()),Ui(this,"onChangeTime",(e=>{const{updateTimeRange:t,exploreId:i}=this.props;t({exploreId:i,rawRange:e})})),Ui(this,"onClickExample",(e=>{this.props.setQueries(this.props.exploreId,[e])})),Ui(this,"onCellFilterAdded",(e=>{const{value:t,key:i,operator:s}=e;s===j.PT&&this.onClickFilterLabel(i,t),s===j.tE&&this.onClickFilterOutLabel(i,t)})),Ui(this,"onClickFilterLabel",((e,t)=>{this.onModifyQueries({type:"ADD_FILTER",options:{key:e,value:t}})})),Ui(this,"onClickFilterOutLabel",((e,t)=>{this.onModifyQueries({type:"ADD_FILTER_OUT",options:{key:e,value:t}})})),Ui(this,"onClickAddQueryRowButton",(()=>{const{exploreId:e,queryKeys:t,datasourceInstance:i}=this.props;this.props.addQueryRow(e,t.length,i)})),Ui(this,"onMakeAbsoluteTime",(()=>{const{makeAbsoluteTime:e}=this.props;e()})),Ui(this,"onModifyQueries",((e,t)=>{const{datasourceInstance:i}=this.props;if(null!=i&&i.modifyQuery){const s=(e,t)=>i.modifyQuery(e,t);this.props.modifyQueries(this.props.exploreId,e,s,t)}})),Ui(this,"onResize",(e=>{this.props.changeSize(this.props.exploreId,e)})),Ui(this,"onStartScanning",(()=>{this.props.scanStart(this.props.exploreId)})),Ui(this,"onStopScanning",(()=>{this.props.scanStopAction({exploreId:this.props.exploreId})})),Ui(this,"onUpdateTimeRange",(e=>{const{exploreId:t,updateTimeRange:i}=this.props;i({exploreId:t,absoluteRange:e})})),Ui(this,"onChangeGraphStyle",(e=>{const{exploreId:t,changeGraphStyle:i}=this.props;i(t,e)})),Ui(this,"toggleShowRichHistory",(()=>{this.setState((e=>({openDrawer:e.openDrawer===Ki.RichHistory?void 0:Ki.RichHistory})))})),Ui(this,"toggleShowQueryInspector",(()=>{this.setState((e=>({openDrawer:e.openDrawer===Ki.QueryInspector?void 0:Ki.QueryInspector})))})),Ui(this,"memoizedGetNodeGraphDataFrames",(0,f.Z)(I.Ee)),this.state={openDrawer:void 0}}componentDidMount(){this.absoluteTimeUnsubsciber=C.Z.subscribe(z.QI,this.onMakeAbsoluteTime)}componentWillUnmount(){var e;null===(e=this.absoluteTimeUnsubsciber)||void 0===e||e.unsubscribe()}renderEmptyState(e){return(0,E.jsx)("div",{className:(0,s.cx)(e),children:Zi||(Zi=(0,E.jsx)(Pt,{}))})}renderNoData(){return Qi||(Qi=(0,E.jsx)(Nt,{}))}renderGraphPanel(e){const{graphResult:t,absoluteRange:i,timeZone:s,splitOpen:o,queryResponse:r,loading:n,theme:l,graphStyle:c}=this.props,d=parseInt(l.spacing(2).slice(0,-2),10),h=(0,E.jsx)(M,{graphStyle:c,onChangeGraphStyle:this.onChangeGraphStyle});return(0,E.jsx)(a.Collapse,{label:h,loading:n,isOpen:!0,children:(0,E.jsx)($,{graphStyle:c,data:t,height:400,width:e-d,absoluteRange:i,onChangeTime:this.onUpdateTimeRange,timeZone:s,annotations:r.annotations,splitOpenFn:o,loadingState:r.state})})}renderTablePanel(e){const{exploreId:t,datasourceInstance:i,timeZone:s}=this.props;return(0,E.jsx)(Pi,{ariaLabel:x.wl.pages.Explore.General.table,width:e,exploreId:t,onCellFilterAdded:null!=i&&i.modifyQuery?this.onCellFilterAdded:void 0,timeZone:s})}renderLogsPanel(e){const{exploreId:t,syncedTimes:i,theme:s,queryResponse:o}=this.props,r=parseInt(s.spacing(2).slice(0,-2),10);return(0,E.jsx)(Dt,{exploreId:t,loadingState:o.state,syncedTimes:i,width:e-r,onClickFilterLabel:this.onClickFilterLabel,onClickFilterOutLabel:this.onClickFilterOutLabel,onStartScanning:this.onStartScanning,onStopScanning:this.onStopScanning})}renderNodeGraphPanel(){const{exploreId:e,showTrace:t,queryResponse:i,datasourceInstance:s}=this.props,o=s?null==s?void 0:s.type:"unknown";return(0,E.jsx)(Qt,{dataFrames:this.memoizedGetNodeGraphDataFrames(i.series),exploreId:e,withTraceView:t,datasourceType:o})}renderTraceViewPanel(){const{queryResponse:e,splitOpen:t,exploreId:i}=this.props,s=e.series.filter((e=>{var t;return"trace"===(null===(t=e.meta)||void 0===t?void 0:t.preferredVisualisationType)}));return s.length&&(0,E.jsx)(_i,{exploreId:i,dataFrames:s,splitOpenFn:t,scrollElement:this.scrollElement,queryResponse:e,topOfViewRef:this.topOfViewRef})}render(){const{datasourceInstance:e,datasourceMissing:t,exploreId:i,graphResult:o,queryResponse:r,isLive:n,theme:l,showMetrics:c,showTable:d,showLogs:h,showTrace:p,showNodeGraph:u,timeZone:g}=this.props,{openDrawer:m}=this.state,f=(e=>({exploreMain:s.css`
      label: exploreMain;
      // Is needed for some transition animations to work.
      position: relative;
      margin-top: 21px;
    `,button:s.css`
      label: button;
      margin: 1em 4px 0 0;
    `,queryContainer:s.css`
      label: queryContainer;
      // Need to override normal css class and don't want to count on ordering of the classes in html.
      height: auto !important;
      flex: unset !important;
      display: unset !important;
      padding: ${e.spacing(1)};
    `,exploreContainer:s.css`
      display: flex;
      flex: 1 1 auto;
      flex-direction: column;
      padding: ${e.spacing(2)};
      padding-top: 0;
    `}))(l),v=r&&r.state!==y.LoadingState.NotStarted,b=m===Ki.RichHistory,w=!(0,T.X)().queryHistoryAvailable,R=m===Ki.QueryInspector,j=r.state===y.LoadingState.Done&&[r.logsFrames,r.graphFrames,r.nodeGraphFrames,r.tableFrames,r.traceFrames].every((e=>0===e.length));return(0,E.jsxs)(a.CustomScrollbar,{testId:x.wl.pages.Explore.General.scrollView,autoHeightMin:"100%",scrollRefCallback:e=>this.scrollElement=e||void 0,children:[(0,E.jsx)(Be,{exploreId:i,onChangeTime:this.onChangeTime,topOfViewRef:this.topOfViewRef}),t?this.renderEmptyState(f.exploreContainer):null,e&&(0,E.jsxs)("div",{className:(0,s.cx)(f.exploreContainer),children:[(0,E.jsxs)(a.PanelContainer,{className:f.queryContainer,children:[(0,E.jsx)(Yt,{exploreId:i}),(0,E.jsx)(Li,{addQueryRowButtonDisabled:n,addQueryRowButtonHidden:!1,richHistoryRowButtonHidden:w,richHistoryButtonActive:b,queryInspectorButtonActive:R,onClickAddQueryRowButton:this.onClickAddQueryRowButton,onClickRichHistoryButton:this.toggleShowRichHistory,onClickQueryInspectorButton:this.toggleShowQueryInspector}),(0,E.jsx)(ti,{exploreId:i})]}),(0,E.jsx)(S.Z,{onResize:this.onResize,disableHeight:!0,children:e=>{let{width:t}=e;return 0===t?null:(0,E.jsx)("main",{className:(0,s.cx)(f.exploreMain),style:{width:t},children:(0,E.jsxs)(a.ErrorBoundaryAlert,{children:[v&&(0,E.jsxs)(E.Fragment,{children:[c&&o&&(0,E.jsx)(a.ErrorBoundaryAlert,{children:this.renderGraphPanel(t)}),d&&(0,E.jsx)(a.ErrorBoundaryAlert,{children:this.renderTablePanel(t)}),h&&(0,E.jsx)(a.ErrorBoundaryAlert,{children:this.renderLogsPanel(t)}),u&&(0,E.jsx)(a.ErrorBoundaryAlert,{children:this.renderNodeGraphPanel()}),p&&(0,E.jsx)(a.ErrorBoundaryAlert,{children:this.renderTraceViewPanel()}),j&&(0,E.jsx)(a.ErrorBoundaryAlert,{children:this.renderNoData()})]}),b&&(0,E.jsx)(Oi,{width:t,exploreId:i,onClose:this.toggleShowRichHistory}),R&&(0,E.jsx)(ve,{exploreId:i,width:t,onClose:this.toggleShowQueryInspector,timeZone:g})]})})}})]})]})}}const Yi={changeSize:Vi.qN,changeGraphStyle:Vi.Rl,modifyQueries:u.sK,scanStart:u.EA,scanStopAction:u.P4,setQueries:u.KO,updateTimeRange:Ne.cD,makeAbsoluteTime:Ne.F9,addQueryRow:u.CS,splitOpen:p.bW},Xi=(0,r.connect)((function(e,t){let{exploreId:i}=t;const s=e.explore,{syncedTimes:o}=s,r=s[i],n=(0,w.Z)(e.user),{datasourceInstance:a,datasourceMissing:l,queryKeys:c,isLive:d,graphResult:h,logsResult:p,showLogs:u,showMetrics:g,showTable:m,showTrace:f,absoluteRange:y,queryResponse:x,showNodeGraph:v,loading:b,graphStyle:S}=r;return{datasourceInstance:a,datasourceMissing:l,queryKeys:c,isLive:d,graphResult:h,logsResult:null!=p?p:void 0,absoluteRange:y,queryResponse:x,syncedTimes:o,timeZone:n,showLogs:u,showMetrics:g,showTable:m,showTrace:f,showNodeGraph:v,loading:b,graphStyle:S}}),Yi),Ji=(0,R.compose)(Xi,a.withTheme2)(Gi);function es(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class ts extends o.PureComponent{constructor(e){super(e),es(this,"el",void 0),es(this,"exploreEvents",void 0),es(this,"refreshExplore",(e=>{const{exploreId:t,urlQuery:i}=this.props;i!==e&&i!==p.IS[t]&&this.props.refreshExplore(t,i)})),es(this,"getRef",(e=>{this.el=e})),this.exploreEvents=new y.EventBusSrv,this.state={openDrawer:void 0}}componentDidMount(){var e,t;const{initialized:i,exploreId:s,initialDatasource:o,initialQueries:r,initialRange:n,panelsState:a}=this.props,l=null!==(e=null===(t=this.el)||void 0===t?void 0:t.offsetWidth)&&void 0!==e?e:0;i||this.props.initializeExplore(s,o,r,n,l,this.exploreEvents,a)}componentWillUnmount(){this.exploreEvents.removeAllListeners(),this.props.cleanupPaneAction({exploreId:this.props.exploreId})}componentDidUpdate(e){this.refreshExplore(e.urlQuery)}render(){const{theme:e,split:t,exploreId:i,initialized:o}=this.props,r=(e=>({explore:s.css`
      display: flex;
      flex: 1 1 auto;
      flex-direction: column;
      & + & {
        border-left: 1px dotted ${e.colors.border.medium};
      }
    `,exploreSplit:s.css`
      width: 50%;
    `}))(e),n=(0,s.cx)(r.explore,t&&r.exploreSplit);return(0,E.jsx)("div",{className:n,ref:this.getRef,"data-testid":x.wl.pages.Explore.General.container,children:o&&(0,E.jsx)(Ji,{exploreId:i})})}}const is=(0,f.Z)(b.Z8),ss=(0,f.Z)(b.vP);const os={initializeExplore:Vi.CK,refreshExplore:Vi.Om,cleanupPaneAction:p.Jt},rs=(0,r.connect)((function(e,t){var i;const s=(0,b.J5)(t.urlQuery),o=(0,w.Z)(e.user),r=(0,w.i)(e.user),{datasource:n,queries:a,range:l,panelsState:c}=s||{},d=n||v.Z.get((0,b.I$)(e.user.orgId)),h=is(a),p=l?ss(l,o,r):(0,b.OQ)(o,b.UI,r);return{initialized:null===(i=e.explore[t.exploreId])||void 0===i?void 0:i.initialized,initialDatasource:d,initialQueries:h,initialRange:p,panelsState:c}}),os),ns=(0,a.withTheme2)(rs(ts)),as={pageScrollbarWrapper:s.css`
    width: 100%;
    flex-grow: 1;
    min-height: 0;
  `,exploreWrapper:s.css`
    display: flex;
    height: 100%;
  `},ls={resetExploreAction:p.WK,richHistoryUpdatedAction:p.ZU},cs=(0,r.connect)((e=>({navModel:(0,d.h)(e.navIndex,"explore"),exploreState:e.explore})),ls);class ds extends o.PureComponent{componentWillUnmount(){this.props.resetExploreAction({})}componentDidMount(){p.IS.left=void 0,p.IS.right=void 0;const e=n.locationService.getSearchObject();(e.from||e.to)&&n.locationService.partial({from:void 0,to:void 0},!0)}componentDidUpdate(e){var t,i,s,o;const{left:r,right:n}=this.props.queryParams,a=Boolean(r)&&Boolean(n)?`${null===(t=this.props.exploreState.left.datasourceInstance)||void 0===t?void 0:t.name} | ${null===(i=this.props.exploreState.right)||void 0===i||null===(s=i.datasourceInstance)||void 0===s?void 0:s.name}`:`${null===(o=this.props.exploreState.left.datasourceInstance)||void 0===o?void 0:o.name}`,l=`${this.props.navModel.main.text} - ${a} - ${c.c.AppTitle}`;document.title=l}render(){const{left:e,right:t}=this.props.queryParams,i=Boolean(e)&&Boolean(t);return(0,E.jsxs)("div",{className:as.pageScrollbarWrapper,children:[(0,E.jsx)(m,{exploreIdLeft:l.K.left,exploreIdRight:l.K.right}),(0,E.jsxs)("div",{className:as.exploreWrapper,children:[(0,E.jsx)(a.ErrorBoundaryAlert,{style:"page",children:(0,E.jsx)(ns,{split:i,exploreId:l.K.left,urlQuery:e})}),i&&(0,E.jsx)(a.ErrorBoundaryAlert,{style:"page",children:(0,E.jsx)(ns,{split:i,exploreId:l.K.right,urlQuery:t})})]})]})}}const hs=cs(ds)},16479:(e,t,i)=>{i.d(t,{F:()=>r,p:()=>o});var s=i(47570);const o=e=>Boolean(e.explore[s.Kd.left]&&e.explore[s.Kd.right]),r=e=>t=>t.explore[e]},2675:(e,t,i)=>{i.d(t,{Z:()=>o});var s=i(68404);function o(e){var t=(0,s.useRef)();return(0,s.useEffect)((function(){t.current=e})),t.current}},28953:(e,t,i)=>{function s(e){for(var t=arguments.length,i=Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];throw Error("[Immer] minified error nr: "+e+(i.length?" "+i.map((function(e){return"'"+e+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function o(e){return!!e&&!!e[Z]}function r(e){return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var i=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return i===Object||"function"==typeof i&&Function.toString.call(i)===Q}(e)||Array.isArray(e)||!!e[_]||!!e.constructor[_]||p(e)||u(e))}function n(e,t,i){void 0===i&&(i=!1),0===a(e)?(i?Object.keys:V)(e).forEach((function(s){i&&"symbol"==typeof s||t(s,e[s],e)})):e.forEach((function(i,s){return t(s,i,e)}))}function a(e){var t=e[Z];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:p(e)?2:u(e)?3:0}function l(e,t){return 2===a(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function c(e,t){return 2===a(e)?e.get(t):e[t]}function d(e,t,i){var s=a(e);2===s?e.set(t,i):3===s?(e.delete(t),e.add(i)):e[t]=i}function h(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function p(e){return B&&e instanceof Map}function u(e){return M&&e instanceof Set}function g(e){return e.o||e.t}function m(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=U(e);delete t[Z];for(var i=V(t),s=0;s<i.length;s++){var o=i[s],r=t[o];!1===r.writable&&(r.writable=!0,r.configurable=!0),(r.get||r.set)&&(t[o]={configurable:!0,writable:!0,enumerable:r.enumerable,value:e[o]})}return Object.create(Object.getPrototypeOf(e),t)}function f(e,t){return void 0===t&&(t=!1),x(e)||o(e)||!r(e)||(a(e)>1&&(e.set=e.add=e.clear=e.delete=y),Object.freeze(e),t&&n(e,(function(e,t){return f(t,!0)}),!0)),e}function y(){s(2)}function x(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function v(e){var t=K[e];return t||s(18,e),t}function b(){return P}function w(e,t){t&&(v("Patches"),e.u=[],e.s=[],e.v=t)}function S(e){R(e),e.p.forEach(C),e.p=null}function R(e){e===P&&(P=e.l)}function j(e){return P={p:[],l:P,h:e,m:!0,_:0}}function C(e){var t=e[Z];0===t.i||1===t.i?t.j():t.O=!0}function T(e,t){t._=t.p.length;var i=t.p[0],o=void 0!==e&&e!==i;return t.h.g||v("ES5").S(t,e,o),o?(i[Z].P&&(S(t),s(4)),r(e)&&(e=I(t,e),t.l||F(t,e)),t.u&&v("Patches").M(i[Z].t,e,t.u,t.s)):e=I(t,i,[]),S(t),t.u&&t.v(t.u,t.s),e!==W?e:void 0}function I(e,t,i){if(x(t))return t;var s=t[Z];if(!s)return n(t,(function(o,r){return z(e,s,t,o,r,i)}),!0),t;if(s.A!==e)return t;if(!s.P)return F(e,s.t,!0),s.t;if(!s.I){s.I=!0,s.A._--;var o=4===s.i||5===s.i?s.o=m(s.k):s.o;n(3===s.i?new Set(o):o,(function(t,r){return z(e,s,o,t,r,i)})),F(e,o,!1),i&&e.u&&v("Patches").R(s,i,e.u,e.s)}return s.o}function z(e,t,i,s,n,a){if(o(n)){var c=I(e,n,a&&t&&3!==t.i&&!l(t.D,s)?a.concat(s):void 0);if(d(i,s,c),!o(c))return;e.m=!1}if(r(n)&&!x(n)){if(!e.h.F&&e._<1)return;I(e,n),t&&t.A.l||F(e,n)}}function F(e,t,i){void 0===i&&(i=!1),e.h.F&&e.m&&f(t,i)}function k(e,t){var i=e[Z];return(i?g(i):e)[t]}function O(e,t){if(t in e)for(var i=Object.getPrototypeOf(e);i;){var s=Object.getOwnPropertyDescriptor(i,t);if(s)return s;i=Object.getPrototypeOf(i)}}function L(e){e.P||(e.P=!0,e.l&&L(e.l))}function D(e){e.o||(e.o=m(e.t))}function N(e,t,i){var s=p(t)?v("MapSet").N(t,i):u(t)?v("MapSet").T(t,i):e.g?function(e,t){var i=Array.isArray(e),s={i:i?1:0,A:t?t.A:b(),P:!1,I:!1,D:{},l:t,t:e,k:null,o:null,j:null,C:!1},o=s,r=G;i&&(o=[s],r=Y);var n=Proxy.revocable(o,r),a=n.revoke,l=n.proxy;return s.k=l,s.j=a,l}(t,i):v("ES5").J(t,i);return(i?i.A:b()).p.push(s),s}function E(e){return o(e)||s(22,e),function e(t){if(!r(t))return t;var i,s=t[Z],o=a(t);if(s){if(!s.P&&(s.i<4||!v("ES5").K(s)))return s.t;s.I=!0,i=$(t,o),s.I=!1}else i=$(t,o);return n(i,(function(t,o){s&&c(s.t,t)===o||d(i,t,e(o))})),3===o?new Set(i):i}(e)}function $(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return m(e)}i.d(t,{ZP:()=>te});var H,P,A="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),B="undefined"!=typeof Map,M="undefined"!=typeof Set,q="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,W=A?Symbol.for("immer-nothing"):((H={})["immer-nothing"]=!0,H),_=A?Symbol.for("immer-draftable"):"__$immer_draftable",Z=A?Symbol.for("immer-state"):"__$immer_state",Q=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),V="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,U=Object.getOwnPropertyDescriptors||function(e){var t={};return V(e).forEach((function(i){t[i]=Object.getOwnPropertyDescriptor(e,i)})),t},K={},G={get:function(e,t){if(t===Z)return e;var i=g(e);if(!l(i,t))return function(e,t,i){var s,o=O(t,i);return o?"value"in o?o.value:null===(s=o.get)||void 0===s?void 0:s.call(e.k):void 0}(e,i,t);var s=i[t];return e.I||!r(s)?s:s===k(e.t,t)?(D(e),e.o[t]=N(e.A.h,s,e)):s},has:function(e,t){return t in g(e)},ownKeys:function(e){return Reflect.ownKeys(g(e))},set:function(e,t,i){var s=O(g(e),t);if(null==s?void 0:s.set)return s.set.call(e.k,i),!0;if(!e.P){var o=k(g(e),t),r=null==o?void 0:o[Z];if(r&&r.t===i)return e.o[t]=i,e.D[t]=!1,!0;if(h(i,o)&&(void 0!==i||l(e.t,t)))return!0;D(e),L(e)}return e.o[t]===i&&"number"!=typeof i&&(void 0!==i||t in e.o)||(e.o[t]=i,e.D[t]=!0,!0)},deleteProperty:function(e,t){return void 0!==k(e.t,t)||t in e.t?(e.D[t]=!1,D(e),L(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var i=g(e),s=Reflect.getOwnPropertyDescriptor(i,t);return s?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:s.enumerable,value:i[t]}:s},defineProperty:function(){s(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){s(12)}},Y={};n(G,(function(e,t){Y[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),Y.deleteProperty=function(e,t){return Y.set.call(this,e,t,void 0)},Y.set=function(e,t,i){return G.set.call(this,e[0],t,i,e[0])};var X=function(){function e(e){var t=this;this.g=q,this.F=!0,this.produce=function(e,i,o){if("function"==typeof e&&"function"!=typeof i){var n=i;i=e;var a=t;return function(e){var t=this;void 0===e&&(e=n);for(var s=arguments.length,o=Array(s>1?s-1:0),r=1;r<s;r++)o[r-1]=arguments[r];return a.produce(e,(function(e){var s;return(s=i).call.apply(s,[t,e].concat(o))}))}}var l;if("function"!=typeof i&&s(6),void 0!==o&&"function"!=typeof o&&s(7),r(e)){var c=j(t),d=N(t,e,void 0),h=!0;try{l=i(d),h=!1}finally{h?S(c):R(c)}return"undefined"!=typeof Promise&&l instanceof Promise?l.then((function(e){return w(c,o),T(e,c)}),(function(e){throw S(c),e})):(w(c,o),T(l,c))}if(!e||"object"!=typeof e){if(void 0===(l=i(e))&&(l=e),l===W&&(l=void 0),t.F&&f(l,!0),o){var p=[],u=[];v("Patches").M(e,l,p,u),o(p,u)}return l}s(21,e)},this.produceWithPatches=function(e,i){if("function"==typeof e)return function(i){for(var s=arguments.length,o=Array(s>1?s-1:0),r=1;r<s;r++)o[r-1]=arguments[r];return t.produceWithPatches(i,(function(t){return e.apply(void 0,[t].concat(o))}))};var s,o,r=t.produce(e,i,(function(e,t){s=e,o=t}));return"undefined"!=typeof Promise&&r instanceof Promise?r.then((function(e){return[e,s,o]})):[r,s,o]},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var t=e.prototype;return t.createDraft=function(e){r(e)||s(8),o(e)&&(e=E(e));var t=j(this),i=N(this,e,void 0);return i[Z].C=!0,R(t),i},t.finishDraft=function(e,t){var i=(e&&e[Z]).A;return w(i,t),T(void 0,i)},t.setAutoFreeze=function(e){this.F=e},t.setUseProxies=function(e){e&&!q&&s(20),this.g=e},t.applyPatches=function(e,t){var i;for(i=t.length-1;i>=0;i--){var s=t[i];if(0===s.path.length&&"replace"===s.op){e=s.value;break}}i>-1&&(t=t.slice(i+1));var r=v("Patches").$;return o(e)?r(e,t):this.produce(e,(function(e){return r(e,t)}))},e}(),J=new X,ee=J.produce;J.produceWithPatches.bind(J),J.setAutoFreeze.bind(J),J.setUseProxies.bind(J),J.applyPatches.bind(J),J.createDraft.bind(J),J.finishDraft.bind(J);const te=ee}}]);
//# sourceMappingURL=explore.21457acf38b9a2ae19e8.js.map