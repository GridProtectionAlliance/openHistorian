{"version":3,"file":"xychart2.e7e57ef6e015593e096f.js","mappings":"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","sources":["webpack://grafana/./public/app/core/components/Layers/LayerName.tsx","webpack://grafana/./public/app/plugins/panel/xychart/v2/panelcfg.gen.ts","webpack://grafana/./public/app/plugins/panel/xychart/v2/SeriesEditor.tsx","webpack://grafana/./public/app/plugins/panel/xychart/v2/utils.ts","webpack://grafana/./public/app/plugins/panel/xychart/v2/XYChartTooltip.tsx","webpack://grafana/./public/app/plugins/panel/xychart/v2/scatter.ts","webpack://grafana/./public/app/plugins/panel/xychart/v2/XYChartPanel.tsx","webpack://grafana/./public/app/plugins/panel/xychart/v2/config.ts","webpack://grafana/./public/app/plugins/panel/xychart/v2/migrations.ts","webpack://grafana/./public/app/plugins/panel/xychart/v2/module.tsx"],"sourcesContent":["import { css, cx } from '@emotion/css';\nimport { useState } from 'react';\nimport * as React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Icon, Input, FieldValidationMessage, useStyles2 } from '@grafana/ui';\n\nexport interface LayerNameProps {\n  name: string;\n  onChange: (v: string) => void;\n  verifyLayerNameUniqueness?: (nameToCheck: string) => boolean;\n  overrideStyles?: boolean;\n}\n\nexport const LayerName = ({ name, onChange, verifyLayerNameUniqueness, overrideStyles }: LayerNameProps) => {\n  const styles = useStyles2(getStyles);\n\n  const [isEditing, setIsEditing] = useState<boolean>(false);\n  const [validationError, setValidationError] = useState<string | null>(null);\n\n  const onEditLayer = (event: React.SyntheticEvent) => {\n    setIsEditing(true);\n  };\n\n  const onEndEditName = (newName: string) => {\n    setIsEditing(false);\n\n    if (validationError) {\n      setValidationError(null);\n      return;\n    }\n\n    if (name !== newName) {\n      onChange(newName);\n    }\n  };\n\n  const onInputChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n    const newName = event.currentTarget.value.trim();\n\n    if (newName.length === 0) {\n      setValidationError('An empty layer name is not allowed');\n      return;\n    }\n\n    if (verifyLayerNameUniqueness && !verifyLayerNameUniqueness(newName) && newName !== name) {\n      setValidationError('Layer name already exists');\n      return;\n    }\n\n    if (validationError) {\n      setValidationError(null);\n    }\n  };\n\n  const onEditLayerBlur = (event: React.SyntheticEvent<HTMLInputElement>) => {\n    onEndEditName(event.currentTarget.value.trim());\n  };\n\n  const onKeyDown = (event: React.KeyboardEvent<HTMLInputElement>) => {\n    if (event.key === 'Enter') {\n      onEndEditName(event.currentTarget.value);\n    }\n  };\n\n  const onFocus = (event: React.FocusEvent<HTMLInputElement>) => {\n    event.target.select();\n  };\n\n  return (\n    <>\n      <div className={styles.wrapper}>\n        {!isEditing && (\n          <button\n            className={styles.layerNameWrapper}\n            title=\"Edit layer name\"\n            onClick={onEditLayer}\n            data-testid=\"layer-name-div\"\n          >\n            <span className={overrideStyles ? '' : styles.layerName}>{name}</span>\n            <Icon name=\"pen\" className={styles.layerEditIcon} size=\"sm\" />\n          </button>\n        )}\n\n        {isEditing && (\n          <>\n            <Input\n              type=\"text\"\n              defaultValue={name}\n              onBlur={onEditLayerBlur}\n              autoFocus\n              onKeyDown={onKeyDown}\n              onFocus={onFocus}\n              invalid={validationError !== null}\n              onChange={onInputChange}\n              className={styles.layerNameInput}\n              data-testid=\"layer-name-input\"\n            />\n            {validationError && <FieldValidationMessage horizontal>{validationError}</FieldValidationMessage>}\n          </>\n        )}\n      </div>\n    </>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    wrapper: css({\n      label: 'Wrapper',\n      display: 'flex',\n      alignItems: 'center',\n      marginLeft: theme.spacing(0.5),\n    }),\n    layerNameWrapper: css({\n      display: 'flex',\n      cursor: 'pointer',\n      border: '1px solid transparent',\n      borderRadius: theme.shape.radius.default,\n      alignItems: 'center',\n      padding: `0 0 0 ${theme.spacing(0.5)}`,\n      margin: 0,\n      background: 'transparent',\n\n      '&:hover': {\n        background: theme.colors.action.hover,\n        border: `1px dashed ${theme.colors.border.strong}`,\n      },\n\n      '&:focus': {\n        border: `2px solid ${theme.colors.primary.border}`,\n      },\n\n      '&:hover, &:focus': {\n        '.query-name-edit-icon': {\n          visibility: 'visible',\n        },\n      },\n    }),\n    layerName: css({\n      fontWeight: theme.typography.fontWeightMedium,\n      color: theme.colors.primary.text,\n      cursor: 'pointer',\n      overflow: 'hidden',\n      marginLeft: theme.spacing(0.5),\n    }),\n    layerEditIcon: cx(\n      css({\n        marginLeft: theme.spacing(2),\n        visibility: 'hidden',\n      }),\n      'query-name-edit-icon'\n    ),\n    layerNameInput: css({\n      maxWidth: '300px',\n      margin: '-4px 0',\n    }),\n  };\n};\n","// Code generated - EDITING IS FUTILE. DO NOT EDIT.\n//\n// Generated by:\n//     public/app/plugins/gen.go\n// Using jennies:\n//     TSTypesJenny\n//     PluginTsTypesJenny\n//\n// Run 'make gen-cue' from repository root to regenerate.\n\nimport * as common from '@grafana/schema';\n\nexport enum PointShape {\n  Circle = 'circle',\n  Square = 'square',\n}\n\nexport enum SeriesMapping {\n  Auto = 'auto',\n  Manual = 'manual',\n}\n\nexport enum XYShowMode {\n  Lines = 'lines',\n  Points = 'points',\n  PointsAndLines = 'points+lines',\n}\n\n/**\n * NOTE: (copied from dashboard_kind.cue, since not exported)\n * Matcher is a predicate configuration. Based on the config a set of field(s) or values is filtered in order to apply override / transformation.\n * It comes with in id ( to resolve implementation from registry) and a configuration that’s specific to a particular matcher type.\n */\nexport interface MatcherConfig {\n  /**\n   * The matcher id. This is used to find the matcher implementation from registry.\n   */\n  id: string;\n  /**\n   * The matcher options. This is specific to the matcher implementation.\n   */\n  options?: unknown;\n}\n\nexport const defaultMatcherConfig: Partial<MatcherConfig> = {\n  id: '',\n};\n\nexport interface FieldConfig extends common.HideableFieldConfig, common.AxisConfig {\n  fillOpacity?: number;\n  lineStyle?: common.LineStyle;\n  lineWidth?: number;\n  pointShape?: PointShape;\n  pointSize?: {\n    fixed?: number;\n    min?: number;\n    max?: number;\n  };\n  pointStrokeWidth?: number;\n  show?: XYShowMode;\n}\n\nexport const defaultFieldConfig: Partial<FieldConfig> = {\n  fillOpacity: 50,\n  show: XYShowMode.Points,\n};\n\nexport interface XYSeriesConfig {\n  color?: {\n    matcher: MatcherConfig;\n  };\n  frame?: {\n    matcher: MatcherConfig;\n  };\n  name?: {\n    fixed?: string;\n  };\n  size?: {\n    matcher: MatcherConfig;\n  };\n  x?: {\n    matcher: MatcherConfig;\n  };\n  y?: {\n    matcher: MatcherConfig;\n  };\n}\n\nexport interface Options extends common.OptionsWithLegend, common.OptionsWithTooltip {\n  mapping: SeriesMapping;\n  series: Array<XYSeriesConfig>;\n}\n\nexport const defaultOptions: Partial<Options> = {\n  series: [],\n};\n","import { css, cx } from '@emotion/css';\nimport { Fragment, useState } from 'react';\nimport { usePrevious } from 'react-use';\n\nimport {\n  getFrameDisplayName,\n  StandardEditorProps,\n  // getFieldDisplayName,\n  FrameMatcherID,\n  FieldMatcherID,\n  FieldNamePickerBaseNameMode,\n  FieldType,\n  GrafanaTheme2,\n} from '@grafana/data';\nimport { Button, Field, IconButton, Select, useStyles2 } from '@grafana/ui';\nimport { FieldNamePicker } from '@grafana/ui/src/components/MatchersUI/FieldNamePicker';\nimport { LayerName } from 'app/core/components/Layers/LayerName';\n\nimport { Options, SeriesMapping, XYSeriesConfig } from './panelcfg.gen';\n\nexport const SeriesEditor = ({\n  value: seriesCfg,\n  onChange,\n  context,\n}: StandardEditorProps<XYSeriesConfig[], unknown, Options>) => {\n  const style = useStyles2(getStyles);\n\n  // reset opts when mapping changes (no way to do this in panel opts builder?)\n  const mapping = context.options?.mapping;\n  const prevMapping = usePrevious(mapping);\n  const mappingChanged = prevMapping != null && mapping !== prevMapping;\n\n  const defaultFrame = { frame: { matcher: { id: FrameMatcherID.byIndex, options: 0 } } };\n  const [selectedIdx, setSelectedIdx] = useState(0);\n\n  if (mappingChanged || seriesCfg == null) {\n    seriesCfg = [{ ...defaultFrame }];\n    onChange([...seriesCfg]);\n\n    if (selectedIdx > 0) {\n      setSelectedIdx(0);\n    }\n  }\n\n  const addSeries = () => {\n    seriesCfg = seriesCfg.concat({ ...defaultFrame });\n    setSelectedIdx(seriesCfg.length - 1);\n    onChange([...seriesCfg]);\n  };\n\n  const deleteSeries = (index: number) => {\n    seriesCfg = seriesCfg.filter((s, i) => i !== index);\n    setSelectedIdx(0);\n    onChange([...seriesCfg]);\n  };\n\n  const series = seriesCfg[selectedIdx];\n  const formKey = `${mapping}${selectedIdx}`;\n\n  const baseNameMode =\n    mapping === SeriesMapping.Manual\n      ? FieldNamePickerBaseNameMode.ExcludeBaseNames\n      : context.data.length === 1\n        ? FieldNamePickerBaseNameMode.IncludeAll\n        : FieldNamePickerBaseNameMode.OnlyBaseNames;\n\n  context.data.forEach((frame, frameIndex) => {\n    frame.fields.forEach((field, fieldIndex) => {\n      field.state = {\n        ...field.state,\n        origin: {\n          frameIndex,\n          fieldIndex,\n        },\n      };\n    });\n  });\n\n  return (\n    <>\n      {mapping === SeriesMapping.Manual && (\n        <>\n          <Button icon=\"plus\" size=\"sm\" variant=\"secondary\" onClick={addSeries} className={style.marginBot}>\n            Add series\n          </Button>\n\n          <div className={style.marginBot}>\n            {seriesCfg.map((series, index) => {\n              return (\n                <div\n                  key={`series/${index}`}\n                  className={index === selectedIdx ? `${style.row} ${style.sel}` : style.row}\n                  onClick={() => setSelectedIdx(index)}\n                  role=\"button\"\n                  aria-label={`Select series ${index + 1}`}\n                  tabIndex={0}\n                  onKeyPress={(e) => {\n                    if (e.key === 'Enter') {\n                      setSelectedIdx(index);\n                    }\n                  }}\n                >\n                  <LayerName\n                    name={series.name?.fixed ?? `Series ${index + 1}`}\n                    onChange={(v) => {\n                      series.name = {\n                        fixed: v === '' || v === `Series ${index + 1}` ? undefined : v,\n                      };\n                      onChange([...seriesCfg]);\n                    }}\n                  />\n                  <IconButton\n                    name=\"trash-alt\"\n                    title={'remove'}\n                    className={cx(style.actionIcon)}\n                    onClick={() => deleteSeries(index)}\n                    tooltip=\"Delete series\"\n                  />\n                </div>\n              );\n            })}\n          </div>\n        </>\n      )}\n\n      {selectedIdx >= 0 && series != null && (\n        <Fragment key={formKey}>\n          <Field label=\"Frame\">\n            <Select\n              placeholder={mapping === SeriesMapping.Auto ? 'All frames' : 'Select frame'}\n              isClearable={true}\n              options={context.data.map((frame, index) => ({\n                value: index,\n                label: `${getFrameDisplayName(frame, index)} (index: ${index}, rows: ${frame.length})`,\n              }))}\n              value={series.frame?.matcher.options}\n              onChange={(opt) => {\n                if (opt == null) {\n                  delete series.frame;\n                } else {\n                  series.frame = {\n                    matcher: {\n                      id: FrameMatcherID.byIndex,\n                      options: Number(opt.value),\n                    },\n                  };\n                }\n\n                onChange([...seriesCfg]);\n              }}\n            />\n          </Field>\n          <Field label=\"X field\">\n            <FieldNamePicker\n              value={series.x?.matcher.options as string}\n              context={context}\n              onChange={(fieldName) => {\n                if (fieldName == null) {\n                  delete series.x;\n                } else {\n                  // TODO: reset any other dim that was set to fieldName\n                  series.x = {\n                    matcher: {\n                      id: FieldMatcherID.byName,\n                      options: fieldName,\n                    },\n                  };\n                }\n\n                onChange([...seriesCfg]);\n              }}\n              item={{\n                id: 'x',\n                name: 'x',\n                settings: {\n                  filter: (field) =>\n                    (mapping === SeriesMapping.Auto ||\n                      field.state?.origin?.frameIndex === series.frame?.matcher.options) &&\n                    field.type === FieldType.number &&\n                    !field.config.custom?.hideFrom?.viz,\n                  baseNameMode,\n                  placeholderText: mapping === SeriesMapping.Auto ? 'First number field in each frame' : undefined,\n                },\n              }}\n            />\n          </Field>\n          <Field label=\"Y field\">\n            <FieldNamePicker\n              value={series.y?.matcher?.options as string}\n              context={context}\n              onChange={(fieldName) => {\n                if (fieldName == null) {\n                  delete series.y;\n                } else {\n                  // TODO: reset any other dim that was set to fieldName\n                  series.y = {\n                    matcher: {\n                      id: FieldMatcherID.byName,\n                      options: fieldName,\n                    },\n                  };\n                }\n\n                onChange([...seriesCfg]);\n              }}\n              item={{\n                id: 'y',\n                name: 'y',\n                settings: {\n                  // TODO: filter out series.y?.exclude.options, series.size.matcher.options, series.color.matcher.options\n                  filter: (field) =>\n                    (mapping === SeriesMapping.Auto ||\n                      field.state?.origin?.frameIndex === series.frame?.matcher.options) &&\n                    field.type === FieldType.number &&\n                    !field.config.custom?.hideFrom?.viz,\n                  baseNameMode,\n                  placeholderText: mapping === SeriesMapping.Auto ? 'Remaining number fields in each frame' : undefined,\n                },\n              }}\n            />\n          </Field>\n          <Field label=\"Size field\">\n            <FieldNamePicker\n              value={series.size?.matcher?.options as string}\n              context={context}\n              onChange={(fieldName) => {\n                if (fieldName == null) {\n                  delete series.size;\n                } else {\n                  // TODO: reset any other dim that was set to fieldName\n                  series.size = {\n                    matcher: {\n                      id: FieldMatcherID.byName,\n                      options: fieldName,\n                    },\n                  };\n                }\n\n                onChange([...seriesCfg]);\n              }}\n              item={{\n                id: 'size',\n                name: 'size',\n                settings: {\n                  // TODO: filter out series.y?.exclude.options, series.size.matcher.options, series.color.matcher.options\n                  filter: (field) =>\n                    field.name !== series.x?.matcher.options &&\n                    (mapping === SeriesMapping.Auto ||\n                      field.state?.origin?.frameIndex === series.frame?.matcher.options) &&\n                    field.type === FieldType.number &&\n                    !field.config.custom?.hideFrom?.viz,\n                  baseNameMode,\n                  placeholderText: '',\n                },\n              }}\n            />\n          </Field>\n          <Field label=\"Color field\">\n            <FieldNamePicker\n              value={series.color?.matcher?.options as string}\n              context={context}\n              onChange={(fieldName) => {\n                if (fieldName == null) {\n                  delete series.color;\n                } else {\n                  // TODO: reset any other dim that was set to fieldName\n                  series.color = {\n                    matcher: {\n                      id: FieldMatcherID.byName,\n                      options: fieldName,\n                    },\n                  };\n                }\n\n                onChange([...seriesCfg]);\n              }}\n              item={{\n                id: 'color',\n                name: 'color',\n                settings: {\n                  // TODO: filter out series.y?.exclude.options, series.size.matcher.options, series.color.matcher.options\n                  filter: (field) =>\n                    field.name !== series.x?.matcher.options &&\n                    (mapping === SeriesMapping.Auto ||\n                      field.state?.origin?.frameIndex === series.frame?.matcher.options) &&\n                    field.type === FieldType.number &&\n                    !field.config.custom?.hideFrom?.viz,\n                  baseNameMode,\n                  placeholderText: '',\n                },\n              }}\n            />\n          </Field>\n        </Fragment>\n      )}\n    </>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  marginBot: css({\n    marginBottom: '20px',\n  }),\n  row: css({\n    padding: `${theme.spacing(0.5, 1)}`,\n    borderRadius: `${theme.shape.radius.default}`,\n    background: `${theme.colors.background.secondary}`,\n    minHeight: `${theme.spacing(4)}`,\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    marginBottom: '3px',\n    cursor: 'pointer',\n\n    border: `1px solid ${theme.components.input.borderColor}`,\n    '&:hover': {\n      border: `1px solid ${theme.components.input.borderHover}`,\n    },\n  }),\n  sel: css({\n    border: `1px solid ${theme.colors.primary.border}`,\n    '&:hover': {\n      border: `1px solid ${theme.colors.primary.border}`,\n    },\n  }),\n  actionIcon: css({\n    color: `${theme.colors.text.secondary}`,\n    '&:hover': {\n      color: `${theme.colors.text}`,\n    },\n  }),\n});\n","import {\n  Field,\n  formattedValueToString,\n  getFieldMatcher,\n  FieldType,\n  getFieldDisplayName,\n  DataFrame,\n  FrameMatcherID,\n  MatcherConfig,\n  FieldColorModeId,\n  cacheFieldDisplayNames,\n  FieldMatcherID,\n  FieldConfigSource,\n} from '@grafana/data';\nimport { decoupleHideFromState } from '@grafana/data/src/field/fieldState';\nimport { config } from '@grafana/runtime';\nimport { VisibilityMode } from '@grafana/schema';\n\nimport { XYShowMode, SeriesMapping, XYSeriesConfig } from './panelcfg.gen';\nimport { XYSeries } from './types2';\n\nexport function fmt(field: Field, val: number): string {\n  if (field.display) {\n    return formattedValueToString(field.display(val));\n  }\n\n  return `${val}`;\n}\n\n// cause we dont have a proper matcher for this currently\nfunction getFrameMatcher2(config: MatcherConfig) {\n  if (config.id === FrameMatcherID.byIndex) {\n    return (frame: DataFrame, index: number) => index === config.options;\n  }\n\n  return () => false;\n}\n\nexport function prepSeries(\n  mapping: SeriesMapping,\n  mappedSeries: XYSeriesConfig[],\n  frames: DataFrame[],\n  fieldConfig: FieldConfigSource\n) {\n  cacheFieldDisplayNames(frames);\n  decoupleHideFromState(frames, fieldConfig);\n\n  let series: XYSeries[] = [];\n\n  if (mappedSeries.length === 0) {\n    mappedSeries = [{}];\n  }\n\n  const { palette, getColorByName } = config.theme2.visualization;\n\n  mappedSeries.forEach((seriesCfg, seriesIdx) => {\n    if (mapping === SeriesMapping.Manual) {\n      if (seriesCfg.frame?.matcher == null || seriesCfg.x?.matcher == null || seriesCfg.y?.matcher == null) {\n        return;\n      }\n    }\n\n    let xMatcher = getFieldMatcher(\n      seriesCfg.x?.matcher ?? {\n        id: FieldMatcherID.byType,\n        options: 'number',\n      }\n    );\n    let yMatcher = getFieldMatcher(\n      seriesCfg.y?.matcher ?? {\n        id: FieldMatcherID.byType,\n        options: 'number',\n      }\n    );\n    let colorMatcher = seriesCfg.color ? getFieldMatcher(seriesCfg.color.matcher) : null;\n    let sizeMatcher = seriesCfg.size ? getFieldMatcher(seriesCfg.size.matcher) : null;\n    // let frameMatcher = seriesCfg.frame ? getFrameMatchers(seriesCfg.frame) : null;\n    let frameMatcher = seriesCfg.frame ? getFrameMatcher2(seriesCfg.frame.matcher) : null;\n\n    // loop over all frames and fields, adding a new series for each y dim\n    frames.forEach((frame, frameIdx) => {\n      // must match frame in manual mode\n      if (frameMatcher != null && !frameMatcher(frame, frameIdx)) {\n        return;\n      }\n\n      // shared across each series in this frame\n      let restFields: Field[] = [];\n\n      let frameSeries: XYSeries[] = [];\n\n      // only grabbing number fields (exclude time, string, enum, other)\n      let onlyNumFields = frame.fields.filter((field) => field.type === FieldType.number);\n\n      // only one of these per frame\n      let x = onlyNumFields.find((field) => xMatcher(field, frame, frames));\n      let color =\n        colorMatcher != null\n          ? onlyNumFields.find((field) => field !== x && colorMatcher!(field, frame, frames))\n          : undefined;\n      let size =\n        sizeMatcher != null\n          ? onlyNumFields.find((field) => field !== x && field !== color && sizeMatcher!(field, frame, frames))\n          : undefined;\n\n      // x field is required\n      if (x != null) {\n        // match y fields and create series\n        onlyNumFields.forEach((field) => {\n          if (field === x) {\n            return;\n          }\n\n          // in auto mode don't reuse already-mapped fields\n          if (mapping === SeriesMapping.Auto && (field === color || field === size)) {\n            return;\n          }\n\n          // in manual mode only add single series for this config\n          if (mapping === SeriesMapping.Manual && frameSeries.length > 0) {\n            return;\n          }\n\n          // if we match non-excluded y, create series\n          if (yMatcher(field, frame, frames) && !field.config.custom?.hideFrom?.viz) {\n            let y = field;\n            let name = seriesCfg.name?.fixed ?? getFieldDisplayName(y, frame, frames);\n\n            let ser: XYSeries = {\n              // these typically come from y field\n              name: {\n                value: name,\n              },\n\n              showPoints: y.config.custom.show === XYShowMode.Lines ? VisibilityMode.Never : VisibilityMode.Always,\n              pointShape: y.config.custom.pointShape,\n              pointStrokeWidth: y.config.custom.pointStrokeWidth,\n              fillOpacity: y.config.custom.fillOpacity,\n\n              showLine: y.config.custom.show !== XYShowMode.Points,\n              lineWidth: y.config.custom.lineWidth ?? 2,\n              lineStyle: y.config.custom.lineStyle,\n\n              x: {\n                field: x!,\n              },\n              y: {\n                field: y,\n              },\n              color: {},\n              size: {},\n              _rest: restFields,\n            };\n\n            if (color != null) {\n              ser.color.field = color;\n            }\n\n            if (size != null) {\n              ser.size.field = size;\n              ser.size.min = size.config.custom.pointSize?.min ?? 5;\n              ser.size.max = size.config.custom.pointSize?.max ?? 100;\n              // ser.size.mode =\n            }\n\n            frameSeries.push(ser);\n          }\n        });\n\n        if (frameSeries.length === 0) {\n          // TODO: could not create series, skip & show error?\n        }\n\n        // populate rest fields\n        frame.fields.forEach((field) => {\n          let isUsedField = frameSeries.some(\n            ({ x, y, color, size }) =>\n              x.field === field || y.field === field || color.field === field || size.field === field\n          );\n\n          if (!isUsedField) {\n            restFields.push(field);\n          }\n        });\n\n        series.push(...frameSeries);\n      } else {\n        // x is missing in this frame!\n      }\n    });\n  });\n\n  if (series.length === 0) {\n    // TODO: could not create series, skip & show error?\n  } else {\n    // assign classic palette colors by index, as fallbacks for all series\n\n    let paletteIdx = 0;\n\n    // todo: populate min, max, mode from field + hints\n    series.forEach((s, i) => {\n      if (s.color.field == null) {\n        // derive fixed color from y field config\n        let colorCfg = s.y.field.config.color ?? { mode: FieldColorModeId.PaletteClassic };\n\n        let value = '';\n\n        if (colorCfg.mode === FieldColorModeId.PaletteClassic) {\n          value = getColorByName(palette[paletteIdx++ % palette.length]); // todo: do this via state.seriesIdx and re-init displayProcessor\n        } else if (colorCfg.mode === FieldColorModeId.Fixed) {\n          value = getColorByName(colorCfg.fixedColor!);\n        }\n\n        s.color.fixed = value;\n      }\n\n      if (s.size.field == null) {\n        // derive fixed size from y field config\n        s.size.fixed = s.y.field.config.custom.pointSize?.fixed ?? 5;\n        // ser.size.mode =\n      }\n    });\n\n    autoNameSeries(series);\n\n    // TODO: re-assign y display names?\n    // y.state = {\n    //   ...y.state,\n    //   seriesIndex: series.length + ,\n    // };\n    // y.display = getDisplayProcessor({ field, theme });\n  }\n\n  return series;\n}\n\n// strip common prefixes and suffixes from y field names\nfunction autoNameSeries(series: XYSeries[]) {\n  let names = series.map((s) => s.name.value.split(/\\s+/g));\n\n  const { prefix, suffix } = findCommonPrefixSuffixLengths(names);\n\n  if (prefix < Infinity || suffix < Infinity) {\n    series.forEach((s, i) => {\n      s.name.value = names[i].slice(prefix, names[i].length - suffix).join(' ');\n    });\n  }\n}\n\nexport function getCommonPrefixSuffix(strs: string[]) {\n  let names = strs.map((s) => s.split(/\\s+/g));\n\n  let { prefix, suffix } = findCommonPrefixSuffixLengths(names);\n\n  let n = names[0];\n\n  if (n.length === 1 && prefix === 1 && suffix === 1) {\n    return '';\n  }\n\n  let parts = [];\n\n  if (prefix > 0) {\n    parts.push(...n.slice(0, prefix));\n  }\n\n  if (suffix > 0) {\n    parts.push(...n.slice(-suffix));\n  }\n\n  return parts.join(' ');\n}\n\n// lengths are in number of tokens (segments) in a phrase\nfunction findCommonPrefixSuffixLengths(names: string[][]) {\n  let commonPrefixLen = Infinity;\n  let commonSuffixLen = Infinity;\n\n  // if auto naming strategy, rename fields by stripping common prefixes and suffixes\n  let segs0: string[] = names[0];\n\n  for (let i = 1; i < names.length; i++) {\n    if (names[i].length < segs0.length) {\n      segs0 = names[i];\n    }\n  }\n\n  for (let i = 1; i < names.length; i++) {\n    let segs = names[i];\n\n    if (segs !== segs0) {\n      // prefixes\n      let preLen = 0;\n      for (let j = 0; j < segs0.length; j++) {\n        if (segs[j] === segs0[j]) {\n          preLen++;\n        } else {\n          break;\n        }\n      }\n\n      if (preLen < commonPrefixLen) {\n        commonPrefixLen = preLen;\n      }\n\n      // suffixes\n      let sufLen = 0;\n      for (let j = segs0.length - 1; j >= 0; j--) {\n        if (segs[j] === segs0[j]) {\n          sufLen++;\n        } else {\n          break;\n        }\n      }\n\n      if (sufLen < commonSuffixLen) {\n        commonSuffixLen = sufLen;\n      }\n    }\n  }\n\n  return {\n    prefix: commonPrefixLen,\n    suffix: commonSuffixLen,\n  };\n}\n","import { ReactNode } from 'react';\n\nimport { DataFrame, InterpolateFunction } from '@grafana/data';\nimport { alpha } from '@grafana/data/src/themes/colorManipulator';\nimport { VizTooltipContent } from '@grafana/ui/src/components/VizTooltip/VizTooltipContent';\nimport { VizTooltipFooter } from '@grafana/ui/src/components/VizTooltip/VizTooltipFooter';\nimport { VizTooltipHeader } from '@grafana/ui/src/components/VizTooltip/VizTooltipHeader';\nimport { VizTooltipWrapper } from '@grafana/ui/src/components/VizTooltip/VizTooltipWrapper';\nimport { ColorIndicator, VizTooltipItem } from '@grafana/ui/src/components/VizTooltip/types';\n\nimport { getDataLinks, getFieldActions } from '../../status-history/utils';\n\nimport { XYSeries } from './types2';\nimport { fmt } from './utils';\n\nexport interface Props {\n  dataIdxs: Array<number | null>;\n  seriesIdx: number | null | undefined;\n  isPinned: boolean;\n  dismiss: () => void;\n  data: DataFrame[];\n  xySeries: XYSeries[];\n  replaceVariables: InterpolateFunction;\n}\n\nfunction stripSeriesName(fieldName: string, seriesName: string) {\n  if (fieldName !== seriesName && fieldName.includes(' ')) {\n    fieldName = fieldName.replace(seriesName, '').trim();\n  }\n\n  return fieldName;\n}\n\nexport const XYChartTooltip = ({ dataIdxs, seriesIdx, data, xySeries, dismiss, isPinned, replaceVariables }: Props) => {\n  const rowIndex = dataIdxs.find((idx) => idx !== null)!;\n\n  const series = xySeries[seriesIdx! - 1];\n  const xField = series.x.field;\n  const yField = series.y.field;\n\n  const sizeField = series.size.field;\n  const colorField = series.color.field;\n\n  let label = series.name.value;\n\n  let seriesColor = series.color.fixed;\n  // let colorField = series.color.field;\n  // let pointColor: string;\n\n  // if (colorField != null) {\n  //   pointColor = colorField.display?.(colorField.values[rowIndex]).color!;\n  // }\n\n  const headerItem: VizTooltipItem = {\n    label,\n    value: '',\n    color: alpha(seriesColor ?? '#fff', 0.5),\n    colorIndicator: ColorIndicator.marker_md,\n  };\n\n  const contentItems: VizTooltipItem[] = [\n    {\n      label: stripSeriesName(xField.state?.displayName ?? xField.name, label),\n      value: fmt(xField, xField.values[rowIndex]),\n    },\n    {\n      label: stripSeriesName(yField.state?.displayName ?? yField.name, label),\n      value: fmt(yField, yField.values[rowIndex]),\n    },\n  ];\n\n  // mapped fields for size/color\n  if (sizeField != null && sizeField !== yField) {\n    contentItems.push({\n      label: stripSeriesName(sizeField.state?.displayName ?? sizeField.name, label),\n      value: fmt(sizeField, sizeField.values[rowIndex]),\n    });\n  }\n\n  if (colorField != null && colorField !== yField) {\n    contentItems.push({\n      label: stripSeriesName(colorField.state?.displayName ?? colorField.name, label),\n      value: fmt(colorField, colorField.values[rowIndex]),\n    });\n  }\n\n  series._rest.forEach((field) => {\n    contentItems.push({\n      label: stripSeriesName(field.state?.displayName ?? field.name, label),\n      value: fmt(field, field.values[rowIndex]),\n    });\n  });\n\n  let footer: ReactNode;\n\n  if (isPinned && seriesIdx != null) {\n    const links = getDataLinks(yField, rowIndex);\n    const yFieldFrame = data.find((frame) => frame.fields.includes(yField))!;\n    const actions = getFieldActions(yFieldFrame, yField, replaceVariables, rowIndex);\n\n    footer = <VizTooltipFooter dataLinks={links} actions={actions} />;\n  }\n\n  return (\n    <VizTooltipWrapper>\n      <VizTooltipHeader item={headerItem} isPinned={isPinned} />\n      <VizTooltipContent items={contentItems} isPinned={isPinned} />\n      {footer}\n    </VizTooltipWrapper>\n  );\n};\n","import tinycolor from 'tinycolor2';\nimport uPlot from 'uplot';\n\nimport {\n  FALLBACK_COLOR,\n  Field,\n  FieldType,\n  formattedValueToString,\n  getFieldColorModeForField,\n  GrafanaTheme2,\n  MappingType,\n  SpecialValueMatch,\n  ThresholdsMode,\n} from '@grafana/data';\nimport { alpha } from '@grafana/data/src/themes/colorManipulator';\nimport { AxisPlacement, FieldColorModeId, ScaleDirection, ScaleOrientation, VisibilityMode } from '@grafana/schema';\nimport { UPlotConfigBuilder } from '@grafana/ui';\nimport { FacetedData, FacetSeries } from '@grafana/ui/src/components/uPlot/types';\n\nimport { pointWithin, Quadtree, Rect } from '../../barchart/quadtree';\nimport { valuesToFills } from '../../heatmap/utils';\n\nimport { PointShape } from './panelcfg.gen';\nimport { XYSeries } from './types2';\nimport { getCommonPrefixSuffix } from './utils';\n\ninterface DrawBubblesOpts {\n  each: (u: uPlot, seriesIdx: number, dataIdx: number, lft: number, top: number, wid: number, hgt: number) => void;\n  disp: {\n    //unit: 3,\n    size: {\n      values: (u: uPlot, seriesIdx: number) => number[];\n    };\n    color: {\n      values: (u: uPlot, seriesIdx: number) => string[];\n    };\n  };\n}\n\nexport const prepConfig = (xySeries: XYSeries[], theme: GrafanaTheme2) => {\n  if (xySeries.length === 0) {\n    return { builder: null, prepData: () => [] };\n  }\n\n  let qt: Quadtree;\n  let hRect: Rect | null;\n\n  function drawBubblesFactory(opts: DrawBubblesOpts) {\n    const drawBubbles: uPlot.Series.PathBuilder = (u, seriesIdx, idx0, idx1) => {\n      uPlot.orient(\n        u,\n        seriesIdx,\n        (\n          series,\n          dataX,\n          dataY,\n          scaleX,\n          scaleY,\n          valToPosX,\n          valToPosY,\n          xOff,\n          yOff,\n          xDim,\n          yDim,\n          moveTo,\n          lineTo,\n          rect,\n          arc\n        ) => {\n          const pxRatio = uPlot.pxRatio;\n          const scatterInfo = xySeries[seriesIdx - 1];\n          let d = u.data[seriesIdx] as unknown as FacetSeries;\n\n          // showLine: boolean;\n          // lineStyle: common.LineStyle;\n          // showPoints: common.VisibilityMode;\n\n          let showLine = scatterInfo.showLine;\n          let showPoints = scatterInfo.showPoints === VisibilityMode.Always;\n          let strokeWidth = scatterInfo.pointStrokeWidth ?? 0;\n\n          u.ctx.save();\n\n          u.ctx.rect(u.bbox.left, u.bbox.top, u.bbox.width, u.bbox.height);\n          u.ctx.clip();\n\n          let pointAlpha = scatterInfo.fillOpacity / 100;\n\n          u.ctx.fillStyle = alpha((series.fill as any)(), pointAlpha);\n          u.ctx.strokeStyle = alpha((series.stroke as any)(), 1);\n          u.ctx.lineWidth = strokeWidth;\n\n          let deg360 = 2 * Math.PI;\n\n          let xKey = scaleX.key!;\n          let yKey = scaleY.key!;\n\n          //const colorMode = getFieldColorModeForField(field); // isByValue\n          const pointSize = scatterInfo.y.field.config.custom.pointSize;\n          const colorByValue = scatterInfo.color.field != null; // && colorMode.isByValue;\n\n          let maxSize = (pointSize.max ?? pointSize.fixed) * pxRatio;\n\n          // todo: this depends on direction & orientation\n          // todo: calc once per redraw, not per path\n          let filtLft = u.posToVal(-maxSize / 2, xKey);\n          let filtRgt = u.posToVal(u.bbox.width / pxRatio + maxSize / 2, xKey);\n          let filtBtm = u.posToVal(u.bbox.height / pxRatio + maxSize / 2, yKey);\n          let filtTop = u.posToVal(-maxSize / 2, yKey);\n\n          let sizes = opts.disp.size.values(u, seriesIdx);\n          // let pointColors = opts.disp.color.values(u, seriesIdx);\n          let pointColors = dispColors[seriesIdx - 1].values; // idxs\n          let pointPalette = dispColors[seriesIdx - 1].index as Array<CanvasRenderingContext2D['fillStyle']>;\n          let paletteHasAlpha = dispColors[seriesIdx - 1].hasAlpha;\n\n          let isSquare = scatterInfo.pointShape === PointShape.Square;\n\n          let linePath: Path2D | null = showLine ? new Path2D() : null;\n\n          let curColorIdx = -1;\n\n          for (let i = 0; i < d[0].length; i++) {\n            let xVal = d[0][i];\n            let yVal = d[1][i];\n\n            if (xVal >= filtLft && xVal <= filtRgt && yVal >= filtBtm && yVal <= filtTop) {\n              let size = Math.round(sizes[i] * pxRatio);\n              let cx = valToPosX(xVal, scaleX, xDim, xOff);\n              let cy = valToPosY(yVal, scaleY, yDim, yOff);\n\n              if (showLine) {\n                linePath!.lineTo(cx, cy);\n              }\n\n              if (showPoints) {\n                if (colorByValue) {\n                  if (pointColors[i] !== curColorIdx) {\n                    curColorIdx = pointColors[i];\n                    let c = curColorIdx === -1 ? FALLBACK_COLOR : pointPalette[curColorIdx];\n                    u.ctx.fillStyle = paletteHasAlpha ? c : alpha(c as string, pointAlpha);\n                    u.ctx.strokeStyle = alpha(c as string, 1);\n                  }\n                }\n\n                if (isSquare) {\n                  let x = Math.round(cx - size / 2);\n                  let y = Math.round(cy - size / 2);\n\n                  if (colorByValue || pointAlpha > 0) {\n                    u.ctx.fillRect(x, y, size, size);\n                  }\n\n                  if (strokeWidth > 0) {\n                    u.ctx.strokeRect(x, y, size, size);\n                  }\n                } else {\n                  u.ctx.beginPath();\n                  u.ctx.arc(cx, cy, size / 2, 0, deg360);\n\n                  if (colorByValue || pointAlpha > 0) {\n                    u.ctx.fill();\n                  }\n\n                  if (strokeWidth > 0) {\n                    u.ctx.stroke();\n                  }\n                }\n\n                opts.each(\n                  u,\n                  seriesIdx,\n                  i,\n                  cx - size / 2 - strokeWidth / 2,\n                  cy - size / 2 - strokeWidth / 2,\n                  size + strokeWidth,\n                  size + strokeWidth\n                );\n              }\n            }\n          }\n\n          if (showLine) {\n            u.ctx.strokeStyle = scatterInfo.color.fixed!;\n            u.ctx.lineWidth = scatterInfo.lineWidth * pxRatio;\n\n            const { lineStyle } = scatterInfo;\n            if (lineStyle && lineStyle.fill !== 'solid') {\n              if (lineStyle.fill === 'dot') {\n                u.ctx.lineCap = 'round';\n              }\n              u.ctx.setLineDash(lineStyle.dash ?? [10, 10]);\n            }\n\n            u.ctx.stroke(linePath!);\n          }\n\n          u.ctx.restore();\n        }\n      );\n\n      return null;\n    };\n\n    return drawBubbles;\n  }\n\n  let drawBubbles = drawBubblesFactory({\n    disp: {\n      size: {\n        //unit: 3, // raw CSS pixels\n        values: (u, seriesIdx) => {\n          return u.data[seriesIdx][2] as any; // already contains final pixel geometry\n          //let [minValue, maxValue] = getSizeMinMax(u);\n          //return u.data[seriesIdx][2].map(v => getSize(v, minValue, maxValue));\n        },\n      },\n      color: {\n        // string values\n        values: (u, seriesIdx) => {\n          return u.data[seriesIdx][3] as any;\n        },\n      },\n    },\n    each: (u, seriesIdx, dataIdx, lft, top, wid, hgt) => {\n      // we get back raw canvas coords (included axes & padding). translate to the plotting area origin\n      lft -= u.bbox.left;\n      top -= u.bbox.top;\n      qt.add({ x: lft, y: top, w: wid, h: hgt, sidx: seriesIdx, didx: dataIdx });\n    },\n  });\n\n  const builder = new UPlotConfigBuilder();\n\n  builder.setCursor({\n    drag: { setScale: true },\n    dataIdx: (u, seriesIdx) => {\n      if (seriesIdx === 1) {\n        const pxRatio = uPlot.pxRatio;\n\n        hRect = null;\n\n        let dist = Infinity;\n        let cx = u.cursor.left! * pxRatio;\n        let cy = u.cursor.top! * pxRatio;\n\n        qt.get(cx, cy, 1, 1, (o) => {\n          if (pointWithin(cx, cy, o.x, o.y, o.x + o.w, o.y + o.h)) {\n            let ocx = o.x + o.w / 2;\n            let ocy = o.y + o.h / 2;\n\n            let dx = ocx - cx;\n            let dy = ocy - cy;\n\n            let d = Math.sqrt(dx ** 2 + dy ** 2);\n\n            // test against radius for actual hover\n            if (d <= o.w / 2) {\n              // only hover bbox with closest distance\n              if (d <= dist) {\n                dist = d;\n                hRect = o;\n              }\n            }\n          }\n        });\n      }\n\n      return hRect && seriesIdx === hRect.sidx ? hRect.didx : null;\n    },\n    points: {\n      size: (u, seriesIdx) => {\n        return hRect && seriesIdx === hRect.sidx ? hRect.w / uPlot.pxRatio : 0;\n      },\n      fill: (u, seriesIdx) => 'rgba(255,255,255,0.4)',\n    },\n  });\n\n  // clip hover points/bubbles to plotting area\n  builder.addHook('init', (u, r) => {\n    u.over.style.overflow = 'hidden';\n  });\n\n  builder.addHook('drawClear', (u) => {\n    qt = qt || new Quadtree(0, 0, u.bbox.width, u.bbox.height);\n\n    qt.clear();\n\n    // force-clear the path cache to cause drawBars() to rebuild new quadtree\n    u.series.forEach((s, i) => {\n      if (i > 0) {\n        // @ts-ignore\n        s._paths = null;\n      }\n    });\n  });\n\n  builder.setMode(2);\n\n  let xField = xySeries[0].x.field;\n\n  let fieldConfig = xField.config;\n  let customConfig = fieldConfig.custom;\n  let scaleDistr = customConfig?.scaleDistribution;\n\n  builder.addScale({\n    scaleKey: 'x',\n    isTime: false,\n    orientation: ScaleOrientation.Horizontal,\n    direction: ScaleDirection.Right,\n    distribution: scaleDistr?.type,\n    log: scaleDistr?.log,\n    linearThreshold: scaleDistr?.linearThreshold,\n    min: fieldConfig.min,\n    max: fieldConfig.max,\n    softMin: customConfig?.axisSoftMin,\n    softMax: customConfig?.axisSoftMax,\n    centeredZero: customConfig?.axisCenteredZero,\n    decimals: fieldConfig.decimals,\n  });\n\n  // why does this fall back to '' instead of null or undef?\n  let xAxisLabel = customConfig.axisLabel;\n\n  if (xAxisLabel == null || xAxisLabel === '') {\n    let dispNames = xySeries.map((s) => s.x.field.state?.displayName ?? '');\n\n    let xAxisAutoLabel =\n      xySeries.length === 1\n        ? (xField.state?.displayName ?? xField.name)\n        : new Set(dispNames).size === 1\n          ? dispNames[0]\n          : getCommonPrefixSuffix(dispNames);\n\n    if (xAxisAutoLabel !== '') {\n      xAxisLabel = xAxisAutoLabel;\n    }\n  }\n\n  builder.addAxis({\n    scaleKey: 'x',\n    placement: customConfig?.axisPlacement !== AxisPlacement.Hidden ? AxisPlacement.Bottom : AxisPlacement.Hidden,\n    show: customConfig?.axisPlacement !== AxisPlacement.Hidden,\n    grid: { show: customConfig?.axisGridShow },\n    border: { show: customConfig?.axisBorderShow },\n    theme,\n    label: xAxisLabel,\n    formatValue: (v, decimals) => formattedValueToString(xField.display!(v, decimals)),\n  });\n\n  xySeries.forEach((s, si) => {\n    let field = s.y.field;\n\n    const lineColor = s.color.fixed;\n    const pointColor = s.color.fixed;\n    //const lineColor = s.lineColor(frame);\n    //const lineWidth = s.lineWidth;\n\n    let scaleKey = field.config.unit ?? 'y';\n    let config = field.config;\n    let customConfig = config.custom;\n    let scaleDistr = customConfig?.scaleDistribution;\n\n    builder.addScale({\n      scaleKey,\n      orientation: ScaleOrientation.Vertical,\n      direction: ScaleDirection.Up,\n      distribution: scaleDistr?.type,\n      log: scaleDistr?.log,\n      linearThreshold: scaleDistr?.linearThreshold,\n      min: config.min,\n      max: config.max,\n      softMin: customConfig?.axisSoftMin,\n      softMax: customConfig?.axisSoftMax,\n      centeredZero: customConfig?.axisCenteredZero,\n      decimals: config.decimals,\n    });\n\n    // why does this fall back to '' instead of null or undef?\n    let yAxisLabel = customConfig.axisLabel;\n\n    if (yAxisLabel == null || yAxisLabel === '') {\n      let dispNames = xySeries.map((s) => s.y.field.state?.displayName ?? '');\n\n      let yAxisAutoLabel =\n        xySeries.length === 1\n          ? (field.state?.displayName ?? field.name)\n          : new Set(dispNames).size === 1\n            ? dispNames[0]\n            : getCommonPrefixSuffix(dispNames);\n\n      if (yAxisAutoLabel !== '') {\n        yAxisLabel = yAxisAutoLabel;\n      }\n    }\n\n    builder.addAxis({\n      scaleKey,\n      theme,\n      placement: customConfig?.axisPlacement === AxisPlacement.Auto ? AxisPlacement.Left : customConfig?.axisPlacement,\n      show: customConfig?.axisPlacement !== AxisPlacement.Hidden,\n      grid: { show: customConfig?.axisGridShow },\n      border: { show: customConfig?.axisBorderShow },\n      size: customConfig?.axisWidth,\n      // label: yAxisLabel == null || yAxisLabel === '' ? fieldDisplayName : yAxisLabel,\n      label: yAxisLabel,\n      formatValue: (v, decimals) => formattedValueToString(field.display!(v, decimals)),\n    });\n\n    builder.addSeries({\n      facets: [\n        {\n          scale: 'x',\n          auto: true,\n        },\n        {\n          scale: scaleKey,\n          auto: true,\n        },\n      ],\n      pathBuilder: drawBubbles, // drawBubbles({disp: {size: {values: () => }}})\n      theme,\n      scaleKey: '', // facets' scales used (above)\n      lineColor: alpha(lineColor ?? '#ffff', 1),\n      fillColor: alpha(pointColor ?? '#ffff', 0.5),\n      show: !field.state?.hideFrom?.viz,\n    });\n  });\n\n  const dispColors = xySeries.map((s): FieldColorValuesWithCache => {\n    const cfg: FieldColorValuesWithCache = {\n      index: [],\n      getAll: () => [],\n      getOne: () => -1,\n      // cache for renderer, refreshed in prepData()\n      values: [],\n      hasAlpha: false,\n    };\n\n    const f = s.color.field;\n\n    if (f != null) {\n      Object.assign(cfg, fieldValueColors(f, theme));\n      cfg.hasAlpha = cfg.index.some((v) => !(v as string).endsWith('ff'));\n    }\n\n    return cfg;\n  });\n\n  function prepData(xySeries: XYSeries[]): FacetedData {\n    // if (info.error || !data.length) {\n    //   return [null];\n    // }\n\n    const { size: sizeRange, color: colorRange } = getGlobalRanges(xySeries);\n\n    xySeries.forEach((s, i) => {\n      dispColors[i].values = dispColors[i].getAll(s.color.field?.values ?? [], colorRange.min, colorRange.max);\n    });\n\n    return [\n      null,\n      ...xySeries.map((s, idx) => {\n        let len = s.x.field.values.length;\n\n        let diams: number[];\n\n        if (s.size.field != null) {\n          let { min, max } = s.size;\n\n          // todo: this scaling should be in renderer from raw values (not by passing css pixel diams via data)\n          let minPx = min! ** 2;\n          let maxPx = max! ** 2;\n          // use quadratic size scaling in byValue modes\n          let pxRange = maxPx - minPx;\n\n          let vals = s.size.field.values;\n          let minVal = sizeRange.min;\n          let maxVal = sizeRange.max;\n          let valRange = maxVal - minVal;\n\n          diams = Array(len);\n\n          for (let i = 0; i < vals.length; i++) {\n            let val = vals[i];\n\n            let valPct = (val - minVal) / valRange;\n            let pxArea = minPx + valPct * pxRange;\n            diams[i] = pxArea ** 0.5;\n          }\n        } else {\n          diams = Array(len).fill(s.size.fixed!);\n        }\n\n        return [\n          s.x.field.values, // X\n          s.y.field.values, // Y\n          diams,\n          Array(len).fill(s.color.fixed!), // TODO: fails for by value\n        ];\n      }),\n    ];\n  }\n\n  return { builder, prepData };\n};\n\nexport type PrepData = (xySeries: XYSeries[]) => FacetedData;\n\nconst getGlobalRanges = (xySeries: XYSeries[]) => {\n  const ranges = {\n    size: {\n      min: Infinity,\n      max: -Infinity,\n    },\n    color: {\n      min: Infinity,\n      max: -Infinity,\n    },\n  };\n\n  xySeries.forEach((series) => {\n    [series.size, series.color].forEach((facet, fi) => {\n      if (facet.field != null) {\n        let range = fi === 0 ? ranges.size : ranges.color;\n\n        const vals = facet.field.values;\n\n        for (let i = 0; i < vals.length; i++) {\n          const v = vals[i];\n\n          if (v != null) {\n            if (v < range.min) {\n              range.min = v;\n            }\n\n            if (v > range.max) {\n              range.max = v;\n            }\n          }\n        }\n      }\n    });\n  });\n\n  return ranges;\n};\n\nfunction getHex8Color(color: string, theme: GrafanaTheme2) {\n  return tinycolor(theme.visualization.getColorByName(color)).toHex8String();\n}\n\ninterface FieldColorValues {\n  index: unknown[];\n  getOne: GetOneValue;\n  getAll: GetAllValues;\n}\ninterface FieldColorValuesWithCache extends FieldColorValues {\n  values: number[];\n  hasAlpha: boolean;\n}\ntype GetAllValues = (values: unknown[], min?: number, max?: number) => number[];\ntype GetOneValue = (value: unknown, min?: number, max?: number) => number;\n\n/** compiler for values to palette color idxs (from thresholds, mappings, by-value gradients) */\nfunction fieldValueColors(f: Field, theme: GrafanaTheme2): FieldColorValues {\n  let index: unknown[] = [];\n  let getAll: GetAllValues = () => [];\n  let getOne: GetOneValue = () => -1;\n\n  let conds = '';\n\n  // if any mappings exist, use them regardless of other settings\n  if (f.config.mappings?.length ?? 0 > 0) {\n    let mappings = f.config.mappings!;\n\n    for (let i = 0; i < mappings.length; i++) {\n      let m = mappings[i];\n\n      if (m.type === MappingType.ValueToText) {\n        for (let k in m.options) {\n          let { color } = m.options[k];\n\n          if (color != null) {\n            let rhs = f.type === FieldType.string ? JSON.stringify(k) : Number(k);\n            conds += `v === ${rhs} ? ${index.length} : `;\n            index.push(getHex8Color(color, theme));\n          }\n        }\n      } else if (m.options.result.color != null) {\n        let { color } = m.options.result;\n\n        if (m.type === MappingType.RangeToText) {\n          let range = [];\n\n          if (m.options.from != null) {\n            range.push(`v >= ${Number(m.options.from)}`);\n          }\n\n          if (m.options.to != null) {\n            range.push(`v <= ${Number(m.options.to)}`);\n          }\n\n          if (range.length > 0) {\n            conds += `${range.join(' && ')} ? ${index.length} : `;\n            index.push(getHex8Color(color, theme));\n          }\n        } else if (m.type === MappingType.SpecialValue) {\n          let spl = m.options.match;\n\n          if (spl === SpecialValueMatch.NaN) {\n            conds += `isNaN(v)`;\n          } else if (spl === SpecialValueMatch.NullAndNaN) {\n            conds += `v == null || isNaN(v)`;\n          } else {\n            conds += `v ${\n              spl === SpecialValueMatch.True\n                ? '=== true'\n                : spl === SpecialValueMatch.False\n                  ? '=== false'\n                  : spl === SpecialValueMatch.Null\n                    ? '== null'\n                    : spl === SpecialValueMatch.Empty\n                      ? '=== \"\"'\n                      : '== null'\n            }`;\n          }\n\n          conds += ` ? ${index.length} : `;\n          index.push(getHex8Color(color, theme));\n        } else if (m.type === MappingType.RegexToText) {\n          // TODO\n        }\n      }\n    }\n\n    conds += '-1'; // ?? what default here? null? FALLBACK_COLOR?\n  } else if (f.config.color?.mode === FieldColorModeId.Thresholds) {\n    if (f.config.thresholds?.mode === ThresholdsMode.Absolute) {\n      let steps = f.config.thresholds.steps;\n      let lasti = steps.length - 1;\n\n      for (let i = lasti; i > 0; i--) {\n        conds += `v >= ${steps[i].value} ? ${i} : `;\n      }\n\n      conds += '0';\n\n      index = steps.map((s) => getHex8Color(s.color, theme));\n    } else {\n      // TODO: percent thresholds?\n    }\n  } else if (f.config.color?.mode?.startsWith('continuous')) {\n    let calc = getFieldColorModeForField(f).getCalculator(f, theme);\n\n    index = Array(32);\n\n    for (let i = 0; i < index.length; i++) {\n      let pct = i / (index.length - 1);\n      index[i] = getHex8Color(calc(pct, pct), theme);\n    }\n\n    getAll = (vals, min, max) => valuesToFills(vals as number[], index as string[], min!, max!);\n  }\n\n  if (conds !== '') {\n    getOne = new Function('v', `return ${conds};`) as GetOneValue;\n\n    getAll = new Function(\n      'vals',\n      `\n      let idxs = Array(vals.length);\n\n      for (let i = 0; i < vals.length; i++) {\n        let v = vals[i];\n        idxs[i] = ${conds};\n      }\n\n      return idxs;\n    `\n    ) as GetAllValues;\n  }\n\n  return {\n    index,\n    getOne,\n    getAll,\n  };\n}\n","import { css } from '@emotion/css';\nimport { useMemo } from 'react';\n\nimport { FALLBACK_COLOR, PanelProps } from '@grafana/data';\nimport { alpha } from '@grafana/data/src/themes/colorManipulator';\nimport { config } from '@grafana/runtime';\nimport {\n  TooltipDisplayMode,\n  TooltipPlugin2,\n  UPlotChart,\n  VizLayout,\n  VizLegend,\n  VizLegendItem,\n  useStyles2,\n  useTheme2,\n} from '@grafana/ui';\nimport { TooltipHoverMode } from '@grafana/ui/src/components/uPlot/plugins/TooltipPlugin2';\nimport { getDisplayValuesForCalcs } from '@grafana/ui/src/components/uPlot/utils';\n\nimport { XYChartTooltip } from './XYChartTooltip';\nimport { Options } from './panelcfg.gen';\nimport { prepConfig } from './scatter';\nimport { prepSeries } from './utils';\n\ntype Props2 = PanelProps<Options>;\n\nexport const XYChartPanel2 = (props: Props2) => {\n  const styles = useStyles2(getStyles);\n  const theme = useTheme2();\n\n  let { mapping, series: mappedSeries } = props.options;\n\n  // regenerate series schema when mappings or data changes\n  let series = useMemo(\n    () => prepSeries(mapping, mappedSeries, props.data.series, props.fieldConfig),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [mapping, mappedSeries, props.data.series, props.fieldConfig]\n  );\n\n  // if series changed due to mappings or data structure, re-init config & renderers\n  let { builder, prepData } = useMemo(\n    () => prepConfig(series, config.theme2),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [mapping, mappedSeries, props.data.structureRev, props.fieldConfig, props.options.tooltip]\n  );\n\n  // generate data struct for uPlot mode: 2\n  let data = useMemo(\n    () => prepData(series),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [series]\n  );\n\n  // todo: handle errors\n  let error = builder == null || data.length === 0 ? 'Err' : '';\n\n  // TODO: React.memo()\n  const renderLegend = () => {\n    if (!props.options.legend.showLegend) {\n      return null;\n    }\n\n    const items: VizLegendItem[] = [];\n\n    series.forEach((s, idx) => {\n      let yField = s.y.field;\n      let config = yField.config;\n      let custom = config.custom;\n\n      if (!custom.hideFrom?.legend) {\n        items.push({\n          yAxis: 1, // TODO: pull from y field\n          label: s.name.value,\n          color: alpha(s.color.fixed ?? FALLBACK_COLOR, 1),\n          getItemKey: () => `${idx}-${s.name.value}`,\n          fieldName: yField.state?.displayName ?? yField.name,\n          disabled: yField.state?.hideFrom?.viz ?? false,\n          getDisplayValues: () => getDisplayValuesForCalcs(props.options.legend.calcs, yField, theme),\n        });\n      }\n    });\n\n    const { placement, displayMode, width, sortBy, sortDesc } = props.options.legend;\n\n    return (\n      <VizLayout.Legend placement={placement} width={width}>\n        <VizLegend\n          className={styles.legend}\n          placement={placement}\n          items={items}\n          displayMode={displayMode}\n          sortBy={sortBy}\n          sortDesc={sortDesc}\n          isSortable={true}\n        />\n      </VizLayout.Legend>\n    );\n  };\n\n  if (error) {\n    return (\n      <div className=\"panel-empty\">\n        <p>{error}</p>\n      </div>\n    );\n  }\n\n  return (\n    <VizLayout width={props.width} height={props.height} legend={renderLegend()}>\n      {(vizWidth: number, vizHeight: number) => (\n        <UPlotChart config={builder!} data={data} width={vizWidth} height={vizHeight}>\n          {props.options.tooltip.mode !== TooltipDisplayMode.None && (\n            <TooltipPlugin2\n              config={builder!}\n              hoverMode={TooltipHoverMode.xyOne}\n              render={(u, dataIdxs, seriesIdx, isPinned, dismiss) => {\n                return (\n                  <XYChartTooltip\n                    data={props.data.series}\n                    dataIdxs={dataIdxs}\n                    xySeries={series}\n                    dismiss={dismiss}\n                    isPinned={isPinned}\n                    seriesIdx={seriesIdx!}\n                    replaceVariables={props.replaceVariables}\n                  />\n                );\n              }}\n              maxWidth={props.options.tooltip.maxWidth}\n            />\n          )}\n        </UPlotChart>\n      )}\n    </VizLayout>\n  );\n};\n\nconst getStyles = () => ({\n  legend: css({\n    div: {\n      justifyContent: 'flex-start',\n    },\n  }),\n});\n","import {\n  FieldColorModeId,\n  FieldConfigProperty,\n  FieldType,\n  identityOverrideProcessor,\n  SetFieldConfigOptionsArgs,\n} from '@grafana/data';\nimport { LineStyle } from '@grafana/schema';\nimport { commonOptionsBuilder } from '@grafana/ui';\n\nimport { LineStyleEditor } from '../../timeseries/LineStyleEditor';\n\nimport { FieldConfig, XYShowMode, PointShape } from './panelcfg.gen';\n\nexport const DEFAULT_POINT_SIZE = 5;\n\nexport function getScatterFieldConfig(cfg: FieldConfig): SetFieldConfigOptionsArgs<FieldConfig> {\n  return {\n    standardOptions: {\n      [FieldConfigProperty.Min]: {\n        hideFromDefaults: true,\n      },\n      [FieldConfigProperty.Max]: {\n        hideFromDefaults: true,\n      },\n      [FieldConfigProperty.Unit]: {\n        hideFromDefaults: true,\n      },\n      [FieldConfigProperty.Decimals]: {\n        hideFromDefaults: true,\n      },\n      [FieldConfigProperty.NoValue]: {\n        hideFromDefaults: true,\n      },\n      [FieldConfigProperty.DisplayName]: {\n        hideFromDefaults: true,\n      },\n\n      // TODO: this still leaves Color series by: [ Last | Min | Max ]\n      // because item.settings?.bySeriesSupport && colorMode.isByValue\n      [FieldConfigProperty.Color]: {\n        settings: {\n          byValueSupport: true,\n          bySeriesSupport: true,\n          preferThresholdsMode: false,\n        },\n        defaultValue: {\n          mode: FieldColorModeId.PaletteClassic,\n        },\n      },\n    },\n\n    useCustomConfig: (builder) => {\n      builder\n        .addRadio({\n          path: 'show',\n          name: 'Show',\n          defaultValue: cfg.show,\n          settings: {\n            options: [\n              { label: 'Points', value: XYShowMode.Points },\n              { label: 'Lines', value: XYShowMode.Lines },\n              { label: 'Both', value: XYShowMode.PointsAndLines },\n            ],\n          },\n        })\n        // .addGenericEditor(\n        //   {\n        //     path: 'pointSymbol',\n        //     name: 'Point symbol',\n        //     defaultValue: defaultFieldConfig.pointSymbol ?? {\n        //       mode: 'fixed',\n        //       fixed: 'img/icons/marker/circle.svg',\n        //     },\n        //     settings: {\n        //       resourceType: MediaType.Icon,\n        //       folderName: ResourceFolderName.Marker,\n        //       placeholderText: 'Select a symbol',\n        //       placeholderValue: 'img/icons/marker/circle.svg',\n        //       showSourceRadio: false,\n        //     },\n        //     showIf: (c) => c.show !== ScatterShow.Lines,\n        //   },\n        //   SymbolEditor // ResourceDimensionEditor\n        // )\n        .addSliderInput({\n          path: 'pointSize.fixed',\n          name: 'Point size',\n          defaultValue: cfg.pointSize?.fixed ?? DEFAULT_POINT_SIZE,\n          settings: {\n            min: 1,\n            max: 100,\n            step: 1,\n          },\n          showIf: (c) => c.show !== XYShowMode.Lines,\n        })\n        .addNumberInput({\n          path: 'pointSize.min',\n          name: 'Min point size',\n          showIf: (c) => c.show !== XYShowMode.Lines,\n        })\n        .addNumberInput({\n          path: 'pointSize.max',\n          name: 'Max point size',\n          showIf: (c) => c.show !== XYShowMode.Lines,\n        })\n        .addRadio({\n          path: 'pointShape',\n          name: 'Point shape',\n          defaultValue: PointShape.Circle,\n          settings: {\n            options: [\n              { value: PointShape.Circle, label: 'Circle' },\n              { value: PointShape.Square, label: 'Square' },\n            ],\n          },\n          showIf: (c) => c.show !== XYShowMode.Lines,\n        })\n        .addSliderInput({\n          path: 'pointStrokeWidth',\n          name: 'Point stroke width',\n          defaultValue: 1,\n          settings: {\n            min: 0,\n            max: 10,\n          },\n          showIf: (c) => c.show !== XYShowMode.Lines,\n        })\n        .addSliderInput({\n          path: 'fillOpacity',\n          name: 'Fill opacity',\n          defaultValue: 50,\n          settings: {\n            min: 0,\n            max: 100,\n            step: 1,\n          },\n          showIf: (c) => c.show !== XYShowMode.Lines,\n        })\n        .addCustomEditor<void, LineStyle>({\n          id: 'lineStyle',\n          path: 'lineStyle',\n          name: 'Line style',\n          showIf: (c) => c.show !== XYShowMode.Points,\n          editor: LineStyleEditor,\n          override: LineStyleEditor,\n          process: identityOverrideProcessor,\n          shouldApply: (f) => f.type === FieldType.number,\n        })\n        .addSliderInput({\n          path: 'lineWidth',\n          name: 'Line width',\n          defaultValue: cfg.lineWidth,\n          settings: {\n            min: 0,\n            max: 10,\n            step: 1,\n          },\n          showIf: (c) => c.show !== XYShowMode.Points,\n        });\n\n      commonOptionsBuilder.addAxisConfig(builder, cfg);\n      commonOptionsBuilder.addHideFrom(builder);\n    },\n  };\n}\n","import { FieldMatcherID, FrameMatcherID, MatcherConfig, PanelModel } from '@grafana/data';\n\nimport { ScatterSeriesConfig, SeriesMapping, XYDimensionConfig, Options as PrevOptions } from '../panelcfg.gen';\n\nimport { XYSeriesConfig, Options } from './panelcfg.gen';\n\nexport const xyChartMigrationHandler = (panel: PanelModel): Options => {\n  const pluginVersion = panel?.pluginVersion ?? '';\n\n  if (pluginVersion === '' || parseFloat(pluginVersion) < 11.1) {\n    return migrateOptions(panel);\n  }\n\n  return panel.options;\n};\n\nfunction migrateOptions(panel: PanelModel): Options {\n  const { dims, seriesMapping, series: oldSeries, ...cleanedOpts } = panel.options as PrevOptions;\n  const { exclude = [], frame: frameShared, x: xShared }: XYDimensionConfig = dims ?? {};\n\n  const custDefaults = panel.fieldConfig.defaults.custom;\n\n  let oldSeries2 = oldSeries;\n\n  if (seriesMapping === SeriesMapping.Auto) {\n    oldSeries2 = [\n      {\n        x: undefined,\n        y: undefined,\n      },\n    ];\n  }\n\n  /*\n  // old manual mode example\n  \"series\": [\n    {\n      \"pointColor\": {\n        \"fixed\": \"purple\"       // this becomes override for y field.config.custom.pointColor.fixed, (or config.color?)\n        \"field\": \"BMI Male\",    // ...unless another field is mapped, then ignore\n      },\n      \"pointSize\": {\n        \"field\": \"Weight Male\",\n        \"max\": 40,              // this becomes override for y field.config.custom.pointSize.max\n        \"min\": 1,               // ...and .min\n        \"fixed\": 50.5\n      },\n      \"frame\": 0,               // byIndex frame matcher\n      \"x\": \"Height Male\",       // byName field matcher, falls back to byType/number field matcher\n      \"y\": \"Weight Male\"        // byName field matcher, falls back to byType/number field matcher\n    }\n  ],\n*/\n  let i = 0;\n\n  const newSeries: XYSeriesConfig[] = oldSeries2.map(({ x, y, pointColor, pointSize, frame }: ScatterSeriesConfig) => {\n    const { fixed: colorFixed, field: colorField } = pointColor ?? {};\n    const { fixed: sizeFixed, field: sizeField, min: sizeMin, max: sizeMax } = pointSize ?? {};\n\n    let xMatcherConfig: MatcherConfig;\n    let yMatcherConfig: MatcherConfig;\n\n    // old auto mode did not require x field defined\n    if (x == null && xShared == null) {\n      // TODO: this should just be the internal default. no need to store on save model\n      xMatcherConfig = {\n        id: FieldMatcherID.byType,\n        options: 'number',\n      };\n    } else {\n      xMatcherConfig = {\n        id: FieldMatcherID.byName,\n        options: x ?? xShared,\n      };\n    }\n\n    if (y == null) {\n      // TODO: this should just be the internal default. no need to store on save model\n      yMatcherConfig = {\n        id: FieldMatcherID.byType,\n        options: 'number',\n      };\n    } else {\n      yMatcherConfig = {\n        id: FieldMatcherID.byName,\n        options: y,\n      };\n    }\n\n    if (colorField == null && colorFixed && custDefaults.pointColor?.fixed !== colorFixed) {\n      // NOTE: intentionally not using custom.pointColor.fixed\n      let hasOverride = panel.fieldConfig.overrides.some(\n        (o) =>\n          o.matcher.id === yMatcherConfig.id &&\n          o.matcher.options === yMatcherConfig.options &&\n          o.properties.some((p) => p.id === 'color')\n      );\n\n      if (!hasOverride) {\n        panel.fieldConfig.overrides.push({\n          matcher: yMatcherConfig,\n          properties: [\n            {\n              id: 'color',\n              value: {\n                mode: 'fixed',\n                fixedColor: colorFixed,\n              },\n            },\n          ],\n        });\n      }\n    }\n\n    // add field overrides for custom pointSize.fixed\n    if (sizeField == null && sizeFixed && custDefaults.pointSize?.fixed !== sizeFixed) {\n      let hasOverride = panel.fieldConfig.overrides.some(\n        (o) =>\n          o.matcher.id === yMatcherConfig.id &&\n          o.matcher.options === yMatcherConfig.options &&\n          o.properties.some((p) => p.id === 'custom.pointSize.fixed')\n      );\n\n      if (!hasOverride) {\n        panel.fieldConfig.overrides.push({\n          matcher: yMatcherConfig,\n          properties: [\n            {\n              id: 'custom.pointSize.fixed',\n              value: sizeFixed,\n            },\n          ],\n        });\n      }\n    }\n\n    if (sizeField != null) {\n      // add field overrides for custom pointSize.min\n      if (sizeMin && custDefaults.pointSize?.min !== sizeMin) {\n        let hasOverride = panel.fieldConfig.overrides.some(\n          (o) =>\n            o.matcher.id === yMatcherConfig.id &&\n            o.matcher.options === yMatcherConfig.options &&\n            o.properties.some((p) => p.id === 'custom.pointSize.min')\n        );\n\n        if (!hasOverride) {\n          panel.fieldConfig.overrides.push({\n            matcher: {\n              id: FieldMatcherID.byName,\n              options: sizeField,\n            },\n            properties: [\n              {\n                id: 'custom.pointSize.min',\n                value: sizeMin,\n              },\n            ],\n          });\n        }\n      }\n      // add field overrides for custom pointSize.min\n      if (sizeMax && custDefaults.pointSize?.max !== sizeMax) {\n        let hasOverride = panel.fieldConfig.overrides.some(\n          (o) =>\n            o.matcher.id === yMatcherConfig.id &&\n            o.matcher.options === yMatcherConfig.options &&\n            o.properties.some((p) => p.id === 'custom.pointSize.max')\n        );\n\n        if (!hasOverride) {\n          panel.fieldConfig.overrides.push({\n            matcher: {\n              id: FieldMatcherID.byName,\n              options: sizeField,\n            },\n            properties: [\n              {\n                id: 'custom.pointSize.max',\n                value: sizeMax,\n              },\n            ],\n          });\n        }\n      }\n    }\n\n    return {\n      frame: {\n        matcher: {\n          id: FrameMatcherID.byIndex,\n          options: frame ?? (seriesMapping === SeriesMapping.Manual ? i++ : (frameShared ?? 0)),\n        },\n      },\n      x: {\n        matcher: xMatcherConfig,\n      },\n      y: {\n        matcher: yMatcherConfig,\n        ...(exclude.length && {\n          exclude: {\n            id: FieldMatcherID.byNames,\n            options: exclude,\n          },\n        }),\n      },\n      ...(colorField && {\n        color: {\n          matcher: {\n            id: FieldMatcherID.byName,\n            options: colorField,\n          },\n        },\n      }),\n      ...(sizeField && {\n        size: {\n          matcher: {\n            id: FieldMatcherID.byName,\n            options: sizeField,\n          },\n        },\n      }),\n    };\n  });\n\n  const newOptions: Options = {\n    ...cleanedOpts,\n    mapping: seriesMapping === SeriesMapping.Auto ? SeriesMapping.Auto : SeriesMapping.Manual,\n    series: newSeries,\n  };\n\n  return newOptions;\n}\n","import { PanelPlugin } from '@grafana/data';\nimport { commonOptionsBuilder } from '@grafana/ui';\n\nimport { SeriesEditor } from './SeriesEditor';\nimport { XYChartPanel2 } from './XYChartPanel';\nimport { getScatterFieldConfig } from './config';\nimport { xyChartMigrationHandler } from './migrations';\nimport { FieldConfig, defaultFieldConfig, Options } from './panelcfg.gen';\n\nexport const plugin = new PanelPlugin<Options, FieldConfig>(XYChartPanel2)\n  // .setPanelChangeHandler(xyChartChangeHandler)\n  .setMigrationHandler(xyChartMigrationHandler)\n  .useFieldConfig(getScatterFieldConfig(defaultFieldConfig))\n  .setPanelOptions((builder) => {\n    builder\n      .addRadio({\n        path: 'mapping',\n        name: 'Series mapping',\n        defaultValue: 'auto',\n        settings: {\n          options: [\n            { value: 'auto', label: 'Auto' },\n            { value: 'manual', label: 'Manual' },\n          ],\n        },\n      })\n      .addCustomEditor({\n        id: 'series',\n        path: 'series',\n        name: '',\n        editor: SeriesEditor,\n        defaultValue: [{}],\n      });\n\n    commonOptionsBuilder.addTooltipOptions(builder, true);\n    commonOptionsBuilder.addLegendOptions(builder);\n  });\n"],"names":["LayerName","name","onChange","verifyLayerNameUniqueness","overrideStyles","styles","getStyles","isEditing","setIsEditing","validationError","setValidationError","onEditLayer","event","onEndEditName","newName","onInputChange","onEditLayerBlur","onKeyDown","onFocus","theme","PointShape","SeriesMapping","XYShowMode","defaultMatcherConfig","defaultFieldConfig","defaultOptions","SeriesEditor","seriesCfg","context","style","mapping","prevMapping","usePrevious","mappingChanged","defaultFrame","selectedIdx","setSelectedIdx","addSeries","deleteSeries","index","s","i","series","formKey","baseNameMode","frame","frameIndex","field","fieldIndex","Button","e","v","IconButton","Fragment","Field","Select","opt","FieldNamePicker","fieldName","fmt","val","getFrameMatcher2","config","prepSeries","mappedSeries","frames","fieldConfig","palette","getColorByName","seriesIdx","xMatcher","yMatcher","colorMatcher","sizeMatcher","frameMatcher","frameIdx","restFields","frameSeries","onlyNumFields","x","color","size","y","ser","paletteIdx","colorCfg","value","autoNameSeries","names","prefix","suffix","findCommonPrefixSuffixLengths","getCommonPrefixSuffix","strs","n","parts","commonPrefixLen","commonSuffixLen","segs0","segs","preLen","j","sufLen","stripSeriesName","seriesName","XYChartTooltip","dataIdxs","data","xySeries","dismiss","isPinned","replaceVariables","rowIndex","idx","xField","yField","sizeField","colorField","label","seriesColor","headerItem","contentItems","footer","links","yFieldFrame","actions","VizTooltipFooter","VizTooltipWrapper","VizTooltipHeader","VizTooltipContent","prepConfig","qt","hRect","drawBubblesFactory","opts","u","idx0","idx1","dataX","dataY","scaleX","scaleY","valToPosX","valToPosY","xOff","yOff","xDim","yDim","moveTo","lineTo","rect","arc","pxRatio","scatterInfo","d","showLine","showPoints","strokeWidth","pointAlpha","deg360","xKey","yKey","pointSize","colorByValue","maxSize","filtLft","filtRgt","filtBtm","filtTop","sizes","pointColors","dispColors","pointPalette","paletteHasAlpha","isSquare","linePath","curColorIdx","xVal","yVal","cx","cy","c","lineStyle","drawBubbles","dataIdx","lft","top","wid","hgt","builder","UPlotConfigBuilder","dist","o","ocx","ocy","dx","dy","r","customConfig","scaleDistr","xAxisLabel","dispNames","xAxisAutoLabel","decimals","si","lineColor","pointColor","scaleKey","yAxisLabel","yAxisAutoLabel","cfg","f","fieldValueColors","prepData","sizeRange","colorRange","getGlobalRanges","len","diams","min","max","minPx","pxRange","vals","minVal","valRange","valPct","pxArea","ranges","facet","fi","range","getHex8Color","tinycolor","getAll","getOne","conds","mappings","m","k","rhs","spl","steps","lasti","calc","pct","XYChartPanel2","props","error","renderLegend","items","placement","displayMode","width","sortBy","sortDesc","VizLayout","VizLegend","vizWidth","vizHeight","TooltipPlugin2","DEFAULT_POINT_SIZE","getScatterFieldConfig","LineStyleEditor","xyChartMigrationHandler","panel","pluginVersion","migrateOptions","dims","seriesMapping","oldSeries","cleanedOpts","exclude","frameShared","xShared","custDefaults","oldSeries2","newSeries","colorFixed","sizeFixed","sizeMin","sizeMax","xMatcherConfig","yMatcherConfig","p","PanelPlugin"],"sourceRoot":""}