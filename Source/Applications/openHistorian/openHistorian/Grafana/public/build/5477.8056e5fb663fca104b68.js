"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5477],{15477:(e,t,a)=>{a.d(t,{H:()=>U});var n=a(68404),s=a(18745),r=a(22584),o=a(52772),l=a(16695),i=a(3490),c=a(45916);function u(e){let{dataSourceName:t,isDefault:a,onDefaultChange:n,onNameChange:s}=e;return(0,c.jsx)("div",{className:"gf-form-group","aria-label":"Datasource settings page basic settings",children:(0,c.jsxs)("div",{className:"gf-form-inline",children:[(0,c.jsx)("div",{className:"gf-form max-width-30",children:(0,c.jsx)(i.InlineField,{label:"Name",tooltip:"The name is used when you select the data source in panels. The default data source is 'preselected in new panels.",grow:!0,children:(0,c.jsx)(i.Input,{id:"basic-settings-name",type:"text",value:t,placeholder:"Name",onChange:e=>s(e.currentTarget.value),required:!0,"aria-label":l.wl.pages.DataSource.name})})}),(0,c.jsx)(i.InlineField,{label:"Default",labelWidth:8,children:(0,c.jsx)(i.InlineSwitch,{id:"basic-settings-default",value:a,onChange:e=>{n(e.currentTarget.checked)}})})]})})}var d=a(98163),h=a(47570);function p(e){let{canSave:t,canDelete:a,onDelete:n,onSubmit:s,onTest:r,exploreUrl:o}=e;const u=d.Vt.hasPermission(h.bW.DataSourcesExplore);return(0,c.jsxs)("div",{className:"gf-form-button-row",children:[(0,c.jsx)(i.Button,{variant:"secondary",fill:"solid",type:"button",onClick:()=>history.back(),children:"Back"}),(0,c.jsx)(i.LinkButton,{variant:"secondary",fill:"solid",href:o,disabled:!u,children:"Explore"}),(0,c.jsx)(i.Button,{type:"button",variant:"destructive",disabled:!a,onClick:n,"aria-label":l.wl.pages.DataSource.delete,children:"Delete"}),t&&(0,c.jsx)(i.Button,{type:"submit",variant:"primary",disabled:!t,onClick:e=>s(e),"aria-label":l.wl.pages.DataSource.saveAndTest,children:"Save & test"}),!t&&(0,c.jsx)(i.Button,{variant:"primary",onClick:r,children:"Test"})]})}var g=a(12011),f=a(53772),m=a(78837);function x(e){var t;let{dataSource:a}=e,n="",s="";if(a.readOnly||(null!==(t=a.version)&&void 0!==t?t:0)>2)return null;if(m.vc.buildInfo.edition!==g.e.OpenSource)return null;switch(a.type){case"prometheus":n="Prometheus",s="Loki";break;case"loki":n="Loki",s="Prometheus";break;default:return null}return(0,c.jsx)(f.G,{storageKey:"datasources.settings.cloudInfoBox.isDismissed",defaultValue:!1,children:(e,t)=>e?null:(0,c.jsxs)(i.Alert,{title:`Configure your ${n} data source below`,severity:"info",bottomSpacing:4,onRemove:()=>{t(!0)},children:["Or skip the effort and get ",n," (and ",s,") as fully-managed, scalable, and hosted data sources from Grafana Labs with the"," ",(0,c.jsx)("a",{className:"external-link",href:`https://grafana.com/signup/cloud/connect-account?src=grafana-oss&cnt=${a.type}-settings`,target:"_blank",rel:"noreferrer",title:"The free plan includes 10k active metrics and 50gb storage.",children:"free-forever Grafana Cloud plan"}),"."]})})}function b(){return(0,c.jsx)(i.Alert,{"aria-label":l.wl.pages.DataSource.readOnly,severity:"info",title:"Provisioned data source",children:"This data source was added by config and cannot be modified using the UI. Please contact your server admin to update this data source."})}var v,S;function j(e){let{dataSourceRights:t,onDelete:a}=e;const{readOnly:n,hasDeleteRights:s}=t,r=!n&&s;return(0,c.jsxs)(c.Fragment,{children:[n&&(v||(v=(0,c.jsx)(b,{}))),(0,c.jsxs)("div",{className:"gf-form-button-row",children:[r&&(0,c.jsx)(i.Button,{type:"submit",variant:"destructive",onClick:a,children:"Delete"}),(0,c.jsx)(i.Button,{variant:"secondary",fill:"outline",type:"button",onClick:()=>history.back(),children:"Back"})]})]})}function D(){return S||(S=(0,c.jsx)(i.Alert,{severity:"info",title:"Missing rights",children:"You are not allowed to modify this data source. Please contact your server admin to update this data source."}))}function y(e){let{plugin:t,pageId:a}=e;if(!t||!t.configPages)return null;const n=t.configPages.find((e=>{let{id:t}=e;return t===a}));return n?(0,c.jsx)(n.body,{plugin:t,query:{}}):(0,c.jsxs)("div",{children:["Page not found: ",n]})}var C=a(82897),w=a(90923);function k(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class I extends n.PureComponent{constructor(e){super(e),k(this,"element",null),k(this,"component",void 0),k(this,"scopeProps",void 0),k(this,"onModelChanged",(e=>{this.props.onModelChange(e)})),this.scopeProps={ctrl:{datasourceMeta:e.dataSourceMeta,current:(0,C.cloneDeep)(e.dataSource)},onModelChanged:this.onModelChanged},this.onModelChanged=this.onModelChanged.bind(this)}componentDidMount(){const{plugin:e}=this.props;if(this.element&&!e.components.ConfigEditor){const e=(0,w.getAngularLoader)(),t='<plugin-component type="datasource-config-ctrl" />';this.component=e.load(this.element,this.scopeProps,t)}}componentDidUpdate(e){const{plugin:t}=this.props;var a;t.components.ConfigEditor||this.props.dataSource===e.dataSource||(this.scopeProps.ctrl.current=(0,C.cloneDeep)(this.props.dataSource),null===(a=this.component)||void 0===a||a.digest())}componentWillUnmount(){this.component&&this.component.destroy()}render(){const{plugin:e,dataSource:t}=this.props;return e?(0,c.jsx)("div",{ref:e=>this.element=e,children:e.components.ConfigEditor&&n.createElement(e.components.ConfigEditor,{options:t,onOptionsChange:this.onModelChanged})}):null}}var P,M,N,T,E=a(30978);function O(e){let{state:t}=e;return(0,c.jsxs)("div",{className:"gf-form",children:[P||(P=(0,c.jsx)("label",{className:"gf-form-label width-10",children:"Plugin state"})),(0,c.jsx)("label",{className:"gf-form-label gf-form-label--transparent",children:(0,c.jsx)(E.u,{state:t})})]})}function B(e){var t,a;let{testingStatus:n}=e;const s="error"===(null==n?void 0:n.status),r=null==n?void 0:n.message,o=null==n||null===(t=n.details)||void 0===t?void 0:t.message,u=null==n||null===(a=n.details)||void 0===a?void 0:a.verboseMessage;return r?(0,c.jsx)("div",{className:"gf-form-group p-t-2",children:(0,c.jsx)(i.Alert,{severity:s?"error":"success",title:r,"aria-label":l.wl.pages.DataSource.alert,children:(null==n?void 0:n.details)&&(0,c.jsxs)(c.Fragment,{children:[o,u?(0,c.jsx)("details",{style:{whiteSpace:"pre-wrap"},children:u}):null]})})}):null}function U(e){let{uid:t,pageId:a}=e;(0,o.E)(t);const n=(0,s.useDispatch)(),r=(0,o.wl)(t),l=(0,o.Qs)(r.type),i=(0,o._l)(),u=(0,o.YY)(t),d=(0,o.IA)(t),h=(0,o.q6)(),p=(0,o.hw)(t),g=(0,o.qj)();return(0,c.jsx)(A,{pageId:a,dataSource:r,dataSourceMeta:l,dataSourceSettings:i,dataSourceRights:u,exploreUrl:d,onDelete:h,onDefaultChange:e=>n((0,o.yr)(e)),onNameChange:e=>n((0,o.BX)(e)),onOptionsChange:e=>n((0,o.rl)(e)),onTest:p,onUpdate:g})}function A(e){let{pageId:t,dataSource:a,dataSourceMeta:n,dataSourceSettings:s,dataSourceRights:o,exploreUrl:l,onDelete:i,onDefaultChange:d,onNameChange:h,onOptionsChange:g,onTest:f,onUpdate:m}=e;const{plugin:v,loadError:S,testingStatus:C,loading:w}=s,{readOnly:k,hasWriteRights:P,hasDeleteRights:E}=o,U=a.id>0,A=async e=>{e.preventDefault(),await m(Object.assign({},a)),f()};return S?(0,c.jsx)(j,{dataSourceRights:o,onDelete:i}):w?M||(M=(0,c.jsx)(r.Z,{})):U?t?(0,c.jsx)(y,{pageId:t,plugin:v}):(0,c.jsxs)("form",{onSubmit:A,children:[!P&&(N||(N=(0,c.jsx)(D,{}))),k&&(T||(T=(0,c.jsx)(b,{}))),n.state&&(0,c.jsx)(O,{state:n.state}),(0,c.jsx)(x,{dataSource:a}),(0,c.jsx)(u,{dataSourceName:a.name,isDefault:a.isDefault,onDefaultChange:d,onNameChange:h}),v&&(0,c.jsx)(I,{plugin:v,dataSource:a,dataSourceMeta:n,onModelChange:g}),(0,c.jsx)(B,{testingStatus:C}),(0,c.jsx)(p,{onSubmit:A,onDelete:i,onTest:f,exploreUrl:l,canSave:!k&&P,canDelete:!k&&E})]}):null}},52772:(e,t,a)=>{a.d(t,{Vj:()=>o,rl:()=>E.rl,mt:()=>m.mt,r7:()=>m.r7,IO:()=>m.IO,I5:()=>m.I5,BX:()=>E.BX,Ht:()=>E.Ht,zT:()=>E.zT,yr:()=>E.yr,nH:()=>D,wl:()=>w,IA:()=>k,Qs:()=>I,YY:()=>N,_l:()=>P,MF:()=>M,d7:()=>T,q6:()=>C,E:()=>x,wi:()=>S,OU:()=>j,zJ:()=>v,hw:()=>b,qj:()=>y});var n=a(4643),s=(a(57235),a(68404)),r=a(78507);const o=(0,s.createContext)(r.n);var l=a(18745),i=a(43215),c=a(45193),u=a(5831),d=a(98163),h=a(8674),p=a(47570),g=a(21169),f=a(7947),m=a(77197);const x=e=>{const t=(0,l.useDispatch)();(0,s.useEffect)((()=>(t((0,n.M9)(e)),function(){t((0,c.e)({stateSelector:e=>e.dataSourceSettings}))})),[e,t])},b=e=>{const t=(0,l.useDispatch)();return()=>t((0,n.kY)(e))},v=()=>{const e=(0,l.useDispatch)();(0,s.useEffect)((()=>{e((0,n.bZ)())}),[e])},S=e=>{const t=(0,l.useDispatch)();(0,s.useEffect)((()=>{t((0,n.gv)(e))}),[t,e])},j=()=>{const e=(0,l.useDispatch)();(0,s.useEffect)((()=>{e((0,n.Kj)())}),[e])},D=()=>{const e=(0,l.useDispatch)(),t=T();return a=>{e((0,n.J_)(a,t.Edit))}},y=()=>{const e=(0,l.useDispatch)();return t=>e((0,n.oe)(t))},C=()=>{const e=(0,l.useDispatch)(),{name:t}=(0,l.useSelector)((e=>e.dataSources.dataSource));return()=>{u.Z.publish(new g.VJ({title:"Delete",text:`Are you sure you want to delete the "${t}" data source?`,yesText:"Delete",icon:"trash-alt",onConfirm:()=>e((0,n.F5)())}))}},w=e=>(0,l.useSelector)((t=>(0,m.f6)(t.dataSources,e))),k=e=>{const t=w(e),a=JSON.stringify({datasource:t.name,context:"explore"});return i.urlUtil.renderUrl("/explore",{left:a})},I=e=>(0,l.useSelector)((t=>(0,m.G4)(t.dataSources,e))),P=()=>(0,l.useSelector)((e=>e.dataSourceSettings)),M=(e,t)=>{const a=w(e),{plugin:n,loadError:s,loading:r}=P(),o=(0,l.useSelector)((e=>e.navIndex)),i=t?`datasource-page-${t}`:`datasource-settings-${e}`;if(s){const e={text:s,subTitle:"Data Source Error",icon:"exclamation-triangle"};return{node:e,main:e}}return r||!n?(0,h.h)(o,i,(0,f.xG)("settings")):(0,h.h)(o,i,(0,f.nI)((0,f.B1)(a,n),t||"settings"))},N=e=>{const t=w(e);return{readOnly:!0===t.readOnly,hasWriteRights:d.Vt.hasPermissionInMetadata(p.bW.DataSourcesWrite,t),hasDeleteRights:d.Vt.hasPermissionInMetadata(p.bW.DataSourcesDelete,t)}},T=()=>(0,s.useContext)(o);var E=a(75375)},30978:(e,t,a)=>{a.d(t,{u:()=>o});a(68404);var n=a(43215),s=a(3490),r=a(45916);const o=e=>{const t=function(e){switch(e){case n.PluginState.deprecated:return{text:"Deprecated",color:"red",tooltip:"This feature is deprecated and will be removed in a future release"};case n.PluginState.alpha:return{text:"Alpha",color:"blue",tooltip:"This feature is experimental and future updates might not be backward compatible"};case n.PluginState.beta:return{text:"Beta",color:"blue",tooltip:"This feature is close to complete but not fully tested"};default:return null}}(e.state);return t?(0,r.jsx)(s.Badge,{color:t.color,title:t.tooltip,text:t.text,icon:t.icon}):null}}}]);
//# sourceMappingURL=5477.8056e5fb663fca104b68.js.map