{"version":3,"file":"AlertingRedirectToRule.7e857313d4d720476ac7.js","mappings":"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","sources":["webpack://grafana/./public/app/features/alerting/unified/components/rule-viewer/RuleViewerLayout.tsx","webpack://grafana/./public/app/features/alerting/unified/RedirectToRuleViewer.tsx"],"sourcesContent":["import { css } from '@emotion/css';\nimport * as React from 'react';\n\nimport { GrafanaTheme2, NavModelItem } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\nimport { Page } from 'app/core/components/Page/Page';\nimport { PageProps } from 'app/core/components/Page/types';\n\ntype Props = {\n  children: React.ReactNode | React.ReactNode[];\n  title: string;\n  renderTitle?: PageProps['renderTitle'];\n  wrapInContent?: boolean;\n};\n\nconst defaultPageNav: Partial<NavModelItem> = {\n  icon: 'bell',\n  id: 'alert-rule-view',\n};\n\nexport function RuleViewerLayout(props: Props): JSX.Element | null {\n  const { wrapInContent = true, children, title, renderTitle } = props;\n  const styles = useStyles2(getPageStyles);\n\n  return (\n    <Page pageNav={{ ...defaultPageNav, text: title }} renderTitle={renderTitle} navId=\"alert-list\">\n      <Page.Contents>\n        <div className={styles.content}>{wrapInContent ? <RuleViewerLayoutContent {...props} /> : children}</div>\n      </Page.Contents>\n    </Page>\n  );\n}\n\ntype ContentProps = {\n  children: React.ReactNode | React.ReactNode[];\n  padding?: number;\n};\n\nexport function RuleViewerLayoutContent({ children, padding = 2 }: ContentProps): JSX.Element | null {\n  const styles = useStyles2(getContentStyles(padding));\n  return <div className={styles.wrapper}>{children}</div>;\n}\n\nconst getPageStyles = (theme: GrafanaTheme2) => {\n  return {\n    content: css({\n      maxWidth: `${theme.breakpoints.values.xxl}px`,\n    }),\n  };\n};\n\nconst getContentStyles = (padding: number) => (theme: GrafanaTheme2) => {\n  return {\n    wrapper: css({\n      background: theme.colors.background.primary,\n      border: `1px solid ${theme.colors.border.weak}`,\n      borderRadius: theme.shape.radius.default,\n      padding: theme.spacing(padding),\n    }),\n  };\n};\n","import { css } from '@emotion/css';\nimport { useMemo } from 'react';\nimport { Navigate } from 'react-router-dom-v5-compat';\nimport { useLocation } from 'react-use';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { config, isFetchError } from '@grafana/runtime';\nimport { Alert, Card, Icon, LoadingPlaceholder, useStyles2, withErrorBoundary } from '@grafana/ui';\n\nimport { AlertLabels } from './components/AlertLabels';\nimport { RuleViewerLayout } from './components/rule-viewer/RuleViewerLayout';\nimport { useCloudCombinedRulesMatching } from './hooks/useCombinedRule';\nimport { getRulesSourceByName } from './utils/datasource';\nimport { createViewLink } from './utils/misc';\nimport { unescapePathSeparators } from './utils/rule-id';\n\nconst pageTitle = 'Find rule';\nconst subUrl = config.appSubUrl;\n\nfunction useRuleFindParams() {\n  // DO NOT USE REACT-ROUTER HOOKS FOR THIS CODE\n  // React-router's useLocation/useParams/props.match are broken and don't preserve original param values when parsing location\n  // so, they cannot be used to parse name and sourceName path params\n  // React-router messes the pathname up resulting in a string that is neither encoded nor decoded\n  // Relevant issue: https://github.com/remix-run/history/issues/505#issuecomment-453175833\n  // It was probably fixed in React-Router v6\n  const location = useLocation();\n\n  return useMemo(() => {\n    const segments = location.pathname?.replace(subUrl, '').split('/') ?? []; // [\"\", \"alerting\", \"{sourceName}\", \"{name}]\n    const name = unescapePathSeparators(decodeURIComponent(unescapePathSeparators(segments[3])));\n    const sourceName = decodeURIComponent(segments[2]);\n\n    const searchParams = new URLSearchParams(location.search);\n\n    return {\n      name,\n      sourceName,\n      namespace: searchParams.get('namespace') ?? undefined,\n      group: searchParams.get('group') ?? undefined,\n    };\n  }, [location]);\n}\n\nexport function RedirectToRuleViewer(): JSX.Element | null {\n  const styles = useStyles2(getStyles);\n\n  const { name, sourceName, namespace, group } = useRuleFindParams();\n  const {\n    error,\n    loading,\n    rules = [],\n  } = useCloudCombinedRulesMatching(name, sourceName, { namespace, groupName: group });\n\n  if (!name || !sourceName) {\n    return <Navigate replace to=\"/notfound\" />;\n  }\n\n  if (error) {\n    return (\n      <RuleViewerLayout title={pageTitle}>\n        <Alert title={`Failed to load rules from ${sourceName}`}>\n          {isFetchError(error) && (\n            <details className={styles.errorMessage}>\n              {error.message}\n              <br />\n              {/* {!!error?.stack && error.stack} */}\n            </details>\n          )}\n        </Alert>\n      </RuleViewerLayout>\n    );\n  }\n\n  if (loading) {\n    return (\n      <RuleViewerLayout title={pageTitle}>\n        <LoadingPlaceholder text=\"Loading rule...\" />\n      </RuleViewerLayout>\n    );\n  }\n\n  const rulesSource = getRulesSourceByName(sourceName);\n\n  if (!rulesSource) {\n    return (\n      <RuleViewerLayout title={pageTitle}>\n        <Alert title=\"Could not view rule\">\n          <details className={styles.errorMessage}>{`Could not find data source with name: ${sourceName}.`}</details>\n        </Alert>\n      </RuleViewerLayout>\n    );\n  }\n\n  if (rules.length === 1) {\n    const [rule] = rules;\n    const to = createViewLink(rulesSource, rule, '/alerting/list').replace(subUrl, '');\n    return <Navigate replace to={to} />;\n  }\n\n  if (rules.length === 0) {\n    return (\n      <RuleViewerLayout title={pageTitle}>\n        <div data-testid=\"no-rules\">\n          No rules in <span className={styles.param}>{sourceName}</span> matched the name{' '}\n          <span className={styles.param}>{name}</span>\n        </div>\n      </RuleViewerLayout>\n    );\n  }\n\n  return (\n    <RuleViewerLayout title={pageTitle}>\n      <div>\n        Several rules in <span className={styles.param}>{sourceName}</span> matched the name{' '}\n        <span className={styles.param}>{name}</span>, please select the rule you want to view.\n      </div>\n      <div className={styles.rules}>\n        {rules.map((rule, index) => {\n          return (\n            <Card key={`${rule.name}-${index}`} href={createViewLink(rulesSource, rule, '/alerting/list')}>\n              <Card.Heading>{rule.name}</Card.Heading>\n              <Card.Meta separator={''}>\n                <Icon name=\"folder\" />\n                <span className={styles.namespace}>{`${rule.namespace.name} / ${rule.group.name}`}</span>\n              </Card.Meta>\n              <Card.Tags>\n                <AlertLabels labels={rule.labels} />\n              </Card.Tags>\n            </Card>\n          );\n        })}\n      </div>\n    </RuleViewerLayout>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    param: css({\n      fontStyle: 'italic',\n      color: theme.colors.text.secondary,\n    }),\n    rules: css({\n      marginTop: theme.spacing(2),\n    }),\n    namespace: css({\n      marginLeft: theme.spacing(1),\n    }),\n    errorMessage: css({\n      whiteSpace: 'pre-wrap',\n    }),\n  };\n}\n\nexport default withErrorBoundary(RedirectToRuleViewer, { style: 'page' });\n"],"names":["defaultPageNav","RuleViewerLayout","props","wrapInContent","children","title","renderTitle","styles","getPageStyles","Page","RuleViewerLayoutContent","padding","getContentStyles","theme","pageTitle","subUrl","config","useRuleFindParams","location","useLocation","segments","name","sourceName","searchParams","RedirectToRuleViewer","getStyles","namespace","group","error","loading","rules","Alert","LoadingPlaceholder","rulesSource","rule","to","index","Card","Icon","AlertLabels"],"sourceRoot":""}