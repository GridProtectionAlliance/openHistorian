(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9404],{6191:(Pe,ve,h)=>{"use strict";h.d(ve,{X:()=>$});var V=h(32196),L=h(96540),P=h(40845);const $=({children:C})=>{const E=(0,P.of)(Q);return L.createElement("div",{className:E.root},C)},Q=C=>({root:(0,V.css)({display:"flex",flexWrap:"wrap",alignItems:"center",gap:C.spacing(3),minHeight:C.spacing(4)})})},31347:(Pe,ve,h)=>{"use strict";h.d(ve,{Z:()=>L});var V=h(96540);const L=({grow:P,shrink:$})=>V.createElement("div",{style:{display:"block",flexGrow:P,flexShrink:$}})},22354:(Pe,ve,h)=>{"use strict";h.d(ve,{W:()=>re});var V=h(32196),L=h(96540),P=h(40845),$=h(90182),Q=h(4603),C=Object.defineProperty,E=Object.defineProperties,N=Object.getOwnPropertyDescriptors,j=Object.getOwnPropertySymbols,W=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable,X=(Be,Ge,O)=>Ge in Be?C(Be,Ge,{enumerable:!0,configurable:!0,writable:!0,value:O}):Be[Ge]=O,q=(Be,Ge)=>{for(var O in Ge||(Ge={}))W.call(Ge,O)&&X(Be,O,Ge[O]);if(j)for(var O of j(Ge))J.call(Ge,O)&&X(Be,O,Ge[O]);return Be},ae=(Be,Ge)=>E(Be,N(Ge)),Le=(Be,Ge)=>{var O={};for(var de in Be)W.call(Be,de)&&Ge.indexOf(de)<0&&(O[de]=Be[de]);if(Be!=null&&j)for(var de of j(Be))Ge.indexOf(de)<0&&J.call(Be,de)&&(O[de]=Be[de]);return O};function re(Be){var Ge=Be,{label:O}=Ge,de=Le(Ge,["label"]);const T=(0,P.of)(nr),[Xe]=(0,L.useState)(()=>Math.random().toString(16).slice(2)),Sr={SelectContainer:Ne,ValueContainer:er,SingleValue:er};return L.createElement("div",{className:T.root},O&&L.createElement("label",{className:T.label,htmlFor:Xe},O,":","\xA0"),L.createElement($.l6,ae(q({openMenuOnFocus:!0,inputId:Xe},de),{components:Sr})))}const Ne=Be=>{const{children:Ge}=Be,O=(0,P.of)(nr);return L.createElement(Q.K,ae(q({},Be),{className:(0,V.cx)(Be.className,O.container)}),Ge)},er=Be=>{const{className:Ge,children:O}=Be,de=(0,P.of)(nr);return L.createElement("div",{className:(0,V.cx)(Ge,de.valueContainer)},O)},nr=Be=>({root:(0,V.css)({display:"flex",fontSize:12,alignItems:"center"}),label:(0,V.css)({color:Be.colors.text.secondary,whiteSpace:"nowrap"}),container:(0,V.css)({background:"none",borderColor:"transparent"}),valueContainer:(0,V.css)({display:"flex",alignItems:"center",flex:"initial",color:Be.colors.text.secondary,fontSize:12})})},1779:(Pe,ve,h)=>{var V=h(48287).Buffer,L=function(){"use strict";function P(q,ae){return ae!=null&&q instanceof ae}var $;try{$=Map}catch{$=function(){}}var Q;try{Q=Set}catch{Q=function(){}}var C;try{C=Promise}catch{C=function(){}}function E(q,ae,Le,re,Ne){typeof ae=="object"&&(Le=ae.depth,re=ae.prototype,Ne=ae.includeNonEnumerable,ae=ae.circular);var er=[],nr=[],Be=typeof V<"u";typeof ae>"u"&&(ae=!0),typeof Le>"u"&&(Le=1/0);function Ge(O,de){if(O===null)return null;if(de===0)return O;var T,Xe;if(typeof O!="object")return O;if(P(O,$))T=new $;else if(P(O,Q))T=new Q;else if(P(O,C))T=new C(function(ot,he){O.then(function(te){ot(Ge(te,de-1))},function(te){he(Ge(te,de-1))})});else if(E.__isArray(O))T=[];else if(E.__isRegExp(O))T=new RegExp(O.source,X(O)),O.lastIndex&&(T.lastIndex=O.lastIndex);else if(E.__isDate(O))T=new Date(O.getTime());else{if(Be&&V.isBuffer(O))return V.allocUnsafe?T=V.allocUnsafe(O.length):T=new V(O.length),O.copy(T),T;P(O,Error)?T=Object.create(O):typeof re>"u"?(Xe=Object.getPrototypeOf(O),T=Object.create(Xe)):(T=Object.create(re),Xe=re)}if(ae){var Sr=er.indexOf(O);if(Sr!=-1)return nr[Sr];er.push(O),nr.push(T)}P(O,$)&&O.forEach(function(ot,he){var te=Ge(he,de-1),fe=Ge(ot,de-1);T.set(te,fe)}),P(O,Q)&&O.forEach(function(ot){var he=Ge(ot,de-1);T.add(he)});for(var Je in O){var Qe;Xe&&(Qe=Object.getOwnPropertyDescriptor(Xe,Je)),!(Qe&&Qe.set==null)&&(T[Je]=Ge(O[Je],de-1))}if(Object.getOwnPropertySymbols)for(var rr=Object.getOwnPropertySymbols(O),Je=0;Je<rr.length;Je++){var Zr=rr[Je],it=Object.getOwnPropertyDescriptor(O,Zr);it&&!it.enumerable&&!Ne||(T[Zr]=Ge(O[Zr],de-1),it.enumerable||Object.defineProperty(T,Zr,{enumerable:!1}))}if(Ne)for(var Ur=Object.getOwnPropertyNames(O),Je=0;Je<Ur.length;Je++){var fr=Ur[Je],it=Object.getOwnPropertyDescriptor(O,fr);it&&it.enumerable||(T[fr]=Ge(O[fr],de-1),Object.defineProperty(T,fr,{enumerable:!1}))}return T}return Ge(q,Le)}E.clonePrototype=function(ae){if(ae===null)return null;var Le=function(){};return Le.prototype=ae,new Le};function N(q){return Object.prototype.toString.call(q)}E.__objToStr=N;function j(q){return typeof q=="object"&&N(q)==="[object Date]"}E.__isDate=j;function W(q){return typeof q=="object"&&N(q)==="[object Array]"}E.__isArray=W;function J(q){return typeof q=="object"&&N(q)==="[object RegExp]"}E.__isRegExp=J;function X(q){var ae="";return q.global&&(ae+="g"),q.ignoreCase&&(ae+="i"),q.multiline&&(ae+="m"),ae}return E.__getRegExpFlags=X,E}();Pe.exports&&(Pe.exports=L)},20322:(Pe,ve,h)=>{"use strict";h.r(ve),h.d(ve,{plugin:()=>pE});var V={};h.r(V),h.d(V,{applyToJS:()=>so,cleanJSX:()=>co,deepEqual:()=>ui,deepFreeze:()=>ru,escapeRegExp:()=>Xl,getFirstDefined:()=>au,getLogger:()=>nu,getOpCardinality:()=>zr,isDirtyJSX:()=>Pa,isImmutable:()=>la,isImmutableList:()=>si,isJSX:()=>fo,isJsonCompatible:()=>tu,isJsonLogic:()=>Tt,isObject:()=>li,logger:()=>In,mergeArraysSmart:()=>ci,mergeCustomizerNoArrays:()=>Zl,omit:()=>Vt,opDefKeysToOmit:()=>oa,shallowCopy:()=>Yl,shallowEqual:()=>Ia,sleep:()=>eu,toImmutableList:()=>Hr,uuid:()=>mr,widgetDefKeysToOmit:()=>zn});var L={};h.r(L),h.d(L,{getItemInListValues:()=>Na,getListValue:()=>vi,getTitleInListValues:()=>uu,getValueInListValues:()=>Mg,listValuesToArray:()=>lu,makeCustomListValue:()=>vo,mapListValues:()=>go,searchListValue:()=>_g,toListValue:()=>An});var P={};h.r(P),h.d(P,{_fixImmutableValue:()=>bo,expandTreePath:()=>Te,expandTreeSubpath:()=>mo,fixEmptyGroupsInTree:()=>gi,fixPathsInTree:()=>en,getFlatTree:()=>ho,getItemByPath:()=>ua,getLightTree:()=>cu,getSwitchValues:()=>du,getTotalReordableNodesCountInTree:()=>Gg,getTotalRulesCountInTree:()=>yo,hasChildren:()=>Oo,immutableToJs:()=>so,isEmptyTree:()=>So,isImmutable:()=>la,jsToImmutable:()=>Da,removeIsLockedInTree:()=>su,toImmutableList:()=>Hr});var $={};h.r($),h.d($,{SqlString:()=>Nn,mongoEmptyValue:()=>Au,spelEscape:()=>da,spelFixList:()=>Lu,spelFormatConcat:()=>vm,spelImportConcat:()=>gm,sqlEmptyValue:()=>Cu,stringifyForDisplay:()=>wu,wrapWithBrackets:()=>xu});var Q={};h.r(Q),h.d(Q,{_loadFromJsonLogic:()=>bu,_loadFromSpel:()=>zu,getTree:()=>Bg,isImmutableTree:()=>fu,isJsonLogic:()=>Tt,isTree:()=>pu,jsToImmutable:()=>Da,loadFromJsonLogic:()=>Hg,loadFromSpel:()=>Am,loadTree:()=>Fo});var C={};h.r(C),h.d(C,{createListFromArray:()=>ns,createListWithOneElement:()=>Bm,defaultConjunction:()=>mn,defaultGroupConjunction:()=>Ba,defaultGroupProperties:()=>Dn,defaultItemProperties:()=>rs,defaultOperatorOptions:()=>Ga,defaultRoot:()=>Gm,defaultRule:()=>ts,defaultRuleProperties:()=>gn,emptyProperties:()=>Um,getDefaultField:()=>Zu,getDefaultFieldSrc:()=>wo,getDefaultOperator:()=>xo,getDefaultSubField:()=>es});var E={};h.r(E),h.d(E,{_validateTree:()=>Ua,checkTree:()=>zs,getNewValueForFieldOp:()=>Hn,getTreeBadFields:()=>Ks,isValidTree:()=>Qs,sanitizeTree:()=>qs,translateValidation:()=>rn,validateAndFixTree:()=>Js,validateRange:()=>Vo,validateTree:()=>Hs,validateValue:()=>pa});var N={};h.r(N),h.d(N,{completeFuncValue:()=>ec,getCompatibleArgsOnFuncChange:()=>ac,setArgValue:()=>Mo,setArgValueSrc:()=>nc,setFunc:()=>rc,setFuncDefaultArg:()=>hi});var j={};h.r(j),h.d(j,{calculateValueType:()=>oc,completeValue:()=>Jn,filterValueSourcesForField:()=>qn,formatFieldName:()=>wn,getFieldPartsConfigs:()=>lc,getFieldPathLabels:()=>$a,getFirstOperator:()=>_o,getFuncPathLabels:()=>ih,getOneChildOrDescendant:()=>Qo,getOperatorsForField:()=>Si,getOperatorsForType:()=>ic,getValueLabel:()=>oh,getValueSourcesForFieldOp:()=>uc,getWidgetForFieldOp:()=>Ir,getWidgetsForFieldOp:()=>lh,isEmptyGroupChildren:()=>Uo,isEmptyItem:()=>Bo,isEmptyRuleGroupExtPropertiesAndChildren:()=>sc,isEmptyRuleProperties:()=>$o,selectTypes:()=>yi,whatRulePropertiesAreCompleted:()=>Wo});var W={};h.r(W),h.d(W,{_getFromConfigCache:()=>Ai,_saveToConfigCache:()=>Li,_widgetDefKeysToOmit:()=>Mh,applyJsonLogic:()=>gh,cleanJSX:()=>co,compileConfig:()=>Tc,compressConfig:()=>bc,configKeys:()=>hn,createConfigMemo:()=>xc,decompressConfig:()=>Fc,extendConfig:()=>kt,findExtendedConfigInAllMemos:()=>wc,getCommonMemo:()=>Lc,getFieldConfig:()=>Re,getFieldId:()=>Ci,getFieldParts:()=>_r,getFieldPath:()=>yn,getFieldPathParts:()=>_h,getFieldRawConfig:()=>tn,getFieldSrc:()=>kc,getFieldWidgetConfig:()=>gt,getFirstField:()=>Mc,getFuncArgConfig:()=>Xo,getFuncConfig:()=>qr,getFuncSignature:()=>Yo,getOperatorConfig:()=>vr,isDirtyJSX:()=>Pa,isFieldDescendantOfField:()=>Vc,isJSX:()=>fo,iterateFields:()=>Dc,iterateFuncs:()=>ha,normalizeField:()=>Ei});var J={};h.r(J),h.d(J,{_mongodbFormat:()=>rd,_spelFormat:()=>Du,_sqlFormat:()=>od,elasticSearchFormat:()=>pd,jsonLogicFormat:()=>Wh,mongodbFormat:()=>Jh,queryBuilderFormat:()=>Gh,queryString:()=>us,spelFormat:()=>ym,sqlFormat:()=>ty});var X={};h.r(X),h.d(X,{fixListValuesGroupOrder:()=>Ay,getListValue:()=>vi,listValueToOption:()=>Cy,mergeListValues:()=>Fy,optionToListValue:()=>Ty,optionsToListValues:()=>Ey,simulateAsyncFetch:()=>by});var q={};h.r(q),h.d(q,{Autocomplete:()=>X,ConfigUtils:()=>W,DefaultUtils:()=>C,ExportUtils:()=>$,FuncUtils:()=>N,ListUtils:()=>L,OtherUtils:()=>V,RuleUtils:()=>j,TreeUtils:()=>P,Validation:()=>E,checkTree:()=>zs,clone:()=>Wt(),compressConfig:()=>bc,decompressConfig:()=>Fc,getSwitchValues:()=>du,i18n:()=>Ym,isValidTree:()=>Qs,moment:()=>sa(),sanitizeTree:()=>qs,uuid:()=>mr,validateAndFixTree:()=>Js,validateTree:()=>Hs});var ae={};h.r(ae),h.d(ae,{LINEAR_REGRESSION:()=>Ry,LOWER:()=>xy,NOW:()=>Ly,RELATIVE_DATETIME:()=>wy,UPPER:()=>jy});var Le={};h.r(Le),h.d(Le,{addCaseGroup:()=>h0,addDefaultCaseGroup:()=>m0,addGroup:()=>y0,addRule:()=>v0,moveItem:()=>O0,removeGroup:()=>S0,removeRule:()=>g0,setTree:()=>p0});var re={};h.r(re),h.d(re,{setConjunction:()=>b0,setLock:()=>T0,setNot:()=>F0});var Ne={};h.r(Ne),h.d(Ne,{setField:()=>E0,setFieldSrc:()=>C0,setFuncValue:()=>x0,setOperator:()=>A0,setOperatorOption:()=>j0,setValue:()=>L0,setValueSrc:()=>w0});var er={};h.r(er),h.d(er,{bindActionCreators:()=>ff,isUsingLegacyReactDomRender:()=>df,liteShouldComponentUpdate:()=>Ni,pureShouldComponentUpdate:()=>Sa,useOnPropsChanged:()=>Et});var nr={};h.r(nr),h.d(nr,{FuncWidget:()=>Tl,ValueFieldWidget:()=>Zp,VanillaBooleanWidget:()=>jb,VanillaButton:()=>Qb,VanillaButtonGroup:()=>zb,VanillaConjs:()=>$b,VanillaDateTimeWidget:()=>Db,VanillaDateWidget:()=>Pb,VanillaFieldSelect:()=>Ub,VanillaIcon:()=>Kb,VanillaMultiSelectWidget:()=>kb,VanillaNumberWidget:()=>Gb,VanillaProvider:()=>Yb,VanillaSelectWidget:()=>_b,VanillaSliderWidget:()=>Bb,VanillaSwitch:()=>qb,VanillaTextAreaWidget:()=>Ib,VanillaTextWidget:()=>Rb,VanillaTimeWidget:()=>Nb,VanillaValueSources:()=>Hb,vanillaConfirm:()=>Jb});var Be={};h.r(Be),h.d(Be,{ProximityOperator:()=>wl});var Ge=h(40187),O=h(74848),de=h(2543),T=h(96540),Xe=h(22391),Sr=h(32264),Je=h(84167),Qe=h(88575),rr=h(90182),Zr=h(42418),it=h(91409),Ur=h(14186),fr=h(10354);const ot="Direct browser access in the InfluxDB datasource is no longer available. Switch to server access mode.",he="default";var te=(n=>(n.InfluxQL="InfluxQL",n.Flux="Flux",n.SQL="SQL",n))(te||{}),fe=h(39268),ke=h(9226);const De=20,le=n=>{const{options:{jsonData:e,secureJsonData:t,secureJsonFields:r}}=n,a=(0,de.uniqueId)("influxdb-flux-config");return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(fe.C,{children:(0,O.jsx)(Ur.I,{labelWidth:De,label:"Organization",htmlFor:`${a}-org`,children:(0,O.jsx)(fr.p,{id:`${a}-org`,className:"width-20",value:e.organization||"",onChange:(0,Xe.PG)(n,"organization")})})}),(0,O.jsx)(fe.C,{children:(0,O.jsx)(Ur.I,{labelWidth:De,label:"Token",children:(0,O.jsx)(ke.L4,{isConfigured:!!(r&&r.token),value:t?.token||"",label:"Token","aria-label":"Token",className:"width-20",onReset:()=>(0,Xe.QP)(n,"token"),onChange:(0,Xe.mn)(n,"token")})})}),(0,O.jsx)(fe.C,{children:(0,O.jsx)(Ur.I,{labelWidth:De,label:"Default Bucket",children:(0,O.jsx)(fr.p,{className:"width-20",placeholder:"default bucket",value:e.defaultBucket||"",onChange:(0,Xe.PG)(n,"defaultBucket")})})}),(0,O.jsx)(fe.C,{children:(0,O.jsx)(Ur.I,{labelWidth:De,label:"Min time interval",tooltip:`A lower limit for the auto group by time interval. Recommended to be set to write frequency,
				for example 1m if your data is written every minute.`,children:(0,O.jsx)(fr.p,{className:"width-20",placeholder:"10s",value:e.timeInterval||"",onChange:(0,Xe.PG)(n,"timeInterval")})})})]})};var pe=h(32196),Ae=h(40845),Ke=h(76892);const Rt=[{label:"GET",value:"GET"},{label:"POST",value:"POST"}],rt=n=>{const{options:e,onOptionsChange:t}=n,{database:r,jsonData:a,secureJsonData:i,secureJsonFields:o}=e,l=(0,Ae.of)(Mr),u=(0,de.uniqueId)("influxdb-influxql-config");return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(Zr.F,{severity:"info",title:"Database Access",children:(0,O.jsxs)("p",{children:["Setting the database for this datasource does not deny access to other databases. The InfluxDB query syntax allows switching the database in the query. For example:",(0,O.jsx)("code",{children:"SHOW MEASUREMENTS ON _internal"})," or",(0,O.jsx)("code",{children:'SELECT * FROM "_internal".."database" LIMIT 10'}),(0,O.jsx)("br",{}),(0,O.jsx)("br",{}),"To support data isolation and security, make sure appropriate permissions are configured in InfluxDB."]})}),(0,O.jsx)(Qe.D,{horizontal:!0,label:(0,O.jsx)(Ke.c,{width:De,children:"Database"}),className:l.horizontalField,htmlFor:`${u}-db`,children:(0,O.jsx)(fr.p,{id:`${u}-db`,className:"width-20",value:a.dbName??r,onChange:s=>{t({...e,database:"",jsonData:{...a,dbName:s.currentTarget.value}})}})}),(0,O.jsx)(Qe.D,{horizontal:!0,label:(0,O.jsx)(Ke.c,{width:De,children:"User"}),className:l.horizontalField,htmlFor:`${u}-user`,children:(0,O.jsx)(fr.p,{id:`${u}-user`,className:"width-20",value:e.user||"",onChange:(0,Xe.zX)(n,"user")})}),(0,O.jsx)(Qe.D,{horizontal:!0,label:(0,O.jsx)(Ke.c,{width:De,children:"Password"}),className:l.horizontalField,children:(0,O.jsx)(ke.L4,{isConfigured:!!(o&&o.password),value:i?.password||"",label:"Password","aria-label":"Password",className:"width-20",onReset:()=>(0,Xe.QP)(n,"password"),onChange:(0,Xe.mn)(n,"password")})}),(0,O.jsx)(Qe.D,{horizontal:!0,label:(0,O.jsx)(Ke.c,{width:De,tooltip:`You can use either GET or POST HTTP method to query your InfluxDB database. The POST
          method allows you to perform heavy requests (with a lots of WHERE clause) while the GET method
          will restrict you and return an error if the query is too large.`,children:"HTTP Method"}),htmlFor:`${u}-http-method`,className:l.horizontalField,children:(0,O.jsx)(rr.l6,{inputId:`${u}-http-method`,className:"width-20",value:Rt.find(s=>s.value===e.jsonData.httpMode),options:Rt,defaultValue:e.jsonData.httpMode,onChange:(0,Xe.BD)(n,"httpMode")})}),(0,O.jsx)(Qe.D,{horizontal:!0,label:(0,O.jsx)(Ke.c,{width:De,tooltip:"A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example 1m if your data is written every minute.",children:"Min time interval"}),className:l.horizontalField,children:(0,O.jsx)(fr.p,{className:"width-20",placeholder:"10s",value:e.jsonData.timeInterval||"",onChange:(0,Xe.PG)(n,"timeInterval")})})]})},Mr=n=>({horizontalField:(0,pe.css)({justifyContent:"initial",margin:`0 ${n.spacing(.5)} ${n.spacing(.5)} 0`})});var bn=h(15292);const ln=n=>{const{options:e,onOptionsChange:t}=n,{jsonData:r,secureJsonData:a,secureJsonFields:i}=e,o=(0,Ae.of)(Hi),l=(0,de.uniqueId)("influxdb-sql-config");return(0,O.jsxs)("div",{children:[(0,O.jsx)(Qe.D,{horizontal:!0,label:(0,O.jsx)(Ke.c,{width:De,children:"Database"}),className:o.horizontalField,htmlFor:`${l}-dbName`,children:(0,O.jsx)(fr.p,{id:`${l}-dbName`,className:"width-20","aria-label":"Database or bucket name",value:r.dbName,onChange:u=>{t({...e,jsonData:{...r,dbName:u.currentTarget.value}})}})}),(0,O.jsx)(Qe.D,{horizontal:!0,label:(0,O.jsx)(Ke.c,{width:De,children:"Token"}),className:o.horizontalField,children:(0,O.jsx)(ke.L4,{label:"Token","aria-label":"Token",className:"width-20",value:a?.token||"",onReset:()=>(0,Xe.QP)(n,"token"),onChange:(0,Xe.mn)(n,"token"),isConfigured:!!(i&&i.token)})}),(0,O.jsx)(Qe.D,{horizontal:!0,label:(0,O.jsx)(Ke.c,{width:De,children:"Insecure Connection"}),className:o.horizontalField,children:(0,O.jsx)(bn.K,{id:`${l}-insecure-grpc`,value:r.insecureGrpc??!1,onChange:u=>{t({...e,jsonData:{...r,insecureGrpc:u.currentTarget.checked}})}})})]})},Hi=n=>({horizontalField:(0,pe.css)({justifyContent:"initial",margin:`0 ${n.spacing(.5)} ${n.spacing(.5)} 0`})}),Fn={[te.InfluxQL]:{label:"InfluxQL",value:te.InfluxQL,description:"The InfluxDB SQL-like query language."},[te.SQL]:{label:"SQL",value:te.SQL,description:"Native SQL language. Supported in InfluxDB 3.0"},[te.Flux]:{label:"Flux",value:te.Flux,description:"Supported in InfluxDB 2.x and 1.8+"}},Bn=[Fn[te.InfluxQL],Fn[te.SQL],Fn[te.Flux]];class Un extends T.PureComponent{constructor(e){super(e),this.state={maxSeries:""},this.versionNotice={Flux:"Support for Flux in Grafana is currently in beta",SQL:"Support for SQL in Grafana is currently in alpha"},this.onVersionChanged=t=>{const{options:r,onOptionsChange:a}=this.props,i={...r,jsonData:{...r.jsonData,version:t.value}};if(t.value===te.Flux){i.access="proxy",i.basicAuth=!0,i.jsonData.httpMode="POST";const{user:o,database:l,...u}=i;a(u)}else a(i)},this.state.maxSeries=e.options.jsonData.maxSeries?.toString()||"",this.htmlPrefix=(0,de.uniqueId)("influxdb-config")}renderJsonDataOptions(){switch(this.props.options.jsonData.version){case te.InfluxQL:return(0,O.jsx)(rt,{...this.props});case te.Flux:return(0,O.jsx)(le,{...this.props});case te.SQL:return(0,O.jsx)(ln,{...this.props});default:return(0,O.jsx)(rt,{...this.props})}}render(){const{options:e,onOptionsChange:t}=this.props,r=e.access==="direct";return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(Je.n,{children:[(0,O.jsx)("h3",{className:"page-heading",children:"Query language"}),(0,O.jsx)(Qe.D,{children:(0,O.jsx)(rr.l6,{"aria-label":"Query language",className:"width-30",value:Fn[e.jsonData.version??te.InfluxQL],options:Bn,defaultValue:Fn[te.InfluxQL],onChange:this.onVersionChanged})})]}),e.jsonData.version!==te.InfluxQL&&(0,O.jsx)(Zr.F,{severity:"info",title:this.versionNotice[e.jsonData.version],children:(0,O.jsxs)("p",{children:["Please report any issues to: ",(0,O.jsx)("br",{}),(0,O.jsx)("a",{href:"https://github.com/grafana/grafana/issues/new/choose",children:"https://github.com/grafana/grafana/issues"})]})}),r&&(0,O.jsx)(Zr.F,{title:"Error",severity:"error",children:ot}),(0,O.jsx)(it.t,{showAccessOptions:r,dataSourceConfig:e,defaultUrl:"http://localhost:8086",onChange:t,secureSocksDSProxyEnabled:Sr.$.secureSocksDSProxyEnabled}),(0,O.jsxs)(Je.n,{children:[(0,O.jsx)("h3",{className:"page-heading",children:"InfluxDB Details"}),this.renderJsonDataOptions(),(0,O.jsx)(Ur.I,{labelWidth:20,label:"Max series",tooltip:"Limit the number of series/tables that Grafana will process. Lower this number to prevent abuse, and increase it if you have lots of small time series and not all are shown. Defaults to 1000.",children:(0,O.jsx)(fr.p,{placeholder:"1000",type:"number",className:"width-20",value:this.state.maxSeries,onChange:a=>{this.setState({maxSeries:a.currentTarget.value});const i=parseInt(a.currentTarget.value,10);(0,Xe.lO)(this.props,"maxSeries",Number.isFinite(i)?i:void 0)}})})]})]})}}const Aa=Un;var St=h(54479),hr=h(1062);const La=[],ze={Aggregations:[],Selectors:[],Transformations:[],Predictors:[],Math:[],Aliasing:[],Fields:[]};function wa(n){const e=La[n.type];if(!e)throw{message:"Could not find query part "+n.type};return new hr.kW(n,e)}function pr(n){La[n.type]=new hr.tI(n),n.category.push(La[n.type])}const aa=[];function ri(n,e){return e+' AS "'+n.params[0]+'"'}function xa(n){const e=n.params[0];if(e==="*")return"*";let t=`"${e}"`;return e.endsWith("::tag")&&(t=`"${e.slice(0,-5)}"::tag`),e.endsWith("::field")&&(t=`"${e.slice(0,-7)}"::field`),t}function tt(n,e){for(let t=0;t<n.length;t++){const r=n[t];if(r.def.category===ze.Aggregations){if(r.def.type===e.def.type)return;if(r.def.type==="count"&&e.def.type==="distinct")break;if(r.def.type==="distinct"){const a=n.length>=t+2;if(e.def.type!=="count"&&a)n[t+1].def.category===ze.Aggregations&&n.splice(t+1,1);else if(e.def.type==="count"){(!a||n[t+1].def.type!=="count")&&n.splice(t+1,0,e);return}}n[t]=e;return}if(r.def.category===ze.Selectors){n[t]=e;return}}n.splice(1,0,e)}function pt(n,e){let t;for(t=0;t<n.length;t++){const r=n[t];if(r.def.category===ze.Math||r.def.category===ze.Aliasing)break}n.splice(t,0,e)}function qi(n,e){const t=n.length;if(t>0){if(n[t-1].def.type==="math"){n[t-1]=e;return}if(t>1&&n[t-2].def.type==="math"){n[t-2]=e;return}else if(n[t-1].def.type==="alias"){n.splice(t-1,0,e);return}}n.push(e)}function Ji(n,e){const t=n.length;if(t>0&&n[t-1].def.type==="alias"){n[t-1]=e;return}n.push(e)}function Yi(n,e,t){const r=(0,de.map)(n,a=>wa({type:a.def.type,params:(0,de.clone)(a.params)}));t.selectModels.push(r)}pr({type:"field",addStrategy:Yi,category:ze.Fields,params:[{type:"field",dynamicLookup:!0}],defaultParams:["value"],renderer:xa}),pr({type:"count",addStrategy:tt,category:ze.Aggregations,params:[],defaultParams:[],renderer:hr.Wn}),pr({type:"distinct",addStrategy:tt,category:ze.Aggregations,params:[],defaultParams:[],renderer:hr.Wn}),pr({type:"integral",addStrategy:tt,category:ze.Aggregations,params:[],defaultParams:[],renderer:hr.Wn}),pr({type:"mean",addStrategy:tt,category:ze.Aggregations,params:[],defaultParams:[],renderer:hr.Wn}),pr({type:"median",addStrategy:tt,category:ze.Aggregations,params:[],defaultParams:[],renderer:hr.Wn}),pr({type:"mode",addStrategy:tt,category:ze.Aggregations,params:[],defaultParams:[],renderer:hr.Wn}),pr({type:"sum",addStrategy:tt,category:ze.Aggregations,params:[],defaultParams:[],renderer:hr.Wn}),pr({type:"derivative",addStrategy:pt,category:ze.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:hr.Wn}),pr({type:"spread",addStrategy:pt,category:ze.Transformations,params:[],defaultParams:[],renderer:hr.Wn}),pr({type:"non_negative_derivative",addStrategy:pt,category:ze.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:hr.Wn}),pr({type:"difference",addStrategy:pt,category:ze.Transformations,params:[],defaultParams:[],renderer:hr.Wn}),pr({type:"non_negative_difference",addStrategy:pt,category:ze.Transformations,params:[],defaultParams:[],renderer:hr.Wn}),pr({type:"moving_average",addStrategy:pt,category:ze.Transformations,params:[{name:"window",type:"int",options:[5,10,20,30,40]}],defaultParams:[10],renderer:hr.Wn}),pr({type:"cumulative_sum",addStrategy:pt,category:ze.Transformations,params:[],defaultParams:[],renderer:hr.Wn}),pr({type:"stddev",addStrategy:pt,category:ze.Transformations,params:[],defaultParams:[],renderer:hr.Wn}),pr({type:"time",category:aa,params:[{name:"interval",type:"time",options:["$__interval","1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["$__interval"],renderer:hr.Wn}),pr({type:"fill",category:aa,params:[{name:"fill",type:"string",options:["none","null","0","previous","linear"]}],defaultParams:["null"],renderer:hr.Wn}),pr({type:"elapsed",addStrategy:pt,category:ze.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:hr.Wn}),pr({type:"holt_winters",addStrategy:pt,category:ze.Predictors,params:[{name:"number",type:"int",options:[5,10,20,30,40]},{name:"season",type:"int",options:[0,1,2,5,10]}],defaultParams:[10,2],renderer:hr.Wn}),pr({type:"holt_winters_with_fit",addStrategy:pt,category:ze.Predictors,params:[{name:"number",type:"int",options:[5,10,20,30,40]},{name:"season",type:"int",options:[0,1,2,5,10]}],defaultParams:[10,2],renderer:hr.Wn}),pr({type:"bottom",addStrategy:tt,category:ze.Selectors,params:[{name:"count",type:"int"}],defaultParams:[3],renderer:hr.Wn}),pr({type:"first",addStrategy:tt,category:ze.Selectors,params:[],defaultParams:[],renderer:hr.Wn}),pr({type:"last",addStrategy:tt,category:ze.Selectors,params:[],defaultParams:[],renderer:hr.Wn}),pr({type:"max",addStrategy:tt,category:ze.Selectors,params:[],defaultParams:[],renderer:hr.Wn}),pr({type:"min",addStrategy:tt,category:ze.Selectors,params:[],defaultParams:[],renderer:hr.Wn}),pr({type:"percentile",addStrategy:tt,category:ze.Selectors,params:[{name:"nth",type:"int"}],defaultParams:[95],renderer:hr.Wn}),pr({type:"top",addStrategy:tt,category:ze.Selectors,params:[{name:"count",type:"int"}],defaultParams:[3],renderer:hr.Wn}),pr({type:"tag",category:aa,params:[{name:"tag",type:"string",dynamicLookup:!0}],defaultParams:["tag"],renderer:xa}),pr({type:"math",addStrategy:qi,category:ze.Math,params:[{name:"expr",type:"string"}],defaultParams:[" / 100"],renderer:hr.Dw}),pr({type:"alias",addStrategy:Ji,category:ze.Aliasing,params:[{name:"name",type:"string",quote:"double"}],defaultParams:["alias"],renderMode:"suffix",renderer:ri});const un={create:wa,getCategories:()=>ze,replaceAggregationAdd:tt};class Dt{constructor(e,t,r){this.selectModels=[],this.groupByParts=[],this.target=e,this.templateSrv=t,this.scopedVars=r,e.policy=e.policy||he,e.resultFormat=e.resultFormat||"time_series",e.orderByTime=e.orderByTime||"ASC",e.tags=e.tags||[],e.groupBy=e.groupBy||[{type:"time",params:["$__interval"]},{type:"fill",params:["null"]}],e.select=e.select||[[{type:"field",params:["value"]},{type:"mean",params:[]}]],this.updateProjection()}updateProjection(){this.selectModels=(0,de.map)(this.target.select,e=>(0,de.map)(e,un.create)),this.groupByParts=(0,de.map)(this.target.groupBy,un.create)}updatePersistedParts(){this.target.select=(0,de.map)(this.selectModels,e=>(0,de.map)(e,t=>({type:t.def.type,params:t.params})))}hasGroupByTime(){return(0,de.find)(this.target.groupBy,e=>e.type==="time")}hasFill(){return(0,de.find)(this.target.groupBy,e=>e.type==="fill")}addGroupBy(e){let t=e.match(/^(\w+)\((.*)\)$/);if(!t||!this.target.groupBy)return;const r=t[1],a=t[2],i=un.create({type:r,params:[a]}),o=this.target.groupBy.length;o===0?this.target.groupBy.push(i.part):r==="time"?this.target.groupBy.splice(0,0,i.part):r==="tag"?this.target.groupBy[o-1].type==="fill"?this.target.groupBy.splice(o-1,0,i.part):this.target.groupBy.push(i.part):this.target.groupBy.push(i.part),this.updateProjection()}removeGroupByPart(e,t){const r=un.getCategories();e.def.type==="time"&&(this.target.groupBy=(0,de.filter)(this.target.groupBy,a=>a.type!=="fill"),this.target.select=(0,de.map)(this.target.select,a=>(0,de.filter)(a,i=>{const o=un.create(i);return!(o.def.category===r.Aggregations||o.def.category===r.Selectors)}))),this.target.groupBy.splice(t,1),this.updateProjection()}removeSelect(e){this.target.select.splice(e,1),this.updateProjection()}removeSelectPart(e,t){if(t.def.type==="field"){if(this.selectModels.length>1){const r=(0,de.indexOf)(this.selectModels,e);this.selectModels.splice(r,1)}}else{const r=(0,de.indexOf)(e,t);e.splice(r,1)}this.updatePersistedParts()}addSelectPart(e,t){const r=un.create({type:t});r.def.addStrategy(e,r,this),this.updatePersistedParts()}isOperatorTypeHandler(e,t,r){let a;if(e==="Is Not"?e="!=":e="=",r.endsWith("::tag"))return a="'"+$n(t.replace(/\\/g,"\\\\").replace(/\'/g,"\\'"))+"'",{operator:e,value:a};let i=t.toLowerCase();return isNaN(parseFloat(t))?["true","false"].includes(i)?a=i:a="'"+$n(t.replace(/\\/g,"\\\\").replace(/\'/g,"\\'"))+"'":a=t,{operator:e,value:a}}renderTagCondition(e,t,r){let a="",i=e.operator,o=e.value;if(t>0&&(a=(e.condition||"AND")+" "),i||(/^\/.*\/$/.test(o)?i="=~":i="="),i!=="=~"&&i!=="!~")if(r&&(o=this.templateSrv.replace(o,this.scopedVars)),o=$n(o),i.startsWith("Is")){let u=this.isOperatorTypeHandler(i,o,e.key);i=u.operator,o=u.value}else(!i.startsWith(">")&&!i.startsWith("<")||i==="<>")&&(o="'"+o.replace(/\\/g,"\\\\").replace(/\'/g,"\\'")+"'");else r&&(o=this.templateSrv.replace(o,this.scopedVars,"regex"));let l=`"${e.key}"`;return e.key.endsWith("::tag")&&(l=`"${e.key.slice(0,-5)}"::tag`),e.key.endsWith("::field")&&(l=`"${e.key.slice(0,-7)}"::field`),a+l+" "+i+" "+o}getMeasurementAndPolicy(e){let t=this.target.policy,r=this.target.measurement||"measurement";return r.match("^/.*/$")?e&&(r=this.templateSrv.replace(r,this.scopedVars,"regex")):r='"'+r+'"',t!==he?t='"'+this.target.policy+'".':t="",t+r}interpolateQueryStr(e,t){return!t.multi&&!t.includeAll?e:typeof e=="string"?(0,St.$f)(e):"("+(0,de.map)(e,St.$f).join("|")+")"}render(e){const t=this.target;if(t.rawQuery)return e?this.templateSrv.replace(t.query,this.scopedVars,this.interpolateQueryStr):t.query;let r="SELECT ",a,i;for(a=0;a<this.selectModels.length;a++){const u=this.selectModels[a];let s="";for(i=0;i<u.length;i++)s=u[i].render(s);a>0&&(r+=", "),r+=s}r+=" FROM "+this.getMeasurementAndPolicy(e)+" WHERE ";const o=(0,de.map)(t.tags,(u,s)=>this.renderTagCondition(u,s,e));o.length>0&&(r+="("+o.join(" ")+") AND "),r+="$timeFilter";let l="";for(a=0;a<this.groupByParts.length;a++){const u=this.groupByParts[a];a>0&&(l+=u.def.type==="fill"?" ":", "),l+=u.render("")}return l.length&&(r+=" GROUP BY "+l),t.fill&&(r+=" fill("+t.fill+")"),t.orderByTime==="DESC"&&(r+=" ORDER BY time DESC"),t.limit&&(r+=" LIMIT "+t.limit),t.slimit&&(r+=" SLIMIT "+t.slimit),t.tz&&(r+=" tz('"+t.tz+"')"),r}renderAdhocFilters(e){return(0,de.map)(e,(r,a)=>this.renderTagCondition(r,a,!0)).join(" ")}}function ja(n){const e=(0,de.cloneDeep)(n);return new Dt(e).render(!1)}function Xi(n){if(n.policy!==void 0&&n.resultFormat!==void 0&&n.orderByTime!==void 0&&n.tags!==void 0&&n.groupBy!==void 0&&n.select!==void 0)return n;const e=(0,de.cloneDeep)(n);return new Dt(e).target}function ti(n,e,t){const r=(0,de.cloneDeep)(n),a=new Dt(r);return a.addSelectPart(a.selectModels[t],e),a.target}function _l(n,e,t){const r=(0,de.cloneDeep)(n),a=new Dt(r),i=a.selectModels[t];return a.removeSelectPart(i,i[e]),a.target}function Zi(n,e,t,r){const a=[...n.select??[]];return a[e]=[...a[e]],a[e][t]={...a[e][t],params:r},{...n,select:a}}function eo(n,e){const t=(0,de.cloneDeep)(n),r=new Dt(t);return r.addGroupBy(e),r.target}function ro(n,e){const t=(0,de.cloneDeep)(n),r=new Dt(t);return r.removeGroupByPart(r.groupByParts[e],e),r.target}function to(n,e,t){const r=[...n.groupBy??[]];return r[e]={...r[e],params:t},{...n,groupBy:r}}function $n(n){const e=/\/\^(.*?)\$\//,t=n.match(e);return t&&t.length>1?t[1]:n}var sn=h(72574),Tn=h(19716),ni=h(32372),Ot=h(55852),no=h(38401),Xt=h(38894);const ao=[{label:"Show buckets",description:"List the available buckets (table)",value:"buckets()"},{label:"Simple query",description:"filter by measurement and field",value:`from(bucket: "db/rp")
  |> range(start: v.timeRangeStart, stop:v.timeRangeStop)
  |> filter(fn: (r) =>
    r._measurement == "example-measurement" and
    r._field == "example-field"
  )`},{label:"Grouped Query",description:"Group by (min/max/sum/median)",value:`// v.windowPeriod is a variable referring to the current optimized window period (currently: $interval)
from(bucket: v.bucket)
  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
  |> filter(fn: (r) => r["_measurement"] == "measurement1" or r["_measurement"] =~ /^.*?regex.*$/)
  |> filter(fn: (r) => r["_field"] == "field2" or r["_field"] =~ /^.*?regex.*$/)
  |> aggregateWindow(every: v.windowPeriod, fn: mean|median|max|count|derivative|sum)
  |> yield(name: "some-name")`},{label:"Filter by value",description:"Results between a min/max",value:`// v.bucket, v.timeRangeStart, and v.timeRange stop are all variables supported by the flux plugin and influxdb
from(bucket: v.bucket)
  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
  |> filter(fn: (r) => r["_value"] >= 10 and r["_value"] <= 20)`},{label:"Schema Exploration: (measurements)",description:"Get a list of measurement using flux",value:`import "influxdata/influxdb/v1"
v1.measurements(bucket: v.bucket)`},{label:"Schema Exploration: (fields)",description:"Return every possible key in a single table",value:`from(bucket: v.bucket)
  |> range(start: v.timeRangeStart, stop:v.timeRangeStop)
  |> keys()
  |> keep(columns: ["_value"])
  |> group()
  |> distinct()`},{label:"Schema Exploration: (tag keys)",description:"Get a list of tag keys using flux",value:`import "influxdata/influxdb/v1"
v1.tagKeys(bucket: v.bucket)`},{label:"Schema Exploration: (tag values)",description:"Get a list of tag values using flux",value:`import "influxdata/influxdb/v1"
v1.tagValues(
    bucket: v.bucket,
    tag: "host",
    predicate: (r) => true,
    start: -1d
)`}];class wr extends T.PureComponent{constructor(){super(...arguments),this.onFluxQueryChange=e=>{this.props.onChange({...this.props.query,query:e})},this.onSampleChange=e=>{this.props.onChange({...this.props.query,query:e.value}),this.forceUpdate()},this.getSuggestions=()=>{const e=[{label:"v.timeRangeStart",kind:Tn.q.Property,detail:"The start time"},{label:"v.timeRangeStop",kind:Tn.q.Property,detail:"The stop time"},{label:"v.windowPeriod",kind:Tn.q.Property,detail:"based on max data points"},{label:"v.defaultBucket",kind:Tn.q.Property,detail:"bucket configured in the datsource"},{label:"v.organization",kind:Tn.q.Property,detail:"org configured for the datsource"}],t=(0,sn.w)();return t.getVariables().forEach(r=>{const a="${"+r.name+"}";let i=t.replace(a);i===a&&(i=""),e.push({label:a,kind:Tn.q.Text,detail:`(Template Variable) ${i}`})}),e},this.editorDidMountCallbackHack=e=>{setTimeout(()=>e.layout(),100)}}render(){const{query:e,theme:t}=this.props,r=Bt(t),a=(0,O.jsxs)("div",{children:["Type: ",(0,O.jsx)("i",{children:"ctrl+space"})," to show template variable suggestions ",(0,O.jsx)("br",{}),"Many queries can be copied from Chronograf"]});return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(ni.B,{height:"100%",containerStyles:r.editorContainerStyles,language:"sql",value:e.query||"",onBlur:this.onFluxQueryChange,onSave:this.onFluxQueryChange,showMiniMap:!1,showLineNumbers:!0,getSuggestions:this.getSuggestions,onEditorDidMount:this.editorDidMountCallbackHack}),(0,O.jsxs)("div",{className:(0,pe.cx)("gf-form-inline",r.editorActions),children:[(0,O.jsx)(Ot.z9,{icon:"external-link-alt",variant:"secondary",target:"blank",href:"https://docs.influxdata.com/influxdb/latest/query-data/get-started/",children:"Flux language syntax"}),(0,O.jsx)(no.Y,{options:ao,value:"Sample query",onChange:this.onSampleChange,className:(0,pe.css)`
              margin-top: -${t.spacing(.5)};
              margin-left: ${t.spacing(.5)};
            `}),(0,O.jsx)("div",{className:"gf-form gf-form--grow",children:(0,O.jsx)("div",{className:"gf-form-label gf-form-label--grow"})}),(0,O.jsx)(Xt.I,{width:5,tooltip:a,children:"Help"})]})]})}}const Bt=n=>({editorContainerStyles:(0,pe.css)`
    height: 200px;
    max-width: 100%;
    resize: vertical;
    overflow: auto;
    background-color: ${n.isDark?n.colors.background.canvas:n.colors.background.primary};
    padding-bottom: ${n.spacing(1)};
  `,editorActions:(0,pe.css)`
    margin-top: 6px;
  `}),Ra=(0,Ae.cV)(wr);var Ut=h(50877),En=(n=>(n.Timeseries="time_series",n.Table="table",n))(En||{});const $r=[{label:"Time series",value:"time_series"},{label:"Table",value:"table"}],Wr=n=>({label:n,value:n}),lt=Ut.z??Wr;var cn=h(13288),$t=h(75505),Wn=h(81160),dn=h(41987),Ar=h(92053),jr=h(43127),ut=h(78368),ar=h(98765),Qn=h(26657),bt=h(14110),Kn=h(17172),Ye=h(47773);class It{transformMetricFindResponse(e){const t=[],r=e.fields.find(i=>i.name==="__text"),a=e.fields.find(i=>i.name==="__value");if(r&&a)for(let i=0;i<r.values.length;i++)t.push({text:""+r.values[i],value:""+a.values[i]});else for(const i of e.fields)for(const o of i.values)t.push({text:o});return(0,de.uniqBy)(t,"text")}}var B=h(16817),Z=h(68402),Oe=(n=>(n.String="string",n))(Oe||{}),$e=(n=>(n.Property="property",n.Operator="operator",n.Or="or",n.And="and",n.GroupBy="groupBy",n.Function="function",n.FunctionParameter="functionParameter",n))($e||{});function Ft(n){return`SELECT ${n.map(t=>{let r="";return t.name&&t.alias?r+=`${t.name}(${t.parameters?.map(a=>`${a.name}`)}) AS ${t.alias}`:t.name?r+=`${t.name}(${t.parameters?.map(a=>`${a.name}`)})`:t.alias?r+=`${t.parameters?.map(a=>`${a.name}`)} AS ${t.alias}`:r+=`${t.parameters?.map(a=>`${a.name}`)}`,r}).join(", ")} `}const st=n=>{if(!n)return!1;const e=n.some(r=>r.parameters?.length||r.parameters?.some(a=>a.name)),t=n.some(r=>r.name);return e||t};function io(n){return{type:$e.GroupBy,property:{type:Oe.String,name:n}}}function $v(n){return{type:$e.Property,property:{type:Oe.String,name:n}}}function Gl(n){return{type:$e.Function,name:n,parameters:[]}}function oo(n){let e=n?.editorMode||ar.lX.Builder;return n?.editorMode===void 0&&n?.rawSql!==void 0&&(e=ar.lX.Code),{...n,refId:n?.refId||"A",format:n?.format!==void 0?n.format:En.Table,rawSql:n?.rawSql||"",editorMode:e,sql:n?.sql??{columns:[Gl()],groupBy:[io()],limit:50}}}var Wv=h(73287),Zt=h(13544),Qv=h(6191),Kv=h(22354),zv=h(31347),ia=h(9e4),fn=h(81580),Bl=h(56034),Ul=h(94354),lo=h(37390),uo=h(14578);function Hv({isOpen:n,onCancel:e,onDiscard:t,onCopy:r}){const a=(0,T.useRef)(null),i=(0,Ae.of)(qv);return(0,T.useEffect)(()=>{n&&a.current?.focus()},[n]),(0,O.jsxs)(lo.a,{title:(0,O.jsxs)("div",{className:i.modalHeaderTitle,children:[(0,O.jsx)(uo.I,{name:"exclamation-triangle",size:"lg"}),(0,O.jsx)("span",{className:i.titleText,children:"Warning"})]}),onDismiss:e,isOpen:n,children:[(0,O.jsx)("p",{children:"Builder mode does not display changes made in code. The query builder will display the last changes you made in builder mode."}),(0,O.jsx)("p",{children:"Do you want to copy your code to the clipboard?"}),(0,O.jsxs)(lo.a.ButtonRow,{children:[(0,O.jsx)(Ot.$n,{type:"button",variant:"secondary",onClick:e,fill:"outline",children:"Cancel"}),(0,O.jsx)(Ot.$n,{variant:"destructive",type:"button",onClick:t,ref:a,children:"Discard code and switch"}),(0,O.jsx)(Ot.$n,{variant:"primary",onClick:r,children:"Copy code and switch"})]})]})}const qv=n=>({titleText:(0,pe.css)({paddingLeft:n.spacing(2)}),modalHeaderTitle:(0,pe.css)({fontSize:n.typography.size.lg,float:"left",paddingTop:n.spacing(1),margin:n.spacing(0,2)})}),ai=()=>!!Sr.$.featureToggles.sqlDatasourceDatabaseSelection,Jv=({dataset:n,db:e,dialect:t,onChange:r,inputId:a,preconfiguredDataset:i})=>{const o=!!i||t==="postgres",l=(0,B.A)(async()=>ai()&&o?(r(lt(i)),[lt(i)]):(n&&r(lt(n)),(await e.datasets()).map(lt)),[]);return(0,T.useEffect)(()=>{ai()||(n?l.value&&l.value.find(u=>u.value===n)===void 0&&l.value.length>0&&r(l.value[0]):l.value&&l.value[0]&&r(l.value[0]))},[l.value,r,n]),(0,O.jsx)(rr.l6,{"aria-label":"Dataset selector",inputId:a,value:n,options:l.value,onChange:r,disabled:l.loading,isLoading:l.loading,menuShouldPortal:!0})},Yv=({db:n,dataset:e,table:t,className:r,onChange:a,inputId:i})=>{const o=(0,B.A)(async()=>e?(await n.tables(e)).map(Ut.z):[],[e]);return(0,O.jsx)(rr.l6,{className:r,disabled:o.loading,"aria-label":"Table selector",inputId:i,"data-testid":Zt.Tp.components.SQLQueryEditor.headerTableSelector,value:t,options:o.value,onChange:a,isLoading:o.loading,menuShouldPortal:!0,placeholder:o.loading?"Loading tables":"Select table"})},Xv=[{label:"Builder",value:ar.lX.Builder},{label:"Code",value:ar.lX.Code}];function Zv({db:n,dialect:e,isQueryRunnable:t,onChange:r,onQueryRowChange:a,onRunQuery:i,preconfiguredDataset:o,query:l,queryRowFilter:u}){const{editorMode:s}=l,[c,d]=(0,Wv.A)(),[f,p]=(0,T.useState)(!1),m=n.toRawSql,v=(0,T.useId)(),g=(0,T.useCallback)(A=>{if(A===ar.lX.Code&&(0,bt.rR)("grafana_sql_editor_mode_changed",{datasource:l.datasource?.type,selectedEditorMode:ar.lX.Code}),s===ar.lX.Code){p(!0);return}r({...l,editorMode:A})},[s,r,l]),S=A=>{const w={...l,format:A.value!==void 0?A.value:En.Table};(0,bt.rR)("grafana_sql_format_changed",{datasource:l.datasource?.type,selectedFormat:w.format}),r(w)},y=A=>{if(A.value===l.dataset)return;const w={...l,dataset:A.value,table:void 0,sql:void 0,rawSql:""};r(w)},b=A=>{if(A.value===l.table)return;const w={...l,table:A.value,sql:void 0,rawSql:""};r(w)},F=()=>!(e==="influx"||!ai()&&e==="postgres");return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(Qv.X,{children:[(0,O.jsx)(Kv.W,{label:"Format",value:l.format,placeholder:"Select format",menuShouldPortal:!0,onChange:S,options:$r}),s===ar.lX.Builder&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(bn.K,{id:`sql-filter-${v}`,label:"Filter","data-testid":Zt.Tp.components.SQLQueryEditor.headerFilterSwitch,transparent:!0,showLabel:!0,value:u.filter,onChange:A=>{A.target instanceof HTMLInputElement&&((0,bt.rR)("grafana_sql_filter_toggled",{datasource:l.datasource?.type,displayed:A.target.checked}),a({...u,filter:A.target.checked}))}}),(0,O.jsx)(bn.K,{id:`sql-group-${v}`,label:"Group","data-testid":Zt.Tp.components.SQLQueryEditor.headerGroupSwitch,transparent:!0,showLabel:!0,value:u.group,onChange:A=>{A.target instanceof HTMLInputElement&&((0,bt.rR)("grafana_sql_group_toggled",{datasource:l.datasource?.type,displayed:A.target.checked}),a({...u,group:A.target.checked}))}}),(0,O.jsx)(bn.K,{id:`sql-order-${v}`,label:"Order","data-testid":Zt.Tp.components.SQLQueryEditor.headerOrderSwitch,transparent:!0,showLabel:!0,value:u.order,onChange:A=>{A.target instanceof HTMLInputElement&&((0,bt.rR)("grafana_sql_order_toggled",{datasource:l.datasource?.type,displayed:A.target.checked}),a({...u,order:A.target.checked}))}}),(0,O.jsx)(bn.K,{id:`sql-preview-${v}`,label:"Preview","data-testid":Zt.Tp.components.SQLQueryEditor.headerPreviewSwitch,transparent:!0,showLabel:!0,value:u.preview,onChange:A=>{A.target instanceof HTMLInputElement&&((0,bt.rR)("grafana_sql_preview_toggled",{datasource:l.datasource?.type,displayed:A.target.checked}),a({...u,preview:A.target.checked}))}})]}),(0,O.jsx)(zv.Z,{grow:1}),t?(0,O.jsx)(Ot.$n,{icon:"play",variant:"primary",size:"sm",onClick:()=>i(),children:"Run query"}):(0,O.jsx)(Bl.m,{theme:"error",content:(0,O.jsxs)(O.Fragment,{children:["Your query is invalid. Check below for details. ",(0,O.jsx)("br",{}),"However, you can still run this query."]}),placement:"top",children:(0,O.jsx)(Ot.$n,{icon:"exclamation-triangle",variant:"secondary",size:"sm",onClick:()=>i(),children:"Run query"})}),(0,O.jsx)(Ul.z,{options:Xv,size:"sm",value:s,onChange:g}),(0,O.jsx)(Hv,{isOpen:f,onCopy:()=>{(0,bt.rR)("grafana_sql_editor_mode_changed",{datasource:l.datasource?.type,selectedEditorMode:ar.lX.Builder,type:"copy"}),p(!1),d(l.rawSql),r({...l,rawSql:m(l),editorMode:ar.lX.Builder})},onDiscard:()=>{(0,bt.rR)("grafana_sql_editor_mode_changed",{datasource:l.datasource?.type,selectedEditorMode:ar.lX.Builder,type:"discard"}),p(!1),r({...l,rawSql:m(l),editorMode:ar.lX.Builder})},onCancel:()=>{(0,bt.rR)("grafana_sql_editor_mode_changed",{datasource:l.datasource?.type,selectedEditorMode:ar.lX.Builder,type:"cancel"}),p(!1)}})]}),s===ar.lX.Builder&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(Z.$,{v:.5}),(0,O.jsxs)(ia.U,{children:[F()&&(0,O.jsx)(fn.c,{label:"Dataset",width:25,children:(0,O.jsx)(Jv,{db:n,inputId:`sql-dataset-${v}`,dataset:l.dataset,dialect:e,preconfiguredDataset:o,onChange:y})}),(0,O.jsx)(fn.c,{label:"Table",width:25,children:(0,O.jsx)(Yv,{db:n,inputId:`sql-tableselect-${v}`,dataset:l.dataset||o,table:l.table,onChange:b})})]})]})]})}var $l=h(49185),eg=h(70713),rg=h(6867);function tg({children:n,onChange:e,query:t,width:r,height:a,editorLanguageDefinition:i}){const o=(0,T.useRef)(t);(0,T.useEffect)(()=>{o.current=t},[t]);const l=(0,T.useCallback)((u,s)=>{const c={...o.current,rawQuery:!0,rawSql:u};e(c,s)},[e]);return(0,O.jsx)(rg.Y,{width:r,height:a,query:t.rawSql,onChange:l,language:i,children:n})}var ng=h(66864),Wl=h(29158),Ql=h(41053),ag=h(75198),Kl=h(83195),ig=h(62930);function og({db:n,query:e,onValidate:t,range:r}){const[a,i]=(0,T.useState)(),o=(0,Ae.$j)(),l=(0,T.useMemo)(()=>(0,Kl.j_)("bytes"),[]),u=(0,T.useMemo)(()=>({error:(0,pe.css)({color:o.colors.error.text,fontSize:o.typography.bodySmall.fontSize,fontFamily:o.typography.fontFamilyMonospace}),valid:(0,pe.css)({color:o.colors.success.text}),info:(0,pe.css)({color:o.colors.text.secondary})}),[o]),[s,c]=(0,Ql.A)(async f=>f.rawSql?.trim()===""?null:await n.validateQuery(f,r),[n]),[,]=(0,ag.A)(async()=>{const f=await c(e);return f&&i(f),null},1e3,[e,c]);if((0,T.useEffect)(()=>{a?.isError&&t(!1),a?.isValid&&t(!0)},[a,t]),!s.value&&!s.loading)return null;const d=s.value?.error?lg(s.value.error):"";return(0,O.jsxs)(O.Fragment,{children:[s.loading&&(0,O.jsxs)("div",{className:u.info,children:[(0,O.jsx)(ig.y,{inline:!0,size:"xs"})," Validating query..."]}),!s.loading&&s.value&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(O.Fragment,{children:s.value.isValid&&s.value.statistics&&(0,O.jsxs)("div",{className:u.valid,children:[(0,O.jsx)(uo.I,{name:"check"})," This query will process"," ",(0,O.jsx)("strong",{children:(0,Kl.cN)(l(s.value.statistics.TotalBytesProcessed))})," ","when run."]})}),(0,O.jsx)(O.Fragment,{children:s.value.isError&&(0,O.jsx)("div",{className:u.error,children:d})})]})]})}function lg(n){const e=n.split(":");return e.length>2?e.slice(2).join(":"):n}function zl({showTools:n,onFormatCode:e,onExpand:t,isExpanded:r,...a}){const i=(0,Ae.$j)(),[o,l]=(0,T.useState)(),u=(0,T.useMemo)(()=>({container:(0,pe.css)({border:`1px solid ${i.colors.border.medium}`,borderTop:"none",padding:i.spacing(.5,.5,.5,.5),display:"flex",flexGrow:1,justifyContent:"space-between",fontSize:i.typography.bodySmall.fontSize}),error:(0,pe.css)({color:i.colors.error.text,fontSize:i.typography.bodySmall.fontSize,fontFamily:i.typography.fontFamilyMonospace}),valid:(0,pe.css)({color:i.colors.success.text}),info:(0,pe.css)({color:i.colors.text.secondary}),hint:(0,pe.css)({color:i.colors.text.disabled,whiteSpace:"nowrap",cursor:"help"})}),[i]);let s={};return!n&&o===void 0&&(s={height:0,padding:0,visibility:"hidden"}),(0,O.jsxs)("div",{className:u.container,style:s,children:[(0,O.jsx)("div",{children:a.onValidate&&(0,O.jsx)(og,{...a,onValidate:c=>{l(c),a.onValidate(c)}})}),n&&(0,O.jsx)("div",{children:(0,O.jsxs)(ng.Gy,{spacing:"sm",children:[e&&(0,O.jsx)(Wl.K,{onClick:()=>{(0,bt.rR)("grafana_sql_query_formatted",{datasource:a.query.datasource?.type}),e()},name:"brackets-curly",size:"xs",tooltip:"Format query"}),t&&(0,O.jsx)(Wl.K,{onClick:()=>{(0,bt.rR)("grafana_sql_editor_expand",{datasource:a.query.datasource?.type,expanded:!r}),t(!r)},name:r?"angle-up":"angle-down",size:"xs",tooltip:r?"Collapse editor":"Expand editor"}),(0,O.jsx)(Bl.m,{content:"Hit CTRL/CMD+Return to run query",children:(0,O.jsx)(uo.I,{className:u.hint,name:"keyboard"})})]})})]})}function ug({db:n,query:e,onChange:t,onRunQuery:r,onValidate:a,queryToValidate:i,range:o}){const l=(0,Ae.$j)(),u=(0,Ae.of)(sg),[s,c]=(0,T.useState)(!1),[d,f]=(0,$l.A)(),[p,m]=(0,$l.A)(),v=(0,T.useMemo)(()=>n.getEditorLanguageDefinition(),[n]),g=(b,F)=>(0,O.jsx)(tg,{editorLanguageDefinition:v,query:e,width:b,height:F?F-f.height:void 0,onChange:t,children:({formatQuery:A})=>(0,O.jsx)("div",{ref:d,children:(0,O.jsx)(zl,{db:n,query:i,onValidate:a,onFormatCode:A,showTools:!0,range:o,onExpand:c,isExpanded:s})})}),S=(b=!1)=>b?(0,O.jsx)(eg.Ay,{children:({width:F,height:A})=>g(F,A)}):(0,O.jsx)("div",{ref:p,children:g()}),y=()=>(0,O.jsx)("div",{style:{width:m.width,height:m.height,background:l.colors.background.primary,display:"flex",alignItems:"center",justifyContent:"center"},children:"Editing in expanded code editor"});return(0,O.jsxs)(O.Fragment,{children:[s?y():S(),s&&(0,O.jsx)(lo.a,{title:`Query ${e.refId}`,closeOnBackdropClick:!1,closeOnEscape:!1,className:u.modal,contentClassName:u.modalContent,isOpen:s,onDismiss:()=>{(0,bt.rR)("grafana_sql_editor_expand",{datasource:e.datasource?.type,expanded:!1}),c(!1)},children:S(!0)})]})}function sg(n){return{modal:(0,pe.css)({width:"95vw",height:"95vh"}),modalContent:(0,pe.css)({height:"100%",paddingTop:0})}}var cg=h(71087),dg=h(11807);function ii({query:n,onQueryChange:e,db:t}){return{onSqlChange:(0,T.useCallback)(a=>{const i=t.toRawSql,o=i({sql:a,dataset:n.dataset,table:n.table,refId:n.refId}),l={...n,sql:a,rawSql:o};e(l)},[t,e,n])}}var fg=h(85269),Hl=h(81392),oi=h(3721);function pg({sql:n,columns:e,onSqlChange:t}){const r=(0,T.useCallback)(a=>{const i=a.map(l=>io(l.property?.name)),o={...n,groupBy:i};t(o)},[t,n]);return(0,O.jsx)(fg.o,{items:n.groupBy,onChange:r,renderItem:vg({options:e})})}function vg({options:n}){return function(t,r,a){return(0,O.jsxs)(Hl.M,{children:[(0,O.jsx)(rr.l6,{value:t.property?.name?(0,Ut.z)(t.property.name):null,"aria-label":"Group by",options:n,menuShouldPortal:!0,onChange:({value:i})=>i&&r(io(i))}),(0,O.jsx)(oi.Z,{title:"Remove group by column",icon:"times",variant:"secondary",onClick:a})]})}}function gg({fields:n,query:e,onQueryChange:t,db:r}){const{onSqlChange:a}=ii({query:e,onQueryChange:t,db:r});return(0,O.jsx)(pg,{columns:n,sql:e.sql,onSqlChange:a})}const mg=[{description:"Sort by ascending",value:"ASC",icon:"sort-amount-up"},{description:"Sort by descending",value:"DESC",icon:"sort-amount-down"}];function hg({sql:n,onSqlChange:e,columns:t,showOffset:r}){const a=(0,T.useCallback)(u=>{const s={...n,orderByDirection:u};e(s)},[e,n]),i=(0,T.useCallback)(u=>{const s={...n,limit:Number.parseInt(u.currentTarget.value,10)};e(s)},[e,n]),o=(0,T.useCallback)(u=>{const s={...n,offset:Number.parseInt(u.currentTarget.value,10)};e(s)},[e,n]),l=(0,T.useCallback)(u=>{const s={...n,orderBy:$v(u?.value)};u===null&&(s.orderByDirection=void 0),e(s)},[e,n]);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(fn.c,{label:"Order by",width:25,children:(0,O.jsxs)(Hl.M,{children:[(0,O.jsx)(rr.l6,{"aria-label":"Order by",options:t,value:n.orderBy?.property.name?(0,Ut.z)(n.orderBy.property.name):null,isClearable:!0,menuShouldPortal:!0,onChange:l}),(0,O.jsx)(Z.$,{h:1.5}),(0,O.jsx)(Ul.z,{options:mg,disabled:!n?.orderBy?.property.name,value:n.orderByDirection,onChange:a})]})}),(0,O.jsx)(fn.c,{label:"Limit",optional:!0,width:25,children:(0,O.jsx)(fr.p,{type:"number",min:0,id:(0,de.uniqueId)("limit-"),value:n.limit||"",onChange:i})}),r&&(0,O.jsx)(fn.c,{label:"Offset",optional:!0,width:25,children:(0,O.jsx)(fr.p,{type:"number",id:(0,de.uniqueId)("offset-"),value:n.offset||"",onChange:o})})]})}function yg({fields:n,query:e,onQueryChange:t,db:r}){const{onSqlChange:a}=ii({query:e,onQueryChange:t,db:r});let i=[];return n&&(i=[{value:"",label:"Selected columns",options:e.sql?.columns?.map((l,u)=>{const s=l.name?`${l.name}(${l.parameters?.map(c=>c.name)})`:l.parameters?.map(c=>c.name);return{value:s,label:`${u+1} - ${s}`}}),expanded:!0},...n]),(0,O.jsx)(hg,{sql:e.sql,onSqlChange:a,columns:i})}const Sg=["AVG","COUNT","MAX","MIN","SUM"],Og=["$__time","$__timeEpoch","$__timeFilter","$__timeFrom","$__timeTo","$__timeGroup","$__timeGroupAlias","$__unixEpochFilter","$__unixEpochNanoFilter","$__unixEpochNanoFrom","$__unixEpochNanoTo","$__unixEpochGroup","$__unixEpochGroupAlias"];var ql=h(46819);const bg={label:"*",value:"*"};function Fg({sql:n,format:e,columns:t,onSqlChange:r,functions:a}){const i=(0,Ae.of)(Tg),o=[bg,...t||[]],l=[];e===En.Timeseries&&(l.push({label:"time",value:"time"}),l.push({label:"value",value:"value"}));const u=(0,T.useCallback)((p,m)=>v=>{let g={...p};p.parameters?.length?g.parameters=p.parameters.map(y=>y.type===$e.FunctionParameter?{...y,name:v.value}:y):g.parameters=[{type:$e.FunctionParameter,name:v.value}];const S={...n,columns:n.columns?.map((y,b)=>b===m?g:y)};r(S)},[r,n]),s=(0,T.useCallback)((p,m)=>v=>{const g={...p,name:v?.value},S={...n,columns:n.columns?.map((y,b)=>b===m?g:y)};r(S)},[r,n]),c=(0,T.useCallback)((p,m)=>v=>{let g={...p};v!==null?g={...p,alias:`"${v?.value?.trim()}"`}:delete g.alias;const S={...n,columns:n.columns?.map((y,b)=>b===m?g:y)};r(S)},[r,n]),d=(0,T.useCallback)(p=>()=>{const m=[...n.columns];m.splice(p,1);const v={...n,columns:m};r(v)},[r,n]),f=(0,T.useCallback)(()=>{const p={...n,columns:[...n.columns,Gl()]};r(p)},[r,n]);return(0,O.jsxs)(ql.B,{gap:2,wrap:!0,direction:"column",children:[n.columns?.map((p,m)=>(0,O.jsx)("div",{children:(0,O.jsxs)(ql.B,{gap:2,alignItems:"end",children:[(0,O.jsx)(fn.c,{label:"Column",width:25,children:(0,O.jsx)(rr.l6,{value:Eg(p),"data-testid":Zt.Tp.components.SQLQueryEditor.selectColumn,options:o,inputId:`select-column-${m}-${(0,de.uniqueId)()}`,menuShouldPortal:!0,allowCustomValue:!0,onChange:u(p,m)})}),(0,O.jsx)(fn.c,{label:"Aggregation",optional:!0,width:25,children:(0,O.jsx)(rr.l6,{value:p.name?(0,Ut.z)(p.name):null,inputId:`select-aggregation-${m}-${(0,de.uniqueId)()}`,"data-testid":Zt.Tp.components.SQLQueryEditor.selectAggregation,isClearable:!0,menuShouldPortal:!0,allowCustomValue:!0,options:a,onChange:s(p,m)})}),(0,O.jsx)(fn.c,{label:"Alias",optional:!0,width:15,children:(0,O.jsx)(rr.l6,{value:p.alias?(0,Ut.z)(p.alias):null,inputId:`select-alias-${m}-${(0,de.uniqueId)()}`,"data-testid":Zt.Tp.components.SQLQueryEditor.selectAlias,options:l,onChange:c(p,m),isClearable:!0,menuShouldPortal:!0,allowCustomValue:!0})}),(0,O.jsx)(Ot.$n,{title:"Remove column",type:"button",icon:"trash-alt",variant:"secondary",size:"md",onClick:d(m)})]})},m)),(0,O.jsx)(Ot.$n,{type:"button",onClick:f,variant:"secondary",title:"Add column",size:"md",icon:"plus",className:i.addButton})]})}const Tg=()=>({addButton:(0,pe.css)({alignSelf:"flex-start"})});function Eg({parameters:n}){const e=n?.find(t=>t.type===$e.FunctionParameter);return e?.name?(0,Ut.z)(e.name):null}function Cg({fields:n,query:e,onQueryChange:t,db:r}){const{onSqlChange:a}=ii({query:e,onQueryChange:t,db:r}),i=[...Sg,...r.functions?.()||[]].map(Ut.z);return(0,O.jsx)(Fg,{columns:n,sql:e.sql,format:e.format,functions:i,onSqlChange:a})}var Ag=h(24705),br=h(23029),Fr=h(92901),Lr=h(56822),xe=h(53954),Tr=h(85501),ne=h(64467),we=h(5544),Fe=h(60436),Er=h(82284),Se=h(49568),Lg=0;const mr=function(){var n=(new Date().getTime().toString(16)+"FF").substr(0,11),e="ssssssss-xxxx-4xxx-yxxx-x".replace(/[xys]/g,function(t){var r=t==="s"?Math.floor(Math.random()*16):Lg++&15,a=t==="x"?r:r&3|8;return a.toString(16)});return e+n};function Jl(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function wg(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Jl(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Jl(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var zn=["formatValue","mongoFormatValue","sqlFormatValue","jsonLogic","elasticSearchFormatValue","spelFormatValue","spelImportFuncs","spelImportValue"],oa=["formatOp","mongoFormatOp","sqlFormatOp","jsonLogic","spelFormatOp"],li=function(e){return(0,Er.A)(e)==="object"&&e!==null&&Object.prototype.toString.call(e)==="[object Object]"},Yl=function(e){if((0,Er.A)(e)==="object"&&e!==null){if(Array.isArray(e))return(0,Fe.A)(e);if(li(e))return wg({},e)}return e},Vt=function(e,t){return Object.fromEntries(Object.entries(e).filter(function(r){var a=(0,we.A)(r,1),i=a[0];return!t.includes(i)}))},zr=function(e){var t;return(t=e?.cardinality)!==null&&t!==void 0?t:1},ui=function(e,t){return e===t?!0:Se.Map.isMap(e)?e.equals(t):JSON.stringify(e)==JSON.stringify(t)},Ia=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return e===t?!0:Array.isArray(e)?xg(e,t,r):Se.Map.isMap(e)?e.equals(t):(0,Er.A)(e)=="object"?jg(e,t,r):e===t};function xg(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(n===e)return!0;if(!n||!e)return!1;var r=n.length;if(e.length!==r)return!1;for(var a=0;a<r;a++){var i=t?Ia(n[a],e[a],t):n[a]===e[a];if(!i)return!1}return!0}function jg(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(n===e)return!0;if(!n||!e)return!1;var r=Object.keys(n),a=Object.keys(e),i=r.length;if(a.length!==i)return!1;for(var o=0;o<i;o++){var l=r[o],u=t?Ia(n[l],e[l],t):n[l]===e[l];if(!u)return!1}return!0}var la=function(e){return(0,Er.A)(e)==="object"&&e!==null&&typeof e.toJS=="function"},si=function(e){return la(e)&&Se.default.isList(e)};function Hr(n){return si(n)?n:new Se.default.List(n)}function so(n){return la(n)?n.toJS():n}var Xl=function(e){return e.replace(/[.*+?^${}()|[\]\\/]/g,"\\$&")},Zl=function(e,t,r,a,i,o){if(Array.isArray(e))return t},co=function n(e){var t=["$$typeof","_owner","_store","ref","key"],r=function(l){return typeof l=="string"?l:typeof l=="function"?l.name:l};if(e instanceof Array)return e.map(function(o,l){return n(o)});if((0,Er.A)(e)==="object"&&e!==null&&Pa(e)){var a,i=Vt(e,t);return i.type&&(i.type=r(i.type)),i!=null&&(a=i.props)!==null&&a!==void 0&&a.children&&(i.props.children=n(i.props.children)),i}return e},Pa=function(e){return(0,Er.A)(e)==="object"&&e!==null&&!Array.isArray(e)&&Object.keys(e).includes("type")&&Object.keys(e).includes("props")&&Object.keys(e).includes("key")&&Object.keys(e).includes("ref")&&Object.keys(e).includes("$$typeof")},fo=function(e){return(0,Er.A)(e)==="object"&&e!==null&&!Array.isArray(e)&&typeof e.type=="string"&&Object.keys(e).includes("props")},Tt=function(e){var t=(0,Er.A)(e)==="object"&&e!==null&&!Array.isArray(e)&&Object.keys(e).length===1;return t};function eu(n){return new Promise(function(e){setTimeout(e,n)})}function ci(n,e){return n||(n=[]),e||(e=[]),e.map(function(t){return[t,n.indexOf(t)]}).map(function(t,r,a){var i=(0,we.A)(t,2),o=i[0],l=i[1];if(l==-1){var u=a.slice(r+1),s=a.slice(0,r),c=s.reverse().find(function(f){var p=(0,we.A)(f,2),m=p[0],v=p[1];return v!=-1}),d=u.find(function(f){var p=(0,we.A)(f,2),m=p[0],v=p[1];return v!=-1});return d?[o,"before",d[0]]:c?[o,"after",c[0]]:[o,"append",null]}else return null}).filter(function(t){return t!==null}).reduce(function(t,r){var a=(0,we.A)(r,3),i=a[0],o=a[1],l=a[2],u=t.indexOf(l);return t.indexOf(i)==-1&&(u>-1?t.splice(u+(o=="after"?1:0),0,i):t.splice(o=="append"?1/0:0,0,i)),t},n.slice())}var ru=function n(e){(0,Er.A)(e)==="object"&&e!==null&&!Pa(e)&&(Object.keys(e).forEach(function(t){t!=="__cache"&&n(e[t])}),Object.freeze(e))},tu=function n(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(li(e)){if(e.var)return r[e.var]=t,!0;if(!li(t))return!1;for(var i in e){var o=e[i],l=t[i];if(!n(o,l,r,[].concat((0,Fe.A)(a),[i])))return!1}return!0}else if(Array.isArray(e)){if(!Array.isArray(t))return!1;for(var u=0;u<e.length;u++){var s=e[u],c=t[u];if(!n(s,c,r,[].concat((0,Fe.A)(a),[u])))return!1}return!0}else return e===t},Rg=function(){return typeof process<"u"&&process.env&&!1},nu=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=e??Rg();return t?console:{error:function(){},log:function(){},warn:function(){},debug:function(){},info:function(){}}},au=function(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t,r=0;r<e.length;r++){var a=e[r];if(a!==void 0){t=a;break}}return t},In=nu(),Ig=h(54756),Cn=h.n(Ig),Pg=h(44383),pn=h.n(Pg),Ng=h(68090),di=h.n(Ng),Dg=h(90179),fi=h.n(Dg);function Vg(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=kg(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(s){throw s},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,l;return{s:function(){t=t.call(n)},n:function(){var s=t.next();return i=s.done,s},e:function(s){o=!0,l=s},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function kg(n,e){if(n){if(typeof n=="string")return iu(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return iu(n,e)}}function iu(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function ou(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function pi(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ou(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ou(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var po=function(e){return(0,Er.A)(e)=="object"&&e!==null&&!Array.isArray(e)},An=function(e,t){if(!(e==null||e==""))return po(e)?pi(pi({},e),{},{title:e.title||e.value}):{value:e,title:t!==void 0?t:""+e}},vo=function(e){var t=An(e);return po(t)?pi(pi({},An(e)),{},{isCustom:!0}):t},lu=function(e){if(Array.isArray(e))return e.map(function(i){return An(i)});if(!po(e))return e;var t=[];for(var r in e){var a=e[r];t.push(An(r,a))}return t},Na=function(e,t){if(Array.isArray(e)){var r=e.map(function(a){return An(a)});return r.find(function(a){return""+a.value==""+t})}else return e[t]!==void 0?An(t,e[t]):void 0},uu=function(e,t){if(e==null)return t;var r=Na(e,t);return r!==void 0?r.title:t},Mg=function(e,t){if(e==null)return t;var r=Na(e,t);return r!==void 0?r.value:t},go=function(e,t){var r=[];if(Array.isArray(e)){var a=Vg(e),i;try{for(a.s();!(i=a.n()).done;){var o=i.value,l=t(An(o));l!=null&&r.push(l)}}catch(c){a.e(c)}finally{a.f()}}else for(var u in e){var s=t(An(u,e[u]));s!=null&&r.push(s)}return r},_g=function(e,t){return go(t,function(r){return"".concat(r.value).indexOf(e)!=-1||r.title.indexOf(e)!=-1?r:null}).filter(function(r){return r!==null}).shift()},vi=function(e,t){return go(t,function(r){return""+r.value==""+e?r:null}).filter(function(r){return r!==null}).shift()},Te=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return e.interpose("children1").withMutations(function(i){return i.skip(1),i.push.apply(i,r),i})},mo=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return e.interpose("children1").withMutations(function(i){return i.push.apply(i,r),i})},ua=function(e,t){var r=new Se.default.OrderedMap((0,ne.A)({},e.get("id"),e)),a=e;return t.forEach(function(i){var o;a=r.get(i),r=(o=a)===null||o===void 0?void 0:o.get("children1")}),a},su=function(e){var t=e;function r(a,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,l=i.push(a.get("id")),u=a.getIn(["properties","isLocked"]);o&&u&&(t=t.deleteIn(Te(l,"properties","isLocked")));var s=a.get("children1");s&&s.map(function(c,d){r(c,l,u||o)})}return r(e,new Se.default.List),t},en=function(e){var t=e;function r(a,i,o,l){if(a){var u=a.get("path"),s=a.get("id"),c=s||l||mr(),d=i.push(c);(!u||!u.equals(d))&&(t=t.setIn(Te(d,"path"),d)),s||(t=t.setIn(Te(d,"id"),c));var f=a.get("children1");f&&(f.constructor.name==="Map"&&(t=t.setIn(Te(d,"children1"),new Se.default.OrderedMap(f))),f.map(function(p,m){r(p,d,o+1,m)}))}}return r(e,new Se.default.List,0),t},gi=function(e){var t=e;function r(a,i,o,l){if(!a)return!1;var u=a.get("id")||l,s=i.push(u),c=a.get("children1");if(c){var d=c.map(function(f,p){return r(f,s,o+1,p)}).reduce(function(f,p){return f&&p},!0);if((c.size==0||d)&&o>0)return t=t.deleteIn(Te(s)),!0}return!1}return r(e,new Se.default.List,0),t},ho=function(e){var t=[],r={},a=[],i=0,o=0,l=0,u=0,s={};function c(v,g,S,y,b,F,A,w){var x=v===e,k=v.get("type"),D=v.get("collapsed"),I=v.get("id"),_=v.get("children1"),G=v.getIn(["properties","isLocked"]),M=_?_.map(function(Ee,_e){return _e}).valueSeq().toArray():null,H=k==="rule_group",K=k==="rule",z=k==="group",U=k==="case_group",ee=!b&&(!_||H),Y=M?.length>0,oe=g.length?g[g.length-1]:null,ie=U?I:A;U&&(a.push(I),o=0,l=0,u=0,s={});var se=ie?a.indexOf(ie):null,ce=t.length,ge=i,ye;x||(ye={},ye.caseNo=se,ye.globalNoByType=U?se:s[k]||0,ye.indexPath=[].concat((0,Fe.A)(g.slice(1).map(function(Ee){return r[Ee].childNo})),[w]),K?ye.globalLeafNo=o:z&&(ye.globalGroupNo=u)),t.push(I),r[I]={node:v,index:ce,id:I,type:k,parent:oe,parentType:oe?r[oe].type:null,children:M,childNo:w,caseId:ie,caseNo:se,path:g.concat(I),lev:F,isLeaf:!_,isAtomicRule:ee,isLocked:G||y,top:S?null:ge,isDefaultCase:U?!_:void 0,atomicRulesCountInCase:U?0:void 0,position:ye,collapsed:D,_top:ce,leaf:!_};var ue=0,be=0;S||(i+=1,ue+=1,Y&&!D&&!H&&(be+=1),!x&&!U&&(z&&u++,ee&&l++,K&&o++,s[k]=(s[k]||0)+1)),A&&ee&&r[A].atomicRulesCountInCase++;var me=0,Ce=0;if(Y){var Me=0;_.map(function(Ee,_e){if(Ee){c(Ee,g.concat(I),S||D,y||G,b||H,F+1,ie,Me);var He=r[_e];me=Math.max(me,He.depth||0),Ce+=He.height,Me++}})}ue+=Ce,be+=me;var je=t.length,Ie=je-ce,Ve=S?null:ge+ue;Object.assign(r[I],{depth:_?be:void 0,_height:Ie,height:ue,bottom:Ve})}c(e,[],!1,!1,!1,0,null,null);for(var d=0;d<t.length;d++){var f=d>0?t[d-1]:null,p=d<t.length-1?t[d+1]:null,m=r[t[d]];m.prev=f,m.next=p}return{flat:t,items:r,cases:a}},Gg=function(e){if(!e)return-1;var t=0;function r(a,i,o){var l,u,s;typeof a.get=="function"?(l=a.get("id"),u=a.get("children1"),s=a.get("type")):(l=a.id,u=a.children1,s=a.type);var c=s=="rule_group";t++,u&&!c&&u.map(function(d,f){d&&r(d,i.concat(l),o+1)})}return r(e,[],0),t-1},yo=function(e){if(!e)return-1;var t=0;function r(a,i,o){var l,u,s;typeof a.get=="function"?(l=a.get("id"),u=a.get("children1"),s=a.get("type")):(l=a.id,u=a.children1,s=a.type),s=="rule"||s=="rule_group"?t++:u&&u.map(function(c,d){c&&r(c,i.concat(l),o+1)})}return r(e,[],0),t},cu=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=e;function i(o,l){t&&o.path&&delete o.path,t&&!r&&l&&delete o.id;var u=o.properties;u&&u.operatorOptions==null&&delete u.operatorOptions;var s=o.children1;if(s){for(var c in s)s[c]&&i(s[c],c);r&&(o.children1=Object.values(s))}}return i(e,null),a},du=function(e){var t=[],r=e.get("children1");return r&&r.map(function(a){var i=a.getIn(["properties","value"]),o;i&&i.size==1?(o=i.get(0),Array.isArray(o)&&o.length==0&&(o=null)):o=null,t=[].concat((0,Fe.A)(t),[o])}),t},So=function(e){return!e.get("children1")||e.get("children1").size==0},Oo=function(e,t){return e.getIn(Te(t,"children1")).size>0},bo=function(e){if(e!=null&&e.toJS){var t,r=e==null||(t=e.toJS)===null||t===void 0?void 0:t.call(e);return r!=null&&r.func?e.toOrderedMap():r}else return e},Bg=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(e){var a=e;return a=a.toJS(),a=cu(a,t,r),a}},Fo=function(e){if(fu(e))return e;if(pu(e))return en(Da(e));if(typeof e=="string"&&e.startsWith('["~#iM"'))throw new Error("You are trying to load query in obsolete serialization format (Immutable string) which is not supported in versions starting from 2.1.17");if(typeof e=="string")return en(Da(JSON.parse(e)));throw new Error("Can't load tree!")},fu=function(e){return Se.Map.isMap(e)},pu=function(e){return(0,Er.A)(e)=="object"&&(e.type=="group"||e.type=="switch_group")};function Da(n){var e=(0,Se.fromJS)(n,function(t,r,a){var i=a&&a.length>3&&a[a.length-1]==="value"&&a[a.length-3]==="args",o=a&&a.length>3&&a[a.length-1]==="value"&&a[a.length-2]==="properties",l;if(t=="properties"){l=r.toOrderedMap();for(var u=0;u<2;u++){var s,c,d;((s=l.get("value"))===null||s===void 0||(c=(d=s).get)===null||c===void 0?void 0:c.call(d,u))===null&&(l=l.setIn(["value",u],void 0))}}else i?l=bo(r):(a?o:t=="value")&&Se.default.Iterable.isIndexed(r)?l=r.map(bo).toList():t=="asyncListValues"?l=r.toJS():t=="children1"&&Se.default.Iterable.isIndexed(r)?l=new Se.default.OrderedMap(r.map(function(f){return[f?.get("id")||mr(),f]})):l=Se.default.Iterable.isIndexed(r)?r.toList():r.toOrderedMap();return l});return e}var vu=h(87695),Ug=h(95093),sa=h.n(Ug);function gu(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Pn(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?gu(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):gu(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function mu(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=$g(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(s){throw s},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,l;return{s:function(){t=t.call(n)},n:function(){var s=t.next();return i=s.done,s},e:function(s){o=!0,l=s},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function $g(n,e){if(n){if(typeof n=="string")return hu(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return hu(n,e)}}function hu(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}var Wg=function(e){return Array.from(new Set(e))},yu="jlField",Su="jlArgs",Qg=["==","!="],Kg=["<","<=",">",">="],zg=["multiselect_equals","multiselect_not_equals","multiselect_contains","multiselect_not_contains"],Ou=function(e){return{errors:[],settings:e?.settings}},Hg=function(e,t){return bu(e,t,!1)},bu=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=Ou();a.settings={allowUnknownFields:!1,returnErrors:r};var i=kt(t,void 0,!1),o=qg(i),l=e?ca(e,o,i,["rule","group","switch"],a):void 0,u=l?Fo(l):void 0;return r?[u,a.errors]:(a.errors.length&&console.warn("Errors while importing from JsonLogic:",a.errors),u)},qg=function(e){var t={},r={};for(var a in e.operators){var i=e.operators[a];if(typeof i.jsonLogic=="string"){var o=i.jsonLogic+"/"+zr(i);t[o]||(t[o]=[]),t[o].push(a)}else if(typeof i.jsonLogic2=="string"){var l=i.jsonLogic2+"/"+zr(i);t[l]||(t[l]=[]),t[l].push(a),r[a]||(r[a]={}),r[a]={template:i.jsonLogic(yu,a,Su),jsonLogic2:i.jsonLogic2,_jsonLogicIsExclamationOp:!!i._jsonLogicIsExclamationOp}}}var u={};for(var s in e.conjunctions){var c=e.conjunctions[s],d=c.jsonLogicConj||s.toLowerCase();u[d]=s}var f={},p=mu(ha(e)),m;try{for(p.s();!(m=p.n()).done;){var v=(0,we.A)(m.value,2),g=v[0],S=v[1],y=void 0;S.jsonLogicIsMethod?y="#"+S.jsonLogic:typeof S.jsonLogic=="string"&&(y=S.jsonLogic),y&&(f[y]||(f[y]=[]),f[y].push(g))}}catch(w){p.e(w)}finally{p.f()}var b=e.settings.jsonLogic,F=b.groupVarKey,A=b.altVarKey;return{operators:t,conjunctions:u,funcs:f,varKeys:["var",F,A],combinationOperators:r}},To=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i;if(t!=null&&t.combinationOperators)for(var o=0,l=Object.entries(t.combinationOperators);o<l.length;o++){var u=(0,we.A)(l[o],2),s=u[0],c=u[1];if(a==null||a.includes(s)){var d=Jg(c.template,e);d.match&&(i?r.errors.push("Operator matched against 2 templates: ".concat(i.newOp," and ").concat(s)):i=d,i.newOp=c.jsonLogic2)}}return i},Jg=function n(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{match:!0,jlField:null,jlArgs:[]};if(e==null||t==null)return r.match=!1,r;var a=Object.keys(e),i=Object.keys(t);if(a.length!==i.length)return r.match=!1,r;for(var o=0;o<a.length;o++){var l=a[o],u=e[l];if(l!==i[o])return r.match=!1,r;if(u===yu&&Tt(t[l]))r.jlField=t[l];else if(u===Su)r.jlArgs.push(t[l]);else if((0,Er.A)(u)==="object"&&u!==null||Array.isArray(u))r=n(u,t[l],r);else if(u!==t[l])return r.match=!1,r}return r},ca=function n(e,t,r,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1,l=arguments.length>6?arguments[6]:void 0,u=arguments.length>7?arguments[7]:void 0,s=arguments.length>8&&arguments[8]!==void 0?arguments[8]:null,c=arguments.length>9&&arguments[9]!==void 0?arguments[9]:!1,d,f;Tt(e)&&(d=Object.keys(e)[0],f=e[d],Array.isArray(f)||(f=[f]));var p,m=i.errors.length,v=r.settings.jsonLogic.lockedOp,g=d=="!"&&f.length==1&&f[0]&&Tt(f[0])&&t.varKeys.includes(Object.keys(f[0])[0]),S=To(e,t,i);S&&(f=[],f[0]=S.jlField,S.jlArgs.forEach(function(x){return f.push(x)}),d=S.newOp);var y=d=="!"&&!g,b=v&&d==v,F=a.includes("switch"),A=F;b?p=n(f[0],t,r,a,i,o,l,u,s,!0):y?p=n(f[0],t,r,a,i,!o,l,u,s):a.includes("val")?p=Fu(d,f,t,r,o,i,s)||Tu(d,f,t,r,o,l,i,s)||Yg(e,l,u,r,i):(a.includes("switch")&&(p=im(d,f,t,r,o,i,s)),p==null&&a.includes("group")&&(p=Eu(d,f,t,r,o,i,s,!1)),p==null&&a.includes("rule")&&(p=am(d,f,t,r,o,i,s)),p&&A&&!["group","switch_group"].includes(p.type)&&(p=Va(p,r)));var w=i.errors.length;return d!="!"&&p===void 0&&w==m&&i.errors.push("Can't parse logic ".concat(JSON.stringify(e))),b&&(p.properties.isLocked=!0),p},Yg=function(e,t,r,a,i){var o;if(e===void 0&&(e=t?.defaultValue),e!==void 0){r=r||t?.mainWidget;var l=a.widgets[r],u=t?.type;if(u&&!l){i.errors.push("No widget for type ".concat(u));return}if(Tt(e)){i.errors.push("Unexpected logic in value: ".concat(JSON.stringify(e)));return}if(u==="time"&&typeof e=="number"){var s=Math.floor(e/60/60)%24,c=Math.floor(e/60)%60,d=e%60,f=l.valueFormat;if(f){var p=new Date(e);p.setMilliseconds(0),p.setHours(s),p.setMinutes(c),p.setSeconds(d),e=sa()(p).format(f)}else e="".concat(s,":").concat(c,":").concat(d)}if(["date","datetime"].includes(u)&&e&&!(e instanceof Date))try{var m=new Date(e);m instanceof Date&&m.toISOString()===e&&(e=m)}catch{i.errors.push("Can't convert value ".concat(e," as Date")),e=void 0}if(e instanceof Date&&t){var v=l.valueFormat;v&&(e=sa()(e).format(v))}var g;if(e&&t!==null&&t!==void 0&&(o=t.fieldSettings)!==null&&o!==void 0&&o.asyncFetch){var S=Array.isArray(e)?e:[e];g=S}if(l!=null&&l.jsonLogicImport)try{e=l.jsonLogicImport.call(a.ctx,e)}catch(b){var y;i.errors.push("Can't import value ".concat(e," using import func of widget ").concat(r,": ").concat((y=b?.message)!==null&&y!==void 0?y:b)),e=void 0}return{valueSrc:"value",value:e,valueType:l?.type,asyncListValues:g}}},Fu=function(e,t,r,a,i,o){var l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null;if(r.varKeys.includes(e)&&typeof t[0]=="string"){var u,s=Ei(a,t[0],l),c=Re(a,s);if(!c&&!((u=o.settings)!==null&&u!==void 0&&u.allowUnknownFields)){o.errors.push("No config for field ".concat(s));return}return{valueSrc:"field",value:s,valueType:c?.type}}},Xg=function(e,t,r,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,u=arguments.length>7?arguments[7]:void 0,s=arguments.length>8&&arguments[8]!==void 0?arguments[8]:null,c=Object.keys(t)[0],d=Object.values(t)[0],f=function(z,U){return Zg(z,U,a,i,o,u,s)||em(z,U,a,i,o,l,u,s)},p=u.errors.length,m,v,g,S,y=f(c,d);if(y&&(m=y.field,v=y.fieldSrc),e&&(S=!0,g=r[0],r=[]),c=="reduce"&&Array.isArray(d)&&d.length==3){var b=d,F=(0,we.A)(b,3),A=F[0],w=F[1],x=F[2];if(Tt(A)&&x==0&&Tt(w)&&Array.isArray(w["+"])&&w["+"][0]==1&&Tt(w["+"][1])&&w["+"][1].var=="accumulator")if(c=Object.keys(A)[0],d=Object.values(A)[0],c=="filter"){var k=d,D=(0,we.A)(k,2),I=D[0],_=D[1];if(Tt(I)){c=Object.keys(I)[0],d=Object.values(I)[0];var G=f(c,d);G&&(m=G.field,v=G.fieldSrc,g=_,S=!0)}}else{var M=f(c,d);M&&(m=M.field,v=M.fieldSrc,S=!0)}}var H=u.errors.length;if(!m&&H==p&&u.errors.push("Unknown LHS ".concat(JSON.stringify(t))),!!m)return{field:m,fieldSrc:v,having:g,isGroup:S,args:r}},Zg=function(e,t,r,a,i,o){var l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null;Array.isArray(t)||(t=[t]);var u=Fu(e,t,r,a,i,o,l);if(u)return{fieldSrc:"field",field:u.value}},em=function(e,t,r,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,l=arguments.length>6?arguments[6]:void 0,u=arguments.length>7&&arguments[7]!==void 0?arguments[7]:null,s=Tu(e,t,r,a,i,o,l,u);if(s)return{fieldSrc:"func",field:s.value}},Tu=function(e,t,r,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,l=arguments.length>6?arguments[6]:void 0,u=arguments.length>7&&arguments[7]!==void 0?arguments[7]:null;if(e){var s,c,d,f=e=="method";if(f){var p,m,v=(0,vu.A)(t);p=v[0],s=v[1],m=v.slice(2),c=[p].concat((0,Fe.A)(m))}else s=e,c=t;var g=(f?"#":"")+s,S=o?.type||o?.returnType,y=(r.funcs[g]||[]).filter(function(U){return o?qr(a,U).returnType==S:!0});if(y.length)d=y[0];else{var b=(0,ne.A)({},e,t),F=mu(ha(a)),A;try{for(F.s();!(A=F.n()).done;){var w=(0,we.A)(A.value,2),x=w[0],k=w[1];if(k.jsonLogicImport&&(!S||k.returnType==S)){var D=void 0;try{D=k.jsonLogicImport(b)}catch{}D&&(d=x,c=D)}}}catch(U){F.e(U)}finally{F.f()}}if(d&&d){var I=qr(a,d),_=Object.keys(I.args||{}),G=c.reduce(function(U,ee,Y){var oe=_[Y],ie=I.args[oe],se;return ie&&(se=ca(ee,r,a,["val"],l,!1,ie,null,u)),se!==void 0?Pn(Pn({},U),{},(0,ne.A)({},oe,se)):U},{});for(var M in I.args){var H=I.args[M],K=G[M];if(K===void 0){if(K=H?.defaultValue,K!==void 0){var z;K={value:K,valueSrc:(z=K)!==null&&z!==void 0&&z.func?"func":"value",valueType:H.type}}if(K===void 0){if(!(H!=null&&H.isOptional)){l.errors.push("No value for arg ".concat(M," of func ").concat(d));return}}else G[M]=K}}return{valueSrc:"func",value:{func:d,args:G},valueType:I.returnType}}}},Eu=function(e,t,r,a,i,o){var l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,u=arguments.length>7&&arguments[7]!==void 0?arguments[7]:!1,s=r.conjunctions[e],c=a.settings.fieldSeparator;if(s){var d="group",f=t.map(function(b){return ca(b,r,a,["rule","group"],o,!1,null,null,l)}).filter(function(b){return b!==void 0}).reduce(function(b,F){return Pn(Pn({},b),{},(0,ne.A)({},F.id,F))},{}),p=Object.values(f).map(function(b){var F,A;return(b==null||(F=b.properties)===null||F===void 0?void 0:F.fieldSrc)=="field"&&(b==null||(A=b.properties)===null||A===void 0?void 0:A.field)}).filter(function(b){var F;return b==null||(F=b.includes)===null||F===void 0?void 0:F.call(b,c)}),m=Object.fromEntries(Wg(p).map(function(b){var F=b.split(c),A=Object.fromEntries(F.slice(0,-1).map(function(w,x,k){return[].concat((0,Fe.A)(k.slice(0,x)),[w])}).map(function(w){return[w.join(c),Re(a,w)]}).filter(function(w){var x=(0,we.A)(w,2),k=x[0],D=x[1];return D?.type=="!group"}));return[b,Object.keys(A)]})),v={conjunction:s,not:i},g=mr(),S={},y={};return Object.entries(f).map(function(b){var F=(0,we.A)(b,2),A=F[0],w=F[1];if(w?.type=="group"||w?.type=="rule_group")S[A]=w;else{var x,k=w==null||(x=w.properties)===null||x===void 0?void 0:x.field,D=m[k]||[],I=D[D.length-1];if(!I)w&&(S[A]=w);else{var _=S,G=_r(l,a),M=_r(I,a),H=Ia(G,M.slice(0,G.length));H||(G=[]);var K=I.split(c).slice(G.length).map(function(z,U,ee){return[].concat((0,Fe.A)(G),(0,Fe.A)(ee.slice(0,U)),[z]).join(c)}).map(function(z){return{f:z,fc:Re(a,z)||{}}}).filter(function(z){var U=z.fc;return U.type!="!struct"});K.map(function(z,U){var ee=z.f,Y=z.fc,oe=y[ee];oe||(oe=mr(),y[ee]=oe,_[oe]={type:"rule_group",id:oe,children1:{},properties:{conjunction:s,not:!1,field:ee,fieldSrc:"field",mode:Y.mode}}),_=_[oe].children1}),_[A]=w}}}),{type:d,id:g,children1:S,properties:v}}},rm=function(e,t,r,a){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;if(e)return{type:"rule_group",id:mr(),children1:(0,ne.A)({},e.id,e),properties:{conjunction:i||Ba(a,r),not:o,field:t}}},Va=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return{type:"group",id:mr(),children1:(0,ne.A)({},e.id,e),properties:{conjunction:mn(t),not:r}}},tm=function(e,t,r,a,i,o,l){var u=Ou(l),s=nm(e,t,r,a,i,o,u);if(!s){l.errors.push(u.errors.join("; ")||"Unknown op ".concat(e,"/").concat(t));return}return s},nm=function(e,t,r,a,i,o,l){var u,s=zg.map(function(I){var _;return(_=o.operators[I])===null||_===void 0?void 0:_.jsonLogic2}).includes(e),c=o.settings.groupOperators.includes(e)&&!s,d=c?0:t-1;c?d=0:Qg.includes(e)&&d==1&&r[1]===null&&(t=1,d=0,r=[r[0]]);var f=e+"/"+d,p=i.operators[f];if(p){var m,v=[];if(Kg.includes(e)&&t==3)m=r[1],v=[r[0],r[2]];else{var g=r,S=(0,vu.A)(g);m=S[0],v=S.slice(1)}if(!Tt(m)){l.errors.push("Incorrect operands for ".concat(e,": ").concat(JSON.stringify(r)));return}var y=Xg(c,m,v,i,o,null,null,l,a);if(y){var b=y.field,F=y.fieldSrc,A=y.having,w=y.isGroup,x=y.args,k=Re(o,b);if(!k&&!((u=l.settings)!==null&&u!==void 0&&u.allowUnknownFields)){l.errors.push("No config for LHS ".concat(b));return}var D=p[0];if(p.length>1&&k&&k.operators){if(p=p.filter(function(I){return k.operators.includes(I)}),p.length==0){l.errors.push("No corresponding ops for LHS ".concat(b));return}D=p[0]}return{field:b,fieldSrc:F,fieldConfig:k,opKey:D,args:x,having:A}}}},am=function n(e,t,r,a,i,o){var l,u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,s=arguments.length>7&&arguments[7]!==void 0?arguments[7]:!1;if(e){var c=Object.values(a.conjunctions).map(function(ue){var be=ue.jsonLogicConj;return be}),d=t.length,f=tm(e,d,t,u,r,a,o);if(f){var p=f.field,m=f.fieldSrc,v=f.fieldConfig,g=f.opKey,S=f.args,y=f.having,b=Re(a,u),F=a.operators[g],A=a.operators[(l=F)===null||l===void 0?void 0:l.reversedOp],w=!1,x=!!A,k=v.type=="!group",D=b?.type=="!group",I=x&&(!!a.settings.reverseOperatorsForNot||w||k&&!y||!k&&D&&!s),_=i&&I||w,G,M,H=!1,K=!!a.settings.reverseOperatorsForNot;if(v?.type=="!group"&&y){G=Object.keys(y)[0],M=y[G],Array.isArray(M)||(M=[M]);for(var z=To(y,r,o);G=="!"&&!z;){var U=G=="!"&&M.length==1&&M[0]&&Tt(M[0])&&r.varKeys.includes(Object.keys(M[0])[0]);if(U)break;H=!H,y=y["!"],G=Object.keys(y)[0],M=y[G],K&&c.includes(G)&&M.length==1&&(y=y[G][0],G=Object.keys(y)[0],M=y[G]);var ee=To(y,r,o);z=ee||z}Array.isArray(M)||(M=[M]),z&&(M=[],M[0]=z.jlField,z.jlArgs.forEach(function(ue){return M.push(ue)}),G=z.newOp)}_&&(i=!i,g=F.reversedOp,F=a.operators[g]);var Y=Ir(a,p,g,null),oe=S.map(function(ue){return ca(ue,r,a,["val"],o,!1,v,Y,u)});if(!oe.filter(function(ue){return ue===void 0}).length){var ie,se=v?.type;if((se==="!group"||se==="!struct")&&(se=null),v?.type=="!group"&&y){if(r.conjunctions[G]!==void 0)ie=Eu(G,M,r,a,H,o,p,!0);else if(ie=n(G,M,r,a,H,o,p,!0),ie){var ce;ie.type==="rule_group"&&((ce=ie.properties)===null||ce===void 0?void 0:ce.field)!==p&&(ie=rm(ie,p,v,a)),Object.assign(ie.properties,{conjunction:Ba(a,v)})}if(!ie)return;ie.type="rule_group",Object.assign(ie.properties,{field:p,mode:v.mode,operator:g}),v.mode=="array"&&Object.assign(ie.properties,{value:oe.map(function(ue){return ue.value}),valueSrc:oe.map(function(ue){return ue.valueSrc}),valueType:oe.map(function(ue){return ue.valueType})}),i&&(ie=Va(ie,a,i))}else if(v?.type=="!group"&&!y)ie={type:"rule_group",id:mr(),children1:{},properties:{conjunction:Ba(a,v),not:!1,mode:v.mode,field:p,operator:g}},v.mode==="array"&&Object.assign(ie.properties,{value:oe.map(function(ue){return ue.value}),valueSrc:oe.map(function(ue){return ue.valueSrc}),valueType:oe.map(function(ue){return ue.valueType})}),i&&(ie=Va(ie,a,i));else{var ge=oe.map(function(ue){return ue.asyncListValues}).filter(function(ue){return ue!=null}),ye=ge.length?ge[0]:void 0;ie={type:"rule",id:mr(),properties:Pn({field:p,fieldSrc:m,operator:g,value:oe.map(function(ue){return ue.value}),valueSrc:oe.map(function(ue){return ue.valueSrc}),valueType:oe.map(function(ue){return ue.valueType})},ye?{asyncListValues:ye}:{})},(i||s)&&(ie=Va(ie,a,i))}return ie}}}},im=function(e,t,r,a,i,o){var l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null;if(e?.toLowerCase()==="if"){var u=om(t),s=u.map(function(f){var p=(0,we.A)(f,2),m=p[0],v=p[1];return[m?ca(m,r,a,["rule","group"],o,!1,null,null,l):null,um(a,o,r,v)]}),c=s.map(function(f){var p=(0,we.A)(f,2),m=p[0],v=p[1];return lm(m,v,a,o)}),d={type:"switch_group",id:mr(),children1:c,properties:{}};return d}},om=function(e){var t=[];function r(a){var i=(0,we.A)(a,3),o=i[0],l=i[1],u=i[2];t.push([o,l]);var s=Tt(u)?Object.keys(u)[0]:null;s?.toLowerCase()==="if"?r(u[s]):t.push([void 0,u])}return r(e),t},lm=function(e,t,r,a){var i;return e?(i=Pn({},e),i.type?(i.type!="group"&&(i=Va(i,r)),i.type="case_group"):(a.errors.push("Unexpected case: ".concat(JSON.stringify(i))),i=void 0)):i={id:mr(),type:"case_group",properties:{}},i&&(i.properties=Pn(Pn({},i.properties),t)),i},um=function(e,t,r,a){var i=Re(e,"!case_value");if(!i){t.errors.push("Missing caseValueField in settings");return}var o=i.mainWidget,l=e.widgets[o];if(!l){t.errors.push("No widget ".concat(o," for case value"));return}var u=ca(a,r,e,["val","case_val"],t,!1,i,o);if(u!=null){var s=u.value,c=u.valueSrc,d=u.valueType,f={value:[s],valueSrc:[c??"value"],valueType:[d??l?.type],field:"!case_value"};return f}},sm=h(21450),cm=h(61526),dm=h.n(cm),Nn=dm();Nn.trim=function(n){return n.charAt(0)=="'"?n.substring(1,n.length-1):n},Nn.escapeLike=function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=Nn.escape(n);return r=Nn.trim(r),r=r.replace(/[%_]/g,"\\$&"),r=(e?"%":"")+r+(t?"%":""),r="'"+r+"'",r};var Cu=function(e){var t="''",r=e?.type;return r=="date"?t="'0000-00-00'":r=="datetime"?t="'0000-00-00 00:00'":r=="time"?t="'00:00'":r=="number"&&(t="0"),t},Au=function(e){var t="",r=e?.type;return r=="number"&&(t=0),t},fm=function(e){return"'"+e.replace(/'/g,"''")+"'"},pm=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r,a,i=["int","float"];e.map(function(u){if(u!=null){if(typeof u=="string")a="String";else if(typeof u=="number")a=Number.isInteger(u)?"int":"float";else throw new Error("spelEscape: Can't use value ".concat(u," in array"));if(!r)r=a;else if(r!=a)if(i.includes(r)&&i.includes(a))r="float";else throw new Error("spelEscape: Can't use different types in array: found ".concat(r," and ").concat(a))}}),r||(r="String");var o;r=="float"?o=e.map(function(u){return da(u,!0)}):o=e.map(function(u){return da(u)});var l;return t?l="new ".concat(r,"[]{").concat(o.join(", "),"}"):l="{".concat(o.join(", "),"}"),l},Lu=function(e){return"".concat(e,".?[true]")},da=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(e==null)return"null";switch((0,Er.A)(e)){case"boolean":return e?"true":"false";case"number":return!Number.isFinite(e)||isNaN(e)?void 0:e+(!Number.isInteger(e)||t?"f":"");case"object":if(Array.isArray(e))return pm(e,r);throw new Error("spelEscape: Object is not supported");default:return fm(e)}},vm=function(e){return e&&Array.isArray(e)&&e.length?e.map(function(t){if(t.type=="const")return da(t.value);if(t.type=="property")return""+t.value;if(t.type=="variable")return"#"+t.value}).filter(function(t){return t!=null}).join(" + "):"null"},gm=function(e){if(e==null)return[void 0,[]];var t=[],r=e.valueType=="case_value"?e.value:e,a=Array.isArray(r)?r:[r],i=a.map(function(o){if(o.valueSrc==="value")return o.value===null?void 0:{type:"const",value:o.value};if(o.valueSrc==="field")return{type:o.isVariable?"variable":"property",value:o.value};t.push("Unsupported valueSrc ".concat(o.valueSrc," in concatenation"))}).filter(function(o){return o!=null});return[i,t]},wu=function(e){return e==null?"NULL":e.toString()},xu=function(e){return e==null||e?.[0]==="("&&e?.[e?.length-1]===")"?e:"("+e+")"};function ju(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=mm(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(s){throw s},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,l;return{s:function(){t=t.call(n)},n:function(){var s=t.next();return i=s.done,s},e:function(s){o=!0,l=s},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function mm(n,e){if(n){if(typeof n=="string")return Ru(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ru(n,e)}}function Ru(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function Iu(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Pu(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Iu(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Iu(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var Nu="${0}.compareTo(${1})",hm={datetime:!0,time:!0,date:!0},ym=function(e,t){return Du(e,t,!1)},Du=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a={errors:[]},i=kt(t,void 0,!1),o=Vu(e,i,a,null);return r?[o,a.errors]:(a.errors.length&&console.warn("Errors while exporting to SpEL:",a.errors),o)},Vu=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(e){var i=e.get("type");if(i==="group"||i==="rule_group")return Mu(e,t,r,a);if(i==="rule")return bm(e,t,r,a);if(i=="switch_group")return Sm(e,t,r,a);if(i=="case_group")return ku(e,t,r,a)}},ku=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=e.get("type");if(i!="case_group"){r.errors.push("Unexpected child of type ".concat(i," inside switch"));return}var o=e.get("properties")||new Se.Map,l=Eo(t,o,r,null,a,"!case_value"),u=(0,we.A)(l,3),s=u[0],c=u[1],d=u[2],f=Mu(e,t,r,a);return[f,s]},Sm=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=e.get("properties")||new Se.Map,o=e.get("children1");if(o){var l=o.map(function(g){return ku(g,t,r,null)}).filter(function(g){return typeof g<"u"}).valueSeq().toArray();if(l.length){if(l.length==1&&!l[0][0])return l[0][1];for(var u=[],s=0;s<l.length;s++)s!=l.length-1&&!l[s][0]?r.errors.push("No condition for case ".concat(s)):(u.push(l[s]),s==l.length-1&&l[s][0]&&u.push([void 0,null]));for(var c="",d="",f=0;f<u.length;f++){var p=(0,we.A)(u[f],2),m=p[0],v=p[1];v==null&&(v="null"),m==null&&(m="true"),f!=u.length-1?(c+="(".concat(m," ? ").concat(v," : "),d+=")"):c+="".concat(v)}return c+d}}},Mu=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=e.get("type"),o=e.get("properties")||new Se.Map,l=o.get("mode"),u=e.get("children1")||new Se.List,s=o.get("field"),c=o.get("conjunction");c||(c=mn(t));var d=t.conjunctions[c],f=o.get("not"),p=i==="rule_group",m=p&&l!="struct",v=m?s:a,g=Re(t,v)||{},S=g.isSpelArray,y=t.settings.fieldSeparator,b=o.get("operator");!b&&(!l||l=="some")&&(b="some");var F=Gu(t,b,s),A=F!=b,w=b&&vr(t,F,s)||null,x=p&&(!F||w.cardinality==0),k=Eo(t,o,r,F,a,null),D=(0,we.A)(k,3),I=D[0],_=D[1],G=D[2],M=u.map(function(ce){return Vu(ce,t,r,v)}).filter(function(ce){return typeof ce<"u"});if(m&&!x){if(I==null)return}else if(!M.size)return;var H=p,K=M.size?d.spelFormatConj.call(t.ctx,M,c,f,H):null,z;if(m){var U=Ao(r,t,s,a),ee=y||".",Y=ee+(S?"length":"size()"),oe="".concat(U).concat(Y),ie=K?"".concat(U,".?[").concat(K,"]").concat(Y):oe,se=x?oe:I;z=_u(r,t,o,ie,se,F,_,G,A)}else z=K;return z},Om=function(e,t,r){var a=t.spelOp;if(a){var i=a.includes("${0}"),o=hm[r],l=a,u,s=zr(t);return o?u=function(d,f,p,m,v,g,S,y){var b=Nu.replace(/\${(\w+)}/g,function(F,A){return A==0?d:s>1?p[A-1]:p});return"".concat(b," ").concat(l," 0")}:i?u=function(d,f,p,m,v,g,S,y){return a.replace(/\${(\w+)}/g,function(b,F){return F==0?d:s>1?p[F-1]:p})}:s==0?u=function(d,f,p,m,v,g,S,y){return"".concat(d," ").concat(l)}:s==1&&(u=function(d,f,p,m,v,g,S,y){return"".concat(d," ").concat(l," ").concat(p)}),u}},_u=function(e,t,r,a,i,o,l,u){var s=arguments.length>8&&arguments[8]!==void 0?arguments[8]:!1,c=r.get("field"),d=vr(t,o,c)||{},f=Re(t,c)||{},p=r.get("operatorOptions"),m=d.spelFormatOp||Om(o,d,u);if(!m){e.errors.push("Operator ".concat(o," is not supported"));return}var v=[a,o,i,l,u,Vt(d,oa),p,f],g;return g=m.call.apply(m,[t.ctx].concat(v)),s&&(g=t.settings.spelFormatReverse.call(t.ctx,g)),g===void 0&&e.errors.push("Operator ".concat(o," is not supported for value source ").concat(l)),g},Gu=function(e,t,r){if(t){var a=vr(e,t,r)||{},i=a.reversedOp,o=vr(e,i,r)||{},l=!1,u=a.spelOp||a.spelFormatOp,s=o.spelOp||o.spelFormatOp;if(!(!u&&!s)){if(!u&&s){l=!0;var c=[i,t];t=c[0],i=c[1];var d=[o,a];a=d[0],o=d[1]}return t}}},bm=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=e.get("properties")||new Se.Map,o=i.get("field"),l=i.get("fieldSrc"),u=i.get("operator");if(!(o==null||u==null)){var s=Gu(t,u,o);if(!s){r.errors.push("Operator ".concat(u," is not supported"));return}var c=s!=u,d=Eo(t,i,r,s,a,null),f=(0,we.A)(d,3),p=f[0],m=f[1],v=f[2];if(p!==void 0){var g=Fm(r,t,o,l,a);if(g!==void 0){var S=_u(r,t,i,g,p,s,m,v,c);return S}}}},Fm=function(e,t,r,a){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;return a==="func"?Bu(e,t,r,i):Ao(e,t,r,i)},Eo=function(e,t,r,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,l=t.get("field"),u=t.get("valueSrc"),s=t.get("valueType");(o=="!case_value"||s&&s.get(0)=="case_value")&&(l="!case_value");var c=Re(e,l)||{},d=vr(e,a,l)||{},f=zr(d),p=t.get("value"),m=t.get("asyncListValues"),v=[],g=[],S;if(p!=null){var y=p.map(function(F,A){var w=u?u.get(A):null,x=s?s.get(A):null,k=Jn(F,w,e),D=Ir(e,l,a,w),I=gt(e,l,a,D,w,{forExport:!0}),_=Co(r,e,k,w,x,I,c,a,d,i,m);return _!==void 0&&(v.push(w),g.push(x)),_}),b=y.filter(function(F){return F===void 0}).size>0;y.size<f||b||(S=f>1?y.toArray():f==1?y.first():null)}return[S,v.length>1?v:v[0],g.length>1?g:g[0]]},Co=function(e,t,r,a,i,o,l,u,s){var c=arguments.length>9&&arguments[9]!==void 0?arguments[9]:null,d=arguments.length>10?arguments[10]:void 0;if(r!==void 0){var f;if(a==="field")f=Ao(e,t,r,c);else if(a==="func")f=Bu(e,t,r,c);else if(typeof o?.spelFormatValue=="function"){var p=o.spelFormatValue,m=[r,Pu(Pu({},pn()(l,["fieldSettings","listValues"])),{},{asyncListValues:d}),Vt(o,zn)];if(u&&(m.push(u),m.push(s)),a=="field"){var v=Re(t,r)||{};m.push(v)}f=p.call.apply(p,[t.ctx].concat(m))}else f=da(r);return f}},Ao=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(r){var i=t.settings.fieldSeparator,o=Re(t,r)||{},l=_r(r,t),u=lc(r,t,a),s=t.settings.formatSpelField,c=wn(r,t,e,a),d=u.map(function(p){var m=(0,we.A)(p,3),v=m[0],g=m[1],S=m[2],y;S&&(S.type=="!struct"||S.type=="!group"&&S.mode=="struct"?y=g.isSpelMap?"map":"class":S.type=="!group"?y=g.isSpelItemMap?"[map]":"[class]":y="class");var b=g?.isSpelVariable;return{key:v,parent:y,isSpelVariable:b,fieldSeparator:i}}),f=s.call(t.ctx,c,a,l,d,o,t);return f}},Bu=function(e,t,r){var a,i,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,l=(a=r.get)===null||a===void 0?void 0:a.call(r,"func"),u=(i=r.get)===null||i===void 0?void 0:i.call(r,"args"),s=qr(t,l);if(!s){e.errors.push("Func ".concat(l," is not defined in config"));return}var c={},d=[],f=[];for(var p in s.args){var m,v,g=s.args[p],S=Re(t,g),y=g.defaultValue,b=g.isOptional,F=y!=null&&y.func?"func":"value",A=u?u.get(p):void 0,w=A?A.get("value"):void 0,x=A?A.get("valueSrc"):void 0;x!=="func"&&(m=w)!==null&&m!==void 0&&m.toJS&&(w=w.toJS());var k=A?A.get("asyncListValues"):void 0,D=(v=g.spelEscapeForFormat)!==null&&v!==void 0?v:!0,I=null,_=Ir(t,g,I,x),G=gt(t,g,I,_,x,{forExport:!0}),M=Co(e,t,w,x,g.type,G,S,null,null,o,k);if(w!=null&&M===void 0){x!="func"&&e.errors.push("Can't format value of arg ".concat(p," for func ").concat(l));return}var H=void 0;if(M===void 0&&!b&&y!=null){var K=Ir(t,g,I,F),z=gt(t,g,I,K,F,{forExport:!0});if(H=Co(e,t,y,F,g.type,z,S,null,null,o,k),H===void 0){F!="func"&&e.errors.push("Can't format default value of arg ".concat(p," for func ").concat(l));return}}var U=M??H;if(U!==void 0){var ee;if(d.length){var Y=ju(d),oe;try{for(Y.s();!(oe=Y.n()).done;){var ie=oe.value;c[ie]=void 0}}catch(Ce){Y.e(Ce)}finally{Y.f()}d=[]}c[p]=D?U:(ee=w)!==null&&ee!==void 0?ee:y}else b||f.push(p),d.push(p)}if(!f.length){var se;if(typeof s.spelFormatFunc=="function"){var ce=s.spelFormatFunc,ge=[c];se=ce.call.apply(ce,[t.ctx].concat(ge))}else if(s.spelFunc){se=s.spelFunc.replace(/\${(\w+)}/g,function(Ce,Me){var je;return(je=c[Me])!==null&&je!==void 0?je:Ce});var ye=Object.keys(s.args||{}).reverse().filter(function(Ce){return!!s.args[Ce].isOptional}),ue=ju(ye),be;try{for(ue.s();!(be=ue.n()).done;){var me=be.value;if(c[me]!=null)break;se=se.replace(new RegExp("(, )?\\${"+me+"}","g"),"")}}catch(Ce){ue.e(Ce)}finally{ue.f()}se=se.replace(/\${(\w+)}/g,"null")}else e.errors.push("Func ".concat(l," is not supported"));return se}};function vn(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=Tm(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(s){throw s},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,l;return{s:function(){t=t.call(n)},n:function(){var s=t.next();return i=s.done,s},e:function(s){o=!0,l=s},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function Tm(n,e){if(n){if(typeof n=="string")return Uu(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Uu(n,e)}}function Uu(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function $u(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Nr(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?$u(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):$u(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var Wu={number:"number",string:"text",boolean:"boolean",null:"null"},Qu={String:"text"},Em="multiselect",Cm=function(e){return["length"].includes(e)},Ku=function(e){return(0,Er.A)(e)=="object"&&e!==null&&!Array.isArray(e)},Am=function(e,t){return zu(e,t,!0)},zu=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a={errors:[]},i=kt(t,void 0,!1),o=xm(i),l,u,s=void 0;try{var c=sm.SpelExpressionEvaluator.compile(e);l=c._compiledExpression}catch(f){a.errors.push(f)}l&&(u=Lm(l,a),In.debug("convertedObj:",u,a),s=ka(u,o,i,a),s&&s.type!="group"&&s.type!="switch_group"&&(s=_a(s,i,u.not)),In.debug("jsTree:",s));var d=s?Fo(s):void 0;return r?[d,a.errors]:(a.errors.length&&console.warn("Errors while importing from SpEL:",a.errors),d)},Lm=function n(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,a=e.getType(),i=e.getChildren().map(function(M){return n(M,t,e)});if((a=="op-or"||a=="op-and")&&(i=i.reduce(function(M,H){var K=H.type==a&&!H.not,z=K?H.children:[H];return[].concat((0,Fe.A)(M),(0,Fe.A)(z))},[])),a=="op-not")return i.length!=1&&t.errors.push("Operator NOT should have 1 child, but got ".concat(i.length,"}")),Nr(Nr({},i[0]),{},{not:!i[0].not});if(a=="compound"){i=i.filter(function(M){var H=M.type=="selection"&&M.children.length==1&&M.children[0].type=="boolean"&&M.children[0].val==!0;return!H});var o=i.find(function(M){return M.type=="selection"});o&&o.children.length!=1&&t.errors.push("Selection should have 1 child, but got ".concat(o.children.length));var l=o?o.children[0]:null,u=i[i.length-1],s=u.type=="method"&&u.val.methodName=="size"||u.type=="!func"&&u.methodName=="size",c=u.type=="property"&&u.val=="length",d=i.filter(function(M){return M!==o&&M!==u}),f={type:"compound",children:d},p=(s||c)&&Hu(d)!=null;if(p)return{type:"!aggr",filter:l,source:f};if(i=i.filter(function(M){var H=M.type=="variable"&&M.val=="this",K=M.type=="variable"&&M.val=="root";return!(H||K)}),i=i.map(function(M){return M.type=="indexer"&&M.children.length==1?{type:"indexer",val:M.children[0].val,itype:M.children[0].type}:M}),u.type=="!func"){var m={},v=m;do{var g,S;Object.assign(v,u),i=i.filter(function(M){return M!==u}),u=i[i.length-1],((S=u)===null||S===void 0?void 0:S.type)=="!func"?(v.obj={},v=v.obj):i.length>1?v.obj={type:"compound",children:i}:v.obj=u}while(((g=u)===null||g===void 0?void 0:g.type)=="!func");return m}}var y;try{e.getRaw?y=e.getRaw():e.getValue.length==0&&(y=e.getValue())}catch(M){In.error("[spel2js] Error in getValue()",M)}if(a=="ternary"&&(y=wm(i)),(0,Er.A)(y)==="object"&&y!==null&&(y.methodName||y.functionName)&&(y.args=y.args.map(function(M){return n(M,t,e)})),a=="list"&&(y=y.map(function(M){return n(M,t,e)}),!r&&y.length==1))return y[0];if(a=="constructorref"){var b=i.find(function(M){return M.type=="qualifiedidentifier"}),F=b?.val;if(!F){t.errors.push("Can't find qualifiedidentifier in constructorref children: ".concat(JSON.stringify(i)));return}var A=i.filter(function(M){return M.type!="qualifiedidentifier"});return{type:"!new",cls:F,args:A}}if(a=="typeref"){var w=i.find(function(M){return M.type=="qualifiedidentifier"}),x=w?.val;if(!x){t.errors.push("Can't find qualifiedidentifier in typeref children: ".concat(JSON.stringify(i)));return}var k=i.filter(function(M){return M.type!="qualifiedidentifier"});return{type:"!type",cls:x}}if(a=="function"||a=="method"){var D=y,I=D.functionName,_=D.methodName,G=D.args;return{type:"!func",methodName:I||_,isVar:a=="function",args:G}}return{type:a,children:i,val:y}},wm=function(e){var t=[];function r(a){var i=(0,we.A)(a,3),o=i[0],l=i[1],u=i[2];t.push([o,l]),u?.type=="ternary"?r(u.children):t.push([void 0,u])}return r(e),t},xm=function(e){var t={},r=function(K){var z=e.operators[K];if(z.spelOps)z.spelOps.forEach(function(ee){var Y=ee;t[Y]||(t[Y]=[]),t[Y].push(K)});else if(z.spelOp){var U=z.spelOp;t[U]||(t[U]=[]),t[U].push(K)}else In.log("[spel] No spelOp for operator ".concat(K))};for(var a in e.operators)r(a);var i={};for(var o in e.conjunctions){var l=e.conjunctions[o],u=l.spelConj||o.toLowerCase();i[u]=o}var s={},c=vn(ha(e)),d;try{var f=function(){var K=(0,we.A)(d.value,2),z=K[0],U=K[1],ee=[],Y=U.spelFunc;if(typeof Y=="string"){var oe=Object.keys(U.args||{}).reverse().filter(function(ue){return!!U.args[ue].isOptional||U.args[ue].defaultValue!=null}),ie=Y.replace(/\${(\w+)}/g,function(ue,be){return"?"}),se=oe.reduce(function(ue,be){return[].concat((0,Fe.A)(ue),[[be].concat((0,Fe.A)(ue[ue.length-1]||[]))])},[]).map(function(ue){return Y.replace(/(?:, )?\${(\w+)}/g,function(be,me){return ue.includes(me)?"":be}).replace(/\${(\w+)}/g,function(be,me){return"?"})});ee=[ie].concat((0,Fe.A)(se))}var ce=vn(ee),ge;try{for(ce.s();!(ge=ce.n()).done;){var ye=ge.value;s[ye]||(s[ye]=[]),s[ye].push(z)}}catch(ue){ce.e(ue)}finally{ce.f()}};for(c.s();!(d=c.n()).done;)f()}catch(H){c.e(H)}finally{c.f()}var p={};for(var m in e.widgets){var v=e.widgets[m],g=v.spelImportFuncs,S=v.type;if(g){var y=vn(g),b;try{for(y.s();!(b=y.n()).done;){var F=b.value;if(typeof F=="string"){var A=F.replace(/\${(\w+)}/g,function(H,K){return"?"}),w=(0,Fe.A)(F.matchAll(/\${(\w+)}/g)).map(function(H){var K=(0,we.A)(H,2),z=K[0],U=K[1];return U});p[A]||(p[A]=[]),p[A].push({w:m,argsOrder:w})}}}catch(H){y.e(H)}finally{y.f()}}}var x={};for(var k in e.operators){var D=e.operators[k],I=D.spelOp;if(I!=null&&I.includes("${0}")){var _=I.replace(/\${(\w+)}/g,function(H,K){return"?"}),G=(0,Fe.A)(I.matchAll(/\${(\w+)}/g)).map(function(H){var K=(0,we.A)(H,2),z=K[0],U=K[1];return U});x[_]||(x[_]=[]),x[_].push({op:k,argsOrder:G})}}var M=Nu.replace(/\${(\w+)}/g,function(H,K){return"?"});return x[M]=[{op:"!compare",argsOrder:["0","1"]}],{operators:t,conjunctions:i,funcs:s,valueFuncs:p,opFuncs:x}},ka=function n(e,t,r,a){var i,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(e){e._groupField=(i=e._groupField)!==null&&i!==void 0?i:o?._groupField;var l,u=!0;if(e.type.indexOf("op-")===0||e.type==="matches")l=jm(e,t,r,a,o);else if(e.type=="!aggr"){var s,c=n(e.source,t,r,a,e);e._groupField=c?.value;var d=n(e.filter,t,r,a,e);((s=d)===null||s===void 0?void 0:s.type)=="rule"&&(d=_a(d,r,e.filter.not)),l={groupFilter:d,groupFieldValue:c},o||(l=void 0,a.errors.push("Unexpected !aggr in root"),u=!1)}else if(e.type=="ternary"){var f={};e.val.forEach(function(m){var v=(0,we.A)(m,2),g=v[0],S=v[1],y=Ju(g,S,t,r,a,e);y&&(f[y.id]=y)}),l={type:"switch_group",id:mr(),children1:f,properties:{}}}if(!l&&u&&(l=Ma(e,t,r,a,o)),l&&!l.type&&!o){var p=qu(e,t,r,a);p?l=p:(l=void 0,a.errors.push("Can't convert rule of type ".concat(e.type,", it looks like var/literal")))}return l}},jm=function n(e,t,r,a){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,o,l=e.type.startsWith("op-")?e.type.slice(3):e.type,u=(l=="minus"||l=="plus")&&e.children.length==1;if(u){var s=e.negative;return l=="minus"&&(s=!s),e.children[0].negative=s,ka(e.children[0],t,r,a,i)}var c=l=="and"&&e.children.length==2&&e.children[0].type=="op-ge"&&e.children[1].type=="op-le",d=l=="or"&&e.children.length==2&&e.children[0].type=="op-lt"&&e.children[1].type=="op-gt",f=c||d;if(f){var p=(0,we.A)(e.children[0].children,2),m=p[0],v=p[1],g=(0,we.A)(e.children[1].children,2),S=g[0],y=g[1],b=km(m,S,e,t,r,a,i);if(b){var F=v.val,A=y.val,w={type:"op-between",children:[m,v,y],not:d};return w._groupField=i?._groupField,n(w,t,r,a,i)}}var x=t.operators[l];l=="eq"&&e.children[1].type=="null"?x=["is_null"]:l=="ne"&&e.children[1].type=="null"?x=["is_not_null"]:l=="le"&&e.children[1].type=="string"&&e.children[1].val==""?x=["is_empty"]:l=="gt"&&e.children[1].type=="string"&&e.children[1].val==""?x=["is_not_empty"]:l=="between"&&(x=["between"]);var k=function(){var _e,He=e.children.map(function(or){return ka(or,t,r,a,e)});return He.length>=2&&((_e=He)===null||_e===void 0||(_e=_e[0])===null||_e===void 0?void 0:_e.type)=="!compare"&&(He=He[0].children),He};if(l=="and"||l=="or"){var D={},I=k();I.forEach(function(Ee){if(Ee){var _e=mr();Ee.id=_e,Ee.type!=null?D[_e]=Ee:a.errors.push("Bad item in AND/OR: ".concat(JSON.stringify(Ee)))}}),o={type:"group",id:mr(),children1:D,properties:{conjunction:t.conjunctions[l],not:e.not}}}else if(x){var _,G,M,H=k(),K=H[0],z=H.slice(1),U=K==null||(_=K.groupFieldValue)===null||_===void 0?void 0:_.value,ee=(G=z)===null||G===void 0?void 0:G[0],Y=x[0];if(x.length>1){var oe,ie,se=((oe=H[0])===null||oe===void 0?void 0:oe.valueType)||((ie=H[1])===null||ie===void 0?void 0:ie.valueType),ce=K?.value,ge=x.map(function(Ee){return{op:Ee,widget:Ir(r,ce,Ee)}});if(In.warn("[spel] Spel operator ".concat(l," can be mapped to ").concat(x,"."),"widgets:",ge,"vals:",H,"valueType=",se),l=="eq"||l=="ne"){var ye=ge.find(function(Ee){var _e=Ee.op,He=Ee.widget;return He&&He!="field"});ye&&(Y=ye.op)}}K!=null&&K.groupFieldValue&&(ee&&ee.groupFieldValue&&ee.groupFieldValue.valueSrc=="field"&&ee.groupFieldValue.value==U?(Y="all",z=[]):Y=="equal"&&ee.valueSrc=="value"&&ee.valueType=="number"&&ee.value==0?(Y="none",z=[]):Y=="greater"&&ee.valueSrc=="value"&&ee.valueType=="number"&&ee.value==0&&(Y="some",z=[]));var ue=r.operators[Y],be=r.operators[(M=ue)===null||M===void 0?void 0:M.reversedOp],me=e.not&&["between"].includes(Y),Ce=!!be,Me=Ce&&(!!r.settings.reverseOperatorsForNot||me),je=e.not&&Me||me;je&&(Y=ue.reversedOp,ue=r.operators[Y],e.not=!e.not);var Ie=!!e.not;if(e.not=!1,K)if(K.groupFieldValue)K.groupFieldValue.valueSrc!="field"&&a.errors.push("Expected group field ".concat(JSON.stringify(K))),o=Vm(K,Y,z,r,a);else{K.valueSrc!="field"&&K.valueSrc!="func"&&a.errors.push("Expected field/func at LHS, but got ".concat(JSON.stringify(K)));var Ve=K.value;o=Lo(r,a,Ve,Y,z,e)}Ie&&(o.type!=="group"?o=_a(o,r,!0):o.properties.not=!o.properties.not)}else i||(o=qu(e,t,r,a));return o},Hu=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=!1,i=e.map(function(o){if(o.type=="variable"||o.type=="property"||o.type=="indexer"&&o.itype=="string")return o.val;var l,u;a=!0,r&&(t==null||(l=t.errors)===null||l===void 0||(u=l.push)===null||u===void 0||u.call(l,"Unexpected item in field path compound: ".concat(JSON.stringify(o))))});return a?void 0:i},Ma=function n(e,t,r,a){var i,o,l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(e!=null){var u=r.settings.fieldSeparator;if(e._groupField=(i=e._groupField)!==null&&i!==void 0?i:l?._groupField,e.type=="variable"||e.type=="property"){var s=Ei(r,e.val,e._groupField),c=Re(r,s),d=e.type=="variable";return{valueSrc:"field",valueType:c?.type,isVariable:d,value:s}}else if(e.type=="compound"){var f=Hu(e.children,a);if(f){var p,m=Ei(r,f.join(u),e._groupField),v=Re(r,m),g=((p=e.children)===null||p===void 0||(p=p[0])===null||p===void 0?void 0:p.type)=="variable";return{valueSrc:"field",valueType:v?.type,isVariable:g,value:m}}}else if(Wu[e.type]){var S=e.val,y=Wu[e.type];return e.negative&&(S=-S),{valueSrc:"value",valueType:y,value:S}}else if(e.type=="!new"&&Qu[e.cls.at(-1)]){var b=e.args.map(function(G){return n(G,t,r,a,e)}),F=b?.[0],A=Qu[e.cls.at(-1)];return Nr(Nr({},F),{},{valueType:A})}else if(e.type=="list"){var w,x=e.val.map(function(G){return n(G,t,r,a,e)}),k=x.length?(w=x[0])===null||w===void 0?void 0:w.valueType:null,D=x.map(function(G){return G?.value}),I=Em;return{valueSrc:"value",valueType:I,value:D}}else if(e.type==="op-plus"&&l?.type==="ternary"&&((o=r.settings.caseValueField)===null||o===void 0?void 0:o.type)==="case_value")return Yu(e,t,r,a);var _=Pm(e,t,r,a,l);if(_!==void 0)return _;a.errors.push("Can't convert arg of type ".concat(e.type))}},Rm=function(e){var t=[{s:"",params:[],objs:[]}];return Im(e,t),t.map(function(r){var a=r.s,i=r.params;return{s:a,params:i}}).reverse().filter(function(r){var a=r.s;return a!==""&&a!=="?"})},Im=function n(e,t){var r=[],a="",i=e.type,o=e.methodName,l=e.val,u=e.obj,s=e.args,c=e.isVar,d=e.cls,f=e.children,p=f?.[f.length-1],m=t[t.length-1];if(i==="!func"){for(var v=u;v;){var g,S=n(Nr(Nr({},v),{},{obj:null}),[{}]),y=(0,we.A)(S,2),b=y[0],F=y[1];if(b!=="?"){var A={s:m.s,params:(0,Fe.A)(m.params),objs:(0,Fe.A)(m.objs)};m.objs.unshift("?"),m.params.unshift(v),t.push(A),m=t[t.length-1]}m.objs.unshift(b),(g=m.params).unshift.apply(g,(0,Fe.A)(F)),v=v.type==="!func"?v.obj:null}var w=vn(t),x;try{for(w.s();!(x=w.n()).done;){var k,D=x.value;r=[].concat((0,Fe.A)(D?.params||[]),(0,Fe.A)(s||[])),a="",D!=null&&(k=D.objs)!==null&&k!==void 0&&k.length&&(a+=D.objs.join(".")+"."),a+=(c?"#":"")+o,a+="("+(s||[]).map(function(I){return"?"}).join(", ")+")",D.s=a,D.params=r}}catch(I){w.e(I)}finally{w.f()}}else i==="!new"?(r=s||[],a="new ".concat(d.join("."),"(").concat(r.map(function(I){return"?"}).join(", "),")")):i==="!type"?a="T(".concat(d.join("."),")"):i==="compound"&&p.type==="property"&&Cm(p.val)?a=f.map(function(I){var _;if(I===p)return I.val;var G=n(Nr(Nr({},I),{},{obj:null}),[{}]),M=(0,we.A)(G,2),H=M[0],K=M[1];return(_=r).push.apply(_,(0,Fe.A)(K)),H}).join("."):(r=[e],a="?");return m&&(m.s=a,m.params=r),[a,r]},Pm=function(e,t,r,a){var i,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,l=function(z){return ka(z,t,r,a,e)},u=Rm(e),s=u==null||(i=u[0])===null||i===void 0?void 0:i.s;u.length&&In.debug("Signatures for ",e,":",s,u);var c=Nm(e,t,r,a,o,u,l);if(c!==void 0)return c;var d=Dm(e,t,r,a,o,u,l);if(d!==void 0)return d;var f,p,m,v=vn(u),g;try{var S=function(){var z=g.value,U=z.s,ee=z.params,Y=t.funcs[U];if(Y){f=Y[0],p=qr(r,f);var oe=p,ie=oe.spelFunc,se=ee.map(l),ce=(0,Fe.A)(ie.matchAll(/\${(\w+)}/g)).map(function(ge){var ye=(0,we.A)(ge,2),ue=ye[0],be=ye[1];return be});return m=Object.fromEntries(ce.map(function(ge,ye){return[ge,se[ye]]})),1}};for(v.s();!(g=v.n()).done&&!S(););}catch(K){v.e(K)}finally{v.f()}if(!f){var y=vn(ha(r)),b;try{for(y.s();!(b=y.n()).done;){var F=(0,we.A)(b.value,2),A=F[0],w=F[1];if(w.spelImport){var x=void 0;try{x=w.spelImport(e)}catch{}if(x){f=A,p=qr(r,f),m={};for(var k in x)m[k]=l(x[k])}}}}catch(K){y.e(K)}finally{y.f()}}if(f){var D={};for(var I in p.args){var _=p.args[I],G=m[I];if(G===void 0)if(G=_?.defaultValue,G===void 0){if(!(_!=null&&_.isOptional)){a.errors.push("No value for arg ".concat(I," of func ").concat(f));return}}else{var M;G={value:G,valueSrc:(M=G)!==null&&M!==void 0&&M.func?"func":"value",valueType:_.type}}G&&(D[I]=G)}return{valueSrc:"func",value:{func:f,args:D},valueType:p.returnType}}var H=e.methodName;H&&a.errors.push("Signature ".concat(s," - failed to convert"))},Nm=function(e,t,r,a,i,o,l){var u,s,c,d=[];for(var f in r.widgets){var p=r.widgets[f],m=p.spelImportFuncs;if(m)for(var v=0;v<m.length;v++){var g=m[v];if(Ku(g)){var S={};if(tu(g,e,S)){for(var y in S)S[y]=l(S[y]);d.push({s:"widgets.".concat(f,".spelImportFuncs[").concat(v,"]"),w:f,argsObj:S})}}}}var b=vn(o),F;try{for(b.s();!(F=b.n()).done;){var A=F.value,w=A.s,x=A.params,k=t.valueFuncs[w]||[],D=vn(k),I;try{var _=function(){var ue=I.value,be=ue.w,me=ue.argsOrder,Ce=x.map(l),Me=Object.fromEntries(me.map(function(je,Ie){return[je,Ce[Ie]]}));d.push({s:w,w:be,argsObj:Me})};for(D.s();!(I=D.n()).done;)_()}catch(ye){D.e(ye)}finally{D.f()}}}catch(ye){b.e(ye)}finally{b.f()}for(var G=0,M=d;G<M.length;G++){var H=M[G],K=H.s,z=H.w,U=H.argsObj,ee=r.widgets[z],Y=ee.spelImportValue,oe=ee.type;c=z,s=K,u=[];for(var ie in U)["value"].includes(U[ie].valueSrc)||u.push("".concat(ie," has unsupported value src ").concat(U[ie].valueSrc));var se=U.v.value;if(Y&&!u.length){var ce=Y.call(r.ctx,U.v,ee,U),ge=(0,we.A)(ce,2);se=ge[0],u=ge[1],u&&!Array.isArray(u)&&(u=[u])}if(!u.length)return{valueSrc:"value",valueType:oe,value:se}}c&&u.length&&a.errors.push("Signature ".concat(s," - looks like convertable to ").concat(c,", but: ").concat(u.join("; ")))},Dm=function(e,t,r,a,i,o,l){var u,s,c,d=vn(o),f;try{for(d.s();!(f=d.n()).done;){var p=f.value,m=p.s,v=p.params,g=t.opFuncs[m]||[],S=vn(g),y;try{var b=function(){var w,x=y.value,k=x.op,D=x.argsOrder,I=v.map(l);if(s=k,k==="!compare"){if(i.type.startsWith("op-")&&i.children.length==2&&i.children[1].type=="number"&&i.children[1].val===0)return{v:{type:"!compare",children:I}};u.push("Result of compareTo() should be compared to 0")}c=m,u=[];var _=r.operators[s],G=_.spelOp,M=_.valueTypes,H=Object.fromEntries(D.map(function(ee,Y){return[ee,I[Y]]})),K=H[0],z=Object.keys(H).filter(function(ee){return parseInt(ee)>0}).map(function(ee){return H[ee]}),U=(w=I.filter(function(ee){return!!ee}).find(function(ee){var Y=ee.valueSrc;return Y==="value"}))===null||w===void 0?void 0:w.valueType;if(M&&U&&!M.includes(U)&&u.push("Op supports types ".concat(M,", but got ").concat(U)),!u.length)return{v:Lo(r,a,K,s,z,e)}},F;for(S.s();!(y=S.n()).done;)if(F=b(),F)return F.v}catch(A){S.e(A)}finally{S.f()}}}catch(A){d.e(A)}finally{d.f()}s&&u.length&&a.errors.push("Signature ".concat(c," - looks like convertable to ").concat(s,", but: ").concat(u.join("; ")))},Lo=function(e,t,r,a,i,o){var l,u;if(!i.filter(function(_){return _===void 0}).length){var s=(l=r)!==null&&l!==void 0&&l.func?"func":"field";Ku(r)&&r.valueSrc&&(s=r.valueSrc,r=r.value);var c=Re(e,r);if(!c){t.errors.push("No config for field ".concat(r));return}var d=Re(e,o?._groupField),f=c.type=="!group",p=f&&c.mode=="array",m=d?.type=="!group",v=e.operators[a],g=e.operators[(u=v)===null||u===void 0?void 0:u.reversedOp],S=o?.not&&["between"].includes(a),y=!!g,b=y&&(!!e.settings.reverseOperatorsForNot||S||!f&&m),F=o?.not&&b||S;F&&(a=v.reversedOp,v=e.operators[a],o.not=!o.not);var A=!!(o!=null&&o.not),w=Ir(e,r,a),x=e.widgets[w||c.mainWidget],k=i.map(function(_){return _.asyncListValues}).filter(function(_){return _!=null}),D=k.length?k[0]:void 0,I={type:"rule",id:mr(),properties:Nr({field:r,fieldSrc:s,operator:a,value:i.map(function(_){return _.value}),valueSrc:i.map(function(_){return _.valueSrc}),valueType:i.map(function(_){return _.valueSrc=="value"&&(x?.type||c?.type)||_.valueType})},D?{asyncListValues:D}:{})};return A&&(I=_a(I,e,o.not)),I}},Vm=function(e,t,r,a,i){var o=e.groupFilter,l=e.groupFieldValue;if(l.valueSrc!="field")throw"Bad groupFieldValue: ".concat(JSON.stringify(l));var u=l.value,s=Lo(a,i,u,t,r);if(s){var c=Re(a,u),d=c?.mode,f;return o?.type==="group"?f=Nr(Nr({},o||{}),{},{type:"rule_group",properties:Nr(Nr(Nr({},s.properties),o?.properties||{}),{},{mode:d})}):o?f=Nr(Nr({},s||{}),{},{type:"rule_group",children1:[o],properties:Nr(Nr({},s.properties),{},{mode:d})}):f=Nr(Nr({},s||{}),{},{type:"rule_group",properties:Nr(Nr({},s.properties),{},{mode:d})}),f.id||(f.id=mr()),f}},km=function(e,t,r,a,i,o){if(e.type==t.type)if(e.type=="!aggr"){var l=[e.source,t.source].map(function(v){return Ma(v,a,i,o,r)}),u=(0,we.A)(l,2),s=u[0],c=u[1];return s.value==c.value}else{var d=[e,t].map(function(v){return Ma(v,a,i,o,r)}),f=(0,we.A)(d,2),p=f[0],m=f[1];return p.value==m.value}return!1},qu=function(e,t,r,a){var i={},o=null,l=Ju(o,e,t,r,a);l&&(i[l.id]=l);var u={type:"switch_group",id:mr(),children1:i,properties:{}};return u},Ju=function(e,t,r,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,l=Mm(a,i,r,t,o),u;return e?(u=ka(e,r,a,i,o),u&&u.type?(u.type!="group"&&(u=_a(u,a)),u.type="case_group"):(i.errors.push("Unexpected case: ".concat(JSON.stringify(u))),u=void 0)):u={id:mr(),type:"case_group",properties:{}},u&&(u.properties=Nr(Nr({},u.properties),l)),u},Yu=function(e,t,r,a){var i=[];function o(l){l.map(function(u){if(u.type==="op-plus")o(u.children);else{var s=Ma(u,t,r,a,e);s?i.push(s):a.errors.push("Can't convert ".concat(u.type," in concatenation"))}})}return o(e.children),{valueSrc:"value",valueType:"case_value",value:i}},Mm=function(e,t,r,a){var i,o,l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,u={},s,c,d,f=Re(e,"!case_value");if(a?.type==="op-plus"&&((i=e.settings.caseValueField)===null||i===void 0?void 0:i.type)==="case_value")c="case_value",s=Yu(a,r,e,t);else if(c=f?.mainWidget,d=e.widgets[c],s=Ma(a,r,e,t,l),s&&s.valueSrc==="value"){var p;s.valueType=((p=d)===null||p===void 0?void 0:p.type)||f?.type||s.valueType}var m=e.widgets[c];if(c==="case_value"){var v=m?.spelImportValue;if(v){var g=v.call(e.ctx,s),S=(0,we.A)(g,2),y=S[0],b=S[1];if(b.map(function(A){return t.errors.push(A)}),y!=null){var F;u={value:[y],valueSrc:["value"],valueType:[(F=m?.type)!==null&&F!==void 0?F:"case_value"],field:"!case_value"}}}}else s!=null&&((o=s)===null||o===void 0?void 0:o.value)!=null&&(u={value:[s.value],valueSrc:[s.valueSrc],valueType:[s.valueType],field:"!case_value"});return u},_a=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return{type:"group",id:mr(),children1:(0,ne.A)({},e.id,e),properties:{conjunction:mn(t),not:r||!1}}};function Xu(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function _m(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Xu(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Xu(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var Zu=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,a=e.settings.defaultField,i=(r?es(e,r):a)||t&&Mc(e,r)||null;return i!=null&&typeof i!="string"&&!la(i)&&(i=Da(i)),i},es=function(e){var t,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!r)return null;var a=(e==null||(t=e.settings)===null||t===void 0?void 0:t.fieldSeparator)||".",i=Re(e,r),o=i?.defaultField;return o&&(o=[].concat((0,Fe.A)(_r(r)),[o]).join(a)),o},wo=function(e){var t,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return r&&((t=e.settings.fieldSources)===null||t===void 0?void 0:t[0])||"field"},xo=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=Re(e,t),i=a?.operators||[],o=e.settings.defaultOperator;o&&!i.includes(o)&&(o=null);var l=a?.defaultOperator,u=a?.ownDefaultOperator,s=r?_o(e,t):null,c=u||o||l||s;return c},Ga=function(e,t,r){var a=t?vr(e,t,r):null;return a&&a.options?new Se.default.Map(a.options&&a.options.defaults||{}):null},gn=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,o=null,l=null,u=null,s=e.settings.showErrorMessage;if(r){var c,d,f;u=r==null||(c=r.properties)===null||c===void 0?void 0:c.fieldSrc,o=r==null||(d=r.properties)===null||d===void 0?void 0:d.field,l=r==null||(f=r.properties)===null||f===void 0?void 0:f.operator}else a?(o=Zu(e,i,t),o?u=la(o)?"func":"field":u=wo(e),l=xo(e,o,!0)):u=wo(e);var p=new Se.default.Map({fieldSrc:u,field:o,operator:l,value:new Se.default.List,valueSrc:new Se.default.List,operatorOptions:Ga(e,l,o)});if(s&&(p=p.set("valueError",new Se.default.List)),o&&l){var m=!1,v=Hn(e,e,p,o,l,"operator",m),g=v.newValue,S=v.newValueSrc,y=v.newValueType,b=v.newValueError,F=v.newFieldError;p=p.set("value",g).set("valueSrc",S).set("valueType",y),s&&(p=p.set("valueError",b).set("fieldError",F))}return p},Ba=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;t=Re(e,t);var r=t&&t.conjunctions||Object.keys(e.conjunctions);return r.length==1?r[0]:e.settings.defaultGroupConjunction||e.settings.defaultConjunction||r[0]},mn=function(e){return e.settings.defaultConjunction||Object.keys(e.conjunctions)[0]},Dn=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return new Se.default.Map({conjunction:Ba(e,t),not:!1})},rs=function(e,t){var r;return t&&t.type=="group"?Dn(e,t==null||(r=t.properties)===null||r===void 0?void 0:r.field):gn(e,null,t)},ts=function(e,t){return(0,ne.A)({},e,new Se.default.Map({type:"rule",id:e,properties:gn(t)}))},Gm=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return new Se.default.Map({type:"group",id:mr(),children1:new Se.default.OrderedMap(t?_m({},ts(mr(),e)):{}),properties:Dn(e)})},Bm=function(e){return si(e)?e:ns([e])},ns=function(e){return si(e)?e:new Se.default.List(e)},Um=function(){return new Se.default.Map};function as(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=$m(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(s){throw s},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,l;return{s:function(){t=t.call(n)},n:function(){var s=t.next();return i=s.done,s},e:function(s){o=!0,l=s},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function $m(n,e){if(n){if(typeof n=="string")return is(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return is(n,e)}}function is(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function os(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function ls(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?os(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):os(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var us=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i={errors:[],settings:{isForDisplay:r,isDebugMode:a}},o=kt(t,void 0,!1),l=ss(e,o,i,null);return i.errors.length&&console.warn("Errors while exporting to string:",i.errors),l},ss=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(e){var i=e.get("type"),o=e.get("children1");if(i==="group"||i==="rule_group")return Wm(e,t,r,a);if(i==="rule")return cs(e,t,r,a)}},Wm=function(e,t,r){var a,i,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,l=r.settings,u=l.isForDisplay,s=l.isDebugMode,c=e.get("type"),d=e.get("properties")||new Se.Map,f=d.get("mode"),p=e.get("children1")||new Se.List,m=c==="rule_group",v=m&&f=="array"?d.get("field"):null,g=c==="rule_group"?d.get("operator"):null,S=g?(a=(i=t.operators[g])===null||i===void 0?void 0:i.cardinality)!==null&&a!==void 0?a:1:void 0,y=m&&f==="array"&&S>=1,b=d.get("not"),F=p.map(function(M){return ss(M,t,r,v)}).filter(function(M){return typeof M<"u"});if(!(!y&&!F.size&&!s)){var A=d.get("conjunction");A||(A=mn(t));var w=t.conjunctions[A],x=F.size?w.formatConj.call(t.ctx,F,A,b,u):null,k;if(v){var D=cs(e,t,r,o,!0);if(D){var I,_=D.pop(),G=[x].concat((0,Fe.A)(D));k=(I=t.settings.formatAggr).call.apply(I,[t.ctx].concat((0,Fe.A)(G))),_&&(k=t.settings.formatReverse.call(t.ctx,k,null,null,null,null,u))}}else k=x;return s&&k==null&&(k="?"),k}},Qm=function(e,t,r,a,i){var o=r.settings,l=o.isForDisplay,u=o.isDebugMode,s=t.get("field"),c=t.get("valueSrc"),d=t.get("valueType"),f=Re(e,s)||{},p=a||t.get("operator"),m=vr(e,p,s)||{},v=zr(m),g=t.get("value"),S=t.get("asyncListValues"),y=[],b=[],F,A;if(g!=null){A=g.map(function(k,D){var I=c?c.get(D):null,_=d?d.get(D):null,G=u?k:Jn(k,I,e),M=Ir(e,s,p,I),H=gt(e,s,p,M,I,{forExport:!0}),K=jo(e,r,G,I,_,H,f,p,m,i,S);return K!==void 0&&(y.push(I),b.push(_)),K});var w=A.filter(function(k){return k===void 0}).size>0,x=!w&&A.size===v;x&&(F=v==1?A.first():A)}return u&&!F&&(F=v>1?new Se.List(Array.from({length:v}).map(function(k,D){var I,_;return(I=(_=A)===null||_===void 0?void 0:_.get(D))!==null&&I!==void 0?I:"?"})):"?"),[F,y.length>1?y:y[0],b.length>1?b:b[0]]},Km=function(e,t,r){var a=r.settings.isDebugMode,i=t?.labelForFormat||e,o=zr(t),l;return o==0?l=function(s,c,d,f,p,m,v,g){return"".concat(s," ").concat(i)}:o==1?l=function(s,c,d,f,p,m,v,g){return a&&c==="?"&&d==="?"?s&&s!=="?"?"".concat(s," ?"):"?":"".concat(s," ").concat(i," ").concat(d)}:o==2&&(l=function(s,c,d,f,p,m,v,g){var S,y,b=d==null||(S=d.first)===null||S===void 0?void 0:S.call(d),F=d==null||(y=d.get)===null||y===void 0?void 0:y.call(d,1);return"".concat(s," ").concat(i," ").concat(b," AND ").concat(F)}),l},cs=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,o=r.settings,l=o.isForDisplay,u=o.isDebugMode,s=e.get("properties")||new Se.Map,c=s.get("field"),d=s.get("fieldSrc"),f=s.get("operator"),p=s.get("operatorOptions");if(!((c==null||f==null)&&!u)){var m=Re(t,c)||{},v=vr(t,f,c)||{},g=v.reversedOp,S=vr(t,g,c)||{},y=!1,b=v.formatOp;if(!b&&g&&(b=S.formatOp,b)){y=!0;var F=[g,f];f=F[0],g=F[1];var A=[S,v];v=A[0],S=A[1]}if(u&&!f&&(f="?"),b||(b=Km(f,v,r)),!!b){var w=d==="func"?fs(t,r,c,a):ds(t,r,c,a);if(w!=null){var x=Qm(t,s,r,f,a),k=(0,we.A)(x,3),D=k[0],I=k[1],_=k[2];if(D!==void 0){var G=[w,f,D,I,_,Vt(v,oa),p,l,m,y];if(i)return G;var M,H=(M=b).call.apply(M,[t.ctx].concat(G));return y&&(H=t.settings.formatReverse.call(t.ctx,H,f,g,v,S,l)),H}}}}},jo=function(e,t,r,a,i,o,l,u,s){var c=arguments.length>9&&arguments[9]!==void 0?arguments[9]:null,d=arguments.length>10?arguments[10]:void 0,f=t.settings,p=f.isForDisplay,m=f.isDebugMode;if(r===void 0)return m?o?.jsType==="array"?[]:"?":void 0;var v;if(a=="field")v=ds(e,t,r,c);else if(a=="func")v=fs(e,t,r,c);else if(typeof o?.formatValue=="function"){var g=o.formatValue,S=[r,ls(ls({},pn()(l,["fieldSettings","listValues"])),{},{asyncListValues:d}),Vt(o,zn),p];if(u&&(S.push(u),S.push(s)),a=="field"){var y=Re(e,r)||{};S.push(y)}v=g.call.apply(g,[e.ctx].concat(S))}else v=r;return v},ds=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,o=t.settings,l=o.isForDisplay,u=o.isDebugMode,s=e.settings,c=s.fieldSeparator,d=s.fieldSeparatorDisplay,f=null;if(r){var p=Re(e,r)||{},m=_r(r,e),v=$a(r,e,i?a:null),g=v?v.join(d):null,S=p.label2||g,y=e.settings.formatField,b=wn(r,e,t,i?a:null,{useTableName:!0});f=y(b,m,S,p,e,l)}else u&&(f="?");return f},fs=function(e,t,r){var a,i,o,l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,u=t.settings,s=u.isForDisplay,c=u.isDebugMode,d=r==null||(a=r.get)===null||a===void 0?void 0:a.call(r,"func");if(!d)return c?"?()":void 0;var f=(i=r.get)===null||i===void 0?void 0:i.call(r,"args"),p=qr(e,d);if(!p&&!c){t.errors.push("Func ".concat(d," is not defined in config"));return}var m=_r(d,e),v=m[m.length-1],g=s&&p?.label||v,S={},y=[],b=[],F={},A=p?Object.keys(p.args||{}):(f==null||(o=f.keySeq)===null||o===void 0?void 0:o.call(f).toArray())||[],w=as(A),x;try{for(w.s();!(x=w.n()).done;){var k,D=x.value,I=p?.args[D],_=Re(e,I),G=I||{},M=G.defaultValue,H=G.isOptional,K=M!=null&&M.func?"func":"value",z=s&&I?.label||D,U=f?f.get(D):void 0,ee=U?U.get("value"):void 0,Y=U?U.get("valueSrc"):void 0;Y!=="func"&&(k=ee)!==null&&k!==void 0&&k.toJS&&(ee=ee.toJS());var oe=U?U.get("asyncListValues"):void 0,ie=jo(e,t,ee,Y,I?.type,_,I,null,null,l,oe);ee!=null&&ie===void 0&&Y!="func"&&t.errors.push("Can't format value of arg ".concat(D," for func ").concat(d));var se=void 0;if(ie===void 0&&!H&&M!=null&&(se=jo(e,t,M,K,I?.type,_,I,null,null,l,oe),se===void 0)){K!="func"&&t.errors.push("Can't format default value of arg ".concat(D," for func ").concat(d));return}var ce=ie??se;if(ce!==void 0){if(y.length){var ge=as(D),ye;try{for(ge.s();!(ye=ge.n()).done;){var ue=(0,we.A)(ye.value,2),be=ue[0],me=ue[1];S[be]=void 0}}catch(Ve){ge.e(Ve)}finally{ge.f()}y=[]}S[D]=ce,F[z]=ce}else H||b.push(D),y.push([D,z])}}catch(Ve){w.e(Ve)}finally{w.f()}if(!(b.length&&!c)){var Ce=null;if(typeof p?.formatFunc=="function"){var Me=p.formatFunc,je=[S,s];Ce=Me.call.apply(Me,[e.ctx].concat(je))}else{var Ie=Object.entries(s?F:S).map(function(Ve){var Ee=(0,we.A)(Ve,2),_e=Ee[0],He=Ee[1];return s?"".concat(_e,": ").concat(He):"".concat(He)}).join(", ");Ce="".concat(g,"(").concat(Ie,")")}return Ce}},ps="EMPTY_GROUP",vs="EMPTY_RULE_GROUP",gs="EMPTY_QUERY",ms="EMPTY_CASE",hs="NO_CONFIG_FOR_FIELD",ys="NO_CONFIG_FOR_OPERATOR",zm="FIXED_OPERATOR",Ss="NO_CONFIG_FOR_FUNCTION",Os="INVALID_VALUE",bs="INVALID_FUNC_ARG_VALUE",Fs="UNSUPPORTED_FIELD_TYPE",Ts="UNSUPPORTED_OPERATOR_FOR_FIELD",Es="INVALID_VALUE_SRC",Ro="INCOMPLETE_RULE",Cs="INCOMPLETE_LHS",As="INCOMPLETE_RHS",Io="BAD_MULTISELECT_VALUES",Ls="BAD_SELECT_VALUE",ws="INCORRECT_VALUE_TYPE",xs="INCORRECT_VALUE_JS_TYPE",js="VALUE_LENGTH_CONSTRAINT_FAIL",Po="VALUE_MIN_CONSTRAINT_FAIL",No="VALUE_MAX_CONSTRAINT_FAIL",Rs="NO_CONFIG_FOR_FIELD_VALUE",Is="CANT_COMPARE_FIELD_WITH_ITSELF",Ps="CANT_COMPARE_FIELD_WITH_FIELD",Ns="INCORRECT_FIELD_TYPE",Ds="UNSUPPORTED_FUNCTION_FOR_FIELD",Vs="REQUIRED_FUNCTION_ARG",ks="INCORRECT_FUNCTION_RETURN_TYPE",Ms="INVALID_RANGE",Ln="ITEM_POSITION",_s="ITEM_POSITION_ROOT",Gs="ITEM_POSITION_WITH_INDEX_PATH",Bs="ITEM_POSITION_IN_CASE",Do="range",Hm=h(72635),fa,qm=(fa={},(0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)(fa,ps,"Empty group"),vs,"No conditions for group field {{field}}"),gs,"Empty query"),ms,"Empty case"),hs,"No config for field {{field}}"),zm,"Fixed operator {{from}} to {{to}} for field {{field}}"),ys,"No config for operator {{operator}}"),Ss,"No config for function {{funcKey}}"),Os,"Invalid value"),bs,"Invalid value of arg {{argName}} for func {{funcName}}: {{argValidationError}}"),(0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)(fa,Fs,"Type of field {{field}} is not supported"),Ts,"Operator {{operator}} is not supported for field {{field}}"),Ro,"Incomplete rule"),Cs,"Incomplete LHS"),As,"Incomplete RHS"),Es,"Invalid value src {{valueSrcs, list}}"),Io+"_one","Value {{badValues, list}} is not in the list of allowed values"),Io+"_other","Values {{badValues, list}} are not in the list of allowed values"),Ls,"Value {{value}} is not in the list of allowed values"),ws,"Value should have type {{wType}}, but got value of type {{valueType}}"),(0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)(fa,xs,"Value should have JS type {{jsType}}, but got value of type {{valueTypeof}}"),js,"Value {{value}} should have max length {{fieldSettings.maxLength}} but got {{length}}"),Po,"Value {{value}} should be greater than or equal to {{fieldSettings.min}}"),Po+"_"+Do,"Value {{value}} should be from {{fieldSettings.min}} to {{fieldSettings.max}}"),No,"Value {{value}} should be less than or equal to {{fieldSettings.max}}"),No+"_"+Do,"Value {{value}} should be from {{fieldSettings.min}} to {{fieldSettings.max}}"),Rs,"No config for field {{field}}"),Is,"Can't compare field {{field}} with itself"),Ps,"Can't compare field {{leftField}} with {{rightField}}"),Ns,"Field {{field}} is of type {{type}}, but expected {{expected}}"),(0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)(fa,Ds,"Unsupported function {{funcKey}} for field {{field}}"),Vs,"Value of arg {{argName}} for func {{funcName}} is required"),ks,"Function {{funcKey}} should return value of type {{returnType}}, but got {{valueType}}"),Ms,"Invalid range"),_s,"Root"),Ln+"__rule","Leaf #{{globalLeafNo}}"),Ln+"__group","Group #{{globalGroupNo}}"),Ln+"__rule_group","Rule-group #{{globalNoByType}}"),Ln+"__case_group","Case #{{globalNoByType}}"),Ln+"__rule__deleted","Deleted leaf #{{globalLeafNo}}"),(0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)((0,ne.A)(fa,Ln+"__group__deleted","Deleted group #{{globalGroupNo}}"),Ln+"__rule_group__deleted","Deleted rule-group #{{globalNoByType}}"),Ln+"__case_group__deleted","Deleted case #{{globalNoByType}}"),Bs,"{{str}} in case #{{caseNo}}"),Gs,"{{str}} (index path: {{indexPath, list}})")),Us="raqbvalidation",Jm="".concat(Us,":"),mi=Hm.default.createInstance();mi.init({fallbackLng:"en"}),mi.addResources("en",Us,qm);var rn=function n(e,t){return e!=null&&e.str?e.str:e!=null&&e.key?n(e.key,e.args):t===null?e:mi.t(e.includes(":")?e:Jm+e,t)};const Ym=mi;function $s(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Rr(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?$s(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):$s(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var Ws=function(e){return(0,Er.A)(e)==="object"&&e!==null&&Array.isArray(e)?"array":(0,Er.A)(e)},Xm=function(e,t){return Ws(e)===t||t==="number"&&!isNaN(e)},Qs=function(e,t){return Ks(e,t).length===0},Ks=function(e,t){var r=t.settings.showErrorMessage,a=[];function i(o,l,u){var s,c,d=o.get("id"),f=o.get("children1"),p=o.getIn(["properties","valueError"]),m=o.getIn(["properties","fieldError"]),v=o.getIn(["properties","field"]),g=(s=v==null||(c=v.get)===null||c===void 0?void 0:c.call(v,"func"))!==null&&s!==void 0?s:v,S=p?.size>0&&p.filter(function(b){return b!=null}).size>0,y=S||!!m;y&&r&&a.push(g),f&&f.map(function(b,F){b&&i(b,l.concat(d),u+1)})}return e&&i(e,[],0),Array.from(new Set(a))},zs=function(e,t){var r=kt(t,void 0,!0),a={removeEmptyGroups:t.settings.removeEmptyGroupsOnLoad,removeIncompleteRules:t.settings.removeIncompleteRulesOnLoad,removeEmptyRules:t.settings.removeEmptyRulesOnLoad,forceFix:!1},i=Ua(e,null,r,r,a),o=i.fixedTree,l=i.allErrors,u=i.isSanitized;return u&&l.length&&console.warn("Tree check errors: ",l),o},Hs=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=kt(t,void 0,!0),i=Rr(Rr({},r),{},{removeEmptyGroups:!1,removeEmptyRules:!1,removeIncompleteRules:!1,forceFix:!1}),o=Ua(e,null,a,a,i),l=o.allErrors;return l},qs=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=kt(t,void 0,!0),i=Rr({removeEmptyGroups:!0,removeEmptyRules:!0,removeIncompleteRules:!0,forceFix:!1},r),o=Ua(e,null,a,a,i),l=o.fixedTree,u=o.fixedErrors,s=o.nonFixedErrors,c=o.allErrors;return{fixedTree:l,fixedErrors:u,nonFixedErrors:s,allErrors:c}},Js=function(e,t,r,a,i,o,l){i===void 0&&(i=r.settings.removeEmptyGroupsOnLoad),o===void 0&&(o=r.settings.removeEmptyRulesOnLoad),l===void 0&&(l=r.settings.removeIncompleteRulesOnLoad);var u={removeEmptyGroups:i,removeEmptyRules:o,removeIncompleteRules:l,forceFix:!1},s=Ua(e,t,r,a,u),c=s.fixedTree,d=s.allErrors,f=s.fixedErrors,p=s.nonFixedErrors,m=s.isSanitized;return m&&f.length&&console.warn("Fixed tree errors: ",f),c=en(c),c},Ua=function(e,t,r,a,i){if(!e)return{fixedTree:e,allErrors:[],fixedErrors:[],nonFixedErrors:[],isSanitized:!1};var o=i||{},l=o.removeEmptyGroups,u=o.removeEmptyRules,s=o.removeIncompleteRules,c=o.forceFix,d=o.translateErrors,f=d===void 0?!0:d,p=o.includeStringifiedItems,m=p===void 0?!0:p,v=o.stringifyFixedItems,g=v===void 0?!1:v,S=o.stringifyItemsUserFriendly,y=S===void 0?!0:S,b=o.includeItemsPositions,F=b===void 0?!0:b,A={config:r,oldConfig:a,removeEmptyGroups:l,removeEmptyRules:u,removeIncompleteRules:s,forceFix:c},w={errors:{}},x=Xs(e,[],null,w,A),k=w.sanitized,D=[],I,_;F&&(I=ho(x).items);for(var G in w.errors){var M=w.errors[G],H=M.path,K=M.errors;f&&(K=K.map(function(We){return Rr(Rr({},We),{},{str:rn(We)})}));var z={path:H,errors:K};if(m){var U=ua(g?x:e,H),ee=H.length===1;if(!ee&&U.get("type")!=="group"){var Y=!0,oe=y,ie=us(U,r,oe,Y);z.itemStr=ie}}if(F){var se=I[G],ce=!se;if(ce&&(_||(_=ho(e).items),se=_[G]),se){var ge=Rr(Rr({},se.position),{},{index:se.index,type:se.type,isDeleted:ce});z.itemPosition=ge;var ye=se.index?Ln+"__"+se.type+(ce?"__deleted":""):_s,ue=Rr({},ge);if(y){for(var be,me=0,Ce=["caseNo","globalLeafNo","globalGroupNo","globalNoByType"];me<Ce.length;me++){var Me=Ce[me];ue[Me]!=null&&(ue[Me]=ue[Me]+1)}ue.indexPath=(be=ge.indexPath)===null||be===void 0?void 0:be.map(function(We){return We+1})}z.itemPositionStr=rn(ye,ue),se.index&&(se.caseId&&se.type!=="case_group"&&(z.itemPositionStr=rn(Bs,Rr(Rr({},ue),{},{str:z.itemPositionStr}))),se.type!=="case_group"&&(z.itemPositionStr=rn(Gs,Rr(Rr({},ue),{},{str:z.itemPositionStr}))))}}D.push(z)}for(var je=[],Ie=[],Ve=0,Ee=D;Ve<Ee.length;Ve++){var _e=Ee[Ve],He=_e.errors.filter(function(We){return!!We.fixed}),or=_e.errors.filter(function(We){return!We.fixed&&We.key!=="EMPTY_QUERY"});He.length&&je.push(Rr(Rr({},_e),{},{errors:He})),or.length&&Ie.push(Rr(Rr({},_e),{},{errors:or}))}return{fixedTree:x,allErrors:D,fixedErrors:je,nonFixedErrors:Ie,isSanitized:k}};function Vn(n,e,t,r){var a=e.get("id");n.errors[a]||(n.errors[a]={path:[].concat((0,Fe.A)(t),[a]),errors:[]}),n.errors[a].errors.push(r)}function Ys(n,e){var t=e.get("id");n.errors[t]&&n.errors[t].errors.map(function(r){r.fixed=!0})}function Xs(n,e,t,r,a){var i=n?.get("type");return i==="group"||i==="rule_group"||i=="case_group"||i=="switch_group"?Zm(n,e,t,r,a):i==="rule"?Zs(n,e,t,r,a):n}function Zm(n,e,t,r,a){var i,o,l,u,s,c,d=a.removeEmptyGroups,f=a.removeIncompleteRules,p=a.forceFix,m=a.config,v=m.settings.showErrorMessage,g=!v||p,S=n.get("id"),y=n.get("children1"),b=!e.length,F=y,A=n.get("type"),w=n.get("properties"),x=w?.get("field"),k=w?.get("mode"),D=w==null||(i=w.get)===null||i===void 0?void 0:i.call(w,"operator"),I=A==="rule_group"&&k==="array",_=A==="case_group",G=_&&y==null,M=D?(o=(l=m.operators[D])===null||l===void 0?void 0:l.cardinality)!==null&&o!==void 0?o:1:void 0,H=_?!G:I?M==0:d,K=I||_;!S&&t&&(S=t,n=n.set("id",S),r.sanitized=!0),K&&(n=Zs(n,e,t,r,a));var z={errors:{}};y=(u=y)===null||u===void 0?void 0:u.map(function(ie,se){return Xs(ie,e.concat(S),se,z,a)});var U=(s=y)===null||s===void 0?void 0:s.filter(function(ie){return ie!=null});d&&(y=U);var ee=z.sanitized||F?.size!=((c=y)===null||c===void 0?void 0:c.size),Y=!(U!=null&&U.size),oe=d&&!b;return I&&x&&(oe=f),Y&&H&&(Vn(r,n,e,{key:b?gs:_?ms:I?vs:ps,args:{field:x},fixed:oe}),oe&&(Ys(r,n),n=void 0)),ee&&(r.sanitized=!0),ee&&n&&(n=n.set("children1",y)),r.errors=Rr(Rr({},r.errors),z?.errors||{}),n}function Zs(n,e,t,r,a){var i=a.removeIncompleteRules,o=a.removeEmptyRules,l=a.forceFix,u=a.config,s=a.oldConfig,c=u.settings.showErrorMessage,d=!c||l,f=n,p=n.get("id"),m=n.get("type"),v=m==="case_group",g=n.get("properties");if(!g)if(v)g=new Se.default.Map;else{var S={key:Ro,args:{},fixed:i||o};Vn(r,n,e,S);return}var y=g.get("field")||null;v&&(y="!case_value");var b=g.get("fieldSrc")||null,F=g.get("operator")||null,A=g.get("operatorOptions"),w=g.get("valueSrc"),x=g.get("value"),k=g.get("valueError"),D=g.get("fieldError"),I=function(){var Ee,_e;return{field:((Ee=y)===null||Ee===void 0||(_e=Ee.toJS)===null||_e===void 0?void 0:_e.call(Ee))||y,fieldSrc:b,operator:F,operatorOptions:A?A.toJS():{},valueSrc:w?w.toJS():null,value:x?x.toJS():null,valueError:k?k.toJS():null,fieldError:D||null}},_=I();!p&&t&&(p=t,n=n.set("id",p),r.sanitized=!0);var G=y?Re(u,y):null;y&&!G&&(Vn(r,n,e,{key:hs,args:{field:y},side:"lhs",fixed:i||o}),y=null),y==null&&!v&&(g=["operator","operatorOptions","valueSrc","value","valueError","fieldError","field"].reduce(function(Ve,Ee){return Ve.delete(Ee)},g),F=null),!b&&y&&!v&&(b=kc(y),g=g.set("fieldSrc",b)),(F==="range_between"||F==="range_not_between")&&(F=F==="range_between"?"between":"not_between",g=g.set("operator",F));var M=F?vr(u,F,y):null;F&&!M&&(Vn(r,n,e,{key:ys,args:{operator:F},side:"op",fixed:i||o}),F=null);var H=y?Si(u,y):[];y&&!v&&(H!=null&&H.length?F&&H.indexOf(F)==-1&&(F==="is_empty"||F==="is_not_empty"?(F=F==="is_empty"?"is_null":"is_not_null",g=g.set("operator",F)):(Vn(r,n,e,{key:Ts,args:{operator:F,field:y},side:"lhs",fixed:i||o}),F=null)):(Vn(r,n,e,{key:Fs,args:{field:y},side:"lhs",fixed:i||o}),F=null)),F==null&&!v&&(g=["operatorOptions","valueSrc","value","valueError"].reduce(function(Ve,Ee){return Ve.delete(Ee)},g)),A=g.get("operatorOptions"),!F||A&&!M.options?(A=null,g=g.delete("operatorOptions")):F&&!A&&M.options&&(A=Ga(u,F,y),g=g.set("operatorOptions",A)),w=g.get("valueSrc"),x=g.get("value");var K=!0,z=Hn(u,s,g,y,F,null,d,K),U=z.newValue,ee=z.newValueSrc,Y=z.newValueError,oe=z.validationErrors,ie=z.newFieldError,se=z.fixedField;x=U,w=ee,k=Y,D=ie,y=se,g=g.set("field",y),g=g.set("value",x),g=g.set("valueSrc",w),c?g=g.set("valueError",k).set("fieldError",D):g=g.delete("valueError").delete("fieldError");var ce=I(),ge=!ui(_,ce),ye=Wo(g.toObject(),u),ue=v?ye.parts.value:ye.score>=3;if(ge&&(r.sanitized=!0,n=n.set("properties",g)),oe?.map(function(Ve){return Vn(r,n,e,Ve)}),!ue&&!v){var be=ye.score?i:o,me={key:Ro,args:{}};if(!ye.parts.field)me.key=Cs,me.side="lhs";else if(!ye.parts.value){var Ce,Me,je,Ie;me.key=As,me.side="rhs",(Ce=ce.valueSrc)!==null&&Ce!==void 0&&Ce[0]&&((Me=ce.valueSrc)===null||Me===void 0?void 0:Me[0])!=((je=_.valueSrc)===null||je===void 0?void 0:je[0])&&((Ie=ce.value)===null||Ie===void 0?void 0:Ie[0])!=null&&(me.key=Es,me.args={valueSrcs:ce.valueSrc})}me.fixed=be,Vn(r,n,e,me),be&&(Ys(r,n),n=void 0)}return n}var pa=function(e,t,r,a,i,o,l,u){var s=arguments.length>8&&arguments[8]!==void 0?arguments[8]:!1,c=arguments.length>9&&arguments[9]!==void 0?arguments[9]:!1,d=arguments.length>10&&arguments[10]!==void 0?arguments[10]:!1,f=[],p=i;if(i!=null){var m,v,g,S;if(l==="field"){var y=th(t,r,i,l,o,u,e,a,s,c),b=(0,we.A)(y,2);p=b[0],f=b[1]}else if(l==="func"){var F=nh(t,r,i,l,o,u,e,a,s,c,d),A=(0,we.A)(F,2);p=A[0],f=A[1]}else if(l==="value"||!l){var w=rh(r,i,l,o,u,e,a,s,c),x=(0,we.A)(w,2);p=x[0],f=x[1]}var k=!((m=f)!==null&&m!==void 0&&m.find(function(ge){return!ge.fixed})),D=!!r&&!["field","func"].includes(l)&&(!((v=f)!==null&&v!==void 0&&v.length)||k);if(D){var I=Ir(e,r,a,l),_=a?vr(e,a,r):null,G=gt(e,r,a,I,l,{forExport:!0}),M=l==="field"?Re(e,i):null,H=G,K=G.validateValue;if(typeof K=="function"){var z=[p,H,a,_];l==="field"&&z.push(M);var U=K.call.apply(K,[e.ctx].concat(z));if((0,Er.A)(U)==="object"&&U!==null&&!Array.isArray(U)){var ee,Y;(ee=U.error)!==null&&ee!==void 0&&ee.key?Y=Rr({},U.error):Y={key:U.error,args:null},U.fixedValue!==void 0&&s&&(Y.fixed=!0,Y.fixedFrom=p,Y.fixedTo=U.fixedValue,p=U.fixedValue),f.push(Y)}else typeof U=="boolean"?U==!1&&f.push({key:Os,args:{}}):typeof U=="string"&&f.push({key:U,args:null})}}if(k=!((g=f)!==null&&g!==void 0&&g.find(function(ge){return!ge.fixed})),(S=f)!==null&&S!==void 0&&S.length&&!k&&s){var oe=Re(e,r),ie=oe?.fieldSettings,se=ie?.defaultValue;if(se!==void 0){var ce=f[f.length-1];ce.fixed=!0,ce.fixedFrom=p,ce.fixedTo=se,p=se,f.map(function(ge){ge.fixed=!0})}}}return[p,f]},eh=function(e,t,r,a,i){var o=Se.default.List.isList(e)?e.toJS():e instanceof Array?(0,Fe.A)(e):void 0,l=e,u=[];if(o){var s=o.reduce(function(g,S){var y=(0,we.A)(g,2),b=y[0],F=y[1],A=Na(t,S);return A==null?[b,[].concat((0,Fe.A)(F),[S])]:[[].concat((0,Fe.A)(b),[A.value]),F]},[[],[]]),c=(0,we.A)(s,2),d=c[0],f=c[1],p=f.length>0;if(r=r||i===!0,l=r&&p?d:e,f.length){var m=r&&p;u.push({key:Io,args:{badValues:f,count:f.length},fixed:m,fixedFrom:m?o:void 0,fixedTo:m?l:void 0})}return[l,u]}else{var v=Na(t,e);return v==null?(l=r?null:e,u.push({key:Ls,args:{value:e},fixed:r,fixedFrom:r?e:void 0,fixedTo:r?l:void 0})):l=v.value,[l,u]}},rh=function(e,t,r,a,i,o){var l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,u=arguments.length>7&&arguments[7]!==void 0?arguments[7]:!1,s=arguments.length>8&&arguments[8]!==void 0?arguments[8]:!1,c=[],d=t;if(e){var f=Re(o,e),p=Ir(o,e,l,r),m=o.widgets[p],v=m?.type,g=m?.jsType,S=f?.fieldSettings,y=S?.treeValues||S?.listValues,b=!!(S!=null&&S.asyncFetch),F=y||b;if(a&&v&&a!=v)return c.push({key:ws,args:{wType:v,valueType:a}}),[t,c];if(g&&!Xm(t,g)&&!F)return c.push({key:xs,args:{jsType:g,valueTypeof:Ws(t)}}),[t,c];if(S){var A=i||y;if(A&&!S.allowCustomValues&&p!=="case_value"){var w=eh(t,A,u,s,o.settings.removeInvalidMultiSelectValuesOnLoad),x=(0,we.A)(w,2);d=x[0],c=x[1]}S.maxLength>0&&t!=null&&String(t).length>S.maxLength&&(d=u?String(t).substring(0,S.maxLength):t,c.push({key:js,args:{value:t,length:String(t).length,fieldSettings:S},fixed:u,fixedFrom:u?t:void 0,fixedTo:u?d:void 0}));var k=S.min!=null&&S.max!=null?Do:void 0;S.min!=null&&t<S.min&&(d=u?S.min:t,c.push({key:Po,args:{value:t,fieldSettings:S,context:k},fixed:u,fixedFrom:u?t:void 0,fixedTo:u?d:void 0})),S.max!=null&&t>S.max&&(d=u?S.max:t,c.push({key:No,args:{value:t,fieldSettings:S,context:k},fixed:u,fixedFrom:u?t:void 0,fixedTo:u?d:void 0}))}}return[d,c]},th=function(e,t,r,a,i,o,l){var u=arguments.length>7&&arguments[7]!==void 0?arguments[7]:null,s=arguments.length>8&&arguments[8]!==void 0?arguments[8]:!1,c=arguments.length>9&&arguments[9]!==void 0?arguments[9]:!1,d=[],f=l.settings,p=f.fieldSeparator,m=f.canCompareFieldWithField,v=(0,Er.A)(t)=="object"&&t?._isFuncArg,g=Array.isArray(e)?e.join(p):e,S=Re(l,e),y=Array.isArray(r)?r.join(p):r,b=Re(l,r);if(!b)return d.push({key:Rs,args:{field:y}}),[r,d];if(e&&y===g&&!v)return d.push({key:Is,args:{field:g}}),[r,d];if(i&&i!=b.type)return d.push({key:Ns,args:{field:y,type:b.type,expected:i}}),[r,d];if(e&&!v&&m){var F=m(g,S,y,b,u);if(!F)return d.push({key:Ps,args:{leftField:g,rightField:y}}),[r,d]}return[r]},nh=function(e,t,r,a,i,o,l){var u,s,c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:null,d=arguments.length>8&&arguments[8]!==void 0?arguments[8]:!1,f=arguments.length>9&&arguments[9]!==void 0?arguments[9]:!1,p=arguments.length>10&&arguments[10]!==void 0?arguments[10]:!1,m=r,v=[];if(!r)return[r];var g=(u=r.get)===null||u===void 0?void 0:u.call(r,"func");if(!g)return[r];var S=Re(l,t);if(S!=null&&S.funcs&&!S.funcs.includes(g))return v.push({key:Ds,args:{funcKey:g,field:t}}),[r,v];var y=qr(l,g);if(!y)return v.push({key:Ss,args:{funcKey:g}}),[r,v];var b=(s=y.label)!==null&&s!==void 0?s:g;if(i&&y.returnType!=i)return v.push({key:ks,args:{funcKey:g,funcName:b,returnType:y.returnType,valueType:i}}),[r,v];d=d||p;for(var F in y.args){var A,w=y.args[F],x=m.get("args"),k=x?x.get(F):void 0,D=Re(l,w),I=(A=D?.label)!==null&&A!==void 0?A:F,_=k?k.get("value"):void 0,G=k?k.get("valueSrc"):void 0;if(_!==void 0){var M=pa(l,e,D,c,_,w.type,G,o,d,f,p),H=(0,we.A)(M,2),K=H[0],z=H[1],U=!(z!=null&&z.length),ee=d&&K!==_,Y=d&&!U&&!ee&&(f||p);if(ee&&(m=m.setIn(["args",F,"value"],K)),Y&&(m=m.deleteIn(["args",F]),m=hi(l,m,y,F)),!U){var oe,ie,se=(oe=(ie=z.find(function(me){return!me.fixed&&!me.ignore}))!==null&&ie!==void 0?ie:z.find(function(me){return!me.fixed}))!==null&&oe!==void 0?oe:z[0],ce=ee||Y,ge=z.filter(function(me){return!me.ignore}).length===0;if(se){var ye=rn(se);v.push({key:bs,args:{funcKey:g,funcName:b,argKey:F,argName:I,argValidationError:ye,argErrors:z},ignore:ge,fixed:ce,fixedFrom:ce?_:void 0,fixedTo:ce?ee?K:w.defaultValue:void 0})}}}else if(!w.isOptional&&(f||p)){var ue=d&&w.defaultValue!==void 0&&(f||p),be=f;be&&v.push({key:Vs,args:{funcKey:g,funcName:b,argKey:F,argName:I},fixed:ue,fixedTo:ue?w.defaultValue:void 0,ignore:!ue}),ue&&(m=m.deleteIn(["args",F]),m=hi(l,m,y,F))}}return[m,v]},Vo=function(e,t,r,a,i){var o=vr(e,r,t),l=r?zr(o):null,u=i.toJS?i.toJS():i,s=a.toJS?a.toJS():a,c=u.filter(function(S){return S=="value"||S==null}).length==l,d;if(o!=null&&o.validateValues&&c){var f=u[0],p=Ir(e,t,r,f),m=gt(e,t,r,p,f),v=m!=null&&m.toJS?s.map(function(S){var y=m.toJS.call(e.ctx,S,m);return y instanceof Date&&(y=y.getTime()),y}):s,g=o.validateValues(v);typeof g=="boolean"&&g==!1&&(d={key:Ms,args:{jsValues:v,values:s}})}return d},Hn=function(e){var t,r,a,i,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0,u=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,d=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!1,f=arguments.length>7&&arguments[7]!==void 0?arguments[7]:!1,p=arguments.length>8&&arguments[8]!==void 0?arguments[8]:!1;o||(o=e);var m=e.settings,v=m.keepInputOnChangeFieldSrc,g=m.convertableWidgets,S=m.clearValueOnChangeField,y=m.clearValueOnChangeOp,b=u=="!case_value",F=l.get("field");!F&&b&&(F=u);var A=l.get("fieldType"),w=l.get("fieldSrc"),x=l.get("operator"),k=l.get("value"),D=l.get("valueSrc",new Se.default.List),I=l.get("valueType",new Se.default.List),_=l.get("valueError",new Se.default.List),G=l.get("asyncListValues"),M=b,H=vr(o,x),K=vr(e,s,u),z=b?1:x?zr(H):null,U=b?1:s?zr(K):null,ee=Re(o,F),Y=Re(e,u),oe=!F&&A&&v,ie=ee?.type||A,se=Y?.type||!u&&oe&&ie,ce=ee?.listValuesType,ge=Y?.listValuesType,ye=((t=F)===null||t===void 0||(r=t.get)===null||r===void 0?void 0:r.call(t,"func"))||F,ue=((a=u)===null||a===void 0||(i=a.get)===null||i===void 0?void 0:i.call(a,"func"))||u,be=ue!=ye,me=[],Ce=(F||oe)&&(x&&s||M)&&k!=null;(!(ie&&se&&ie==se)||c==="field"&&be&&S||c==="operator"&&y)&&(Ce=!1),be&&yi.includes(se)&&(ge&&ge===ce||(Ce=!1)),!M&&(!(k!=null&&k.size)&&U||k!=null&&k.size&&!U)&&(Ce=!1);var Me;if(w==="func"&&u){var je=pa(e,null,null,s,u,se,w,G,d,f,p),Ie=(0,we.A)(je,2),Ve=Ie[0],Ee=Ie[1],_e=!(Ee!=null&&Ee.length),He=Ve!==u,or=!_e&&He&&!Ee.find(function(yt){return!yt.fixed}),We=d&&!_e&&!or&&!!c&&u!==F,Gr=!1;if(Gr?u=null:We?u=F:He&&(u=Ve),!_e){var sr=!_e&&!or&&!Gr&&!We,xr=Ee.find(function(yt){return!yt.fixed&&!yt.ignore});sr&&xr&&(Me=rn(xr)),Ee.map(function(yt){return me.push(Rr(Rr({side:"lhs"},yt),{},{fixed:yt.fixed||We||Gr}))})}}for(var lr=0;lr<U;lr++){var ct=D.get(lr)||null,Lt=Ir(o,F,x,ct),dt=Ir(e,u,s,ct),wt=ct==="value"?Lt:Ir(o,F,x,"value"),cr=ct==="value"?dt:Ir(e,u,s,"value"),Pt=cr==wt||(g[wt]||[]).includes(cr)||!wt&&oe;Pt||(Ce=!1)}x!=s&&[x,s].includes("proximity")&&(Ce=!1);var _t=D.first(),Xr=gt(e,u,s,null,_t),ft=uc(e,u,s,null);!u&&oe&&(ft=Object.keys(e.settings.valueSourcesInfo));var dr=ft[0],nt;U===1&&Xr&&Xr.type!==void 0?nt=Xr.type:U===1&&Y&&Y.type!==void 0&&(nt=Y.type==="!group"?"number":Y.type);var et=Ce&&c==="operator"&&z===1&&U===2,Qr=[],mt=[],_n=[],ht=Array.from({length:U},function(){return null});if(Ce)for(var Kr=function(Pr){var Or=k.get(Pr),Gt=I.get(Pr)||null,Rn=D.get(Pr)||null;et&&Pr===1&&(Or=Qr[0]!==void 0?Qr[0]:k.get(0),Qr[Pr]=Or,Gt=I.get(0)||null,Rn=D.get(0)||null);var vE=Rn?ft.find(function(Yt){return Yt==Rn})!==void 0:!0,gE=pa(e,u,u,s,Or,Gt,Rn,G,d,f,p),_v=(0,we.A)(gE,2),Gv=_v[0],jt=_v[1],ei=!(jt!=null&&jt.length),zi=Gv!==Or,mE=!ei&&zi&&!(jt!=null&&jt.find(function(Yt){return!Yt.fixed})),hE=!(jt!=null&&jt.find(function(Yt){return!Yt.fixed&&!Yt.ignore})),Bv=!vE||d&&!ei&&!mE&&(!hE||be);ei||jt?.map(function(Yt){return me.push(Rr(Rr({side:"rhs",delta:Pr},Yt),{},{fixed:Yt.fixed||Bv}))}),Bv&&(Qr[Pr]=null,Pr===0&&delete Qr[1]);var yE=!ei&&!zi,Uv=jt?.find(function(Yt){return!Yt.fixed&&!Yt.ignore});yE&&Uv&&(ht[Pr]=rn(Uv)),zi&&(Qr[Pr]=Gv),et&&Pr===0&&!ei&&!zi&&(et=!1),et&&Pr===0&&["func","field"].includes(Rn)&&(et=!1)},Ue=0;Ue<U;Ue++)Kr(Ue);if(!Ce){for(var qe=0;qe<U;qe++)if(U===1){var ir,gr=au([Y?.defaultValue,Y==null||(ir=Y.fieldSettings)===null||ir===void 0?void 0:ir.defaultValue,Xr?.defaultValue]);Qr[qe]=gr,gr!=null&&gr.func&&(mt[qe]="func")}}for(var Cr=0;Cr<U;Cr++){var kr=Ce&&D.get(Cr)||null,Dr=Ce&&I.get(Cr)||null;if(Ce&&et&&Cr===1){var Nt,Br;kr=(Nt=mt[Cr])!==null&&Nt!==void 0?Nt:D.get(0),Dr=(Br=_n[Cr])!==null&&Br!==void 0?Br:I.get(0),mt[Cr]=kr,_n[Cr]=Dr}var Gn=ft.includes(kr);Gn||(mt[Cr]=dr),Dr||(_n[Cr]=nt)}var at=k;(Qr.length>0||!Ce)&&(at=new Se.default.List(Array.from({length:U},function(yt,Pr){return Qr[Pr]!==void 0?Qr[Pr]:Ce?k.get(Pr):void 0})));var an=D;(mt.length>0||!Ce)&&(an=new Se.default.List(Array.from({length:U},function(yt,Pr){var Or;return(Or=mt[Pr])!==null&&Or!==void 0?Or:Ce&&D.get(Pr)||null})));var jn=I;(_n.length>0||!Ce)&&(jn=new Se.default.List(Array.from({length:U},function(yt,Pr){var Or;return(Or=_n[Pr])!==null&&Or!==void 0?Or:Ce&&I.get(Pr)||null})));var Ht=Vo(e,u,s,at,an);if(Ht){var on=rn(Ht),qt=d&&U>=2,Jt=at;qt&&(Qr[1]=at.get(0),at=at.set(1,Qr[1]),ht[1]=ht[0]);var Za=!qt;Za&&ht.push(on),me.push(Rr(Rr({side:"rhs",delta:-1},Ht),{},{fixed:qt,fixedFrom:qt?[Jt.get(0),Jt.get(1)]:void 0,fixedTo:qt?[at.get(0),at.get(1)]:void 0}))}var xt=_,Ki=_?.size!==ht.length||ht.filter(function(yt,Pr){return yt!=_.get(Pr)}).length>0;return Ki&&(xt=new Se.default.List(ht)),{canReuseValue:Ce,newValue:at,newValueSrc:an,newValueType:jn,operatorCardinality:U,fixedField:u,newValueError:xt,newFieldError:Me,validationErrors:me}},ko=function(e){return(0,Er.A)(e)=="object"&&e!==null&&!Array.isArray(e)},ec=function(e,t){if(e){var r=e.get("func"),a=r&&qr(t,r);if(a){var i=e,o=!1;for(var l in a.args){var u=a.args[l],s=u.valueSources,c=u.isOptional,d=u.defaultValue,f=qn(t,s,u),p=i.get("args"),m=f.length==1?f[0]:void 0,v=p?p.get(l):void 0,g=v?v.get("value"):void 0,S=(v?v.get("valueSrc"):void 0)||m;if(g!==void 0){var y=Jn(g,S,t);if(y===void 0||(y!==g&&(i=i.setIn(["args",l,"value"],y)),o))return}else if(d!==void 0&&!ko(d))i=i.setIn(["args",l,"value"],tc(u)),i=i.setIn(["args",l,"valueSrc"],"value");else if(c)o=!0;else return}return i}}},rc=function(e,t,r,a){var i=r.settings.fieldSeparator;e=e||new Se.default.Map,Array.isArray(t)&&(t=t.join(i));var o=e.get("func"),l=e.get("args");e=e.set("func",t);var u=t&&qr(r,t),s=t&&Yo(r,t),c=o&&Yo(r,o),d=ac(c,s,l,r,a);if(d.length){var f=Object.keys(s.args),p=f.filter(function(m){return!d.includes(m)});e=p.reduce(function(m,v){return m.deleteIn(["args",v])},e)}else e=e.set("args",new Se.default.Map);return e=ah(r,e,u),e},ah=function(e,t,r){if(r)for(var a in r.args)t=hi(e,t,r,a);return t},hi=function(e,t,r,a){var i=r.args[a],o=i.valueSources,l=i.defaultValue,u=qn(e,o,i),s=u.length?u[0]:void 0,c=l?ko(l)&&l.func?"func":"value":void 0,d=c||s,f=t.getIn(["args",a]);return f||(l!==void 0&&(t=t.setIn(["args",a,"value"],tc(i))),d&&(t=t.setIn(["args",a,"valueSrc"],d))),t},tc=function(e){var t=e.defaultValue;return ko(t)&&!Se.default.Map.isMap(t)&&t.func?Se.default.fromJS(t,function(r,a){return Se.default.Iterable.isIndexed(a)?a.toList():a.toOrderedMap()}):t},Mo=function(e,t,r,a,i){if(e&&e.get("func")){e=e.setIn(["args",t,"value"],r);var o=e.getIn(["args",t,"valueSrc"]),l=a.valueSources,u=qn(i,l,a),s=u.length==1?u[0]:void 0;!s&&u.includes("value")&&(s="value"),!o&&s&&(e=e.setIn(["args",t,"valueSrc"],s))}return e},nc=function(e,t,r,a,i){return e&&e.get("func")&&(e=e.setIn(["args",t],new Se.default.Map({valueSrc:r}))),e},ac=function(e,t,r,a){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(e?.returnType!=t?.returnType)return[];var o=!1,l=Object.keys(t.args),u=l.filter(function(s,c){var d=t.args[s],f=e.args[s],p=Object.keys(e.args).indexOf(s);if(!f&&(d.defaultValue!==void 0||d.isOptional))return!0;if(o&&c!==p||f?.type!=d.type||yi.includes(d.type)&&(!f.listValuesType||f.listValuesType!==d.listValuesType))return!1;if(r){var m,v=r.get(s),g=v?.get("value"),S=v?.get("valueSrc");if(S&&d.valueSources&&!d.valueSources.includes(S))return!1;var y=null,b=null,F=d,A=null,w=!0,x=pa(a,y,F,b,g,F.type,S,A,i,w),k=(0,we.A)(x,2),D=k[0],I=k[1];if(I!=null&&(m=I.filter(function(_){return!_.fixed}))!==null&&m!==void 0&&m.length)return!1}return!0});return u},yi=["select","multiselect","treeselect","treemultiselect"],ic=function(e,t){var r;return((r=e.types[t])===null||r===void 0?void 0:r.operators)||null},Si=function(e,t){var r=Re(e,t),a=r?r.operators:[];return a},_o=function(e,t){var r,a=Si(e,t);return(r=a?.[0])!==null&&r!==void 0?r:null},oc=function(e,t,r){var a=null;if(e){if(t==="field"){var i=Re(r,e);i&&(a=i.type)}else if(t==="func"){var o=e.get("func");if(o){var l=qr(r,o);l&&(a=l.returnType||l.type)}}}return a},ih=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;return $a(e,t,r,"funcs","subfields")},$a=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"fields",i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"subfields";if(!e)return null;var o=t.settings.fieldSeparator,l=_r(e,t),u=_r(r,t),s=l.slice(u.length).map(function(c,d,f){return f.slice(0,d+1)}).map(function(c){return[].concat((0,Fe.A)(u),(0,Fe.A)(c)).join(o)}).map(function(c){var d=tn(t,c,a,i);return d&&d.label||di()(c.split(o))}).filter(function(c){return c!=null});return s},lc=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!e)return null;var a=r&&tn(t,r)||null,i=t.settings.fieldSeparator,o=_r(e,t),l=Vc(e,r,t),u=l?_r(r,t):[];return o.slice(u.length).map(function(s,c,d){return d.slice(0,c+1)}).map(function(s){return{part:[].concat((0,Fe.A)(u),(0,Fe.A)(s)).join(i),key:s[s.length-1]}}).map(function(s){var c=s.part,d=s.key,f=tn(t,c);return{key:d,cnf:f}}).map(function(s,c,d){var f=s.key,p=s.cnf,m=c>0?d[c-1].cnf:a;return[f,p,m]})},oh=function(e,t,r,a){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1,l=gt(e,t,r,null,i)||{},u=vr(e,r,t)||{},s=o?1:u.cardinality,c=null;if(s>1){var d=l.valueLabels||u.valueLabels;d&&(c=d[a]),c&&(0,Er.A)(c)!=="object"&&(c={label:c,placeholder:c}),c||(c={label:e.settings.valueLabel+" "+(a+1),placeholder:e.settings.valuePlaceholder+" "+(a+1)})}else{var f=l.valueLabel,p=l.valuePlaceholder;c={label:f||e.settings.valueLabel,placeholder:p||e.settings.valuePlaceholder}}return c};function Go(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,a=[],i=[];if(!e)return{widgets:a,valueSrcs:i};var o=Ci(e),l=o?"".concat(o,"__").concat(t,"__").concat(r):null,u=Ai(n,"_getWidgetsAndSrcsForFieldOp",l);if(u)return u;var s=(0,Er.A)(e)==="object"&&(!!e.func&&!!e.arg||e._isFuncArg),c=Re(n,e),d=t?n.operators[t]:null;if(c!=null&&c.widgets){var f=function(){var S=c.widgets[p];if(!n.widgets[p])return 1;var y=n.widgets[p].valueSrc||"value",b=!0;if(p==="field"&&(b=b&&qn(n,["field"],c).length>0),p==="func"&&(b=b&&qn(n,["func"],c).length>0),r==="value"&&!S.operators&&!s&&e!=="!case_value"&&(b=!1),S.operators&&t&&(b=b&&S.operators.indexOf(t)!=-1),r&&r!=y&&r!=="const"&&(b=!1),d&&d.cardinality==0&&y!=="value"&&(b=!1),b){var F,A;a.push(p);var w=((F=c.valueSources)===null||F===void 0?void 0:F.indexOf(y))!=-1;(d==null||(A=d.valueSources)===null||A===void 0?void 0:A.indexOf(y))==-1&&(w=!1),w&&!i.find(function(x){return x==y})&&i.push(y)}};for(var p in c.widgets)f()}var m=function(S){var y=0;return c.preferWidgets?c.preferWidgets.includes(S)&&(y+=10-c.preferWidgets.indexOf(S)):S==c.mainWidget&&(y+=100),S==="field"&&(y-=1),S==="func"&&(y-=2),y};a.sort(function(g,S){return m(S)-m(g)});var v={widgets:a,valueSrcs:i};return Li(n,"_getWidgetsAndSrcsForFieldOp",l,v),v}var lh=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=Go(e,t,r,a),o=i.widgets;return o},qn=function(e,t,r){var a;if(!r)return t;var i=(a=r.type)!==null&&a!==void 0?a:r.returnType;return i==="!group"&&(i="number"),t||(t=Object.keys(e.settings.valueSourcesInfo)),t.filter(function(o){var l=!0;if(o==="field"&&e.__fieldsCntByType){var u=r._isFuncArg?0:1;l=l&&e.__fieldsCntByType[i]>u}return o==="func"&&(r.funcs&&(l=l&&r.funcs.length>0),e.__funcsCntByType&&(l=l&&e.__funcsCntByType[i]>0)),l})},uc=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=Go(e,t,r,null),o=i.valueSrcs,l=qn(e,o,a);return l},Ir=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=Go(e,t,r,a),o=i.widgets,l=null;return o.length&&(l=o[0]),l},wn=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};if(e){var o=Re(t,e)||{},l=t.settings.fieldSeparator,u=_r(e,t),s=Array.isArray(e)?e.join(l):e;if(i!=null&&i.useTableName&&o.tableName){var c=(0,Fe.A)(u);c[0]=o.tableName,s=c.join(l)}if(o.fieldName&&(s=o.fieldName),a){var d=Re(t,a)||{},f=a;s.indexOf(f+l)==0?s=s.slice((f+l).length):o.fieldName||r.errors.push("Can't cut group ".concat(f," from field ").concat(s))}return s}},Bo=function(e,t){var r=e.get("type"),a=e.getIn(["properties","mode"]);return r=="rule_group"&&a=="array"?uh(e,t):r=="group"||r=="rule_group"?sh(e,t):ch(e,t)},uh=function(e,t){var r=e.get("children1"),a=e.get("properties");return sc(a.toObject(),r,t)},sc=function(e,t,r){var a,i,o=e.operator,l=(a=(i=r.operators[o])===null||i===void 0?void 0:i.cardinality)!==null&&a!==void 0?a:1,u=l==0,s={group:!$o(e,r),children:!Uo(t,r)},c=s.group&&(u?s.children:!0);return!c},sh=function(e,t){var r=e.get("children1");return Uo(r,t)},Uo=function(e,t){var r=e?.size>0&&e.filter(function(a){return!Bo(a,t)}).size>0;return!r},ch=function(e,t){var r=e.get("properties");return $o(r?.toObject()||{},t)},$o=function(e,t){var r=!0,a=3,i=Wo(e,t,r),o=i.score>=a;return!o},Wo=function(e,t){var r,a,i,o=e.field,l=e.fieldSrc,u=e.fieldType,s=e.operator,c=e.value,d=e.valueSrc,f=e.valueType,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,m=(r=(a=t.operators[s])===null||a===void 0?void 0:a.cardinality)!==null&&r!==void 0?r:1,v=d!=null&&d.get?d.toJS():d,g={parts:{},score:0};if(g.parts.field=p?o!=null:Oi(o,l,t),g.parts.operator=!!s,g.parts.value=(c==null||(i=c.filter(function(y,b){return Oi(y,v?.[b],t,p)}))===null||i===void 0?void 0:i.size)>=(p?Math.min(m,1):m),g.score=Object.keys(g.parts).filter(function(y){return!!g.parts[y]}).length,p&&g.score<3){var S=!0;!g.parts.value&&l==="func"&&Oi(o,l,t,!1,S)&&g.score++,g.parts.field||c?.map(function(y,b){v?.[b]==="func"&&Oi(y,v?.[b],t,!1,S)&&g.score++})}return g},Oi=function n(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;if(!a&&t=="func"&&e){var o,l=(o=e.get)===null||o===void 0?void 0:o.call(e,"func"),u=qr(r,l);if(u){var s=e.get("args");for(var c in u.args){var d=u.args[c],f=s?s.get(c):void 0,p=f?f.get("value"):void 0,m=f?f.get("valueSrc"):void 0;if(p==null&&d?.defaultValue===void 0&&!(d!=null&&d.isOptional)||p!=null&&!n(p,m,r,i?a:!0))return!1}return!0}}return e!=null},Jn=function(e,t,r){return t=="func"?ec(e,r):e},Qo=function n(e){var t=e.get("children1");if(t?.size==1){var r=t.first(),a=r.get("type");return a==="group"?n(r):r}return null},dh=h(55364),fh=h.n(dh),ph=h(1779),Wt=h.n(ph),vh=h(18678),Ko=h.n(vh);function cc(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function dc(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?cc(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):cc(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function gh(n,e){return Ko().apply(n,e)}function mh(n,e){return Ko().add_operation(n,e)}var fc={CALL:function(e,t){for(var r=arguments.length,a=new Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i];return e.call.apply(e,[t].concat(a))},JSX:function(e,t){return{type:e,props:t}},mergeObjects:function(e,t){return dc(dc({},e),t)},fromEntries:function(e){return Object.fromEntries(e)},strlen:function(e){return e?.length||0},regexTest:function(e,t,r){return e?.match(new RegExp(t,r))!=null},now:function(){return new Date},date_add:function(e,t,r){return sa()(e).add(t,r).toDate()},toLowerCase:function(e){return e.toLowerCase()},toUpperCase:function(e){return e.toUpperCase()}};function hh(){for(var n in fc)mh(n,fc[n])}function yh(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=Sh(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(s){throw s},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,l;return{s:function(){t=t.call(n)},n:function(){var s=t.next();return i=s.done,s},e:function(s){o=!0,l=s},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function Sh(n,e){if(n){if(typeof n=="string")return pc(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return pc(n,e)}}function pc(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function vc(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function vt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?vc(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):vc(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}hh();function gc(n,e,t){var r;try{r=Ko().apply(n,e)}catch(a){throw a.message="".concat(t.join(".")," :: ").concat(a.message),a}return r}function mc(n,e,t,r){var a;try{a=e.call.apply(e,[n].concat((0,Fe.A)(t)))}catch(i){throw i.message="".concat(r.join(".")," :: ").concat(i.message),i}return a}var hn=["conjunctions","fields","types","operators","widgets","settings","funcs","ctx"],Wa={asyncFetch:{type:"f",args:["search","offset"]},labelYes:{type:"r"},labelNo:{type:"r"},marks:{type:"r",isArr:!0},validateValue:{type:"f",args:["val","fieldSettings","op","opDef","rightFieldDef"]}},zo=vt(vt({},Wa),{},{factory:{type:"rf"},formatValue:{type:"f",args:["val","fieldDef","wgtDef","isForDisplay","op","opDef","rightFieldDef"]},sqlFormatValue:{type:"f",args:["val","fieldDef","wgtDef","op","opDef","rightFieldDef"]},spelFormatValue:{type:"f",args:["val","fieldDef","wgtDef","op","opDef","rightFieldDef"]},spelImportValue:{type:"f",args:["val","wgtDef","args"]},mongoFormatValue:{type:"f",args:["val","fieldDef","wgtDef","op","opDef"]},elasticSearchFormatValue:{type:"f",args:["queryType","val","op","field","config"]},jsonLogic:{type:"f",args:["val","fieldDef","wgtDef","op","opDef"]},jsonLogicImport:{type:"f",args:["val"]},validateValue:{type:"f",args:["val","fieldSettings","op","opDef","rightFieldDef"]},toJS:{type:"f",args:["val"]}}),hc={options:{factory:{type:"rf"}},formatOp:{type:"f",args:["field","op","vals","valueSrc","valueType","opDef","operatorOptions","isForDisplay","fieldDef"]},mongoFormatOp:{type:"f",args:["field","op","vals","useExpr","valueSrc","valueType","opDef","operatorOptions","fieldDef"]},sqlFormatOp:{type:"f",args:["field","op","vals","valueSrc","valueType","opDef","operatorOptions","fieldDef"]},spelFormatOp:{type:"f",args:["field","op","vals","valueSrc","valueType","opDef","operatorOptions","fieldDef"]},jsonLogic:{type:"f",ignore:"string",args:["field","op","vals","opDef","operatorOptions","fieldDef"]},elasticSearchQueryType:{type:"f",ignore:"string",args:["valueType"]},textSeparators:{type:"r",isArr:!0}},Oh={formatConj:{type:"f",args:["children","conj","not","isForDisplay"]},sqlFormatConj:{type:"f",args:["children","conj","not"]},spelFormatConj:{type:"f",args:["children","conj","not","omitBrackets"]}},yc={widgetProps:zo,opProps:hc},bh={renderBrackets:{type:"r",isArr:!0},renderSeps:{type:"r",isArr:!0},jsonLogic:{type:"f",ignore:"string",args:["formattedArgs"]},jsonLogicImport:{type:"f",args:["val"]},spelImport:{type:"f",args:["spel"]},formatFunc:{type:"f",args:["formattedArgs","isForDisplay"]},sqlFormatFunc:{type:"f",args:["formattedArgs"]},mongoFormatFunc:{type:"f",args:["formattedArgs"]},spelFormatFunc:{type:"f",args:["formattedArgs"]}},Sc=vt(vt({},Wa),{},{fieldSettings:Wa}),Oc=vt(vt({},Wa),{},{fieldSettings:Wa,widgets:{x:yc},mainWidgetProps:zo}),Fh={locale:{mui:{type:"f",args:[],invokeWith:[],ignore:"jl"}},caseValueField:Oc,canCompareFieldWithField:{type:"f",args:["leftField","leftFieldConfig","rightField","rightFieldConfig","op"]},formatReverse:{type:"f",args:["q","op","reversedOp","operatorDefinition","revOperatorDefinition","isForDisplay"]},sqlFormatReverse:{type:"f",args:["q"]},spelFormatReverse:{type:"f",args:["q"]},formatField:{type:"f",args:["field","parts","label2","fieldDefinition","config","isForDisplay"]},formatSpelField:{type:"f",args:["field","parentField","parts","partsExt","fieldDefinition","config"]},formatAggr:{type:"f",args:["whereStr","aggrField","operator","value","valueSrc","valueType","opDef","operatorOptions","isForDisplay","aggrFieldDef"]},normalizeListValues:{type:"f",args:["listValues","type","fieldSettings"]},renderConfirm:{type:"f",args:["props"]},useConfirm:{type:"f",args:[]},renderField:{type:"rf"},renderOperator:{type:"rf"},renderFunc:{type:"rf"},renderConjs:{type:"rf"},renderButton:{type:"rf"},renderIcon:{type:"rf"},renderButtonGroup:{type:"rf"},renderValueSources:{type:"rf"},renderFieldSources:{type:"rf"},renderProvider:{type:"rf"},renderSwitch:{type:"rf"},renderSwitchPrefix:{type:"r"},renderItem:{type:"rf"},renderBeforeWidget:{type:"rf"},renderAfterWidget:{type:"rf"},renderBeforeActions:{type:"rf"},renderAfterActions:{type:"rf"},renderBeforeCaseValue:{type:"rf"},renderAfterCaseValue:{type:"rf"},renderRuleError:{type:"rf"}},Th={fields:{x:Oc},widgets:{x:zo},conjunctions:{x:Oh},operators:{x:hc},types:{x:{widgets:{x:yc}}},funcs:{x:vt(vt(vt({},Sc),bh),{},{args:{x:vt({},Sc)}})},settings:Fh},va=function(e){return(0,Er.A)(e)=="object"&&e!==null&&!Array.isArray(e)},bc=function(e,t){if(e.__fieldNames)throw new Error("Don't apply `compressConfig()` to extended config");var r=pn()(e,hn);delete r.ctx;for(var a=function s(c,d,f,p){if(va(c)){if(Pa(c)&&(c=co(c)),f[0]==="funcs"&&!d){var m=f[f.length-1];d=tn({funcs:p.BasicFuncs},m,"funcs","subfields")||void 0,d&&(c.$$key=m)}if(d!==void 0&&va(d))for(var v in d)Object.prototype.hasOwnProperty.call(d,v)&&(!Object.keys(c).includes(v)||c[v]===void 0&&d[v]!==void 0?c[v]="$$deleted":(c[v]=s(c[v],d[v],[].concat((0,Fe.A)(f),[v]),p),c[v]===void 0&&delete c[v]));for(var g in c)if(Object.prototype.hasOwnProperty.call(c,g)){if(!d||!Object.keys(d).includes(g)){var S;c[g]=s(c[g],(S=d)===null||S===void 0?void 0:S[g],[].concat((0,Fe.A)(f),[g]),p)}c[g]===void 0&&delete c[g]}Object.keys(c).length===0&&(c=void 0)}else Array.isArray(c)&&c.forEach(function(y,b){c[b]=s(c[b],void 0,[].concat((0,Fe.A)(f),[b]),p)});if(!(d!==void 0&&Ia(c,d,!0))){if(typeof c=="function")throw new Error("compressConfig: function at ".concat(f.join(".")," should be converted to JsonLogic"));return c}},i=0,o=hn;i<o.length;i++){var l=o[i];if(l!=="ctx")if(l==="fields")r[l]=Wt()(r[l]),a(r[l],{},[l]);else if(l==="funcs"){r[l]=Wt()(r[l]||{});for(var u in r[l])a(r[l][u],null,[l,u],{BasicFuncs:ae})}else r[l]=Wt()(r[l]),a(r[l],t[l],[l])}return r},Fc=function(e,t,r){if(!e.settings.useConfigCompress)throw new Error("Please enable `useConfigCompress` in config settings to use decompressConfig()");for(var a={},i=function c(d,f,p){if(va(f)){va(d)||(d={});for(var m in f)Object.prototype.hasOwnProperty.call(f,m)&&(f[m]==="$$deleted"?delete d[m]:d[m]=c(d[m],f[m],[].concat((0,Fe.A)(p),[m])))}else Array.isArray(f)?d=Wt()(f):d=f;return d},o=function c(d,f,p){var m=!1;if(va(d)&&Object.prototype.hasOwnProperty.call(d,"$$key")&&d.$$key){var v=tn({funcs:p.BasicFuncs},d.$$key,"funcs","subfields");if(v)delete d.$$key,d=i(Wt()(v),d,f),m=!0;else throw new Error("decompressConfig: basic function not found by key ".concat(d.$$key," at ").concat(f.join(".")))}if(!m){if(va(d))for(var g in d)Object.prototype.hasOwnProperty.call(d,g)&&(d[g]=c(d[g],[].concat((0,Fe.A)(f),[g]),p));else if(Array.isArray(d)){var S=yh(d),y;try{for(S.s();!(y=S.n()).done;){var b=y.value;d[b]=c(d[b],[].concat((0,Fe.A)(f),[b]),p)}}catch(F){S.e(F)}finally{S.f()}}}return d},l=0,u=hn;l<u.length;l++){var s=u[l];s==="ctx"?a[s]=fh()({},t.ctx||{},r||{}):s==="funcs"?(a[s]=Wt()(e[s]||{}),o(a[s],[s],{BasicFuncs:ae})):s==="fields"?a[s]=Wt()(e[s]||{}):(a[s]=Wt()(t[s]||{}),i(a[s],e[s]||{},[s]))}return a},Tc=function(e){if(e.__compliled)return e;e=Wt()(e);var t={ctx:e.ctx},r=[];return bi(e,e,t,Th,r),Object.defineProperty(e,"__compliled",{enumerable:!1,writable:!1,value:!0}),e};function bi(n,e,t,r,a){var i=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];if(e){var o=!i.length;for(var l in r){var u=r[l],s=l==="x"?i:[].concat((0,Fe.A)(i),[l]);if(u.type==="r"){var c=e,d=c[l];if(u.isArr)for(var f in d){var p=ga(d[f],t,[].concat((0,Fe.A)(s),[f]));p!==d[f]&&(a.push("Compiled ".concat(s.join("."),"[").concat(f,"]")),d[f]=p)}else{var m=ga(d,t,s,void 0);m!==d&&(a.push("Compiled R ".concat(s.join("."))),c[l]=m)}}else if(u.type==="rf"){var v=e,g=v[l],S=Eh(g,t,s,u.ignore);S!==g&&(a.push("Compiled JL-RF ".concat(s.join("."))),v[l]=S)}else if(u.type==="f"){var y=e,b=y[l],F=Ch(b,t,s,u.args,u.ignore);if(u.invokeWith&&F&&typeof F=="function"){var A;F=(A=F).call.apply(A,[null].concat((0,Fe.A)(u.invokeWith)))}F!==b&&(a.push("Compiled JL-F ".concat(s.join("."))),y[l]=F)}else if(l==="x")for(var w in e){s=[].concat((0,Fe.A)(i),[w]);var x=e[w];bi(n,x,t,u,a,s),x.subfields&&bi(n,x.subfields,t,r,a,s)}else{var k=e[l];bi(n,k,t,u,a,s)}}}}function Eh(n,e,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:void 0;return Tt(n)?function(a,i){i=i||e?.ctx;var o={props:a,ctx:i},l=gc(n,o,t);typeof l=="string"&&(l={type:l,props:a});var u=ga(l,{ctx:i},t);return u}:typeof n=="string"?function(a,i){i=i||e?.ctx;var o=n.split(".").reduce(function(s,c){return s?.[c]},i);if(o)return mc(this,o,[a,i],t);var l={type:n,props:a},u=ga(l,{ctx:i},t);return u}:n}function Ch(n,e,t,r){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;return Tt(n)&&a!=="jl"?function(){for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];var u=this||e?.ctx,s=(r||[]).reduce(function(d,f,p){return vt(vt({},d),{},(0,ne.A)({},f,o[p]))},{args:o,ctx:u}),c=gc(n,s,t);return c}.bind(e?.ctx):typeof n=="string"&&a!=="string"?function(){var i=this||e?.ctx,o=n.split(".").reduce(function(c,d){return c?.[d]},i);if(o){for(var l=arguments.length,u=new Array(l),s=0;s<l;s++)u[s]=arguments[s];return mc(this,o,u,t)}else throw new Error("".concat(t.join(".")," :: Function ").concat(n," is not found in ctx"))}.bind(e?.ctx):n}function Ah(n,e){var t;return(e==null||(t=e.components)===null||t===void 0?void 0:t[n])||e.W[n]||e.O[n]}function ga(n,e,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:void 0;if(fo(n)){var a,i=n.type,o=n.props;if(typeof i!="string")throw new Error("renderReactElement for ".concat(t.join("."),": type should be string"));var l=Ah(i,e.ctx)||i.toLowerCase(),u;r!==void 0&&(o=vt(vt({},o),{},{key:r})),(a=o)!==null&&a!==void 0&&a.children&&(u=ga(o.children,e,t),o=vt(vt({},o),{},{children:u}));var s=e.ctx.RCE(l,o);return s}else if(n instanceof Array)return n.map(function(c,d){return ga(c,e,t,""+d)});return n}var Lh=h(6924),wh=h.n(Lh),Ec={reverseOperatorsForNot:!1,canShortMongoQuery:!0,formatField:function(e,t,r,a,i,o){return o?r:e},caseValueField:{type:"case_value"},fieldSources:["field"],keepInputOnChangeFieldSrc:!0,fieldItemKeysForSearch:["label","path","altLabel","grouplabel"],listKeysForSearch:["title","value"],valueSourcesInfo:{value:{}},fieldSeparator:".",fieldSeparatorDisplay:".",canReorder:!0,canRegroup:!0,canDeleteLocked:!1,canLeaveEmptyGroup:!0,shouldCreateEmptyGroup:!1,exportPreserveGroups:!1,removeEmptyGroupsOnLoad:!0,removeEmptyRulesOnLoad:!0,removeIncompleteRulesOnLoad:!1,removeInvalidMultiSelectValuesOnLoad:!0,showErrorMessage:!1,setOpOnChangeField:["keep","default"],groupOperators:["some","all","none"],defaultGroupConjunction:"AND",locale:{moment:"en"},valueLabel:"Value",valuePlaceholder:"Value",fieldLabel:"Field",operatorLabel:"Operator",funcLabel:"Function",fieldPlaceholder:"Select field",funcPlaceholder:"Select function",operatorPlaceholder:"Select operator",lockLabel:"Lock",lockedLabel:"Locked",deleteLabel:"Delete",addGroupLabel:"Add group",addCaseLabel:"Add condition",addDefaultCaseLabel:"Add default condition",defaultCaseLabel:"Default:",addRuleLabel:"Add rule",addSubRuleLabel:"Add sub rule",delGroupLabel:"Delete",notLabel:"Not",fieldSourcesPopupTitle:"Select source",valueSourcesPopupTitle:"Select value source",removeRuleConfirmOptions:null,removeGroupConfirmOptions:null};function Ho(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=xh(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(s){throw s},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,l;return{s:function(){t=t.call(n)},n:function(){var s=t.next();return i=s.done,s},e:function(s){o=!0,l=s},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function xh(n,e){if(n){if(typeof n=="string")return Cc(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Cc(n,e)}}function Cc(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}var jh=0,Ac=0,ma,Fi={},Lc=function(){return ma||(ma=xc({reactIndex:void 0,maxSize:3,canCompile:void 0})),ma},wc=function(e,t){var r;for(var a in Fi){var i=Fi[a].findExtendedConfig(e,t);if(i){r=i;break}}return r},xc=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{reactIndex:void 0,maxSize:2,canCompile:!0},t=new Map,r=e.maxSize||2,a=++jh,i,o=!0,l=function(g){return pn()(g,hn)},u=function(g){var S=kt(g,++Ac,e.canCompile);return c(g,S),S},s=function(){return t.size},c=function(g,S){t.size+1>r&&t.delete(t.keys().next().value),t.set(g,S)},d=function(g){var S=Ho(t.keys()),y;try{var b=function(){var w=y.value,x=t.get(w),k=hn.map(function(D){return x[D]===g[D]}).filter(function(D){return!D}).length===0;if(k)return{v:w}},F;for(S.s();!(y=S.n()).done;)if(F=b(),F)return F.v}catch(A){S.e(A)}finally{S.f()}return g},f=function(g,S){var y=Ho(t.keys()),b;try{var F=function(){var _=b.value,G=hn.filter(function(H){return _[H]===g[H]}),M=G.length===hn.length&&(S?_.__compliled:!0);if(M)return{v:t.get(_)}},A;for(y.s();!(b=y.n()).done;)if(A=F(),A)return A.v}catch(I){y.e(I)}finally{y.f()}var w=Ho(t.values()),x;try{var k=function(){var _=x.value,G=hn.filter(function(H){return _[H]===g[H]}),M=G.length===hn.length&&(S?_.__compliled:!0);if(M)return{v:_}},D;for(w.s();!(x=w.n()).done;)if(D=k(),D)return D.v}catch(I){w.e(I)}finally{w.f()}return null},p=function(g){return f(g)||u(g)},m=function(){o=!1,t.clear(),delete Fi[a],ma===i&&(ma=void 0)};return i={getExtendedConfig:function(g){return p(l(g))},findExtendedConfig:f,getBasicConfig:d,clearConfigMemo:m,configId:Ac,storeConfigPair:c,getSize:s,configStore:t,memoId:a,meta:e},e.reactIndex===void 0&&(ma=i),Fi[a]=i,i};function qo(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=Rh(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(s){throw s},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,l;return{s:function(){t=t.call(n)},n:function(){var s=t.next();return i=s.done,s},e:function(s){o=!0,l=s},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function Rh(n,e){if(n){if(typeof n=="string")return jc(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return jc(n,e)}}function jc(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function Rc(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Qt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Rc(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Rc(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var kt=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(r=r&&e.settings.useConfigCompress,e.__configId)return e;var a=wc(e,r);if(a)return a;var i=e;r?e.__compliled?e=Wt()(e):e=Tc(e):e=Wt()(e),e.settings=wh()({},Ec,e.settings,Zl),e.__fieldsCntByType={},e.__funcsCntByType={},e.__fieldNames={},Ih(e.types,e),Ic(e.fields,e),Pc(e.funcs,e);var o=e.settings.caseValueField;o&&Ti(o,e,[],!1,!0);var l=e.settings.locale.moment;l&&sa().locale(l),Object.defineProperty(e,"__configId",{enumerable:!1,writable:!1,value:t||mr()}),e.__cache={},ru(e);var u=Lc();return u.storeConfigPair(i,e),e};function Ih(n,e){for(var t in n){var r=n[t];Ph(t,r,e)}}function Ph(n,e,t){var r=null,a=null;e.mainWidget=e.mainWidget||Object.keys(e.widgets).filter(function(p){return p!="field"&&p!="func"})[0];var i=e.excludeOperators||[];for(var o in e.widgets){var l=e.widgets[o],u=l.defaultOperator;if(l.operators){var s=l.operators.filter(function(p){return!i.includes(p)});r=ci(r,s)}u&&!i.includes(u)&&(!a||o===e.mainWidget)&&(a=u),o==e.mainWidget&&(l.widgetProps=Qt(Qt({},e.mainWidgetProps||{}),l.widgetProps||{})),e.widgets[o]=l}e.valueSources||(e.valueSources=Object.keys(t.settings.valueSourcesInfo));var c=qo(e.valueSources),d;try{for(c.s();!(d=c.n()).done;){var f=d.value;f!="value"&&!e.widgets[f]&&(e.widgets[f]={})}}catch(p){c.e(p)}finally{c.f()}!e.operators&&r&&(e.operators=Array.from(new Set(r))),!e.defaultOperator&&a&&(e.defaultOperator=a)}function Ic(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];for(var r in n){var a=[].concat((0,Fe.A)(t),[r]);Ti(n[r],e,a),n[r].subfields&&Ic(n[r].subfields,e,a)}}function Pc(n,e){var t,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];if(n){var a=(e==null||(t=e.settings)===null||t===void 0?void 0:t.fieldSeparator)||".";for(var i in n){var o=[].concat((0,Fe.A)(r),[i]),l=o.join(a),u=n[i];if(u.returnType&&(u.type=u.returnType,e.__funcsCntByType[u.returnType]||(e.__funcsCntByType[u.returnType]=0),e.__funcsCntByType[u.returnType]++),Ti(u,e,o,!1),u.args){for(var s in u.args)Ti(u.args[s],e,[].concat((0,Fe.A)(o),[s]),!0);var c=Object.keys(u.args),d=!0,f=qo(c.reverse()),p;try{for(f.s();!(p=f.n()).done;){var m=p.value,v=u.args[m];!d&&v.isOptional&&(In.info("Arg ".concat(m," for func ").concat(l," can't be optional")),delete v.isOptional),v.isOptional||(d=!1)}}catch(g){f.e(g)}finally{f.f()}}u.subfields&&Pc(u.subfields,e,[].concat((0,Fe.A)(r),[i]))}}}function Nh(n,e,t){for(var r,a,i=["listValues","treeValues","allowCustomValues","validateValue"],o=0,l=i;o<l.length;o++){var u=l[o];n[u]&&(n.fieldSettings||(n.fieldSettings={}),n.fieldSettings[u]=n[u],delete n[u])}(r=n.fieldSettings)!==null&&r!==void 0&&r.listValues&&e.settings.normalizeListValues&&(n.fieldSettings.listValues=e.settings.normalizeListValues.call(e.ctx,n.fieldSettings.listValues,t,n.fieldSettings)),(a=n.fieldSettings)!==null&&a!==void 0&&a.treeValues&&e.settings.normalizeListValues&&(n.fieldSettings.treeValues=e.settings.normalizeListValues.call(e.ctx,n.fieldSettings.treeValues,t,n.fieldSettings))}function Ti(n,e){var t,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,o=e.settings,l=o.showLabels,u=o.fieldSeparator;u=(t=u)!==null&&t!==void 0?t:".";var s=r[r.length-1],c=a?r.slice(0,r.length-1).join(u):r.join(u),d=!!n.returnType,f=n.type||n.returnType,p=e.types[f],m=n.excludeOperators||[],v=(n.operators||p?.operators||[]).filter(function(D){return!m.includes(D)}),g=n.defaultOperator||p?.defaultOperator;m.includes(g)&&(g=void 0);var S=!!g&&g==n.defaultOperator;if(S&&(n.ownDefaultOperator=n.defaultOperator),!p){n.disabled=!0;return}!a&&!d&&!i&&(e.__fieldsCntByType[f]||(e.__fieldsCntByType[f]=0),e.__fieldsCntByType[f]++),a&&(n._isFuncArg=!0,n._argKey=s,n._funcKey=c),d&&(n._isFunc=!0,n._funcKey=c),i&&(n._isCaseValue=!0),Nh(n,e,f);var y=["widgets","operators","defaultOperator"];Object.keys(p).filter(function(D){return!y.includes(D)}).map(function(D){n[D]||(n[D]=Yl(p[D]))});var b=p.excludeOperators||[];n.operators&&(b=b.filter(function(D){return!n.operators.includes(D)})),n.widgets||(n.widgets={});var F=function(){var I=Qt({},n.widgets[A]||{}),_=p.widgets[A]||{};if(!a){var G=I.defaultOperator,M=[].concat((0,Fe.A)(m),(0,Fe.A)(b)),H=n.preferWidgets&&(A==="field"||n.preferWidgets.includes(A))||M.length>0;if(I.operators){var K=I.operators.filter(function(be){return!M.includes(be)});I.operators=K,v=ci(v,K)}else if(H&&_.operators){var z=_.operators.filter(function(be){return!M.includes(be)});I.operators=z,v=ci(v,z)}G&&!M.includes(G)&&(!g||!S&&A===n.mainWidget)&&(g=G)}A===n.mainWidget?I.widgetProps=Qt(Qt(Qt({},_.widgetProps||{}),n.mainWidgetProps||{}),I.widgetProps||{}):I.widgetProps=Qt(Qt({},_.widgetProps||{}),I.widgetProps||{});var U=Array.from(new Set([].concat((0,Fe.A)(Object.keys(_.opProps||{})),(0,Fe.A)(Object.keys(I.opProps||{})))));if(U.length){var ee={},Y=qo(U),oe;try{for(Y.s();!(oe=Y.n()).done;){var ie,se,ce=oe.value;ee[ce]=Qt(Qt({},((ie=_.opProps)===null||ie===void 0?void 0:ie[ce])||{}),((se=I.opProps)===null||se===void 0?void 0:se[ce])||{})}}catch(be){Y.e(be)}finally{Y.f()}I.opProps=ee}var ge=I,ye=ge.valueLabel,ue=ge.valuePlaceholder;a&&(ye||(I.valueLabel=n.label||s),!ue&&!l&&(I.valuePlaceholder=n.label||s)),I=Qt(Qt({},_),I),n.widgets[A]=I};for(var A in p.widgets)F();if(a||(n.operators||(n.operators=Array.from(new Set(v))),n.defaultOperator||(n.defaultOperator=g)),!a&&!d&&!i){var w=Dh(e,r),x=w.fieldName,k=w.inGroup;x&&(n.fieldName=x,e.__fieldNames[x]||(e.__fieldNames[x]=[]),e.__fieldNames[x].push({fullPath:r,inGroup:k}))}}function Dh(n,e){if(!e)return{};var t=n.settings.fieldSeparator,r=(0,Fe.A)(e).reduce(function(l,u,s,c){var d=l.computedPath,f=l.computed,p=l.inGroup,m=[].concat((0,Fe.A)(c.slice(0,s)),[u]),v=tn(n,m);return v?.type==="!group"&&s<c.length-1?(p=m.join(t),d=[]):v!=null&&v.fieldName?(f=!0,d=[v.fieldName]):d=[].concat((0,Fe.A)(d),[u]),{computedPath:d,computed:f,inGroup:p}},{computedPath:[],computed:!1,inGroup:void 0}),a=r.computedPath,i=r.computed,o=r.inGroup;return i?{fieldName:a.join(t),inGroup:o}:{}}function Nc(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Yn(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Nc(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Nc(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var Vh=Cn().mark(ha),kh=Cn().mark(Dc),Mh=zn;function ha(n){return Cn().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(Jo(n,n.funcs||{},[]),"t0",1);case 1:case"end":return t.stop()}},Vh)}function Dc(n){return Cn().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(Jo(n,n.fields||{},[]),"t0",1);case 1:case"end":return t.stop()}},kh)}function Jo(n,e,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"subfields";return Cn().mark(function a(i){var o,l,u;return Cn().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:o=(n==null||(i=n.settings)===null||i===void 0?void 0:i.fieldSeparator)||".",c.t0=Cn().keys(e);case 2:if((c.t1=c.t0()).done){c.next=13;break}if(l=c.t1.value,u=e[l],!u[r]){c.next=9;break}return c.delegateYield(Jo(n,u[r],[].concat((0,Fe.A)(t),[l]),r),"t2",7);case 7:c.next=11;break;case 9:return c.next=11,[[].concat((0,Fe.A)(t),[l]).join(o),u];case 11:c.next=2;break;case 13:case"end":return c.stop()}},a)})()}var tn=function(e,t){var r,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"fields",i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"subfields";if(!t)return null;if(t==="!case_value"){var o;return e==null||(o=e.settings)===null||o===void 0?void 0:o.caseValueField}var l=(e==null||(r=e.settings)===null||r===void 0?void 0:r.fieldSeparator)||".",u=_r(t,e),s=e[a];if(!s)return null;for(var c=s,d=null,f=[],p=0;p<u.length;p++){var m=u[p];f.push(m);var v=f.join(l);d=c[v],p<u.length-1&&(d&&d[i]?(c=d[i],f=[]):d=null)}return d},Ei=function(e,t){var r,a,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,o=e.settings.fieldSeparator,l=[i].concat((0,Fe.A)(t.split(o))).filter(function(c){return c!=null}),u=t,s=(r=e.__fieldNames[u])===null||r===void 0||(a=r.find)===null||a===void 0||(a=a.call(r,function(c){var d=c.inGroup;return d?i?.startsWith(d):!0}))===null||a===void 0?void 0:a.fullPath;return(s||l).join(o)},Yo=function(e,t){if(!t)return null;var r=tn(e,t,"funcs","subfields");if(!r)return null;var a=r.returnType,i=r.args,o=Object.fromEntries(Object.entries(i||{}).map(function(u){var s=(0,we.A)(u,2),c=s[0],d=s[1],f=pn()(d,["type","valueSources","defaultValue","fieldSettings","isOptional","_funcKey","_argKey","_isFuncArg"]);return[c,f]})),l={returnType:a,args:o};return l},qr=function(e,t){if(!t)return null;var r=tn(e,t,"funcs","subfields");return r||null},Xo=function(e,t,r){var a=qr(e,t);if(!a)return null;var i=a.args&&a.args[r]||null;return i||null},Vc=function(e,t){var r,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!t)return!1;var i=(a==null||(r=a.settings)===null||r===void 0?void 0:r.fieldSeparator)||".",o=yn(e,a),l=yn(t,a);return o.startsWith(l+i)},yn=function(e){var t,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(typeof e=="string")return e;var a=(r==null||(t=r.settings)===null||t===void 0?void 0:t.fieldSeparator)||".";return _r(e,r).join(a)},_r=function(e){var t,r,a,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!e)return[];if(Array.isArray(e))return e;var o=(i==null||(t=i.settings)===null||t===void 0?void 0:t.fieldSeparator)||".";if(e!=null&&e.func)return Array.isArray(e.func)?e.func:e.func.split(o);if(e!=null&&(r=e.get)!==null&&r!==void 0&&r.call(e,"func")){var l;return e==null||(l=e.get)===null||l===void 0?void 0:l.call(e,"func").split(o)}return(e==null||(a=e.split)===null||a===void 0?void 0:a.call(e,o))||[]},_h=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(!e)return null;var a=t.settings.fieldSeparator,i=_r(e,t);return r?i:i.map(function(o,l,u){return u.slice(0,l+1)}).map(function(o){return o.join(a)})},Ci=function(e){var t;if(typeof e=="string"||Array.isArray(e))return"field:".concat(yn(e));if((0,Er.A)(e)==="object"&&e){if(e._funcKey&&e._argKey)return"arg:".concat(yn(e._funcKey),"__").concat(e._argKey);if(e._funcKey)return"func:".concat(yn(e._funcKey));if(e.func&&e.arg)return"arg:".concat(yn(e.func),"__").concat(e.arg);if(e.func)return"func:".concat(yn(e.func));if(e.type)return null}return e!=null&&(t=e.get)!==null&&t!==void 0&&t.call(e,"func")?e!=null&&e.get("arg")?"arg:".concat(yn(e.get("func")),"__").concat(e.get("arg")):"func:".concat(yn(e.get("func"))):null},Ai=function(e,t,r){var a;return(a=e.__cache)===null||a===void 0||(a=a[t])===null||a===void 0?void 0:a[r]},Li=function(e,t,r,a){!e.__cache||!r||(e.__cache[t]||(e.__cache[t]={}),e.__cache[t][r]=a)},kc=function(e){var t;if(!e)return null;if((0,Er.A)(e)==="object"){if(!e.func&&e.type)return"field";if(e.func)return e.func&&e.arg?null:"func"}return e!=null&&(t=e.get)!==null&&t!==void 0&&t.call(e,"func")?e!=null&&e.get("arg")?null:"func":"field"},Re=function(e,t){var r;if(!t)return null;if((0,Er.A)(t)=="object"){if(!t.func&&t.type)return t;if(t.func)return t.func&&t.arg?Xo(e,t.func,t.arg):qr(e,t.func)}if(t!=null&&(r=t.get)!==null&&r!==void 0&&r.call(t,"func"))return t!=null&&t.get("arg")?Xo(e,t.get("func"),t.get("arg")):qr(e,t.get("func"));var a=tn(e,t);return a||null},vr=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!t)return null;var a=e.operators[t];if(r){var i,o,l=Ci(r),u=l?"".concat(l,"__").concat(t):null,s=Ai(e,"getOperatorConfig",u);if(s)return s;var c=Re(e,r),d=Ir(e,r,t,null),f=e.widgets[d]||{},p=(c&&c.widgets?c.widgets[d]:{})||{},m=((i=f.opProps)===null||i===void 0?void 0:i[t])||{},v=((o=p.opProps)===null||o===void 0?void 0:o[t])||{},g=Yn(Yn(Yn({},a),m),v);return Li(e,"getOperatorConfig",u,g),g}else return a},gt=function(e,t){var r,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,l=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(!t)return null;var u=Re(e,t),s=Ci(t);i||(i=Ir(e,t,a,o));var c=s?"".concat(s,"__").concat(a,"__").concat(i,"__").concat(o):null,d=Ai(e,"getFieldWidgetConfig",c);if(d)return d;var f=e.widgets[i]||{},p=(u==null||(r=u.widgets)===null||r===void 0?void 0:r[i])||{},m=p.widgetProps||{},v=o==="value"||!o?u?.fieldSettings:{},g=Yn(Yn(Yn(Yn({},f),p),m),v);return Li(e,"getFieldWidgetConfig",c,g),l.forExport&&(g=Vt(g,"factory")),g},Mc=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=e.settings.fieldSeparator,a=_r(t,e),i=t?tn(e,t):e,o=i,l=null,u=[];do{var s,c=o===e?e.fields:(s=o)===null||s===void 0?void 0:s.subfields;if(!c||!Object.keys(c).length){o=l=null;break}l=Object.keys(c)[0],u.push(l),o=c[l]}while(o.type=="!struct"||o.type=="!group");return(a||[]).concat(u).join(r)};function _c(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Gc(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?_c(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):_c(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var Gh=function(e,t){var r={usedFields:[]},a=Bc(e,t,r);if(a)return Gc(Gc({},a),r)},Bc=function(e,t,r){if(e){var a=e.get("type"),i=e.get("children1");if((a==="group"||a==="rule_group")&&i&&i.size)return Bh(e,t,r);if(a==="rule")return Uh(e,t,r)}},Bh=function(e,t,r){var a=e.get("properties")||new Se.Map,i=e.get("children1"),o=e.get("id"),l=i.map(function(d){return Bc(d,t,r)}).filter(function(d){return typeof d<"u"});if(l.size){var u=a.get("conjunction");u||(u=mn(t));var s=a.get("not"),c={id:o,rules:l.toList(),condition:u.toUpperCase(),not:s};return c}},Uh=function(e,t,r){var a,i=e.get("properties")||new Se.Map,o=e.get("id"),l=i.get("operator"),u=i.get("operatorOptions"),s=i.get("field"),c=i.get("value"),d=i.get("valueSrc"),f=i.get("valueType"),p=c.filter(function(I){return I===void 0}).size>0;if(!(s==null||l==null||p)){var m=Re(t,s)||{},v=vr(t,l,s)||{},g=m.type||"undefined",S=zr(v),y=t.types[m.type]||{},b=wn(s,t,r);if(!(c.size<S)){r.usedFields.indexOf(s)==-1&&r.usedFields.push(s),c=c.toArray(),d=d.toArray(),f=((a=f)===null||a===void 0?void 0:a.toArray())||[];for(var F=[],A=0;A<c.length;A++){var w={type:f[A],value:c[A]};if(F.push(w),d[A]=="field"){var x=c[A];r.usedFields.indexOf(x)==-1&&r.usedFields.push(x)}}var k=u?u.toJS():null;k&&!Object.keys(k).length&&(k=null);var D={id:o,fieldName:b,type:g,input:y.mainWidget,operator:l};return k&&(D.operatorOptions=k),D.values=F,D}}};function Uc(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function $c(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Uc(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Uc(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Wc(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=$h(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(s){throw s},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,l;return{s:function(){t=t.call(n)},n:function(){var s=t.next();return i=s.done,s},e:function(s){o=!0,l=s},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function $h(n,e){if(n){if(typeof n=="string")return Qc(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Qc(n,e)}}function Qc(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}var Wh=function(e,t){var r={usedFields:[],errors:[]},a=kt(t,void 0,!1),i=Kc(e,a,r,!1,!0),o=r.errors,l=r.usedFields,u=a.settings.fieldSeparator,s={},c=Wc(l),d;try{for(c.s();!(d=c.n()).done;)for(var f=d.value,p=_r(f,t),m=Re(a,f)||{},v=s,g=0;g<p.length;g++){var S=p[g],y=Re(a,p.slice(0,g+1))||{};g!=p.length-1?y.type=="!group"&&y.mode!="struct"?(v[S]||(v[S]=[{}]),v=v[S][0]):(v[S]||(v[S]={}),v=v[S]):v[S]||(v[S]=null)}}catch(b){c.e(b)}finally{c.f()}return{errors:o,logic:i,data:s}},Kc=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null;if(e){var l=e.get("type"),u=e.get("properties")||new Se.Map,s=u.get("isLocked"),c=t.settings.jsonLogic.lockedOp,d;return l==="group"||l==="rule_group"?d=zc(e,t,r,a,i,o):l==="rule"?d=Qh(e,t,r,a,o):l=="switch_group"?d=Kh(e,t,r,a):l=="case_group"&&(d=Hc(e,t,r,a,o)),s&&d&&c&&(d=(0,ne.A)({},c,d)),d}},zc=function(e,t,r){var a,i,o,l,u,s,c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,f=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,p=e.get("type"),m=e.get("properties")||new Se.Map,v=m.get("mode"),g=e.get("children1")||new Se.List,S=m.get("field"),y=Re(t,S),b=m.get("conjunction");b||(b=mn(t));var F=t.conjunctions[b],A=F.jsonLogicConj||b.toLowerCase(),w=!!m.get("not"),x=p==="rule_group"&&!d,k=x&&v!="struct",D=k?S:f,I=m.get("operator"),_=I&&vr(t,I,S)||null,G=Zo(t,m,r,I,f),M=x&&(!I||((a=_)===null||a===void 0?void 0:a.cardinality)==0),H=x&&g?.size>0,K=x&&!(g!=null&&g.size),z=w,U=!1;H?(U=w,z=c):c&&(z=!z);var ee=!1,Y=(i=_)===null||i===void 0?void 0:i.reversedOp,oe=vr(t,Y,S),ie=!((o=_)!==null&&o!==void 0&&o.jsonLogic)&&!!((l=oe)!==null&&l!==void 0&&l.jsonLogic),se=!!((u=oe)!==null&&u!==void 0&&u.jsonLogic),ce=(s=Qo(e))===null||s===void 0?void 0:s.get("type"),ge=!!t.settings.reverseOperatorsForNot&&(!x&&z&&ce==="rule"||U&&g?.size===1);ge&&(H?U=!U:z=!z,ee=!0);var ye=z&&x&&se&&(!!t.settings.reverseOperatorsForNot||ie);if(ye){z=!z;var ue=[Y,I];I=ue[0],Y=ue[1];var be=[oe,_];_=be[0],oe=be[1]}var me=g.map(function(He){return Kc(He,t,r,ee,!1,D)}).filter(function(He){return typeof He<"u"}),Ce=!!t.settings.exportPreserveGroups;if(k&&!M){if(G==null)return}else if(!me.size&&!Ce)return;var Me=d||Ce||me.size!=1;!Me&&w&&!ee&&(Me=g.some(function(He){var or,We,Gr,sr,xr=(or=He.get("properties"))===null||or===void 0?void 0:or.get("operator"),lr=(We=t.operators)===null||We===void 0||(We=We[xr])===null||We===void 0?void 0:We.reversedOp;return(Gr=(sr=t.operators)===null||sr===void 0||(sr=sr[lr])===null||sr===void 0?void 0:sr._jsonLogicIsExclamationOp)!==null&&Gr!==void 0?Gr:!1}));var je={};if(Me?je[A]=me.toList().toJS():je=me.first(),U&&(je={"!":je}),k){var Ie=rl(r,t,S,f);if(M){var Ve=I||"some";je=(0,ne.A)({},Ve,[Ie,je])}else{var Ee=me.size?{filter:[Ie,je]}:Ie,_e={reduce:[Ee,{"+":[1,{var:"accumulator"}]},0]};je=Jc(t,m,_e,G,I,null,y)}}return z&&(je={"!":je}),je},Qh=function(e,t,r){var a,i,o,l,u,s,c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,f=e.get("properties")||new Se.Map,p=f.get("field"),m=f.get("fieldSrc"),v=f.get("operator"),g=f.get("operatorOptions");if(g=g?g.toJS():null,g&&!Object.keys(g).length&&(g=null),!(p==null||v==null)){var S=Re(t,p),y=vr(t,v,p),b=(a=y)===null||a===void 0?void 0:a.reversedOp,F=vr(t,b,p);if(!((i=y)!==null&&i!==void 0&&i.jsonLogic)&&!((o=F)!==null&&o!==void 0&&o.jsonLogic)){r.errors.push("Operator ".concat(v," is not supported"));return}var A=c,w=!((l=y)!==null&&l!==void 0&&l.jsonLogic)&&!!((u=F)!==null&&u!==void 0&&u.jsonLogic),x=!!((s=F)!==null&&s!==void 0&&s.jsonLogic),k=x&&(!!t.settings.reverseOperatorsForNot||w),D=A&&k||w;if(D){A=!A;var I=[b,v];v=I[0],b=I[1];var _=[F,y];y=_[0],F=_[1]}var G=Zo(t,f,r,v,d);if(G!==void 0){var M=m==="func"?qc(r,t,p,d):rl(r,t,p,d);if(M!==void 0)return Jc(t,f,M,G,v,g,S,A)}}},Kh=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=e.get("children1");if(i){for(var o=i.map(function(w){return Hc(w,t,r,a,null)}).filter(function(w){return typeof w<"u"}).valueSeq().toArray(),l=[],u=0;u<o.length;u++)u!==o.length-1&&!o[u][0]?r.errors.push("No condition for case ".concat(u)):(l.push(o[u]),u===o.length-1&&o[u][0]&&l.push([void 0,null]));if(l.length){if(l.length===1){var s=(0,we.A)(l[0],2),c=s[0],d=s[1];return d==null&&(d=null),d}for(var f={if:[]},p=f.if,m=(0,we.A)(l[l.length-1],2),v=m[0],g=m[1],S=0;S<l.length-1;S++){var y=S===l.length-2,b=(0,we.A)(l[S],2),F=b[0],A=b[1];A==null&&(A=null),F==null&&(F=!0),p.push(F),p.push(A),y?p.push(g):(p.push({if:[]}),p=p[p.length-1].if)}return f}}},Hc=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,o=e.get("type");if(o!="case_group"){r.errors.push("Unexpected child of type ".concat(o," inside switch"));return}var l=e.get("properties")||new Se.Map,u=zc(e,t,r,a,i),s=Zo(t,l,r,null,i,"!case_value");return[u,s]},Zo=function(e,t,r,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,l=t.get("field"),u=t.get("valueSrc"),s=t.get("valueType");(o=="!case_value"||s&&s.get(0)=="case_value")&&(l="!case_value");var c=Re(e,l),d=vr(e,a,l),f=zr(d),p=t.get("value"),m=t.get("asyncListValues");if(p!=null){var v=[],g=[],S=r.usedFields,y=p.map(function(F,A){var w=u?u.get(A):null,x=s?s.get(A):null,k=Jn(F,w,e),D=Ir(e,l,a,w),I=gt(e,l,a,D,w,{forExport:!0}),_=el(r,e,k,w,x,I,c,a,d,i,m);return _!==void 0&&(v.push(w),g.push(x)),_}),b=y.filter(function(F){return F===void 0}).size>0;if(y.size<f||b){r.usedFields=S;return}return f>1?y.toArray():f==1?y.first():null}},el=function(e,t,r,a,i,o,l,u,s){var c=arguments.length>9&&arguments[9]!==void 0?arguments[9]:null,d=arguments.length>10?arguments[10]:void 0;if(r!==void 0){var f;if(a=="field")f=rl(e,t,r,c);else if(a=="func")f=qc(e,t,r,c);else if(typeof o?.jsonLogic=="function"){var p=o.jsonLogic,m=[r,$c($c({},l?pn()(l,["fieldSettings","listValues"]):{}),{},{asyncListValues:d}),Vt(o,zn)];u&&(m.push(u),m.push(s)),f=p.call.apply(p,[t.ctx].concat(m))}else f=r;return f}},qc=function(e,t,r){var a,i,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,l=(a=r.get)===null||a===void 0?void 0:a.call(r,"func"),u=(i=r.get)===null||i===void 0?void 0:i.call(r,"args"),s=qr(t,l),c=_r(l,t),d=c[c.length-1];if(!s){e.errors.push("Func ".concat(l," is not defined in config"));return}if(!(s!=null&&s.jsonLogic)){e.errors.push("Func ".concat(l," is not supported"));return}var f={},p=[],m=[];for(var v in s.args){var g,S=s.args[v],y=Re(t,S),b=S.defaultValue,F=S.isOptional,A=b!=null&&b.func?"func":"value",w=u?u.get(v):void 0,x=w?w.get("value"):void 0,k=w?w.get("valueSrc"):void 0;k!=="func"&&(g=x)!==null&&g!==void 0&&g.toJS&&(x=x.toJS());var D=null,I=Ir(t,S,D,k),_=gt(t,S,D,I,k,{forExport:!0}),G=el(e,t,x,k,S.type,_,y,null,null,o);if(x!=null&&G===void 0){k!="func"&&e.errors.push("Can't format value of arg ".concat(v," for func ").concat(l));return}var M=void 0;if(G===void 0&&!F&&b!=null){var H=Ir(t,S,D,A),K=gt(t,S,D,H,A,{forExport:!0});if(M=el(e,t,b,A,S.type,K,y,null,null,o),M===void 0){A!="func"&&e.errors.push("Can't format default value of arg ".concat(v," for func ").concat(l));return}}var z=G??M;if(z!==void 0){if(p.length){var U=Wc(p),ee;try{for(U.s();!(ee=U.n()).done;){var Y=ee.value;f[Y]=void 0}}catch(me){U.e(me)}finally{U.f()}p=[]}f[v]=z}else F||m.push(v),p.push(v)}if(!m.length){var oe=Object.values(f),ie;if(typeof s.jsonLogic=="function"){var se=s.jsonLogic,ce=[f];ie=se.call.apply(se,[t.ctx].concat(ce))}else{var ge=s.jsonLogic||d,ye=!!s.jsonLogicIsMethod;if(ye){var ue=oe[0],be=oe.slice(1);be.length?ie={method:[ue,ge,be]}:ie={method:[ue,ge]}}else ie=(0,ne.A)({},ge,oe)}return ie}},rl=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=t.settings,o=i.fieldSeparator,l=i.jsonLogic,u;if(r){Array.isArray(r)&&(r=r.join(o));var s=Re(t,r)||{},c=wn(r,t,e,a),d=s.jsonLogicVar||(s.type=="!group"?l.groupVarKey:"var");u=(0,ne.A)({},d,c),e.usedFields.indexOf(r)==-1&&e.usedFields.push(r)}return u},zh=function(e,t,r,a){var i=e,o=zr(t);typeof t.jsonLogic=="string"&&(i=t.jsonLogic);var l=["<","<=",">",">="],u=["==","!="],s=function(d,f,p,m,v){return o==0&&u.includes(i)?(0,ne.A)({},i,[r,null]):o==0?(0,ne.A)({},i,r):o==1?(0,ne.A)({},i,[r,a]):o==2&&l.includes(i)?(0,ne.A)({},i,[a[0],r,a[1]]):(0,ne.A)({},i,[r].concat((0,Fe.A)(a)))};return s},Jc=function(e,t,r,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,u=arguments.length>7&&arguments[7]!==void 0?arguments[7]:!1,s=t.get("field"),c=vr(e,i,s)||{},d=typeof c.jsonLogic=="function"?c.jsonLogic:zh(i,c,r,a),f=[r,i,a,Vt(c,oa),o,l],p=d.call.apply(d,[e.ctx].concat(f));return u&&(p={"!":p}),p};function Hh(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=qh(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(s){throw s},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,l;return{s:function(){t=t.call(n)},n:function(){var s=t.next();return i=s.done,s},e:function(s){o=!0,l=s},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function qh(n,e){if(n){if(typeof n=="string")return Yc(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Yc(n,e)}}function Yc(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function Xc(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Zc(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Xc(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Xc(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var ed=function(e){return(0,Er.A)(e)=="object"&&e!==null&&!Array.isArray(e)},Jh=function(e,t){return rd(e,t,!1)},rd=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a={errors:[]},i=kt(t,void 0,!1),o=tl([],e,i,a);return r?[o,a.errors]:(a.errors.length&&console.warn("Errors while exporting to MongoDb:",a.errors),o)},tl=function(e,t,r,a){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:void 0,u=arguments.length>7&&arguments[7]!==void 0?arguments[7]:void 0;if(t){var s=t.get("type");if(s==="group"||s==="rule_group")return Yh(e,t,r,a,i,o,l,u);if(s==="rule")return Xh(e,t,r,a,i,o,l,u)}},Yh=function(e,t,r,a){var i,o,l,u,s,c,d,f,p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,m=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,v=arguments.length>6&&arguments[6]!==void 0?arguments[6]:void 0,g=arguments.length>7&&arguments[7]!==void 0?arguments[7]:void 0,S=t.get("type"),y=t.get("properties")||new Se.Map,b=!!y.get("not"),F=t.get("children1")||new Se.List,A=r.settings,w=A.canShortMongoQuery,x=A.fieldSeparator,k=x,D=e.filter(function(cr){return cr.get("type")=="rule_group"}).length>0,I=e.filter(function(cr){return cr.get("type")=="rule_group"}).map(function(cr){return cr.get("properties").get("field")}).slice(-1).pop(),_=D&&I,G=S==="rule_group",M=G?y.get("field"):null,H=G?y.get("operator"):null,K=H&&vr(r,H,M)||null,z=H?(i=(o=K)===null||o===void 0?void 0:o.cardinality)!==null&&i!==void 0?i:1:void 0,U=wn(M,r,a,_),ee=Re(r,M)||{},Y=ee.mode,oe=M&&Y==="array"&&z>=1,ie=G&&Y!="struct",se=G&&F?.size>0,ce=G&&!(F!=null&&F.size),ge=!1,ye=b,ue=!1;se?(ue=b,ye=p):p&&(ye=!ye);var be=(l=K)===null||l===void 0?void 0:l.reversedOp,me=vr(r,be,M),Ce=!((u=K)!==null&&u!==void 0&&u.mongoFormatOp)&&!!((s=me)!==null&&s!==void 0&&s.mongoFormatOp),Me=!!((c=me)!==null&&c!==void 0&&c.mongoFormatOp),je=(d=Qo(t))===null||d===void 0?void 0:d.get("type"),Ie=!!r.settings.reverseOperatorsForNot&&(!G&&ye&&je==="rule"||ue&&F?.size===1);Ie&&(se?ue=!ue:ye=!ye,ge=!0);var Ve=ye&&G&&Me&&(!!r.settings.reverseOperatorsForNot||Ce);if(Ve){ye=!ye;var Ee=[be,H];H=Ee[0],be=Ee[1];var _e=[me,K];K=_e[0],me=_e[1]}var He=y.get("conjunction");He||(He=mn(r));var or=r.conjunctions[He];if(or){var We=or.reversedConj,Gr=ye&&((f=He)===null||f===void 0?void 0:f.toLowerCase())==="or"&&We&&!G&&!!r.settings.canShortMongoQuery&&!!r.settings.reverseOperatorsForNot;Gr&&(He=We,or=r.conjunctions[He],ye=!ye,ge=!0);var sr=or.mongoConj,xr=F.map(function(cr){return tl([].concat((0,Fe.A)(e),[t]),cr,r,a,ge,Y!="array",Y=="array"?function(Pt){return"$$el".concat(k).concat(Pt)}:void 0)}).filter(function(cr){return typeof cr<"u"});if(!(!oe&&!xr.size)){var lr;if(xr.size==1)lr=xr.first();else if(xr.size>1){var ct=xr.toList().toJS(),Lt=w&&sr=="$and";Lt&&(lr=ct.reduce(function(cr,Pt){if(cr){for(var _t in Pt){if(_t[0]=="$"){cr=void 0;break}if(cr[_t]==null)cr[_t]=Pt[_t];else{var Xr=cr[_t],ft=Pt[_t];ed(Xr)||(Xr={$eq:Xr}),ed(ft)||(ft={$eq:ft});var dr=Object.keys(Xr)[0],nt=Object.keys(ft)[0];if(dr==nt){cr=void 0;break}cr[_t]=Object.assign({},Xr,ft)}}return cr}},{})),lr||(lr=(0,ne.A)({},sr,ct))}if(M)if(Y=="array"){var dt={$size:{$ifNull:["$"+U,[]]}},wt=lr?{$size:{$ifNull:[{$filter:{input:"$"+U,as:"el",cond:lr}},[]]}}:dt;lr=tl(e,t.set("type","rule"),r,a,ue,!1,function(cr){return wt},dt),lr={$expr:lr}}else lr=(0,ne.A)({},U,{$elemMatch:lr});return ye&&(lr={$not:lr}),lr}}},Xh=function(e,t,r,a){var i,o,l,u,s,c,d,f=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,p=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,m=arguments.length>6&&arguments[6]!==void 0?arguments[6]:void 0,v=arguments.length>7&&arguments[7]!==void 0?arguments[7]:void 0,g=t.get("properties")||new Se.Map,S=e.filter(function(We){return We.get("type")=="rule_group"}).length>0,y=e.filter(function(We){return We.get("type")=="rule_group"}).map(function(We){return We.get("properties").get("field")}).slice(-1).pop(),b=S&&y,F=g.get("operator"),A=g.get("operatorOptions"),w=g.get("field"),x=g.get("fieldSrc"),k=g.get("value"),D=g.get("valueSrc"),I=g.get("valueType"),_=g.get("asyncListValues");if(!(w==null||F==null||k===void 0)){var G=Re(r,w),M=vr(r,F,w),H=(i=M)===null||i===void 0?void 0:i.reversedOp,K=vr(r,H,w),z=zr(M);if(!((o=M)!==null&&o!==void 0&&o.mongoFormatOp)&&!((l=K)!==null&&l!==void 0&&l.mongoFormatOp)){a.errors.push("Operator ".concat(F," is not supported"));return}var U=f,ee=!((u=M)!==null&&u!==void 0&&u.mongoFormatOp)&&!!((s=K)!==null&&s!==void 0&&s.mongoFormatOp),Y=!!((c=K)!==null&&c!==void 0&&c.mongoFormatOp),oe=Y&&(!!r.settings.reverseOperatorsForNot||ee),ie=oe&&U||ee,se=!1;if(ie){var ce=[H,F];F=ce[0],H=ce[1];var ge=[K,M];M=ge[0],K=ge[1],U=!U,se=!0}var ye,ue=!1;if(x=="func"){var be=td(a,r,w,b),me=(0,we.A)(be,2);ye=me[0],ue=me[1]}else ye=wn(w,r,a,b),m&&(ue=!0,ye=m(ye));if(ye!=null){var Ce=[],Me=[],je;if(k!=null){var Ie=k.map(function(We,Gr){var sr=D?D.get(Gr):null,xr=I?I.get(Gr):null,lr=Jn(We,sr,r),ct=Ir(r,w,F,sr),Lt=gt(r,w,F,ct,sr,{forExport:!0}),dt=nl(a,r,lr,sr,xr,Lt,G,b,F,M,_),wt=(0,we.A)(dt,2),cr=wt[0],Pt=wt[1];return cr!==void 0&&(ue=ue||Pt,Ce.push(sr),Me.push(xr)),cr}),Ve=Ie.filter(function(We){return We===void 0}).size>0;if(Ie.size<z||Ve)return;je=z>1?Ie.toArray():z==1?Ie.first():null}var Ee=ue&&p,_e=(d=M)===null||d===void 0?void 0:d.mongoFormatOp,He=[ye,F,v!==void 0&&je==null?v:je,ue,Ce.length>1?Ce:Ce[0],Me.length>1?Me:Me[0],Vt(M,oa),A,G],or=_e.call.apply(_e,[r.ctx].concat(He));return Ee&&(or={$expr:or}),U&&(or={$not:or}),or}}},nl=function(e,t,r,a,i,o,l,u,s,c,d){if(r===void 0)return[void 0,!1];var f,p=!1;if(a=="field"){var m=Zh(e,t,r,u),v=(0,we.A)(m,2);f=v[0],p=v[1]}else if(a=="func"){var g=td(e,t,r,u),S=(0,we.A)(g,2);f=S[0],p=S[1]}else if(typeof o?.mongoFormatValue=="function"){var y=o.mongoFormatValue,b=[r,Zc(Zc({},l?pn()(l,["fieldSettings","listValues"]):{}),{},{asyncListValues:d}),Vt(o,zn)];s&&(b.push(s),b.push(c)),f=y.call.apply(y,[t.ctx].concat(b))}else f=r;return[f,p]},Zh=function(e,t,r,a){var i=t.settings.fieldSeparator,o,l=!0;if(r){var u=Re(t,r)||{},s=_r(r,t),c=$a(r,t),d=c?c.join(i):null,f=t.settings.formatField,p=wn(r,t,e,a),m=f(p,s,d,u,t,!1);o="$"+m}return[o,l]},td=function(e,t,r,a){var i,o,l=!0,u,s=(i=r.get)===null||i===void 0?void 0:i.call(r,"func"),c=(o=r.get)===null||o===void 0?void 0:o.call(r,"args"),d=qr(t,s);if(!d)return e.errors.push("Func ".concat(s," is not defined in config")),[void 0,!1];var f=_r(s,t),p=f[f.length-1],m=d.mongoFunc||p,v=d.mongoArgsAsObject,g={},S=0,y=void 0,b=[],F=[];for(var A in d.args){var w;S++;var x=d.args[A],k=Re(t,x),D=x.defaultValue,I=x.isOptional,_=D!=null&&D.func?"func":"value",G=c?c.get(A):void 0,M=G?G.get("value"):void 0,H=G?G.get("valueSrc"):void 0;H!=="func"&&(w=M)!==null&&w!==void 0&&w.toJS&&(M=M.toJS());var K=G?G.get("asyncListValues"):void 0,z=null,U=Ir(t,x,z,H),ee=gt(t,x,z,U,H,{forExport:!0}),Y=nl(e,t,M,H,x.type,ee,k,a,null,null,K),oe=(0,we.A)(Y,2),ie=oe[0],se=oe[1];if(M!=null&&ie===void 0)return H!="func"&&e.errors.push("Can't format value of arg ".concat(A," for func ").concat(s)),[void 0,!1];var ce=void 0;if(ie===void 0&&!I&&D!=null){var ge=Ir(t,x,z,_),ye=gt(t,x,z,ge,_,{forExport:!0}),ue=void 0,be=nl(e,t,D,_,x.type,ye,k,a,null,null,K),me=(0,we.A)(be,2);if(ce=me[0],ue=me[1],ce===void 0)return _!="func"&&e.errors.push("Can't format default value of arg ".concat(A," for func ").concat(s)),[void 0,!1]}var Ce=ie??ce;if(Ce!==void 0){if(b.length){var Me=Hh(b),je;try{for(Me.s();!(je=Me.n()).done;){var Ie=je.value;g[Ie]=void 0}}catch(_e){Me.e(_e)}finally{Me.f()}b=[]}g[A]=Ce,y=Ce}else I||F.push(A),b.push(A)}if(F.length)return[void 0,!1];if(typeof d.mongoFormatFunc=="function"){var Ve=d.mongoFormatFunc,Ee=[g];u=Ve.call.apply(Ve,[t.ctx].concat(Ee))}else{if(d.mongoFormatFunc===null)return e.errors.push("Functon ".concat(m," is not supported")),[void 0,!1];v?u=(0,ne.A)({},m,g):S==1&&y!==void 0?u=(0,ne.A)({},m,y):u=(0,ne.A)({},m,Object.values(g))}return[u,l]};function ey(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=ry(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(s){throw s},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,l;return{s:function(){t=t.call(n)},n:function(){var s=t.next();return i=s.done,s},e:function(s){o=!0,l=s},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function ry(n,e){if(n){if(typeof n=="string")return nd(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return nd(n,e)}}function nd(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function ad(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function id(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ad(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ad(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var ty=function(e,t){return od(e,t,!1)},od=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a={errors:[]},i=kt(t,void 0,!1),o=ld(e,i,a);return r?[o,a.errors]:(a.errors.length&&console.warn("Errors while exporting to SQL:",a.errors),o)},ld=function(e,t,r){if(e){var a=e.get("type"),i=e.get("children1");if(a==="group"||a==="rule_group")return ny(e,t,r);if(a==="rule")return iy(e,t,r)}},ny=function(e,t,r){var a=e.get("type"),i=e.get("properties")||new Se.Map,o=e.get("children1")||new Se.List,l=a==="rule_group",u=l?i.get("field"):null,s=Re(t,u)||{},c=s.mode;c=="array"&&r.errors.push("Aggregation is not supported for ".concat(u));var d=i.get("not"),f=!1,p=o.map(function(g){return ld(g,t,r)}).filter(function(g){return typeof g<"u"});if(!(!f&&!p.size)){var m=i.get("conjunction");m||(m=mn(t));var v=t.conjunctions[m];return v.sqlFormatConj.call(t.ctx,p,m,d)}},ay=function(e,t){var r=t.sqlOp||e,a=zr(t),i;return a==0?i=function(l,u,s,c,d,f,p,m){return"".concat(l," ").concat(r)}:a==1?i=function(l,u,s,c,d,f,p,m){return"".concat(l," ").concat(r," ").concat(s)}:a==2&&(i=function(l,u,s,c,d,f,p,m){var v,g,S=s==null||(v=s.first)===null||v===void 0?void 0:v.call(s),y=s==null||(g=s.get)===null||g===void 0?void 0:g.call(s,1);return"".concat(l," ").concat(r," ").concat(S," AND ").concat(y)}),i},iy=function(e,t,r){var a=e.get("properties")||new Se.Map,i=a.get("field"),o=a.get("fieldSrc"),l=a.get("operator"),u=a.get("operatorOptions"),s=a.get("valueSrc"),c=a.get("valueType"),d=a.get("value"),f=a.get("asyncListValues");if(!(i==null||l==null)){var p=Re(t,i)||{},m=vr(t,l,i)||{},v=m.reversedOp,g=vr(t,v,i)||{},S=zr(m),y=!1,b=m.sqlOp||m.sqlFormatOp,F=g.sqlOp||g.sqlFormatOp;if(!b&&!F){r.errors.push("Operator ".concat(l," is not supported"));return}if(!b&&F){y=!0;var A=[v,l];l=A[0],v=A[1];var w=[g,m];m=w[0],g=w[1]}var x=[],k=[],D;if(d!=null){var I=d.map(function(z,U){var ee=s?s.get(U):null,Y=c?c.get(U):null,oe=Jn(z,ee,t),ie=Ir(t,i,l,ee),se=gt(t,i,l,ie,ee,{forExport:!0}),ce=al(r,t,oe,ee,Y,se,p,l,m,f);return ce!==void 0&&(x.push(ee),k.push(Y)),ce}),_=I.filter(function(z){return z===void 0}).size>0;if(_||I.size<S)return;D=S==1?I.first():I}var G=m.sqlFormatOp||ay(l,m);if(!G){r.errors.push("Operator ".concat(l," is not supported"));return}var M=o=="func"?sd(r,t,i):ud(r,t,i);if(M!=null){var H=[M,l,D,x.length>1?x:x[0],k.length>1?k:k[0],Vt(m,oa),u,p],K;if(K=G.call.apply(G,[t.ctx].concat(H)),y&&(K=t.settings.sqlFormatReverse.call(t.ctx,K)),K===void 0){r.errors.push("Operator ".concat(l," is not supported for value source ").concat(x.join(", ")));return}return K}}},al=function(e,t,r,a,i,o,l,u,s,c){if(r!==void 0){var d;if(a=="field")d=ud(e,t,r);else if(a=="func")d=sd(e,t,r);else if(typeof o?.sqlFormatValue=="function"){var f=o.sqlFormatValue,p=[r,id(id({},pn()(l,["fieldSettings","listValues"])),{},{asyncListValues:c}),Vt(o,zn)];if(u&&(p.push(u),p.push(s)),a=="field"){var m=Re(t,r)||{};p.push(m)}d=f.call.apply(f,[t.ctx].concat(p))}else Array.isArray(r)?d=r.map(function(v){return Nn.escape(v)}):d=Nn.escape(r);return d}},ud=function(e,t,r){if(r){var a=t.settings.fieldSeparator,i=Re(t,r)||{},o=_r(r,t),l=$a(r,t),u=l?l.join(a):null,s=t.settings.formatField,c=wn(r,t,e,null,{useTableName:!0}),d=s(c,o,u,i,t);return d}},sd=function(e,t,r){var a,i,o=(a=r.get)===null||a===void 0?void 0:a.call(r,"func"),l=(i=r.get)===null||i===void 0?void 0:i.call(r,"args"),u=qr(t,o);if(!u){e.errors.push("Func ".concat(o," is not defined in config"));return}var s=_r(o,t),c=s[s.length-1],d=u.sqlFunc||c,f={},p=[],m=[];for(var v in u.args){var g,S=u.args[v],y=Re(t,S),b=S.defaultValue,F=S.isOptional,A=b!=null&&b.func?"func":"value",w=l?l.get(v):void 0,x=w?w.get("value"):void 0,k=w?w.get("valueSrc"):void 0;k!=="func"&&(g=x)!==null&&g!==void 0&&g.toJS&&(x=x.toJS());var D=w?w.get("asyncListValues"):void 0,I=al(e,t,x,k,S.type,y,S,null,null,D);if(x!=null&&I===void 0){k!="func"&&e.errors.push("Can't format value of arg ".concat(v," for func ").concat(o));return}var _=void 0;if(I===void 0&&!F&&b!=null&&(_=al(e,t,b,A,S.type,y,S,null,null,D),_===void 0)){A!="func"&&e.errors.push("Can't format default value of arg ".concat(v," for func ").concat(o));return}var G=I??_;if(G!==void 0){if(p.length){var M=ey(v),H;try{for(M.s();!(H=M.n()).done;){var K=H.value;f[K]=void 0}}catch(oe){M.e(oe)}finally{M.f()}p=[]}f[v]=G}else F||m.push(v),p.push(v)}if(!m.length){var z;if(typeof u.sqlFormatFunc=="function"){var U=u.sqlFormatFunc,ee=[f];z=U.call.apply(U,[t.ctx].concat(ee))}else{var Y=Object.entries(f).map(function(oe){var ie=(0,we.A)(oe,2),se=ie[0],ce=ie[1];return ce}).join(", ");z="".concat(d,"(").concat(Y,")")}return z}};function cd(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function dd(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?cd(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):cd(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function oy(n){if(n==null)return null;var e=n.split(",").map(Number);return{top_left:{lat:e[0],lon:e[1]},bottom_right:{lat:e[2],lon:e[3]}}}function ly(n,e){if(n.length>1)return{gte:"".concat(n[0]),lte:"".concat(n[1])};var t=n[0];switch(e){case"on_date":case"not_on_date":case"equal":case"select_equals":case"not_equal":return{gte:"".concat(t,"||/d"),lte:"".concat(t,"||+1d")};case"less_or_equal":return{lte:"".concat(t)};case"greater_or_equal":return{gte:"".concat(t)};case"less":return{lt:"".concat(t)};case"greater":return{gt:"".concat(t)};default:return}}function uy(n){return{value:"*"+n+"*"}}function sy(n,e){switch(n){case"AND":return e?"must_not":"must";case"OR":return e?"should_not":"should";case"NOT":return e?"must":"must_not";default:return}}function cy(n){return{value:n}}function dy(n,e){return n}function fy(n,e,t,r,a,i){var o=dy(r,a);switch(n){case"filter":return{script:a.operators[t].elasticSearchScript(r,e)};case"exists":return{field:r};case"match":return(0,ne.A)({},o,e[0]);case"term":return i===vy?(0,ne.A)({},r,{value:e[0]}):(0,ne.A)({},r,e[0]);case"geo_bounding_box":return(0,ne.A)({},r,oy(e[0]));case"range":return(0,ne.A)({},r,ly(e,t));case"wildcard":return(0,ne.A)({},r,uy(e[0]));case"regexp":return(0,ne.A)({},r,cy(e[0]));default:return}}function fd(n,e,t,r,a,i){if(!(!n||!t||e==null)){var o=t,l=r.operators[o];if(l){var u=l,s=u.elasticSearchQueryType,c=!1;if(!s&&l.reversedOp){c=!0,o=l.reversedOp,l=r.operators[o];var d=l;s=d.elasticSearchQueryType}var f=Ir(r,n,o,a),p=r.widgets[f];if(p){var m=p.elasticSearchFormatValue,v;if(typeof s=="function"?v=s(f):v=s,!!v){var g;return typeof m=="function"?g=m(v,e,o,n,r):g=fy(v,e,o,n,r,i),c?{bool:{must_not:(0,ne.A)({},v,dd({},g))}}:(0,ne.A)({},v,dd({},g))}}}}}function py(n,e,t,r,a,i){if(!(!n||!n.size)){var o=n.valueSeq().toArray(),l=sy(e,t),u=o.map(function(c){return r(c,a,i)}).filter(function(c){return c!==void 0});if(u.length){var s=u.flat(1/0);return{bool:(0,ne.A)({},l,s)}}}}var vy="ES_7_SYNTAX",gy="ES_6_SYNTAX";function pd(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:gy,r=kt(e,void 0,!1);if(n){var a=n.get("type"),i=n.get("properties")||new Map;if(a==="rule"&&i.get("field")){var o,l,u,s=i.get("operator"),c=i.get("field"),d=i.get("fieldSrc"),f=(o=i.get("value"))===null||o===void 0?void 0:o.toJS(),p=(l=i.get("valueType"))===null||l===void 0?void 0:l.get(0),m=(u=i.get("valueSrc"))===null||u===void 0?void 0:u.get(0);return m==="func"||d=="func"?void 0:f&&Array.isArray(f[0])?f[0].map(function(y){return fd(c,[y],s,r,m,t)}):fd(c,f,s,r,m,t)}if(a==="group"||a==="rule_group"){var v=i.get("not"),g=i.get("conjunction");g||(g=mn(r));var S=n.get("children1");return py(S,g,v,pd,r,t)}}}var Xn=h(80045);function vd(n,e,t,r,a,i,o){try{var l=n[i](o),u=l.value}catch(s){return void t(s)}l.done?e(u):Promise.resolve(u).then(r,a)}function my(n){return function(){var e=this,t=arguments;return new Promise(function(r,a){var i=n.apply(e,t);function o(u){vd(i,r,a,o,l,"next",u)}function l(u){vd(i,r,a,o,l,"throw",u)}o(void 0)})}}var hy=["title","value","disabled","groupTitle","grouplabel","renderTitle","children","label","isCustom","isHidden"];function yy(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=Sy(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(s){throw s},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,l;return{s:function(){t=t.call(n)},n:function(){var s=t.next();return i=s.done,s},e:function(s){o=!0,l=s},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function Sy(n,e){if(n){if(typeof n=="string")return gd(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return gd(n,e)}}function gd(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function md(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function kn(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?md(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):md(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var Oy=function(e,t){if(e.findLastIndex)return e.findLastIndex(t);var r=(0,Fe.A)(e).reverse().findIndex(t);return r==-1?-1:e.length-1-r},by=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3;return function(){var a=my(Cn().mark(function i(o,l,u){var s,c,d,f,p,m,v,g;return Cn().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(s=u?.pageSize!=null?u.pageSize:t,c=lu(e).filter(function(b){var F=b.title,A=b.value;return o==null?!0:F.toUpperCase().indexOf(o.toUpperCase())!=-1||"".concat(A).toUpperCase().indexOf(o.toUpperCase())!=-1}),d=s?Math.ceil(c.length/s):0,f=l||0,p=s?Math.ceil(f/s):null,m=s?c.slice(f,f+s):c,v=s?f+m.length:null,g=s?v<c.length:!1,!r){y.next=11;break}return y.next=11,eu(r);case 11:return y.abrupt("return",{values:m,hasMore:g});case 12:case"end":return y.stop()}},i)}));return function(i,o,l){return a.apply(this,arguments)}}()},Fy=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!t)return e;var i=e||[],o=t.filter(function(u){return i.find(function(s){return""+s.value==""+u.value})==null}).map(function(u){return a?kn(kn({},u),{},{isHidden:!0}):u}),l=r?[].concat((0,Fe.A)(o),(0,Fe.A)(i)):[].concat((0,Fe.A)(i),(0,Fe.A)(o));return l},Ty=function(e,t,r){var a,i=e==null||e==""?void 0:(a=e?.value)!==null&&a!==void 0?a:e,o=vi(i,t),l=r&&!o?vo(i):void 0,u=o||l,s=u?[u]:void 0;return[i,s]},Ey=function(e,t,r){var a=e.map(function(o,l){var u,s=o==null||o==""?void 0:(u=o?.value)!==null&&u!==void 0?u:o,c=vi(s,t),d=r&&!c?vo(s):void 0,f=c||d;return f}).filter(function(o){return o!=null}),i=a.map(function(o){var l;return(l=o?.value)!==null&&l!==void 0?l:o});return i.length||(i=void 0),[i,a]},Cy=function(e){if(e==null)return null;var t=e.title,r=e.value,a=e.disabled,i=e.groupTitle,o=e.grouplabel,l=e.renderTitle,u=e.children,s=e.label,c=e.isCustom,d=e.isHidden,f=(0,Xn.A)(e,hy),p={value:r,title:t||s||u};return a&&(p.disabled=a),c&&(p.isCustom=c),d&&(p.isHidden=d),(i||o)&&(p.groupTitle=i||o),l&&(p.renderTitle=l),p=kn(kn({},p),f),p},Ay=function(e){var t=[],r=[],a=yy(e),i;try{var o=function(){var u=i.value,s=Oy(t,function(c){var d,f;return((d=c.groupTitle)!==null&&d!==void 0?d:"")==((f=u.groupTitle)!==null&&f!==void 0?f:"")});u.groupTitle!=null&&!r.includes(u.groupTitle)&&(r.push(u.groupTitle),r.length===1&&(t=t.map(function(c){return kn(kn({},c),{},{groupTitle:""})}))),u.groupTitle==null&&r.length&&(u=kn(kn({},u),{},{groupTitle:""})),s!=-1?t.splice(s+1,0,u):t.push(u)};for(a.s();!(i=a.n()).done;)o()}catch(l){a.e(l)}finally{a.f()}return t},Ly={label:"Now",returnType:"datetime",jsonLogic:"now",jsonLogicCustomOps:{now:{}},spelFunc:"T(java.time.LocalDateTime).now()",sqlFormatFunc:function(){return"NOW()"},mongoFormatFunc:function(){return new Date},formatFunc:function(){return"NOW"}},wy={label:"Relative",returnType:"datetime",renderBrackets:["",""],renderSeps:["","",""],spelFormatFunc:function(e){var t=e.date,r=e.op,a=e.val,i=e.dim,o=i.charAt(0).toUpperCase()+i.slice(1)+"s",l=r+o;return"".concat(t,".").concat(l,"(").concat(a,")")},spelImport:function(e){var t,r,a,i,o,l=(t=e.methodName)===null||t===void 0?void 0:t.match(/^(minus|plus)(\w+)s$/);if(l&&(o=l[2].toLowerCase(),a=l[1],["minus","plus"].includes(a)&&["day","week","month","year"].includes(o)))return a={type:"string",val:a},o={type:"string",val:o},i=e.args[0],r=e.obj,{date:r,op:a,val:i,dim:o}},jsonLogic:function(e){var t=e.date,r=e.op,a=e.val,i=e.dim;return{date_add:[t,a*(r=="minus"?-1:1),i]}},jsonLogicImport:function(e){var t=e.date_add[0],r=Math.abs(e.date_add[1]),a=e.date_add[1]>=0?"plus":"minus",i=e.date_add[2];return[t,a,r,i]},jsonLogicCustomOps:{date_add:{}},sqlFormatFunc:function(e){var t=e.date,r=e.op,a=e.val,i=e.dim;return"DATE_ADD(".concat(t,", INTERVAL ").concat(parseInt(a)*(r=="minus"?-1:1)," ").concat(i.replace(/^'|'$/g,""),")")},mongoFormatFunc:null,formatFunc:function(e){var t=e.date,r=e.op,a=e.val,i=e.dim;return a?"".concat(t," ").concat(r=="minus"?"-":"+"," ").concat(a," ").concat(i):t},args:{date:{label:"Date",type:"datetime",defaultValue:{func:"NOW",args:[]},valueSources:["func","field","value"],spelEscapeForFormat:!0},op:{label:"Op",type:"select",defaultValue:"plus",valueSources:["value"],mainWidgetProps:{customProps:{showSearch:!1}},fieldSettings:{listValues:{plus:"+",minus:"-"}},spelEscapeForFormat:!1},val:{label:"Value",type:"number",fieldSettings:{min:0},defaultValue:0,valueSources:["value"],spelEscapeForFormat:!1},dim:{label:"Dimension",type:"select",defaultValue:"day",valueSources:["value"],mainWidgetProps:{customProps:{showSearch:!1}},fieldSettings:{listValues:{day:"day",week:"week",month:"month",year:"year"}},spelEscapeForFormat:!1}}},xy={label:"Lowercase",mongoFunc:"$toLower",jsonLogic:"toLowerCase",spelFunc:"${str}.toLowerCase()",jsonLogicCustomOps:{toLowerCase:{}},returnType:"text",args:{str:{label:"String",type:"text",valueSources:["value","field","func"]}}},jy={label:"Uppercase",mongoFunc:"$toUpper",jsonLogic:"toUpperCase",spelFunc:"${str}.toUpperCase()",jsonLogicCustomOps:{toUpperCase:{}},returnType:"text",args:{str:{label:"String",type:"text",valueSources:["value","field","func"]}}},Ry={label:"Linear regression",returnType:"number",formatFunc:function(e,t){var r=e.coef,a=e.bias,i=e.val;return"(".concat(r," * ").concat(i," + ").concat(a,")")},sqlFormatFunc:function(e){var t=e.coef,r=e.bias,a=e.val;return"(".concat(t," * ").concat(a," + ").concat(r,")")},spelFormatFunc:function(e){var t=e.coef,r=e.bias,a=e.val;return"(".concat(t," * ").concat(a," + ").concat(r,")")},spelImport:function(e){var t,r,a,i;if(e.type==="op-plus"){var o=(0,we.A)(e.children,2);if(i=o[0],a=o[1],i.type==="op-multiply"){var l=(0,we.A)(i.children,2);return t=l[0],r=l[1],{coef:t,val:r,bias:a}}}},mongoFormatFunc:function(e){var t=e.coef,r=e.bias,a=e.val;return{$sum:[{$multiply:[t,a]},r]}},jsonLogic:function(e){var t=e.coef,r=e.bias,a=e.val;return{"+":[{"*":[t,a]},r]}},jsonLogicImport:function(e){var t=e["+"][0]["*"][0],r=e["+"][0]["*"][1],a=e["+"][1];return[t,r,a]},renderBrackets:["",""],renderSeps:[" * "," + "],args:{coef:{label:"Coef",type:"number",defaultValue:1,valueSources:["value"]},val:{label:"Value",type:"number",valueSources:["value","field"]},bias:{label:"Bias",type:"number",defaultValue:0,valueSources:["value"]}}},Iy=function(e,t,r,a,i,o,l,u,s,c,d,f){var p=typeof a=="string"&&!a.startsWith("$")?"$"+a:a,m=t(o,f);if(m!==void 0)return r?!l&&(!e||e=="$eq")?(0,ne.A)({},a,{$ne:m}):l?{$not:(0,ne.A)({},e,[p,m])}:(0,ne.A)({},a,{$not:(0,ne.A)({},e,m)}):!l&&(!e||e=="$eq")?(0,ne.A)({},a,m):l?(0,ne.A)({},e,[p,m]):(0,ne.A)({},a,(0,ne.A)({},e,m))},Py=function(e,t,r,a,i,o,l,u,s,c,d){var f=typeof r=="string"&&!r.startsWith("$")?"$"+r:r;return t?o?{$not:{$and:[(0,ne.A)({},e[0],[f,i[0]]),(0,ne.A)({},e[1],[f,i[1]])]}}:(0,ne.A)({},r,{$not:(0,ne.A)((0,ne.A)({},e[0],i[0]),e[1],i[1])}):o?{$and:[(0,ne.A)({},e[0],[f,i[0]]),(0,ne.A)({},e[1],[f,i[1]])]}:(0,ne.A)({},r,(0,ne.A)((0,ne.A)({},e[0],i[0]),e[1],i[1]))},Ny={utils:{SqlString:Nn,moment:sa(),mongoFormatOp1:Iy,mongoFormatOp2:Py,mongoEmptyValue:Au,escapeRegExp:Xl,sqlEmptyValue:Cu,stringifyForDisplay:wu,getTitleInListValues:uu,spelEscape:da,spelFixList:Lu,wrapWithBrackets:xu}};const Dy=Ny;function Vy(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=ky(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(s){throw s},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,l;return{s:function(){t=t.call(n)},n:function(){var s=t.next();return i=s.done,s},e:function(s){o=!0,l=s},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function ky(n,e){if(n){if(typeof n=="string")return hd(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return hd(n,e)}}function hd(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function yd(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function yr(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?yd(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):yd(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var My={AND:{label:"And",mongoConj:"$and",jsonLogicConj:"and",sqlConj:"AND",spelConj:"and",spelConjs:["and","&&"],reversedConj:"OR",formatConj:function(e,t,r,a){var i=e.size>1?e.join(" "+(a?"AND":"&&")+" "):e.first();return(e.size>1||r)&&(i=this.utils.wrapWithBrackets(i)),r&&(i="NOT "+i),i},sqlFormatConj:function(e,t,r){var a=e.size>1?e.join(" AND "):e.first();return(e.size>1||r)&&(a=this.utils.wrapWithBrackets(a)),r&&(a="NOT "+a),a},spelFormatConj:function(e,t,r,a){r&&(a=!1);var i=e.size>1?e.join(" && "):e.first();return(e.size>1||r)&&!a&&(i=this.utils.wrapWithBrackets(i)),r&&(i="!"+i),i}},OR:{label:"Or",mongoConj:"$or",jsonLogicConj:"or",sqlConj:"OR",spelConj:"or",spelConjs:["or","||"],reversedConj:"AND",formatConj:function(e,t,r,a){return e.size>1?(r?"NOT ":"")+"("+e.join(" "+(a?"OR":"||")+" ")+")":(r?"NOT (":"")+e.first()+(r?")":"")},sqlFormatConj:function(e,t,r){return e.size>1?(r?"NOT ":"")+"("+e.join(" OR ")+")":(r?"NOT (":"")+e.first()+(r?")":"")},spelFormatConj:function(e,t,r,a){return r&&(a=!1),e.size>1?(r?"!":"")+(a?"":"(")+e.join(" || ")+(a?"":")"):(r?"!(":"")+e.first()+(r?")":"")}}},_y={equal:{label:"==",labelForFormat:"==",sqlOp:"=",spelOp:"==",spelOps:["==","eq"],reversedOp:"not_equal",formatOp:function(e,t,r,a,i,o,l,u,s){var c=u?"=":o.label;return i=="boolean"&&u?r=="No"?"NOT ".concat(e):"".concat(e):"".concat(e," ").concat(c," ").concat(r)},mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$eq",function(i){return i},!1].concat(r))},jsonLogic:"==",elasticSearchQueryType:"term"},not_equal:{isNotOp:!0,label:"!=",labelForFormat:"!=",sqlOp:"<>",spelOp:"!=",spelOps:["!=","ne"],reversedOp:"equal",formatOp:function(e,t,r,a,i,o,l,u,s){return i=="boolean"&&u?r=="No"?"".concat(e):"NOT ".concat(e):"".concat(e," ").concat(o.label," ").concat(r)},mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$ne",function(i){return i},!1].concat(r))},jsonLogic:"!="},less:{label:"<",labelForFormat:"<",sqlOp:"<",spelOp:"<",spelOps:["<","lt"],reversedOp:"greater_or_equal",mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$lt",function(i){return i},!1].concat(r))},jsonLogic:"<",elasticSearchQueryType:"range"},less_or_equal:{label:"<=",labelForFormat:"<=",sqlOp:"<=",spelOp:"<=",spelOps:["<=","le"],reversedOp:"greater",mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$lte",function(i){return i},!1].concat(r))},jsonLogic:"<=",elasticSearchQueryType:"range"},greater:{label:">",labelForFormat:">",sqlOp:">",spelOp:">",spelOps:[">","gt"],reversedOp:"less_or_equal",mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$gt",function(i){return i},!1].concat(r))},jsonLogic:">",elasticSearchQueryType:"range"},greater_or_equal:{label:">=",labelForFormat:">=",sqlOp:">=",spelOp:">=",spelOps:[">=","ge"],reversedOp:"less",mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$gte",function(i){return i},!1].concat(r))},jsonLogic:">=",elasticSearchQueryType:"range"},like:{label:"Contains",labelForFormat:"Contains",reversedOp:"not_like",sqlOp:"LIKE",spelOp:"${0}.contains(${1})",valueTypes:["text"],mongoFormatOp:function(){for(var e,t=this,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=this.utils).mongoFormatOp1.apply(e,["$regex",function(o){return typeof o=="string"?t.utils.escapeRegExp(o):void 0},!1].concat(a))},jsonLogic:function(e,t,r){return{in:[r,e]}},jsonLogic2:"#in",valueSources:["value"],elasticSearchQueryType:"regexp"},not_like:{isNotOp:!0,label:"Not contains",reversedOp:"like",labelForFormat:"Not Contains",sqlOp:"NOT LIKE",mongoFormatOp:function(){for(var e,t=this,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=this.utils).mongoFormatOp1.apply(e,["$regex",function(o){return typeof o=="string"?t.utils.escapeRegExp(o):void 0},!0].concat(a))},jsonLogic:function(e,t,r){return{"!":{in:[r,e]}}},jsonLogic2:"#!in",_jsonLogicIsExclamationOp:!0,valueSources:["value"]},starts_with:{label:"Starts with",labelForFormat:"Starts with",sqlOp:"LIKE",spelOp:"${0}.startsWith(${1})",mongoFormatOp:function(){for(var e,t=this,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=this.utils).mongoFormatOp1.apply(e,["$regex",function(o){return typeof o=="string"?"^"+t.utils.escapeRegExp(o):void 0},!1].concat(a))},jsonLogic:void 0,valueSources:["value"]},ends_with:{label:"Ends with",labelForFormat:"Ends with",sqlOp:"LIKE",spelOp:"${0}.endsWith(${1})",mongoFormatOp:function(){for(var e,t=this,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=this.utils).mongoFormatOp1.apply(e,["$regex",function(o){return typeof o=="string"?t.utils.escapeRegExp(o)+"$":void 0},!1].concat(a))},jsonLogic:void 0,valueSources:["value"]},between:{label:"Between",labelForFormat:"BETWEEN",sqlOp:"BETWEEN",cardinality:2,formatOp:function(e,t,r,a,i,o,l,u){var s=r.first(),c=r.get(1);return u?"".concat(e," BETWEEN ").concat(s," AND ").concat(c):"".concat(e," >= ").concat(s," && ").concat(e," <= ").concat(c)},spelFormatOp:function(e,t,r,a,i,o,l,u){var s=r[0],c=r[1];return"".concat(e," >= ").concat(s," && ").concat(e," <= ").concat(c)},mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp2.apply(e,[["$gte","$lte"],!1].concat(r))},valueLabels:["Value from","Value to"],textSeparators:[null,"and"],reversedOp:"not_between",jsonLogic:"<=",validateValues:function(e){return e[0]!=null&&e[1]!=null?e[0]<=e[1]:null},elasticSearchQueryType:function(e){return e==="time"?"filter":"range"}},not_between:{isNotOp:!0,label:"Not between",labelForFormat:"NOT BETWEEN",sqlOp:"NOT BETWEEN",cardinality:2,formatOp:function(e,t,r,a,i,o,l,u){var s=r.first(),c=r.get(1);return u?"".concat(e," NOT BETWEEN ").concat(s," AND ").concat(c):"(".concat(e," < ").concat(s," || ").concat(e," > ").concat(c,")")},spelFormatOp:function(e,t,r,a,i,o,l,u){var s=r[0],c=r[1];return"(".concat(e," < ").concat(s," || ").concat(e," > ").concat(c,")")},mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp2.apply(e,[["$gte","$lte"],!0].concat(r))},valueLabels:["Value from","Value to"],textSeparators:[null,"and"],reversedOp:"between",jsonLogic:function(e,t,r){return{"!":{"<=":[Array.isArray(r)?r[0]:r,e,Array.isArray(r)?r[1]:r]}}},jsonLogic2:"!<=",_jsonLogicIsExclamationOp:!0,validateValues:function(e){return e[0]!=null&&e[1]!=null?e[0]<=e[1]:null}},is_empty:{label:"Is empty",labelForFormat:"IS EMPTY",cardinality:0,reversedOp:"is_not_empty",formatOp:function(e,t,r,a,i,o,l,u){return u?"".concat(e," IS EMPTY"):"!".concat(e)},sqlFormatOp:function(e,t,r,a,i,o,l,u){var s=this.utils.sqlEmptyValue(u);return"COALESCE(".concat(e,", ").concat(s,") = ").concat(s)},spelFormatOp:function(e,t,r,a,i,o,l,u){return"".concat(e," <= ''")},mongoFormatOp:function(){for(var e,t=this,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=this.utils).mongoFormatOp1.apply(e,["$in",function(o,l){return[t.utils.mongoEmptyValue(l),null]},!1].concat(a))},jsonLogic:"!"},is_not_empty:{isNotOp:!0,label:"Is not empty",labelForFormat:"IS NOT EMPTY",cardinality:0,reversedOp:"is_empty",formatOp:function(e,t,r,a,i,o,l,u){return u?"".concat(e," IS NOT EMPTY"):"!!".concat(e)},sqlFormatOp:function(e,t,r,a,i,o,l,u){var s=this.utils.sqlEmptyValue(u);return"COALESCE(".concat(e,", ").concat(s,") <> ").concat(s)},spelFormatOp:function(e,t,r,a,i,o,l,u){return"".concat(e," > ''")},mongoFormatOp:function(){for(var e,t=this,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=this.utils).mongoFormatOp1.apply(e,["$nin",function(o,l){return[t.utils.mongoEmptyValue(l),null]},!1].concat(a))},jsonLogic:"!!",elasticSearchQueryType:"exists"},is_null:{label:"Is null",labelForFormat:"IS NULL",sqlOp:"IS NULL",cardinality:0,reversedOp:"is_not_null",formatOp:function(e,t,r,a,i,o,l,u){return u?"".concat(e," IS NULL"):"!".concat(e)},spelFormatOp:function(e,t,r,a,i,o,l,u){return"".concat(e," == null")},mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$eq",function(i){return null},!1].concat(r))},jsonLogic:"=="},is_not_null:{label:"Is not null",labelForFormat:"IS NOT NULL",sqlOp:"IS NOT NULL",cardinality:0,reversedOp:"is_null",formatOp:function(e,t,r,a,i,o,l,u){return u?"".concat(e," IS NOT NULL"):"!!".concat(e)},spelFormatOp:function(e,t,r,a,i,o,l,u){return"".concat(e," != null")},mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$ne",function(i){return null},!1].concat(r))},jsonLogic:"!=",elasticSearchQueryType:"exists"},select_equals:{label:"==",labelForFormat:"==",sqlOp:"=",formatOp:function(e,t,r,a,i,o,l,u){var s=u?"=":"==";return"".concat(e," ").concat(s," ").concat(r)},spelOp:"==",spelOps:["==","eq"],mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$eq",function(i){return i},!1].concat(r))},reversedOp:"select_not_equals",jsonLogic:"==",elasticSearchQueryType:"term"},select_not_equals:{isNotOp:!0,label:"!=",labelForFormat:"!=",sqlOp:"<>",formatOp:function(e,t,r,a,i,o,l,u){return"".concat(e," != ").concat(r)},spelOp:"!=",spelOps:["!=","ne"],mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$ne",function(i){return i},!1].concat(r))},reversedOp:"select_equals",jsonLogic:"!="},select_any_in:{label:"Any in",labelForFormat:"IN",sqlOp:"IN",formatOp:function(e,t,r,a,i,o,l,u){return a=="value"?"".concat(e," IN (").concat(r.join(", "),")"):"".concat(e," IN (").concat(r,")")},sqlFormatOp:function(e,t,r,a,i,o,l,u){if(a=="value")return"".concat(e," IN (").concat(r.join(", "),")")},valueTypes:["multiselect"],spelOp:"${1}.contains(${0})",mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$in",function(i){return i},!1].concat(r))},reversedOp:"select_not_any_in",jsonLogic:"in",elasticSearchQueryType:"term"},select_not_any_in:{isNotOp:!0,label:"Not in",labelForFormat:"NOT IN",sqlOp:"NOT IN",formatOp:function(e,t,r,a,i,o,l,u){return a=="value"?"".concat(e," NOT IN (").concat(r.join(", "),")"):"".concat(e," NOT IN (").concat(r,")")},sqlFormatOp:function(e,t,r,a,i,o,l,u){if(a=="value")return"".concat(e," NOT IN (").concat(r.join(", "),")")},mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$nin",function(i){return i},!1].concat(r))},reversedOp:"select_any_in",jsonLogic:function(e,t,r){return{"!":{in:[e,r]}}},jsonLogic2:"!in",_jsonLogicIsExclamationOp:!0},multiselect_contains:{label:"Contains",labelForFormat:"CONTAINS",formatOp:function(e,t,r,a,i,o,l,u){return a=="value"?"".concat(e," CONTAINS [").concat(r.join(", "),"]"):"".concat(e," CONTAINS ").concat(r)},reversedOp:"multiselect_not_contains",jsonLogic2:"some-in",jsonLogic:function(e,t,r){return{some:[e,{in:[{var:""},r]}]}},spelOp:"T(CollectionUtils).containsAny(${0}, ${1})",elasticSearchQueryType:"term",mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$in",function(i){return i},!1].concat(r))}},multiselect_not_contains:{isNotOp:!0,label:"Not contains",labelForFormat:"NOT CONTAINS",formatOp:function(e,t,r,a,i,o,l,u){return a=="value"?"".concat(e," NOT CONTAINS [").concat(r.join(", "),"]"):"".concat(e," NOT CONTAINS ").concat(r)},reversedOp:"multiselect_contains",jsonLogic2:"!some-in",jsonLogic:function(e,t,r){return{"!":{some:[e,{in:[{var:""},r]}]}}},_jsonLogicIsExclamationOp:!0},multiselect_equals:{label:"Equals",labelForFormat:"==",sqlOp:"=",formatOp:function(e,t,r,a,i,o,l,u){var s=u?"=":"==";return a=="value"?"".concat(e," ").concat(s," [").concat(r.join(", "),"]"):"".concat(e," ").concat(s," ").concat(r)},sqlFormatOp:function(e,t,r,a,i,o,l,u){var s=this;if(a=="value")return"".concat(e," = '").concat(r.map(function(c){return s.utils.SqlString.trim(c)}).join(","),"'")},spelOp:"${0}.equals(${1})",mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$eq",function(i){return i},!1].concat(r))},reversedOp:"multiselect_not_equals",jsonLogic2:"all-in",jsonLogic:function(e,t,r){return{all:[e,{in:[{var:""},r]}]}},elasticSearchQueryType:"term"},multiselect_not_equals:{isNotOp:!0,label:"Not equals",labelForFormat:"!=",sqlOp:"<>",formatOp:function(e,t,r,a,i,o,l,u){return a=="value"?"".concat(e," != [").concat(r.join(", "),"]"):"".concat(e," != ").concat(r)},sqlFormatOp:function(e,t,r,a,i,o,l,u){var s=this;if(a=="value")return"".concat(e," != '").concat(r.map(function(c){return s.utils.SqlString.trim(c)}).join(","),"'")},mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$ne",function(i){return i},!1].concat(r))},reversedOp:"multiselect_equals",jsonLogic2:"!all-in",jsonLogic:function(e,t,r){return{"!":{all:[e,{in:[{var:""},r]}]}}},_jsonLogicIsExclamationOp:!0},proximity:{label:"Proximity search",cardinality:2,valueLabels:[{label:"Word 1",placeholder:"Enter first word"},{label:"Word 2",placeholder:"Enter second word"}],textSeparators:[],formatOp:function(e,t,r,a,i,o,l,u){var s=r.first(),c=r.get(1),d=l?.get("proximity");return"".concat(e," ").concat(s," NEAR/").concat(d," ").concat(c)},sqlFormatOp:function(e,t,r,a,i,o,l,u){var s=r.first(),c=r.get(1),d=this.utils.SqlString.trim(s),f=this.utils.SqlString.trim(c),p=l?.get("proximity");return"CONTAINS(".concat(e,", 'NEAR((").concat(d,", ").concat(f,"), ").concat(p,")')")},mongoFormatOp:void 0,jsonLogic:void 0,options:{optionLabel:"Near",optionTextBefore:"Near",optionPlaceholder:"Select words between",minProximity:2,maxProximity:10,defaults:{proximity:2}}},some:{label:"Some",labelForFormat:"SOME",cardinality:0,jsonLogic:"some",spelFormatOp:function(e){return"".concat(e," > 0")},mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$gt",function(i){return 0},!1].concat(r))}},all:{label:"All",labelForFormat:"ALL",cardinality:0,jsonLogic:"all",spelFormatOp:function(e,t,r){return"".concat(e," == ").concat(r)},mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$eq",function(i){return i},!1].concat(r))}},none:{label:"None",labelForFormat:"NONE",cardinality:0,jsonLogic:"none",spelFormatOp:function(e){return"".concat(e," == 0")},mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$eq",function(i){return 0},!1].concat(r))}}},Gy={text:{type:"text",jsType:"string",valueSrc:"value",valueLabel:"String",valuePlaceholder:"Enter string",formatValue:function(e,t,r,a){return a?this.utils.stringifyForDisplay(e):JSON.stringify(e)},spelFormatValue:function(e,t,r,a,i){return this.utils.spelEscape(e)},sqlFormatValue:function(e,t,r,a,i){return i.sqlOp=="LIKE"||i.sqlOp=="NOT LIKE"?this.utils.SqlString.escapeLike(e,a!="starts_with",a!="ends_with"):this.utils.SqlString.escape(e)},toJS:function(e,t){return e},mongoFormatValue:function(e,t,r){return e}},textarea:{type:"text",jsType:"string",valueSrc:"value",valueLabel:"Text",valuePlaceholder:"Enter text",formatValue:function(e,t,r,a){return a?this.utils.stringifyForDisplay(e):JSON.stringify(e)},sqlFormatValue:function(e,t,r,a,i){return i.sqlOp=="LIKE"||i.sqlOp=="NOT LIKE"?this.utils.SqlString.escapeLike(e,a!="starts_with",a!="ends_with"):this.utils.SqlString.escape(e)},spelFormatValue:function(e){return this.utils.spelEscape(e)},toJS:function(e,t){return e},mongoFormatValue:function(e,t,r){return e},fullWidth:!0},number:{type:"number",jsType:"number",valueSrc:"value",valueLabel:"Number",valuePlaceholder:"Enter number",valueLabels:[{label:"Number from",placeholder:"Enter number from"},{label:"Number to",placeholder:"Enter number to"}],formatValue:function(e,t,r,a){return a?this.utils.stringifyForDisplay(e):JSON.stringify(e)},sqlFormatValue:function(e,t,r,a,i){return this.utils.SqlString.escape(e)},spelFormatValue:function(e,t,r){var a=r.step&&!Number.isInteger(r.step);return this.utils.spelEscape(e,a)},toJS:function(e,t){return e},mongoFormatValue:function(e,t,r){return e}},slider:{type:"number",jsType:"number",valueSrc:"value",valueLabel:"Number",valuePlaceholder:"Enter number or move slider",formatValue:function(e,t,r,a){return a?this.utils.stringifyForDisplay(e):JSON.stringify(e)},sqlFormatValue:function(e,t,r,a,i){return this.utils.SqlString.escape(e)},spelFormatValue:function(e){return this.utils.spelEscape(e)},toJS:function(e,t){return e},mongoFormatValue:function(e,t,r){return e}},select:{type:"select",jsType:"string",valueSrc:"value",valueLabel:"Value",valuePlaceholder:"Select value",formatValue:function(e,t,r,a){var i=this.utils.getTitleInListValues(t.fieldSettings.listValues||t.asyncListValues,e);return a?this.utils.stringifyForDisplay(i):JSON.stringify(e)},sqlFormatValue:function(e,t,r,a,i){return this.utils.SqlString.escape(e)},spelFormatValue:function(e){return this.utils.spelEscape(e)},toJS:function(e,t){return e},mongoFormatValue:function(e,t,r){return e}},multiselect:{type:"multiselect",jsType:"array",valueSrc:"value",valueLabel:"Values",valuePlaceholder:"Select values",formatValue:function(e,t,r,a){var i=this,o=e.map(function(l){return i.utils.getTitleInListValues(t.fieldSettings.listValues||t.asyncListValues,l)});return a?o.map(this.utils.stringifyForDisplay):e.map(JSON.stringify)},sqlFormatValue:function(e,t,r,a,i){var o=this;return e.map(function(l){return o.utils.SqlString.escape(l)})},spelFormatValue:function(e,t,r,a,i){var o=i&&i.spelOp&&i.spelOp.startsWith("${1}"),l=this.utils.spelEscape(e);return o&&(l=this.utils.spelFixList(l)),l},toJS:function(e,t){return e},mongoFormatValue:function(e,t,r){return e}},date:{type:"date",jsType:"string",valueSrc:"value",dateFormat:"DD.MM.YYYY",valueFormat:"YYYY-MM-DD",valueLabel:"Date",valuePlaceholder:"Enter date",valueLabels:[{label:"Date from",placeholder:"Enter date from"},{label:"Date to",placeholder:"Enter date to"}],formatValue:function(e,t,r,a){var i=this.utils.moment(e,r.valueFormat);return a?i.format(r.dateFormat):JSON.stringify(e)},sqlFormatValue:function(e,t,r,a,i){var o=this.utils.moment(e,r.valueFormat);return this.utils.SqlString.escape(o.format("YYYY-MM-DD"))},spelFormatValue:function(e,t,r,a,i){var o=this.utils.moment(e,r.valueFormat),l=o.format("YYYY-MM-DD"),u="yyyy-MM-dd";return"T(java.time.LocalDate).parse('".concat(l,"', T(java.time.format.DateTimeFormatter).ofPattern('").concat(u,"'))")},spelImportFuncs:[{obj:{cls:["java","time","LocalDate"]},methodName:"parse",args:[{var:"v"},{obj:{cls:["java","time","format","DateTimeFormatter"]},methodName:"ofPattern",args:[{var:"fmt"}]}]}],spelImportValue:function(e,t,r){var a,i,o,l;if(!t)return[void 0,"No widget def to get value format"];if(r!=null&&(a=r.fmt)!==null&&a!==void 0&&(a=a.value)!==null&&a!==void 0&&(i=a.includes)!==null&&i!==void 0&&i.call(a," ")||(o=r.fmt)!==null&&o!==void 0&&(o=o.value)!==null&&o!==void 0&&(l=o.toLowerCase)!==null&&l!==void 0&&l.call(o).includes("hh:mm"))return[void 0,"Invalid date format ".concat(JSON.stringify(r.fmt))];var u=this.utils.moment(e.value,this.utils.moment.ISO_8601);return u.isValid()?[u.format(t?.valueFormat),[]]:[void 0,"Invalid date"]},jsonLogic:function(e,t,r){return this.utils.moment(e,r.valueFormat).toDate()},toJS:function(e,t){var r=this.utils.moment(e,t.valueFormat);return r.isValid()?r.toDate():void 0},mongoFormatValue:function(e,t,r){var a=this.utils.moment(e,r.valueFormat);return a.isValid()?a.toDate():void 0}},time:{type:"time",jsType:"string",valueSrc:"value",timeFormat:"HH:mm",valueFormat:"HH:mm:ss",use12Hours:!1,valueLabel:"Time",valuePlaceholder:"Enter time",valueLabels:[{label:"Time from",placeholder:"Enter time from"},{label:"Time to",placeholder:"Enter time to"}],formatValue:function(e,t,r,a){var i=this.utils.moment(e,r.valueFormat);return a?i.format(r.timeFormat):JSON.stringify(e)},sqlFormatValue:function(e,t,r,a,i){var o=this.utils.moment(e,r.valueFormat);return this.utils.SqlString.escape(o.format("HH:mm:ss"))},spelFormatValue:function(e,t,r,a,i){var o=this.utils.moment(e,r.valueFormat),l="HH:mm:ss",u=o.format("HH:mm:ss");return"T(java.time.LocalTime).parse('".concat(u,"')")},spelImportFuncs:["T(java.time.LocalTime).parse(${v})"],spelImportValue:function(e,t,r){var a,i,o;if(!t)return[void 0,"No widget def to get value format"];if(r!=null&&r.fmt&&(!((a=r.fmt)!==null&&a!==void 0&&(a=a.value)!==null&&a!==void 0&&(i=a.toLowerCase)!==null&&i!==void 0&&i.call(a).includes("hh:mm"))||(o=r.fmt)!==null&&o!==void 0&&(o=o.value)!==null&&o!==void 0&&o.includes(" ")))return[void 0,"Invalid time format ".concat(JSON.stringify(r.fmt))];var l=this.utils.moment(e.value,"HH:mm:ss");return l.isValid()?[l.format(t?.valueFormat),[]]:[void 0,"Invalid date"]},jsonLogic:function(e,t,r){var a=this.utils.moment(e,r.valueFormat);return a.get("hour")*60*60+a.get("minute")*60+a.get("second")},toJS:function(e,t){var r=this.utils.moment(e,t.valueFormat);return r.isValid()?r.get("hour")*60*60+r.get("minute")*60+r.get("second"):void 0},mongoFormatValue:function(e,t,r){var a=this.utils.moment(e,r.valueFormat);return a.get("hour")*60*60+a.get("minute")*60+a.get("second")},elasticSearchFormatValue:function(e,t,r,a){return{script:{script:{source:"doc[".concat(a,"][0].getHour() >== params.min && doc[").concat(a,"][0].getHour() <== params.max"),params:{min:t[0],max:t[1]}}}}}},datetime:{type:"datetime",jsType:"string",valueSrc:"value",timeFormat:"HH:mm",dateFormat:"DD.MM.YYYY",valueFormat:"YYYY-MM-DD HH:mm:ss",use12Hours:!1,valueLabel:"Datetime",valuePlaceholder:"Enter datetime",valueLabels:[{label:"Datetime from",placeholder:"Enter datetime from"},{label:"Datetime to",placeholder:"Enter datetime to"}],formatValue:function(e,t,r,a){var i=this.utils.moment(e,r.valueFormat);return a?i.format(r.dateFormat+" "+r.timeFormat):JSON.stringify(e)},sqlFormatValue:function(e,t,r,a,i){var o=this.utils.moment(e,r.valueFormat);return this.utils.SqlString.escape(o.toDate())},spelFormatValue:function(e,t,r,a,i){var o=this.utils.moment(e,r.valueFormat),l=o.format("YYYY-MM-DD HH:mm:ss"),u="yyyy-MM-dd HH:mm:ss";return"T(java.time.LocalDateTime).parse('".concat(l,"', T(java.time.format.DateTimeFormatter).ofPattern('").concat(u,"'))")},spelImportFuncs:[{obj:{cls:["java","time","LocalDateTime"]},methodName:"parse",args:[{var:"v"},{obj:{cls:["java","time","format","DateTimeFormatter"]},methodName:"ofPattern",args:[{var:"fmt"}]}]}],spelImportValue:function(e,t,r){var a,i;if(!t)return[void 0,"No widget def to get value format"];if(!(r!=null&&(a=r.fmt)!==null&&a!==void 0&&(a=a.value)!==null&&a!==void 0&&(i=a.includes)!==null&&i!==void 0&&i.call(a," ")))return[void 0,"Invalid datetime format ".concat(JSON.stringify(r.fmt))];var o=this.utils.moment(e.value,this.utils.moment.ISO_8601);return o.isValid()?[o.format(t?.valueFormat),[]]:[void 0,"Invalid date"]},jsonLogic:function(e,t,r){return this.utils.moment(e,r.valueFormat).toDate()},toJS:function(e,t){var r=this.utils.moment(e,t.valueFormat);return r.isValid()?r.toDate():void 0},mongoFormatValue:function(e,t,r){var a=this.utils.moment(e,r.valueFormat);return a.isValid()?a.toDate():void 0}},boolean:{type:"boolean",jsType:"boolean",valueSrc:"value",labelYes:"Yes",labelNo:"No",formatValue:function(e,t,r,a){return a?e?"Yes":"No":JSON.stringify(!!e)},sqlFormatValue:function(e,t,r,a,i){return this.utils.SqlString.escape(e)},spelFormatValue:function(e,t,r,a,i){return this.utils.spelEscape(e)},defaultValue:!1,toJS:function(e,t){return e},mongoFormatValue:function(e,t,r){return e}},field:{valueSrc:"field",formatValue:function(e,t,r,a,i,o,l){return a&&l.label||e},sqlFormatValue:function(e,t,r,a,i,o){return e},spelFormatValue:function(e,t,r,a,i){return e},valueLabel:"Field to compare",valuePlaceholder:"Select field to compare"},func:{valueSrc:"func",valueLabel:"Function",valuePlaceholder:"Select function"},case_value:{valueSrc:"value",type:"case_value",spelFormatValue:function(e){return this.utils.spelEscape(e===""?null:e)},spelImportValue:function(e){return[e.value,[]]},jsonLogic:function(e){return e===""?null:e}}},By={text:{defaultOperator:"equal",mainWidget:"text",widgets:{text:{operators:["equal","not_equal","like","not_like","starts_with","ends_with","proximity","is_empty","is_not_empty","is_null","is_not_null"],widgetProps:{},opProps:{}},textarea:{operators:["equal","not_equal","like","not_like","starts_with","ends_with","is_empty","is_not_empty","is_null","is_not_null"],widgetProps:{},opProps:{}},field:{operators:["equal","not_equal","proximity"]}}},number:{defaultOperator:"equal",mainWidget:"number",widgets:{number:{operators:["equal","not_equal","less","less_or_equal","greater","greater_or_equal","between","not_between","is_null","is_not_null"]},slider:{operators:["equal","not_equal","less","less_or_equal","greater","greater_or_equal","is_null","is_not_null"]}}},date:{defaultOperator:"equal",widgets:{date:{operators:["equal","not_equal","less","less_or_equal","greater","greater_or_equal","between","not_between","is_null","is_not_null"]}}},time:{defaultOperator:"equal",widgets:{time:{operators:["equal","not_equal","less","less_or_equal","greater","greater_or_equal","between","not_between","is_null","is_not_null"]}}},datetime:{defaultOperator:"equal",widgets:{datetime:{operators:["equal","not_equal","less","less_or_equal","greater","greater_or_equal","between","not_between","is_null","is_not_null"]}}},select:{mainWidget:"select",defaultOperator:"select_equals",widgets:{select:{operators:["select_equals","select_not_equals","is_null","is_not_null"]},multiselect:{operators:["select_any_in","select_not_any_in","is_null","is_not_null"]}}},multiselect:{defaultOperator:"multiselect_equals",widgets:{multiselect:{operators:["multiselect_contains","multiselect_not_contains","multiselect_equals","multiselect_not_equals","is_null","is_not_null"]}}},boolean:{defaultOperator:"equal",widgets:{boolean:{operators:["equal","not_equal","is_null","is_not_null"],widgetProps:{}},field:{operators:["equal","not_equal"]}}},"!group":{defaultOperator:"some",mainWidget:"number",widgets:{number:{widgetProps:{min:0},operators:["some","all","none","equal","not_equal","less","less_or_equal","greater","greater_or_equal","between","not_between"],opProps:{equal:{label:"Count =="},not_equal:{label:"Count !="},less:{label:"Count <"},less_or_equal:{label:"Count <="},greater:{label:"Count >"},greater_or_equal:{label:"Count >="},between:{label:"Count between"},not_between:{label:"Count not between"}}}}},case_value:{mainWidget:"case_value",widgets:{case_value:{widgetProps:{}}}}},Uy=yr(yr({},Ec),{},{convertableWidgets:{number:["slider","rangeslider"],slider:["number","rangeslider"],rangeslider:["number","slider"],text:["textarea"],textarea:["text"]},formatSpelField:function(e,t,r,a,i,o){var l=this,u=a.map(function(s,c){var d=s.key,f=s.parent,p=s.fieldSeparator;return c==0?f=="[map]"?"#this[".concat(l.utils.spelEscape(d),"]"):(f=="[class]",d):f=="map"||f=="[map]"?"[".concat(l.utils.spelEscape(d),"]"):(f=="class"||f=="[class]","".concat(p).concat(d))}).join("");return i.fieldName&&(u=e),i.isSpelVariable&&(u="#"+u),u},sqlFormatReverse:function(e){if(e!=null)return"NOT"+this.utils.wrapWithBrackets(e)},spelFormatReverse:function(e){if(e!=null)return"!"+this.utils.wrapWithBrackets(e)},formatReverse:function(e,t,r,a,i,o){if(e!=null)return o?"NOT "+this.utils.wrapWithBrackets(e):"!"+this.utils.wrapWithBrackets(e)},formatAggr:function(e,t,r,a,i,o,l,u,s,c){var d=l.labelForFormat,f=l.cardinality;if(f==0){var p=e?" HAVE ".concat(e):"";return"".concat(d," OF ").concat(t).concat(p)}else if(f==null||f==1){var m=e?" WHERE ".concat(e):"";return"COUNT OF ".concat(t).concat(m," ").concat(d," ").concat(a)}else if(f==2){var v=e?" WHERE ".concat(e):"",g=a.first(),S=a.get(1);return"COUNT OF ".concat(t).concat(v," ").concat(d," ").concat(g," AND ").concat(S)}},jsonLogic:{groupVarKey:"var",altVarKey:"var",lockedOp:"locked"},canCompareFieldWithField:function(e,t,r,a){return!0},valueSourcesInfo:{value:{label:"Value"},field:{label:"Field",widget:"field"},func:{label:"Function",widget:"func"}}}),Sd=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a={rangeslider:Qy,treeselect:Ky,treemultiselect:zy,rangeable__date:Wy("date","date")},i=Vy(t),o;try{for(i.s();!(o=i.n()).done;){var l=o.value,u=a[l];if(u)e=u(e,r);else throw new Error("Can't ".concat(r?"add":"remove"," mixin ").concat(l))}}catch(s){i.e(s)}finally{i.f()}return e},Od=function(e,t){return Sd(e,t,!0)},$y=function(e,t){return Sd(e,t,!1)},Wy=function(e,t){return function(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,i=r.types;return i=yr(yr({},i),{},(0,ne.A)({},e,yr(yr({},i[e]),{},{widgets:yr({},i[e].widgets)}))),a?i[e].widgets[t]=yr({opProps:{between:{isSpecialRange:!0,textSeparators:[null,null]},not_between:{isSpecialRange:!0,textSeparators:[null,null]}}},i[e].widgets[t]):delete i[e].widgets[t],yr(yr({},r),{},{types:i})}},Qy=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=e.widgets,a=e.types;return r=yr({},r),t?r.rangeslider=yr({type:"number",jsType:"number",valueSrc:"value",valueLabel:"Range",valuePlaceholder:"Select range",valueLabels:[{label:"Number from",placeholder:"Enter number from"},{label:"Number to",placeholder:"Enter number to"}],formatValue:function(o,l,u,s){return s?this.utils.stringifyForDisplay(o):JSON.stringify(o)},sqlFormatValue:function(o,l,u,s,c){return this.utils.SqlString.escape(o)},spelFormatValue:function(o){return this.utils.spelEscape(o)},singleWidget:"slider",toJS:function(o,l){return o}},r.rangeslider):delete r.rangeslider,a=yr(yr({},a),{},{number:yr(yr({},a.number),{},{widgets:yr({},a.number.widgets)})}),t?a.number.widgets.rangeslider=yr({opProps:{between:{isSpecialRange:!0},not_between:{isSpecialRange:!0}},operators:["between","not_between","is_null","is_not_null"]},a.number.widgets.rangeslider):delete a.number.widgets.rangeslider,yr(yr({},e),{},{widgets:r,types:a})},Ky=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=e.widgets,a=e.types;return r=yr({},r),t?r.treeselect=yr({type:"treeselect",jsType:"string",valueSrc:"value",valueLabel:"Value",valuePlaceholder:"Select value",formatValue:function(o,l,u,s){var c=l.fieldSettings.treeValues||l.fieldSettings.listValues||l.asyncListValues,d=this.utils.getTitleInListValues(c,o);return s?this.utils.stringifyForDisplay(d):JSON.stringify(o)},sqlFormatValue:function(o,l,u,s,c){return this.utils.SqlString.escape(o)},spelFormatValue:function(o){return this.utils.spelEscape(o)},toJS:function(o,l){return o}},r.treeselect):delete r.treeselect,a=yr({},a),t?a.treeselect=yr({mainWidget:"treeselect",defaultOperator:"select_equals",widgets:{treeselect:{operators:["select_equals","select_not_equals"]},treemultiselect:{operators:["select_any_in","select_not_any_in"]}}},a.treeselect):delete a.treeselect,yr(yr({},e),{},{widgets:r,types:a})},zy=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=e.widgets,a=e.types;return r=yr({},r),t?r.treemultiselect=yr({type:"treemultiselect",jsType:"array",valueSrc:"value",valueLabel:"Values",valuePlaceholder:"Select values",formatValue:function(o,l,u,s){var c=this,d=l.fieldSettings.treeValues||l.fieldSettings.listValues||l.asyncListValues,f=o.map(function(p){return c.utils.getTitleInListValues(d,p)});return s?f.map(this.utils.stringifyForDisplay):o.map(JSON.stringify)},sqlFormatValue:function(o,l,u,s,c){var d=this;return o.map(function(f){return d.utils.SqlString.escape(f)})},spelFormatValue:function(o){return this.utils.spelEscape(o)},toJS:function(o,l){return o}},r.treemultiselect):delete r.treemultiselect,a=yr({},a),t?a.treemultiselect=yr({defaultOperator:"multiselect_equals",widgets:{treemultiselect:{operators:["multiselect_equals","multiselect_not_equals"]}}},a.treemultiselect):delete a.treemultiselect,yr(yr({},e),{},{widgets:r,types:a})},Hy={addMixins:Od,removeMixins:$y},il={conjunctions:My,operators:_y,widgets:Gy,types:By,settings:Uy,ctx:Dy};il=Od(il,["rangeslider","treeselect","treemultiselect"]);const Vr=il;var bd="ADD_GROUP",ol="ADD_CASE_GROUP",Fd="REMOVE_GROUP",Td="SET_CONJUNCTION",Ed="SET_NOT",Cd="ADD_RULE",Ad="REMOVE_RULE",Ld="SET_FIELD",wd="SET_FIELD_SRC",xd="SET_OPERATOR",jd="SET_VALUE",Rd="SET_VALUE_SRC",Id="SET_FUNC_VALUE",Pd="SET_OPERATOR_OPTION",Nd="SET_LOCK",ll="SET_TREE",Dd="MOVE_ITEM",Vd="after",kd="before",ul="append",sl="prepend",Md="SET_DRAG_PROGRESS",_d="SET_DRAG_START",Gd="SET_DRAG_END",qy=h(73916),wi=h.n(qy);function Bd(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Sn(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Bd(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Bd(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function cl(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=Jy(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(s){throw s},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,l;return{s:function(){t=t.call(n)},n:function(){var s=t.next();return i=s.done,s},e:function(s){o=!0,l=s},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function Jy(n,e){if(n){if(typeof n=="string")return Ud(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ud(n,e)}}function Ud(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}var $d=function(e,t,r,a,i,o){var l,u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,s=arguments.length>7&&arguments[7]!==void 0?arguments[7]:{},c=e.getIn(Te(t));if(!c)return e;var d=(i==null||(l=i.get)===null||l===void 0?void 0:l.call(i,"id"))||a,f=o.settings.shouldCreateEmptyGroup,p=t.push(d),m=!f,v=!!(s!=null&&s.isDefaultCase),g=e;return e=Zn(e,t,r,d,Dn(o).merge((0,Se.fromJS)(i)||{}),o,u),e!==g&&(!u&&!v&&(e=e.setIn(Te(p,"children1"),new Se.default.OrderedMap),m&&(e=Zn(e,p,"rule",mr(),gn(o),o))),e=en(e)),e},Yy=function(e,t,r){var a=e.getIn(Te(t));if(!a)return e;e=dl(e,t);var i=r.settings.canLeaveEmptyGroup,o=t.slice(0,-1),l=!Oo(e,o);if(l&&!i&&(e=gi(e),So(e)&&!i)){var u=!1,s=!1;e=Zn(e,new Se.default.List,"rule",mr(),gn(r,void 0,void 0,u,s),r)}return e=en(e),e},Xy=function(e,t,r){var a=e.getIn(Te(t));if(!a)return e;e=dl(e,t);var i=r.settings.canLeaveEmptyGroup,o=t.pop(),l=e.getIn(Te(o)),u=l.getIn(["properties","field"]),s=l.getIn(["properties","operator"]),c=u?Re(r,u):null,d=s?vr(r,s,u):null,f=u&&s&&d.cardinality!=0,p=l.get("type")=="rule_group",m=!Oo(e,o),v=p?f&&c.initialEmptyWhere:i;if(m&&!v&&(p&&(e=e.deleteIn(Te(o))),e=gi(e),So(e)&&!i)){var g=!1,S=!1;e=Zn(e,new Se.default.List,"rule",mr(),gn(r,void 0,void 0,g,S),r)}return e=en(e),e},Zy=function(e,t,r){var a=e.getIn(Te(t));return a&&(e=e.setIn(Te(t,"properties","not"),r)),e},e0=function(e,t,r){var a=e.getIn(Te(t));return a&&(e=su(e.setIn(Te(t,"properties","isLocked"),r))),e},r0=function(e,t,r){var a=e.getIn(Te(t));return a&&(e=e.setIn(Te(t,"properties","conjunction"),r)),e},Zn=function(e,t,r,a,i,o){var l,u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null;if(r==="switch_group")throw new Error("Can't add switch_group programmatically");var s=e.getIn(Te(t));if(!s)return e;var c=(i==null||(l=i.get)===null||l===void 0?void 0:l.call(i,"id"))||a,d=o.settings,f=d.maxNumberOfCases,p=d.maxNumberOfRules,m=d.maxNesting,v=e.get("type"),g=v==="switch_group",S=g?e.getIn(Te(t.take(2))):null,y=Te(t,"children1"),b=e.getIn(y),F=!!b&&b.size,A=F?b.size:null,w,x;r==="case_group"?(w=A,x=f):r==="group"?(w=t.size,x=m):s?.get("type")==="rule_group"||(w=yo(g?S:e),x=p);var k=x&&w?w<x:!0,D={type:r,id:c,properties:i};s0(o,D,u);var I=r==="case_group"&&F&&b.last().get("children1")==null;if(k){var _=new Se.default.OrderedMap((0,ne.A)({},c,new Se.default.Map(D)));if(!F)e=e.setIn(y,_);else if(I){var G=b.last(),M=new Se.default.OrderedMap((0,ne.A)((0,ne.A)({},c,new Se.default.Map(D)),G.get("id"),G));e=e.deleteIn(Te(y,"children1",G.get("id"))),e=e.mergeIn(y,M)}else e=e.mergeIn(y,_);e=en(e)}return e},dl=function(e,t){return e=e.deleteIn(Te(t)),e=en(e),e},t0=function(e,t,r,a,i){var o=ua(e,t),l=t.pop(),u=t.size>1?ua(e,l):null,s=u?u.get("children1"):null,c=ua(e,r),d=a==ul||a==sl?r:r.pop(),f=a==ul||a==sl?c:r.size>1?ua(e,d):null,p=f?f.get("children1"):null;if(!u||!f||!o)return e;var m=u.get("id")==f.get("id"),v=d.size<l.size&&ui(d.toArray(),l.toArray().slice(0,d.size)),g=d.size>l.size&&ui(l.toArray(),d.toArray().slice(0,l.size)),S=null,y=null;v?S=Se.default.List(l.toArray().slice(d.size)):g&&(y=Se.default.List(d.toArray().slice(l.size)));var b=p,F=s;return g||(F=F.delete(o.get("id"))),m?b=F:v&&(b=b.updateIn(mo(S,"children1"),function(A){return F})),a==kd||a==Vd?b=Se.default.OrderedMap().withMutations(function(A){var w=cl(b.entries()),x;try{for(w.s();!(x=w.n()).done;){var k=(0,we.A)(x.value,2),D=k[0],I=k[1];D==c?.get("id")&&a==kd&&A.set(o.get("id"),o),A.set(D,I),D==c?.get("id")&&a==Vd&&A.set(o.get("id"),o)}}catch(_){w.e(_)}finally{w.f()}}):a==ul?b=b.merge(Se.default.OrderedMap((0,ne.A)({},o.get("id"),o))):a==sl&&(b=Se.default.OrderedMap((0,ne.A)({},o.get("id"),o)).merge(b)),g&&(F=F.updateIn(mo(y,"children1"),function(A){return b}),F=F.delete(o.get("id"))),!m&&!v&&(e=e.updateIn(Te(l,"children1"),function(A){return F})),g||(e=e.updateIn(Te(d,"children1"),function(A){return b})),e=en(e),e},n0=function(e,t,r,a){var i=e.getIn(Te(t));if(!i)return e;var o=a.settings.keepInputOnChangeFieldSrc,l=i.get("properties"),u=l?.get("field"),s=l?.get("fieldType"),c=Re(a,u),d=c?.type||s;(!d||d==="!group"||d==="!struct")&&(d=null);var f=!yi.includes(d),p=o&&!Bo(i,a)&&f;return p?(e=e.setIn(Te(t,"properties","field"),null),e=e.deleteIn(Te(t,"properties","fieldError")),e=e.setIn(Te(t,"properties","fieldType"),d)):e=e.setIn(Te(t,"properties"),gn(a,null,null,!1)),e=e.setIn(Te(t,"properties","fieldSrc"),r),e},a0=function(e,t,r,a,i,o,l,u,s){var c=arguments.length>9&&arguments[9]!==void 0?arguments[9]:{},d=t.getIn(Te(r));if(!d)return t;var f=a===-1,p=d.get("properties"),m=p.get("field"),v=p.get("value"),g=f?m:v.getIn([a]),S=[],y=g,b=cl(i||[]),F;try{for(b.s();!(F=b.n()).done;){var A=(0,we.A)(F.value,2),w=A[0],x=A[1];if(S.push([w,x,y]),w!==y.get("func")){var k=S.map(function(ge){var ye=(0,we.A)(ge,2),ue=ye[0],be=ye[1];return"".concat(ue,"(").concat(be,")")}).join("/")||"root";throw new Error("In ".concat(f?"LHS":"RHS"," for path ").concat(k," expected func key ").concat(w," but got ").concat(parent.get("func")))}y=y.getIn(["args",x,"value"])}}catch(ge){b.e(ge)}finally{b.f()}if(o){var _=y.get("func"),G=qr(e,_),M=G.args,H=M[o];u==="!valueSrc"?y=nc(y,o,l,H,e):y=Mo(y,o,l,H,e)}else{var D=l,I=!0;y=rc(y,D,e,I),c.canDropArgs=!0}for(var K=y;S.length;){var z=S.pop(),U=(0,we.A)(z,3),ee=U[0],Y=U[1],oe=U[2],ie=qr(e,ee),se=ie.args,ce=se[Y];K=Mo(oe,Y,K,ce,e)}return f?Wd(t,r,K,e,s,c):Qd(t,r,a,K,void 0,e,s,c)},Wd=function(e,t,r,a,i){var o,l,u,s,c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},d=e.getIn(Te(t));if(!d)return{state:e};var f=c.isEndValue,p=c.canDropArgs;if(!r)return e=dl(e,t),{state:e};var m=a.settings,v=m.fieldSeparator,g=m.setOpOnChangeField,S=m.showErrorMessage;Array.isArray(r)&&(r=r.join(v));var y=d.get("type"),b=d.get("properties"),F=y=="rule_group",A=b?.get("fieldSrc"),w=Re(a,r);if(!w)return console.warn("No config for LHS ".concat(r)),{state:e};var x=w.type;(x==="!group"||x==="!struct")&&(x=null);var k=b?.get("operator"),D=b?.get("operatorOptions"),I=b?.get("field"),_=w.type=="!group",G=_&&w.mode=="array",M=F!=_,H=w&&((o=w.operators)===null||o===void 0?void 0:o.indexOf(k))!==-1?k:null,K=A==="func"&&(I==null||(l=I.get)===null||l===void 0?void 0:l.call(I,"func"))===((u=r)===null||u===void 0||(s=u.get)===null||s===void 0?void 0:s.call(u,"func")),z=K&&!!H,U=null,ee=A==="func"?ic(a,x):Si(a,r);if(ee&&ee.length==1)U=ee[0];else if(z)U=H;else if(ee&&ee.length>1){var Y=cl(g),oe;try{for(Y.s();!(oe=Y.n()).done;){var ie=oe.value;if(ie=="keep"&&!M?U=H:ie=="default"?U=xo(a,r,!1):ie=="first"&&(U=_o(a,r)),U)break}}catch(Me){Y.e(Me)}finally{Y.f()}}if(!_&&!w.operators)return console.warn("Type ".concat(w.type," is not supported")),{state:e};F&&!_&&(e=e.setIn(Te(t,"type"),"rule"),e=e.deleteIn(Te(t,"children1")),e=e.setIn(Te(t,"properties"),new Se.default.OrderedMap)),b||(e=e.setIn(Te(t,"properties"),new Se.default.OrderedMap));var se=!S;if(_){e=e.setIn(Te(t,"type"),"rule_group");var ce=Hn(a,a,b,r,U,"field",se,f,p),ge=ce.canReuseValue,ye=ce.newValue,ue=ce.newValueSrc,be=ce.newValueType,me=ce.operatorCardinality,Ce=Dn(a,w).merge({field:r,fieldSrc:"field",mode:w.mode});G&&(Ce=Ce.merge({operator:U,value:ye,valueSrc:ue,valueType:be})),e=e.setIn(Te(t,"children1"),new Se.default.OrderedMap),e=e.setIn(Te(t,"properties"),Ce),w.initialEmptyWhere&&me==1||(e=Zn(e,t,"rule",mr(),gn(a,r),a)),e=en(e)}else e=e.updateIn(Te(t,"properties"),function(Me){return Me.withMutations(function(je){var Ie=Hn(a,a,je,r,U,"field",se,f,p),Ve=Ie.canReuseValue,Ee=Ie.newValue,_e=Ie.newValueSrc,He=Ie.newValueType,or=Ie.newValueError,We=Ie.newFieldError,Gr=Ie.fixedField,sr=r,xr=Gr!==r;xr&&(sr=Gr),S&&(je=je.set("fieldError",We),je=je.set("valueError",or));var lr=Ve?D:Ga(a,U,sr);return je=je.set("field",sr).delete("fieldType").set("fieldSrc",A).set("operator",U).set("operatorOptions",lr).set("value",Ee).set("valueSrc",_e).set("valueType",He),Ve||(je=je.delete("asyncListValues")),je})});return{state:e}},i0=function(e,t,r,a){var i=e.getIn(Te(t));if(!i)return e;var o=a.settings.showErrorMessage,l=i.get("properties"),u=i.get("children1"),s=l.get("field"),c=l.get("fieldSrc"),d=Re(a,s),f=d?.type=="!group",p=vr(a,r,s),m=p?zr(p):null,v=!0;return e=e.updateIn(Te(t,"properties"),function(g){return g.withMutations(function(S){var y=S.get("field"),b=S.get("operatorOptions"),F=S.get("value",new Se.default.List),A=S.get("valueSrc",new Se.default.List),w=S.get("operator"),x=Hn(a,a,S,y,r,"operator",v),k=x.canReuseValue,D=x.newValue,I=x.newValueSrc,_=x.newValueType,G=x.newValueError;o&&(S=S.set("valueError",G));var M=k?b:Ga(a,r,y);return k||(S=S.delete("asyncListValues")),S.set("operator",r).set("operatorOptions",M).set("value",D).set("valueSrc",I).set("valueType",_)})}),f&&m==0&&u.size==0&&(e=Zn(e,t,"rule",mr(),gn(a,s),a)),e},Qd=function(e,t,r,a,i,o,l){var u=arguments.length>7&&arguments[7]!==void 0?arguments[7]:{},s=e.getIn(Te(t));if(!s)return{state:e};var c=u.canDropArgs,d=u.isEndValue,f=o.settings,p=f.fieldSeparator,m=f.showErrorMessage,v=e.getIn(Te(t,"properties","valueSrc",r+""))||null;v==="field"&&Array.isArray(a)&&(a=a.join(p));var g=e.getIn(Te(t,"properties","field"))||null,S=e.getIn(Te(t,"properties","operator"))||null,y=vr(o,S,g),b=S?zr(y):null,F=i||oc(a,v,o),A=!m,w=pa(o,g,g,S,a,F,v,l,A,d,c),x=(0,we.A)(w,2),k=x[0],D=x[1],I=D?.find(function(oe){return!oe.fixed&&!oe.ignore}),_=I?rn(I):null,G=k!==a;G&&(a=k),e=Kd(e,t,o,b);var M=Array.from({length:b},function(oe,ie){return ie==r?a:e.getIn(Te(t,"properties","value",ie+""))||null}),H=Array.from({length:b},function(oe,ie){return e.getIn(Te(t,"properties","valueSrc",ie+""))||null}),K=Vo(o,g,S,M,H),z=K?rn(K):null,U=!_&&!z,ee=m?!0:U||G;if(ee&&(e=e.deleteIn(Te(t,"properties","asyncListValues")),typeof a>"u"?(e=e.setIn(Te(t,"properties","value",r),void 0),e=e.setIn(Te(t,"properties","valueType",r),null)):(l&&(e=e.setIn(Te(t,"properties","asyncListValues"),l)),e=e.setIn(Te(t,"properties","value",r),a),e=e.setIn(Te(t,"properties","valueType",r),F))),m){var Y=e.getIn(Te(t,"properties","valueError"));Y||(e=e.setIn(Te(t,"properties","valueError"),new Se.default.List(new Array(b)))),e=e.setIn(Te(t,"properties","valueError",r),_),b>=2&&(e=e.setIn(Te(t,"properties","valueError",b),z))}return{state:e}},o0=function(e,t,r,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},l=e.getIn(Te(t));if(!l)return e;var u=i.settings.showErrorMessage,s=e.getIn(Te(t,"properties","field"))||null,c=e.getIn(Te(t,"properties","operator"))||null,d=vr(i,c,s),f=c?zr(d):null;if(e=Kd(e,t,i,f),e=e.setIn(Te(t,"properties","value",r+""),void 0),e=e.setIn(Te(t,"properties","valueType",r+""),null),e=e.deleteIn(Te(t,"properties","asyncListValues")),u&&(e=e.setIn(Te(t,"properties","valueError",r),null),d.validateValues&&(e=e.setIn(Te(t,"properties","valueError",f),null))),typeof a>"u"?e=e.setIn(Te(t,"properties","valueSrc",r+""),null):e=e.setIn(Te(t,"properties","valueSrc",r+""),a),a){var p=e.getIn(Te(t,"properties")),m=!0,v=Hn(i,i,p,s,c,"valueSrc",m),g=v.canReuseValue,S=v.newValue,y=v.newValueSrc,b=v.newValueType,F=v.newValueError;!g&&y.get(r)==a&&(e=e.setIn(Te(t,"properties","value",r+""),S.get(r)),e=e.setIn(Te(t,"properties","valueType",r+""),b.get(r)))}return e},l0=function(e,t,r,a){var i=e.getIn(Te(t));return i?e.setIn(Te(t,"properties","operatorOptions",r),a):e},u0=function(e,t){var r=t.settings.canLeaveEmptyGroup;return r||(e=gi(e)),e},Kd=function(e,t,r,a){if(!a){var i=e.getIn(Te(t,"properties","field"))||null,o=e.getIn(Te(t,"properties","operator"))||null,l=vr(r,o,i);a=o?zr(l):null}for(var u=0,s=["value","valueType","valueError","valueSrc"];u<s.length;u++){var c=s[u];e.getIn(Te(t,"properties",c))||(e=e.setIn(Te(t,"properties",c),new Se.default.List(a?Array.from({length:a}):[])))}return e},s0=function n(e,t,r){r&&Array.isArray(r)&&(t.children1=new Se.default.OrderedMap(r.reduce(function(a,i){var o,l=(o=i.id)!==null&&o!==void 0?o:mr(),u=Sn(Sn({},i),{},{properties:rs(e,i).merge((0,Se.fromJS)(i.properties)||{}),id:l});return n(e,u,u.children1),Sn(Sn({},a),{},(0,ne.A)({},l,new Se.default.Map(u)))},{})))},c0=function(e,t){var r=e.getIn(Te(t,"properties","field"))||null;return r},zd={dragging:{id:null,x:null,y:null,w:null,h:null},mousePos:{},dragStart:{id:null}},d0=function(e,t){if(!e||!e.type)return null;var r=["config","asyncListValues"],a=[ll,_d,Md,Gd],i=wi()(fi()(e,r),so),o=e.path&&c0(t.tree,e.path)||e.field;if(o){var l;(l=o)!==null&&l!==void 0&&l.toJS&&(o=o.toJS()),i.affectedField=o}return(a.includes(e.type)||e.type.indexOf("@@redux")==0)&&(i=null),i};const f0=function(n,e,t,r,a){var i=e,o=Sn({tree:i},zd);return function(){var l,u,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:o,c=arguments.length>1?arguments[1]:void 0,d=(l=(u=a?.())!==null&&u!==void 0?u:c?.config)!==null&&l!==void 0?l:n,f={__lastAction:void 0},p={},m=d0(c,s);switch(c?.type){case ll:{var v=t(d,c.tree);p.tree=v;break}case ol:{p.tree=$d(s.tree,c.path,"case_group",c.id,c.properties,d,c.children,c.meta);break}case bd:{p.tree=$d(s.tree,c.path,"group",c.id,c.properties,d,c.children,c.meta);break}case Fd:{p.tree=Yy(s.tree,c.path,d);break}case Cd:{p.tree=Zn(s.tree,c.path,c.ruleType,c.id,c.properties,d,c.children);break}case Ad:{p.tree=Xy(s.tree,c.path,d);break}case Td:{p.tree=r0(s.tree,c.path,c.conjunction);break}case Ed:{p.tree=Zy(s.tree,c.path,c.not);break}case Ld:{var g=Wd(s.tree,c.path,c.field,d,c.asyncListValues,c._meta),S=g.state;p.tree=S;break}case wd:{p.tree=n0(s.tree,c.path,c.srcKey,d);break}case Nd:{p.tree=e0(s.tree,c.path,c.lock);break}case xd:{p.tree=i0(s.tree,c.path,c.operator,d);break}case jd:{var y=Qd(s.tree,c.path,c.delta,c.value,c.valueType,d,c.asyncListValues,c._meta),b=y.state;p.tree=b;break}case Id:{var F=a0(d,s.tree,c.path,c.delta,c.parentFuncs,c.argKey,c.value,c.valueType,c.asyncListValues,c._meta),A=F.state;p.tree=A;break}case Rd:{p.tree=o0(s.tree,c.path,c.delta,c.srcKey,d,c._meta);break}case Pd:{p.tree=l0(s.tree,c.path,c.name,c.value);break}case Dd:{p.tree=t0(s.tree,c.fromPath,c.toPath,c.placement,d);break}case _d:{p.dragStart=c.dragStart,p.dragging=c.dragging,p.mousePos=c.mousePos;break}case Md:{p.mousePos=c.mousePos,p.dragging=c.dragging;break}case Gd:{p.tree=u0(s.tree,d),p=Sn(Sn({},p),zd);break}default:break}return m&&(p.__lastAction=m),r&&p.tree&&s.tree&&r(s.tree),Sn(Sn(Sn({},s),f),p)}};var p0=function(e,t){return{type:ll,tree:t,config:e}},v0=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rule",i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null;return{type:Cd,ruleType:a,children:i,path:Hr(t),id:mr(),properties:gn(e,o).merge((0,Se.fromJS)(r)||{}),config:e}},g0=function(e,t){return{type:Ad,path:Hr(t),config:e}},m0=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return{type:ol,path:Hr(t),children:a,id:mr(),properties:Dn(e).merge((0,Se.fromJS)(r)||{}),config:e,meta:{isDefaultCase:!0}}},h0=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return{type:ol,path:Hr(t),children:a,id:mr(),properties:Dn(e).merge((0,Se.fromJS)(r)||{}),config:e}},y0=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return{type:bd,path:Hr(t),children:a,id:mr(),properties:Dn(e).merge((0,Se.fromJS)(r)||{}),config:e}},S0=function(e,t){return{type:Fd,path:Hr(t),config:e}},O0=function(e,t,r,a){return{type:Dd,fromPath:Hr(t),toPath:Hr(r),placement:a,config:e}},b0=function(e,t,r){return{type:Td,path:Hr(t),conjunction:r}},F0=function(e,t,r){return{type:Ed,path:Hr(t),not:r}},T0=function(e,t,r){return{type:Nd,path:Hr(t),lock:r}},E0=function(e,t,r,a,i){return{type:Ld,path:Hr(t),field:r,config:e,asyncListValues:a,_meta:i}},C0=function(e,t,r){return{type:wd,path:Hr(t),srcKey:r,config:e}},A0=function(e,t,r){return{type:xd,path:Hr(t),operator:r,config:e}},L0=function(e,t,r,a,i,o,l){return{type:jd,path:Hr(t),delta:r,value:a,valueType:i,asyncListValues:o,config:e,_meta:l}},w0=function(e,t,r,a,i){return{type:Rd,path:Hr(t),delta:r,srcKey:a,config:e,_meta:i}},x0=function(e,t,r,a,i,o,l,u,s){return{type:Id,path:Hr(t),delta:r,parentFuncs:a,argKey:i,value:o,valueType:l,asyncListValues:u,config:e,_meta:s}},j0=function(e,t,r,a){return{type:Pd,path:Hr(t),name:r,value:a,config:e}};function Hd(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function fl(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Hd(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Hd(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var tr=fl(fl(fl({},q),{},{Export:J,Import:Q,ConfigMixins:Hy},J),Q),R0=h(5556),R=h.n(R0);const I0=f0,Qa=T.createContext();var P0=h(14644),N0=h(19888),D0=h(69242),V0=h(40961);function k0(n){n()}let qd=k0;const M0=n=>qd=n,_0=()=>qd,Jd=Symbol.for("react-redux-context"),Yd=typeof globalThis<"u"?globalThis:{};function G0(){var n;if(!T.createContext)return{};const e=(n=Yd[Jd])!=null?n:Yd[Jd]=new Map;let t=e.get(T.createContext);return t||(t=T.createContext(null),e.set(T.createContext,t)),t}const Xd=G0(),SE=null;function OE(n=ReactReduxContext){return function(){return useContext(n)}}const bE=null;let Zd=null;const B0=n=>{Zd=n},U0=(n,e)=>n===e;function FE(n=ReactReduxContext){const e=n===ReactReduxContext?useDefaultReduxContext:createReduxContextHook(n);return function(r,a={}){const{equalityFn:i=U0,stabilityCheck:o=void 0,noopCheck:l=void 0}=typeof a=="function"?{equalityFn:a}:a,{store:u,subscription:s,getServerState:c,stabilityCheck:d,noopCheck:f}=e(),p=useRef(!0),m=useCallback({[r.name](g){return r(g)}}[r.name],[r,d,o]),v=Zd(s.addNestedSub,u.getState,c||u.getState,m,i);return useDebugValue(v),v}}const TE=null;var ur=h(58168),ef=h(98587),$0=h(4146),rf=h.n($0),W0=h(44363);const Q0=["initMapStateToProps","initMapDispatchToProps","initMergeProps"];function K0(n,e,t,r,{areStatesEqual:a,areOwnPropsEqual:i,areStatePropsEqual:o}){let l=!1,u,s,c,d,f;function p(y,b){return u=y,s=b,c=n(u,s),d=e(r,s),f=t(c,d,s),l=!0,f}function m(){return c=n(u,s),e.dependsOnOwnProps&&(d=e(r,s)),f=t(c,d,s),f}function v(){return n.dependsOnOwnProps&&(c=n(u,s)),e.dependsOnOwnProps&&(d=e(r,s)),f=t(c,d,s),f}function g(){const y=n(u,s),b=!o(y,c);return c=y,b&&(f=t(c,d,s)),f}function S(y,b){const F=!i(b,s),A=!a(y,u,b,s);return u=y,s=b,F&&A?m():F?v():A?g():f}return function(b,F){return l?S(b,F):p(b,F)}}function z0(n,e){let{initMapStateToProps:t,initMapDispatchToProps:r,initMergeProps:a}=e,i=(0,ef.A)(e,Q0);const o=t(n,i),l=r(n,i),u=a(n,i);return K0(o,l,u,n,i)}function H0(n,e){const t={};for(const r in n){const a=n[r];typeof a=="function"&&(t[r]=(...i)=>e(a(...i)))}return t}function pl(n){return function(t){const r=n(t);function a(){return r}return a.dependsOnOwnProps=!1,a}}function tf(n){return n.dependsOnOwnProps?!!n.dependsOnOwnProps:n.length!==1}function nf(n,e){return function(r,{displayName:a}){const i=function(l,u){return i.dependsOnOwnProps?i.mapToProps(l,u):i.mapToProps(l,void 0)};return i.dependsOnOwnProps=!0,i.mapToProps=function(l,u){i.mapToProps=n,i.dependsOnOwnProps=tf(n);let s=i(l,u);return typeof s=="function"&&(i.mapToProps=s,i.dependsOnOwnProps=tf(s),s=i(l,u)),s},i}}function vl(n,e){return(t,r)=>{throw new Error(`Invalid value of type ${typeof n} for ${e} argument when connecting component ${r.wrappedComponentName}.`)}}function q0(n){return n&&typeof n=="object"?pl(e=>H0(n,e)):n?typeof n=="function"?nf(n,"mapDispatchToProps"):vl(n,"mapDispatchToProps"):pl(e=>({dispatch:e}))}function J0(n){return n?typeof n=="function"?nf(n,"mapStateToProps"):vl(n,"mapStateToProps"):pl(()=>({}))}function Y0(n,e,t){return(0,ur.A)({},t,n,e)}function X0(n){return function(t,{displayName:r,areMergedPropsEqual:a}){let i=!1,o;return function(u,s,c){const d=n(u,s,c);return i?a(d,o)||(o=d):(i=!0,o=d),o}}}function Z0(n){return n?typeof n=="function"?X0(n):vl(n,"mergeProps"):()=>Y0}function eS(){const n=_0();let e=null,t=null;return{clear(){e=null,t=null},notify(){n(()=>{let r=e;for(;r;)r.callback(),r=r.next})},get(){let r=[],a=e;for(;a;)r.push(a),a=a.next;return r},subscribe(r){let a=!0,i=t={callback:r,next:null,prev:t};return i.prev?i.prev.next=i:e=i,function(){!a||e===null||(a=!1,i.next?i.next.prev=i.prev:t=i.prev,i.prev?i.prev.next=i.next:e=i.next)}}}}const af={notify(){},get:()=>[]};function of(n,e){let t,r=af,a=0,i=!1;function o(v){c();const g=r.subscribe(v);let S=!1;return()=>{S||(S=!0,g(),d())}}function l(){r.notify()}function u(){m.onStateChange&&m.onStateChange()}function s(){return i}function c(){a++,t||(t=e?e.addNestedSub(u):n.subscribe(u),r=eS())}function d(){a--,t&&a===0&&(t(),t=void 0,r.clear(),r=af)}function f(){i||(i=!0,c())}function p(){i&&(i=!1,d())}const m={addNestedSub:o,notifyNestedSubs:l,handleChangeWrapper:u,isSubscribed:s,trySubscribe:f,tryUnsubscribe:p,getListeners:()=>r};return m}const xi=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?T.useLayoutEffect:T.useEffect;function lf(n,e){return n===e?n!==0||e!==0||1/n===1/e:n!==n&&e!==e}function gl(n,e){if(lf(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;const t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(let a=0;a<t.length;a++)if(!Object.prototype.hasOwnProperty.call(e,t[a])||!lf(n[t[a]],e[t[a]]))return!1;return!0}const rS=()=>{throw new Error("uSES not initialized!")},tS=["reactReduxForwardedRef"];let uf=rS;const nS=n=>{uf=n},aS=null,iS=[null,null],CE=n=>{try{return JSON.stringify(n)}catch{return String(n)}};function oS(n,e,t){xi(()=>n(...e),t)}function lS(n,e,t,r,a,i){n.current=r,t.current=!1,a.current&&(a.current=null,i())}function uS(n,e,t,r,a,i,o,l,u,s,c){if(!n)return()=>{};let d=!1,f=null;const p=()=>{if(d||!l.current)return;const v=e.getState();let g,S;try{g=r(v,a.current)}catch(y){S=y,f=y}S||(f=null),g===i.current?o.current||s():(i.current=g,u.current=g,o.current=!0,c())};return t.onStateChange=p,t.trySubscribe(),p(),()=>{if(d=!0,t.tryUnsubscribe(),t.onStateChange=null,f)throw f}}const AE=()=>aS;function sS(n,e){return n===e}let LE=!1;function cS(n,e,t,{pure:r,areStatesEqual:a=sS,areOwnPropsEqual:i=gl,areStatePropsEqual:o=gl,areMergedPropsEqual:l=gl,forwardRef:u=!1,context:s=Xd}={}){const c=s,d=J0(n),f=q0(e),p=Z0(t),m=!!n;return g=>{const S=g.displayName||g.name||"Component",y=`Connect(${S})`,b={shouldHandleStateChanges:m,displayName:y,wrappedComponentName:S,WrappedComponent:g,initMapStateToProps:d,initMapDispatchToProps:f,initMergeProps:p,areStatesEqual:a,areStatePropsEqual:o,areOwnPropsEqual:i,areMergedPropsEqual:l};function F(x){const[k,D,I]=T.useMemo(()=>{const{reactReduxForwardedRef:Ve}=x,Ee=(0,ef.A)(x,tS);return[x.context,Ve,Ee]},[x]),_=T.useMemo(()=>k&&k.Consumer&&(0,W0.isContextConsumer)(T.createElement(k.Consumer,null))?k:c,[k,c]),G=T.useContext(_),M=!!x.store&&!!x.store.getState&&!!x.store.dispatch,H=!!G&&!!G.store,K=M?x.store:G.store,z=H?G.getServerState:K.getState,U=T.useMemo(()=>z0(K.dispatch,b),[K]),[ee,Y]=T.useMemo(()=>{if(!m)return iS;const Ve=of(K,M?void 0:G.subscription),Ee=Ve.notifyNestedSubs.bind(Ve);return[Ve,Ee]},[K,M,G]),oe=T.useMemo(()=>M?G:(0,ur.A)({},G,{subscription:ee}),[M,G,ee]),ie=T.useRef(),se=T.useRef(I),ce=T.useRef(),ge=T.useRef(!1),ye=T.useRef(!1),ue=T.useRef(!1),be=T.useRef();xi(()=>(ue.current=!0,()=>{ue.current=!1}),[]);const me=T.useMemo(()=>()=>ce.current&&I===se.current?ce.current:U(K.getState(),I),[K,I]),Ce=T.useMemo(()=>Ee=>ee?uS(m,K,ee,U,se,ie,ge,ue,ce,Y,Ee):()=>{},[ee]);oS(lS,[se,ie,ge,I,ce,Y]);let Me;try{Me=uf(Ce,me,z?()=>U(z(),I):me)}catch(Ve){throw be.current&&(Ve.message+=`
The error may be correlated with this previous error:
${be.current.stack}

`),Ve}xi(()=>{be.current=void 0,ce.current=void 0,ie.current=Me});const je=T.useMemo(()=>T.createElement(g,(0,ur.A)({},Me,{ref:D})),[D,g,Me]);return T.useMemo(()=>m?T.createElement(_.Provider,{value:oe},je):je,[_,je,oe])}const w=T.memo(F);if(w.WrappedComponent=g,w.displayName=F.displayName=y,u){const k=T.forwardRef(function(I,_){return T.createElement(w,(0,ur.A)({},I,{reactReduxForwardedRef:_}))});return k.displayName=y,k.WrappedComponent=g,rf()(k,g)}return rf()(w,g)}}const ji=cS;function dS({store:n,context:e,children:t,serverState:r,stabilityCheck:a="once",noopCheck:i="once"}){const o=T.useMemo(()=>{const s=of(n);return{store:n,subscription:s,getServerState:r?()=>r:void 0,stabilityCheck:a,noopCheck:i}},[n,r,a,i]),l=T.useMemo(()=>n.getState(),[n]);xi(()=>{const{subscription:s}=o;return s.onStateChange=s.notifyNestedSubs,s.trySubscribe(),l!==n.getState()&&s.notifyNestedSubs(),()=>{s.tryUnsubscribe(),s.onStateChange=void 0}},[o,l]);const u=e||Xd;return T.createElement(u.Provider,{value:o},t)}const fS=dS;function wE(n=ReactReduxContext){const e=n===ReactReduxContext?useDefaultReduxContext:createReduxContextHook(n);return function(){const{store:r}=e();return r}}const xE=null;function jE(n=ReactReduxContext){const e=n===ReactReduxContext?useDefaultStore:createStoreHook(n);return function(){return e().dispatch}}const RE=null;B0(D0.useSyncExternalStoreWithSelector),nS(N0.useSyncExternalStore),M0(V0.unstable_batchedUpdates);var IE="ADD_GROUP",PE="ADD_CASE_GROUP",NE="REMOVE_GROUP",DE="SET_CONJUNCTION",VE="SET_NOT",kE="ADD_RULE",ME="REMOVE_RULE",_E="SET_FIELD",GE="SET_FIELD_SRC",BE="SET_OPERATOR",UE="SET_VALUE",$E="SET_VALUE_SRC",WE="SET_OPERATOR_OPTION",QE="SET_LOCK",KE="SET_TREE",zE="MOVE_ITEM",Ri="after",Ii="before",ea="append",ya="prepend",pS="SET_DRAG_PROGRESS",vS="SET_DRAG_START",gS="SET_DRAG_END",mS=function(e,t){return{type:pS,mousePos:e,dragging:t}},hS=function(e,t,r){return{type:vS,dragStart:e,dragging:t,mousePos:r}},yS=function(){return{type:gS}},sf=Le,SS=re,OS=Ne,bS=function(e){var t;return(t=e?.cardinality)!==null&&t!==void 0?t:1},Pi=function(e,t,r){if(!t||!e||e.length<=t)return e;var a=e.substr(0,t-1);return(r?a.substr(0,a.lastIndexOf(" ")):a)+"..."},ra=function(e,t){return e===t?!0:e?.equals(t)},ta=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return e===t?!0:Array.isArray(e)?FS(e,t,r):e&&typeof e.equals=="function"?e.equals(t):(0,Er.A)(e)==="object"?TS(e,t,r):e===t};function FS(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(n===e)return!0;if(!n||!e)return!1;var r=n.length;if(e.length!==r)return!1;for(var a=0;a<r;a++){var i=t?ta(n[a],e[a],t):n[a]===e[a];if(!i)return!1}return!0}function TS(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(n===e)return!0;if(!n||!e)return!1;var r=Object.keys(n),a=Object.keys(e),i=r.length;if(a.length!==i)return!1;for(var o=0;o<i;o++){var l=r[o],u=t?ta(n[l],e[l],t):n[l]===e[l];if(!u)return!1}return!0}var ES=function(){return typeof process<"u"&&process.env&&!1},CS=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=e??ES();return t?console:{error:function(){},log:function(){},warn:function(){},debug:function(){},info:function(){}}},AS=CS(),cf=tr.Validation.validateAndFixTree,LS=function(){var e,t,r;return function(a,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;return i?(a.__configId===r&&(ra(i,e)||ra(i,t))||(r=a.__configId,e=i,l===!1?t=cf(i,null,a,o||a,!1,!1,!1):t=cf(i,null,a,o||a)),t):null}},wS=function(e){if(e._reactRootContainer)return"root";if(Object.getOwnPropertyNames(e).filter(function(t){return t.startsWith("__reactContainer")}).length>0)return"container"},xS=function n(e){if(e){var t=wS(e);return t!==void 0?t:n(e.parentNode)}},df=function(e){return xS(e)==="root"},Ni=function(e,t){return function(r,a){var i=e.props,o=e.state,l=r!=i||a!=o;if(l&&o==a&&i!=r){var u=[];for(var s in r){var c=r[s]!=i[s];c&&(t[s]=="ignore"?c=!1:t[s]=="shallow_deep"?c=!ta(r[s],i[s],!0):t[s]=="shallow"?c=!ta(r[s],i[s]):typeof t[s]=="function"&&(c=t[s](r[s],i[s],r,i))),c&&u.push(s)}u.length||(l=!1)}return l}},Sa=function(e){return function(t,r){return!ta(e.props,t)||!ta(e.state,r)}},jS=function(){var e=T.version.split(".").map(parseInt.bind(null,10));return e[0]==16&&e[1]<3||e[0]<16},Et=function(e){if(e.shouldComponentUpdate||(e.shouldComponentUpdate=Sa(e)),jS())e.componentWillReceiveProps=function(a){e.onPropsChanged(a)};else{var t=e.shouldComponentUpdate,r=function(i,o){var l=!ta(e.props,i);l&&e.onPropsChanged(i);var u=t.call(e,i,o);return u};e.shouldComponentUpdate=r.bind(e)}},ff=function(e,t,r){return wi()(e,function(a){return function(){for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return r(a.apply(void 0,[t].concat(o)))}})};function pf(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function ml(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?pf(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):pf(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function RS(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,vf()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function vf(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(vf=function(){return!!n})()}var gf=function(n){function e(t){var r;(0,br.A)(this,e),r=RS(this,e,[t]),r.shouldComponentUpdate=Ni(r,{tree:function(o){return!(o===r.oldValidatedTree&&r.oldValidatedTree===r.validatedTree)}}),Et(r),r._updateActions(t),r.validatedTree=t.getMemoizedTree(t.config,t.tree,void 0,t.sanitizeTree),r.oldValidatedTree=r.validatedTree;var a=t.getBasicConfig(t.config);return t.onInit&&t.onInit(r.validatedTree,a,void 0,r.actions),r}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"_updateActions",value:function(r){var a=r.config,i=r.dispatch;this.actions=ff(ml(ml(ml({},sf),SS),OS),a,i)}},{key:"onPropsChanged",value:function(r){var a=r.onChange,i=this.props.config,o=r.tree,l=this.props.tree,u=r.config;this.oldValidatedTree=this.validatedTree,this.validatedTree=o,i!==u&&(this._updateActions(r),this.validatedTree=r.getMemoizedTree(u,o,i));var s=!ra(this.validatedTree,this.oldValidatedTree);if(s){var c=r.getBasicConfig(u);a&&a(this.validatedTree,c,r.__lastAction,this.actions)}}},{key:"render",value:function(){var r=this.props,a=r.config,i=r.renderBuilder,o=r.dispatch,l={tree:this.validatedTree,actions:this.actions,config:a,dispatch:o};return i(l)}}])}(T.Component);gf.propTypes={config:R().object.isRequired,onChange:R().func,onInit:R().func,renderBuilder:R().func,tree:R().any};var mf=ji(function(n){return{tree:n.tree,__lastAction:n.__lastAction}},null,null,{context:Qa})(gf);mf.displayName="ConnectedQuery";const IS=mf;function PS(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,hf()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function hf(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hf=function(){return!!n})()}var yf=tr.DefaultUtils.defaultRoot,NS=tr.ConfigUtils.createConfigMemo,Sf=function(n){function e(t,r){var a,i,o;(0,br.A)(this,e),o=PS(this,e,[t,r]),o.setLastTree=function(F){o.prevTree&&(o.prevprevTree=o.prevTree),o.prevTree=F},o.getConfig=function(){return o.config},o.shouldComponentUpdate=Ni(o,{value:function(A,w){return!1}}),Et(o);var l=NS({reactIndex:(a=(i=o._reactInternals)===null||i===void 0?void 0:i.index)!==null&&a!==void 0?a:-1,maxSize:2,canCompile:!0}),u=l.getExtendedConfig,s=l.getBasicConfig,c=l.clearConfigMemo;o.getMemoizedConfig=u,o.getBasicConfig=s,o.clearConfigMemo=c,o.getMemoizedTree=LS();var d=o.getMemoizedConfig(t),f=d.settings.shouldCreateEmptyGroup,p=!f,m=yf(d,p),v=!!t.value,g=t.value||m,S=o.getMemoizedTree(d,g,void 0,v),y=I0(d,S,o.getMemoizedTree,o.setLastTree,o.getConfig),b=(0,P0.createStore)(y);return o.config=d,o.state={store:b},o.QueryWrapper=function(F){return d.settings.renderProvider(F,d.ctx)},o}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"componentWillUnmount",value:function(){this.clearConfigMemo()}},{key:"onPropsChanged",value:function(r){var a=this.props,i=this.config,o=this.getMemoizedConfig(r),l=i!==o,u=this.state.store.getState().tree,s=!ra(r.value,this.props.value)&&!ra(r.value,u),c=s?r.value||yf(r):u,d=s&&!ra(r.value,this.prevTree)&&!ra(r.value,this.prevprevTree);if(this.sanitizeTree=d||l,l&&(a.settings.renderProvider!==r.settings.renderProvider&&(this.QueryWrapper=function(p){return o.settings.renderProvider(p,o.ctx)}),this.config=o),s||l){var f=this.getMemoizedTree(o,c,i,this.sanitizeTree);this.state.store.dispatch(sf.setTree(o,f))}}},{key:"render",value:function(){var r=this.props,a=r.renderBuilder,i=r.get_children,o=r.onChange,l=r.onInit,u=this.state.store,s=this.config,c=this.QueryWrapper;return T.createElement(c,{config:s},T.createElement(fS,{store:u,context:Qa},T.createElement(IS,{config:s,getMemoizedTree:this.getMemoizedTree,getBasicConfig:this.getBasicConfig,sanitizeTree:this.sanitizeTree,onChange:o,onInit:l,renderBuilder:a||i})))}}])}(T.Component);Sf.propTypes={conjunctions:R().object.isRequired,fields:R().object.isRequired,types:R().object.isRequired,operators:R().object.isRequired,widgets:R().object.isRequired,settings:R().object.isRequired,ctx:R().object.isRequired,onChange:R().func,onInit:R().func,renderBuilder:R().func,value:R().any};var DS=h(46942),Kt=h.n(DS);function VS(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,Of()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function Of(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Of=function(){return!!n})()}var kS=tr.ConfigUtils.getFieldConfig,MS=function(e){var t;return t=function(r){function a(i){var o;return(0,br.A)(this,a),o=VS(this,a,[i]),o.dummyFn=function(){},o.removeSelf=function(){o.props.actions.removeRule(o.props.path)},o.setLock=function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;o.props.actions.setLock(o.props.path,l)},o.setField=function(l,u,s){o.props.actions.setField(o.props.path,l,u,s)},o.setFieldSrc=function(l){o.props.actions.setFieldSrc(o.props.path,l)},o.setOperator=function(l){o.props.actions.setOperator(o.props.path,l)},o.setOperatorOption=function(l,u){o.props.actions.setOperatorOption(o.props.path,l,u)},o.setValue=function(l,u,s,c,d){o.props.actions.setValue(o.props.path,l,u,s,c,d)},o.setValueSrc=function(l,u,s){o.props.actions.setValueSrc(o.props.path,l,u,s)},o.setFuncValue=function(l,u,s,c,d,f,p){o.props.actions.setFuncValue(o.props.path,l,u,s,c,d,f,p)},o.pureShouldComponentUpdate=Sa(o),o.dummyFn.isDummyFn=!0,o}return(0,Tr.A)(a,r),(0,Fr.A)(a,[{key:"shouldComponentUpdate",value:function(o,l){var u=this.props,s=this.state,c=this.pureShouldComponentUpdate(o,l);if(c&&s==l&&u!=o){var d=o.dragging.id||u.dragging.id,f=d==o.id,p=[];for(var m in o){var v=o[m]!=u[m];m=="dragging"&&!f&&(v=!1),v&&p.push(m)}p.length||(c=!1)}return c}},{key:"render",value:function(){var o=this.props.dragging.id==this.props.id,l=kS(this.props.config,this.props.field),u=this.props.fieldType||l?.type||null,s=this.props.config.settings.showErrorMessage,c=l&&l.type=="!struct",d=!o&&this.props.isDraggingTempo,f=this.props,p=f.valueError,m=f.fieldError,v=[m].concat((0,Fe.A)(p?.toArray()||[])).filter(function(S){return!!S}).shift()||null,g=v!=null&&s;return T.createElement("div",{className:Kt()("group-or-rule-container","rule-container",g?"rule-with-error":null),"data-id":this.props.id},[o?T.createElement(e,{key:"dragging",id:this.props.id,groupId:this.props.groupId,isDraggingMe:!0,isDraggingTempo:!0,dragging:this.props.dragging,setField:this.dummyFn,setFieldSrc:this.dummyFn,setFuncValue:this.dummyFn,setOperator:this.dummyFn,setOperatorOption:this.dummyFn,setLock:this.dummyFn,removeSelf:this.dummyFn,setValue:this.dummyFn,setValueSrc:this.dummyFn,selectedField:this.props.field||null,selectedFieldSrc:this.props.fieldSrc||"field",selectedFieldType:u,parentField:this.props.parentField||null,selectedOperator:this.props.operator||null,value:this.props.value||null,valueSrc:this.props.valueSrc||null,valueType:this.props.valueType||null,valueError:this.props.valueError||null,fieldError:this.props.fieldError||null,operatorOptions:this.props.operatorOptions,config:this.props.config,reordableNodesCnt:this.props.reordableNodesCnt,totalRulesCnt:this.props.totalRulesCnt,asyncListValues:this.props.asyncListValues,isLocked:this.props.isLocked,isTrueLocked:this.props.isTrueLocked,parentReordableNodesCnt:this.props.parentReordableNodesCnt}):null,T.createElement(e,{key:this.props.id,id:this.props.id,groupId:this.props.groupId,isDraggingMe:o,isDraggingTempo:d,onDragStart:this.props.onDragStart,setLock:d?this.dummyFn:this.setLock,removeSelf:d?this.dummyFn:this.removeSelf,setField:d?this.dummyFn:this.setField,setFieldSrc:d?this.dummyFn:this.setFieldSrc,setFuncValue:d?this.dummyFn:this.setFuncValue,setOperator:d?this.dummyFn:this.setOperator,setOperatorOption:d?this.dummyFn:this.setOperatorOption,setValue:d?this.dummyFn:this.setValue,setValueSrc:d?this.dummyFn:this.setValueSrc,selectedField:this.props.field||null,selectedFieldSrc:this.props.fieldSrc||"field",selectedFieldType:u,parentField:this.props.parentField||null,selectedOperator:this.props.operator||null,value:this.props.value||null,valueSrc:this.props.valueSrc||null,valueType:this.props.valueType||null,valueError:this.props.valueError||null,fieldError:this.props.fieldError||null,operatorOptions:this.props.operatorOptions,config:this.props.config,reordableNodesCnt:this.props.reordableNodesCnt,totalRulesCnt:this.props.totalRulesCnt,asyncListValues:this.props.asyncListValues,isLocked:this.props.isLocked,isTrueLocked:this.props.isTrueLocked,parentReordableNodesCnt:this.props.parentReordableNodesCnt})])}}])}(T.Component),t.propTypes={id:R().string.isRequired,groupId:R().string,config:R().object.isRequired,path:R().any.isRequired,operator:R().string,field:R().any,fieldSrc:R().string,fieldType:R().string,actions:R().object.isRequired,onDragStart:R().func,value:R().any,valueSrc:R().any,asyncListValues:R().array,valueError:R().any,fieldError:R().string,operatorOptions:R().object,reordableNodesCnt:R().number,parentField:R().string,isLocked:R().bool,isTrueLocked:R().bool,dragging:R().object,isDraggingTempo:R().bool},t};const _S=function(n){var e=ji(function(t){return{dragging:t.dragging}},null,null,{context:Qa})(MS(n));return e.displayName="ConnectedRuleContainer",e};function GS(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,bf()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function bf(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(bf=function(){return!!n})()}var Ff=tr.clone,BS=tr.TreeUtils.getFlatTree,hl=!1,US=function(e){var t,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return t=function(a){function i(o){var l;return(0,br.A)(this,i),l=GS(this,i,[o]),l._getEventTarget=function(u,s){return u&&u.__mocked_window||document.body||window},l.onDragStart=function(u,s,c){var d=s.closest(".query-builder");l._isUsingLegacyReactDomRender===void 0&&(l._isUsingLegacyReactDomRender=df(d)),document.body.classList.add("qb-dragging"),d.classList.add("qb-dragging");var f=d.closest(".query-builder-container")||d;f=l._getScrollParent(f)||document.body;var p=f.scrollTop,m=l._getDraggableNodeEl(d),v=l._getPlaceholderNodeEl(d),g=d.querySelectorAll(".group--children"),S=g.length?g[0]:null,y;S&&(y=window.getComputedStyle(S,null).getPropertyValue("padding-left"),y=parseInt(y));var b={id:u,x:s.offsetLeft,y:s.offsetTop,w:s.offsetWidth,h:s.offsetHeight,itemInfo:l.tree.items[u],paddingLeft:y},F={id:u,x:s.offsetLeft,y:s.offsetTop,scrollTop:p,clientX:c.clientX,clientY:c.clientY,itemInfo:Ff(l.tree.items[u]),treeEl:d,treeElContainer:f},A={clientX:c.clientX,clientY:c.clientY},w=l._getEventTarget(c,F);l.eventTarget=w,w.addEventListener("mousemove",l.onDrag),w.addEventListener("mouseup",l.onDragEnd),l.props.setDragStart(F,b,A)},l.onDrag=function(u){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,c=Object.assign({},l.props.dragging),d=l.props.dragStart,f=c.paddingLeft,p=d.treeElContainer,m=p.scrollTop;if(c.itemInfo=l.tree.items[c.id],!!c.itemInfo){var v={clientX:u.clientX,clientY:u.clientY},g={clientX:d.clientX,clientY:d.clientY};if(u.__mock_dom){var S=d.treeEl,y=l._getDraggableNodeEl(S),b=l._getPlaceholderNodeEl(S);u.__mock_dom({treeEl:S,dragEl:y,plhEl:b})}if(!d.plX){var F=d.treeEl,A=l._getPlaceholderNodeEl(F);A&&(d.plX=A.getBoundingClientRect().left+window.scrollX,d.plY=A.getBoundingClientRect().top+window.scrollY)}var w=d.x,x=d.y,k=d.clientX,D=d.clientY,I=d.scrollTop,_={x:w+(u.clientX-k),y:x+(u.clientY-D)+(m-I)};c.x=_.x,c.y=_.y,c.paddingLeft=f,c.mousePos=v,c.startMousePos=g,l.props.setDragProgress(v,c);var G=s?l.handleDrag(c,u,r):!1;G||u.preventDefault&&u.preventDefault()}},l.onDragEnd=function(){var u=l.props.dragStart.treeEl;l.props.setDragEnd(),u.classList.remove("qb-dragging"),document.body.classList.remove("qb-dragging"),l._cacheEls={};var s=l.eventTarget||l._getEventTarget();s.removeEventListener("mousemove",l.onDrag),s.removeEventListener("mouseup",l.onDragEnd)},l.pureShouldComponentUpdate=Sa(l),Et(l),l.onPropsChanged(o),l}return(0,Tr.A)(i,a),(0,Fr.A)(i,[{key:"onPropsChanged",value:function(l){this.tree=BS(l.tree)}},{key:"shouldComponentUpdate",value:function(l,u){var s=this.props,c=this.state,d=this.pureShouldComponentUpdate(l,u);if(d&&c==u&&s!=l){var f=[];for(var p in l){var m=l[p]!=s[p];m&&p!="dragging"&&p!="mousePos"&&f.push(p)}f.length||(d=!1)}return d}},{key:"componentDidUpdate",value:function(l,u){var s=this.props.dragging,c=this.props.dragStart;if(hl=!1,c&&c.id&&(s.itemInfo=this.tree.items[s.id],s.itemInfo&&(s.itemInfo.index!=c.itemInfo.index||s.itemInfo.parent!=c.itemInfo.parent))){var d=c.treeEl,f=c.treeElContainer,p=this._getPlaceholderNodeEl(d,!0);if(p){var m=p.getBoundingClientRect().left+window.scrollX,v=p.getBoundingClientRect().top+window.scrollY,g=c.plX,S=c.plY,y=f.scrollTop;c.plX=m,c.plY=v,c.itemInfo=Ff(s.itemInfo),c.y=p.offsetTop,c.x=p.offsetLeft,c.clientY+=v-S,c.clientX+=m-g,f!=document.body&&(c.scrollTop=y),this.onDrag(this.props.mousePos,!1)}}}},{key:"_getNodeElById",value:function(l,u){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(u==null)return null;this._cacheEls||(this._cacheEls={});var c=this._cacheEls[u];return c&&document.contains(c)&&!s||(c=l.querySelector('.group-or-rule-container[data-id="'+u+'"]'),this._cacheEls[u]=c),c}},{key:"_getDraggableNodeEl",value:function(l){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;this._cacheEls||(this._cacheEls={});var s=this._cacheEls.draggable;if(s&&document.contains(s)&&!u)return s;var c=l.getElementsByClassName("qb-draggable");return s=c.length?c[0]:null,this._cacheEls.draggable=s,s}},{key:"_getPlaceholderNodeEl",value:function(l){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;this._cacheEls||(this._cacheEls={});var s=this._cacheEls.placeholder;if(s&&document.contains(s)&&!u)return s;var c=l.getElementsByClassName("qb-placeholder");return s=c.length?c[0]:null,this._cacheEls.placeholder=s,s}},{key:"_isScrollable",value:function(l){var u=window.getComputedStyle(l)["overflow-y"];return(u==="scroll"||u==="auto")&&l.scrollHeight>l.offsetHeight}},{key:"_getScrollParent",value:function(l){return l==null?null:l===document.body||this._isScrollable(l)?l:this._getScrollParent(l.parentNode)}},{key:"handleDrag",value:function(l,u,s){var c=this,d=!0,f=l.itemInfo,p=l.paddingLeft,m=null,v=this.props.dragStart.treeEl,g=l.id,S=this._getDraggableNodeEl(v),y=this._getPlaceholderNodeEl(v),b,F,A,w;if(S&&y){if(b=S.getBoundingClientRect(),F=y.getBoundingClientRect(),!F.width)return;var x={hrz:0,vrt:0};b.top<F.top?x.vrt=-1:b.bottom>F.bottom&&(x.vrt=1),b.left>F.left?x.hrz=1:b.left<F.left&&(x.hrz=-1),w=v.getBoundingClientRect();var k={x:w.left+(w.right-w.left)/2,y:x.vrt>=0?b.bottom:b.top},D;if(u.__mocked_hov_container)D=u.__mocked_hov_container;else{var I=document.elementFromPoint(k.x,k.y-1);if(D=I?I.closest(".group-or-rule-container"):null,!D&&I&&I.classList.contains("query-builder-container")){var _,G=I==null||(_=I.firstChild)===null||_===void 0?void 0:_.firstChild;G&&G.classList.contains("group-or-rule-container")&&(D=G)}}if(!D)AS.log("out of tree bounds!");else{var M=D.classList.contains("group-container"),H=D.getAttribute("data-id"),K=D,z=!1,U=!1;if(K){A=K.getBoundingClientRect();var ee=A.bottom-A.top,Y=this.tree.items[H];if(!Y)throw new Error("There is an issue with rendering. If you use Next.js, please check getServerSideProps() method.");var oe=null,ie=null,se=null,ce=null;if(x.vrt==0)se=f,ie=y,ie&&(oe=ie.getBoundingClientRect());else if(M){if(x.vrt>0){var ge=D.getElementsByClassName("group--header"),ye=ge.length?ge[0]:null;if(ye){var ue=ye.getBoundingClientRect(),be=ue.bottom-ue.top,me=b.bottom-ue.top>be*3/4;me&&Y.top>l.itemInfo.top&&(se=Y,oe=ue,ie=ye,U=!0)}}else if(x.vrt<0&&Y.lev>=f.lev){var Ce=A.bottom-b.top>=2;Ce&&Y.top<l.itemInfo.top&&(se=Y,oe=A,ie=K,z=!0)}if(!U&&!z||d){var Me=x.vrt<0?A.bottom-b.top>ee-5:b.bottom-A.top>ee-5;Me&&(!U&&!z&&(se=Y,oe=A,ie=K),d&&(ce=Y))}}else{var je=x.vrt<0?A.bottom-b.top>ee/2:b.bottom-A.top>ee/2;je&&(se=Y,oe=A,ie=K)}var Ie=se&&se.id==g;if(oe){var Ve=b.left-w.left,Ee=oe.left-w.left,_e=Ee/p,He=Math.max(0,Math.round(Ve/p)),or=[],We=[];if(!Ie){if(M&&(z?or.push([ea,se,se.lev+1]):U&&or.push([ya,se,se.lev+1]),d&&ce)){var Gr=ce.lev==0,sr=ce.type=="case_group"&&f.type!="case_group",xr=ce.prev&&this.tree.items[ce.prev].caseId,lr=ce.next&&this.tree.items[ce.next].caseId;f.caseId==xr&&(xr=null),f.caseId==lr&&(lr=null);var ct=xr&&this.tree.items[xr],Lt=lr&&this.tree.items[lr];x.vrt>0?Gr?We.push([ea,ce,ce.lev+1]):sr&&Lt?We.push([ya,Lt,Lt.lev+1]):We.push([Ri,ce,ce.lev]):x.vrt<0&&(Gr?We.push([ya,ce,ce.lev+1]):sr&&ct?We.push([ea,ct,ct.lev+1]):We.push([Ii,ce,ce.lev]))}!z&&!U&&(x.vrt<0?or.push([Ii,se,se.lev]):x.vrt>0&&or.push([Ri,se,se.lev]))}var dt=function(nt){var et=nt[1],Qr=f.caseId?c.tree.items[f.caseId]:null,mt=et.caseId?c.tree.items[et.caseId]:null;return[].concat((0,Fe.A)(nt),[Qr,mt])};or=or.map(dt),We=We.map(dt),or=or.filter(function(dr){var nt=dr[0],et=dr[1];if((nt==Ii||nt==Ri)&&et.parent==null||et.collapsed&&(nt==ea||nt==ya))return!1;var Qr=et.id==f.id;if(!Qr){for(var mt=et;mt.parent;)if(mt=c.tree.items[mt.parent],mt.id==f.id){Qr=!0;break}}return!Qr}).map(function(dr){var nt=dr[0],et=dr[1],Qr=dr[2],mt=dr[3],_n=dr[4],ht=null;return nt==ea||nt==ya?ht=et:ht=c.tree.items[et.parent],ht&&ht.parent==null&&(ht=null),dr[5]=ht,dr});var wt=null,cr=or.filter(function(dr){return c.canMove(f,dr[1],dr[0],dr[3],dr[4],dr[5],s)});d&&cr.length==0&&We.length>0&&(cr=We.filter(function(dr){return c.canMove(f,dr[1],dr[0],dr[3],dr[4],dr[5],s)}));var Pt=cr.map(function(dr){return dr[2]}),_t=f.lev,Xr=Pt.concat(_t),ft=null;Xr.indexOf(He)!=-1?ft=He:He>Math.max.apply(Math,(0,Fe.A)(Xr))?ft=Math.max.apply(Math,(0,Fe.A)(Xr)):He<Math.min.apply(Math,(0,Fe.A)(Xr))&&(ft=Math.min.apply(Math,(0,Fe.A)(Xr))),wt=cr.find(function(dr){return dr[2]==ft}),!Ie&&!wt&&cr.length&&(wt=cr[0]),m=wt}}}}return m?(this.move(f,m[1],m[0],m[3]),!0):!1}},{key:"canMove",value:function(l,u,s,c,d,f,p){if(!l||!u||l.id===u.id)return!1;var m=this.props.config.settings,v=m.canRegroup,g=m.canRegroupCases,S=m.maxNesting,y=m.maxNumberOfRules,b=m.canLeaveEmptyCase,F=f?f.lev+1:u.lev,A=F+(l.depth||0),w=s==Ii||s==Ri,x=s==ya||s==ea,k=w&&u.lev==1||x&&u.lev==0,D=l.parent!=u.parent,I=x||D,_=l.type=="case_group"&&!k||l.parentType=="rule_group"||u.type=="rule_group"||u.parentType=="rule_group"||l.type!="case_group"&&u.type=="case_group"&&w||l.type!="case_group"&&u.type=="switch_group"||!g&&l.caseId!=u.caseId,G=u.isLocked||l.isLocked||f&&f.isLocked;if(S&&A>S||I&&(!v||_||G))return!1;if(l.type!="case_group"&&l.caseId!=u.caseId){var M=c?c._height==2:!1,H=d?d.atomicRulesCountInCase+1:0;if(y&&H>y||M&&!b)return!1}if(l.type=="case_group"&&(l.isDefaultCase||u.isDefaultCase||u.type=="switch_group"&&s==ea))return!1;var K=!0;return p&&(K=p(l.node.toJS(),u.node.toJS(),s,f?f.node.toJS():null)),K}},{key:"move",value:function(l,u,s,c){this._isUsingLegacyReactDomRender||(hl=!0),this.props.actions.moveItem(l.path,u.path,s)}},{key:"render",value:function(){return T.createElement(e,(0,ur.A)({},this.props,{onDragStart:this.onDragStart}))}}])}(T.Component),t.propTypes={tree:R().any.isRequired,actions:R().object.isRequired},t};const $S=function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=ji(function(r){return{dragging:r.dragging,dragStart:r.dragStart,mousePos:r.mousePos}},{setDragStart:hS,setDragProgress:mS,setDragEnd:yS},null,{context:Qa})(US(n,e));return t.displayName="ConnectedSortableContainer",t};var WS=["isDraggingTempo","isDraggingMe","dragging"];function QS(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,Tf()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function Tf(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Tf=function(){return!!n})()}const Oa=function(n){return function(e){var t;return t=function(r){function a(i){var o;return(0,br.A)(this,a),o=QS(this,a,[i]),o.handleDraggerMouseDown=function(l){var u=o.props.id,s=o.wrapper.current;o.props.onDragStart&&o.props.onDragStart(u,s,l)},o.wrapper=T.createRef(),o}return(0,Tr.A)(a,r),(0,Fr.A)(a,[{key:"render",value:function(){var o=this.props,l=o.isDraggingTempo,u=o.isDraggingMe,s=o.dragging,c=(0,Xn.A)(o,WS),d=c.isTrueLocked,f={};u&&l&&(hl||(f={top:s.y,left:s.x,width:s.w}));var p=Kt()(n,"group-or-rule",u&&l?"qb-draggable":null,u&&!l?"qb-placeholder":null,d?"locked":null);return T.createElement("div",{className:p,style:f,ref:this.wrapper,"data-id":this.props.id},T.createElement(e,(0,ur.A)({handleDraggerMouseDown:this.handleDraggerMouseDown,isDraggingMe:u,isDraggingTempo:l},c)))}}])}(T.PureComponent),t.propTypes={isDraggingTempo:R().bool,isDraggingMe:R().bool,onDragStart:R().func,dragging:R().object,isLocked:R().bool,isTrueLocked:R().bool},t}};var KS=h(95950),ba=h.n(KS),zS=h(71086),HS=h.n(zS);function Ef(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function qS(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ef(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ef(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function JS(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,Cf()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function Cf(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Cf=function(){return!!n})()}var Af=tr.ConfigUtils,YS=Af.getFieldConfig,XS=Af.getOperatorConfig,Lf=function(n){function e(t){var r;return(0,br.A)(this,e),r=JS(this,e,[t]),r.shouldComponentUpdate=Ni(r,{selectedField:function(i,o){return!1}}),Et(r),r.onPropsChanged(t),r}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"onPropsChanged",value:function(r){var a=this.props,i=["config","selectedField","selectedFieldSrc","selectedFieldType","selectedOperator"],o=!this.meta||i.map(function(l){return r[l]!==a[l]}).filter(function(l){return l}).length>0;o&&(this.meta=this.getMeta(r))}},{key:"getMeta",value:function(r){var a,i=r.config,o=r.selectedField,l=r.selectedFieldType,u=r.selectedOperator,s=YS(i,o),c=(0,Fe.A)(s?.operators||((a=i.types[l])===null||a===void 0?void 0:a.operators)||[]);!o&&!c.includes(u)&&c.push(u);var d=wi()(HS()(i.operators,function(F,A){return c?.indexOf(A)!==-1}),function(F,A){return XS(i,A,o)}),f=this.buildOptions(i,d,c),p=d[u]||{},m=this.props.config.settings.operatorPlaceholder,v=u,g=v?[v]:null,S=g,y=p.label,b=p.label2||p.tooltip;return{placeholder:m,items:f,selectedKey:v,selectedKeys:g,selectedPath:S,selectedLabel:y,selectedAltLabel:b,selectedOpts:p,fieldConfig:s}}},{key:"buildOptions",value:function(r,a,i){return!a||!i?null:ba()(a).sort(function(o,l){return i.indexOf(o)-i.indexOf(l)}).map(function(o){var l=a[o],u=l.label,s=l.label2,c=l.tooltip;return{key:o,path:o,label:u,altLabel:s,tooltip:c}})}},{key:"render",value:function(){var r=this.props,a=r.config,i=r.customProps,o=r.setOperator,l=r.readonly,u=r.id,s=r.groupId,c=a.settings.renderOperator,d=qS({id:u,groupId:s,config:a,customProps:i,readonly:l,setField:o},this.meta);return d.items?c(d,a.ctx):null}}])}(T.Component);Lf.propTypes={id:R().string,groupId:R().string,config:R().object.isRequired,selectedField:R().any,selectedFieldId:R().string,selectedFieldType:R().string,selectedFieldSrc:R().string,selectedOperator:R().string,readonly:R().bool,customProps:R().object,setOperator:R().func.isRequired};var ZS=["children"],Jr=function(e){var t=e.children,r=(0,Xn.A)(e,ZS);return T.createElement("div",r,t)},Ct=function(){},wf=function(){return T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"gray",width:"18px",height:"18px"},T.createElement("path",{d:"M0 0h24v24H0V0z",fill:"none"}),T.createElement("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"}))},Fa=function(e){return function(t){var r=t.config.settings.useConfirm,a=r?r.call(t.config.ctx,t.config.ctx):null;return T.createElement(e,(0,ur.A)({},t,{confirmFn:a}))}},xf=function(e){var t=e.id,r=e.isLHS,a=e.delta,i=e.parentFuncs;return[t,r?"L":"R",r?-1:a||0,(i||[]).map(function(o){var l=(0,we.A)(o,2),u=l[0],s=l[1];return"".concat(u,"(").concat(s,")")}).join("/")].join(":")},At=function(e,t){var r;return typeof t=="function"?(r=function(i){return t?.(i,e.ctx)},r.displayName=t.name):r=t,r};function eO(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,jf()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function jf(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(jf=function(){return!!n})()}var Rf=function(n){function e(){return(0,br.A)(this,e),eO(this,e,arguments)}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"render",value:function(){var r=this.props,a=r.config,i=r.selectedField,o=r.selectedFieldSrc,l=r.selectedFieldType,u=r.selectedOperator,s=r.setOperator,c=r.selectedFieldId,d=r.showOperator,f=r.showOperatorLabel,p=r.selectedFieldWidgetConfig,m=r.readonly,v=r.id,g=r.groupId,S=d&&T.createElement(Jr,{key:"operators-for-"+c,className:"rule--operator"},a.settings.showLabels&&T.createElement("label",{className:"rule--label"},a.settings.operatorLabel),T.createElement(Lf,{key:"operator",config:a,selectedField:i,selectedFieldSrc:o,selectedFieldType:l,selectedFieldId:c,selectedOperator:u,setOperator:s,customProps:a.settings.customOperatorSelectProps,readonly:m,id:v,groupId:g})),y=f&&T.createElement(Jr,{key:"operators-for-"+c,className:"rule--operator"},T.createElement("div",{className:"rule--operator-wrapper"},a.settings.showLabels?T.createElement("label",{className:"rule--label"},"\xA0"):null,T.createElement("div",{className:"rule--operator-text-wrapper"},T.createElement("span",{className:"rule--operator-text"},p.operatorInlineLabel))));return[S,y]}}])}(T.PureComponent);function If(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function rO(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?If(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):If(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function tO(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,Pf()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function Pf(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Pf=function(){return!!n})()}var Nf=tr.RuleUtils.getFieldPathLabels,yl=tr.ConfigUtils,Df=yl.getFieldConfig,Vf=yl.getFieldParts,kf=yl.getFieldPathParts,Mf=function(n){function e(t){var r;return(0,br.A)(this,e),r=tO(this,e,[t]),r.setField=function(a,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},l=r.props.id;if(!o.widgetId){var u=[l,"L",-1].join(":");o.widgetId=u}r.props.setField(a,i,o)},Et(r),r.onPropsChanged(t),r}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"onPropsChanged",value:function(r){var a=this.props,i=["selectedField","selectedFieldSrc","selectedFieldType","config","parentField"],o=!this.meta||i.map(function(l){return r[l]!==a[l]}).filter(function(l){return l}).length>0;o&&(this.meta=this.getMeta(r))}},{key:"getMeta",value:function(r){var a=r.selectedField,i=r.selectedFieldType,o=r.config,l=r.parentField,u=a,s=o.settings,c=s.maxLabelsLength,d=s.fieldSeparatorDisplay,f=s.fieldPlaceholder,p=s.fieldSeparator,m=!!a,v=m?null:Pi(f,c),g=m?Df(o,u):null,S=g||{},y=kf(u,o),b=kf(u,o,!0),F=this.getFieldLabel(g,u,o),A=Nf(u,o),w=A?A.join(d):null;(w==F||l)&&(w=null);var x=S.label2||S.tooltip,k=Vf(l,o),D=l?Df(o,l):null,I=l?D&&D.subfields:o.fields,_=!m&&i,G=this.buildOptions(k,o,I,_,k),M=_?"Please select field":null;return u&&(0,Er.A)(u)==="object"&&(u=void 0),{placeholder:v,items:G,parentField:l,selectedKey:u,selectedKeys:y,selectedPath:b,selectedLabel:F,selectedOpts:S,selectedAltLabel:x,selectedFullLabel:w,errorText:M}}},{key:"getFieldLabel",value:function(r,a,i){if(!a)return null;var o=i.settings.maxLabelsLength,l=Vf(a,i),u=r?.label||di()(l);return u=Pi(u,o),u}},{key:"buildOptions",value:function(r,a,i){var o=this,l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:void 0,u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null;if(!i)return null;var c=a.settings,d=c.fieldSeparator,f=c.fieldSeparatorDisplay,p=u!=null&&u.length?u.join(d)+d:"",m=function v(g){return Object.keys(g||{}).reduce(function(S,y){var b=g[y];return b.type==="!struct"?S+v(b.subfields):S+(b.type===l?1:0)},0)};return ba()(i).map(function(v){var g=[].concat((0,Fe.A)(u??[]),[v]),S=i[v],y=o.getFieldLabel(S,g,a),b=Nf(g,a),F=b.join(f);(F==y||r!=null&&r.length)&&(F=null);var A=S.label2,w=S.tooltip,x=S.disabled;if(!S.hideForSelect)if(S.type=="!struct"){var k=o.buildOptions(r,a,S.subfields,l,g,{label:y,tooltip:w}),D=m(S.subfields)>0;return{disabled:x,key:v,path:p+v,label:y,fullLabel:F,altLabel:A,tooltip:w,items:k,matchesType:D}}else{var I=l!==void 0?S.type===l:void 0;return{disabled:x,key:v,path:p+v,label:y,fullLabel:F,altLabel:A,tooltip:w,grouplabel:s?.label,group:s,matchesType:I}}}).filter(function(v){return!!v})}},{key:"render",value:function(){var r=this.props,a=r.config,i=r.customProps,o=r.setFieldSrc,l=r.readonly,u=r.id,s=r.groupId,c=a.settings.renderField,d=rO({id:u,groupId:s,config:a,customProps:i,readonly:l,setField:this.setField,setFieldSrc:o},this.meta);return c(d,a.ctx)}}])}(T.Component);Mf.propTypes={id:R().string,groupId:R().string,config:R().object.isRequired,selectedField:R().any,selectedFieldSrc:R().string,selectedFieldType:R().string,parentField:R().string,customProps:R().object,readonly:R().bool,setField:R().func.isRequired,setFieldSrc:R().func};function _f(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function nO(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?_f(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):_f(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function aO(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,Gf()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function Gf(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Gf=function(){return!!n})()}var iO=tr.clone,Di=tr.ConfigUtils,oO=Di.getFieldConfig,Bf=Di.getFuncConfig,lO=Di.getFieldParts,Uf=Di.getFieldPathParts,$f=tr.RuleUtils,Wf=$f.getFuncPathLabels,uO=$f.getWidgetForFieldOp,sO=tr.OtherUtils.shallowEqual,Qf=function(n){function e(t){var r;return(0,br.A)(this,e),r=aO(this,e,[t]),Et(r),r.onPropsChanged(t),r}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"onPropsChanged",value:function(r){var a=this.props,i=["config","field","fieldType","fieldSrc","operator","isFuncArg","isLHS","parentFuncs"],o=["config","field","fieldType","fieldSrc","value","isLHS"],l=!this.items||i.map(function(s){return s==="parentFuncs"?!sO(r[s],a[s],!0):r[s]!==a[s]}).filter(function(s){return s}).length>0,u=!this.meta||o.map(function(s){return r[s]!==a[s]}).filter(function(s){return s}).length>0;u&&(this.meta=this.getMeta(r)),l&&(this.items=this.getItems(r,this.meta))}},{key:"getItems",value:function(r,a){var i=r.config,o=r.field,l=r.fieldType,u=r.isLHS,s=r.operator,c=r.parentFuncs,d=r.fieldDefinition,f=r.isFuncArg,p=a.lookingForFieldType,m=i.settings.canUseFuncForField,v=this.filterFuncs(i,i.funcs,o,l,u,s,m,c,f,d),g=this.buildOptions(i,v,p);return g}},{key:"getMeta",value:function(r){var a=r.config,i=r._field,o=r.fieldType,l=r.value,u=r.isLHS,s=r.isFuncArg,c=a.settings,d=c.funcPlaceholder,f=c.fieldSeparatorDisplay,p=l,m=!!l,v=m?null:d,g=m?Bf(a,p):null,S=g||{},y=Uf(p,a),b=Uf(p,a,!0),F=this.getFuncLabel(g,p,a),A=Wf(p,a),w=A?A.join(f):null;w==F&&(w=null);var x=u&&!s,k=x&&!m&&o,D=k?"Please select function":null;return{placeholder:v,selectedKey:p,selectedKeys:y,selectedPath:b,selectedLabel:F,selectedOpts:S,selectedFullLabel:w,errorText:D,lookingForFieldType:k}}},{key:"filterFuncs",value:function(r,a,i,o,l,u,s,c,d,f){a=iO(a);var p=r.settings.fieldSeparator,m=oO(r,i),v=!1,g,S=m,y=uO(r,i,u,"value"),b=y&&r.widgets[y];d?(S=f,g=f?.type):v&&b?g=b.type:m?g=m.type:l||(g=o);function F(A,w){for(var x in A){var k=A[x].subfields,D=(w||[]).concat(x),I=D.join(p),_=Bf(r,I);if(_.type=="!struct")F(k,D)==0&&delete A[x];else{var G,M=!g||_.returnType==g;(G=S)!==null&&G!==void 0&&G.funcs&&(M=M&&S.funcs.includes(I)),s&&(M=M&&s(i,m,I,_,u)),!_.allowSelfNesting&&c&&c.map(function(H){var K=(0,we.A)(H,2),z=K[0],U=K[1];return z}).includes(I)&&(M=!1),M||delete A[x]}}return ba()(A).length}return F(a,[]),a}},{key:"buildOptions",value:function(r,a){var i=this,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!a)return null;var s=r.settings,c=s.fieldSeparator,d=s.fieldSeparatorDisplay,f=l!=null&&l.length?l.join(c)+c:"",p=function m(v){return Object.keys(v||{}).reduce(function(g,S){var y=v[S];return y.type==="!struct"?g+m(y.subfields):g+(y.type===o?1:0)},0)};return ba()(a).map(function(m){var v=[].concat((0,Fe.A)(l??[]),[m]),g=a[m],S=i.getFuncLabel(g,v,r),y=Wf(v,r),b=y.join(d);b==S&&(b=null);var F=g.tooltip;if(g.type=="!struct"){var A=i.buildOptions(r,g.subfields,o,v,{label:S,tooltip:F}),w=p(g.subfields)>0;return{key:m,path:f+m,label:S,fullLabel:b,tooltip:F,items:A,matchesType:w}}else{var x=o!==void 0?g.returnType===o:void 0;return{key:m,path:f+m,label:S,fullLabel:b,tooltip:F,grouplabel:u?.label,group:u,matchesType:x}}})}},{key:"getFuncLabel",value:function(r,a,i){if(!a)return null;var o=i.settings.maxLabelsLength,l=lO(a,i),u=r?.label||di()(l);return u=Pi(u,o),u}},{key:"render",value:function(){var r=this.props,a=r.config,i=r.customProps,o=r.setValue,l=r.readonly,u=r.id,s=r.groupId,c=a.settings.renderFunc,d=nO({config:a,customProps:i,readonly:l,setField:o,items:this.items,id:u,groupId:s},this.meta);return c(d,a.ctx)}}])}(T.Component);Qf.propTypes={id:R().string,groupId:R().string,config:R().object.isRequired,field:R().any,fieldType:R().string,fieldSrc:R().string,operator:R().string,customProps:R().object,value:R().string,setValue:R().func.isRequired,readonly:R().bool,parentFuncs:R().array,fieldDefinition:R().object,isFuncArg:R().bool,isLHS:R().bool};var cO=h(23181),Sl=h.n(cO),dO=["widgetFactory"],fO=["factory"];function Kf(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Ol(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Kf(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Kf(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var zf=tr.ListUtils.getTitleInListValues,pO=tr.ConfigUtils._widgetDefKeysToOmit,Hf=tr.TreeUtils,vO=Hf._fixImmutableValue,gO=Hf.isImmutable,qf=(0,T.memo)(function(n){var e=n.widgetFactory,t=(0,Xn.A)(n,dO),r=t.config,a=t.isFuncArg,i=t.fieldDefinition,o=i||{},l=o.fieldSettings,u=o.defaultValue,s=o.valueSources,c=a&&s?.length==1&&s?.[0]==="const",d=l?.treeValues||l?.listValues;return c&&u?typeof u=="boolean"?u?t.labelYes||"YES":t.labelNo||"NO":d?Array.isArray(u)?u.map(function(f){return zf(d,f)||f}).join(", "):zf(d,u)||u:""+u:e?e(t,r.ctx):"?"});qf.displayName="WidgetFactoryMemo";var Jf=function(e){var t=e.delta,r=e.isFuncArg,a=e.valueSrc,i=e.value,o=e.valueError,l=e.fieldError,u=e.asyncListValues,s=e.isSpecialRange,c=e.fieldDefinition,d=e.widget,f=e.widgetDefinition,p=e.widgetValueLabel,m=e.valueLabels,v=e.textSeparators,g=e.setValue,S=e.setFuncValue,y=e.config,b=e.field,F=e.fieldSrc,A=e.fieldPath,w=e.fieldType,x=e.isLHS,k=e.operator,D=e.readonly,I=e.parentField,_=e.parentFuncs,G=e.id,M=e.groupId,H=e.widgetId,K=f.factory,z=(0,Xn.A)(f,fO),U=i?i.map(function(me){return vO(me)}):void 0,ee=(0,T.useMemo)(function(){if(s){var me=[U?.get(0),U?.get(1)];return me[0]===void 0&&me[1]===void 0&&(me=void 0),me}return U?.get(t)},[s,i]),Y=(0,T.useMemo)(function(){return o?s?[o.get(0),o.get(1),o.get(2)]:o?.get(t):null},[s,i]),oe=x?l:Y,ie=c||{},se=ie.fieldSettings,ce=p.label,ge=p.placeholder,ye=m?m.placeholder:null,ue=gO(b)?null:b,be=fi()(Ol(Ol(Ol({},z),se),{},{config:y,field:ue,fieldPath:A,fieldSrc:F,fieldType:w,isLHS:x,parentField:I,parentFuncs:_,fieldDefinition:c,operator:k,delta:t,isSpecialRange:s,isFuncArg:r,value:ee,valueSrc:a,valueError:Y,fieldError:l,errorMessage:oe,label:ce,placeholder:ge,placeholders:ye,textSeparators:v,setValue:g,setFuncValue:S,readonly:D,asyncListValues:u,id:G,groupId:M,widgetId:H,widgetFactory:K,widget:d}),[].concat((0,Fe.A)(pO),["toJS"]));return T.createElement(qf,(0,ur.A)({widgetFactory:K},be))};Jf.displayName="WidgetFactory";const mO=Jf;function hO(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,Yf()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function Yf(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Yf=function(){return!!n})()}var bl=tr.ConfigUtils,yO=bl.getFieldConfig,SO=bl.getOperatorConfig,Xf=bl.getFieldWidgetConfig,Fl=tr.RuleUtils,OO=Fl.getValueSourcesForFieldOp,Zf=Fl.getWidgetForFieldOp,Vi=Fl.getValueLabel,ep=tr.DefaultUtils.createListWithOneElement,bO=tr.OtherUtils.shallowEqual,HE=tr.TreeUtils.isImmutable,FO={cardinality:1},Ka=function(n){function e(t){var r;return(0,br.A)(this,e),r=hO(this,e,[t]),r._setValue=function(a,i,o,l,u,s){var c=arguments.length>6&&arguments[6]!==void 0?arguments[6]:{};if(c.widgetId||(c.widgetId=l),a&&Array.isArray(u)){var d=[r.props.value.get(0),r.props.value.get(1)];d[0]!=u[0]&&r.props.setValue(0,u[0],o,s,c),d[1]!=u[1]&&r.props.setValue(1,u[1],o,s,c)}else r.props.setValue(i,u,o,s,c)},r._setValueSrc=function(a,i,o){var l={widgetId:i};r.props.setValueSrc(a,o,l)},r.renderWidget=function(a,i,o){var l=o.config,u=o.isFuncArg,s=o.leftField,c=o.operator,d=o.value,f=o.valueError,p=o.fieldError,m=o.readonly,v=o.parentField,g=o.parentFuncs,S=o.id,y=o.groupId,b=o.fieldSrc,F=o.fieldType,A=o.isLHS,w=o.setFuncValue,x=l.settings,k=i.widgets,D=i.iValues,I=i.aField,_=i.valueSources,G=u?D:d,M=u?s:I,H=k[a],K=H.valueSrc,z=H.valueLabel,U=H.widgetId,ee=_.length>1&&!m,Y=x.showLabels?T.createElement("label",{key:"label-"+U,className:"rule--label"},z.label):null;return T.createElement("div",{key:"wrapper-"+U,className:Kt()(K==="func"?"widget--func":"widget--widget",ee?"widget--has-valuerscs":"widget--has-no-valuerscs")},K==="func"?null:Y,T.createElement(mO,(0,ur.A)({key:U,id:S,groupId:y,widgetId:U,valueSrc:K,delta:a,value:G,valueError:f,fieldError:p,isFuncArg:u,isLHS:A},pn()(i,["isSpecialRange","fieldDefinition","asyncListValues"]),pn()(k[a],["widget","widgetDefinition","widgetValueLabel","valueLabels","textSeparators","setValue"]),{setFuncValue:w,config:l,field:M,fieldSrc:b,fieldType:F,parentField:v,parentFuncs:g,operator:c,readonly:m})))},r.renderValueSources=function(a,i,o){var l=o.config,u=o.isFuncArg,s=o.leftField,c=o.operator,d=o.readonly,f=l.settings,p=i.valueSources,m=i.widgets,v=i.aField,g=i.valueSourcesOptions,S=u?s:v,y=m[a],b=y.valueSrc,F=y.setValueSrc,A=r.ValueSources,w=f.showLabels?T.createElement("label",{className:"rule--label"},"\xA0"):null;return p.length>1&&!d&&T.createElement("div",{key:"wrapper-valuesrc-"+a,className:"widget--valuesrc"},w,T.createElement(A,{key:"valuesrc-"+a,delta:a,valueSources:g,valueSrc:b,config:l,field:S,operator:c,setValueSrc:F,readonly:d,title:f.valueSourcesPopupTitle}))},r.renderSep=function(a,i,o){var l=o.config,u=i.widgets,s=l.settings,c=u[a].sepText,d=s.showLabels?T.createElement("label",{className:"rule--label"},"\xA0"):null;return c&&T.createElement("div",{key:"widget-separators-"+a,className:Kt()("widget--sep",a==0&&"widget--sep-first")},d,T.createElement("span",null,c))},r.renderWidgetDelta=function(a){var i=r.renderSep(a,r.meta,r.props),o=r.renderValueSources(a,r.meta,r.props),l=r.renderWidget(a,r.meta,r.props);return[i,o,l]},Et(r),r.onPropsChanged(t),r}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"onPropsChanged",value:function(r){var a=this.props,i=!this.ValueSources||a?.config!==r?.config,o=["config","id","parentFuncs","field","fieldId","fieldSrc","fieldType","fieldFunc","fieldArg","leftField","operator","valueSrc","asyncListValues","isLHS","isFuncArg","isForRuleGroup","isCaseValue","value"],l=o.filter(function(d){return d==="parentFuncs"?!bO(r[d],a[d],!0):d==="field"?r.fieldId!==a.fieldId:r[d]!==a[d]}),u=!this.meta||l.length>0;if(u&&(this.meta=this.getMeta(r,l)),i){var s=r.config,c=s.settings.renderValueSources;this.ValueSources=At(s,c)}}},{key:"getMeta",value:function(r){var a,i,o,l,u=this,s=r.config,c=r.field,d=r.fieldSrc,f=r.fieldType,p=r.fieldFunc,m=r.fieldArg,v=r.operator,g=r.valueSrc,S=r.value,y=r.isForRuleGroup,b=r.isCaseValue,F=r.isFuncArg,A=r.leftField,w=r.asyncListValues,x=r.parentFuncs,k=r.isLHS,D=r.id,I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],_=s.settings.valueSourcesInfo,G=F?{func:p,arg:m}:c,M=!c&&f,H=g,K=S;(F||y||b)&&(H=ep(g),K=ep(S));var z=yO(s,G);!z&&M&&(z=s.types[f]);var U=Zf(s,G,v);if(!U&&M){var ee;U=(ee=s.types[f])===null||ee===void 0?void 0:ee.mainWidget}var Y=F?FO:SO(s,v,G);if((z==null||Y==null)&&!b)return null;var oe=Y?.isSpecialRange,ie=oe&&(((a=H)===null||a===void 0?void 0:a.get(0))==="field"||((i=H)===null||i===void 0?void 0:i.get(1))==="field"),se=oe&&!ie,ce=se?1:bS(Y);if(ce===0)return null;var ge=(o=this.meta)===null||o===void 0?void 0:o.valueSources,ye=(l=this.meta)===null||l===void 0?void 0:l.valueSourcesOptions;(!ge||["field","operator","config","fieldDefinition","isForRuleGroup"].filter(function(be){return I.includes(be)}).length)&&(ge=OO(s,G,v,z),y&&(ge=["value"]),G||(ge=Object.keys(_)),ye=ge.map(function(be){return[be,{label:_[be].label}]}));var ue=Sl()(0,ce).map(function(be){var me,Ce,Me,je,Ie=(me=u.meta)===null||me===void 0||(me=me.widgets)===null||me===void 0?void 0:me[be],Ve=((Ce=H)===null||Ce===void 0?void 0:Ce.get(be))||null,Ee=Zf(s,G,v,Ve),_e=Xf(s,G,v,Ee,Ve);ie&&(Ee=_e.singleWidget,_e=Xf(s,G,v,Ee,Ve)),!_e&&M&&(Ee=["func","field"].includes(Ve)?Ve:U,_e=s.widgets[Ee]);var He=(Me=_e)===null||Me===void 0?void 0:Me.type,or=Vi(s,G,v,be,Ve,se),We=Vi(s,G,v,be,null,se),Gr=Y!=null&&Y.textSeparators?Y?.textSeparators[be]:null,sr=null,xr=null;oe&&(sr=[Vi(s,G,v,0),Vi(s,G,v,1)],sr={placeholder:[sr[0].placeholder,sr[1].placeholder],label:[sr[0].label,sr[1].label]},xr=Y?.textSeparators);var lr=xf({id:D,isLHS:k,delta:be,parentFuncs:x}),ct=lr+":VS",Lt=Ie?.setValueSrc;(!Lt||Ie?.widgetId!==lr)&&(Lt=u._setValueSrc.bind(u,be,ct));var dt=Ie?.setValue;return(!dt||Ie?.widgetId!==lr||Ie?.widgetType!==He||((je=u.meta)===null||je===void 0?void 0:je.isSpecialRange)!==oe)&&(dt=u._setValue.bind(u,oe,be,He,lr)),{valueSrc:Ve,valueLabel:or,widget:Ee,sepText:Gr,widgetDefinition:_e,widgetValueLabel:We,valueLabels:sr,textSeparators:xr,setValueSrc:Lt,setValue:dt,widgetId:lr,widgetType:He}});return{defaultWidget:U,fieldDefinition:z,operatorDefinition:Y,isSpecialRange:se,cardinality:ce,valueSources:ge,valueSourcesOptions:ye,widgets:ue,iValues:K,aField:G,asyncListValues:w}}},{key:"render",value:function(){if(!this.meta)return null;var r=this.meta,a=r.defaultWidget,i=r.cardinality;if(!a)return null;var o=a;return T.createElement(Jr,{className:"rule--widget rule--widget--".concat(o.toUpperCase()),key:"widget-col-"+o},Sl()(0,i).map(this.renderWidgetDelta))}}])}(T.Component);Ka.propTypes={config:R().object.isRequired,value:R().any,valueSrc:R().any,valueError:R().any,fieldError:R().string,field:R().any,fieldSrc:R().string,fieldType:R().string,fieldId:R().string,operator:R().string,readonly:R().bool,asyncListValues:R().array,id:R().string,groupId:R().string,setValue:R().func,setValueSrc:R().func,setFuncValue:R().func,isFuncArg:R().bool,fieldFunc:R().string,fieldArg:R().string,leftField:R().any,isForRuleGroup:R().bool,parentField:R().string,parentFuncs:R().array,isLHS:R().bool,isCaseValue:R().bool};function rp(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,tp()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function tp(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(tp=function(){return!!n})()}var TO=tr.ConfigUtils.getFuncConfig,np=tr.OtherUtils.shallowEqual,Tl=function(n){function e(t){var r;return(0,br.A)(this,e),r=rp(this,e,[t]),r.setFunc=function(a){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=r.props,l=o.isLHS,u=o.delta,s=o.parentFuncs,c=o.id;if(!i.widgetId){var d=xf({id:c,isLHS:l,delta:u,parentFuncs:s});i.widgetId=d}r.props.setFuncValue(l?-1:u||0,s,null,a,"!func",void 0,i)},r.setArgValue=function(a,i,o,l,u){var s=r.props,c=s.config,d=s.delta,f=s.isLHS,p=s.parentFuncs;r.props.setFuncValue(f?-1:d||0,p,a,i,o,l,u)},r.setArgValueSrc=function(a,i,o){var l=r.props,u=l.config,s=l.delta,c=l.isLHS,d=l.parentFuncs;r.props.setFuncValue(c?-1:s||0,d,a,i,"!valueSrc",void 0,o)},r.renderFuncSelect=function(){var a,i,o=r.props,l=o.config,u=o.field,s=o.fieldType,c=o.fieldSrc,d=o.isLHS,f=o.operator,p=o.customProps,m=o.value,v=o.readonly,g=o.parentFuncs,S=o.id,y=o.groupId,b=o.isFuncArg,F=o.fieldDefinition,A=(a=m==null||(i=m.get)===null||i===void 0?void 0:i.call(m,"func"))!==null&&a!==void 0?a:null,w={value:A,setValue:r.setFunc,config:l,field:u,fieldType:s,fieldSrc:c,isLHS:d,operator:f,customProps:p,readonly:v,parentFuncs:g,isFuncArg:b,fieldDefinition:F,id:S,groupId:y},x=l.settings,k=x.showLabels,D=x.funcLabel,I=k?T.createElement("label",{className:"rule--label"},D):null;return T.createElement(Jr,{key:"func",className:"rule--func"},I,T.createElement(Qf,w))},r.renderArgLabel=function(a,i){var o=i.valueSources,l=i.type,u=i.showPrefix,s=i.label,c=r.props.config,d=o&&o.length==1&&o[0]=="const",f=!c.settings.showLabels&&(l=="boolean"||d)&&u;return f?T.createElement(Jr,{className:"rule--func--arg-label"},s||a):null},r.renderArgLabelSep=function(a,i){var o=i.valueSources,l=i.type,u=i.showPrefix,s=r.props.config,c=o&&o.length==1&&o[0]=="const",d=!s.settings.showLabels&&(l=="boolean"||c)&&u;return d?T.createElement(Jr,{className:"rule--func--arg-label-sep"},":"):null},r.renderArgVal=function(a,i,o){var l=r.props,u=l.config,s=l.field,c=l.fieldType,d=l.fieldSrc,f=l.isLHS,p=l.operator,m=l.value,v=l.readonly,g=l.parentFuncs,S=l.id,y=l.groupId,b=l.fieldError,F=l.valueError,A=l.setFuncValue,w=m?m.getIn(["args",i]):null,x=w?w.get("value"):void 0,k=o.valueSources.length==1?o.valueSources[0]:void 0,D=w?w.get("valueSrc")||k||"value":k,I={config:u,fieldFunc:a,fieldArg:i,leftField:s,fieldType:c,fieldSrc:d,fieldError:b,valueError:F,isLHS:f,operator:null,value:x,valueSrc:D,setValue:r.setArgValue,setValueSrc:r.setArgValueSrc,setFuncValue:A,funcKey:a,argKey:i,argDefinition:o,readonly:v,parentFuncs:g,id:S,groupId:y};return T.createElement(Jr,{className:"rule--func--arg-value"},T.createElement(ap,I))},r.renderArgSep=function(a,i,o,l){var u=l.renderSeps;return o?T.createElement(Jr,{className:"rule--func--arg-sep"},u?u[o-1]:", "):null},r.renderBracketBefore=function(a){var i=a.renderBrackets;return T.createElement(Jr,{key:"before_args",className:"rule--func--bracket-before"},i?i[0]:"(")},r.renderBracketAfter=function(a){var i=a.renderBrackets;return T.createElement(Jr,{key:"after_args",className:"rule--func--bracket-after"},i?i[1]:")")},r.renderFuncArgs=function(){var a=r.meta,i=a.funcDefinition,o=a.funcKey;if(!o)return null;var l=i||{},u=l.args;return u?T.createElement(T.Fragment,null,r.renderBracketBefore(i),T.createElement(Jr,{key:"args-".concat(o),className:"rule--func--args rule--func--".concat(o,"--args")},Object.keys(u).map(function(s,c){return T.createElement(Jr,{key:"arg-".concat(s,"-").concat(c),className:"rule--func--arg rule--func--".concat(o,"--arg--").concat(s)},r.renderArgSep(s,u[s],c,i),r.renderArgLabel(s,u[s]),r.renderArgLabelSep(s,u[s]),r.renderArgVal(o,s,u[s]))})),r.renderBracketAfter(i)):null},Et(r),r.onPropsChanged(t),r}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"onPropsChanged",value:function(r){var a=this.props,i=["config","field","operator","value","fieldSrc","fieldType","isLHS"],o=!this.meta||i.map(function(l){return l==="parentFuncs"?!np(r[l],a[l],!0):r[l]!==a[l]}).filter(function(l){return l}).length>0;o&&(this.meta=this.getMeta(r))}},{key:"getMeta",value:function(r){var a,i,o=r.config,l=r.field,u=r.operator,s=r.value,c=(a=s==null||(i=s.get)===null||i===void 0?void 0:i.call(s,"func"))!==null&&a!==void 0?a:null,d=c?TO(o,c):null;return{funcDefinition:d,funcKey:c}}},{key:"render",value:function(){var r=this.props.parentFuncs,a=r?r.map(function(o){var l=(0,we.A)(o,2),u=l[0],s=l[1];return"".concat(u,"_").concat(s)}).join("-"):"root",i=r?.length||0;return T.createElement(Jr,{className:"rule--func--wrapper rule--func--wrapper--under-".concat(a," rule--func--wrapper--lev-").concat(i)},this.renderFuncSelect(),this.renderFuncArgs())}}])}(T.Component);Tl.propTypes={id:R().string,groupId:R().string,config:R().object.isRequired,field:R().any,fieldSrc:R().string,fieldType:R().string,fieldError:R().string,operator:R().string,customProps:R().object,value:R().object,setValue:R().func.isRequired,setFuncValue:R().func,readonly:R().bool,parentFuncs:R().array,fieldDefinition:R().object,isFuncArg:R().bool,isLHS:R().bool,valueError:R().string};var ap=function(n){function e(t){var r;return(0,br.A)(this,e),r=rp(this,e,[t]),r.setValue=function(a,i,o,l,u){var s=r.props,c=s.setValue,d=s.argKey;c(d,i,o,l,u)},r.setValueSrc=function(a,i,o){var l=r.props,u=l.setValueSrc,s=l.argKey;u(s,i,o)},Et(r),r.onPropsChanged(t),r}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"onPropsChanged",value:function(r){var a=this.props,i=["parentFuncs","funcKey","argKey"],o=!this.meta||i.map(function(l){return l==="parentFuncs"?!np(r[l],a[l],!0):r[l]!==a[l]}).filter(function(l){return l}).length>0;o&&(this.meta=this.getMeta(r))}},{key:"getMeta",value:function(r){var a=r.parentFuncs,i=r.funcKey,o=r.argKey,l=[].concat((0,Fe.A)(a||[]),[[i,o]]);return{parentFuncs:l}}},{key:"render",value:function(){var r=this.meta.parentFuncs;return T.createElement(Ka,(0,ur.A)({},this.props,{setValue:this.setValue,setValueSrc:this.setValueSrc,isFuncArg:!0,parentFuncs:r}))}}])}(T.Component);ap.propTypes={funcKey:R().string.isRequired,argKey:R().string.isRequired,setValue:R().func.isRequired,setValueSrc:R().func.isRequired,readonly:R().bool,isLHS:R().bool,parentFuncs:R().array,id:R().string,groupId:R().string};function EO(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,ip()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function ip(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ip=function(){return!!n})()}var El=function(n){function e(t){var r;return(0,br.A)(this,e),r=EO(this,e,[t]),r.renderField=function(){var a=r.props,i=a.config,o=a.classname,l=a.selectedField,u=a.selectedFieldSrc,s=a.selectedFieldType,c=a.setField,d=a.setFuncValue,f=a.parentField,p=a.readonly,m=a.id,v=a.groupId,g=a.fieldError,S=a.valueError,y=["func","field"];if(!y.includes(u))return"?";var b=u==="func"?T.createElement(Tl,{isLHS:!0,config:i,value:l,fieldSrc:u,fieldType:s,fieldError:g,valueError:S,parentField:f,setValue:c,setFuncValue:d,readonly:p,id:m,groupId:v,key:"field-func-"+m}):T.createElement(Mf,{config:i,selectedField:l,selectedFieldSrc:u,selectedFieldType:s,parentField:f,setField:c,customProps:i.settings.customFieldSelectProps,readonly:p,id:m,groupId:v,key:"field-"+m}),F=u==="func"?i.settings.funcLabel:i.settings.fieldLabel,A=i.settings.showLabels&&u!=="func"&&T.createElement("label",{className:"rule--label"},F);return T.createElement("div",{key:u,className:o},A,b)},r.renderFieldSources=function(){if(!r.meta)return null;var a=r.props,i=a.config,o=a.readonly,l=a.selectedFieldSrc,u=a.setFieldSrc,s=a.id,c=r.meta.fieldSourcesOptions,d=i.settings,f=r.ValueSources,p=d.showLabels?T.createElement("label",{className:"rule--label"},"\xA0"):null;return c.length>1&&!o&&T.createElement("div",{key:"fieldsrc",className:"rule--fieldsrc"},p,T.createElement(f,{key:"fieldsrc-"+s,valueSources:c,valueSrc:l,config:i,setValueSrc:u,readonly:o,title:d.fieldSourcesPopupTitle}))},Et(r),r.onPropsChanged(t),r}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"onPropsChanged",value:function(r){var a=this.props,i=!this.ValueSources||a?.config!==r?.config,o=["config"],l=!this.meta||o.map(function(c){return r[c]!==a[c]}).filter(function(c){return c}).length>0;if(l&&(this.meta=this.getMeta(r)),i){var u=r.config,s=u.settings.renderValueSources;this.ValueSources=function(c){return s(c,u.ctx)}}}},{key:"getMeta",value:function(r){var a=r.config,i=a.settings,o=i.valueSourcesInfo,l=i.fieldSources,u=l.map(function(s){return[s,{label:o[s].label}]});return{fieldSourcesOptions:u}}},{key:"render",value:function(){var r=this.props,a=r.classname,i=r.canSelectFieldSource,o=i&&this.renderFieldSources(),l=this.renderField();return i?T.createElement(Jr,{className:"rule--field-wrapper"},o,l):l}}])}(T.Component),CO=["factory"];function AO(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,op()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function op(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(op=function(){return!!n})()}var LO=tr.ConfigUtils.getOperatorConfig,lp=function(n){function e(){return(0,br.A)(this,e),AO(this,e,arguments)}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"render",value:function(){if(!this.props.selectedOperator)return null;var r=LO(this.props.config,this.props.selectedOperator,this.props.selectedField);if(typeof r.options>"u")return null;var a=r.options,i=a.factory,o=(0,Xn.A)(a,CO),l=Object.assign({},o,{config:this.props.config,field:this.props.selectedField,fieldSrc:this.props.selectedFieldSrc,operator:this.props.selectedOperator,options:this.props.operatorOptions,setOption:this.props.setOperatorOption,readonly:this.props.readonly}),u=i(l,this.props.config.ctx),s=this.props.selectedOperator;return T.createElement("div",{className:"rule--operator rule--operator--".concat(s.toUpperCase())},u)}}])}(T.PureComponent);lp.propTypes={config:R().object.isRequired,operatorOptions:R().any.isRequired,selectedField:R().any,selectedFieldSrc:R().string,selectedOperator:R().string.isRequired,readonly:R().bool,setOperatorOption:R().func.isRequired};function up(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function sp(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?up(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):up(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function wO(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,cp()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function cp(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(cp=function(){return!!n})()}var ki=tr.ConfigUtils,xO=ki.getFieldConfig,jO=ki.getOperatorConfig,RO=ki.getFieldWidgetConfig,IO=ki.getFieldId,PO=tr.RuleUtils.isEmptyRuleProperties,dp=function(n){function e(t){var r;return(0,br.A)(this,e),r=wO(this,e,[t]),Et(r),r.removeSelf=r.removeSelf.bind(r),r.setLock=r.setLock.bind(r),r.onPropsChanged(t),r}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"onPropsChanged",value:function(r){var a=this,i=this.props,o=!this.Icon||i?.config!==r?.config,l=["selectedField","selectedFieldSrc","selectedFieldType","selectedOperator","config","reordableNodesCnt","isLocked"],u=!this.meta||l.map(function(y){return r[y]!==i[y]}).filter(function(y){return y}).length>0;if(u&&(this.meta=this.getMeta(r)),o){var s=r.config,c=s.settings,d=c.renderIcon,f=c.renderButton,p=c.renderButtonGroup,m=c.renderSwitch,v=c.renderBeforeWidget,g=c.renderAfterWidget,S=c.renderRuleError;this.Icon=At(s,d),this.Btn=At(s,f),this.BtnGrp=At(s,p),this.Switch=At(s,m),this.BeforeWidget=At(s,v),this.AfterWidget=At(s,g),this.RuleError=At(s,S)}this.doRemove=function(){a.props.removeSelf()}}},{key:"getMeta",value:function(r){var a=r.selectedField,i=r.selectedFieldType,o=r.selectedOperator,l=r.config,u=r.reordableNodesCnt,s=r.isLocked,c=l.settings.keepInputOnChangeFieldSrc,d=IO(a,l),f=xO(l,a),p=f&&f.type==="!struct",m=c&&i,v=!!a||m,g=v&&o,S=jO(l,o,a),y=S&&S.options!=null,b=RO(l,a,o,null,null)||{},F=b.hideOperator,A=l.settings.canReorder&&u>1&&!s,w=v&&!F,x=v&&F&&b.operatorInlineLabel,k=g&&!p,D=g&&y;return{selectedFieldId:d,selectedFieldWidgetConfig:b,showDragIcon:A,showOperator:w,showOperatorLabel:x,showWidget:k,showOperatorOptions:D}}},{key:"setLock",value:function(r){this.props.setLock(r)}},{key:"removeSelf",value:function(){var r=this.props,a=r.confirmFn,i=r.config,o=i.settings,l=o.renderConfirm,u=o.removeRuleConfirmOptions;u&&!this.isEmptyCurrentRule()?l.call(i.ctx,sp(sp({},u),{},{onOk:this.doRemove,onCancel:null,confirmFn:a}),i.ctx):this.doRemove()}},{key:"_buildWidgetProps",value:function(r,a){var i=r.selectedField,o=r.selectedFieldSrc,l=r.selectedFieldType,u=r.selectedOperator,s=r.operatorOptions,c=r.value,d=r.valueType,f=r.valueSrc,p=r.asyncListValues,m=r.valueError,v=r.fieldError,g=r.parentField,S=a.selectedFieldId;return{field:i,fieldSrc:o,fieldType:l,fieldId:S,operator:u,operatorOptions:s,value:c,valueType:d,valueSrc:f,asyncListValues:p,valueError:m,fieldError:v,parentField:g}}},{key:"isEmptyCurrentRule",value:function(){var r=this.props.config,a=this._buildWidgetProps(this.props,this.meta);return PO(a,r)}},{key:"renderField",value:function(){var r=this.props,a=r.config,i=r.isLocked,o=r.parentField,l=r.groupId,u=r.id,s=r.selectedFieldSrc,c=r.selectedField,d=r.selectedFieldType,f=r.setField,p=r.setFuncValue,m=r.setFieldSrc,v=r.fieldError,g=a.settings.immutableFieldsMode,S=this.meta.selectedFieldId;return T.createElement(El,{key:"field",classname:Kt()(s=="func"?"rule--field--func":"rule--field"),config:a,canSelectFieldSource:!o,selectedField:c,selectedFieldSrc:s,selectedFieldType:d,selectedFieldId:S,fieldError:v,setField:g?Ct:f,setFuncValue:g?Ct:p,setFieldSrc:g?Ct:m,parentField:o,readonly:g||i,id:u,groupId:l})}},{key:"renderOperator",value:function(){var r=this.props,a=r.config,i=r.isLocked,o=this.meta,l=o.selectedFieldId,u=o.selectedFieldWidgetConfig,s=o.showOperator,c=o.showOperatorLabel,d=a.settings.immutableOpsMode;return T.createElement(Rf,{key:"operator",config:a,selectedField:this.props.selectedField,selectedFieldSrc:this.props.selectedFieldSrc,selectedFieldType:this.props.selectedFieldType,selectedFieldId:l,selectedOperator:this.props.selectedOperator,setOperator:d?Ct:this.props.setOperator,showOperator:s,showOperatorLabel:c,selectedFieldWidgetConfig:u,readonly:d||i,id:this.props.id,groupId:this.props.groupId})}},{key:"renderWidget",value:function(){var r=this.props,a=r.config,i=r.isLocked,o=this.meta.showWidget,l=a.settings.immutableValuesMode;if(!o)return null;var u=T.createElement(Ka,(0,ur.A)({key:"values"},this._buildWidgetProps(this.props,this.meta),{config:a,setValue:l?Ct:this.props.setValue,setValueSrc:l?Ct:this.props.setValueSrc,setFuncValue:l?Ct:this.props.setFuncValue,readonly:l||i,id:this.props.id,groupId:this.props.groupId}));return T.createElement(Jr,{key:"widget-for-"+this.props.selectedOperator,className:"rule--value"},u)}},{key:"renderOperatorOptions",value:function(){var r=this.props.config,a=this.meta.showOperatorOptions,i=r.settings,o=i.immutableOpsMode,l=i.immutableValuesMode;if(!a)return null;var u=T.createElement(lp,{key:"operatorOptions",selectedField:this.props.selectedField,selectedOperator:this.props.selectedOperator,operatorOptions:this.props.operatorOptions,setOperatorOption:o?Ct:this.props.setOperatorOption,config:r,readonly:l});return T.createElement(Jr,{key:"op-options-for-"+this.props.selectedOperator,className:"rule--operator-options"},u)}},{key:"renderBeforeWidget",value:function(){var r=this.BeforeWidget;return r?T.createElement(Jr,{key:"before-widget-for-"+this.props.selectedOperator,className:"rule--before-widget"},T.createElement(r,this.props)):null}},{key:"renderAfterWidget",value:function(){var r=this.AfterWidget;return r?T.createElement(Jr,{key:"after-widget-for-"+this.props.selectedOperator,className:"rule--after-widget"},T.createElement(r,this.props)):null}},{key:"renderError",value:function(){var r=this.props,a=r.config,i=r.valueError,o=r.fieldError,l=a.settings.showErrorMessage,u=this.RuleError,s=[o].concat((0,Fe.A)(i?.toArray()||[])).filter(function(c){return!!c}).shift()||null;return l&&s&&T.createElement("div",{className:"rule--error"},u?T.createElement(u,{error:s}):s)}},{key:"renderDrag",value:function(){var r=this.props.handleDraggerMouseDown,a=this.meta.showDragIcon,i=this.Icon,o=T.createElement(i,{type:"drag"});return a&&T.createElement("div",{key:"rule-drag-icon",onMouseDown:r,className:"qb-drag-handler rule--drag-handler"},o)}},{key:"renderDel",value:function(){var r=this.props,a=r.config,i=r.isLocked,o=a.settings,l=o.deleteLabel,u=o.immutableGroupsMode,s=o.canDeleteLocked,c=this.Icon,d=this.Btn;return!u&&(!i||i&&s)&&T.createElement(d,{key:"rule-del",type:"delRule",onClick:this.removeSelf,label:l,config:a,renderIcon:c})}},{key:"renderLock",value:function(){var r=this.props,a=r.config,i=r.isLocked,o=r.isTrueLocked,l=r.id,u=a.settings,s=u.lockLabel,c=u.lockedLabel,d=u.showLock,f=this.Switch;return d&&!(i&&!o)&&T.createElement(f,{key:"rule-lock",type:"lock",id:l,value:i,setValue:this.setLock,label:s,checkedLabel:c,hideLabel:!0,config:a})}},{key:"render",value:function(){var r=this.meta,a=r.showOperatorOptions,i=r.selectedFieldWidgetConfig,o=this.props,l=o.valueSrc,u=o.value,s=o.config,c=l?.first()=="value"&&!a&&u.size==1&&i.fullWidth,d=this.BtnGrp,f=[this.renderField(),this.renderOperator(),this.renderBeforeWidget(),this.renderWidget(),this.renderAfterWidget(),this.renderOperatorOptions()],p=T.createElement("div",{key:"rule-body",className:Kt()("rule--body",c&&"can--shrink--value")},f),m=this.renderError(),v=this.renderDrag(),g=this.renderLock(),S=this.renderDel();return T.createElement(T.Fragment,null,v,T.createElement("div",{key:"rule-body-wrapper",className:"rule--body--wrapper"},p,m),T.createElement("div",{key:"rule-header-wrapper",className:"rule--header"},T.createElement(d,{key:"rule-header-group",config:s},g,S)))}}])}(T.Component);dp.propTypes={id:R().string.isRequired,groupId:R().string,selectedField:R().any,selectedFieldSrc:R().string,selectedFieldType:R().string,selectedOperator:R().string,operatorOptions:R().object,config:R().object.isRequired,value:R().any,valueSrc:R().any,valueType:R().any,asyncListValues:R().array,isDraggingMe:R().bool,isDraggingTempo:R().bool,parentField:R().string,valueError:R().any,fieldError:R().string,isLocked:R().bool,isTrueLocked:R().bool,handleDraggerMouseDown:R().func,setField:R().func,setFieldSrc:R().func,setOperator:R().func,setOperatorOption:R().func,setLock:R().func,removeSelf:R().func,setValue:R().func,setValueSrc:R().func,setFuncValue:R().func,reordableNodesCnt:R().number,totalRulesCnt:R().number,parentReordableNodesCnt:R().number};const NO=_S(Oa("rule")(Fa(dp)));var DO=h(22331),VO=h.n(DO);function kO(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,fp()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function fp(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(fp=function(){return!!n})()}var MO=tr.DefaultUtils.defaultGroupConjunction,_O=function(e,t){var r;return r=function(a){function i(o){var l;return(0,br.A)(this,i),l=kO(this,i,[o]),l._selectedConjunction=function(u){return u=u||l.props,u.conjunction||MO(u.config,u.field)},l.setConjunction=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;l.props.actions.setConjunction(l.props.path,u)},l.setNot=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;l.props.actions.setNot(l.props.path,u)},l.setLock=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;l.props.actions.setLock(l.props.path,u)},l.dummyFn=function(){},l.removeSelf=function(){l.props.actions.removeGroup(l.props.path)},l.addGroup=function(){l.props.actions.addGroup(l.props.path)},l.addCaseGroup=function(){l.props.actions.addCaseGroup(l.props.path)},l.addDefaultCaseGroup=function(){l.props.actions.addDefaultCaseGroup(l.props.path)},l.addRule=function(){var u=t=="rule_group"?l.props.field:null;l.props.actions.addRule(l.props.path,void 0,void 0,void 0,u)},l.setField=function(u,s,c){l.props.actions.setField(l.props.path,u,s,c)},l.setOperator=function(u){l.props.actions.setOperator(l.props.path,u)},l.setValue=function(u,s,c,d,f){l.props.actions.setValue(l.props.path,u,s,c,d,f)},l.setValueSrc=function(u,s,c){l.props.actions.setValueSrc(l.props.path,u,s,c)},l.setFuncValue=function(u,s,c,d,f,p,m){l.props.actions.setFuncValue(l.props.path,u,s,c,d,f,p,m)},l.pureShouldComponentUpdate=Sa(l),Et(l),l.selectedConjunction=l._selectedConjunction(o),l.conjunctionOptions=l._getConjunctionOptions(o),l.dummyFn.isDummyFn=!0,l}return(0,Tr.A)(i,a),(0,Fr.A)(i,[{key:"shouldComponentUpdate",value:function(l,u){var s=this.props,c=this.state,d=this.pureShouldComponentUpdate(l,u);if(d&&c==u&&s!=l){var f=l.dragging.id||s.dragging.id,p=f==l.id,m=[];for(var v in l){var g=l[v]!=s[v];v=="dragging"&&!p&&(g=!1),g&&m.push(v)}m.length||(d=!1)}return d}},{key:"onPropsChanged",value:function(l){var u=l.config,s=l.id,c=l.conjunction,d=this.props.config,f=this.props.conjunction;(d!=u||f!=c)&&(this.selectedConjunction=this._selectedConjunction(l),this.conjunctionOptions=this._getConjunctionOptions(l))}},{key:"_getConjunctionOptions",value:function(l){var u=this;return wi()(l.config.conjunctions,function(s,c){return{id:"conjunction-".concat(l.id,"-").concat(c),name:"conjunction[".concat(l.id,"]"),key:c,label:s.label,checked:c===u._selectedConjunction(l)}})}},{key:"render",value:function(){var l=this.props.config.settings.showErrorMessage,u=this.props.dragging.id==this.props.id,s=this.props.path.size,c=this.props.config.settings.maxNesting,d=!u&&this.props.isDraggingTempo,f=this.props.fieldType||null,p=this.props.valueError,m=(0,Fe.A)(p?.toArray()||[]).filter(function(y){return!!y}).shift()||null,v=m!=null&&l,g=typeof c>"u"||s<c,S=s==1;return T.createElement("div",{className:Kt()("group-or-rule-container","group-container",v?"group-with-error":null),"data-id":this.props.id},[u?T.createElement(e,{key:"dragging",id:this.props.id,groupId:this.props.groupId,isDraggingMe:!0,isDraggingTempo:!0,dragging:this.props.dragging,isRoot:S,allowFurtherNesting:g,conjunctionOptions:this.conjunctionOptions,not:this.props.not,selectedConjunction:this.selectedConjunction,setConjunction:this.dummyFn,setNot:this.dummyFn,setLock:this.dummyFn,removeSelf:this.dummyFn,addGroup:this.dummyFn,addCaseGroup:this.dummyFn,addDefaultCaseGroup:this.dummyFn,addRule:this.dummyFn,setField:this.dummyFn,setFuncValue:this.dummyFn,setOperator:this.dummyFn,setValue:this.dummyFn,setValueSrc:this.dummyFn,value:this.props.value||null,valueError:this.props.valueError||null,valueSrc:this.props.valueSrc||null,config:this.props.config,children1:this.props.children1,actions:this.props.actions,reordableNodesCnt:this.props.reordableNodesCnt,totalRulesCnt:this.props.totalRulesCnt,selectedField:this.props.field||null,selectedFieldSrc:this.props.fieldSrc||"field",selectedFieldType:f,parentField:this.props.parentField||null,selectedOperator:this.props.operator||null,isLocked:this.props.isLocked,isTrueLocked:this.props.isTrueLocked,parentReordableNodesCnt:this.props.parentReordableNodesCnt}):null,T.createElement(e,{key:this.props.id,id:this.props.id,groupId:this.props.groupId,isDraggingMe:u,isDraggingTempo:d,onDragStart:this.props.onDragStart,isRoot:S,allowFurtherNesting:g,conjunctionOptions:this.conjunctionOptions,not:this.props.not,selectedConjunction:this.selectedConjunction,setConjunction:d?this.dummyFn:this.setConjunction,setNot:d?this.dummyFn:this.setNot,setLock:d?this.dummyFn:this.setLock,removeSelf:d?this.dummyFn:this.removeSelf,addGroup:d?this.dummyFn:this.addGroup,addCaseGroup:d?this.dummyFn:this.addCaseGroup,addDefaultCaseGroup:d?this.dummyFn:this.addDefaultCaseGroup,addRule:d?this.dummyFn:this.addRule,setField:d?this.dummyFn:this.setField,setFuncValue:d?this.dummyFn:this.setFuncValue,setOperator:d?this.dummyFn:this.setOperator,setValue:d?this.dummyFn:this.setValue,setValueSrc:d?this.dummyFn:this.setValueSrc,value:this.props.value||null,valueError:this.props.valueError||null,valueSrc:this.props.valueSrc||null,config:this.props.config,children1:this.props.children1,actions:this.props.actions,reordableNodesCnt:this.props.reordableNodesCnt,totalRulesCnt:this.props.totalRulesCnt,selectedField:this.props.field||null,selectedFieldSrc:this.props.fieldSrc||"field",selectedFieldType:f,parentField:this.props.parentField||null,selectedOperator:this.props.operator||null,isLocked:this.props.isLocked,isTrueLocked:this.props.isTrueLocked,parentReordableNodesCnt:this.props.parentReordableNodesCnt})])}}])}(T.Component),r.propTypes={config:R().object.isRequired,actions:R().object.isRequired,path:R().any.isRequired,id:R().string.isRequired,groupId:R().string,not:R().bool,conjunction:R().string,children1:R().any,onDragStart:R().func,reordableNodesCnt:R().number,field:R().any,fieldSrc:R().string,fieldType:R().string,parentField:R().string,value:R().any,valueSrc:R().any,valueError:R().any,isLocked:R().bool,isTrueLocked:R().bool,dragging:R().object,isDraggingTempo:R().bool},r};const za=function(n,e){var t=ji(function(r){return{dragging:r.dragging}},null,null,{context:Qa})(_O(n,e));return t.displayName="ConnectedGroupContainer",t};function GO(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,pp()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function pp(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(pp=function(){return!!n})()}var BO={topLeft:"group--actions--tl",topCenter:"group--actions--tc",topRight:"group--actions--tr",bottomLeft:"group--actions--bl",bottomCenter:"group--actions--bc",bottomRight:"group--actions--br"},UO="topRight",vp=function(n){function e(){return(0,br.A)(this,e),GO(this,e,arguments)}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"render",value:function(){var r=this.props,a=r.config,i=r.addRule,o=r.addGroup,l=r.removeSelf,u=r.setLock,s=r.isLocked,c=r.isTrueLocked,d=r.id,f=r.canAddGroup,p=r.canAddRule,m=r.canDeleteGroup,v=a.settings,g=v.immutableGroupsMode,S=v.addRuleLabel,y=v.addGroupLabel,b=v.delGroupLabel,F=v.groupActionsPosition,A=v.renderButton,w=v.renderIcon,x=v.renderSwitch,k=v.renderButtonGroup,D=v.lockLabel,I=v.lockedLabel,_=v.showLock,G=v.canDeleteLocked,M=function(ce){return w(ce,a.ctx)},H=function(ce){return A(ce,a.ctx)},K=function(ce){return x(ce,a.ctx)},z=function(ce){return k(ce,a.ctx)},U=BO[F||UO],ee=_&&!(s&&!c)&&T.createElement(K,{type:"lock",id:d,value:s,setValue:u,label:D,checkedLabel:I,config:a}),Y=!g&&p&&!s&&T.createElement(H,{type:"addRule",onClick:i,label:S,readonly:s,config:a,renderIcon:M}),oe=!g&&f&&!s&&T.createElement(H,{type:"addGroup",onClick:o,label:y,readonly:s,config:a,renderIcon:M}),ie=!g&&m&&(!s||s&&G)&&T.createElement(H,{type:"delGroup",onClick:l,label:b,config:a,renderIcon:M});return T.createElement("div",{className:"group--actions ".concat(U)},T.createElement(z,{config:a},ee,Y,oe,ie))}}])}(T.PureComponent);function gp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function mp(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?gp(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):gp(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function $O(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,hp()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function hp(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hp=function(){return!!n})()}var WO=tr.RuleUtils.isEmptyGroupChildren,QO="topRight",On=function(n){function e(t){var r;return(0,br.A)(this,e),r=$O(this,e,[t]),r.childrenClassName=function(){return""},r.renderBeforeActions=function(){var a=r.BeforeActions;return a==null?null:T.createElement(a,(0,ur.A)({key:"group-actions-before"},r.props))},r.renderAfterActions=function(){var a=r.AfterActions;return a==null?null:T.createElement(a,(0,ur.A)({key:"group-actions-after"},r.props))},Et(r),r.onPropsChanged(t),r.removeSelf=r.removeSelf.bind(r),r.setLock=r.setLock.bind(r),r.renderItem=r.renderItem.bind(r),r}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"onPropsChanged",value:function(r){var a=this,i=this.props,o=!this.Icon||i?.config!==r?.config;if(o){var l=r.config,u=l.settings,s=u.renderIcon,c=u.renderConjs,d=u.renderBeforeActions,f=u.renderAfterActions;this.Icon=At(l,s),this.Conjs=At(l,c),this.BeforeActions=At(l,d),this.AfterActions=At(l,f)}this.doRemove=function(){a.props.removeSelf()}}},{key:"isGroupTopPosition",value:function(){return VO()(this.props.config.settings.groupActionsPosition||QO,"top")}},{key:"setLock",value:function(r){this.props.setLock(r)}},{key:"removeSelf",value:function(){var r=this.props,a=r.confirmFn,i=r.config,o=i.settings,l=o.renderConfirm,u=o.removeGroupConfirmOptions;u&&!this.isEmptyCurrentGroup()?l.call(i.ctx,mp(mp({},u),{},{onOk:this.doRemove,onCancel:null,confirmFn:a}),i.ctx):this.doRemove()}},{key:"isEmptyCurrentGroup",value:function(){var r=this.props,a=r.children1,i=r.config;return WO(a,i)}},{key:"showNot",value:function(){var r=this.props.config;return r.settings.showNot}},{key:"showConjs",value:function(){var r=this.props,a=r.conjunctionOptions,i=r.children1,o=r.config,l=Object.keys(a).length;return l>1||this.showNot()}},{key:"isNoChildren",value:function(){var r=this.props.children1;return r?r.size==0:!0}},{key:"isOneChild",value:function(){var r=this.props.children1;return r?r.size<2:!0}},{key:"renderChildrenWrapper",value:function(){var r=this.props.children1;return r&&T.createElement("div",{key:"group-children",className:Kt()("group--children",this.showConjs()?"":"hide--conjs",this.isOneChild()?"hide--line":"",this.isOneChild()?"one--child":"",this.childrenClassName())},this.renderChildren())}},{key:"renderHeaderWrapper",value:function(){var r=this.isGroupTopPosition();return T.createElement("div",{key:"group-header",className:Kt()("group--header",this.isOneChild()?"one--child":"",this.showConjs()?"":"hide--conjs",this.isOneChild()?"hide--line":"",this.isNoChildren()?"no--children":"")},this.renderHeader(),r&&this.renderBeforeActions(),r&&this.renderActions(),r&&this.renderAfterActions())}},{key:"renderFooterWrapper",value:function(){var r=this.isGroupTopPosition();return!r&&T.createElement("div",{key:"group-footer",className:"group--footer"},this.renderBeforeActions(),this.renderActions(),this.renderAfterActions())}},{key:"renderActions",value:function(){var r=this.props,a=r.config,i=r.addRule,o=r.addGroup,l=r.isLocked,u=r.isTrueLocked,s=r.id;return T.createElement(vp,{key:"group-actions",config:a,addRule:i,addGroup:o,canAddGroup:this.canAddGroup(),canAddRule:this.canAddRule(),canDeleteGroup:this.canDeleteGroup(),removeSelf:this.removeSelf,setLock:this.setLock,isLocked:l,isTrueLocked:u,id:s})}},{key:"canAddGroup",value:function(){return this.props.allowFurtherNesting}},{key:"canAddRule",value:function(){var r=this.props.config.settings.maxNumberOfRules,a=this.props.totalRulesCnt;return r?a<r:!0}},{key:"canDeleteGroup",value:function(){return!this.props.isRoot}},{key:"renderChildren",value:function(){var r=this.props.children1;return r?r.valueSeq().toArray().map(this.renderItem):null}},{key:"renderItem",value:function(r){if(r){var a=this.props,i=a.config,o=a.actions,l=a.onDragStart,u=a.isLocked,s=r.get("type")=="group"&&r.getIn(["properties","field"])!=null,c=s?"rule_group":r.get("type");return T.createElement(Al,(0,ur.A)({},this.extraPropsForItem(r),{key:r.get("id"),id:r.get("id"),groupId:a.id,path:r.get("path"),type:c,properties:r.get("properties"),config:i,actions:o,children1:r.get("children1"),reordableNodesCnt:this.reordableNodesCntForItem(r),totalRulesCnt:this.totalRulesCntForItem(r),parentReordableNodesCnt:this.reordableNodesCnt(),onDragStart:l,isDraggingTempo:this.props.isDraggingTempo,isParentLocked:u}))}}},{key:"extraPropsForItem",value:function(r){return{}}},{key:"reordableNodesCnt",value:function(){return this.props.isLocked?0:this.props.reordableNodesCnt}},{key:"totalRulesCntForItem",value:function(r){return this.props.totalRulesCnt}},{key:"reordableNodesCntForItem",value:function(r){return this.props.isLocked?0:this.reordableNodesCnt()}},{key:"showDragIcon",value:function(){var r=this.props,a=r.config,i=r.isRoot,o=r.isLocked,l=this.reordableNodesCnt();return a.settings.canReorder&&!i&&l>1&&!o}},{key:"renderDrag",value:function(){var r=this.props.handleDraggerMouseDown,a=this.Icon,i=T.createElement(a,{type:"drag"});return this.showDragIcon()&&T.createElement("div",{key:"group-drag-icon",onMouseDown:r,className:"qb-drag-handler group--drag-handler"},i)}},{key:"conjunctionOptions",value:function(){var r=this.props.conjunctionOptions;return r}},{key:"renderConjs",value:function(){var r=this.props,a=r.config,i=r.children1,o=r.id,l=r.selectedConjunction,u=r.setConjunction,s=r.not,c=r.setNot,d=r.isLocked,f=a.settings,p=f.immutableGroupsMode,m=f.renderConjs,v=f.showNot,g=f.notLabel,S=this.conjunctionOptions();if(!this.showConjs()||!i||!i.size)return null;var y={disabled:this.isOneChild(),readonly:p||d,selectedConjunction:l,setConjunction:p?Ct:u,conjunctionOptions:S,config:a,not:s||!1,id:o,setNot:p?Ct:c,notLabel:g,showNot:this.showNot(),isLocked:d},b=this.Conjs;return T.createElement(b,(0,ur.A)({key:"group-conjs"},y))}},{key:"renderHeader",value:function(){return T.createElement("div",{key:"group-conjunctions",className:"group--conjunctions"},this.renderConjs(),this.renderDrag())}},{key:"render",value:function(){return T.createElement(T.Fragment,null,this.renderHeaderWrapper(),this.renderChildrenWrapper(),this.renderFooterWrapper())}}])}(T.Component);On.propTypes={reordableNodesCnt:R().number,conjunctionOptions:R().object.isRequired,allowFurtherNesting:R().bool.isRequired,isRoot:R().bool.isRequired,not:R().bool,selectedConjunction:R().string,config:R().object.isRequired,id:R().string.isRequired,groupId:R().string,path:R().any,children1:R().any,isDraggingMe:R().bool,isDraggingTempo:R().bool,isLocked:R().bool,isTrueLocked:R().bool,handleDraggerMouseDown:R().func,onDragStart:R().func,addRule:R().func.isRequired,addGroup:R().func.isRequired,removeSelf:R().func.isRequired,setConjunction:R().func.isRequired,setNot:R().func.isRequired,setLock:R().func.isRequired,actions:R().object.isRequired};const KO=za(Oa("group")(Fa(On)),"group");function zO(n,e){for(;!{}.hasOwnProperty.call(n,e)&&(n=(0,xe.A)(n))!==null;);return n}function Mt(){return Mt=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(n,e,t){var r=zO(n,e);if(r){var a=Object.getOwnPropertyDescriptor(r,e);return a.get?a.get.call(arguments.length<3?n:t):a.value}},Mt.apply(null,arguments)}function HO(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,yp()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function yp(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(yp=function(){return!!n})()}var qO=function(n){function e(){return(0,br.A)(this,e),HO(this,e,arguments)}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"render",value:function(){var r=this.props,a=r.config,i=r.addRule,o=r.canAddRule,l=r.canDeleteGroup,u=r.removeSelf,s=r.setLock,c=r.isLocked,d=r.isTrueLocked,f=r.id,p=a.settings,m=p.immutableGroupsMode,v=p.addRuleLabel,g=p.delGroupLabel,S=p.renderButton,y=p.renderIcon,b=p.renderSwitch,F=p.renderButtonGroup,A=p.lockLabel,w=p.lockedLabel,x=p.showLock,k=p.canDeleteLocked,D=function(U){return y(U,a.ctx)},I=function(U){return S(U,a.ctx)},_=function(U){return b(U,a.ctx)},G=function(U){return F(U,a.ctx)},M=x&&!(c&&!d)&&T.createElement(_,{type:"lock",id:f,value:c,setValue:s,label:A,checkedLabel:w,hideLabel:!0,config:a}),H=!m&&o&&!c&&T.createElement(I,{type:"addRuleGroup",onClick:i,label:v,readonly:c,config:a,renderIcon:D}),K=!m&&l&&(!c||c&&k)&&T.createElement(I,{type:"delRuleGroup",onClick:u,label:g,config:a,renderIcon:D});return T.createElement("div",{className:"group--actions"},T.createElement(G,{config:a},M,H,K))}}])}(T.PureComponent);function Sp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Op(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Sp(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Sp(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function JO(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,bp()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function bp(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(bp=function(){return!!n})()}var Fp=function(n){function e(t){var r;return(0,br.A)(this,e),r=JO(this,e,[t]),r.childrenClassName=function(){return"rule_group--children"},r.renderHeaderWrapper=function(){return null},r.renderFooterWrapper=function(){return null},r.renderConjs=function(){return null},r.canAddGroup=function(){return!1},r.canAddRule=function(){return!0},r.canDeleteGroup=function(){return!1},r}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"onPropsChanged",value:function(r){Mt((0,xe.A)(e.prototype),"onPropsChanged",this).call(this,r)}},{key:"reordableNodesCntForItem",value:function(r){if(this.props.isLocked)return 0;var a=this.props.children1;return a?.size||0}},{key:"renderChildrenWrapper",value:function(){return T.createElement(T.Fragment,null,this.renderDrag(),this.renderField(),this.renderActions(),Mt((0,xe.A)(e.prototype),"renderChildrenWrapper",this).call(this))}},{key:"renderField",value:function(){var r=this.props,a=r.config,i=r.selectedField,o=r.selectedFieldSrc,l=r.selectedFieldType,u=r.setField,s=r.setFuncValue,c=r.setFieldSrc,d=r.parentField,f=r.id,p=r.groupId,m=r.isLocked,v=a.settings.immutableFieldsMode;return T.createElement(El,{key:"field",classname:"group--field",config:a,canSelectFieldSource:!1,selectedField:i,selectedFieldSrc:o,selectedFieldType:l,setField:u,setFuncValue:s,setFieldSrc:c,parentField:d,readonly:v||m,id:f,groupId:p})}},{key:"renderActions",value:function(){var r=this.props,a=r.config,i=r.addRule,o=r.isLocked,l=r.isTrueLocked,u=r.id;return T.createElement(qO,{config:a,addRule:i,canAddRule:this.canAddRule(),canDeleteGroup:this.canDeleteGroup(),removeSelf:this.removeSelf,setLock:this.setLock,isLocked:o,isTrueLocked:l,id:u})}},{key:"extraPropsForItem",value:function(r){return{parentField:this.props.selectedField}}}])}(On);Fp.propTypes=Op(Op({},On.propTypes),{},{selectedField:R().any,selectedFieldSrc:R().string,parentField:R().string,setField:R().func,setFieldSrc:R().func});const YO=za(Oa("group rule_group")(Fa(Fp)),"rule_group");function XO(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,Tp()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function Tp(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Tp=function(){return!!n})()}var ZO=function(n){function e(){return(0,br.A)(this,e),XO(this,e,arguments)}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"render",value:function(){var r=this.props,a=r.config,i=r.addRule,o=r.canAddRule,l=r.canDeleteGroup,u=r.removeSelf,s=r.setLock,c=r.isLocked,d=r.isTrueLocked,f=r.id,p=a.settings,m=p.immutableGroupsMode,v=p.addSubRuleLabel,g=p.delGroupLabel,S=p.renderButton,y=p.renderIcon,b=p.renderSwitch,F=p.renderButtonGroup,A=p.lockLabel,w=p.lockedLabel,x=p.showLock,k=p.canDeleteLocked,D=function(U){return y(U,a.ctx)},I=function(U){return S(U,a.ctx)},_=function(U){return b(U,a.ctx)},G=function(U){return F(U,a.ctx)},M=x&&!(c&&!d)&&T.createElement(_,{type:"lock",id:f,value:c,setValue:s,label:A,checkedLabel:w,config:a}),H=!m&&o&&!c&&T.createElement(I,{type:"addRuleGroupExt",onClick:i,label:v,readonly:c,config:a,renderIcon:D}),K=!m&&l&&(!c||c&&k)&&T.createElement(I,{type:"delRuleGroup",onClick:u,label:g,config:a,renderIcon:D});return T.createElement("div",{className:"group--actions group--actions--tr"},T.createElement(G,{config:a},M,H,K))}}])}(T.PureComponent);function Ep(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Cp(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ep(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ep(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function eb(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=rb(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(s){throw s},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,l;return{s:function(){t=t.call(n)},n:function(){var s=t.next();return i=s.done,s},e:function(s){o=!0,l=s},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function rb(n,e){if(n){if(typeof n=="string")return Ap(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ap(n,e)}}function Ap(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function tb(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,Lp()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function Lp(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Lp=function(){return!!n})()}var wp=tr.ConfigUtils,xp=wp.getFieldConfig,nb=wp.getFieldWidgetConfig,ab=tr.RuleUtils.isEmptyRuleGroupExtPropertiesAndChildren,jp=function(n){function e(t){var r;return(0,br.A)(this,e),r=tb(this,e,[t]),r.childrenClassName=function(){return"rule_group_ext--children"},r.renderFooterWrapper=function(){return null},r.canAddGroup=function(){return!1},r.canAddRule=function(){return!0},r.canDeleteGroup=function(){return!0},r}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"onPropsChanged",value:function(r){Mt((0,xe.A)(e.prototype),"onPropsChanged",this).call(this,r)}},{key:"renderHeaderWrapper",value:function(){return T.createElement("div",{key:"group-header",className:Kt()("group--header",this.isOneChild()?"one--child":"",this.isOneChild()?"hide--line":"",this.isNoChildren()?"no--children":"",this.showDragIcon()?"with--drag":"hide--drag",this.showConjs()&&(!this.isOneChild()||this.showNot())?"with--conjs":"hide--conjs")},this.renderHeader(),this.renderGroupField(),this.renderActions())}},{key:"renderHeader",value:function(){return T.createElement("div",{className:"group--conjunctions"},this.renderConjs(),this.renderDrag())}},{key:"renderGroupField",value:function(){return T.createElement("div",{className:"group--field--count--rule"},this.renderField(),this.renderOperator(),this.renderWidget(),this.renderError())}},{key:"renderError",value:function(){var r=this.props,a=r.config,i=r.valueError,o=a.settings,l=o.renderRuleError,u=o.showErrorMessage,s=(0,Fe.A)(i?.toArray()||[]).filter(function(c){return!!c}).shift()||null;return u&&s&&T.createElement("div",{className:"rule_group--error"},l?l({error:s},a.ctx):s)}},{key:"showNot",value:function(){var r=this.props,a=r.config,i=r.selectedField,o=r.selectedOperator,l=xp(a,i)||{};return l.showNot!=null?l.showNot:a.settings.showNot}},{key:"conjunctionOptions",value:function(){var r=this.props,a=r.config,i=r.selectedField,o=r.selectedOperator,l=xp(a,i)||{},u=Mt((0,xe.A)(e.prototype),"conjunctionOptions",this).call(this);if(l.conjunctions){var s={},c=eb(l.conjunctions),d;try{for(c.s();!(d=c.n()).done;){var f=d.value,p=u[f];p&&(s[f]=p)}}catch(m){c.e(m)}finally{c.f()}u=s}return u}},{key:"renderField",value:function(){var r=this.props,a=r.config,i=r.selectedField,o=r.selectedFieldSrc,l=r.selectedFieldType,u=r.setField,s=r.setFieldSrc,c=r.setFuncValue,d=r.parentField,f=r.id,p=r.groupId,m=r.isLocked,v=a.settings.immutableFieldsMode;return T.createElement(El,{key:"field",classname:"rule--field",config:a,canSelectFieldSource:!1,selectedField:i,selectedFieldSrc:o,selectedFieldType:l,setField:u,setFuncValue:c,setFieldSrc:s,parentField:d,readonly:v||m,id:f,groupId:p})}},{key:"renderOperator",value:function(){var r=this.props,a=r.config,i=r.selectedField,o=r.selectedFieldSrc,l=r.selectedOperator,u=r.setField,s=r.setOperator,c=r.isLocked,d=a.settings.immutableFieldsMode,f=nb(a,i,l)||{},p=f.hideOperator,m=i&&p&&f.operatorInlineLabel,v=i&&!p;return T.createElement(Rf,{key:"operator",classname:"group--operator",config:a,selectedField:i,selectedFieldSrc:o,selectedOperator:l,setOperator:s,showOperator:v,showOperatorLabel:m,selectedFieldWidgetConfig:f,readonly:d||c,id:this.props.id,groupId:this.props.groupId})}},{key:"isEmptyCurrentGroup",value:function(){var r=this.props,a=r.children1,i=r.config,o=this._buildWidgetProps(this.props);return ab(o,a,i)}},{key:"_buildWidgetProps",value:function(r){var a=r.selectedField,i=r.selectedFieldSrc,o=r.selectedFieldType,l=r.selectedOperator,u=r.operatorOptions,s=r.value,c=r.valueType,d=r.valueSrc,f=r.asyncListValues,p=r.valueError,m=r.fieldError,v=r.parentField;return{field:a,fieldSrc:i,fieldType:o,operator:l,operatorOptions:u,value:s,valueType:c,valueSrc:["value"],valueError:p,fieldError:null,parentField:v}}},{key:"renderWidget",value:function(){var r=this.props,a=r.config,i=r.selectedField,o=r.selectedOperator,l=r.isLocked,u=a.settings.immutableValuesMode,s=i&&o,c=s;if(!c)return null;var d=T.createElement(Ka,(0,ur.A)({key:"values",isForRuleGroup:!0},this._buildWidgetProps(this.props),{config:a,setValue:u?Ct:this.props.setValue,setValueSrc:Ct,readonly:u||l,id:this.props.id,groupId:this.props.groupId}));return T.createElement(Jr,{key:"widget-for-"+this.props.selectedOperator,className:"rule--value"},d)}},{key:"renderActions",value:function(){var r=this.props,a=r.config,i=r.addRule,o=r.isLocked,l=r.isTrueLocked,u=r.id;return T.createElement(ZO,{config:a,addRule:i,canAddRule:this.canAddRule(),canDeleteGroup:this.canDeleteGroup(),removeSelf:this.removeSelf,setLock:this.setLock,isLocked:o,isTrueLocked:l,id:u})}},{key:"reordableNodesCntForItem",value:function(r){if(this.props.isLocked)return 0;var a=this.props.children1;return a?.size||0}},{key:"extraPropsForItem",value:function(r){return{parentField:this.props.selectedField}}}])}(On);jp.propTypes=Cp(Cp({},On.propTypes),{},{selectedField:R().any,selectedFieldSrc:R().string,selectedOperator:R().string,value:R().any,parentField:R().string,setField:R().func,setFieldSrc:R().func,setOperator:R().func,setValue:R().func,valueError:R().any});const ib=za(Oa("group rule_group_ext")(Fa(jp)),"rule_group");function ob(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,Rp()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function Rp(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Rp=function(){return!!n})()}var lb={topLeft:"group--actions--tl",topCenter:"group--actions--tc",topRight:"group--actions--tr",bottomLeft:"group--actions--bl",bottomCenter:"group--actions--bc",bottomRight:"group--actions--br"},ub="topRight",sb=function(n){function e(){return(0,br.A)(this,e),ob(this,e,arguments)}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"render",value:function(){var r=this.props,a=r.config,i=r.addCaseGroup,o=r.addDefaultCaseGroup,l=r.setLock,u=r.isLocked,s=r.isTrueLocked,c=r.id,d=r.canAddGroup,f=r.canAddDefault,p=a.settings,m=p.immutableGroupsMode,v=p.addCaseLabel,g=p.addDefaultCaseLabel,S=p.groupActionsPosition,y=p.renderButton,b=p.renderIcon,F=p.renderSwitch,A=p.renderButtonGroup,w=p.lockLabel,x=p.lockedLabel,k=p.showLock,D=function(ee){return b(ee,a.ctx)},I=function(ee){return y(ee,a.ctx)},_=function(ee){return F(ee,a.ctx)},G=function(ee){return A(ee,a.ctx)},M=lb[S||ub],H=k&&!(u&&!s)&&T.createElement(_,{type:"lock",id:c,value:u,setValue:l,label:w,checkedLabel:x,config:a}),K=!m&&d&&!u&&T.createElement(I,{type:"addCaseGroup",onClick:i,label:v,readonly:u,config:a,renderIcon:D}),z=!m&&f&&!u&&T.createElement(I,{type:"addDefaultCaseGroup",onClick:o,label:g,readonly:u,config:a,renderIcon:D});return T.createElement("div",{className:"group--actions ".concat(M)},T.createElement(G,{config:a},H,K,z))}}])}(T.PureComponent);function Ip(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function cb(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ip(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ip(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function db(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,Pp()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function Pp(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Pp=function(){return!!n})()}var Np=tr.TreeUtils,fb=Np.getTotalReordableNodesCountInTree,pb=Np.getTotalRulesCountInTree,Dp=function(n){function e(t){var r;return(0,br.A)(this,e),r=db(this,e,[t]),r.childrenClassName=function(){return"switch_group--children"},r.renderFooterWrapper=function(){return null},r.hasDefaultCase=function(){var a;return((a=r.props.children1)===null||a===void 0?void 0:a.size)&&r.props.children1.filter(function(i){return i.get("children1")==null}).size>0},r}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"onPropsChanged",value:function(r){Mt((0,xe.A)(e.prototype),"onPropsChanged",this).call(this,r)}},{key:"canAddGroup",value:function(){var r,a=this.props.config.settings.maxNumberOfCases,i=((r=this.props.children1)===null||r===void 0?void 0:r.size)||0;return a?i<a:!0}},{key:"canAddRule",value:function(){return!1}},{key:"reordableNodesCnt",value:function(){var r,a=((r=this.props.children1)===null||r===void 0?void 0:r.size)||0,i=a;return this.hasDefaultCase()&&i--,i}},{key:"totalRulesCntForItem",value:function(r){return pb(r)}},{key:"reordableNodesCntForItem",value:function(r){var a;if(this.props.isLocked)return 0;var i=this.props.config.settings,o=i.canLeaveEmptyCase,l=i.canRegroupCases,u=((a=this.props.children1)===null||a===void 0?void 0:a.size)||0,s=u;this.hasDefaultCase()&&s--;var c=fb(r),d=c;return d==1&&l&&o&&s>1&&(d=111),d}},{key:"renderHeaderWrapper",value:function(){return T.createElement("div",{key:"group-header",className:Kt()("group--header",this.isOneChild()?"one--child":"",this.isOneChild()?"hide--line":"",this.isNoChildren()?"no--children":"",this.showDragIcon()?"with--drag":"hide--drag")},this.renderHeader(),this.renderActions())}},{key:"renderHeader",value:function(){return T.createElement("div",{className:"group--conjunctions"},this.renderConjs(),this.renderDrag())}},{key:"renderConjs",value:function(){var r=this.props.config,a=r.settings.renderSwitchPrefix;return a||null}},{key:"showNot",value:function(){return!1}},{key:"renderActions",value:function(){var r=this.props,a=r.config,i=r.addCaseGroup,o=r.addDefaultCaseGroup,l=r.isLocked,u=r.isTrueLocked,s=r.id;return T.createElement(sb,{config:a,addCaseGroup:i,addDefaultCaseGroup:o,canAddDefault:!this.hasDefaultCase(),canAddGroup:this.canAddGroup(),setLock:this.setLock,isLocked:l,isTrueLocked:u,id:s})}}])}(On);Dp.propTypes=cb({},On.propTypes);const vb=za(Oa("group switch_group")(Fa(Dp)),"switch_group");function Vp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function kp(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Vp(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Vp(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function gb(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,Mp()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function Mp(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Mp=function(){return!!n})()}var _p=function(n){function e(t){var r;return(0,br.A)(this,e),r=gb(this,e,[t]),r.childrenClassName=function(){return"case_group--children"},r.renderFooterWrapper=function(){return null},r}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"onPropsChanged",value:function(r){var a=this.props,i=!this.renderBeforeCaseValue||a?.config!==r?.config;if(Mt((0,xe.A)(e.prototype),"onPropsChanged",this).call(this,r),i){var o=r.config,l=o.settings,u=l.renderBeforeCaseValue,s=l.renderAfterCaseValue,c=l.renderRuleError;this.BeforeCaseValue=At(o,u),this.AfterCaseValue=At(o,s),this.RuleError=At(o,c)}}},{key:"isDefaultCase",value:function(){return this.props.children1==null}},{key:"reordableNodesCnt",value:function(){return this.props.parentReordableNodesCnt}},{key:"reordableNodesCntForItem",value:function(r){return this.props.isLocked?0:this.props.reordableNodesCnt}},{key:"totalRulesCntForItem",value:function(r){return this.props.totalRulesCnt}},{key:"showDragIcon",value:function(){return this.isDefaultCase()?!1:Mt((0,xe.A)(e.prototype),"showDragIcon",this).call(this)}},{key:"renderHeaderWrapper",value:function(){return T.createElement("div",{key:"group-header",className:Kt()("group--header",this.isOneChild()?"one--child":"",this.isOneChild()?"hide--line":"",this.isNoChildren()?"no--children":"",this.showDragIcon()?"with--drag":"hide--drag",this.showConjs()&&(!this.isOneChild()||this.showNot())?"with--conjs":"hide--conjs")},this.renderHeaderLeft(),this.renderHeaderCenter(),this.renderActions())}},{key:"renderChildrenWrapper",value:function(){return this.isDefaultCase()?null:T.createElement("div",{className:"case_group--body"},this.renderCondition(),this.renderBeforeValue(),this.renderValue(),this.renderAfterValue())}},{key:"renderHeaderLeft",value:function(){if(this.isDefaultCase()){var r=this.props.config.settings.defaultCaseLabel;return r||""}return T.createElement("div",{className:"group--conjunctions"},this.renderConjs(),this.renderDrag(),this.renderError())}},{key:"renderCondition",value:function(){return this.isDefaultCase()?null:Mt((0,xe.A)(e.prototype),"renderChildrenWrapper",this).call(this)}},{key:"renderHeaderCenter",value:function(){return this.isDefaultCase()?T.createElement("div",null,this.renderValue(),this.renderError()):null}},{key:"canAddGroup",value:function(){return this.isDefaultCase()?!1:Mt((0,xe.A)(e.prototype),"canAddGroup",this).call(this)}},{key:"canAddRule",value:function(){return this.isDefaultCase()?!1:Mt((0,xe.A)(e.prototype),"canAddRule",this).call(this)}},{key:"renderBeforeValue",value:function(){var r=this.BeforeCaseValue;return r==null?null:T.createElement(r,(0,ur.A)({key:"values-before"},this.props))}},{key:"renderAfterValue",value:function(){var r=this.AfterCaseValue;return r==null?null:T.createElement(r,(0,ur.A)({key:"values-after"},this.props))}},{key:"renderError",value:function(){var r=this.props,a=r.config,i=r.valueError,o=a.settings.showErrorMessage,l=this.RuleError,u=(0,Fe.A)(i?.toArray()||[]).filter(function(s){return!!s}).shift()||null;return o&&u&&T.createElement("div",{className:"rule--error"},l?T.createElement(l,{error:u}):u)}},{key:"renderValue",value:function(){var r=this.props,a=r.config,i=r.isLocked,o=r.value,l=r.valueSrc,u=r.valueError,s=r.setValue,c=r.setValueSrc,d=r.setFuncValue,f=r.id,p=a.settings.immutableValuesMode,m=T.createElement(Ka,{key:"values",isCaseValue:!0,field:"!case_value",operator:null,value:o,valueSrc:l??"value",valueError:u,fieldError:null,config:a,setValue:p?Ct:s,setValueSrc:p?Ct:c,setFuncValue:p?Ct:d,readonly:p||i,id:f,groupId:null});return T.createElement(Jr,{className:"case_group--value"},m)}},{key:"renderActions",value:function(){var r=this.props,a=r.config,i=r.addGroup,o=r.addRule,l=r.isLocked,u=r.isTrueLocked,s=r.id;return T.createElement(vp,{config:a,addGroup:i,addRule:o,canAddRule:this.canAddRule(),canAddGroup:this.canAddGroup(),canDeleteGroup:this.canDeleteGroup(),removeSelf:this.removeSelf,setLock:this.setLock,isLocked:l,isTrueLocked:u,id:s})}},{key:"isEmptyCurrentGroup",value:function(){var r=this.props.value,a=r&&r.size?r.get(0):null,i=a!=null&&(Array.isArray(a)?a.length>0:!0);return Mt((0,xe.A)(e.prototype),"isEmptyCurrentGroup",this).call(this)&&!i}}])}(On);_p.propTypes=kp(kp({},On.propTypes),{},{parentReordableNodesCnt:R().number,value:R().any,setValue:R().func});const mb=za(Oa("group case_group")(Fa(_p)),"case_group");var hb=["type"];function yb(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,Gp()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function Gp(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Gp=function(){return!!n})()}function Bp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Cl(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Bp(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Bp(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var Sb=["rule","group","rule_group","switch_group","case_group"],Ta=function(e){var t,r=((t=e.properties)===null||t===void 0?void 0:t.toObject())||{},a=Cl({},r);return e.isParentLocked&&(a.isLocked=!0),r.isLocked&&(a.isTrueLocked=!0),a},Ob={rule:function(e){return T.createElement(NO,(0,ur.A)({},Ta(e),{id:e.id,groupId:e.groupId,path:e.path,actions:e.actions,reordableNodesCnt:e.reordableNodesCnt,totalRulesCnt:e.totalRulesCnt,config:e.config,onDragStart:e.onDragStart,isDraggingTempo:e.isDraggingTempo,parentField:e.parentField,parentReordableNodesCnt:e.parentReordableNodesCnt}))},group:function(e){return T.createElement(KO,(0,ur.A)({},Ta(e),{id:e.id,groupId:e.groupId,path:e.path,actions:e.actions,config:e.config,reordableNodesCnt:e.reordableNodesCnt,totalRulesCnt:e.totalRulesCnt,onDragStart:e.onDragStart,isDraggingTempo:e.isDraggingTempo,children1:e.children1,parentField:null,parentReordableNodesCnt:e.parentReordableNodesCnt}))},rule_group:function(e){return T.createElement(YO,(0,ur.A)({},Ta(e),{id:e.id,groupId:e.groupId,path:e.path,actions:e.actions,config:e.config,reordableNodesCnt:e.reordableNodesCnt,totalRulesCnt:e.totalRulesCnt,onDragStart:e.onDragStart,isDraggingTempo:e.isDraggingTempo,children1:e.children1,parentField:e.parentField,parentReordableNodesCnt:e.parentReordableNodesCnt}))},rule_group_ext:function(e){return T.createElement(ib,(0,ur.A)({},Ta(e),{id:e.id,groupId:e.groupId,path:e.path,actions:e.actions,config:e.config,reordableNodesCnt:e.reordableNodesCnt,totalRulesCnt:e.totalRulesCnt,onDragStart:e.onDragStart,isDraggingTempo:e.isDraggingTempo,children1:e.children1,parentField:e.parentField,parentReordableNodesCnt:e.parentReordableNodesCnt}))},switch_group:function(e){return T.createElement(vb,(0,ur.A)({},Ta(e),{id:e.id,groupId:e.groupId,path:e.path,actions:e.actions,config:e.config,reordableNodesCnt:e.reordableNodesCnt,totalRulesCnt:e.totalRulesCnt,onDragStart:e.onDragStart,isDraggingTempo:e.isDraggingTempo,children1:e.children1,parentField:null,parentReordableNodesCnt:e.parentReordableNodesCnt}))},case_group:function(e){return T.createElement(mb,(0,ur.A)({},Ta(e),{id:e.id,groupId:e.groupId,path:e.path,actions:e.actions,config:e.config,reordableNodesCnt:e.reordableNodesCnt,totalRulesCnt:e.totalRulesCnt,onDragStart:e.onDragStart,isDraggingTempo:e.isDraggingTempo,children1:e.children1,parentField:null,parentReordableNodesCnt:e.parentReordableNodesCnt}))}},Al=function(n){function e(){return(0,br.A)(this,e),yb(this,e,arguments)}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"render",value:function(){var r,a=this.props,i=a.type,o=(0,Xn.A)(a,hb),l=(r=o.properties)===null||r===void 0?void 0:r.get("mode"),u=l=="array"?"_ext":"",s=o.config.settings.renderItem,c=Ob[i+u];return s?s(Cl(Cl({},o),{},{type:i,itemComponent:c}),o.config.ctx):c?c(o):null}}])}(T.PureComponent);Al.propTypes={config:R().object.isRequired,id:R().string.isRequired,groupId:R().string,type:R().oneOf(Sb).isRequired,path:R().any.isRequired,properties:R().any,children1:R().any,actions:R().object.isRequired,reordableNodesCnt:R().number,onDragStart:R().func,parentField:R().string,isDraggingTempo:R().bool,isParentLocked:R().bool};function bb(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,Up()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function Up(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Up=function(){return!!n})()}var $p=tr.TreeUtils,Fb=$p.getTotalReordableNodesCountInTree,Tb=$p.getTotalRulesCountInTree,Wp=tr.DefaultUtils,Eb=Wp.createListWithOneElement,Qp=Wp.emptyProperties,Kp=function(n){function e(t){var r;return(0,br.A)(this,e),r=bb(this,e,[t]),r.pureShouldComponentUpdate=Sa(r),r._updPath(t),r}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"shouldComponentUpdate",value:function(r,a){var i=this.pureShouldComponentUpdate(r,a);return i}},{key:"_updPath",value:function(r){var a=r.tree.get("id");this.path=Eb(a)}},{key:"render",value:function(){var r=this.props,a=r.tree,i=r.config,o=r.actions,l=r.onDragStart,u=a.get("type"),s=u=="switch_group",c=s?null:Fb(a),d=s?null:Tb(a),f=a.get("id");return T.createElement(Al,{key:f,id:f,path:this.path,type:u,properties:a.get("properties")||Qp(),config:i,actions:o,children1:a.get("children1")||Qp(),reordableNodesCnt:c,totalRulesCnt:d,parentReordableNodesCnt:0,onDragStart:l})}}])}(T.Component);Kp.propTypes={tree:R().any.isRequired,config:R().object.isRequired,actions:R().object.isRequired,onDragStart:R().func};const Cb=$S(Kp);function zp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Ab(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?zp(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):zp(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Lb(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,Hp()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function Hp(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Hp=function(){return!!n})()}var wb=tr.clone,Ll=tr.ConfigUtils,Ha=Ll.getFieldConfig,qp=Ll.getFieldParts,Jp=Ll.getFieldPathParts,Yp=tr.RuleUtils,Xp=Yp.getFieldPathLabels,xb=Yp.getWidgetForFieldOp,Zp=function(n){function e(t){var r;return(0,br.A)(this,e),r=Lb(this,e,[t]),Et(r),r.onPropsChanged(t),r}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"onPropsChanged",value:function(r){var a=this.props,i=["config","field","fieldSrc","fieldType","operator","isFuncArg","parentField"],o=["config","field","fieldSrc","fieldType","operator","value","placeholder","isFuncArg","parentField"],l=!this.items||i.map(function(s){return r[s]!==a[s]}).filter(function(s){return s}).length>0,u=!this.meta||o.map(function(s){return r[s]!==a[s]}).filter(function(s){return s}).length>0;l&&(this.items=this.getItems(r)),u&&(this.meta=this.getMeta(r))}},{key:"getItems",value:function(r){var a=r.config,i=r.field,o=r.fieldType,l=r.operator,u=r.parentField,s=r.isFuncArg,c=r.fieldDefinition,d=a.settings.canCompareFieldWithField,f=qp(u,a),p=u?Ha(a,u):null,m=u?p?.subfields:a.fields,v=this.filterFields(a,m,i,u,f,l,d,s,c,o),g=this.buildOptions(f,a,v,f);return g}},{key:"getMeta",value:function(r){var a,i=r.config,o=r.field,l=r.fieldType,u=r.operator,s=r.value,c=r.placeholder,d=r.isFuncArg,f=r.parentField,p=i.settings,m=p.fieldPlaceholder,v=p.fieldSeparatorDisplay,g=s,S=!!s,y=o?Ha(i,o):{},b=y==null||(a=y.widgets)===null||a===void 0?void 0:a.field,F=b?.widgetProps||{},A=S?null:d&&c||F.valuePlaceholder||m,w=S?Ha(i,g):null,x=w||{},k=Jp(g,i),D=Jp(g,i,!0),I=this.getFieldLabel(w,g,i),_=Xp(g,i),G=_?_.join(v):null;(G==I||f)&&(G=null);var M=x.label2||x.tooltip;return{placeholder:A,selectedKey:g,selectedKeys:k,selectedPath:D,selectedLabel:I,selectedOpts:x,selectedAltLabel:M,selectedFullLabel:G}}},{key:"filterFields",value:function(r,a,i,o,l,u,s,c,d,f){a=wb(a);var p=r.settings.fieldSeparator,m=Ha(r,i),v=!1,g=xb(r,i,u,"value"),S=r.widgets[g],y;c?y=d?.type:v&&S?y=S.type:m?y=m.type:y=f;function b(F,A){for(var w in F){var x=F[w].subfields,k=(A||[]).concat(w),D=k.join(p),I=Ha(r,D);if(!I)delete F[w];else if(I.type=="!struct"||I.type=="!group")b(x,k)==0&&delete F[w];else{var _=(!y||I.type==y)&&(c?!0:D!=i),G=s||r.settings.canCompareFieldWithField;G&&(_=_&&G(i,m,D,I,u)),_||delete F[w]}}return ba()(F).length}return b(a,l||[]),a}},{key:"buildOptions",value:function(r,a,i){var o=this,l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!i)return null;var s=a.settings,c=s.fieldSeparator,d=s.fieldSeparatorDisplay,f=l!=null&&l.length?l.join(c)+c:"";return ba()(i).map(function(p){var m=[].concat((0,Fe.A)(l??[]),[p]),v=i[p],g=o.getFieldLabel(v,m,a),S=Xp(m,a),y=S.join(d);(y==g||r)&&(y=null);var b=v.label2,F=v.tooltip;if(!v.hideForCompare)return v.type=="!struct"||v.type=="!group"?{key:p,path:f+p,label:g,fullLabel:y,altLabel:b,tooltip:F,items:o.buildOptions(r,a,v.subfields,m,{label:g,tooltip:F})}:{key:p,path:f+p,label:g,fullLabel:y,altLabel:b,tooltip:F,grouplabel:u?.label,group:u}}).filter(function(p){return!!p})}},{key:"getFieldLabel",value:function(r,a,i){if(!a)return null;var o=i.settings.maxLabelsLength,l=qp(a,i),u=r?.label||di()(l);return u=Pi(u,o),u}},{key:"render",value:function(){var r=this.props,a=r.config,i=r.customProps,o=r.setValue,l=r.readonly,u=r.id,s=r.groupId,c=a.settings.renderField,d=Ab({isValueField:!0,config:a,customProps:i,setField:o,readonly:l,items:this.items,id:u,groupId:s},this.meta);return c(d,a.ctx)}}])}(T.Component);Zp.propTypes={id:R().string,groupId:R().string,setValue:R().func.isRequired,config:R().object.isRequired,field:R().any,fieldSrc:R().string,fieldType:R().string,value:R().string,operator:R().string,customProps:R().object,readonly:R().bool,parentField:R().string,fieldDefinition:R().object,isFuncArg:R().bool};const jb=function(n){var e=n.value,t=n.setValue,r=n.config,a=n.labelYes,i=n.labelNo,o=n.readonly,l=n.widgetId,u=n.customProps,s=u===void 0?{}:u,c=s.radioYes||{},d=s.radioNo||{},f=function(v){return t(v.target.checked)},p=function(v){return t(v.target.value=="true")};return T.createElement(T.Fragment,null,T.createElement("input",(0,ur.A)({type:"radio",value:!0,checked:!!e,disabled:o,onChange:p},c))," ",a,T.createElement("input",(0,ur.A)({type:"radio",value:!1,checked:!e,disabled:o,onChange:p},d))," ",i)},Rb=function(n){var e=n.value,t=n.setValue,r=n.config,a=n.readonly,i=n.placeholder,o=n.maxLength,l=n.customProps,u=function(d){var f=d.target.value;f===""&&(f=void 0),t(f)},s=e||"";return T.createElement("input",(0,ur.A)({type:"text",value:s,placeholder:i,disabled:a,onChange:u,maxLength:o},l))},Ib=function(n){var e=n.value,t=n.setValue,r=n.config,a=n.readonly,i=n.placeholder,o=n.maxLength,l=n.maxRows,u=n.fullWidth,s=n.customProps,c=function(p){var m=p.target.value;m===""&&(m=void 0),t(m)},d=e||"";return T.createElement("textarea",(0,ur.A)({value:d,placeholder:i,disabled:a,onChange:c,maxLength:o,style:{width:u?"100%":void 0}},s))};var qE=tr.moment;const Pb=function(n){var e=n.value,t=n.setValue,r=n.config,a=n.valueFormat,i=n.readonly,o=n.customProps,l=function(s){var c=s.target.value;c==""&&(c=void 0),t(c)};return T.createElement("input",(0,ur.A)({type:"date",value:e||"",disabled:i,onChange:l},o))},Nb=function(n){var e=n.value,t=n.setValue,r=n.config,a=n.valueFormat,i=n.use12Hours,o=n.readonly,l=n.customProps,u=function(c){var d=c.target.value;d==""&&(d=void 0),t(d)};return T.createElement("input",(0,ur.A)({type:"time",value:e||"",disabled:o,onChange:u},l))};var ev=tr.moment;const Db=function(n){var e=n.value,t=n.setValue,r=n.config,a=n.valueFormat,i=n.use12Hours,o=n.readonly,l=n.customProps,u=function(d){var f=d.target.value;f==""?f=void 0:f=ev(new Date(f)).format(a),t(f)},s=e;return e?s=ev(e).format("YYYY-MM-DDTHH:mm"):s="",T.createElement("input",(0,ur.A)({type:"datetime-local",value:s,disabled:o,onChange:u},l))};var Vb=tr.ListUtils.mapListValues;const kb=function(n){var e=n.listValues,t=n.value,r=n.setValue,a=n.allowCustomValues,i=n.readonly,o=n.customProps,l=function(){return Vb(e,function(d){var f=d.title,p=d.value;return T.createElement("option",{key:p,value:p},f)})},u=function(d){for(var f=[],p=d.options,m=0;m<p.length;m++){var v=p[m];v.selected&&f.push(v.value)}return f.length||(f=void 0),f},s=function(d){return r(u(d.target))};return T.createElement("select",(0,ur.A)({multiple:!0,onChange:s,value:t,disabled:i},fi()(o,["showSearch","input","showCheckboxes"])),l())};var Mb=tr.ListUtils.mapListValues;const _b=function(n){var e=n.listValues,t=n.value,r=n.setValue,a=n.allowCustomValues,i=n.readonly,o=n.customProps,l=function(){return Mb(e,function(d){var f=d.title,p=d.value;return T.createElement("option",{key:p,value:p},f)})},u=function(d){return r(d.target.value)},s=t!=null;return T.createElement("select",(0,ur.A)({onChange:u,value:s?t:"",disabled:i},fi()(o,["showSearch","input"])),!s&&T.createElement("option",{disabled:!0,value:""}),l())},Gb=function(n){var e=n.value,t=n.setValue,r=n.config,a=n.readonly,i=n.min,o=n.max,l=n.step,u=n.placeholder,s=n.customProps,c=function(p){var m=p.target.value;m===""||m===null?m=void 0:m=Number(m),t(m)},d=e??"";return T.createElement("input",(0,ur.A)({type:"number",value:d,placeholder:u,disabled:a,min:i,max:o,step:l,onChange:c},s))},Bb=function(n){var e=n.value,t=n.setValue,r=n.config,a=n.readonly,i=n.min,o=n.max,l=n.step,u=n.placeholder,s=n.customProps,c=s===void 0?{}:s,d=c.input||{},f=c.slider||c,p=function(g){var S=g.target.value;S===""||S===null?S=void 0:S=Number(S),t(S)},m=e??"";return T.createElement("div",{style:{display:"inline-flex"}},T.createElement("input",(0,ur.A)({key:"number",type:"number",value:m,placeholder:u,disabled:a,min:i,max:o,step:l,onChange:p},d)),T.createElement("input",(0,ur.A)({key:"range",type:"range",value:m,disabled:a,min:i,max:o,step:l,onChange:p},f)))},Ub=function(n){var e=n.items,t=n.setField,r=n.selectedKey,a=n.readonly,i=n.errorText,o=function s(c){return c.map(function(d){var f=d.items,p=d.path,m=d.label,v=d.disabled,g=d.matchesType;if(f)return T.createElement("optgroup",{disabled:v,key:p,label:m},s(f));var S=g?{fontWeight:"bold"}:{};return T.createElement("option",{disabled:v,key:p,value:p,style:S},m)})},l=function(c){return t(c.target.value)},u=r!=null;return T.createElement("select",{onChange:l,value:u?r:"",disabled:a,style:{color:i?"red":null}},!u&&T.createElement("option",{disabled:!0,value:""}),o(e))},$b=function(n){var e=n.id,t=n.not,r=n.setNot,a=n.conjunctionOptions,i=n.setConjunction,o=n.disabled,l=n.readonly,u=n.config,s=n.showNot,c=n.notLabel,d=Object.keys(a).length,f=o,p=u.settings.forceShowConj,m=p||d>1&&!f,v=function(){return Object.keys(a).map(function(F){var A=a[F],w=A.id,x=A.name,k=A.label,D=A.checked,I=i.isDummyFn?"__dummy":"";return(l||o)&&!D?null:[T.createElement("input",{key:w+I,type:"radio",id:w+I,name:x+I,checked:D,disabled:l||o,value:F,onChange:S}),T.createElement("label",{key:w+I+"label",htmlFor:w+I},k)]})},g=function(){var F="not";return[T.createElement("input",{key:e+F,type:"checkbox",id:e+F,checked:t,disabled:l,onChange:y}),T.createElement("label",{key:e+F+"label",htmlFor:e+F},c||"NOT")]},S=function(F){return i(F.target.value)},y=function(F){return r(F.target.checked)};return[s&&g(),m&&v()]};var Wb={addRuleGroup:"+",addRuleGroupExt:"+",delGroup:"x",delRuleGroup:"x",delRule:"x"};const Qb=function(n){var e=n.type,t=n.label,r=n.onClick,a=n.readonly,i=t||Wb[e];return T.createElement("button",{onClick:r,type:"button",disabled:a},i)},Kb=function(n){var e=n.type,t={},r=t[e]||null;return!r&&e==="drag"&&(r=T.createElement(wf,null)),r},zb=function(n){var e=n.children,t=n.config;return T.createElement(T.Fragment,null,e)},Hb=function(n){var e=n.config,t=n.valueSources,r=n.valueSrc,a=n.title,i=n.setValueSrc,o=n.readonly,l=function(c){return c.map(function(d){var f=(0,we.A)(d,2),p=f[0],m=f[1];return T.createElement("option",{key:p,value:p},m.label)})},u=function(c){return i(c.target.value)};return T.createElement("select",{onChange:u,value:r||"",disabled:o},l(t))},qb=function(n){var e=n.value,t=n.setValue,r=n.label,a=n.id,i=n.config,o=n.type,l=function(c){return t(c.target.checked)},u=o;return[T.createElement("input",{key:a+u,type:"checkbox",id:a+u,checked:!!e,onChange:l}),T.createElement("label",{key:a+u+"label",htmlFor:a+u},r)]},Jb=function(n){var e=n.onOk,t=n.okText,r=n.cancelText,a=n.title;confirm(a)&&e()};var Yb=function(e){var t=e.config,r=e.children;return r};function Xb(n,e,t){return e=(0,xe.A)(e),(0,Lr.A)(n,rv()?Reflect.construct(e,t||[],(0,xe.A)(n).constructor):e.apply(n,t))}function rv(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(rv=function(){return!!n})()}var wl=function(n){function e(){var t;(0,br.A)(this,e);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return t=Xb(this,e,[].concat(a)),t.handleChange=function(o){t.props.setOption("proximity",parseInt(o))},t}return(0,Tr.A)(e,n),(0,Fr.A)(e,[{key:"render",value:function(){var r=this.props,a=r.defaults,i=r.options,o=r.config,l=r.optionLabel,u=r.optionPlaceholder,s=r.customProps,c=r.minProximity,d=r.maxProximity,f=r.optionTextBefore,p=r.readonly,m=o.settings,v=o.widgets,g=o.ctx,S=a?a.proximity:void 0,y=m.showLabels,b=i.get("proximity",S),F=Sl()(c,d+1).map(function(x){return{title:x,value:x}}),A=v.select.factory,w=function(k){return A(k,g)};return T.createElement("div",{className:"operator--PROXIMITY"},T.createElement("div",{className:"operator--options"},y&&T.createElement("label",{className:"rule--label"},l),!y&&f&&T.createElement("div",{className:"operator--options--sep"},T.createElement("span",null,f)),T.createElement(w,(0,ur.A)({config:o,value:b,listValues:F,setValue:this.handleChange,readonly:p,placeholder:u},s))),T.createElement("div",{className:"operator--widgets"},this.props.children))}}])}(T.PureComponent);wl.propTypes={config:R().object.isRequired,setOption:R().func.isRequired,options:R().any.isRequired,minProximity:R().number,maxProximity:R().number,optionPlaceholder:R().string,optionTextBefore:R().string,optionLabel:R().string,customProps:R().object,readonly:R().bool},wl.defaultProps={customProps:{},minProximity:2,maxProximity:10,optionPlaceholder:"Select words between",optionLabel:"Words between",optionTextBefore:null};function tv(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Ze(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?tv(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):tv(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var Zb=Ze({},Vr.conjunctions),eF=Ze(Ze({},Vr.operators),{},{proximity:Ze(Ze({},Vr.operators.proximity),{},{options:Ze(Ze({},Vr.operators.proximity.options),{},{factory:function(e,t){var r=t.RCE,a=t.O.ProximityOperator;return r(a,e)}})})}),rF={text:Ze(Ze({},Vr.widgets.text),{},{factory:function(e,t){var r=t.RCE,a=t.W.VanillaTextWidget;return r(a,e)}}),textarea:Ze(Ze({},Vr.widgets.textarea),{},{factory:function(e,t){var r=t.RCE,a=t.W.VanillaTextAreaWidget;return r(a,e)}}),number:Ze(Ze({},Vr.widgets.number),{},{factory:function(e,t){var r=t.RCE,a=t.W.VanillaNumberWidget;return r(a,e)}}),slider:Ze(Ze({},Vr.widgets.slider),{},{factory:function(e,t){var r=t.RCE,a=t.W.VanillaSliderWidget;return r(a,e)}}),select:Ze(Ze({},Vr.widgets.select),{},{factory:function(e,t){var r=t.RCE,a=t.W.VanillaSelectWidget;return r(a,e)}}),multiselect:Ze(Ze({},Vr.widgets.multiselect),{},{factory:function(e,t){var r=t.RCE,a=t.W.VanillaMultiSelectWidget;return r(a,e)}}),date:Ze(Ze({},Vr.widgets.date),{},{factory:function(e,t){var r=t.RCE,a=t.W.VanillaDateWidget;return r(a,e)}}),time:Ze(Ze({},Vr.widgets.time),{},{factory:function(e,t){var r=t.RCE,a=t.W.VanillaTimeWidget;return r(a,e)}}),datetime:Ze(Ze({},Vr.widgets.datetime),{},{factory:function(e,t){var r=t.RCE,a=t.W.VanillaDateTimeWidget;return r(a,e)}}),boolean:Ze(Ze({},Vr.widgets.boolean),{},{factory:function(e,t){var r=t.RCE,a=t.W.VanillaBooleanWidget;return r(a,e)}}),field:Ze(Ze({},Vr.widgets.field),{},{factory:function(e,t){var r=t.RCE,a=t.W.ValueFieldWidget;return r(a,e)},customProps:{showSearch:!0}}),func:Ze(Ze({},Vr.widgets.func),{},{factory:function(e,t){var r=t.RCE,a=t.W.FuncWidget;return r(a,e)},customProps:{}}),case_value:Ze(Ze({},Vr.widgets.case_value),{},{factory:function(e,t){var r=t.RCE,a=t.W.VanillaTextWidget;return r(a,e)}})},tF=Ze(Ze({},Vr.types),{},{select:Ze(Ze({},Vr.types.select),{},{widgets:Ze(Ze({},Vr.types.select.widgets),{},{select:Ze(Ze({},Vr.types.select.widgets.select),{},{widgetProps:{customProps:{showSearch:!0}}})})})}),nF=Ze(Ze({},Vr.settings),{},{renderField:function(e,t){var r=t.RCE,a=t.W.VanillaFieldSelect;return r(a,e)},renderOperator:function(e,t){var r=t.RCE,a=t.W.VanillaFieldSelect;return r(a,e)},renderFunc:function(e,t){var r=t.RCE,a=t.W.VanillaFieldSelect;return r(a,e)},renderConjs:function(e,t){var r=t.RCE,a=t.W.VanillaConjs;return r(a,e)},renderSwitch:function(e,t){var r=t.RCE,a=t.W.VanillaSwitch;return r(a,e)},renderButton:function(e,t){var r=t.RCE,a=t.W.VanillaButton;return r(a,e)},renderIcon:function(e,t){var r=t.RCE,a=t.W.VanillaIcon;return r(a,e)},renderButtonGroup:function(e,t){var r=t.RCE,a=t.W.VanillaButtonGroup;return r(a,e)},renderProvider:function(e,t){var r=t.RCE,a=t.W.VanillaProvider;return r(a,e)},renderValueSources:function(e,t){var r=t.RCE,a=t.W.VanillaValueSources;return r(a,e)},renderFieldSources:function(e,t){var r=t.RCE,a=t.W.VanillaValueSources;return r(a,e)},renderConfirm:function(e,t){var r=t.W.vanillaConfirm;return r(e)},renderSwitchPrefix:"IF",renderBeforeCaseValue:function(e,t){var r=t.RCE;return r("span",{children:[" then "]})},customFieldSelectProps:{showSearch:!0},customOperatorSelectProps:{},defaultSliderWidth:"200px",defaultSelectWidth:"200px",defaultSearchWidth:"100px",defaultMaxRows:5,renderSize:"small",maxLabelsLength:100,showLock:!1,showNot:!0,forceShowConj:!1,groupActionsPosition:"topRight"}),aF=Ze(Ze({},Vr.ctx),{},{W:Ze({},nr),O:Ze({},Be),RCE:function(e,t){return T.createElement(e,t)}}),xl={conjunctions:Zb,operators:eF,widgets:rF,types:tF,settings:nF,ctx:aF};xl=tr.ConfigMixins.removeMixins(xl,["rangeslider","treeselect","treemultiselect"]);const Yr=xl;var JE=h(38221);function nv(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Mi(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?nv(Object(t),!0).forEach(function(r){_defineProperty(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):nv(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var qa=tr.Autocomplete,_i=qa.mergeListValues,av=qa.listValueToOption,iF=qa.optionToListValue,oF=qa.optionsToListValues,lF=qa.fixListValuesGroupOrder,Ea=tr.ListUtils,uF=Ea.mapListValues,Gi=Ea.listValuesToArray,Bi=Ea.getListValue,sF=Ea.makeCustomListValue,cF=Ea.searchListValue,YE=Ea.getItemInListValues;function iv(n){return new Promise(function(e){setTimeout(e,n)})}var XE=function(e,t){var r=e.asyncFetch,a=e.useLoadMore,i=e.useAsyncSearch,o=e.forceAsyncSearch,l=e.asyncListValues,u=e.listValues,s=e.allowCustomValues,c=e.value,d=e.setValue,f=e.placeholder,p=e.config,m=t.debounceTimeout,v=t.multiple,g=t.uif,S=t.isFieldAutocomplete,y=["LOAD_MORE","LOADING_MORE"],b="Load more...",F="Loading more...",A=o?"Type to search":f,w=React.useState(!1),x=_slicedToArray(w,2),k=x[0],D=x[1],I=React.useState(void 0),_=_slicedToArray(I,2),G=_[0],M=_[1],H=React.useState(0),K=_slicedToArray(H,2),z=K[0],U=K[1],ee=React.useState(!1),Y=_slicedToArray(ee,2),oe=Y[0],ie=Y[1],se=React.useState(""),ce=_slicedToArray(se,2),ge=ce[0],ye=ce[1],ue=React.useState(void 0),be=_slicedToArray(ue,2),me=be[0],Ce=be[1],Me=React.useRef(0),je=React.useRef(0),Ie=React.useRef(!1),Ve=React.useMemo(function(){return Gi(l)},[l]),Ee=React.useMemo(function(){return r?l?_i(me,Ve,!0):me:Gi(u)},[r,l,me,u]),_e=r?me:Gi(u);s&&ge&&!cF(ge,me)&&(_e=_i(_e,[sF(ge)],!0)),r&&!me&&l&&!ge&&!k&&g==="antd"&&(_e=Ee),r&&!s&&l&&g==="mui"&&(_e=_i(_e,Ve,!0,!0));var He=z>0,or=k&&r&&me===void 0&&(o?ge:!0),We=or&&He,Gr=!We&&Ee&&Ee.length>0&&G&&G.hasMore&&(G.filter||"")===ge,sr=!He&&Gr,xr=uF(_e,av),lr=c!=null,ct=!v&&lr?Bi(c,Ee):null,Lt=function(){var Kr=_asyncToGenerator(_regeneratorRuntime.mark(function Ue(){var qe,ir,gr,Cr,kr,Dr,Nt,Br,Gn,at,an,jn,Ht,on,qt,Jt=arguments;return _regeneratorRuntime.wrap(function(xt){for(;;)switch(xt.prev=xt.next){case 0:return qe=Jt.length>0&&Jt[0]!==void 0?Jt[0]:null,ir=Jt.length>1&&Jt[1]!==void 0?Jt[1]:!1,!ir&&G&&M(void 0),gr=ir&&me?me.length:0,Cr=ir&&G||!a&&{pageSize:0},kr=++Me.current,xt.next=8,r.call(p?.ctx,qe,gr,Cr);case 8:if(Dr=xt.sent,Nt=Me.current!=kr,!(Nt||!je.current)){xt.next=12;break}return xt.abrupt("return",null);case 12:return Br=Dr!=null&&Dr.values?Dr:{values:Dr},Gn=Br.values,at=Br.hasMore,an=Br.meta,jn=Gi(Gn),ir?(on=_i(me,jn,!1),Ht=on.length>me.length):(on=jn,a&&(Ht=on.length>0)),qt=at!=null||an!=null||Ht!=null?Mi(Mi(Mi(Mi({},Ht!=null?{hasMore:Ht}:{}),at!=null?{hasMore:at}:{}),an??{}),{},{filter:qe}):void 0,qt&&M(qt),xt.abrupt("return",on);case 18:case"end":return xt.stop()}},Ue)}));return function(){return Kr.apply(this,arguments)}}(),dt=function(){var Kr=_asyncToGenerator(_regeneratorRuntime.mark(function Ue(){var qe,ir,gr,Cr=arguments;return _regeneratorRuntime.wrap(function(Dr){for(;;)switch(Dr.prev=Dr.next){case 0:return qe=Cr.length>0&&Cr[0]!==void 0?Cr[0]:null,ir=Cr.length>1&&Cr[1]!==void 0?Cr[1]:!1,U(function(Nt){return Nt+1}),ie(ir),Dr.next=6,Lt(qe,ir);case 6:if(gr=Dr.sent,je.current){Dr.next=9;break}return Dr.abrupt("return");case 9:gr!=null&&Ce(gr),U(function(Nt){return Nt-1}),ie(!1);case 12:case"end":return Dr.stop()}},Ue)}));return function(){return Kr.apply(this,arguments)}}(),wt=React.useCallback(debounce(dt,m),[]);React.useEffect(function(){return je.current++,or&&z==0&&Me.current==0&&_asyncToGenerator(_regeneratorRuntime.mark(function Kr(){return _regeneratorRuntime.wrap(function(qe){for(;;)switch(qe.prev=qe.next){case 0:return qe.next=2,dt();case 2:case"end":return qe.stop()}},Kr)}))(),function(){je.current--}},[or]);var cr=function(){D(!0)},Pt=function(){var Kr=_asyncToGenerator(_regeneratorRuntime.mark(function Ue(qe){var ir,gr;return _regeneratorRuntime.wrap(function(kr){for(;;)switch(kr.prev=kr.next){case 0:if(ir=Ie.current,ir?(Ie.current=!1,v&&D(!1)):D(!1),!(g==="mui"&&!ir)){kr.next=6;break}return gr="",kr.next=6,dr(null,gr,"my-reset");case 6:case"end":return kr.stop()}},Ue)}));return function(qe){return Kr.apply(this,arguments)}}(),_t=function(Ue){Ue?cr():Pt()},Xr=function(Ue){var qe=Ue?.specialValue||Ue?.value;return y.includes(qe)},ft=function(){var Kr=_asyncToGenerator(_regeneratorRuntime.mark(function Ue(qe,ir,gr){var Cr,kr,Dr,Nt,Br,Gn,at,an,jn,Ht,on,qt,Jt,Za,xt,Ki,yt;return _regeneratorRuntime.wrap(function(Or){for(;;)switch(Or.prev=Or.next){case 0:if(kr=v&&g==="mui"&&gr==="clear",Dr=!v&&g==="mui"&&gr==="clear"&&qe?.type==="change",Nt=!v&&g==="mui"&&gr==="clear"&&qe?.type!=="change",g==="mui"&&(gr=ir,v?ir=gr.map(function(Gt){var Rn;return(Rn=Gt?.value)!==null&&Rn!==void 0?Rn:Gt}):ir=(Br=(Gn=gr)===null||Gn===void 0?void 0:Gn.value)!==null&&Br!==void 0?Br:gr),at=v&&Array.isArray(gr)&&gr.map(function(Gt){return Gt?.specialValue}).find(function(Gt){return!!Gt})||((Cr=gr)===null||Cr===void 0?void 0:Cr.specialValue),v&&ir&&!Array.isArray(ir)&&(ir=[].concat(_toConsumableArray(c||[]),[ir]),gr=null),an=kr&&ir.length===0&&ge&&k||Dr,!an){Or.next=9;break}return Or.abrupt("return");case 9:if(jn=v&&ir.length&&ir.length>(c||[]).length&&ir[ir.length-1]==ge&&!Bi(ge,me),at!="LOAD_MORE"){Or.next=17;break}return ye(ge),Ie.current=!0,Or.next=15,dt(ge,!0);case 15:Or.next=37;break;case 17:if(at!="LOADING_MORE"){Or.next=21;break}Ie.current=!0,Or.next=37;break;case 21:if(!v){Or.next=31;break}if(Ht=oF(ir,Ee,s),on=_slicedToArray(Ht,2),qt=on[0],Jt=on[1],d(qt,r?Jt:void 0),!jn){Or.next=29;break}return Or.next=27,iv(0);case 27:return Or.next=29,dr(null,"","my-reset");case 29:Or.next=37;break;case 31:if(Za=iF(ir,Ee,s),xt=_slicedToArray(Za,2),Ki=xt[0],yt=xt[1],d(Ki,r?yt:void 0),!(Nt&&S)){Or.next=37;break}return Or.next=36,iv(0);case 36:D(!1);case 37:case"end":return Or.stop()}},Ue)}));return function(qe,ir,gr){return Kr.apply(this,arguments)}}(),dr=function(){var Kr=_asyncToGenerator(_regeneratorRuntime.mark(function Ue(qe,ir,gr){var Cr,kr,Dr;return _regeneratorRuntime.wrap(function(Br){for(;;)switch(Br.prev=Br.next){case 0:if(Cr=g==="mui"&&gr==="reset",kr=ir,!(kr===b||kr===F||Cr)){Br.next=4;break}return Br.abrupt("return");case 4:if(ir==ge){Br.next=13;break}if(ye(kr),Dr=i&&(o?!!kr:!0),!Dr){Br.next=12;break}return Br.next=10,wt(kr);case 10:Br.next=13;break;case 12:i&&o&&Ce([]);case 13:case"end":return Br.stop()}},Ue)}));return function(qe,ir,gr){return Kr.apply(this,arguments)}}(),nt=function(Ue){var qe=_toConsumableArray(Ue);return a&&(sr?qe.push({specialValue:"LOAD_MORE",title:b}):oe&&qe.push({specialValue:"LOADING_MORE",title:F,disabled:!0})),qe},et=function(Ue,qe){if(qe==null)return null;var ir=qe.value!=null?qe.value:qe;return Ue.value===ir},Qr=function(Ue){return Ue&&Ue.disabled},mt=function(Ue){var qe;if(Ue!=null&&Ue.isCustom)return!0;var ir=(qe=Ue?.value)!==null&&qe!==void 0?qe:Ue,gr=Bi(ir,Ee);return gr?.isCustom||!1},_n=function(Ue){if(Ue==null)return null;var qe=Ue.value!=null?Ue:av(Bi(Ue,Ee));return!qe&&Ue.specialValue?Ue.title:!qe&&s||!qe?Ue.toString():qe.title||qe.label||qe.value.toString()},ht=g==="mui"?lF(xr):xr;return{options:ht,listValues:Ee,hasValue:lr,selectedListValue:ct,open:k,onOpen:cr,onClose:Pt,onDropdownVisibleChange:_t,onChange:ft,inputValue:ge,onInputChange:dr,canShowLoadMore:sr,isInitialLoading:We,isLoading:He,isLoadingMore:oe,isSpecialValue:Xr,extendOptions:nt,getOptionSelected:et,getOptionDisabled:Qr,getOptionIsCustom:mt,getOptionLabel:_n,aPlaceholder:A}};const ZE=null;function ov(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function lv(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ov(Object(t),!0).forEach(function(r){(0,ne.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ov(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}const na=lv(lv({},tr),{},{ReactUtils:er,DragIcon:wf});var uv=h(47232),dF=h(63383);const jl={add:"Add",remove:"Remove"},sv={id:na.uuid(),type:"group"},cv="timeFilter",dv=[cv],fF={...Yr.widgets,text:{...Yr.widgets.text,factory:function(e){return(0,O.jsx)(fr.p,{value:e?.value||"",placeholder:e?.placeholder,onChange:t=>e?.setValue(t.currentTarget.value)})}},number:{...Yr.widgets.number,factory:function(e){return(0,O.jsx)(fr.p,{value:e?.value,placeholder:e?.placeholder,type:"number",onChange:t=>e?.setValue(Number.parseInt(t.currentTarget.value,10))})}},datetime:{...Yr.widgets.datetime,factory:function(e){if(e?.operator==="macros")return(0,O.jsx)(rr.l6,{id:e.id,"aria-label":"Macros value selector",menuShouldPortal:!0,options:dv.map(Ut.z),value:e?.value,onChange:r=>e.setValue(r.value)});const t=(0,uv.KQ)(e?.value).isValid()?(0,uv.KQ)(e?.value).utc():void 0;return(0,O.jsx)(dF.K,{onChange:r=>{e?.setValue(r?.format(Yr.widgets.datetime.valueFormat))},date:t})},sqlFormatValue:(n,e,t,r,a,i)=>r==="macros"?dv.includes(n)?n:void 0:typeof Yr.widgets.datetime.sqlFormatValue=="string"||typeof Yr.widgets.datetime.sqlFormatValue=="object"?void 0:Yr.widgets.datetime.sqlFormatValue?.call(Yr.ctx,n,e,t,r,a,i)||""}},pF={...Yr.settings,canRegroup:!1,maxNesting:1,canReorder:!1,showNot:!1,addRuleLabel:jl.add,deleteLabel:jl.remove,renderConjs:function(e){return(0,O.jsx)(rr.l6,{id:e?.id,"aria-label":"Conjunction","data-testid":Zt.Tp.components.SQLQueryEditor.filterConjunction,menuShouldPortal:!0,options:e?.conjunctionOptions?Object.keys(e?.conjunctionOptions).map(Ut.z):void 0,value:e?.selectedConjunction,onChange:t=>e?.setConjunction(t.value)})},renderField:function(e){const t=e?.config?.fields||{};return(0,O.jsx)(rr.l6,{id:e?.id,width:25,"aria-label":"Field","data-testid":Zt.Tp.components.SQLQueryEditor.filterField,menuShouldPortal:!0,options:e?.items.map(r=>{const a=t[r.key].mainWidgetProps?.customProps?.icon;return{label:r.label,value:r.key,icon:a}}),value:e?.selectedKey,onChange:r=>{e?.setField(r.label)}})},renderButton:function(e){return(0,O.jsx)(Ot.$n,{type:"button",title:`${e?.label} filter`,onClick:e?.onClick,variant:"secondary",size:"md",icon:e?.label===jl.add?"plus":"times"})},renderOperator:function(e){return(0,O.jsx)(rr.l6,{options:e?.items.map(t=>({label:t.label,value:t.key})),"aria-label":"Operator","data-testid":Zt.Tp.components.SQLQueryEditor.filterOperator,menuShouldPortal:!0,value:e?.selectedKey,onChange:t=>{e?.setField(t.value||"")}})}};var vF=(n=>(n.IN="select_any_in",n.NOT_IN="select_not_any_in",n.MACROS="macros",n))(vF||{});const gF=OF(Yr),fv=Yr.types.text.widgets.text,mF=[...fv.operators||[],"select_any_in","select_not_any_in"],hF={...fv,operators:mF},yF={...Yr.types,text:{...Yr.types.text,widgets:{...Yr.types.text.widgets,text:hF}},datetime:{...Yr.types.datetime,widgets:{...Yr.types.datetime.widgets,datetime:{...Yr.types.datetime.widgets.datetime,operators:["macros",...Yr.types.datetime.widgets.datetime.operators||[]]}}}},SF={...Yr,widgets:fF,settings:pF,operators:gF,types:yF},pv=()=>"",vv=n=>typeof n=="function";function OF(n){const{...e}=n.operators,t=()=>{const l=e.select_any_in.sqlFormatOp;return vv(l)?l:pv},r=(l,u,s,c,d,f,p,m)=>t()(l,u,gv(s),c,d,f,p,m),a=()=>{const l=e.select_not_any_in.sqlFormatOp;return vv(l)?l:pv},i=(l,u,s,c,d,f,p,m)=>a()(l,u,gv(s),c,d,f,p,m);return{...e,select_any_in:{...e.select_any_in,sqlFormatOp:r},select_not_any_in:{...e.select_not_any_in,sqlFormatOp:i},macros:{label:"Macros",sqlFormatOp:(l,u,s)=>s===cv?`$__timeFilter(${l})`:s}}}function gv(n){return(0,de.isString)(n)?n.split(","):n}function bF({sql:n,config:e,onSqlChange:t}){const[r,a]=(0,T.useState)(),i=(0,T.useMemo)(()=>({...SF,...e}),[e]);(0,T.useEffect)(()=>{if(!r){const l=na.checkTree(na.loadTree(n.whereJsonTree??sv),i);a(l)}},[i,n.whereJsonTree,r]),(0,T.useEffect)(()=>{n.whereJsonTree||a(na.checkTree(na.loadTree(sv),i))},[i,n.whereJsonTree]);const o=(0,T.useCallback)((l,u)=>{a(l);const s={...n,whereJsonTree:na.getTree(l),whereString:na.sqlFormat(l,u)};t(s)},[t,n]);return r?(0,O.jsx)(Sf,{...i,value:r,onChange:o,renderBuilder:l=>(0,O.jsx)(Cb,{...l})}):null}function Ui(n){return`
    display: flex;
    gap: 8px;
    flex-direction: ${n};`}(0,pe.injectGlobal)`
  .group--header {
    ${Ui("row")}
  }

  .group-or-rule {
    ${Ui("column")}
    .rule {
      flex-direction: row;
    }
  }

  .rule--body {
    ${Ui("row")}
  }

  .group--children {
    ${Ui("column")}
  }

  .group--conjunctions:empty {
    display: none;
  }
`;function FF({query:n,fields:e,onQueryChange:t,db:r}){const a=(0,Ag.A)(async()=>TF(e),[e]),{onSqlChange:i}=ii({query:n,onQueryChange:t,db:r});return(0,O.jsx)(bF,{config:{fields:a.value||{}},sql:n.sql,onSqlChange:o=>{const l=(0,sn.w)().getVariables();EF(o,l),i(o)}},JSON.stringify(a.value))}function TF(n){const e={};for(const t of n)e[t.value]={type:t.raqbFieldType||"text",valueSources:["value"],mainWidgetProps:{customProps:{icon:t.icon}}};return e}function EF(n,e){const t=r=>"multi"in r&&r.multi&&(n.whereString?.includes(`\${${r.name}}`)||n.whereString?.includes(`$${r.name}`));e.some(r=>t(r))&&(n.whereString=n.whereString?.replaceAll("')",")"),n.whereString=n.whereString?.replaceAll("('","("))}const CF=({query:n,db:e,queryRowFilter:t,onChange:r,onValidate:a,range:i})=>{const o=(0,B.A)(async()=>await e.fields(n),[e,n.dataset,n.table]);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(cg.D,{children:[(0,O.jsx)(ia.U,{children:(0,O.jsx)(Cg,{fields:o.value||[],query:n,onQueryChange:r,db:e})}),t.filter&&(0,O.jsx)(ia.U,{children:(0,O.jsx)(fn.c,{label:"Filter by column value",optional:!0,children:(0,O.jsx)(FF,{fields:o.value||[],query:n,onQueryChange:r,db:e})})}),t.group&&(0,O.jsx)(ia.U,{children:(0,O.jsx)(fn.c,{label:"Group by column",children:(0,O.jsx)(gg,{fields:o.value||[],query:n,onQueryChange:r,db:e})})}),t.order&&(0,O.jsx)(ia.U,{children:(0,O.jsx)(yg,{fields:o.value||[],query:n,onQueryChange:r,db:e})}),t.preview&&n.rawSql&&(0,O.jsx)(ia.U,{children:(0,O.jsx)(dg.l,{rawSql:n.rawSql,datasourceType:n.datasource?.type})})]}),(0,O.jsx)(zl,{db:e,query:n,onValidate:a,range:i})]})};function mv({datasource:n,query:e,onChange:t,onRunQuery:r,range:a,queryHeaderProps:i}){const[o,l]=(0,T.useState)(!0),u=n.getDB(),{preconfiguredDatabase:s}=n,c=i?.dialect??"other",{loading:d,error:f}=(0,B.A)(async()=>()=>{n.getDB(n.id).init!==void 0&&n.getDB(n.id).init()},[n]),p=oo(e),[m,v]=(0,T.useState)({filter:!!p.sql?.whereString,group:!!p.sql?.groupBy?.[0]?.property.name,order:!!p.sql?.orderBy?.property.name,preview:!0}),[g,S]=(0,T.useState)(p);(0,T.useEffect)(()=>()=>{n.getDB(n.id).dispose!==void 0&&n.getDB(n.id).dispose()},[n]);const y=(0,T.useCallback)(A=>{AF(A)&&r&&r()},[r]),b=(A,w=!0)=>{S(A),t(A),st(A.sql?.columns)&&A.sql?.columns.some(x=>x.name)&&!m.group&&v({...m,group:!0}),w&&y(A)},F=A=>{S(A),t(A)};return d||f?null:(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(Zv,{db:u,preconfiguredDataset:s,onChange:F,onRunQuery:r,onQueryRowChange:v,queryRowFilter:m,query:p,isQueryRunnable:o,dialect:c}),(0,O.jsx)(Z.$,{v:.5}),p.editorMode!==ar.lX.Code&&(0,O.jsx)(CF,{db:u,query:p,onChange:A=>b(A,!1),queryRowFilter:m,onValidate:l,range:a}),p.editorMode===ar.lX.Code&&(0,O.jsx)(ug,{db:u,query:p,queryToValidate:g,onChange:b,onRunQuery:r,onValidate:l,range:a})]})}const AF=n=>!!n.rawSql;function LF(n){const e=typeof n.rawQuery=="string"?n.rawQuery:null;if(!e)return n;const t=oo({refId:"Annotation",...n.target??{},rawSql:e});return{...n,rawQuery:void 0,workspace:void 0,subscription:void 0,queryType:void 0,target:t}}class wF extends Qn.iy{constructor(e,t=(0,sn.w)()){super(e),this.templateSrv=t,this.interpolateVariable=(a,i)=>typeof a=="string"?i.multi||i.includeAll?this.getQueryModel().quoteLiteral(a):String(a).replace(/'/g,"''"):typeof a=="number"?a:Array.isArray(a)?a.map(l=>this.getQueryModel().quoteLiteral(l)).join(","):a,this.name=e.name,this.responseParser=new It,this.id=e.id;const r=e.jsonData||{};this.interval=r.timeInterval||"1m",this.db=this.getDB(),this.preconfiguredDatabase=r.database??"",this.annotations={prepareAnnotation:LF,QueryEditor:mv}}getResponseParser(){return this.responseParser}interpolateVariablesInQueries(e,t){let r=e;return e&&e.length>0&&(r=e.map(a=>({...a,datasource:this.getRef(),rawSql:this.templateSrv.replace(a.rawSql,t,this.interpolateVariable),rawQuery:!0}))),r}filterQuery(e){return!e.hide}applyTemplateVariables(e,t){return{refId:e.refId,datasource:this.getRef(),rawSql:this.templateSrv.replace(e.rawSql,t,this.interpolateVariable),format:e.format}}query(e){if(ai()){const t=this.checkForDatabaseIssue(e);if(t){const r=new Error(t);return(0,cn.$)(()=>r)}}return e.targets.forEach(t=>{e.app===dn.Jk.Dashboard||e.app===dn.Jk.PanelViewer||(0,bt.rR)("grafana_sql_query_executed",{datasource:t.datasource?.type,editorMode:t.editorMode,format:t.format,app:e.app})}),super.query(e)}checkForDatabaseIssue(e){if(this.type==="postgres"&&!this.preconfiguredDatabase)return`You do not currently have a default database configured for this data source. Postgres requires a default
             database with which to connect. Please configure one through the Data Sources Configuration page, or if you
             are using a provisioning file, update that configuration file with a default database.`;if(e.app!==dn.Jk.Explore&&this.preconfiguredDatabase){for(const t of e.targets)if(t.editorMode===ar.lX.Builder&&t.dataset!==this.preconfiguredDatabase)return`The configuration for this panel's data source has been modified. The previous database used in this panel's
                   saved query is no longer available. Please update the query to use the new database option.
                   Previous query parameters will be preserved until the query is updated.`}}async metricFindQuery(e,t){const r=t?.range;if(r==null)return[];let a="tempvar";t&&t.variable&&t.variable.name&&(a=t.variable.name);const i={...t?.scopedVars,...(0,Ar.c)({query:e,wildcardChar:"%",options:t})},o=this.templateSrv.replace(e,i,this.interpolateVariable),l={refId:a,datasource:this.getRef(),rawSql:o,format:En.Table};let u;try{u=await this.runMetaQuery(l,r)}catch(s){throw console.error(s),new Error("error when executing the sql query")}return this.getResponseParser().transformMetricFindResponse(u)}async runSql(e,t){const r=(0,jr.E2)(),a=await this.runMetaQuery({rawSql:e,format:En.Table,refId:t?.refId},r);return new ut.R(a)}runMetaQuery(e,t){const r=e.refId||"meta",a=[{...e,datasource:e.datasource||this.getRef(),refId:r}];return(0,$t.s)((0,Kn.AI)().fetch({url:"/api/ds/query",method:"POST",headers:this.getRequestHeaders(),data:{from:t.from.valueOf().toString(),to:t.to.valueOf().toString(),queries:a},requestId:r}).pipe((0,Wn.T)(i=>(0,Ye.bE)(i,a).data[0]??{fields:[]})))}targetContainsTemplate(e){let t=e.rawSql;return Og.forEach(r=>{t=t?.replace(r,"")||""}),this.templateSrv.containsTemplate(t)}}var xF=h(94471);function eC({value:n,defaultValue:e,onChange:t,width:r}){const[a,i]=useState(!1);return jsx(Input,{type:"number",placeholder:String(e),value:a?"":n,onChange:o=>{if(o.currentTarget.value?.trim()==="")i(!0),t(e);else{i(!1);const l=Number(o.currentTarget.value);Number.isNaN(l)||t(l)}},width:r})}const rC=n=>{const{onOptionsChange:e,options:t}=n,r=t.jsonData,a=r.maxIdleConnsAuto!==void 0?r.maxIdleConnsAuto:!1,i=c=>{const d={...t,jsonData:{...r,...c}};return e(d)},o=c=>d=>{i({[c]:d})},l=c=>{i(a&&c?{maxOpenConns:c,maxIdleConns:c}:{maxOpenConns:c})},u=()=>{let c,d;a?(d=r.maxOpenConns,c=r.maxIdleConns):r.maxOpenConns!==void 0&&(d=r.maxOpenConns,c=r.maxOpenConns),i({maxIdleConnsAuto:!a,maxIdleConns:c,maxOpenConns:d})},s=40;return jsxs(ConfigSubSection,{title:"Connection limits",children:[jsx(Field,{label:jsx(Label,{children:jsxs(Stack,{gap:.5,children:[jsx("span",{children:"Max open"}),jsx(Tooltip,{content:jsxs("span",{children:["The maximum number of open connections to the database. If ",jsx("i",{children:"Max idle connections"})," is greater than 0 and the ",jsx("i",{children:"Max open connections"})," is less than ",jsx("i",{children:"Max idle connections"}),", then",jsx("i",{children:"Max idle connections"})," will be reduced to match the ",jsx("i",{children:"Max open connections"})," limit. If set to 0, there is no limit on the number of open connections."]}),children:jsx(Icon,{name:"info-circle",size:"sm"})})]})}),children:jsx(NumberInput,{value:r.maxOpenConns,defaultValue:config.sqlConnectionLimits.maxOpenConns,onChange:c=>{l(c)},width:s})}),jsx(Field,{label:jsx(Label,{children:jsxs(Stack,{gap:.5,children:[jsx("span",{children:"Auto max idle"}),jsx(Tooltip,{content:jsxs("span",{children:["If enabled, automatically set the number of ",jsx("i",{children:"Maximum idle connections"})," to the same value as",jsx("i",{children:" Max open connections"}),". If the number of maximum open connections is not set it will be set to the default (",config.sqlConnectionLimits.maxIdleConns,")."]}),children:jsx(Icon,{name:"info-circle",size:"sm"})})]})}),children:jsx(Switch,{value:a,onChange:u})}),jsx(Field,{label:jsx(Label,{children:jsxs(Stack,{gap:.5,children:[jsx("span",{children:"Max idle"}),jsx(Tooltip,{content:jsxs("span",{children:["The maximum number of connections in the idle connection pool.If ",jsx("i",{children:"Max open connections"})," is greater than 0 but less than the ",jsx("i",{children:"Max idle connections"}),", then the ",jsx("i",{children:"Max idle connections"})," ","will be reduced to match the ",jsx("i",{children:"Max open connections"})," limit. If set to 0, no idle connections are retained."]}),children:jsx(Icon,{name:"info-circle",size:"sm"})})]})}),children:a?jsx(InlineLabel,{width:s,children:t.jsonData.maxIdleConns}):jsx(NumberInput,{value:r.maxIdleConns,defaultValue:config.sqlConnectionLimits.maxIdleConns,onChange:c=>{o("maxIdleConns")(c)},width:s})}),jsx(Field,{label:jsx(Label,{children:jsxs(Stack,{gap:.5,children:[jsx("span",{children:"Max lifetime"}),jsx(Tooltip,{content:jsx("span",{children:"The maximum amount of time in seconds a connection may be reused. If set to 0, connections are reused forever."}),children:jsx(Icon,{name:"info-circle",size:"sm"})})]})}),children:jsx(NumberInput,{value:r.connMaxLifetime,defaultValue:config.sqlConnectionLimits.connMaxLifetime,onChange:c=>{o("connMaxLifetime")(c)},width:s})})]})},tC=()=>{const n=useStyles2(jF);return jsx("hr",{className:n.horizontalDivider})},jF=n=>({horizontalDivider:css({borderTop:`1px solid ${n.colors.border.weak}`,margin:n.spacing(2,0),width:"100%"})}),nC=n=>{const{editorProps:e,showCACert:t,showKeyPair:r=!0}=n,{secureJsonFields:a}=e.options;return jsxs(Fragment,{children:[r?jsx(Field,{label:jsx(Label,{children:jsxs(Stack,{gap:.5,children:[jsx("span",{children:"TLS/SSL Client Certificate"}),jsx(Tooltip,{content:jsx("span",{children:"To authenticate with an TLS/SSL client certificate, provide the client certificate here."}),children:jsx(Icon,{name:"info-circle",size:"sm"})})]})}),children:jsx(SecretTextArea,{placeholder:"-----BEGIN CERTIFICATE-----",cols:45,rows:7,isConfigured:a&&a.tlsClientCert,onChange:onUpdateDatasourceSecureJsonDataOption(e,"tlsClientCert"),onReset:()=>{updateDatasourcePluginResetOption(e,"tlsClientCert")}})}):null,t?jsx(Field,{label:jsx(Label,{children:jsxs(Stack,{gap:.5,children:[jsx("span",{children:"TLS/SSL Root Certificate"}),jsx(Tooltip,{content:jsx("span",{children:"If the selected TLS/SSL mode requires a server root certificate, provide it here."}),children:jsx(Icon,{name:"info-circle",size:"sm"})})]})}),children:jsx(SecretTextArea,{placeholder:"-----BEGIN CERTIFICATE-----",cols:45,rows:7,isConfigured:a&&a.tlsCACert,onChange:onUpdateDatasourceSecureJsonDataOption(e,"tlsCACert"),onReset:()=>{updateDatasourcePluginResetOption(e,"tlsCACert")}})}):null,r?jsx(Field,{label:jsx(Label,{children:jsxs(Stack,{gap:.5,children:[jsx("span",{children:"TLS/SSL Client Key"}),jsx(Tooltip,{content:jsx("span",{children:"To authenticate with a client TLS/SSL certificate, provide the key here."}),children:jsx(Icon,{name:"info-circle",size:"sm"})})]})}),children:jsx(SecretTextArea,{placeholder:"-----BEGIN RSA PRIVATE KEY-----",cols:45,rows:7,isConfigured:a&&a.tlsClientKey,onChange:onUpdateDatasourceSecureJsonDataOption(e,"tlsClientKey"),onReset:()=>{updateDatasourcePluginResetOption(e,"tlsClientKey")}})}):null]})};var RF=h(34867);const aC=(0,RF.DW)("features.plugins.sql");function iC({onOptionsChange:n,options:e}){useEffect(()=>{const t=e.jsonData;let r={...e},a=!1;if(e.database&&(sqlPluginLogger.logDebug(`Migrating from options.database with value ${e.database} for ${e.name}`),r.database="",r.jsonData={...t,database:e.database},a=!0),t.maxOpenConns===void 0&&t.maxIdleConns===void 0&&t.maxIdleConnsAuto===void 0){const{maxOpenConns:i,maxIdleConns:o}=config.sqlConnectionLimits;sqlPluginLogger.logDebug(`Setting default max open connections to ${i} and setting max idle connection to ${o}`),r.jsonData={...r.jsonData,maxOpenConns:i,maxIdleConns:o,maxIdleConnsAuto:!0},a=!0}if(t.connMaxLifetime===void 0){const{connMaxLifetime:i}=config.sqlConnectionLimits;r.jsonData={...r.jsonData,connMaxLifetime:i},a=!0}a&&n(r)},[n,e])}function IF(n){const e=[];for(const t of n){let r="text";switch(t.type?.toUpperCase()){case"BOOLEAN":case"BOOL":{r="boolean";break}case"BYTES":case"VARCHAR":{r="text";break}case"FLOAT":case"FLOAT64":case"INT":case"INTEGER":case"INT64":case"NUMERIC":case"BIGNUMERIC":{r="number";break}case"DATE":{r="date";break}case"TIMESTAMP(NANOSECOND, NONE)":case"DATETIME":{r="datetime";break}case"TIME":{r="time";break}case"TIMESTAMP":{r="datetime";break}case"GEOGRAPHY":{r="text";break}default:break}e.push({...t,raqbFieldType:r,icon:PF(t.type.toUpperCase())})}return e}function PF(n){switch(n){case"TIME":case"DATETIME":case"TIMESTAMP":return"clock-nine";case"BOOLEAN":return"toggle-off";case"INTEGER":case"FLOAT":case"FLOAT64":case"INT":case"SMALLINT":case"BIGINT":case"TINYINT":case"BYTEINT":case"INT64":case"NUMERIC":case"DECIMAL":return"calculator-alt";case"CHAR":case"VARCHAR":case"STRING":case"BYTES":case"TEXT":case"TINYTEXT":case"MEDIUMTEXT":case"LONGTEXT":return"text";case"GEOGRAPHY":return"map";default:return}}function NF(n){return n[0]==='"'&&n[n.length-1]==='"'?n.substring(1,n.length-1).replace(/""/g,'"'):n[0]==="`"&&n[n.length-1]==="`"?n.substring(1,n.length-1):n}function hv(n){return"'"+n.replace(/'/g,"''")+"'"}function yv({sql:n,table:e}){let t="";if(!n||!st(n.columns))return t;const r=n.columns.map(a=>({...a,parameters:a.parameters?.map(i=>({...i,name:DF(i.name)}))}));if(t+=Ft(r),e&&(t+=`FROM "${e}" `),t+='WHERE "time" >= $__timeFrom AND "time" <= $__timeTo ',n.whereString){const a=new RegExp("(\\s?)([^\\(]\\S+)(\\s?=)","g"),o=n.whereString.replace(a,'$1"$2"$3');t+=`AND ${o} `}if(n.groupBy?.[0]?.property.name){const a=n.groupBy.map(i=>`"${i.property.name}"`).filter(i=>!(0,de.isEmpty)(i));t+=`GROUP BY ${a.join(", ")} `}return n.orderBy?.property.name&&(t+=`ORDER BY "${n.orderBy.property.name}" `),n.orderBy?.property.name&&n.orderByDirection&&(t+=`${n.orderByDirection} `),VF(n.limit)&&(t+=`LIMIT ${n.limit}`),t}function DF(n){return n==="*"?n:`"${n}"`}const VF=n=>n!==void 0&&n>=0;function Rl(n){return kF(n)?n:`"${n}"`}function kF(n){const e=/^[a-zA-Z_][a-zA-Z0-9_$]*$/g.test(n);return!MF.includes(n.toUpperCase())&&e}const MF=["ACCESSIBLE","ADD","ALL","ALTER","ANALYZE","AND","AS","ASC","ASENSITIVE","BEFORE","BETWEEN","BIGINT","BINARY","BLOB","BOTH","BY","CALL","CASCADE","CASE","CHANGE","CHAR","CHARACTER","CHECK","COLLATE","COLUMN","CONDITION","CONSTRAINT","CONTINUE","CONVERT","CREATE","CROSS","CUBE","CUME_DIST","CURRENT_DATE","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_USER","CURSOR","DATABASE","DATABASES","DAY_HOUR","DAY_MICROSECOND","DAY_MINUTE","DAY_SECOND","DEC","DECIMAL","DECLARE","DEFAULT","DELAYED","DELETE","DENSE_RANK","DESC","DESCRIBE","DETERMINISTIC","DISTINCT","DISTINCTROW","DIV","DOUBLE","DROP","DUAL","EACH","ELSE","ELSEIF","EMPTY","ENCLOSED","ESCAPED","EXCEPT","EXISTS","EXIT","EXPLAIN","FALSE","FETCH","FIRST_VALUE","FLOAT","FLOAT4","FLOAT8","FOR","FORCE","FOREIGN","FROM","FULLTEXT","FUNCTION","GENERATED","GET","GRANT","GROUP","GROUPING","GROUPS","HAVING","HIGH_PRIORITY","HOUR_MICROSECOND","HOUR_MINUTE","HOUR_SECOND","IF","IGNORE","IN","INDEX","INFILE","INNER","INOUT","INSENSITIVE","INSERT","INT","INT1","INT2","INT3","INT4","INT8","INTEGER","INTERSECT","INTERVAL","INTO","IO_AFTER_GTIDS","IO_BEFORE_GTIDS","IS","ITERATE","JOIN","JSON_TABLE","KEY","KEYS","KILL","LAG","LAST_VALUE","LATERAL","LEAD","LEADING","LEAVE","LEFT","LIKE","LIMIT","LINEAR","LINES","LOAD","LOCALTIME","LOCALTIMESTAMP","LOCK","LONG","LONGBLOB","LONGTEXT","LOOP","LOW_PRIORITY","MASTER_BIND","MASTER_SSL_VERIFY_SERVER_CERT","MATCH","MAXVALUE","MEDIUMBLOB","MEDIUMINT","MEDIUMTEXT","MIDDLEINT","MINUTE_MICROSECOND","MINUTE_SECOND","MOD","MODIFIES","NATURAL","NOT","NO_WRITE_TO_BINLOG","NTH_VALUE","NTILE","NULL","NUMERIC","OF","ON","OPTIMIZE","OPTIMIZER_COSTS","OPTION","OPTIONALLY","OR","ORDER","OUT","OUTER","OUTFILE","OVER","PARTITION","PERCENT_RANK","PRECISION","PRIMARY","PROCEDURE","PURGE","RANGE","RANK","READ","READS","READ_WRITE","REAL","RECURSIVE","REFERENCES","REGEXP","RELEASE","RENAME","REPEAT","REPLACE","REQUIRE","RESIGNAL","RESTRICT","RETURN","REVOKE","RIGHT","RLIKE","ROW","ROWS","ROW_NUMBER","SCHEMA","SCHEMAS","SECOND_MICROSECOND","SELECT","SENSITIVE","SEPARATOR","SET","SHOW","SIGNAL","SMALLINT","SPATIAL","SPECIFIC","SQL","SQLEXCEPTION","SQLSTATE","SQLWARNING","SQL_BIG_RESULT","SQL_CALC_FOUND_ROWS","SQL_SMALL_RESULT","SSL","STARTING","STORED","STRAIGHT_JOIN","SYSTEM","TABLE","TERMINATED","THEN","TINYBLOB","TINYINT","TINYTEXT","TO","TRAILING","TRIGGER","TRUE","UNDO","UNION","UNIQUE","UNLOCK","UNSIGNED","UPDATE","USAGE","USE","USING","UTC_DATE","UTC_TIME","UTC_TIMESTAMP","VALUES","VARBINARY","VARCHAR","VARCHARACTER","VARYING","VIRTUAL","WHEN","WHERE","WHILE","WINDOW","WITH","WRITE","XOR","YEAR_MONTH","ZEROFILL"];function _F(n){return`SELECT table_name FROM information_schema.tables WHERE table_schema = ${n!==void 0?Ja(n):"database()"} ORDER BY table_name`}function oC(){return"SELECT DISTINCT TABLE_SCHEMA from information_schema.TABLES where TABLE_TYPE != 'SYSTEM VIEW' ORDER BY TABLE_SCHEMA"}function GF(n,e){let t="SELECT column_name, data_type FROM information_schema.columns WHERE ";return t+=BF(n,e),t+=" ORDER BY column_name",t}function BF(n,e){let t="";if(n.includes(".")){const r=n.split(".");return t="table_schema = "+Ja(r[0]),t+=" AND table_name = "+Ja(r[1]),t}else return t=`table_schema = ${e!==void 0?Ja(e):"database()"} AND table_name = `+Ja(n),t}function Ja(n){return hv(NF(n))}var UF=h(33125);const $F=({getMeta:n})=>(e,t)=>({...t&&(0,UF.N)(e,t),customStatementPlacement:QF,customSuggestionKinds:KF(n)}),Sv={afterDatabase:"afterDatabase"},WF={tablesWithinDatabase:"tablesWithinDatabase"},Il="FROM",QF=()=>[{id:Sv.afterDatabase,resolve:(n,e,t)=>!!(n?.is(ar.ks.Delimiter,".")&&e?.value===Il&&(t?.is(ar.ks.IdentifierQuote)||t?.isIdentifier())&&n?.getPreviousUntil(ar.ks.Keyword,[ar.ks.IdentifierQuote],Il)?.filter(r=>r.isIdentifier()).length===1)}],KF=n=>()=>[{id:ar.ng.Tables,overrideDefault:!0,suggestionsResolver:async e=>{const t=Nl(e.currentToken);return(await n({schema:t})).map(Pl(e))}},{id:ar.ng.Columns,overrideDefault:!0,suggestionsResolver:async e=>{const t=qF(e.currentToken),r=Nl(t),a=zF(t);return!r||!a?[]:(await n({schema:r,table:a})).map(Pl(e))}},{id:WF.tablesWithinDatabase,applyTo:[Sv.afterDatabase],suggestionsResolver:async e=>{const t=Nl(e.currentToken);return(await n({schema:t})).map(Pl(e))}}];function Pl(n){return function(e){return{label:e.name,insertText:e.completion??e.name,command:{id:"editor.action.triggerSuggest",title:""},kind:ar.Io.Field,sortText:ar.mY.High,range:{...n.range,startColumn:n.range.endColumn,endColumn:n.range.endColumn}}}}function Nl(n){if(n?.isIdentifier()&&n.value[n.value.length-1]!==".")return n.value;if(n?.is(ar.ks.Delimiter,"."))return n.getPreviousOfType(ar.ks.Identifier)?.value;if(n?.is(ar.ks.IdentifierQuote))return n.getPreviousOfType(ar.ks.Identifier)?.value||n.getNextOfType(ar.ks.Identifier)?.value}function zF(n){return n?.getNextOfType(ar.ks.Identifier)?.value}const HF=n=>(n?.getPreviousOfType(ar.ks.Keyword,"SELECT")??null)?.getNextOfType(ar.ks.Keyword,Il),qF=n=>{const t=HF(n)?.getNextOfType(ar.ks.Identifier);return t?.isKeyword()&&t.next?.is(ar.ks.Parenthesis,"(")?null:t};class JF extends wF{constructor(e,t=(0,sn.w)()){super(e),this.instanceSettings=e,this.templateSrv=t}getQueryModel(){return{quoteLiteral:hv}}getSqlLanguageDefinition(){if(this.sqlLanguageDefinition!==void 0)return this.sqlLanguageDefinition;const e={getMeta:t=>this.fetchMeta(t)};return this.sqlLanguageDefinition={id:"flightsql",completionProvider:$F(e),formatter:xF.s},this.sqlLanguageDefinition}async fetchDatasets(){return Promise.resolve(["iox"])}async fetchTables(e){const t=_F(e),a=(await this.runSql(t,{refId:"tables"})).map(i=>Rl(i[0]));return a.unshift(...this.getTemplateVariables()),a}async fetchFields(e){if(!e.dataset||!e.table)return[];const t=this.templateSrv.replace(e.table),r=GF(t,e.dataset),i=(await this.runSql(r,{refId:"fields"})).map(o=>({name:o[0],text:o[0],value:Rl(o[0]),type:o[1],label:o[0]}));return i.unshift(...this.getTemplateVariables().map(o=>({name:o,text:o,value:Rl(o),type:"",label:o}))),IF(i)}getTemplateVariables(){return this.templateSrv.getVariables().map(e=>`$${e.name}`)}async fetchMeta(e){const t=this.instanceSettings.jsonData.database;return!e?.schema&&t?(await this.fetchTables(t)).map(a=>({name:a,completion:`${t}.${a}`,kind:ar.Io.Class})):!e?.schema&&!t?(await this.fetchDatasets()).map(a=>({name:a,completion:`${a}.`,kind:ar.Io.Module})):!e?.table&&(!t||e?.schema)?(await this.fetchTables(e?.schema)).map(a=>({name:a,completion:a,kind:ar.Io.Class})):e?.table&&e.schema?(await this.fetchFields({dataset:e.schema,table:e.table})).map(a=>({name:a.name,completion:a.value,kind:ar.Io.Field})):[]}getDB(){return this.db!==void 0?this.db:{datasets:()=>this.fetchDatasets(),tables:e=>this.fetchTables(e),fields:e=>this.fetchFields(e),validateQuery:(e,t)=>Promise.resolve({query:e,error:"",isError:!1,isValid:!0}),dsID:()=>this.id,toRawSql:yv,functions:()=>["VARIANCE","STDDEV"],getEditorLanguageDefinition:()=>this.getSqlLanguageDefinition()}}}class YF extends T.PureComponent{constructor(e){super(e);const{datasource:t}=e;this.datasource=new JF({url:t.urls[0],access:t.access,id:t.id,jsonData:{allowCleartextPasswords:!1,tlsAuth:!1,tlsAuthWithCACert:!1,tlsSkipVerify:!1,maxIdleConns:1,maxOpenConns:1,maxIdleConnsAuto:!0,connMaxLifetime:1,timezone:"",user:"",database:"",url:t.urls[0],timeInterval:""},meta:t.meta,name:t.name,readOnly:!1,type:t.type,uid:t.uid},t.templateSrv)}transformQuery(e){const t=oo(e);return{...t,dataset:"iox",sql:{...t.sql,limit:void 0}}}render(){const{query:e,theme:t,onRunQuery:r,onChange:a}=this.props,i=XF(t),o=()=>r(),l=s=>{a({...s})},u=(0,O.jsxs)("div",{children:["Type: ",(0,O.jsx)("i",{children:"ctrl+space"})," to show template variable suggestions ",(0,O.jsx)("br",{}),"Many queries can be copied from Chronograf"]});return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(mv,{datasource:this.datasource,query:this.transformQuery(e),onRunQuery:o,onChange:l,queryHeaderProps:{dialect:"influx"}}),(0,O.jsxs)("div",{className:(0,pe.cx)("gf-form-inline",i.editorActions),children:[(0,O.jsx)(Ot.z9,{icon:"external-link-alt",variant:"secondary",target:"blank",href:"https://docs.influxdata.com/influxdb/cloud-serverless/query-data/sql/",children:"SQL language syntax"}),(0,O.jsx)("div",{className:"gf-form gf-form--grow",children:(0,O.jsx)("div",{className:"gf-form-label gf-form-label--grow"})}),(0,O.jsx)(Xt.I,{width:5,tooltip:u,children:"Help"})]})]})}}const XF=n=>({editorContainerStyles:(0,pe.css)`
    height: 200px;
    max-width: 100%;
    resize: vertical;
    overflow: auto;
    background-color: ${n.isDark?n.colors.background.canvas:n.colors.background.primary};
    padding-bottom: ${n.spacing(1)};
  `,editorActions:(0,pe.css)`
    margin-top: 6px;
  `}),ZF=(0,Ae.cV)(YF);var eT=h(96374);const rT=({isRaw:n,onChange:e})=>{const[t,r]=(0,T.useState)(!1);return(0,T.useEffect)(()=>{r(!1)},[n]),n?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(Ot.$n,{"aria-label":"Switch to visual editor",icon:"pen",variant:"secondary",type:"button",onClick:()=>{r(!0)}}),(0,O.jsx)(eT.u,{isOpen:t,title:"Switch to visual editor mode",body:"Are you sure to switch to visual editor mode? You will lose the changes done in raw query mode.",confirmText:"Yes, switch to editor mode",dismissText:"No, stay in raw query mode",onConfirm:()=>{e(!1)},onDismiss:()=>{r(!1)}})]}):(0,O.jsx)(Ot.$n,{"aria-label":"Switch to text editor",icon:"pen",variant:"secondary",type:"button",onClick:()=>{e(!0)}})};var xn=h(67061),Ov=h(21744);const bv=[{label:"Time series",value:"time_series"},{label:"Table",value:"table"},{label:"Logs",value:"logs"}],Fv="time_series";var tT=h(84596);function $i(n){const[e,t]=(0,T.useState)(n),r=(0,tT.A)(n);return(0,T.useEffect)(()=>{r!==n&&e!==n&&t(n)},[n,e,r]),[e,t]}const nT=({query:n,onChange:e,onRunQuery:t})=>{const[r,a]=$i(n.query),[i,o]=$i(n.alias),l=(0,T.useId)(),u=(0,T.useId)(),s=n.resultFormat??Fv,c=()=>{e({...n,query:r,alias:i,resultFormat:s}),t()};return(0,O.jsxs)(xn.B,{direction:"column",children:[(0,O.jsx)(Ov.f,{"aria-label":"query",rows:3,spellCheck:!1,placeholder:"InfluxDB Query",onBlur:c,onChange:d=>{a(d.currentTarget.value)},value:r??""}),(0,O.jsxs)(xn.B,{children:[(0,O.jsx)(Ur.I,{htmlFor:u,label:"Format as",children:(0,O.jsx)(rr.l6,{inputId:u,onChange:d=>{e({...n,resultFormat:d.value}),t()},value:s,options:bv})}),(0,O.jsx)(Ur.I,{htmlFor:l,label:"Alias by",children:(0,O.jsx)(fr.p,{id:l,type:"text",spellCheck:!1,placeholder:"Naming pattern",onBlur:c,onChange:d=>{o(d.currentTarget.value)},value:i??""})})]})]})};var Ca=h(64765),Tv=h(2913);const Dl=n=>{let e="",{type:t,templateService:r,scopedVars:a,database:i,measurement:o,retentionPolicy:l,tags:u,withKey:s,withMeasurementFilter:c}=n;switch(t){case"RETENTION_POLICIES":return'SHOW RETENTION POLICIES on "'+i+'"';case"FIELDS":return!o||o===""?"SHOW FIELD KEYS":(o&&!o.match(/^\/.*\/|^$/)&&(o='"'+o+'"',l&&l!==he&&(l='"'+l+'"',o=l+"."+o)),"SHOW FIELD KEYS FROM "+o);case"TAG_KEYS":e="SHOW TAG KEYS";break;case"TAG_VALUES":e="SHOW TAG VALUES";break;case"MEASUREMENTS":e="SHOW MEASUREMENTS",c&&(e+=" WITH MEASUREMENT =~ /(?i)"+(0,St.$f)(c)+"/");break;default:return e}if(o&&(!o.match("^/.*/")&&!o.match(/^merge\(.*\)/)&&(o='"'+o+'"'),l&&l!==he&&(l='"'+l+'"',o=l+"."+o),o!==""&&(e+=" FROM "+o)),s){let d=s;d.endsWith("::tag")&&(d=d.slice(0,-5)),e+=' WITH KEY = "'+d+'"'}if(u&&u.length>0){const d=(0,de.reduce)(u,(f,p)=>(p.key&&p.key===s||p.operator===">"||p.operator==="<"||f.push(aT(p,f.length,r,a,!0)),f),[]);d.length>0&&(e+=" WHERE "+d.join(" "))}return t==="MEASUREMENTS"&&(e+=" LIMIT 100"),e};function aT(n,e,t,r,a){let i="",o=n.operator,l=n.value;e>0&&(i=(n.condition||"AND")+" "),o||(/^\/.*\/$/.test(n.value)?o="=~":o="="),(l===""||o!=="=~"&&o!=="!~")&&(l="'"+l.replace(/\\/g,"\\\\").replace(/\'/g,"\\'")+"'"),o!=="=~"&&o!=="!~"?a?l=t.replace(l,r):o!==">"&&o!=="<"&&(l="'"+l.replace(/\\/g,"\\\\").replace(/\'/g,"\\'")+"'"):a&&(l=t.replace(l,r,"regex"));let u=`"${n.key}"`;return n.key.endsWith("::tag")&&(u=`"${n.key.slice(0,-5)}"::tag`),n.key.endsWith("::field")&&(u=`"${n.key.slice(0,-7)}"::field`),i+u+" "+o+" "+l}const Ya=async n=>{const{type:e,datasource:t,scopedVars:r,measurement:a,retentionPolicy:i,tags:o,withKey:l,withMeasurementFilter:u}=n,s=Dl({type:e,scopedVars:r,measurement:a,retentionPolicy:i,tags:o,withKey:l,withMeasurementFilter:u,templateService:t.templateSrv,database:t.database}),c=i?t.templateSrv.replace(i,{},"regex"):"",d={query:s,policy:c,rawQuery:!0,refId:"metadataQuery"};if(Tv.Ay.featureToggles.influxdbBackendMigration)return t.runMetadataQuery(d);{const f={policy:d.policy};return t.metricFindQuery({refId:"run-explore-query",query:s},f)}};async function iT(n){return(await Ya({type:"RETENTION_POLICIES",datasource:n})).map(t=>t.text)}async function oT(n,e,t){return(await Ya({type:"MEASUREMENTS",datasource:n,tags:e,withMeasurementFilter:t})).map(a=>a.text)}async function lT(n,e,t){return(await Ya({type:"TAG_KEYS",datasource:n,measurement:e,retentionPolicy:t})).map(a=>a.text)}async function uT(n,e,t,r,a){return t.endsWith("::field")?[]:(await Ya({type:"TAG_VALUES",tags:e,withKey:t,datasource:n,measurement:r,retentionPolicy:a})).map(o=>o.text)}async function Ev(n,e,t){return(await Ya({type:"FIELDS",datasource:n,measurement:e,retentionPolicy:t})).map(a=>a.text)}function Cv(n,e){return n.filter(t=>t.key.endsWith("::tag")||e.has(t.key+"::tag"))}function zt(n){return{label:n,value:n}}function Xa(n){if(n==null)throw new Error("value must not be nullish");return n}function sT(){const n=un.getCategories(),e=[];return Object.keys(n).forEach(r=>{const a=n[r].map(i=>zt(i.type));e.push({label:r,options:a})}),e}async function cT(n,e){const t=await e(),r={...n},a=new Dt(r),i=[];return a.hasFill()||i.push(zt("fill(null)")),a.hasGroupByTime()||i.push(zt("time($interval)")),t.forEach(o=>{i.push(zt(`tag(${o})`))}),i}function dT(n,e){const t=un.create(n).def,r=(n.params??[]).map(a=>a.toString());if(r.length!==t.params.length)throw new Error("Invalid query-segment");return r.map((a,i)=>{const o=t.params[i];return o.dynamicLookup?{value:a,options:Xa(e.get(`${t.type}_${i}`))}:o.options!=null?{value:a,options:()=>Promise.resolve(o.options)}:{value:a,options:null}})}function Av(n,e){return n.map(t=>({name:t.type,params:dT(t,e)}))}function fT(n){return(0,sn.w)().getVariables().map(n)}function Vl(n,e,t){let r=fT(e);return t&&(r=r.filter(a=>a.indexOf(t)>-1)),n.then(a=>[...r,...a])}function Lv(n){return`/^$${n.name}$/`}function pT(n){return`$${n.name}`}const kl=(0,pe.css)({paddingRight:"4px"}),vT=(0,pe.cx)("width-8",kl),gT=({format:n,inputId:e,onChange:t})=>(0,O.jsx)(rr.l6,{inputId:e,className:vT,onChange:r=>{t(Xa(r.value))},value:n,options:bv});var mT=h(76459),hT=h.n(mT);const wv=(0,pe.css)({minWidth:"160px"}),xv=n=>n,yT=({loadOptions:n,allowCustomValue:e,onChange:t,onClose:r})=>{const a=hT()(n,1e3,{leading:!0});return(0,O.jsx)("div",{className:wv,children:(0,O.jsx)(rr.DW,{formatCreateLabel:xv,defaultOptions:!0,autoFocus:!0,isOpen:!0,onCloseMenu:r,allowCustomValue:e,loadOptions:a,onChange:t,createOptionPosition:"first"})})},ST=({loadOptions:n,allowCustomValue:e,onChange:t,onClose:r})=>{const[a,i]=(0,Ql.A)(n,[n]);return(0,T.useEffect)(()=>{i("")},[i,n]),(0,O.jsx)("div",{className:wv,children:(0,O.jsx)(rr.l6,{isLoading:a.loading,formatCreateLabel:xv,autoFocus:!0,isOpen:!a.loading,onCloseMenu:r,allowCustomValue:e,options:a.value??[],onChange:t,createOptionPosition:"first"})})},OT=({loadOptions:n,filterByLoadOptions:e,allowCustomValue:t,onChange:r,onClose:a})=>e?(0,O.jsx)(yT,{loadOptions:n,allowCustomValue:t,onChange:r,onClose:a}):(0,O.jsx)(ST,{loadOptions:n,allowCustomValue:t,onChange:r,onClose:a}),bT=({initialValue:n,onChange:e,onClose:t})=>{const[r,a]=$i(n);return(0,O.jsx)(fr.p,{autoFocus:!0,type:"text",spellCheck:!1,onBlur:t,onKeyDown:i=>{i.key==="Enter"&&e(r)},onChange:i=>{a(i.currentTarget.value)},value:r})},FT=(0,pe.css)({width:"auto",cursor:"pointer"}),Mn=({value:n,buttonClassName:e,loadOptions:t,filterByLoadOptions:r,allowCustomValue:a,onChange:i})=>{const[o,l]=(0,T.useState)(!1);if(o)return t!==void 0?(0,O.jsx)(OT,{loadOptions:t,filterByLoadOptions:r??!1,allowCustomValue:a,onChange:u=>{l(!1),i(u)},onClose:()=>{l(!1)}}):(0,O.jsx)(bT,{initialValue:n,onClose:()=>{l(!1)},onChange:u=>{l(!1),i({value:u,label:u})}});{const u=(0,pe.cx)(FT,e);return(0,O.jsx)(Ke.c,{as:"button",className:u,onClick:()=>{l(!0)},children:n})}},TT=({policy:n,measurement:e,onChange:t,getPolicyOptions:r,getMeasurementOptions:a})=>{const i=async()=>{const l=await r();return(l.some(s=>s===he)?l:[he,...l]).map(zt)},o=async l=>(await a(l)).map(zt);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(Mn,{allowCustomValue:!0,value:n??"using default policy",loadOptions:i,onChange:l=>{t(l.value,e)}}),(0,O.jsx)(Mn,{allowCustomValue:!0,value:e??"select measurement",loadOptions:o,filterByLoadOptions:!0,onChange:l=>{t(n,l.value)}}),e&&(0,O.jsx)(oi.Z,{style:{marginRight:"4px"},"aria-label":"remove",icon:"times",variant:"secondary",onClick:()=>{t(n,void 0)}})]})},Wi=({value:n,onChange:e,isWide:t,placeholder:r})=>{const[a,i]=$i(n),o=()=>{e(a===""?void 0:a)};return(0,O.jsx)(O.Fragment,{children:(0,O.jsx)(fr.p,{placeholder:r,className:(0,pe.cx)(t??!1?"width-14":"width-8",kl),type:"text",spellCheck:!1,onBlur:o,onChange:l=>{i(l.currentTarget.value)},value:a??""})})},ET=[{label:"ascending",value:"ASC"},{label:"descending",value:"DESC"}],CT=(0,pe.cx)("width-9",kl),AT=({value:n,onChange:e,inputId:t})=>(0,O.jsx)(O.Fragment,{children:(0,O.jsx)(rr.l6,{inputId:t,className:CT,onChange:r=>{e(Xa(r.value))},value:n,options:ET})}),jv=({loadOptions:n,allowCustomValue:e,onAdd:t})=>(0,O.jsx)(Mn,{value:"+",loadOptions:n,allowCustomValue:e,onChange:r=>{t(Xa(r.value))}}),LT=(0,pe.css)({paddingRight:"0",marginRight:"0"}),wT=(0,pe.css)({paddingLeft:"0",paddingRight:"0",marginLeft:"0",marginRight:"0"}),xT=n=>(0,pe.cx)("gf-form-label",(0,pe.css)({paddingLeft:"0",lineHeight:n.typography.body.lineHeight,fontSize:n.typography.body.fontSize})),jT=({name:n,params:e,onChange:t})=>{const r=(0,Ae.$j)(),a=(0,T.useMemo)(()=>xT(r),[r]),i=(o,l)=>{const u=e.map(s=>s.value);u[l]=o,t(u)};return(0,O.jsxs)("div",{className:a,children:[(0,O.jsx)("button",{className:(0,pe.cx)("gf-form-label",LT),children:n}),"(",e.map((o,l)=>{const{value:u,options:s}=o,c=l===e.length-1,d=s!==null?()=>s().then(f=>f.map(zt)):void 0;return(0,O.jsxs)(T.Fragment,{children:[(0,O.jsx)(Mn,{allowCustomValue:!0,value:u,buttonClassName:wT,loadOptions:d,onChange:f=>{i(Xa(f.value),l)}}),!c&&","]},l)}),")"]})},Rv=({parts:n,getNewPartOptions:e,onAddNewPart:t,onRemovePart:r,onChange:a})=>(0,O.jsxs)(O.Fragment,{children:[n.map((i,o)=>(0,O.jsxs)(T.Fragment,{children:[(0,O.jsx)(jT,{name:i.name,params:i.params,onRemove:()=>{r(o)},onChange:l=>{a(o,l)}}),(0,O.jsx)(oi.Z,{style:{marginRight:"4px"},"aria-label":"remove",icon:"times",variant:"secondary",onClick:()=>{r(o)}})]},o)),(0,O.jsx)(jv,{loadOptions:e,onAdd:t})]});function Iv(n){return/^\/.*\/$/.test(n)}function Pv(n){return n.operator??(Iv(n.value)?"=~":"=")}function Nv(n,e){return e?void 0:n.condition??"AND"}function RT(n,e){const t=n==="=~"||n==="!~";return Iv(e)?t?n:"=~":t?"=":n}const IT=["=","!=","<>","<",">",">=","<=","=~","!~","Is","Is Not"],PT=["AND","OR"],NT=IT.map(zt),DT=PT.map(zt),VT=()=>Promise.resolve(DT),kT=()=>Promise.resolve(NT),MT=({tag:n,isFirst:e,onRemove:t,onChange:r,getTagKeyOptions:a,getTagValueOptions:i})=>{const o=Pv(n),l=Nv(n,e),u=()=>a().catch(c=>(console.error(c),[])).then(c=>c.map(zt)),s=()=>i(n.key).then(c=>c.map(zt));return(0,O.jsxs)("div",{className:"gf-form",children:[l!=null&&(0,O.jsx)(Mn,{value:l,loadOptions:VT,onChange:c=>{r({...n,condition:c.value})}}),(0,O.jsx)(Mn,{allowCustomValue:!0,value:n.key,loadOptions:u,onChange:c=>{const{value:d}=c;d===void 0?t():r({...n,key:d??""})}}),(0,O.jsx)(Mn,{value:o,loadOptions:kT,onChange:c=>{r({...n,operator:c.value})}}),(0,O.jsx)(Mn,{allowCustomValue:!0,value:n.value,loadOptions:s,onChange:c=>{const d=c.value??"";r({...n,value:d,operator:RT(o,d)})}}),(0,O.jsx)(oi.Z,{style:{marginRight:"4px"},"aria-label":"remove",icon:"times",variant:"secondary",onClick:()=>{t()}})]})},_T=({tags:n,onChange:e,getTagKeyOptions:t,getTagValueOptions:r})=>{const a=(u,s)=>{const c=n.map((d,f)=>s===f?u:d);e(c)},i=u=>{const s=n.filter((c,d)=>d!==u);e(s)},o=()=>t().then(u=>u.map(zt)),l=(u,s)=>{const c={key:u,value:"select tag value"},d={key:c.key,value:c.value,operator:Pv(c),condition:Nv(c,s)};e([...n,d])};return(0,O.jsxs)(O.Fragment,{children:[n.map((u,s)=>(0,O.jsx)(MT,{tag:u,isFirst:s===0,onChange:c=>{a(c,s)},onRemove:()=>{i(s)},getTagKeyOptions:t,getTagValueOptions:r},s)),(0,O.jsx)(jv,{allowCustomValue:!0,loadOptions:o,onAdd:u=>{l(u,n.length===0)}})]})},GT=n=>{const e=(0,T.useId)(),t=`influxdb-qe-format-as-${e}`,r=`influxdb-qe-order-by${e}`,a=(0,Ae.of)(BT),i=Xi(n.query),{datasource:o}=n,{measurement:l,policy:u}=i,s=(0,T.useMemo)(async()=>{const g=(await lT(o,l,u)).map(y=>`${y}::tag`),S=(await Ev(o,l||"",u)).map(y=>`${y}::field`);return new Set([...g,...S])},[l,u,o]),c=(0,T.useMemo)(()=>{const g=new Map([["field_0",()=>l!==void 0?Ev(o,l,u):Promise.resolve([])]]);return(i.select??[]).map(S=>Av(S,g))},[l,u,i.select,o]),d=(0,T.useMemo)(()=>async()=>[...await s],[s]),f=(0,T.useMemo)(()=>{const g=new Map([["tag_0",d]]);return Av(i.groupBy??[],g)},[d,i.groupBy]),p=g=>{n.onChange(g),n.onRunQuery()},m=(g,S)=>{p({...i,policy:g,measurement:S})},v=g=>{p({...i,tags:g.length===0?void 0:g})};return(0,O.jsxs)("div",{children:[(0,O.jsxs)(Ca.L,{label:"FROM",fill:!0,children:[(0,O.jsx)(TT,{policy:u,measurement:l,getPolicyOptions:()=>Vl(iT(o),pT),getMeasurementOptions:g=>Vl(s.then(S=>oT(o,Cv(i.tags??[],S),g===""?void 0:g)),Lv,g),onChange:m}),(0,O.jsx)(Ke.c,{width:"auto",className:a.inlineLabel,children:"WHERE"}),(0,O.jsx)(_T,{tags:i.tags??[],onChange:v,getTagKeyOptions:d,getTagValueOptions:g=>Vl(s.then(S=>uT(o,Cv(i.tags??[],S),g,l)),Lv)})]}),c.map((g,S)=>(0,O.jsx)(Ca.L,{label:S===0?"SELECT":"",fill:!0,children:(0,O.jsx)(Rv,{parts:g,getNewPartOptions:()=>Promise.resolve(sT()),onChange:(y,b)=>{const F=Zi(i,S,y,b);p(F)},onAddNewPart:y=>{p(ti(i,y,S))},onRemovePart:y=>{p(_l(i,y,S))}})},S)),(0,O.jsx)(Ca.L,{label:"GROUP BY",fill:!0,children:(0,O.jsx)(Rv,{parts:f,getNewPartOptions:()=>cT(i,d),onChange:(g,S)=>{const y=to(i,g,S);p(y)},onAddNewPart:g=>{p(eo(i,g))},onRemovePart:g=>{p(ro(i,g))}})}),(0,O.jsxs)(Ca.L,{label:"TIMEZONE",fill:!0,children:[(0,O.jsx)(Wi,{placeholder:"(optional)",value:i.tz,onChange:g=>{p({...i,tz:g})}}),(0,O.jsx)(Ke.c,{htmlFor:r,width:"auto",className:a.inlineLabel,children:"ORDER BY TIME"}),(0,O.jsx)(AT,{inputId:r,value:i.orderByTime==="DESC"?"DESC":"ASC",onChange:g=>{p({...i,orderByTime:g})}})]}),(0,O.jsxs)(Ca.L,{label:"LIMIT",fill:!0,children:[(0,O.jsx)(Wi,{placeholder:"(optional)",value:i.limit?.toString(),onChange:g=>{p({...i,limit:g})}}),(0,O.jsx)(Ke.c,{width:"auto",className:a.inlineLabel,children:"SLIMIT"}),(0,O.jsx)(Wi,{placeholder:"(optional)",value:i.slimit?.toString(),onChange:g=>{p({...i,slimit:g})}})]}),(0,O.jsxs)(Ca.L,{htmlFor:t,label:"FORMAT AS",fill:!0,children:[(0,O.jsx)(gT,{inputId:t,format:i.resultFormat??Fv,onChange:g=>{p({...i,resultFormat:g})}}),i.resultFormat!=="table"&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(Ke.c,{width:"auto",className:a.inlineLabel,children:"ALIAS"}),(0,O.jsx)(Wi,{isWide:!0,placeholder:"Naming pattern",value:i.alias,onChange:g=>{p({...i,alias:g})}})]})]})]})};function BT(n){return{inlineLabel:(0,pe.css)`
      color: ${n.colors.primary.text};
    `}}const UT=({query:n,onChange:e,onRunQuery:t,datasource:r})=>{switch(r.version){case te.Flux:return(0,O.jsx)("div",{className:"gf-form-query-content",children:(0,O.jsx)(Ra,{query:n,onChange:e,datasource:r})});case te.SQL:return(0,O.jsx)(ZF,{datasource:r,query:n,onChange:e,onRunQuery:t});case te.InfluxQL:default:return(0,O.jsxs)("div",{className:(0,pe.css)({display:"flex"}),children:[(0,O.jsx)("div",{className:(0,pe.css)({flexGrow:1}),children:n.rawQuery?(0,O.jsx)(nT,{query:n,onChange:e,onRunQuery:t}):(0,O.jsx)(GT,{query:n,onChange:e,onRunQuery:t,datasource:r})}),(0,O.jsx)(rT,{isRaw:n.rawQuery??!1,onChange:a=>{e({...n,query:ja(n),rawQuery:a}),t()}})]})}},$T=[{title:"Getting started",label:"Start by selecting a measurement and field from the dropdown above. You can then use the tag selector to further narrow your search."}],WT=()=>{const n=(0,Ae.of)(QT);return(0,O.jsxs)("div",{children:[(0,O.jsx)("h2",{children:"InfluxDB Cheat Sheet"}),$T.map(e=>(0,O.jsxs)("div",{className:n.cheatSheetItem,children:[(0,O.jsx)("div",{className:n.cheatSheetItemTitle,children:e.title}),e.label]},e.title))]})},QT=n=>({cheatSheetItem:(0,pe.css)({margin:n.spacing(3,0)}),cheatSheetItemTitle:(0,pe.css)({fontSize:n.typography.h3.fontSize})});function KT(){return(0,O.jsx)(WT,{})}var zT=h(88483),HT=h(44240),Qi=h(62467),qT=h(66847),JT=h(14236),nn=h(11261),YT=h(85858);const XT=n=>{const{query:e,onChange:t}=n,[r,a]=(0,T.useState)(e.query??""),[i,o]=(0,T.useState)(e.textColumn??""),[l,u]=(0,T.useState)(e.tagsColumn??""),[s,c]=(0,T.useState)(e?.timeEndColumn??""),[d]=(0,T.useState)(e?.titleColumn??""),f=(p,m)=>{t({...e,[p]:m,rawQuery:!0,fromAnnotations:!0,textEditor:!0})};return(0,O.jsxs)(xn.B,{gap:5,direction:"column",children:[(0,O.jsxs)(xn.B,{gap:.5,direction:"column",children:[(0,O.jsxs)(xn.B,{gap:0,children:[(0,O.jsx)(Xt.I,{width:12,children:"InfluxQL Query"}),(0,O.jsx)(fr.p,{value:r,onChange:p=>a(p.currentTarget.value??""),onBlur:()=>f("query",r),placeholder:"select text from events where $timeFilter limit 1000"})]}),(0,O.jsx)(Xt.I,{width:12,tooltip:(0,O.jsx)("div",{children:"If your influxdb query returns more than one field you need to specify the column names below. An annotation event is composed of a title, tags, and an additional text field. Optionally you can map the timeEnd column for region annotation usage."}),children:"Field mappings"}),(0,O.jsxs)(xn.B,{gap:.5,alignItems:"flex-start",wrap:"wrap",children:[(0,O.jsxs)(xn.B,{gap:0,children:[(0,O.jsx)(Xt.I,{width:12,children:"Text"}),(0,O.jsx)(fr.p,{value:i,onChange:p=>o(p.currentTarget.value??""),onBlur:()=>f("textColumn",i)})]}),(0,O.jsxs)(xn.B,{gap:0,children:[(0,O.jsx)(Xt.I,{width:12,children:"Tags"}),(0,O.jsx)(fr.p,{value:l,onChange:p=>u(p.currentTarget.value??""),onBlur:()=>f("tagsColumn",l)})]}),(0,O.jsxs)(xn.B,{gap:0,children:[(0,O.jsx)(Xt.I,{width:12,children:"TimeEnd"}),(0,O.jsx)(fr.p,{value:s,onChange:p=>c(p.currentTarget.value??""),onBlur:()=>f("timeEndColumn",s)})]}),(0,O.jsxs)("div",{className:"gf-form ng-hide",children:[(0,O.jsx)(Xt.I,{width:12,children:"Title"}),(0,O.jsx)(fr.p,{defaultValue:d})]})]})]}),(0,O.jsx)("div",{})]})};var Dv=h(91950);class Vv{constructor(e){this.series=e.series,this.alias=e.alias,this.annotation=e.annotation,this.meta=e.meta,this.refId=e.refId}getTimeSeries(){const e=[];let t,r;return this.series.length===0||(0,de.each)(this.series,a=>{const i=a.columns.length,o=(0,de.map)(a.tags,(l,u)=>u+": "+l);for(r=1;r<i;r++){let l=a.name;const u=a.columns[r];u!=="value"&&(l=l+"."+u),this.alias?l=this._getSeriesName(a,r):a.tags&&(l=l+" {"+o.join(", ")+"}");const s=[];if(a.values)for(t=0;t<a.values.length;t++)s[t]=[a.values[t][r],a.values[t][0]];e.push({title:l,target:l,datapoints:s,tags:a.tags,meta:this.meta,refId:this.refId})}}),e}_getSeriesName(e,t){const r=/\$(\w+)|\[\[([\s\S]+?)\]\]/g,a=e.name.split(".");return this.alias?.replace(r,(i,o,l)=>{const u=o||l,s=parseInt(u,10);if(u==="m"||u==="measurement")return e.name;if(u==="col")return e.columns[t];if(!isNaN(s))return a[s]??i;if(u.indexOf("tag_")!==0)return i;const c=u.replace("tag_","");return e.tags?e.tags[c]:i})}getAnnotations(){const e=[];return(0,de.each)(this.series,t=>{let r=null,a=null,i=null;const o=[];let l=null;(0,de.each)(t.columns,(u,s)=>{if(u==="time"){a=s;return}if(u!=="sequence_number"){if(u===this.annotation?.titleColumn){r=s;return}if((0,de.includes)((this.annotation?.tagsColumn||"").replace(" ","").split(","),u)){o.push(s);return}if(u===this.annotation?.textColumn){l=s;return}if(u===this.annotation?.timeEndColumn){i=s;return}!r&&l!==s&&(r=s)}}),(0,de.each)(t.values,u=>{const s={annotation:this.annotation,time:+new Date(u[a]),title:u[r],timeEnd:u[i],tags:(0,de.flatten)(o.filter(c=>u[c]).map(c=>u[c].split(","))),text:u[l]};e.push(s)})}),e}getTable(){const e=new Dv.A;let t,r;return e.refId=this.refId,e.meta=this.meta,this.series.length===0||(0,de.each)(this.series,(a,i)=>{if(i===0){const o=a.columns[0],l=o==="time"?{text:"Time",type:nn.PU.time}:{text:o};for(e.columns.push(l),(0,de.each)((0,de.keys)(a.tags),u=>{e.columns.push({text:u})}),r=1;r<a.columns.length;r++)e.columns.push({text:a.columns[r]})}if(a.values)for(t=0;t<a.values.length;t++){const o=a.values[t],l=[o[0]];if(a.tags)for(const u in a.tags)a.tags.hasOwnProperty(u)&&l.push(a.tags[u]);for(r=1;r<o.length;r++)l.push(o[r]);e.rows.push(l)}}),e}}const ZT=n=>{const e={refId:"",query:n.query??"",queryType:"tags",fromAnnotations:!0,tagsColumn:n.tagsColumn??"",textColumn:n.textColumn??"",timeEndColumn:n.timeEndColumn??"",titleColumn:n.titleColumn??"",name:n.name??""};return n.target&&n.target.limit&&(e.limit=n.target.limit),n.target&&n.target.matchAny&&(e.matchAny=n.target.matchAny),n.target&&n.target.tags&&(e.tags=n.target.tags),n.target&&n.target.type&&(e.type=n.target.type),e},eE=n=>(n.target=n.target&&!n.target?.query?ZT(n):n.target,n);class rE{parse(e,t){if(!t?.results||t.results.length===0)return[];const r=t.results[0];if(!r.series)return[];const a=e.toLowerCase(),i=a.indexOf("show retention policies")>=0,o=a.indexOf("show field keys")>=0||i,l=new Set;return(0,de.each)(r.series,u=>{(0,de.each)(u.values,s=>{(0,de.isArray)(s)?o?l.add(s[0].toString()):s[1]!==void 0?l.add(s[1].toString()):l.add(s[0].toString()):l.add(s.toString())})}),Array.from(l).map(u=>({text:u}))}getTable(e,t,r){let a=new Dv.A;if(e.length>0)if(a.meta={...r,executedQueryString:e[0].meta?.executedQueryString},a.refId=t.refId,a=nE(e,a,t),e[0].fields[1]&&e[0].fields[1].labels){let i=(0,de.groupBy)(e,u=>u.fields[1].labels?Object.values(u.fields[1].labels):null);const o=Object.keys(i),l=Object.values(i);for(let u=0;u<l.length;u++)a=kv(l[u],a,[...o[u].split(",")])}else a=kv(e,a,[]);return a}async transformAnnotationResponse(e,t,r){const a=(0,Ye.bE)(t,[r]);if(!a)return[];const i=this.getTable(a.data,r,{}),o=[];let l=0,u=0,s=0,c=0;const d=[];return(0,de.each)(i.columns,(f,p)=>{if(f.text.toLowerCase()==="time"){u=p;return}if(f.text===e.titleColumn){l=p;return}if(tE(f.text,e.tagsColumn)){d.push(p);return}if(e.textColumn&&f.text.includes(e.textColumn)){c=p;return}if(f.text===e.timeEndColumn){s=p;return}!l&&c!==p&&(l=p)}),(0,de.each)(i.rows,f=>{const p={annotation:e,time:+new Date(f[u]),title:f[l],timeEnd:f[s],tags:(0,de.flatten)(d.filter(m=>f[m]).map(m=>f[m].split(","))),text:f[c]};o.push(p)}),o}}function tE(n,e){const t=(e||"").replace(" ","").split(",");for(const r of t)if(r!==""&&n.includes(r))return!0;return!1}function nE(n,e,t){const r=aE(t);n[0].fields.forEach(a=>{a.name.toLowerCase()==="time"?e.columns.push({text:"Time",type:nn.PU.time}):a.name.toLowerCase()==="value"&&a.labels&&Object.keys(a.labels).forEach(i=>{e.columns.push({text:i})})}),n[0].refId==="metricFindQuery"&&n.forEach(a=>{a.name&&e.columns.push({text:a.name})});for(let a=0;a<r.length;a++)e.columns.push({text:r[a]});return t.rawQuery&&r.length===0&&iE(t.query,n)&&n[0].refId!=="metricFindQuery"&&n.map(a=>{a.name&&e.columns.push({text:a.name})}),e}function kv(n,e,t){const r=n[0].fields[0].values;for(let a=0;a<r.length;a++){const i=r[a],o=n.map(l=>l.fields[1]?l.fields[1].values[a]:null);o.indexOf(null)<0&&e.rows.push([i,...t,...o])}return e}function aE(n){let e=[];n.select?.forEach(r=>{const a=r.filter(i=>i.type!=="field");if(a.length>0){const i=a.find(o=>o.type==="alias");i?e.push(i.params?.[0].toString()??""):e.push(a[0].type)}else r[0]&&r[0].params&&r[0].params[0]&&e.push(r[0].params[0].toString())});let t=[];return e.forEach(r=>{t.push(Mv(r,r,t,0))}),t}function Mv(n,e,t,r){return t.indexOf(e)>-1?(r++,Mv(n,n+"_"+r,t,r)):e}function iE(n,e){const r=e.map(o=>o.name).every(o=>o&&n?o.split(".").every(u=>n.toLowerCase().includes(u.toLowerCase())):!1),i=["*","SHOW"].some(o=>n?n.toLowerCase().includes(o.toLowerCase()):!1);return r||i}var oE=h(65474),lE=h(29505);const Ml="InfluxVariableQueryEditor-VariableQuery",uE=({onChange:n,datasource:e,query:t})=>{const r=a=>typeof a!="string"?a:{refId:Ml,query:a,...e.version===te.Flux?{maxDataPoints:1e3}:{}};switch(e.version){case te.Flux:return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(Ra,{datasource:e,query:r(t),onChange:a=>{n({...t,query:a.query??""})}}),(0,O.jsx)(fe.C,{children:(0,O.jsx)(Ur.I,{label:"Max Data Points",labelWidth:20,required:!0,grow:!0,"aria-labelledby":"flux-maxdatapoints",tooltip:(0,O.jsx)("div",{children:"Upper boundary of data points will return for the variable query."}),children:(0,O.jsx)(fr.p,{id:"influx-sql-variable-maxdatapoints","aria-label":"flux-maxdatapoints",type:"number",defaultValue:t.maxDataPoints??1e3,placeholder:"Default is 1000",onBlur:a=>{n({refId:Ml,query:t.query,maxDataPoints:Number.parseInt(a.currentTarget.value,10)})}})})})]});default:return(0,O.jsx)(fe.C,{children:(0,O.jsx)(Ur.I,{label:"Query",labelWidth:20,required:!0,grow:!0,"aria-labelledby":"influx-variable-query",children:(0,O.jsx)(Ov.f,{"aria-label":"influx-variable-query",defaultValue:r(t).query,placeholder:"metric name or tags query",rows:1,onBlur:a=>{n({refId:Ml,query:a.currentTarget.value??""})}})})})}};class sE extends lE.f5{constructor(e,t=(0,sn.w)()){super(),this.datasource=e,this.templateSrv=t,this.editor=uE}query(e){let t;if(typeof e.targets[0]=="string"?t=e.targets[0]:t=e.targets[0].query,!t)return(0,Qi.of)({data:[]});const r=this.templateSrv.replace(t,e.scopedVars,this.datasource.interpolateQueryExpr),a=this.datasource.getTimeFilter({rangeRaw:e.range.raw,timezone:e.timezone}),i=r.replace("$timeFilter",a);return(0,oE.H)(this.datasource.metricFindQuery({refId:e.targets[0].refId,query:i,maxDataPoints:e.targets[0].maxDataPoints??1e3},{range:e.range})).pipe((0,Wn.T)(l=>({data:l})))}}class cE extends Qn.iy{constructor(e,t=(0,sn.w)()){super(e),this.templateSrv=t,this.type="influxdb",this.urls=(e.url??"").split(",").map(a=>a.trim()),this.username=e.username??"",this.password=e.password??"",this.name=e.name,this.basicAuth=e.basicAuth,this.withCredentials=e.withCredentials,this.access=e.access;const r=e.jsonData??{};this.database=r.dbName??e.database,this.interval=r.timeInterval,this.httpMode=r.httpMode||"GET",this.responseParser=new rE,this.version=r.version??te.InfluxQL,this.isProxyAccess=e.access==="proxy",this.variables=new sE(this,this.templateSrv),this.version===te.Flux?this.annotations={QueryEditor:Ra}:this.annotations={QueryEditor:XT,prepareAnnotation:eE}}query(e){if(!this.isProxyAccess){const t=new Error(ot);return(0,cn.$)(()=>t)}return this._query(e)}_query(e){const t={...e,targets:e.targets.filter(r=>r.hide!==!0)};if(t.targets.some(r=>r.fromAnnotations)){const r=[];for(const a of t.targets)a.query&&r.push(new zT.c(i=>{this.annotationEvents(t,a).then(o=>i.next({data:[(0,JT.Vc)(o)]})).catch(o=>i.error(new Error(o))).finally(()=>i.complete())}));return(0,HT.h)(...r)}return this.version===te.InfluxQL&&!this.isMigrationToggleOnAndIsAccessProxy()?this.classicQuery(e):super.query(t)}getQueryDisplayText(e){switch(this.version){case te.Flux:return e.query;case te.SQL:return yv(e);case te.InfluxQL:return new Dt(e).render(!1);default:return""}}filterQuery(e){return this.version===te.Flux?!!e.query:!0}applyTemplateVariables(e,t,r){const a=t||{};if(a.__interval={value:"$__interval"},a.__interval_ms={value:"$__interval_ms"},this.version===te.Flux)return{...e,query:this.templateSrv.replace(e.query??"",a)};if((this.version===te.SQL||this.isMigrationToggleOnAndIsAccessProxy())&&(e=this.applyVariables(e,a,r),e.adhocFilters?.length)){const i=(e.adhocFilters??[]).map(o=>{const{condition:l,...u}=o;return u});e.tags=[...e.tags??[],...i]}return e}targetContainsTemplate(e){const t=this.version===te.Flux?e.query:ja(e);return this.templateSrv.containsTemplate(t)}interpolateVariablesInQueries(e,t){return!e||e.length===0?[]:e.map(r=>this.version===te.Flux?{...r,datasource:this.getRef(),query:this.templateSrv.replace(r.query??"",t,(a=[],i)=>this.interpolateQueryExpr(a,i,r.query))}:{...r,datasource:this.getRef(),...this.applyVariables(r,t)})}applyVariables(e,t,r){const a={...e};return e.groupBy&&(a.groupBy=e.groupBy.map(i=>({...i,params:i.params?.map(o=>this.templateSrv.replace(o.toString(),void 0))}))),e.select&&(a.select=e.select.map(i=>i.map(o=>({...o,params:o.params?.map(l=>this.templateSrv.replace(l.toString(),t))})))),e.tags&&(a.tags=e.tags.map(i=>(i.operator!=="=~"&&i.operator!=="!~"&&(i.value=$n(i.value)),{...i,key:this.templateSrv.replace(i.key,t),value:this.templateSrv.replace(i.value??"",t,(o=[],l)=>this.interpolateQueryExpr(o,l,i.value))}))),{...a,adhocFilters:r??[],query:this.templateSrv.replace(e.query??"",t,(i=[],o)=>this.interpolateQueryExpr(i,o,e.query)),rawSql:this.templateSrv.replace(e.rawSql??"",t,(i=[],o)=>this.interpolateQueryExpr(i,o,e.rawSql)),alias:this.templateSrv.replace(e.alias??"",t),limit:this.templateSrv.replace(e.limit?.toString()??"",t),measurement:this.templateSrv.replace(e.measurement??"",t,(i=[],o)=>this.interpolateQueryExpr(i,o,e.measurement)),policy:this.templateSrv.replace(e.policy??"",t),slimit:this.templateSrv.replace(e.slimit?.toString()??"",t),tz:this.templateSrv.replace(e.tz??"",t)}}interpolateQueryExpr(e=[],t,r){if(typeof e=="string"&&!isNaN(parseFloat(e)))return e;if(t.multi)return typeof e=="string"?isNaN(parseFloat(e))?(0,St.$f)(e):e:`(${e.map(i=>(0,St.$f)(i)).join("|")})`;const a=new RegExp(`\\/(?:\\^)?(.*)(\\$${t.name})(.*)(?:\\$)?\\/`,"gm");return r&&a.test(r)?typeof e=="string"?(0,St.$f)(e):`(${e.map(i=>(0,St.$f)(i)).join("|")})`:e}async runMetadataQuery(e){return(0,$t.s)(super.query({targets:[e]})).then(this.toMetricFindValue)}async metricFindQuery(e,t){if(this.version===te.Flux||this.version===te.SQL||this.isMigrationToggleOnAndIsAccessProxy()){const a={refId:"metricFindQuery",query:e.query,rawQuery:!0,...this.version===te.SQL?{rawSql:e.query,format:En.Table}:{}};return(0,$t.s)(super.query({...t??{},maxDataPoints:e.maxDataPoints,targets:[a]})).then(this.toMetricFindValue)}const r=this.templateSrv.replace(e.query,t?.scopedVars,(a=[],i)=>this.interpolateQueryExpr(a,i,e.query));return(0,$t.s)(this._seriesQuery(r,t)).then(a=>this.responseParser.parse(e.query,a))}toMetricFindValue(e){const t=new Map;return e?.data?.forEach(r=>{if(r&&r.length>0){let a=r.fields.find(i=>i.type===nn.PU.string);a||(a=r.fields.find(i=>i.type!==nn.PU.time)),a&&a.values.forEach(i=>{t.set(i.toString(),{text:i.toString()})})}}),Array.from(t.values())}getTagKeys(e){const t=Dl({type:"TAG_KEYS",templateService:this.templateSrv,database:this.database});return this.metricFindQuery({refId:"get-tag-keys",query:t})}getTagValues(e){const t=Dl({type:"TAG_VALUES",templateService:this.templateSrv,database:this.database,withKey:e.key});return this.metricFindQuery({refId:"get-tag-values",query:t})}_seriesQuery(e,t){if(!e)return(0,Qi.of)({results:[]});if(t&&t.range){const r=this.getTimeFilter({rangeRaw:t.range,timezone:t.timezone});e=e.replace("$timeFilter",r)}return this._influxRequest(this.httpMode,"/query",{q:e,epoch:"ms"},t)}serializeParams(e){return e?(0,de.reduce)(e,(t,r,a)=>(r==null||t.push(encodeURIComponent(a)+"="+encodeURIComponent(r)),t),[]).join("&"):""}_influxRequest(e,t,r,a){const i=this.urls.shift();this.urls.push(i);const o={};this.username&&(o.u=this.username,o.p=this.password),a&&a.database?o.db=a.database:this.database&&(o.db=this.database),a?.policy&&a.policy!==he&&(o.rp=a.policy);const{q:l}=r;e==="POST"&&(0,de.has)(r,"q")?((0,de.extend)(o,(0,de.omit)(r,["q"])),r=this.serializeParams((0,de.pick)(r,["q"]))):(e==="GET"||e==="POST")&&((0,de.extend)(o,r),r=null);const u={method:e,url:i+t,params:o,data:r,precision:"ms",inspect:{type:"influxdb"},paramSerializer:this.serializeParams};return u.headers=u.headers||{},(this.basicAuth||this.withCredentials)&&(u.withCredentials=!0),this.basicAuth&&(u.headers.Authorization=this.basicAuth),e==="POST"&&(u.headers["Content-type"]="application/x-www-form-urlencoded"),(0,Kn.AI)().fetch(u).pipe((0,Wn.T)(s=>{const{data:c}=s;if(c&&(c.executedQueryString=l,c.results)){const d=s.data.results.filter(f=>f.error);if(d.length>0)throw{message:"InfluxDB Error: "+d[0].error,data:c}}return c}),(0,qT.W)(s=>s.cancelled?(0,Qi.of)(s):(0,cn.$)(this.handleErrors(s))))}handleErrors(e){const t={message:e&&e.status||e&&e.message||"Unknown error during query transaction. Please check JS console logs."};return(Number.isInteger(e.status)&&e.status!==0||e.status>=300)&&(e.data&&e.data.error?(t.message="InfluxDB Error: "+e.data.error,t.data=e.data,t.config=e.config):(t.message="Network Error: "+e.statusText+"("+e.status+")",t.data=e.data,t.config=e.config)),t}getTimeFilter(e){const t=this.getInfluxTime(e.rangeRaw.from,!1,e.timezone),r=this.getInfluxTime(e.rangeRaw.to,!0,e.timezone);return"time >= "+t+" and time <= "+r}getInfluxTime(e,t,r){let a;if((0,de.isString)(e)){if(e==="now")return"now()";const i=/^now-(\d+)([dhms])$/.exec(e);if(i){const o=parseInt(i[1],10),l=i[2];return"now() - "+o+l}if(a=YT.parse(e,t,r),!a)throw new Error("unable to parse date");e=a}return e.valueOf()+"ms"}isMigrationToggleOnAndIsAccessProxy(){return Tv.Ay.featureToggles.influxdbBackendMigration&&this.access==="proxy"}classicQuery(e){let t=this.getTimeFilter(e);const r=e.scopedVars,a=(0,de.cloneDeep)(e.targets),i=[];let o,l,u=(0,de.map)(a,d=>d.hide?"":(i.push(d),r.interval=r.__interval,new Dt(d,this.templateSrv,r).render(!0))).reduce((d,f)=>(f!==""&&(d+=";"+f),d));if(u==="")return(0,Qi.of)({data:[]});const s=e.filters,c=e.targets.flatMap(d=>d.adhocFilters??[]);if(s?.length||c?.length){const d=s?.length?s:c,f=new Dt({refId:"A"},this.templateSrv,r);t+=" AND "+f.renderAdhocFilters(d)}return r.timeFilter={value:t},u=this.templateSrv.replace(u,r),this._seriesQuery(u,e).pipe((0,Wn.T)(d=>{if(!d||!d.results)return{data:[]};const f=[];for(o=0;o<d.results.length;o++){const p=d.results[o];if(!p||!p.series)continue;const m=i[o];let v=m.alias;v&&(v=this.templateSrv.replace(m.alias,e.scopedVars));const g={executedQueryString:d.executedQueryString},S=new Vv({refId:m.refId,series:d.results[o].series,alias:v,meta:g});switch(m.resultFormat){case"logs":g.preferredVisualisationType="logs";case"table":{f.push(S.getTable());break}default:{const y=S.getTimeSeries();for(l=0;l<y.length;l++)f.push(fE(y[l]));break}}}return{data:f}}))}async annotationEvents(e,t){if(this.version===te.Flux)return Promise.reject({message:"Flux requires the standard annotation query"});if(!t.query)return Promise.reject({message:"Query missing in annotation definition"});if(this.isMigrationToggleOnAndIsAccessProxy()){const i={refId:"metricFindQuery",datasource:this.getRef(),query:this.templateSrv.replace(t.query,void 0,(o=[],l)=>this.interpolateQueryExpr(o,l,t.query)),rawQuery:!0};return(0,$t.s)((0,Kn.AI)().fetch({url:"/api/ds/query",method:"POST",headers:this.getRequestHeaders(),data:{from:e.range.from.valueOf().toString(),to:e.range.to.valueOf().toString(),queries:[i]},requestId:t.name}).pipe((0,Wn.T)(async o=>await this.responseParser.transformAnnotationResponse(t,o,i))))}const r=this.getTimeFilter({rangeRaw:e.range.raw,timezone:e.timezone});let a=t.query.replace("$timeFilter",r);return a=this.templateSrv.replace(a,void 0,(i=[],o)=>this.interpolateQueryExpr(i,o,a)),(0,$t.s)(this._seriesQuery(a,e)).then(i=>{if(!i||!i.results||!i.results[0])throw{message:"No results in response from InfluxDB"};return new Vv({series:i.results[0].series,annotation:t}).getAnnotations()})}}function dE(n){const e=n.find(r=>r!==null);if(e===void 0)return nn.PU.number;const t=typeof e;switch(t){case"string":return nn.PU.string;case"boolean":return nn.PU.boolean;case"number":return nn.PU.number;default:throw new Error(`InfluxQL: invalid value type ${t}`)}}function fE(n){const e=[],t=[],r=n.datapoints;for(const l of r)t.push(l[0]),e.push(l[1]);const a={name:nn.LE,type:nn.PU.time,config:{},values:e},i={name:nn.Bc,type:dE(t),config:{displayNameFromDS:n.title},values:t,labels:n.tags},o=[a,i];return{name:n.target,refId:n.refId,meta:n.meta,fields:o,length:t.length}}const pE=new Ge.tD(cE).setConfigEditor(Aa).setQueryEditor(UT).setQueryEditorHelp(KT)},18678:function(Pe,ve,h){var V,L;(function(P,$){V=$,L=typeof V=="function"?V.call(ve,h,ve,Pe):V,L!==void 0&&(Pe.exports=L)})(this,function(){"use strict";Array.isArray||(Array.isArray=function(C){return Object.prototype.toString.call(C)==="[object Array]"});function P(C){for(var E=[],N=0,j=C.length;N<j;N++)E.indexOf(C[N])===-1&&E.push(C[N]);return E}var $={},Q={"==":function(C,E){return C==E},"===":function(C,E){return C===E},"!=":function(C,E){return C!=E},"!==":function(C,E){return C!==E},">":function(C,E){return C>E},">=":function(C,E){return C>=E},"<":function(C,E,N){return N===void 0?C<E:C<E&&E<N},"<=":function(C,E,N){return N===void 0?C<=E:C<=E&&E<=N},"!!":function(C){return $.truthy(C)},"!":function(C){return!$.truthy(C)},"%":function(C,E){return C%E},log:function(C){return console.log(C),C},in:function(C,E){return!E||typeof E.indexOf>"u"?!1:E.indexOf(C)!==-1},cat:function(){return Array.prototype.join.call(arguments,"")},substr:function(C,E,N){if(N<0){var j=String(C).substr(E);return j.substr(0,j.length+N)}return String(C).substr(E,N)},"+":function(){return Array.prototype.reduce.call(arguments,function(C,E){return parseFloat(C,10)+parseFloat(E,10)},0)},"*":function(){return Array.prototype.reduce.call(arguments,function(C,E){return parseFloat(C,10)*parseFloat(E,10)})},"-":function(C,E){return E===void 0?-C:C-E},"/":function(C,E){return C/E},min:function(){return Math.min.apply(this,arguments)},max:function(){return Math.max.apply(this,arguments)},merge:function(){return Array.prototype.reduce.call(arguments,function(C,E){return C.concat(E)},[])},var:function(C,E){var N=E===void 0?null:E,j=this;if(typeof C>"u"||C===""||C===null)return j;for(var W=String(C).split("."),J=0;J<W.length;J++)if(j==null||(j=j[W[J]],j===void 0))return N;return j},missing:function(){for(var C=[],E=Array.isArray(arguments[0])?arguments[0]:arguments,N=0;N<E.length;N++){var j=E[N],W=$.apply({var:j},this);(W===null||W==="")&&C.push(j)}return C},missing_some:function(C,E){var N=$.apply({missing:E},this);return E.length-N.length>=C?[]:N}};return $.is_logic=function(C){return typeof C=="object"&&C!==null&&!Array.isArray(C)&&Object.keys(C).length===1},$.truthy=function(C){return Array.isArray(C)&&C.length===0?!1:!!C},$.get_operator=function(C){return Object.keys(C)[0]},$.get_values=function(C){return C[$.get_operator(C)]},$.apply=function(C,E){if(Array.isArray(C))return C.map(function(Ne){return $.apply(Ne,E)});if(!$.is_logic(C))return C;var N=$.get_operator(C),j=C[N],W,J,X,q,ae;if(Array.isArray(j)||(j=[j]),N==="if"||N=="?:"){for(W=0;W<j.length-1;W+=2)if($.truthy($.apply(j[W],E)))return $.apply(j[W+1],E);return j.length===W+1?$.apply(j[W],E):null}else if(N==="and"){for(W=0;W<j.length;W+=1)if(J=$.apply(j[W],E),!$.truthy(J))return J;return J}else if(N==="or"){for(W=0;W<j.length;W+=1)if(J=$.apply(j[W],E),$.truthy(J))return J;return J}else{if(N==="filter")return q=$.apply(j[0],E),X=j[1],Array.isArray(q)?q.filter(function(Ne){return $.truthy($.apply(X,Ne))}):[];if(N==="map")return q=$.apply(j[0],E),X=j[1],Array.isArray(q)?q.map(function(Ne){return $.apply(X,Ne)}):[];if(N==="reduce")return q=$.apply(j[0],E),X=j[1],ae=typeof j[2]<"u"?j[2]:null,Array.isArray(q)?q.reduce(function(Ne,er){return $.apply(X,{current:er,accumulator:Ne})},ae):ae;if(N==="all"){if(q=$.apply(j[0],E),X=j[1],!Array.isArray(q)||!q.length)return!1;for(W=0;W<q.length;W+=1)if(!$.truthy($.apply(X,q[W])))return!1;return!0}else if(N==="none"){if(q=$.apply(j[0],E),X=j[1],!Array.isArray(q)||!q.length)return!0;for(W=0;W<q.length;W+=1)if($.truthy($.apply(X,q[W])))return!1;return!0}else if(N==="some"){if(q=$.apply(j[0],E),X=j[1],!Array.isArray(q)||!q.length)return!1;for(W=0;W<q.length;W+=1)if($.truthy($.apply(X,q[W])))return!0;return!1}}if(j=j.map(function(Ne){return $.apply(Ne,E)}),Q.hasOwnProperty(N)&&typeof Q[N]=="function")return Q[N].apply(E,j);if(N.indexOf(".")>0){var Le=String(N).split("."),re=Q;for(W=0;W<Le.length;W++){if(!re.hasOwnProperty(Le[W]))throw new Error("Unrecognized operation "+N+" (failed at "+Le.slice(0,W+1).join(".")+")");re=re[Le[W]]}return re.apply(E,j)}throw new Error("Unrecognized operation "+N)},$.uses_data=function(C){var E=[];if($.is_logic(C)){var N=$.get_operator(C),j=C[N];Array.isArray(j)||(j=[j]),N==="var"?E.push(j[0]):j.forEach(function(W){E.push.apply(E,$.uses_data(W))})}return P(E)},$.add_operation=function(C,E){Q[C]=E},$.rm_operation=function(C){delete Q[C]},$.rule_like=function(C,E){if(E===C||E==="@")return!0;if(E==="number")return typeof C=="number";if(E==="string")return typeof C=="string";if(E==="array")return Array.isArray(C)&&!$.is_logic(C);if($.is_logic(E)){if($.is_logic(C)){var N=$.get_operator(E),j=$.get_operator(C);if(N==="@"||N===j)return $.rule_like($.get_values(C,!1),$.get_values(E,!1))}return!1}if(Array.isArray(E))if(Array.isArray(C)){if(E.length!==C.length)return!1;for(var W=0;W<E.length;W+=1)if(!$.rule_like(C[W],E[W]))return!1;return!0}else return!1;return!1},$})},87805:(Pe,ve,h)=>{var V=h(43360),L=h(75288);function P($,Q,C){(C!==void 0&&!L($[Q],C)||C===void 0&&!(Q in $))&&V($,Q,C)}Pe.exports=P},85250:(Pe,ve,h)=>{var V=h(37217),L=h(87805),P=h(86649),$=h(42824),Q=h(23805),C=h(37241),E=h(14974);function N(j,W,J,X,q){j!==W&&P(W,function(ae,Le){if(q||(q=new V),Q(ae))$(j,W,Le,J,N,X,q);else{var re=X?X(E(j,Le),ae,Le+"",j,W,q):void 0;re===void 0&&(re=ae),L(j,Le,re)}},C)}Pe.exports=N},42824:(Pe,ve,h)=>{var V=h(87805),L=h(93290),P=h(71961),$=h(23007),Q=h(35529),C=h(72428),E=h(56449),N=h(83693),j=h(3656),W=h(1882),J=h(23805),X=h(11331),q=h(37167),ae=h(14974),Le=h(69884);function re(Ne,er,nr,Be,Ge,O,de){var T=ae(Ne,nr),Xe=ae(er,nr),Sr=de.get(Xe);if(Sr){V(Ne,nr,Sr);return}var Je=O?O(T,Xe,nr+"",Ne,er,de):void 0,Qe=Je===void 0;if(Qe){var rr=E(Xe),Zr=!rr&&j(Xe),it=!rr&&!Zr&&q(Xe);Je=Xe,rr||Zr||it?E(T)?Je=T:N(T)?Je=$(T):Zr?(Qe=!1,Je=L(Xe,!0)):it?(Qe=!1,Je=P(Xe,!0)):Je=[]:X(Xe)||C(Xe)?(Je=T,C(T)?Je=Le(T):(!J(T)||W(T))&&(Je=Q(Xe))):Qe=!1}Qe&&(de.set(Xe,Je),Ge(Je,Xe,Be,O,de),de.delete(Xe)),V(Ne,nr,Je)}Pe.exports=re},69302:(Pe,ve,h)=>{var V=h(83488),L=h(56757),P=h(32865);function $(Q,C){return P(L(Q,C,V),Q+"")}Pe.exports=$},20999:(Pe,ve,h)=>{var V=h(69302),L=h(36800);function P($){return V(function(Q,C){var E=-1,N=C.length,j=N>1?C[N-1]:void 0,W=N>2?C[2]:void 0;for(j=$.length>3&&typeof j=="function"?(N--,j):void 0,W&&L(C[0],C[1],W)&&(j=N<3?void 0:j,N=1),Q=Object(Q);++E<N;){var J=C[E];J&&$(Q,J,E,j)}return Q})}Pe.exports=P},14974:Pe=>{function ve(h,V){if(!(V==="constructor"&&typeof h[V]=="function")&&V!="__proto__")return h[V]}Pe.exports=ve},83693:(Pe,ve,h)=>{var V=h(64894),L=h(40346);function P($){return L($)&&V($)}Pe.exports=P},73916:(Pe,ve,h)=>{var V=h(43360),L=h(30641),P=h(15389);function $(Q,C){var E={};return C=P(C,3),L(Q,function(N,j,W){V(E,j,C(N,j,W))}),E}Pe.exports=$},55364:(Pe,ve,h)=>{var V=h(85250),L=h(20999),P=L(function($,Q,C){V($,Q,C)});Pe.exports=P},6924:(Pe,ve,h)=>{var V=h(85250),L=h(20999),P=L(function($,Q,C,E){V($,Q,C,E)});Pe.exports=P},71086:(Pe,ve,h)=>{var V=h(34932),L=h(15389),P=h(97420),$=h(83349);function Q(C,E){if(C==null)return{};var N=V($(C),function(j){return[j]});return E=L(E),P(C,N,function(j,W){return E(j,W[0])})}Pe.exports=Q},22331:(Pe,ve,h)=>{var V=h(87133),L=h(77556),P=h(61489),$=h(13222);function Q(C,E,N){return C=$(C),N=N==null?0:V(P(N),0,C.length),E=L(E),C.slice(N,N+E.length)==E}Pe.exports=Q},69884:(Pe,ve,h)=>{var V=h(21791),L=h(37241);function P($){return V($,L($))}Pe.exports=P},75198:(Pe,ve,h)=>{"use strict";var V;V={value:!0};var L=h(31635),P=h(96540),$=L.__importDefault(h(93182));function Q(C,E,N){E===void 0&&(E=0),N===void 0&&(N=[]);var j=$.default(C,E),W=j[0],J=j[1],X=j[2];return P.useEffect(X,N),[W,J]}ve.A=Q},93182:(Pe,ve,h)=>{"use strict";Object.defineProperty(ve,"__esModule",{value:!0});var V=h(96540);function L(P,$){$===void 0&&($=0);var Q=V.useRef(!1),C=V.useRef(),E=V.useRef(P),N=V.useCallback(function(){return Q.current},[]),j=V.useCallback(function(){Q.current=!1,C.current&&clearTimeout(C.current),C.current=setTimeout(function(){Q.current=!0,E.current()},$)},[$]),W=V.useCallback(function(){Q.current=null,C.current&&clearTimeout(C.current)},[]);return V.useEffect(function(){E.current=P},[P]),V.useEffect(function(){return j(),W},[$]),[N,W,j]}ve.default=L},21450:function(Pe){(function(h,V){Pe.exports=V()})(this,function(){return function(ve){var h={};function V(L){if(h[L])return h[L].exports;var P=h[L]={i:L,l:!1,exports:{}};return ve[L].call(P.exports,P,P.exports,V),P.l=!0,P.exports}return V.m=ve,V.c=h,V.d=function(L,P,$){V.o(L,P)||Object.defineProperty(L,P,{configurable:!1,enumerable:!0,get:$})},V.n=function(L){var P=L&&L.__esModule?function(){return L.default}:function(){return L};return V.d(P,"a",P),P},V.o=function(L,P){return Object.prototype.hasOwnProperty.call(L,P)},V.p="",V(V.s=3)}([function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0});function L($,Q){var C={},E=$||"Abstract",N=[],j=null,W;if(C._type=E,C.getType=function(){return E},C.setType=function(ae){E=ae},C.getChildren=function(){return N},C.addChild=function(ae){if(ae){if(!ae.setParent)throw{name:"Error",message:"Trying to add a child which is not a node: "+JSON.stringify(ae)};ae.setParent(C),N.push(ae)}},C.getParent=function(){return j},C.setParent=function(ae){j=ae},C.getContext=function(ae){return W||ae.activeContext.peek()},C.setContext=function(ae){W=ae},C.getStartPosition=function(){return Q>>16},C.getEndPosition=function(){return Q&65535},C.getValue=function(){throw{name:"MethodNotImplementedException",message:"SpelNode#getValue() must be overridden."}},C.toString=function(){var ae="Kind: "+C.getType();ae+=", Children: [";for(var Le=0,re=C.getChildren().length;Le<re;Le+=1)ae+="{"+C.getChildren()[Le]+"}, ";return ae+="]",ae},Q===0)throw{name:"Error",message:"Position cannot be 0"};for(var J=arguments.length,X=Array(J>2?J-2:0),q=2;q<J;q++)X[q-2]=arguments[q];return X&&X.forEach(function(ae){C.addChild(ae)}),C}var P=h.SpelNode={create:L}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.Stack=L;function L(P){this.elements=P||[]}L.prototype.push=function(P){return this.elements.push(P),P},L.prototype.pop=function(){return this.elements.pop()},L.prototype.peek=function(){return this.elements[this.elements.length-1]},L.prototype.empty=function(){return this.elements.length>0},L.prototype.search=function(P){return this.elements.length-this.elements.indexOf(P)}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0});var L={LITERAL_INT:1,LITERAL_LONG:2,LITERAL_HEXINT:3,LITERAL_HEXLONG:4,LITERAL_STRING:5,LITERAL_REAL:6,LITERAL_REAL_FLOAT:7,LPAREN:"(",RPAREN:")",COMMA:",",IDENTIFIER:0,COLON:":",HASH:"#",RSQUARE:"]",LSQUARE:"[",LCURLY:"{",RCURLY:"}",DOT:".",PLUS:"+",STAR:"*",MINUS:"-",SELECT_FIRST:"^[",SELECT_LAST:"$[",QMARK:"?",PROJECT:"![",DIV:"/",GE:">=",GT:">",LE:"<=",LT:"<",EQ:"==",NE:"!=",MOD:"%",NOT:"!",ASSIGN:"=",INSTANCEOF:"instanceof",MATCHES:"matches",BETWEEN:"between",SELECT:"?[",POWER:"^",ELVIS:"?:",SAFE_NAVI:"?.",BEAN_REF:"@",SYMBOLIC_OR:"||",SYMBOLIC_AND:"&&",INC:"++",DEC:"--"};function P(Q){this.type=Q,this.tokenChars=L[Q],this._hasPayload=typeof L[Q]!="string",typeof L[Q]=="number"&&(this._ordinal=L[Q])}for(var $ in L)L.hasOwnProperty($)&&(P[$]=new P($));P.prototype.toString=function(){return this.type+(this.tokenChars.length!==0?"("+this.tokenChars+")":"")},P.prototype.getLength=function(){return this.tokenChars.length},P.prototype.hasPayload=function(){return this._hasPayload},P.prototype.valueOf=function(Q){for(var C in L)if(L.hasOwnProperty(C)&&L[C]===Q)return P[C]},P.prototype.ordinal=function(){return this._ordinal},h.TokenKind=P},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.StandardContext=h.SpelExpressionEvaluator=void 0;var L=V(4),P=V(50);h.SpelExpressionEvaluator=L.SpelExpressionEvaluator,h.StandardContext=P.StandardContext},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.SpelExpressionEvaluator=void 0;var L=V(5),P=V(1),$={};function Q(C,E,N){var j=new P.Stack,W;return E||(E={}),j.push(E),W={rootContext:E,activeContext:j,locals:N},C.getValue(W)}$.compile=function(C){var E=(0,L.SpelExpressionParser)().parse(C);return{eval:function(j,W){return Q(E,j,W)},_compiledExpression:E}},$.eval=function(C,E,N){return $.compile(C).eval(E,N)},h.SpelExpressionEvaluator=$},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.SpelExpressionParser=void 0;var L=V(2),P=V(6),$=V(8),Q=V(9),C=V(10),E=V(11),N=V(12),j=V(13),W=V(14),J=V(15),X=V(16),q=V(17),ae=V(18),Le=V(19),re=V(20),Ne=V(21),er=V(22),nr=V(23),Be=V(24),Ge=V(25),O=V(26),de=V(27),T=V(28),Xe=V(29),Sr=V(30),Je=V(31),Qe=V(32),rr=V(33),Zr=V(34),it=V(35),Ur=V(36),fr=V(37),ot=V(38),he=V(39),te=V(40),fe=V(41),ke=V(42),De=V(43),le=V(44),pe=V(45),Ae=V(46),Ke=V(47),Rt=V(48),rt=V(49),Mr=h.SpelExpressionParser=function(){var ln=new RegExp("[\\p{L}\\p{N}_$]+"),Hi,Fn=[],Bn,Un,Aa,St;function hr(B){Hi=B}function La(B,Z){try{Bn=B,Un=P.Tokenizer.tokenize(B),Aa=Un.length,St=0,Fn=[];var Oe=ze();return dn()&&ut(jr().startPos,"MORE_INPUT",Ar().toString()),Oe}catch($e){throw $e.message}}function ze(){var B=wa();if(dn()){var Z=jr();if(Z.getKind()===L.TokenKind.ASSIGN){B===null&&(B=E.NullLiteral.create(It(Z.startPos-1,Z.endPos-1))),Ar();var Oe=wa();return ae.Assign.create(Ye(Z),B,Oe)}if(Z.getKind()===L.TokenKind.ELVIS){B===null&&(B=E.NullLiteral.create(It(Z.startPos-1,Z.endPos-2))),Ar();var $e=ze();return $e===null&&($e=E.NullLiteral.create(It(Z.startPos+1,Z.endPos+1))),ot.Elvis.create(Ye(Z),B,$e)}if(Z.getKind()===L.TokenKind.QMARK){B===null&&(B=E.NullLiteral.create(It(Z.startPos-1,Z.endPos-1))),Ar();var Ft=ze();$r(L.TokenKind.COLON);var st=ze();return fr.Ternary.create(Ye(Z),B,Ft,st)}}return B}function wa(){for(var B=pr();$t("or")||Wr(L.TokenKind.SYMBOLIC_OR);){var Z=Ar(),Oe=pr();Qn(Z,B,Oe),B=it.OpOr.create(Ye(Z),B,Oe)}return B}function pr(){for(var B=aa();$t("and")||Wr(L.TokenKind.SYMBOLIC_AND);){var Z=Ar(),Oe=aa();Qn(Z,B,Oe),B=Zr.OpAnd.create(Ye(Z),B,Oe)}return B}function aa(){var B=ri(),Z=En();if(Z!==null){var Oe=Ar(),$e=ri();Qn(Oe,B,$e);var Ft=Z.kind;if(Z.isNumericRelationalOperator()){var st=Ye(Oe);return Ft===L.TokenKind.GT?er.OpGT.create(st,B,$e):Ft===L.TokenKind.LT?Be.OpLT.create(st,B,$e):Ft===L.TokenKind.LE?nr.OpLE.create(st,B,$e):Ft===L.TokenKind.GE?Ne.OpGE.create(st,B,$e):Ft===L.TokenKind.EQ?Le.OpEQ.create(st,B,$e):re.OpNE.create(st,B,$e)}return Ft===L.TokenKind.INSTANCEOF?De.OpInstanceof.create(Ye(Oe),B,$e):Ft===L.TokenKind.MATCHES?Ur.OpMatches.create(Ye(Oe),B,$e):le.OpBetween.create(Ye(Oe),B,$e)}return B}function ri(){for(var B=xa();cn(L.TokenKind.PLUS,L.TokenKind.MINUS,L.TokenKind.INC);){var Z=Ar(),Oe=xa();Kn(Z,Oe),Z.getKind()===L.TokenKind.PLUS?B=Ge.OpPlus.create(Ye(Z),B,Oe):Z.getKind()===L.TokenKind.MINUS&&(B=O.OpMinus.create(Ye(Z),B,Oe))}return B}function xa(){for(var B=tt();cn(L.TokenKind.STAR,L.TokenKind.DIV,L.TokenKind.MOD);){var Z=Ar(),Oe=tt();Qn(Z,B,Oe),Z.getKind()===L.TokenKind.STAR?B=de.OpMultiply.create(Ye(Z),B,Oe):Z.getKind()===L.TokenKind.DIV?B=T.OpDivide.create(Ye(Z),B,Oe):B=Xe.OpModulus.create(Ye(Z),B,Oe)}return B}function tt(){var B=pt(),Z;if(Wr(L.TokenKind.POWER)){Z=Ar();var Oe=pt();return Kn(Z,Oe),Sr.OpPower.create(Ye(Z),B,Oe)}return B!==null&&cn(L.TokenKind.INC,L.TokenKind.DEC)?(Z=Ar(),Z.getKind()===L.TokenKind.INC?Je.OpInc.create(Ye(Z),!0,B):Qe.OpDec.create(Ye(Z),!0,B)):B}function pt(){var B,Z;return cn(L.TokenKind.PLUS,L.TokenKind.MINUS,L.TokenKind.NOT)?(B=Ar(),Z=pt(),B.getKind()===L.TokenKind.NOT?rr.OpNot.create(Ye(B),Z):B.getKind()===L.TokenKind.PLUS?Ge.OpPlus.create(Ye(B),Z):O.OpMinus.create(Ye(B),Z)):cn(L.TokenKind.INC,L.TokenKind.DEC)?(B=Ar(),Z=pt(),B.getKind()===L.TokenKind.INC?Je.OpInc.create(Ye(B),!1,Z):Qe.OpDec.create(Ye(B),!1,Z)):qi()}function qi(){var B=[],Z=Zi();for(B.push(Z);Ji();)B.push(Bt());return B.length===1?B[0]:X.CompoundExpression.create(It(Z.getStartPosition(),B[B.length-1].getEndPosition()),B)}function Ji(){var B=null;return cn(L.TokenKind.DOT,L.TokenKind.SAFE_NAVI)?B=un():B=Yi(),B===null?!1:(wr(B),!0)}function Yi(){return Wr(L.TokenKind.LSQUARE)&&Tn()?Bt():null}function un(){var B=Ar(),Z=B.getKind()===L.TokenKind.SAFE_NAVI;return Xt(Z)||Dt()||$n(Z)||ni(Z)?Bt():(jr()===null?ut(B.startPos,"OOD"):ut(B.startPos,"UNEXPECTED_DATA_AFTER_DOT",ar(jr())),null)}function Dt(){if(!Wr(L.TokenKind.HASH))return!1;var B=Ar(),Z=$r(L.TokenKind.IDENTIFIER),Oe=ja();return Oe===null?(wr(J.VariableReference.create(Z.data,It(B.startPos,Z.endPos))),!0):(wr(N.FunctionReference.create(Z.data,It(B.startPos,Z.endPos),Oe)),!0)}function ja(){if(!Wr(L.TokenKind.LPAREN))return null;var B=[];return ti(B),$r(L.TokenKind.RPAREN),B}function Xi(B){Wr(L.TokenKind.LPAREN)||ut(Ye(jr()),"MISSING_CONSTRUCTOR_ARGS"),ti(B),$r(L.TokenKind.RPAREN)}function ti(B){var Z=jr().startPos,Oe;do{Ar();var $e=jr();$e===null&&ut(Z,"RUN_OUT_OF_ARGUMENTS"),$e.getKind()!==L.TokenKind.RPAREN&&B.push(ze()),Oe=jr()}while(Oe!==null&&Oe.kind===L.TokenKind.COMMA);Oe===null&&ut(Z,"RUN_OUT_OF_ARGUMENTS")}function _l(B){return B===null?Bn.length:B.startPos}function Zi(){return Ra()||Ut()||ro()||to()||ao()||Xt(!1)||Dt()||eo()||$n(!1)||ni(!1)||Tn()||sn()?Bt():null}function eo(){if(Wr(L.TokenKind.BEAN_REF)){var B=Ar(),Z=null,Oe=null;Wr(L.TokenKind.IDENTIFIER)?(Z=$r(L.TokenKind.IDENTIFIER),Oe=Z.data):Wr(L.TokenKind.LITERAL_STRING)?(Z=$r(L.TokenKind.LITERAL_STRING),Oe=Z.stringValue(),Oe=Oe.substring(1,Oe.length()-1)):ut(B.startPos,"INVALID_BEAN_REFERENCE");var $e=Ae.BeanReference.create(Ye(Z),Oe);return wr($e),!0}return!1}function ro(){if(Wr(L.TokenKind.IDENTIFIER)){var B=jr();if(B.stringValue()!=="T")return!1;var Z=Ar();if(Wr(L.TokenKind.RSQUARE))return wr(W.PropertyReference.create(Z.stringValue(),Ye(Z))),!0;$r(L.TokenKind.LPAREN);for(var Oe=Ot(),$e=0;lt(L.TokenKind.LSQUARE,!0);)$r(L.TokenKind.RSQUARE),$e++;return $r(L.TokenKind.RPAREN),wr(pe.TypeReference.create(Ye(B),Oe,$e)),!0}return!1}function to(){if(Wr(L.TokenKind.IDENTIFIER)){var B=jr();return B.stringValue().toLowerCase()!=="null"?!1:(Ar(),wr(E.NullLiteral.create(Ye(B))),!0)}return!1}function $n(B){var Z=jr();if(!lt(L.TokenKind.PROJECT,!0))return!1;var Oe=ze();return $r(L.TokenKind.RSQUARE),wr(ke.Projection.create(B,Ye(Z),Oe)),!0}function sn(){var B=jr(),Z=[];if(!lt(L.TokenKind.LCURLY,!0))return!1;var Oe=null,$e=jr();if(lt(L.TokenKind.RCURLY,!0))Oe=he.InlineList.create(It(B.startPos,$e.endPos));else if(lt(L.TokenKind.COLON,!0))$e=$r(L.TokenKind.RCURLY),Oe=te.InlineMap.create(It(B.startPos,$e.endPos));else{var Ft=ze();if(Wr(L.TokenKind.RCURLY))Z.push(Ft),$e=$r(L.TokenKind.RCURLY),Oe=he.InlineList.create(It(B.startPos,$e.endPos),Z);else if(lt(L.TokenKind.COMMA,!0)){Z.push(Ft);do Z.push(ze());while(lt(L.TokenKind.COMMA,!0));$e=$r(L.TokenKind.RCURLY),Oe=he.InlineList.create(Ye(B.startPos,$e.endPos),Z)}else if(lt(L.TokenKind.COLON,!0)){var st=[];for(st.push(Ft),st.push(ze());lt(L.TokenKind.COMMA,!0);)st.push(ze()),$r(L.TokenKind.COLON),st.push(ze());$e=$r(L.TokenKind.RCURLY),Oe=te.InlineMap.create(It(B.startPos,$e.endPos),st)}else ut(B.startPos,"OOD")}return wr(Oe),!0}function Tn(){var B=jr();if(!lt(L.TokenKind.LSQUARE,!0))return!1;var Z=ze();return $r(L.TokenKind.RSQUARE),wr(q.Indexer.create(Ye(B),Z)),!0}function ni(B){var Z=jr();if(!Wn())return!1;Ar();var Oe=ze();return Oe===null&&ut(Ye(Z),"MISSING_SELECTION_EXPRESSION"),$r(L.TokenKind.RSQUARE),Z.getKind()===L.TokenKind.SELECT_FIRST?wr(fe.Selection.create(B,fe.Selection.FIRST,Ye(Z),Oe)):Z.getKind()===L.TokenKind.SELECT_LAST?wr(fe.Selection.create(B,fe.Selection.LAST,Ye(Z),Oe)):wr(fe.Selection.create(B,fe.Selection.ALL,Ye(Z),Oe)),!0}function Ot(){for(var B=[],Z=jr();no(Z);)Ar(),Z.kind!==L.TokenKind.DOT&&B.push(Ke.Identifier.create(Z.stringValue(),Ye(Z))),Z=jr();B.length||(Z===null&&ut(Bn.length(),"OOD"),ut(Z.startPos,"NOT_EXPECTED_TOKEN","qualified ID",Z.getKind().toString().toLowerCase()));var Oe=It(B[0].getStartPosition(),B[B.length-1].getEndPosition());return Rt.QualifiedIdentifier.create(Oe,B)}function no(B){if(B===null||B.kind===L.TokenKind.LITERAL_STRING)return!1;if(B.kind===L.TokenKind.DOT||B.kind===L.TokenKind.IDENTIFIER)return!0;var Z=B.stringValue();return Z&&Z.length&&ln.test(Z)}function Xt(B){if(Wr(L.TokenKind.IDENTIFIER)){var Z=Ar(),Oe=ja();return Oe===null?(wr(W.PropertyReference.create(B,Z.stringValue(),Ye(Z))),!0):(wr(j.MethodReference.create(B,Z.stringValue(),Ye(Z),Oe)),!0)}return!1}function ao(){if($t("new")){var B=Ar();if(Wr(L.TokenKind.RSQUARE))return wr(W.PropertyReference.create(B.stringValue(),Ye(B))),!0;var Z=Ot(),Oe=[];if(Oe.push(Z),Wr(L.TokenKind.LSQUARE)){for(var $e=[];lt(L.TokenKind.LSQUARE,!0);)Wr(L.TokenKind.RSQUARE)?$e.push(null):$e.push(ze()),$r(L.TokenKind.RSQUARE);sn()&&Oe.push(Bt()),wr(rt.ConstructorReference.create(Ye(B),$e,Oe))}else Xi(Oe),wr(rt.ConstructorReference.create(Ye(B),Oe));return!0}return!1}function wr(B){Fn.push(B)}function Bt(){return Fn.pop()}function Ra(){var B=jr();if(B===null)return!1;if(B.getKind()===L.TokenKind.LITERAL_INT||B.getKind()===L.TokenKind.LITERAL_LONG)wr(Q.NumberLiteral.create(parseInt(B.stringValue(),10),Ye(B)));else if(B.getKind()===L.TokenKind.LITERAL_REAL||B.getKind()===L.TokenKind.LITERAL_REAL_FLOAT)wr(Q.NumberLiteral.create(parseFloat(B.stringValue()),Ye(B)));else if(B.getKind()===L.TokenKind.LITERAL_HEXINT||B.getKind()===L.TokenKind.LITERAL_HEXLONG)wr(Q.NumberLiteral.create(parseInt(B.stringValue(),16),Ye(B)));else if($t("true"))wr($.BooleanLiteral.create(!0,Ye(B)));else if($t("false"))wr($.BooleanLiteral.create(!1,Ye(B)));else if(B.getKind()===L.TokenKind.LITERAL_STRING)wr(C.StringLiteral.create(B.stringValue(),Ye(B)));else return!1;return Ar(),!0}function Ut(){if(Wr(L.TokenKind.LPAREN)){Ar();var B=ze();return $r(L.TokenKind.RPAREN),wr(B),!0}else return!1}function En(){var B=jr();if(B===null)return null;if(B.isNumericRelationalOperator())return B;if(B.isIdentifier()){var Z=B.stringValue();if(Z.toLowerCase()==="instanceof")return B.asInstanceOfToken();if(Z.toLowerCase()==="matches")return B.asMatchesToken();if(Z.toLowerCase()==="between")return B.asBetweenToken()}return null}function $r(B){var Z=Ar();return Z===null&&ut(Bn.length,"OOD"),Z.getKind()!==B&&ut(Z.startPos,"NOT_EXPECTED_TOKEN",B.toString().toLowerCase(),Z.getKind().toString().toLowerCase()),Z}function Wr(B){return lt(B,!1)}function lt(B,Z){if(!dn())return!1;var Oe=jr();return Oe.getKind()===B?(Z&&St++,!0):B===L.TokenKind.IDENTIFIER&&Oe.getKind().ordinal()>=L.TokenKind.DIV.ordinal()&&Oe.getKind().ordinal()<=L.TokenKind.NOT.ordinal()&&Oe.data!==null}function cn(){if(!dn())return!1;for(var B=jr(),Z=Array.prototype.slice.call(arguments),Oe=0,$e=Z.length;Oe<$e;Oe+=1)if(B.getKind()===Z[Oe])return!0;return!1}function $t(B){if(!dn())return!1;var Z=jr();return Z.getKind()===L.TokenKind.IDENTIFIER&&Z.stringValue().toLowerCase()===B.toLowerCase()}function Wn(){if(!dn())return!1;var B=jr();return B.getKind()===L.TokenKind.SELECT||B.getKind()===L.TokenKind.SELECT_FIRST||B.getKind()===L.TokenKind.SELECT_LAST}function dn(){return St<Un.length}function Ar(){return St>=Aa?null:Un[St++]}function jr(){return St>=Aa?null:Un[St]}function ut(B,Z,Oe,$e){throw Oe&&(Z+=`
Expected: `+Oe),$e&&(Z+=`
Actual: `+$e),{name:"InternalParseException",message:"Error occurred while attempting to parse expression '"+Bn+"' at position "+B+". Message: "+Z}}function ar(B){return B.getKind().hasPayload()?B.stringValue():B.getKind().toString().toLowerCase()}function Qn(B,Z,Oe){bt(B,Z),Kn(B,Oe)}function bt(B,Z){Z===null&&ut(B.startPos,"LEFT_OPERAND_PROBLEM")}function Kn(B,Z){Z===null&&ut(B.startPos,"RIGHT_OPERAND_PROBLEM")}function Ye(B){return(B.startPos<<16)+B.endPos}function It(B,Z){return(B<<16)+Z}return{setConfiguration:hr,parse:La}}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.Tokenizer=void 0;var L=V(7),P=V(2),$=["DIV","EQ","GE","GT","LE","LT","MOD","NE","NOT"],Q=[],C=1,E=2,N=4;function j(){var X;for(X=48;X<=57;X+=1)Q[X]|=C|E;for(X=65;X<=70;X+=1)Q[X]|=E;for(X=97;X<=102;X+=1)Q[X]|=E;for(X=65;X<=90;X+=1)Q[X]|=N;for(X=97;X<=122;X+=1)Q[X]|=N}j();function W(X){var q=X,ae=X+"\0",Le=ae.length,re=0,Ne=[];function er(){for(var le;re<Le;)if(le=ae[re],ke(le))O();else switch(le){case"+":Je(P.TokenKind.INC)?rr(P.TokenKind.INC):Qe(P.TokenKind.PLUS);break;case"_":O();break;case"-":Je(P.TokenKind.DEC)?rr(P.TokenKind.DEC):Qe(P.TokenKind.MINUS);break;case":":Qe(P.TokenKind.COLON);break;case".":Qe(P.TokenKind.DOT);break;case",":Qe(P.TokenKind.COMMA);break;case"*":Qe(P.TokenKind.STAR);break;case"/":Qe(P.TokenKind.DIV);break;case"%":Qe(P.TokenKind.MOD);break;case"(":Qe(P.TokenKind.LPAREN);break;case")":Qe(P.TokenKind.RPAREN);break;case"[":Qe(P.TokenKind.LSQUARE);break;case"#":Qe(P.TokenKind.HASH);break;case"]":Qe(P.TokenKind.RSQUARE);break;case"{":Qe(P.TokenKind.LCURLY);break;case"}":Qe(P.TokenKind.RCURLY);break;case"@":Qe(P.TokenKind.BEAN_REF);break;case"^":Je(P.TokenKind.SELECT_FIRST)?rr(P.TokenKind.SELECT_FIRST):Qe(P.TokenKind.POWER);break;case"!":Je(P.TokenKind.NE)?rr(P.TokenKind.NE):Je(P.TokenKind.PROJECT)?rr(P.TokenKind.PROJECT):Qe(P.TokenKind.NOT);break;case"=":Je(P.TokenKind.EQ)?rr(P.TokenKind.EQ):Qe(P.TokenKind.ASSIGN);break;case"&":if(!Je(P.TokenKind.SYMBOLIC_AND))throw{name:"SpelParseException",message:"Missing character '&' in expression ("+q+") at position "+re};rr(P.TokenKind.SYMBOLIC_AND);break;case"|":if(!Je(P.TokenKind.SYMBOLIC_OR))throw{name:"SpelParseException",message:"Missing character '|' in expression ("+q+") at position "+re};rr(P.TokenKind.SYMBOLIC_OR);break;case"?":Je(P.TokenKind.SELECT)?rr(P.TokenKind.SELECT):Je(P.TokenKind.ELVIS)?rr(P.TokenKind.ELVIS):Je(P.TokenKind.SAFE_NAVI)?rr(P.TokenKind.SAFE_NAVI):Qe(P.TokenKind.QMARK);break;case"$":Je(P.TokenKind.SELECT_LAST)?rr(P.TokenKind.SELECT_LAST):O();break;case">":Je(P.TokenKind.GE)?rr(P.TokenKind.GE):Qe(P.TokenKind.GT);break;case"<":Je(P.TokenKind.LE)?rr(P.TokenKind.LE):Qe(P.TokenKind.LT);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":Ge(le==="0");break;case" ":case"	":case"\r":case`
`:re+=1;break;case"'":nr();break;case'"':Be();break;case"\0":re+=1;break;case"\\":throw{name:"SpelParseException",message:"Unexpected escape character in expression ("+q+") at position "+re};default:throw{name:"SpelParseException",message:"Cannot handle character '"+le+"' in expression ("+q+") at position "+re}}}function nr(){for(var le=re,pe=!1,Ae;!pe;)if(re+=1,Ae=ae[re],Ae==="'"&&(ae[re+1]==="'"?re+=1:pe=!0),Ae.charCodeAt(0)===0)throw{name:"SpelParseException",message:"Non-terminating quoted string in expression ("+q+") at position "+re};re+=1,Ne.push(new L.Token(P.TokenKind.LITERAL_STRING,Sr(le,re),le,re))}function Be(){for(var le=re,pe=!1,Ae;!pe;)if(re+=1,Ae=ae[re],Ae==='"'&&(ae[re+1]==='"'?re+=1:pe=!0),Ae.charCodeAt(0)===0)throw{name:"SpelParseException",message:"Non-terminating double-quoted string in expression ("+q+") at position "+re};re+=1,Ne.push(new L.Token(P.TokenKind.LITERAL_STRING,Sr(le,re),le,re))}function Ge(le){var pe=!1,Ae=re,Ke=ae[re+1],Rt=Ke==="x"||Ke==="X",rt,Mr,bn,ln;if(le&&Rt){re=re+1;do re+=1;while(De(ae[re]));Ur("L","l")?(T(Sr(Ae+2,re),!0,Ae,re),re+=1):T(Sr(Ae+2,re),!1,Ae,re);return}do re+=1;while(fe(ae[re]));if(Ke=ae[re],Ke==="."){pe=!0,rt=re;do re+=1;while(fe(ae[re]));if(re===rt+1){re=rt,de(Sr(Ae,re),!1,Ae,re);return}}if(Mr=re,Ur("L","l")){if(pe)throw{name:"SpelParseException",message:"Real cannot be long in expression ("+q+") at position "+re};de(Sr(Ae,Mr),!0,Ae,Mr),re+=1}else if(fr(ae[re])){pe=!0,re+=1,bn=ae[re],te(bn)&&(re+=1);do re+=1;while(fe(ae[re]));ln=!1,ot(ae[re])?(ln=!0,re+=1,Mr=re):he(ae[re])&&(re+=1,Mr=re),Xe(Sr(Ae,re),ln,Ae,re)}else Ke=ae[re],ln=!1,ot(Ke)?(pe=!0,ln=!0,re+=1,Mr=re):he(Ke)&&(pe=!0,re+=1,Mr=re),pe?Xe(Sr(Ae,Mr),ln,Ae,Mr):de(Sr(Ae,Mr),!1,Ae,Mr)}function O(){var le=re,pe,Ae,Ke;do re+=1;while(it(ae[re]));if(pe=Sr(le,re),(re-le===2||re-le===3)&&(Ae=pe.toUpperCase(),Ke=$.indexOf(Ae),Ke>=0)){Zr(P.TokenKind.valueOf(Ae),le,pe);return}Ne.push(new L.Token(P.TokenKind.IDENTIFIER,pe.replace("\0",""),le,re))}function de(le,pe,Ae,Ke){pe?Ne.push(new L.Token(P.TokenKind.LITERAL_LONG,le,Ae,Ke)):Ne.push(new L.Token(P.TokenKind.LITERAL_INT,le,Ae,Ke))}function T(le,pe,Ae,Ke){if(le.length===0)throw pe?{name:"SpelParseException",message:"Not a long in expression ("+q+") at position "+re}:{name:"SpelParseException",message:"Not an int in expression ("+q+") at position "+re};pe?Ne.push(new L.Token(P.TokenKind.LITERAL_HEXLONG,le,Ae,Ke)):Ne.push(new L.Token(P.TokenKind.LITERAL_HEXINT,le,Ae,Ke))}function Xe(le,pe,Ae,Ke){pe?Ne.push(new L.Token(P.TokenKind.LITERAL_REAL_FLOAT,le,Ae,Ke)):Ne.push(new L.Token(P.TokenKind.LITERAL_REAL,le,Ae,Ke))}function Sr(le,pe){return ae.substring(le,pe)}function Je(le){return le.tokenChars.length===2&&ae[re]===le.tokenChars[0]?ae[re+1]===le.tokenChars[1]:!1}function Qe(le){Ne.push(new L.Token(le,null,re,re+1)),re+=1}function rr(le){Ne.push(new L.Token(le,null,re,re+2)),re+=2}function Zr(le,pe,Ae){Ne.push(new L.Token(le,Ae,pe,pe+le.getLength()))}function it(le){return ke(le)||fe(le)||le==="_"||le==="$"}function Ur(le,pe){var Ae=ae[re];return Ae===le||Ae===pe}function fr(le){return le==="e"||le==="E"}function ot(le){return le==="f"||le==="F"}function he(le){return le==="d"||le==="D"}function te(le){return le==="+"||le==="-"}function fe(le){return le.charCodeAt(0)>255?!1:(Q[le.charCodeAt(0)]&C)!==0}function ke(le){return le.charCodeAt(0)>255?!1:(Q[le.charCodeAt(0)]&N)!==0}function De(le){return le.charCodeAt(0)>255?!1:(Q[le.charCodeAt(0)]&E)!==0}return er(),Ne}var J=h.Tokenizer={tokenize:W}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.Token=void 0;var L=V(2);function P($,Q,C,E){this.kind=$,this.startPos=C,this.endPos=E,Q&&(this.data=Q)}P.prototype.getKind=function(){return this.kind},P.prototype.toString=function(){var $="[";return $+=this.kind.toString(),this.kind.hasPayload()&&($+=":"+this.data),$+="]",$+="("+this.startPos+","+this.endPos+")",$},P.prototype.isIdentifier=function(){return this.kind===L.TokenKind.IDENTIFIER},P.prototype.isNumericRelationalOperator=function(){return this.kind===L.TokenKind.GT||this.kind===L.TokenKind.GE||this.kind===L.TokenKind.LT||this.kind===L.TokenKind.LE||this.kind===L.TokenKind.EQ||this.kind===L.TokenKind.NE},P.prototype.stringValue=function(){return this.data},P.prototype.asInstanceOfToken=function(){return new P(L.TokenKind.INSTANCEOF,this.startPos,this.endPos)},P.prototype.asMatchesToken=function(){return new P(L.TokenKind.MATCHES,this.startPos,this.endPos)},P.prototype.asBetweenToken=function(){return new P(L.TokenKind.BETWEEN,this.startPos,this.endPos)},P.prototype.getStartPosition=function(){return this.startPos},P.prototype.getEndPosition=function(){return this.endPos},h.Token=P},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.BooleanLiteral=void 0;var L=V(0);function P(Q,C){var E=L.SpelNode.create("boolean",C);return E.getValue=function(){return Q},E.setValue=function(N){return Q=N},E}var $=h.BooleanLiteral={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.NumberLiteral=void 0;var L=V(0);function P(Q,C){var E=L.SpelNode.create("number",C);return E.getValue=function(){return Q},E.setValue=function(N){return Q=N},E}var $=h.NumberLiteral={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.StringLiteral=void 0;var L=V(0);function P(Q,C){var E=L.SpelNode.create("string",C);function N(j){return(j[0]==="'"&&j[j.length-1]==="'"||j[0]==='"'&&j[j.length-1]==='"')&&(j=j.substring(1,j.length-1)),j.replace(/''/g,"'").replace(/""/g,'"')}return Q=N(Q),E.getValue=function(){return Q},E.setValue=function(j){return Q=j},E}var $=h.StringLiteral={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.NullLiteral=void 0;var L=V(0);function P(Q,C){var E=L.SpelNode.create("null",C);return E.getValue=function(){return null},E}var $=h.NullLiteral={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.FunctionReference=void 0;var L=V(0),P=V(1);function $(C,E,N){var j=L.SpelNode.create("function",E);return j.getRaw=function(){return{functionName:C,args:N}},j.getValue=function(W){var J=W.locals||{},X=W.rootContext,q=[];if(N.forEach(function(ae){var Le=W.activeContext;W.activeContext=new P.Stack,W.activeContext.push(W.rootContext),q.push(ae.getValue(W)),W.activeContext=Le}),J[C])return J[C].apply(X,q);throw{name:"FunctionDoesNotExistException",message:"Function '"+C+"' does not exist."}},j}var Q=h.FunctionReference={create:$}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.MethodReference=void 0;var L=V(0),P=V(1);function $(C,E,N,j){var W=L.SpelNode.create("method",N);return W.getRaw=function(){return{methodName:E,args:j}},W.getValue=function(J){var X=J.activeContext.peek(),q=[],ae;if(!X)throw{name:"ContextDoesNotExistException",message:"Attempting to look up property '"+E+"' for an undefined context."};function Le(re){if(re==null){if(C)return null;throw{name:"NullPointerException",message:"Method "+E+" does not exist."}}return re}if(j.forEach(function(re){var Ne=J.activeContext;J.activeContext=new P.Stack,J.activeContext.push(J.rootContext),q.push(re.getValue(J)),J.activeContext=Ne}),E.substr(0,3)==="get"&&!X[E])return Le(X[E.charAt(3).toLowerCase()+E.substring(4)]);if(E.substr(0,3)==="set"&&!X[E])return X[E.charAt(3).toLowerCase()+E.substring(4)]=q[0];if(Array.isArray(X)){if(E==="size")return X.length;if(E==="contains")return X.includes(q[0])}return ae=Le(X[E]),ae?ae.apply(X,q):null},W}var Q=h.MethodReference={create:$}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.PropertyReference=void 0;var L=V(0);function P(Q,C,E){var N=L.SpelNode.create("property",E);return N.getRaw=function(){return C},N.getValue=function(j){var W=j.activeContext.peek();if(!W){if(Q)return null;throw{name:"ContextDoesNotExistException",message:"Attempting to look up property '"+C+"' for an undefined context."}}if(W[C]===void 0||W[C]===null){if(Q)return null;if(C==="size"&&Array.isArray(W))return W.length;throw{name:"NullPointerException",message:"Property '"+C+"' does not exist."}}return W[C]},N.setValue=function(j,W){var J=W.activeContext.peek();if(!J)throw{name:"ContextDoesNotExistException",message:"Attempting to assign property '"+C+"' for an undefined context."};return J[C]=j},N.getName=function(){return C},N}var $=h.PropertyReference={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.VariableReference=void 0;var L=V(0);function P(Q,C){var E=L.SpelNode.create("variable",C);return E.getRaw=function(){return Q},E.getValue=function(N){var j=N.activeContext.peek(),W=N.locals;if(!j)throw{name:"ContextDoesNotExistException",message:"Attempting to look up variable '"+Q+"' for an undefined context."};return Q==="this"?j:Q==="root"?N.rootContext:W[Q]},E.setValue=function(N,j){var W=j.locals;return W[Q]=N},E}var $=h.VariableReference={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.CompoundExpression=void 0;var L=V(0);function P(Q,C){var E=L.SpelNode.create.apply(null,["compound",Q].concat(C));function N(j){var W=E.getChildren().length,J;for(J=0;J<W;J+=1)E.getChildren()[J].getType()==="indexer"?j.activeContext.push(j.activeContext.peek()[E.getChildren()[J].getValue(j)]):j.activeContext.push(E.getChildren()[J].getValue(j));return function(){for(J=0;J<W;J+=1)j.activeContext.pop()}}return E.getValue=function(j){var W=j.activeContext.peek(),J;if(!W)throw{name:"ContextDoesNotExistException",message:"Attempting to evaluate compound expression with an undefined context."};var X=N(j);return J=j.activeContext.peek(),X(),J},E.setValue=function(j,W){var J=N(W),X=E.getChildren().length;return W.activeContext.pop(),j=E.getChildren()[X-1].setValue(j,W),W.activeContext.push(null),J(),j},E}var $=h.CompoundExpression={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.Indexer=void 0;var L=V(0),P=V(1);function $(C,E){var N=L.SpelNode.create.apply(null,["indexer",C].concat(E));return N.getValue=function(j){var W=j.activeContext,J,X=N.getChildren().length,q,ae;if(j.activeContext=new P.Stack,j.activeContext.push(j.rootContext),J=j.activeContext.peek(),!J)throw{name:"ContextDoesNotExistException",message:"Attempting to evaluate compound expression with an undefined context."};for(q=0;q<X;q+=1)j.activeContext.push(N.getChildren()[q].getValue(j));for(ae=j.activeContext.peek(),q=0;q<X;q+=1)j.activeContext.pop();return j.activeContext=W,ae},N}var Q=h.Indexer={create:$}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.Assign=void 0;var L=V(0);function P(Q,C,E){var N=L.SpelNode.create("assign",Q,C,E);return N.getValue=function(j){var W=j.activeContext.peek();if(!W)throw{name:"ContextDoesNotExistException",message:"Attempting to assign property '"+C.getValue(j)+"' for an undefined context."};return C.setValue(E.getValue(j),j)},N}var $=h.Assign={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.OpEQ=void 0;var L=V(0);function P(Q,C,E){var N=L.SpelNode.create("op-eq",Q,C,E);return N.getValue=function(j){return C.getValue(j)===E.getValue(j)},N}var $=h.OpEQ={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.OpNE=void 0;var L=V(0);function P(Q,C,E){var N=L.SpelNode.create("op-ne",Q,C,E);return N.getValue=function(j){return C.getValue(j)!==E.getValue(j)},N}var $=h.OpNE={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.OpGE=void 0;var L=V(0);function P(Q,C,E){var N=L.SpelNode.create("op-ge",Q,C,E);return N.getValue=function(j){return C.getValue(j)>=E.getValue(j)},N}var $=h.OpGE={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.OpGT=void 0;var L=V(0);function P(Q,C,E){var N=L.SpelNode.create("op-gt",Q,C,E);return N.getValue=function(j){return C.getValue(j)>E.getValue(j)},N}var $=h.OpGT={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.OpLE=void 0;var L=V(0);function P(Q,C,E){var N=L.SpelNode.create("op-le",Q,C,E);return N.getValue=function(j){return C.getValue(j)<=E.getValue(j)},N}var $=h.OpLE={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.OpLT=void 0;var L=V(0);function P(Q,C,E){var N=L.SpelNode.create("op-lt",Q,C,E);return N.getValue=function(j){return C.getValue(j)<E.getValue(j)},N}var $=h.OpLT={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.OpPlus=void 0;var L=V(0);function P(Q,C,E){var N=L.SpelNode.create("op-plus",Q,C,E);return N.getValue=function(j){return E?C.getValue(j)+E.getValue(j):+C.getValue(j)},N}var $=h.OpPlus={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.OpMinus=void 0;var L=V(0);function P(Q,C,E){var N=L.SpelNode.create("op-minus",Q,C,E);return N.getValue=function(j){return E?C.getValue(j)-E.getValue(j):-C.getValue(j)},N}var $=h.OpMinus={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.OpMultiply=void 0;var L=V(0);function P(Q,C,E){var N=L.SpelNode.create("op-multiply",Q,C,E);return N.getValue=function(j){var W=C.getValue(j),J=E.getValue(j);if(typeof W=="number"&&typeof J=="number")return W*J;if(typeof W=="string"&&typeof J=="number"){for(var X="",q=0;q<J;q+=1)X+=W;return X}return null},N}var $=h.OpMultiply={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.OpDivide=void 0;var L=V(0);function P(Q,C,E){var N=L.SpelNode.create("op-divide",Q,C,E);return N.getValue=function(j){return C.getValue(j)/E.getValue(j)},N}var $=h.OpDivide={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.OpModulus=void 0;var L=V(0);function P(Q,C,E){var N=L.SpelNode.create("op-modulus",Q,C,E);return N.getValue=function(j){return C.getValue(j)%E.getValue(j)},N}var $=h.OpModulus={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.OpPower=void 0;var L=V(0);function P(Q,C,E){var N=L.SpelNode.create("op-power",Q,C,E);return N.getValue=function(j){return Math.pow(C.getValue(j),E.getValue(j))},N}var $=h.OpPower={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.OpInc=void 0;var L=V(0);function P(Q,C,E){var N=L.SpelNode.create("op-inc",Q,E);return N.getValue=function(j){var W=E.getValue(j);return E.setValue(W+1,j),C?W:W+1},N}var $=h.OpInc={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.OpDec=void 0;var L=V(0);function P(Q,C,E){var N=L.SpelNode.create("op-dec",Q,E);return N.getValue=function(j){var W=E.getValue(j);return E.setValue(W-1,j),C?W:W-1},N}var $=h.OpDec={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.OpNot=void 0;var L=V(0);function P(Q,C){var E=L.SpelNode.create("op-not",Q,C);return E.getValue=function(N){return!C.getValue(N)},E}var $=h.OpNot={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.OpAnd=void 0;var L=V(0);function P(Q,C,E){var N=L.SpelNode.create("op-and",Q,C,E);return N.getValue=function(j){return!!C.getValue(j)&&!!E.getValue(j)},N}var $=h.OpAnd={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.OpOr=void 0;var L=V(0);function P(Q,C,E){var N=L.SpelNode.create("op-or",Q,C,E);return N.getValue=function(j){return!!C.getValue(j)||!!E.getValue(j)},N}var $=h.OpOr={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.OpMatches=void 0;var L=V(0);function P(Q,C,E){var N=L.SpelNode.create("matches",Q,C,E);return N.getValue=function(j){var W=C.getValue(j),J=E.getValue(j);try{var X=new RegExp(J);return!!X.exec(W)}catch(q){throw{name:"EvaluationException",message:q.toString()}}},N}var $=h.OpMatches={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.Ternary=void 0;var L=V(0);function P(Q,C,E,N){var j=L.SpelNode.create("ternary",Q,C,E,N);return j.getValue=function(W){return C.getValue(W)?E.getValue(W):N.getValue(W)},j}var $=h.Ternary={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.Elvis=void 0;var L=V(0);function P(Q,C,E){var N=L.SpelNode.create("elvis",Q,C,E);return N.getValue=function(j){return C.getValue(j)!==null?C.getValue(j):E.getValue(j)},N}var $=h.Elvis={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.InlineList=void 0;var L=V(0);function P(Q,C){var E=L.SpelNode.create("list",Q),N=[].concat(C||[]);return E.getRaw=function(){return N},E.getValue=function(j){return N.map(function(W){return W.getValue(j)})},E}var $=h.InlineList={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.InlineMap=void 0;var L=V(0);function P(Q,C){var E=L.SpelNode.create("map",Q),N=[].concat(C||[]);return E.getValue=function(j){var W=!0,J=null,X={};return N.forEach(function(q){W?q.getType()==="property"?J=q.getName():J=q.getValue(j):X[J]=q.getValue(j),W=!W}),X},E}var $=h.InlineMap={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.Selection=void 0;var L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(j){return typeof j}:function(j){return j&&typeof Symbol=="function"&&j.constructor===Symbol&&j!==Symbol.prototype?"symbol":typeof j},P=V(0);function $(j,W,J){var X=!1;return J.activeContext.push(j),X=W.getValue(J),J.activeContext.pop(),X}function Q(j,W,J,X){var q=j.filter(function(ae){return $(ae,J,X)});switch(W){case"ALL":return q;case"FIRST":return q[0]||null;case"LAST":return q.length?q[q.length-1]:null}}function C(j,W,J,X){var q={},ae,Le,re=[],Ne={};for(Le in j)j.hasOwnProperty(Le)&&(ae={key:Le,value:j[Le]},$(ae,J,X)&&re.push(ae));switch(W){case"ALL":return re.forEach(function(er){q[er.key]=er.value}),q;case"FIRST":return re.length?(Ne[re[0].key]=re[0].value,Ne):null;case"LAST":return re.length?(Ne[re[re.length-1].key]=re[re.length-1].value,Ne):null}re.forEach(function(er){q[er.key]=er.value})}function E(j,W,J,X){var q=P.SpelNode.create("selection",J,X);return q.getValue=function(ae){var Le=ae.activeContext.peek();if(Le){if(Array.isArray(Le))return Q(Le,W,X,ae);if((typeof Le>"u"?"undefined":L(Le))==="object")return C(Le,W,X,ae)}return null},q}var N=h.Selection={create:E,FIRST:"FIRST",LAST:"LAST",ALL:"ALL"}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.Projection=void 0;var L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},P=V(0);function $(E,N,j){return E.map(function(W){var J;return j.activeContext.push(W),J=N.getValue(j),j.activeContext.pop(),J})}function Q(E,N,j){var W=P.SpelNode.create("projection",N,j);return W.getValue=function(J){var X=J.activeContext.peek(),q=[],ae;if(Array.isArray(X))return $(X,j,J);if((typeof X>"u"?"undefined":L(X))==="object"){for(ae in X)X.hasOwnProperty(ae)&&q.push(X[ae]);return $(q,j,J)}return null},W}var C=h.Projection={create:Q}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.OpInstanceof=void 0;var L=V(0);function P(Q,C,E){var N=L.SpelNode.create("instanceof",Q,C,E);return N.getValue=function(j){throw{name:"MethodNotImplementedException",message:"OpInstanceOf: Not implemented"}},N}var $=h.OpInstanceof={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.OpBetween=void 0;var L=V(0);function P(Q,C,E){var N=L.SpelNode.create("between",Q,C,E);return N.getValue=function(j){throw{name:"MethodNotImplementedException",message:"OpBetween: Not implemented"}},N}var $=h.OpBetween={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.TypeReference=void 0;var L=V(0);function P(Q,N,E){var N=L.SpelNode.create("typeref",Q,N);return N.getValue=function(j){throw{name:"MethodNotImplementedException",message:"TypeReference: Not implemented"}},N}var $=h.TypeReference={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.BeanReference=void 0;var L=V(0);function P(Q,C){var E=L.SpelNode.create("beanref",Q);return E.getValue=function(N){throw{name:"MethodNotImplementedException",message:"BeanReference: Not implemented"}},E}var $=h.BeanReference={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.Identifier=void 0;var L=V(0);function P(Q,C){var E=L.SpelNode.create("identifier",C);return E.getRaw=function(){return Q},E.getValue=function(N){throw{name:"MethodNotImplementedException",message:"Identifier: Not implemented"}},E}var $=h.Identifier={create:P}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.QualifiedIdentifier=void 0;var L=V(0);function P(C){if(Array.isArray(C)){for(var E=0,N=Array(C.length);E<C.length;E++)N[E]=C[E];return N}else return Array.from(C)}function $(C,E){var N=L.SpelNode.create.apply(L.SpelNode,["qualifiedidentifier",C].concat(P(E)));return N.getRaw=function(){return E.map(function(j){return j.getRaw()})},N.getValue=function(j){throw{name:"MethodNotImplementedException",message:"QualifiedIdentifier: Not implemented"}},N}var Q=h.QualifiedIdentifier={create:$}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.ConstructorReference=void 0;var L=V(0),P=V(1);function $(N){if(Array.isArray(N)){for(var j=0,W=Array(N.length);j<N.length;j++)W[j]=N[j];return W}else return Array.from(N)}function Q(N){return Array.isArray(N)?N:Array.from(N)}function C(N,j,W){var J=W!==void 0,X;J?X=j.length&&j[0]&&j[0].getType()==="number"?j[0].getValue():null:(W=j,j=void 0);var q=W,ae=Q(q),Le=ae[0],re=ae.slice(1),Ne=L.SpelNode.create.apply(L.SpelNode,["constructorref",N].concat($(W)));return Ne.getRaw=function(){return X},Ne.getValue=function(er){if(J&&re.length<=1){var nr=[];return re.forEach(function(Be){var Ge=er.activeContext;er.activeContext=new P.Stack,er.activeContext.push(er.rootContext),nr.push(Be.getValue(er)),er.activeContext=Ge}),re.length===1?nr[0]:X?new Array(X):[]}throw{name:"MethodNotImplementedException",message:"ConstructorReference: Not implemented"}},Ne}var E=h.ConstructorReference={create:C}},function(ve,h,V){"use strict";Object.defineProperty(h,"__esModule",{value:!0});function L($,Q){var C={};return C.authentication=$||{},C.principal=Q||{},C.hasRole=function(E){var N=!1;return!E||!C.authentication&&!Array.isArray(C.authentication.authorities)?!1:(C.authentication.authorities.forEach(function(j){j.authority.toLowerCase()===E.toLowerCase()&&(N=!0)}),N)},C.hasPermission=function(){var E=Array.prototype.slice.call(arguments);if(E.length===1)return C.hasRole(E[0])},C}var P=h.StandardContext={create:L}}])})},61526:(Pe,ve,h)=>{Pe.exports=h(88319)},88319:(Pe,ve,h)=>{var V=h(48287).Buffer,L=ve,P=/`/g,$=/\./g,Q=/[\0\b\t\n\r\x1a\"\'\\]/g,C={"\0":"\\0","\b":"\\b","	":"\\t","\n":"\\n","\r":"\\r","":"\\Z",'"':'\\"',"'":"\\'","\\":"\\\\"};L.escapeId=function(J,X){if(Array.isArray(J)){for(var q="",ae=0;ae<J.length;ae++)q+=(ae===0?"":", ")+L.escapeId(J[ae],X);return q}else return X?"`"+String(J).replace(P,"``")+"`":"`"+String(J).replace(P,"``").replace($,"`.`")+"`"},L.escape=function(J,X,q){if(J==null)return"NULL";switch(typeof J){case"boolean":return J?"true":"false";case"number":return J+"";case"object":return Object.prototype.toString.call(J)==="[object Date]"?L.dateToString(J,q||"local"):Array.isArray(J)?L.arrayToList(J,q):V.isBuffer(J)?L.bufferToString(J):typeof J.toSqlString=="function"?String(J.toSqlString()):X?E(J.toString()):L.objectToValues(J,q);default:return E(J)}},L.arrayToList=function(J,X){for(var q="",ae=0;ae<J.length;ae++){var Le=J[ae];Array.isArray(Le)?q+=(ae===0?"":", ")+"("+L.arrayToList(Le,X)+")":q+=(ae===0?"":", ")+L.escape(Le,!0,X)}return q},L.format=function(J,X,q,ae){if(X==null)return J;Array.isArray(X)||(X=[X]);for(var Le=0,re=/\?+/g,Ne="",er=0,nr;er<X.length&&(nr=re.exec(J));){var Be=nr[0].length;if(!(Be>2)){var Ge=Be===2?L.escapeId(X[er]):L.escape(X[er],q,ae);Ne+=J.slice(Le,nr.index)+Ge,Le=re.lastIndex,er++}}return Le===0?J:Le<J.length?Ne+J.slice(Le):Ne},L.dateToString=function(J,X){var q=new Date(J);if(isNaN(q.getTime()))return"NULL";var ae,Le,re,Ne,er,nr,Be;if(X==="local")ae=q.getFullYear(),Le=q.getMonth()+1,re=q.getDate(),Ne=q.getHours(),er=q.getMinutes(),nr=q.getSeconds(),Be=q.getMilliseconds();else{var Ge=j(X);Ge!==!1&&Ge!==0&&q.setTime(q.getTime()+Ge*6e4),ae=q.getUTCFullYear(),Le=q.getUTCMonth()+1,re=q.getUTCDate(),Ne=q.getUTCHours(),er=q.getUTCMinutes(),nr=q.getUTCSeconds(),Be=q.getUTCMilliseconds()}var O=N(ae,4)+"-"+N(Le,2)+"-"+N(re,2)+" "+N(Ne,2)+":"+N(er,2)+":"+N(nr,2)+"."+N(Be,3);return E(O)},L.bufferToString=function(J){return"X"+E(J.toString("hex"))},L.objectToValues=function(J,X){var q="";for(var ae in J){var Le=J[ae];typeof Le!="function"&&(q+=(q.length===0?"":", ")+L.escapeId(ae)+" = "+L.escape(Le,!0,X))}return q},L.raw=function(J){if(typeof J!="string")throw new TypeError("argument sql must be a string");return{toSqlString:function(){return J}}};function E(W){for(var J=Q.lastIndex=0,X="",q;q=Q.exec(W);)X+=W.slice(J,q.index)+C[q[0]],J=Q.lastIndex;return J===0?"'"+W+"'":J<W.length?"'"+X+W.slice(J)+"'":"'"+X+"'"}function N(W,J){for(W=W.toString();W.length<J;)W="0"+W;return W}function j(W){if(W==="Z")return 0;var J=W.match(/([\+\-\s])(\d\d):?(\d\d)?/);return J?(J[1]==="-"?-1:1)*(parseInt(J[2],10)+(J[3]?parseInt(J[3],10):0)/60)*60:!1}},4633:(Pe,ve,h)=>{var V=h(73738).default;function L(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Pe.exports=L=function(){return $},Pe.exports.__esModule=!0,Pe.exports.default=Pe.exports;var P,$={},Q=Object.prototype,C=Q.hasOwnProperty,E=Object.defineProperty||function(he,te,fe){he[te]=fe.value},N=typeof Symbol=="function"?Symbol:{},j=N.iterator||"@@iterator",W=N.asyncIterator||"@@asyncIterator",J=N.toStringTag||"@@toStringTag";function X(he,te,fe){return Object.defineProperty(he,te,{value:fe,enumerable:!0,configurable:!0,writable:!0}),he[te]}try{X({},"")}catch{X=function(fe,ke,De){return fe[ke]=De}}function q(he,te,fe,ke){var De=te&&te.prototype instanceof Be?te:Be,le=Object.create(De.prototype),pe=new fr(ke||[]);return E(le,"_invoke",{value:rr(he,fe,pe)}),le}function ae(he,te,fe){try{return{type:"normal",arg:he.call(te,fe)}}catch(ke){return{type:"throw",arg:ke}}}$.wrap=q;var Le="suspendedStart",re="suspendedYield",Ne="executing",er="completed",nr={};function Be(){}function Ge(){}function O(){}var de={};X(de,j,function(){return this});var T=Object.getPrototypeOf,Xe=T&&T(T(ot([])));Xe&&Xe!==Q&&C.call(Xe,j)&&(de=Xe);var Sr=O.prototype=Be.prototype=Object.create(de);function Je(he){["next","throw","return"].forEach(function(te){X(he,te,function(fe){return this._invoke(te,fe)})})}function Qe(he,te){function fe(De,le,pe,Ae){var Ke=ae(he[De],he,le);if(Ke.type!=="throw"){var Rt=Ke.arg,rt=Rt.value;return rt&&V(rt)=="object"&&C.call(rt,"__await")?te.resolve(rt.__await).then(function(Mr){fe("next",Mr,pe,Ae)},function(Mr){fe("throw",Mr,pe,Ae)}):te.resolve(rt).then(function(Mr){Rt.value=Mr,pe(Rt)},function(Mr){return fe("throw",Mr,pe,Ae)})}Ae(Ke.arg)}var ke;E(this,"_invoke",{value:function(le,pe){function Ae(){return new te(function(Ke,Rt){fe(le,pe,Ke,Rt)})}return ke=ke?ke.then(Ae,Ae):Ae()}})}function rr(he,te,fe){var ke=Le;return function(De,le){if(ke===Ne)throw Error("Generator is already running");if(ke===er){if(De==="throw")throw le;return{value:P,done:!0}}for(fe.method=De,fe.arg=le;;){var pe=fe.delegate;if(pe){var Ae=Zr(pe,fe);if(Ae){if(Ae===nr)continue;return Ae}}if(fe.method==="next")fe.sent=fe._sent=fe.arg;else if(fe.method==="throw"){if(ke===Le)throw ke=er,fe.arg;fe.dispatchException(fe.arg)}else fe.method==="return"&&fe.abrupt("return",fe.arg);ke=Ne;var Ke=ae(he,te,fe);if(Ke.type==="normal"){if(ke=fe.done?er:re,Ke.arg===nr)continue;return{value:Ke.arg,done:fe.done}}Ke.type==="throw"&&(ke=er,fe.method="throw",fe.arg=Ke.arg)}}}function Zr(he,te){var fe=te.method,ke=he.iterator[fe];if(ke===P)return te.delegate=null,fe==="throw"&&he.iterator.return&&(te.method="return",te.arg=P,Zr(he,te),te.method==="throw")||fe!=="return"&&(te.method="throw",te.arg=new TypeError("The iterator does not provide a '"+fe+"' method")),nr;var De=ae(ke,he.iterator,te.arg);if(De.type==="throw")return te.method="throw",te.arg=De.arg,te.delegate=null,nr;var le=De.arg;return le?le.done?(te[he.resultName]=le.value,te.next=he.nextLoc,te.method!=="return"&&(te.method="next",te.arg=P),te.delegate=null,nr):le:(te.method="throw",te.arg=new TypeError("iterator result is not an object"),te.delegate=null,nr)}function it(he){var te={tryLoc:he[0]};1 in he&&(te.catchLoc=he[1]),2 in he&&(te.finallyLoc=he[2],te.afterLoc=he[3]),this.tryEntries.push(te)}function Ur(he){var te=he.completion||{};te.type="normal",delete te.arg,he.completion=te}function fr(he){this.tryEntries=[{tryLoc:"root"}],he.forEach(it,this),this.reset(!0)}function ot(he){if(he||he===""){var te=he[j];if(te)return te.call(he);if(typeof he.next=="function")return he;if(!isNaN(he.length)){var fe=-1,ke=function De(){for(;++fe<he.length;)if(C.call(he,fe))return De.value=he[fe],De.done=!1,De;return De.value=P,De.done=!0,De};return ke.next=ke}}throw new TypeError(V(he)+" is not iterable")}return Ge.prototype=O,E(Sr,"constructor",{value:O,configurable:!0}),E(O,"constructor",{value:Ge,configurable:!0}),Ge.displayName=X(O,J,"GeneratorFunction"),$.isGeneratorFunction=function(he){var te=typeof he=="function"&&he.constructor;return!!te&&(te===Ge||(te.displayName||te.name)==="GeneratorFunction")},$.mark=function(he){return Object.setPrototypeOf?Object.setPrototypeOf(he,O):(he.__proto__=O,X(he,J,"GeneratorFunction")),he.prototype=Object.create(Sr),he},$.awrap=function(he){return{__await:he}},Je(Qe.prototype),X(Qe.prototype,W,function(){return this}),$.AsyncIterator=Qe,$.async=function(he,te,fe,ke,De){De===void 0&&(De=Promise);var le=new Qe(q(he,te,fe,ke),De);return $.isGeneratorFunction(te)?le:le.next().then(function(pe){return pe.done?pe.value:le.next()})},Je(Sr),X(Sr,J,"Generator"),X(Sr,j,function(){return this}),X(Sr,"toString",function(){return"[object Generator]"}),$.keys=function(he){var te=Object(he),fe=[];for(var ke in te)fe.push(ke);return fe.reverse(),function De(){for(;fe.length;){var le=fe.pop();if(le in te)return De.value=le,De.done=!1,De}return De.done=!0,De}},$.values=ot,fr.prototype={constructor:fr,reset:function(te){if(this.prev=0,this.next=0,this.sent=this._sent=P,this.done=!1,this.delegate=null,this.method="next",this.arg=P,this.tryEntries.forEach(Ur),!te)for(var fe in this)fe.charAt(0)==="t"&&C.call(this,fe)&&!isNaN(+fe.slice(1))&&(this[fe]=P)},stop:function(){this.done=!0;var te=this.tryEntries[0].completion;if(te.type==="throw")throw te.arg;return this.rval},dispatchException:function(te){if(this.done)throw te;var fe=this;function ke(Rt,rt){return pe.type="throw",pe.arg=te,fe.next=Rt,rt&&(fe.method="next",fe.arg=P),!!rt}for(var De=this.tryEntries.length-1;De>=0;--De){var le=this.tryEntries[De],pe=le.completion;if(le.tryLoc==="root")return ke("end");if(le.tryLoc<=this.prev){var Ae=C.call(le,"catchLoc"),Ke=C.call(le,"finallyLoc");if(Ae&&Ke){if(this.prev<le.catchLoc)return ke(le.catchLoc,!0);if(this.prev<le.finallyLoc)return ke(le.finallyLoc)}else if(Ae){if(this.prev<le.catchLoc)return ke(le.catchLoc,!0)}else{if(!Ke)throw Error("try statement without catch or finally");if(this.prev<le.finallyLoc)return ke(le.finallyLoc)}}}},abrupt:function(te,fe){for(var ke=this.tryEntries.length-1;ke>=0;--ke){var De=this.tryEntries[ke];if(De.tryLoc<=this.prev&&C.call(De,"finallyLoc")&&this.prev<De.finallyLoc){var le=De;break}}le&&(te==="break"||te==="continue")&&le.tryLoc<=fe&&fe<=le.finallyLoc&&(le=null);var pe=le?le.completion:{};return pe.type=te,pe.arg=fe,le?(this.method="next",this.next=le.finallyLoc,nr):this.complete(pe)},complete:function(te,fe){if(te.type==="throw")throw te.arg;return te.type==="break"||te.type==="continue"?this.next=te.arg:te.type==="return"?(this.rval=this.arg=te.arg,this.method="return",this.next="end"):te.type==="normal"&&fe&&(this.next=fe),nr},finish:function(te){for(var fe=this.tryEntries.length-1;fe>=0;--fe){var ke=this.tryEntries[fe];if(ke.finallyLoc===te)return this.complete(ke.completion,ke.afterLoc),Ur(ke),nr}},catch:function(te){for(var fe=this.tryEntries.length-1;fe>=0;--fe){var ke=this.tryEntries[fe];if(ke.tryLoc===te){var De=ke.completion;if(De.type==="throw"){var le=De.arg;Ur(ke)}return le}}throw Error("illegal catch attempt")},delegateYield:function(te,fe,ke){return this.delegate={iterator:ot(te),resultName:fe,nextLoc:ke},this.method==="next"&&(this.arg=P),nr}},$}Pe.exports=L,Pe.exports.__esModule=!0,Pe.exports.default=Pe.exports},73738:Pe=>{function ve(h){"@babel/helpers - typeof";return Pe.exports=ve=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(V){return typeof V}:function(V){return V&&typeof Symbol=="function"&&V.constructor===Symbol&&V!==Symbol.prototype?"symbol":typeof V},Pe.exports.__esModule=!0,Pe.exports.default=Pe.exports,ve(h)}Pe.exports=ve,Pe.exports.__esModule=!0,Pe.exports.default=Pe.exports},54756:(Pe,ve,h)=>{var V=h(4633)();Pe.exports=V;try{regeneratorRuntime=V}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=V:Function("r","regeneratorRuntime = r")(V)}}}]);

//# sourceMappingURL=influxdbPlugin.5fa4f666b04eb5021747.js.map