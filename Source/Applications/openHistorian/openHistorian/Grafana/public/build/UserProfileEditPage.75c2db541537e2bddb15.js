"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7323],{18885:(H,U,t)=>{t.d(U,{Z:()=>j,v:()=>S});var e=t(9892),a=t(68404),o=t(40400),P=t(68183),L=t(35645),D=t(41818),y=t(94270),b=t(13393),h=t(24799),r=t(2594),M=t(64353),A=t(52566),n=t(80124),l=t(26338),B=t(53217),z=t(31403),V=t(7804),x=t(99661),m=t(35287),N=t(19719),X=t(42454);function $(){const F=N.a2.map(i=>({value:i.code,label:i.name}));return[{value:"",label:(0,m.t)("common.locale.default","Default")},...F]}const W=Boolean(L.v.featureToggles.internationalization);class S extends a.PureComponent{constructor(u){super(u),this.onSubmitForm=async()=>{if(this.props.onConfirm?await this.props.onConfirm():!0){const{homeDashboardUID:Z,theme:C,timezone:_,weekStart:R,language:I,queryHistory:T}=this.state;await this.service.update({homeDashboardUID:Z,theme:C,timezone:_,weekStart:R,language:I,queryHistory:T}),window.location.reload()}},this.onThemeChanged=i=>{this.setState({theme:i})},this.onTimeZoneChanged=i=>{i&&this.setState({timezone:i})},this.onWeekStartChanged=i=>{this.setState({weekStart:i})},this.onHomeDashboardChanged=i=>{this.setState({homeDashboardUID:i})},this.onLanguageChanged=i=>{this.setState({language:i}),(0,D.ff)("grafana_preferences_language_changed",{toLanguage:i,preferenceType:this.props.preferenceType})},this.service=new X.y(u.resourceUri),this.state={theme:"",timezone:"",weekStart:"",language:"",queryHistory:{homeTab:""}},this.themeOptions=[{value:"",label:(0,m.t)("shared-preferences.theme.default-label","Default")},{value:"dark",label:(0,m.t)("shared-preferences.theme.dark-label","Dark")},{value:"light",label:(0,m.t)("shared-preferences.theme.light-label","Light")},{value:"system",label:(0,m.t)("shared-preferences.theme.system-label","System")}]}async componentDidMount(){const u=await this.service.load();this.setState({homeDashboardUID:u.homeDashboardUID,theme:u.theme,timezone:u.timezone,weekStart:u.weekStart,language:u.language,queryHistory:u.queryHistory})}render(){const{theme:u,timezone:i,weekStart:Z,homeDashboardUID:C,language:_}=this.state,{disabled:R}=this.props,I=J(),T=$();let w=this.themeOptions[0].value;return u?.length&&(w=this.themeOptions.find(s=>s.value===u)?.value),a.createElement(y.l,{onSubmit:this.onSubmitForm},()=>a.createElement(b.C,{label:a.createElement(m.cC,{i18nKey:"shared-preferences.title"},"Preferences"),disabled:R},a.createElement(h.g,{label:(0,m.t)("shared-preferences.fields.theme-label","UI Theme")},a.createElement(r.S,{options:this.themeOptions,value:w,onChange:this.onThemeChanged})),a.createElement(h.g,{label:a.createElement(M._,{htmlFor:"home-dashboard-select"},a.createElement("span",{className:I.labelText},a.createElement(m.cC,{i18nKey:"shared-preferences.fields.home-dashboard-label"},"Home Dashboard"))),"data-testid":"User preferences home dashboard drop down"},a.createElement(x.o,{value:C,onChange:s=>this.onHomeDashboardChanged(s?.uid??""),defaultOptions:!0,isClearable:!0,placeholder:(0,m.t)("shared-preferences.fields.home-dashboard-placeholder","Default dashboard"),inputId:"home-dashboard-select"})),a.createElement(h.g,{label:(0,m.t)("shared-dashboard.fields.timezone-label","Timezone"),"data-testid":P.wl.components.TimeZonePicker.containerV2},a.createElement(A.O,{includeInternal:!0,value:i,onChange:this.onTimeZoneChanged,inputId:"shared-preferences-timezone-picker"})),a.createElement(h.g,{label:(0,m.t)("shared-preferences.fields.week-start-label","Week start"),"data-testid":P.wl.components.WeekStartPicker.containerV2},a.createElement(n.z,{value:Z||"",onChange:this.onWeekStartChanged,inputId:"shared-preferences-week-start-picker"})),W?a.createElement(h.g,{label:a.createElement(M._,{htmlFor:"locale-select"},a.createElement("span",{className:I.labelText},a.createElement(m.cC,{i18nKey:"shared-preferences.fields.locale-label"},"Language")),a.createElement(l.a,{featureState:o.CQ.beta})),"data-testid":"User preferences language drop down"},a.createElement(B.Ph,{value:T.find(s=>s.value===_),onChange:s=>this.onLanguageChanged(s.value??""),options:T,placeholder:(0,m.t)("shared-preferences.fields.locale-placeholder","Choose language"),inputId:"locale-select"})):null,a.createElement("div",{className:"gf-form-button-row"},a.createElement(z.zx,{type:"submit",variant:"primary","data-testid":P.wl.components.UserProfile.preferencesSaveButton},a.createElement(m.cC,{i18nKey:"common.save"},"Save")))))}}const j=S,J=(0,V.B)(()=>({labelText:e.css`
      margin-right: 6px;
    `}))},87807:(H,U,t)=>{t.r(U),t.d(U,{UserProfileEditPage:()=>T,default:()=>w});var e=t(68404),a=t(36635),o=t(95700),P=t(52081),L=t(79396),D=t(18885),y=t(68183),b=t(61744),h=t(31403),r=t(35287);class M extends e.PureComponent{render(){const{isLoading:g,orgs:E,user:f}=this.props;return g?e.createElement(b.u,{text:"Loading organizations..."}):E.length===0?null:e.createElement("div",null,e.createElement("h3",{className:"page-sub-heading"},e.createElement(r.cC,{i18nKey:"user-orgs.title"},"Organizations")),e.createElement("div",{className:"gf-form-group"},e.createElement("table",{className:"filter-table form-inline","data-testid":y.wl.components.UserProfile.orgsTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,e.createElement(r.cC,{i18nKey:"user-orgs.name-column"},"Name")),e.createElement("th",null,e.createElement(r.cC,{i18nKey:"user-orgs.role-column"},"Role")),e.createElement("th",null))),e.createElement("tbody",null,E.map((d,c)=>e.createElement("tr",{key:c},e.createElement("td",null,d.name),e.createElement("td",null,d.role),e.createElement("td",{className:"text-right"},d.orgId===f?.orgId?e.createElement(h.zx,{variant:"secondary",size:"sm",disabled:!0},e.createElement(r.cC,{i18nKey:"user-orgs.current-org-button"},"Current")):e.createElement(h.zx,{variant:"secondary",size:"sm",onClick:()=>{this.props.setUserOrg(d)}},e.createElement(r.cC,{i18nKey:"user-orgs.select-org-button"},"Select organisation")))))))))}}const A=M;var n=t(94270),l=t(13393),B=t(24799),z=t(46967),V=t(6554),x=t(39904),m=t(47694);const{disableLoginForm:N}=m.ZP,$=({user:s,isSavingUser:g,updateProfile:E})=>{const f=v=>{E(v)},d=(s&&s.isExternal)??!1,c=d&&s&&s.authLabels?s.authLabels[0]:"",p=c?` (Synced via ${c})`:"",O=N||d;return e.createElement(n.l,{onSubmit:f,validateOn:"onBlur"},({register:v,errors:K})=>e.createElement(l.C,null,e.createElement(B.g,{label:(0,r.t)("user-profile.fields.name-label","Name")+p,invalid:!!K.name,error:e.createElement(r.cC,{i18nKey:"user-profile.fields.name-error"},"Name is required"),disabled:O},e.createElement(z.I,{...v("name",{required:!0}),id:"edit-user-profile-name",placeholder:(0,r.t)("user-profile.fields.name-label","Name"),defaultValue:s?.name??"",suffix:e.createElement(W,null)})),e.createElement(B.g,{label:(0,r.t)("user-profile.fields.email-label","Email")+p,invalid:!!K.email,error:e.createElement(r.cC,{i18nKey:"user-profile.fields.email-error"},"Email is required"),disabled:O},e.createElement(z.I,{...v("email",{required:!0}),id:"edit-user-profile-email",placeholder:(0,r.t)("user-profile.fields.email-label","Email"),defaultValue:s?.email??"",suffix:e.createElement(W,null)})),e.createElement(B.g,{label:(0,r.t)("user-profile.fields.username-label","Username")+p,disabled:O},e.createElement(z.I,{...v("login"),id:"edit-user-profile-username",defaultValue:s?.login??"",placeholder:(0,r.t)("user-profile.fields.username-label","Username")+p,suffix:e.createElement(W,null)})),e.createElement("div",{className:"gf-form-button-row"},e.createElement(h.zx,{variant:"primary",disabled:g||O,"data-testid":y.wl.components.UserProfile.profileSaveButton,type:"submit"},e.createElement(r.cC,{i18nKey:"common.save"},"Save")))))},W=()=>N?e.createElement(V.u,{content:"Login details locked because they are managed in another system."},e.createElement(x.J,{name:"lock"})):null;var S=t(9892),j=t(97925);class J extends e.PureComponent{render(){const{isLoading:g,sessions:E,revokeUserSession:f}=this.props,d=F();return g?e.createElement(b.u,{text:e.createElement(r.cC,{i18nKey:"user-sessions.loading"},"Loading sessions...")}):e.createElement("div",{className:d.wrapper},E.length>0&&e.createElement(e.Fragment,null,e.createElement("h3",{className:"page-sub-heading"},"Sessions"),e.createElement("div",{className:(0,S.cx)("gf-form-group",d.table)},e.createElement("table",{className:"filter-table form-inline","data-testid":y.wl.components.UserProfile.sessionsTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,e.createElement(r.cC,{i18nKey:"user-session.seen-at-column"},"Last seen")),e.createElement("th",null,e.createElement(r.cC,{i18nKey:"user-session.created-at-column"},"Logged on")),e.createElement("th",null,e.createElement(r.cC,{i18nKey:"user-session.ip-column"},"IP address")),e.createElement("th",null,e.createElement(r.cC,{i18nKey:"user-session.browser-column"},"Browser & OS")),e.createElement("th",null))),e.createElement("tbody",null,E.map((c,p)=>e.createElement("tr",{key:p},c.isActive?e.createElement("td",null,"Now"):e.createElement("td",null,c.seenAt),e.createElement("td",null,(0,r.$q)(c.createdAt,{dateStyle:"long"})),e.createElement("td",null,c.clientIp),e.createElement("td",null,c.browser," on ",c.os," ",c.osVersion),e.createElement("td",null,e.createElement(h.zx,{size:"sm",variant:"destructive",onClick:()=>f(c.id),"aria-label":(0,j.t)("user-session.revoke","Revoke user session")},e.createElement(x.J,{name:"power"}))))))))))}}const F=()=>({wrapper:(0,S.css)({maxWidth:"100%"}),table:(0,S.css)({overflow:"auto"})}),u=J;class i extends e.PureComponent{render(){const{isLoading:g,teams:E}=this.props;return g?e.createElement(b.u,{text:"Loading teams..."}):E.length===0?null:e.createElement("div",null,e.createElement("h3",{className:"page-sub-heading"},"Teams"),e.createElement("div",{className:"gf-form-group"},e.createElement("table",{className:"filter-table form-inline","aria-label":"User teams table"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null),e.createElement("th",null,"Name"),e.createElement("th",null,"Email"),e.createElement("th",null,"Members"))),e.createElement("tbody",null,E.map((f,d)=>e.createElement("tr",{key:d},e.createElement("td",{className:"width-4 text-center"},e.createElement("img",{className:"filter-table__avatar",src:f.avatarUrl,alt:""})),e.createElement("td",null,f.name),e.createElement("td",null,f.email),e.createElement("td",null,f.memberCount)))))))}}const Z=null;var C=t(20523);function _(s){const g=s.user,{user:E,teams:f,orgs:d,sessions:c,teamsAreLoading:p,orgsAreLoading:O,sessionsAreLoading:v,isUpdating:K}=g;return{orgsAreLoading:O,sessionsAreLoading:v,teamsAreLoading:p,orgs:d,sessions:c,teams:f,isUpdating:K,user:E}}const R={initUserProfilePage:C.PA,revokeUserSession:C.cc,changeUserOrg:C.hz,updateUserProfile:C.Lj},I=(0,a.connect)(_,R);function T({orgsAreLoading:s,sessionsAreLoading:g,teamsAreLoading:E,initUserProfilePage:f,orgs:d,sessions:c,teams:p,isUpdating:O,user:v,revokeUserSession:K,changeUserOrg:Q,updateUserProfile:G}){return(0,o.Z)(()=>f()),e.createElement(L.T,{navId:"profile/settings"},e.createElement(L.T.Contents,{isLoading:!v},e.createElement(P.wc,{spacing:"md"},e.createElement($,{updateProfile:G,isSavingUser:O,user:v}),e.createElement(D.Z,{resourceUri:"user",preferenceType:"user"}),e.createElement(i,{isLoading:E,teams:p}),e.createElement(A,{isLoading:s,setUserOrg:Q,orgs:d,user:v}),e.createElement(u,{isLoading:g,revokeUserSession:K,sessions:c}))))}const w=I(T)},20523:(H,U,t)=>{t.d(U,{Cp:()=>P,II:()=>D,Lj:()=>A,PA:()=>L,cc:()=>r,hz:()=>M});var e=t(35645),a=t(19360),o=t(54294);function P(n){return async function(l){l((0,o.zc)({updating:!0})),await a.h.changePassword(n),l((0,o.zc)({updating:!1}))}}function L(){return async function(n){await n(D()),n(y()),n(b()),n(h())}}function D(){return async function(n){const l=await a.h.loadUser();n((0,o.aw)({user:l}))}}function y(){return async function(n){n((0,o.qD)());const l=await a.h.loadTeams();n((0,o.PL)({teams:l}))}}function b(){return async function(n){n((0,o.$S)());const l=await a.h.loadOrgs();n((0,o.Ns)({orgs:l}))}}function h(){return async function(n){n((0,o.Uk)());const l=await a.h.loadSessions();n((0,o.z0)({sessions:l}))}}function r(n){return async function(l){l((0,o.zc)({updating:!0})),await a.h.revokeUserSession(n),l((0,o.p$)({tokenId:n}))}}function M(n){return async function(l){l((0,o.zc)({updating:!0})),await a.h.setUserOrg(n),window.location.href=e.v.appSubUrl+"/profile"}}function A(n){return async function(l){l((0,o.zc)({updating:!0})),await a.h.updateUserProfile(n),await l(D()),l((0,o.zc)({updating:!1}))}}},95700:(H,U,t)=>{t.d(U,{Z:()=>o});var e=t(58252),a=function(P){(0,e.Z)(function(){P()})};const o=a}}]);

//# sourceMappingURL=UserProfileEditPage.75c2db541537e2bddb15.js.map