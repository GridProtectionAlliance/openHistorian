{"version":3,"sources":["webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/time_grain_converter.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/editor/typeahead.tsx","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/editor/query_field.tsx","webpack:///./public/app/features/explore/slate-plugins/prism/index.tsx","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/editor/kusto/kusto.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/editor/KustoQueryField.tsx","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/editor/editor_component.tsx","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/query_ctrl.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/azure_monitor/url_builder.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/azure_monitor/response_parser.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/types.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/azure_monitor/supported_namespaces.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/azure_monitor/azure_monitor_datasource.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/app_insights/response_parser.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/app_insights/app_insights_datasource.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/log_analytics/querystring_builder.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/azure_log_analytics/response_parser.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/azure_log_analytics/azure_log_analytics_datasource.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/insights_analytics/insights_analytics_datasource.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/datasource.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/AzureCredentialsForm.tsx","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/MonitorConfig.tsx","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/AnalyticsConfig.tsx","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/InsightsConfig.tsx","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/ConfigEditor.tsx","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/annotations_query_ctrl.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/module.tsx","webpack:///./public/app/core/utils/CancelablePromise.ts"],"names":["TimeGrainConverter","timeGrain","timeGrainUnit","_","includes","toUpperCase","interval","slice","length","unit","indexOf","createISO8601Duration","toMinutes","allowedTimeGrains","timeGrains","filter","o","closest","intervalMs","rangeUtil","intervalToMs","i","duration","offset","substring","value","timeUnitToText","text","timeUnitToKbn","TypeaheadItem","getRef","el","prevProps","this","props","isSelected","offsetParent","container","offsetTop","scrollTop","offsetHeight","scrollIntoView","hint","label","onClickItem","className","ref","onClick","React","PureComponent","TypeaheadGroup","items","selected","map","item","display","key","Typeahead","groupedItems","menuRef","selectedItems","g","flattenSuggestions","s","reduce","acc","concat","Portal","index","prefix","node","document","createElement","classList","add","body","appendChild","removeChild","ReactDOM","createPortal","children","Component","QueryField","context","keybindingSrv","getKeybindingSrv","onChange","changed","state","setState","requestAnimationFrame","onTypeahead","onChangeQuery","onQueryChange","Plain","serialize","onKeyDown","event","editor","next","typeaheadIndex","suggestions","keyboardEvent","menuEl","preventDefault","stopPropagation","resetTypeahead","ctrlKey","shiftKey","flattenedSuggestions","suggestion","Math","abs","applyTypeahead","max","change","Value","callback","typeaheadPrefix","typeaheadContext","handleBlur","onBlur","resetTimer","setTimeout","restoreEscapeKeyBinding","handleFocus","onFocus","removeEscapeKeyBinding","updateMenu","menu","selection","window","getSelection","anchorNode","parentElement","rect","getBoundingClientRect","scrollX","scrollY","screenHeight","innerHeight","menuLeft","left","menuTop","top","height","menuHeight","style","opacity","maxHeight","removeAttribute","renderMenu","portalPrefix","selectedIndex","selectedKeys","definition","language","query","lines","prismDefinition","prismLanguage","plugins","BracesPlugin","ClearPlugin","RunnerPlugin","handler","onPressEnter","NewlinePlugin","Prism","languages","renderDecoration","decoration","type","data","get","decorateNode","texts","getTexts","toArray","tstring","t","join","grammar","tokens","tokenize","decorations","startText","shift","endText","startOffset","endOffset","start","processToken","token","types","alias","content","newlines","split","end","available","remaining","range","createDecoration","anchor","focus","push","labelKeys","labelValues","initialQuery","create","line","Block","nodes","Text","Document","clearTimeout","unbind","setupGlobal","autoCorrect","placeholder","spellCheck","operatorTokens","functionTokens","KEYWORDS","grafanaMacros","tokenizer","comment","pattern","lookbehind","greedy","inside","RegExp","builtin","f","string","keyword","boolean","number","operator","punctuation","variable","argument","cleanText","replace","trim","wrapText","KustoQueryField","force","wrapperNode","editorNode","isBlurred","getRangeAt","textContent","substr","modelOffset","anchorOffset","modelPrefix","anchorText","suggestionGroups","wrapperClasses","contains","getColumnSuggestions","match","getFunctionSuggestions","getTableSuggestions","db","getDBFromDatabaseFunction","normalizeQuery","schema","fetchSchema","getInitialSuggestions","getKeywordSuggestions","getLastWord","results","toLowerCase","filteredSuggestions","group","skipFilter","c","prefixMatch","typeaheadText","suggestionText","nextChar","DOMUtil","getNextCharacter","backward","deleteBackwards","suffixLength","forward","deleteBackward","deleteForward","insertText","moveForward","Databases","Default","debounce","Tables","Name","table","getTableFromContext","tableSchema","OrderedColumns","Type","normalizedQuery","exec","getSchema","castSchema","defaultSchemaTemplate","str","Editor","edited","execute","variables","Kusto","templateVariables","defaultProps","coreModule","directive","reactDirective","watchDepth","AzureMonitorQueryCtrl","$scope","$injector","templateSrv","defaultDropdownValue","dummyDiminsionString","defaults","queryType","azureMonitor","resourceGroup","metricDefinition","resourceName","metricNamespace","metricName","dimensionFilter","aggOptions","azureLogAnalytics","resultFormat","workspace","datasource","azureLogAnalyticsDatasource","defaultOrFirstWorkspace","appInsights","insightsAnalytics","getWorkspaces","target","subscription","then","list","workspaces","catch","handleQueryCtrlError","bind","getAzureLogAnalyticsSchema","onLogAnalyticsQueryChange","nextQuery","onLogAnalyticsQueryExecute","panelCtrl","refresh","onInsightsAnalyticsQueryChange","onQueryExecute","getAppInsightsQuerySchema","appInsightsDatasource","getQuerySchema","removeGroupBy","dimension","splice","defaultsDeep","migrateTimeGrains","migrateToFromTimes","migrateToDefaultNamespace","migrateApplicationInsightsKeys","migrateApplicationInsightsDimensions","migrateMetricsDimensionFilters","events","on","PanelEvents","dataReceived","onDataReceived","dataError","onDataError","resultFormats","getSubscriptions","dataList","lastQueryError","undefined","lastQuery","anySeriesFromQuery","find","refId","meta","err","error","innererror","message","TimegrainConverter","onMetricNameChange","timeGrainCount","oldAzureTimeGrains","allowedTimeGrainsMs","convertTimeGrainsToMs","mappings","xaxis","yaxis","spliton","groupBy","groupByOptions","old","isString","panel","scopedVars","azureMonitorDatasource","isConfigured","subs","subscriptions","logAnalyticsSubscriptionId","subscriptionId","aggregation","dimensionFilters","getResourceGroups","getMetricDefinitions","getResourceNames","getMetricNamespaces","getMetricNames","getMetricMetadata","metadata","primaryAggType","supportedTimeGrains","hackState","supportedAggTypes","dimensions","Promise","resolve","forEach","tg","createKbnUnitFromISO8601Duration","findClosestTimeGrain","generateAutoUnits","getAppInsightsMetricNames","getAppInsightsColumns","getAppInsightsMetricMetadata","aggData","supportedGroupBy","option","timeGrainType","getVariables","name","QueryCtrl","oldDimension","templateUrl","UrlBuilder","baseUrl","apiVersion","rn","service","lastIndexOf","md","encodeURIComponent","ResponseParser","result","textFieldName","valueFieldName","defaultAggTypes","metricData","primaryAggregationType","supportedAggregationTypes","parseTimeGrains","metricAvailabilities","parseDimensions","avail","createTimeGrainFromISO8601Duration","localizedValue","properties","AzureQueryType","SupportedNamespaces","cloudName","supportedMetricNamespaces","azuremonitor","govazuremonitor","germanyazuremonitor","chinaazuremonitor","AzureMonitorDatasource","instanceSettings","apiPreviewVersion","jsonData","url","hide","getTemplateSrv","toString","AzureMonitor","format","resourceGroupsQueryWithSub","toVariable","metricDefinitionsQuery","metricDefinitionsQueryWithSub","resourceNamesQuery","resourceNamesQueryWithSub","metricNamespaceQuery","metricNamespaceQueryWithSub","metricNamesQuery","metricNamesQueryWithSub","metric","route","doRequest","parseSubscriptions","parseResponseValues","shouldHardcodeBlobStorage","startsWith","parseResourceNames","buildAzureMonitorGetMetricNamespacesUrl","buildAzureMonitorGetMetricNamesUrl","parseMetadata","isValidConfigField","tenantId","status","clientId","response","title","statusText","code","field","maxRetries","getBackendSrv","datasourceRequest","method","DataSourceWithBackend","hasSegmentsField","dataTarget","datapoints","obj","keys","segment","without","isObject","dataObj","intersection","dateTimeValue","dateTime","valueOf","metrics","toTextValueList","values","columns","raw","yaxises","Columns","rows","Rows","parseRawQueryResultRow","parseQueryResultRow","columnsForDropdown","column","ColumnName","xaxisColumn","findIndex","yaxisesSplit","yaxisColumns","splitonColumn","convertTimestamp","row","yaxisColumn","yaxisName","bucket","findOrCreateBucket","epoch","dateTimeToEpoch","isSingleValue","getMetricFieldKey","aggField","getKeyForAggregationField","segments","j","getTargetName","segmentName","segmentValue","prop","g1","g2","Error","defaultAggregation","supportedAggregations","all","columnTable","columnName","columnType","AppInsightsDatasource","version","logAnalyticsColumns","applicationId","appInsightsAppId","options","timeColumn","valueColumn","segmentColumn","rawQuery","rawQueryString","ApplicationInsights","d","appInsightsGroupByQuery","getGroupBys","parseMetricNames","parseGroupBys","parseQuerySchema","LogAnalyticsQuerystringBuilder","defaultTimeField","queryString","macroRegexp","p1","p2","getMultiContains","escape","getTimeFilter","getFrom","getUntil","uriString","from","startOf","toISOString","rangeRaw","to","now","Date","until","timeFieldArg","timeField","inputs","firstCommaIndex","templateVar","v","tables","parseTimeSeriesResult","parseTableResult","timeIndex","metricIndex","valueIndex","executedQueryString","col","queryResult","parseQueryResult","flattenDeep","textIndex","tagsIndex","annotation","time","floor","tags","Plugins","createSchemaDatabaseWithTables","createSchemaTables","Functions","createSchemaFunctions","convertToKustoColumn","functions","func","Body","DocString","displayName","Folder","category","FunctionKind","InputParameters","OutputColumns","AzureLogAnalyticsDatasource","cache","Map","logAnalyticsDefaultWorkspace","setWorkspaceUrl","azureLogAnalyticsSameAs","azureCloud","azureMonitorUrl","getWorkspaceList","val","customerId","workspaceListUrl","parseSchemaResult","interpolateVariable","LogAnalytics","request","pipe","mergeMap","res","processResponse","df","encodedQuery","custom","buildDeepLink","fields","config","links","targetBlank","customMeta","base64Enc","workspaceId","getWorkspaceDetails","details","id","workspacesQueryWithSub","getDefaultOrFirstWorkspace","queries","buildQuery","promises","doQueries","parseToVariables","querystring","generate","datasourceId","multi","includeAll","reject","transformToAnnotations","useCache","has","set","validationError","isValidConfig","ws","getErrorMessage","logAnalyticsTenantId","logAnalyticsClientId","InsightsAnalyticsDatasource","InsightsAnalytics","Datasource","insightsAnalyticsDatasource","pseudoDatasource","optionsKey","byType","targets","opts","q","cloneDeep","requestId","obs","Object","req","forkJoin","frame","LoadingState","Done","of","annotationQuery","aiResult","metricFindQueryInternal","amResult","alaResult","testDatasource","upperFirst","applyTemplateVariables","DataSourceApi","Select","LegacyForms","Input","AzureCredentialsForm","selectedAzureCloud","selectedSubscription","clientSecret","clientSecretConfigured","azureCloudOptions","subscriptionOptions","onAzureCloudChange","onSubscriptionSelectChange","onTenantIdChange","onClientIdChange","onClientSecretChange","onResetClientSecret","onLoadSubscriptions","hasRequiredFields","hasSubscriptions","tooltip","defaultValue","disabled","variant","size","azureClouds","MonitorConfig","onAzureCloudSelect","onUpdateJsonDataOption","makeSameAs","onUpdateSecureJsonDataOption","onResetOptionKey","onSubscriptionSelect","secureJsonData","secureJsonFields","Switch","AnalyticsConfig","onLogAnalyticsTenantIdChange","onLogAnalyticsClientIdChange","onLogAnalyticsClientSecretChange","onLogAnalyticsSubscriptionSelect","logAnalyticsSubscription","onWorkspaceSelectChange","onAzureLogAnalyticsSameAsChange","onUpdateDatasourceOptions","sameAsSwitched","onLogAnalyticsResetClientSecret","hasWorkspaceRequiredFields","logAnalyticsClientSecret","hasOwnProperty","addtlAttrs","showSameAsHelpMsg","checked","onLoadWorkspaces","InsightsConfig","onAppInsightsResetApiKey","appInsightsApiKey","ConfigEditor","initPromise","init","getLogAnalyticsSubscriptions","updateJsonDataOption","updateDatasourcePluginJsonDataOption","updateSecureJsonDataOption","updateDatasourcePluginSecureJsonDataOption","resetSecureKey","updateDatasourcePluginResetOption","currentTarget","updatedClientSecret","onOptionsChange","hasNecessaryCredentials","logAnalyticsHasNecessaryCredentials","put","updateDatasourcePluginOption","loadSubscriptions","parseSubscriptionsForSelect","loadWorkspaces","parseWorkspacesForSelect","logAnalyticsSubscriptions","subscriptionIdToUse","logAnalyticsWorkspaces","makePromiseCancelable","promise","isCanceled","console","warn","cancel","AzureMonitorAnnotationsQueryCtrl","defaultQuery","onSubscriptionChange","initDropdowns","bustCache","getAzureLogAnalyticsWorkspaces","plugin","DataSourcePlugin","setConfigEditor","setQueryCtrl","setAnnotationQueryCtrl","hasCanceled_"],"mappings":"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/G,EAAgD,GAEtD,IAAK+G,EACH,OAAO/G,EAKT,IAFA,IAESxU,EAAI,EAAGA,EAAIub,EAAO/R,KAAKpJ,MAAMjB,OAAQa,IACvClB,IAAEkY,KAAKxC,EAAM,CAAC,QAAS1V,IAAE2K,IAAI8R,EAAO/R,KAAKpJ,MAAMJ,GAAGoc,WAHlC,iBAInB5H,EAAK/I,KAAK,CACRnK,MAAOxC,IAAE2K,IAAI8R,EAAO/R,KAAKpJ,MAAMJ,GAJf,QAKhBI,MAAOtB,IAAE2K,IAAI8R,EAAO/R,KAAKpJ,MAAMJ,GAAGoc,WANjB,gBAWvB,OAAO5H,M,sNClKC6H,GCJSC,G,WA6OnB,WAAoBC,I,4FAAmB,cAAnBA,YAAmB,KA5OvCC,0BAAiC,CAC/BC,aAAc,CACZ,qCACA,kCACA,0CACA,gCACA,wBACA,2CACA,mDACA,uCACA,oCACA,4CACA,8CACA,yCACA,6CACA,kCACA,2CACA,sCACA,kCACA,uCACA,mCACA,iCACA,+BACA,oCACA,4BACA,yCACA,wCACA,6BACA,yCACA,sCACA,gCACA,8BACA,+BACA,uCACA,gCACA,4BACA,2BACA,2CACA,4BACA,iDACA,gDACA,wDACA,sCACA,kCACA,6BACA,sCACA,mCACA,wCACA,2CACA,yCACA,kDACA,gCACA,2CACA,uDACA,+BACA,yDACA,2CACA,wCACA,6BACA,kCACA,kCACA,kCACA,qCACA,iCACA,oCACA,iDACA,iDACA,kDACA,kDACA,4CACA,uDACA,uEACA,8DACA,0CACA,4BACA,sBACA,4BACA,mDACA,iDAEFC,gBAAiB,CACf,qCACA,kCACA,gCACA,wBACA,2CACA,mDACA,uCACA,oCACA,4CACA,yCACA,+BACA,oCACA,4BACA,yCACA,6BACA,yCACA,sCACA,gCACA,8BACA,uCACA,4BACA,4BACA,sCACA,kCACA,6BACA,sCACA,mCACA,wCACA,2CACA,yCACA,kDACA,gCACA,2CACA,uDACA,+BACA,yDACA,2CACA,wCACA,6BACA,kCACA,kCACA,qCACA,iCACA,oCACA,iDACA,iDACA,kDACA,kDACA,4BACA,sBACA,4BACA,m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","file":"azureMonitorPlugin.591ee81e63053ad31983.js","sourcesContent":["import _ from 'lodash';\nimport { rangeUtil } from '@grafana/data';\n\nexport default class TimeGrainConverter {\n  static createISO8601Duration(timeGrain: string | number, timeGrainUnit: any) {\n    const timeIntervals = ['hour', 'minute', 'h', 'm'];\n    if (_.includes(timeIntervals, timeGrainUnit)) {\n      return `PT${timeGrain}${timeGrainUnit[0].toUpperCase()}`;\n    }\n\n    return `P${timeGrain}${timeGrainUnit[0].toUpperCase()}`;\n  }\n\n  static createISO8601DurationFromInterval(interval: string) {\n    const timeGrain = +interval.slice(0, interval.length - 1);\n    const unit = interval[interval.length - 1];\n\n    if (interval.indexOf('ms') > -1) {\n      return TimeGrainConverter.createISO8601Duration(1, 'm');\n    }\n\n    if (interval[interval.length - 1] === 's') {\n      let toMinutes = (timeGrain * 60) % 60;\n\n      if (toMinutes < 1) {\n        toMinutes = 1;\n      }\n\n      return TimeGrainConverter.createISO8601Duration(toMinutes, 'm');\n    }\n\n    return TimeGrainConverter.createISO8601Duration(timeGrain, unit);\n  }\n\n  static findClosestTimeGrain(interval: any, allowedTimeGrains: string[]) {\n    const timeGrains = _.filter(allowedTimeGrains, o => o !== 'auto');\n\n    let closest = timeGrains[0];\n    const intervalMs = rangeUtil.intervalToMs(interval);\n\n    for (let i = 0; i < timeGrains.length; i++) {\n      // abs (num - val) < abs (num - curr):\n      if (intervalMs > rangeUtil.intervalToMs(timeGrains[i])) {\n        if (i + 1 < timeGrains.length) {\n          closest = timeGrains[i + 1];\n        } else {\n          closest = timeGrains[i];\n        }\n      }\n    }\n\n    return closest;\n  }\n\n  static createTimeGrainFromISO8601Duration(duration: string) {\n    let offset = 1;\n    if (duration.substring(0, 2) === 'PT') {\n      offset = 2;\n    }\n\n    const value = duration.substring(offset, duration.length - 1);\n    const unit = duration.substring(duration.length - 1);\n\n    return value + ' ' + TimeGrainConverter.timeUnitToText(+value, unit);\n  }\n\n  static timeUnitToText(value: number, unit: string) {\n    let text = '';\n\n    if (unit === 'S') {\n      text = 'second';\n    }\n    if (unit === 'M') {\n      text = 'minute';\n    }\n    if (unit === 'H') {\n      text = 'hour';\n    }\n    if (unit === 'D') {\n      text = 'day';\n    }\n\n    if (value > 1) {\n      return text + 's';\n    }\n\n    return text;\n  }\n\n  static createKbnUnitFromISO8601Duration(duration: string) {\n    if (duration === 'auto') {\n      return 'auto';\n    }\n\n    let offset = 1;\n    if (duration.substring(0, 2) === 'PT') {\n      offset = 2;\n    }\n\n    const value = duration.substring(offset, duration.length - 1);\n    const unit = duration.substring(duration.length - 1);\n\n    return value + TimeGrainConverter.timeUnitToKbn(+value, unit);\n  }\n\n  static timeUnitToKbn(value: number, unit: string) {\n    if (unit === 'S') {\n      return 's';\n    }\n    if (unit === 'M') {\n      return 'm';\n    }\n    if (unit === 'H') {\n      return 'h';\n    }\n    if (unit === 'D') {\n      return 'd';\n    }\n\n    return '';\n  }\n}\n","import React from 'react';\n\nfunction scrollIntoView(el: any) {\n  if (!el || !el.offsetParent) {\n    return;\n  }\n  const container = el.offsetParent;\n  if (el.offsetTop > container.scrollTop + container.offsetHeight || el.offsetTop < container.scrollTop) {\n    container.scrollTop = el.offsetTop - container.offsetTop;\n  }\n}\n\nclass TypeaheadItem extends React.PureComponent<any, any> {\n  el: any;\n  componentDidUpdate(prevProps: any) {\n    if (this.props.isSelected && !prevProps.isSelected) {\n      scrollIntoView(this.el);\n    }\n  }\n\n  getRef = (el: any) => {\n    this.el = el;\n  };\n\n  render() {\n    const { hint, isSelected, label, onClickItem } = this.props;\n    const className = isSelected ? 'typeahead-item typeahead-item__selected' : 'typeahead-item';\n    const onClick = () => onClickItem(label);\n    return (\n      <li ref={this.getRef} className={className} onClick={onClick}>\n        {label}\n        {hint && isSelected ? <div className=\"typeahead-item-hint\">{hint}</div> : null}\n      </li>\n    );\n  }\n}\n\nclass TypeaheadGroup extends React.PureComponent<any, any> {\n  render() {\n    const { items, label, selected, onClickItem } = this.props;\n    return (\n      <li className=\"typeahead-group\">\n        <div className=\"typeahead-group__title\">{label}</div>\n        <ul className=\"typeahead-group__list\">\n          {items.map((item: any) => {\n            const text = typeof item === 'object' ? item.text : item;\n            const label = typeof item === 'object' ? item.display || item.text : item;\n            return (\n              <TypeaheadItem\n                key={text}\n                onClickItem={onClickItem}\n                isSelected={selected.indexOf(text) > -1}\n                hint={item.hint}\n                label={label}\n              />\n            );\n          })}\n        </ul>\n      </li>\n    );\n  }\n}\n\nclass Typeahead extends React.PureComponent<any, any> {\n  render() {\n    const { groupedItems, menuRef, selectedItems, onClickItem } = this.props;\n    return (\n      <ul className=\"typeahead\" ref={menuRef}>\n        {groupedItems.map((g: any) => (\n          <TypeaheadGroup key={g.label} onClickItem={onClickItem} selected={selectedItems} {...g} />\n        ))}\n      </ul>\n    );\n  }\n}\n\nexport default Typeahead;\n","import PluginPrism from 'app/features/explore/slate-plugins/prism';\nimport { BracesPlugin, ClearPlugin, RunnerPlugin, NewlinePlugin } from '@grafana/ui';\nimport Typeahead from './typeahead';\nimport { getKeybindingSrv, KeybindingSrv } from 'app/core/services/keybindingSrv';\n\nimport { Block, Document, Text, Value, Editor as CoreEditor } from 'slate';\nimport { Editor } from '@grafana/slate-react';\nimport Plain from 'slate-plain-serializer';\nimport ReactDOM from 'react-dom';\nimport React from 'react';\nimport _ from 'lodash';\n\nfunction flattenSuggestions(s: any) {\n  return s ? s.reduce((acc: any, g: any) => acc.concat(g.items), []) : [];\n}\n\nexport const makeFragment = (text: string) => {\n  const lines = text.split('\\n').map((line: any) =>\n    Block.create({\n      type: 'paragraph',\n      nodes: [Text.create(line)],\n    } as any)\n  );\n\n  const fragment = Document.create({\n    nodes: lines,\n  });\n  return fragment;\n};\n\nexport const getInitialValue = (query: string) => Value.create({ document: makeFragment(query) });\n\nclass Portal extends React.Component<any, any> {\n  node: any;\n\n  constructor(props: any) {\n    super(props);\n    const { index = 0, prefix = 'query' } = props;\n    this.node = document.createElement('div');\n    this.node.classList.add(`slate-typeahead`, `slate-typeahead-${prefix}-${index}`);\n    document.body.appendChild(this.node);\n  }\n\n  componentWillUnmount() {\n    document.body.removeChild(this.node);\n  }\n\n  render() {\n    return ReactDOM.createPortal(this.props.children, this.node);\n  }\n}\n\nclass QueryField extends React.Component<any, any> {\n  menuEl: any;\n  plugins: any;\n  resetTimer: any;\n  keybindingSrv: KeybindingSrv = getKeybindingSrv();\n\n  constructor(props: any, context: any) {\n    super(props, context);\n\n    const { prismDefinition = {}, prismLanguage = 'kusto' } = props;\n\n    this.plugins = [\n      BracesPlugin(),\n      ClearPlugin(),\n      RunnerPlugin({ handler: props.onPressEnter }),\n      NewlinePlugin(),\n      PluginPrism({ definition: prismDefinition, language: prismLanguage }),\n    ];\n\n    this.state = {\n      labelKeys: {},\n      labelValues: {},\n      suggestions: [],\n      typeaheadIndex: null,\n      typeaheadPrefix: '',\n      value: getInitialValue(props.initialQuery || ''),\n    };\n  }\n\n  componentDidMount() {\n    this.updateMenu();\n  }\n\n  componentWillUnmount() {\n    this.restoreEscapeKeyBinding();\n    clearTimeout(this.resetTimer);\n  }\n\n  componentDidUpdate() {\n    this.updateMenu();\n  }\n\n  onChange = ({ value }: { value: Value }) => {\n    const changed = value.document !== this.state.value.document;\n    this.setState({ value }, () => {\n      if (changed) {\n        // call typeahead only if query changed\n        requestAnimationFrame(() => this.onTypeahead());\n        this.onChangeQuery();\n      }\n    });\n  };\n\n  onChangeQuery = () => {\n    // Send text change to parent\n    const { onQueryChange } = this.props;\n    if (onQueryChange) {\n      onQueryChange(Plain.serialize(this.state.value));\n    }\n  };\n\n  onKeyDown = (event: Event, editor: CoreEditor, next: Function) => {\n    const { typeaheadIndex, suggestions } = this.state;\n    const keyboardEvent = event as KeyboardEvent;\n\n    switch (keyboardEvent.key) {\n      case 'Escape': {\n        if (this.menuEl) {\n          keyboardEvent.preventDefault();\n          keyboardEvent.stopPropagation();\n          this.resetTypeahead();\n          return true;\n        }\n        break;\n      }\n\n      case ' ': {\n        if (keyboardEvent.ctrlKey) {\n          keyboardEvent.preventDefault();\n          this.onTypeahead(true);\n          return true;\n        }\n        break;\n      }\n\n      case 'Tab':\n      case 'Enter': {\n        if (this.menuEl && typeaheadIndex !== null) {\n          // Dont blur input\n          keyboardEvent.preventDefault();\n          if (!suggestions || !suggestions.length || keyboardEvent.shiftKey || keyboardEvent.ctrlKey) {\n            return next();\n          }\n\n          // Get the currently selected suggestion\n          const flattenedSuggestions = flattenSuggestions(suggestions);\n          const selected = Math.abs(typeaheadIndex);\n          const selectedIndex = selected % flattenedSuggestions.length || 0;\n          const suggestion = flattenedSuggestions[selectedIndex];\n\n          return this.applyTypeahead(editor, suggestion);\n        }\n        break;\n      }\n\n      case 'ArrowDown': {\n        if (this.menuEl) {\n          // Select next suggestion\n          keyboardEvent.preventDefault();\n          this.setState({ typeaheadIndex: (typeaheadIndex || 0) + 1 });\n        }\n        break;\n      }\n\n      case 'ArrowUp': {\n        if (this.menuEl) {\n          // Select previous suggestion\n          keyboardEvent.preventDefault();\n          this.setState({ typeaheadIndex: Math.max(0, (typeaheadIndex || 0) - 1) });\n        }\n        break;\n      }\n\n      default: {\n        // console.log('default key', event.key, event.which, event.charCode, event.locale, data.key);\n        break;\n      }\n    }\n    return next();\n  };\n\n  onTypeahead = (change = false, item?: any): boolean | void => {\n    return change;\n  };\n\n  applyTypeahead = (\n    editor?: CoreEditor,\n    suggestion?: { text: any; type: string; deleteBackwards: any }\n  ): { value: Value } => {\n    return { value: new Value() };\n  };\n\n  resetTypeahead = (callback?: () => void) => {\n    this.setState(\n      {\n        suggestions: [],\n        typeaheadIndex: null,\n        typeaheadPrefix: '',\n        typeaheadContext: null,\n      },\n      callback\n    );\n  };\n\n  handleBlur = (event: Event, editor: CoreEditor, next: Function) => {\n    const { onBlur } = this.props;\n    // If we dont wait here, menu clicks wont work because the menu\n    // will be gone.\n    this.resetTimer = setTimeout(this.resetTypeahead, 100);\n    if (onBlur) {\n      onBlur();\n    }\n    this.restoreEscapeKeyBinding();\n    return next();\n  };\n\n  handleFocus = (event: Event, editor: CoreEditor, next: Function) => {\n    const { onFocus } = this.props;\n    if (onFocus) {\n      onFocus();\n    }\n    // Don't go back to dashboard if Escape pressed inside the editor.\n    this.removeEscapeKeyBinding();\n    return next();\n  };\n\n  removeEscapeKeyBinding() {\n    this.keybindingSrv.unbind('esc', 'keydown');\n  }\n\n  restoreEscapeKeyBinding() {\n    this.keybindingSrv.setupGlobal();\n  }\n\n  onClickItem = (item: any) => {\n    const { suggestions } = this.state;\n    if (!suggestions || suggestions.length === 0) {\n      return;\n    }\n\n    // Manually triggering change\n    const change = this.applyTypeahead();\n    this.onChange(change);\n  };\n\n  updateMenu = () => {\n    const { suggestions } = this.state;\n    const menu = this.menuEl;\n    const selection = window.getSelection();\n\n    // No menu, nothing to do\n    if (!menu || !selection) {\n      return;\n    }\n\n    const node = selection.anchorNode;\n\n    // No suggestions or blur, remove menu\n    const hasSuggesstions = suggestions && suggestions.length > 0;\n    if (!hasSuggesstions) {\n      menu.removeAttribute('style');\n      return;\n    }\n\n    // Align menu overlay to editor node\n    if (node && node.parentElement) {\n      // Read from DOM\n      const rect = node.parentElement.getBoundingClientRect();\n      const scrollX = window.scrollX;\n      const scrollY = window.scrollY;\n      const screenHeight = window.innerHeight;\n\n      const menuLeft = rect.left + scrollX - 2;\n      const menuTop = rect.top + scrollY + rect.height + 4;\n      const menuHeight = screenHeight - menuTop - 10;\n\n      // Write DOM\n      requestAnimationFrame(() => {\n        menu.style.opacity = 1;\n        menu.style.top = `${menuTop}px`;\n        menu.style.left = `${menuLeft}px`;\n        menu.style.maxHeight = `${menuHeight}px`;\n      });\n    }\n  };\n\n  menuRef = (el: any) => {\n    this.menuEl = el;\n  };\n\n  renderMenu = () => {\n    const { portalPrefix } = this.props;\n    const { suggestions, typeaheadIndex } = this.state;\n    const hasSuggesstions = suggestions && suggestions.length > 0;\n    if (!hasSuggesstions) {\n      return null;\n    }\n\n    // Guard selectedIndex to be within the length of the suggestions\n    let selectedIndex = Math.max(typeaheadIndex, 0);\n    const flattenedSuggestions = flattenSuggestions(suggestions);\n    selectedIndex = selectedIndex % flattenedSuggestions.length || 0;\n    const selectedKeys = (typeaheadIndex !== null && flattenedSuggestions.length > 0\n      ? [flattenedSuggestions[selectedIndex]]\n      : []\n    ).map(i => (typeof i === 'object' ? i.text : i));\n\n    // Create typeahead in DOM root so we can later position it absolutely\n    return (\n      <Portal prefix={portalPrefix}>\n        <Typeahead\n          menuRef={this.menuRef}\n          selectedItems={selectedKeys}\n          onClickItem={this.onClickItem}\n          groupedItems={suggestions}\n        />\n      </Portal>\n    );\n  };\n\n  render() {\n    return (\n      <div className=\"slate-query-field\">\n        {this.renderMenu()}\n        <Editor\n          autoCorrect={false}\n          onBlur={this.handleBlur}\n          onKeyDown={this.onKeyDown}\n          onChange={this.onChange}\n          onFocus={this.handleFocus}\n          placeholder={this.props.placeholder}\n          plugins={this.plugins}\n          spellCheck={false}\n          value={this.state.value}\n        />\n      </div>\n    );\n  }\n}\n\nexport default QueryField;\n","import React from 'react';\nimport Prism from 'prismjs';\nimport { Decoration } from 'slate';\nimport { Editor } from '@grafana/slate-react';\n\nconst TOKEN_MARK = 'prism-token';\n\nexport function setPrismTokens(language: string, field: string | number, values: any, alias = 'variable') {\n  Prism.languages[language][field] = {\n    alias,\n    pattern: new RegExp(`(?:^|\\\\s)(${values.join('|')})(?:$|\\\\s)`),\n  };\n}\n\n/**\n * Code-highlighting plugin based on Prism and\n * https://github.com/ianstormtaylor/slate/blob/master/examples/code-highlighting/index.js\n *\n * (Adapted to handle nested grammar definitions.)\n */\n\nexport default function PrismPlugin({ definition, language }: { definition: any; language: string }) {\n  if (definition) {\n    // Don't override exising modified definitions\n    Prism.languages[language] = Prism.languages[language] || definition;\n  }\n\n  return {\n    /**\n     * Render a Slate mark with appropriate CSS class names\n     *\n     * @param {Object} props\n     * @return {Element}\n     */\n\n    renderDecoration(props: any, editor: Editor, next: () => any): JSX.Element {\n      const { children, decoration } = props;\n      // Only apply spans to marks identified by this plugin\n      if (decoration.type !== TOKEN_MARK) {\n        return next();\n      }\n      const className = `token ${decoration.data.get('types')}`;\n      return <span className={className}>{children}</span>;\n    },\n\n    /**\n     * Decorate code blocks with Prism.js highlighting.\n     *\n     * @param {Node} node\n     * @return {Array}\n     */\n\n    decorateNode(node: any, editor: Editor, next: () => any): any[] {\n      if (node.type !== 'paragraph') {\n        return [];\n      }\n\n      const texts = node.getTexts().toArray();\n      const tstring = texts.map((t: { text: any }) => t.text).join('\\n');\n      const grammar = Prism.languages[language];\n      const tokens = Prism.tokenize(tstring, grammar);\n      const decorations: Decoration[] = [];\n      let startText = texts.shift();\n      let endText = startText;\n      let startOffset = 0;\n      let endOffset = 0;\n      let start = 0;\n\n      function processToken(token: any, acc?: string) {\n        // Accumulate token types down the tree\n        const types = `${acc || ''} ${token.type || ''} ${token.alias || ''}`;\n\n        // Add mark for token node\n        if (typeof token === 'string' || typeof token.content === 'string') {\n          startText = endText;\n          startOffset = endOffset;\n\n          const content = typeof token === 'string' ? token : token.content;\n          const newlines = content.split('\\n').length - 1;\n          const length = content.length - newlines;\n          const end = start + length;\n\n          let available = startText.text.length - startOffset;\n          let remaining = length;\n\n          endOffset = startOffset + remaining;\n\n          while (available < remaining) {\n            endText = texts.shift();\n            remaining = length - available;\n            available = endText.text.length;\n            endOffset = remaining;\n          }\n\n          // Inject marks from up the tree (acc) as well\n          if (typeof token !== 'string' || acc) {\n            const range = node.createDecoration({\n              anchor: {\n                key: startText.key,\n                offset: startOffset,\n              },\n              focus: {\n                key: endText.key,\n                offset: endOffset,\n              },\n              type: TOKEN_MARK,\n              data: { types },\n            });\n\n            decorations.push(range);\n          }\n\n          start = end;\n        } else if (token.content && token.content.length) {\n          // Tokens can be nested\n          for (const subToken of token.content) {\n            processToken(subToken, types);\n          }\n        }\n      }\n\n      // Process top-level tokens\n      for (const token of tokens) {\n        processToken(token);\n      }\n\n      return decorations;\n    },\n  };\n}\n","/* eslint-disable max-len */\nexport const operatorTokens = [\n  { text: '!between', hint: 'Matches the input that is outside the inclusive range.' },\n  { text: 'as', hint: \"Binds a name to the operator's input tabular expression.\" },\n  { text: 'between', hint: 'Matches the input that is inside the inclusive range.' },\n  {\n    text: 'consume',\n    hint:\n      'The `consume` operator consumes the tabular data stream handed to it. It is\\r\\nmostly used for triggering the query side-effect without actually returning\\r\\nthe results back to the caller.',\n  },\n  { text: 'count', hint: 'Returns the number of records in the input record set.' },\n  { text: 'datatable', hint: 'Returns a table whose schema and values are defined in the query itself.' },\n  {\n    text: 'distinct',\n    hint: 'Produces a table with the distinct combination of the provided columns of the input table.',\n  },\n  { text: 'evaluate', hint: 'Invokes a service-side query extension (plugin).' },\n  { text: 'extend', hint: 'Create calculated columns and append them to the result set.' },\n  {\n    text: 'externaldata',\n    hint:\n      'Returns a table whose schema is defined in the query itself, and whose data is read from an external raw file.',\n  },\n  {\n    text: 'facet',\n    hint:\n      'Returns a set of tables, one for each specified column.\\r\\nEach table specifies the list of values taken by its column.\\r\\nAn additional table can be created by using the `with` clause.',\n  },\n  { text: 'find', hint: 'Finds rows that match a predicate across a set of tables.' },\n  { text: 'fork', hint: 'Runs multiple consumer operators in parallel.' },\n  { text: 'getschema', hint: 'Produce a table that represents a tabular schema of the input.' },\n  { text: 'in', hint: 'Filters a recordset based on the provided set of values.' },\n  { text: 'invoke', hint: 'Invokes lambda that receives the source of `invoke` as tabular parameter argument.' },\n  {\n    text: 'join',\n    hint:\n      'Merge the rows of two tables to form a new table by matching values of the specified column(s) from each table.',\n  },\n  { text: 'limit', hint: 'Return up to the specified number of rows.' },\n  { text: 'make-series', hint: 'Create series of specified aggregated values along specified axis.' },\n  { text: 'mvexpand', hint: 'Expands multi-value array or property bag.' },\n  { text: 'order', hint: 'Sort the rows of the input table into order by one or more columns.' },\n  { text: 'parse', hint: 'Evaluates a string expression and parses its value into one or more calculated columns.' },\n  {\n    text: 'print',\n    hint:\n      'Evaluates one or more scalar expressions and inserts the results (as a single-row table with as many columns as there are expressions) into the output.',\n  },\n  { text: 'project', hint: 'Select the columns to include, rename or drop, and insert new computed columns.' },\n  { text: 'project-away', hint: 'Select what  columns to exclude from the input.' },\n  { text: 'project-rename', hint: 'Renames columns in the result output.' },\n  { text: 'range', hint: 'Generates a single-column table of values.' },\n  { text: 'reduce', hint: 'Groups a set of strings together based on values similarity.' },\n  { text: 'render', hint: 'Instructs the user agent to render the results of the query in a particular way.' },\n  { text: 'sample', hint: 'Returns up to the specified number of random rows from the input table.' },\n  {\n    text: 'sample-distinct',\n    hint:\n      'Returns a single column that contains up to the specified number of distinct values of the requested column.',\n  },\n  { text: 'search', hint: 'The search operator provides a multi-table/multi-column search experience.' },\n  { text: 'serialize', hint: 'Marks that order of the input row set is safe for window functions usage.' },\n  { text: 'sort', hint: 'Sort the rows of the input table into order by one or more columns.' },\n  { text: 'summarize', hint: 'Produces a table that aggregates the content of the input table.' },\n  { text: 'take', hint: 'Return up to the specified number of rows.' },\n  { text: 'top', hint: 'Returns the first *N* records sorted by the specified columns.' },\n  {\n    text: 'top-hitters',\n    hint: 'Returns an approximation of the first *N* results (assuming skewed distribution of the input).',\n  },\n  {\n    text: 'top-nested',\n    hint: 'Produces hierarchical top results, where each level is a drill-down based on previous level values.',\n  },\n  { text: 'union', hint: 'Takes two or more tables and returns the rows of all of them.' },\n  { text: 'where', hint: 'Filters a table to the subset of rows that satisfy a predicate.' },\n];\n\nexport const functionTokens = [\n  { text: 'abs', hint: 'Calculates the absolute value of the input.' },\n  {\n    text: 'acos',\n    hint:\n      'Returns the angle whose cosine is the specified number (the inverse operation of [`cos()`](cosfunction.md)) .',\n  },\n  { text: 'ago', hint: 'Subtracts the given timespan from the current UTC clock time.' },\n  { text: 'any', hint: 'Returns random non-empty value from the specified expression values.' },\n  {\n    text: 'arg_max',\n    hint:\n      'Finds a row in the group that maximizes *ExprToMaximize*, and returns the value of *ExprToReturn* (or `*` to return the entire row).',\n  },\n  {\n    text: 'arg_min',\n    hint:\n      'Finds a row in the group that minimizes *ExprToMinimize*, and returns the value of *ExprToReturn* (or `*` to return the entire row).',\n  },\n  {\n    text: 'argmax',\n    hint:\n      'Finds a row in the group that maximizes *ExprToMaximize*, and returns the value of *ExprToReturn* (or `*` to return the entire row).',\n  },\n  {\n    text: 'argmin',\n    hint:\n      'Finds a row in the group that minimizes *ExprToMinimize*, and returns the value of *ExprToReturn* (or `*` to return the entire row).',\n  },\n  { text: 'array_concat', hint: 'Concatenates a number of dynamic arrays to a single array.' },\n  { text: 'array_length', hint: 'Calculates the number of elements in a dynamic array.' },\n  { text: 'array_slice', hint: 'Extracts a slice of a dynamic array.' },\n  {\n    text: 'array_split',\n    hint:\n      'Splits an array to multiple arrays according to the split indices and packs the generated array in a dynamic array.',\n  },\n  {\n    text: 'asin',\n    hint: 'Returns the angle whose sine is the specified number (the inverse operation of [`sin()`](sinfunction.md)) .',\n  },\n  {\n    text: 'assert',\n    hint: 'Checks for a condition; if the condition is false, outputs error messages and fails the query.',\n  },\n  {\n    text: 'atan',\n    hint:\n      'Returns the angle whose tangent is the specified number (the inverse operation of [`tan()`](tanfunction.md)) .',\n  },\n  {\n    text: 'atan2',\n    hint:\n      'Calculates the angle, in radians, between the positive x-axis and the ray from the origin to the point (y, x).',\n  },\n  { text: 'avg', hint: 'Calculates the average of *Expr* across the group.' },\n  {\n    text: 'avgif',\n    hint:\n      'Calculates the [average](avg-aggfunction.md) of *Expr* across the group for which *Predicate* evaluates to `true`.',\n  },\n  { text: 'bag_keys', hint: 'Enumerates all the root keys in a dynamic property-bag object.' },\n  { text: 'base64_decodestring', hint: 'Decodes a base64 string to a UTF-8 string' },\n  { text: 'base64_encodestring', hint: 'Encodes a string as base64 string' },\n  { text: 'beta_cdf', hint: 'Returns the standard cumulative beta distribution function.' },\n  { text: 'beta_inv', hint: 'Returns the inverse of the beta cumulative probability beta density function.' },\n  { text: 'beta_pdf', hint: 'Returns the probability density beta function.' },\n  { text: 'bin', hint: 'Rounds values down to an integer multiple of a given bin size.' },\n  {\n    text: 'bin_at',\n    hint:\n      \"Rounds values down to a fixed-size 'bin', with control over the bin's starting point.\\r\\n(See also [`bin function`](./binfunction.md).)\",\n  },\n  {\n    text: 'bin_auto',\n    hint:\n      \"Rounds values down to a fixed-size 'bin', with control over the bin size and starting point provided by a query property.\",\n  },\n  { text: 'binary_and', hint: 'Returns a result of the bitwise `and` operation between two values.' },\n  { text: 'binary_not', hint: 'Returns a bitwise negation of the input value.' },\n  { text: 'binary_or', hint: 'Returns a result of the bitwise `or` operation of the two values.' },\n  { text: 'binary_shift_left', hint: 'Returns binary shift left operation on a pair of numbers.' },\n  { text: 'binary_shift_right', hint: 'Returns binary shift right operation on a pair of numbers.' },\n  { text: 'binary_xor', hint: 'Returns a result of the bitwise `xor` operation of the two values.' },\n  { text: 'buildschema', hint: 'Returns the minimal schema that admits all values of *DynamicExpr*.' },\n  {\n    text: 'case',\n    hint: 'Evaluates a list of predicates and returns the first result expression whose predicate is satisfied.',\n  },\n  {\n    text: 'ceiling',\n    hint: 'Calculates the smallest integer greater than, or equal to, the specified numeric expression.',\n  },\n  { text: 'cluster', hint: 'Changes the reference of the query to a remote cluster.' },\n  {\n    text: 'coalesce',\n    hint: 'Evaluates a list of expressions and returns the first non-null (or non-empty for string) expression.',\n  },\n  { text: 'cos', hint: 'Returns the cosine function.' },\n  { text: 'cot', hint: 'Calculates the trigonometric cotangent of the specified angle, in radians.' },\n  {\n    text: 'count',\n    hint:\n      'Returns a count of the records per summarization group (or in total if summarization is done without grouping).',\n  },\n  { text: 'countif', hint: 'Returns a count of rows for which *Predicate* evaluates to `true`.' },\n  {\n    text: 'countof',\n    hint: 'Counts occurrences of a substring in a string. Plain string matches may overlap; regex matches do not.',\n  },\n  { text: 'current_principal', hint: 'Returns the current principal running this query.' },\n  {\n    text: 'cursor_after',\n    hint: 'A predicate over the records of a table to compare their ingestion time\\r\\nagainst a database cursor.',\n  },\n  {\n    text: 'cursor_before_or_at',\n    hint: 'A predicate over the records of a table to compare their ingestion time\\r\\nagainst a database cursor.',\n  },\n  { text: 'database', hint: 'Changes the reference of the query to a specific database within the cluster scope.' },\n  {\n    text: 'datetime_add',\n    hint:\n      'Calculates a new [datetime](./scalar-data-types/datetime.md) from a specified datepart multiplied by a specified amount, added to a specified [datetime](./scalar-data-types/datetime.md).',\n  },\n  {\n    text: 'datetime_diff',\n    hint: 'Calculates calendarian difference between two [datetime](./scalar-data-types/datetime.md) values.',\n  },\n  { text: 'datetime_part', hint: 'Extracts the requested date part as an integer value.' },\n  { text: 'dayofmonth', hint: 'Returns the integer number representing the day number of the given month' },\n  { text: 'dayofweek', hint: 'Returns the integer number of days since the preceding Sunday, as a `timespan`.' },\n  { text: 'dayofyear', hint: 'Returns the integer number represents the day number of the given year.' },\n  { text: 'dcount', hint: 'Returns an estimate of the number of distinct values of *Expr* in the group.' },\n  {\n    text: 'dcount_hll',\n    hint:\n      'Calculates the dcount from hll results (which was generated by [hll](hll-aggfunction.md) or [hll_merge](hll-merge-aggfunction.md)).',\n  },\n  {\n    text: 'dcountif',\n    hint:\n      'Returns an estimate of the number of distinct values of *Expr* of rows for which *Predicate* evaluates to `true`.',\n  },\n  {\n    text: 'degrees',\n    hint:\n      'Converts angle value in radians into value in degrees, using formula `degrees = (180 / PI ) * angle_in_radians`',\n  },\n  { text: 'distance', hint: 'Returns the distance between two points in meters.' },\n  { text: 'endofday', hint: 'Returns the end of the day containing the date, shifted by an offset, if provided.' },\n  { text: 'endofmonth', hint: 'Returns the end of the month containing the date, shifted by an offset, if provided.' },\n  { text: 'endofweek', hint: 'Returns the end of the week containing the date, shifted by an offset, if provided.' },\n  { text: 'endofyear', hint: 'Returns the end of the year containing the date, shifted by an offset, if provided.' },\n  {\n    text: 'estimate_data_size',\n    hint: 'Returns an estimated data size of the selected columns of the tabular expression.',\n  },\n  { text: 'exp', hint: 'The base-e exponential function of x, which is e raised to the power x: e^x.' },\n  {\n    text: 'exp10',\n    hint: 'The base-10 exponential function of x, which is 10 raised to the power x: 10^x.  \\r\\n**Syntax**',\n  },\n  { text: 'exp2', hint: 'The base-2 exponential function of x, which is 2 raised to the power x: 2^x.' },\n  {\n    text: 'extent_id',\n    hint: 'Returns a unique identifier that identifies the data shard (\"extent\") that the current record resides in.',\n  },\n  {\n    text: 'extent_tags',\n    hint:\n      'Returns a dynamic array with the [tags](../management/extents-overview.md#extent-tagging) of the data shard (\"extent\") that the current record resides in.',\n  },\n  { text: 'extract', hint: 'Get a match for a [regular expression](./re2.md) from a text string.' },\n  { text: 'extract_all', hint: 'Get all matches for a [regular expression](./re2.md) from a text string.' },\n  { text: 'extractjson', hint: 'Get a specified element out of a JSON text using a path expression.' },\n  { text: 'floor', hint: 'An alias for [`bin()`](binfunction.md).' },\n  { text: 'format_datetime', hint: 'Formats a datetime parameter based on the format pattern parameter.' },\n  { text: 'format_timespan', hint: 'Formats a timespan parameter based on the format pattern parameter.' },\n  { text: 'gamma', hint: 'Computes [gamma function](https://en.wikipedia.org/wiki/Gamma_function)' },\n  { text: 'getmonth', hint: 'Get the month number (1-12) from a datetime.' },\n  { text: 'gettype', hint: 'Returns the runtime type of its single argument.' },\n  { text: 'getyear', hint: 'Returns the year part of the `datetime` argument.' },\n  { text: 'hash', hint: 'Returns a hash value for the input value.' },\n  { text: 'hash_sha256', hint: 'Returns a sha256 hash value for the input value.' },\n  { text: 'hll', hint: 'Calculates the Intermediate results of [dcount](dcount-aggfunction.md) across the group.' },\n  {\n    text: 'hll_merge',\n    hint: 'Merges hll results (scalar version of the aggregate version [`hll_merge()`](hll-merge-aggfunction.md)).',\n  },\n  { text: 'hourofday', hint: 'Returns the integer number representing the hour number of the given date' },\n  {\n    text: 'iff',\n    hint:\n      'Evaluates the first argument (the predicate), and returns the value of either the second or third arguments, depending on whether the predicate evaluated to `true` (second) or `false` (third).',\n  },\n  {\n    text: 'iif',\n    hint:\n      'Evaluates the first argument (the predicate), and returns the value of either the second or third arguments, depending on whether the predicate evaluated to `true` (second) or `false` (third).',\n  },\n  {\n    text: 'indexof',\n    hint: 'Function reports the zero-based index of the first occurrence of a specified string within input string.',\n  },\n  { text: 'ingestion_time', hint: \"Retrieves the record's `$IngestionTime` hidden `datetime` column, or null.\" },\n  {\n    text: 'iscolumnexists',\n    hint:\n      'Returns a boolean value indicating if the given string argument exists in the schema produced by the preceding tabular operator.',\n  },\n  { text: 'isempty', hint: 'Returns `true` if the argument is an empty string or is null.' },\n  { text: 'isfinite', hint: 'Returns whether input is a finite value (is neither infinite nor NaN).' },\n  { text: 'isinf', hint: 'Returns whether input is an infinite (positive or negative) value.' },\n  { text: 'isnan', hint: 'Returns whether input is Not-a-Number (NaN) value.' },\n  { text: 'isnotempty', hint: 'Returns `true` if the argument is not an empty string nor it is a null.' },\n  { text: 'isnotnull', hint: 'Returns `true` if the argument is not null.' },\n  {\n    text: 'isnull',\n    hint:\n      'Evaluates its sole argument and returns a `bool` value indicating if the argument evaluates to a null value.',\n  },\n  { text: 'log', hint: 'Returns the natural logarithm function.' },\n  { text: 'log10', hint: 'Returns the common (base-10) logarithm function.' },\n  { text: 'log2', hint: 'Returns the base-2 logarithm function.' },\n  {\n    text: 'loggamma',\n    hint: 'Computes log of absolute value of the [gamma function](https://en.wikipedia.org/wiki/Gamma_function)',\n  },\n  {\n    text: 'make_datetime',\n    hint: 'Creates a [datetime](./scalar-data-types/datetime.md) scalar value from the specified date and time.',\n  },\n  {\n    text: 'make_dictionary',\n    hint: 'Returns a `dynamic` (JSON) property-bag (dictionary) of all the values of *Expr* in the group.',\n  },\n  { text: 'make_string', hint: 'Returns the string generated by the Unicode characters.' },\n  {\n    text: 'make_timespan',\n    hint: 'Creates a [timespan](./scalar-data-types/timespan.md) scalar value from the specified time period.',\n  },\n  { text: 'makelist', hint: 'Returns a `dynamic` (JSON) array of all the values of *Expr* in the group.' },\n  {\n    text: 'makeset',\n    hint: 'Returns a `dynamic` (JSON) array of the set of distinct values that *Expr* takes in the group.',\n  },\n  {\n    text: 'materialize',\n    hint:\n      'Allows caching a sub-query result during the time of query execution in a way that other subqueries can reference the partial result.',\n  },\n  { text: 'max', hint: 'Returns the maximum value across the group.' },\n  { text: 'max_of', hint: 'Returns the maximum value of several evaluated numeric expressions.' },\n  {\n    text: 'merge_tdigests',\n    hint:\n      'Merges tdigest results (scalar version of the aggregate version [`merge_tdigests()`](merge-tdigests-aggfunction.md)).',\n  },\n  { text: 'min', hint: 'Returns the minimum value agross the group.' },\n  { text: 'min_of', hint: 'Returns the minimum value of several evaluated numeric expressions.' },\n  { text: 'monthofyear', hint: 'Returns the integer number represents the month number of the given year.' },\n  {\n    text: 'next',\n    hint:\n      'Returns the value of a column in a row that it at some offset following the\\r\\ncurrent row in a [serialized row set](./windowsfunctions.md#serialized-row-set).',\n  },\n  { text: 'not', hint: 'Reverses the value of its `bool` argument.' },\n  {\n    text: 'now',\n    hint:\n      'Returns the current UTC clock time, optionally offset by a given timespan.\\r\\nThis function can be used multiple times in a statement and the clock time being referenced will be the same for all instances.',\n  },\n  { text: 'pack', hint: 'Creates a `dynamic` object (property bag) from a list of names and values.' },\n  {\n    text: 'pack_all',\n    hint: 'Creates a `dynamic` object (property bag) from all the columns of the tabular expression.',\n  },\n  { text: 'pack_array', hint: 'Packs all input values into a dynamic array.' },\n  { text: 'parse_ipv4', hint: 'Converts input to integer (signed 64-bit) number representation.' },\n  {\n    text: 'parse_json',\n    hint:\n      'Interprets a `string` as a [JSON value](https://json.org/)) and returns the value as [`dynamic`](./scalar-data-types/dynamic.md). \\r\\nIt is superior to using [extractjson() function](./extractjsonfunction.md)\\r\\nwhen you need to extract more than one element of a JSON compound object.',\n  },\n  {\n    text: 'parse_path',\n    hint:\n      'Parses a file path `string` and returns a [`dynamic`](./scalar-data-types/dynamic.md) object that contains the following parts of the path: \\r\\nScheme, RootPath, DirectoryPath, DirectoryName, FileName, Extension, AlternateDataStreamName.\\r\\nIn addition to the simple paths with both types of slashes, supports paths with schemas (e.g. \"file://...\"), shared paths (e.g. \"\\\\\\\\shareddrive\\\\users...\"), long paths (e.g \"\\\\\\\\?\\\\C:...\"\"), alternate data streams (e.g. \"file1.exe:file2.exe\")',\n  },\n  {\n    text: 'parse_url',\n    hint:\n      'Parses an absolute URL `string` and returns a [`dynamic`](./scalar-data-types/dynamic.md) object contains all parts of the URL (Scheme, Host, Port, Path, Username, Password, Query Parameters, Fragment).',\n  },\n  {\n    text: 'parse_urlquery',\n    hint:\n      'Parses a url query `string` and returns a [`dynamic`](./scalar-data-types/dynamic.md) object contains the Query parameters.',\n  },\n  {\n    text: 'parse_user_agent',\n    hint:\n      \"Interprets a user-agent string, which identifies the user's browser and provides certain system details to servers hosting the websites the user visits. The result is returned as [`dynamic`](./scalar-data-types/dynamic.md).\",\n  },\n  { text: 'parse_version', hint: 'Converts input string representation of version to a comparable decimal number.' },\n  {\n    text: 'parse_xml',\n    hint:\n      'Interprets a `string` as a XML value, converts the value to a [JSON value](https://json.org/) and returns the value as  [`dynamic`](./scalar-data-types/dynamic.md).',\n  },\n  {\n    text: 'percentile',\n    hint:\n      'Returns an estimate for the specified [nearest-rank percentile](#nearest-rank-percentile) of the population defined by *Expr*. \\r\\nThe accuracy depends on the density of population in the region of the percentile.',\n  },\n  {\n    text: 'percentile_tdigest',\n    hint:\n      'Calculates the percentile result from tdigest results (which was generated by [tdigest](tdigest-aggfunction.md) or [merge-tdigests](merge-tdigests-aggfunction.md))',\n  },\n  {\n    text: 'percentrank_tdigest',\n    hint:\n      \"Calculates the approximate rank of the value in a set where rank is expressed as percentage of set's size. \\r\\nThis function can be viewed as the inverse of the percentile.\",\n  },\n  { text: 'pi', hint: 'Returns the constant value of Pi ().' },\n  { text: 'point', hint: 'Returns a dynamic array representation of a point.' },\n  { text: 'pow', hint: 'Returns a result of raising to power' },\n  {\n    text: 'prev',\n    hint:\n      'Returns the value of a column in a row that it at some offset prior to the\\r\\ncurrent row in a [serialized row set](./windowsfunctions.md#serialized-row-set).',\n  },\n  {\n    text: 'radians',\n    hint:\n      'Converts angle value in degrees into value in radians, using formula `radians = (PI / 180 ) * angle_in_degrees`',\n  },\n  { text: 'rand', hint: 'Returns a random number.' },\n  { text: 'range', hint: 'Generates a dynamic array holding a series of equally-spaced values.' },\n  { text: 'repeat', hint: 'Generates a dynamic array holding a series of equal values.' },\n  { text: 'replace', hint: 'Replace all regex matches with another string.' },\n  { text: 'reverse', hint: 'Function makes reverse of input string.' },\n  { text: 'round', hint: 'Returns the rounded source to the specified precision.' },\n  {\n    text: 'row_cumsum',\n    hint:\n      'Calculates the cumulative sum of a column in a [serialized row set](./windowsfunctions.md#serialized-row-set).',\n  },\n  {\n    text: 'row_number',\n    hint:\n      \"Returns the current row's index in a [serialized row set](./windowsfunctions.md#serialized-row-set).\\r\\nThe row index starts by default at `1` for the first row, and is incremented by `1` for each additional row.\\r\\nOptionally, the row index can start at a different value than `1`.\\r\\nAdditionally, the row index may be reset according to some provided predicate.\",\n  },\n  { text: 'series_add', hint: 'Calculates the element-wise addition of two numeric series inputs.' },\n  { text: 'series_decompose', hint: 'Applies a decomposition transformation on a series.' },\n  {\n    text: 'series_decompose_anomalies',\n    hint:\n      'Anomaly Detection based on series decomposition (refer to [series_decompose()](series-decomposefunction.md))',\n  },\n  { text: 'series_decompose_forecast', hint: 'Forecast based on series decomposition.' },\n  { text: 'series_divide', hint: 'Calculates the element-wise division of two numeric series inputs.' },\n  {\n    text: 'series_equals',\n    hint: 'Calculates the element-wise equals (`==`) logic operation of two numeric series inputs.',\n  },\n  { text: 'series_fill_backward', hint: 'Performs backward fill interpolation of missing values in a series.' },\n  { text: 'series_fill_const', hint: 'Replaces missing values in a series with a specified constant value.' },\n  { text: 'series_fill_forward', hint: 'Performs forward fill interpolation of missing values in a series.' },\n  { text: 'series_fill_linear', hint: 'Performs linear interpolation of missing values in a series.' },\n  { text: 'series_fir', hint: 'Applies a Finite Impulse Response filter on a series.' },\n  {\n    text: 'series_fit_2lines',\n    hint: 'Applies two segments linear regression on a series, returning multiple columns.',\n  },\n  {\n    text: 'series_fit_2lines_dynamic',\n    hint: 'Applies two segments linear regression on a series, returning dynamic object.',\n  },\n  { text: 'series_fit_line', hint: 'Applies linear regression on a series, returning multiple columns.' },\n  { text: 'series_fit_line_dynamic', hint: 'Applies linear regression on a series, returning dynamic object.' },\n  {\n    text: 'series_greater',\n    hint: 'Calculates the element-wise greater (`>`) logic operation of two numeric series inputs.',\n  },\n  {\n    text: 'series_greater_equals',\n    hint: 'Calculates the element-wise greater or equals (`>=`) logic operation of two numeric series inputs.',\n  },\n  { text: 'series_iir', hint: 'Applies a Infinite Impulse Response filter on a series.' },\n  { text: 'series_less', hint: 'Calculates the element-wise less (`<`) logic operation of two numeric series inputs.' },\n  {\n    text: 'series_less_equals',\n    hint: 'Calculates the element-wise less or equal (`<=`) logic operation of two numeric series inputs.',\n  },\n  { text: 'series_multiply', hint: 'Calculates the element-wise multiplication of two numeric series inputs.' },\n  {\n    text: 'series_not_equals',\n    hint: 'Calculates the element-wise not equals (`!=`) logic operation of two numeric series inputs.',\n  },\n  { text: 'series_outliers', hint: 'Scores anomaly points in a series.' },\n  { text: 'series_periods_detect', hint: 'Finds the most significant periods that exist in a time series.' },\n  {\n    text: 'series_periods_validate',\n    hint: 'Checks whether a time series contains periodic patterns of given lengths.',\n  },\n  {\n    text: 'series_seasonal',\n    hint: 'Calculates the seasonal component of a series according to the detected or given seasonal period.',\n  },\n  { text: 'series_stats', hint: 'Returns statistics for a series in multiple columns.' },\n  { text: 'series_stats_dynamic', hint: 'Returns statistics for a series in dynamic object.' },\n  { text: 'series_subtract', hint: 'Calculates the element-wise subtraction of two numeric series inputs.' },\n  { text: 'sign', hint: 'Sign of a numeric expression' },\n  { text: 'sin', hint: 'Returns the sine function.' },\n  {\n    text: 'split',\n    hint:\n      'Splits a given string according to a given delimiter and returns a string array with the contained substrings.',\n  },\n  { text: 'sqrt', hint: 'Returns the square root function.' },\n  { text: 'startofday', hint: 'Returns the start of the day containing the date, shifted by an offset, if provided.' },\n  {\n    text: 'startofmonth',\n    hint: 'Returns the start of the month containing the date, shifted by an offset, if provided.',\n  },\n  {\n    text: 'startofweek',\n    hint: 'Returns the start of the week containing the date, shifted by an offset, if provided.',\n  },\n  {\n    text: 'startofyear',\n    hint: 'Returns the start of the year containing the date, shifted by an offset, if provided.',\n  },\n  {\n    text: 'stdev',\n    hint:\n      'Calculates the standard deviation of *Expr* across the group, considering the group as a [sample](https://en.wikipedia.org/wiki/Sample_%28statistics%29).',\n  },\n  {\n    text: 'stdevif',\n    hint:\n      'Calculates the [stdev](stdev-aggfunction.md) of *Expr* across the group for which *Predicate* evaluates to `true`.',\n  },\n  {\n    text: 'stdevp',\n    hint:\n      'Calculates the standard deviation of *Expr* across the group, considering the group as a [population](https://en.wikipedia.org/wiki/Statistical_population).',\n  },\n  { text: 'strcat', hint: 'Concatenates between 1 and 64 arguments.' },\n  { text: 'strcat_array', hint: 'Creates a concatenated string of array values using specified delimiter.' },\n  {\n    text: 'strcat_delim',\n    hint: 'Concatenates between 2 and 64 arguments, with delimiter, provided as first argument.',\n  },\n  { text: 'strcmp', hint: 'Compares two strings.' },\n  { text: 'string_size', hint: 'Returns the size, in bytes, of the input string.' },\n  { text: 'strlen', hint: 'Returns the length, in characters, of the input string.' },\n  { text: 'strrep', hint: 'Repeats given [string](./scalar-data-types/string.md) provided amount of times.' },\n  {\n    text: 'substring',\n    hint: 'Extracts a substring from a source string starting from some index to the end of the string.',\n  },\n  { text: 'sum', hint: 'Calculates the sum of *Expr* across the group.' },\n  { text: 'sumif', hint: 'Returns a sum of *Expr* for which *Predicate* evaluates to `true`.' },\n  { text: 'table', hint: 'References specific table using an query-time evaluated string-expression.' },\n  { text: 'tan', hint: 'Returns the tangent function.' },\n  {\n    text: 'tdigest',\n    hint: 'Calculates the Intermediate results of [`percentiles()`](percentiles-aggfunction.md) across the group.',\n  },\n  {\n    text: 'tdigest_merge',\n    hint:\n      'Merges tdigest results (scalar version of the aggregate version [`tdigest_merge()`](tdigest-merge-aggfunction.md)).',\n  },\n  { text: 'tobool', hint: 'Converts input to boolean (signed 8-bit) representation.' },\n  { text: 'todatetime', hint: 'Converts input to [datetime](./scalar-data-types/datetime.md) scalar.' },\n  { text: 'todecimal', hint: 'Converts input to decimal number representation.' },\n  {\n    text: 'todouble',\n    hint: 'Converts the input to a value of type `real`. (`todouble()` and `toreal()` are synonyms.)',\n  },\n  {\n    text: 'todynamic',\n    hint:\n      'Interprets a `string` as a [JSON value](https://json.org/) and returns the value as [`dynamic`](./scalar-data-types/dynamic.md).',\n  },\n  { text: 'toguid', hint: 'Converts input to [`guid`](./scalar-data-types/guid.md) representation.' },\n  { text: 'tohex', hint: 'Converts input to a hexadecimal string.' },\n  { text: 'toint', hint: 'Converts input to integer (signed 32-bit) number representation.' },\n  { text: 'tolong', hint: 'Converts input to long (signed 64-bit) number representation.' },\n  { text: 'tolower', hint: 'Converts input string to lower case.' },\n  { text: 'toscalar', hint: 'Returns a scalar constant value of the evaluated expression.' },\n  { text: 'tostring', hint: 'Converts input to a string representation.' },\n  { text: 'totimespan', hint: 'Converts input  to [timespan](./scalar-data-types/timespan.md) scalar.' },\n  { text: 'toupper', hint: 'Converts a string to upper case.' },\n  {\n    text: 'translate',\n    hint:\n      \"Replaces a set of characters ('searchList') with another set of characters ('replacementList') in a given a string.\\r\\nThe function searches for characters in the 'searchList' and replaces them with the corresponding characters in 'replacementList'\",\n  },\n  { text: 'treepath', hint: 'Enumerates all the path expressions that identify leaves in a dynamic object.' },\n  { text: 'trim', hint: 'Removes all leading and trailing matches of the specified regular expression.' },\n  { text: 'trim_end', hint: 'Removes trailing match of the specified regular expression.' },\n  { text: 'trim_start', hint: 'Removes leading match of the specified regular expression.' },\n  { text: 'url_decode', hint: 'The function converts encoded URL into a to regular URL representation.' },\n  {\n    text: 'url_encode',\n    hint: 'The function converts characters of the input URL into a format that can be transmitted over the Internet.',\n  },\n  {\n    text: 'variance',\n    hint:\n      'Calculates the variance of *Expr* across the group, considering the group as a [sample](https://en.wikipedia.org/wiki/Sample_%28statistics%29).',\n  },\n  {\n    text: 'varianceif',\n    hint:\n      'Calculates the [variance](variance-aggfunction.md) of *Expr* across the group for which *Predicate* evaluates to `true`.',\n  },\n  {\n    text: 'variancep',\n    hint:\n      'Calculates the variance of *Expr* across the group, considering the group as a [population](https://en.wikipedia.org/wiki/Statistical_population).',\n  },\n  { text: 'weekofyear', hint: 'Returns the integer number represents the week number.' },\n  {\n    text: 'welch_test',\n    hint: 'Computes the p_value of the [Welch-test function](https://en.wikipedia.org/wiki/Welch%27s_t-test)',\n  },\n  {\n    text: 'zip',\n    hint:\n      'The `zip` function accepts any number of `dynamic` arrays, and returns an\\r\\narray whose elements are each an array holding the elements of the input\\r\\narrays of the same index.',\n  },\n];\n\nexport const KEYWORDS = [\n  'by',\n  'on',\n  'contains',\n  'notcontains',\n  'containscs',\n  'notcontainscs',\n  'startswith',\n  'has',\n  'matches',\n  'regex',\n  'true',\n  'false',\n  'and',\n  'or',\n  'typeof',\n  'int',\n  'string',\n  'date',\n  'datetime',\n  'time',\n  'long',\n  'real',\n  'boolean',\n  'bool',\n];\n\nexport const grafanaMacros = [\n  {\n    text: '$__timeFilter',\n    display: '$__timeFilter()',\n    hint: 'Macro that uses the selected timerange in Grafana to filter the query.',\n  },\n  {\n    text: '$__timeTo',\n    display: '$__timeTo()',\n    hint: 'Returns the From datetime from the Grafana picker. Example: datetime(2018-06-05T20:09:58.907Z).',\n  },\n  {\n    text: '$__timeFrom',\n    display: '$__timeFrom()',\n    hint: 'Returns the From datetime from the Grafana picker. Example: datetime(2018-06-05T18:09:58.907Z).',\n  },\n  {\n    text: '$__escapeMulti',\n    display: '$__escapeMulti()',\n    hint: 'Macro to escape multi-value template variables that contain illegal characters.',\n  },\n  { text: '$__contains', display: '$__contains()', hint: 'Macro for multi-value template variables.' },\n];\n\n// Kusto operators\n// export const OPERATORS = ['+', '-', '*', '/', '>', '<', '==', '<>', '<=', '>=', '~', '!~'];\n\nexport const DURATION = ['SECONDS', 'MINUTES', 'HOURS', 'DAYS', 'WEEKS', 'MONTHS', 'YEARS'];\n\nconst tokenizer = {\n  comment: {\n    pattern: /(^|[^\\\\:])\\/\\/.*/,\n    lookbehind: true,\n    greedy: true,\n  },\n  'function-context': {\n    pattern: /[a-z0-9_]+\\([^)]*\\)?/i,\n    inside: {},\n  },\n  duration: {\n    pattern: new RegExp(`${DURATION.join('?|')}?`, 'i'),\n    alias: 'number',\n  },\n  builtin: new RegExp(`\\\\b(?:${functionTokens.map(f => f.text).join('|')})(?=\\\\s*\\\\()`, 'i'),\n  string: {\n    pattern: /([\"'])(?:\\\\(?:\\r\\n|[\\s\\S])|(?!\\1)[^\\\\\\r\\n])*\\1/,\n    greedy: true,\n  },\n  keyword: new RegExp(`\\\\b(?:${KEYWORDS.join('|')}|${operatorTokens.map(f => f.text).join('|')}|\\\\*)\\\\b`, 'i'),\n  boolean: /\\b(?:true|false)\\b/,\n  number: /\\b0x[\\da-f]+\\b|(?:\\b\\d+\\.?\\d*|\\B\\.\\d+)(?:e[+-]?\\d+)?/i,\n  operator: /-|\\+|\\*|\\/|>|<|==|<=?|>=?|<>|!~|~|=|\\|/,\n  punctuation: /[{};(),.:]/,\n  variable: /(\\[\\[(.+?)\\]\\])|(\\$(.+?))\\b/,\n};\n\ntokenizer['function-context'].inside = {\n  argument: {\n    pattern: /[a-z0-9_]+(?=:)/i,\n    alias: 'symbol',\n  },\n  duration: tokenizer.duration,\n  number: tokenizer.number,\n  builtin: tokenizer.builtin,\n  string: tokenizer.string,\n  variable: tokenizer.variable,\n};\n\n// console.log(tokenizer.builtin);\n\nexport default tokenizer;\n\n// function escapeRegExp(str: string): string {\n//   return str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n// }\n","import _ from 'lodash';\nimport Plain from 'slate-plain-serializer';\n\nimport QueryField from './query_field';\nimport debounce from 'lodash/debounce';\nimport { DOMUtil } from '@grafana/ui';\nimport { Editor as CoreEditor } from 'slate';\n\nimport { KEYWORDS, functionTokens, operatorTokens, grafanaMacros } from './kusto/kusto';\n// import '../sass/editor.base.scss';\n\nconst TYPEAHEAD_DELAY = 100;\n\ninterface Suggestion {\n  text: string;\n  deleteBackwards?: number;\n  type?: string;\n}\n\ninterface SuggestionGroup {\n  label: string;\n  items: Suggestion[];\n  prefixMatch?: boolean;\n  skipFilter?: boolean;\n}\n\ninterface KustoSchema {\n  Databases: {\n    Default: KustoDBSchema;\n  };\n  Plugins?: any[];\n}\n\ninterface KustoDBSchema {\n  Name?: string;\n  Functions?: any;\n  Tables?: any;\n}\n\nconst defaultSchema: any = () => ({\n  Databases: {\n    Default: {},\n  },\n});\n\nconst cleanText = (s: string) => s.replace(/[{}[\\]=\"(),!~+\\-*/^%]/g, '').trim();\nconst wrapText = (text: string) => ({ text });\n\nexport default class KustoQueryField extends QueryField {\n  fields: any;\n  events: any;\n  schema: KustoSchema;\n\n  constructor(props: any, context: any) {\n    super(props, context);\n    this.schema = defaultSchema();\n\n    this.onTypeahead = debounce(this.onTypeahead, TYPEAHEAD_DELAY);\n  }\n\n  componentDidMount() {\n    super.componentDidMount();\n    this.fetchSchema();\n  }\n\n  onTypeahead = (force = false) => {\n    const selection = window.getSelection();\n\n    if (selection && selection.anchorNode) {\n      const wrapperNode = selection.anchorNode.parentElement;\n      if (wrapperNode === null) {\n        return;\n      }\n      const editorNode = wrapperNode.closest('.slate-query-field');\n      if (!editorNode || this.state.value.isBlurred) {\n        // Not inside this editor\n        return;\n      }\n\n      // DOM ranges\n      const range = selection.getRangeAt(0);\n      const text = selection.anchorNode.textContent;\n      if (text === null) {\n        return;\n      }\n      const offset = range.startOffset;\n      let prefix = cleanText(text.substr(0, offset));\n\n      // Model ranges\n      const modelOffset = this.state.value.anchorOffset;\n      const modelPrefix = this.state.value.anchorText.text.slice(0, modelOffset);\n\n      // Determine candidates by context\n      let suggestionGroups: SuggestionGroup[] = [];\n      const wrapperClasses = wrapperNode.classList;\n      let typeaheadContext: string | null = null;\n\n      // Built-in functions\n      if (wrapperClasses.contains('function-context')) {\n        typeaheadContext = 'context-function';\n        suggestionGroups = this.getColumnSuggestions();\n\n        // where\n      } else if (modelPrefix.match(/(where\\s(\\w+\\b)?$)/i)) {\n        typeaheadContext = 'context-where';\n        suggestionGroups = this.getColumnSuggestions();\n\n        // summarize by\n      } else if (modelPrefix.match(/(summarize\\s(\\w+\\b)?$)/i)) {\n        typeaheadContext = 'context-summarize';\n        suggestionGroups = this.getFunctionSuggestions();\n      } else if (modelPrefix.match(/(summarize\\s(.+\\s)?by\\s+([^,\\s]+,\\s*)*([^,\\s]+\\b)?$)/i)) {\n        typeaheadContext = 'context-summarize-by';\n        suggestionGroups = this.getColumnSuggestions();\n\n        // order by, top X by, ... by ...\n      } else if (modelPrefix.match(/(by\\s+([^,\\s]+,\\s*)*([^,\\s]+\\b)?$)/i)) {\n        typeaheadContext = 'context-by';\n        suggestionGroups = this.getColumnSuggestions();\n\n        // join\n      } else if (modelPrefix.match(/(on\\s(.+\\b)?$)/i)) {\n        typeaheadContext = 'context-join-on';\n        suggestionGroups = this.getColumnSuggestions();\n      } else if (modelPrefix.match(/(join\\s+(\\(\\s+)?(\\w+\\b)?$)/i)) {\n        typeaheadContext = 'context-join';\n        suggestionGroups = this.getTableSuggestions();\n\n        // distinct\n      } else if (modelPrefix.match(/(distinct\\s(.+\\b)?$)/i)) {\n        typeaheadContext = 'context-distinct';\n        suggestionGroups = this.getColumnSuggestions();\n\n        // database()\n      } else if (modelPrefix.match(/(database\\(\\\"(\\w+)\\\"\\)\\.(.+\\b)?$)/i)) {\n        typeaheadContext = 'context-database-table';\n        const db = this.getDBFromDatabaseFunction(modelPrefix);\n        suggestionGroups = this.getTableSuggestions(db);\n        prefix = prefix.replace('.', '');\n\n        // new\n      } else if (normalizeQuery(Plain.serialize(this.state.value)).match(/^\\s*\\w*$/i)) {\n        typeaheadContext = 'context-new';\n        if (this.schema) {\n          suggestionGroups = this.getInitialSuggestions();\n        } else {\n          this.fetchSchema();\n          setTimeout(this.onTypeahead, 0);\n          return;\n        }\n\n        // built-in\n      } else if (prefix && !wrapperClasses.contains('argument') && !force) {\n        // Use only last typed word as a prefix for searching\n        if (modelPrefix.match(/\\s$/i)) {\n          prefix = '';\n          return;\n        }\n        prefix = getLastWord(prefix);\n        typeaheadContext = 'context-builtin';\n        suggestionGroups = this.getKeywordSuggestions();\n      } else if (force === true) {\n        typeaheadContext = 'context-builtin-forced';\n        if (modelPrefix.match(/\\s$/i)) {\n          prefix = '';\n        }\n        suggestionGroups = this.getKeywordSuggestions();\n      }\n\n      let results = 0;\n      prefix = prefix.toLowerCase();\n      const filteredSuggestions = suggestionGroups\n        .map(group => {\n          if (group.items && prefix && !group.skipFilter) {\n            group.items = group.items.filter(c => c.text.length >= prefix.length);\n            if (group.prefixMatch) {\n              group.items = group.items.filter(c => c.text.toLowerCase().indexOf(prefix) === 0);\n            } else {\n              group.items = group.items.filter(c => c.text.toLowerCase().indexOf(prefix) > -1);\n            }\n          }\n          results += group.items.length;\n          return group;\n        })\n        .filter(group => group.items.length > 0);\n\n      // console.log('onTypeahead', selection.anchorNode, wrapperClasses, text, offset, prefix, typeaheadContext);\n      // console.log('onTypeahead', prefix, typeaheadContext, force);\n\n      this.setState({\n        typeaheadPrefix: prefix,\n        typeaheadContext,\n        typeaheadText: text,\n        suggestions: results > 0 ? filteredSuggestions : [],\n      });\n    }\n  };\n\n  applyTypeahead = (editor: CoreEditor, suggestion: { text: any; type: string; deleteBackwards: any }): CoreEditor => {\n    const { typeaheadPrefix, typeaheadContext, typeaheadText } = this.state;\n    let suggestionText = suggestion.text || suggestion;\n    const move = 0;\n\n    // Modify suggestion based on context\n\n    const nextChar = DOMUtil.getNextCharacter();\n    if (suggestion.type === 'function') {\n      if (!nextChar || nextChar !== '(') {\n        suggestionText += '(';\n      }\n    } else if (typeaheadContext === 'context-function') {\n      if (!nextChar || nextChar !== ')') {\n        suggestionText += ')';\n      }\n    } else {\n      if (!nextChar || nextChar !== ' ') {\n        suggestionText += ' ';\n      }\n    }\n\n    // Remove the current, incomplete text and replace it with the selected suggestion\n    const backward = suggestion.deleteBackwards || typeaheadPrefix.length;\n    const text = cleanText(typeaheadText);\n    const suffixLength = text.length - typeaheadPrefix.length;\n    const offset = typeaheadText.indexOf(typeaheadPrefix);\n    const midWord = typeaheadPrefix && ((suffixLength > 0 && offset > -1) || suggestionText === typeaheadText);\n    const forward = midWord ? suffixLength + offset : 0;\n\n    this.resetTypeahead(() =>\n      editor\n        .deleteBackward(backward)\n        .deleteForward(forward)\n        .insertText(suggestionText)\n        .moveForward(move)\n        .focus()\n    );\n\n    return editor;\n  };\n\n  // private _getFieldsSuggestions(): SuggestionGroup[] {\n  //   return [\n  //     {\n  //       prefixMatch: true,\n  //       label: 'Fields',\n  //       items: this.fields.map(wrapText)\n  //     },\n  //     {\n  //       prefixMatch: true,\n  //       label: 'Variables',\n  //       items: this.props.templateVariables.map(wrapText)\n  //     }\n  //   ];\n  // }\n\n  // private _getAfterFromSuggestions(): SuggestionGroup[] {\n  //   return [\n  //     {\n  //       skipFilter: true,\n  //       label: 'Events',\n  //       items: this.events.map(wrapText)\n  //     },\n  //     {\n  //       prefixMatch: true,\n  //       label: 'Variables',\n  //       items: this.props.templateVariables\n  //         .map(wrapText)\n  //         .map(suggestion => {\n  //           suggestion.deleteBackwards = 0;\n  //           return suggestion;\n  //         })\n  //     }\n  //   ];\n  // }\n\n  // private _getAfterSelectSuggestions(): SuggestionGroup[] {\n  //   return [\n  //     {\n  //       prefixMatch: true,\n  //       label: 'Fields',\n  //       items: this.fields.map(wrapText)\n  //     },\n  //     {\n  //       prefixMatch: true,\n  //       label: 'Functions',\n  //       items: FUNCTIONS.map((s: any) => { s.type = 'function'; return s; })\n  //     },\n  //     {\n  //       prefixMatch: true,\n  //       label: 'Variables',\n  //       items: this.props.templateVariables.map(wrapText)\n  //     }\n  //   ];\n  // }\n\n  private getInitialSuggestions(): SuggestionGroup[] {\n    return this.getTableSuggestions();\n  }\n\n  private getKeywordSuggestions(): SuggestionGroup[] {\n    return [\n      {\n        prefixMatch: true,\n        label: 'Keywords',\n        items: KEYWORDS.map(wrapText),\n      },\n      {\n        prefixMatch: true,\n        label: 'Operators',\n        items: operatorTokens,\n      },\n      {\n        prefixMatch: true,\n        label: 'Functions',\n        items: functionTokens.map((s: any) => {\n          s.type = 'function';\n          return s;\n        }),\n      },\n      {\n        prefixMatch: true,\n        label: 'Macros',\n        items: grafanaMacros.map((s: any) => {\n          s.type = 'function';\n          return s;\n        }),\n      },\n      {\n        prefixMatch: true,\n        label: 'Tables',\n        items: _.map(this.schema.Databases.Default.Tables, (t: any) => ({ text: t.Name })),\n      },\n    ];\n  }\n\n  private getFunctionSuggestions(): SuggestionGroup[] {\n    return [\n      {\n        prefixMatch: true,\n        label: 'Functions',\n        items: functionTokens.map((s: any) => {\n          s.type = 'function';\n          return s;\n        }),\n      },\n      {\n        prefixMatch: true,\n        label: 'Macros',\n        items: grafanaMacros.map((s: any) => {\n          s.type = 'function';\n          return s;\n        }),\n      },\n    ];\n  }\n\n  getTableSuggestions(db = 'Default'): SuggestionGroup[] {\n    // @ts-ignore\n    if (this.schema.Databases[db]) {\n      return [\n        {\n          prefixMatch: true,\n          label: 'Tables',\n          // @ts-ignore\n          items: _.map(this.schema.Databases[db].Tables, (t: any) => ({ text: t.Name })),\n        },\n      ];\n    } else {\n      return [];\n    }\n  }\n\n  private getColumnSuggestions(): SuggestionGroup[] {\n    const table = this.getTableFromContext();\n    if (table) {\n      const tableSchema = this.schema.Databases.Default.Tables[table];\n      if (tableSchema) {\n        return [\n          {\n            prefixMatch: true,\n            label: 'Fields',\n            items: _.map(tableSchema.OrderedColumns, (f: any) => ({\n              text: f.Name,\n              hint: f.Type,\n            })),\n          },\n        ];\n      }\n    }\n    return [];\n  }\n\n  private getTableFromContext() {\n    const query = Plain.serialize(this.state.value);\n    const tablePattern = /^\\s*(\\w+)\\s*|/g;\n    const normalizedQuery = normalizeQuery(query);\n    const match = tablePattern.exec(normalizedQuery);\n    if (match && match.length > 1 && match[0] && match[1]) {\n      return match[1];\n    } else {\n      return null;\n    }\n  }\n\n  private getDBFromDatabaseFunction(prefix: string) {\n    const databasePattern = /database\\(\\\"(\\w+)\\\"\\)/gi;\n    const match = databasePattern.exec(prefix);\n    if (match && match.length > 1 && match[0] && match[1]) {\n      return match[1];\n    } else {\n      return undefined;\n    }\n  }\n\n  private async fetchSchema() {\n    let schema = await this.props.getSchema();\n    if (schema) {\n      if (schema.Type === 'AppInsights') {\n        schema = castSchema(schema);\n      }\n      this.schema = schema;\n    } else {\n      this.schema = defaultSchema();\n    }\n  }\n}\n\n/**\n * Cast schema from App Insights to default Kusto schema\n */\nfunction castSchema(schema: any) {\n  const defaultSchemaTemplate = defaultSchema();\n  defaultSchemaTemplate.Databases.Default = schema;\n  return defaultSchemaTemplate;\n}\n\nfunction normalizeQuery(query: string): string {\n  const commentPattern = /\\/\\/.*$/gm;\n  let normalizedQuery = query.replace(commentPattern, '');\n  normalizedQuery = normalizedQuery.replace('\\n', ' ');\n  return normalizedQuery;\n}\n\nfunction getLastWord(str: string): string {\n  const lastWordPattern = /(?:.*\\s)?([^\\s]+\\s*)$/gi;\n  const match = lastWordPattern.exec(str);\n  if (match && match.length > 1) {\n    return match[1];\n  }\n  return '';\n}\n","import KustoQueryField from './KustoQueryField';\nimport Kusto from './kusto/kusto';\n\nimport React, { Component } from 'react';\nimport coreModule from 'app/core/core_module';\n\ninterface EditorProps {\n  index: number;\n  placeholder?: string;\n  change: (value: string, index: number) => void;\n  variables: () => string[] | string[];\n  getSchema?: () => Promise<any>;\n  execute?: () => void;\n  query?: string;\n}\n\nclass Editor extends Component<EditorProps, any> {\n  static defaultProps = {\n    placeholder: 'Enter a query',\n  };\n\n  constructor(props: EditorProps) {\n    super(props);\n    this.state = {\n      edited: false,\n      query: props.query || '',\n    };\n  }\n\n  onChangeQuery = (value: any) => {\n    const { index, change } = this.props;\n    const { query } = this.state;\n    const edited = query !== value;\n    this.setState({ edited, query: value });\n    if (change) {\n      change(value, index);\n    }\n  };\n\n  onPressEnter = () => {\n    const { execute } = this.props;\n    if (execute) {\n      execute();\n    }\n  };\n\n  render() {\n    const { variables, getSchema, placeholder } = this.props;\n    const { edited, query } = this.state;\n\n    return (\n      <div className=\"gf-form-input\" style={{ height: 'auto' }}>\n        <KustoQueryField\n          initialQuery={edited ? null : query}\n          onPressEnter={this.onPressEnter}\n          onQueryChange={this.onChangeQuery}\n          prismLanguage=\"kusto\"\n          prismDefinition={Kusto}\n          placeholder={placeholder}\n          templateVariables={variables}\n          getSchema={getSchema}\n        />\n      </div>\n    );\n  }\n}\n\ncoreModule.directive('kustoEditor', [\n  'reactDirective',\n  reactDirective => {\n    return reactDirective(Editor, [\n      'change',\n      'database',\n      'execute',\n      'query',\n      'variables',\n      'placeholder',\n      ['getSchema', { watchDepth: 'reference' }],\n    ]);\n  },\n]);\n","import _ from 'lodash';\nimport { QueryCtrl } from 'app/plugins/sdk';\n// import './css/query_editor.css';\nimport TimegrainConverter from './time_grain_converter';\nimport './editor/editor_component';\n\nimport { TemplateSrv } from '@grafana/runtime';\nimport { auto, IPromise } from 'angular';\nimport { DataFrame, PanelEvents, rangeUtil } from '@grafana/data';\nimport { AzureQueryType, AzureMetricQuery } from './types';\n\nexport interface ResultFormat {\n  text: string;\n  value: string;\n}\n\nexport class AzureMonitorQueryCtrl extends QueryCtrl {\n  static templateUrl = 'partials/query.editor.html';\n\n  defaultDropdownValue = 'select';\n\n  dummyDiminsionString = '+';\n\n  target: {\n    // should be: AzureMonitorQuery\n    refId: string;\n    queryType: AzureQueryType;\n    subscription: string;\n    azureMonitor: AzureMetricQuery;\n    azureLogAnalytics: {\n      query: string;\n      resultFormat: string;\n      workspace: string;\n    };\n    appInsights: {\n      // metric style query when rawQuery == false\n      metricName: string;\n      dimension: any;\n      dimensionFilter: string;\n      dimensions: string[];\n\n      aggOptions: string[];\n      aggregation: string;\n\n      timeGrainType: string;\n      timeGrainCount: string;\n      timeGrainUnit: string;\n      timeGrain: string;\n      timeGrains: Array<{ text: string; value: string }>;\n      allowedTimeGrainsMs: number[];\n    };\n    insightsAnalytics: {\n      query: any;\n      resultFormat: string;\n    };\n  };\n\n  defaults = {\n    queryType: 'Azure Monitor',\n    azureMonitor: {\n      resourceGroup: this.defaultDropdownValue,\n      metricDefinition: this.defaultDropdownValue,\n      resourceName: this.defaultDropdownValue,\n      metricNamespace: this.defaultDropdownValue,\n      metricName: this.defaultDropdownValue,\n      dimensionFilter: '*',\n      timeGrain: 'auto',\n      top: '10',\n      aggOptions: [] as string[],\n      timeGrains: [] as string[],\n    },\n    azureLogAnalytics: {\n      query: [\n        '//change this example to create your own time series query',\n        '<table name>                                                              ' +\n          '//the table to query (e.g. Usage, Heartbeat, Perf)',\n        '| where $__timeFilter(TimeGenerated)                                      ' +\n          '//this is a macro used to show the full charts time range, choose the datetime column here',\n        '| summarize count() by <group by column>, bin(TimeGenerated, $__interval) ' +\n          '//change group by column to a column in your table, such as Computer. ' +\n          'The $__interval macro is used to auto-select the time grain. Can also use 1h, 5m etc.',\n        '| order by TimeGenerated asc',\n      ].join('\\n'),\n      resultFormat: 'time_series',\n      workspace:\n        this.datasource && this.datasource.azureLogAnalyticsDatasource\n          ? this.datasource.azureLogAnalyticsDatasource.defaultOrFirstWorkspace\n          : '',\n    },\n    appInsights: {\n      metricName: this.defaultDropdownValue,\n      // dimension: [],\n      timeGrain: 'auto',\n    },\n    insightsAnalytics: {\n      query: '',\n      resultFormat: 'time_series',\n    },\n  };\n\n  resultFormats: ResultFormat[];\n  workspaces: any[];\n  showHelp: boolean;\n  showLastQuery: boolean;\n  lastQuery: string;\n  lastQueryError?: string;\n  subscriptions: Array<{ text: string; value: string }>;\n\n  /** @ngInject */\n  constructor($scope: any, $injector: auto.IInjectorService, private templateSrv: TemplateSrv) {\n    super($scope, $injector);\n\n    _.defaultsDeep(this.target, this.defaults);\n\n    this.migrateTimeGrains();\n\n    this.migrateToFromTimes();\n\n    this.migrateToDefaultNamespace();\n\n    this.migrateApplicationInsightsKeys();\n\n    this.migrateApplicationInsightsDimensions();\n\n    migrateMetricsDimensionFilters(this.target.azureMonitor);\n\n    this.panelCtrl.events.on(PanelEvents.dataReceived, this.onDataReceived.bind(this), $scope);\n    this.panelCtrl.events.on(PanelEvents.dataError, this.onDataError.bind(this), $scope);\n    this.resultFormats = [\n      { text: 'Time series', value: 'time_series' },\n      { text: 'Table', value: 'table' },\n    ];\n    this.getSubscriptions();\n    if (this.target.queryType === 'Azure Log Analytics') {\n      this.getWorkspaces();\n    }\n  }\n\n  onDataReceived(dataList: DataFrame[]) {\n    this.lastQueryError = undefined;\n    this.lastQuery = '';\n\n    const anySeriesFromQuery: any = _.find(dataList, { refId: this.target.refId });\n    if (anySeriesFromQuery && anySeriesFromQuery.meta) {\n      this.lastQuery = anySeriesFromQuery.meta.query;\n    }\n  }\n\n  onDataError(err: any) {\n    this.handleQueryCtrlError(err);\n  }\n\n  handleQueryCtrlError(err: any) {\n    if (err.query && err.query.refId && err.query.refId !== this.target.refId) {\n      return;\n    }\n\n    if (err.error && err.error.data && err.error.data.error && err.error.data.error.innererror) {\n      if (err.error.data.error.innererror.innererror) {\n        this.lastQueryError = err.error.data.error.innererror.innererror.message;\n      } else {\n        this.lastQueryError = err.error.data.error.innererror.message;\n      }\n    } else if (err.error && err.error.data && err.error.data.error) {\n      this.lastQueryError = err.error.data.error.message;\n    } else if (err.error && err.error.data) {\n      this.lastQueryError = err.error.data.message;\n    } else if (err.data && err.data.error) {\n      this.lastQueryError = err.data.error.message;\n    } else if (err.data && err.data.message) {\n      this.lastQueryError = err.data.message;\n    } else {\n      this.lastQueryError = err;\n    }\n  }\n\n  migrateTimeGrains() {\n    if (this.target.azureMonitor.timeGrainUnit) {\n      if (this.target.azureMonitor.timeGrain !== 'auto') {\n        this.target.azureMonitor.timeGrain = TimegrainConverter.createISO8601Duration(\n          this.target.azureMonitor.timeGrain,\n          this.target.azureMonitor.timeGrainUnit\n        );\n      }\n\n      delete this.target.azureMonitor.timeGrainUnit;\n      this.onMetricNameChange();\n    }\n\n    if (this.target.appInsights.timeGrainUnit) {\n      if (this.target.appInsights.timeGrain !== 'auto') {\n        if (this.target.appInsights.timeGrainCount) {\n          this.target.appInsights.timeGrain = TimegrainConverter.createISO8601Duration(\n            this.target.appInsights.timeGrainCount,\n            this.target.appInsights.timeGrainUnit\n          );\n        } else {\n          this.target.appInsights.timeGrainCount = this.target.appInsights.timeGrain;\n          this.target.appInsights.timeGrain = TimegrainConverter.createISO8601Duration(\n            this.target.appInsights.timeGrain,\n            this.target.appInsights.timeGrainUnit\n          );\n        }\n      }\n    }\n\n    const oldAzureTimeGrains = (this.target.azureMonitor as any).timeGrains;\n    if (\n      oldAzureTimeGrains &&\n      oldAzureTimeGrains.length > 0 &&\n      (!this.target.azureMonitor.allowedTimeGrainsMs || this.target.azureMonitor.allowedTimeGrainsMs.length === 0)\n    ) {\n      this.target.azureMonitor.allowedTimeGrainsMs = this.convertTimeGrainsToMs(oldAzureTimeGrains);\n    }\n\n    if (\n      this.target.appInsights.timeGrains &&\n      this.target.appInsights.timeGrains.length > 0 &&\n      (!this.target.appInsights.allowedTimeGrainsMs || this.target.appInsights.allowedTimeGrainsMs.length === 0)\n    ) {\n      this.target.appInsights.allowedTimeGrainsMs = this.convertTimeGrainsToMs(this.target.appInsights.timeGrains);\n    }\n  }\n\n  migrateToFromTimes() {\n    this.target.azureLogAnalytics.query = this.target.azureLogAnalytics.query.replace(/\\$__from\\s/gi, '$__timeFrom() ');\n    this.target.azureLogAnalytics.query = this.target.azureLogAnalytics.query.replace(/\\$__to\\s/gi, '$__timeTo() ');\n  }\n\n  async migrateToDefaultNamespace() {\n    if (\n      this.target.azureMonitor.metricNamespace &&\n      this.target.azureMonitor.metricNamespace !== this.defaultDropdownValue &&\n      this.target.azureMonitor.metricDefinition\n    ) {\n      return;\n    }\n\n    this.target.azureMonitor.metricNamespace = this.target.azureMonitor.metricDefinition;\n  }\n\n  migrateApplicationInsightsKeys(): void {\n    const appInsights = this.target.appInsights as any;\n\n    // Migrate old app insights data keys to match other datasources\n    const mappings = {\n      xaxis: 'timeColumn',\n      yaxis: 'valueColumn',\n      spliton: 'segmentColumn',\n      groupBy: 'dimension',\n      groupByOptions: 'dimensions',\n      filter: 'dimensionFilter',\n    } as { [old: string]: string };\n\n    for (const old in mappings) {\n      if (appInsights[old]) {\n        appInsights[mappings[old]] = appInsights[old];\n        delete appInsights[old];\n      }\n    }\n  }\n\n  migrateApplicationInsightsDimensions() {\n    const { appInsights } = this.target;\n\n    if (!appInsights.dimension) {\n      appInsights.dimension = [];\n    }\n\n    if (_.isString(appInsights.dimension)) {\n      appInsights.dimension = [appInsights.dimension as string];\n    }\n  }\n\n  replace(variable: string) {\n    return this.templateSrv.replace(variable, this.panelCtrl.panel.scopedVars);\n  }\n\n  onQueryTypeChange() {\n    if (this.target.queryType === 'Azure Log Analytics') {\n      return this.getWorkspaces();\n    }\n  }\n\n  getSubscriptions() {\n    if (!this.datasource.azureMonitorDatasource.isConfigured()) {\n      return;\n    }\n\n    return this.datasource.azureMonitorDatasource.getSubscriptions().then((subs: any) => {\n      this.subscriptions = subs;\n      if (!this.target.subscription && this.target.queryType === 'Azure Monitor') {\n        this.target.subscription = this.datasource.azureMonitorDatasource.subscriptionId;\n      } else if (!this.target.subscription && this.target.queryType === 'Azure Log Analytics') {\n        this.target.subscription = this.datasource.azureLogAnalyticsDatasource.logAnalyticsSubscriptionId;\n      }\n\n      if (!this.target.subscription && this.subscriptions.length > 0) {\n        this.target.subscription = this.subscriptions[0].value;\n      }\n\n      return this.subscriptions;\n    });\n  }\n\n  onSubscriptionChange() {\n    if (this.target.queryType === 'Azure Log Analytics') {\n      return this.getWorkspaces();\n    }\n\n    if (this.target.queryType === 'Azure Monitor') {\n      this.target.azureMonitor.resourceGroup = this.defaultDropdownValue;\n      this.target.azureMonitor.metricDefinition = this.defaultDropdownValue;\n      this.target.azureMonitor.resourceName = this.defaultDropdownValue;\n      this.target.azureMonitor.metricName = this.defaultDropdownValue;\n      this.target.azureMonitor.aggregation = '';\n      this.target.azureMonitor.timeGrain = '';\n      this.target.azureMonitor.dimensionFilters = [];\n    }\n  }\n\n  /* Azure Monitor Section */\n  getResourceGroups(query: any) {\n    if (this.target.queryType !== 'Azure Monitor' || !this.datasource.azureMonitorDatasource.isConfigured()) {\n      return;\n    }\n\n    return this.datasource\n      .getResourceGroups(\n        this.replace(this.target.subscription || this.datasource.azureMonitorDatasource.subscriptionId)\n      )\n      .catch(this.handleQueryCtrlError.bind(this));\n  }\n\n  getMetricDefinitions(query: any) {\n    if (\n      this.target.queryType !== 'Azure Monitor' ||\n      !this.target.azureMonitor.resourceGroup ||\n      this.target.azureMonitor.resourceGroup === this.defaultDropdownValue\n    ) {\n      return;\n    }\n    return this.datasource\n      .getMetricDefinitions(\n        this.replace(this.target.subscription || this.datasource.azureMonitorDatasource.subscriptionId),\n        this.replace(this.target.azureMonitor.resourceGroup)\n      )\n      .catch(this.handleQueryCtrlError.bind(this));\n  }\n\n  getResourceNames(query: any) {\n    if (\n      this.target.queryType !== 'Azure Monitor' ||\n      !this.target.azureMonitor.resourceGroup ||\n      this.target.azureMonitor.resourceGroup === this.defaultDropdownValue ||\n      !this.target.azureMonitor.metricDefinition ||\n      this.target.azureMonitor.metricDefinition === this.defaultDropdownValue\n    ) {\n      return;\n    }\n\n    return this.datasource\n      .getResourceNames(\n        this.replace(this.target.subscription || this.datasource.azureMonitorDatasource.subscriptionId),\n        this.replace(this.target.azureMonitor.resourceGroup),\n        this.replace(this.target.azureMonitor.metricDefinition)\n      )\n      .catch(this.handleQueryCtrlError.bind(this));\n  }\n\n  getMetricNamespaces() {\n    if (\n      this.target.queryType !== 'Azure Monitor' ||\n      !this.target.azureMonitor.resourceGroup ||\n      this.target.azureMonitor.resourceGroup === this.defaultDropdownValue ||\n      !this.target.azureMonitor.metricDefinition ||\n      this.target.azureMonitor.metricDefinition === this.defaultDropdownValue ||\n      !this.target.azureMonitor.resourceName ||\n      this.target.azureMonitor.resourceName === this.defaultDropdownValue\n    ) {\n      return;\n    }\n\n    return this.datasource\n      .getMetricNamespaces(\n        this.replace(this.target.subscription || this.datasource.azureMonitorDatasource.subscriptionId),\n        this.replace(this.target.azureMonitor.resourceGroup),\n        this.replace(this.target.azureMonitor.metricDefinition),\n        this.replace(this.target.azureMonitor.resourceName)\n      )\n      .catch(this.handleQueryCtrlError.bind(this));\n  }\n\n  getMetricNames() {\n    if (\n      this.target.queryType !== 'Azure Monitor' ||\n      !this.target.azureMonitor.resourceGroup ||\n      this.target.azureMonitor.resourceGroup === this.defaultDropdownValue ||\n      !this.target.azureMonitor.metricDefinition ||\n      this.target.azureMonitor.metricDefinition === this.defaultDropdownValue ||\n      !this.target.azureMonitor.resourceName ||\n      this.target.azureMonitor.resourceName === this.defaultDropdownValue ||\n      !this.target.azureMonitor.metricNamespace ||\n      this.target.azureMonitor.metricNamespace === this.defaultDropdownValue\n    ) {\n      return;\n    }\n\n    return this.datasource\n      .getMetricNames(\n        this.replace(this.target.subscription || this.datasource.azureMonitorDatasource.subscriptionId),\n        this.replace(this.target.azureMonitor.resourceGroup),\n        this.replace(this.target.azureMonitor.metricDefinition),\n        this.replace(this.target.azureMonitor.resourceName),\n        this.replace(this.target.azureMonitor.metricNamespace)\n      )\n      .catch(this.handleQueryCtrlError.bind(this));\n  }\n\n  onResourceGroupChange() {\n    this.target.azureMonitor.metricDefinition = this.defaultDropdownValue;\n    this.target.azureMonitor.resourceName = this.defaultDropdownValue;\n    this.target.azureMonitor.metricNamespace = this.defaultDropdownValue;\n    this.target.azureMonitor.metricName = this.defaultDropdownValue;\n    this.target.azureMonitor.aggregation = '';\n    this.target.azureMonitor.timeGrain = '';\n    this.target.azureMonitor.dimensionFilters = [];\n    this.refresh();\n  }\n\n  onMetricDefinitionChange() {\n    this.target.azureMonitor.resourceName = this.defaultDropdownValue;\n    this.target.azureMonitor.metricNamespace = this.defaultDropdownValue;\n    this.target.azureMonitor.metricName = this.defaultDropdownValue;\n    this.target.azureMonitor.aggregation = '';\n    this.target.azureMonitor.timeGrain = '';\n    this.target.azureMonitor.dimensionFilters = [];\n  }\n\n  onResourceNameChange() {\n    this.target.azureMonitor.metricNamespace = this.defaultDropdownValue;\n    this.target.azureMonitor.metricName = this.defaultDropdownValue;\n    this.target.azureMonitor.aggregation = '';\n    this.target.azureMonitor.timeGrain = '';\n    this.target.azureMonitor.dimensionFilters = [];\n    this.refresh();\n  }\n\n  onMetricNamespacesChange() {\n    this.target.azureMonitor.metricName = this.defaultDropdownValue;\n    this.target.azureMonitor.dimensionFilters = [];\n  }\n\n  onMetricNameChange(): IPromise<void> {\n    if (!this.target.azureMonitor.metricName || this.target.azureMonitor.metricName === this.defaultDropdownValue) {\n      return Promise.resolve();\n    }\n\n    return this.datasource\n      .getMetricMetadata(\n        this.replace(this.target.subscription),\n        this.replace(this.target.azureMonitor.resourceGroup),\n        this.replace(this.target.azureMonitor.metricDefinition),\n        this.replace(this.target.azureMonitor.resourceName),\n        this.replace(this.target.azureMonitor.metricNamespace),\n        this.replace(this.target.azureMonitor.metricName)\n      )\n      .then((metadata: any) => {\n        this.target.azureMonitor.aggregation = metadata.primaryAggType;\n        this.target.azureMonitor.timeGrain = 'auto';\n        this.target.azureMonitor.allowedTimeGrainsMs = this.convertTimeGrainsToMs(metadata.supportedTimeGrains || []);\n\n        // HACK: this saves the last metadata values in the panel json \\_()_/\n        const hackState = this.target.azureMonitor as any;\n        hackState.aggOptions = metadata.supportedAggTypes || [metadata.primaryAggType];\n        hackState.timeGrains = [{ text: 'auto', value: 'auto' }].concat(metadata.supportedTimeGrains);\n        hackState.dimensions = metadata.dimensions;\n\n        if (metadata.dimensions.length > 0) {\n          //  this.target.azureMonitor.dimension = metadata.dimensions[0].value;\n        }\n\n        return this.refresh();\n      })\n      .catch(this.handleQueryCtrlError.bind(this));\n  }\n\n  convertTimeGrainsToMs(timeGrains: Array<{ text: string; value: string }>) {\n    const allowedTimeGrainsMs: number[] = [];\n    timeGrains.forEach((tg: any) => {\n      if (tg.value !== 'auto') {\n        allowedTimeGrainsMs.push(rangeUtil.intervalToMs(TimegrainConverter.createKbnUnitFromISO8601Duration(tg.value)));\n      }\n    });\n    return allowedTimeGrainsMs;\n  }\n\n  generateAutoUnits(timeGrain: string, timeGrains: Array<{ value: string }>) {\n    if (timeGrain === 'auto') {\n      return TimegrainConverter.findClosestTimeGrain(\n        '1m',\n        _.map(timeGrains, o => TimegrainConverter.createKbnUnitFromISO8601Duration(o.value)) || [\n          '1m',\n          '5m',\n          '15m',\n          '30m',\n          '1h',\n          '6h',\n          '12h',\n          '1d',\n        ]\n      );\n    }\n\n    return '';\n  }\n\n  getAzureMonitorAutoInterval() {\n    return this.generateAutoUnits(this.target.azureMonitor.timeGrain, (this.target.azureMonitor as any).timeGrains);\n  }\n\n  getApplicationInsightAutoInterval() {\n    return this.generateAutoUnits(this.target.appInsights.timeGrain, this.target.appInsights.timeGrains);\n  }\n\n  azureMonitorAddDimensionFilter() {\n    this.target.azureMonitor.dimensionFilters.push({\n      dimension: '',\n      operator: 'eq',\n      filter: '',\n    });\n  }\n\n  azureMonitorRemoveDimensionFilter(index: number) {\n    this.target.azureMonitor.dimensionFilters.splice(index, 1);\n    this.refresh();\n  }\n\n  /* Azure Log Analytics */\n\n  getWorkspaces = () => {\n    return this.datasource.azureLogAnalyticsDatasource\n      .getWorkspaces(this.target.subscription)\n      .then((list: any[]) => {\n        this.workspaces = list;\n\n        if (list.length > 0 && !this.target.azureLogAnalytics.workspace) {\n          if (this.datasource.azureLogAnalyticsDatasource.defaultOrFirstWorkspace) {\n            this.target.azureLogAnalytics.workspace = this.datasource.azureLogAnalyticsDatasource.defaultOrFirstWorkspace;\n          }\n\n          if (!this.target.azureLogAnalytics.workspace) {\n            this.target.azureLogAnalytics.workspace = list[0].value;\n          }\n        }\n\n        return this.workspaces;\n      })\n      .catch(this.handleQueryCtrlError.bind(this));\n  };\n\n  getAzureLogAnalyticsSchema = () => {\n    return this.getWorkspaces()\n      .then(() => {\n        return this.datasource.azureLogAnalyticsDatasource.getSchema(this.target.azureLogAnalytics.workspace);\n      })\n      .catch(this.handleQueryCtrlError.bind(this));\n  };\n\n  onLogAnalyticsQueryChange = (nextQuery: string) => {\n    this.target.azureLogAnalytics.query = nextQuery;\n  };\n\n  onLogAnalyticsQueryExecute = () => {\n    this.panelCtrl.refresh();\n  };\n\n  get templateVariables() {\n    return this.templateSrv.getVariables().map(t => '$' + t.name);\n  }\n\n  getAppInsightsMetricNames() {\n    if (!this.datasource.appInsightsDatasource.isConfigured()) {\n      return;\n    }\n\n    return this.datasource.getAppInsightsMetricNames().catch(this.handleQueryCtrlError.bind(this));\n  }\n\n  getAppInsightsColumns() {\n    return this.datasource.getAppInsightsColumns(this.target.refId);\n  }\n\n  onAppInsightsColumnChange() {\n    return this.refresh();\n  }\n\n  onAppInsightsMetricNameChange() {\n    if (!this.target.appInsights.metricName || this.target.appInsights.metricName === this.defaultDropdownValue) {\n      return;\n    }\n\n    return this.datasource\n      .getAppInsightsMetricMetadata(this.replace(this.target.appInsights.metricName))\n      .then((aggData: { supportedAggTypes: string[]; supportedGroupBy: string[]; primaryAggType: string }) => {\n        this.target.appInsights.aggOptions = aggData.supportedAggTypes;\n        this.target.appInsights.dimensions = aggData.supportedGroupBy;\n        this.target.appInsights.aggregation = aggData.primaryAggType;\n        return this.refresh();\n      })\n      .catch(this.handleQueryCtrlError.bind(this));\n  }\n\n  onInsightsAnalyticsQueryChange = (nextQuery: string) => {\n    this.target.insightsAnalytics.query = nextQuery;\n  };\n\n  onQueryExecute = () => {\n    return this.refresh();\n  };\n\n  getAppInsightsQuerySchema = () => {\n    return this.datasource.appInsightsDatasource.getQuerySchema().catch(this.handleQueryCtrlError.bind(this));\n  };\n\n  removeGroupBy = (index: number) => {\n    const { appInsights } = this.target;\n    appInsights.dimension.splice(index, 1);\n    this.refresh();\n  };\n\n  getAppInsightsGroupBySegments(query: any) {\n    const { appInsights } = this.target;\n\n    // HACK alert... there must be a better way!\n    if (this.dummyDiminsionString && this.dummyDiminsionString.length && '+' !== this.dummyDiminsionString) {\n      if (!appInsights.dimension) {\n        appInsights.dimension = [];\n      }\n      appInsights.dimension.push(this.dummyDiminsionString);\n      this.dummyDiminsionString = '+';\n      this.refresh();\n    }\n\n    // Return the list of dimensions stored on the query object from the last request :(\n    return _.map(appInsights.dimensions, (option: string) => {\n      return { text: option, value: option };\n    });\n  }\n\n  resetAppInsightsGroupBy() {\n    this.target.appInsights.dimension = 'none';\n    this.refresh();\n  }\n\n  updateTimeGrainType() {\n    if (this.target.appInsights.timeGrainType === 'specific') {\n      this.target.appInsights.timeGrainCount = '1';\n      this.target.appInsights.timeGrainUnit = 'minute';\n      this.target.appInsights.timeGrain = TimegrainConverter.createISO8601Duration(\n        this.target.appInsights.timeGrainCount,\n        this.target.appInsights.timeGrainUnit\n      );\n    } else {\n      this.target.appInsights.timeGrainCount = '';\n      this.target.appInsights.timeGrainUnit = '';\n    }\n  }\n\n  updateAppInsightsTimeGrain() {\n    if (this.target.appInsights.timeGrainUnit && this.target.appInsights.timeGrainCount) {\n      this.target.appInsights.timeGrain = TimegrainConverter.createISO8601Duration(\n        this.target.appInsights.timeGrainCount,\n        this.target.appInsights.timeGrainUnit\n      );\n    }\n    this.refresh();\n  }\n}\n\n// Modifies the actual query object\nexport function migrateMetricsDimensionFilters(item: AzureMetricQuery) {\n  if (!item.dimensionFilters) {\n    item.dimensionFilters = [];\n  }\n  const oldDimension = (item as any).dimension;\n  if (oldDimension && oldDimension !== 'None') {\n    item.dimensionFilters.push({\n      dimension: oldDimension,\n      operator: 'eq',\n      filter: (item as any).dimensionFilter,\n    });\n    delete (item as any).dimension;\n    delete (item as any).dimensionFilter;\n  }\n}\n","export default class UrlBuilder {\n  static buildAzureMonitorGetMetricNamespacesUrl(\n    baseUrl: string,\n    subscriptionId: string,\n    resourceGroup: string,\n    metricDefinition: string,\n    resourceName: string,\n    apiVersion: string\n  ) {\n    if ((metricDefinition.match(/\\//g) || []).length > 1) {\n      const rn = resourceName.split('/');\n      const service = metricDefinition.substring(metricDefinition.lastIndexOf('/') + 1);\n      const md = metricDefinition.substring(0, metricDefinition.lastIndexOf('/'));\n      return (\n        `${baseUrl}/${subscriptionId}/resourceGroups/${resourceGroup}/providers/${md}/${rn[0]}/${service}/${rn[1]}` +\n        `/providers/microsoft.insights/metricNamespaces?api-version=${apiVersion}`\n      );\n    }\n\n    return (\n      `${baseUrl}/${subscriptionId}/resourceGroups/${resourceGroup}/providers/${metricDefinition}/${resourceName}` +\n      `/providers/microsoft.insights/metricNamespaces?api-version=${apiVersion}`\n    );\n  }\n\n  static buildAzureMonitorGetMetricNamesUrl(\n    baseUrl: string,\n    subscriptionId: string,\n    resourceGroup: string,\n    metricDefinition: string,\n    resourceName: string,\n    metricNamespace: string,\n    apiVersion: string\n  ) {\n    if ((metricDefinition.match(/\\//g) || []).length > 1) {\n      const rn = resourceName.split('/');\n      const service = metricDefinition.substring(metricDefinition.lastIndexOf('/') + 1);\n      const md = metricDefinition.substring(0, metricDefinition.lastIndexOf('/'));\n      return (\n        `${baseUrl}/${subscriptionId}/resourceGroups/${resourceGroup}/providers/${md}/${rn[0]}/${service}/${rn[1]}` +\n        `/providers/microsoft.insights/metricdefinitions?api-version=${apiVersion}&metricnamespace=${encodeURIComponent(\n          metricNamespace\n        )}`\n      );\n    }\n\n    return (\n      `${baseUrl}/${subscriptionId}/resourceGroups/${resourceGroup}/providers/${metricDefinition}/${resourceName}` +\n      `/providers/microsoft.insights/metricdefinitions?api-version=${apiVersion}&metricnamespace=${encodeURIComponent(\n        metricNamespace\n      )}`\n    );\n  }\n}\n","import _ from 'lodash';\nimport TimeGrainConverter from '../time_grain_converter';\nexport default class ResponseParser {\n  static parseResponseValues(\n    result: any,\n    textFieldName: string,\n    valueFieldName: string\n  ): Array<{ text: string; value: string }> {\n    const list: Array<{ text: string; value: string }> = [];\n\n    if (!result) {\n      return list;\n    }\n\n    for (let i = 0; i < result.data.value.length; i++) {\n      if (!_.find(list, ['value', _.get(result.data.value[i], valueFieldName)])) {\n        const value = _.get(result.data.value[i], valueFieldName);\n        const text = _.get(result.data.value[i], textFieldName, value);\n\n        list.push({\n          text: text,\n          value: value,\n        });\n      }\n    }\n    return list;\n  }\n\n  static parseResourceNames(result: any, metricDefinition: string): Array<{ text: string; value: string }> {\n    const list: Array<{ text: string; value: string }> = [];\n\n    if (!result) {\n      return list;\n    }\n\n    for (let i = 0; i < result.data.value.length; i++) {\n      if (result.data.value[i].type === metricDefinition) {\n        list.push({\n          text: result.data.value[i].name,\n          value: result.data.value[i].name,\n        });\n      }\n    }\n\n    return list;\n  }\n\n  static parseMetadata(result: any, metricName: string) {\n    const defaultAggTypes = ['None', 'Average', 'Minimum', 'Maximum', 'Total', 'Count'];\n\n    if (!result) {\n      return {\n        primaryAggType: '',\n        supportedAggTypes: defaultAggTypes,\n        supportedTimeGrains: [],\n        dimensions: [],\n      };\n    }\n\n    const metricData: any = _.find(result.data.value, o => {\n      return _.get(o, 'name.value') === metricName;\n    });\n\n    return {\n      primaryAggType: metricData.primaryAggregationType,\n      supportedAggTypes: metricData.supportedAggregationTypes || defaultAggTypes,\n      supportedTimeGrains: ResponseParser.parseTimeGrains(metricData.metricAvailabilities || []),\n      dimensions: ResponseParser.parseDimensions(metricData),\n    };\n  }\n\n  static parseTimeGrains(metricAvailabilities: any[]): Array<{ text: string; value: string }> {\n    const timeGrains: any[] = [];\n    if (!metricAvailabilities) {\n      return timeGrains;\n    }\n\n    metricAvailabilities.forEach(avail => {\n      if (avail.timeGrain) {\n        timeGrains.push({\n          text: TimeGrainConverter.createTimeGrainFromISO8601Duration(avail.timeGrain),\n          value: avail.timeGrain,\n        });\n      }\n    });\n    return timeGrains;\n  }\n\n  static parseDimensions(metricData: any): Array<{ text: string; value: string }> {\n    const dimensions: Array<{ text: string; value: string }> = [];\n    if (!metricData.dimensions || metricData.dimensions.length === 0) {\n      return dimensions;\n    }\n\n    for (let i = 0; i < metricData.dimensions.length; i++) {\n      const text = metricData.dimensions[i].localizedValue;\n      const value = metricData.dimensions[i].value;\n\n      dimensions.push({\n        text: !text ? value : text,\n        value: value,\n      });\n    }\n    return dimensions;\n  }\n\n  static parseSubscriptions(result: any): Array<{ text: string; value: string }> {\n    const list: Array<{ text: string; value: string }> = [];\n\n    if (!result) {\n      return list;\n    }\n\n    const valueFieldName = 'subscriptionId';\n    const textFieldName = 'displayName';\n    for (let i = 0; i < result.data.value.length; i++) {\n      if (!_.find(list, ['value', _.get(result.data.value[i], valueFieldName)])) {\n        list.push({\n          text: `${_.get(result.data.value[i], textFieldName)} - ${_.get(result.data.value[i], valueFieldName)}`,\n          value: _.get(result.data.value[i], valueFieldName),\n        });\n      }\n    }\n\n    return list;\n  }\n\n  static parseSubscriptionsForSelect(result: any): Array<{ label: string; value: string }> {\n    const list: Array<{ label: string; value: string }> = [];\n\n    if (!result) {\n      return list;\n    }\n\n    const valueFieldName = 'subscriptionId';\n    const textFieldName = 'displayName';\n    for (let i = 0; i < result.data.value.length; i++) {\n      if (!_.find(list, ['value', _.get(result.data.value[i], valueFieldName)])) {\n        list.push({\n          label: `${_.get(result.data.value[i], textFieldName)} - ${_.get(result.data.value[i], valueFieldName)}`,\n          value: _.get(result.data.value[i], valueFieldName),\n        });\n      }\n    }\n\n    return list;\n  }\n\n  static parseWorkspacesForSelect(result: any): Array<{ label: string; value: string }> {\n    const list: Array<{ label: string; value: string }> = [];\n\n    if (!result) {\n      return list;\n    }\n\n    const valueFieldName = 'customerId';\n    const textFieldName = 'name';\n    for (let i = 0; i < result.data.value.length; i++) {\n      if (!_.find(list, ['value', _.get(result.data.value[i].properties, valueFieldName)])) {\n        list.push({\n          label: _.get(result.data.value[i], textFieldName),\n          value: _.get(result.data.value[i].properties, valueFieldName),\n        });\n      }\n    }\n\n    return list;\n  }\n}\n","import { DataQuery, DataSourceJsonData, DataSourceSettings, TableData } from '@grafana/data';\n\nexport type AzureDataSourceSettings = DataSourceSettings<AzureDataSourceJsonData, AzureDataSourceSecureJsonData>;\n\nexport enum AzureQueryType {\n  AzureMonitor = 'Azure Monitor',\n  ApplicationInsights = 'Application Insights',\n  InsightsAnalytics = 'Insights Analytics',\n  LogAnalytics = 'Azure Log Analytics',\n}\n\nexport interface AzureMonitorQuery extends DataQuery {\n  queryType: AzureQueryType;\n  format: string;\n  subscription: string;\n\n  azureMonitor: AzureMetricQuery;\n  azureLogAnalytics: AzureLogsQuery;\n  appInsights?: ApplicationInsightsQuery;\n  insightsAnalytics: InsightsAnalyticsQuery;\n}\n\nexport interface AzureDataSourceJsonData extends DataSourceJsonData {\n  subscriptionId: string;\n  cloudName: string;\n\n  // monitor\n  tenantId?: string;\n  clientId?: string;\n\n  // logs\n  logAnalyticsSubscriptionId?: string;\n  logAnalyticsTenantId?: string;\n  logAnalyticsClientId?: string;\n  azureLogAnalyticsSameAs?: boolean;\n  logAnalyticsDefaultWorkspace?: string;\n\n  // App Insights\n  appInsightsAppId?: string;\n}\n\nexport interface AzureDataSourceSecureJsonData {\n  clientSecret?: string;\n  logAnalyticsClientSecret?: string;\n  appInsightsApiKey?: string;\n}\n\nexport interface AzureMetricDimension {\n  dimension: string;\n  operator: 'eq'; // future proof\n  filter?: string; // *\n}\n\nexport interface AzureMetricQuery {\n  resourceGroup: string;\n  resourceName: string;\n  metricDefinition: string;\n  metricNamespace: string;\n  metricName: string;\n  timeGrainUnit?: string;\n  timeGrain: string;\n  allowedTimeGrainsMs: number[];\n  aggregation: string;\n  dimensionFilters: AzureMetricDimension[];\n  alias: string;\n  top: string;\n}\n\nexport interface AzureLogsQuery {\n  query: string;\n  resultFormat: string;\n  workspace: string;\n}\n\nexport interface ApplicationInsightsQuery {\n  metricName: string;\n  timeGrainUnit: string;\n  timeGrain: string;\n  allowedTimeGrainsMs: number[];\n  aggregation: string;\n  dimension: string[]; // Was string before 7.1\n  // dimensions: string[]; why is this metadata stored on the object!\n  dimensionFilter: string;\n  alias: string;\n}\n\nexport interface InsightsAnalyticsQuery {\n  query: string;\n  resultFormat: string;\n}\n\n// Azure Monitor API Types\n\nexport interface AzureMonitorMetricDefinitionsResponse {\n  data: {\n    value: Array<{ name: string; type: string; location?: string }>;\n  };\n  status: number;\n  statusText: string;\n}\n\nexport interface AzureMonitorResourceGroupsResponse {\n  data: {\n    value: Array<{ name: string }>;\n  };\n  status: number;\n  statusText: string;\n}\n\n// Azure Log Analytics types\nexport interface KustoSchema {\n  Databases: { [key: string]: KustoDatabase };\n  Plugins: any[];\n}\nexport interface KustoDatabase {\n  Name: string;\n  Tables: { [key: string]: KustoTable };\n  Functions: { [key: string]: KustoFunction };\n}\n\nexport interface KustoTable {\n  Name: string;\n  OrderedColumns: KustoColumn[];\n}\n\nexport interface KustoColumn {\n  Name: string;\n  Type: string;\n}\n\nexport interface KustoFunction {\n  Name: string;\n  DocString: string;\n  Body: string;\n  Folder: string;\n  FunctionKind: string;\n  InputParameters: any[];\n  OutputColumns: any[];\n}\n\nexport interface AzureLogsVariable {\n  text: string;\n  value: string;\n}\n\nexport interface AzureLogsTableData extends TableData {\n  columns: AzureLogsTableColumn[];\n  rows: any[];\n  type: string;\n}\n\nexport interface AzureLogsTableColumn {\n  text: string;\n  type: string;\n}\n","export default class SupportedNamespaces {\n  supportedMetricNamespaces: any = {\n    azuremonitor: [\n      'Microsoft.AnalysisServices/servers',\n      'Microsoft.ApiManagement/service',\n      'Microsoft.Automation/automationAccounts',\n      'Microsoft.Batch/batchAccounts',\n      'Microsoft.Cache/redis',\n      'Microsoft.ClassicCompute/virtualMachines',\n      'Microsoft.ClassicCompute/domainNames/slots/roles',\n      'Microsoft.CognitiveServices/accounts',\n      'Microsoft.Compute/virtualMachines',\n      'Microsoft.Compute/virtualMachineScaleSets',\n      'Microsoft.ContainerInstance/containerGroups',\n      'Microsoft.ContainerRegistry/registries',\n      'Microsoft.ContainerService/managedClusters',\n      'Microsoft.CustomerInsights/hubs',\n      'Microsoft.DataBoxEdge/dataBoxEdgeDevices',\n      'Microsoft.DataFactory/datafactories',\n      'Microsoft.DataFactory/factories',\n      'Microsoft.DataLakeAnalytics/accounts',\n      'Microsoft.DataLakeStore/accounts',\n      'Microsoft.DBforMariaDB/servers',\n      'Microsoft.DBforMySQL/servers',\n      'Microsoft.DBforPostgreSQL/servers',\n      'Microsoft.Devices/IotHubs',\n      'Microsoft.Devices/provisioningServices',\n      'Microsoft.DocumentDB/databaseAccounts',\n      'Microsoft.EventGrid/topics',\n      'Microsoft.EventGrid/eventSubscriptions',\n      'Microsoft.EventGrid/extensionTopics',\n      'Microsoft.EventHub/namespaces',\n      'Microsoft.EventHub/clusters',\n      'Microsoft.HDInsight/clusters',\n      'Microsoft.Insights/AutoscaleSettings',\n      'Microsoft.Insights/components',\n      'Microsoft.KeyVault/vaults',\n      'Microsoft.Kusto/clusters',\n      'Microsoft.LocationBasedServices/accounts',\n      'Microsoft.Logic/workflows',\n      'Microsoft.Logic/integrationServiceEnvironments',\n      'Microsoft.NetApp/netAppAccounts/capacityPools',\n      'Microsoft.NetApp/netAppAccounts/capacityPools/volumes',\n      'Microsoft.Network/networkInterfaces',\n      'Microsoft.Network/loadBalancers',\n      'Microsoft.Network/dnsZones',\n      'Microsoft.Network/publicIPAddresses',\n      'Microsoft.Network/azureFirewalls',\n      'Microsoft.Network/applicationGateways',\n      'Microsoft.Network/virtualNetworkGateways',\n      'Microsoft.Network/expressRouteCircuits',\n      'Microsoft.Network/expressRouteCircuits/Peerings',\n      'Microsoft.Network/connections',\n      'Microsoft.Network/trafficManagerProfiles',\n      'Microsoft.Network/networkWatchers/connectionMonitors',\n      'Microsoft.Network/frontdoors',\n      'Microsoft.NotificationHubs/namespaces/notificationHubs',\n      'Microsoft.OperationalInsights/workspaces',\n      'Microsoft.PowerBIDedicated/capacities',\n      'Microsoft.Relay/namespaces',\n      'Microsoft.Search/searchServices',\n      'Microsoft.ServiceBus/namespaces',\n      'Microsoft.Sql/servers/databases',\n      'Microsoft.Sql/servers/elasticPools',\n      'Microsoft.Sql/managedInstances',\n      'Microsoft.Storage/storageAccounts',\n      'Microsoft.Storage/storageAccounts/blobServices',\n      'Microsoft.Storage/storageAccounts/fileServices',\n      'Microsoft.Storage/storageAccounts/queueServices',\n      'Microsoft.Storage/storageAccounts/tableServices',\n      'Microsoft.StorageSync/storageSyncServices',\n      'Microsoft.StorageSync/storageSyncServices/syncGroups',\n      'Microsoft.StorageSync/storageSyncServices/syncGroups/serverEndpoints',\n      'Microsoft.StorageSync/storageSyncServices/registeredServers',\n      'Microsoft.StreamAnalytics/streamingJobs',\n      'Microsoft.Web/serverfarms',\n      'Microsoft.Web/sites',\n      'Microsoft.Web/sites/slots',\n      'Microsoft.Web/hostingEnvironments/multiRolePools',\n      'Microsoft.Web/hostingEnvironments/workerPools',\n    ],\n    govazuremonitor: [\n      'Microsoft.AnalysisServices/servers',\n      'Microsoft.ApiManagement/service',\n      'Microsoft.Batch/batchAccounts',\n      'Microsoft.Cache/redis',\n      'Microsoft.ClassicCompute/virtualMachines',\n      'Microsoft.ClassicCompute/domainNames/slots/roles',\n      'Microsoft.CognitiveServices/accounts',\n      'Microsoft.Compute/virtualMachines',\n      'Microsoft.Compute/virtualMachineScaleSets',\n      'Microsoft.ContainerRegistry/registries',\n      'Microsoft.DBforMySQL/servers',\n      'Microsoft.DBforPostgreSQL/servers',\n      'Microsoft.Devices/IotHubs',\n      'Microsoft.Devices/provisioningServices',\n      'Microsoft.EventGrid/topics',\n      'Microsoft.EventGrid/eventSubscriptions',\n      'Microsoft.EventGrid/extensionTopics',\n      'Microsoft.EventHub/namespaces',\n      'Microsoft.EventHub/clusters',\n      'Microsoft.Insights/AutoscaleSettings',\n      'Microsoft.KeyVault/vaults',\n      'Microsoft.Logic/workflows',\n      'Microsoft.Network/networkInterfaces',\n      'Microsoft.Network/loadBalancers',\n      'Microsoft.Network/dnsZones',\n      'Microsoft.Network/publicIPAddresses',\n      'Microsoft.Network/azureFirewalls',\n      'Microsoft.Network/applicationGateways',\n      'Microsoft.Network/virtualNetworkGateways',\n      'Microsoft.Network/expressRouteCircuits',\n      'Microsoft.Network/expressRouteCircuits/Peerings',\n      'Microsoft.Network/connections',\n      'Microsoft.Network/trafficManagerProfiles',\n      'Microsoft.Network/networkWatchers/connectionMonitors',\n      'Microsoft.Network/frontdoors',\n      'Microsoft.NotificationHubs/namespaces/notificationHubs',\n      'Microsoft.OperationalInsights/workspaces',\n      'Microsoft.PowerBIDedicated/capacities',\n      'Microsoft.Relay/namespaces',\n      'Microsoft.ServiceBus/namespaces',\n      'Microsoft.Sql/servers/databases',\n      'Microsoft.Sql/servers/elasticPools',\n      'Microsoft.Sql/managedInstances',\n      'Microsoft.Storage/storageAccounts',\n      'Microsoft.Storage/storageAccounts/blobServices',\n      'Microsoft.Storage/storageAccounts/fileServices',\n      'Microsoft.Storage/storageAccounts/queueServices',\n      'Microsoft.Storage/storageAccounts/tableServices',\n      'Microsoft.Web/serverfarms',\n      'Microsoft.Web/sites',\n      'Microsoft.Web/sites/slots',\n      'Microsoft.Web/hostingEnvironments/multiRolePools',\n      'Microsoft.Web/hostingEnvironments/workerPools',\n    ],\n    germanyazuremonitor: [\n      'Microsoft.AnalysisServices/servers',\n      'Microsoft.Batch/batchAccounts',\n      'Microsoft.Cache/redis',\n      'Microsoft.ClassicCompute/virtualMachines',\n      'Microsoft.ClassicCompute/domainNames/slots/roles',\n      'Microsoft.Compute/virtualMachines',\n      'Microsoft.Compute/virtualMachineScaleSets',\n      'Microsoft.DBforMySQL/servers',\n      'Microsoft.DBforPostgreSQL/servers',\n      'Microsoft.Devices/IotHubs',\n      'Microsoft.Devices/provisioningServices',\n      'Microsoft.EventHub/namespaces',\n      'Microsoft.EventHub/clusters',\n      'Microsoft.Insights/AutoscaleSettings',\n      'Microsoft.KeyVault/vaults',\n      'Microsoft.Network/networkInterfaces',\n      'Microsoft.Network/loadBalancers',\n      'Microsoft.Network/dnsZones',\n      'Microsoft.Network/publicIPAddresses',\n      'Microsoft.Network/azureFirewalls',\n      'Microsoft.Network/applicationGateways',\n      'Microsoft.Network/virtualNetworkGateways',\n      'Microsoft.Network/expressRouteCircuits',\n      'Microsoft.Network/expressRouteCircuits/Peerings',\n      'Microsoft.Network/connections',\n      'Microsoft.Network/trafficManagerProfiles',\n      'Microsoft.Network/networkWatchers/connectionMonitors',\n      'Microsoft.Network/frontdoors',\n      'Microsoft.NotificationHubs/namespaces/notificationHubs',\n      'Microsoft.OperationalInsights/workspaces',\n      'Microsoft.PowerBIDedicated/capacities',\n      'Microsoft.Relay/namespaces',\n      'Microsoft.ServiceBus/namespaces',\n      'Microsoft.Sql/servers/databases',\n      'Microsoft.Sql/servers/elasticPools',\n      'Microsoft.Sql/managedInstances',\n      'Microsoft.Storage/storageAccounts',\n      'Microsoft.Storage/storageAccounts/blobServices',\n      'Microsoft.Storage/storageAccounts/fileServices',\n      'Microsoft.Storage/storageAccounts/queueServices',\n      'Microsoft.Storage/storageAccounts/tableServices',\n      'Microsoft.StreamAnalytics/streamingJobs',\n      'Microsoft.Web/serverfarms',\n      'Microsoft.Web/sites',\n      'Microsoft.Web/sites/slots',\n      'Microsoft.Web/hostingEnvironments/multiRolePools',\n      'Microsoft.Web/hostingEnvironments/workerPools',\n    ],\n    chinaazuremonitor: [\n      'Microsoft.AnalysisServices/servers',\n      'Microsoft.Batch/batchAccounts',\n      'Microsoft.Cache/redis',\n      'Microsoft.ClassicCompute/virtualMachines',\n      'Microsoft.ClassicCompute/domainNames/slots/roles',\n      'Microsoft.CognitiveServices/accounts',\n      'Microsoft.Compute/virtualMachines',\n      'Microsoft.Compute/virtualMachineScaleSets',\n      'Microsoft.ContainerRegistry/registries',\n      'Microsoft.DBforMySQL/servers',\n      'Microsoft.DBforPostgreSQL/servers',\n      'Microsoft.Devices/IotHubs',\n      'Microsoft.Devices/provisioningServices',\n      'Microsoft.EventHub/namespaces',\n      'Microsoft.Insights/AutoscaleSettings',\n      'Microsoft.KeyVault/vaults',\n      'Microsoft.Logic/workflows',\n      'Microsoft.Network/networkInterfaces',\n      'Microsoft.Network/loadBalancers',\n      'Microsoft.Network/dnsZones',\n      'Microsoft.Network/publicIPAddresses',\n      'Microsoft.Network/azureFirewalls',\n      'Microsoft.Network/applicationGateways',\n      'Microsoft.Network/virtualNetworkGateways',\n      'Microsoft.Network/expressRouteCircuits',\n      'Microsoft.Network/expressRouteCircuits/Peerings',\n      'Microsoft.Network/connections',\n      'Microsoft.Network/trafficManagerProfiles',\n      'Microsoft.Network/networkWatchers/connectionMonitors',\n      'Microsoft.Network/frontdoors',\n      'Microsoft.NotificationHubs/namespaces/notificationHubs',\n      'Microsoft.PowerBIDedicated/capacities',\n      'Microsoft.Relay/namespaces',\n      'Microsoft.ServiceBus/namespaces',\n      'Microsoft.Sql/servers/databases',\n      'Microsoft.Sql/servers/elasticPools',\n      'Microsoft.Sql/managedInstances',\n      'Microsoft.Storage/storageAccounts',\n      'Microsoft.Storage/storageAccounts/blobServices',\n      'Microsoft.Storage/storageAccounts/fileServices',\n      'Microsoft.Storage/storageAccounts/queueServices',\n      'Microsoft.Storage/storageAccounts/tableServices',\n      'Microsoft.StreamAnalytics/streamingJobs',\n      'Microsoft.Web/serverfarms',\n      'Microsoft.Web/sites',\n      'Microsoft.Web/sites/slots',\n      'Microsoft.Web/hostingEnvironments/multiRolePools',\n      'Microsoft.Web/hostingEnvironments/workerPools',\n    ],\n  };\n\n  constructor(private cloudName: string) {}\n\n  get(): string[] {\n    return this.supportedMetricNamespaces[this.cloudName];\n  }\n}\n","import { filter, startsWith } from 'lodash';\nimport UrlBuilder from './url_builder';\nimport ResponseParser from './response_parser';\nimport SupportedNamespaces from './supported_namespaces';\nimport TimegrainConverter from '../time_grain_converter';\nimport {\n  AzureMonitorQuery,\n  AzureDataSourceJsonData,\n  AzureMonitorMetricDefinitionsResponse,\n  AzureMonitorResourceGroupsResponse,\n  AzureQueryType,\n} from '../types';\nimport { DataSourceInstanceSettings, ScopedVars, MetricFindValue } from '@grafana/data';\nimport { getBackendSrv, DataSourceWithBackend, getTemplateSrv } from '@grafana/runtime';\n\nconst defaultDropdownValue = 'select';\n\nexport default class AzureMonitorDatasource extends DataSourceWithBackend<AzureMonitorQuery, AzureDataSourceJsonData> {\n  apiVersion = '2018-01-01';\n  apiPreviewVersion = '2017-12-01-preview';\n  subscriptionId: string;\n  baseUrl: string;\n  resourceGroup: string;\n  resourceName: string;\n  url: string;\n  cloudName: string;\n  supportedMetricNamespaces: string[] = [];\n\n  constructor(private instanceSettings: DataSourceInstanceSettings<AzureDataSourceJsonData>) {\n    super(instanceSettings);\n\n    this.subscriptionId = instanceSettings.jsonData.subscriptionId;\n    this.cloudName = instanceSettings.jsonData.cloudName || 'azuremonitor';\n    this.baseUrl = `/${this.cloudName}/subscriptions`;\n    this.url = instanceSettings.url!;\n    this.supportedMetricNamespaces = new SupportedNamespaces(this.cloudName).get();\n  }\n\n  isConfigured(): boolean {\n    return !!this.subscriptionId && this.subscriptionId.length > 0;\n  }\n\n  filterQuery(item: AzureMonitorQuery): boolean {\n    return (\n      item.hide !== true &&\n      item.azureMonitor.resourceGroup !== defaultDropdownValue &&\n      item.azureMonitor.resourceName !== defaultDropdownValue &&\n      item.azureMonitor.metricDefinition !== defaultDropdownValue &&\n      item.azureMonitor.metricName !== defaultDropdownValue\n    );\n  }\n\n  applyTemplateVariables(target: AzureMonitorQuery, scopedVars: ScopedVars): Record<string, any> {\n    const item = target.azureMonitor;\n\n    // fix for timeGrainUnit which is a deprecated/removed field name\n    if (item.timeGrainUnit && item.timeGrain !== 'auto') {\n      item.timeGrain = TimegrainConverter.createISO8601Duration(item.timeGrain, item.timeGrainUnit);\n    }\n\n    const templateSrv = getTemplateSrv();\n\n    const subscriptionId = templateSrv.replace(target.subscription || this.subscriptionId, scopedVars);\n    const resourceGroup = templateSrv.replace(item.resourceGroup, scopedVars);\n    const resourceName = templateSrv.replace(item.resourceName, scopedVars);\n    const metricNamespace = templateSrv.replace(item.metricNamespace, scopedVars);\n    const metricDefinition = templateSrv.replace(item.metricDefinition, scopedVars);\n    const timeGrain = templateSrv.replace((item.timeGrain || '').toString(), scopedVars);\n    const aggregation = templateSrv.replace(item.aggregation, scopedVars);\n    const top = templateSrv.replace(item.top || '', scopedVars);\n\n    const dimensionFilters = item.dimensionFilters\n      .filter(f => f.dimension && f.dimension !== 'None')\n      .map(f => {\n        const filter = templateSrv.replace(f.filter ?? '', scopedVars);\n        return {\n          dimension: templateSrv.replace(f.dimension, scopedVars),\n          operator: f.operator || 'eq',\n          filter: filter || '*', // send * when empty\n        };\n      });\n\n    return {\n      refId: target.refId,\n      subscription: subscriptionId,\n      queryType: AzureQueryType.AzureMonitor,\n      azureMonitor: {\n        resourceGroup,\n        resourceName,\n        metricDefinition,\n        timeGrain,\n        allowedTimeGrainsMs: item.allowedTimeGrainsMs,\n        metricName: templateSrv.replace(item.metricName, scopedVars),\n        metricNamespace:\n          metricNamespace && metricNamespace !== defaultDropdownValue ? metricNamespace : metricDefinition,\n        aggregation: aggregation,\n        dimensionFilters,\n        top: top || '10',\n        alias: item.alias,\n        format: target.format,\n      },\n    };\n  }\n\n  /**\n   * This is named differently than DataSourceApi.metricFindQuery\n   * because it's not exposed to Grafana like the main AzureMonitorDataSource.\n   * And some of the azure internal data sources return null in this function, which the\n   * external interface does not support\n   */\n  metricFindQueryInternal(query: string): Promise<MetricFindValue[]> | null {\n    const subscriptionsQuery = query.match(/^Subscriptions\\(\\)/i);\n    if (subscriptionsQuery) {\n      return this.getSubscriptions();\n    }\n\n    const resourceGroupsQuery = query.match(/^ResourceGroups\\(\\)/i);\n    if (resourceGroupsQuery) {\n      return this.getResourceGroups(this.subscriptionId);\n    }\n\n    const resourceGroupsQueryWithSub = query.match(/^ResourceGroups\\(([^\\)]+?)(,\\s?([^,]+?))?\\)/i);\n    if (resourceGroupsQueryWithSub) {\n      return this.getResourceGroups(this.toVariable(resourceGroupsQueryWithSub[1]));\n    }\n\n    const metricDefinitionsQuery = query.match(/^Namespaces\\(([^\\)]+?)(,\\s?([^,]+?))?\\)/i);\n    if (metricDefinitionsQuery) {\n      if (!metricDefinitionsQuery[3]) {\n        return this.getMetricDefinitions(this.subscriptionId, this.toVariable(metricDefinitionsQuery[1]));\n      }\n    }\n\n    const metricDefinitionsQueryWithSub = query.match(/^Namespaces\\(([^,]+?),\\s?([^,]+?)\\)/i);\n    if (metricDefinitionsQueryWithSub) {\n      return this.getMetricDefinitions(\n        this.toVariable(metricDefinitionsQueryWithSub[1]),\n        this.toVariable(metricDefinitionsQueryWithSub[2])\n      );\n    }\n\n    const resourceNamesQuery = query.match(/^ResourceNames\\(([^,]+?),\\s?([^,]+?)\\)/i);\n    if (resourceNamesQuery) {\n      const resourceGroup = this.toVariable(resourceNamesQuery[1]);\n      const metricDefinition = this.toVariable(resourceNamesQuery[2]);\n      return this.getResourceNames(this.subscriptionId, resourceGroup, metricDefinition);\n    }\n\n    const resourceNamesQueryWithSub = query.match(/^ResourceNames\\(([^,]+?),\\s?([^,]+?),\\s?(.+?)\\)/i);\n    if (resourceNamesQueryWithSub) {\n      const subscription = this.toVariable(resourceNamesQueryWithSub[1]);\n      const resourceGroup = this.toVariable(resourceNamesQueryWithSub[2]);\n      const metricDefinition = this.toVariable(resourceNamesQueryWithSub[3]);\n      return this.getResourceNames(subscription, resourceGroup, metricDefinition);\n    }\n\n    const metricNamespaceQuery = query.match(/^MetricNamespace\\(([^,]+?),\\s?([^,]+?),\\s?([^,]+?)\\)/i);\n    if (metricNamespaceQuery) {\n      const resourceGroup = this.toVariable(metricNamespaceQuery[1]);\n      const metricDefinition = this.toVariable(metricNamespaceQuery[2]);\n      const resourceName = this.toVariable(metricNamespaceQuery[3]);\n      return this.getMetricNamespaces(this.subscriptionId, resourceGroup, metricDefinition, resourceName);\n    }\n\n    const metricNamespaceQueryWithSub = query.match(\n      /^metricnamespace\\(([^,]+?),\\s?([^,]+?),\\s?([^,]+?),\\s?([^,]+?)\\)/i\n    );\n    if (metricNamespaceQueryWithSub) {\n      const subscription = this.toVariable(metricNamespaceQueryWithSub[1]);\n      const resourceGroup = this.toVariable(metricNamespaceQueryWithSub[2]);\n      const metricDefinition = this.toVariable(metricNamespaceQueryWithSub[3]);\n      const resourceName = this.toVariable(metricNamespaceQueryWithSub[4]);\n      return this.getMetricNamespaces(subscription, resourceGroup, metricDefinition, resourceName);\n    }\n\n    const metricNamesQuery = query.match(/^MetricNames\\(([^,]+?),\\s?([^,]+?),\\s?([^,]+?),\\s?([^,]+?)\\)/i);\n    if (metricNamesQuery) {\n      if (metricNamesQuery[3].indexOf(',') === -1) {\n        const resourceGroup = this.toVariable(metricNamesQuery[1]);\n        const metricDefinition = this.toVariable(metricNamesQuery[2]);\n        const resourceName = this.toVariable(metricNamesQuery[3]);\n        const metricNamespace = this.toVariable(metricNamesQuery[4]);\n        return this.getMetricNames(this.subscriptionId, resourceGroup, metricDefinition, resourceName, metricNamespace);\n      }\n    }\n\n    const metricNamesQueryWithSub = query.match(\n      /^MetricNames\\(([^,]+?),\\s?([^,]+?),\\s?([^,]+?),\\s?([^,]+?),\\s?(.+?)\\)/i\n    );\n\n    if (metricNamesQueryWithSub) {\n      const subscription = this.toVariable(metricNamesQueryWithSub[1]);\n      const resourceGroup = this.toVariable(metricNamesQueryWithSub[2]);\n      const metricDefinition = this.toVariable(metricNamesQueryWithSub[3]);\n      const resourceName = this.toVariable(metricNamesQueryWithSub[4]);\n      const metricNamespace = this.toVariable(metricNamesQueryWithSub[5]);\n      return this.getMetricNames(subscription, resourceGroup, metricDefinition, resourceName, metricNamespace);\n    }\n\n    return null;\n  }\n\n  toVariable(metric: string) {\n    return getTemplateSrv().replace((metric || '').trim());\n  }\n\n  getSubscriptions(route?: string) {\n    const url = `/${route || this.cloudName}/subscriptions?api-version=2019-03-01`;\n    return this.doRequest(url).then((result: any) => {\n      return ResponseParser.parseSubscriptions(result);\n    });\n  }\n\n  getResourceGroups(subscriptionId: string) {\n    const url = `${this.baseUrl}/${subscriptionId}/resourceGroups?api-version=${this.apiVersion}`;\n    return this.doRequest(url).then((result: AzureMonitorResourceGroupsResponse) => {\n      return ResponseParser.parseResponseValues(result, 'name', 'name');\n    });\n  }\n\n  getMetricDefinitions(subscriptionId: string, resourceGroup: string) {\n    const url = `${this.baseUrl}/${subscriptionId}/resourceGroups/${resourceGroup}/resources?api-version=${this.apiVersion}`;\n    return this.doRequest(url)\n      .then((result: AzureMonitorMetricDefinitionsResponse) => {\n        return ResponseParser.parseResponseValues(result, 'type', 'type');\n      })\n      .then((result: any) => {\n        return filter(result, t => {\n          for (let i = 0; i < this.supportedMetricNamespaces.length; i++) {\n            if (t.value.toLowerCase() === this.supportedMetricNamespaces[i].toLowerCase()) {\n              return true;\n            }\n          }\n\n          return false;\n        });\n      })\n      .then((result: any) => {\n        let shouldHardcodeBlobStorage = false;\n        for (let i = 0; i < result.length; i++) {\n          if (result[i].value === 'Microsoft.Storage/storageAccounts') {\n            shouldHardcodeBlobStorage = true;\n            break;\n          }\n        }\n\n        if (shouldHardcodeBlobStorage) {\n          result.push({\n            text: 'Microsoft.Storage/storageAccounts/blobServices',\n            value: 'Microsoft.Storage/storageAccounts/blobServices',\n          });\n          result.push({\n            text: 'Microsoft.Storage/storageAccounts/fileServices',\n            value: 'Microsoft.Storage/storageAccounts/fileServices',\n          });\n          result.push({\n            text: 'Microsoft.Storage/storageAccounts/tableServices',\n            value: 'Microsoft.Storage/storageAccounts/tableServices',\n          });\n          result.push({\n            text: 'Microsoft.Storage/storageAccounts/queueServices',\n            value: 'Microsoft.Storage/storageAccounts/queueServices',\n          });\n        }\n\n        return result;\n      });\n  }\n\n  getResourceNames(subscriptionId: string, resourceGroup: string, metricDefinition: string) {\n    const url = `${this.baseUrl}/${subscriptionId}/resourceGroups/${resourceGroup}/resources?api-version=${this.apiVersion}`;\n\n    return this.doRequest(url).then((result: any) => {\n      if (!startsWith(metricDefinition, 'Microsoft.Storage/storageAccounts/')) {\n        return ResponseParser.parseResourceNames(result, metricDefinition);\n      }\n\n      const list = ResponseParser.parseResourceNames(result, 'Microsoft.Storage/storageAccounts');\n      for (let i = 0; i < list.length; i++) {\n        list[i].text += '/default';\n        list[i].value += '/default';\n      }\n\n      return list;\n    });\n  }\n\n  getMetricNamespaces(subscriptionId: string, resourceGroup: string, metricDefinition: string, resourceName: string) {\n    const url = UrlBuilder.buildAzureMonitorGetMetricNamespacesUrl(\n      this.baseUrl,\n      subscriptionId,\n      resourceGroup,\n      metricDefinition,\n      resourceName,\n      this.apiPreviewVersion\n    );\n\n    return this.doRequest(url).then((result: any) => {\n      return ResponseParser.parseResponseValues(result, 'name', 'properties.metricNamespaceName');\n    });\n  }\n\n  getMetricNames(\n    subscriptionId: string,\n    resourceGroup: string,\n    metricDefinition: string,\n    resourceName: string,\n    metricNamespace: string\n  ) {\n    const url = UrlBuilder.buildAzureMonitorGetMetricNamesUrl(\n      this.baseUrl,\n      subscriptionId,\n      resourceGroup,\n      metricDefinition,\n      resourceName,\n      metricNamespace,\n      this.apiVersion\n    );\n\n    return this.doRequest(url).then((result: any) => {\n      return ResponseParser.parseResponseValues(result, 'name.localizedValue', 'name.value');\n    });\n  }\n\n  getMetricMetadata(\n    subscriptionId: string,\n    resourceGroup: string,\n    metricDefinition: string,\n    resourceName: string,\n    metricNamespace: string,\n    metricName: string\n  ) {\n    const url = UrlBuilder.buildAzureMonitorGetMetricNamesUrl(\n      this.baseUrl,\n      subscriptionId,\n      resourceGroup,\n      metricDefinition,\n      resourceName,\n      metricNamespace,\n      this.apiVersion\n    );\n\n    return this.doRequest(url).then((result: any) => {\n      return ResponseParser.parseMetadata(result, metricName);\n    });\n  }\n\n  testDatasource(): Promise<any> {\n    if (!this.isValidConfigField(this.instanceSettings.jsonData.tenantId)) {\n      return Promise.resolve({\n        status: 'error',\n        message: 'The Tenant Id field is required.',\n      });\n    }\n\n    if (!this.isValidConfigField(this.instanceSettings.jsonData.clientId)) {\n      return Promise.resolve({\n        status: 'error',\n        message: 'The Client Id field is required.',\n      });\n    }\n\n    const url = `/${this.cloudName}/subscriptions?api-version=2019-03-01`;\n    return this.doRequest(url)\n      .then((response: any) => {\n        if (response.status === 200) {\n          return {\n            status: 'success',\n            message: 'Successfully queried the Azure Monitor service.',\n            title: 'Success',\n          };\n        }\n\n        return {\n          status: 'error',\n          message: 'Returned http status code ' + response.status,\n        };\n      })\n      .catch((error: any) => {\n        let message = 'Azure Monitor: ';\n        message += error.statusText ? error.statusText + ': ' : '';\n\n        if (error.data && error.data.error && error.data.error.code) {\n          message += error.data.error.code + '. ' + error.data.error.message;\n        } else if (error.data && error.data.error) {\n          message += error.data.error;\n        } else if (error.data) {\n          message += error.data;\n        } else {\n          message += 'Cannot connect to Azure Monitor REST API.';\n        }\n        return {\n          status: 'error',\n          message: message,\n        };\n      });\n  }\n\n  isValidConfigField(field?: string) {\n    return field && field.length > 0;\n  }\n\n  doRequest(url: string, maxRetries = 1): Promise<any> {\n    return getBackendSrv()\n      .datasourceRequest({\n        url: this.url + url,\n        method: 'GET',\n      })\n      .catch((error: any) => {\n        if (maxRetries > 0) {\n          return this.doRequest(url, maxRetries - 1);\n        }\n\n        throw error;\n      });\n  }\n}\n","import _ from 'lodash';\nimport { dateTime } from '@grafana/data';\n\nexport default class ResponseParser {\n  constructor(private results: any) {}\n\n  parseQueryResult() {\n    let data: any = [];\n    let columns: any = [];\n    for (let i = 0; i < this.results.length; i++) {\n      if (this.results[i].query.raw) {\n        const xaxis = this.results[i].query.xaxis;\n        const yaxises = this.results[i].query.yaxis;\n        const spliton = this.results[i].query.spliton;\n        columns = this.results[i].result.data.Tables[0].Columns;\n        const rows = this.results[i].result.data.Tables[0].Rows;\n        data = _.concat(\n          data,\n          this.parseRawQueryResultRow(this.results[i].query, columns, rows, xaxis, yaxises, spliton)\n        );\n      } else {\n        const value = this.results[i].result.data.value;\n        const alias = this.results[i].query.alias;\n        data = _.concat(data, this.parseQueryResultRow(this.results[i].query, value, alias));\n      }\n    }\n    return data;\n  }\n\n  parseRawQueryResultRow(query: any, columns: any, rows: any, xaxis: string, yaxises: string, spliton: string) {\n    const data: any[] = [];\n    const columnsForDropdown = _.map(columns, column => ({ text: column.ColumnName, value: column.ColumnName }));\n\n    const xaxisColumn = columns.findIndex((column: any) => column.ColumnName === xaxis);\n    const yaxisesSplit = yaxises.split(',');\n    const yaxisColumns: any = {};\n    _.forEach(yaxisesSplit, yaxis => {\n      yaxisColumns[yaxis] = columns.findIndex((column: any) => column.ColumnName === yaxis);\n    });\n    const splitonColumn = columns.findIndex((column: any) => column.ColumnName === spliton);\n    const convertTimestamp = xaxis === 'timestamp';\n\n    _.forEach(rows, row => {\n      _.forEach(yaxisColumns, (yaxisColumn, yaxisName) => {\n        const bucket =\n          splitonColumn === -1\n            ? ResponseParser.findOrCreateBucket(data, yaxisName)\n            : ResponseParser.findOrCreateBucket(data, row[splitonColumn]);\n        const epoch = convertTimestamp ? ResponseParser.dateTimeToEpoch(row[xaxisColumn]) : row[xaxisColumn];\n        bucket.datapoints.push([row[yaxisColumn], epoch]);\n        bucket.refId = query.refId;\n        bucket.query = query.query;\n        bucket.columnsForDropdown = columnsForDropdown;\n      });\n    });\n\n    return data;\n  }\n\n  parseQueryResultRow(query: any, value: any, alias: string) {\n    const data: any[] = [];\n\n    if (ResponseParser.isSingleValue(value)) {\n      const metricName = ResponseParser.getMetricFieldKey(value);\n      const aggField = ResponseParser.getKeyForAggregationField(value[metricName]);\n      const epoch = ResponseParser.dateTimeToEpoch(value.end);\n      data.push({\n        target: metricName,\n        datapoints: [[value[metricName][aggField], epoch]],\n        refId: query.refId,\n        query: query.query,\n      });\n      return data;\n    }\n\n    const groupedBy = ResponseParser.hasSegmentsField(value.segments[0]);\n    if (!groupedBy) {\n      const metricName = ResponseParser.getMetricFieldKey(value.segments[0]);\n      const dataTarget = ResponseParser.findOrCreateBucket(data, metricName);\n\n      for (let i = 0; i < value.segments.length; i++) {\n        const epoch = ResponseParser.dateTimeToEpoch(value.segments[i].end);\n        const aggField: string = ResponseParser.getKeyForAggregationField(value.segments[i][metricName]);\n\n        dataTarget.datapoints.push([value.segments[i][metricName][aggField], epoch]);\n      }\n      dataTarget.refId = query.refId;\n      dataTarget.query = query.query;\n    } else {\n      for (let i = 0; i < value.segments.length; i++) {\n        const epoch = ResponseParser.dateTimeToEpoch(value.segments[i].end);\n\n        for (let j = 0; j < value.segments[i].segments.length; j++) {\n          const metricName = ResponseParser.getMetricFieldKey(value.segments[i].segments[j]);\n          const aggField = ResponseParser.getKeyForAggregationField(value.segments[i].segments[j][metricName]);\n          const target = this.getTargetName(value.segments[i].segments[j], alias);\n\n          const bucket = ResponseParser.findOrCreateBucket(data, target);\n          bucket.datapoints.push([value.segments[i].segments[j][metricName][aggField], epoch]);\n          bucket.refId = query.refId;\n          bucket.meta = {\n            query: query.query,\n          };\n        }\n      }\n    }\n\n    return data;\n  }\n\n  getTargetName(segment: { [x: string]: string }, alias: string) {\n    let metric = '';\n    let segmentName = '';\n    let segmentValue = '';\n    for (const prop in segment) {\n      if (_.isObject(segment[prop])) {\n        metric = prop;\n      } else {\n        segmentName = prop;\n        segmentValue = segment[prop];\n      }\n    }\n\n    if (alias) {\n      const regex = /\\{\\{([\\s\\S]+?)\\}\\}/g;\n      return alias.replace(regex, (match, g1, g2) => {\n        const group = g1 || g2;\n\n        if (group === 'metric') {\n          return metric;\n        } else if (group === 'groupbyname') {\n          return segmentName;\n        } else if (group === 'groupbyvalue') {\n          return segmentValue;\n        }\n\n        return match;\n      });\n    }\n\n    return metric + `{${segmentName}=\"${segmentValue}\"}`;\n  }\n\n  static isSingleValue(value: any) {\n    return !ResponseParser.hasSegmentsField(value);\n  }\n\n  static findOrCreateBucket(data: any[], target: string) {\n    let dataTarget: any = _.find(data, ['target', target]);\n    if (!dataTarget) {\n      dataTarget = { target: target, datapoints: [] };\n      data.push(dataTarget);\n    }\n\n    return dataTarget;\n  }\n\n  static hasSegmentsField(obj: any) {\n    const keys = _.keys(obj);\n    return _.indexOf(keys, 'segments') > -1;\n  }\n\n  static getMetricFieldKey(segment: { [x: string]: any }) {\n    const keys = _.keys(segment);\n\n    return _.filter(_.without(keys, 'start', 'end'), key => {\n      return _.isObject(segment[key]);\n    })[0];\n  }\n\n  static getKeyForAggregationField(dataObj: any): string {\n    const keys = _.keys(dataObj);\n    return _.intersection(keys, ['sum', 'avg', 'min', 'max', 'count', 'unique'])[0];\n  }\n\n  static dateTimeToEpoch(dateTimeValue: any) {\n    return dateTime(dateTimeValue).valueOf();\n  }\n\n  static parseMetricNames(result: { data: { metrics: any } }) {\n    const keys = _.keys(result.data.metrics);\n\n    return ResponseParser.toTextValueList(keys);\n  }\n\n  parseMetadata(metricName: string) {\n    const metric = this.results.data.metrics[metricName];\n\n    if (!metric) {\n      throw Error('No data found for metric: ' + metricName);\n    }\n\n    return {\n      primaryAggType: metric.defaultAggregation,\n      supportedAggTypes: metric.supportedAggregations,\n      supportedGroupBy: metric.supportedGroupBy.all,\n    };\n  }\n\n  parseGroupBys() {\n    return ResponseParser.toTextValueList(this.results.supportedGroupBy);\n  }\n\n  parseQuerySchema() {\n    const result: any = {\n      Type: 'AppInsights',\n      Tables: {},\n    };\n    if (this.results && this.results.data && this.results.data.Tables) {\n      for (let i = 0; i < this.results.data.Tables[0].Rows.length; i++) {\n        const column = this.results.data.Tables[0].Rows[i];\n        const columnTable = column[0];\n        const columnName = column[1];\n        const columnType = column[2];\n        if (result.Tables[columnTable]) {\n          result.Tables[columnTable].OrderedColumns.push({ Name: columnName, Type: columnType });\n        } else {\n          result.Tables[columnTable] = {\n            Name: columnTable,\n            OrderedColumns: [{ Name: columnName, Type: columnType }],\n          };\n        }\n      }\n    }\n    return result;\n  }\n\n  static toTextValueList(values: any) {\n    const list: any[] = [];\n    for (let i = 0; i < values.length; i++) {\n      list.push({\n        text: values[i],\n        value: values[i],\n      });\n    }\n    return list;\n  }\n}\n","import { ScopedVars, MetricFindValue } from '@grafana/data';\nimport { DataQueryRequest, DataSourceInstanceSettings } from '@grafana/data';\nimport { getBackendSrv, getTemplateSrv, DataSourceWithBackend } from '@grafana/runtime';\nimport _, { isString } from 'lodash';\n\nimport TimegrainConverter from '../time_grain_converter';\nimport { AzureDataSourceJsonData, AzureMonitorQuery, AzureQueryType } from '../types';\nimport ResponseParser from './response_parser';\n\nexport interface LogAnalyticsColumn {\n  text: string;\n  value: string;\n}\nexport default class AppInsightsDatasource extends DataSourceWithBackend<AzureMonitorQuery, AzureDataSourceJsonData> {\n  url: string;\n  baseUrl: string;\n  version = 'beta';\n  applicationId: string;\n  logAnalyticsColumns: { [key: string]: LogAnalyticsColumn[] } = {};\n\n  constructor(instanceSettings: DataSourceInstanceSettings<AzureDataSourceJsonData>) {\n    super(instanceSettings);\n    this.applicationId = instanceSettings.jsonData.appInsightsAppId || '';\n\n    switch (instanceSettings.jsonData?.cloudName) {\n      // Azure US Government\n      case 'govazuremonitor':\n        break;\n      // Azure Germany\n      case 'germanyazuremonitor':\n        break;\n      // Azue China\n      case 'chinaazuremonitor':\n        this.baseUrl = `/chinaappinsights/${this.version}/apps/${this.applicationId}`;\n        break;\n      // Azure Global\n      default:\n        this.baseUrl = `/appinsights/${this.version}/apps/${this.applicationId}`;\n    }\n\n    this.url = instanceSettings.url || '';\n  }\n\n  isConfigured(): boolean {\n    return !!this.applicationId && this.applicationId.length > 0;\n  }\n\n  createRawQueryRequest(item: any, options: DataQueryRequest<AzureMonitorQuery>, target: AzureMonitorQuery) {\n    if (item.xaxis && !item.timeColumn) {\n      item.timeColumn = item.xaxis;\n    }\n\n    if (item.yaxis && !item.valueColumn) {\n      item.valueColumn = item.yaxis;\n    }\n\n    if (item.spliton && !item.segmentColumn) {\n      item.segmentColumn = item.spliton;\n    }\n\n    return {\n      type: 'timeSeriesQuery',\n      raw: false,\n      appInsights: {\n        rawQuery: true,\n        rawQueryString: getTemplateSrv().replace(item.rawQueryString, options.scopedVars),\n        timeColumn: item.timeColumn,\n        valueColumn: item.valueColumn,\n        segmentColumn: item.segmentColumn,\n      },\n    };\n  }\n\n  applyTemplateVariables(target: AzureMonitorQuery, scopedVars: ScopedVars): Record<string, any> {\n    const item = target.appInsights!;\n\n    const old: any = item;\n    // fix for timeGrainUnit which is a deprecated/removed field name\n    if (old.timeGrainCount) {\n      item.timeGrain = TimegrainConverter.createISO8601Duration(old.timeGrainCount, item.timeGrainUnit);\n    } else if (item.timeGrainUnit && item.timeGrain !== 'auto') {\n      item.timeGrain = TimegrainConverter.createISO8601Duration(item.timeGrain, item.timeGrainUnit);\n    }\n\n    // migration for non-standard names\n    if (old.groupBy && !item.dimension) {\n      item.dimension = [old.groupBy];\n    }\n    if (old.filter && !item.dimensionFilter) {\n      item.dimensionFilter = old.filter;\n    }\n\n    // Migrate single dimension string to array\n    if (isString(item.dimension)) {\n      if (item.dimension === 'None') {\n        item.dimension = [];\n      } else {\n        item.dimension = [item.dimension as string];\n      }\n    }\n    if (!item.dimension) {\n      item.dimension = [];\n    }\n\n    const templateSrv = getTemplateSrv();\n\n    return {\n      type: 'timeSeriesQuery',\n      refId: target.refId,\n      format: target.format,\n      queryType: AzureQueryType.ApplicationInsights,\n      appInsights: {\n        timeGrain: templateSrv.replace((item.timeGrain || '').toString(), scopedVars),\n        allowedTimeGrainsMs: item.allowedTimeGrainsMs,\n        metricName: templateSrv.replace(item.metricName, scopedVars),\n        aggregation: templateSrv.replace(item.aggregation, scopedVars),\n        dimension: item.dimension.map(d => templateSrv.replace(d, scopedVars)),\n        dimensionFilter: templateSrv.replace(item.dimensionFilter, scopedVars),\n        alias: item.alias,\n        format: target.format,\n      },\n    };\n  }\n\n  /**\n   * This is named differently than DataSourceApi.metricFindQuery\n   * because it's not exposed to Grafana like the main AzureMonitorDataSource.\n   * And some of the azure internal data sources return null in this function, which the\n   * external interface does not support\n   */\n  metricFindQueryInternal(query: string): Promise<MetricFindValue[]> | null {\n    const appInsightsMetricNameQuery = query.match(/^AppInsightsMetricNames\\(\\)/i);\n    if (appInsightsMetricNameQuery) {\n      return this.getMetricNames();\n    }\n\n    const appInsightsGroupByQuery = query.match(/^AppInsightsGroupBys\\(([^\\)]+?)(,\\s?([^,]+?))?\\)/i);\n    if (appInsightsGroupByQuery) {\n      const metricName = appInsightsGroupByQuery[1];\n      return this.getGroupBys(getTemplateSrv().replace(metricName));\n    }\n\n    return null;\n  }\n\n  testDatasource() {\n    const url = `${this.baseUrl}/metrics/metadata`;\n    return this.doRequest(url)\n      .then((response: any) => {\n        if (response.status === 200) {\n          return {\n            status: 'success',\n            message: 'Successfully queried the Application Insights service.',\n            title: 'Success',\n          };\n        }\n\n        return {\n          status: 'error',\n          message: 'Application Insights: Returned http status code ' + response.status,\n        };\n      })\n      .catch((error: any) => {\n        let message = 'Application Insights: ';\n        message += error.statusText ? error.statusText + ': ' : '';\n\n        if (error.data && error.data.error && error.data.error.code === 'PathNotFoundError') {\n          message += 'Invalid Application Id for Application Insights service.';\n        } else if (error.data && error.data.error) {\n          message += error.data.error.code + '. ' + error.data.error.message;\n        } else {\n          message += 'Cannot connect to Application Insights REST API.';\n        }\n\n        return {\n          status: 'error',\n          message: message,\n        };\n      });\n  }\n\n  doRequest(url: any, maxRetries = 1): Promise<any> {\n    return getBackendSrv()\n      .datasourceRequest({\n        url: this.url + url,\n        method: 'GET',\n      })\n      .catch((error: any) => {\n        if (maxRetries > 0) {\n          return this.doRequest(url, maxRetries - 1);\n        }\n\n        throw error;\n      });\n  }\n\n  getMetricNames() {\n    const url = `${this.baseUrl}/metrics/metadata`;\n    return this.doRequest(url).then(ResponseParser.parseMetricNames);\n  }\n\n  getMetricMetadata(metricName: string) {\n    const url = `${this.baseUrl}/metrics/metadata`;\n    return this.doRequest(url).then((result: any) => {\n      return new ResponseParser(result).parseMetadata(metricName);\n    });\n  }\n\n  getGroupBys(metricName: string) {\n    return this.getMetricMetadata(metricName).then((result: any) => {\n      return new ResponseParser(result).parseGroupBys();\n    });\n  }\n\n  getQuerySchema() {\n    const url = `${this.baseUrl}/query/schema`;\n    return this.doRequest(url).then((result: any) => {\n      const schema = new ResponseParser(result).parseQuerySchema();\n      // console.log(schema);\n      return schema;\n    });\n  }\n}\n","import { dateTime } from '@grafana/data';\n\nexport default class LogAnalyticsQuerystringBuilder {\n  constructor(public rawQueryString: string, public options: any, public defaultTimeField: any) {}\n\n  generate() {\n    let queryString = this.rawQueryString;\n    const macroRegexp = /\\$__([_a-zA-Z0-9]+)\\(([^\\)]*)\\)/gi;\n    queryString = queryString.replace(macroRegexp, (match, p1, p2) => {\n      if (p1 === 'contains') {\n        return this.getMultiContains(p2);\n      }\n\n      return match;\n    });\n\n    queryString = queryString.replace(/\\$__escapeMulti\\(('[^]*')\\)/gi, (match, p1) => this.escape(p1));\n\n    if (this.options) {\n      queryString = queryString.replace(macroRegexp, (match, p1, p2) => {\n        if (p1 === 'timeFilter') {\n          return this.getTimeFilter(p2, this.options);\n        }\n        if (p1 === 'timeFrom') {\n          return this.getFrom(this.options);\n        }\n        if (p1 === 'timeTo') {\n          return this.getUntil(this.options);\n        }\n\n        return match;\n      });\n      queryString = queryString.replace(/\\$__interval/gi, this.options.interval);\n    }\n    const rawQuery = queryString;\n    queryString = encodeURIComponent(queryString);\n    const uriString = `query=${queryString}`;\n\n    return { uriString, rawQuery };\n  }\n\n  getFrom(options: any) {\n    const from = options.range.from;\n    return `datetime(${dateTime(from)\n      .startOf('minute')\n      .toISOString()})`;\n  }\n\n  getUntil(options: any) {\n    if (options.rangeRaw.to === 'now') {\n      const now = Date.now();\n      return `datetime(${dateTime(now)\n        .startOf('minute')\n        .toISOString()})`;\n    } else {\n      const until = options.range.to;\n      return `datetime(${dateTime(until)\n        .startOf('minute')\n        .toISOString()})`;\n    }\n  }\n\n  getTimeFilter(timeFieldArg: any, options: any) {\n    const timeField = timeFieldArg || this.defaultTimeField;\n    if (options.rangeRaw.to === 'now') {\n      return `${timeField} >= ${this.getFrom(options)}`;\n    } else {\n      return `${timeField}  >= ${this.getFrom(options)} and ${timeField} <= ${this.getUntil(options)}`;\n    }\n  }\n\n  getMultiContains(inputs: string) {\n    const firstCommaIndex = inputs.indexOf(',');\n    const field = inputs.substring(0, firstCommaIndex);\n    const templateVar = inputs.substring(inputs.indexOf(',') + 1);\n\n    if (templateVar && templateVar.toLowerCase().trim() === 'all') {\n      return '1 == 1';\n    }\n\n    return `${field.trim()} in (${templateVar.trim()})`;\n  }\n\n  escape(inputs: string) {\n    return inputs\n      .substring(1, inputs.length - 1)\n      .split(`','`)\n      .map(v => `@'${v}'`)\n      .join(', ');\n  }\n}\n","import _ from 'lodash';\nimport { AnnotationEvent, dateTime, TimeSeries } from '@grafana/data';\nimport {\n  AzureLogsTableData,\n  AzureLogsVariable,\n  KustoColumn,\n  KustoDatabase,\n  KustoFunction,\n  KustoSchema,\n  KustoTable,\n} from '../types';\n\nexport default class ResponseParser {\n  columns: string[];\n  constructor(private results: any) {}\n\n  parseQueryResult(): any {\n    let data: any[] = [];\n    let columns: any[] = [];\n    for (let i = 0; i < this.results.length; i++) {\n      if (this.results[i].result.data.tables.length === 0) {\n        continue;\n      }\n      columns = this.results[i].result.data.tables[0].columns;\n      const rows = this.results[i].result.data.tables[0].rows;\n\n      if (this.results[i].query.resultFormat === 'time_series') {\n        data = _.concat(data, this.parseTimeSeriesResult(this.results[i].query, columns, rows));\n      } else {\n        data = _.concat(data, this.parseTableResult(this.results[i].query, columns, rows));\n      }\n    }\n\n    return data;\n  }\n\n  parseTimeSeriesResult(query: { refId: string; query: any }, columns: any[], rows: any): TimeSeries[] {\n    const data: TimeSeries[] = [];\n    let timeIndex = -1;\n    let metricIndex = -1;\n    let valueIndex = -1;\n\n    for (let i = 0; i < columns.length; i++) {\n      if (timeIndex === -1 && columns[i].type === 'datetime') {\n        timeIndex = i;\n      }\n\n      if (metricIndex === -1 && columns[i].type === 'string') {\n        metricIndex = i;\n      }\n\n      if (valueIndex === -1 && ['int', 'long', 'real', 'double'].indexOf(columns[i].type) > -1) {\n        valueIndex = i;\n      }\n    }\n\n    if (timeIndex === -1) {\n      throw new Error('No datetime column found in the result. The Time Series format requires a time column.');\n    }\n\n    _.forEach(rows, row => {\n      const epoch = ResponseParser.dateTimeToEpoch(row[timeIndex]);\n      const metricName = metricIndex > -1 ? row[metricIndex] : columns[valueIndex].name;\n      const bucket = ResponseParser.findOrCreateBucket(data, metricName);\n      bucket.datapoints.push([row[valueIndex], epoch]);\n      bucket.refId = query.refId;\n      bucket.meta = {\n        executedQueryString: query.query,\n      };\n    });\n\n    return data;\n  }\n\n  parseTableResult(query: { refId: string; query: string }, columns: any[], rows: any[]): AzureLogsTableData {\n    const tableResult: AzureLogsTableData = {\n      type: 'table',\n      columns: _.map(columns, col => {\n        return { text: col.name, type: col.type };\n      }),\n      rows: rows,\n      refId: query.refId,\n      meta: {\n        executedQueryString: query.query,\n      },\n    };\n\n    return tableResult;\n  }\n\n  parseToVariables(): AzureLogsVariable[] {\n    const queryResult = this.parseQueryResult();\n\n    const variables: AzureLogsVariable[] = [];\n    _.forEach(queryResult, result => {\n      _.forEach(_.flattenDeep(result.rows), row => {\n        variables.push({\n          text: row,\n          value: row,\n        } as AzureLogsVariable);\n      });\n    });\n\n    return variables;\n  }\n\n  transformToAnnotations(options: any) {\n    const queryResult = this.parseQueryResult();\n\n    const list: AnnotationEvent[] = [];\n\n    _.forEach(queryResult, result => {\n      let timeIndex = -1;\n      let textIndex = -1;\n      let tagsIndex = -1;\n\n      for (let i = 0; i < result.columns.length; i++) {\n        if (timeIndex === -1 && result.columns[i].type === 'datetime') {\n          timeIndex = i;\n        }\n\n        if (textIndex === -1 && result.columns[i].text.toLowerCase() === 'text') {\n          textIndex = i;\n        }\n\n        if (tagsIndex === -1 && result.columns[i].text.toLowerCase() === 'tags') {\n          tagsIndex = i;\n        }\n      }\n\n      _.forEach(result.rows, row => {\n        list.push({\n          annotation: options.annotation,\n          time: Math.floor(ResponseParser.dateTimeToEpoch(row[timeIndex])),\n          text: row[textIndex] ? row[textIndex].toString() : '',\n          tags: row[tagsIndex] ? row[tagsIndex].trim().split(/\\s*,\\s*/) : [],\n        });\n      });\n    });\n\n    return list;\n  }\n\n  parseSchemaResult(): KustoSchema {\n    return {\n      Plugins: [\n        {\n          Name: 'pivot',\n        },\n      ],\n      Databases: this.createSchemaDatabaseWithTables(),\n    };\n  }\n\n  createSchemaDatabaseWithTables(): { [key: string]: KustoDatabase } {\n    const databases = {\n      Default: {\n        Name: 'Default',\n        Tables: this.createSchemaTables(),\n        Functions: this.createSchemaFunctions(),\n      },\n    };\n\n    return databases;\n  }\n\n  createSchemaTables(): { [key: string]: KustoTable } {\n    const tables: { [key: string]: KustoTable } = {};\n\n    for (const table of this.results.tables) {\n      tables[table.name] = {\n        Name: table.name,\n        OrderedColumns: [],\n      };\n      for (const col of table.columns) {\n        tables[table.name].OrderedColumns.push(this.convertToKustoColumn(col));\n      }\n    }\n\n    return tables;\n  }\n\n  convertToKustoColumn(col: any): KustoColumn {\n    return {\n      Name: col.name,\n      Type: col.type,\n    };\n  }\n\n  createSchemaFunctions(): { [key: string]: KustoFunction } {\n    const functions: { [key: string]: KustoFunction } = {};\n    if (!this.results.functions) {\n      return functions;\n    }\n\n    for (const func of this.results.functions) {\n      functions[func.name] = {\n        Name: func.name,\n        Body: func.body,\n        DocString: func.displayName,\n        Folder: func.category,\n        FunctionKind: 'Unknown',\n        InputParameters: [],\n        OutputColumns: [],\n      };\n    }\n\n    return functions;\n  }\n\n  static findOrCreateBucket(data: TimeSeries[], target: any): TimeSeries {\n    let dataTarget: any = _.find(data, ['target', target]);\n    if (!dataTarget) {\n      dataTarget = { target: target, datapoints: [], refId: '', query: '' };\n      data.push(dataTarget);\n    }\n\n    return dataTarget;\n  }\n\n  static dateTimeToEpoch(dateTimeValue: any) {\n    return dateTime(dateTimeValue).valueOf();\n  }\n}\n","import _ from 'lodash';\nimport LogAnalyticsQuerystringBuilder from '../log_analytics/querystring_builder';\nimport ResponseParser from './response_parser';\nimport { AzureMonitorQuery, AzureDataSourceJsonData, AzureLogsVariable, AzureQueryType } from '../types';\nimport {\n  DataQueryRequest,\n  DataQueryResponse,\n  ScopedVars,\n  DataSourceInstanceSettings,\n  MetricFindValue,\n} from '@grafana/data';\nimport { getBackendSrv, getTemplateSrv, DataSourceWithBackend } from '@grafana/runtime';\nimport { Observable, from } from 'rxjs';\nimport { mergeMap } from 'rxjs/operators';\n\nexport default class AzureLogAnalyticsDatasource extends DataSourceWithBackend<\n  AzureMonitorQuery,\n  AzureDataSourceJsonData\n> {\n  url: string;\n  baseUrl: string;\n  applicationId: string;\n  azureMonitorUrl: string;\n  defaultOrFirstWorkspace: string;\n  subscriptionId: string;\n  cache: Map<string, any>;\n\n  constructor(private instanceSettings: DataSourceInstanceSettings<AzureDataSourceJsonData>) {\n    super(instanceSettings);\n    this.cache = new Map();\n\n    switch (this.instanceSettings.jsonData.cloudName) {\n      case 'govazuremonitor': // Azure US Government\n        this.baseUrl = '/govloganalyticsazure';\n        break;\n      case 'germanyazuremonitor': // Azure Germany\n        break;\n      case 'chinaazuremonitor': // Azure China\n        this.baseUrl = '/chinaloganalyticsazure';\n        break;\n      default:\n        // Azure Global\n        this.baseUrl = '/loganalyticsazure';\n    }\n\n    this.url = instanceSettings.url || '';\n    this.defaultOrFirstWorkspace = this.instanceSettings.jsonData.logAnalyticsDefaultWorkspace || '';\n\n    this.setWorkspaceUrl();\n  }\n\n  isConfigured(): boolean {\n    return (\n      (!!this.instanceSettings.jsonData.logAnalyticsSubscriptionId &&\n        this.instanceSettings.jsonData.logAnalyticsSubscriptionId.length > 0) ||\n      !!this.instanceSettings.jsonData.azureLogAnalyticsSameAs\n    );\n  }\n\n  setWorkspaceUrl() {\n    if (!!this.instanceSettings.jsonData.subscriptionId || !!this.instanceSettings.jsonData.azureLogAnalyticsSameAs) {\n      this.subscriptionId = this.instanceSettings.jsonData.subscriptionId;\n      const azureCloud = this.instanceSettings.jsonData.cloudName || 'azuremonitor';\n      this.azureMonitorUrl = `/${azureCloud}/subscriptions`;\n    } else {\n      this.subscriptionId = this.instanceSettings.jsonData.logAnalyticsSubscriptionId || '';\n\n      switch (this.instanceSettings.jsonData.cloudName) {\n        case 'govazuremonitor': // Azure US Government\n          this.azureMonitorUrl = `/govworkspacesloganalytics/subscriptions`;\n          break;\n        case 'germanyazuremonitor': // Azure Germany\n          break;\n        case 'chinaazuremonitor': // Azure China\n          this.azureMonitorUrl = `/chinaworkspacesloganalytics/subscriptions`;\n          break;\n        default:\n          // Azure Global\n          this.azureMonitorUrl = `/workspacesloganalytics/subscriptions`;\n      }\n    }\n  }\n\n  async getWorkspaces(subscription: string): Promise<AzureLogsVariable[]> {\n    const response = await this.getWorkspaceList(subscription);\n\n    return (\n      _.map(response.data.value, (val: any) => {\n        return { text: val.name, value: val.properties.customerId };\n      }) || []\n    );\n  }\n\n  getWorkspaceList(subscription: string): Promise<any> {\n    const subscriptionId = getTemplateSrv().replace(subscription || this.subscriptionId);\n\n    const workspaceListUrl =\n      this.azureMonitorUrl +\n      `/${subscriptionId}/providers/Microsoft.OperationalInsights/workspaces?api-version=2017-04-26-preview`;\n    return this.doRequest(workspaceListUrl, true);\n  }\n\n  getSchema(workspace: string) {\n    if (!workspace) {\n      return Promise.resolve();\n    }\n    const url = `${this.baseUrl}/${getTemplateSrv().replace(workspace, {})}/metadata`;\n\n    return this.doRequest(url).then((response: any) => {\n      return new ResponseParser(response.data).parseSchemaResult();\n    });\n  }\n\n  applyTemplateVariables(target: AzureMonitorQuery, scopedVars: ScopedVars): Record<string, any> {\n    const item = target.azureLogAnalytics;\n\n    const templateSrv = getTemplateSrv();\n    let workspace = templateSrv.replace(item.workspace, scopedVars);\n\n    if (!workspace && this.defaultOrFirstWorkspace) {\n      workspace = this.defaultOrFirstWorkspace;\n    }\n\n    const subscriptionId = templateSrv.replace(target.subscription || this.subscriptionId, scopedVars);\n    const query = templateSrv.replace(item.query, scopedVars, this.interpolateVariable);\n\n    return {\n      refId: target.refId,\n      format: target.format,\n      queryType: AzureQueryType.LogAnalytics,\n      subscriptionId: subscriptionId,\n      azureLogAnalytics: {\n        resultFormat: item.resultFormat,\n        query: query,\n        workspace: workspace,\n      },\n    };\n  }\n\n  /**\n   * Augment the results with links back to the azure console\n   */\n  query(request: DataQueryRequest<AzureMonitorQuery>): Observable<DataQueryResponse> {\n    return super.query(request).pipe(\n      mergeMap((res: DataQueryResponse) => {\n        return from(this.processResponse(res));\n      })\n    );\n  }\n\n  async processResponse(res: DataQueryResponse): Promise<DataQueryResponse> {\n    if (res.data) {\n      for (const df of res.data) {\n        const encodedQuery = df.meta?.custom?.encodedQuery;\n        if (encodedQuery && encodedQuery.length > 0) {\n          const url = await this.buildDeepLink(df.meta.custom);\n          if (url?.length) {\n            for (const field of df.fields) {\n              field.config.links = [\n                {\n                  url: url,\n                  title: 'View in Azure Portal',\n                  targetBlank: true,\n                },\n              ];\n            }\n          }\n        }\n      }\n    }\n    return res;\n  }\n\n  private async buildDeepLink(customMeta: Record<string, any>) {\n    const base64Enc = encodeURIComponent(customMeta.encodedQuery);\n    const workspaceId = customMeta.workspace;\n    const subscription = customMeta.subscription;\n\n    const details = await this.getWorkspaceDetails(workspaceId);\n    if (!details.workspace || !details.resourceGroup) {\n      return '';\n    }\n\n    const url =\n      `https://portal.azure.com/#blade/Microsoft_OperationsManagementSuite_Workspace/` +\n      `AnalyticsBlade/initiator/AnalyticsShareLinkToQuery/isQueryEditorVisible/true/scope/` +\n      `%7B%22resources%22%3A%5B%7B%22resourceId%22%3A%22%2Fsubscriptions%2F${subscription}` +\n      `%2Fresourcegroups%2F${details.resourceGroup}%2Fproviders%2Fmicrosoft.operationalinsights%2Fworkspaces%2F${details.workspace}` +\n      `%22%7D%5D%7D/query/${base64Enc}/isQueryBase64Compressed/true/timespanInIsoFormat/P1D`;\n    return url;\n  }\n\n  async getWorkspaceDetails(workspaceId: string) {\n    const response = await this.getWorkspaceList(this.subscriptionId);\n\n    const details = response.data.value.find((o: any) => {\n      return o.properties.customerId === workspaceId;\n    });\n\n    if (!details) {\n      return {};\n    }\n\n    const regex = /.*resourcegroups\\/(.*)\\/providers.*/;\n    const results = regex.exec(details.id);\n    if (!results || results.length < 2) {\n      return {};\n    }\n\n    return {\n      workspace: details.name,\n      resourceGroup: results[1],\n    };\n  }\n\n  /**\n   * This is named differently than DataSourceApi.metricFindQuery\n   * because it's not exposed to Grafana like the main AzureMonitorDataSource.\n   * And some of the azure internal data sources return null in this function, which the\n   * external interface does not support\n   */\n  metricFindQueryInternal(query: string): Promise<MetricFindValue[]> {\n    const workspacesQuery = query.match(/^workspaces\\(\\)/i);\n    if (workspacesQuery) {\n      return this.getWorkspaces(this.subscriptionId);\n    }\n\n    const workspacesQueryWithSub = query.match(/^workspaces\\([\"']?([^\\)]+?)[\"']?\\)/i);\n    if (workspacesQueryWithSub) {\n      return this.getWorkspaces((workspacesQueryWithSub[1] || '').trim());\n    }\n\n    return this.getDefaultOrFirstWorkspace().then((workspace: any) => {\n      const queries: any[] = this.buildQuery(query, null, workspace);\n\n      const promises = this.doQueries(queries);\n\n      return Promise.all(promises)\n        .then(results => {\n          return new ResponseParser(results).parseToVariables();\n        })\n        .catch(err => {\n          if (\n            err.error &&\n            err.error.data &&\n            err.error.data.error &&\n            err.error.data.error.innererror &&\n            err.error.data.error.innererror.innererror\n          ) {\n            throw { message: err.error.data.error.innererror.innererror.message };\n          } else if (err.error && err.error.data && err.error.data.error) {\n            throw { message: err.error.data.error.message };\n          }\n        });\n    }) as Promise<MetricFindValue[]>;\n  }\n\n  private buildQuery(query: string, options: any, workspace: any) {\n    const querystringBuilder = new LogAnalyticsQuerystringBuilder(\n      getTemplateSrv().replace(query, {}, this.interpolateVariable),\n      options,\n      'TimeGenerated'\n    );\n    const querystring = querystringBuilder.generate().uriString;\n    const url = `${this.baseUrl}/${workspace}/query?${querystring}`;\n    const queries: any[] = [];\n    queries.push({\n      datasourceId: this.id,\n      url: url,\n      resultFormat: 'table',\n    });\n    return queries;\n  }\n\n  interpolateVariable(value: string, variable: { multi: any; includeAll: any }) {\n    if (typeof value === 'string') {\n      if (variable.multi || variable.includeAll) {\n        return \"'\" + value + \"'\";\n      } else {\n        return value;\n      }\n    }\n\n    if (typeof value === 'number') {\n      return value;\n    }\n\n    const quotedValues = _.map(value, val => {\n      if (typeof value === 'number') {\n        return value;\n      }\n\n      return \"'\" + val + \"'\";\n    });\n    return quotedValues.join(',');\n  }\n\n  getDefaultOrFirstWorkspace() {\n    if (this.defaultOrFirstWorkspace) {\n      return Promise.resolve(this.defaultOrFirstWorkspace);\n    }\n\n    return this.getWorkspaces(this.subscriptionId).then((workspaces: any[]) => {\n      this.defaultOrFirstWorkspace = workspaces[0].value;\n      return this.defaultOrFirstWorkspace;\n    });\n  }\n\n  annotationQuery(options: any) {\n    if (!options.annotation.rawQuery) {\n      return Promise.reject({\n        message: 'Query missing in annotation definition',\n      });\n    }\n\n    const queries: any[] = this.buildQuery(options.annotation.rawQuery, options, options.annotation.workspace);\n\n    const promises = this.doQueries(queries);\n\n    return Promise.all(promises).then(results => {\n      const annotations = new ResponseParser(results).transformToAnnotations(options);\n      return annotations;\n    });\n  }\n\n  doQueries(queries: any[]) {\n    return _.map(queries, query => {\n      return this.doRequest(query.url)\n        .then((result: any) => {\n          return {\n            result: result,\n            query: query,\n          };\n        })\n        .catch((err: any) => {\n          throw {\n            error: err,\n            query: query,\n          };\n        });\n    });\n  }\n\n  async doRequest(url: string, useCache = false, maxRetries = 1): Promise<any> {\n    try {\n      if (useCache && this.cache.has(url)) {\n        return this.cache.get(url);\n      }\n\n      const res = await getBackendSrv().datasourceRequest({\n        url: this.url + url,\n        method: 'GET',\n      });\n\n      if (useCache) {\n        this.cache.set(url, res);\n      }\n\n      return res;\n    } catch (error) {\n      if (maxRetries > 0) {\n        return this.doRequest(url, useCache, maxRetries - 1);\n      }\n\n      throw error;\n    }\n  }\n\n  testDatasource(): Promise<any> {\n    const validationError = this.isValidConfig();\n    if (validationError) {\n      return Promise.resolve(validationError);\n    }\n\n    return this.getDefaultOrFirstWorkspace()\n      .then((ws: any) => {\n        const url = `${this.baseUrl}/${ws}/metadata`;\n\n        return this.doRequest(url);\n      })\n      .then((response: any) => {\n        if (response.status === 200) {\n          return {\n            status: 'success',\n            message: 'Successfully queried the Azure Log Analytics service.',\n            title: 'Success',\n          };\n        }\n\n        return {\n          status: 'error',\n          message: 'Returned http status code ' + response.status,\n        };\n      })\n      .catch((error: any) => {\n        let message = 'Azure Log Analytics: ';\n        if (error.config && error.config.url && error.config.url.indexOf('workspacesloganalytics') > -1) {\n          message = 'Azure Log Analytics requires access to Azure Monitor but had the following error: ';\n        }\n\n        message = this.getErrorMessage(message, error);\n\n        return {\n          status: 'error',\n          message: message,\n        };\n      });\n  }\n\n  private getErrorMessage(message: string, error: any) {\n    message += error.statusText ? error.statusText + ': ' : '';\n    if (error.data && error.data.error && error.data.error.code) {\n      message += error.data.error.code + '. ' + error.data.error.message;\n    } else if (error.data && error.data.error) {\n      message += error.data.error;\n    } else if (error.data) {\n      message += error.data;\n    } else {\n      message += 'Cannot connect to Azure Log Analytics REST API.';\n    }\n    return message;\n  }\n\n  isValidConfig() {\n    if (this.instanceSettings.jsonData.azureLogAnalyticsSameAs) {\n      return undefined;\n    }\n\n    if (!this.isValidConfigField(this.instanceSettings.jsonData.logAnalyticsSubscriptionId)) {\n      return {\n        status: 'error',\n        message: 'The Subscription Id field is required.',\n      };\n    }\n\n    if (!this.isValidConfigField(this.instanceSettings.jsonData.logAnalyticsTenantId)) {\n      return {\n        status: 'error',\n        message: 'The Tenant Id field is required.',\n      };\n    }\n\n    if (!this.isValidConfigField(this.instanceSettings.jsonData.logAnalyticsClientId)) {\n      return {\n        status: 'error',\n        message: 'The Client Id field is required.',\n      };\n    }\n\n    return undefined;\n  }\n\n  isValidConfigField(field: string | undefined) {\n    return field && field.length > 0;\n  }\n}\n","import { ScopedVars } from '@grafana/data';\nimport { DataSourceInstanceSettings } from '@grafana/data';\nimport { getTemplateSrv } from '@grafana/runtime';\n\nimport { AzureDataSourceJsonData, AzureMonitorQuery, AzureQueryType } from '../types';\nimport AppInsightsDatasource from '../app_insights/app_insights_datasource';\n\nexport default class InsightsAnalyticsDatasource extends AppInsightsDatasource {\n  constructor(instanceSettings: DataSourceInstanceSettings<AzureDataSourceJsonData>) {\n    super(instanceSettings);\n  }\n\n  applyTemplateVariables(target: AzureMonitorQuery, scopedVars: ScopedVars): Record<string, any> {\n    const item = target.insightsAnalytics;\n\n    // Old name migrations\n    const old: any = item;\n    if (old.rawQueryString && !item.query) {\n      item.query = old.rawQueryString;\n    }\n\n    return {\n      refId: target.refId,\n      queryType: AzureQueryType.InsightsAnalytics,\n      insightsAnalytics: {\n        query: getTemplateSrv().replace(item.query, scopedVars),\n        resultFormat: item.resultFormat,\n      },\n    };\n  }\n}\n","import _ from 'lodash';\nimport AzureMonitorDatasource from './azure_monitor/azure_monitor_datasource';\nimport AppInsightsDatasource from './app_insights/app_insights_datasource';\nimport AzureLogAnalyticsDatasource from './azure_log_analytics/azure_log_analytics_datasource';\nimport { AzureDataSourceJsonData, AzureMonitorQuery, AzureQueryType, InsightsAnalyticsQuery } from './types';\nimport {\n  DataFrame,\n  DataQueryRequest,\n  DataQueryResponse,\n  DataSourceApi,\n  DataSourceInstanceSettings,\n  LoadingState,\n  ScopedVars,\n} from '@grafana/data';\nimport { forkJoin, Observable, of } from 'rxjs';\nimport { DataSourceWithBackend } from '@grafana/runtime';\nimport InsightsAnalyticsDatasource from './insights_analytics/insights_analytics_datasource';\nimport { migrateMetricsDimensionFilters } from './query_ctrl';\nimport { map } from 'rxjs/operators';\n\nexport default class Datasource extends DataSourceApi<AzureMonitorQuery, AzureDataSourceJsonData> {\n  azureMonitorDatasource: AzureMonitorDatasource;\n  appInsightsDatasource: AppInsightsDatasource;\n  azureLogAnalyticsDatasource: AzureLogAnalyticsDatasource;\n  insightsAnalyticsDatasource: InsightsAnalyticsDatasource;\n\n  pseudoDatasource: Record<AzureQueryType, DataSourceWithBackend>;\n  optionsKey: Record<AzureQueryType, string>;\n\n  constructor(instanceSettings: DataSourceInstanceSettings<AzureDataSourceJsonData>) {\n    super(instanceSettings);\n    this.azureMonitorDatasource = new AzureMonitorDatasource(instanceSettings);\n    this.appInsightsDatasource = new AppInsightsDatasource(instanceSettings);\n    this.azureLogAnalyticsDatasource = new AzureLogAnalyticsDatasource(instanceSettings);\n    this.insightsAnalyticsDatasource = new InsightsAnalyticsDatasource(instanceSettings);\n\n    const pseudoDatasource: any = {};\n    pseudoDatasource[AzureQueryType.ApplicationInsights] = this.appInsightsDatasource;\n    pseudoDatasource[AzureQueryType.AzureMonitor] = this.azureMonitorDatasource;\n    pseudoDatasource[AzureQueryType.InsightsAnalytics] = this.insightsAnalyticsDatasource;\n    pseudoDatasource[AzureQueryType.LogAnalytics] = this.azureLogAnalyticsDatasource;\n    this.pseudoDatasource = pseudoDatasource;\n\n    const optionsKey: any = {};\n    optionsKey[AzureQueryType.ApplicationInsights] = 'appInsights';\n    optionsKey[AzureQueryType.AzureMonitor] = 'azureMonitor';\n    optionsKey[AzureQueryType.InsightsAnalytics] = 'insightsAnalytics';\n    optionsKey[AzureQueryType.LogAnalytics] = 'azureLogAnalytics';\n    this.optionsKey = optionsKey;\n  }\n\n  query(options: DataQueryRequest<AzureMonitorQuery>): Observable<DataQueryResponse> {\n    const byType: Record<AzureQueryType, DataQueryRequest<AzureMonitorQuery>> = ({} as unknown) as Record<\n      AzureQueryType,\n      DataQueryRequest<AzureMonitorQuery>\n    >;\n\n    for (const target of options.targets) {\n      // Migrate old query structure\n      if (target.queryType === AzureQueryType.ApplicationInsights) {\n        if ((target.appInsights as any).rawQuery) {\n          target.queryType = AzureQueryType.InsightsAnalytics;\n          target.insightsAnalytics = (target.appInsights as unknown) as InsightsAnalyticsQuery;\n          delete target.appInsights;\n        }\n      }\n      if (!target.queryType) {\n        target.queryType = AzureQueryType.AzureMonitor;\n      }\n\n      if (target.queryType === AzureQueryType.AzureMonitor) {\n        migrateMetricsDimensionFilters(target.azureMonitor);\n      }\n\n      // Check that we have options\n      const opts = (target as any)[this.optionsKey[target.queryType]];\n\n      // Skip hidden queries or ones without properties\n      if (target.hide || !opts) {\n        continue;\n      }\n\n      // Initialize the list of queries\n      let q = byType[target.queryType];\n      if (!q) {\n        q = _.cloneDeep(options);\n        q.requestId = `${q.requestId}-${target.refId}`;\n        q.targets = [];\n        byType[target.queryType] = q;\n      }\n      q.targets.push(target);\n    }\n\n    // Distinct types are managed by distinct requests\n    const obs = Object.keys(byType).map((type: AzureQueryType) => {\n      const req = byType[type];\n      return this.pseudoDatasource[type].query(req);\n    });\n    // Single query can skip merge\n    if (obs.length === 1) {\n      return obs[0];\n    }\n\n    if (obs.length > 1) {\n      return forkJoin(obs).pipe(\n        map((results: DataQueryResponse[]) => {\n          const data: DataFrame[] = [];\n          for (const result of results) {\n            for (const frame of result.data) {\n              data.push(frame);\n            }\n          }\n\n          return { state: LoadingState.Done, data };\n        })\n      );\n    }\n\n    return of({ state: LoadingState.Done, data: [] });\n  }\n\n  async annotationQuery(options: any) {\n    return this.azureLogAnalyticsDatasource.annotationQuery(options);\n  }\n\n  async metricFindQuery(query: string) {\n    if (!query) {\n      return Promise.resolve([]);\n    }\n\n    const aiResult = this.appInsightsDatasource.metricFindQueryInternal(query);\n    if (aiResult) {\n      return aiResult;\n    }\n\n    const amResult = this.azureMonitorDatasource.metricFindQueryInternal(query);\n    if (amResult) {\n      return amResult;\n    }\n\n    const alaResult = this.azureLogAnalyticsDatasource.metricFindQueryInternal(query);\n    if (alaResult) {\n      return alaResult;\n    }\n\n    return Promise.resolve([]);\n  }\n\n  async testDatasource() {\n    const promises: any[] = [];\n\n    if (this.azureMonitorDatasource.isConfigured()) {\n      promises.push(this.azureMonitorDatasource.testDatasource());\n    }\n\n    if (this.appInsightsDatasource.isConfigured()) {\n      promises.push(this.appInsightsDatasource.testDatasource());\n    }\n\n    if (this.azureLogAnalyticsDatasource.isConfigured()) {\n      promises.push(this.azureLogAnalyticsDatasource.testDatasource());\n    }\n\n    if (promises.length === 0) {\n      return {\n        status: 'error',\n        message: `Nothing configured. At least one of the API's must be configured.`,\n        title: 'Error',\n      };\n    }\n\n    return Promise.all(promises).then(results => {\n      let status = 'success';\n      let message = '';\n\n      for (let i = 0; i < results.length; i++) {\n        if (results[i].status !== 'success') {\n          status = results[i].status;\n        }\n        message += `${i + 1}. ${results[i].message} `;\n      }\n\n      return {\n        status: status,\n        message: message,\n        title: _.upperFirst(status),\n      };\n    });\n  }\n\n  /* Azure Monitor REST API methods */\n  getResourceGroups(subscriptionId: string) {\n    return this.azureMonitorDatasource.getResourceGroups(subscriptionId);\n  }\n\n  getMetricDefinitions(subscriptionId: string, resourceGroup: string) {\n    return this.azureMonitorDatasource.getMetricDefinitions(subscriptionId, resourceGroup);\n  }\n\n  getResourceNames(subscriptionId: string, resourceGroup: string, metricDefinition: string) {\n    return this.azureMonitorDatasource.getResourceNames(subscriptionId, resourceGroup, metricDefinition);\n  }\n\n  getMetricNames(\n    subscriptionId: string,\n    resourceGroup: string,\n    metricDefinition: string,\n    resourceName: string,\n    metricNamespace: string\n  ) {\n    return this.azureMonitorDatasource.getMetricNames(\n      subscriptionId,\n      resourceGroup,\n      metricDefinition,\n      resourceName,\n      metricNamespace\n    );\n  }\n\n  getMetricNamespaces(subscriptionId: string, resourceGroup: string, metricDefinition: string, resourceName: string) {\n    return this.azureMonitorDatasource.getMetricNamespaces(\n      subscriptionId,\n      resourceGroup,\n      metricDefinition,\n      resourceName\n    );\n  }\n\n  getMetricMetadata(\n    subscriptionId: string,\n    resourceGroup: string,\n    metricDefinition: string,\n    resourceName: string,\n    metricNamespace: string,\n    metricName: string\n  ) {\n    return this.azureMonitorDatasource.getMetricMetadata(\n      subscriptionId,\n      resourceGroup,\n      metricDefinition,\n      resourceName,\n      metricNamespace,\n      metricName\n    );\n  }\n\n  /* Application Insights API method */\n  getAppInsightsMetricNames() {\n    return this.appInsightsDatasource.getMetricNames();\n  }\n\n  getAppInsightsMetricMetadata(metricName: string) {\n    return this.appInsightsDatasource.getMetricMetadata(metricName);\n  }\n\n  getAppInsightsColumns(refId: string | number) {\n    return this.appInsightsDatasource.logAnalyticsColumns[refId];\n  }\n\n  /*Azure Log Analytics */\n  getAzureLogAnalyticsWorkspaces(subscriptionId: string) {\n    return this.azureLogAnalyticsDatasource.getWorkspaces(subscriptionId);\n  }\n\n  getSubscriptions() {\n    return this.azureMonitorDatasource.getSubscriptions();\n  }\n\n  interpolateVariablesInQueries(queries: AzureMonitorQuery[], scopedVars: ScopedVars): AzureMonitorQuery[] {\n    return queries.map(\n      query => this.pseudoDatasource[query.queryType].applyTemplateVariables(query, scopedVars) as AzureMonitorQuery\n    );\n  }\n}\n","import React, { ChangeEvent, PureComponent } from 'react';\nimport { SelectableValue } from '@grafana/data';\nimport { InlineFormLabel, LegacyForms, Button } from '@grafana/ui';\nconst { Select, Input } = LegacyForms;\n\nexport interface Props {\n  selectedAzureCloud?: string;\n  selectedSubscription?: string;\n  azureCloudOptions?: SelectableValue[];\n  tenantId?: string;\n  clientId?: string;\n  clientSecret?: string;\n  clientSecretConfigured?: boolean;\n  subscriptionOptions?: SelectableValue[];\n  onAzureCloudChange?: (value: SelectableValue<string>) => void;\n  onSubscriptionSelectChange?: (value: SelectableValue<string>) => void;\n  onTenantIdChange: (event: ChangeEvent<HTMLInputElement>) => void;\n  onClientIdChange: (event: ChangeEvent<HTMLInputElement>) => void;\n  onClientSecretChange: (event: ChangeEvent<HTMLInputElement>) => void;\n  onResetClientSecret: () => void;\n  onLoadSubscriptions?: () => void;\n}\n\nexport class AzureCredentialsForm extends PureComponent<Props> {\n  render() {\n    const {\n      selectedAzureCloud,\n      selectedSubscription,\n      tenantId,\n      clientId,\n      clientSecret,\n      clientSecretConfigured,\n      azureCloudOptions,\n      subscriptionOptions,\n      onAzureCloudChange,\n      onSubscriptionSelectChange,\n      onTenantIdChange,\n      onClientIdChange,\n      onClientSecretChange,\n      onResetClientSecret,\n      onLoadSubscriptions,\n    } = this.props;\n    const hasRequiredFields = tenantId && clientId && (clientSecret || clientSecretConfigured);\n    const hasSubscriptions = onLoadSubscriptions && subscriptionOptions;\n\n    return (\n      <>\n        <div className=\"gf-form-group\">\n          {azureCloudOptions && (\n            <div className=\"gf-form-inline\">\n              <div className=\"gf-form\">\n                <InlineFormLabel className=\"width-12\" tooltip=\"Choose an Azure Cloud.\">\n                  Azure Cloud\n                </InlineFormLabel>\n                <Select\n                  className=\"width-15\"\n                  value={azureCloudOptions.find(azureCloud => azureCloud.value === selectedAzureCloud)}\n                  options={azureCloudOptions}\n                  defaultValue={selectedAzureCloud}\n                  onChange={onAzureCloudChange}\n                />\n              </div>\n            </div>\n          )}\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form\">\n              <InlineFormLabel className=\"width-12\">Directory (tenant) ID</InlineFormLabel>\n              <div className=\"width-15\">\n                <Input\n                  className=\"width-30\"\n                  placeholder=\"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\"\n                  value={tenantId || ''}\n                  onChange={onTenantIdChange}\n                />\n              </div>\n            </div>\n          </div>\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form\">\n              <InlineFormLabel className=\"width-12\">Application (client) ID</InlineFormLabel>\n              <div className=\"width-15\">\n                <Input\n                  className=\"width-30\"\n                  placeholder=\"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\"\n                  value={clientId || ''}\n                  onChange={onClientIdChange}\n                />\n              </div>\n            </div>\n          </div>\n          {clientSecretConfigured ? (\n            <div className=\"gf-form-inline\">\n              <div className=\"gf-form\">\n                <InlineFormLabel className=\"width-12\">Client Secret</InlineFormLabel>\n                <Input className=\"width-25\" placeholder=\"configured\" disabled={true} />\n              </div>\n              <div className=\"gf-form\">\n                <div className=\"max-width-30 gf-form-inline\">\n                  <Button variant=\"secondary\" type=\"button\" onClick={onResetClientSecret}>\n                    reset\n                  </Button>\n                </div>\n              </div>\n            </div>\n          ) : (\n            <div className=\"gf-form-inline\">\n              <div className=\"gf-form\">\n                <InlineFormLabel className=\"width-12\">Client Secret</InlineFormLabel>\n                <div className=\"width-15\">\n                  <Input\n                    className=\"width-30\"\n                    placeholder=\"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\"\n                    value={clientSecret || ''}\n                    onChange={onClientSecretChange}\n                  />\n                </div>\n              </div>\n            </div>\n          )}\n          {hasSubscriptions && (\n            <>\n              <div className=\"gf-form-inline\">\n                <div className=\"gf-form\">\n                  <InlineFormLabel className=\"width-12\">Default Subscription</InlineFormLabel>\n                  <div className=\"width-25\">\n                    <Select\n                      value={subscriptionOptions!.find(subscription => subscription.value === selectedSubscription)}\n                      options={subscriptionOptions}\n                      defaultValue={selectedSubscription}\n                      onChange={onSubscriptionSelectChange}\n                    />\n                  </div>\n                </div>\n              </div>\n              <div className=\"gf-form-inline\">\n                <div className=\"gf-form\">\n                  <div className=\"max-width-30 gf-form-inline\">\n                    <Button\n                      variant=\"secondary\"\n                      size=\"sm\"\n                      type=\"button\"\n                      onClick={onLoadSubscriptions}\n                      disabled={!hasRequiredFields}\n                    >\n                      Load Subscriptions\n                    </Button>\n                  </div>\n                </div>\n              </div>\n            </>\n          )}\n        </div>\n      </>\n    );\n  }\n}\n\nexport default AzureCredentialsForm;\n","import React, { PureComponent, ChangeEvent } from 'react';\nimport { SelectableValue } from '@grafana/data';\nimport { AzureCredentialsForm } from './AzureCredentialsForm';\nimport { AzureDataSourceSettings } from '../types';\n\nconst azureClouds = [\n  { value: 'azuremonitor', label: 'Azure' },\n  { value: 'govazuremonitor', label: 'Azure US Government' },\n  { value: 'germanyazuremonitor', label: 'Azure Germany' },\n  { value: 'chinaazuremonitor', label: 'Azure China' },\n] as SelectableValue[];\n\nexport interface Props {\n  options: AzureDataSourceSettings;\n  subscriptions: SelectableValue[];\n  makeSameAs: (updatedClientSecret?: string) => void;\n  onUpdateJsonDataOption: (key: string, val: any) => void;\n  onUpdateSecureJsonDataOption: (key: string, val: any) => void;\n  onResetOptionKey: (key: string) => void;\n  onLoadSubscriptions: () => void;\n}\n\nexport class MonitorConfig extends PureComponent<Props> {\n  onAzureCloudSelect = (cloudName: SelectableValue<string>) => {\n    this.props.onUpdateJsonDataOption('cloudName', cloudName.value);\n  };\n\n  onTenantIdChange = (event: ChangeEvent<HTMLInputElement>) => {\n    this.props.onUpdateJsonDataOption('tenantId', event.target.value);\n  };\n\n  onClientIdChange = (event: ChangeEvent<HTMLInputElement>) => {\n    this.props.onUpdateJsonDataOption('clientId', event.target.value);\n  };\n\n  onClientSecretChange = (event: ChangeEvent<HTMLInputElement>) => {\n    const { options, makeSameAs } = this.props;\n\n    if (options.jsonData.azureLogAnalyticsSameAs && event.target.value) {\n      makeSameAs(event.target.value);\n    } else {\n      this.props.onUpdateSecureJsonDataOption('clientSecret', event.target.value);\n    }\n  };\n\n  onResetClientSecret = () => {\n    this.props.onResetOptionKey('clientSecret');\n  };\n\n  onSubscriptionSelect = (subscription: SelectableValue<string>) => {\n    this.props.onUpdateJsonDataOption('subscriptionId', subscription.value);\n  };\n\n  render() {\n    const { options, subscriptions } = this.props;\n    return (\n      <>\n        <h3 className=\"page-heading\">Azure Monitor Details</h3>\n        <AzureCredentialsForm\n          selectedAzureCloud={options.jsonData.cloudName || 'azuremonitor'}\n          azureCloudOptions={azureClouds}\n          subscriptionOptions={subscriptions}\n          selectedSubscription={options.jsonData.subscriptionId}\n          tenantId={options.jsonData.tenantId}\n          clientId={options.jsonData.clientId}\n          clientSecret={options.secureJsonData?.clientSecret}\n          clientSecretConfigured={options.secureJsonFields.clientSecret}\n          onAzureCloudChange={this.onAzureCloudSelect}\n          onSubscriptionSelectChange={this.onSubscriptionSelect}\n          onTenantIdChange={this.onTenantIdChange}\n          onClientIdChange={this.onClientIdChange}\n          onClientSecretChange={this.onClientSecretChange}\n          onResetClientSecret={this.onResetClientSecret}\n          onLoadSubscriptions={this.props.onLoadSubscriptions}\n        />\n      </>\n    );\n  }\n}\n\nexport default MonitorConfig;\n","import React, { PureComponent, ChangeEvent } from 'react';\nimport { SelectableValue } from '@grafana/data';\nimport { AzureCredentialsForm } from './AzureCredentialsForm';\nimport { InlineFormLabel, LegacyForms, Button } from '@grafana/ui';\nconst { Select, Switch } = LegacyForms;\nimport { AzureDataSourceSettings } from '../types';\n\nexport interface State {\n  sameAsSwitched: boolean;\n}\n\nexport interface Props {\n  options: AzureDataSourceSettings;\n  subscriptions: SelectableValue[];\n  workspaces: SelectableValue[];\n  makeSameAs: () => void;\n  onUpdateDatasourceOptions: (options: AzureDataSourceSettings) => void;\n  onUpdateJsonDataOption: (key: string, val: any) => void;\n  onUpdateSecureJsonDataOption: (key: string, val: any) => void;\n  onResetOptionKey: (key: string) => void;\n  onLoadSubscriptions: (type?: string) => void;\n  onLoadWorkspaces: (type?: string) => void;\n}\nexport class AnalyticsConfig extends PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n\n    this.state = {\n      sameAsSwitched: false,\n    };\n  }\n\n  onLogAnalyticsTenantIdChange = (event: ChangeEvent<HTMLInputElement>) => {\n    this.props.onUpdateJsonDataOption('logAnalyticsTenantId', event.target.value);\n  };\n\n  onLogAnalyticsClientIdChange = (event: ChangeEvent<HTMLInputElement>) => {\n    this.props.onUpdateJsonDataOption('logAnalyticsClientId', event.target.value);\n  };\n\n  onLogAnalyticsClientSecretChange = (event: ChangeEvent<HTMLInputElement>) => {\n    this.props.onUpdateSecureJsonDataOption('logAnalyticsClientSecret', event.target.value);\n  };\n\n  onLogAnalyticsSubscriptionSelect = (logAnalyticsSubscription: SelectableValue<string>) => {\n    this.props.onUpdateJsonDataOption('logAnalyticsSubscriptionId', logAnalyticsSubscription.value);\n  };\n\n  onWorkspaceSelectChange = (logAnalyticsDefaultWorkspace: SelectableValue<string>) => {\n    this.props.onUpdateJsonDataOption('logAnalyticsDefaultWorkspace', logAnalyticsDefaultWorkspace.value);\n  };\n\n  onAzureLogAnalyticsSameAsChange = () => {\n    const { options, onUpdateDatasourceOptions, makeSameAs } = this.props;\n\n    if (!options.jsonData.azureLogAnalyticsSameAs && options.secureJsonData!.clientSecret) {\n      makeSameAs();\n    } else if (!options.jsonData.azureLogAnalyticsSameAs) {\n      // if currently off, clear monitor secret\n      onUpdateDatasourceOptions({\n        ...options,\n        jsonData: {\n          ...options.jsonData,\n          azureLogAnalyticsSameAs: !options.jsonData.azureLogAnalyticsSameAs,\n        },\n        secureJsonData: {\n          ...options.secureJsonData,\n          clientSecret: '',\n        },\n        secureJsonFields: {\n          clientSecret: false,\n        },\n      });\n\n      this.setState({\n        sameAsSwitched: true,\n      });\n    } else {\n      this.props.onUpdateJsonDataOption('azureLogAnalyticsSameAs', !options.jsonData.azureLogAnalyticsSameAs);\n    }\n  };\n\n  onLogAnalyticsResetClientSecret = () => {\n    this.props.onResetOptionKey('logAnalyticsClientSecret');\n  };\n\n  hasWorkspaceRequiredFields = () => {\n    const {\n      options: { jsonData, secureJsonData, secureJsonFields },\n    } = this.props;\n\n    if (jsonData.azureLogAnalyticsSameAs) {\n      return (\n        jsonData.tenantId &&\n        jsonData.clientId &&\n        jsonData.subscriptionId &&\n        (secureJsonData!.clientSecret || secureJsonFields.clientSecret)\n      );\n    }\n\n    return (\n      jsonData.logAnalyticsTenantId &&\n      jsonData.logAnalyticsTenantId.length &&\n      jsonData.logAnalyticsClientId &&\n      jsonData.logAnalyticsClientId.length &&\n      jsonData.logAnalyticsSubscriptionId &&\n      (secureJsonFields.logAnalyticsClientSecret || secureJsonData!.logAnalyticsClientSecret)\n    );\n  };\n\n  render() {\n    const {\n      options: { jsonData, secureJsonData, secureJsonFields },\n      subscriptions,\n      workspaces,\n    } = this.props;\n\n    const { sameAsSwitched } = this.state;\n\n    if (!jsonData.hasOwnProperty('azureLogAnalyticsSameAs')) {\n      jsonData.azureLogAnalyticsSameAs = true;\n    }\n\n    const addtlAttrs = {\n      ...(jsonData.azureLogAnalyticsSameAs && {\n        tooltip: 'Workspaces are pulled from default subscription selected above.',\n      }),\n    };\n\n    const showSameAsHelpMsg =\n      sameAsSwitched &&\n      jsonData.azureLogAnalyticsSameAs &&\n      secureJsonFields &&\n      !secureJsonFields.clientSecret &&\n      !secureJsonData!.clientSecret;\n\n    return (\n      <>\n        <h3 className=\"page-heading\">Azure Log Analytics API Details</h3>\n        <Switch\n          label=\"Same details as Azure Monitor API\"\n          checked={jsonData.azureLogAnalyticsSameAs ?? false}\n          onChange={this.onAzureLogAnalyticsSameAsChange}\n          {...addtlAttrs}\n        />\n        {showSameAsHelpMsg && (\n          <div className=\"grafana-info-box m-t-2\">\n            <div className=\"alert-body\">\n              <p>Re-enter your Azure Monitor Client Secret to use this setting.</p>\n            </div>\n          </div>\n        )}\n        {!jsonData.azureLogAnalyticsSameAs && (\n          <AzureCredentialsForm\n            subscriptionOptions={subscriptions}\n            selectedSubscription={jsonData.logAnalyticsSubscriptionId}\n            tenantId={jsonData.logAnalyticsTenantId}\n            clientId={jsonData.logAnalyticsClientId}\n            clientSecret={secureJsonData!.logAnalyticsClientSecret}\n            clientSecretConfigured={secureJsonFields.logAnalyticsClientSecret}\n            onSubscriptionSelectChange={this.onLogAnalyticsSubscriptionSelect}\n            onTenantIdChange={this.onLogAnalyticsTenantIdChange}\n            onClientIdChange={this.onLogAnalyticsClientIdChange}\n            onClientSecretChange={this.onLogAnalyticsClientSecretChange}\n            onResetClientSecret={this.onLogAnalyticsResetClientSecret}\n            onLoadSubscriptions={() => this.props.onLoadSubscriptions('workspacesloganalytics')}\n          />\n        )}\n        <div className=\"gf-form-group\">\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form\">\n              <InlineFormLabel\n                className=\"width-12\"\n                tooltip=\"Choose the default/preferred Workspace for Azure Log Analytics queries.\"\n              >\n                Default Workspace\n              </InlineFormLabel>\n              <div className=\"width-25\">\n                <Select\n                  value={workspaces.find(workspace => workspace.value === jsonData.logAnalyticsDefaultWorkspace)}\n                  options={workspaces}\n                  defaultValue={jsonData.logAnalyticsDefaultWorkspace}\n                  onChange={this.onWorkspaceSelectChange}\n                />\n              </div>\n            </div>\n          </div>\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form\">\n              <div className=\"max-width-30 gf-form-inline\">\n                <Button\n                  variant=\"secondary\"\n                  size=\"sm\"\n                  type=\"button\"\n                  onClick={() => this.props.onLoadWorkspaces()}\n                  disabled={!this.hasWorkspaceRequiredFields()}\n                >\n                  Load Workspaces\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </>\n    );\n  }\n}\n\nexport default AnalyticsConfig;\n","import React, { PureComponent } from 'react';\nimport { InlineFormLabel, Button, LegacyForms } from '@grafana/ui';\nconst { Input } = LegacyForms;\nimport { AzureDataSourceSettings, AzureDataSourceJsonData, AzureDataSourceSecureJsonData } from '../types';\n\nexport interface Props {\n  options: AzureDataSourceSettings;\n  onUpdateJsonDataOption: (\n    key: keyof AzureDataSourceJsonData\n  ) => (event: React.SyntheticEvent<HTMLInputElement | HTMLSelectElement>) => void;\n  onUpdateSecureJsonDataOption: (\n    key: keyof AzureDataSourceSecureJsonData\n  ) => (event: React.SyntheticEvent<HTMLInputElement | HTMLSelectElement>) => void;\n  onResetOptionKey: (key: string) => void;\n}\nexport class InsightsConfig extends PureComponent<Props> {\n  onAppInsightsResetApiKey = () => {\n    this.props.onResetOptionKey('appInsightsApiKey');\n  };\n\n  render() {\n    const { options, onUpdateJsonDataOption, onUpdateSecureJsonDataOption } = this.props;\n    return (\n      <>\n        <h3 className=\"page-heading\">Application Insights Details</h3>\n        <div className=\"gf-form-group\">\n          {options.secureJsonFields.appInsightsApiKey ? (\n            <div className=\"gf-form-inline\">\n              <div className=\"gf-form\">\n                <InlineFormLabel className=\"width-12\">API Key</InlineFormLabel>\n                <Input className=\"width-25\" placeholder=\"configured\" disabled={true} />\n              </div>\n              <div className=\"gf-form\">\n                <div className=\"max-width-30 gf-form-inline\">\n                  <Button variant=\"secondary\" type=\"button\" onClick={this.onAppInsightsResetApiKey}>\n                    reset\n                  </Button>\n                </div>\n              </div>\n            </div>\n          ) : (\n            <div className=\"gf-form-inline\">\n              <div className=\"gf-form\">\n                <InlineFormLabel className=\"width-12\">API Key</InlineFormLabel>\n                <div className=\"width-15\">\n                  <Input\n                    className=\"width-30\"\n                    placeholder=\"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\"\n                    value={options.secureJsonData!.appInsightsApiKey || ''}\n                    onChange={onUpdateSecureJsonDataOption('appInsightsApiKey')}\n                  />\n                </div>\n              </div>\n            </div>\n          )}\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form\">\n              <InlineFormLabel className=\"width-12\">Application ID</InlineFormLabel>\n              <div className=\"width-15\">\n                <Input\n                  className=\"width-30\"\n                  value={options.jsonData.appInsightsAppId || ''}\n                  onChange={onUpdateJsonDataOption('appInsightsAppId')}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </>\n    );\n  }\n}\n\nexport default InsightsConfig;\n","import React, { PureComponent } from 'react';\nimport {\n  SelectableValue,\n  DataSourcePluginOptionsEditorProps,\n  updateDatasourcePluginOption,\n  updateDatasourcePluginResetOption,\n  updateDatasourcePluginJsonDataOption,\n  updateDatasourcePluginSecureJsonDataOption,\n} from '@grafana/data';\nimport { MonitorConfig } from './MonitorConfig';\nimport { AnalyticsConfig } from './AnalyticsConfig';\nimport { getBackendSrv, TemplateSrv, getTemplateSrv } from '@grafana/runtime';\nimport { InsightsConfig } from './InsightsConfig';\nimport ResponseParser from '../azure_monitor/response_parser';\nimport { AzureDataSourceJsonData, AzureDataSourceSecureJsonData, AzureDataSourceSettings } from '../types';\nimport { makePromiseCancelable, CancelablePromise } from 'app/core/utils/CancelablePromise';\n\nexport type Props = DataSourcePluginOptionsEditorProps<AzureDataSourceJsonData, AzureDataSourceSecureJsonData>;\n\nexport interface State {\n  subscriptions: SelectableValue[];\n  logAnalyticsSubscriptions: SelectableValue[];\n  logAnalyticsWorkspaces: SelectableValue[];\n  subscriptionId: string;\n  logAnalyticsSubscriptionId: string;\n}\n\nexport class ConfigEditor extends PureComponent<Props, State> {\n  initPromise: CancelablePromise<any> | null = null;\n  templateSrv: TemplateSrv = getTemplateSrv();\n\n  constructor(props: Props) {\n    super(props);\n\n    this.state = {\n      subscriptions: [],\n      logAnalyticsSubscriptions: [],\n      logAnalyticsWorkspaces: [],\n      subscriptionId: '',\n      logAnalyticsSubscriptionId: '',\n    };\n\n    if (this.props.options.id) {\n      updateDatasourcePluginOption(this.props, 'url', '/api/datasources/proxy/' + this.props.options.id);\n    }\n  }\n\n  componentDidMount() {\n    this.initPromise = makePromiseCancelable(this.init());\n    this.initPromise.promise.catch(({ isCanceled }) => {\n      if (isCanceled) {\n        console.warn('Azure Monitor ConfigEditor has unmounted, intialization was canceled');\n      }\n    });\n  }\n\n  componentWillUnmount() {\n    this.initPromise!.cancel();\n  }\n\n  init = async () => {\n    await this.getSubscriptions();\n\n    if (!this.props.options.jsonData.azureLogAnalyticsSameAs) {\n      await this.getLogAnalyticsSubscriptions();\n    }\n  };\n\n  updateJsonDataOption = (key: keyof AzureDataSourceJsonData, val: any) => {\n    updateDatasourcePluginJsonDataOption(this.props, key, val);\n  };\n\n  updateSecureJsonDataOption = (key: keyof AzureDataSourceSecureJsonData, val: any) => {\n    updateDatasourcePluginSecureJsonDataOption(this.props, key, val);\n  };\n\n  resetSecureKey = (key: keyof AzureDataSourceSecureJsonData) => {\n    updateDatasourcePluginResetOption(this.props, key);\n  };\n\n  onUpdateJsonDataOption = (key: keyof AzureDataSourceJsonData) => (\n    event: React.SyntheticEvent<HTMLInputElement | HTMLSelectElement>\n  ) => {\n    this.updateJsonDataOption(key, event.currentTarget.value);\n  };\n\n  onUpdateSecureJsonDataOption = (key: keyof AzureDataSourceSecureJsonData) => (\n    event: React.SyntheticEvent<HTMLInputElement | HTMLSelectElement>\n  ) => {\n    this.updateSecureJsonDataOption(key, event.currentTarget.value);\n  };\n\n  makeSameAs = (updatedClientSecret?: string) => {\n    const { options } = this.props;\n    const clientSecret = updatedClientSecret || options.secureJsonData!.clientSecret;\n\n    this.props.onOptionsChange({\n      ...options,\n      jsonData: {\n        ...options.jsonData,\n        azureLogAnalyticsSameAs: true,\n        logAnalyticsSubscriptionId: options.jsonData.subscriptionId,\n        logAnalyticsTenantId: options.jsonData.tenantId,\n        logAnalyticsClientId: options.jsonData.clientId,\n      },\n      secureJsonData: {\n        ...options.secureJsonData,\n        clientSecret,\n        logAnalyticsClientSecret: clientSecret,\n      },\n    });\n  };\n\n  hasNecessaryCredentials = () => {\n    if (!this.props.options.secureJsonFields.clientSecret && !this.props.options.secureJsonData!.clientSecret) {\n      return false;\n    }\n\n    if (!this.props.options.jsonData.clientId || !this.props.options.jsonData.tenantId) {\n      return false;\n    }\n\n    return true;\n  };\n\n  logAnalyticsHasNecessaryCredentials = () => {\n    if (\n      !this.props.options.secureJsonFields.logAnalyticsClientSecret &&\n      !this.props.options.secureJsonData!.logAnalyticsClientSecret\n    ) {\n      return false;\n    }\n\n    if (!this.props.options.jsonData.logAnalyticsClientId || !this.props.options.jsonData.logAnalyticsTenantId) {\n      return false;\n    }\n\n    return true;\n  };\n\n  onLoadSubscriptions = async (type?: string) => {\n    await getBackendSrv()\n      .put(`/api/datasources/${this.props.options.id}`, this.props.options)\n      .then((result: AzureDataSourceSettings) => {\n        updateDatasourcePluginOption(this.props, 'version', result.version);\n      });\n\n    if (type && type === 'workspacesloganalytics') {\n      this.getLogAnalyticsSubscriptions();\n    } else {\n      this.getSubscriptions();\n    }\n  };\n\n  loadSubscriptions = async (route?: string) => {\n    const url = `/${route || this.props.options.jsonData.cloudName}/subscriptions?api-version=2019-03-01`;\n\n    const result = await getBackendSrv().datasourceRequest({\n      url: this.props.options.url + url,\n      method: 'GET',\n    });\n\n    return ResponseParser.parseSubscriptionsForSelect(result);\n  };\n\n  loadWorkspaces = async (subscription: string) => {\n    const { azureLogAnalyticsSameAs, cloudName, logAnalyticsSubscriptionId } = this.props.options.jsonData;\n    let azureMonitorUrl = '',\n      subscriptionId = this.templateSrv.replace(subscription || this.props.options.jsonData.subscriptionId);\n\n    if (azureLogAnalyticsSameAs) {\n      const azureCloud = cloudName || 'azuremonitor';\n      azureMonitorUrl = `/${azureCloud}/subscriptions`;\n    } else {\n      subscriptionId = logAnalyticsSubscriptionId!;\n      azureMonitorUrl = `/workspacesloganalytics/subscriptions`;\n    }\n\n    const workspaceListUrl =\n      azureMonitorUrl +\n      `/${subscriptionId}/providers/Microsoft.OperationalInsights/workspaces?api-version=2017-04-26-preview`;\n\n    const result = await getBackendSrv().datasourceRequest({\n      url: this.props.options.url + workspaceListUrl,\n      method: 'GET',\n    });\n\n    return ResponseParser.parseWorkspacesForSelect(result);\n  };\n\n  getSubscriptions = async () => {\n    if (!this.hasNecessaryCredentials()) {\n      return;\n    }\n\n    const subscriptions = ((await this.loadSubscriptions()) || []) as SelectableValue[];\n\n    if (subscriptions && subscriptions.length > 0) {\n      this.setState({ subscriptions });\n\n      this.updateJsonDataOption('subscriptionId', this.props.options.jsonData.subscriptionId || subscriptions[0].value);\n    }\n\n    if (this.props.options.jsonData.subscriptionId && this.props.options.jsonData.azureLogAnalyticsSameAs) {\n      await this.getWorkspaces();\n    }\n  };\n\n  getLogAnalyticsSubscriptions = async () => {\n    if (!this.logAnalyticsHasNecessaryCredentials()) {\n      return;\n    }\n\n    const logAnalyticsSubscriptions = ((await this.loadSubscriptions('workspacesloganalytics')) ||\n      []) as SelectableValue[];\n\n    if (logAnalyticsSubscriptions && logAnalyticsSubscriptions.length > 0) {\n      this.setState({ logAnalyticsSubscriptions });\n\n      this.updateJsonDataOption(\n        'logAnalyticsSubscriptionId',\n        this.props.options.jsonData.logAnalyticsSubscriptionId || logAnalyticsSubscriptions[0].value\n      );\n    }\n\n    if (this.props.options.jsonData.logAnalyticsSubscriptionId) {\n      await this.getWorkspaces();\n    }\n  };\n\n  getWorkspaces = async () => {\n    const { subscriptionId, azureLogAnalyticsSameAs, logAnalyticsSubscriptionId } = this.props.options.jsonData;\n    const subscriptionIdToUse = azureLogAnalyticsSameAs ? subscriptionId : logAnalyticsSubscriptionId;\n\n    if (!subscriptionIdToUse) {\n      return;\n    }\n\n    const logAnalyticsWorkspaces = await this.loadWorkspaces(subscriptionIdToUse);\n\n    if (logAnalyticsWorkspaces.length > 0) {\n      this.setState({ logAnalyticsWorkspaces });\n\n      this.updateJsonDataOption(\n        'logAnalyticsDefaultWorkspace',\n        this.props.options.jsonData.logAnalyticsDefaultWorkspace || logAnalyticsWorkspaces[0].value\n      );\n    }\n  };\n\n  render() {\n    const { subscriptions, logAnalyticsSubscriptions, logAnalyticsWorkspaces } = this.state;\n    const { options } = this.props;\n\n    options.jsonData.cloudName = options.jsonData.cloudName || 'azuremonitor';\n    // This is bad, causes so many messy typing issues everwhere..\n    options.secureJsonData = (options.secureJsonData || {}) as AzureDataSourceSecureJsonData;\n\n    return (\n      <>\n        <MonitorConfig\n          options={options}\n          subscriptions={subscriptions}\n          makeSameAs={this.makeSameAs}\n          onLoadSubscriptions={this.onLoadSubscriptions}\n          onUpdateJsonDataOption={this.updateJsonDataOption}\n          onUpdateSecureJsonDataOption={this.updateSecureJsonDataOption}\n          onResetOptionKey={this.resetSecureKey}\n        />\n\n        <AnalyticsConfig\n          options={options}\n          workspaces={logAnalyticsWorkspaces}\n          subscriptions={logAnalyticsSubscriptions}\n          makeSameAs={this.makeSameAs}\n          onUpdateDatasourceOptions={this.props.onOptionsChange}\n          onUpdateJsonDataOption={this.updateJsonDataOption}\n          onUpdateSecureJsonDataOption={this.updateSecureJsonDataOption}\n          onResetOptionKey={this.resetSecureKey}\n          onLoadSubscriptions={this.onLoadSubscriptions}\n          onLoadWorkspaces={this.getWorkspaces}\n        />\n\n        <InsightsConfig\n          options={options}\n          onUpdateJsonDataOption={this.onUpdateJsonDataOption}\n          onUpdateSecureJsonDataOption={this.onUpdateSecureJsonDataOption}\n          onResetOptionKey={this.resetSecureKey}\n        />\n      </>\n    );\n  }\n}\n\nexport default ConfigEditor;\n","import { getTemplateSrv, TemplateSrv } from '@grafana/runtime';\n\nexport class AzureMonitorAnnotationsQueryCtrl {\n  static templateUrl = 'partials/annotations.editor.html';\n  datasource: any;\n  annotation: any;\n  workspaces: any[];\n  subscriptions: Array<{ text: string; value: string }>;\n\n  defaultQuery =\n    '<your table>\\n| where $__timeFilter() \\n| project TimeGenerated, Text=YourTitleColumn, Tags=\"tag1,tag2\"';\n\n  constructor(private templateSrv: TemplateSrv = getTemplateSrv()) {\n    this.annotation.queryType = this.annotation.queryType || 'Azure Log Analytics';\n    this.annotation.rawQuery = this.annotation.rawQuery || this.defaultQuery;\n    this.initDropdowns();\n  }\n\n  async initDropdowns() {\n    await this.getSubscriptions();\n    await this.getWorkspaces();\n  }\n\n  async getSubscriptions() {\n    if (!this.datasource.azureMonitorDatasource.isConfigured()) {\n      return;\n    }\n\n    return this.datasource.azureMonitorDatasource.getSubscriptions().then((subs: any[]) => {\n      this.subscriptions = subs;\n\n      if (!this.annotation.subscription && this.annotation.queryType === 'Azure Log Analytics') {\n        this.annotation.subscription = this.datasource.azureLogAnalyticsDatasource.subscriptionId;\n      }\n\n      if (!this.annotation.subscription && this.subscriptions.length > 0) {\n        this.annotation.subscription = this.subscriptions[0].value;\n      }\n    });\n  }\n\n  async getWorkspaces(bustCache?: boolean) {\n    if (!bustCache && this.workspaces && this.workspaces.length > 0) {\n      return this.workspaces;\n    }\n\n    return this.datasource\n      .getAzureLogAnalyticsWorkspaces(this.annotation.subscription)\n      .then((list: any[]) => {\n        this.workspaces = list;\n        if (list.length > 0 && !this.annotation.workspace) {\n          this.annotation.workspace = list[0].value;\n        }\n        return this.workspaces;\n      })\n      .catch(() => {});\n  }\n\n  getAzureLogAnalyticsSchema = () => {\n    return this.getWorkspaces()\n      .then(() => {\n        return this.datasource.azureLogAnalyticsDatasource.getSchema(this.annotation.workspace);\n      })\n      .catch(() => {});\n  };\n\n  onSubscriptionChange = () => {\n    this.getWorkspaces(true);\n  };\n\n  onLogAnalyticsQueryChange = (nextQuery: string) => {\n    this.annotation.rawQuery = nextQuery;\n  };\n\n  get templateVariables() {\n    return this.templateSrv.getVariables().map((t: any) => '$' + t.name);\n  }\n}\n","import { DataSourcePlugin } from '@grafana/data';\nimport { AzureMonitorQueryCtrl } from './query_ctrl';\nimport Datasource from './datasource';\nimport { ConfigEditor } from './components/ConfigEditor';\nimport { AzureMonitorAnnotationsQueryCtrl } from './annotations_query_ctrl';\nimport { AzureMonitorQuery, AzureDataSourceJsonData } from './types';\n\nexport const plugin = new DataSourcePlugin<Datasource, AzureMonitorQuery, AzureDataSourceJsonData>(Datasource)\n  .setConfigEditor(ConfigEditor)\n  .setQueryCtrl(AzureMonitorQueryCtrl)\n  .setAnnotationQueryCtrl(AzureMonitorAnnotationsQueryCtrl);\n","// https://github.com/facebook/react/issues/5465\n\nexport interface CancelablePromise<T> {\n  promise: Promise<T>;\n  cancel: () => void;\n}\n\nexport const makePromiseCancelable = <T>(promise: Promise<T>): CancelablePromise<T> => {\n  let hasCanceled_ = false;\n\n  const wrappedPromise = new Promise<T>((resolve, reject) => {\n    promise.then(val => (hasCanceled_ ? reject({ isCanceled: true }) : resolve(val)));\n    promise.catch(error => (hasCanceled_ ? reject({ isCanceled: true }) : reject(error)));\n  });\n\n  return {\n    promise: wrappedPromise,\n    cancel() {\n      hasCanceled_ = true;\n    },\n  };\n};\n"],"sourceRoot":""}