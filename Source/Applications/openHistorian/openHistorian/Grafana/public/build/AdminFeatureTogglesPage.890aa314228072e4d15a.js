"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7024],{47295:(Q,v,s)=>{s.r(v),s.d(v,{default:()=>L});var a=s(74848),u=s(32196),c=s(96540),b=s(16817),C=s(40845),A=s(14578),x=s(21780),y=s(17172);class R{constructor(){this.baseURL="/apis/featuretoggle.grafana.app/v0alpha1"}async getFeatureToggles(){const t=await(0,y.AI)().get(this.baseURL+"/current");return{restartRequired:!!t.restartRequired,allowEditing:!!t.allowEditing,toggles:t.toggles.map(l=>({name:l.name,description:l.description,enabled:l.enabled,readOnly:!l.writeable,stage:l.stage,hidden:!1}))}}updateFeatureToggles(t){const l={kind:"ResolvedToggleState",enabled:{}};return t.forEach(r=>{l.enabled[r.name]=r.enabled}),(0,y.AI)().patch(this.baseURL+"/current",l)}}const j=()=>new R;var T=s(56034),B=s(15292),F=s(55852),I=s(96374),w=s(48840);const E=(n,t)=>n.original.name.localeCompare(t.original.name),M=(n,t)=>{if(!n.original.description&&!t.original.description)return 0;if(n.original.description){if(!t.original.description)return-1}else return 1;return n.original.description.localeCompare(t.original.description)},N=(n,t)=>n.original.enabled===t.original.enabled?0:n.original.enabled?1:-1;function G({featureToggles:n,allowEditing:t,onUpdateSuccess:l}){n.sort((e,i)=>e.name.localeCompare(i.name));const r=(0,c.useRef)(n),[o,f]=(0,c.useState)(n),[d,g]=(0,c.useState)(!1),[P,U]=(0,c.useState)(!1),D=j(),W=(e,i)=>{const p={...e,enabled:i},J=o.map(S=>S.name===e.name?p:S);f(J)},Y=async()=>{g(!0);try{const e=K();await D.updateFeatureToggles(e),r.current=[...o],l()}finally{g(!1)}},h=(0,c.useRef)(null),m=e=>()=>{U(e),!e&&h.current&&h.current.focus()},K=()=>o.filter((e,i)=>e.enabled!==r.current[i].enabled),V=()=>o.some((e,i)=>e.enabled!==r.current[i].enabled),$=e=>t?e?"This is a non-editable feature":"":"Feature management is not configured for editing",z=e=>{switch(e){case"GA":return(0,a.jsx)(T.m,{content:"General availability",children:(0,a.jsx)("div",{children:"GA"})});case"privatePreview":case"preview":case"experimental":return"Beta";case"deprecated":return"Deprecated";default:return e}},H=[{id:"name",header:"Name",cell:({cell:{value:e}})=>(0,a.jsx)("div",{children:e}),sortType:E},{id:"description",header:"Description",cell:({cell:{value:e}})=>(0,a.jsx)("div",{children:e}),sortType:M},{id:"stage",header:"Stage",cell:({cell:{value:e}})=>(0,a.jsx)("div",{children:z(e)})},{id:"enabled",header:"State",cell:({row:e})=>{const i=(0,a.jsx)("div",{children:(0,a.jsx)(B.d,{value:e.original.enabled,disabled:e.original.readOnly,onChange:p=>W(e.original,p.currentTarget.checked)})});return e.original.readOnly?(0,a.jsx)(T.m,{content:$(e.original.readOnly),children:i}):i},sortType:N}];return(0,a.jsxs)(a.Fragment,{children:[t&&(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",padding:"0 0 5px 0"},children:[(0,a.jsx)(F.$n,{disabled:!V()||d,onClick:m(!0),ref:h,children:d?"Saving...":"Save Changes"}),(0,a.jsx)(I.u,{isOpen:P,title:"Apply feature toggle changes",body:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{children:"Some features are stable (GA) and enabled by default, whereas some are currently in their preliminary Beta phase, available for early adoption."}),(0,a.jsx)("p",{children:"We advise understanding the implications of each feature change before making modifications."})]}),confirmText:"Save changes",onConfirm:async()=>{m(!1)(),Y()},onDismiss:m(!1)})]}),(0,a.jsx)(w.j,{columns:H,data:o,getRowId:e=>e.name})]})}function L(){const[n,t]=(0,c.useState)(1),l=j(),r=(0,b.A)(()=>l.getFeatureToggles(),[n]),o=(0,C.of)(O),f=()=>{t(n+1)},d=()=>(0,a.jsxs)("div",{className:o.warning,children:[(0,a.jsx)("div",{className:o.icon,children:(0,a.jsx)(A.I,{name:"exclamation-triangle"})}),(0,a.jsx)("span",{className:o.message,children:r.value?.restartRequired?"A restart is pending for your Grafana instance to apply the latest feature toggle changes":"Saving feature toggle changes will prompt a restart of the instance, which may take a few minutes"})]}),g=(0,a.jsxs)("div",{children:["View and edit feature toggles. Read more about feature toggles at"," ",(0,a.jsx)("a",{className:"external-link",target:"_new",href:"https://grafana.com/docs/grafana/latest/setup-grafana/configure-grafana/feature-toggles/",children:"grafana.com"}),"."]});return(0,a.jsx)(x.YW,{navId:"feature-toggles",subTitle:g,children:(0,a.jsx)(x.YW.Contents,{isLoading:r.loading,children:(0,a.jsxs)(a.Fragment,{children:[r.error,r.loading&&"Fetching feature toggles",(0,a.jsx)(d,{}),r.value&&(0,a.jsx)(G,{featureToggles:r.value.toggles,allowEditing:r.value.allowEditing||!1,onUpdateSuccess:f})]})})})}function O(n){return{warning:(0,u.css)({display:"flex",marginTop:n.spacing(.25),marginBottom:n.spacing(.25)}),icon:(0,u.css)({color:n.colors.warning.main,paddingRight:n.spacing()}),message:(0,u.css)({color:n.colors.text.secondary,marginTop:n.spacing(.25)})}}}}]);

//# sourceMappingURL=AdminFeatureTogglesPage.890aa314228072e4d15a.js.map