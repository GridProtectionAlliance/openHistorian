(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{R57O:function(t,e,r){"use strict";r.r(e);var a=r("LvDl"),n=r.n(a),o=r("mrSG"),i=function(){function t(t){this.$q=t}return t.prototype.processQueryResult=function(t){var e,r,a,n,i=[];if(!t.data.results)return{data:i};for(var s in t.data.results){var u=t.data.results[s];if(u.series)try{for(var l=(e=void 0,o.i(u.series)),c=l.next();!c.done;c=l.next()){var m=c.value;i.push({target:m.name,datapoints:m.points,refId:u.refId,meta:u.meta})}}catch(t){e={error:t}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(e)throw e.error}}if(u.tables)try{for(var f=(a=void 0,o.i(u.tables)),d=f.next();!d.done;d=f.next()){var p=d.value;p.type="table",p.refId=u.refId,p.meta=u.meta,i.push(p)}}catch(t){a={error:t}}finally{try{d&&!d.done&&(n=f.return)&&n.call(f)}finally{if(a)throw a.error}}}return{data:i}},t.prototype.parseMetricFindQueryResult=function(t,e){if(!e||0===e.data.length||0===e.data.results[t].meta.rowCount)return[];var r=e.data.results[t].tables[0].columns,a=e.data.results[t].tables[0].rows,n=this.findColIndex(r,"__text"),o=this.findColIndex(r,"__value");return 2===r.length&&-1!==n&&-1!==o?this.transformToKeyValueList(a,n,o):this.transformToSimpleList(a)},t.prototype.transformToKeyValueList=function(t,e,r){for(var a=[],n=0;n<t.length;n++)this.containsKey(a,t[n][e])||a.push({text:t[n][e],value:t[n][r]});return a},t.prototype.transformToSimpleList=function(t){for(var e=[],r=0;r<t.length;r++)for(var a=0;a<t[r].length;a++){var o=t[r][a];-1===e.indexOf(o)&&e.push(o)}return n.a.map(e,function(t){return{text:t}})},t.prototype.findColIndex=function(t,e){for(var r=0;r<t.length;r++)if(t[r].text===e)return r;return-1},t.prototype.containsKey=function(t,e){for(var r=0;r<t.length;r++)if(t[r].text===e)return!0;return!1},t.prototype.transformAnnotationResponse=function(t,e){for(var r=e.data.results[t.annotation.name].tables[0],a=-1,n=-1,o=-1,i=0;i<r.columns.length;i++)"time"===r.columns[i].text?a=i:"text"===r.columns[i].text?n=i:"tags"===r.columns[i].text&&(o=i);if(-1===a)return this.$q.reject({message:"Missing mandatory time column (with time column alias) in annotation query."});var s=[];for(i=0;i<r.rows.length;i++){var u=r.rows[i];s.push({annotation:t.annotation,time:Math.floor(u[a]),text:u[n],tags:u[o]?u[o].trim().split(/\s*,\s*/):[]})}return s},t}(),s=function(){function t(t,e,r,a,n){this.backendSrv=e,this.$q=r,this.templateSrv=a,this.timeSrv=n,this.name=t.name,this.id=t.id,this.responseParser=new i(this.$q),this.interval=(t.jsonData||{}).timeInterval||"1m"}return t.$inject=["instanceSettings","backendSrv","$q","templateSrv","timeSrv"],t.prototype.interpolateVariable=function(t,e){return"string"==typeof t?e.multi||e.includeAll?"'"+t.replace(/'/g,"''")+"'":t:"number"==typeof t?t:n.a.map(t,function(e){return"number"==typeof t?t:"'"+e.replace(/'/g,"''")+"'"}).join(",")},t.prototype.query=function(t){var e=this,r=n.a.filter(t.targets,function(t){return!0!==t.hide}).map(function(r){return{refId:r.refId,intervalMs:t.intervalMs,maxDataPoints:t.maxDataPoints,datasourceId:e.id,rawSql:e.templateSrv.replace(r.rawSql,t.scopedVars,e.interpolateVariable),format:r.format}});return 0===r.length?this.$q.when({data:[]}):this.backendSrv.datasourceRequest({url:"/api/tsdb/query",method:"POST",data:{from:t.range.from.valueOf().toString(),to:t.range.to.valueOf().toString(),queries:r}}).then(this.responseParser.processQueryResult)},t.prototype.annotationQuery=function(t){var e=this;if(!t.annotation.rawQuery)return this.$q.reject({message:"Query missing in annotation definition"});var r={refId:t.annotation.name,datasourceId:this.id,rawSql:this.templateSrv.replace(t.annotation.rawQuery,t.scopedVars,this.interpolateVariable),format:"table"};return this.backendSrv.datasourceRequest({url:"/api/tsdb/query",method:"POST",data:{from:t.range.from.valueOf().toString(),to:t.range.to.valueOf().toString(),queries:[r]}}).then(function(r){return e.responseParser.transformAnnotationResponse(t,r)})},t.prototype.metricFindQuery=function(t,e){var r=this,a="tempvar";e&&e.variable&&e.variable.name&&(a=e.variable.name);var n={refId:a,datasourceId:this.id,rawSql:this.templateSrv.replace(t,{},this.interpolateVariable),format:"table"},o=this.timeSrv.timeRange(),i={queries:[n],from:o.from.valueOf().toString(),to:o.to.valueOf().toString()};return this.backendSrv.datasourceRequest({url:"/api/tsdb/query",method:"POST",data:i}).then(function(t){return r.responseParser.parseMetricFindQueryResult(a,t)})},t.prototype.testDatasource=function(){return this.backendSrv.datasourceRequest({url:"/api/tsdb/query",method:"POST",data:{from:"5m",to:"now",queries:[{refId:"A",intervalMs:1,maxDataPoints:1,datasourceId:this.id,rawSql:"SELECT 1",format:"table"}]}}).then(function(t){return{status:"success",message:"Database Connection OK"}}).catch(function(t){return console.log(t),t.data&&t.data.message?{status:"error",message:t.data.message}:{status:"error",message:t.status}})},t.prototype.targetContainsTemplate=function(t){var e=t.rawSql.replace("$__","");return this.templateSrv.variableExists(e)},t}(),u=r("LzXI"),l="SELECT\n  $__timeEpoch(<time_column>),\n  <value column> as value,\n  <series name column> as metric\nFROM\n  <table name>\nWHERE\n  $__timeFilter(time_column)\nORDER BY\n  <time_column> ASC",c=function(t){function e(e,r){var a=t.call(this,e,r)||this;return a.target.format=a.target.format||"time_series",a.target.alias="",a.formats=[{text:"Time series",value:"time_series"},{text:"Table",value:"table"}],a.target.rawSql||("table"===a.panelCtrl.panel.type?(a.target.format="table",a.target.rawSql="SELECT 1"):a.target.rawSql=l),a.panelCtrl.events.on("data-received",a.onDataReceived.bind(a),e),a.panelCtrl.events.on("data-error",a.onDataError.bind(a),e),a}return e.$inject=["$scope","$injector"],o.c(e,t),e.prototype.onDataReceived=function(t){this.lastQueryMeta=null,this.lastQueryError=null;var e=n.a.find(t,{refId:this.target.refId});e&&(this.lastQueryMeta=e.meta)},e.prototype.onDataError=function(t){if(t.data&&t.data.results){var e=t.data.results[this.target.refId];e&&(this.lastQueryMeta=e.meta,this.lastQueryError=e.error)}},e.templateUrl="partials/query.editor.html",e}(u.QueryCtrl),m=r("QjE0"),f=function(){function t(t){this.current.jsonData.encrypt=this.current.jsonData.encrypt||"false",this.onPasswordReset=Object(m.c)(this,m.a.Password),this.onPasswordChange=Object(m.b)(this,m.a.Password)}return t.$inject=["$scope"],t.templateUrl="partials/config.html",t}();r.d(e,"AnnotationsQueryCtrl",function(){return p}),r.d(e,"MssqlDatasource",function(){return s}),r.d(e,"Datasource",function(){return s}),r.d(e,"QueryCtrl",function(){return c}),r.d(e,"ConfigCtrl",function(){return f});var d="SELECT\n    <time_column> as time,\n    <text_column> as text,\n    <tags_column> as tags\n  FROM\n    <table name>\n  WHERE\n    $__timeFilter(time_column)\n  ORDER BY\n    <time_column> ASC",p=function(){function t(){this.annotation.rawQuery=this.annotation.rawQuery||d}return t.templateUrl="partials/annotations.editor.html",t}()}}]);
//# sourceMappingURL=mssqlPlugin.3932bda029d2299a9d96.js.map