{"version":3,"file":"9711.9bbb489fb2ca3baed3d3.js","mappings":"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","sources":["webpack://grafana/./public/app/features/alerting/unified/components/Authorize.tsx","webpack://grafana/./public/app/features/alerting/unified/components/notification-policies/Matchers.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/notificaton-preview/route.ts","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/notificaton-preview/NotificationPolicyMatchers.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/notificaton-preview/NotificationRouteDetailsModal.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/notificaton-preview/NotificationRoute.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/notificaton-preview/useAlertmanagerNotificationRoutingPreview.ts","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/notificaton-preview/NotificationPreviewByAlertManager.tsx","webpack://grafana/./public/app/features/alerting/unified/hooks/useAlertmanagerConfig.ts","webpack://grafana/./public/app/features/alerting/unified/createRouteGroupsMatcherWorker.ts","webpack://grafana/./public/app/features/alerting/unified/useRouteGroupsMatcher.ts"],"sourcesContent":["import { chain, filter } from 'lodash';\nimport { PropsWithChildren } from 'react';\n\nimport {\n  Abilities,\n  Action,\n  AlertingAction,\n  AlertmanagerAction,\n  useAlertingAbilities,\n  useAllAlertmanagerAbilities,\n} from '../hooks/useAbilities';\n\ninterface AuthorizeProps extends PropsWithChildren {\n  actions: AlertmanagerAction[] | AlertingAction[];\n}\n\nexport const Authorize = ({ actions, children }: AuthorizeProps) => {\n  const alertmanagerActions = filter(actions, isAlertmanagerAction) as AlertmanagerAction[];\n  const alertSourceActions = filter(actions, isAlertingAction) as AlertingAction[];\n\n  if (alertmanagerActions.length) {\n    return <AuthorizeAlertmanager actions={alertmanagerActions}>{children}</AuthorizeAlertmanager>;\n  }\n\n  if (alertSourceActions.length) {\n    return <AuthorizeAlertsource actions={alertSourceActions}>{children}</AuthorizeAlertsource>;\n  }\n\n  return null;\n};\n\ninterface ActionsProps<T extends Action> extends PropsWithChildren {\n  actions: T[];\n}\n\nconst AuthorizeAlertmanager = ({ actions, children }: ActionsProps<AlertmanagerAction>) => {\n  const alertmanagerAbilties = useAllAlertmanagerAbilities();\n  const allowed = actionsAllowed(alertmanagerAbilties, actions);\n\n  if (allowed) {\n    return <>{children}</>;\n  } else {\n    return null;\n  }\n};\n\nconst AuthorizeAlertsource = ({ actions, children }: ActionsProps<AlertingAction>) => {\n  const alertSourceAbilities = useAlertingAbilities();\n  const allowed = actionsAllowed(alertSourceAbilities, actions);\n\n  if (allowed) {\n    return <>{children}</>;\n  } else {\n    return null;\n  }\n};\n\n// TODO add some authorize helper components for alert source and individual alert rules\n\n// check if some action is allowed from the abilities\nfunction actionsAllowed<T extends Action>(abilities: Abilities<T>, actions: T[]) {\n  return chain(abilities)\n    .pick(actions)\n    .values()\n    .value()\n    .some(([_supported, allowed]) => allowed === true);\n}\n\nfunction isAlertmanagerAction(action: AlertmanagerAction) {\n  return Object.values(AlertmanagerAction).includes(action);\n}\n\nfunction isAlertingAction(action: AlertingAction) {\n  return Object.values(AlertingAction).includes(action);\n}\n","import { css } from '@emotion/css';\nimport { take, takeRight, uniqueId } from 'lodash';\nimport { FC } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { getTagColorsFromName, useStyles2, Stack } from '@grafana/ui';\nimport { ObjectMatcher } from 'app/plugins/datasource/alertmanager/types';\n\nimport { MatcherFormatter, matcherFormatter } from '../../utils/matchers';\nimport { PopupCard } from '../HoverCard';\n\ntype MatchersProps = { matchers: ObjectMatcher[]; formatter?: MatcherFormatter };\n\n// renders the first N number of matchers\nconst Matchers: FC<MatchersProps> = ({ matchers, formatter = 'default' }) => {\n  const styles = useStyles2(getStyles);\n\n  const NUM_MATCHERS = 5;\n\n  const firstFew = take(matchers, NUM_MATCHERS);\n  const rest = takeRight(matchers, matchers.length - NUM_MATCHERS);\n  const hasMoreMatchers = rest.length > 0;\n\n  return (\n    <span data-testid=\"label-matchers\">\n      <Stack direction=\"row\" gap={1} alignItems=\"center\" wrap={'wrap'}>\n        {firstFew.map((matcher) => (\n          <MatcherBadge key={uniqueId()} matcher={matcher} formatter={formatter} />\n        ))}\n        {/* TODO hover state to show all matchers we're not showing */}\n        {hasMoreMatchers && (\n          <PopupCard\n            arrow\n            placement=\"top\"\n            content={\n              <>\n                {rest.map((matcher) => (\n                  <MatcherBadge key={uniqueId()} matcher={matcher} />\n                ))}\n              </>\n            }\n          >\n            <span>\n              <div className={styles.metadata}>{`and ${rest.length} more`}</div>\n            </span>\n          </PopupCard>\n        )}\n      </Stack>\n    </span>\n  );\n};\n\ninterface MatcherBadgeProps {\n  matcher: ObjectMatcher;\n  formatter?: MatcherFormatter;\n}\n\nconst MatcherBadge: FC<MatcherBadgeProps> = ({ matcher, formatter = 'default' }) => {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.matcher(matcher[0]).wrapper}>\n      <Stack direction=\"row\" gap={0} alignItems=\"baseline\">\n        {matcherFormatter[formatter](matcher)}\n      </Stack>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  matcher: (label: string) => {\n    const { color, borderColor } = getTagColorsFromName(label);\n\n    return {\n      wrapper: css({\n        color: '#fff',\n        background: color,\n        padding: `${theme.spacing(0.33)} ${theme.spacing(0.66)}`,\n        fontSize: theme.typography.bodySmall.fontSize,\n\n        border: `solid 1px ${borderColor}`,\n        borderRadius: theme.shape.borderRadius(2),\n\n        // Ensure we preserve whitespace, as otherwise it's not noticeable _at all_\n        // when rendering the matcher, and is only noticeable when editing\n        whiteSpace: 'pre',\n      }),\n    };\n  },\n  metadata: css({\n    color: theme.colors.text.secondary,\n\n    fontSize: theme.typography.bodySmall.fontSize,\n    fontWeight: theme.typography.bodySmall.fontWeight,\n  }),\n});\n\nexport { Matchers };\n","import { RouteWithID } from '../../../../../../plugins/datasource/alertmanager/types';\n\nexport interface RouteWithPath extends RouteWithID {\n  path: string[]; // path from root route to this route\n}\n\nexport function isDefaultPolicy(route: RouteWithPath) {\n  return route.path?.length === 0;\n}\n\n// we traverse the whole tree and we create a map with <id , RouteWithPath>\nexport function getRoutesByIdMap(rootRoute: RouteWithID): Map<string, RouteWithPath> {\n  const map = new Map<string, RouteWithPath>();\n\n  function addRoutesToMap(route: RouteWithID, path: string[] = []) {\n    map.set(route.id, { ...route, path: path });\n    route.routes?.forEach((r) => addRoutesToMap(r, [...path, route.id]));\n  }\n\n  addRoutesToMap(rootRoute, []);\n  return map;\n}\n\nexport function hasEmptyMatchers(route: RouteWithID) {\n  return route.object_matchers?.length === 0;\n}\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\n\nimport { MatcherFormatter } from '../../../utils/matchers';\nimport { Matchers } from '../../notification-policies/Matchers';\n\nimport { hasEmptyMatchers, isDefaultPolicy, RouteWithPath } from './route';\n\ninterface Props {\n  route: RouteWithPath;\n  matcherFormatter: MatcherFormatter;\n}\n\nexport function NotificationPolicyMatchers({ route, matcherFormatter }: Props) {\n  const styles = useStyles2(getStyles);\n  if (isDefaultPolicy(route)) {\n    return <div className={styles.defaultPolicy}>Default policy</div>;\n  } else if (hasEmptyMatchers(route)) {\n    return <div className={styles.textMuted}>No matchers</div>;\n  } else {\n    return <Matchers matchers={route.object_matchers ?? []} formatter={matcherFormatter} />;\n  }\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  defaultPolicy: css({\n    padding: theme.spacing(0.5),\n    background: theme.colors.background.secondary,\n    width: 'fit-content',\n  }),\n  textMuted: css({\n    color: theme.colors.text.secondary,\n  }),\n});\n","import { css, cx } from '@emotion/css';\nimport { compact } from 'lodash';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, Icon, Modal, Stack, useStyles2 } from '@grafana/ui';\n\nimport { Receiver } from '../../../../../../plugins/datasource/alertmanager/types';\nimport { AlertmanagerAction } from '../../../hooks/useAbilities';\nimport { AlertmanagerProvider } from '../../../state/AlertmanagerContext';\nimport { getAmMatcherFormatter } from '../../../utils/alertmanager';\nimport { MatcherFormatter } from '../../../utils/matchers';\nimport { makeAMLink } from '../../../utils/misc';\nimport { Authorize } from '../../Authorize';\nimport { Matchers } from '../../notification-policies/Matchers';\n\nimport { hasEmptyMatchers, isDefaultPolicy, RouteWithPath } from './route';\n\ninterface Props {\n  routesByIdMap: Map<string, RouteWithPath>;\n  route: RouteWithPath;\n  matcherFormatter: MatcherFormatter;\n}\n\nfunction PolicyPath({ route, routesByIdMap, matcherFormatter }: Props) {\n  const styles = useStyles2(getStyles);\n  const routePathIds = route.path?.slice(1) ?? [];\n  const routePathObjects = [...compact(routePathIds.map((id) => routesByIdMap.get(id))), route];\n\n  return (\n    <div className={styles.policyPathWrapper}>\n      <div className={styles.defaultPolicy}>Default policy</div>\n      {routePathObjects.map((pathRoute, index) => {\n        return (\n          <div key={pathRoute.id}>\n            <div className={styles.policyInPath(index, index === routePathObjects.length - 1)}>\n              {hasEmptyMatchers(pathRoute) ? (\n                <div className={styles.textMuted}>No matchers</div>\n              ) : (\n                <Matchers matchers={pathRoute.object_matchers ?? []} formatter={matcherFormatter} />\n              )}\n            </div>\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n\ninterface NotificationRouteDetailsModalProps {\n  onClose: () => void;\n  route: RouteWithPath;\n  receiver: Receiver;\n  routesByIdMap: Map<string, RouteWithPath>;\n  alertManagerSourceName: string;\n}\n\nexport function NotificationRouteDetailsModal({\n  onClose,\n  route,\n  receiver,\n  routesByIdMap,\n  alertManagerSourceName,\n}: NotificationRouteDetailsModalProps) {\n  const styles = useStyles2(getStyles);\n  const isDefault = isDefaultPolicy(route);\n\n  return (\n    <AlertmanagerProvider accessType=\"notification\" alertmanagerSourceName={alertManagerSourceName}>\n      <Modal\n        className={styles.detailsModal}\n        isOpen={true}\n        title=\"Routing details\"\n        onDismiss={onClose}\n        onClickBackdrop={onClose}\n      >\n        <Stack gap={0} direction=\"column\">\n          <div className={cx(styles.textMuted, styles.marginBottom(2))}>\n            Your alert instances are routed as follows.\n          </div>\n          <div>Notification policy path</div>\n          {isDefault && <div className={styles.textMuted}>Default policy</div>}\n          <div className={styles.separator(1)} />\n          {!isDefault && (\n            <>\n              <PolicyPath\n                route={route}\n                routesByIdMap={routesByIdMap}\n                matcherFormatter={getAmMatcherFormatter(alertManagerSourceName)}\n              />\n            </>\n          )}\n          <div className={styles.separator(4)} />\n          <div className={styles.contactPoint}>\n            <Stack gap={1} direction=\"row\" alignItems=\"center\">\n              Contact point:\n              <span className={styles.textMuted}>{receiver.name}</span>\n            </Stack>\n            <Authorize actions={[AlertmanagerAction.UpdateContactPoint]}>\n              <Stack gap={1} direction=\"row\" alignItems=\"center\">\n                <a\n                  href={makeAMLink(\n                    `/alerting/notifications/receivers/${encodeURIComponent(receiver.name)}/edit`,\n                    alertManagerSourceName\n                  )}\n                  className={styles.link}\n                  target=\"_blank\"\n                  rel=\"noreferrer\"\n                >\n                  See details <Icon name=\"external-link-alt\" />\n                </a>\n              </Stack>\n            </Authorize>\n          </div>\n          <div className={styles.button}>\n            <Button variant=\"primary\" type=\"button\" onClick={onClose}>\n              Close\n            </Button>\n          </div>\n        </Stack>\n      </Modal>\n    </AlertmanagerProvider>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  textMuted: css({\n    color: theme.colors.text.secondary,\n  }),\n  link: css({\n    display: 'block',\n    color: theme.colors.text.link,\n  }),\n  button: css({\n    justifyContent: 'flex-end',\n    display: 'flex',\n  }),\n  detailsModal: css({\n    maxWidth: '560px',\n  }),\n  defaultPolicy: css({\n    padding: theme.spacing(0.5),\n    background: theme.colors.background.secondary,\n    width: 'fit-content',\n  }),\n  contactPoint: css({\n    display: 'flex',\n    flexDirection: 'row',\n    gap: theme.spacing(1),\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    marginBottom: theme.spacing(1),\n  }),\n  policyPathWrapper: css({\n    display: 'flex',\n    flexDirection: 'column',\n    marginTop: theme.spacing(1),\n  }),\n  separator: (units: number) =>\n    css({\n      marginTop: theme.spacing(units),\n    }),\n  marginBottom: (units: number) =>\n    css({\n      marginBottom: theme.spacing(theme.spacing(units)),\n    }),\n  policyInPath: (index = 0, highlight = false) =>\n    css({\n      marginLeft: `${30 + index * 30}px`,\n      padding: theme.spacing(1),\n      marginTop: theme.spacing(1),\n      border: `solid 1px ${highlight ? theme.colors.info.border : theme.colors.border.weak}`,\n      background: theme.colors.background.secondary,\n      width: 'fit-content',\n      position: 'relative',\n      '&:before': {\n        content: '\"\"',\n        position: 'absolute',\n        height: 'calc(100% - 10px)',\n        width: theme.spacing(1),\n        borderLeft: `solid 1px ${theme.colors.border.weak}`,\n        borderBottom: `solid 1px ${theme.colors.border.weak}`,\n        marginTop: theme.spacing(-2),\n        marginLeft: `-17px`,\n      },\n    }),\n});\n","import { css, cx } from '@emotion/css';\nimport { uniqueId } from 'lodash';\nimport pluralize from 'pluralize';\nimport { useState } from 'react';\nimport { useToggle } from 'react-use';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, getTagColorIndexFromName, TagList, useStyles2 } from '@grafana/ui';\n\nimport { Receiver } from '../../../../../../plugins/datasource/alertmanager/types';\nimport { Stack } from '../../../../../../plugins/datasource/parca/QueryEditor/Stack';\nimport { getAmMatcherFormatter } from '../../../utils/alertmanager';\nimport { AlertInstanceMatch } from '../../../utils/notification-policies';\nimport { CollapseToggle } from '../../CollapseToggle';\nimport { MetaText } from '../../MetaText';\nimport { Spacer } from '../../Spacer';\n\nimport { NotificationPolicyMatchers } from './NotificationPolicyMatchers';\nimport { NotificationRouteDetailsModal } from './NotificationRouteDetailsModal';\nimport { RouteWithPath } from './route';\n\nfunction NotificationRouteHeader({\n  route,\n  receiver,\n  routesByIdMap,\n  instancesCount,\n  alertManagerSourceName,\n  expandRoute,\n  onExpandRouteClick,\n}: {\n  route: RouteWithPath;\n  receiver: Receiver;\n  routesByIdMap: Map<string, RouteWithPath>;\n  instancesCount: number;\n  alertManagerSourceName: string;\n  expandRoute: boolean;\n  onExpandRouteClick: (expand: boolean) => void;\n}) {\n  const styles = useStyles2(getStyles);\n  const [showDetails, setShowDetails] = useState(false);\n\n  const onClickDetails = () => {\n    setShowDetails(true);\n  };\n\n  // @TODO: re-use component ContactPointsHoverDetails from Policy once we have it for cloud AMs.\n\n  return (\n    <div className={styles.routeHeader}>\n      <CollapseToggle\n        isCollapsed={!expandRoute}\n        onToggle={(isCollapsed) => onExpandRouteClick(!isCollapsed)}\n        aria-label=\"Expand policy route\"\n      />\n\n      <Stack flexGrow={1} gap={1}>\n        {/* TODO: fix keyboard a11y */}\n        {/* eslint-disable-next-line jsx-a11y/click-events-have-key-events, jsx-a11y/no-static-element-interactions */}\n        <div onClick={() => onExpandRouteClick(!expandRoute)} className={styles.expandable}>\n          <Stack gap={1} direction=\"row\" alignItems=\"center\">\n            Notification policy\n            <NotificationPolicyMatchers\n              route={route}\n              matcherFormatter={getAmMatcherFormatter(alertManagerSourceName)}\n            />\n          </Stack>\n        </div>\n        <Spacer />\n        <Stack gap={2} direction=\"row\" alignItems=\"center\">\n          <MetaText icon=\"layers-alt\" data-testid=\"matching-instances\">\n            {instancesCount ?? '-'} {pluralize('instance', instancesCount)}\n          </MetaText>\n          <Stack gap={1} direction=\"row\" alignItems=\"center\">\n            <div>\n              <span className={styles.textMuted}>@ Delivered to</span> {receiver.name}\n            </div>\n\n            <div className={styles.verticalBar} />\n\n            <Button type=\"button\" onClick={onClickDetails} variant=\"secondary\" fill=\"outline\" size=\"sm\">\n              See details\n            </Button>\n          </Stack>\n        </Stack>\n      </Stack>\n      {showDetails && (\n        <NotificationRouteDetailsModal\n          onClose={() => setShowDetails(false)}\n          route={route}\n          receiver={receiver}\n          routesByIdMap={routesByIdMap}\n          alertManagerSourceName={alertManagerSourceName}\n        />\n      )}\n    </div>\n  );\n}\n\ninterface NotificationRouteProps {\n  route: RouteWithPath;\n  receiver: Receiver;\n  instanceMatches: AlertInstanceMatch[];\n  routesByIdMap: Map<string, RouteWithPath>;\n  alertManagerSourceName: string;\n}\n\nexport function NotificationRoute({\n  route,\n  instanceMatches,\n  receiver,\n  routesByIdMap,\n  alertManagerSourceName,\n}: NotificationRouteProps) {\n  const styles = useStyles2(getStyles);\n  const [expandRoute, setExpandRoute] = useToggle(false);\n  // @TODO: The color index might be updated at some point in the future.Maybe we should roll our own tag component,\n  // one that supports a custom function to define the color and allow manual color overrides\n  const GREY_COLOR_INDEX = 9;\n\n  return (\n    <div data-testid=\"matching-policy-route\">\n      <NotificationRouteHeader\n        route={route}\n        receiver={receiver}\n        routesByIdMap={routesByIdMap}\n        instancesCount={instanceMatches.length}\n        alertManagerSourceName={alertManagerSourceName}\n        expandRoute={expandRoute}\n        onExpandRouteClick={setExpandRoute}\n      />\n      {expandRoute && (\n        <Stack gap={1} direction=\"column\">\n          <div className={styles.routeInstances} data-testid=\"route-matching-instance\">\n            {instanceMatches.map((instanceMatch) => {\n              const matchArray = Array.from(instanceMatch.labelsMatch);\n              const matchResult = matchArray.map(([label, matchResult]) => ({\n                label: `${label[0]}=${label[1]}`,\n                match: matchResult.match,\n                colorIndex: matchResult.match ? getTagColorIndexFromName(label[0]) : GREY_COLOR_INDEX,\n              }));\n\n              const matchingLabels = matchResult.filter((mr) => mr.match);\n              const nonMatchingLabels = matchResult.filter((mr) => !mr.match);\n\n              return (\n                <div className={styles.tagListCard} key={uniqueId()}>\n                  {matchArray.length > 0 ? (\n                    <>\n                      {matchingLabels.length > 0 ? (\n                        <TagList\n                          tags={matchingLabels.map((mr) => mr.label)}\n                          className={styles.labelList}\n                          getColorIndex={(_, index) => matchingLabels[index].colorIndex}\n                        />\n                      ) : (\n                        <div className={cx(styles.textMuted, styles.textItalic)}>No matching labels</div>\n                      )}\n                      <div className={styles.labelSeparator} />\n                      <TagList\n                        tags={nonMatchingLabels.map((mr) => mr.label)}\n                        className={styles.labelList}\n                        getColorIndex={(_, index) => nonMatchingLabels[index].colorIndex}\n                      />\n                    </>\n                  ) : (\n                    <div className={styles.textMuted}>No labels</div>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        </Stack>\n      )}\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  textMuted: css({\n    color: theme.colors.text.secondary,\n  }),\n  textItalic: css({\n    fontStyle: 'italic',\n  }),\n  expandable: css({\n    cursor: 'pointer',\n  }),\n  routeHeader: css({\n    display: 'flex',\n    flexDirection: 'row',\n    gap: theme.spacing(1),\n    alignItems: 'center',\n    borderBottom: `1px solid ${theme.colors.border.weak}`,\n    padding: theme.spacing(0.5, 0.5, 0.5, 0),\n    '&:hover': {\n      backgroundColor: theme.components.table.rowHoverBackground,\n    },\n  }),\n  labelList: css({\n    flex: '0 1 auto',\n    justifyContent: 'flex-start',\n  }),\n  labelSeparator: css({\n    width: '1px',\n    backgroundColor: theme.colors.border.weak,\n  }),\n  tagListCard: css({\n    display: 'flex',\n    flexDirection: 'row',\n    gap: theme.spacing(2),\n\n    position: 'relative',\n    background: theme.colors.background.secondary,\n    padding: theme.spacing(1),\n\n    borderRadius: theme.shape.borderRadius(2),\n    border: `solid 1px ${theme.colors.border.weak}`,\n  }),\n  routeInstances: css({\n    padding: theme.spacing(1, 0, 1, 4),\n    position: 'relative',\n\n    display: 'flex',\n    flexDirection: 'column',\n    gap: theme.spacing(1),\n\n    '&:before': {\n      content: '\"\"',\n      position: 'absolute',\n      left: theme.spacing(2),\n      height: `calc(100% - ${theme.spacing(2)})`,\n      width: theme.spacing(4),\n      borderLeft: `solid 1px ${theme.colors.border.weak}`,\n    },\n  }),\n  verticalBar: css({\n    width: '1px',\n    height: '20px',\n    backgroundColor: theme.colors.secondary.main,\n    marginLeft: theme.spacing(1),\n    marginRight: theme.spacing(1),\n  }),\n});\n","import { useMemo } from 'react';\nimport { useAsync } from 'react-use';\n\nimport { Receiver } from '../../../../../../plugins/datasource/alertmanager/types';\nimport { Labels } from '../../../../../../types/unified-alerting-dto';\nimport { useAlertmanagerConfig } from '../../../hooks/useAlertmanagerConfig';\nimport { useRouteGroupsMatcher } from '../../../useRouteGroupsMatcher';\nimport { addUniqueIdentifierToRoute } from '../../../utils/amroutes';\nimport { GRAFANA_RULES_SOURCE_NAME } from '../../../utils/datasource';\nimport { AlertInstanceMatch, computeInheritedTree, normalizeRoute } from '../../../utils/notification-policies';\n\nimport { getRoutesByIdMap, RouteWithPath } from './route';\n\nexport const useAlertmanagerNotificationRoutingPreview = (\n  alertManagerSourceName: string,\n  potentialInstances: Labels[]\n) => {\n  const { currentData, isLoading: configLoading, error: configError } = useAlertmanagerConfig(alertManagerSourceName);\n  const config = currentData?.alertmanager_config;\n\n  const { matchInstancesToRoute } = useRouteGroupsMatcher();\n\n  // to create the list of matching contact points we need to first get the rootRoute\n  const { rootRoute, receivers } = useMemo(() => {\n    if (!config) {\n      return {\n        receivers: [],\n        rootRoute: undefined,\n      };\n    }\n\n    return {\n      rootRoute: config.route ? normalizeRoute(addUniqueIdentifierToRoute(config.route)) : undefined,\n      receivers: config.receivers ?? [],\n    };\n  }, [config]);\n\n  // create maps for routes to be get by id, this map also contains the path to the route\n  // ⚠️ don't forget to compute the inherited tree before using this map\n  const routesByIdMap: Map<string, RouteWithPath> = rootRoute\n    ? getRoutesByIdMap(computeInheritedTree(rootRoute))\n    : new Map();\n\n  // create map for receivers to be get by name\n  const receiversByName =\n    receivers.reduce((map, receiver) => {\n      return map.set(receiver.name, receiver);\n    }, new Map<string, Receiver>()) ?? new Map<string, Receiver>();\n\n  // match labels in the tree => map of notification policies and the alert instances (list of labels) in each one\n  const {\n    value: matchingMap = new Map<string, AlertInstanceMatch[]>(),\n    loading: matchingLoading,\n    error: matchingError,\n  } = useAsync(async () => {\n    if (!rootRoute) {\n      return;\n    }\n    return await matchInstancesToRoute(rootRoute, potentialInstances, {\n      unquoteMatchers: alertManagerSourceName !== GRAFANA_RULES_SOURCE_NAME,\n    });\n  }, [rootRoute, potentialInstances]);\n\n  return {\n    routesByIdMap,\n    receiversByName,\n    matchingMap,\n    loading: configLoading || matchingLoading,\n    error: configError ?? matchingError,\n  };\n};\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Alert, LoadingPlaceholder, useStyles2, withErrorBoundary } from '@grafana/ui';\n\nimport { Stack } from '../../../../../../plugins/datasource/parca/QueryEditor/Stack';\nimport { Labels } from '../../../../../../types/unified-alerting-dto';\nimport { AlertManagerDataSource } from '../../../utils/datasource';\n\nimport { NotificationRoute } from './NotificationRoute';\nimport { useAlertmanagerNotificationRoutingPreview } from './useAlertmanagerNotificationRoutingPreview';\n\nfunction NotificationPreviewByAlertManager({\n  alertManagerSource,\n  potentialInstances,\n  onlyOneAM,\n}: {\n  alertManagerSource: AlertManagerDataSource;\n  potentialInstances: Labels[];\n  onlyOneAM: boolean;\n}) {\n  const styles = useStyles2(getStyles);\n\n  const { routesByIdMap, receiversByName, matchingMap, loading, error } = useAlertmanagerNotificationRoutingPreview(\n    alertManagerSource.name,\n    potentialInstances\n  );\n\n  if (error) {\n    return (\n      <Alert title=\"Cannot load Alertmanager configuration\" severity=\"error\">\n        {error.message}\n      </Alert>\n    );\n  }\n\n  if (loading) {\n    return <LoadingPlaceholder text=\"Loading routing preview...\" />;\n  }\n\n  const matchingPoliciesFound = matchingMap.size > 0;\n\n  return matchingPoliciesFound ? (\n    <div className={styles.alertManagerRow}>\n      {!onlyOneAM && (\n        <Stack direction=\"row\" alignItems=\"center\">\n          <div className={styles.firstAlertManagerLine}></div>\n          <div className={styles.alertManagerName}>\n            {' '}\n            Alertmanager:\n            <img src={alertManagerSource.imgUrl} alt=\"\" className={styles.img} />\n            {alertManagerSource.name}\n          </div>\n          <div className={styles.secondAlertManagerLine}></div>\n        </Stack>\n      )}\n      <Stack gap={1} direction=\"column\">\n        {Array.from(matchingMap.entries()).map(([routeId, instanceMatches]) => {\n          const route = routesByIdMap.get(routeId);\n          const receiver = route?.receiver && receiversByName.get(route.receiver);\n\n          if (!route) {\n            return null;\n          }\n          if (!receiver) {\n            throw new Error('Receiver not found');\n          }\n          return (\n            <NotificationRoute\n              instanceMatches={instanceMatches}\n              route={route}\n              receiver={receiver}\n              key={routeId}\n              routesByIdMap={routesByIdMap}\n              alertManagerSourceName={alertManagerSource.name}\n            />\n          );\n        })}\n      </Stack>\n    </div>\n  ) : null;\n}\n\n// export default because we want to load the component dynamically using React.lazy\n// Due to loading of the web worker we don't want to load this component when not necessary\nexport default withErrorBoundary(NotificationPreviewByAlertManager);\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  alertManagerRow: css({\n    display: 'flex',\n    flexDirection: 'column',\n    gap: theme.spacing(1),\n    width: '100%',\n  }),\n  firstAlertManagerLine: css({\n    height: '1px',\n    width: theme.spacing(4),\n    backgroundColor: theme.colors.secondary.main,\n  }),\n  alertManagerName: css({\n    width: 'fit-content',\n  }),\n  secondAlertManagerLine: css({\n    height: '1px',\n    width: '100%',\n    flex: 1,\n    backgroundColor: theme.colors.secondary.main,\n  }),\n  img: css({\n    marginLeft: theme.spacing(2),\n    width: theme.spacing(3),\n    height: theme.spacing(3),\n    marginRight: theme.spacing(1),\n  }),\n});\n","import { SerializedError } from '@reduxjs/toolkit';\n\nimport { alertmanagerApi } from '../api/alertmanagerApi';\n\ntype Options = {\n  refetchOnFocus: boolean;\n  refetchOnReconnect: boolean;\n};\n\n// TODO refactor this so we can just call \"alertmanagerApi.endpoints.getAlertmanagerConfiguration\" everywhere\n// and remove this hook since it adds little value\nexport function useAlertmanagerConfig(amSourceName?: string, options?: Options) {\n  const fetchConfig = alertmanagerApi.endpoints.getAlertmanagerConfiguration.useQuery(amSourceName ?? '', {\n    // we'll disable cache by default to prevent overwriting other changes made since last fetch\n    refetchOnMountOrArgChange: true,\n    ...options,\n    skip: !amSourceName,\n  });\n\n  return {\n    ...fetchConfig,\n    // TODO refactor to get rid of this type assertion\n    error: fetchConfig.error as SerializedError,\n  };\n}\n","import { CorsWorker as Worker } from 'app/core/utils/CorsWorker';\n\n// CorsWorker is needed as a workaround for CORS issue caused\n// by static assets served from an url different from origin\nexport const createWorker = () => new Worker(new URL('./routeGroupsMatcher.worker.ts', import.meta.url));\n","import * as comlink from 'comlink';\nimport { useCallback, useEffect } from 'react';\n\nimport { AlertmanagerGroup, RouteWithID } from '../../../plugins/datasource/alertmanager/types';\nimport { Labels } from '../../../types/unified-alerting-dto';\n\nimport { logError, logInfo } from './Analytics';\nimport { createWorker } from './createRouteGroupsMatcherWorker';\nimport type { MatchOptions, RouteGroupsMatcher } from './routeGroupsMatcher';\n\nlet routeMatcher: comlink.Remote<RouteGroupsMatcher> | undefined;\n\n// Load worker loads the worker if it's not loaded yet\n// and returns a function to dispose of the worker\n// We do it to enable feature toggling. If the feature is disabled we don't wont to load the worker code at all\n// An alternative way would be to move all this code to the hook below, but it will create and terminate the worker much more often\nfunction loadWorker() {\n  let worker: Worker | undefined;\n\n  if (routeMatcher === undefined) {\n    try {\n      worker = createWorker();\n      routeMatcher = comlink.wrap<RouteGroupsMatcher>(worker);\n    } catch (e: unknown) {\n      if (e instanceof Error) {\n        logError(e);\n      }\n    }\n  }\n\n  const disposeWorker = () => {\n    if (worker && routeMatcher) {\n      routeMatcher[comlink.releaseProxy]();\n      worker.terminate();\n\n      routeMatcher = undefined;\n      worker = undefined;\n    }\n  };\n\n  return { disposeWorker };\n}\n\nfunction validateWorker(matcher: typeof routeMatcher): asserts matcher is comlink.Remote<RouteGroupsMatcher> {\n  if (!routeMatcher) {\n    throw new Error('Route Matcher has not been initialized');\n  }\n}\n\nexport function useRouteGroupsMatcher() {\n  useEffect(() => {\n    const { disposeWorker } = loadWorker();\n    return disposeWorker;\n  }, []);\n\n  const getRouteGroupsMap = useCallback(\n    async (rootRoute: RouteWithID, alertGroups: AlertmanagerGroup[], options?: MatchOptions) => {\n      validateWorker(routeMatcher);\n\n      const startTime = performance.now();\n\n      const result = await routeMatcher.getRouteGroupsMap(rootRoute, alertGroups, options);\n\n      const timeSpent = performance.now() - startTime;\n\n      logInfo(`Route Groups Matched in  ${timeSpent} ms`, {\n        matchingTime: timeSpent.toString(),\n        alertGroupsCount: alertGroups.length.toString(),\n        // Counting all nested routes might be too time-consuming, so we only count the first level\n        topLevelRoutesCount: rootRoute.routes?.length.toString() ?? '0',\n      });\n\n      return result;\n    },\n    []\n  );\n\n  const matchInstancesToRoute = useCallback(\n    async (rootRoute: RouteWithID, instancesToMatch: Labels[], options?: MatchOptions) => {\n      validateWorker(routeMatcher);\n\n      const startTime = performance.now();\n\n      const result = await routeMatcher.matchInstancesToRoute(rootRoute, instancesToMatch, options);\n\n      const timeSpent = performance.now() - startTime;\n\n      logInfo(`Instances Matched in  ${timeSpent} ms`, {\n        matchingTime: timeSpent.toString(),\n        instancesToMatchCount: instancesToMatch.length.toString(),\n        // Counting all nested routes might be too time-consuming, so we only count the first level\n        topLevelRoutesCount: rootRoute.routes?.length.toString() ?? '0',\n      });\n\n      return result;\n    },\n    []\n  );\n\n  return { getRouteGroupsMap, matchInstancesToRoute };\n}\n"],"names":["Authorize","actions","children","alertmanagerActions","isAlertmanagerAction","alertSourceActions","isAlertingAction","AuthorizeAlertmanager","AuthorizeAlertsource","alertmanagerAbilties","actionsAllowed","alertSourceAbilities","abilities","_supported","allowed","action","Matchers","matchers","formatter","styles","getStyles","NUM_MATCHERS","firstFew","rest","hasMoreMatchers","matcher","MatcherBadge","theme","label","color","borderColor","isDefaultPolicy","route","getRoutesByIdMap","rootRoute","map","addRoutesToMap","path","r","hasEmptyMatchers","NotificationPolicyMatchers","matcherFormatter","PolicyPath","routesByIdMap","routePathIds","routePathObjects","id","pathRoute","index","NotificationRouteDetailsModal","onClose","receiver","alertManagerSourceName","isDefault","Modal","Icon","Button","units","highlight","NotificationRouteHeader","instancesCount","expandRoute","onExpandRouteClick","showDetails","setShowDetails","onClickDetails","CollapseToggle","isCollapsed","Stack","Spacer","MetaText","NotificationRoute","instanceMatches","setExpandRoute","useToggle","GREY_COLOR_INDEX","instanceMatch","matchArray","matchResult","matchingLabels","mr","nonMatchingLabels","TagList","_","useAlertmanagerNotificationRoutingPreview","potentialInstances","currentData","configLoading","configError","useAlertmanagerConfig","config","matchInstancesToRoute","useRouteGroupsMatcher","receivers","receiversByName","matchingMap","matchingLoading","matchingError","useAsync","NotificationPreviewByAlertManager","alertManagerSource","onlyOneAM","loading","error","Alert","LoadingPlaceholder","routeId","amSourceName","options","fetchConfig","createWorker","routeMatcher","loadWorker","worker","comlink","e","validateWorker","disposeWorker","getRouteGroupsMap","alertGroups","startTime","result","timeSpent","instancesToMatch"],"sourceRoot":""}