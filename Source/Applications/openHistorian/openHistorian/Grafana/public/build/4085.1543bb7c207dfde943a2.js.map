{"version":3,"file":"4085.1543bb7c207dfde943a2.js","mappings":"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","sources":["webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/CollapsibleSection.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/KeyValueMapInput.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/StringArrayInput.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/styles.ts","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/SubformArrayField.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/SubformField.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/TemplateContentAndPreview.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/TemplateSelector.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/OptionField.tsx","webpack://grafana/./public/app/features/alerting/unified/hooks/useControlledFieldArray.ts","webpack://grafana/./public/app/features/alerting/unified/utils/receiver-form.ts"],"sourcesContent":["import { css, cx } from '@emotion/css';\nimport { useState } from 'react';\nimport * as React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { IconSize, useStyles2 } from '@grafana/ui';\n\nimport { CollapseToggle } from '../../CollapseToggle';\n\ninterface Props {\n  label: string;\n  description?: string;\n  className?: string;\n  size?: IconSize;\n}\n\nexport const CollapsibleSection = ({\n  label,\n  description,\n  children,\n  className,\n  size = 'xl',\n}: React.PropsWithChildren<Props>) => {\n  const styles = useStyles2(getStyles);\n  const [isCollapsed, setIsCollapsed] = useState(true);\n\n  const toggleCollapse = () => setIsCollapsed(!isCollapsed);\n\n  return (\n    <div className={cx(styles.wrapper, className)}>\n      <CollapseToggle\n        className={styles.toggle}\n        size={size}\n        onToggle={toggleCollapse}\n        isCollapsed={isCollapsed}\n        text={label}\n      />\n      {description && <p className={styles.description}>{description}</p>}\n      <div className={isCollapsed ? styles.hidden : styles.content}>{children}</div>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  wrapper: css({\n    marginTop: theme.spacing(1),\n    paddingBottom: theme.spacing(1),\n  }),\n  toggle: css({\n    margin: theme.spacing(1, 0),\n    padding: 0,\n  }),\n  hidden: css({\n    display: 'none',\n  }),\n  description: css({\n    color: theme.colors.text.secondary,\n    fontSize: theme.typography.size.sm,\n    fontWeight: theme.typography.fontWeightRegular,\n    margin: 0,\n  }),\n  content: css({\n    paddingLeft: theme.spacing(3),\n  }),\n});\n","import { css } from '@emotion/css';\nimport { useEffect, useState } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, Input, useStyles2 } from '@grafana/ui';\n\nimport { ActionIcon } from '../../../rules/ActionIcon';\n\ninterface Props {\n  value?: Record<string, string>;\n  readOnly?: boolean;\n  onChange: (value: Record<string, string>) => void;\n}\n\nexport const KeyValueMapInput = ({ value, onChange, readOnly = false }: Props) => {\n  const styles = useStyles2(getStyles);\n  const [pairs, setPairs] = useState(recordToPairs(value));\n  useEffect(() => setPairs(recordToPairs(value)), [value]);\n\n  const emitChange = (pairs: Array<[string, string]>) => {\n    onChange(pairsToRecord(pairs));\n  };\n\n  const deleteItem = (index: number) => {\n    const newPairs = pairs.slice();\n    const removed = newPairs.splice(index, 1)[0];\n    setPairs(newPairs);\n    if (removed[0]) {\n      emitChange(newPairs);\n    }\n  };\n\n  const updatePair = (values: [string, string], index: number) => {\n    const old = pairs[index];\n    const newPairs = pairs.map((pair, i) => (i === index ? values : pair));\n    setPairs(newPairs);\n    if (values[0] || old[0]) {\n      emitChange(newPairs);\n    }\n  };\n\n  return (\n    <div>\n      {!!pairs.length && (\n        <table className={styles.table}>\n          <thead>\n            <tr>\n              <th>Name</th>\n              <th>Value</th>\n              {!readOnly && <th></th>}\n            </tr>\n          </thead>\n          <tbody>\n            {pairs.map(([key, value], index) => (\n              <tr key={index}>\n                <td>\n                  <Input\n                    readOnly={readOnly}\n                    value={key}\n                    onChange={(e) => updatePair([e.currentTarget.value, value], index)}\n                  />\n                </td>\n                <td>\n                  <Input\n                    readOnly={readOnly}\n                    value={value}\n                    onChange={(e) => updatePair([key, e.currentTarget.value], index)}\n                  />\n                </td>\n                {!readOnly && (\n                  <td>\n                    <ActionIcon icon=\"trash-alt\" tooltip=\"delete\" onClick={() => deleteItem(index)} />\n                  </td>\n                )}\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      )}\n      {!readOnly && (\n        <Button\n          className={styles.addButton}\n          type=\"button\"\n          variant=\"secondary\"\n          icon=\"plus\"\n          size=\"sm\"\n          onClick={() => setPairs([...pairs, ['', '']])}\n        >\n          Add\n        </Button>\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  addButton: css({\n    marginTop: theme.spacing(1),\n  }),\n  table: css({\n    'tbody td': {\n      padding: `0 ${theme.spacing(1)} ${theme.spacing(1)} 0`,\n    },\n  }),\n});\n\nconst pairsToRecord = (pairs: Array<[string, string]>): Record<string, string> => {\n  const record: Record<string, string> = {};\n  for (const [key, value] of pairs) {\n    if (key) {\n      record[key] = value;\n    }\n  }\n  return record;\n};\n\nconst recordToPairs = (obj?: Record<string, string>): Array<[string, string]> => Object.entries(obj ?? {});\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, Input, useStyles2 } from '@grafana/ui';\n\nimport { ActionIcon } from '../../../rules/ActionIcon';\n\ninterface Props {\n  value?: string[];\n  readOnly?: boolean;\n  onChange: (value: string[]) => void;\n}\n\nexport const StringArrayInput = ({ value, onChange, readOnly = false }: Props) => {\n  const styles = useStyles2(getStyles);\n\n  const deleteItem = (index: number) => {\n    if (!value) {\n      return;\n    }\n    const newValue = value.slice();\n    newValue.splice(index, 1);\n    onChange(newValue);\n  };\n\n  const updateValue = (itemValue: string, index: number) => {\n    if (!value) {\n      return;\n    }\n    onChange(value.map((v, i) => (i === index ? itemValue : v)));\n  };\n\n  return (\n    <div>\n      {!!value?.length &&\n        value.map((v, index) => (\n          <div key={index} className={styles.row}>\n            <Input readOnly={readOnly} value={v} onChange={(e) => updateValue(e.currentTarget.value, index)} />\n            {!readOnly && (\n              <ActionIcon\n                className={styles.deleteIcon}\n                icon=\"trash-alt\"\n                tooltip=\"delete\"\n                onClick={() => deleteItem(index)}\n              />\n            )}\n          </div>\n        ))}\n      {!readOnly && (\n        <Button\n          className={styles.addButton}\n          type=\"button\"\n          variant=\"secondary\"\n          icon=\"plus\"\n          size=\"sm\"\n          onClick={() => onChange([...(value ?? []), ''])}\n        >\n          Add\n        </Button>\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  row: css({\n    display: 'flex',\n    flexDirection: 'row',\n    marginBottom: theme.spacing(1),\n    alignItems: 'center',\n  }),\n  deleteIcon: css({\n    marginLeft: theme.spacing(1),\n  }),\n  addButton: css({\n    marginTop: theme.spacing(1),\n  }),\n});\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\n\nexport const getReceiverFormFieldStyles = (theme: GrafanaTheme2) => ({\n  collapsibleSection: css({\n    margin: 0,\n    padding: 0,\n  }),\n  wrapper: css({\n    margin: theme.spacing(2, 0),\n    padding: theme.spacing(1),\n    border: `solid 1px ${theme.colors.border.medium}`,\n    borderRadius: theme.shape.radius.default,\n    position: 'relative',\n  }),\n  description: css({\n    color: theme.colors.text.secondary,\n    fontSize: theme.typography.size.sm,\n    fontWeight: theme.typography.fontWeightRegular,\n    margin: 0,\n  }),\n  deleteIcon: css({\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n  }),\n  addButton: css({\n    marginTop: theme.spacing(1),\n  }),\n});\n","import { FieldError, DeepMap, useFormContext } from 'react-hook-form';\n\nimport { Button, useStyles2 } from '@grafana/ui';\nimport { useControlledFieldArray } from 'app/features/alerting/unified/hooks/useControlledFieldArray';\nimport { NotificationChannelOption } from 'app/types';\n\nimport { ActionIcon } from '../../../rules/ActionIcon';\nimport { CollapsibleSection } from '../CollapsibleSection';\n\nimport { OptionField } from './OptionField';\nimport { getReceiverFormFieldStyles } from './styles';\n\ninterface Props {\n  defaultValues?: any[];\n  option: NotificationChannelOption;\n  pathPrefix: string;\n  errors?: Array<DeepMap<any, FieldError>>;\n  readOnly?: boolean;\n}\n\nexport const SubformArrayField = ({ option, pathPrefix, errors, defaultValues, readOnly = false }: Props) => {\n  const styles = useStyles2(getReceiverFormFieldStyles);\n  const path = `${pathPrefix}${option.propertyName}`;\n  const formAPI = useFormContext();\n  const { fields, append, remove } = useControlledFieldArray({ name: path, formAPI, defaults: defaultValues });\n\n  return (\n    <div className={styles.wrapper}>\n      <CollapsibleSection\n        className={styles.collapsibleSection}\n        label={`${option.label} (${fields.length})`}\n        description={option.description}\n      >\n        {(fields ?? defaultValues ?? []).map((field, itemIndex) => {\n          return (\n            <div key={itemIndex} className={styles.wrapper}>\n              {!readOnly && (\n                <ActionIcon\n                  data-testid={`${path}.${itemIndex}.delete-button`}\n                  icon=\"trash-alt\"\n                  tooltip=\"delete\"\n                  onClick={() => remove(itemIndex)}\n                  className={styles.deleteIcon}\n                />\n              )}\n              {option.subformOptions?.map((option) => (\n                <OptionField\n                  readOnly={readOnly}\n                  defaultValue={field?.[option.propertyName]}\n                  key={option.propertyName}\n                  option={option}\n                  pathPrefix={`${path}.${itemIndex}.`}\n                  error={errors?.[itemIndex]?.[option.propertyName]}\n                />\n              ))}\n            </div>\n          );\n        })}\n        {!readOnly && (\n          <Button\n            data-testid={`${path}.add-button`}\n            className={styles.addButton}\n            type=\"button\"\n            variant=\"secondary\"\n            icon=\"plus\"\n            size=\"sm\"\n            onClick={() => append({ __id: String(Math.random()) })}\n          >\n            Add\n          </Button>\n        )}\n      </CollapsibleSection>\n    </div>\n  );\n};\n","import { useState } from 'react';\nimport { FieldError, DeepMap, useFormContext } from 'react-hook-form';\n\nimport { Button, useStyles2 } from '@grafana/ui';\nimport { NotificationChannelOption, NotificationChannelSecureFields } from 'app/types';\n\nimport { ActionIcon } from '../../../rules/ActionIcon';\n\nimport { OptionField } from './OptionField';\nimport { getReceiverFormFieldStyles } from './styles';\n\ninterface Props {\n  defaultValue: any;\n  option: NotificationChannelOption;\n  pathPrefix: string;\n  errors?: DeepMap<any, FieldError>;\n  readOnly?: boolean;\n  secureFields?: NotificationChannelSecureFields;\n  onResetSecureField?: (propertyName: string) => void;\n}\n\nexport const SubformField = ({\n  option,\n  pathPrefix,\n  errors,\n  defaultValue,\n  readOnly = false,\n  secureFields = {},\n  onResetSecureField,\n}: Props) => {\n  const styles = useStyles2(getReceiverFormFieldStyles);\n  const name = `${pathPrefix}${option.propertyName}`;\n  const { watch } = useFormContext();\n  const _watchValue = watch(name);\n  const value = _watchValue === undefined ? defaultValue : _watchValue;\n\n  const [show, setShow] = useState(!!value);\n\n  return (\n    <div className={styles.wrapper} data-testid={`${name}.container`}>\n      <h6>{option.label}</h6>\n      {option.description && <p className={styles.description}>{option.description}</p>}\n      {show && (\n        <>\n          {!readOnly && (\n            <ActionIcon\n              data-testid={`${name}.delete-button`}\n              icon=\"trash-alt\"\n              tooltip=\"delete\"\n              onClick={() => setShow(false)}\n              className={styles.deleteIcon}\n            />\n          )}\n          {(option.subformOptions ?? []).map((subOption) => {\n            return (\n              <OptionField\n                readOnly={readOnly}\n                secureFields={secureFields}\n                onResetSecureField={onResetSecureField}\n                defaultValue={defaultValue?.[subOption.propertyName]}\n                parentOption={option}\n                key={subOption.propertyName}\n                option={subOption}\n                pathPrefix={`${name}.`}\n                error={errors?.[subOption.propertyName]}\n              />\n            );\n          })}\n        </>\n      )}\n      {!show && !readOnly && (\n        <Button\n          className={styles.addButton}\n          type=\"button\"\n          variant=\"secondary\"\n          icon=\"plus\"\n          size=\"sm\"\n          onClick={() => setShow(true)}\n          data-testid={`${name}.add-button`}\n        >\n          Add\n        </Button>\n      )}\n    </div>\n  );\n};\n","import { css, cx } from '@emotion/css';\nimport * as React from 'react';\nimport AutoSizer from 'react-virtualized-auto-sizer';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Box, useStyles2 } from '@grafana/ui';\nimport { useAlertmanager } from 'app/features/alerting/unified/state/AlertmanagerContext';\nimport { GRAFANA_RULES_SOURCE_NAME } from 'app/features/alerting/unified/utils/datasource';\n\nimport { EditorColumnHeader } from '../../../contact-points/templates/EditorColumnHeader';\nimport { TemplateEditor } from '../../TemplateEditor';\nimport { getPreviewResults } from '../../TemplatePreview';\nimport { usePreviewTemplate } from '../../usePreviewTemplate';\n\nexport function TemplateContentAndPreview({\n  payload,\n  templateContent,\n  templateName,\n  payloadFormatError,\n  setPayloadFormatError,\n  className,\n}: {\n  payload: string;\n  templateName: string;\n  payloadFormatError: string | null;\n  setPayloadFormatError: (value: React.SetStateAction<string | null>) => void;\n  className?: string;\n  templateContent: string;\n}) {\n  const styles = useStyles2(getStyles);\n\n  const { selectedAlertmanager } = useAlertmanager();\n  const isGrafanaAlertManager = selectedAlertmanager === GRAFANA_RULES_SOURCE_NAME;\n\n  const { data, error } = usePreviewTemplate(templateContent, templateName, payload, setPayloadFormatError);\n  const previewToRender = getPreviewResults(error, payloadFormatError, data);\n\n  return (\n    <div className={cx(className, styles.mainContainer)}>\n      <div className={styles.container}>\n        <EditorColumnHeader label=\"Template content\" />\n        <Box flex={1}>\n          <div className={styles.viewerContainer({ height: 400 })}>\n            <AutoSizer>\n              {({ width, height }) => (\n                <TemplateEditor\n                  value={templateContent}\n                  containerStyles={styles.editorContainer}\n                  width={width}\n                  height={height}\n                  readOnly\n                />\n              )}\n            </AutoSizer>\n          </div>\n        </Box>\n      </div>\n\n      {isGrafanaAlertManager && (\n        <div className={styles.container}>\n          <EditorColumnHeader label=\"Preview with the default payload\" />\n          <Box flex={1}>\n            <div className={styles.viewerContainer({ height: 'minHeight' })}>{previewToRender}</div>\n          </Box>\n        </div>\n      )}\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  mainContainer: css({\n    display: 'flex',\n    flexDirection: 'column',\n    gap: theme.spacing(2),\n  }),\n  container: css({\n    label: 'template-preview-container',\n    display: 'flex',\n    flexDirection: 'column',\n    borderRadius: theme.shape.radius.default,\n    border: `1px solid ${theme.colors.border.medium}`,\n  }),\n  viewerContainer: ({ height }: { height: number | string }) =>\n    css({\n      height,\n      overflow: 'auto',\n      backgroundColor: theme.colors.background.primary,\n    }),\n  editorContainer: css({\n    width: 'fit-content',\n    border: 'none',\n  }),\n});\n","import { css, cx } from '@emotion/css';\nimport { PropsWithChildren, useEffect, useMemo, useState } from 'react';\nimport { useFormContext } from 'react-hook-form';\nimport { useCopyToClipboard } from 'react-use';\n\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport {\n  Button,\n  Drawer,\n  IconButton,\n  Input,\n  RadioButtonGroup,\n  Select,\n  Stack,\n  Text,\n  TextArea,\n  useStyles2,\n} from '@grafana/ui';\nimport {\n  trackEditInputWithTemplate,\n  trackUseCustomInputInTemplate,\n  trackUseSingleTemplateInInput,\n} from 'app/features/alerting/unified/Analytics';\nimport { templatesApi } from 'app/features/alerting/unified/api/templateApi';\nimport {\n  NotificationTemplate,\n  useNotificationTemplates,\n} from 'app/features/alerting/unified/components/contact-points/useNotificationTemplates';\nimport { useAlertmanager } from 'app/features/alerting/unified/state/AlertmanagerContext';\nimport { NotificationChannelOption } from 'app/types';\n\nimport { defaultPayloadString } from '../../TemplateForm';\n\nimport { TemplateContentAndPreview } from './TemplateContentAndPreview';\nimport { getTemplateName, getUseTemplateText, matchesOnlyOneTemplate, parseTemplates } from './utils';\n\ninterface TemplatesPickerProps {\n  onSelect: (temnplate: string) => void;\n  option: NotificationChannelOption;\n  valueInForm: string;\n}\nexport function TemplatesPicker({ onSelect, option, valueInForm }: TemplatesPickerProps) {\n  const [showTemplates, setShowTemplates] = useState(false);\n  const onClick = () => {\n    setShowTemplates(true);\n    trackEditInputWithTemplate();\n  };\n  return (\n    <>\n      <Button\n        icon=\"edit\"\n        tooltip={'Edit using existing templates.'}\n        onClick={onClick}\n        variant=\"secondary\"\n        size=\"sm\"\n        aria-label={'Select available template from the list of available templates.'}\n      >\n        {`Edit ${option.label}`}\n      </Button>\n\n      {showTemplates && (\n        <Drawer title={`Edit ${option.label}`} size=\"md\" onClose={() => setShowTemplates(false)}>\n          <TemplateSelector\n            onSelect={onSelect}\n            onClose={() => setShowTemplates(false)}\n            option={option}\n            valueInForm={valueInForm}\n          />\n        </Drawer>\n      )}\n    </>\n  );\n}\n\ntype TemplateFieldOption = 'Existing' | 'Custom';\n\nexport function getTemplateOptions(templateFiles: NotificationTemplate[], defaultTemplates: Template[] = []) {\n  // Add default templates\n  const templateMap = new Map<string, SelectableValue<Template>>();\n  templateFiles.forEach(({ content }) => {\n    const templates: Template[] = parseTemplates(content);\n    templates.forEach((template) => {\n      templateMap.set(template.name, {\n        label: template.name,\n        value: {\n          name: template.name,\n          content: template.content,\n        },\n      });\n    });\n  });\n  // Add default templates to the map\n  defaultTemplates.forEach((template) => {\n    templateMap.set(template.name, {\n      label: template.name,\n      value: {\n        name: template.name,\n        content: template.content,\n      },\n    });\n  });\n  // return the sum of default and custom templates\n  return Array.from(templateMap.values());\n}\nfunction getContentFromOptions(name: string, options: Array<SelectableValue<Template>>) {\n  const template = options.find((option) => option.label === name);\n  return template?.value?.content ?? '';\n}\n\nexport interface Template {\n  name: string;\n  content: string;\n}\ninterface TemplateSelectorProps {\n  onSelect: (template: string) => void;\n  onClose: () => void;\n  option: NotificationChannelOption;\n  valueInForm: string;\n}\nfunction TemplateSelector({ onSelect, onClose, option, valueInForm }: TemplateSelectorProps) {\n  const styles = useStyles2(getStyles);\n  const useGetDefaultTemplatesQuery = templatesApi.endpoints.getDefaultTemplates.useQuery;\n  const [template, setTemplate] = useState<Template | undefined>(undefined);\n  const [inputToUpdate, setInputToUpdate] = useState<string>('');\n  const [inputToUpdateCustom, setInputToUpdateCustom] = useState<string>(valueInForm);\n\n  const { selectedAlertmanager } = useAlertmanager();\n  const { data = [], error, isLoading } = useNotificationTemplates({ alertmanager: selectedAlertmanager! });\n  const { data: defaultTemplates } = useGetDefaultTemplatesQuery();\n  const [templateOption, setTemplateOption] = useState<TemplateFieldOption>('Existing');\n  const [_, copyToClipboard] = useCopyToClipboard();\n\n  const templateOptions: Array<SelectableValue<TemplateFieldOption>> = [\n    {\n      label: 'Select existing template',\n      value: 'Existing',\n      description: `Select a single template and preview it, or copy it to paste it in the custom tab. ${templateOption === 'Existing' ? 'Clicking Save will save your changes to the selected template.' : ''}`,\n    },\n    {\n      label: `Enter custom ${option.label.toLowerCase()}`,\n      value: 'Custom',\n      description: `Enter custom ${option.label.toLowerCase()}. ${templateOption === 'Custom' ? 'Clicking Save will save the custom value only.' : ''}`,\n    },\n  ];\n\n  useEffect(() => {\n    if (template) {\n      setInputToUpdate(getUseTemplateText(template.name));\n    }\n  }, [template]);\n\n  function onCustomTemplateChange(customInput: string) {\n    setInputToUpdateCustom(customInput);\n  }\n\n  const onTemplateOptionChange = (option: TemplateFieldOption) => {\n    setTemplateOption(option);\n  };\n\n  const options = useMemo(() => {\n    if (!defaultTemplates || !data || isLoading || error) {\n      return [];\n    }\n    return getTemplateOptions(data, defaultTemplates);\n  }, [data, defaultTemplates, isLoading, error]);\n\n  // if we are using only one template, we should settemplate to that template\n  useEffect(() => {\n    if (Boolean(valueInForm)) {\n      if (matchesOnlyOneTemplate(valueInForm)) {\n        const name = getTemplateName(valueInForm);\n        setTemplate({\n          name,\n          content: getContentFromOptions(name, options),\n        });\n      } else {\n        // if it's empty we default to select existing template\n        setTemplateOption('Custom');\n      }\n    }\n  }, [valueInForm, setTemplate, setTemplateOption, options]);\n\n  if (error) {\n    return <div>Error loading templates</div>;\n  }\n\n  if (isLoading || !data || !defaultTemplates) {\n    return <div>Loading...</div>;\n  }\n\n  return (\n    <Stack direction=\"column\" gap={1} justifyContent=\"space-between\" height=\"100%\">\n      <Stack direction=\"column\" gap={1}>\n        <RadioButtonGroup\n          options={templateOptions}\n          value={templateOption}\n          onChange={onTemplateOptionChange}\n          className={styles.templateTabOption}\n        />\n\n        {templateOption === 'Existing' ? (\n          <Stack direction=\"column\" gap={1}>\n            <Stack direction=\"row\" gap={1} alignItems=\"center\">\n              <Select<Template>\n                placeholder=\"Choose template\"\n                aria-label=\"Choose template\"\n                onChange={(value: SelectableValue<Template>, _) => {\n                  setTemplate(value?.value);\n                }}\n                options={options}\n                width={50}\n                value={template ? { label: template.name, value: template } : undefined}\n              />\n              <IconButton\n                tooltip=\"Copy selected template to clipboard. You can use it in the custom tab.\"\n                onClick={() => copyToClipboard(getUseTemplateText(template?.name ?? ''))}\n                name=\"copy\"\n              />\n            </Stack>\n\n            <TemplateContentAndPreview\n              templateContent={template?.content ?? ''}\n              payload={defaultPayloadString}\n              templateName={template?.name ?? ''}\n              setPayloadFormatError={() => {}}\n              className={cx(styles.templatePreview, styles.minEditorSize)}\n              payloadFormatError={null}\n            />\n          </Stack>\n        ) : (\n          <OptionCustomfield\n            option={option}\n            onCustomTemplateChange={onCustomTemplateChange}\n            initialValue={inputToUpdateCustom}\n          />\n        )}\n      </Stack>\n      <div className={styles.actions}>\n        <Button variant=\"secondary\" onClick={onClose}>\n          Cancel\n        </Button>\n        <Button\n          variant=\"primary\"\n          onClick={() => {\n            onSelect(templateOption === 'Custom' ? inputToUpdateCustom : inputToUpdate);\n            onClose();\n            if (templateOption === 'Custom') {\n              trackUseCustomInputInTemplate();\n            } else {\n              trackUseSingleTemplateInInput();\n            }\n          }}\n        >\n          Save\n        </Button>\n      </div>\n    </Stack>\n  );\n}\n\nfunction OptionCustomfield({\n  option,\n  onCustomTemplateChange,\n  initialValue,\n}: {\n  option: NotificationChannelOption;\n  onCustomTemplateChange(customInput: string): void;\n  initialValue: string;\n}) {\n  switch (option.element) {\n    case 'textarea':\n      return (\n        <Stack direction=\"row\" gap={1} alignItems=\"center\">\n          <TextArea\n            placeholder={option.placeholder}\n            onChange={(e) => onCustomTemplateChange(e.currentTarget.value)}\n            defaultValue={initialValue}\n          />\n        </Stack>\n      );\n    case 'input':\n      return (\n        <Stack direction=\"row\" gap={1} alignItems=\"center\">\n          <Input\n            type={option.inputType}\n            placeholder={option.placeholder}\n            onChange={(e) => onCustomTemplateChange(e.currentTarget.value)}\n            defaultValue={initialValue}\n          />\n        </Stack>\n      );\n    default:\n      return null;\n  }\n}\n\ninterface WrapWithTemplateSelectionProps extends PropsWithChildren {\n  useTemplates: boolean;\n  onSelectTemplate: (template: string) => void;\n  option: NotificationChannelOption;\n  name: string;\n}\nexport function WrapWithTemplateSelection({\n  useTemplates,\n  onSelectTemplate,\n  option,\n  name,\n  children,\n}: WrapWithTemplateSelectionProps) {\n  const styles = useStyles2(getStyles);\n  const { getValues } = useFormContext();\n  const value = getValues(name) ?? '';\n  // if the placeholder does not contain a template, we don't need to show the template picker\n  if (!option.placeholder.includes('{{ template ') || typeof value !== 'string') {\n    return <>{children}</>;\n  }\n  // Otherwise, we can use templates on this field\n  // if the value is empty, we only show the template picker\n  if (!value) {\n    return (\n      <div className={styles.inputContainer}>\n        <Stack direction=\"row\" gap={1} alignItems=\"center\">\n          {useTemplates && (\n            <TemplatesPicker onSelect={onSelectTemplate} option={option} valueInForm={getValues(name) ?? ''} />\n          )}\n        </Stack>\n      </div>\n    );\n  }\n  const onlyOneTemplate = value ? matchesOnlyOneTemplate(value) : false;\n  if (onlyOneTemplate) {\n    return (\n      <div className={styles.inputContainer}>\n        <Stack direction=\"row\" gap={1} alignItems=\"center\">\n          <Text variant=\"bodySmall\">{`Template: ${getTemplateName(value)}`}</Text>\n          {useTemplates && (\n            <TemplatesPicker onSelect={onSelectTemplate} option={option} valueInForm={getValues(name) ?? ''} />\n          )}\n        </Stack>\n      </div>\n    );\n  }\n  // custom template  field\n  return (\n    <div className={styles.inputContainer}>\n      <Stack direction=\"row\" gap={1} alignItems=\"center\">\n        {children}\n        {useTemplates && (\n          <TemplatesPicker onSelect={onSelectTemplate} option={option} valueInForm={getValues(name) ?? ''} />\n        )}\n      </Stack>\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  actions: css({\n    flex: 0,\n    justifyContent: 'flex-end',\n    display: 'flex',\n    gap: theme.spacing(1),\n  }),\n  templatePreview: css({\n    flex: 1,\n    display: 'flex',\n  }),\n  templateTabOption: css({\n    width: 'fit-content',\n  }),\n  minEditorSize: css({\n    minHeight: 300,\n    minWidth: 300,\n  }),\n  inputContainer: css({\n    marginTop: theme.spacing(1.5),\n  }),\n});\n","import { css } from '@emotion/css';\nimport { isEmpty } from 'lodash';\nimport { FC, useEffect } from 'react';\nimport { Controller, DeepMap, FieldError, useFormContext } from 'react-hook-form';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport {\n  Checkbox,\n  Field,\n  Input,\n  RadioButtonList,\n  SecretInput,\n  SecretTextArea,\n  Select,\n  TextArea,\n  useStyles2,\n} from '@grafana/ui';\nimport { NotificationChannelOption, NotificationChannelSecureFields } from 'app/types';\n\nimport { KeyValueMapInput } from './KeyValueMapInput';\nimport { StringArrayInput } from './StringArrayInput';\nimport { SubformArrayField } from './SubformArrayField';\nimport { SubformField } from './SubformField';\nimport { WrapWithTemplateSelection } from './TemplateSelector';\n\ninterface Props {\n  defaultValue: any;\n  option: NotificationChannelOption;\n  // this is defined if the option is rendered inside a subform\n  parentOption?: NotificationChannelOption;\n  invalid?: boolean;\n  pathPrefix: string;\n  pathSuffix?: string;\n  error?: FieldError | DeepMap<any, FieldError>;\n  readOnly?: boolean;\n  customValidator?: (value: string) => boolean | string | Promise<boolean | string>;\n  onResetSecureField?: (propertyName: string) => void;\n  secureFields?: NotificationChannelSecureFields;\n}\n\nexport const OptionField: FC<Props> = ({\n  option,\n  parentOption,\n  invalid,\n  pathPrefix,\n  pathSuffix = '',\n  error,\n  defaultValue,\n  readOnly = false,\n  customValidator,\n  onResetSecureField,\n  secureFields = {},\n}) => {\n  const optionPath = `${pathPrefix}${pathSuffix}`;\n\n  if (option.element === 'subform') {\n    return (\n      <SubformField\n        secureFields={secureFields}\n        onResetSecureField={onResetSecureField}\n        readOnly={readOnly}\n        defaultValue={defaultValue}\n        option={option}\n        errors={error}\n        pathPrefix={optionPath}\n      />\n    );\n  }\n  if (option.element === 'subform_array') {\n    return (\n      <SubformArrayField\n        readOnly={readOnly}\n        defaultValues={defaultValue}\n        option={option}\n        pathPrefix={optionPath}\n        errors={error as Array<DeepMap<any, FieldError>> | undefined}\n      />\n    );\n  }\n  return (\n    <Field\n      label={option.element !== 'checkbox' && option.element !== 'radio' ? option.label : undefined}\n      description={option.description || undefined}\n      invalid={!!error}\n      error={error?.message}\n      data-testid={`${optionPath}${option.propertyName}`}\n    >\n      <OptionInput\n        id={`${optionPath}${option.propertyName}`}\n        defaultValue={defaultValue}\n        option={option}\n        invalid={invalid}\n        pathPrefix={optionPath}\n        readOnly={readOnly}\n        pathIndex={pathPrefix}\n        parentOption={parentOption}\n        customValidator={customValidator}\n        onResetSecureField={onResetSecureField}\n        secureFields={secureFields}\n      />\n    </Field>\n  );\n};\n\nconst OptionInput: FC<Props & { id: string; pathIndex?: string }> = ({\n  option,\n  invalid,\n  id,\n  pathPrefix = '',\n  pathIndex = '',\n  readOnly = false,\n  customValidator,\n  onResetSecureField,\n  secureFields = {},\n  parentOption,\n}) => {\n  const styles = useStyles2(getStyles);\n  const { control, register, unregister, getValues, setValue } = useFormContext();\n\n  const name = `${pathPrefix}${option.propertyName}`;\n  const nestedKey = parentOption ? `${parentOption.propertyName}.${option.propertyName}` : option.propertyName;\n\n  const isEncryptedInput = secureFields?.[nestedKey];\n\n  // workaround for https://github.com/react-hook-form/react-hook-form/issues/4993#issuecomment-829012506\n  useEffect(\n    () => () => {\n      unregister(name, { keepValue: false });\n    },\n    [unregister, name]\n  );\n\n  const useTemplates = option.placeholder.includes('{{ template');\n\n  function onSelectTemplate(template: string) {\n    setValue(name, template);\n  }\n\n  switch (option.element) {\n    case 'checkbox':\n      return (\n        <Checkbox\n          id={id}\n          readOnly={readOnly}\n          disabled={readOnly}\n          className={styles.checkbox}\n          {...register(name)}\n          label={option.label}\n          description={option.description}\n        />\n      );\n    case 'input':\n      return (\n        <WrapWithTemplateSelection\n          useTemplates={useTemplates}\n          option={option}\n          name={name}\n          onSelectTemplate={onSelectTemplate}\n        >\n          {isEncryptedInput ? (\n            <SecretInput onReset={() => onResetSecureField?.(nestedKey)} isConfigured />\n          ) : (\n            <Input\n              id={id}\n              readOnly={readOnly || useTemplates || determineReadOnly(option, getValues, pathIndex)}\n              invalid={invalid}\n              type={option.inputType}\n              {...register(name, {\n                required: determineRequired(option, getValues, pathIndex),\n                validate: {\n                  validationRule: (v) =>\n                    option.validationRule ? validateOption(v, option.validationRule, option.required) : true,\n                  customValidator: (v) => (customValidator ? customValidator(v) : true),\n                },\n                setValueAs: option.setValueAs,\n              })}\n              placeholder={option.placeholder}\n            />\n          )}\n        </WrapWithTemplateSelection>\n      );\n\n    case 'select':\n      return (\n        <Controller\n          render={({ field: { onChange, ref, ...field } }) => (\n            <Select\n              disabled={readOnly}\n              options={option.selectOptions ?? undefined}\n              invalid={invalid}\n              onChange={(value) => onChange(value.value)}\n              {...field}\n            />\n          )}\n          control={control}\n          name={name}\n          defaultValue={option.defaultValue?.value}\n          rules={{\n            validate: {\n              customValidator: (v) => (customValidator ? customValidator(v) : true),\n            },\n          }}\n        />\n      );\n    case 'radio':\n      return (\n        <>\n          <legend className={styles.legend}>{option.label}</legend>\n          <Controller\n            render={({ field: { ref, ...field } }) => (\n              <RadioButtonList disabled={readOnly} options={option.selectOptions ?? []} {...field} />\n            )}\n            control={control}\n            defaultValue={option.defaultValue?.value}\n            name={name}\n            rules={{\n              required: option.required ? 'Option is required' : false,\n              validate: {\n                validationRule: (v) =>\n                  option.validationRule ? validateOption(v, option.validationRule, option.required) : true,\n                customValidator: (v) => (customValidator ? customValidator(v) : true),\n              },\n            }}\n          />\n        </>\n      );\n    case 'textarea':\n      return (\n        <WrapWithTemplateSelection\n          useTemplates={useTemplates}\n          option={option}\n          name={name}\n          onSelectTemplate={onSelectTemplate}\n        >\n          {isEncryptedInput ? (\n            <SecretTextArea onReset={() => onResetSecureField?.(nestedKey)} isConfigured />\n          ) : (\n            <TextArea\n              id={id}\n              readOnly={readOnly || useTemplates}\n              invalid={invalid}\n              placeholder={option.placeholder}\n              {...register(name, {\n                required: option.required ? 'Required' : false,\n                validate: (v) =>\n                  option.validationRule !== '' ? validateOption(v, option.validationRule, option.required) : true,\n              })}\n            />\n          )}\n        </WrapWithTemplateSelection>\n      );\n    case 'string_array':\n      return (\n        <Controller\n          render={({ field: { value, onChange } }) => (\n            <StringArrayInput readOnly={readOnly} value={value} onChange={onChange} />\n          )}\n          control={control}\n          name={name}\n        />\n      );\n    case 'key_value_map':\n      return (\n        <Controller\n          render={({ field: { value, onChange } }) => (\n            <KeyValueMapInput readOnly={readOnly} value={value} onChange={onChange} />\n          )}\n          control={control}\n          name={name}\n        />\n      );\n\n    default:\n      console.error('Element not supported', option.element);\n      return null;\n  }\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  checkbox: css({\n    height: 'auto', // native checkbox has fixed height which does not take into account description\n  }),\n  legend: css({\n    fontSize: theme.typography.h6.fontSize,\n  }),\n});\n\nconst validateOption = (value: string, validationRule: string, required: boolean) => {\n  if (value === '' && !required) {\n    return true;\n  }\n\n  return RegExp(validationRule).test(value) ? true : 'Invalid format';\n};\n\nconst determineRequired = (option: NotificationChannelOption, getValues: any, pathIndex: string) => {\n  const secureFields = getValues(`${pathIndex}secureFields`);\n  const secureSettings = getValues(`${pathIndex}secureSettings`);\n\n  if (!option.dependsOn) {\n    return option.required ? 'Required' : false;\n  }\n  if (isEmpty(secureFields) || !secureFields[option.dependsOn]) {\n    const dependentOn = Boolean(secureSettings[option.dependsOn]);\n    return !dependentOn && option.required ? 'Required' : false;\n  } else {\n    const dependentOn = Boolean(secureFields[option.dependsOn]);\n    return !dependentOn && option.required ? 'Required' : false;\n  }\n};\n\nconst determineReadOnly = (option: NotificationChannelOption, getValues: any, pathIndex: string) => {\n  if (!option.dependsOn) {\n    return false;\n  }\n  if (isEmpty(getValues(`${pathIndex}secureFields`))) {\n    return getValues(`${pathIndex}secureSettings.${option.dependsOn}`);\n  } else {\n    return getValues(`${pathIndex}secureFields.${option.dependsOn}`);\n  }\n};\n","import { set } from 'lodash';\nimport { useCallback } from 'react';\nimport { UseFormReturn } from 'react-hook-form';\n\ninterface Options<R> {\n  name: string;\n  formAPI: UseFormReturn<any>;\n  defaults?: R[];\n\n  // if true, sets `__deleted: true` but does not remove item from the array in values\n  softDelete?: boolean;\n}\n\nexport type ControlledField<R> = R & {\n  __deleted?: boolean;\n};\n\nconst EMPTY_ARRAY = [] as const;\n\n/*\n * react-hook-form's own useFieldArray is uncontrolled and super buggy.\n * this is a simple controlled version. It's dead simple and more robust at the cost of re-rendering the form\n * on every change to the sub forms in the array.\n * Warning: you'll have to take care of your own unique identiifer to use as `key` for the ReactNode array.\n * Using index will cause problems.\n */\nexport function useControlledFieldArray<R>(options: Options<R>) {\n  const { name, formAPI, defaults, softDelete } = options;\n  const { watch, getValues, reset, setValue } = formAPI;\n\n  const fields: Array<ControlledField<R>> = watch(name) ?? defaults ?? EMPTY_ARRAY;\n\n  const update = useCallback(\n    (updateFn: (fields: R[]) => R[]) => {\n      const values = JSON.parse(JSON.stringify(getValues()));\n      const newItems = updateFn(fields ?? []);\n      reset(set(values, name, newItems));\n    },\n    [getValues, name, reset, fields]\n  );\n\n  return {\n    fields,\n    append: useCallback((values: R) => update((fields) => [...fields, values]), [update]),\n    remove: useCallback(\n      (index: number) => {\n        if (softDelete) {\n          setValue(`${name}.${index}.__deleted`, true);\n        } else {\n          update((items) => {\n            const newItems = items.slice();\n            newItems.splice(index, 1);\n            return newItems;\n          });\n        }\n      },\n      [update, name, setValue, softDelete]\n    ),\n  };\n}\n","import { get, has, isArray, isNil, omit, omitBy, reduce } from 'lodash';\n\nimport {\n  AlertmanagerReceiver,\n  GrafanaManagedContactPoint,\n  GrafanaManagedReceiverConfig,\n  Receiver,\n} from 'app/plugins/datasource/alertmanager/types';\nimport { CloudNotifierType, NotificationChannelOption, NotifierDTO, NotifierType } from 'app/types';\n\nimport {\n  CloudChannelConfig,\n  CloudChannelMap,\n  CloudChannelValues,\n  GrafanaChannelMap,\n  GrafanaChannelValues,\n  ReceiverFormValues,\n} from '../types/receiver-form';\n\nexport function grafanaReceiverToFormValues(\n  receiver: GrafanaManagedContactPoint,\n  notifiers: NotifierDTO[]\n): [ReceiverFormValues<GrafanaChannelValues>, GrafanaChannelMap] {\n  const channelMap: GrafanaChannelMap = {};\n  // giving each form receiver item a unique id so we can use it to map back to \"original\" items\n  // as well as to use as `key` prop.\n  // @TODO use uid once backend is fixed to provide it. then we can get rid of the GrafanaChannelMap\n  let idCounter = 1;\n  const values = {\n    name: receiver.name,\n    items:\n      receiver.grafana_managed_receiver_configs?.map((channel) => {\n        const id = String(idCounter++);\n        channelMap[id] = channel;\n        const notifier = notifiers.find(({ type }) => type === channel.type);\n        return grafanaChannelConfigToFormChannelValues(id, channel, notifier);\n      }) ?? [],\n  };\n  return [values, channelMap];\n}\n\nexport function cloudReceiverToFormValues(\n  receiver: Receiver,\n  notifiers: NotifierDTO[]\n): [ReceiverFormValues<CloudChannelValues>, CloudChannelMap] {\n  const channelMap: CloudChannelMap = {};\n  // giving each form receiver item a unique id so we can use it to map back to \"original\" items\n  let idCounter = 1;\n  const items: CloudChannelValues[] = Object.entries(receiver)\n    // filter out only config items that are relevant to cloud\n    .filter(([type]) => type.endsWith('_configs') && type !== 'grafana_managed_receiver_configs')\n    // map property names to cloud notifier types by removing the `_config` suffix\n    .map(([type, configs]): [CloudNotifierType, CloudChannelConfig[]] => [\n      type.replace('_configs', '') as CloudNotifierType,\n      configs,\n    ])\n    // convert channel configs to form values\n    .map(([type, configs]) =>\n      configs.map((config) => {\n        const id = String(idCounter++);\n        channelMap[id] = { type, config };\n        const notifier = notifiers.find((notifier) => notifier.type === type);\n        if (!notifier) {\n          throw new Error(`unknown cloud notifier: ${type}`);\n        }\n        return cloudChannelConfigToFormChannelValues(id, type, config);\n      })\n    )\n    .flat();\n  const values = {\n    name: receiver.name,\n    items,\n  };\n  return [values, channelMap];\n}\n\nexport function formValuesToGrafanaReceiver(\n  values: ReceiverFormValues<GrafanaChannelValues>,\n  channelMap: GrafanaChannelMap,\n  defaultChannelValues: GrafanaChannelValues,\n  notifiers: NotifierDTO[]\n): Receiver {\n  return {\n    name: values.name,\n    grafana_managed_receiver_configs: (values.items ?? []).map((channelValues) => {\n      const existing: GrafanaManagedReceiverConfig | undefined = channelMap[channelValues.__id];\n      const notifier = notifiers.find((notifier) => notifier.type === channelValues.type);\n\n      return formChannelValuesToGrafanaChannelConfig(\n        channelValues,\n        defaultChannelValues,\n        values.name,\n        existing,\n        notifier\n      );\n    }),\n  };\n}\n\nexport function formValuesToCloudReceiver(\n  values: ReceiverFormValues<CloudChannelValues>,\n  defaults: CloudChannelValues\n): Receiver {\n  const recv: AlertmanagerReceiver = {\n    name: values.name,\n  };\n  values.items.forEach(({ __id, type, settings, sendResolved }) => {\n    const channel = omitEmptyValues({\n      ...omitTemporaryIdentifiers(settings),\n      send_resolved: sendResolved ?? defaults.sendResolved,\n    });\n\n    if (!(`${type}_configs` in recv)) {\n      recv[`${type}_configs`] = [channel];\n    } else {\n      recv[`${type}_configs`]?.push(channel);\n    }\n  });\n  return recv;\n}\n\nfunction cloudChannelConfigToFormChannelValues(\n  id: string,\n  type: CloudNotifierType,\n  channel: CloudChannelConfig\n): CloudChannelValues {\n  return {\n    __id: id,\n    type,\n    settings: {\n      ...channel,\n    },\n    secureFields: {},\n    secureSettings: {},\n    sendResolved: channel.send_resolved,\n  };\n}\n\nfunction grafanaChannelConfigToFormChannelValues(\n  id: string,\n  channel: GrafanaManagedReceiverConfig,\n  notifier?: NotifierDTO\n): GrafanaChannelValues {\n  const values: GrafanaChannelValues = {\n    __id: id,\n    type: channel.type as NotifierType,\n    provenance: channel.provenance,\n    secureSettings: {},\n    settings: { ...channel.settings },\n    secureFields: { ...channel.secureFields },\n    disableResolveMessage: channel.disableResolveMessage,\n  };\n\n  notifier?.options.forEach((option) => {\n    if (option.secure && values.settings[option.propertyName]) {\n      values.secureSettings[option.propertyName] = values.settings[option.propertyName];\n      delete values.settings[option.propertyName];\n    }\n  });\n\n  return values;\n}\n\n/**\n * Recursively find all keys that should be marked a secure fields, using JSONpath for nested fields.\n */\nexport function getSecureFieldNames(notifier: NotifierDTO): string[] {\n  // eg. ['foo', 'bar.baz']\n  const secureFieldPaths: string[] = [];\n\n  // we'll pass in the prefix for each iteration so we can track the JSON path\n  function findSecureOptions(options: NotificationChannelOption[], prefix?: string) {\n    for (const option of options) {\n      const key = prefix ? `${prefix}.${option.propertyName}` : option.propertyName;\n\n      // if the field is a subform, recurse\n      if (option.subformOptions) {\n        findSecureOptions(option.subformOptions, key);\n        continue;\n      }\n\n      if (option.secure) {\n        secureFieldPaths.push(key);\n        continue;\n      }\n    }\n  }\n\n  findSecureOptions(notifier.options);\n\n  return secureFieldPaths;\n}\n\nexport function formChannelValuesToGrafanaChannelConfig(\n  values: GrafanaChannelValues,\n  defaults: GrafanaChannelValues,\n  name: string,\n  existing?: GrafanaManagedReceiverConfig,\n  notifier?: NotifierDTO\n): GrafanaManagedReceiverConfig {\n  const channel: GrafanaManagedReceiverConfig = {\n    settings: omitEmptyValues({\n      ...(existing && existing.type === values.type ? (existing.settings ?? {}) : {}),\n      ...(values.settings ?? {}),\n    }),\n    secureSettings: omitEmptyUnlessExisting(values.secureSettings, existing?.secureFields),\n    type: values.type,\n    name,\n    disableResolveMessage:\n      values.disableResolveMessage ?? existing?.disableResolveMessage ?? defaults.disableResolveMessage,\n  };\n\n  // find all secure field definitions\n  const secureFieldNames = notifier ? getSecureFieldNames(notifier) : [];\n\n  // we make sure all fields that are marked as \"secure\" will be moved to \"SecureSettings\" instead of \"settings\"\n  const secureSettings = reduce(\n    secureFieldNames,\n    (acc: Record<string, unknown> = {}, key) => {\n      // the value for secure settings can come from either the \"settings\" (accidental) or \"secureFields\" if editing an existing receiver\n      acc[key] = get(channel.settings, key) ?? get(values.secureFields, key);\n      return acc;\n    },\n    {}\n  );\n\n  channel.secureSettings = {\n    ...secureSettings,\n    ...channel.secureSettings,\n  };\n\n  // remove the secure ones from the regular settings\n  channel.settings = omit(channel.settings, secureFieldNames);\n\n  if (existing) {\n    channel.uid = existing.uid;\n  }\n\n  return channel;\n}\n\n// null, undefined and '' are deemed unacceptable\nconst isUnacceptableValue = (value: unknown) => isNil(value) || value === '';\n\n// will remove properties that have empty ('', null, undefined) object properties.\n// traverses nested objects and arrays as well. in place, mutates the object.\n// this is needed because form will submit empty string for not filled in fields,\n// but for cloud alertmanager receiver config to use global default value the property must be omitted entirely\n// this isn't a perfect solution though. No way for user to intentionally provide an empty string. Will need rethinking later\nexport function omitEmptyValues<T>(obj: T): T {\n  if (isArray(obj)) {\n    obj.forEach(omitEmptyValues);\n  } else if (typeof obj === 'object' && obj !== null) {\n    Object.entries(obj).forEach(([key, value]) => {\n      if (isUnacceptableValue(value)) {\n        delete (obj as any)[key];\n      } else {\n        omitEmptyValues(value);\n      }\n    });\n  }\n  return obj;\n}\n\n// Will remove empty ('', null, undefined) object properties unless they were previously defined.\n// existing is a map of property names that were previously defined.\nexport function omitEmptyUnlessExisting(settings = {}, existing = {}): Record<string, unknown> {\n  return omitBy(settings, (value, key) => isUnacceptableValue(value) && !has(existing, key));\n}\n\nexport function omitTemporaryIdentifiers<T>(object: Readonly<T>): T {\n  function omitIdentifiers<T>(obj: T) {\n    if (isArray(obj)) {\n      obj.forEach(omitIdentifiers);\n    } else if (typeof obj === 'object' && obj !== null) {\n      if ('__id' in obj) {\n        delete obj.__id;\n      }\n      Object.values(obj).forEach(omitIdentifiers);\n    }\n  }\n\n  const objectCopy = structuredClone(object);\n  omitIdentifiers(objectCopy);\n\n  return objectCopy;\n}\n"],"names":["CollapsibleSection","label","description","children","className","size","styles","getStyles","isCollapsed","setIsCollapsed","toggleCollapse","theme","KeyValueMapInput","value","onChange","readOnly","pairs","setPairs","recordToPairs","emitChange","pairsToRecord","deleteItem","index","newPairs","removed","updatePair","values","old","pair","i","key","Input","e","ActionIcon","Button","record","obj","StringArrayInput","newValue","updateValue","itemValue","v","getReceiverFormFieldStyles","SubformArrayField","option","pathPrefix","errors","defaultValues","path","formAPI","fields","append","remove","useControlledFieldArray","field","itemIndex","OptionField","SubformField","defaultValue","secureFields","onResetSecureField","name","watch","_watchValue","show","setShow","subOption","TemplateContentAndPreview","payload","templateContent","templateName","payloadFormatError","setPayloadFormatError","selectedAlertmanager","isGrafanaAlertManager","data","error","usePreviewTemplate","previewToRender","EditorColumnHeader","Box","width","height","TemplateEditor","TemplatesPicker","onSelect","valueInForm","showTemplates","setShowTemplates","onClick","Drawer","TemplateSelector","getTemplateOptions","templateFiles","defaultTemplates","templateMap","content","template","getContentFromOptions","options","onClose","useGetDefaultTemplatesQuery","setTemplate","inputToUpdate","setInputToUpdate","inputToUpdateCustom","setInputToUpdateCustom","isLoading","useNotificationTemplates","templateOption","setTemplateOption","_","copyToClipboard","useCopyToClipboard","templateOptions","onCustomTemplateChange","customInput","onTemplateOptionChange","Stack","RadioButtonGroup","Select","IconButton","OptionCustomfield","initialValue","TextArea","WrapWithTemplateSelection","useTemplates","onSelectTemplate","getValues","Text","parentOption","invalid","pathSuffix","customValidator","optionPath","Field","OptionInput","id","pathIndex","control","register","unregister","setValue","nestedKey","isEncryptedInput","Checkbox","SecretInput","determineReadOnly","determineRequired","validateOption","ref","RadioButtonList","SecretTextArea","validationRule","required","secureSettings","EMPTY_ARRAY","defaults","softDelete","reset","update","updateFn","newItems","items","grafanaReceiverToFormValues","receiver","notifiers","channelMap","idCounter","channel","notifier","type","grafanaChannelConfigToFormChannelValues","cloudReceiverToFormValues","configs","config","cloudChannelConfigToFormChannelValues","formValuesToGrafanaReceiver","defaultChannelValues","channelValues","existing","formChannelValuesToGrafanaChannelConfig","formValuesToCloudReceiver","recv","__id","settings","sendResolved","omitEmptyValues","omitTemporaryIdentifiers","getSecureFieldNames","secureFieldPaths","findSecureOptions","prefix","omitEmptyUnlessExisting","secureFieldNames","acc","isUnacceptableValue","object","omitIdentifiers","objectCopy"],"sourceRoot":""}