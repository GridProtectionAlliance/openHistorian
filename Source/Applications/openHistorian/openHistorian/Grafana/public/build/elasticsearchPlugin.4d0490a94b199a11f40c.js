(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{EnIS:function(e,t,r){"use strict";r.r(t);var a=r("Obii"),i=r("mrSG"),n=r("KHwQ"),s=r.n(n),o=r("LvDl"),l=r.n(o),u=r("wEtz"),c=[{text:"Count",value:"count",requiresField:!1},{text:"Average",value:"avg",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0},{text:"Sum",value:"sum",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0},{text:"Max",value:"max",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0},{text:"Min",value:"min",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0},{text:"Extended Stats",value:"extended_stats",requiresField:!0,supportsMissing:!0,supportsInlineScript:!0},{text:"Percentiles",value:"percentiles",requiresField:!0,supportsMissing:!0,supportsInlineScript:!0},{text:"Unique Count",value:"cardinality",requiresField:!0,supportsMissing:!0},{text:"Moving Average",value:"moving_avg",requiresField:!1,isPipelineAgg:!0,minVersion:2},{text:"Derivative",value:"derivative",requiresField:!1,isPipelineAgg:!0,minVersion:2},{text:"Bucket Script",value:"bucket_script",requiresField:!1,isPipelineAgg:!0,supportsMultipleBucketPaths:!0,minVersion:2},{text:"Raw Document",value:"raw_document",requiresField:!1},{text:"Logs",value:"logs",requiresField:!1}],g=[{text:"Terms",value:"terms",requiresField:!0},{text:"Filters",value:"filters"},{text:"Geo Hash Grid",value:"geohash_grid",requiresField:!0},{text:"Date Histogram",value:"date_histogram",requiresField:!0},{text:"Histogram",value:"histogram",requiresField:!0}],d=[{text:"Doc Count",value:"_count"},{text:"Term value",value:"_term"}],p=[{text:"Top",value:"desc"},{text:"Bottom",value:"asc"}],f=[{text:"No limit",value:"0"},{text:"1",value:"1"},{text:"2",value:"2"},{text:"3",value:"3"},{text:"5",value:"5"},{text:"10",value:"10"},{text:"15",value:"15"},{text:"20",value:"20"}],m=[{text:"Avg",value:"avg"},{text:"Min",value:"min"},{text:"Max",value:"max"},{text:"Sum",value:"sum"},{text:"Count",value:"count"},{text:"Std Dev",value:"std_deviation"},{text:"Std Dev Upper",value:"std_deviation_bounds_upper"},{text:"Std Dev Lower",value:"std_deviation_bounds_lower"}],v=[{text:"auto",value:"auto"},{text:"10s",value:"10s"},{text:"1m",value:"1m"},{text:"5m",value:"5m"},{text:"10m",value:"10m"},{text:"20m",value:"20m"},{text:"1h",value:"1h"},{text:"1d",value:"1d"}],h=[{text:"Simple",value:"simple"},{text:"Linear",value:"linear"},{text:"Exponentially Weighted",value:"ewma"},{text:"Holt Linear",value:"holt"},{text:"Holt Winters",value:"holt_winters"}],y={moving_avg:[{text:"window",default:5},{text:"model",default:"simple"},{text:"predict",default:void 0},{text:"minimize",default:!1}],derivative:[{text:"unit",default:void 0}],bucket_script:[]},_={simple:[],linear:[],ewma:[{text:"Alpha",value:"alpha",default:void 0}],holt:[{text:"Alpha",value:"alpha",default:void 0},{text:"Beta",value:"beta",default:void 0}],holt_winters:[{text:"Alpha",value:"alpha",default:void 0},{text:"Beta",value:"beta",default:void 0},{text:"Gamma",value:"gamma",default:void 0},{text:"Period",value:"period",default:void 0},{text:"Pad",value:"pad",default:void 0,isCheckbox:!0}]};function b(e){return l.a.filter(c,function(t){return!t.minVersion||t.minVersion<=e})}function x(e){if(e){var t=y[e];return null!=t}return!1}function O(e){return!!e&&void 0!==c.find(function(t){return t.value===e&&t.supportsMultipleBucketPaths})}function k(e,t){var r=[];return t?(l.a.each(_[e],function(e){e.isCheckbox||r.push(e)}),r):_[e]}function F(e){var t=l.a.find(c,{value:e.type});return t.requiresField||x(e.type)?t.text+" "+e.field:t.text}var j=function(e,t){return l.a.find(e,{id:t})};function w(e,t){return e&&e.metrics&&e.metrics.some(function(e){return e.type===t})}var q=r("iZOS"),S=function(){function e(e,t){this.targets=e,this.response=t,this.targets=e,this.response=t}return e.prototype.processMetrics=function(e,t,r,a){var i,n,s,o,l,u;for(n=0;n<t.metrics.length;n++)if(!(i=t.metrics[n]).hide)switch(i.type){case"count":for(o={datapoints:[],metric:"count",props:a},s=0;s<e.buckets.length;s++)u=(l=e.buckets[s]).doc_count,o.datapoints.push([u,l.key]);r.push(o);break;case"percentiles":if(0===e.buckets.length)break;var c=e.buckets[0][i.id].values;for(var g in c){for(o={datapoints:[],metric:"p"+g,props:a,field:i.field},s=0;s<e.buckets.length;s++){var d=(l=e.buckets[s])[i.id].values;o.datapoints.push([d[g],l.key])}r.push(o)}break;case"extended_stats":for(var p in i.meta)if(i.meta[p]){for(o={datapoints:[],metric:p,props:a,field:i.field},s=0;s<e.buckets.length;s++){var f=(l=e.buckets[s])[i.id];f.std_deviation_bounds_upper=f.std_deviation_bounds.upper,f.std_deviation_bounds_lower=f.std_deviation_bounds.lower,o.datapoints.push([f[p],l.key])}r.push(o)}break;default:for(o={datapoints:[],metric:i.type,field:i.field,metricId:i.id,props:a},s=0;s<e.buckets.length;s++)void 0!==(u=(l=e.buckets[s])[i.id])&&(u.normalized_value?o.datapoints.push([u.normalized_value,l.key]):o.datapoints.push([u.value,l.key]));r.push(o)}},e.prototype.processAggregationDocs=function(e,t,r,a,n){var s,o,u,c,g,d,p,f;if(0===a.columns.length){try{for(var m=Object(i.__values)(l.a.keys(n)),v=m.next();!v.done;v=m.next()){var h=v.value;a.addColumn({text:h,filterable:!0})}}catch(e){s={error:e}}finally{try{v&&!v.done&&(o=m.return)&&o.call(m)}finally{if(s)throw s.error}}a.addColumn({text:t.field,filterable:!0})}var y=function(e,t,r){a.addColumn({text:t}),e.push(r)};try{for(var _=Object(i.__values)(e.buckets),b=_.next();!b.done;b=_.next()){var x=b.value,O=[];try{for(var k=(g=void 0,Object(i.__values)(l.a.values(n))),F=k.next();!F.done;F=k.next()){var j=F.value;O.push(j)}}catch(e){g={error:e}}finally{try{F&&!F.done&&(d=k.return)&&d.call(k)}finally{if(g)throw g.error}}O.push(x.key);try{for(var w=(p=void 0,Object(i.__values)(r.metrics)),q=w.next();!q.done;q=w.next()){var S=q.value;switch(S.type){case"count":y(O,this.getMetricName(S.type),x.doc_count);break;case"extended_stats":for(var E in S.meta)if(S.meta[E]){var C=x[S.id];C.std_deviation_bounds_upper=C.std_deviation_bounds.upper,C.std_deviation_bounds_lower=C.std_deviation_bounds.lower,y(O,this.getMetricName(E),C[E])}break;case"percentiles":var A=x[S.id].values;for(var T in A)y(O,"p"+T+" "+S.field,A[T]);break;default:var D=this.getMetricName(S.type);l.a.filter(r.metrics,{type:S.type}).length>1&&(D+=" "+S.field),y(O,D,x[S.id].value)}}}catch(e){p={error:e}}finally{try{q&&!q.done&&(f=w.return)&&f.call(w)}finally{if(p)throw p.error}}a.rows.push(O)}}catch(e){u={error:e}}finally{try{b&&!b.done&&(c=_.return)&&c.call(_)}finally{if(u)throw u.error}}},e.prototype.processBuckets=function(e,t,r,a,i,n){var s,o,u,c,g=t.bucketAggs.length-1;for(c in e)if(o=l.a.find(t.bucketAggs,{id:c}),u=e[c],o)if(n===g)"date_histogram"===o.type?this.processMetrics(u,t,r,i):this.processAggregationDocs(u,o,t,a,i);else for(var d in u.buckets)s=u.buckets[d],i=l.a.clone(i),void 0!==s.key?i[o.field]=s.key:i.filter=d,s.key_as_string&&(i[o.field]=s.key_as_string),this.processBuckets(s,t,r,a,i,n+1)},e.prototype.getMetricName=function(e){var t=l.a.find(c,{value:e});return t||(t=l.a.find(m,{value:e})),t?t.text:e},e.prototype.getSeriesName=function(e,t,r){var a,n,s=this.getMetricName(e.metric);if(t.alias){return t.alias.replace(/\{\{([\s\S]+?)\}\}/g,function(t,r,a){var i=r||a;return 0===i.indexOf("term ")?e.props[i.substring(5)]:void 0!==e.props[i]?e.props[i]:"metric"===i?s:"field"===i?e.field||"":t})}if(e.field&&x(e.metric))if(e.metric&&O(e.metric)){var o=l.a.find(t.metrics,{id:e.metricId});if(o&&o.settings.script){s=o.settings.script;try{for(var u=Object(i.__values)(o.pipelineVariables),c=u.next();!c.done;c=u.next()){var g=c.value;(d=l.a.find(t.metrics,{id:g.pipelineAgg}))&&(s=s.replace("params."+g.name,F(d)))}}catch(e){a={error:e}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(a)throw a.error}}}else s="Unset"}else{var d;(d=l.a.find(t.metrics,{id:e.field}))?s+=" "+F(d):s="Unset"}else e.field&&(s+=" "+e.field);if(0===l.a.keys(e.props).length)return s;var p="";for(var f in e.props)p+=e.props[f]+" ";return 1===r?p.trim():p.trim()+" "+s},e.prototype.nameSeries=function(e,t){for(var r=l.a.uniq(l.a.map(e,"metric")).length,a=0;a<e.length;a++){var i=e[a];i.target=this.getSeriesName(i,t,r)}},e.prototype.processHits=function(e,t){var r,a,i,n,s={target:"docs",type:"docs",datapoints:[],total:"number"==typeof e.total?e.total:e.total.value,filterable:!0};for(n=0;n<e.hits.length;n++){if(i={_id:(a=e.hits[n])._id,_type:a._type,_index:a._index},a._source)for(r in a._source)i[r]=a._source[r];for(r in a.fields)i[r]=a.fields[r];s.datapoints.push(i)}t.push(s)},e.prototype.trimDatapoints=function(e,t){var r=l.a.find(t.bucketAggs,{type:"date_histogram"});if(r&&r.settings&&r.settings.trimEdges){var a=r.settings.trimEdges;for(var i in e){var n=e[i];n.datapoints.length>2*a&&(n.datapoints=n.datapoints.slice(a,n.datapoints.length-a))}}},e.prototype.getErrorFromElasticResponse=function(e,t){var r={};return r.data=JSON.stringify(t,null,4),t.root_cause&&t.root_cause.length>0&&t.root_cause[0].reason?r.message=t.root_cause[0].reason:r.message=t.reason||"Unkown elastic error response",e.$$config&&(r.config=e.$$config),r},e.prototype.getTimeSeries=function(){for(var e=[],t=0;t<this.response.responses.length;t++){var r=this.response.responses[t];if(r.error)throw this.getErrorFromElasticResponse(this.response,r.error);if(r.hits&&r.hits.hits.length>0&&this.processHits(r.hits,e),r.aggregations){var a=r.aggregations,i=this.targets[t],n=[],s=new q.a;this.processBuckets(a,i,n,s,{},0),this.trimDatapoints(n,i),this.nameSeries(n,i);for(var o=0;o<n.length;o++)e.push(n[o]);s.rows.length>0&&e.push(s)}}return{data:e}},e.prototype.getLogs=function(e,t){for(var r,n,s=[],o=0;o<this.response.responses.length;o++){var l=this.response.responses[o];if(l.error)throw this.getErrorFromElasticResponse(this.response,l.error);var u=E(l.hits.hits),c=u.propNames,g=u.docs;if(g.length>0){var d=C(c,this.targets[0].timeField,e,t);try{for(var p=(r=void 0,Object(i.__values)(g)),f=p.next();!f.done;f=p.next()){var m=f.value;t&&(m.level=m[t]),d.add(m)}}catch(e){r={error:e}}finally{try{f&&!f.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}s.push(d)}if(l.aggregations){var v=l.aggregations,h=this.targets[o],y=[],_=new q.a;this.processBuckets(v,h,y,_,{},0),this.trimDatapoints(y,h),this.nameSeries(y,h);for(var b=0;b<y.length;b++){d=Object(a.toDataFrame)(y[b]);s.push(d)}}}return{data:s}},e}(),E=function(e){var t,r,a,n,s=[],o=[];try{for(var l=Object(i.__values)(e),c=l.next();!c.done;c=l.next()){var g=c.value,d=g._source?Object(u.default)(g._source,null):{},p=Object(i.__assign)({_id:g._id,_type:g._type,_index:g._index,_source:Object(i.__assign)({},d)},d);try{for(var f=(a=void 0,Object(i.__values)(Object.keys(p))),m=f.next();!m.done;m=f.next()){var v=m.value;-1===o.indexOf(v)&&o.push(v)}}catch(e){a={error:e}}finally{try{m&&!m.done&&(n=f.return)&&n.call(f)}finally{if(a)throw a.error}}s.push(p)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}return o.sort(),{docs:s,propNames:o}},C=function(e,t,r,n){var s,o,l=new a.MutableDataFrame({fields:[]});l.addField({name:t,type:a.FieldType.time}),r?l.addField({name:r,type:a.FieldType.string}).parse=function(e){return e||""}:l.addField({name:"_source",type:a.FieldType.string}).parse=function(e){return JSON.stringify(e,null,2)},n&&(l.addField({name:"level",type:a.FieldType.string}).parse=function(e){return e||""});var u=l.fields.map(function(e){return e.name});try{for(var c=Object(i.__values)(e),g=c.next();!g.done;g=c.next()){var d=g.value;u.includes(d)||(l.addField({name:d,type:a.FieldType.string}).parse=function(e){return e||""})}}catch(e){s={error:e}}finally{try{g&&!g.done&&(o=c.return)&&o.call(c)}finally{if(s)throw s.error}}return l},A={Hourly:{startOf:"hour",amount:"hours"},Daily:{startOf:"day",amount:"days"},Weekly:{startOf:"isoWeek",amount:"weeks"},Monthly:{startOf:"month",amount:"months"},Yearly:{startOf:"year",amount:"years"}},T=function(){function e(e,t){this.pattern=e,this.interval=t}return e.prototype.getIndexForToday=function(){return this.interval?Object(a.toUtc)().format(this.pattern):this.pattern},e.prototype.getIndexList=function(e,t){if(!this.interval)return this.pattern;for(var r=A[this.interval],i=Object(a.dateTime)(e).utc().startOf(r.startOf),n=Object(a.dateTime)(t).utc().startOf(r.startOf).valueOf(),s=[];i.valueOf()<=n;)s.push(i.format(this.pattern)),i.add(1,r.amount);return s},e}(),D=function(){function e(e){this.timeField=e.timeField,this.esVersion=e.esVersion}return e.prototype.getRangeFilter=function(){var e={};return e[this.timeField]={gte:"$timeFrom",lte:"$timeTo",format:"epoch_millis"},e},e.prototype.buildTermsAgg=function(e,t,r){var a,i,n;if(t.terms={field:e.field},!e.settings)return t;if(t.terms.size=0===parseInt(e.settings.size,10)?500:parseInt(e.settings.size,10),void 0!==e.settings.orderBy&&(t.terms.order={},"_term"===e.settings.orderBy&&this.esVersion>=60?t.terms.order._key=e.settings.order:t.terms.order[e.settings.orderBy]=e.settings.order,a=parseInt(e.settings.orderBy,10),!isNaN(a)))for(n=0;n<r.metrics.length;n++)if((i=r.metrics[n]).id===e.settings.orderBy){t.aggs={},t.aggs[i.id]={},t.aggs[i.id][i.type]={field:i.field};break}return void 0!==e.settings.min_doc_count&&(t.terms.min_doc_count=parseInt(e.settings.min_doc_count,10)),e.settings.missing&&(t.terms.missing=e.settings.missing),t},e.prototype.getDateHistogramAgg=function(e){var t={},r=e.settings||{};return t.interval=r.interval,t.field=this.timeField,t.min_doc_count=r.min_doc_count||0,t.extended_bounds={min:"$timeFrom",max:"$timeTo"},t.format="epoch_millis",""!==r.offset&&(t.offset=r.offset),"auto"===t.interval&&(t.interval="$__interval"),r.missing&&(t.missing=r.missing),t},e.prototype.getHistogramAgg=function(e){var t={},r=e.settings||{};return t.interval=r.interval,t.field=e.field,t.min_doc_count=r.min_doc_count||0,r.missing&&(t.missing=r.missing),t},e.prototype.getFiltersAgg=function(e){for(var t={},r=0;r<e.settings.filters.length;r++){var a=e.settings.filters[r].query,i=e.settings.filters[r].label;t[i=""===i||void 0===i?a:i]={query_string:{query:a,analyze_wildcard:!0}}}return t},e.prototype.documentQuery=function(e,t){return e.size=t,e.sort={},e.sort[this.timeField]={order:"desc",unmapped_type:"boolean"},this.esVersion<5&&(e.fields=["*","_source"]),e.script_fields={},e},e.prototype.addAdhocFilters=function(e,t){var r,a,i,n;if(t)for(r=0;r<t.length;r++)switch((i={})[(a=t[r]).key]=a.value,(n={})[a.key]={query:a.value},a.operator){case"=":e.query.bool.must||(e.query.bool.must=[]),e.query.bool.must.push({match_phrase:n});break;case"!=":e.query.bool.must_not||(e.query.bool.must_not=[]),e.query.bool.must_not.push({match_phrase:n});break;case"<":i[a.key]={lt:a.value},e.query.bool.filter.push({range:i});break;case">":i[a.key]={gt:a.value},e.query.bool.filter.push({range:i});break;case"=~":e.query.bool.filter.push({regexp:i});break;case"!~":e.query.bool.filter.push({bool:{must_not:{regexp:i}}})}},e.prototype.build=function(e,t,r){var a,i,n,s,o;e.metrics=e.metrics||[{type:"count",id:"1"}],e.bucketAggs=e.bucketAggs||[{type:"date_histogram",id:"2",settings:{interval:"auto"}}],e.timeField=this.timeField;var l={size:0,query:{bool:{filter:[{range:this.getRangeFilter()},{query_string:{analyze_wildcard:!0,query:r}}]}}};if(this.addAdhocFilters(l,t),0===e.bucketAggs.length){if(!(o=e.metrics[0])||"raw_document"!==o.type)throw{message:"Invalid query"};var u=o.settings&&o.settings.size||500;return this.documentQuery(l,u)}for(s=l,a=0;a<e.bucketAggs.length;a++){var c=e.bucketAggs[a],g={};switch(c.type){case"date_histogram":g.date_histogram=this.getDateHistogramAgg(c);break;case"histogram":g.histogram=this.getHistogramAgg(c);break;case"filters":g.filters={filters:this.getFiltersAgg(c)};break;case"terms":this.buildTermsAgg(c,g,e);break;case"geohash_grid":g.geohash_grid={field:c.field,precision:c.settings.precision}}s.aggs=s.aggs||{},s.aggs[c.id]=g,s=g}for(s.aggs={},a=0;a<e.metrics.length;a++)if("count"!==(o=e.metrics[a]).type){var d={},p=null;if(x(o.type))if(O(o.type)){if(!o.pipelineVariables)continue;for(p={buckets_path:{}},i=0;i<o.pipelineVariables.length;i++){if((n=o.pipelineVariables[i]).name&&n.pipelineAgg&&/^\d*$/.test(n.pipelineAgg))(f=j(e.metrics,n.pipelineAgg))&&("count"===f.type?p.buckets_path[n.name]="_count":p.buckets_path[n.name]=n.pipelineAgg)}}else{if(!o.pipelineAgg||!/^\d*$/.test(o.pipelineAgg))continue;var f;(f=j(e.metrics,o.pipelineAgg))&&(p="count"===f.type?{buckets_path:"_count"}:{buckets_path:o.pipelineAgg})}else p={field:o.field};for(var m in o.settings)o.settings.hasOwnProperty(m)&&null!==o.settings[m]&&(p[m]=o.settings[m]);d[o.type]=p,s.aggs[o.id]=d}return l},e.prototype.getTermsQuery=function(e){var t={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};e.query&&t.query.bool.filter.push({query_string:{analyze_wildcard:!0,query:e.query}});var r=500;e.size&&(r=e.size),t.aggs={1:{terms:{field:e.field,size:r,order:{}}}};var a=e.orderBy,i=void 0===a?"key":a,n=e.order,s=void 0===n?"doc_count"===i?"desc":"asc":n;if(["asc","desc"].indexOf(s)<0)throw{message:"Invalid query sort order "+s};switch(i){case"key":case"term":var o=this.esVersion>=60?"_key":"_term";t.aggs[1].terms.order[o]=s;break;case"doc_count":t.aggs[1].terms.order._count=s;break;default:throw{message:"Invalid query sort type "+i}}return t},e.prototype.getLogsQuery=function(e,t,r){var a={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};return this.addAdhocFilters(a,t),e.query&&a.query.bool.filter.push({query_string:{analyze_wildcard:!0,query:r}}),a=this.documentQuery(a,500),Object(i.__assign)(Object(i.__assign)({},a),{aggs:this.build(e,null,r).aggs})},e}(),M=function(e){function t(t,r,a,i){var n=e.call(this,t)||this;n.backendSrv=r,n.templateSrv=a,n.timeSrv=i,n.basicAuth=t.basicAuth,n.withCredentials=t.withCredentials,n.url=t.url,n.name=t.name,n.index=t.database;var s=t.jsonData||{};return n.timeField=s.timeField,n.esVersion=s.esVersion,n.indexPattern=new T(n.index,s.interval),n.interval=s.timeInterval,n.maxConcurrentShardRequests=s.maxConcurrentShardRequests,n.queryBuilder=new D({timeField:n.timeField,esVersion:n.esVersion}),n.logMessageField=s.logMessageField||"",n.logLevelField=s.logLevelField||"",n.dataLinks=s.dataLinks||[],""===n.logMessageField&&(n.logMessageField=null),""===n.logLevelField&&(n.logLevelField=null),n}return t.$inject=["instanceSettings","backendSrv","templateSrv","timeSrv"],Object(i.__extends)(t,e),t.prototype.request=function(e,t,r){var a={url:this.url+"/"+t,method:e,data:r};return(this.basicAuth||this.withCredentials)&&(a.withCredentials=!0),this.basicAuth&&(a.headers={Authorization:this.basicAuth}),this.backendSrv.datasourceRequest(a)},t.prototype.get=function(e){var t=this.timeSrv.timeRange(),r=this.indexPattern.getIndexList(t.from.valueOf(),t.to.valueOf());return l.a.isArray(r)&&r.length?this.request("GET",r[0]+e).then(function(e){return e.data.$$config=e.config,e.data}):this.request("GET",this.indexPattern.getIndexForToday()+e).then(function(e){return e.data.$$config=e.config,e.data})},t.prototype.post=function(e,t){return this.request("POST",e,t).then(function(e){return e.data.$$config=e.config,e.data}).catch(function(e){if(e.data&&e.data.error)throw{message:"Elasticsearch error: "+e.data.error.reason,error:e.data.error};throw e})},t.prototype.annotationQuery=function(e){var t=e.annotation,r=t.timeField||"@timestamp",i=t.timeEndField||null,n=t.query||"*",o=t.tagsField||"tags",u=t.textField||null,c=[],g={};if(g[r]={from:e.range.from.valueOf(),to:e.range.to.valueOf(),format:"epoch_millis"},c.push({range:g}),i){var d={};d[i]={from:e.range.from.valueOf(),to:e.range.to.valueOf(),format:"epoch_millis"},c.push({range:d})}var p={query:{bool:{filter:[{bool:{should:c,minimum_should_match:1}},{query_string:{query:this.templateSrv.replace(n,{},"lucene")}}]}},size:1e4};this.esVersion<5&&(p.fields=[r,"_source"]);var f={search_type:"query_then_fetch",ignore_unavailable:!0};t.index?f.index=t.index:f.index=this.indexPattern.getIndexList(e.range.from,e.range.to);var m=s.a.toJson(f)+"\n"+s.a.toJson(p)+"\n";return this.post("_msearch",m).then(function(e){for(var n=[],s=e.responses[0].hits.hits,c=function(e,t){if(t){for(var r=t.split("."),a=e,i=0;i<r.length;i++)if(!(a=a[r[i]]))return console.log("could not find field in annotation: ",t),"";return a}},g=0;g<s.length;g++){var d=s[g]._source,p=c(d,r);if(void 0!==s[g].fields){var f=s[g].fields;(l.a.isString(f[r])||l.a.isNumber(f[r]))&&(p=f[r])}var m={annotation:t,time:Object(a.toUtc)(p).valueOf(),text:c(d,u),tags:c(d,o)};if(i){var v=c(d,i);v&&(m.timeEnd=Object(a.toUtc)(v).valueOf())}if(t.titleField){var h=c(d,t.titleField);h&&(m.text=h+"\n"+m.text)}"string"==typeof m.tags&&(m.tags=m.tags.split(",")),n.push(m)}return n})},t.prototype.interpolateVariablesInQueries=function(e,t){var r=this,a=e;return e&&e.length>0&&(a=e.map(function(e){return Object(i.__assign)(Object(i.__assign)({},e),{datasource:r.name,query:r.templateSrv.replace(e.query,t,"lucene")})})),a},t.prototype.testDatasource=function(){var e=this;return this.getFields({type:"date"}).then(function(t){return l.a.find(t,{text:e.timeField})?{status:"success",message:"Index OK. Time field name OK."}:{status:"error",message:"No date field named "+e.timeField+" found"}},function(e){if(console.log(e),e.data&&e.data.error){var t=s.a.toJson(e.data.error);return e.data.error.reason&&(t=e.data.error.reason),{status:"error",message:t}}return{status:"error",message:e.status}})},t.prototype.getQueryHeader=function(e,t,r){var a={search_type:e,ignore_unavailable:!0,index:this.indexPattern.getIndexList(t,r)};return this.esVersion>=56&&this.esVersion<70&&(a.max_concurrent_shard_requests=this.maxConcurrentShardRequests),s.a.toJson(a)},t.prototype.query=function(e){var t,r,a=this,n="",o=l.a.cloneDeep(e.targets),u=[],c=this.templateSrv.getAdhocFilters(this.name);try{for(var g=Object(i.__values)(o),d=g.next();!d.done;d=g.next()){var p=d.value;if(!p.hide){var f=this.templateSrv.replace(p.query,e.scopedVars,"lucene");f&&""!==f||(f="*");var m=void 0;p.isLogsQuery||w(p,"logs")?(p.bucketAggs=[{type:"date_histogram",id:"2",settings:{interval:"auto"}}],p.metrics=[{type:"count",id:"1"}],p.isLogsQuery=!0,m=this.queryBuilder.getLogsQuery(p,c,f)):(p.alias&&(p.alias=this.templateSrv.replace(p.alias,e.scopedVars,"lucene")),m=this.queryBuilder.build(p,c,f));var v=s.a.toJson(m),h=0===m.size&&this.esVersion<5?"count":"query_then_fetch";n+=this.getQueryHeader(h,e.range.from,e.range.to)+"\n",n+=v+"\n",u.push(p)}}}catch(e){t={error:e}}finally{try{d&&!d.done&&(r=g.return)&&r.call(g)}finally{if(t)throw t.error}}if(0===u.length)return Promise.resolve({data:[]});n=(n=n.replace(/"\$timeFrom"/g,e.range.from.valueOf().toString())).replace(/"\$timeTo"/g,e.range.to.valueOf().toString()),n=this.templateSrv.replace(n,e.scopedVars);var y=this.getMultiSearchUrl();return this.post(y,n).then(function(e){var t,r,n=new S(u,e);if(u.some(function(e){return e.isLogsQuery})){var s=n.getLogs(a.logMessageField,a.logLevelField);try{for(var o=Object(i.__values)(s.data),l=o.next();!l.done;l=o.next()){var c=l.value;a.enhanceDataFrame(c)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return s}return n.getTimeSeries()})},t.prototype.getFields=function(e){var t=this.esVersion;return this.get("/_mapping").then(function(r){var a={float:"number",double:"number",integer:"number",long:"number",date:"date",string:"string",text:"string",scaled_float:"number",nested:"nested"};function i(e,t,r){return"_"!==t[0]&&(!r.type||(r.type===e.type||r.type===a[e.type]))}var n=[],s={};function o(t){for(var r in t){var a=t[r];if(l.a.isObject(a.properties)&&(n.push(r),o(a.properties)),l.a.isObject(a.fields)&&(n.push(r),o(a.fields)),l.a.isString(a.type)){var u=n.concat(r).join(".");i(a,r,e)&&(s[u]={text:u,type:a.type})}}n.pop()}for(var u in r){var c=r[u];if(c&&c.mappings){var g=c.mappings;if(t<70)for(var d in g){o(g[d].properties)}else o(g.properties)}}return l.a.map(s,function(e){return e})})},t.prototype.getTerms=function(e){var t=this.timeSrv.timeRange(),r=this.esVersion>=5?"query_then_fetch":"count",a=this.getQueryHeader(r,t.from,t.to),i=s.a.toJson(this.queryBuilder.getTermsQuery(e));i=a+"\n"+(i=(i=i.replace(/\$timeFrom/g,t.from.valueOf().toString())).replace(/\$timeTo/g,t.to.valueOf().toString()))+"\n";var n=this.getMultiSearchUrl();return this.post(n,i).then(function(e){if(!e.responses[0].aggregations)return[];var t=e.responses[0].aggregations[1].buckets;return l.a.map(t,function(e){return{text:e.key_as_string||e.key,value:e.key}})})},t.prototype.getMultiSearchUrl=function(){return this.esVersion>=70&&this.maxConcurrentShardRequests?"_msearch?max_concurrent_shard_requests="+this.maxConcurrentShardRequests:"_msearch"},t.prototype.metricFindQuery=function(e){return(e=s.a.fromJson(e))?"fields"===e.find?(e.field=this.templateSrv.replace(e.field,{},"lucene"),this.getFields(e)):"terms"===e.find?(e.field=this.templateSrv.replace(e.field,{},"lucene"),e.query=this.templateSrv.replace(e.query||"*",{},"lucene"),this.getTerms(e)):void 0:Promise.resolve([])},t.prototype.getTagKeys=function(){return this.getFields({})},t.prototype.getTagValues=function(e){return this.getTerms({field:e.key,query:"*"})},t.prototype.targetContainsTemplate=function(e){var t,r,a,n;if(this.templateSrv.variableExists(e.query)||this.templateSrv.variableExists(e.alias))return!0;try{for(var s=Object(i.__values)(e.bucketAggs),o=s.next();!o.done;o=s.next()){var l=o.value;if(this.templateSrv.variableExists(l.field)||this.objectContainsTemplate(l.settings))return!0}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}try{for(var u=Object(i.__values)(e.metrics),c=u.next();!c.done;c=u.next()){var g=c.value;if(this.templateSrv.variableExists(g.field)||this.objectContainsTemplate(g.settings)||this.objectContainsTemplate(g.meta))return!0}}catch(e){a={error:e}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(a)throw a.error}}return!1},t.prototype.enhanceDataFrame=function(e){var t,r;if(this.dataLinks.length){var a=function(e){var t=n.dataLinks.find(function(t){return e.name&&e.name.match(t.field)});t&&(e.config=e.config||{},e.config.links=Object(i.__spread)(e.config.links||[],[{url:t.url,title:""}]))},n=this;try{for(var s=Object(i.__values)(e.fields),o=s.next();!o.done;o=s.next()){a(o.value)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}}},t.prototype.isPrimitive=function(e){return null==e||!!["string","number","boolean"].some(function(e){return e===typeof!0})},t.prototype.objectContainsTemplate=function(e){var t,r,a,n;if(!e)return!1;try{for(var s=Object(i.__values)(Object.keys(e)),o=s.next();!o.done;o=s.next()){var l=o.value;if(this.isPrimitive(e[l])){if(this.templateSrv.variableExists(e[l]))return!0}else if(Array.isArray(e[l]))try{for(var u=(a=void 0,Object(i.__values)(e[l])),c=u.next();!c.done;c=u.next()){var g=c.value;if(this.objectContainsTemplate(g))return!0}}catch(e){a={error:e}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(a)throw a.error}}else if(this.objectContainsTemplate(e[l]))return!0}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return!1},t}(a.DataSourceApi),L=r("txxJ"),V=r("GQ3c"),I=function(){function e(e,t,r){var a=e.target.bucketAggs;e.orderByOptions=[],e.getBucketAggTypes=function(){return g},e.getOrderOptions=function(){return p},e.getSizeOptions=function(){return f},r.onAppEvent(V.CoreEvents.elasticQueryUpdated,function(){e.validateModel()},e),e.init=function(){e.agg=a[e.index],e.validateModel()},e.onChangeInternal=function(){e.onChange()},e.onTypeChanged=function(){switch(e.agg.settings={},e.showOptions=!1,e.agg.type){case"date_histogram":case"histogram":case"terms":delete e.agg.query,e.agg.field="select field";break;case"filters":delete e.agg.field,e.agg.query="*";break;case"geohash_grid":e.agg.settings.precision=3}e.validateModel(),e.onChange()},e.validateModel=function(){e.index=l.a.indexOf(a,e.agg),e.isFirst=0===e.index,e.bucketAggCount=a.length;var t,r="",i=e.agg.settings||{};switch(e.agg.type){case"terms":i.order=i.order||"desc",i.size=i.size||"10",i.min_doc_count=i.min_doc_count||1,i.orderBy=i.orderBy||"_term","0"!==i.size&&(t=i.order,r=l.a.find(p,{value:t}).text+" "+i.size+", "),i.min_doc_count>0&&(r+="Min Doc Count: "+i.min_doc_count+", "),r+="Order by: "+function(e,t){var r=l.a.find(d,{value:e});if(r)return r.text;var a=l.a.find(t.metrics,{id:e});return a?F(a):"metric not found"}(i.orderBy,e.target),"0"===i.size&&(r+=" ("+i.order+")");break;case"filters":i.filters=i.filters||[{query:"*"}],(r=l.a.reduce(i.filters,function(e,t,r){return e+="Q"+(r+1)+"  = "+t.query+" "},"")).length>50&&(r=r.substr(0,50)+"..."),r="Filter Queries ("+i.filters.length+")";break;case"date_histogram":i.interval=i.interval||"auto",i.min_doc_count=i.min_doc_count||0,e.agg.field=e.target.timeField,r="Interval: "+i.interval,i.min_doc_count>0&&(r+=", Min Doc Count: "+i.min_doc_count),(void 0===i.trimEdges||i.trimEdges<0)&&(i.trimEdges=0),i.trimEdges&&i.trimEdges>0&&(r+=", Trim edges: "+i.trimEdges);break;case"histogram":i.interval=i.interval||1e3,i.min_doc_count=l.a.defaultTo(i.min_doc_count,1),r="Interval: "+i.interval,i.min_doc_count>0&&(r+=", Min Doc Count: "+i.min_doc_count);break;case"geohash_grid":i.precision=Math.max(Math.min(i.precision,7),1),r="Precision: "+i.precision}return e.settingsLinkText=r,e.agg.settings=i,!0},e.addFiltersQuery=function(){e.agg.settings.filters.push({query:"*"})},e.removeFiltersQuery=function(t){e.agg.settings.filters=l.a.without(e.agg.settings.filters,t)},e.toggleOptions=function(){e.showOptions=!e.showOptions},e.getOrderByOptions=function(){return t=e.target,r=[],l.a.each(t.metrics,function(e){"count"!==e.type&&r.push({text:F(e),value:e.id})}),d.concat(r);var t,r},e.getFieldsInternal=function(){return"date_histogram"===e.agg.type?e.getFields({$fieldType:"date"}):e.getFields()},e.getIntervalOptions=function(){return Promise.resolve(t.transformToSegments(!0,"interval")(v))},e.addBucketAgg=function(){var t=a[a.length-1],r=a.length-1;t&&"date_histogram"===t.type&&(r-=1);var i=l.a.reduce(e.target.bucketAggs.concat(e.target.metrics),function(e,t){return parseInt(t.id,10)>e?parseInt(t.id,10):e},0);a.splice(r,0,{type:"terms",field:"select field",id:(i+1).toString(),fake:!0}),e.onChange()},e.removeBucketAgg=function(){a.splice(e.index,1),e.onChange()},e.init()}return e.$inject=["$scope","uiSegmentSrv","$rootScope"],e}();L.c.directive("elasticBucketAgg",function(){return{templateUrl:"public/app/plugins/datasource/elasticsearch/partials/bucket_agg.html",controller:I,restrict:"E",scope:{target:"=",index:"=",onChange:"&",getFields:"&"}}});var Q=function(){function e(e,t,r){var a=e.target.metrics;e.metricAggTypes=b(e.esVersion),e.extendedStats=m,e.pipelineAggOptions=[],e.modelSettingsValues={},e.init=function(){e.agg=a[e.index],e.validateModel(),e.updatePipelineAggOptions()},e.updatePipelineAggOptions=function(){var t,r;e.pipelineAggOptions=(t=e.target,r=[],l.a.each(t.metrics,function(e){x(e.type)||r.push({text:F(e),value:e.id})}),r)},r.onAppEvent(V.CoreEvents.elasticQueryUpdated,function(){e.index=l.a.indexOf(a,e.agg),e.updatePipelineAggOptions(),e.validateModel()},e),e.validateModel=function(){if(e.isFirst=0===e.index,e.isSingle=1===a.length,e.settingsLinkText="",e.variablesLinkText="",e.aggDef=l.a.find(e.metricAggTypes,{value:e.agg.type}),x(e.agg.type)){O(e.agg.type)?(e.variablesLinkText="Options",e.agg.settings.script&&(e.variablesLinkText="Script: "+e.agg.settings.script.replace(new RegExp("params.","g"),""))):(e.agg.pipelineAgg=e.agg.pipelineAgg||"select metric",e.agg.field=e.agg.pipelineAgg);var t=x((r=e.agg).type)?y[r.type]:[];t.length>0&&(l.a.each(t,function(t){e.agg.settings[t.text]=e.agg.settings[t.text]||t.default}),e.settingsLinkText="Options")}else e.agg.field||(e.agg.field="select field");var r;switch(e.agg.type){case"cardinality":var i=e.agg.settings.precision_threshold||"";e.settingsLinkText="Precision threshold: "+i;break;case"percentiles":e.agg.settings.percents=e.agg.settings.percents||[25,50,75,95,99],e.settingsLinkText="Values: "+e.agg.settings.percents.join(",");break;case"extended_stats":0===l.a.keys(e.agg.meta).length&&(e.agg.meta.std_deviation_bounds_lower=!0,e.agg.meta.std_deviation_bounds_upper=!0);var n=l.a.reduce(e.agg.meta,function(t,r,a){if(r){var i=l.a.find(e.extendedStats,{value:a});t.push(i.text)}return t},[]);e.settingsLinkText="Stats: "+n.join(", ");break;case"moving_avg":e.movingAvgModelTypes=h,e.modelSettings=k(e.agg.settings.model,!0),e.updateMovingAvgModelSettings();break;case"raw_document":e.agg.settings.size=e.agg.settings.size||500,e.settingsLinkText="Size: "+e.agg.settings.size,e.target.metrics.splice(0,e.target.metrics.length,e.agg),e.target.bucketAggs=[]}if(e.aggDef.supportsInlineScript){var s=e.agg.inlineScript;s?e.agg.settings.script={inline:s}:delete e.agg.settings.script,""===e.settingsLinkText&&(e.settingsLinkText="Options")}},e.toggleOptions=function(){e.showOptions=!e.showOptions,e.updatePipelineAggOptions()},e.toggleVariables=function(){e.showVariables=!e.showVariables},e.onChangeInternal=function(){e.onChange()},e.updateMovingAvgModelSettings=function(){for(var t=[],r=k(e.agg.settings.model,!1),a=0;a<r.length;a++)t.push(r[a].value);for(var i in e.agg.settings.settings)null!==e.agg.settings.settings[i]&&-1!==t.indexOf(i)||delete e.agg.settings.settings[i]},e.onChangeClearInternal=function(){delete e.agg.settings.minimize,e.onChange()},e.onTypeChange=function(){e.agg.settings={},e.agg.meta={},e.showOptions=!1,0===e.target.bucketAggs.length&&"raw_document"!==e.agg.type&&(e.target.bucketAggs=[{type:"date_histogram",id:"2",settings:{interval:"auto"}}]),e.showVariables=O(e.agg.type),e.updatePipelineAggOptions(),e.onChange()},e.getFieldsInternal=function(){return"cardinality"===e.agg.type?e.getFields():e.getFields({$fieldType:"number"})},e.addMetricAgg=function(){var t=a.length,r=l.a.reduce(e.target.bucketAggs.concat(e.target.metrics),function(e,t){return parseInt(t.id,10)>e?parseInt(t.id,10):e},0);a.splice(t,0,{type:"count",field:"select field",id:(r+1).toString()}),e.onChange()},e.removeMetricAgg=function(){a.splice(e.index,1),e.onChange()},e.toggleShowMetric=function(){e.agg.hide=!e.agg.hide,e.agg.hide||delete e.agg.hide,e.onChange()},e.init()}return e.$inject=["$scope","uiSegmentSrv","$rootScope"],e}();L.c.directive("elasticMetricAgg",function(){return{templateUrl:"public/app/plugins/datasource/elasticsearch/partials/metric_agg.html",controller:Q,restrict:"E",scope:{target:"=",index:"=",onChange:"&",getFields:"&",esVersion:"="}}});var N=function(e){return{name:"var"+e,pipelineAgg:"select metric"}},$=function(){function e(e){e.variables=e.variables||[N(1)],e.onChangeInternal=function(){e.onChange()},e.add=function(){e.variables.push(N(e.variables.length+1)),e.onChange()},e.remove=function(t){e.variables.splice(t,1),e.onChange()}}return e.$inject=["$scope"],e}();L.c.directive("elasticPipelineVariables",function(){return{templateUrl:"public/app/plugins/datasource/elasticsearch/partials/pipeline_variables.html",controller:"ElasticPipelineVariablesCtrl",restrict:"E",scope:{onChange:"&",variables:"=",options:"="}}}),L.c.controller("ElasticPipelineVariablesCtrl",$);var P=function(e){function t(t,r,a,i){var n=e.call(this,t,r)||this;if(n.$rootScope=a,n.uiSegmentSrv=i,n.esVersion=n.datasource.esVersion,n.target=n.target||{},n.target.metrics=n.target.metrics||[{type:"count",id:"1"}],n.target.bucketAggs=n.target.bucketAggs||[{type:"date_histogram",id:"2",settings:{interval:"auto"}}],0===n.target.bucketAggs.length){var s=n.target.metrics[0];s&&"raw_document"===s.type||(n.target.bucketAggs=[{type:"date_histogram",id:"2",settings:{interval:"auto"}}]),n.refresh()}return n.queryUpdated(),n}return t.$inject=["$scope","$injector","$rootScope","uiSegmentSrv"],Object(i.__extends)(t,e),t.prototype.getFields=function(e){var t=s.a.toJson({find:"fields",type:e});return this.datasource.metricFindQuery(t).then(this.uiSegmentSrv.transformToSegments(!1)).catch(this.handleQueryError.bind(this))},t.prototype.queryUpdated=function(){var e=s.a.toJson(this.datasource.queryBuilder.build(this.target),!0);this.rawQueryOld&&e!==this.rawQueryOld&&this.refresh(),this.rawQueryOld=e,this.$rootScope.appEvent(V.CoreEvents.elasticQueryUpdated)},t.prototype.getCollapsedText=function(){var e=this.target.metrics,t=this.target.bucketAggs,r=b(this.esVersion),a=g,i="";return this.target.query&&(i+="Query: "+this.target.query+", "),i+="Metrics: ",l.a.each(e,function(e,t){var a=l.a.find(r,{value:e.type});i+=a.text+"(",a.requiresField&&(i+=e.field),a.supportsMultipleBucketPaths&&(i+=e.settings.script.replace(new RegExp("params.","g"),"")),i+="), "}),l.a.each(t,function(e,t){0===t&&(i+=" Group by: ");var r=l.a.find(a,{value:e.type});i+=r.text+"(",r.requiresField&&(i+=e.field),i+="), "}),this.target.alias&&(i+="Alias: "+this.target.alias),i},t.prototype.handleQueryError=function(e){return this.error=e.message||"Failed to issue metric query",[]},t.templateUrl="partials/query.editor.html",t}(r("LzXI").QueryCtrl),R=r("q1tI"),B=r.n(R),z=r("kDLi"),U=function(e){function t(t,r){var a=e.call(this,t,r)||this;return a.onChangeQuery=function(e,t){var r=a.props,n=r.query,s=r.onChange,o=r.onRunQuery;s&&(s(Object(i.__assign)(Object(i.__assign)({},n),{query:e,isLogsQuery:!0})),t&&o&&o())},a.plugins=[Object(z.SlatePrism)({onlyIn:function(e){return"code_block"===e.type},getSyntax:function(e){return"lucene"}})],a.state={syntaxLoaded:!1},a}return Object(i.__extends)(t,e),t.prototype.componentDidMount=function(){this.props.query.isLogsQuery||this.onChangeQuery("",!0)},t.prototype.componentWillUnmount=function(){},t.prototype.componentDidUpdate=function(e){this.props.query.isLogsQuery||this.onChangeQuery("",!0)},t.prototype.render=function(){var e=this.props,t=e.data,r=e.query,a=this.state.syntaxLoaded;return B.a.createElement(B.a.Fragment,null,B.a.createElement("div",{className:"gf-form-inline gf-form-inline--nowrap"},B.a.createElement("div",{className:"gf-form gf-form--grow flex-shrink-1"},B.a.createElement(z.QueryField,{additionalPlugins:this.plugins,query:r.query,onChange:this.onChangeQuery,onRunQuery:this.props.onRunQuery,placeholder:"Enter a Lucene query",portalOrigin:"elasticsearch",syntaxLoaded:a}))),t&&t.error?B.a.createElement("div",{className:"prom-query-field-info text-error"},t.error.message):null)},t}(B.a.PureComponent),W=[{label:"No pattern",value:"none"},{label:"Hourly",value:"Hourly",example:"[logstash-]YYYY.MM.DD.HH"},{label:"Daily",value:"Daily",example:"[logstash-]YYYY.MM.DD"},{label:"Weekly",value:"Weekly",example:"[logstash-]GGGG.WW"},{label:"Monthly",value:"Monthly",example:"[logstash-]YYYY.MM"},{label:"Yearly",value:"Yearly",example:"[logstash-]YYYY"}],H=[{label:"2.x",value:2},{label:"5.x",value:5},{label:"5.6+",value:56},{label:"6.0+",value:60},{label:"7.0+",value:70}],Y=function(e){var t,r=e.value,a=e.onChange;return B.a.createElement(B.a.Fragment,null,B.a.createElement("h3",{className:"page-heading"},"Elasticsearch details"),B.a.createElement("div",{className:"gf-form-group"},B.a.createElement("div",{className:"gf-form-inline"},B.a.createElement("div",{className:"gf-form max-width-25"},B.a.createElement(z.FormField,{labelWidth:10,inputWidth:15,label:"Index name",value:r.database||"",onChange:J("database",r,a),placeholder:"es-index-name",required:!0})),B.a.createElement("div",{className:"gf-form width-14"},B.a.createElement(z.FormField,{labelWidth:10,label:"Pattern",inputEl:B.a.createElement(z.Select,{options:W,onChange:K(r,a),value:W.find(function(e){return e.value===(void 0===r.jsonData.interval?"none":r.jsonData.interval)})})}))),B.a.createElement("div",{className:"gf-form max-width-25"},B.a.createElement(z.FormField,{labelWidth:10,inputWidth:15,label:"Time field name",value:r.jsonData.timeField||"",onChange:G("timeField",r,a),required:!0})),B.a.createElement("div",{className:"gf-form"},B.a.createElement("span",{className:"gf-form-select-wrapper"},B.a.createElement(z.FormField,{labelWidth:10,label:"Version",inputEl:B.a.createElement(z.Select,{options:H,onChange:function(e){var t=function(e,t){if(5===e&&t<70)return 256;if(256===e&&t>=70)return 5;return e||X(t)}(r.jsonData.maxConcurrentShardRequests,e.value);a(Object(i.__assign)(Object(i.__assign)({},r),{jsonData:Object(i.__assign)(Object(i.__assign)({},r.jsonData),{esVersion:e.value,maxConcurrentShardRequests:t})}))},value:H.find(function(e){return e.value===r.jsonData.esVersion})})}))),r.jsonData.esVersion>=56&&B.a.createElement("div",{className:"gf-form max-width-30"},B.a.createElement(z.FormField,{"aria-label":"Max concurrent Shard Requests input",labelWidth:15,label:"Max concurrent Shard Requests",value:r.jsonData.maxConcurrentShardRequests||"",onChange:G("maxConcurrentShardRequests",r,a)})),B.a.createElement("div",{className:"gf-form-inline"},B.a.createElement("div",{className:"gf-form"},B.a.createElement(z.FormField,{labelWidth:10,label:"Min time interval",inputEl:B.a.createElement(z.Input,{className:"width-6",value:r.jsonData.timeInterval||"",onChange:G("timeInterval",r,a),placeholder:"10s",validationEvents:(t={},t[z.EventsWithValidation.onBlur]=[Object(z.regexValidation)(/^\d+(ms|[Mwdhmsy])$/,"Value is not valid, you can use number with time unit specifier: y, M, w, d, h, m, s")],t)}),tooltip:B.a.createElement(B.a.Fragment,null,"A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example ",B.a.createElement("code",null,"1m")," if your data is written every minute.")})))))},J=function(e,t,r){return function(a){var n;r(Object(i.__assign)(Object(i.__assign)({},t),((n={})[e]=a.currentTarget.value,n)))}},G=function(e,t,r){return function(a){var n;r(Object(i.__assign)(Object(i.__assign)({},t),{jsonData:Object(i.__assign)(Object(i.__assign)({},t.jsonData),(n={},n[e]=a.currentTarget.value,n))}))}},K=function(e,t){return function(r){var a=e.database,n="none"===r.value?void 0:r.value;if(!a||0===a.length||a.startsWith("[logstash-]")){var s="";if(void 0!==n){var o=W.find(function(e){return e.value===n});o&&(s=o.example)}t(Object(i.__assign)(Object(i.__assign)({},e),{database:s,jsonData:Object(i.__assign)(Object(i.__assign)({},e.jsonData),{interval:n})}))}else t(Object(i.__assign)(Object(i.__assign)({},e),{jsonData:Object(i.__assign)(Object(i.__assign)({},e.jsonData),{interval:n})}))}};function X(e){return e>=70?5:256}var Z,ee,te,re,ae,ie,ne,se=function(e){var t=e.value,r=e.onChange,a=function(e){return function(a){var n;r(Object(i.__assign)(Object(i.__assign)({},t),((n={})[e]=a.currentTarget.value,n)))}};return B.a.createElement(B.a.Fragment,null,B.a.createElement("h3",{className:"page-heading"},"Logs"),B.a.createElement("div",{className:"gf-form-group"},B.a.createElement("div",{className:"gf-form max-width-30"},B.a.createElement(z.FormField,{labelWidth:11,label:"Message field name",value:t.logMessageField,onChange:a("logMessageField"),placeholder:"_source"})),B.a.createElement("div",{className:"gf-form max-width-30"},B.a.createElement(z.FormField,{labelWidth:11,label:"Level field name",value:t.logLevelField,onChange:a("logLevelField")}))))},oe=r("PAeb"),le=Object(z.stylesFactory)(function(){return{firstRow:Object(oe.css)(Z||(Z=Object(i.__makeTemplateObject)(["\n    display: flex;\n  "],["\n    display: flex;\n  "]))),nameField:Object(oe.css)(ee||(ee=Object(i.__makeTemplateObject)(["\n    flex: 2;\n  "],["\n    flex: 2;\n  "]))),regexField:Object(oe.css)(te||(te=Object(i.__makeTemplateObject)(["\n    flex: 3;\n  "],["\n    flex: 3;\n  "])))}}),ue=function(e){var t,r=e.value,a=e.onChange,n=e.onDelete,s=e.suggestions,o=e.className,l=le();return B.a.createElement("div",{className:o},B.a.createElement("div",{className:l.firstRow},B.a.createElement(z.FormField,{className:l.nameField,labelWidth:6,inputWidth:null,label:"Field",type:"text",value:r.field,tooltip:"Can be exact field name or a regex pattern that will match on the field name.",onChange:(t="field",function(e){var n;a(Object(i.__assign)(Object(i.__assign)({},r),((n={})[t]=e.currentTarget.value,n)))})}),B.a.createElement(z.Button,{variant:"inverse",title:"Remove field",icon:"fa fa-times",onClick:function(e){e.preventDefault(),n()}})),B.a.createElement(z.FormField,{label:"URL",labelWidth:6,inputEl:B.a.createElement(z.DataLinkInput,{placeholder:"http://example.com/${__value.raw}",value:r.url||"",onChange:function(e){return a(Object(i.__assign)(Object(i.__assign)({},r),{url:e}))},suggestions:s}),className:Object(oe.css)(re||(re=Object(i.__makeTemplateObject)(["\n          width: 100%;\n        "],["\n          width: 100%;\n        "])))}))},ce=Object(z.stylesFactory)(function(e){return{infoText:Object(oe.css)(ae||(ae=Object(i.__makeTemplateObject)(["\n    padding-bottom: ",";\n    color: ",";\n  "],["\n    padding-bottom: ",";\n    color: ",";\n  "])),e.spacing.md,e.colors.textWeak),dataLink:Object(oe.css)(ie||(ie=Object(i.__makeTemplateObject)(["\n    margin-bottom: ",";\n  "],["\n    margin-bottom: ",";\n  "])),e.spacing.sm)}}),ge=function(e){var t=e.value,r=e.onChange,a=Object(z.useTheme)(),n=ce(a);return B.a.createElement(B.a.Fragment,null,B.a.createElement("h3",{className:"page-heading"},"Data links"),B.a.createElement("div",{className:n.infoText},"Add links to existing fields. Links will be shown in log row details next to the field value."),B.a.createElement("div",{className:"gf-form-group"},t&&t.map(function(e,a){return B.a.createElement(ue,{className:n.dataLink,key:a,value:e,onChange:function(e){var n=Object(i.__spread)(t);n.splice(a,1,e),r(n)},onDelete:function(){var e=Object(i.__spread)(t);e.splice(a,1),r(e)},suggestions:[{value:z.DataLinkBuiltInVars.valueRaw,label:"Raw value",documentation:"Raw value of the field",origin:z.VariableOrigin.Value}]})}),B.a.createElement("div",null,B.a.createElement(z.Button,{variant:"inverse",className:Object(oe.css)(ne||(ne=Object(i.__makeTemplateObject)(["\n              margin-right: 10px;\n            "],["\n              margin-right: 10px;\n            "]))),icon:"fa fa-plus",onClick:function(e){e.preventDefault();var a=Object(i.__spread)(t||[],[{field:"",url:""}]);r(a)}},"Add"))))};r.d(t,"plugin",function(){return pe});var de=function(){function e(){}return e.templateUrl="partials/annotations.editor.html",e}(),pe=new a.DataSourcePlugin(M).setQueryCtrl(P).setConfigEditor(function(e){var t=e.options,r=e.onOptionsChange;return Object(R.useEffect)(function(){var e=t.jsonData.esVersion||5;r(Object(i.__assign)(Object(i.__assign)({},t),{jsonData:Object(i.__assign)(Object(i.__assign)({},t.jsonData),{timeField:t.jsonData.timeField||"@timestamp",esVersion:e,maxConcurrentShardRequests:t.jsonData.maxConcurrentShardRequests||X(e),logMessageField:t.jsonData.logMessageField||"",logLevelField:t.jsonData.logLevelField||""})}))},[]),B.a.createElement(B.a.Fragment,null,B.a.createElement(z.DataSourceHttpSettings,{defaultUrl:"http://localhost:9200",dataSourceConfig:t,showAccessOptions:!0,onChange:r}),B.a.createElement(Y,{value:t,onChange:r}),B.a.createElement(se,{value:t.jsonData,onChange:function(e){return r(Object(i.__assign)(Object(i.__assign)({},t),{jsonData:e}))}}),B.a.createElement(ge,{value:t.jsonData.dataLinks,onChange:function(e){r(Object(i.__assign)(Object(i.__assign)({},t),{jsonData:Object(i.__assign)(Object(i.__assign)({},t.jsonData),{dataLinks:e})}))}}))}).setExploreLogsQueryField(U).setAnnotationQueryCtrl(de)}}]);
//# sourceMappingURL=elasticsearchPlugin.4d0490a94b199a11f40c.js.map