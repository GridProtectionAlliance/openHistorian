"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9711],{64853:(W,A,s)=>{s.d(A,{_:()=>C});var t=s(74848),a=s(2543),d=s.n(a),M=s(19073);const C=({actions:l,children:i})=>{const e=(0,a.filter)(l,O),f=(0,a.filter)(l,v);return e.length?(0,t.jsx)(m,{actions:e,children:i}):f.length?(0,t.jsx)(j,{actions:f,children:i}):null},m=({actions:l,children:i})=>{const e=(0,M.iI)();return P(e,l)?(0,t.jsx)(t.Fragment,{children:i}):null},j=({actions:l,children:i})=>{const e=(0,M.e2)();return P(e,l)?(0,t.jsx)(t.Fragment,{children:i}):null};function P(l,i){return(0,a.chain)(l).pick(i).values().value().some(([e,f])=>f===!0)}function O(l){return Object.values(M.QI).includes(l)}function v(l){return Object.values(M.RY).includes(l)}},26928:(W,A,s)=>{s.d(A,{s:()=>v});var t=s(74848),a=s(32196),d=s(2543),M=s.n(d),C=s(40845),m=s(67061),j=s(69613),P=s(32642),O=s(35108);const v=({matchers:e,formatter:f="default"})=>{const y=(0,C.of)(i),E=5,N=(0,d.take)(e,E),w=(0,d.takeRight)(e,e.length-E),U=w.length>0;return(0,t.jsx)("span",{"data-testid":"label-matchers",children:(0,t.jsxs)(m.B,{direction:"row",gap:1,alignItems:"center",wrap:"wrap",children:[N.map(S=>(0,t.jsx)(l,{matcher:S,formatter:f},(0,d.uniqueId)())),U&&(0,t.jsx)(O.B,{arrow:!0,placement:"top",content:(0,t.jsx)(t.Fragment,{children:w.map(S=>(0,t.jsx)(l,{matcher:S},(0,d.uniqueId)()))}),children:(0,t.jsx)("span",{children:(0,t.jsx)("div",{className:y.metadata,children:`and ${w.length} more`})})})]})})},l=({matcher:e,formatter:f="default"})=>{const y=(0,C.of)(i);return(0,t.jsx)("div",{className:y.matcher(e[0]).wrapper,children:(0,t.jsx)(m.B,{direction:"row",gap:0,alignItems:"baseline",children:P.t8[f](e)})})},i=e=>({matcher:f=>{const{color:y,borderColor:E}=(0,j.MC)(f);return{wrapper:(0,a.css)({color:"#fff",background:y,padding:`${e.spacing(.33)} ${e.spacing(.66)}`,fontSize:e.typography.bodySmall.fontSize,border:`solid 1px ${E}`,borderRadius:e.shape.borderRadius(2),whiteSpace:"pre"})}},metadata:(0,a.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.bodySmall.fontWeight})})},39711:(W,A,s)=>{s.r(A),s.d(A,{default:()=>gt});var t=s(74848),a=s(32196),d=s(40845),M=s(42418),C=s(39558),m=s(66602),j=s(87286),P=s(2543),O=s(55127),v=s.n(O),l=s(96540),i=s(42941),e=s(55852),f=s(69613),y=s(64149),E=s(98164),N=s(64047),w=s(55196),U=s(26058),S=s(26928);function K(n){return n.path?.length===0}function k(n){const r=new Map;function g(c,p=[]){r.set(c.id,{...c,path:p}),c.routes?.forEach(o=>g(o,[...p,c.id]))}return g(n,[]),r}function z(n){return n.object_matchers?.length===0}function Q({route:n,matcherFormatter:r}){const g=(0,d.of)(V);return K(n)?(0,t.jsx)("div",{className:g.defaultPolicy,children:"Default policy"}):z(n)?(0,t.jsx)("div",{className:g.textMuted,children:"No matchers"}):(0,t.jsx)(S.s,{matchers:n.object_matchers??[],formatter:r})}const V=n=>({defaultPolicy:(0,a.css)({padding:n.spacing(.5),background:n.colors.background.secondary,width:"fit-content"}),textMuted:(0,a.css)({color:n.colors.text.secondary})});var Y=s(37390),$=s(67061),J=s(14578),X=s(19073),Z=s(70383),q=s(78742),_=s(64853);function tt({route:n,routesByIdMap:r,matcherFormatter:g}){const c=(0,d.of)(F),p=n.path?.slice(1)??[],o=[...(0,P.compact)(p.map(u=>r.get(u))),n];return(0,t.jsxs)("div",{className:c.policyPathWrapper,children:[(0,t.jsx)("div",{className:c.defaultPolicy,children:"Default policy"}),o.map((u,x)=>(0,t.jsx)("div",{children:(0,t.jsx)("div",{className:c.policyInPath(x,x===o.length-1),children:z(u)?(0,t.jsx)("div",{className:c.textMuted,children:"No matchers"}):(0,t.jsx)(S.s,{matchers:u.object_matchers??[],formatter:g})})},u.id))]})}function nt({onClose:n,route:r,receiver:g,routesByIdMap:c,alertManagerSourceName:p}){const o=(0,d.of)(F),u=K(r);return(0,t.jsx)(Z.b9,{accessType:"notification",alertmanagerSourceName:p,children:(0,t.jsx)(Y.a,{className:o.detailsModal,isOpen:!0,title:"Routing details",onDismiss:n,onClickBackdrop:n,children:(0,t.jsxs)($.B,{gap:0,direction:"column",children:[(0,t.jsx)("div",{className:(0,a.cx)(o.textMuted,o.marginBottom(2)),children:"Your alert instances are routed as follows."}),(0,t.jsx)("div",{children:"Notification policy path"}),u&&(0,t.jsx)("div",{className:o.textMuted,children:"Default policy"}),(0,t.jsx)("div",{className:o.separator(1)}),!u&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(tt,{route:r,routesByIdMap:c,matcherFormatter:(0,E.VE)(p)})}),(0,t.jsx)("div",{className:o.separator(4)}),(0,t.jsxs)("div",{className:o.contactPoint,children:[(0,t.jsxs)($.B,{gap:1,direction:"row",alignItems:"center",children:["Contact point:",(0,t.jsx)("span",{className:o.textMuted,children:g.name})]}),(0,t.jsx)(_._,{actions:[X.QI.UpdateContactPoint],children:(0,t.jsx)($.B,{gap:1,direction:"row",alignItems:"center",children:(0,t.jsxs)("a",{href:(0,q.nL)(`/alerting/notifications/receivers/${encodeURIComponent(g.name)}/edit`,p),className:o.link,target:"_blank",rel:"noreferrer",children:["See details ",(0,t.jsx)(J.I,{name:"external-link-alt"})]})})})]}),(0,t.jsx)("div",{className:o.button,children:(0,t.jsx)(e.$n,{variant:"primary",type:"button",onClick:n,children:"Close"})})]})})})}const F=n=>({textMuted:(0,a.css)({color:n.colors.text.secondary}),link:(0,a.css)({display:"block",color:n.colors.text.link}),button:(0,a.css)({justifyContent:"flex-end",display:"flex"}),detailsModal:(0,a.css)({maxWidth:"560px"}),defaultPolicy:(0,a.css)({padding:n.spacing(.5),background:n.colors.background.secondary,width:"fit-content"}),contactPoint:(0,a.css)({display:"flex",flexDirection:"row",gap:n.spacing(1),alignItems:"center",justifyContent:"space-between",marginBottom:n.spacing(1)}),policyPathWrapper:(0,a.css)({display:"flex",flexDirection:"column",marginTop:n.spacing(1)}),separator:r=>(0,a.css)({marginTop:n.spacing(r)}),marginBottom:r=>(0,a.css)({marginBottom:n.spacing(n.spacing(r))}),policyInPath:(r=0,g=!1)=>(0,a.css)({marginLeft:`${30+r*30}px`,padding:n.spacing(1),marginTop:n.spacing(1),border:`solid 1px ${g?n.colors.info.border:n.colors.border.weak}`,background:n.colors.background.secondary,width:"fit-content",position:"relative","&:before":{content:'""',position:"absolute",height:"calc(100% - 10px)",width:n.spacing(1),borderLeft:`solid 1px ${n.colors.border.weak}`,borderBottom:`solid 1px ${n.colors.border.weak}`,marginTop:n.spacing(-2),marginLeft:"-17px"}})});function st({route:n,receiver:r,routesByIdMap:g,instancesCount:c,alertManagerSourceName:p,expandRoute:o,onExpandRouteClick:u}){const x=(0,d.of)(H),[D,T]=(0,l.useState)(!1),R=()=>{T(!0)};return(0,t.jsxs)("div",{className:x.routeHeader,children:[(0,t.jsx)(N.e,{isCollapsed:!o,onToggle:L=>u(!L),"aria-label":"Expand policy route"}),(0,t.jsxs)(j.B,{flexGrow:1,gap:1,children:[(0,t.jsx)("div",{onClick:()=>u(!o),className:x.expandable,children:(0,t.jsxs)(j.B,{gap:1,direction:"row",alignItems:"center",children:["Notification policy",(0,t.jsx)(Q,{route:n,matcherFormatter:(0,E.VE)(p)})]})}),(0,t.jsx)(U.h,{}),(0,t.jsxs)(j.B,{gap:2,direction:"row",alignItems:"center",children:[(0,t.jsxs)(w.P,{icon:"layers-alt","data-testid":"matching-instances",children:[c??"-"," ",v()("instance",c)]}),(0,t.jsxs)(j.B,{gap:1,direction:"row",alignItems:"center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:x.textMuted,children:"@ Delivered to"})," ",r.name]}),(0,t.jsx)("div",{className:x.verticalBar}),(0,t.jsx)(e.$n,{type:"button",onClick:R,variant:"secondary",fill:"outline",size:"sm",children:"See details"})]})]})]}),D&&(0,t.jsx)(nt,{onClose:()=>T(!1),route:n,receiver:r,routesByIdMap:g,alertManagerSourceName:p})]})}function at({route:n,instanceMatches:r,receiver:g,routesByIdMap:c,alertManagerSourceName:p}){const o=(0,d.of)(H),[u,x]=(0,i.A)(!1),D=9;return(0,t.jsxs)("div",{"data-testid":"matching-policy-route",children:[(0,t.jsx)(st,{route:n,receiver:g,routesByIdMap:c,instancesCount:r.length,alertManagerSourceName:p,expandRoute:u,onExpandRouteClick:x}),u&&(0,t.jsx)(j.B,{gap:1,direction:"column",children:(0,t.jsx)("div",{className:o.routeInstances,"data-testid":"route-matching-instance",children:r.map(T=>{const R=Array.from(T.labelsMatch),L=R.map(([h,B])=>({label:`${h[0]}=${h[1]}`,match:B.match,colorIndex:B.match?(0,f.JF)(h[0]):D})),I=L.filter(h=>h.match),b=L.filter(h=>!h.match);return(0,t.jsx)("div",{className:o.tagListCard,children:R.length>0?(0,t.jsxs)(t.Fragment,{children:[I.length>0?(0,t.jsx)(y.L,{tags:I.map(h=>h.label),className:o.labelList,getColorIndex:(h,B)=>I[B].colorIndex}):(0,t.jsx)("div",{className:(0,a.cx)(o.textMuted,o.textItalic),children:"No matching labels"}),(0,t.jsx)("div",{className:o.labelSeparator}),(0,t.jsx)(y.L,{tags:b.map(h=>h.label),className:o.labelList,getColorIndex:(h,B)=>b[B].colorIndex})]}):(0,t.jsx)("div",{className:o.textMuted,children:"No labels"})},(0,P.uniqueId)())})})})]})}const H=n=>({textMuted:(0,a.css)({color:n.colors.text.secondary}),textItalic:(0,a.css)({fontStyle:"italic"}),expandable:(0,a.css)({cursor:"pointer"}),routeHeader:(0,a.css)({display:"flex",flexDirection:"row",gap:n.spacing(1),alignItems:"center",borderBottom:`1px solid ${n.colors.border.weak}`,padding:n.spacing(.5,.5,.5,0),"&:hover":{backgroundColor:n.components.table.rowHoverBackground}}),labelList:(0,a.css)({flex:"0 1 auto",justifyContent:"flex-start"}),labelSeparator:(0,a.css)({width:"1px",backgroundColor:n.colors.border.weak}),tagListCard:(0,a.css)({display:"flex",flexDirection:"row",gap:n.spacing(2),position:"relative",background:n.colors.background.secondary,padding:n.spacing(1),borderRadius:n.shape.borderRadius(2),border:`solid 1px ${n.colors.border.weak}`}),routeInstances:(0,a.css)({padding:n.spacing(1,0,1,4),position:"relative",display:"flex",flexDirection:"column",gap:n.spacing(1),"&:before":{content:'""',position:"absolute",left:n.spacing(2),height:`calc(100% - ${n.spacing(2)})`,width:n.spacing(4),borderLeft:`solid 1px ${n.colors.border.weak}`}}),verticalBar:(0,a.css)({width:"1px",height:"20px",backgroundColor:n.colors.secondary.main,marginLeft:n.spacing(1),marginRight:n.spacing(1)})});var ot=s(16817),et=s(51488),rt=s(19143),it=s(79657),ct=s(57220),G=s(79581);const lt=(n,r)=>{const{currentData:g,isLoading:c,error:p}=(0,et.f)(n),o=g?.alertmanager_config,{matchInstancesToRoute:u}=(0,rt.L)(),{rootRoute:x,receivers:D}=(0,l.useMemo)(()=>o?{rootRoute:o.route?(0,G.rJ)((0,it.QM)(o.route)):void 0,receivers:o.receivers??[]}:{receivers:[],rootRoute:void 0},[o]),T=x?k((0,G._I)(x)):new Map,R=D.reduce((h,B)=>h.set(B.name,B),new Map)??new Map,{value:L=new Map,loading:I,error:b}=(0,ot.A)(async()=>{if(x)return await u(x,r,{unquoteMatchers:n!==ct.hY})},[x,r]);return{routesByIdMap:T,receiversByName:R,matchingMap:L,loading:c||I,error:p??b}};function dt({alertManagerSource:n,potentialInstances:r,onlyOneAM:g}){const c=(0,d.of)(ut),{routesByIdMap:p,receiversByName:o,matchingMap:u,loading:x,error:D}=lt(n.name,r);return D?(0,t.jsx)(M.F,{title:"Cannot load Alertmanager configuration",severity:"error",children:D.message}):x?(0,t.jsx)(C._,{text:"Loading routing preview..."}):u.size>0?(0,t.jsxs)("div",{className:c.alertManagerRow,children:[!g&&(0,t.jsxs)(j.B,{direction:"row",alignItems:"center",children:[(0,t.jsx)("div",{className:c.firstAlertManagerLine}),(0,t.jsxs)("div",{className:c.alertManagerName,children:[" ","Alertmanager:",(0,t.jsx)("img",{src:n.imgUrl,alt:"",className:c.img}),n.name]}),(0,t.jsx)("div",{className:c.secondAlertManagerLine})]}),(0,t.jsx)(j.B,{gap:1,direction:"column",children:Array.from(u.entries()).map(([R,L])=>{const I=p.get(R),b=I?.receiver&&o.get(I.receiver);if(!I)return null;if(!b)throw new Error("Receiver not found");return(0,t.jsx)(at,{instanceMatches:L,route:I,receiver:b,routesByIdMap:p,alertManagerSourceName:n.name},R)})})]}):null}const gt=(0,m.Xc)(dt),ut=n=>({alertManagerRow:(0,a.css)({display:"flex",flexDirection:"column",gap:n.spacing(1),width:"100%"}),firstAlertManagerLine:(0,a.css)({height:"1px",width:n.spacing(4),backgroundColor:n.colors.secondary.main}),alertManagerName:(0,a.css)({width:"fit-content"}),secondAlertManagerLine:(0,a.css)({height:"1px",width:"100%",flex:1,backgroundColor:n.colors.secondary.main}),img:(0,a.css)({marginLeft:n.spacing(2),width:n.spacing(3),height:n.spacing(3),marginRight:n.spacing(1)})})},51488:(W,A,s)=>{s.d(A,{f:()=>a});var t=s(82843);function a(d,M){const C=t.m.endpoints.getAlertmanagerConfiguration.useQuery(d??"",{refetchOnMountOrArgChange:!0,...M,skip:!d});return{...C,error:C.error}}},19143:(W,A,s)=>{s.d(A,{L:()=>O});var t=s(14590),a=s(96540),d=s(25027),M=s(67278);const C=()=>new M.c(new URL(s.p+s.u(5398),s.b));let m;function j(){let v;if(m===void 0)try{v=C(),m=t.LV(v)}catch(i){i instanceof Error&&(0,d.vV)(i)}return{disposeWorker:()=>{v&&m&&(m[t.A2](),v.terminate(),m=void 0,v=void 0)}}}function P(v){if(!m)throw new Error("Route Matcher has not been initialized")}function O(){(0,a.useEffect)(()=>{const{disposeWorker:i}=j();return i},[]);const v=(0,a.useCallback)(async(i,e,f)=>{P(m);const y=performance.now(),E=await m.getRouteGroupsMap(i,e,f),N=performance.now()-y;return(0,d.fH)(`Route Groups Matched in  ${N} ms`,{matchingTime:N.toString(),alertGroupsCount:e.length.toString(),topLevelRoutesCount:i.routes?.length.toString()??"0"}),E},[]),l=(0,a.useCallback)(async(i,e,f)=>{P(m);const y=performance.now(),E=await m.matchInstancesToRoute(i,e,f),N=performance.now()-y;return(0,d.fH)(`Instances Matched in  ${N} ms`,{matchingTime:N.toString(),instancesToMatchCount:e.length.toString(),topLevelRoutesCount:i.routes?.length.toString()??"0"}),E},[]);return{getRouteGroupsMap:v,matchInstancesToRoute:l}}}}]);

//# sourceMappingURL=9711.9bbb489fb2ca3baed3d3.js.map