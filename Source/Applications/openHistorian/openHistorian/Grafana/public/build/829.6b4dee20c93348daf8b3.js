"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[829],{39184:(je,q,t)=>{t.d(q,{u:()=>x});var e=t(74848),r=t(32196),g=t(96540),p=t(40845),O=t(94753),m=t(42418),f=t(67061),j=t(90182),w=t(29158),W=t(79633),U=t(70383),J=t(93667);const R=500,h=v=>new Promise(N=>setTimeout(N,v)),s=1e3,x=({selectProps:v,showRefreshButton:N,selectedContactPointName:V})=>{const{selectedAlertmanager:H}=(0,U.VI)(),{contactPoints:_,isLoading:G,error:P,refetch:D}=(0,J.dK)({alertmanager:H}),[B,z]=(0,g.useState)(!1),oe=(0,p.of)(y),Y=_.map(ee=>({label:ee.name,value:ee,component:()=>(0,e.jsx)(O.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(W.yz,{receivers:ee.grafana_managed_receiver_configs,limit:2})})})),X=(0,g.useMemo)(()=>Y.find(ee=>ee.value?.name===V)||null,[Y,V]),ye=()=>{z(!0),Promise.all([D(),h(s)]).finally(()=>{z(!1)})};return P?(0,e.jsx)(m.F,{title:"Failed to fetch contact points",severity:"error"}):(0,e.jsxs)(f.B,{children:[(0,e.jsx)(j.l6,{virtualized:Y.length>R,options:Y,value:X,...v,isLoading:G}),N&&(0,e.jsx)(w.K,{name:"sync",onClick:ye,"aria-label":"Refresh contact points",tooltip:"Refresh contact points list",className:(0,r.cx)(oe.refreshButton,{[oe.loading]:B||G})})]})},E=(0,r.keyframes)({from:{transform:"rotate(0deg)"},to:{transform:"rotate(720deg)"}}),y=v=>({refreshButton:(0,r.css)({color:v.colors.text.secondary,cursor:"pointer",borderRadius:v.shape.radius.circle,overflow:"hidden"}),loading:(0,r.css)({pointerEvents:"none",[v.transitions.handleMotion("no-preference")]:{animation:`${E} 2s infinite linear`},[v.transitions.handleMotion("reduce")]:{animation:`${E} 6s infinite linear`}})})},99226:(je,q,t)=>{t.d(q,{gv:()=>U});var e=t(74848),r=t(2543),g=t.n(r),p=t(32264),O=t(67061),m=t(55852),f=t(25968);const j=p.$.unifiedAlerting.minInterval??"10s",W=((J=j)=>{const h=[(0,f.M9)("10s"),(0,f.M9)("30s"),(0,f.M9)("1m"),(0,f.M9)("5m"),(0,f.M9)("10m"),(0,f.M9)("15m"),(0,f.M9)("30m"),(0,f.M9)("1h")],s=(0,f.P8)(J),x=h.filter(y=>s<=y),E=(0,r.times)(8-x.length,y=>{const v=(0,r.last)(x)??s,N=x.length===0?1:2;return v*N*(y+1)});return[...x,...E].map(f.an)})(j),U=({currentInterval:J,onSelect:R})=>(0,e.jsx)(O.B,{direction:"row",gap:.5,role:"listbox",children:W.map(h=>{const s=J===h;return(0,e.jsx)(m.$n,{role:"option","aria-selected":s,variant:s?"primary":"secondary",size:"sm",onClick:()=>R(h),children:h},h)})})},1723:(je,q,t)=>{t.d(q,{R:()=>Je,I:()=>Te});var e=t(74848),r=t(32196),g=t(96540),p=t(49785),O=t(40845),m=t(67061),f=t(29158),j=t(88575),w=t(60029),W=t(10354),U=t(94753),J=t(15292),R=t(56034),h=t(14578),s=t(8484),x=t(23662),E=t(25027),y=t(9518),v=t(61410),N=t(57220),V=t(25968),H=t(64047),_=t(46479),G=t(2543),P=t(26272),D=t(13544),B=t(55852),z=t(90182),oe=t(90613),Y=t(37390),X=t(28138),ye=t(16233),ee=t(11230),Ne=t(31678),Fe=t(79938),De=t(77583),Ie=t(63066),Ae=t(48205),I=t(99226),C=t(85242);const A=()=>{const n=(0,O.of)(se),a=()=>window.open("https://github.com/grafana/grafana/issues/42947","_blank");return(0,e.jsxs)(m.B,{gap:.5,children:[(0,e.jsx)("div",{className:n.slashNotAllowed,children:"Folders with '/' character are not allowed."}),(0,e.jsx)(R.m,{placement:"top",content:"Link to the Github issue",theme:"info",children:(0,e.jsx)(h.I,{name:"info-circle",size:"xs",className:n.infoIcon,onClick:a})})]})},L=n=>n.indexOf("/")!==-1;function ae(n){const{value:a}=n,i={warningCondition:u=>L(u),warningComponent:A},o={disallowValues:!0,isAllowedValue:u=>!L(u)};return(0,e.jsx)(C.sR,{showRoot:!1,rootName:"",allowEmpty:!0,initialFolderUid:a?.uid,searchQueryType:Ne.SearchQueryType.AlertFolder,...n,permissionLevel:Ne.PermissionLevelString.Edit,customAdd:o,folderWarning:i})}const se=n=>({slashNotAllowed:(0,r.css)({color:n.colors.warning.main,fontSize:"12px",marginBottom:"2px"}),infoIcon:(0,r.css)({color:n.colors.warning.main,fontSize:"12px",marginBottom:"2px",cursor:"pointer"})}),te=1e3,K=(n,a)=>{const{isLoading:l,currentData:i}=Fe.hK.endpoints.rulerNamespace.useQuery({namespace:n,rulerConfig:De.b},{skip:!n,refetchOnMountOrArgChange:!0});return{groupOptions:(0,g.useMemo)(()=>i?(Object.values(i).flat()??[]).map(d=>{const c=pe(d);return{label:d.name,value:d.name,description:d.interval??Ie.T6,isDisabled:a?!1:c,isProvisioned:c}}).sort(Be):[],[i,a]),loading:l}},pe=n=>n.rules.some(a=>(0,x.lT)(a)&&!!a.grafana_alert.provenance),Be=(n,a)=>n.label?.localeCompare(a.label??"")||0,Le=(n,a)=>n.label?.toLowerCase().includes(a.toLowerCase());function Ke({groupfoldersForGrafana:n,enableProvisionedGroups:a}){const{formState:{errors:l},watch:i,setValue:o,control:u}=(0,p.xW)(),d=(0,O.of)(me),[c,M,S]=i(["folder","group","type"]),b=S?(0,x.pq)(S):!1,{groupOptions:$,loading:ce}=K(c?.uid??"",a),[k,T]=(0,g.useState)(!1),[le,Q]=(0,g.useState)(!1),F=()=>T(!0),Me=()=>Q(!0),ge=de=>{he(),o("folder",de),T(!1)},Oe=(de,ie)=>{o("group",de),o("evaluateEvery",ie),Q(!1)},he=(0,g.useCallback)(()=>{o("group","")},[o]),xe=(0,g.useCallback)(async de=>{const ie=de?$.filter(Ge=>Le(Ge,de)):$;return(0,G.take)(ie,te)},[$]),ne=(0,g.useMemo)(()=>(0,G.debounce)(xe,300,{leading:!0}),[xe]),Pe=M?{value:M,label:M}:void 0,He=b?(0,s.t)("alerting.folderAndGroup.evaluation.text.recording","Define how often the recording rule is evaluated."):(0,s.t)("alerting.folderAndGroup.evaluation.text.alerting","Define how often the alert rule is evaluated.");return(0,e.jsxs)("div",{className:d.container,children:[(0,e.jsxs)(m.B,{alignItems:"center",children:[(0,e.jsx)(j.D,{label:(0,e.jsx)(w.J,{htmlFor:"folder",description:"Select a folder to store your rule.",children:"Folder"}),className:d.formInput,error:l.folder?.message,"data-testid":"folder-picker",children:(0,e.jsx)(m.B,{direction:"row",alignItems:"center",children:!k&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(p.xI,{render:({field:{ref:de,...ie}})=>(0,e.jsx)("div",{style:{width:420},children:(0,e.jsx)(ae,{inputId:"folder",invalid:!!l.folder?.message,...ie,enableReset:!0,onChange:({title:Ge,uid:Ee})=>{ie.onChange({title:Ge,uid:Ee}),he()}})}),name:"folder",rules:{required:{value:!0,message:"Select a folder"}}}),(0,e.jsx)(U.E,{color:"secondary",children:"or"}),(0,e.jsx)(B.$n,{onClick:F,type:"button",icon:"plus",fill:"outline",variant:"secondary",disabled:!ye.TP.hasPermission(Ne.AccessControlAction.FoldersCreate),"data-testid":D.Tp.components.AlertRules.newFolderButton,children:"New folder"})]})||(0,e.jsx)("div",{children:"Creating new folder..."})})}),k&&(0,e.jsx)(Se,{onCreate:ge,onClose:()=>T(!1)})]}),k&&(0,e.jsx)(Se,{onCreate:ge,onClose:()=>T(!1)}),(0,e.jsxs)(m.B,{alignItems:"center",children:[(0,e.jsx)("div",{style:{width:420},children:(0,e.jsx)(j.D,{label:"Evaluation group and interval","data-testid":"group-picker",description:He,className:d.formInput,error:l.group?.message,invalid:!!l.group?.message,htmlFor:"group",children:(0,e.jsx)(p.xI,{render:({field:{ref:de,...ie},fieldState:Ge})=>(0,e.jsx)(z.DW,{disabled:!c||ce,inputId:"group",...ie,onChange:Ee=>{ie.onChange(Ee.label??"")},isLoading:ce,invalid:!!c&&!M&&!!Ge.error,loadOptions:ne,cacheOptions:!0,loadingMessage:"Loading groups...",defaultValue:Pe,defaultOptions:$,getOptionLabel:Ee=>(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{children:Ee.label}),Ee.isProvisioned&&(0,e.jsxs)(e.Fragment,{children:[" ",(0,e.jsx)(Ae.rS,{})]})]}),placeholder:"Select an evaluation group..."},(0,G.uniqueId)()),name:"group",control:u,rules:{required:{value:!0,message:"Must enter a group name"}}})})}),(0,e.jsxs)(oe.a,{marginTop:4,gap:1,display:"flex",alignItems:"center",children:[(0,e.jsx)(U.E,{color:"secondary",children:"or"}),(0,e.jsx)(B.$n,{onClick:Me,type:"button",icon:"plus",fill:"outline",variant:"secondary",disabled:!c,"data-testid":D.Tp.components.AlertRules.newEvaluationGroupButton,children:"New evaluation group"})]}),le&&(0,e.jsx)(be,{onCreate:Oe,onClose:()=>Q(!1),groupfoldersForGrafana:n})]})]})}function Se({onClose:n,onCreate:a}){const l=(0,O.of)(me),[i,o]=(0,g.useState)(""),u=async()=>{const c=await(0,ee.vV)({title:i});if(!c.uid){X.A.emit(P.r1.alertError,["Folder could not be created"]);return}const M={title:c.title,uid:c.uid};a(M),X.A.emit(P.r1.alertSuccess,["Folder Created","OK"])},d=L(i);return(0,e.jsxs)(Y.a,{className:l.modal,isOpen:!0,title:"New folder",onDismiss:n,onClickBackdrop:n,children:[(0,e.jsx)("div",{className:l.modalTitle,children:"Create a new folder to store your rule"}),(0,e.jsxs)("form",{onSubmit:u,children:[(0,e.jsx)(j.D,{label:(0,e.jsx)(w.J,{htmlFor:"folder",children:"Folder name"}),error:"The folder name can't contain slashes",invalid:d,children:(0,e.jsx)(W.p,{"data-testid":D.Tp.components.AlertRules.newFolderNameField,autoFocus:!0,id:"folderName",placeholder:"Enter a name",value:i,onChange:c=>o(c.currentTarget.value),className:l.formInput})}),(0,e.jsxs)(Y.a.ButtonRow,{children:[(0,e.jsx)(B.$n,{variant:"secondary",type:"button",onClick:n,children:"Cancel"}),(0,e.jsx)(B.$n,{type:"submit",disabled:!i||d,"data-testid":D.Tp.components.AlertRules.newFolderNameCreateButton,children:"Create"})]})]})]})}function be({onClose:n,onCreate:a,groupfoldersForGrafana:l}){const i=(0,O.of)(me),o=()=>{a(ge("group"),ge("evaluateEvery"))},{watch:u}=(0,p.xW)(),d="eval-every-input",c="new-eval-group-name",[M,S,b]=u(["group","folder.title","type"]),$=b?(0,x.pq)(b):!1,ce=(l&&l[S]?.find(Pe=>Pe.name===M)?.rules)??[],k=()=>{n()},T=(0,p.mN)({defaultValues:{group:"",evaluateEvery:Ie.T6},mode:"onChange",shouldFocusError:!0}),{register:le,handleSubmit:Q,formState:F,setValue:Me,getValues:ge,watch:Oe}=T,he=Oe("evaluateEvery"),xe=Pe=>{Me("evaluateEvery",Pe,{shouldValidate:!0})},ne=$?(0,s.t)("alerting.folderAndGroup.evaluation.modal.text.recording","Create a new evaluation group to use for this recording rule."):(0,s.t)("alerting.folderAndGroup.evaluation.modal.text.alerting","Create a new evaluation group to use for this alert rule.");return(0,e.jsxs)(Y.a,{className:i.modal,isOpen:!0,title:"New evaluation group",onDismiss:k,onClickBackdrop:k,children:[(0,e.jsx)("div",{className:i.modalTitle,children:ne}),(0,e.jsx)(p.Op,{...T,children:(0,e.jsxs)("form",{onSubmit:Q(()=>o()),children:[(0,e.jsx)(j.D,{label:(0,e.jsx)(w.J,{htmlFor:c,description:"A group evaluates all its rules over the same evaluation interval.",children:"Evaluation group name"}),error:F.errors.group?.message,invalid:!!F.errors.group,children:(0,e.jsx)(W.p,{"data-testid":D.Tp.components.AlertRules.newEvaluationGroupName,className:i.formInput,autoFocus:!0,id:c,placeholder:"Enter a name",...le("group",{required:{value:!0,message:"Required."}})})}),(0,e.jsx)(j.D,{error:F.errors.evaluateEvery?.message,label:(0,e.jsx)(w.J,{htmlFor:d,description:"How often all rules in the group are evaluated.",children:"Evaluation interval"}),invalid:!!F.errors.evaluateEvery,children:(0,e.jsx)(W.p,{"data-testid":D.Tp.components.AlertRules.newEvaluationGroupInterval,className:i.formInput,id:d,placeholder:Ie.T6,...le("evaluateEvery",(0,_.iS)(ce))})}),(0,e.jsx)(I.gv,{currentInterval:he,onSelect:xe}),(0,e.jsxs)(Y.a.ButtonRow,{children:[(0,e.jsx)(B.$n,{variant:"secondary",type:"button",onClick:k,children:"Cancel"}),(0,e.jsx)(B.$n,{type:"submit",disabled:!F.isValid,"data-testid":D.Tp.components.AlertRules.newEvaluationGroupCreate,children:"Create"})]})]})})]})}const me=n=>({container:(0,r.css)({display:"flex",flexDirection:"column",alignItems:"baseline",maxWidth:`${n.breakpoints.values.lg}px`,justifyContent:"space-between"}),formInput:(0,r.css)({flexGrow:1}),modal:(0,r.css)({width:`${n.breakpoints.values.sm}px`}),modalTitle:(0,r.css)({color:n.colors.text.secondary,marginBottom:n.spacing(2)})});var re=t(94822);const ve=[{value:re.Q8.Alerting,label:"Alerting"},{value:re.Q8.NoData,label:"No Data"},{value:re.Q8.OK,label:"Normal"},{value:re.Q8.Error,label:"Error"},{value:re.Q8.KeepLast,label:"Keep Last State"}],fe=({includeNoData:n,includeError:a,...l})=>{const i=(0,g.useMemo)(()=>n?a?ve:ve.filter(o=>o.value!==re.Q8.Error):ve.filter(o=>o.value!==re.Q8.NoData),[n,a]);return(0,e.jsx)(z.l6,{options:i,...l})};var Z=t(19338);function we(n){const a=(0,V.P8)(n);return[0,a*1,a*2,a*3,a*4,a*5].map(V.an)}function We({selectedPendingPeriod:n,groupEvaluationInterval:a,onSelect:l}){const i=u=>n===u,o=we(a);return(0,e.jsx)(m.B,{direction:"row",gap:.5,role:"listbox",children:o.map(u=>(0,e.jsx)(B.$n,{role:"option","aria-selected":i(u),variant:i(u)?"primary":"secondary",size:"sm",onClick:()=>{l(u)},children:u==="0s"?"None":u},u))})}var Ue=t(271);const Te=10,Ve=n=>({required:{value:!0,message:"Required."},validate:a=>{if(a==="0")return!0;try{const l=(0,V.M9)(a);if(l===0)return!0;try{const i=(0,V.M9)(n);return l>=i?!0:(0,s.t)("alert-rule-form.evaluation-behaviour-for.validation","Pending period must be greater than or equal to the evaluation interval.")}catch{return!0}}catch(l){return l instanceof Error?l.message:(0,s.t)("alert-rule-form.evaluation-behaviour-for.error-parsing","Failed to parse duration")}}}),Re=(n,a)=>{const{groupOptions:l}=K(n,!1);return!(0,g.useCallback)(o=>l.some(u=>u.label===o),[l])(a)};function ze({evaluateEvery:n,setEvaluateEvery:a,enableProvisionedGroups:l}){const i=(0,O.of)(Ce),{watch:o,setValue:u,getValues:d}=(0,p.xW)(),[c,M]=(0,g.useState)(!1),[S,b,$]=o(["group","folder.uid","folder.title"]),k=(0,v.$)(ne=>ne.rulerRules)[N.hY],le=(0,y.dy)(N.hY).find(ne=>ne.uid===b),Q=le?.groups.find(ne=>ne.name===S),F=Re(b??"",S);(0,g.useEffect)(()=>{!F&&Q?.interval&&a(Q.interval)},[a,F,u,Q]);const Me=(ne=!1)=>{ne||(0,E.fH)(E.le.leavingRuleGroupEdit),M(!1)},ge=()=>M(!0),Oe=k?.loading||F||!b||!S,he={name:$,rulesSource:N.hY,groups:[]},xe={name:S,interval:n,rules:[],totals:{}};return(0,e.jsxs)("div",{children:[(0,e.jsx)(Ke,{groupfoldersForGrafana:k?.result,enableProvisionedGroups:l}),$&&c&&(0,e.jsx)(_.u5,{namespace:le??he,group:Q??xe,folderUid:b,onClose:()=>Me(),intervalEditOnly:!0,hideFolder:!0}),$&&S&&(0,e.jsx)("div",{className:i.evaluationContainer,children:(0,e.jsx)(m.B,{direction:"column",gap:0,children:(0,e.jsx)("div",{className:i.marginTop,children:(0,e.jsx)(m.B,{direction:"column",gap:1,children:d("group")&&d("evaluateEvery")&&(0,e.jsxs)("span",{children:[(0,e.jsxs)(s.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-group.text",values:{evaluateEvery:n},children:["All rules in the selected group are evaluated every ",{evaluateEvery:n},"."]}),!F&&(0,e.jsx)(f.K,{name:"pen","aria-label":"Edit",disabled:Oe,onClick:ge})]})})})})})]})}function $e({evaluateEvery:n}){const a=(0,O.of)(Ce),{register:l,formState:{errors:i},setValue:o,watch:u}=(0,p.xW)(),d="eval-for-input",c=u("evaluateFor"),M=S=>{o("evaluateFor",S)};return(0,e.jsxs)(m.B,{direction:"column","justify-content":"flex-start","align-items":"flex-start",children:[(0,e.jsx)(j.D,{label:(0,e.jsx)(w.J,{htmlFor:d,description:'Period the threshold condition must be met to trigger the alert. Selecting "None" triggers the alert immediately once the condition is met.',children:(0,e.jsx)(s.x6,{i18nKey:"alert-rule-form.evaluation-behaviour.pending-period",children:"Pending period"})}),className:a.inlineField,error:i.evaluateFor?.message,invalid:i.evaluateFor?.message?!0:void 0,validationMessageHorizontalOverflow:!0,children:(0,e.jsx)(W.p,{id:d,width:8,...l("evaluateFor",Ve(n))})}),(0,e.jsx)(We,{selectedPendingPeriod:c,groupEvaluationInterval:n,onSelect:M})]})}function ue(){return(0,e.jsxs)(m.B,{direction:"row",gap:.5,alignItems:"center",children:[(0,e.jsx)(U.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(s.x6,{i18nKey:"alert-rule-form.evaluation-behaviour.info-help.text",children:"Define the alert behavior when the evaluation fails or the query returns no data."})}),(0,e.jsx)(Z.G,{contentText:"These settings can help mitigate temporary data source issues, preventing alerts from unintentionally firing due to lack of data, errors, or timeouts.",externalLink:"https://grafana.com/docs/grafana/latest/alerting/alerting-rules/create-grafana-managed-rule/#configure-no-data-and-error-handling",linkText:"Read more about this option",title:"Configure no data and error handling"})]})}function Qe(n){return(0,e.jsxs)(m.B,{direction:"row",gap:.5,alignItems:"center",children:[(0,e.jsx)(U.E,{variant:"bodySmall",color:"secondary",children:n?(0,e.jsx)(s.x6,{i18nKey:"alerting.alert-recording-rule-form.evaluation-behaviour.description.text",children:"Define how the recording rule is evaluated."}):(0,e.jsx)(s.x6,{i18nKey:"alerting.alert-rule-form.evaluation-behaviour.description.text",children:"Define how the alert rule is evaluated."})}),(0,e.jsx)(Z.G,{contentText:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{children:(0,e.jsx)(s.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-description1",children:"Evaluation groups are containers for evaluating alert and recording rules."})}),(0,e.jsx)("p",{children:(0,e.jsx)(s.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-description2",children:"An evaluation group defines an evaluation interval - how often a rule is evaluated. Alert rules within the same evaluation group are evaluated over the same evaluation interval."})}),(0,e.jsx)("p",{children:(0,e.jsx)(s.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-description3",children:"Pending period specifies how long the threshold condition must be met before the alert starts firing. This option helps prevent alerts from being triggered by temporary issues."})})]}),externalLink:"https://grafana.com/docs/grafana/latest/alerting/fundamentals/alert-rules/rule-evaluation/",linkText:"Read about evaluation and alert states",title:"Alert rule evaluation"})]})}function Je({evaluateEvery:n,setEvaluateEvery:a,existing:l,enableProvisionedGroups:i}){const o=(0,O.of)(Ce),[u,d]=(0,g.useState)(!1),{watch:c,setValue:M}=(0,p.xW)(),S=c("isPaused"),b=c("type"),$=(0,x.Mu)(b),ce=b?(0,x.pq)(b):!1,k=ce?(0,s.t)("alert-rule-form.pause.recording","Turn on to pause evaluation for this recording rule."):(0,s.t)("alert-rule-form.pause.alerting","Turn on to pause evaluation for this alert rule.");return(0,e.jsxs)(Ue.P,{stepNo:3,title:"Set evaluation behavior",description:Qe(ce),children:[(0,e.jsxs)(m.B,{direction:"column","justify-content":"flex-start","align-items":"flex-start",children:[(0,e.jsx)(ze,{setEvaluateEvery:a,evaluateEvery:n,enableProvisionedGroups:i}),$&&(0,e.jsx)($e,{evaluateEvery:n}),l&&(0,e.jsx)(j.D,{htmlFor:"pause-alert-switch",children:(0,e.jsx)(p.xI,{render:()=>(0,e.jsxs)(m.B,{gap:1,direction:"row",alignItems:"center",children:[(0,e.jsx)(J.d,{id:"pause-alert",onChange:T=>{M("isPaused",T.currentTarget.checked)},value:!!S}),(0,e.jsxs)("label",{htmlFor:"pause-alert",className:o.switchLabel,children:[(0,e.jsx)(s.x6,{i18nKey:"alert-rule-form.pause.label",children:"Pause evaluation"}),(0,e.jsx)(R.m,{placement:"top",content:k,theme:"info",children:(0,e.jsx)(h.I,{tabIndex:0,name:"info-circle",size:"sm",className:o.infoIcon})})]})]}),name:"isPaused"})})]}),$&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(H.e,{isCollapsed:!u,onToggle:T=>d(!T),text:"Configure no data and error handling"}),u&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ue,{}),(0,e.jsx)(j.D,{htmlFor:"no-data-state-input",label:"Alert state if no data or all values are null",children:(0,e.jsx)(p.xI,{render:({field:{onChange:T,ref:le,...Q}})=>(0,e.jsx)(fe,{...Q,inputId:"no-data-state-input",width:42,includeNoData:!0,includeError:!1,onChange:F=>T(F?.value)}),name:"noDataState"})}),(0,e.jsx)(j.D,{htmlFor:"exec-err-state-input",label:"Alert state if execution error or timeout",children:(0,e.jsx)(p.xI,{render:({field:{onChange:T,ref:le,...Q}})=>(0,e.jsx)(fe,{...Q,inputId:"exec-err-state-input",width:42,includeNoData:!1,includeError:!0,onChange:F=>T(F?.value)}),name:"execErrState"})})]})]})]})}const Ce=n=>({inlineField:(0,r.css)({marginBottom:0}),evaluateLabel:(0,r.css)({marginRight:n.spacing(1)}),evaluationContainer:(0,r.css)({color:n.colors.text.secondary,maxWidth:`${n.breakpoints.values.sm}px`,fontSize:n.typography.size.sm}),intervalChangedLabel:(0,r.css)({marginBottom:n.spacing(1)}),warningIcon:(0,r.css)({justifySelf:"center",marginRight:n.spacing(1),color:n.colors.warning.text}),infoIcon:(0,r.css)({marginLeft:"10px"}),warningMessage:(0,r.css)({color:n.colors.warning.text}),bold:(0,r.css)({fontWeight:"bold"}),alignInterval:(0,r.css)({marginTop:n.spacing(1),marginLeft:`-${n.spacing(1)}`}),marginTop:(0,r.css)({marginTop:n.spacing(1)}),switchLabel:(0,r.css)({color:n.colors.text.primary,cursor:"pointer",fontSize:n.typography.bodySmall.fontSize})})},46479:(je,q,t)=>{t.d(q,{u5:()=>Ie,iS:()=>De});var e=t(74848),r=t(32196),g=t(2543),p=t(96540),O=t(49785),m=t(39938),f=t(40845),j=t(37390),w=t(67061),W=t(88575),U=t(60029),J=t(10354),R=t(55852),h=t(42418),s=t(3169),x=t(99140),E=t(30531),y=t(6833),v=t(26627),N=t(82775),V=t(57220),H=t(78742),_=t(63066),G=t(23662),P=t(25968),D=t(75591),B=t(32264);const z=()=>(0,e.jsxs)(h.F,{severity:"warning",title:"Global evaluation interval limit exceeded",children:["A minimum evaluation interval of ",(0,e.jsx)("strong",{children:B.$.unifiedAlerting.minInterval})," has been configured in Grafana.",(0,e.jsx)("br",{}),"Please contact the administrator to configure a lower interval."]});var oe=t(99106),Y=t(99226),X=t(1723);const ye=10;function ee({message:I,error:C}){return C?(0,e.jsx)(m.E,{color:"red",icon:"exclamation-circle",text:"Error",tooltip:I}):(0,e.jsx)(m.E,{color:"orange",icon:"exclamation-triangle",text:"Unknown",tooltip:I})}const Ne=I=>{try{const C=(0,P.M9)(I);return!(C<X.I*1e3||C%(X.I*1e3)!==0)}catch{return!1}},Fe=({rulesWithoutRecordingRules:I})=>{const C=(0,f.of)(Ae),{watch:A}=(0,O.xW)(),L=A("groupInterval"),ae=!L,se=I.slice().map((K,pe)=>({id:pe,data:(0,G.jg)(K,L)})).sort((K,pe)=>(0,P.P8)(K.data.forDuration??"")-(0,P.P8)(pe.data.forDuration??"")),te=(0,p.useMemo)(()=>[{id:"alertName",label:"Alert",renderCell:({data:{alertName:K}})=>(0,e.jsx)(e.Fragment,{children:K}),size:"330px"},{id:"for",label:"Pending period",renderCell:({data:{forDuration:K}})=>(0,e.jsx)(e.Fragment,{children:K}),size:.5},{id:"numberEvaluations",label:"#Eval",renderCell:({data:{evaluationsToFire:K}})=>ae?(0,e.jsx)(ee,{message:"#Evaluations not available."}):Ne(L)?K===0?(0,e.jsx)(ee,{message:"Invalid 'For' value: it should be greater or equal to evaluation interval.",error:!0}):(0,e.jsx)(e.Fragment,{children:K}):(0,e.jsx)(ee,{message:"Invalid evaluation interval format",error:!0}),size:.4}],[L,ae]);return(0,e.jsx)("div",{className:C.tableWrapper,children:(0,e.jsx)(D.E,{items:se,cols:te,pagination:{itemsPerPage:ye}})})},De=I=>({required:{value:!0,message:"Required."},validate:C=>{try{const A=(0,P.M9)(C);if(A<X.I*1e3)return`Cannot be less than ${X.I} seconds.`;if(A%(X.I*1e3)!==0)return`Must be a multiple of ${X.I} seconds.`;if((0,v.uQ)(I,C).length===0)return!0;{const L=I.map(se=>{const{forDuration:te}=(0,G.jg)(se,C);return te?(0,P.P8)(te):null}),ae=Math.min(...L.filter(se=>se!==null));return`Evaluation interval should be smaller or equal to "pending period" values for existing rules in this rule group. Choose a value smaller than or equal to "${(0,P.an)(ae)}".`}}catch(A){return A instanceof Error?A.message:"Failed to parse duration"}}});function Ie(I){const{namespace:C,group:A,onClose:L,intervalEditOnly:ae,folderUid:se}=I,te=(0,f.of)(Ae),K=(0,s._2)(),[pe,Be]=(0,E.iG)(),[Le,Ke]=(0,E.xt)(),[Se,be]=(0,E.Ot)(),{loading:me,error:re}=(0,y.Gz)(Be,be,Ke),ve=(0,p.useMemo)(()=>({namespaceName:(0,oe.EL)(C).name,groupName:A.name,groupInterval:A.interval??_.T6}),[C,A.name,A.interval]),fe=(0,V.EV)(C.rulesSource),Z=fe===V.hY,we=(0,oe.EL)(C).parents,We=Z?"Folder":"Namespace",Ue=async o=>{const u={dataSourceName:fe,groupName:A.name,namespaceName:Z?se:C.name},d=Z?(0,oe.wf)(o.namespaceName,we):o.namespaceName,c=o.groupName,M=o.groupInterval,S=Z?!1:d!==u.namespaceName,b=c!==u.groupName;try{S?await Se.execute(u,d,c,M):b?await Le.execute(u,c,M):await pe.execute(u,M),L(!0),await(0,x.JD)((0,v.eB)({rulesSourceName:fe}))}catch{}},Te=(0,O.mN)({mode:"onBlur",defaultValues:ve,shouldFocusError:!0}),{handleSubmit:Ve,register:Re,watch:ze,formState:{isDirty:$e,errors:ue,isValid:Qe},setValue:Je,getValues:Ce}=Te,n=()=>{K.error("There are errors in the form. Correct the errors and retry.")},a=(0,g.compact)(A.rules.map(o=>o.rulerRule).filter(o=>!(0,G.UL)(o))),l=a.length>0,i=ae||Z?"Edit evaluation group":"Edit namespace or evaluation group";return(0,e.jsx)(j.a,{className:te.modal,isOpen:!0,title:i,onDismiss:L,onClickBackdrop:L,children:(0,e.jsx)(O.Op,{...Te,children:(0,e.jsx)("form",{onSubmit:Ve(Ue,n),children:(0,e.jsxs)(e.Fragment,{children:[!I.hideFolder&&(0,e.jsxs)(w.B,{gap:1,alignItems:"center",children:[(0,e.jsx)(W.D,{className:te.formInput,label:(0,e.jsx)(U.J,{htmlFor:"namespaceName",description:!Z&&"Change the current namespace name. Moving groups between namespaces is not supported",children:We}),invalid:ue.namespaceName?!0:void 0,error:ue.namespaceName?.message,children:(0,e.jsx)(J.p,{id:"namespaceName",readOnly:ae||Z,...Re("namespaceName",{required:"Namespace name is required."})})}),Z&&I.folderUrl&&(0,e.jsx)(R.z9,{href:I.folderUrl,title:"Go to folder",variant:"secondary",icon:"folder-open",target:"_blank"})]}),(0,e.jsx)(W.D,{label:(0,e.jsx)(U.J,{htmlFor:"groupName",description:"A group evaluates all its rules over the same evaluation interval.",children:"Evaluation group"}),invalid:!!ue.groupName,error:ue.groupName?.message,children:(0,e.jsx)(J.p,{autoFocus:!0,id:"groupName",readOnly:ae,...Re("groupName",{required:"Evaluation group name is required."})})}),(0,e.jsx)(W.D,{label:(0,e.jsx)(U.J,{htmlFor:"groupInterval",description:"How often is the rule evaluated. Applies to every rule within the group.",children:(0,e.jsx)(w.B,{gap:.5,children:"Evaluation interval"})}),invalid:ue.groupInterval?!0:void 0,error:ue.groupInterval?.message,children:(0,e.jsxs)(w.B,{direction:"column",children:[(0,e.jsx)(J.p,{id:"groupInterval",placeholder:_.T6,...Re("groupInterval",De(a))}),(0,e.jsx)(Y.gv,{currentInterval:Ce("groupInterval"),onSelect:o=>Je("groupInterval",o,{shouldValidate:!0,shouldDirty:!0})})]})}),Z&&(0,N.q)(ze("groupInterval")).exceedsLimit&&(0,e.jsx)(z,{}),!l&&(0,e.jsx)("div",{children:"This group does not contain alert rules."}),l&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:"List of rules that belong to this group"}),(0,e.jsx)("div",{className:te.evalRequiredLabel,children:"#Eval column represents the number of evaluations needed before alert starts firing."}),(0,e.jsx)(Fe,{rulesWithoutRecordingRules:a})]}),re&&(0,e.jsx)(h.F,{title:"Failed to update rule group",children:(0,H.JZ)(re)}),(0,e.jsx)("div",{className:te.modalButtons,children:(0,e.jsxs)(j.a.ButtonRow,{children:[(0,e.jsx)(R.$n,{variant:"secondary",type:"button",disabled:me,onClick:()=>L(!1),fill:"outline",children:"Cancel"}),(0,e.jsx)(R.$n,{type:"submit",disabled:!$e||!Qe||me,children:me?"Saving...":"Save"})]})})]})},JSON.stringify(ve))})})}const Ae=I=>({modal:(0,r.css)({maxWidth:"560px"}),modalButtons:(0,r.css)({top:"-24px",position:"relative"}),formInput:(0,r.css)({flex:1}),tableWrapper:(0,r.css)({marginTop:I.spacing(2),marginBottom:I.spacing(2),height:"100%"}),evalRequiredLabel:(0,r.css)({fontSize:I.typography.bodySmall.fontSize})})},30531:(je,q,t)=>{t.d(q,{Ot:()=>W,iG:()=>w,ts:()=>J,xt:()=>U});var e=t(8484),r=t(79938),g=t(53270),p=t(48070),O=t(57220),m=t(6833),f=t(43482);const j=()=>(0,e.t)("alerting.rule-groups.update.success","Successfully updated rule group");function w(){const[R]=(0,f.D)(),[h]=r.hK.endpoints.upsertRuleGroupForNamespace.useMutation();return(0,m.Yb)(async(s,x)=>{const{namespaceName:E}=s,y=(0,p.lF)({interval:x}),{newRuleGroupDefinition:v,rulerConfig:N}=await R(s,y);return h({rulerConfig:N,namespace:E,payload:v,notificationOptions:{successMessage:j()}}).unwrap()})}function W(){const[R]=(0,f.D)(),[h]=r.hK.endpoints.getRuleGroupForNamespace.useLazyQuery(),[s]=r.hK.endpoints.upsertRuleGroupForNamespace.useMutation(),[x]=r.hK.endpoints.deleteRuleGroupFromNamespace.useMutation(),E=(0,e.t)("alerting.rule-groups.move.success","Successfully moved rule group");return(0,m.Yb)(async(y,v,N,V)=>{if((0,O.z2)(y.dataSourceName))throw new Error("Moving a Grafana-managed rule group to another folder is currently not supported.");const H=(0,p.fO)({newNamespaceName:v,groupName:N,interval:V}),{newRuleGroupDefinition:_,rulerConfig:G}=await R(y,H),P=y.namespaceName,D=H.payload.newNamespaceName,B=y.groupName,z=H.payload.groupName;if(z&&(!!z&&B!==z)&&(await h({rulerConfig:G,namespace:D,group:z,notificationOptions:{showErrorAlert:!1}}).unwrap().catch(g.R))?.rules?.length)throw new Error("Target group already has rules, merging rule groups is currently not supported.");return await s({rulerConfig:G,namespace:D,payload:_,notificationOptions:{successMessage:E}}).unwrap(),await x({rulerConfig:G,namespace:P,group:B,notificationOptions:{showSuccessAlert:!1}}).unwrap()})}function U(){const[R]=(0,f.D)(),[h]=r.hK.endpoints.getRuleGroupForNamespace.useLazyQuery(),[s]=r.hK.endpoints.upsertRuleGroupForNamespace.useMutation(),[x]=r.hK.endpoints.deleteRuleGroupFromNamespace.useMutation();return(0,m.Yb)(async(E,y,v)=>{const N=(0,p.KL)({groupName:y,interval:v}),{newRuleGroupDefinition:V,rulerConfig:H}=await R(E,N),_=E.groupName,G=N.payload.groupName,P=E.namespaceName,D=(0,e.t)("alerting.rule-groups.rename.success","Successfully renamed rule group");if((await h({rulerConfig:H,namespace:P,group:G,notificationOptions:{showErrorAlert:!1}}).unwrap().catch(g.R))?.rules?.length)throw new Error("Target group has existing rules, merging rule groups is currently not supported.");const z=await s({rulerConfig:H,namespace:P,payload:V,notificationOptions:{successMessage:D}}).unwrap();return await x({rulerConfig:H,namespace:P,group:_,notificationOptions:{showSuccessAlert:!1}}).unwrap(),z})}function J(){const[R]=(0,f.D)(),[h]=r.hK.endpoints.upsertRuleGroupForNamespace.useMutation();return(0,m.Yb)(async(s,x)=>{const{namespaceName:E}=s,y=(0,p.bw)({swaps:x}),{newRuleGroupDefinition:v,rulerConfig:N}=await R(s,y);return h({rulerConfig:N,namespace:E,payload:v,notificationOptions:{successMessage:j()}}).unwrap()})}},41520:(je,q,t)=>{t.d(q,{V:()=>g});var e=t(96540),r=t(75471);function g(){return(0,e.useMemo)(()=>(0,r.Q9)(),[])}}}]);

//# sourceMappingURL=829.6b4dee20c93348daf8b3.js.map