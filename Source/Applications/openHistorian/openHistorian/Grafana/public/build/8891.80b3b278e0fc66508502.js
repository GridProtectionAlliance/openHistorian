"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8891],{88891:(pt,nt,z)=>{z.d(nt,{Mv:()=>ct,O4:()=>yt,g$:()=>dt});var Y=z(36613),rt=z(11261),ot=z(41260),J=z(77678),lt=z(83195),f=z(52622),st=z(51336),tt=z(80909),it=z(4134),V=z(52995);function ct(x){const{dataRef:l,theme:p,timeZone:s,getTimeRange:D,cellGap:y,hideLE:I,hideGE:E,yAxisConfig:L,ySizeDivisor:d,selectionMode:O=V.iS.X}=x,U="x";let h=!0;l.current?.heatmap?.fields[0].type!==rt.PU.time&&(h=!1);const C=devicePixelRatio;let X=l.current?.heatmap?.meta?.type;const Z=p.visualization.getColorByName(x.exemplarColor);let F,g,c=new st.e(s);c.addHook("init",e=>{e.root.querySelectorAll(".u-cursor-pt").forEach(i=>{Object.assign(i.style,{borderRadius:"0",border:"1px solid white",background:"transparent"})})}),h&&c.addHook("setData",e=>{let{min:i,max:t}=e.scales.x,n=D().from.valueOf(),a=D().to.valueOf();(i!==n||t!==a)&&queueMicrotask(()=>{e.setScale(U,{min:n,max:a})})}),c.addHook("drawClear",e=>{F=F||new it.C$(0,0,e.bbox.width,e.bbox.height),F.clear(),e.series.forEach((i,t)=>{t>0&&(i._paths=null)})}),c.setMode(2),c.addScale({scaleKey:U,isTime:h,orientation:f.Lt.Horizontal,direction:f.ON.Right,range:(e,i,t)=>{if(h)return[D().from.valueOf(),D().to.valueOf()];if(l.current?.xLayout===f.D7.le)return[i-l.current?.xBucketSize,t];if(l.current?.xLayout===f.D7.ge)return[i,t+l.current?.xBucketSize];{let n=l.current?.xBucketSize/2;return[i-n,t+n]}}});let B;if(!h){B=[];for(let e=0;e<10;e++)B.push(e*l.current?.xBucketSize)}c.addAxis({scaleKey:U,placement:f.vM.Bottom,incrs:B,isTime:h,theme:p,timeZone:s});const A=l.current?.heatmap?.fields[1];if(!A)return c;const v=A.config?.custom?.scaleDistribution??{type:f.L4.Linear},H=!!L.reverse,m=X===ot.m.HeatmapCells&&!(0,tt.Nb)(l.current?.heatmap),W=v.type!==f.L4.Linear||m,w=(0,tt.eE)(l.current?.heatmap).yOrdinalDisplay!=null,b="y_"+(Math.random()+1).toString(36).substring(7);c.addScale({scaleKey:b,isTime:!1,orientation:f.Lt.Vertical,direction:H?f.ON.Down:f.ON.Up,distribution:W?f.L4.Log:f.L4.Linear,log:v.log??2,range:m?(e,i,t)=>{let n=e.data[1][2][0]/e.data[1][1][0];t*=n;let a,r;if([a,r]=W?Y.A.rangeLog(i,t,v.log??2,!0):[i,t],W&&!w){let u=e.scales[b].log,o=u===2?Math.log2:Math.log10,{min:M,max:S}=L;if(M!=null&&M>0){let K=o(M);a=u**(0,J.rs)(K,1)}if(S!=null&&S>0){let K=o(S);r=u**(0,J.Uh)(K,1)}}return[a,r]}:(e,i,t)=>{let n=i,a=t,{min:r,max:u}=L;if(W){let o=e.scales[b].log,M=!1,S=!1,K=o===2?Math.log2:Math.log10;if(d!==1){let N=K(i),G=K(t);Number.isInteger(N)||(n=o**(0,J.rs)(N,1),M=!0),Number.isInteger(G)||(a=o**(0,J.Uh)(G,1),S=!0)}if(l.current?.yLayout===f.D7.le?M||(n/=o):l.current?.yLayout===f.D7.ge?S||(a*=o):(n/=o/2,a*=o/2),!w){if(r!=null&&r>0){let N=K(r);n=o**(0,J.rs)(N,1)}if(u!=null&&u>0){let N=K(u);a=o**(0,J.Uh)(N,1)}}}else{let o=l.current?.yBucketSize;o===0&&(o=1),o&&(l.current?.yLayout===f.D7.le?n-=o:l.current?.yLayout===f.D7.ge?a+=o:(n-=o/2,a+=o/2)),w||(n=r??n,a=u??a)}return[n,a]}});const Q=A.display??(0,lt.j_)("short");c.addAxis({scaleKey:b,show:L.axisPlacement!==f.vM.Hidden,placement:L.axisPlacement||f.vM.Left,size:L.axisWidth||null,label:L.axisLabel,theme:p,formatValue:(e,i)=>(0,lt.cN)(Q(e,i)),splits:w?e=>{const i=(0,tt.eE)(l.current?.heatmap);if(!i.yOrdinalDisplay)return[0,1];let t=i.yOrdinalDisplay.map((n,a)=>a);switch(l.current?.yLayout){case f.D7.le:t.unshift(-1);break;case f.D7.ge:t.push(t.length);break}if(e.height<60)t=[t[0],t[t.length-1]];else for(;t.length>3&&(e.height-15)/t.length<10;)t=t.filter((n,a)=>a%2===0);return t}:void 0,values:w?(e,i)=>{const t=(0,tt.eE)(l.current?.heatmap);return t.yOrdinalDisplay?i.map(n=>n<0?t.yMinDisplay??"":t.yOrdinalDisplay[n]??""):i}:void 0});const R=m?xt:ft;c.addSeries({facets:[{scale:U,auto:!0,sorted:1},{scale:b,auto:!0}],pathBuilder:R({each:(e,i,t,n,a,r,u)=>{F.add({x:n-e.bbox.left,y:a-e.bbox.top,w:r,h:u,sidx:i,didx:t})},gap:y,hideLE:I,hideGE:E,xAlign:l.current?.xLayout===f.D7.le?-1:l.current?.xLayout===f.D7.ge?1:0,yAlign:(l.current?.yLayout===f.D7.le?-1:l.current?.yLayout===f.D7.ge?1:0)*(H?-1:1),ySizeDivisor:d,disp:{fill:{values:(e,i)=>l.current?.heatmapColors?.values,index:l.current?.heatmapColors?.palette}}}),theme:p,scaleKey:""}),c.addSeries({facets:[{scale:U,auto:!0,sorted:1},{scale:b,auto:!0}],pathBuilder:ht({each:(e,i,t,n,a,r,u)=>{F.add({x:n-e.bbox.left,y:a-e.bbox.top,w:r,h:u,sidx:i,didx:t})}},Z,l.current.yLayout),theme:p,scaleKey:""});const P=O===V.iS.X||O===V.iS.Xy,k=O===V.iS.Y||O===V.iS.Xy,$={drag:{x:P,y:k,setScale:!1},dataIdx:(e,i)=>{if(i===1){g=null;let t=e.cursor.left*C,n=e.cursor.top*C;F.get(t,n,1,1,a=>{(0,it.ur)(t,n,a.x,a.y,a.x+a.w,a.y+a.h)&&(g=a)})}return g&&i===g.sidx?g.didx:null},focus:{prox:1e3,dist:(e,i)=>g?.sidx===i?0:1/0},points:{fill:"rgba(255,255,255, 0.3)",bbox:(e,i)=>{let t=g&&i===g.sidx;return{left:t?g.x/C:-10,top:t?g.y/C:-10,width:t?g.w/C:0,height:t?g.h/C:0}}}};return c.setCursor($),c}const at=4;function ft(x){const{disp:l,each:p,gap:s=1,hideLE:D=-1/0,hideGE:y=1/0,xAlign:I=1,yAlign:E=1,ySizeDivisor:L=1}=x,d=devicePixelRatio,O=s>=at?Math.round:h=>h,U=Math.round(s*d);return(h,C)=>(Y.A.orient(h,C,(X,Z,F,g,c,B,A,T,v,H,m,W,w,b,Q)=>{let R=h.data[C];const P=R[0],k=R[1],$=R[2],e=P.length;let i=l.fill.values(h,C),t=l.fill.index??[...new Set(i)],n=t.map(_=>new Path2D),a=e-k.lastIndexOf(k[0]),r=e/a,u=k[1]-k[0]||c.max-c.min,o=P[a]-P[0],M,S;g.distr===3?M=Math.abs(B(P[0]*g.log,g,H,T)-B(P[0],g,H,T)):M=Math.abs(B(o,g,H,T)-B(0,g,H,T)),c.distr===3?S=Math.abs(A(k[0]*c.log,c,m,v)-A(k[0],c,m,v))/L:S=Math.abs(A(u,c,m,v)-A(0,c,m,v))/L,M=Math.max(1,O(M-U)),S=Math.max(1,O(S-U));let K=I===-1?-M:I===0?-M/2:0,N=E===1?-S:E===0?-S/2:0,G=k.slice(0,a).map(_=>O(A(_,c,m,v)+N)),q=Array.from({length:r},(_,j)=>O(B(P[j*a],g,H,T)+K));for(let _=0;_<e;_++)if($[_]!=null&&$[_]>D&&$[_]<y){let j=q[~~(_/a)],et=G[_%a],gt=n[i[_]];b(gt,j,et,M,S),p(h,1,_,j,et,M,S)}return h.ctx.save(),h.ctx.rect(h.bbox.left,h.bbox.top,h.bbox.width,h.bbox.height),h.ctx.clip(),n.forEach((_,j)=>{h.ctx.fillStyle=t[j],h.ctx.fill(_)}),h.ctx.restore(),null}),null)}function ht(x,l,p){return(s,D)=>(Y.A.orient(s,D,(y,I,E,L,d,O,U,h,C,X,Z,F,g,c,B)=>{let A=new Path2D,T=[A],v=[l??"rgba(255,0,255,0.7)"],H=p===f.D7.le?-.5:p===f.D7.ge?.5:0;for(let m=0;m<I.length;m++){let W=E[m];d.distr===3&&d.log===2||(W+=H);let b=O(I[m],L,X,h),Q=U(W,d,Z,C),R=8,P=8;c(A,b-R/2,Q-P/2,R,P),x.each(s,D,m,b-R/2,Q-P/2,R,P)}s.ctx.save(),s.ctx.rect(s.bbox.left,s.bbox.top,s.bbox.width,s.bbox.height),s.ctx.clip(),T.forEach((m,W)=>{s.ctx.fillStyle=v[W],s.ctx.fill(m)}),s.ctx.restore()}),null)}function xt(x){const{disp:l,each:p,gap:s=1,hideLE:D=-1/0,hideGE:y=1/0}=x,I=devicePixelRatio,E=s>=at?Math.round:d=>d,L=Math.round(s*I);return(d,O)=>(Y.A.orient(d,O,(U,h,C,X,Z,F,g,c,B,A,T,v,H,m,W)=>{let w=d.data[O];const b=w[0],Q=w[1],R=w[2],P=w[3],k=b.length;let $=l.fill.values(d,O),e=l.fill.index??[...new Set($)],i=e.map(r=>new Path2D),t=new Map,n=new Map;for(let r=0;r<b.length;r++){let u=b[r],o=Q[r],M=R[r];t.has(u)||t.set(u,E(F(u,X,A,c))),n.has(o)||n.set(o,E(g(o,Z,T,B))),n.has(M)||n.set(M,E(g(M,Z,T,B)))}let a=t.get(b.find(r=>r!==b[0]))-t.get(b[0]);for(let r=0;r<k;r++){if(P[r]<=D||P[r]>=y)continue;let u=b[r],o=Q[r],M=R[r],S=t.get(u),K=n.get(o),N=n.get(M),G=a,q=K-N;G=Math.max(1,G-L),q=Math.max(1,q-L);let _=S-L/2-G,j=N+L/2,et=i[$[r]];m(et,_,j,G,q),p(d,1,r,_,j,G,q)}d.ctx.save(),d.ctx.rect(d.bbox.left,d.bbox.top,d.bbox.width,d.bbox.height),d.ctx.clip(),i.forEach((r,u)=>{d.ctx.fillStyle=e[u],d.ctx.fill(r)}),d.ctx.restore()}),null)}const dt=(x,l,p,s=-1/0,D=1/0)=>{if(l==null){l=1/0;for(let y=0;y<x.length;y++)x[y]!=null&&x[y]>s&&x[y]<D&&(l=Math.min(l,x[y]))}if(p==null){p=-1/0;for(let y=0;y<x.length;y++)x[y]!=null&&x[y]>s&&x[y]<D&&(p=Math.max(p,x[y]))}return[l,p]},yt=(x,l,p,s)=>{let D=s-p||1,y=l.length,I=Array(x.length);for(let E=0;E<x.length;E++)I[E]=x[E]<p?0:x[E]>s?y-1:Math.min(y-1,Math.floor(y*(x[E]-p)/D));return I}}}]);

//# sourceMappingURL=8891.80b3b278e0fc66508502.js.map