"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7884],{66642:($e,V,t)=>{t.r(V),t.d(V,{plugin:()=>xe});var $=t(65158),i=t(52622),C=t(9557),a=t(74848),F=t(32196),s=t(96540),D=t(69129),v=t(41987),Z=t(76885),H=t(47232),q=t(40845),_=t(79041),ee=t(40276),ne=t(96192),te=t(81166),se=t(17888),oe=t(7030),ae=t(93463),le=t(14647),R=t(69147);const Ze={displayedFields:[]};function ie(e){return typeof e=="function"}function re(e){return typeof e=="function"}function ce(e){return typeof e=="function"}function de(e){return typeof e=="function"}function ue(e){return typeof e=="function"}function fe(e){return typeof e=="function"}function ge(e){return typeof e=="function"}var me=t(16817),pe=t(19347);const Ce=e=>{const[l,c]=(0,s.useState)(new Map);return(0,me.A)(async()=>{if(!e){c(new Map);return}const r=await Promise.all(e.filter(f=>!!f.datasource?.uid).map(f=>(0,pe.l)().get(f.datasource?.uid).then(y=>({key:f.refId,ds:y}))));c(new Map(r.map(({key:f,ds:y})=>[f,y])))},[e]),l},ve={},he=({data:e,timeZone:l,fieldConfig:c,options:{showLabels:r,showTime:f,wrapLogMessage:y,showCommonLabels:T,prettifyLogMessage:ke,sortOrder:M,dedupStrategy:j,enableLogDetails:Oe,showLogContextToggle:E,onClickFilterLabel:J,onClickFilterOutLabel:B,onClickFilterOutString:N,onClickFilterString:Y,isFilterLabelActive:U,...g},id:Pe})=>{const h=M===i.uH.Ascending,b=(0,q.of)(Se),[we,W]=(0,s.useState)(0),x=(0,s.useRef)(null),[k,z]=(0,s.useState)(null),Q=e.timeRange,d=Ce(e.request?.targets),[G,Re]=(0,s.useState)(null),[u,I]=(0,s.useState)(g.displayedFields??[]);let L=(0,s.useRef)();const{eventBus:O,onAddAdHocFilter:S}=(0,_.d2)(),Me=(0,s.useCallback)(n=>{n&&O.publish(new D.b_({point:{time:n.timeEpochMs}}))},[O]),je=(0,s.useCallback)(()=>{O.publish(new D.ql)},[O]),Ie=(0,s.useCallback)(()=>{z(null),L.current&&L.current()},[L]),Ve=(0,s.useCallback)((n,o)=>{z(n),L.current=o},[L]),De=(0,s.useCallback)(async n=>await ye(n,Q),[Q]),He=(0,s.useCallback)(n=>{if(!n.dataFrame.refId||!d||!E&&e.request?.app!==v.Jk.Dashboard&&e.request?.app!==v.Jk.PanelEditor&&e.request?.app!==v.Jk.PanelViewer)return!1;const o=d.get(n.dataFrame.refId);return(0,C.Ol)(o)},[d,E,e.request?.app]),Ae=(0,s.useCallback)(()=>!(e.request?.app!==v.Jk.Dashboard&&e.request?.app!==v.Jk.PanelEditor&&e.request?.app!==v.Jk.PanelViewer),[e.request?.app]),Te=(0,s.useCallback)(async(n,o,m)=>{if(!o.dataFrame.refId||!d)return Promise.resolve({data:[]});const p=e.request?.targets[0];if(!p)return Promise.resolve({data:[]});const w=d.get(o.dataFrame.refId);return(0,C.Ol)(w)?w.getLogRowContext(n,m,p):Promise.resolve({data:[]})},[e.request?.targets,d]),Ee=(0,s.useCallback)((n,o)=>{if(!n.dataFrame.refId||!d)return(0,a.jsx)(a.Fragment,{});const m=e.request?.targets[0];if(!m)return(0,a.jsx)(a.Fragment,{});const p=d.get(n.dataFrame.refId);return(0,C.wj)(p)?p.getLogRowContextUi?p.getLogRowContextUi(n,o,m):(0,a.jsx)(a.Fragment,{}):(0,a.jsx)(a.Fragment,{})},[e.request?.targets,d]),[P,Je,K]=(0,s.useMemo)(()=>{const n=e?(0,R.HT)(e.series,e.request?.intervalMs,void 0,e.request?.targets):null,o=n?.rows||[],m=n?.meta?.find(w=>w.label===R.yR),p=(0,R.M0)(o,j);return[o,p,m]},[e,j]);(0,s.useLayoutEffect)(()=>{h&&x.current?W(x.current.offsetHeight):W(0)},[h,P]);const Be=(0,s.useCallback)((n,o)=>(0,ne.QL)({field:n,rowIndex:o,range:e.timeRange}),[e]),Ne=(0,s.useCallback)(n=>{G?.scrollTo({top:n.offsetTop,behavior:"smooth"})},[G]),Ye=(0,s.useCallback)((n,o)=>{S?.({key:n,value:o,operator:"="})},[S]),Ue=(0,s.useCallback)((n,o)=>{S?.({key:n,value:o,operator:"!="})},[S]),We=(0,s.useCallback)(n=>{u?.indexOf(n)===-1&&I(u?.concat(n))},[u]),ze=(0,s.useCallback)(n=>{const o=u?.indexOf(n);o!==void 0&&o>-1&&I(u?.filter(m=>n!==m))},[u]);if((0,s.useEffect)(()=>{g.displayedFields&&I(g.displayedFields)},[g.displayedFields]),!e||P.length===0)return(0,a.jsx)(se.a,{fieldConfig:c,panelId:Pe,data:e,needsStringField:!0});const X=()=>(0,a.jsxs)("div",{className:(0,F.cx)(b.labelContainer,h&&b.labelContainerAscending),children:[(0,a.jsx)("span",{className:b.label,children:"Common labels:"}),(0,a.jsx)(ae.h,{labels:typeof K?.value=="object"?K?.value:ve,emptyMessage:"(no common labels)"})]}),Qe=S?Ye:void 0,Ge=S?Ue:void 0,Ke=fe(g.onClickShowField)?g.onClickShowField:We,Xe=ge(g.onClickHideField)?g.onClickHideField:ze;return(0,a.jsxs)(a.Fragment,{children:[k&&(0,a.jsx)(te.V,{open:k!==null,row:k,onClose:Ie,getRowContext:(n,o)=>Te(n,k,o),logsSortOrder:M,timeZone:l,getLogRowContextUi:Ee}),(0,a.jsx)(ee.E,{autoHide:!0,scrollTop:we,scrollRefCallback:n=>Re(n),children:(0,a.jsxs)("div",{onMouseLeave:je,className:b.container,ref:x,children:[T&&!h&&X(),(0,a.jsx)(le.k,{containerRendered:x.current!==null,scrollIntoView:Ne,permalinkedRowId:Fe()?.logs?.id??void 0,onPermalinkClick:Ae()?De:void 0,logRows:P,showContextToggle:He,deduplicatedRows:Je,dedupStrategy:j,showLabels:r,showTime:f,wrapLogMessage:y,prettifyLogMessage:ke,timeZone:l,getFieldLinks:Be,logsSortOrder:M,enableLogDetails:Oe,previewLimit:h?P.length:void 0,onLogRowHover:Me,app:v.Jk.Dashboard,onOpenContext:Ve,onClickFilterLabel:ie(J)?J:Qe,onClickFilterOutLabel:re(B)?B:Ge,onClickFilterString:ce(Y)?Y:void 0,onClickFilterOutString:de(N)?N:void 0,isFilterLabelActive:ue(U)?U:void 0,displayedFields:u,onClickShowField:u!==void 0?Ke:void 0,onClickHideField:u!==void 0?Xe:void 0}),T&&h&&X()]})})]})},Se=e=>({container:(0,F.css)({marginBottom:e.spacing(1.5)}),labelContainer:(0,F.css)({margin:e.spacing(0,0,.5,.5),display:"flex",alignItems:"center"}),labelContainerAscending:(0,F.css)({margin:e.spacing(.5,0,.5,0)}),label:(0,F.css)({marginRight:e.spacing(.5),fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium})});function Fe(){const l=Z.kM.getUrlSearchParams()?.panelState;if(l&&Array.isArray(l)&&l?.length>0&&typeof l[0]=="string")try{return JSON.parse(l[0])}catch(c){console.error("error parsing logsPanelState",c)}}async function ye(e,l){if(e.rowId===void 0||!e.dataFrame.refId)return;const c={logs:{id:e.uid}},r=new URL(window.location.href);return r.searchParams.set("panelState",JSON.stringify(c)),r.searchParams.set("from",(0,H.yT)(l.from).valueOf().toString(10)),r.searchParams.set("to",(0,H.yT)(l.to).valueOf().toString(10)),await(0,oe.VP)(r.toString()),Promise.resolve()}var Le=t(47070),A=t(38824);class be{getSuggestionsForData(l){const c=l.getListAppender({name:"",pluginId:"logs",options:{},fieldConfig:{defaults:{custom:{}},overrides:[]}}),{dataSummary:r}=l;!r.hasData||!r.hasTimeField||!r.hasStringField||(r.preferredVisualisationType==="logs"?c.append({name:A.m.Logs,score:Le.nQ.Best}):c.append({name:A.m.Logs}))}}const xe=new $.m(he).setPanelOptions(e=>{e.addBooleanSwitch({path:"showTime",name:"Time",description:"",defaultValue:!1}).addBooleanSwitch({path:"showLabels",name:"Unique labels",description:"",defaultValue:!1}).addBooleanSwitch({path:"showCommonLabels",name:"Common labels",description:"",defaultValue:!1}).addBooleanSwitch({path:"wrapLogMessage",name:"Wrap lines",description:"",defaultValue:!1}).addBooleanSwitch({path:"prettifyLogMessage",name:"Prettify JSON",description:"",defaultValue:!1}).addBooleanSwitch({path:"enableLogDetails",name:"Enable log details",description:"",defaultValue:!0}).addRadio({path:"dedupStrategy",name:"Deduplication",description:"",settings:{options:[{value:i.fY.none,label:"None",description:C._C[i.fY.none]},{value:i.fY.exact,label:"Exact",description:C._C[i.fY.exact]},{value:i.fY.numbers,label:"Numbers",description:C._C[i.fY.numbers]},{value:i.fY.signature,label:"Signature",description:C._C[i.fY.signature]}]},defaultValue:i.fY.none}).addRadio({path:"sortOrder",name:"Order",description:"",settings:{options:[{value:i.uH.Descending,label:"Newest first"},{value:i.uH.Ascending,label:"Oldest first"}]},defaultValue:i.uH.Descending})}).setSuggestionsSupplier(new be)}}]);

//# sourceMappingURL=logsPanel.37c0e991f554637edb20.js.map