"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7323],{67833:(e,s,a)=>{a.d(s,{Z:()=>y,v:()=>k});var r,i,n,t,l,o=a(25235),d=a(19309),c=a(36636),h=a(68404),u=a(43215),m=a(16695),g=a(90923),x=a(3490),f=a(57512),j=a(76187),p=a(28659),b=a(45916);function v(e,s,a){return s in e?Object.defineProperty(e,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[s]=a,e}const U=[{value:"",label:d.ag._({id:"shared-preferences.theme.default-label",message:"Default"})},{value:"dark",label:d.ag._({id:"shared-preferences.theme.dark-label",message:"Dark"})},{value:"light",label:d.ag._({id:"shared-preferences.theme.light-label",message:"Light"})}],w=[{value:"",label:d.ag._({id:"common.locale.default",message:"Default"})},{value:f.cV,label:d.ag._({id:"common.locale.en",message:"English"})},{value:f.Hc,label:d.ag._({id:"common.locale.es",message:"Spanish"})},{value:f.jW,label:d.ag._({id:"common.locale.fr",message:"French"})}],C=Boolean(g.config.featureToggles.internationalization),S={title:"Default",tags:[],type:"",uid:void 0,uri:"",url:"",folderId:0,folderTitle:"",folderUid:"",folderUrl:"",isStarred:!1,slug:"",items:[]};class k extends h.PureComponent{constructor(e){super(e),v(this,"service",void 0),v(this,"onSubmitForm",(async()=>{const{homeDashboardUID:e,theme:s,timezone:a,weekStart:r,locale:i,queryHistory:n}=this.state;await this.service.update({homeDashboardUID:e,theme:s,timezone:a,weekStart:r,locale:i,queryHistory:n}),window.location.reload()})),v(this,"onThemeChanged",(e=>{this.setState({theme:e})})),v(this,"onTimeZoneChanged",(e=>{e&&this.setState({timezone:e})})),v(this,"onWeekStartChanged",(e=>{this.setState({weekStart:e})})),v(this,"onHomeDashboardChanged",(e=>{this.setState({homeDashboardUID:e})})),v(this,"onLocaleChanged",(e=>{this.setState({locale:e})})),v(this,"getFullDashName",(e=>void 0===e.folderTitle||""===e.folderTitle?e.title:e.folderTitle+" / "+e.title)),this.service=new j.y(e.resourceUri),this.state={homeDashboardUID:S.uid,theme:"",timezone:"",weekStart:"",locale:"",dashboards:[],queryHistory:{homeTab:""}}}async componentDidMount(){const e=await this.service.load(),s=await p.ae.search({starred:!0});if(e.homeDashboardUID&&!s.find((s=>s.uid===e.homeDashboardUID))){const a=await p.ae.search({dashboardUIDs:e.homeDashboardUID});a.length>0&&s.push(a[0])}this.setState({homeDashboardUID:e.homeDashboardUID,theme:e.theme,timezone:e.timezone,weekStart:e.weekStart,locale:e.locale,dashboards:[S,...s],queryHistory:e.queryHistory})}render(){const{theme:e,timezone:s,weekStart:a,homeDashboardUID:c,locale:h,dashboards:g}=this.state,{disabled:f}=this.props,j=L(),p=r||(r=(0,b.jsx)(x.Tooltip,{content:(0,b.jsx)(o.cC,{id:"shared-preferences.fields.home-dashboard-tooltip"}),children:(0,b.jsx)(x.Icon,{name:"info-circle"})}));return(0,b.jsx)(x.Form,{onSubmit:this.onSubmitForm,children:()=>{var r;return(0,b.jsxs)(x.FieldSet,{label:i||(i=(0,b.jsx)(o.cC,{id:"shared-preferences.title"})),disabled:f,children:[(0,b.jsx)(x.Field,{label:d.ag._({id:"shared-preferences.fields.theme-label",message:"UI Theme"}),children:(0,b.jsx)(x.RadioButtonGroup,{options:U,value:null===(r=U.find((s=>s.value===e)))||void 0===r?void 0:r.value,onChange:this.onThemeChanged})}),(0,b.jsx)(x.Field,{label:(0,b.jsxs)(x.Label,{htmlFor:"home-dashboard-select",children:[(0,b.jsx)("span",{className:j.labelText,children:n||(n=(0,b.jsx)(o.cC,{id:"shared-preferences.fields.home-dashboard-label"}))}),p]}),"data-testid":"User preferences home dashboard drop down",children:(0,b.jsx)(x.Select,{value:g.find((e=>e.uid===c)),getOptionValue:e=>e.uid,getOptionLabel:this.getFullDashName,onChange:e=>this.onHomeDashboardChanged(e.uid),options:g,placeholder:d.ag._({id:"shared-preferences.fields.home-dashboard-placeholder",message:"Choose default dashboard"}),inputId:"home-dashboard-select"})}),(0,b.jsx)(x.Field,{label:d.ag._({id:"shared-dashboard.fields.timezone-label",message:"Timezone"}),"data-testid":m.wl.components.TimeZonePicker.containerV2,children:(0,b.jsx)(x.TimeZonePicker,{includeInternal:!0,value:s,onChange:this.onTimeZoneChanged,inputId:"shared-preferences-timezone-picker"})}),(0,b.jsx)(x.Field,{label:d.ag._({id:"shared-preferences.fields.week-start-label",message:"Week start"}),"data-testid":m.wl.components.WeekStartPicker.containerV2,children:(0,b.jsx)(x.WeekStartPicker,{value:a,onChange:this.onWeekStartChanged,inputId:"shared-preferences-week-start-picker"})}),C?(0,b.jsx)(x.Field,{label:(0,b.jsxs)(x.Label,{htmlFor:"locale-select",children:[(0,b.jsx)("span",{className:j.labelText,children:t||(t=(0,b.jsx)(o.cC,{id:"shared-preferences.fields.locale-label"}))}),(0,b.jsx)(x.FeatureBadge,{featureState:u.FeatureState.alpha})]}),"data-testid":"User preferences language drop down",children:(0,b.jsx)(x.Select,{value:w.find((e=>e.value===h)),onChange:e=>{var s;return this.onLocaleChanged(null!==(s=e.value)&&void 0!==s?s:"")},options:w,placeholder:d.ag._({id:"shared-preferences.fields.locale-placeholder",message:"Choose language"}),inputId:"locale-select"})}):null,(0,b.jsx)("div",{className:"gf-form-button-row",children:(0,b.jsx)(x.Button,{type:"submit",variant:"primary","data-testid":m.wl.components.UserProfile.preferencesSaveButton,children:l||(l=(0,b.jsx)(o.cC,{id:"common.save"}))})})]})}})}}const y=k,L=(0,x.stylesFactory)((()=>({labelText:c.css`
      margin-right: 6px;
    `})))},92795:(e,s,a)=>{a.r(s),a.d(s,{UserProfileEditPage:()=>$,default:()=>M});var r,i,n,t,l,o=a(68404),d=a(18745),c=a(69578),h=a(3490),u=a(69371),m=a(67833),g=a(25235),x=a(16695),f=a(45916);class j extends o.PureComponent{render(){const{isLoading:e,orgs:s,user:a}=this.props;return e?r||(r=(0,f.jsx)(h.LoadingPlaceholder,{text:"Loading organizations..."})):0===s.length?null:(0,f.jsxs)("div",{children:[i||(i=(0,f.jsx)("h3",{className:"page-sub-heading",children:(0,f.jsx)(g.cC,{id:"user-orgs.title"})})),(0,f.jsx)("div",{className:"gf-form-group",children:(0,f.jsxs)("table",{className:"filter-table form-inline","data-testid":x.wl.components.UserProfile.orgsTable,children:[n||(n=(0,f.jsx)("thead",{children:(0,f.jsxs)("tr",{children:[(0,f.jsx)("th",{children:(0,f.jsx)(g.cC,{id:"user-orgs.name-column"})}),(0,f.jsx)("th",{children:(0,f.jsx)(g.cC,{id:"user-orgs.role-column"})}),(0,f.jsx)("th",{})]})})),(0,f.jsx)("tbody",{children:s.map(((e,s)=>(0,f.jsxs)("tr",{children:[(0,f.jsx)("td",{children:e.name}),(0,f.jsx)("td",{children:e.role}),(0,f.jsx)("td",{className:"text-right",children:e.orgId===(null==a?void 0:a.orgId)?t||(t=(0,f.jsx)(h.Button,{variant:"secondary",size:"sm",disabled:!0,children:(0,f.jsx)(g.cC,{id:"user-orgs.current-org-button"})})):(0,f.jsx)(h.Button,{variant:"secondary",size:"sm",onClick:()=>{this.props.setUserOrg(e)},children:l||(l=(0,f.jsx)(g.cC,{id:"user-orgs.select-org-button"}))})})]},s)))})]})})]})}}const p=j;var b,v,U,w,C,S,k,y,L=a(19309),P=a(78837);const{disableLoginForm:D}=P.ZP,I=e=>{var s;let{user:a,isSavingUser:r,updateProfile:i}=e;const n=null!==(s=a&&a.isExternal)&&void 0!==s&&s,t=n&&a&&a.authLabels?a.authLabels[0]:"",l=t?` (Synced via ${t})`:"",o=D||n;return(0,f.jsx)(h.Form,{onSubmit:e=>{i(e)},validateOn:"onBlur",children:e=>{var s,i,n;let{register:t,errors:d}=e;return(0,f.jsxs)(h.FieldSet,{label:b||(b=(0,f.jsx)(g.cC,{id:"user-profile.title"})),children:[(0,f.jsx)(h.Field,{label:L.ag._({id:"user-profile.fields.name-label",message:"Name"})+l,invalid:!!d.name,error:v||(v=(0,f.jsx)(g.cC,{id:"user-profile.fields.name-error"})),disabled:o,children:(0,f.jsx)(h.Input,Object.assign({},t("name",{required:!0}),{id:"edit-user-profile-name",placeholder:L.ag._({id:"user-profile.fields.name-label",message:"Name"}),defaultValue:null!==(s=null==a?void 0:a.name)&&void 0!==s?s:"",suffix:U||(U=(0,f.jsx)(T,{}))}))}),(0,f.jsx)(h.Field,{label:L.ag._({id:"user-profile.fields.email-label",message:"Email"})+l,invalid:!!d.email,error:w||(w=(0,f.jsx)(g.cC,{id:"user-profile.fields.email-error"})),disabled:o,children:(0,f.jsx)(h.Input,Object.assign({},t("email",{required:!0}),{id:"edit-user-profile-email",placeholder:L.ag._({id:"user-profile.fields.email-label",message:"Email"}),defaultValue:null!==(i=null==a?void 0:a.email)&&void 0!==i?i:"",suffix:C||(C=(0,f.jsx)(T,{}))}))}),(0,f.jsx)(h.Field,{label:L.ag._({id:"user-profile.fields.username-label",message:"Username"})+l,disabled:o,children:(0,f.jsx)(h.Input,Object.assign({},t("login"),{id:"edit-user-profile-username",defaultValue:null!==(n=null==a?void 0:a.login)&&void 0!==n?n:"",placeholder:L.ag._({id:"user-profile.fields.username-label",message:"Username"})+l,suffix:S||(S=(0,f.jsx)(T,{}))}))}),(0,f.jsx)("div",{className:"gf-form-button-row",children:(0,f.jsx)(h.Button,{variant:"primary",disabled:r||o,"data-testid":x.wl.components.UserProfile.profileSaveButton,type:"submit",children:k||(k=(0,f.jsx)(g.cC,{id:"common.save"}))})})]})}})},T=()=>D?y||(y=(0,f.jsx)(h.Tooltip,{content:"Login details locked because they are managed in another system.",children:(0,f.jsx)(h.Icon,{name:"lock"})})):null;var z,F,N,_,A;class O extends o.PureComponent{render(){const{isLoading:e,sessions:s,revokeUserSession:a,i18n:r}=this.props;return e?z||(z=(0,f.jsx)(h.LoadingPlaceholder,{text:(0,f.jsx)(g.cC,{id:"user-sessions.loading"})})):(0,f.jsx)("div",{children:s.length>0&&(0,f.jsxs)(f.Fragment,{children:[F||(F=(0,f.jsx)("h3",{className:"page-sub-heading",children:"Sessions"})),(0,f.jsx)("div",{className:"gf-form-group",children:(0,f.jsxs)("table",{className:"filter-table form-inline","data-testid":x.wl.components.UserProfile.sessionsTable,children:[N||(N=(0,f.jsx)("thead",{children:(0,f.jsxs)("tr",{children:[(0,f.jsx)("th",{children:(0,f.jsx)(g.cC,{id:"user-session.seen-at-column"})}),(0,f.jsx)("th",{children:(0,f.jsx)(g.cC,{id:"user-session.created-at-column"})}),(0,f.jsx)("th",{children:(0,f.jsx)(g.cC,{id:"user-session.ip-column"})}),(0,f.jsx)("th",{children:(0,f.jsx)(g.cC,{id:"user-session.browser-column"})}),(0,f.jsx)("th",{})]})})),(0,f.jsx)("tbody",{children:s.map(((e,s)=>(0,f.jsxs)("tr",{children:[e.isActive?_||(_=(0,f.jsx)("td",{children:"Now"})):(0,f.jsx)("td",{children:e.seenAt}),(0,f.jsx)("td",{children:r.date(e.createdAt,{dateStyle:"long"})}),(0,f.jsx)("td",{children:e.clientIp}),(0,f.jsxs)("td",{children:[e.browser," on ",e.os," ",e.osVersion]}),(0,f.jsx)("td",{children:(0,f.jsx)(h.Button,{size:"sm",variant:"destructive",onClick:()=>a(e.id),"aria-label":r._({id:"user-session.revoke",message:"Revoke user session"}),children:A||(A=(0,f.jsx)(h.Icon,{name:"power"}))})})]},s)))})]})})]})})}}const B=(0,g.GV)()(O);var V,Z,q;class H extends o.PureComponent{render(){const{isLoading:e,teams:s}=this.props;return e?V||(V=(0,f.jsx)(h.LoadingPlaceholder,{text:"Loading teams..."})):0===s.length?null:(0,f.jsxs)("div",{children:[Z||(Z=(0,f.jsx)("h3",{className:"page-sub-heading",children:"Teams"})),(0,f.jsx)("div",{className:"gf-form-group",children:(0,f.jsxs)("table",{className:"filter-table form-inline","aria-label":"User teams table",children:[q||(q=(0,f.jsx)("thead",{children:(0,f.jsxs)("tr",{children:[(0,f.jsx)("th",{}),(0,f.jsx)("th",{children:"Name"}),(0,f.jsx)("th",{children:"Email"}),(0,f.jsx)("th",{children:"Members"})]})})),(0,f.jsx)("tbody",{children:s.map(((e,s)=>(0,f.jsxs)("tr",{children:[(0,f.jsx)("td",{className:"width-4 text-center",children:(0,f.jsx)("img",{className:"filter-table__avatar",src:e.avatarUrl,alt:""})}),(0,f.jsx)("td",{children:e.name}),(0,f.jsx)("td",{children:e.email}),(0,f.jsx)("td",{children:e.memberCount})]},s)))})]})})]})}}var E,W=a(86706);const G={initUserProfilePage:W.PA,revokeUserSession:W.cc,changeUserOrg:W.hz,updateUserProfile:W.Lj};function $(e){let{orgsAreLoading:s,sessionsAreLoading:a,teamsAreLoading:r,initUserProfilePage:i,orgs:n,sessions:t,teams:l,isUpdating:o,user:d,revokeUserSession:g,changeUserOrg:x,updateUserProfile:j}=e;return(0,c.Z)((()=>i())),(0,f.jsx)(u.T,{navId:"profile/settings",children:(0,f.jsx)(u.T.Contents,{isLoading:!d,children:(0,f.jsxs)(h.VerticalGroup,{spacing:"md",children:[(0,f.jsx)(I,{updateProfile:j,isSavingUser:o,user:d}),E||(E=(0,f.jsx)(m.Z,{resourceUri:"user"})),(0,f.jsx)(H,{isLoading:r,teams:l}),(0,f.jsx)(p,{isLoading:s,setUserOrg:x,orgs:n,user:d}),(0,f.jsx)(B,{isLoading:a,revokeUserSession:g,sessions:t})]})})})}const M=(0,d.connect)((function(e){const s=e.user,{user:a,teams:r,orgs:i,sessions:n,teamsAreLoading:t,orgsAreLoading:l,sessionsAreLoading:o,isUpdating:d}=s;return{orgsAreLoading:l,sessionsAreLoading:o,teamsAreLoading:t,orgs:i,sessions:n,teams:r,isUpdating:d,user:a}}),G)($)},86706:(e,s,a)=>{a.d(s,{Cp:()=>t,II:()=>o,Lj:()=>h,PA:()=>l,cc:()=>d,hz:()=>c});var r=a(90923),i=a(67220),n=a(10603);function t(e){return async function(s){s((0,n.zc)({updating:!0})),await i.h.changePassword(e),s((0,n.zc)({updating:!1}))}}function l(){return async function(e){await e(o()),e((async function(e){e((0,n.qD)());const s=await i.h.loadTeams();e((0,n.PL)({teams:s}))})),e((async function(e){e((0,n.$S)());const s=await i.h.loadOrgs();e((0,n.Ns)({orgs:s}))})),e((async function(e){e((0,n.Uk)());const s=await i.h.loadSessions();e((0,n.z0)({sessions:s}))}))}}function o(){return async function(e){const s=await i.h.loadUser();e((0,n.aw)({user:s}))}}function d(e){return async function(s){s((0,n.zc)({updating:!0})),await i.h.revokeUserSession(e),s((0,n.p$)({tokenId:e}))}}function c(e){return async function(s){s((0,n.zc)({updating:!0})),await i.h.setUserOrg(e),window.location.href=r.config.appSubUrl+"/profile"}}function h(e){return async function(s){s((0,n.zc)({updating:!0})),await i.h.updateUserProfile(e),await s(o()),s((0,n.zc)({updating:!1}))}}},69578:(e,s,a)=>{a.d(s,{Z:()=>i});var r=a(76687);const i=function(e){(0,r.Z)((function(){e()}))}}}]);
//# sourceMappingURL=UserProfileEditPage.e8abc3b5e98f21318d78.js.map