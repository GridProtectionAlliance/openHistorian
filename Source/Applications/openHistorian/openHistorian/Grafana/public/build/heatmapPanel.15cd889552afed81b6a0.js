"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5857],{96589:($e,re,n)=>{n.d(re,{w:()=>O});var m=n(74848),I=n(32196),Z=n(96540),q=n(40845);const me=10,O=({colorPalette:h,min:x,max:p,display:C,hoverValue:g,useStopsPercentage:w})=>{const[K,V]=(0,Z.useState)([]),[k,L]=(0,Z.useState)({isShown:!1,value:0}),[R,Y]=(0,Z.useState)(null),_=(0,q.$j)(),A=S(_,K);(0,Z.useEffect)(()=>{V(l({colorArray:h,stops:me,useStopsPercentage:w}))},[h,w]);const ae=b=>{const E=b.nativeEvent.offsetX,te=b.currentTarget.offsetWidth,he=Math.floor(E*100/te+1),fe=Math.floor((p-x)*he/100+x);L({isShown:!0,value:fe}),Y(he)},Q=()=>{L({isShown:!1,value:0})};return(0,Z.useEffect)(()=>{Y(g==null?null:v((g-x)/(p-x)))},[g,x,p]),(0,m.jsxs)("div",{className:A.scaleWrapper,onMouseMove:ae,onMouseLeave:Q,children:[(0,m.jsx)("div",{className:A.scaleGradient,children:C&&(k.isShown||g!==void 0)&&(0,m.jsx)("div",{className:A.followerContainer,children:(0,m.jsx)("div",{className:A.follower,style:{left:`${R}%`}})})}),C&&(0,m.jsxs)("div",{className:A.followerContainer,children:[(0,m.jsxs)("div",{className:A.legendValues,children:[(0,m.jsx)("span",{className:A.disabled,children:C(x)}),(0,m.jsx)("span",{className:A.disabled,children:C(p)})]}),R!=null&&(k.isShown||g!==void 0)&&(0,m.jsx)("span",{className:A.hoverValue,style:{left:`${R}%`},children:C(g??k.value)})]})]})},l=({colorArray:h,stops:x,useStopsPercentage:p=!0})=>{const C=h.length;if(p&&C<=20){const V=1/C*100;let k=0;const L=[];for(const R of h)k>0?L.push(`${R} ${k}%`):L.push(R),k+=V,L.push(`${R} ${k}%`);return L}const g=h[C-1],w=Math.ceil(C/x),K=new Set;for(let V=0;V<C;V+=w)K.add(h[V]);return K.add(g),[...K]};function v(h){return h>1?100:h<0?0:h*100}const S=(h,x)=>({scaleWrapper:(0,I.css)({width:"100%",fontSize:"11px",opacity:1}),scaleGradient:(0,I.css)({background:`linear-gradient(90deg, ${x.join()})`,height:"9px",pointerEvents:"none",borderRadius:h.shape.radius.default}),legendValues:(0,I.css)({display:"flex",justifyContent:"space-between",pointerEvents:"none"}),hoverValue:(0,I.css)({position:"absolute",marginTop:"-14px",padding:"3px 15px",transform:"translateX(-50%)"}),followerContainer:(0,I.css)({position:"relative",pointerEvents:"none",whiteSpace:"nowrap"}),follower:(0,I.css)({position:"absolute",height:"13px",width:"13px",borderRadius:h.shape.radius.default,transform:"translateX(-50%) translateY(-50%)",border:`2px solid ${h.colors.text.primary}`,top:"5px"}),disabled:(0,I.css)({color:h.colors.text.disabled})})},1819:($e,re,n)=>{n.d(re,{e:()=>p});var m=n(74848),I=n(32196),Z=n(28240),q=n(83195),me=n(14588),O=n(52622),l=n(40845),v=n(72109),S=n(61994),h=n(74007);function x(g,w,K,V,k){const L=g.fields,R=K!=null?L[K]:null,Y=L.filter(E=>!E.config.custom?.hideFrom?.tooltip),_=Y.find(E=>E.name==="traceID")||L[0],A=[];if(Y.filter(E=>_===E).length>0&&A.push(_),A.push(...Y.filter(E=>_!==E)),A.length===0)return null;const ae=[],Q=[],b=new Set;for(const E of A){if(k===O.$N.Single&&E!==R)continue;const te=E.values[w],he=E.display?E.display(te):{text:`${te}`,numeric:+te};E.getLinks&&E.getLinks({calculatedValue:he,valueRowIndex:w}).forEach(fe=>{const Be=`${fe.title}/${fe.href}`;b.has(Be)||(Q.push(fe),b.add(Be))}),ae.push({name:(0,Z.Ct)(E,g),value:te,valueString:(0,q.cN)(he),highlight:E===R})}return V&&V!==O.xB.None&&ae.sort((E,te)=>me.sortValues(V)(E.value,te.value)),{displayValues:ae,links:Q}}const p=({data:g,rowIndex:w,columnIndex:K,sortOrder:V,mode:k,header:L,padding:R=0})=>{const Y=(0,l.of)(C,R);if(!g||w==null)return null;const _=x(g,w,K,V,k);if(_==null)return null;const{displayValues:A,links:ae}=_;return L==="Exemplar"?(0,m.jsx)(h.i,{displayValues:A,links:ae,header:L}):(0,m.jsxs)("div",{className:Y.wrapper,children:[L&&(0,m.jsx)("div",{className:Y.header,children:(0,m.jsx)("span",{className:Y.title,children:L})}),(0,m.jsx)("table",{className:Y.infoWrap,children:(0,m.jsxs)("tbody",{children:[A.map((Q,b)=>(0,m.jsxs)("tr",{children:[(0,m.jsx)("th",{children:Q.name}),(0,m.jsx)("td",{children:(0,S.A)(Q.valueString)})]},`${b}/${w}`)),ae.map((Q,b)=>(0,m.jsxs)("tr",{children:[(0,m.jsx)("th",{children:"Link"}),(0,m.jsx)("td",{colSpan:2,children:(0,m.jsx)(v.Y,{href:Q.href,external:Q.target==="_blank",weight:"medium",inline:!1,children:Q.title})})]},b))]})})]})},C=(g,w=0)=>({wrapper:(0,I.css)({padding:`${w}px`,background:g.components.tooltip.background,borderRadius:g.shape.borderRadius(2)}),header:(0,I.css)({background:g.colors.background.secondary,alignItems:"center",alignContent:"center",display:"flex",paddingBottom:g.spacing(1)}),title:(0,I.css)({fontWeight:g.typography.fontWeightMedium,overflow:"hidden",display:"inline-block",whiteSpace:"nowrap",textOverflow:"ellipsis",flexGrow:1}),infoWrap:(0,I.css)({padding:g.spacing(1),background:"transparent",border:"none",th:{fontWeight:g.typography.fontWeightMedium,padding:g.spacing(.25,2,.25,0)},tr:{borderBottom:`1px solid ${g.colors.border.weak}`,"&:last-child":{borderBottom:"none"}}}),link:(0,I.css)({color:g.colors.text.link})})},4134:($e,re,n)=>{n.d(re,{C$:()=>O,HY:()=>me,Tr:()=>q,ur:()=>Z});const m=10,I=4;function Z(l,v,S,h,x,p){return l>=S&&l<=x&&v>=h&&v<=p}function q(l,v,S){let h=[];if(l.o.length&&h.push(...l.o.filter(x=>(v==null||x.sidx===v)&&(S==null||x.didx===S))),l.q)for(let x=0;x<l.q.length;x++)h.push(...q(l.q[x],v,S));return h}function me(l,v){return l.x<=v.x+v.w&&l.x+l.w>=v.x&&l.y+l.h>=v.y&&l.y<=v.y+v.h}class O{constructor(v,S,h,x,p=0){this.x=v,this.y=S,this.w=h,this.h=x,this.l=p,this.o=[],this.q=null}split(){let v=this,S=v.x,h=v.y,x=v.w/2,p=v.h/2,C=v.l+1;v.q=[new O(S+x,h,x,p,C),new O(S,h,x,p,C),new O(S,h+p,x,p,C),new O(S+x,h+p,x,p,C)]}quads(v,S,h,x,p){let C=this,g=C.q,w=C.x+C.w/2,K=C.y+C.h/2,V=S<K,k=v<w,L=v+h>w,R=S+x>K;V&&L&&p(g[0]),k&&V&&p(g[1]),k&&R&&p(g[2]),L&&R&&p(g[3])}add(v){let S=this;if(S.q!=null)S.quads(v.x,v.y,v.w,v.h,h=>{h.add(v)});else{let h=S.o;if(h.push(v),h.length>m&&S.l<I){S.split();for(let x=0;x<h.length;x++){let p=h[x];S.quads(p.x,p.y,p.w,p.h,C=>{C.add(p)})}S.o.length=0}}}get(v,S,h,x,p){let C=this,g=C.o;for(let w=0;w<g.length;w++)p(g[w]);C.q!=null&&C.quads(v,S,h,x,w=>{w.get(v,S,h,x,p)})}clear(){this.o.length=0,this.q=null}}},26235:($e,re,n)=>{n.r(re),n.d(re,{plugin:()=>yt});var m=n(74848),I=n(65158),Z=n(37055),q=n(11261),me=n(27310),O=n(32264),l=n(52622),v=n(38248),S=n(11404),h=n(96589),x=n(27825),p=n(80909),C=n(32196),g=n(96540),w=n(94624),K=n(97152),V=n(40845),k=n(79041),L=n(67266),R=n(81297),Y=n(68268),_=n(38761),A=n(62567),ae=n(7874),Q=n(36613),b=n(41260),E=n(83195),te=n(28240),he=n(11389),fe=n(75073),Be=n(52415),qe=n(55307),Ne=n(79871),_e=n(14792),et=n(1819),Fe=n(21164),tt=n(82915);function at(e,r,a,o,t,s,c){let u=e.current?.getContext("2d");if(u!=null){let d=s;for(;o[d-1]===o[s];)d--;let y=d+c,i=0,D=d;for(;D<y;){let se=t[D];i=Math.max(i,se),D++}let $=new Path2D,le=new Path2D;D=d;let ne=0;for(;D<y;){let se=t[D];if(se>0){let U=se/i,ce=ne/c,G=D===s?$:le;const T=r*ce+1,z=r/c-1;G.rect(T,Math.round(a*(1-U)),z,Math.round(a*U))}D++,ne++}u.clearRect(0,0,r,a),u.fillStyle="#2E3036",u.fill(le),u.fillStyle="#5794F2",u.fill($)}}const je=(e,r)=>{const a=e.heatmapColors?.palette,o=e.heatmapColors?.values[r];let t;return o!=null&&(t=a[o]),{cellColor:t,colorPalette:a}},Oe={year:1e3*60*60*24*365,month:1e3*60*60*24*30,week:1e3*60*60*24*7,day:1e3*60*60*24,h:1e3*60*60,m:1e3*60,s:1e3,ms:1},lt=new Set(["ms","s","m","h"]),nt=e=>{let r=1,a="ms";for(a in Oe)if(e>=Oe[a]){r=Math.floor(e/Oe[a]);break}const t=r!==1&&!lt.has(a)?a+"s":a;return`${r} ${t}`},Ie=(e,r,a)=>{let o;switch(r){case"x":o=a?e?.fields.find(({name:t})=>t==="x"||t==="xMin"||t==="xMax"):e?.fields[0];break;case"y":o=a?e?.fields.find(({name:t})=>t==="y"||t==="yMin"||t==="yMax"):e?.fields[1];break;case"count":o=a?e?.fields.find(({name:t})=>t==="count"):e?.fields[2];break}return o},He=(e,r)=>{let a=e.heatmap.fields,o=a.find(u=>u.name==="xMax"),t=a.find(u=>u.name==="yMin"),s=a.find(u=>u.name==="yMax"),c=o.config.interval;return{xBucketMin:o.values[r]-c,xBucketMax:o.values[r],yBucketMin:t.values[r],yBucketMax:s.values[r]}},st=e=>e.seriesIdx===2?(0,m.jsx)(et.e,{data:e.dataRef.current.exemplars,rowIndex:e.dataIdxs[2],header:"Exemplar",padding:8}):(0,m.jsx)(it,{...e}),Ke=264,ot=64,it=({dataIdxs:e,dataRef:r,showHistogram:a,isPinned:o,showColorScale:t=!1,mode:s,annotate:c,maxHeight:u,maxWidth:M,replaceVariables:d})=>{const y=e[1],i=r.current,[D]=(0,g.useState)(()=>i.heatmap?.meta?.type===b.m.HeatmapCells&&!(0,p.Nb)(i.heatmap)),$=Ie(i.heatmap,"x",D),le=Ie(i.heatmap,"y",D),ne=Ie(i.heatmap,"count",D),se=N=>$?.display?(0,E.cN)($.display(N)):$?.type===q.PU.time?(0,_e.UA)().getCurrent()?.formatDate(N,"YYYY-MM-DD HH:mm:ss"):`${N}`,U=$.values,ce=le.values,G=ne.values,T=(0,p.eE)(i.heatmap),z=le?.display?N=>(0,E.cN)(le.display(N)):N=>`${N}`;let B=$?.config.interval,J,j,ee,ue,pe,X=[];const oe=N=>N%(i.yBucketCount??1);let W=oe(y);const ge=Math.floor(y/(i.yBucketCount??1)),Ce=(N=y)=>{if(T.yOrdinalDisplay){const P=i.yLayout===l.D7.le?W-1:W,F=i.yLayout===l.D7.le?W:W+1;J=P<0?T.yMinDisplay:`${T.yOrdinalDisplay[P]}`,j=`${T.yOrdinalDisplay[F]}`,(!T.yOrdinalLabel||Number.isNaN(+T.yOrdinalLabel[0]))&&(pe=i.yLayout===l.D7.le?j:J)}else{const P=ce?.[W];if(i.yLayout===l.D7.le)if(j=`${P}`,i.yLog){let H=(i.yLog===2?Math.log2:Math.log10)(P)-1/i.yLogSplit;J=`${i.yLog**H}`}else J=`${P-i.yBucketSize}`;else if(J=`${P}`,i.yLog){let H=(i.yLog===2?Math.log2:Math.log10)(P)+1/i.yLogSplit;j=`${i.yLog**H}`}else j=`${P+i.yBucketSize}`}i.xLayout===l.D7.le?(ue=U[N],ee=ue-i.xBucketSize):(ee=U[N],ue=ee+i.xBucketSize)};D?{xBucketMin:ee,xBucketMax:ue,yBucketMin:J,yBucketMax:j}=He(i,y):Ce();const{cellColor:ve,colorPalette:xe}=je(i,y),Pe=(N,P)=>{let F=[];for(let H=N;H<=P;H++){if(!G?.[H])continue;const de=je(i,H).cellColor;ie=Ae(H),D?{xBucketMin:ee,xBucketMax:ue,yBucketMin:J,yBucketMax:j}=He(i,H):(W=oe(H),Ce(H));const{label:Ct,value:Bt}=Ve()[0];F.push({label:Ct,value:Bt,color:de??"#FFF",isActive:y===H})}return F},Ve=()=>{const N=s===l.$N.Multi&&!o;if(pe)return N?[{label:`Name ${pe}`,value:i.display(ie)}]:[{label:"Name",value:pe}];switch(i.yLayout){case l.D7.unknown:return N?[{label:z(J),value:i.display(ie)}]:[{label:"",value:z(J)}]}return N?[{label:`Bucket ${z(J)}-${z(j)}`,value:i.display(ie)}]:[{label:"Bucket",value:`${z(J)}-${z(j)}`}]},Ae=N=>G?.[N];let ie=Ae(y);if(s===l.$N.Single||o){const N=B?[{label:"Duration",value:nt(B)}]:[];X=[{label:(0,te.Ct)(ne,i.heatmap),value:i.display(ie),color:ve??"#FFF",colorPlacement:Ne.lJ.trailing,colorIndicator:Ne.fX.value},...Ve(),...N]}if(s===l.$N.Multi&&!o){let N=$.values[y],P=y,F=y;for(;$.values[P-1]===N;)P--;for(;$.values[F+1]===N;)F++;Pe(P,F).forEach(de=>{X.push({label:de.label,value:de.value,color:de.color??"#FFF",colorIndicator:Ne.fX.value,colorPlacement:Ne.lJ.trailing,isActive:de.isActive})})}let Ue;if(o){let N=[],P=[];const F=i.series?.fields[W+1];if(F!=null){const H=!F.config.custom?.hideFrom?.tooltip,de=(F.config.links?.length??0)>0;H&&de&&(N=(0,Fe.u)(F,ge)),P=(0,Fe.O)(i.series,F,d,ge)}Ue=(0,m.jsx)(fe.S,{dataLinks:N,annotate:c,actions:P})}let Ge=(0,g.useRef)(null);const Ye=(0,V.$j)(),Mt=parseInt(Ye.spacing(1),10);let ze=Math.min(Ke,M?M-Mt*2:Ke),Je=ot,Xe=Math.round(ze*Q.A.pxRatio),Ze=Math.round(Je*Q.A.pxRatio);(0,g.useEffect)(()=>{a&&U!=null&&G!=null&&s===l.$N.Single&&at(Ge,Xe,Ze,U,G,y,i.yBucketCount)},[y]);const St={label:"",value:se(ue)};let Re=[];return s===l.$N.Single&&(a&&!D&&Re.push((0,m.jsx)("canvas",{width:Xe,height:Ze,ref:Ge,style:{width:ze+"px",height:Je+"px"}})),xe&&t&&Re.push((0,m.jsx)(h.w,{colorPalette:xe,min:i.heatmapColors?.minValue,max:i.heatmapColors?.maxValue,display:i.display,hoverValue:ie}))),(0,m.jsxs)(qe.i,{children:[(0,m.jsx)(Be.A,{item:St,isPinned:o}),(0,m.jsx)(he.o,{items:X,isPinned:o,scrollable:(0,tt.T5)({mode:s,maxHeight:u}),maxHeight:u,children:Re?.map((N,P)=>(0,m.jsx)("div",{style:{padding:`${Ye.spacing(1)} 0`},children:N},P))}),Ue]})};var be=n(90708),rt=n(73060),ct=n(57875),ye=n(59809),Me=n(88891);function ke({frames:e,annotations:r,options:a,palette:o,theme:t,replaceVariables:s=u=>u,timeRange:c}){if(!e?.length)return{};(0,te.Fm)(e);const u=r?.find(d=>d.name==="exemplar");if(u?.fields.forEach(d=>{d.getLinks=(0,be._M)(u,d,d.state?.scopedVars??{},s)}),a.calculate){if(O.$.featureToggles.transformationsVariableSupport){const d={...a,calculation:{xBuckets:{...a.calculation?.xBuckets},yBuckets:{...a.calculation?.yBuckets}}};return d.calculation?.xBuckets?.value&&s!==void 0&&(d.calculation.xBuckets.value=s(d.calculation.xBuckets.value)),d.calculation?.yBuckets?.value&&s!==void 0&&(d.calculation.yBuckets.value=s(d.calculation.yBuckets.value)),De((0,p.VQ)(e,{...a.calculation,timeRange:c}),u,d,o,t)}return De((0,p.VQ)(e,{...a.calculation,timeRange:c}),u,a,o,t)}let M;for(const d of e)switch(d.meta?.type){case b.m.HeatmapCells:return(0,p.Nb)(d)?De(d,u,a,o,t):ut(d,u,a,o,t);case b.m.HeatmapRows:M=d}if(M==null)if(e.length>1)e.every(y=>!Number.isNaN((0,ye.L)(y.fields[1].state?.displayName)))&&e.sort(ye.Bm),M=(0,rt.Fd)({frames:e,keepDisplayNames:!0});else{let d=e[0],y=d.fields.filter(D=>D.type===q.PU.number);y.every(D=>!Number.isNaN((0,ye.L)(D.state?.displayName)))?(y.sort((D,$)=>(0,ye.L)(D.state?.displayName)-(0,ye.L)($.state?.displayName)),M={...d,fields:[d.fields.find(D=>D.type===q.PU.time),...y]}):M=d}return M.fields.forEach(d=>{(d.config.links?.length??0)!==0&&(d.getLinks=(0,be._M)(M,d,d.state?.scopedVars??{},s))}),{...De((0,p.yJ)({unit:a.yAxis?.unit,decimals:a.yAxis?.decimals,...a.rowsFrame,frame:M}),u,a,o,t),series:M}}const ut=(e,r,a,o,t)=>{if(e.meta?.type!==b.m.HeatmapCells||(0,p.Nb)(e))return{warning:"Expected sparse heatmap format",heatmap:e};we(e.fields[1],a.yAxis,t);const s=e.fields[3],c=we(s,a.cellValues,t);let[u,M]=(0,Me.g$)(s.values,a.color.min,a.color.max,a.filterValues?.le,a.filterValues?.ge);return{heatmap:e,heatmapColors:{palette:o,values:(0,Me.O4)(s.values,o,u,M),minValue:u,maxValue:M},exemplars:r,display:d=>(0,E.cN)(c(d))}},De=(e,r,a,o,t)=>{if(e.meta?.type!==b.m.HeatmapCells)return{warning:"Expected heatmap scanlines format",heatmap:e};if(e.fields.length<2||e.length<2)return{heatmap:e};const s=(0,p.eE)(e);let c,u,M;for(const B of e.fields)switch(B.name){case"y":u=B.name;case"yMin":case"yMax":{u||(u=B.name),s.yOrdinalDisplay==null&&we(B,a.yAxis,t);break}case"x":case"xMin":case"xMax":c=B.name;break;default:B.type===q.PU.number&&!M&&(M=B)}if(!u)return{warning:"Missing Y field",heatmap:e};if(!u)return{warning:"Missing X field",heatmap:e};if(!M)return{warning:"Missing value field",heatmap:e};const d=we(M,a.cellValues,t),y=e.fields[0].values,i=e.fields[1].values,D=y.length;let $=D-i.lastIndexOf(i[0]),le=D/$,ne=i[1]-i[0],se=y[$]-y[0],[U,ce]=(0,Me.g$)(M.values,a.color.min,a.color.max,a.filterValues?.le,a.filterValues?.ge),G=a.calculation?.xBuckets,T=a.calculation?.yBuckets;return{heatmap:e,heatmapColors:{palette:o,values:(0,Me.O4)(M.values,o,U,ce),minValue:U,maxValue:ce},exemplars:r?.length?r:void 0,xBucketSize:se,yBucketSize:ne,xBucketCount:le,yBucketCount:$,yLog:T?.scale?.log??0,xLog:G?.scale?.log??0,xLogSplit:G?.scale?.log?+(G?.value??"1"):1,yLogSplit:T?.scale?.log?+(T?.value??"1"):1,xLayout:c==="xMax"?l.D7.le:c==="xMin"?l.D7.ge:l.D7.unknown,yLayout:u==="yMax"?l.D7.le:u==="yMin"?l.D7.ge:l.D7.unknown,display:B=>(0,E.cN)(d(B))}};function we(e,r,a){if(r?.unit?.length||r?.decimals!=null){const{unit:o,decimals:t}=r;e.display=void 0,e.config={...e.config},o?.length&&(e.config.unit=o),t!=null&&(e.config.decimals=t)}return e.display||(e.display=(0,ct.J)({field:e,theme:a})),e.display}var Te=n(55995),dt=n(37634),We=n(84140),f=n(52995);const Se=[{name:"BrBG",invert:"always"},{name:"PiYG",invert:"always"},{name:"PRGn",invert:"always"},{name:"PuOr",invert:"always"},{name:"RdBu",invert:"always"},{name:"RdGy",invert:"always"},{name:"RdYlBu",invert:"always"},{name:"RdYlGn",invert:"always"},{name:"Spectral",invert:"always"},{name:"Blues",invert:"dark"},{name:"Greens",invert:"dark"},{name:"Greys",invert:"dark"},{name:"Oranges",invert:"dark"},{name:"Purples",invert:"dark"},{name:"Reds",invert:"dark"},{name:"Turbo",invert:"light"},{name:"Cividis",invert:"light"},{name:"Viridis",invert:"light"},{name:"Magma",invert:"light"},{name:"Inferno",invert:"light"},{name:"Plasma",invert:"light"},{name:"Warm",invert:"light"},{name:"Cool",invert:"light"},{name:"Cubehelix",invert:"light",name2:"CubehelixDefault"},{name:"BuGn",invert:"dark"},{name:"BuPu",invert:"dark"},{name:"GnBu",invert:"dark"},{name:"OrRd",invert:"dark"},{name:"PuBuGn",invert:"dark"},{name:"PuBu",invert:"dark"},{name:"PuRd",invert:"dark"},{name:"RdPu",invert:"dark"},{name:"YlGnBu",invert:"dark"},{name:"YlGn",invert:"dark"},{name:"YlOrBr",invert:"dark"},{name:"YlOrRd",invert:"dark"},{name:"Rainbow",invert:"always"},{name:"Sinebow",invert:"always"}],mt=Se.find(e=>e.name==="Spectral");function Ee(e,r){const a={...f.KQ.color,...e},o=[],t=(a.steps??128)-1;if(e.mode===f.P7.Opacity){const s=(0,We.A)(r.visualization.getColorByName(e.fill)).toPercentageRgb(),c=a.scale===f.uM.Exponential?Te.scalePow().exponent(a.exponent).domain([0,1]).range([0,1]):Te.scaleLinear().domain([0,1]).range([0,1]);for(let u=0;u<=t;u++)s.a=c(u/t),o.push((0,We.A)(s).toString("hex8"))}else{const s=Se.find(M=>M.name===a.scheme)??mt;let c="interpolate"+(s.name2??s.name);const u=dt[c];for(let M=0;M<=t;M++){let d=u(M/t),y=d.indexOf("rgb")===0?"#"+[...d.matchAll(/\d+/g)].map(i=>(+i[0]).toString(16).padStart(2,"0")).join(""):d;o.push(y)}(s.invert==="always"||s.invert==="dark"&&r.isDark||s.invert==="light"&&r.isLight)&&o.reverse(),e.reverse&&o.reverse()}return o}const ht=({data:e,id:r,timeRange:a,timeZone:o,width:t,height:s,options:c,fieldConfig:u,eventBus:M,onChangeTimeRange:d,replaceVariables:y})=>{const i=(0,V.$j)(),D=(0,V.of)(ft),{sync:$,eventsScope:le,canAddAnnotations:ne,onSelectRange:se}=(0,k.d2)(),U=$?.()??w.y.Off,[ce,G]=(0,g.useState)(null);let T=(0,g.useRef)(a);T.current=a;const z=(0,g.useMemo)(()=>Ee(c.color,i),[c.color,i]),B=(0,g.useMemo)(()=>{try{return ke({frames:e.series,annotations:e.annotations,options:c,palette:z,theme:i,replaceVariables:y,timeRange:a})}catch(X){return{warning:`${X}`}}},[e.series,e.annotations,c,z,i,y,a]),J=(0,g.useMemo)(()=>{let X=[],oe=[];const W=(0,p.eE)(B.heatmap);return B.exemplars?.length&&(X=B.exemplars?.fields[0].values,W.yMatchWithLabel&&W.yOrdinalDisplay!=null?oe=(B.exemplars?.fields.find(ve=>ve.name===W.yMatchWithLabel).values).map(ve=>W.yOrdinalLabel?.indexOf(ve)):oe=B.exemplars?.fields[1].values),[null,B.heatmap?.fields.map(ge=>ge.values),[X,oe]]},[B.heatmap,B.exemplars]),j=(0,g.useRef)(B);j.current=B;const ee=(0,g.useMemo)(()=>{const X=j.current?.heatmap?.fields[1].config?.custom?.scaleDistribution;return(0,Me.Mv)({dataRef:j,theme:i,timeZone:o,getTimeRange:()=>T.current,cellGap:c.cellGap,hideLE:c.filterValues?.le,hideGE:c.filterValues?.ge,exemplarColor:c.exemplars?.color??"rgba(255,0,255,0.7)",yAxisConfig:c.yAxis,ySizeDivisor:X?.type===l.L4.Log?+(c.calculation?.yBuckets?.value||1):1,selectionMode:c.selectionMode})},[c,o,e.structureRev,U]),ue=()=>!B.heatmap||!c.legend.show?null:(0,m.jsx)(L.KU.Legend,{placement:"bottom",maxHeight:"20%",children:(0,m.jsx)("div",{className:D.colorScaleWrapper,children:(0,m.jsx)(h.w,{hoverValue:void 0,colorPalette:z,min:j.current.heatmapColors?.minValue,max:j.current.heatmapColors?.maxValue,display:B.display})})});if(B.warning||!B.heatmap)return(0,m.jsx)(K.a,{panelId:r,fieldConfig:u,data:e,needsNumberField:!0,message:B.warning});const pe=!!(ne&&ne());return(0,m.jsx)(m.Fragment,{children:(0,m.jsx)(L.KU,{width:t,height:s,legend:ue(),children:(X,oe)=>(0,m.jsxs)(R.Z,{config:ee,data:J,width:X,height:oe,children:[U!==w.y.Off&&(0,m.jsx)(Y.K,{config:ee,eventBus:M,frame:B.series??B.heatmap}),c.tooltip.mode!==l.$N.None&&(0,m.jsx)(_.xl,{config:ee,hoverMode:c.tooltip.mode===l.$N.Single?_.b3.xOne:_.b3.xAll,queryZoom:d,onSelectRange:se,syncMode:U,syncScope:le,render:(W,ge,Ce,ve,xe,Pe,Ve)=>{if(pe&&Pe!=null){G(Pe),xe();return}const Ae=()=>{let ie=W.posToVal(W.cursor.left,"x");G({from:ie,to:ie}),xe()};return(0,m.jsx)(st,{mode:Ve?l.$N.Multi:c.tooltip.mode,dataIdxs:ge,seriesIdx:Ce,dataRef:j,isPinned:ve,dismiss:xe,showHistogram:c.tooltip.yHistogram,showColorScale:c.tooltip.showColorScale,panelData:e,annotate:pe?Ae:void 0,maxHeight:c.tooltip.maxHeight,maxWidth:c.tooltip.maxWidth,replaceVariables:y})},maxWidth:c.tooltip.maxWidth}),(0,m.jsx)(A.W,{annotations:e.annotations??[],config:ee,timeZone:o,newRange:ce,setNewRange:G,canvasRegionRendering:!1}),(0,m.jsx)(ae.U,{config:ee,onChangeTimeRange:d})]},ee.uid)})})},ft=()=>({colorScaleWrapper:(0,C.css)({marginLeft:"25px",padding:"10px 0",maxWidth:"300px"})}),pt=e=>{if(Object.keys(e.options??{}).length===0)return Qe(e,"heatmap",{angular:e},e.fieldConfig);let r=e.options?.tooltip?.show;return r!==void 0&&(r===!0?e.options.tooltip.mode=l.$N.Single:r===!1&&(e.options.tooltip.mode=l.$N.None),delete e.options.tooltip?.show),e.options},Qe=(e,r,a,o)=>{if(r==="heatmap"&&a.angular){const{fieldConfig:t,options:s}=gt({...a.angular,fieldConfig:o});return e.fieldConfig=t,s}if(r==="heatmap-new"){const{bucketFrame:t,...s}=e.options;return t?{...s,rowsFrame:t}:e.options}return{}};function gt(e){const r={defaults:{},overrides:[]},a=e.dataFormat!=="tsbuckets",o={...f.KQ.calculation},t={logBase:1,...e.yAxis};a&&(e.xBucketSize?o.xBuckets={mode:l.J1.Size,value:`${e.xBucketSize}`}:e.xBucketNumber&&(o.xBuckets={mode:l.J1.Count,value:`${e.xBucketNumber}`}),e.yBucketSize?o.yBuckets={mode:l.J1.Size,value:`${e.yBucketSize}`}:e.xBucketNumber&&(o.yBuckets={mode:l.J1.Count,value:`${e.yBucketNumber}`}),t.logBase>1&&(o.yBuckets={mode:l.J1.Count,value:+t.splitFactor>0?`${t.splitFactor}`:void 0,scale:{type:l.L4.Log,log:t.logBase}}));const s=Le(e.cards?.cardPadding,2),c={calculate:a,calculation:o,color:{...f.KQ.color,steps:128},cellGap:s||1,cellRadius:Le(e.cards?.cardRound),yAxis:{axisPlacement:t.show===!1?l.vM.Hidden:l.vM.Left,reverse:!!e.reverseYBuckets,axisWidth:Le(t.width),min:t.min,max:t.max,unit:t.format,decimals:t.decimals},cellValues:{decimals:Le(e.tooltipDecimals)},rowsFrame:{layout:vt(e.yBucketBound)},legend:{show:!!e.legend?.show},showValue:l.yL.Never,tooltip:{mode:e.tooltip?.show?l.$N.Single:l.$N.None,yHistogram:!!e.tooltip?.showHistogram},exemplars:{...f.KQ.exemplars}};e.hideZeroBuckets&&(c.filterValues={...f.KQ.filterValues});const u=e.color??{};switch(u?.mode){case"spectrum":{c.color.mode=f.P7.Scheme;const M=u.colorScheme;let d=Se.find(y=>y.name===M);d||(d=Se.find(y=>M.indexOf(y.name)>=0)),c.color.scheme=d?d.name:f.KQ.color.scheme;break}case"opacity":{c.color.mode=f.P7.Opacity,c.color.scale=u.scale;break}}return c.color.fill=u.cardColor,c.color.min=u.min,c.color.max=u.max,typeof u.min=="number"&&typeof u.max=="number"&&u.min>u.max&&(c.color.min=u.max,c.color.max=u.min,c.color.reverse=!0),{fieldConfig:r,options:c}}function vt(e){switch(e){case"upper":return l.D7.ge;case"lower":return l.D7.le;case"middle":return l.D7.unknown}return l.D7.auto}function Le(e,r){if(e==null||e==="")return r;const a=+e;return isNaN(a)?r:a}class xt{getSuggestionsForData(r){const{dataSummary:a}=r;if(!r.data?.series||!a.hasData||a.timeFieldCount<1||a.numberFieldCount<2||a.numberFieldCount>10)return;const o=Ee(f.KQ.color,O.$.theme2),t=ke({frames:r.data.series,options:f.KQ,palette:o,theme:O.$.theme2});!t||t.warning||r.getListAppender({name:"",pluginId:"heatmap",options:{},fieldConfig:{defaults:{custom:{}},overrides:[]}})}}const yt=new I.m(ht).useFieldConfig({disableStandardOptions:Object.values(Z.uo).filter(e=>e!==Z.uo.Links),useCustomConfig:e=>{e.addCustomEditor({id:"scaleDistribution",path:"scaleDistribution",name:"Y axis scale",category:["Heatmap"],editor:v.W,override:v.W,defaultValue:{type:l.L4.Linear},shouldApply:r=>r.type===q.PU.number,process:me.hS,hideFromDefaults:!0}),(0,S.e)(e)}}).setPanelChangeHandler(Qe).setMigrationHandler(pt).setPanelOptions((e,r)=>{const a=r.options??f.KQ;let o=!1;if(r.data.length>0)try{const s=Ee(a.color,O.$.theme2),c=ke({frames:r.data,options:a,palette:s,theme:O.$.theme2});o=(0,p.eE)(c.heatmap).yOrdinalDisplay!=null}catch{}let t=["Heatmap"];e.addRadio({path:"calculate",name:"Calculate from data",defaultValue:f.KQ.calculate,category:t,settings:{options:[{label:"Yes",value:!0},{label:"No",value:!1}]}}),a.calculate&&(0,x.J)("calculation.",e,a.calculation,t),t=["Y Axis"],e.addRadio({path:"yAxis.axisPlacement",name:"Placement",defaultValue:f.KQ.yAxis.axisPlacement??l.vM.Left,category:t,settings:{options:[{label:"Left",value:l.vM.Left},{label:"Right",value:l.vM.Right},{label:"Hidden",value:l.vM.Hidden}]}}).addUnitPicker({category:t,path:"yAxis.unit",name:"Unit",defaultValue:void 0,settings:{isClearable:!0}}).addNumberInput({category:t,path:"yAxis.decimals",name:"Decimals",settings:{placeholder:"Auto"}}),o||e.addNumberInput({path:"yAxis.min",name:"Min value",settings:{placeholder:"Auto"},category:t}).addTextInput({path:"yAxis.max",name:"Max value",settings:{placeholder:"Auto"},category:t}),e.addNumberInput({path:"yAxis.axisWidth",name:"Axis width",defaultValue:f.KQ.yAxis.axisWidth,settings:{placeholder:"Auto",min:5},category:t}).addTextInput({path:"yAxis.axisLabel",name:"Axis label",defaultValue:f.KQ.yAxis.axisLabel,settings:{placeholder:"Auto"},category:t}),a.calculate||e.addRadio({path:"rowsFrame.layout",name:"Tick alignment",defaultValue:f.KQ.rowsFrame?.layout??l.D7.auto,category:t,settings:{options:[{label:"Auto",value:l.D7.auto},{label:"Top (LE)",value:l.D7.le},{label:"Middle",value:l.D7.unknown},{label:"Bottom (GE)",value:l.D7.ge}]}}),e.addBooleanSwitch({path:"yAxis.reverse",name:"Reverse",defaultValue:f.KQ.yAxis.reverse===!0,category:t}),t=["Colors"],e.addRadio({path:"color.mode",name:"Mode",defaultValue:f.KQ.color.mode,category:t,settings:{options:[{label:"Scheme",value:f.P7.Scheme},{label:"Opacity",value:f.P7.Opacity}]}}),e.addColorPicker({path:"color.fill",name:"Color",defaultValue:f.KQ.color.fill,category:t,showIf:s=>s.color.mode===f.P7.Opacity}),e.addRadio({path:"color.scale",name:"Scale",defaultValue:f.KQ.color.scale,category:t,settings:{options:[{label:"Exponential",value:f.uM.Exponential},{label:"Linear",value:f.uM.Linear}]},showIf:s=>s.color.mode===f.P7.Opacity}),e.addSliderInput({path:"color.exponent",name:"Exponent",defaultValue:f.KQ.color.exponent,category:t,settings:{min:.1,max:2,step:.1},showIf:s=>s.color.mode===f.P7.Opacity&&s.color.scale===f.uM.Exponential}),e.addSelect({path:"color.scheme",name:"Scheme",description:"",defaultValue:f.KQ.color.scheme,category:t,settings:{options:Se.map(s=>({value:s.name,label:s.name}))},showIf:s=>s.color.mode!==f.P7.Opacity}),e.addSliderInput({path:"color.steps",name:"Steps",defaultValue:f.KQ.color.steps,category:t,settings:{min:2,max:128,step:1}}).addBooleanSwitch({path:"color.reverse",name:"Reverse",defaultValue:f.KQ.color.reverse,category:t}).addCustomEditor({id:"__scale__",path:"__scale__",name:"",category:t,editor:()=>{const s=Ee(a.color,O.$.theme2);return(0,m.jsx)("div",{children:(0,m.jsx)(h.w,{colorPalette:s,min:1,max:100})})}}),e.addNumberInput({path:"color.min",name:"Start color scale from value",defaultValue:f.KQ.color.min,settings:{placeholder:"Auto (min)"},category:t}).addNumberInput({path:"color.max",name:"End color scale at value",defaultValue:f.KQ.color.max,settings:{placeholder:"Auto (max)"},category:t}),t=["Cell display"],a.calculate||e.addTextInput({path:"rowsFrame.value",name:"Value name",defaultValue:f.KQ.rowsFrame?.value,settings:{placeholder:"Value"},category:t}),e.addUnitPicker({category:t,path:"cellValues.unit",name:"Unit",defaultValue:void 0,settings:{isClearable:!0}}).addNumberInput({category:t,path:"cellValues.decimals",name:"Decimals",settings:{placeholder:"Auto"}}),e.addSliderInput({name:"Cell gap",path:"cellGap",defaultValue:f.KQ.cellGap,category:t,settings:{min:0,max:25}}).addNumberInput({path:"filterValues.le",name:"Hide cells with values <=",defaultValue:f.KQ.filterValues?.le,settings:{placeholder:"None"},category:t}).addNumberInput({path:"filterValues.ge",name:"Hide cells with values >=",defaultValue:f.KQ.filterValues?.ge,settings:{placeholder:"None"},category:t}),t=["Tooltip"],e.addRadio({path:"tooltip.mode",name:"Tooltip mode",category:t,defaultValue:l.$N.Single,settings:{options:[{value:l.$N.Single,label:"Single"},{value:l.$N.Multi,label:"All"},{value:l.$N.None,label:"Hidden"}]}}),e.addBooleanSwitch({path:"tooltip.yHistogram",name:"Show histogram (Y axis)",defaultValue:f.KQ.tooltip.yHistogram,category:t,showIf:s=>s.tooltip.mode===l.$N.Single}),e.addBooleanSwitch({path:"tooltip.showColorScale",name:"Show color scale",defaultValue:f.KQ.tooltip.showColorScale,category:t,showIf:s=>s.tooltip.mode===l.$N.Single}),e.addNumberInput({path:"tooltip.maxWidth",name:"Max width",category:t,settings:{integer:!0},showIf:s=>s.tooltip.mode!==l.$N.None}),e.addNumberInput({path:"tooltip.maxHeight",name:"Max height",category:t,defaultValue:void 0,settings:{integer:!0},showIf:s=>s.tooltip?.mode===l.$N.Multi}),t=["Legend"],e.addBooleanSwitch({path:"legend.show",name:"Show legend",defaultValue:f.KQ.legend.show,category:t}),t=["Exemplars"],e.addColorPicker({path:"exemplars.color",name:"Color",defaultValue:f.KQ.exemplars.color,category:t})}).setSuggestionsSupplier(new xt).setDataSupport({annotations:!0})}}]);

//# sourceMappingURL=heatmapPanel.15cd889552afed81b6a0.js.map