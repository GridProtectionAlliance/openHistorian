"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4286],{10029:(e,t,a)=>{a.r(t),a.d(t,{AlertRuleListUnconnected:()=>T,default:()=>F});var n,r=a(68404),s=a(18745),i=a(90923),l=a(3490),o=a(5831),c=a(69371),d=a(8674),u=a(21169),h=a(45916);function g(e){let{onDismiss:t}=e;return(0,h.jsx)(l.Modal,{title:"Adding an Alert",isOpen:!0,onDismiss:t,onClickBackdrop:t,children:n||(n=(0,h.jsxs)(l.VerticalGroup,{spacing:"sm",children:[(0,h.jsx)("img",{src:"public/img/alert_howto_new.png",alt:"link to how to alert image"}),(0,h.jsx)("p",{children:"Alerts are added and configured in the Alert tab of any dashboard graph panel, letting you build and visualize an alert using existing queries."}),(0,h.jsx)("p",{children:"Remember to save the dashboard to persist your alert rule changes."})]}))})}var p=a(9575),f=a.n(p);const x=e=>{let{rule:t,search:a,onTogglePause:n}=e;const s=`${t.url}?editPanel=${t.panelId}&tab=alert`,i=(0,r.useCallback)((e=>(0,h.jsx)(f(),{highlightClassName:"highlight-search-match",textToHighlight:e,searchWords:[a]},e)),[a]);return(0,h.jsxs)(l.Card,{children:[(0,h.jsx)(l.Card.Heading,{children:i(t.name)}),(0,h.jsx)(l.Card.Figure,{children:(0,h.jsx)(l.Icon,{size:"xl",name:t.stateIcon,className:`alert-rule-item__icon ${t.stateClass}`})}),(0,h.jsxs)(l.Card.Meta,{children:[(0,h.jsxs)("span",{children:[(0,h.jsxs)("span",{className:`${t.stateClass}`,children:[i(t.stateText)," "]},"text"),"for ",t.stateAge]},"state"),t.info?i(t.info):null]}),(0,h.jsxs)(l.Card.Actions,{children:[(0,h.jsx)(l.Button,{variant:"secondary",icon:"paused"===t.state?"play":"pause",onClick:n,children:"paused"===t.state?"Resume":"Pause"},"play"),(0,h.jsx)(l.LinkButton,{variant:"secondary",href:s,icon:"cog",children:"Edit alert"},"edit")]})]})};var v;const m=()=>v||(v=(0,h.jsxs)(l.Alert,{severity:"warning",title:"Grafana legacy alerting is going away soon",children:[(0,h.jsxs)("p",{children:["You are using Grafana legacy alerting, it has been deprecated and will be removed in the next major version of Grafana.",(0,h.jsx)("br",{}),"We encourage you to upgrade to the new Grafana Alerting experience."]}),(0,h.jsxs)("p",{children:["See"," ",(0,h.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/alerting/unified-alerting/difference-old-new/",children:"What’s New with Grafana Alerting"})," ","to learn more about what‘s new or learn"," ",(0,h.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/alerting/unified-alerting/opt-in/",children:"how to enable the new Grafana Alerting feature"}),"."]})]}));var j=a(9191),y=a(61988);const b=e=>e.searchQuery,w=e=>{const t=new RegExp(e.alertRules.searchQuery,"i");return e.alertRules.items.filter((e=>t.test(e.name)||t.test(e.stateText)||t.test(e.info)))};var A,S,C,k;function R(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const N={getAlertRulesAsync:j.Au,setSearchQuery:y.ql,togglePauseAlertRule:j.en},P=(0,s.connect)((function(e){return{navModel:(0,d.h)(e.navIndex,"alert-list"),alertRules:w(e),search:b(e.alertRules),isLoading:e.alertRules.isLoading}}),N);class T extends r.PureComponent{constructor(){super(...arguments),R(this,"stateFilters",[{label:"All",value:"all"},{label:"OK",value:"ok"},{label:"Not OK",value:"not_ok"},{label:"Alerting",value:"alerting"},{label:"No data",value:"no_data"},{label:"Paused",value:"paused"},{label:"Pending",value:"pending"}]),R(this,"onStateFilterChanged",(e=>{i.locationService.partial({state:e.value})})),R(this,"onOpenHowTo",(()=>{o.Z.publish(new u.Dn({component:g}))})),R(this,"onSearchQueryChange",(e=>{this.props.setSearchQuery(e)})),R(this,"onTogglePause",(e=>{this.props.togglePauseAlertRule(e.id,{paused:"paused"!==e.state})})),R(this,"alertStateFilterOption",(e=>{let{text:t,value:a}=e;return(0,h.jsx)("option",{value:a,children:t},a)}))}componentDidMount(){this.fetchRules()}componentDidUpdate(e){e.queryParams.state!==this.props.queryParams.state&&this.fetchRules()}async fetchRules(){await this.props.getAlertRulesAsync({state:this.getStateFilter()})}getStateFilter(){var e;return null!==(e=this.props.queryParams.state)&&void 0!==e?e:"all"}render(){const{navModel:e,alertRules:t,search:a,isLoading:n}=this.props;return(0,h.jsx)(c.T,{navModel:e,children:(0,h.jsxs)(c.T.Contents,{isLoading:n,children:[(0,h.jsxs)("div",{className:"page-action-bar",children:[(0,h.jsx)("div",{className:"gf-form gf-form--grow",children:(0,h.jsx)(l.FilterInput,{placeholder:"Search alerts",value:a,onChange:this.onSearchQueryChange})}),(0,h.jsxs)("div",{className:"gf-form",children:[A||(A=(0,h.jsx)("label",{className:"gf-form-label",htmlFor:"alert-state-filter",children:"States"})),(0,h.jsx)("div",{className:"width-13",children:(0,h.jsx)(l.Select,{inputId:"alert-state-filter",options:this.stateFilters,onChange:this.onStateFilterChanged,value:this.getStateFilter()})})]}),S||(S=(0,h.jsx)("div",{className:"page-action-bar__spacer"})),i.config.unifiedAlertingEnabled&&(C||(C=(0,h.jsx)(l.LinkButton,{variant:"primary",href:"alerting/ng/new",children:"Add NG Alert"}))),(0,h.jsx)(l.Button,{variant:"secondary",onClick:this.onOpenHowTo,children:"How to add an alert"})]}),k||(k=(0,h.jsx)(m,{})),(0,h.jsx)(l.VerticalGroup,{spacing:"none",children:t.map((e=>(0,h.jsx)(x,{rule:e,search:a,onTogglePause:()=>this.onTogglePause(e)},e.id)))})]})})}}const F=P(T)},9191:(e,t,a)=>{a.d(t,{Au:()=>l,C2:()=>c,c1:()=>u,en:()=>o,fA:()=>h,fg:()=>d,tk:()=>g});var n=a(90923),r=a(36537),s=a(58257),i=a(61988);function l(e){return async t=>{t((0,i.gz)());const a=await(0,n.getBackendSrv)().get("/api/alerts",e);t((0,i.Oc)(a))}}function o(e,t){return async a=>{await(0,n.getBackendSrv)().post(`/api/alerts/${e}/pause`,t);a(l({state:(n.locationService.getSearchObject().state||"all").toString()}))}}function c(e){return async t=>{try{await(0,n.getBackendSrv)().post("/api/alert-notifications",e),t((0,r.$l)((0,s.AT)("Notification created"))),n.locationService.push("/alerting/notifications")}catch(e){(0,n.isFetchError)(e)&&t((0,r.$l)((0,s.t_)(e.data.error)))}}}function d(e){return async t=>{try{await(0,n.getBackendSrv)().put(`/api/alert-notifications/${e.id}`,e),t((0,r.$l)((0,s.AT)("Notification updated")))}catch(e){(0,n.isFetchError)(e)&&t((0,r.$l)((0,s.t_)(e.data.error)))}}}function u(e){return async(t,a)=>{const r=a().notificationChannel.notificationChannel;await(0,n.getBackendSrv)().post("/api/alert-notifications/test",Object.assign({id:r.id},e))}}function h(){return async e=>{const t=(await(0,n.getBackendSrv)().get("/api/alert-notifiers")).sort(((e,t)=>e.name>t.name?1:-1));e((0,i.T2)(t))}}function g(e){return async t=>{await t(h());const a=await(0,n.getBackendSrv)().get(`/api/alert-notifications/${e}`);t((0,i.K)(a))}}}}]);
//# sourceMappingURL=AlertRuleList.e7505f86ff9c64ae107a.js.map