"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7497,8039,8580],{68082:(Z,P,n)=>{n.r(P),n.d(P,{UserListAdminPage:()=>V,UserListAdminPageContent:()=>O,addExtraFilters:()=>N,default:()=>X});var e=n(9892),t=n(68404),C=n(36635),f=n(72648),p=n(14747),A=n(2594),D=n(31403),i=n(6554),m=n(39904),M=n(78889),y=n(79396),I=n(21731),g=n(77582),L=n(2555),R=n(81168),E=n(37592);const v=[],N=a=>{v.push(a)},F={fetchUsers:E.uh,changeQuery:E.R5,changePage:E.oO,changeFilter:E.M6},r=a=>({users:a.userListAdmin.users,query:a.userListAdmin.query,showPaging:a.userListAdmin.showPaging,totalPages:a.userListAdmin.totalPages,page:a.userListAdmin.page,filters:a.userListAdmin.filters,isLoading:a.userListAdmin.isLoading}),O=(0,C.connect)(r,F)(({fetchUsers:a,query:u,changeQuery:d,users:c,showPaging:S,totalPages:Y,page:w,changePage:k,changeFilter:b,filters:z,isLoading:q})=>{const $=(0,f.wW)(W);(0,t.useEffect)(()=>{a()},[a]);const ee=(0,t.useMemo)(()=>c.some(h=>h.licensedRole),[c]);return t.createElement(y.T.Contents,null,t.createElement("div",{className:"page-action-bar"},t.createElement("div",{className:"gf-form gf-form--grow"},t.createElement(p.H,{placeholder:"Search user by login, email, or name.",autoFocus:!0,value:u,onChange:d}),t.createElement(A.S,{options:[{label:"All users",value:!1},{label:"Active last 30 days",value:!0}],onChange:h=>b({name:"activeLast30Days",value:h}),value:z.find(h=>h.name==="activeLast30Days")?.value,className:$.filter}),v.map((h,te)=>t.createElement(h,{key:te,filters:z,onChange:b,className:$.filter}))),g.Vt.hasPermission(R.AccessControlAction.UsersCreate)&&t.createElement(D.Qj,{href:"admin/users/create",variant:"primary"},"New user")),q?t.createElement(L.Z,null):t.createElement(t.Fragment,null,t.createElement("div",{className:(0,e.cx)($.table,"admin-list-table")},t.createElement("table",{className:"filter-table form-inline filter-table--hover"},t.createElement("thead",null,t.createElement("tr",null,t.createElement("th",null),t.createElement("th",null,"Login"),t.createElement("th",null,"Email"),t.createElement("th",null,"Name"),t.createElement("th",null,"Belongs to"),ee&&t.createElement("th",null,"Licensed role"," ",t.createElement(i.u,{placement:"top",content:t.createElement(t.Fragment,null,"Licensed role is based on a user's Org role (i.e. Viewer, Editor, Admin) and their dashboard/folder permissions."," ",t.createElement("a",{className:$.link,target:"_blank",rel:"noreferrer noopener",href:"https://grafana.com/docs/grafana/next/enterprise/license/license-restrictions/#active-users-limit"},"Learn more"))},t.createElement(m.J,{name:"question-circle"}))),t.createElement("th",null,"Last active\xA0",t.createElement(i.u,{placement:"top",content:"Time since user was seen using Grafana"},t.createElement(m.J,{name:"question-circle"}))),t.createElement("th",{style:{width:"1%"}},"Origin"))),t.createElement("tbody",null,c.map(h=>t.createElement(J,{user:h,showLicensedRole:ee,key:h.id}))))),S&&t.createElement(M.t,{numberOfPages:Y,currentPage:w,onNavigate:k})))});function V(){return t.createElement(y.T,{navId:"global-users"},t.createElement(O,null))}const x=a=>`Edit user's ${a} details`,J=(0,t.memo)(({user:a,showLicensedRole:u})=>{const d=(0,f.wW)(W),c=`admin/users/edit/${a.id}`;return t.createElement("tr",{key:a.id},t.createElement("td",{className:"width-4 text-center link-td"},t.createElement("a",{href:c,"aria-label":`Edit user's ${a.name} details`},t.createElement("img",{className:"filter-table__avatar",src:a.avatarUrl,alt:`Avatar for user ${a.name}`}))),t.createElement("td",{className:"link-td max-width-10"},t.createElement("a",{className:"ellipsis",href:c,title:a.login,"aria-label":x(a.name)},a.login)),t.createElement("td",{className:"link-td max-width-10"},t.createElement("a",{className:"ellipsis",href:c,title:a.email,"aria-label":x(a.name)},a.email)),t.createElement("td",{className:"link-td max-width-10"},t.createElement("a",{className:"ellipsis",href:c,title:a.name,"aria-label":x(a.name)},a.name)),t.createElement("td",{className:d.row,title:a.orgs?.length?`The user is a member of the following organizations: ${a.orgs.map(S=>S.name).join(",")}`:void 0},t.createElement(H,{units:a.orgs,icon:"building"}),a.isAdmin&&t.createElement("a",{href:c,"aria-label":x(a.name)},t.createElement(i.u,{placement:"top",content:"Grafana Admin"},t.createElement(m.J,{name:"shield"})))),u&&t.createElement("td",{className:(0,e.cx)("link-td",d.iconRow)},t.createElement("a",{className:"ellipsis",href:c,title:a.name,"aria-label":x(a.name)},a.licensedRole==="None"?t.createElement("span",{className:d.disabled},"Not assigned"," ",t.createElement(i.u,{placement:"top",content:"A licensed role will be assigned when this user signs in"},t.createElement(m.J,{name:"question-circle"}))):a.licensedRole)),t.createElement("td",{className:"link-td"},a.lastSeenAtAge&&t.createElement("a",{href:c,"aria-label":`Last seen at ${a.lastSeenAtAge}. Follow to edit user's ${a.name} details.`},a.lastSeenAtAge==="10 years"?t.createElement("span",{className:d.disabled},"Never"):a.lastSeenAtAge)),t.createElement("td",{className:"text-right"},Array.isArray(a.authLabels)&&a.authLabels.length>0&&t.createElement(I.e,{label:a.authLabels[0],removeIcon:!1,count:0})),t.createElement("td",{className:"text-right"},a.isDisabled&&t.createElement("span",{className:"label label-tag label-tag--gray"},"Disabled")))});J.displayName="UserListItem";const H=({units:a,icon:u})=>{const d=(0,f.wW)(W);return a?.length?a.length>1?t.createElement(i.u,{placement:"top",content:t.createElement("div",{className:d.unitTooltip},a?.map(c=>t.createElement("a",{href:c.url,className:d.link,title:c.name,key:c.name,"aria-label":`Edit ${c.name}`},c.name)))},t.createElement("div",{className:d.unitItem},t.createElement(m.J,{name:u})," ",t.createElement("span",null,a.length))):t.createElement("a",{href:a[0].url,className:d.unitItem,title:a[0].name,key:a[0].name,"aria-label":`Edit ${a[0].name}`},t.createElement(m.J,{name:u})," ",a[0].name):null},W=a=>({table:e.css`
      margin-top: ${a.spacing(3)};
    `,filter:e.css`
      margin: 0 ${a.spacing(1)};
    `,iconRow:e.css`
      svg {
        margin-left: ${a.spacing(.5)};
      }
    `,row:e.css`
      display: flex;
      align-items: center;
      height: 100% !important;

      a {
        padding: ${a.spacing(.5)} 0 !important;
      }
    `,unitTooltip:e.css`
      display: flex;
      flex-direction: column;
    `,unitItem:e.css`
      cursor: pointer;
      padding: ${a.spacing(.5)} 0;
      margin-right: ${a.spacing(1)};
    `,disabled:e.css`
      color: ${a.colors.text.disabled};
    `,link:e.css`
      color: inherit;
      cursor: pointer;
      text-decoration: underline;
    `}),X=V},21038:(Z,P,n)=>{n.r(P),n.d(P,{default:()=>y});var e=n(9892),t=n(68404),C=n(72648),f=n(72142),p=n(79841),A=n(82002),D=n(79396),i=n(81168),m=n(71221),M=n(68082);function y(){const g=A.Vt.hasAccess(i.AccessControlAction.UsersRead,A.Vt.isGrafanaAdmin),L=A.Vt.hasPermission(i.AccessControlAction.OrgUsersRead),R=(0,C.wW)(I),[E,v]=(0,t.useState)(()=>g?"admin":L?"org":null),N=L&&g;return t.createElement(D.T,{navId:"global-users"},N&&t.createElement(f.J,{className:R.tabsMargin},t.createElement(p.O,{label:"All users",active:E==="admin",onChangeTab:()=>v("admin")}),t.createElement(p.O,{label:"Organization users",active:E==="org",onChangeTab:()=>v("org")})),E==="admin"?t.createElement(M.UserListAdminPageContent,null):t.createElement(m.UsersListPageContent,null))}const I=g=>({tabsMargin:(0,e.css)({marginBottom:g.spacing(3)})})},71221:(Z,P,n)=>{n.r(P),n.d(P,{UsersListPageContent:()=>ce,UsersListPageUnconnected:()=>re,default:()=>ge});var e=n(68404),t=n(36635),C=n(41959),f=n(52081),p=n(78889),A=n(79396),D=n(77582),i=n(94599),m=n(31403),M=n(90336);const y={revokeInvite:M.GY},I=(0,t.connect)(null,y);class g extends e.PureComponent{render(){const{invitee:l,revokeInvite:o}=this.props;return e.createElement("tr",null,e.createElement("td",null,l.email),e.createElement("td",null,l.name),e.createElement("td",{className:"text-right"},e.createElement(i.m,{icon:"copy",variant:"secondary",size:"sm",getText:()=>l.url},"Copy Invite"),"\xA0"),e.createElement("td",null,e.createElement(m.zx,{variant:"destructive",size:"sm",icon:"times",onClick:()=>o(l.code),"aria-label":"Revoke Invite"})))}}const L=I(g);class R extends e.PureComponent{render(){const{invitees:l}=this.props;return e.createElement("table",{className:"filter-table form-inline"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Email"),e.createElement("th",null,"Name"),e.createElement("th",null),e.createElement("th",{style:{width:"34px"}}))),e.createElement("tbody",{"data-testid":"InviteesTable-body"},l.map((o,T)=>e.createElement(L,{key:`${o.id}-${T}`,invitee:o}))))}}var E=n(90158),v=n(75804);const{selectAll:N,selectById:F,selectTotal:r}=v.wl,B=(s,l)=>l,_=(0,E.P1)([N,B],(s,l)=>{const o=new RegExp(l,"i");return s.filter(U=>o.test(U.name)||o.test(U.email))});var O=n(14747),V=n(2594),x=n(47694),J=n(81168),H=n(82897),W=n(54899),X=n(95156),a=n(12142);function u(){return async(s,l)=>{try{const{perPage:o,page:T,searchQuery:U}=l().users,K=await(0,W.i)().get("/api/org/users/search",(0,X.y)({perpage:o,page:T,query:U}));s((0,a.eT)(K))}catch{(0,a.k7)()}}}const d=(0,H.debounce)(s=>s(u()),300);function c(s){return async l=>{await(0,W.i)().patch(`/api/org/users/${s.userId}`,{role:s.role}),l(u())}}function S(s){return async l=>{await(0,W.i)().delete(`/api/org/users/${s}`),l(u())}}function Y(s){return async l=>{l((0,a.tZ)()),l((0,a.PJ)(s)),l(u())}}function w(s){return async l=>{l((0,a.tZ)()),l((0,a.w4)(s)),d(l)}}const k=s=>{const l=new RegExp(s.searchQuery,"i");return s.users.filter(o=>l.test(o.login)||l.test(o.email)||l.test(o.name))},b=s=>s.searchQuery;function z(s){return{searchQuery:b(s.users),pendingInvitesCount:r(s.invites),externalUserMngLinkName:s.users.externalUserMngLinkName,externalUserMngLinkUrl:s.users.externalUserMngLinkUrl,canInvite:s.users.canInvite}}const q={changeSearchQuery:w},h=(0,t.connect)(z,q)(({canInvite:s,externalUserMngLinkName:l,externalUserMngLinkUrl:o,searchQuery:T,pendingInvitesCount:U,changeSearchQuery:K,onShowInvites:j,showInvites:G})=>{const ae=[{label:"Users",value:"users"},{label:`Pending Invites (${U})`,value:"invites"}],ne=D.Vt.hasAccess(J.AccessControlAction.OrgUsersAdd,s)&&!x.ZP.disableLoginForm;return e.createElement("div",{className:"page-action-bar","data-testid":"users-action-bar"},e.createElement("div",{className:"gf-form gf-form--grow"},e.createElement(O.H,{value:T,onChange:K,placeholder:"Search user by login, email or name"})),U>0&&e.createElement("div",{style:{marginLeft:"1rem"}},e.createElement(V.S,{value:G?"invites":"users",options:ae,onChange:j})),ne&&e.createElement(m.Qj,{href:"org/users/invite"},"Invite"),o&&e.createElement(m.Qj,{href:o,target:"_blank",rel:"noopener"},l))});var te=n(68903);function me(s){const l=b(s.users);return{users:k(s.users),searchQuery:b(s.users),page:s.users.page,totalPages:s.users.totalPages,perPage:s.users.perPage,invitees:_(s.invites,l),externalUserMngInfo:s.users.externalUserMngInfo,isLoading:s.users.isLoading}}const Ee={loadUsers:u,fetchInvitees:M.nW,changePage:Y,updateUser:c,removeUser:S},de=(0,t.connect)(me,Ee),re=({users:s,page:l,totalPages:o,invitees:T,externalUserMngInfo:U,isLoading:K,loadUsers:j,fetchInvitees:G,changePage:ae,updateUser:oe,removeUser:ne})=>{const[se,ue]=(0,e.useState)(!1),ie=U?(0,C.a)(U):"";(0,e.useEffect)(()=>{j(),G()},[G,j]);const he=(Q,le)=>{oe({...le,role:Q})},ve=()=>{ue(!se)},Pe=()=>se?e.createElement(R,{invitees:T}):e.createElement(f.wc,{spacing:"md"},e.createElement(te.P,{users:s,orgId:D.Vt.user.orgId,onRoleChange:(Q,le)=>he(Q,le),onRemoveUser:Q=>ne(Q.userId)}),e.createElement(f.Lh,{justify:"flex-end"},e.createElement(p.t,{onNavigate:ae,currentPage:l,numberOfPages:o,hideWhenSinglePage:!0})));return e.createElement(A.T.Contents,{isLoading:!K},e.createElement(h,{onShowInvites:ve,showInvites:se}),ie&&e.createElement("div",{className:"grafana-info-box",dangerouslySetInnerHTML:{__html:ie}}),K&&Pe())},ce=de(re);function ge(){return e.createElement(A.T,{navId:"users"},e.createElement(ce,null))}},68903:(Z,P,n)=>{n.d(P,{P:()=>y});var e=n(68404),t=n(31403),C=n(98102),f=n(66226),p=n(11630),A=n(21731),D=n(47694),i=n(77582),m=n(81168),M=n(65135);const y=({users:I,orgId:g,onRoleChange:L,onRemoveUser:R})=>{const[E,v]=(0,e.useState)(null),[N,F]=(0,e.useState)([]);return(0,e.useEffect)(()=>{async function r(){try{if(i.Vt.hasPermission(m.AccessControlAction.ActionRolesList)){let B=await(0,p.ul)(g);F(B)}}catch{console.error("Error loading options")}}i.Vt.licensedAccessControlEnabled()&&r()},[g]),e.createElement(e.Fragment,null,e.createElement("table",{className:"filter-table form-inline"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null),e.createElement("th",null,"Login"),e.createElement("th",null,"Email"),e.createElement("th",null,"Name"),e.createElement("th",null,"Seen"),e.createElement("th",null,"Role"),e.createElement("th",{style:{width:"34px"}}),e.createElement("th",null,"Origin"),e.createElement("th",null))),e.createElement("tbody",null,I.map((r,B)=>{let _=!i.Vt.hasPermissionInMetadata(m.AccessControlAction.OrgUsersWrite,r);return D.ZP.featureToggles.onlyExternalOrgRoleSync&&(_=r?.isExternallySynced||_),e.createElement("tr",{key:`${r.userId}-${B}`},e.createElement("td",{className:"width-2 text-center"},e.createElement("img",{className:"filter-table__avatar",src:r.avatarUrl,alt:"User avatar"})),e.createElement("td",{className:"max-width-6"},e.createElement("span",{className:"ellipsis",title:r.login},r.login)),e.createElement("td",{className:"max-width-5"},e.createElement("span",{className:"ellipsis",title:r.email},r.email)),e.createElement("td",{className:"max-width-5"},e.createElement("span",{className:"ellipsis",title:r.name},r.name)),e.createElement("td",{className:"width-1"},r.lastSeenAtAge),e.createElement("td",{className:"width-8"},i.Vt.licensedAccessControlEnabled()?e.createElement(f.R,{userId:r.userId,orgId:g,roleOptions:N,basicRole:r.role,onBasicRoleChange:O=>L(O,r),basicRoleDisabled:_}):e.createElement(M.A,{"aria-label":"Role",value:r.role,disabled:_,onChange:O=>L(O,r)})),e.createElement("td",{className:"width-1 text-center"},r.isDisabled&&e.createElement("span",{className:"label label-tag label-tag--gray"},"Disabled")),e.createElement("td",{className:"width-1"},Array.isArray(r.authLabels)&&r.authLabels.length>0&&e.createElement(A.e,{label:r.authLabels[0],removeIcon:!1,count:0})),i.Vt.hasPermissionInMetadata(m.AccessControlAction.OrgUsersRemove,r)&&e.createElement("td",{className:"text-right"},e.createElement(t.zx,{size:"sm",variant:"destructive",onClick:()=>{v(r)},icon:"times","aria-label":"Delete user"})))}))),Boolean(E)&&e.createElement(C.s,{body:`Are you sure you want to delete user ${E?.login}?`,confirmText:"Delete",title:"Delete",onDismiss:()=>{v(null)},isOpen:!0,onConfirm:()=>{E&&(R(E),v(null))}}))}}}]);

//# sourceMappingURL=UserListPage.81772552d539a19ec0c7.js.map