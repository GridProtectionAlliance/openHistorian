"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[152],{2471:(ae,w,t)=>{t.r(w),t.d(w,{default:()=>Et});var e=t(74848),g=t(32196),r=t(96540),P=t(54148),B=t(70713),v=t(14110),l=t(32264),y=t(40845),h=t(55852),T=t(67647),C=t(21780),x=t(2913),c=t(8484),M=t(31678),b=t(16233),L=t(71101),i=t(39788);function j(s=!1){return s?(0,c.t)("search.search-input.include-panels-placeholder","Search for dashboards, folders, and panels"):(0,c.t)("search.search-input.placeholder","Search for dashboards and folders")}function a(){return(0,c.t)("search.dashboard-actions.new-dashboard","New dashboard")}function f(){return(0,c.t)("search.dashboard-actions.new-folder","New folder")}function D(){return(0,c.t)("search.dashboard-actions.import","Import")}function N(){return(0,c.t)("search.dashboard-actions.new","New")}var p=t(55314),G=t(67061),q=t(56034),X=t(28138),Z=t(28444),_=t(37690),ee=t(18241),te=t(51887);function K(){const s=(0,M.useDispatch)(),o=(0,_.xK)(),[u]=(0,p.uz)(),[d]=(0,p.wt)(),[,n]=(0,i.ET)(),E=(0,r.useMemo)(()=>!l.$.featureToggles.nestedFolders&&Object.values(o.folder).some(H=>H),[o]),S=n.hasSearchFilters(),O=()=>{s((0,_.cT)({isSelected:!1,folderUID:void 0})),S&&n.doSearchWithDebounce()},m=async()=>{await u({selectedItems:o}),se("delete",o),O()},U=async H=>{await d({selectedItems:o,destinationUID:H}),se("move",o),O()},z=()=>{X.A.publish(new Z.S8({component:te.J,props:{selectedItems:o,onConfirm:U}}))},W=()=>{X.A.publish(new Z.S8({component:ee.T,props:{selectedItems:o,onConfirm:m}}))},V=(0,e.jsx)(h.$n,{onClick:z,variant:"secondary",disabled:E,children:(0,e.jsx)(c.x6,{i18nKey:"browse-dashboards.action.move-button",children:"Move"})});return(0,e.jsxs)(G.B,{gap:1,"data-testid":"manage-actions",children:[E?(0,e.jsx)(q.m,{content:(0,c.t)("browse-dashboards.action.cannot-move-folders","Folders cannot be moved"),children:V}):V,(0,e.jsx)(h.$n,{onClick:W,variant:"destructive",children:(0,e.jsx)(c.x6,{i18nKey:"browse-dashboards.action.delete-button",children:"Delete"})})]})}const Q={move:"grafana_manage_dashboards_item_moved",delete:"grafana_manage_dashboards_item_deleted"};function se(s,o){const u=Object.keys(o.dashboard).filter(n=>o.dashboard[n]),d=Object.keys(o.folder).filter(n=>o.folder[n]);(0,v.rR)(Q[s],{item_counts:{folder:d.length,dashboard:u.length},source:"tree_actions",restore_enabled:l.$.featureToggles.dashboardRestoreUI})}var he=t(19519),le=t(65812);function ue(){const[s,o]=(0,i.ET)();return(0,e.jsx)(he.bj,{showStarredFilter:!0,showLayout:!0,state:s,getTagOptions:o.getTagOptions,getSortOptions:(0,le.getGrafanaSearcher)().getSortOptions,sortPlaceholder:(0,le.getGrafanaSearcher)().sortPlaceholder,onLayoutChange:o.onLayoutChange,onStarredFilterChange:o.onStarredFilterChange,onSortChange:o.onSortChange,onTagFilterChange:o.onTagFilterChange,onDatasourceChange:o.onDatasourceChange,onPanelTypeChange:o.onPanelTypeChange,onSetIncludePanels:o.onSetIncludePanels})}var ge=t(69529),fe=t(72109),me=t(76442),ve=t(92955),R=(s=>(s[s.Unselected=0]="Unselected",s[s.Selected=1]="Selected",s[s.Mixed=2]="Mixed",s))(R||{}),Ee=t(32885),We=t(91793),Fe=t(10022),we=t(39070),oe=t(13544),De=t(10880),Pe=t(49952);function Ne({row:{original:s},isSelected:o,onItemSelectionChange:u}){const d=s.item;if(!o)return(0,e.jsx)(Ce,{});if(d.kind==="ui")return d.uiKind==="pagination-placeholder"?(0,e.jsx)(De.S,{disabled:!0,value:!1}):(0,e.jsx)(Ce,{});if((0,Pe.I)(d.uid))return(0,e.jsx)(Ce,{});const n=o(d);return(0,e.jsx)(De.S,{"data-testid":oe.Tp.pages.BrowseDashboards.table.checkbox(d.uid),"aria-label":(0,c.t)("browse-dashboards.dashboards-tree.select-checkbox","Select"),value:n===R.Selected,indeterminate:n===R.Mixed,onChange:E=>u?.(d,E.currentTarget.checked)})}function Ce(){const s=(0,y.of)($e);return(0,e.jsx)("span",{className:s.checkboxSpacer})}const $e=s=>({checkboxSpacer:(0,g.css)({paddingLeft:s.spacing(2)})});function ze({isSelected:s,onAllSelectionChange:o}){const u=s?.("$all")??R.Unselected;return(0,e.jsx)(De.S,{value:u===R.Selected,indeterminate:u===R.Mixed,"aria-label":(0,c.t)("browse-dashboards.dashboards-tree.select-all-header-checkbox","Select all"),onChange:d=>{u===R.Mixed?o?.(!1):o?.(d.currentTarget.checked)}})}var Ve=t(70255),Oe=t(94753),He=t(29158),Qe=t(62930),Te=t(14578),Ge=t(50720),je=t(78318),Ye=t(40957),Ie=t(18759);const xe="md",Ae="sm";function Ze({row:{original:s},onFolderClick:o,treeID:u}){const d=(0,y.of)(Je),{item:n,level:E,isOpen:S}=s,O=(0,_.V6)(),m=S&&!O[n.uid],U=(0,Ye.cu)(s.item,S);return n.kind==="ui"?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ie.T,{level:E,spacing:{xs:1,md:3}}),(0,e.jsx)("span",{className:d.folderButtonSpacer}),n.uiKind==="empty-folder"?(0,e.jsx)("em",{className:d.emptyText,children:(0,e.jsx)(Oe.E,{variant:"body",color:"secondary",truncate:!0,children:"No items"})}):(0,e.jsx)(Ve.A,{width:200})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ie.T,{level:E,spacing:{xs:1,md:3}}),n.kind==="folder"?(0,e.jsx)(He.K,{size:xe,className:d.chevron,onClick:()=>{o(n.uid,!S)},name:S?"angle-down":"angle-right","aria-label":S?(0,c.t)("browse-dashboards.dashboards-tree.collapse-folder-button","Collapse folder {{title}}",{title:n.title}):(0,c.t)("browse-dashboards.dashboards-tree.expand-folder-button","Expand folder {{title}}",{title:n.title})}):(0,e.jsx)("span",{className:d.folderButtonSpacer}),(0,e.jsxs)("div",{className:d.iconNameContainer,children:[m?(0,e.jsx)(Qe.y,{size:Ae}):(0,e.jsx)(Te.I,{size:Ae,name:U}),(0,e.jsx)(Oe.E,{variant:"body",truncate:!0,id:u&&(0,Pe.e)(u,n),children:n.url?(0,e.jsx)(Ge.N,{onClick:()=>{(0,v.rR)("manage_dashboards_result_clicked")},href:n.url,className:d.link,children:n.title}):n.title})]})]})}const Je=s=>({chevron:(0,g.css)({marginRight:s.spacing(1),width:(0,je.cs)(xe)}),emptyText:(0,g.css)({overflow:"hidden"}),folderButtonSpacer:(0,g.css)({paddingLeft:`calc(${(0,je.cs)(xe)}px + ${s.spacing(1)})`}),iconNameContainer:(0,g.css)({alignItems:"center",display:"flex",gap:s.spacing(1),overflow:"hidden"}),link:(0,g.css)({"&:hover":{textDecoration:"underline"}})});var _e=t(64149);function Xe({row:{original:s}}){const o=(0,y.of)(ke),u=s.item;return u.kind==="ui"?u.uiKind==="pagination-placeholder"?(0,e.jsx)(_e.L.Skeleton,{}):null:u.tags?(0,e.jsx)(_e.L,{className:o.tagList,tags:u.tags}):null}function ke(s){return{tagList:(0,g.css)({justifyContent:"flex-start",flexWrap:"nowrap"})}}var qe=t(37811);const Re=36,ye=36,et=0;function tt({items:s,width:o,height:u,isSelected:d,onFolderClick:n,onAllSelectionChange:E,onItemSelectionChange:S,isItemLoaded:O,requestLoadMore:m,canSelect:U=!1}){const z=(0,r.useId)(),W=(0,r.useRef)(null),V=(0,r.useRef)(null),H=(0,y.of)(Le);(0,r.useEffect)(()=>{W.current&&W.current.resetloadMoreItemsCache(!0),V.current&&V.current.resetAfterIndex(0)},[s]);const A=(0,r.useMemo)(()=>{const I={id:"checkbox",width:0,Header:ze,Cell:Ne},F={id:"name",width:3,Header:(0,e.jsx)("span",{style:{paddingLeft:24},children:(0,e.jsx)(c.x6,{i18nKey:"browse-dashboards.dashboards-tree.name-column",children:"Name"})}),Cell:Se=>(0,e.jsx)(Ze,{...Se,onFolderClick:n})},Y={id:"tags",width:2,Header:(0,c.t)("browse-dashboards.dashboards-tree.tags-column","Tags"),Cell:Xe};return[U&&I,F,Y].filter(we.zz)},[n,U]),$=(0,Ee.useTable)({columns:A,data:s},qe.A),{getTableProps:J,getTableBodyProps:k,headerGroups:ne}=$,ie=(0,r.useMemo)(()=>({table:$,isSelected:d,onAllSelectionChange:E,onItemSelectionChange:S,treeID:z}),[$,d,E,S,s,z]),ce=(0,r.useCallback)(I=>O(I),[O]),be=(0,r.useCallback)((I,F)=>{const{parentUID:Y}=s[I];m(Y)},[m,s]),pe=(0,r.useCallback)(I=>{const F=s[I];return F.item.kind==="ui"&&F.item.uiKind==="divider"?et:ye},[s]);return(0,e.jsxs)("div",{...J(),role:"table",children:[ne.map(I=>{const{key:F,...Y}=I.getHeaderGroupProps({style:{width:o}});return(0,e.jsx)("div",{...Y,className:(0,g.cx)(H.row,H.headerRow),children:I.headers.map(re=>{const{key:Se,...Dt}=re.getHeaderProps();return(0,e.jsx)("div",{...Dt,role:"columnheader",className:H.cell,children:re.render("Header",{isSelected:d,onAllSelectionChange:E})},Se)})},F)}),(0,e.jsx)("div",{...k(),"data-testid":oe.Tp.pages.BrowseDashboards.table.body,children:(0,e.jsx)(Fe.A,{ref:W,itemCount:s.length,isItemLoaded:ce,loadMoreItems:be,children:({onItemsRendered:I,ref:F})=>(0,e.jsx)(We._m,{ref:Y=>{F(Y),V.current=Y},height:u-Re,width:o,itemCount:s.length,itemData:ie,estimatedItemSize:ye,itemSize:pe,onItemsRendered:I,children:st})})})]})}function st({index:s,style:o,data:u}){const d=(0,y.of)(Le),{table:n,isSelected:E,onItemSelectionChange:S,treeID:O}=u,{rows:m,prepareRow:U}=n,z=m[s];U(z);const W=z.original.item,{key:V,...H}=z.getRowProps({style:o});return W.kind==="ui"&&W.uiKind==="divider"?(0,e.jsx)("div",{...H,children:(0,e.jsx)("hr",{className:d.divider})},V):(0,e.jsx)("div",{...H,className:(0,g.cx)(d.row,d.bodyRow),"aria-labelledby":(0,Pe.e)(O,W),"data-testid":oe.Tp.pages.BrowseDashboards.table.row("title"in W?W.title:W.uid),children:z.cells.map(A=>{const{key:$,...J}=A.getCellProps();return(0,e.jsx)("div",{...J,className:d.cell,children:A.render("Cell",{isSelected:E,onItemSelectionChange:S,treeID:O})},$)})},V)}const Le=s=>({row:(0,g.css)({gap:s.spacing(1)}),divider:(0,g.css)({borderTop:`1px solid ${s.colors.border.weak}`,width:"100%",margin:0}),headerRow:(0,g.css)({backgroundColor:s.colors.background.secondary,height:Re}),bodyRow:(0,g.css)({height:ye,"&:hover":{backgroundColor:s.colors.emphasize(s.colors.background.primary,.03)}}),cell:(0,g.css)({padding:s.spacing(1),overflow:"hidden",display:"flex",alignItems:"center"}),link:(0,g.css)({"&:hover":{textDecoration:"underline"}})});function at({folderUID:s,width:o,height:u,canSelect:d}){const n=(0,_.eC)(s),E=(0,M.useDispatch)(),S=(0,_.q0)(s),O=(0,_.Ms)(),m=(0,_.V6)(),U=(0,r.useCallback)((A,$)=>{E((0,_.wn)({folderUID:A,isOpen:$})),$&&E((0,_.Ii)({parentUID:A,pageSize:ve.md}))},[E]),z=(0,r.useCallback)((A,$)=>{E((0,_.t$)({item:A,isSelected:$}))},[E]),W=(0,r.useCallback)(A=>{if(A==="$all"){if(O.$all)return R.Selected;for(const k of Object.values(O))if(typeof k!="boolean"){for(const ne in k)if(k[ne])return R.Mixed}return R.Unselected}return O[A.kind][A.uid]?R.Selected:Be(A,m,O)?R.Mixed:R.Unselected},[O,m]),V=(0,r.useCallback)(A=>{const $=S[A];if(!$)return!1;const J=$.item;return!(J.kind==="ui"&&J.uiKind==="pagination-placeholder")},[S]),H=(0,_.Zg)();return n==="fulfilled"&&S.length===0?(0,e.jsx)("div",{style:{width:o},children:d?(0,e.jsx)(ge.p,{variant:"call-to-action",button:(0,e.jsx)(h.z9,{href:s?`dashboard/new?folderUid=${s}`:"dashboard/new",icon:"plus",size:"lg",children:(0,e.jsx)(c.x6,{i18nKey:"browse-dashboards.empty-state.button-title",children:"Create dashboard"})}),message:s?(0,c.t)("browse-dashboards.empty-state.title-folder","This folder doesn't have any dashboards yet"):(0,c.t)("browse-dashboards.empty-state.title","You haven't created any dashboards yet"),children:s&&(0,e.jsxs)(c.x6,{i18nKey:"browse-dashboards.empty-state.pro-tip",children:["Add/move dashboards to your folder at"," ",(0,e.jsx)(fe.Y,{external:!1,href:"/dashboards",children:"Browse dashboards"})]})}):(0,e.jsx)(me.c,{callToActionElement:(0,e.jsx)("span",{children:"This folder is empty"})})}):(0,e.jsx)(tt,{canSelect:d,items:S,width:o,height:u,isSelected:W,onFolderClick:U,onAllSelectionChange:A=>E((0,_.cT)({isSelected:A,folderUID:s})),onItemSelectionChange:z,isItemLoaded:V,requestLoadMore:H})}function Be(s,o,u){const d=o[s.uid];return d?d.items.some(n=>{const E=u[n.kind][n.uid];return E||Be(n,o,u)}):!1}var ot=t(38138),Me=t(64539),nt=t(83122),rt=t(87978),lt=t(49785),dt=t(88575),it=t(10354),ct=t(71500);const Ke={folderName:""};function ht({onCancel:s,onConfirm:o}){const{handleSubmit:u,register:d,formState:{errors:n}}=(0,lt.mN)({defaultValues:Ke}),E=(0,c.t)("browse-dashboards.action.new-folder-name-required-phrase","Folder name is required."),S=async m=>{try{return await ct.P.validateNewFolderName(m),!0}catch(U){if(U instanceof Error)return U.message;throw U}},O=(0,c.t)("browse-dashboards.new-folder-form.name-label","Folder name");return(0,e.jsxs)("form",{name:"addFolder",onSubmit:u(m=>o(m.folderName)),"data-testid":oe.Tp.pages.BrowseDashboards.NewFolderForm.form,children:[(0,e.jsx)(dt.D,{label:O,invalid:!!n.folderName,error:n.folderName&&n.folderName.message,children:(0,e.jsx)(it.p,{"data-testid":oe.Tp.pages.BrowseDashboards.NewFolderForm.nameInput,id:"folder-name-input",defaultValue:Ke.folderName,...d("folderName",{required:E,validate:async m=>await S(m)})})}),(0,e.jsxs)(G.B,{children:[(0,e.jsx)(h.$n,{variant:"secondary",fill:"outline",onClick:s,children:(0,e.jsx)(c.x6,{i18nKey:"browse-dashboards.new-folder-form.cancel-label",children:"Cancel"})}),(0,e.jsx)(h.$n,{type:"submit",children:(0,e.jsx)(c.x6,{i18nKey:"browse-dashboards.new-folder-form.create-label",children:"Create"})})]})]})}function ut({parentFolder:s,canCreateDashboard:o,canCreateFolder:u}){const[d,n]=(0,r.useState)(!1),E=(0,P.zy)(),[S]=(0,p.Vc)(),[O,m]=(0,r.useState)(!1),U=async W=>{try{await S({title:W,parentUid:s?.uid});const V=s?.parents?s.parents.length+1:0;(0,v.rR)("grafana_manage_dashboards_folder_created",{is_subfolder:!!s?.uid,folder_depth:V})}finally{m(!1)}},z=(0,e.jsxs)(ot.W,{children:[o&&(0,e.jsx)(Me.D,{label:a(),onClick:()=>(0,v.rR)("grafana_menu_item_clicked",{url:de("/dashboard/new",s?.uid),from:E.pathname}),url:de("/dashboard/new",s?.uid)}),u&&(0,e.jsx)(Me.D,{onClick:()=>m(!0),label:f()}),o&&(0,e.jsx)(Me.D,{label:D(),onClick:()=>(0,v.rR)("grafana_menu_item_clicked",{url:de("/dashboard/import",s?.uid),from:E.pathname}),url:de("/dashboard/import",s?.uid)})]});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(nt.m,{overlay:z,onVisibleChange:n,children:(0,e.jsxs)(h.$n,{children:[N(),(0,e.jsx)(Te.I,{name:d?"angle-up":"angle-down"})]})}),O&&(0,e.jsx)(rt._,{title:f(),subtitle:s?.title?`Location: ${s.title}`:void 0,onClose:()=>m(!1),size:"sm",children:(0,e.jsx)(ht,{onConfirm:U,onCancel:()=>m(!1)})})]})}function de(s,o){const u=o?s+"?folderUid="+o:s;return l.$.appSubUrl?l.$.appSubUrl+u:u}var gt=t(9134),ft=t(2960),mt=t(49904);const Ue=(0,r.memo)(()=>{const{uid:s}=(0,P.g)(),o=(0,M.useDispatch)(),u=(0,y.of)(vt),[d,n]=(0,i.ET)(),E=n.hasSearchFilters(),S=(0,P.zy)(),O=(0,r.useMemo)(()=>new URLSearchParams(S.search),[S.search]);(0,r.useEffect)(()=>{n.initStateFromUrl(s),o((0,_.cT)({isSelected:!1,folderUID:void 0}))},[o,s,n]),(0,r.useEffect)(()=>{n.onSetStarred(O.has("starred"))},[O,n]),(0,r.useEffect)(()=>{!E&&d.result&&n.setState({result:void 0,includePanels:void 0})},[E,d.result,n]);const{data:m}=(0,p.kH)(s??p.hT),[U]=(0,p.iB)(),z=(0,r.useMemo)(()=>{if(!m)return;const I=(0,L.R4)(m),F=(0,L.Cg)(m.uid),Y=I.children?.find(re=>re.id===F);return Y&&(Y.active=!0),I},[m]),W=(0,_.QE)(),{data:V}=(0,p.kH)(m?p.hT:"general"),H=m??V,{canEditFolders:A,canEditDashboards:$,canCreateDashboards:J,canCreateFolders:k}=(0,mt.N)(H),ne=b.TP.hasRole("Admin")||b.TP.isGrafanaAdmin,ie=A&&s,ce=A||$,be=async I=>{if(m){const F=await U({...m,title:I});if("error"in F)throw(0,v.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"failed_with_error",error:F.error}),F.error;(0,v.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"success"})}else(0,v.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"failed_no_folderDTO"})},pe=()=>{(0,v.rR)("grafana_browse_dashboards_page_button_to_recently_deleted",{origin:window.location.pathname===(0,x.zj)().appSubUrl+"/dashboards"?"Dashboards":"Folder view"})};return(0,e.jsx)(C.YW,{navId:"dashboards/browse",pageNav:z,onEditTitle:ie?be:void 0,actions:(0,e.jsxs)(e.Fragment,{children:[l.$.featureToggles.dashboardRestore&&l.$.featureToggles.dashboardRestoreUI&&ne&&(0,e.jsx)(h.z9,{variant:"secondary",href:(0,x.zj)().appSubUrl+"/dashboard/recently-deleted",onClick:pe,children:(0,e.jsx)(c.x6,{i18nKey:"browse-dashboards.actions.button-to-recently-deleted",children:"Recently deleted"})}),m&&(0,e.jsx)(gt.m,{folder:m}),(J||k)&&(0,e.jsx)(ut,{parentFolder:m,canCreateDashboard:J,canCreateFolder:k})]}),children:(0,e.jsxs)(C.YW.Contents,{className:u.pageContents,children:[(0,e.jsx)("div",{children:(0,e.jsx)(T.Z,{placeholder:j(d.includePanels),value:d.query,escapeRegex:!1,onChange:I=>n.onQueryChange(I)})}),W?(0,e.jsx)(K,{}):(0,e.jsx)("div",{className:u.filters,children:(0,e.jsx)(ue,{})}),(0,e.jsx)("div",{className:u.subView,children:(0,e.jsx)(B.Ay,{children:({width:I,height:F})=>E?(0,e.jsx)(ft.Q,{canSelect:ce,width:I,height:F,searchState:d,searchStateManager:n}):(0,e.jsx)(at,{canSelect:ce,width:I,height:F,folderUID:s})})})]})})}),vt=s=>({pageContents:(0,g.css)({display:"flex",flexDirection:"column",gap:s.spacing(1),height:"100%"}),subView:(0,g.css)({height:"100%"}),filters:(0,g.css)({display:"none",[s.breakpoints.up("md")]:{display:"block"}})});Ue.displayName="BrowseDashboardsPage";const Et=Ue},18241:(ae,w,t)=>{t.d(w,{T:()=>x});var e=t(74848),g=t(96540),r=t(14110),P=t(32264),B=t(96374),v=t(94753),l=t(68402),y=t(42418),h=t(8484),T=t(55314),C=t(43907);const x=({onConfirm:c,onDismiss:M,selectedItems:b,...L})=>{const{data:i}=(0,T.G2)(b),j=!!(i&&(i.alertRule||i.libraryPanel)),[a,f]=(0,g.useState)(!1),D=async()=>{(0,r.rR)("grafana_manage_dashboards_delete_clicked",{item_counts:{dashboard:Object.keys(b.dashboard).length,folder:Object.keys(b.folder).length},source:"browse_dashboards",restore_enabled:P.$.featureToggles.dashboardRestoreUI}),f(!0);try{await c(),f(!1),M()}catch{f(!1)}};return(0,e.jsx)(B.u,{body:(0,e.jsxs)(e.Fragment,{children:[P.$.featureToggles.dashboardRestore&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(v.E,{element:"p",children:(0,e.jsx)(h.x6,{i18nKey:"browse-dashboards.action.delete-modal-restore-dashboards-text",children:"This action will delete the selected folders immediately but the selected dashboards will be marked for deletion in 30 days. Your organization administrator can restore the dashboards anytime before the 30 days expire. Folders cannot be restored."})}),(0,e.jsx)(l.$,{v:2})]}),(0,e.jsx)(v.E,{element:"p",children:(0,e.jsx)(h.x6,{i18nKey:"browse-dashboards.action.delete-modal-text",children:"This action will delete the following content:"})}),(0,e.jsx)(C.x,{selectedItems:b}),(0,e.jsx)(l.$,{v:2})]}),description:(0,e.jsx)(e.Fragment,{children:j?(0,e.jsx)(y.F,{severity:"warning",title:(0,h.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder"),children:(0,e.jsx)(h.x6,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text",children:"One or more folders contain library panels or alert rules. Delete these first in order to proceed."})}):null}),confirmationText:(0,h.t)("browse-dashboards.action.confirmation-text","Delete"),confirmText:a?(0,h.t)("browse-dashboards.action.deleting","Deleting..."):(0,h.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:M,onConfirm:D,title:(0,h.t)("browse-dashboards.action.delete-modal-title","Delete"),...L,disabled:j})}},51887:(ae,w,t)=>{t.d(w,{J:()=>x});var e=t(74848),g=t(96540),r=t(37390),P=t(42418),B=t(94753),v=t(68402),l=t(88575),y=t(55852),h=t(36607),T=t(8484),C=t(43907);const x=({onConfirm:c,onDismiss:M,selectedItems:b,...L})=>{const[i,j]=(0,g.useState)(),[a,f]=(0,g.useState)(!1),D=Object.keys(b.folder).filter(p=>b.folder[p]),N=async()=>{if(i!==void 0){f(!0);try{await c(i),f(!1),M()}catch{f(!1)}}};return(0,e.jsxs)(r.a,{title:(0,T.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:M,...L,children:[D.length>0&&(0,e.jsx)(P.F,{severity:"info",title:(0,T.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),(0,e.jsx)(B.E,{element:"p",children:(0,e.jsx)(T.x6,{i18nKey:"browse-dashboards.action.move-modal-text",children:"This action will move the following content:"})}),(0,e.jsx)(C.x,{selectedItems:b}),(0,e.jsx)(v.$,{v:3}),(0,e.jsx)(l.D,{label:(0,T.t)("browse-dashboards.action.move-modal-field-label","Folder name"),children:(0,e.jsx)(h.d,{value:i,excludeUIDs:D,onChange:j})}),(0,e.jsxs)(r.a.ButtonRow,{children:[(0,e.jsx)(y.$n,{onClick:M,variant:"secondary",fill:"outline",children:(0,e.jsx)(T.x6,{i18nKey:"browse-dashboards.action.cancel-button",children:"Cancel"})}),(0,e.jsx)(y.$n,{disabled:i===void 0||a,onClick:N,variant:"primary",children:a?(0,T.t)("browse-dashboards.action.moving","Moving..."):(0,T.t)("browse-dashboards.action.move-button","Move")})]})]})}},9134:(ae,w,t)=>{t.d(w,{m:()=>f});var e=t(74848),g=t(96540),r=t(32264),P=t(14110),B=t(39601),v=t(38138),l=t(64539),y=t(83122),h=t(55852),T=t(14578),C=t(87978),x=t(5108),c=t(10096),M=t(8484),b=t(28444),L=t(55314),i=t(49904),j=t(18241),a=t(51887);function f({folder:D}){const[N,p]=(0,g.useState)(!1),[G,q]=(0,g.useState)(!1),[X]=(0,L.aF)(),[Z]=(0,L.Ko)(),{canEditFolders:_,canDeleteFolders:ee,canViewPermissions:te,canSetPermissions:K}=(0,i.N)(D),Q=r.$.featureToggles.nestedFolders&&_,se=async R=>{await X({folder:D,destinationUID:R}),(0,P.rR)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},he=async()=>{await Z(D),(0,P.rR)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:R}=D,Ee=R&&R.length?R[R.length-1].url:"/dashboards";B.Ny.push(Ee)},le=()=>{c.lE.publish(new b.S8({component:a.J,props:{selectedItems:{folder:{[D.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:se}}))},ue=()=>{c.lE.publish(new b.S8({component:j.T,props:{selectedItems:{folder:{[D.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:he}}))},ge=(0,M.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),fe=(0,M.t)("browse-dashboards.folder-actions-button.move","Move"),me=(0,M.t)("browse-dashboards.folder-actions-button.delete","Delete"),ve=(0,e.jsxs)(v.W,{children:[te&&(0,e.jsx)(l.D,{onClick:()=>q(!0),label:ge}),Q&&(0,e.jsx)(l.D,{onClick:le,label:fe}),ee&&(0,e.jsx)(l.D,{destructive:!0,onClick:ue,label:me})]});return!te&&!Q&&!ee?null:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(y.m,{overlay:ve,onVisibleChange:p,children:(0,e.jsxs)(h.$n,{variant:"secondary",children:[(0,e.jsx)(M.x6,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions",children:"Folder actions"}),(0,e.jsx)(T.I,{name:N?"angle-up":"angle-down"})]})}),G&&(0,e.jsx)(C._,{title:(0,M.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:D.title,onClose:()=>q(!1),size:"md",children:(0,e.jsx)(x.x,{resource:"folders",resourceId:D.uid,canSetPermissions:K})})]})}},2960:(ae,w,t)=>{t.d(w,{Q:()=>M});var e=t(74848),g=t(96540),r=t(78368),P=t(14236),B=t(69529),v=t(55852),l=t(8484),y=t(97427),h=t(66359),T=t(31678),C=t(37690);const x=25,c={view:new r.R((0,P.Vc)({fields:[{name:"uid",display:!0,values:Array(x).fill(null)},{name:"kind",display:!0,values:Array(x).fill("dashboard")},{name:"name",display:!0,values:Array(x).fill("")},{name:"location",display:!0,values:Array(x).fill("")},{name:"tags",display:!0,values:Array(x).fill([])}],meta:{custom:{locationInfo:[]}}})),loadMoreItems:()=>Promise.resolve(),isItemLoaded:()=>!1,totalRows:x};function M({width:L,height:i,canSelect:j,searchState:a,searchStateManager:f,emptyState:D}){const N=(0,T.useDispatch)(),p=(0,T.useSelector)(K=>K.browseDashboards.selectedItems),G=(0,C.QE)(),{keyboardEvents:q}=(0,y.d)(),X=a.result??c,Z=(0,g.useCallback)((K,Q)=>K?K==="*"&&Q==="*"?G:K==="*"?!1:p[b(K)][Q]??!1:!1,[p,G]),_=(0,g.useCallback)(()=>{N((0,C.cT)({isSelected:!1,folderUID:void 0}))},[N]),ee=(0,g.useCallback)((K,Q)=>{const se=!Z(K,Q);N((0,C.t$)({item:{kind:b(K),uid:Q},isSelected:se}))},[Z,N]);if(X.totalRows===0){const K=D??(0,e.jsx)(B.p,{button:(0,e.jsx)(v.$n,{variant:"secondary",onClick:f.onClearSearchAndFilters,children:(0,e.jsx)(l.x6,{i18nKey:"browse-dashboards.no-results.clear",children:"Clear search and filters"})}),message:(0,l.t)("browse-dashboards.no-results.text","No results found for your query"),variant:"not-found",role:"alert"});return(0,e.jsx)("div",{style:{width:L},children:K})}const te={response:X,selection:j?Z:void 0,selectionToggle:j?ee:void 0,clearSelection:_,width:L,height:i,onTagSelected:f.onAddTag,keyboardEvents:q,onDatasourceChange:a.datasource?f.onDatasourceChange:void 0,onClickItem:f.onSearchItemClicked};return(0,e.jsx)(h.P,{...te})}function b(L){switch(L){case"folder":return"folder";case"dashboard":return"dashboard";case"panel":return"panel"}throw new Error("Unsupported kind"+L)}},49904:(ae,w,t)=>{t.d(w,{N:()=>v});var e=t(32264),g=t(10096),r=t(31678);function P(l,y){return y?g.TP.hasPermissionInMetadata(l,y):g.TP.hasPermission(l)}function B(l){return l&&l.uid!=="general"&&!e.$.featureToggles.nestedFolders?!1:e.$.featureToggles.accessActionSets?P(r.AccessControlAction.FoldersCreate,l):!l||l.uid==="general"?P(r.AccessControlAction.FoldersCreate):P(r.AccessControlAction.FoldersCreate)&&P(r.AccessControlAction.FoldersWrite,l)}function v(l){const y=P(r.AccessControlAction.DashboardsCreate,l),h=B(l),T=P(r.AccessControlAction.FoldersDelete,l),C=P(r.AccessControlAction.DashboardsWrite,l),x=P(r.AccessControlAction.FoldersWrite,l),c=P(r.AccessControlAction.FoldersPermissionsWrite,l),M=P(r.AccessControlAction.FoldersPermissionsRead,l);return{canCreateDashboards:y,canCreateFolders:h,canDeleteFolders:T,canEditDashboards:C,canEditFolders:x,canSetPermissions:c,canViewPermissions:M}}},19519:(ae,w,t)=>{t.d(w,{bj:()=>b});var e=t(74848),g=t(32196),r=t(32264),P=t(40845),B=t(67061),v=t(10880),l=t(55852),y=t(94354),h=t(73725),T=t(99818),C=t(8484),x=t(64161);function c(){return[{value:x.P.Folders,icon:"folder",description:(0,C.t)("search.actions.view-as-folders","View by folders")},{value:x.P.List,icon:"list-ul",description:(0,C.t)("search.actions.view-as-list","View as list")}]}function M(i){const j=i.layout??x.P.Folders;return j===x.P.Folders&&(i.query||i.sort||i.starred||i.tag.length>0)?x.P.List:j}const b=({state:i,showStarredFilter:j,showLayout:a,sortPlaceholder:f,onLayoutChange:D,onSortChange:N,onStarredFilterChange:p=()=>{},onTagFilterChange:G,getTagOptions:q,getSortOptions:X,onDatasourceChange:Z,onPanelTypeChange:_,onSetIncludePanels:ee})=>{const te=(0,P.of)(L),K=M(i),Q=i.tag.length||i.starred||i.query||i.datasource||i.panel_type?[x.P.Folders]:[];return(0,e.jsxs)(B.B,{justifyContent:"space-between",alignItems:"center",children:[(0,e.jsxs)(B.B,{gap:2,alignItems:"center",children:[(0,e.jsx)(T.$,{isClearable:!1,tags:i.tag,tagOptions:q,onChange:G}),r.$.featureToggles.panelTitleSearch&&(0,e.jsx)(v.S,{"data-testid":"include-panels",disabled:K===x.P.Folders,value:i.includePanels,onChange:()=>ee(!i.includePanels),label:(0,C.t)("search.actions.include-panels","Include panels")}),j&&(0,e.jsx)("div",{className:te.checkboxWrapper,children:(0,e.jsx)(v.S,{label:(0,C.t)("search.actions.starred","Starred"),onChange:p,value:i.starred})}),i.datasource&&(0,e.jsx)(l.$n,{icon:"times",variant:"secondary",onClick:()=>Z(void 0),children:(0,e.jsxs)(C.x6,{i18nKey:"search.actions.remove-datasource-filter",children:["Datasource: ",{datasource:i.datasource}]})}),i.panel_type&&(0,e.jsxs)(l.$n,{icon:"times",variant:"secondary",onClick:()=>_(void 0),children:["Panel: ",i.panel_type]})]}),(0,e.jsxs)(B.B,{gap:2,children:[a&&(0,e.jsx)(y.z,{options:c(),disabledOptions:Q,onChange:D,value:K}),(0,e.jsx)(h.r,{onChange:se=>N(se?.value),value:i.sort,getSortOptions:X,placeholder:f||(0,C.t)("search.actions.sort-placeholder","Sort"),isClearable:!0})]})]})};b.displayName="ActionRow";const L=i=>({checkboxWrapper:(0,g.css)({label:{lineHeight:"1.2"}})})},39788:(ae,w,t)=>{t.d(w,{ET:()=>i,lC:()=>M,ue:()=>C});var e=t(2543),g=t.n(e),r=t(39601),P=t(2619),B=t(33390),v=t(53477),l=t(6204),y=t(65812),h=t(64161),T=t(16757);const C={query:"",tag:[],starred:!1,layout:h.P.Folders,sort:void 0,prevSort:void 0,eventTrackingNamespace:"dashboard_search",deleted:!1},x={sort:null,starred:null,query:null,tag:null,layout:null},c=()=>localStorage.getItem(v.YU)===h.P.List?h.P.List:h.P.Folders;class M extends P.Q{constructor(){super(...arguments),this.updateLocation=(0,e.debounce)(a=>r.Ny.partial(a,!0),300),this.doSearchWithDebounce=(0,e.debounce)(()=>this.doSearch(),300),this.lastSearchTimestamp=0,this.onCloseSearch=()=>{this.updateLocation({search:null,folder:null,...x})},this.onClearSearchAndFilters=()=>{this.setStateAndDoSearch({query:"",datasource:void 0,tag:[],panel_type:void 0,starred:void 0,sort:void 0})},this.onQueryChange=a=>{this.setStateAndDoSearch({query:a})},this.onRemoveTag=a=>{this.setStateAndDoSearch({tag:this.state.tag.filter(f=>f!==a)})},this.onTagFilterChange=a=>{this.setStateAndDoSearch({tag:a})},this.onAddTag=a=>{this.state.tag&&this.state.tag.includes(a)||this.setStateAndDoSearch({tag:[...this.state.tag,a]})},this.onDatasourceChange=a=>{this.setStateAndDoSearch({datasource:a})},this.onPanelTypeChange=a=>{this.setStateAndDoSearch({panel_type:a})},this.onStarredFilterChange=a=>{const f=a.currentTarget.checked;this.setStateAndDoSearch({starred:f})},this.onClearStarred=()=>{this.setStateAndDoSearch({starred:!1})},this.onSetStarred=a=>{a!==this.state.starred&&this.setStateAndDoSearch({starred:a})},this.onSortChange=a=>{a?localStorage.setItem(v.w7,a):localStorage.removeItem(v.w7),this.state.layout===h.P.Folders?this.setStateAndDoSearch({sort:a,layout:h.P.List}):this.setStateAndDoSearch({sort:a})},this.onLayoutChange=a=>{localStorage.setItem(v.YU,a),this.state.sort&&a===h.P.Folders?this.setStateAndDoSearch({layout:a,prevSort:this.state.sort,sort:void 0}):this.setStateAndDoSearch({layout:a,sort:this.state.prevSort})},this.onSetIncludePanels=a=>{this.setStateAndDoSearch({includePanels:a}),B.A.set(v.d7,a)},this.getTagOptions=()=>{const a=this.lastQuery??{kind:["dashboard","folder"],query:"*"};return(0,y.getGrafanaSearcher)().tags(a)},this.onSearchItemClicked=a=>{(0,l.MK)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted})},this.onReportSearchUsage=()=>{(0,l.Pf)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted})}}initStateFromUrl(a,f=!0){const D=(0,T.N1)(r.Ny.getSearchObject());(D.query||D.datasource||D.panel_type)&&(D.layout=h.P.List);const N=c(),p=localStorage.getItem(v.w7)??void 0,G=N===h.P.List?D.sort||p:null;this.setState({...C,...D,layout:N,sort:G??C.sort,prevSort:p,folderUid:a,eventTrackingNamespace:a?"manage_dashboards":"dashboard_search",deleted:this.state.deleted}),f&&this.hasSearchFilters()&&this.doSearch()}setStateAndDoSearch(a){const f=a.sort||this.state.sort||localStorage.getItem(v.w7)||void 0;this.setState({sort:f,...a}),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.hasSearchFilters()&&this.doSearchWithDebounce()}hasSearchFilters(){return!!(this.state.query||this.state.tag.length||this.state.starred||this.state.panel_type||this.state.sort||this.state.deleted||this.state.layout===h.P.List)}getSearchQuery(){const a={query:this.state.query,tags:this.state.tag,ds_uid:this.state.datasource,panel_type:this.state.panel_type,location:this.state.folderUid,sort:this.state.sort,explain:this.state.explain,withAllowedActions:this.state.explain,starred:this.state.starred,deleted:this.state.deleted};return a.sort?.length&&!a.sort.includes("name")&&(a.kind=["dashboard","folder"]),a.query?.length||(a.query="*",a.location||(a.kind=["dashboard","folder"])),!this.state.includePanels&&!a.kind&&(a.kind=["dashboard","folder"]),a.panel_type?.length&&(a.kind=["panel"]),a}doSearch(){const a={layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted};(0,l.J$)(this.state.eventTrackingNamespace,a),this.lastQuery=this.getSearchQuery(),this.setState({loading:!0});const f=(0,y.getGrafanaSearcher)(),D=Date.now();(this.state.starred?f.starred(this.lastQuery):f.search(this.lastQuery)).then(p=>{D>this.lastSearchTimestamp&&(this.setState({result:p,loading:!1}),this.lastSearchTimestamp=D)}).catch(p=>{(0,l.KZ)(this.state.eventTrackingNamespace,{...a,error:p?.message}),this.setState({loading:!1})})}}let b;function L(){if(!b){const a=localStorage.getItem(v.YU)??C.layout;let f=B.A.getBool(v.d7,!0);f&&(f=!1),b=new M({...C,layout:a,includePanels:f})}return b}function i(){const j=L();return[j.useState(),j]}}}]);

//# sourceMappingURL=DashboardListPage.725594642c343001b808.js.map