"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7620],{72235:(S,P,t)=>{t.d(P,{l:()=>h});var a=t(74848),m=t(32196),f=t(96540),I=t(49785);function h({defaultValues:u,onSubmit:b,validateOnMount:E=!1,validateFieldsOnMount:p,children:A,validateOn:D="onSubmit",maxWidth:v=600,...l}){const{handleSubmit:C,trigger:g,formState:y,...B}=(0,I.mN)({mode:D,defaultValues:u});return(0,f.useEffect)(()=>{E&&g(p)},[g,p,E]),(0,a.jsx)("form",{className:(0,m.css)({maxWidth:v!=="none"?v+"px":v,width:"100%"}),onSubmit:C(b),...l,children:A({errors:y.errors,formState:y,trigger:g,...B})})}},84535:(S,P,t)=>{t.r(P),t.d(P,{PlaylistEditPage:()=>p,default:()=>A});var a=t(74848),m=t(54148),f=t(16817),I=t(39601),h=t(21780),u=t(8484),b=t(23833),E=t(86022);const p=()=>{const{uid:D=""}=(0,m.g)(),v=(0,E.NF)(),l=(0,f.A)(()=>v.getPlaylist(D),[D]),C=async y=>{await v.updatePlaylist(y),I.Ny.push("/playlists")},g={text:(0,u.t)("playlist-edit.title","Edit playlist"),subTitle:(0,u.t)("playlist-edit.sub-title","A playlist rotates through a pre-selected list of dashboards. A playlist can be a great way to build situational awareness, or just show off your metrics to your team or visitors.")};return(0,a.jsx)(h.YW,{navId:"dashboards/playlists",pageNav:g,children:(0,a.jsxs)(h.YW.Contents,{isLoading:l.loading,children:[l.error&&(0,a.jsxs)("div",{children:[(0,a.jsx)(u.x6,{i18nKey:"playlist-edit.error-prefix",children:"Error loading playlist:"}),JSON.stringify(l.error)]}),l.value&&(0,a.jsx)(b.$,{onSubmit:C,playlist:l.value})]})})},A=p},23833:(S,P,t)=>{t.d(P,{$:()=>G});var a=t(74848),m=t(96540),f=t(13544),I=t(32264),h=t(88575),u=t(10354),b=t(84167),E=t(67061),p=t(55852),A=t(72235),D=t(59429),v=t(99818),l=t(8484),C=t(65812),g=t(91076),y=t(32196),B=t(55127),R=t.n(B),U=t(40845),L=t(62930),K=t(14578),N=t(29158),F=t(46334);const W=({items:i,onDelete:e})=>{const o=(0,U.of)($);if(!i?.length)return(0,a.jsx)("div",{children:(0,a.jsx)("em",{children:(0,a.jsx)(l.x6,{i18nKey:"playlist-edit.form.table-empty",children:"Playlist is empty. Add dashboards below."})})});const x=s=>{let c=s.type==="dashboard_by_tag"?"apps":"tag-alt";const r=[],n=s.dashboards?.[0];return s.dashboards?s.type==="dashboard_by_tag"?(r.push((0,a.jsx)(F.E,{label:s.value,removeIcon:!1,count:0},s.value)),n?r.push((0,a.jsxs)("span",{children:["\xA0 ",R()("dashboard",s.dashboards.length,!0)]},"info")):(c="exclamation-triangle",r.push((0,a.jsx)("span",{children:"\xA0 No dashboards found"},"info")))):n?r.push(s.dashboards.length>1?(0,a.jsxs)("span",{children:["Multiple items found: $",s.value]},"info"):(0,a.jsx)("span",{children:n.name??s.value},"info")):(c="exclamation-triangle",r.push((0,a.jsxs)("span",{children:["\xA0 Not found: ",s.value]},"info"))):r.push((0,a.jsx)(L.y,{},"spinner")),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(K.I,{name:c,className:o.rightMargin},"icon"),r]})};return(0,a.jsx)(a.Fragment,{children:i.map((s,c)=>(0,a.jsx)(g.sx,{draggableId:`${c}`,index:c,children:r=>(0,a.jsxs)("div",{className:o.row,ref:r.innerRef,...r.draggableProps,...r.dragHandleProps,role:"row",children:[(0,a.jsx)("div",{className:o.actions,role:"cell","aria-label":`Playlist item, ${s.type}, ${s.value}`,children:x(s)}),(0,a.jsxs)("div",{className:o.actions,children:[(0,a.jsx)(N.K,{name:"times",size:"md",onClick:()=>e(c),"data-testid":f.Tp.pages.PlaylistForm.itemDelete,tooltip:(0,l.t)("playlist-edit.form.table-delete","Delete playlist item")}),(0,a.jsx)(K.I,{title:(0,l.t)("playlist-edit.form.table-drag","Drag and drop to reorder"),name:"draggabledots",size:"md"})]})]})},`${c}/${s.value}`))})};function $(i){return{row:(0,y.css)({padding:i.spacing(.75),background:i.colors.background.secondary,borderRadius:i.shape.radius.default,display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"3px",border:`1px solid ${i.colors.border.medium}`,"&:hover":{border:`1px solid ${i.colors.border.strong}`}}),rightMargin:(0,y.css)({marginRight:"5px"}),actions:(0,y.css)({alignItems:"center",justifyContent:"center",display:"flex"}),settings:(0,y.css)({label:"settings",textAlign:"right"})}}const z=({items:i,deleteItem:e,moveItem:o})=>{const x=s=>{s.destination&&o(s.source.index,s.destination?.index)};return(0,a.jsx)(b.n,{label:(0,l.t)("playlist-edit.form.table-heading","Dashboards"),children:(0,a.jsx)(g.JY,{onDragEnd:x,children:(0,a.jsx)(g.gL,{droppableId:"playlist-list",direction:"vertical",children:s=>(0,a.jsxs)("div",{ref:s.innerRef,...s.droppableProps,children:[(0,a.jsx)(W,{items:i,onDelete:e}),s.placeholder]})})})})};var Y=t(16817),V=t(86022);function J(i){const[e,o]=(0,m.useState)(i??[]);(0,Y.A)(async()=>{for(const n of e)if(!n.dashboards){o(await(0,V.qY)(e));return}},[e]);const x=(0,m.useCallback)(n=>{n&&o([...e,{type:"dashboard_by_uid",value:n.uid}])},[e]),s=(0,m.useCallback)(n=>{const d=n[0];if(!d||e.find(O=>O.value===d))return;const j={type:"dashboard_by_tag",value:d};o([...e,j])},[e]),c=(0,m.useCallback)((n,d)=>{if(n===d||!e[n])return;const j=Array.from(e),[O]=j.splice(n,1);j.splice(d,0,O),o(j)},[e]),r=(0,m.useCallback)(n=>{const d=e.slice();d.splice(n,1),o(d)},[e]);return{items:e,addByUID:x,addByTag:s,deleteItem:r,moveItem:c}}const G=({onSubmit:i,playlist:e})=>{const[o,x]=(0,m.useState)(!1),{name:s,interval:c,items:r}=e,n=(0,m.useMemo)(()=>()=>(0,C.getGrafanaSearcher)().tags({kind:["dashboard"]}),[]),{items:d,addByUID:j,addByTag:O,deleteItem:H,moveItem:X}=J(r),Q=T=>{x(!0),i({...T,items:d,uid:e.uid})};return(0,a.jsx)(A.l,{onSubmit:Q,validateOn:"onBlur",children:({register:T,errors:M})=>{const Z=d.length===0||Object.keys(M).length>0;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.D,{label:(0,l.t)("playlist-edit.form.name-label","Name"),invalid:!!M.name,error:M?.name?.message,children:(0,a.jsx)(u.p,{type:"text",...T("name",{required:(0,l.t)("playlist-edit.form.name-required","Name is required")}),placeholder:(0,l.t)("playlist-edit.form.name-placeholder","Name"),defaultValue:s,"aria-label":f.Tp.pages.PlaylistForm.name})}),(0,a.jsx)(h.D,{label:(0,l.t)("playlist-edit.form.interval-label","Interval"),invalid:!!M.interval,error:M?.interval?.message,children:(0,a.jsx)(u.p,{type:"text",...T("interval",{required:(0,l.t)("playlist-edit.form.interval-required","Interval is required")}),placeholder:(0,l.t)("playlist-edit.form.interval-placeholder","5m"),defaultValue:c??"5m","aria-label":f.Tp.pages.PlaylistForm.interval})}),(0,a.jsx)(z,{items:d,deleteItem:H,moveItem:X}),(0,a.jsxs)(b.n,{label:(0,l.t)("playlist-edit.form.heading","Add dashboards"),children:[(0,a.jsx)(h.D,{label:(0,l.t)("playlist-edit.form.add-title-label","Add by title"),children:(0,a.jsx)(D.b,{id:"dashboard-picker",onChange:j},d.length)}),(0,a.jsx)(h.D,{label:(0,l.t)("playlist-edit.form.add-tag-label","Add by tag"),children:(0,a.jsx)(v.$,{isClearable:!0,tags:[],hideValues:!0,tagOptions:n,onChange:O,placeholder:(0,l.t)("playlist-edit.form.add-tag-placeholder","Select a tag")})})]}),(0,a.jsxs)(E.B,{children:[(0,a.jsx)(p.$n,{type:"submit",variant:"primary",disabled:Z,icon:o?"spinner":void 0,children:(0,a.jsx)(l.x6,{i18nKey:"playlist-edit.form.save",children:"Save"})}),(0,a.jsx)(p.z9,{variant:"secondary",href:`${I.$.appSubUrl}/playlists`,children:(0,a.jsx)(l.x6,{i18nKey:"playlist-edit.form.cancel",children:"Cancel"})})]})]})}})}}}]);

//# sourceMappingURL=PlaylistEditPage.6cd5d7fb6e87465c6f38.js.map