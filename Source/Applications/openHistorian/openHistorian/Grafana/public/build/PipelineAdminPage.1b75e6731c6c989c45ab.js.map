{"version":3,"file":"PipelineAdminPage.1b75e6731c6c989c45ab.js","mappings":"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","sources":["webpack://grafana/./public/app/core/hooks/useNavModel.ts","webpack://grafana/./public/app/features/live/pages/AddNewRule.tsx","webpack://grafana/./public/app/features/live/pages/RuleSettingsEditor.tsx","webpack://grafana/./public/app/features/live/pages/RuleSettingsArray.tsx","webpack://grafana/./public/app/features/live/pages/RuleTest.tsx","webpack://grafana/./public/app/features/live/pages/utils.ts","webpack://grafana/./public/app/features/live/pages/RuleModal.tsx","webpack://grafana/./public/app/features/live/pages/PipelineTable.tsx","webpack://grafana/./public/app/features/live/pages/PipelineAdminPage.tsx"],"sourcesContent":["import { useSelector } from 'react-redux';\n\nimport { NavModel } from '@grafana/data';\nimport { StoreState } from 'app/types/store';\n\nimport { getNavModel } from '../selectors/navModel';\n\nexport const useNavModel = (id: string): NavModel => {\n  const navIndex = useSelector((state: StoreState) => state.navIndex);\n  return getNavModel(navIndex, id);\n};\n","import React, { useState } from 'react';\n\nimport { DataSourceRef, LiveChannelScope, SelectableValue } from '@grafana/data';\nimport { DataSourcePicker, getBackendSrv } from '@grafana/runtime';\nimport { Input, Field, Button, ValuePicker, HorizontalGroup } from '@grafana/ui';\nimport { useAppNotification } from 'app/core/copy/appNotification';\n\nimport { Rule } from './types';\n\ninterface Props {\n  onRuleAdded: (rule: Rule) => void;\n}\n\ntype PatternType = 'ds' | 'any';\n\nconst patternTypes: Array<SelectableValue<PatternType>> = [\n  {\n    label: 'Data source',\n    description: 'Configure a channel scoped to a data source instance',\n    value: 'ds',\n  },\n  {\n    label: 'Any',\n    description: 'Enter an arbitray channel pattern',\n    value: 'any',\n  },\n];\n\nexport function AddNewRule({ onRuleAdded }: Props) {\n  const [patternType, setPatternType] = useState<PatternType>();\n  const [pattern, setPattern] = useState<string>();\n  const [patternPrefix, setPatternPrefix] = useState<string>('');\n  const [datasource, setDatasource] = useState<DataSourceRef>();\n  const notifyApp = useAppNotification();\n\n  const onSubmit = () => {\n    if (!pattern) {\n      notifyApp.error('Enter path');\n      return;\n    }\n    if (patternType === 'ds' && !patternPrefix.length) {\n      notifyApp.error('Select datasource');\n      return;\n    }\n\n    getBackendSrv()\n      .post(`api/live/channel-rules`, {\n        pattern: patternPrefix + pattern,\n        settings: {\n          converter: {\n            type: 'jsonAuto',\n          },\n          frameOutputs: [\n            {\n              type: 'managedStream',\n            },\n          ],\n        },\n      })\n      .then((v: any) => {\n        console.log('ADDED', v);\n        setPattern(undefined);\n        setPatternType(undefined);\n        onRuleAdded(v.rule);\n      })\n      .catch((e) => {\n        notifyApp.error('Error adding rule', e);\n        e.isHandled = true;\n      });\n  };\n\n  if (patternType) {\n    return (\n      <div>\n        <HorizontalGroup>\n          {patternType === 'any' && (\n            <Field label=\"Pattern\">\n              <Input\n                value={pattern ?? ''}\n                onChange={(e) => setPattern(e.currentTarget.value)}\n                placeholder=\"scope/namespace/path\"\n              />\n            </Field>\n          )}\n          {patternType === 'ds' && (\n            <>\n              <Field label=\"Data source\">\n                <DataSourcePicker\n                  current={datasource}\n                  onChange={(ds) => {\n                    setDatasource(ds);\n                    setPatternPrefix(`${LiveChannelScope.DataSource}/${ds.uid}/`);\n                  }}\n                />\n              </Field>\n              <Field label=\"Path\">\n                <Input value={pattern ?? ''} onChange={(e) => setPattern(e.currentTarget.value)} placeholder=\"path\" />\n              </Field>\n            </>\n          )}\n\n          <Field label=\"\">\n            <Button onClick={onSubmit} variant={pattern?.length ? 'primary' : 'secondary'}>\n              Add\n            </Button>\n          </Field>\n\n          <Field label=\"\">\n            <Button variant=\"secondary\" onClick={() => setPatternType(undefined)}>\n              Cancel\n            </Button>\n          </Field>\n        </HorizontalGroup>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <ValuePicker\n        label=\"Add channel rule\"\n        variant=\"secondary\"\n        size=\"md\"\n        icon=\"plus\"\n        menuPlacement=\"auto\"\n        isFullWidth={false}\n        options={patternTypes}\n        onChange={(v) => setPatternType(v.value)}\n      />\n    </div>\n  );\n}\n","import React from 'react';\n\nimport { CodeEditor, Select } from '@grafana/ui';\n\nimport { RuleType, RuleSetting, PipeLineEntitiesInfo } from './types';\n\ninterface Props {\n  ruleType: RuleType;\n  onChange: (value: RuleSetting) => void;\n  value: RuleSetting;\n  entitiesInfo: PipeLineEntitiesInfo;\n}\n\nexport const RuleSettingsEditor: React.FC<Props> = ({ onChange, value, ruleType, entitiesInfo }) => {\n  return (\n    <>\n      <Select\n        key={ruleType}\n        options={entitiesInfo[ruleType]}\n        placeholder=\"Select an option\"\n        value={value?.type ?? ''}\n        onChange={(value) => {\n          // set the body with example\n          const type = value.value;\n          onChange({\n            type,\n            [type]: entitiesInfo.getExample(ruleType, type),\n          });\n        }}\n      />\n      <CodeEditor\n        height={'50vh'}\n        value={value ? JSON.stringify(value[value.type], null, '\\t') : ''}\n        showLineNumbers={true}\n        readOnly={false}\n        language=\"json\"\n        showMiniMap={false}\n        onBlur={(text: string) => {\n          const body = JSON.parse(text);\n          onChange({\n            type: value.type,\n            [value.type]: body,\n          });\n        }}\n      />\n    </>\n  );\n};\n","import React, { useState } from 'react';\n\nimport { Select } from '@grafana/ui';\n\nimport { SelectableValue } from '../../../../../packages/grafana-data/src';\n\nimport { RuleSettingsEditor } from './RuleSettingsEditor';\nimport { RuleType, RuleSetting, PipeLineEntitiesInfo } from './types';\n\ninterface Props {\n  ruleType: RuleType;\n  onChange: (value: RuleSetting[]) => void;\n  value: RuleSetting[];\n  entitiesInfo: PipeLineEntitiesInfo;\n}\n\nexport const RuleSettingsArray: React.FC<Props> = ({ onChange, value, ruleType, entitiesInfo }) => {\n  const [index, setIndex] = useState<number>(0);\n  const arr = value ?? [];\n  const onRuleChange = (v: RuleSetting) => {\n    if (!value) {\n      onChange([v]);\n    } else {\n      const copy = [...value];\n      copy[index] = v;\n      onChange(copy);\n    }\n  };\n  // create array of value.length + 1\n  let indexArr: Array<SelectableValue<number>> = [];\n  for (let i = 0; i <= arr.length; i++) {\n    indexArr.push({\n      label: `${ruleType}: ${i}`,\n      value: i,\n    });\n  }\n\n  return (\n    <>\n      <Select\n        placeholder=\"Select an index\"\n        options={indexArr}\n        value={index}\n        onChange={(index) => {\n          // set index to find the correct setting\n          setIndex(index.value!);\n        }}\n      ></Select>\n      <RuleSettingsEditor onChange={onRuleChange} value={arr[index]} ruleType={ruleType} entitiesInfo={entitiesInfo} />\n    </>\n  );\n};\n","import { css } from '@emotion/css';\nimport React, { useState } from 'react';\n\nimport { dataFrameFromJSON, getDisplayProcessor, GrafanaTheme } from '@grafana/data';\nimport { getBackendSrv, config } from '@grafana/runtime';\nimport { Button, CodeEditor, Table, useStyles, Field } from '@grafana/ui';\n\nimport { ChannelFrame, Rule } from './types';\n\ninterface Props {\n  rule: Rule;\n}\n\nexport const RuleTest: React.FC<Props> = (props) => {\n  const [response, setResponse] = useState<ChannelFrame[]>();\n  const [data, setData] = useState<string>();\n  const styles = useStyles(getStyles);\n\n  const onBlur = (text: string) => {\n    setData(text);\n  };\n\n  const onClick = () => {\n    getBackendSrv()\n      .post(`api/live/pipeline-convert-test`, {\n        channelRules: [props.rule],\n        channel: props.rule.pattern,\n        data: data,\n      })\n      .then((data: any) => {\n        const t = data.channelFrames as any[];\n        if (t) {\n          setResponse(\n            t.map((f) => {\n              const frame = dataFrameFromJSON(f.frame);\n              for (const field of frame.fields) {\n                field.display = getDisplayProcessor({ field, theme: config.theme2 });\n              }\n              return { channel: f.channel, frame };\n            })\n          );\n        }\n      })\n      .catch((e) => {\n        setResponse(e);\n      });\n  };\n\n  return (\n    <div>\n      <CodeEditor\n        height={100}\n        value=\"\"\n        showLineNumbers={true}\n        readOnly={false}\n        language=\"json\"\n        showMiniMap={false}\n        onBlur={onBlur}\n      />\n\n      <Button onClick={onClick} className={styles.margin}>\n        Test\n      </Button>\n\n      {response?.length &&\n        response.map((r) => (\n          <Field key={r.channel} label={r.channel}>\n            <Table data={r.frame} width={700} height={Math.min(10 * r.frame.length + 10, 150)} showTypeIcons></Table>\n          </Field>\n        ))}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme) => {\n  return {\n    margin: css`\n      margin-bottom: 15px;\n    `,\n  };\n};\n","import { getBackendSrv } from '@grafana/runtime';\n\nimport { PipelineListOption, PipeLineEntitiesInfo } from './types';\n\nexport async function getPipeLineEntities(): Promise<PipeLineEntitiesInfo> {\n  return await getBackendSrv()\n    .get(`api/live/pipeline-entities`)\n    .then((data) => {\n      return {\n        converter: transformLabel(data, 'converters'),\n        frameProcessors: transformLabel(data, 'frameProcessors'),\n        frameOutputs: transformLabel(data, 'frameOutputs'),\n        getExample: (ruleType, type) => {\n          return data[`${ruleType}s`]?.filter((option: PipelineListOption) => option.type === type)?.[0]?.['example'];\n        },\n      };\n    });\n}\n\nexport function transformLabel(data: any, key: keyof typeof data) {\n  if (Array.isArray(data)) {\n    return data.map((d) => ({\n      label: d[key],\n      value: d[key],\n    }));\n  }\n  return data[key].map((typeObj: PipelineListOption) => ({\n    label: typeObj.type,\n    value: typeObj.type,\n  }));\n}\n","import { css } from '@emotion/css';\nimport React, { useState, useMemo } from 'react';\n\nimport { GrafanaTheme } from '@grafana/data';\nimport { getBackendSrv } from '@grafana/runtime';\nimport { Modal, TabContent, TabsBar, Tab, Button, useStyles } from '@grafana/ui';\n\nimport { RuleSettingsArray } from './RuleSettingsArray';\nimport { RuleSettingsEditor } from './RuleSettingsEditor';\nimport { RuleTest } from './RuleTest';\nimport { Rule, RuleType, PipeLineEntitiesInfo, RuleSetting } from './types';\nimport { getPipeLineEntities } from './utils';\n\ninterface Props {\n  rule: Rule;\n  isOpen: boolean;\n  onClose: () => void;\n  clickColumn: RuleType;\n}\ninterface TabInfo {\n  label: string;\n  type?: RuleType;\n  isTest?: boolean;\n  isConverter?: boolean;\n  icon?: string;\n}\nconst tabs: TabInfo[] = [\n  { label: 'Converter', type: 'converter', isConverter: true },\n  { label: 'Processors', type: 'frameProcessors' },\n  { label: 'Outputs', type: 'frameOutputs' },\n  { label: 'Test', isTest: true, icon: 'flask' },\n];\n\nexport const RuleModal: React.FC<Props> = (props) => {\n  const { isOpen, onClose, clickColumn } = props;\n  const [rule, setRule] = useState<Rule>(props.rule);\n  const [activeTab, setActiveTab] = useState<TabInfo | undefined>(tabs.find((t) => t.type === clickColumn));\n  // to show color of Save button\n  const [hasChange, setChange] = useState<boolean>(false);\n  const [ruleSetting, setRuleSetting] = useState<any>(activeTab?.type ? rule?.settings?.[activeTab.type] : undefined);\n  const [entitiesInfo, setEntitiesInfo] = useState<PipeLineEntitiesInfo>();\n  const styles = useStyles(getStyles);\n\n  const onRuleSettingChange = (value: RuleSetting | RuleSetting[]) => {\n    setChange(true);\n    if (activeTab?.type) {\n      setRule({\n        ...rule,\n        settings: {\n          ...rule.settings,\n          [activeTab?.type]: value,\n        },\n      });\n    }\n    setRuleSetting(value);\n  };\n\n  // load pipeline entities info\n  useMemo(() => {\n    getPipeLineEntities().then((data) => {\n      setEntitiesInfo(data);\n    });\n  }, []);\n\n  const onSave = () => {\n    getBackendSrv()\n      .put(`api/live/channel-rules`, rule)\n      .then(() => {\n        setChange(false);\n        onClose();\n      })\n      .catch((e) => console.error(e));\n  };\n\n  return (\n    <Modal isOpen={isOpen} title={rule.pattern} onDismiss={onClose} closeOnEscape>\n      <TabsBar>\n        {tabs.map((tab, index) => {\n          return (\n            <Tab\n              key={index}\n              label={tab.label}\n              active={tab === activeTab}\n              icon={tab.icon as any}\n              onChangeTab={() => {\n                setActiveTab(tab);\n                if (tab.type) {\n                  // to notify children of the new rule\n                  setRuleSetting(rule?.settings?.[tab.type]);\n                }\n              }}\n            />\n          );\n        })}\n      </TabsBar>\n      <TabContent>\n        {entitiesInfo && rule && activeTab && (\n          <>\n            {activeTab?.isTest && <RuleTest rule={rule} />}\n            {activeTab.isConverter && (\n              <RuleSettingsEditor\n                onChange={onRuleSettingChange}\n                value={ruleSetting}\n                ruleType={'converter'}\n                entitiesInfo={entitiesInfo}\n              />\n            )}\n            {!activeTab.isConverter && activeTab.type && (\n              <RuleSettingsArray\n                onChange={onRuleSettingChange}\n                value={ruleSetting}\n                ruleType={activeTab.type}\n                entitiesInfo={entitiesInfo}\n              />\n            )}\n          </>\n        )}\n        <Button onClick={onSave} className={styles.save} variant={hasChange ? 'primary' : 'secondary'}>\n          Save\n        </Button>\n      </TabContent>\n    </Modal>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme) => {\n  return {\n    save: css`\n      margin-top: 5px;\n    `,\n  };\n};\n","import { css } from '@emotion/css';\nimport React, { useEffect, useState } from 'react';\n\nimport { GrafanaTheme } from '@grafana/data';\nimport { getBackendSrv } from '@grafana/runtime';\nimport { Tag, useStyles, IconButton } from '@grafana/ui';\nimport { getDatasourceSrv } from 'app/features/plugins/datasource_srv';\n\nimport { RuleModal } from './RuleModal';\nimport { Rule, Output, RuleType } from './types';\n\nfunction renderOutputTags(key: string, output?: Output): React.ReactNode {\n  if (!output?.type) {\n    return null;\n  }\n  return <Tag key={key} name={output.type} />;\n}\n\ninterface Props {\n  rules: Rule[];\n  onRuleChanged: () => void;\n  selectRule?: Rule;\n}\n\nexport const PipelineTable: React.FC<Props> = (props) => {\n  const { rules } = props;\n  const [isOpen, setOpen] = useState(false);\n  const [selectedRule, setSelectedRule] = useState<Rule>();\n  const [clickColumn, setClickColumn] = useState<RuleType>('converter');\n  const styles = useStyles(getStyles);\n\n  const onRowClick = (rule: Rule, event?: any) => {\n    if (!rule) {\n      return;\n    }\n    let column = event?.target?.getAttribute('data-column');\n    if (!column || column === 'pattern') {\n      column = 'converter';\n    }\n    setClickColumn(column);\n    setSelectedRule(rule);\n    setOpen(true);\n  };\n\n  // Supports selecting a rule from external config (after add rule)\n  useEffect(() => {\n    if (props.selectRule) {\n      onRowClick(props.selectRule);\n    }\n  }, [props.selectRule]);\n\n  const onRemoveRule = (pattern: string) => {\n    getBackendSrv()\n      .delete(`api/live/channel-rules`, JSON.stringify({ pattern: pattern }))\n      .catch((e) => console.error(e))\n      .finally(() => {\n        props.onRuleChanged();\n      });\n  };\n\n  const renderPattern = (pattern: string) => {\n    if (pattern.startsWith('ds/')) {\n      const idx = pattern.indexOf('/', 4);\n      if (idx > 3) {\n        const uid = pattern.substring(3, idx);\n        const ds = getDatasourceSrv().getInstanceSettings(uid);\n        if (ds) {\n          return (\n            <div>\n              <Tag name={ds.name} colorIndex={1} /> &nbsp;\n              <span>{pattern.substring(idx + 1)}</span>\n            </div>\n          );\n        }\n      }\n    }\n    return pattern;\n  };\n\n  return (\n    <div>\n      <div className=\"admin-list-table\">\n        <table className=\"filter-table filter-table--hover form-inline\">\n          <thead>\n            <tr>\n              <th>Channel</th>\n              <th>Converter</th>\n              <th>Processor</th>\n              <th>Output</th>\n              <th style={{ width: 10 }}>&nbsp;</th>\n            </tr>\n          </thead>\n          <tbody>\n            {rules.map((rule) => (\n              <tr key={rule.pattern} onClick={(e) => onRowClick(rule, e)} className={styles.row}>\n                <td data-pattern={rule.pattern} data-column=\"pattern\">\n                  {renderPattern(rule.pattern)}\n                </td>\n                <td data-pattern={rule.pattern} data-column=\"converter\">\n                  {rule.settings?.converter?.type}\n                </td>\n                <td data-pattern={rule.pattern} data-column=\"processor\">\n                  {rule.settings?.frameProcessors?.map((processor) => (\n                    <span key={rule.pattern + processor.type}>{processor.type}</span>\n                  ))}\n                </td>\n                <td data-pattern={rule.pattern} data-column=\"output\">\n                  {rule.settings?.frameOutputs?.map((output) => (\n                    <span key={rule.pattern + output.type}>{renderOutputTags('out', output)}</span>\n                  ))}\n                </td>\n                <td>\n                  <IconButton\n                    name=\"trash-alt\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      onRemoveRule(rule.pattern);\n                    }}\n                  ></IconButton>\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n      {isOpen && selectedRule && (\n        <RuleModal\n          rule={selectedRule}\n          isOpen={isOpen}\n          onClose={() => {\n            setOpen(false);\n          }}\n          clickColumn={clickColumn}\n        />\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme) => {\n  return {\n    row: css`\n      cursor: pointer;\n    `,\n  };\n};\n","import React, { useEffect, useState, ChangeEvent } from 'react';\n\nimport { getBackendSrv } from '@grafana/runtime';\nimport { Input } from '@grafana/ui';\nimport { Page } from 'app/core/components/Page/Page';\nimport { useNavModel } from 'app/core/hooks/useNavModel';\n\nimport { AddNewRule } from './AddNewRule';\nimport { PipelineTable } from './PipelineTable';\nimport { Rule } from './types';\n\nexport default function PipelineAdminPage() {\n  const [rules, setRules] = useState<Rule[]>([]);\n  const [defaultRules, setDefaultRules] = useState<any[]>([]);\n  const [newRule, setNewRule] = useState<Rule>();\n  const navModel = useNavModel('live-pipeline');\n  const [error, setError] = useState<string>();\n\n  const loadRules = () => {\n    getBackendSrv()\n      .get(`api/live/channel-rules`)\n      .then((data) => {\n        setRules(data.rules ?? []);\n        setDefaultRules(data.rules ?? []);\n      })\n      .catch((e) => {\n        if (e.data) {\n          setError(JSON.stringify(e.data, null, 2));\n        }\n      });\n  };\n\n  useEffect(() => {\n    loadRules();\n  }, []);\n\n  const onSearchQueryChange = (e: ChangeEvent<HTMLInputElement>) => {\n    if (e.target.value) {\n      setRules(rules.filter((rule) => rule.pattern.toLowerCase().includes(e.target.value.toLowerCase())));\n    } else {\n      setRules(defaultRules);\n    }\n  };\n\n  return (\n    <Page navModel={navModel}>\n      <Page.Contents>\n        {error && <pre>{error}</pre>}\n        <div className=\"page-action-bar\">\n          <div className=\"gf-form gf-form--grow\">\n            <Input placeholder=\"Search pattern...\" onChange={onSearchQueryChange} />\n          </div>\n        </div>\n\n        <PipelineTable rules={rules} onRuleChanged={loadRules} selectRule={newRule} />\n\n        <AddNewRule\n          onRuleAdded={(r: Rule) => {\n            console.log('GOT', r, 'vs', rules[0]);\n            setNewRule(r);\n            loadRules();\n          }}\n        />\n      </Page.Contents>\n    </Page>\n  );\n}\n"],"names":["useNavModel","id","navIndex","useSelector","state","getNavModel","patternTypes","label","description","value","AddNewRule","onRuleAdded","patternType","setPatternType","useState","pattern","setPattern","patternPrefix","setPatternPrefix","datasource","setDatasource","notifyApp","useAppNotification","onSubmit","length","getBackendSrv","post","settings","converter","type","frameOutputs","then","v","console","log","undefined","rule","catch","e","error","isHandled","HorizontalGroup","Field","Input","onChange","currentTarget","placeholder","DataSourcePicker","current","ds","LiveChannelScope","uid","Button","onClick","variant","ValuePicker","size","icon","menuPlacement","isFullWidth","options","RuleSettingsEditor","ruleType","entitiesInfo","Select","getExample","CodeEditor","height","JSON","stringify","showLineNumbers","readOnly","language","showMiniMap","onBlur","text","body","parse","RuleSettingsArray","index","setIndex","arr","indexArr","i","push","copy","RuleTest","props","response","setResponse","data","setData","styles","useStyles","getStyles","channelRules","channel","t","channelFrames","map","f","frame","dataFrameFromJSON","field","fields","display","getDisplayProcessor","theme","config","className","margin","r","Table","width","Math","min","showTypeIcons","css","transformLabel","key","Array","isArray","d","typeObj","tabs","isConverter","isTest","RuleModal","isOpen","onClose","clickColumn","setRule","activeTab","setActiveTab","find","hasChange","setChange","ruleSetting","setRuleSetting","setEntitiesInfo","onRuleSettingChange","useMemo","async","get","frameProcessors","filter","option","getPipeLineEntities","Modal","title","onDismiss","closeOnEscape","TabsBar","tab","Tab","active","onChangeTab","TabContent","put","save","renderOutputTags","output","Tag","name","PipelineTable","rules","setOpen","selectedRule","setSelectedRule","setClickColumn","onRowClick","event","column","target","getAttribute","useEffect","selectRule","renderPattern","startsWith","idx","indexOf","substring","getDatasourceSrv","getInstanceSettings","colorIndex","style","row","processor","IconButton","stopPropagation","delete","finally","onRuleChanged","PipelineAdminPage","setRules","defaultRules","setDefaultRules","newRule","setNewRule","navModel","setError","loadRules","Page","toLowerCase","includes"],"sourceRoot":""}