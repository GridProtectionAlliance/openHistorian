/*! For license information please see 9137.d7fb8ff029fa51328905.js.LICENSE.txt */
(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9137],{88292:(e,t,a)=>{"use strict";a.d(t,{B:()=>u});var l=a(82897),r=a(68404),n=a(8072),o=a(3490),i=a(22002),s=a(45916);const u=e=>{let{refId:t,value:a="",onChange:u}=e;const[c,d]=(0,r.useState)(null!=a?a:""),p=(0,l.debounce)(u,1e3);return u=e=>{d(e.target.value),p(e.target.value)},(0,s.jsx)(n.EditorField,{label:"Alias by",children:(0,s.jsx)(o.Input,{id:`${t}-alias-by`,width:i.Lh,value:c,onChange:u})})}},54919:(e,t,a)=>{"use strict";a.d(t,{a1:()=>P});var l,r=a(68404),n=a(8072),o=a(2986),i=a(25576),s=a(54834),u=a(3490),c=a(22002),d=a(49224),p=a(45916);const h=e=>{let{refId:t,onChange:a,graphPeriod:r,variableOptionGroup:o}=e;return(0,p.jsx)(n.EditorRow,{children:(0,p.jsx)(n.EditorField,{label:"Graph period",htmlFor:`${t}-graph-period`,tooltip:(0,p.jsxs)(p.Fragment,{children:["Set ",l||(l=(0,p.jsx)("code",{children:"graph_period"}))," which forces a preferred period between points. Automatically set to the current interval if left blank."]}),children:(0,p.jsxs)(u.HorizontalGroup,{children:[(0,p.jsx)(u.Switch,{"data-testid":`${t}-switch-graph-period`,value:"disabled"!==r,onChange:e=>a(e.currentTarget.checked?"":"disabled")}),(0,p.jsx)(d.$d,{inputId:`${t}-graph-period`,templateVariableOptions:o.options,current:r,onChange:a,selectWidth:c.Lh,disabled:"disabled"===r,aligmentPeriods:c.Ry})]})})})};var m=a(88292);const v=e=>{let{inputId:t,query:a,templateVariableOptions:l,onChange:n}=e;const{valueType:i,metricKind:s,perSeriesAligner:c,preprocessor:d}=a,{perSeriesAligner:h,alignOptions:m}=(0,r.useMemo)((()=>(0,o.ID)(i,s,c,d)),[i,s,c,d]);return(0,p.jsx)(u.Select,{onChange:e=>{let{value:t}=e;return n(Object.assign({},a,{perSeriesAligner:t}))},value:[...m,...l].find((e=>e.value===h)),options:[{label:"Template Variables",options:l},{label:"Alignment options",expanded:!0,options:m}],placeholder:"Select Alignment",inputId:t})};var g=a(24717);const b=e=>{let{refId:t,templateVariableOptions:a,onChange:l,query:i,customMetaData:s,datasource:u}=e;const d=(0,r.useMemo)((()=>(0,o.kU)(s,u)),[s,u]);return(0,p.jsxs)(n.EditorFieldGroup,{children:[(0,p.jsx)(n.EditorField,{label:"Alignment function",tooltip:"The process of alignment consists of collecting all data points received in a fixed length of time, applying a function to combine those data points, and assigning a timestamp to the result.",children:(0,p.jsx)(v,{inputId:`${t}-alignment-function`,templateVariableOptions:a,query:i,onChange:l})}),(0,p.jsx)(n.EditorField,{label:"Alignment period",tooltip:d,children:(0,p.jsx)(g.$,{inputId:`${t}-alignment-period`,templateVariableOptions:a,current:i.alignmentPeriod,onChange:e=>l(Object.assign({},i,{alignmentPeriod:e})),aligmentPeriods:c.dD})})]})},f=e=>{const t=y(e),a=I(t,e);return(0,p.jsx)(n.EditorField,{label:"Group by function","data-testid":"cloud-monitoring-aggregation",children:(0,p.jsx)(u.Select,{width:"auto",onChange:t=>{let{value:a}=t;return e.onChange(a)},value:a,options:[{label:"Template Variables",options:e.templateVariableOptions},{label:"Aggregations",expanded:!0,options:t}],placeholder:"Select Reducer",inputId:`${e.refId}-group-by-function`})})},y=e=>{let{metricDescriptor:t}=e;const a=null==t?void 0:t.valueType,l=null==t?void 0:t.metricKind;return(0,r.useMemo)((()=>a&&l?(0,o.A_)(a,l).map((e=>Object.assign({},e,{label:e.text}))):[]),[a,l])},I=(e,t)=>(0,r.useMemo)((()=>[...e,...t.templateVariableOptions].find((e=>e.value===t.crossSeriesReducer))),[e,t.crossSeriesReducer,t.templateVariableOptions]),E=e=>{var t,a;let{refId:l,labels:i=[],query:s,onChange:d,variableOptionGroup:h,metricDescriptor:m}=e;const v=(0,r.useMemo)((()=>[h,...(0,o.gY)([...i,...c.$e])]),[i,h]);return(0,p.jsxs)(n.EditorFieldGroup,{children:[(0,p.jsx)(n.EditorField,{label:"Group by",tooltip:"You can reduce the amount of data returned for a metric by combining different time series. To combine multiple time series, you can specify a grouping and a function. Grouping is done on the basis of labels. The grouping function is used to combine the time series in the group into a single time series.",children:(0,p.jsx)(u.MultiSelect,{inputId:`${l}-group-by`,width:"auto",placeholder:"Choose label",options:v,value:null!==(t=s.groupBys)&&void 0!==t?t:[],onChange:e=>{d(Object.assign({},s,{groupBys:e.map((e=>e.value))}))}})}),(0,p.jsx)(f,{metricDescriptor:m,templateVariableOptions:h.options,crossSeriesReducer:s.crossSeriesReducer,groupBys:null!==(a=s.groupBys)&&void 0!==a?a:[],onChange:e=>d(Object.assign({},s,{crossSeriesReducer:e})),refId:l})]})};var j=a(43215);const T="=",x="AND",O=["=","!=","=~","!=~"].map(j.toOption),C=e=>{let{labels:t={},filters:a,onChange:l,variableOptionGroup:i}=e;const s=(0,r.useMemo)((()=>(0,o.mi)(a)),[a]),c=(0,r.useMemo)((()=>[i,...(0,o.gY)(Object.keys(t))]),[t,i]),d=e=>{let{key:a="",value:l=""}=e;c.some((e=>e.options?c.some((e=>e.label===a)):e.label===a))||c.push({label:a,value:a});const r=t.hasOwnProperty(a)?[i,...t[a].map(j.toOption)]:[i];return r.some((e=>e.label===l))||r.push({label:l,value:l}),{options:c,valueOptions:r}};return(0,p.jsx)(n.EditorRow,{children:(0,p.jsx)(n.EditorField,{label:"Filter",tooltip:"To reduce the amount of data charted, apply a filter. A filter has three components: a label, a comparison, and a value. The comparison can be an equality, inequality, or regular expression.",children:(0,p.jsx)(n.EditorList,{items:s,renderItem:(e,t,a)=>{const{key:l="",operator:r=T,value:o="",condition:i=x}=e,{options:s,valueOptions:c}=d(e);return(0,p.jsxs)(u.HorizontalGroup,{spacing:"xs",width:"auto",children:[(0,p.jsx)(u.Select,{"aria-label":"Filter label key",formatCreateLabel:e=>`Use label key: ${e}`,allowCustomValue:!0,value:l,options:s,onChange:e=>{let{value:a=""}=e;return t({key:a,operator:r,value:o,condition:i})}}),(0,p.jsx)(u.Select,{value:r,options:O,onChange:e=>{let{value:a=T}=e;return t({key:l,operator:a,value:o,condition:i})}}),(0,p.jsx)(u.Select,{"aria-label":"Filter label value",placeholder:"add filter value",formatCreateLabel:e=>`Use label value: ${e}`,allowCustomValue:!0,value:o,options:c,onChange:e=>{let{value:a=""}=e;return t({key:l,operator:r,value:a,condition:i})}}),(0,p.jsx)(n.AccessoryButton,{"aria-label":"Remove",icon:"times",variant:"secondary",onClick:a,type:"button"})]})},onChange:e=>{const t=e.map((e=>{let{key:t,operator:a,value:l,condition:r}=e;return{key:t||"",operator:a||T,value:l||"",condition:r||x}}));l((e=>e.flatMap((e=>{let{key:t,operator:a,value:l,condition:r}=e;return[t,a,l,r]})).slice(0,-1))(t))}})})})};var N=a(36636),L=a(82897),A=a(94448);function S(e){const[t,a]=(0,r.useState)([]),[l,o]=(0,r.useState)(),[i,s]=(0,r.useState)([]),[c,d]=(0,r.useState)([]),[h,m]=(0,r.useState)(""),v=(0,u.useTheme2)(),g=(0,u.getSelectStyles)(v),b=(0,u.useStyles2)(G),{onProjectChange:f,query:y,refId:I,metricType:E,templateVariableOptions:j,projectName:T,datasource:x,onChange:O,children:C}=e,{templateSrv:N}=x,S=(0,r.useCallback)(((e,t)=>e.find((e=>e.type===N.replace(t)))),[N]);(0,r.useEffect)((()=>{(async()=>{if(T){const e=await x.getMetricTypes(T),t=U(e),l=(e=>{const t=S(e,E);return t?e.filter((e=>e.service===t.service)).map((e=>({service:e.service,value:e.type,label:e.displayName,component:function(){return(0,p.jsxs)("div",{children:[(0,p.jsx)("div",{className:b,children:e.type}),(0,p.jsx)("div",{className:g.optionDescription,children:e.description})]})}}))):[]})(e),r=l.length>0?l[0].service:"",n=S(e,E);a(e),d(t),s(l),m(r),o(n)}})()}),[x,S,E,T,b,g.optionDescription]);const D=e=>{let{value:a}=e;const l=S(t,a);o(l),O(Object.assign({},l,{type:a}))},U=e=>{const t=e.map((e=>({value:e.service,label:(0,L.startCase)(e.serviceShortName)})));return t.length>0?(0,L.uniqBy)(t,(e=>e.value)):[]};return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(n.EditorRow,{children:(0,p.jsxs)(n.EditorFieldGroup,{children:[(0,p.jsx)(A.I,{refId:I,templateVariableOptions:j,projectName:T,datasource:x,onChange:e=>{f(Object.assign({},y,{projectName:e}))}}),(0,p.jsx)(n.EditorField,{label:"Service",width:"auto",children:(0,p.jsx)(u.Select,{width:"auto",onChange:e=>{let{value:a}=e;const l=t.filter((e=>e.service===N.replace(a))).map((e=>({service:e.service,value:e.type,label:e.displayName,description:e.description})));l.length>0&&!l.some((e=>e.value===N.replace(E)))?(D(l[0]),m(a),s(l)):(m(a),s(l))},value:[...c,...j].find((e=>e.value===h)),options:[{label:"Template Variables",options:j},...c],placeholder:"Select Services",inputId:`${e.refId}-service`})}),(0,p.jsx)(n.EditorField,{label:"Metric name",width:"auto",children:(0,p.jsx)(u.Select,{width:"auto",onChange:D,value:[...i,...j].find((e=>e.value===E)),options:[{label:"Template Variables",options:j},...i],placeholder:"Select Metric",inputId:`${e.refId}-select-metric`})})]})}),C(l)]})}const G=e=>N.css`
  label: grafana-select-option-description;
  font-weight: normal;
  font-style: italic;
  color: ${e.colors.text.secondary};
`,D={label:"None",value:i.mG.None},U=e=>{var t;let{query:a,metricDescriptor:l,onChange:r}=e;const s=_(l);return(0,p.jsx)(n.EditorField,{label:"Pre-processing",tooltip:"Preprocessing options are displayed when the selected metric has a metric kind of delta or cumulative. The specific options available are determined by the metic's value type. If you select 'Rate', data points are aligned and converted to a rate per time series. If you select 'Delta', data points are aligned by their delta (difference) per time series",children:(0,p.jsx)(u.RadioButtonGroup,{onChange:e=>{const{valueType:t,metricKind:l,perSeriesAligner:n}=a,{perSeriesAligner:i}=(0,o.ID)(t,l,n,e);r(Object.assign({},a,{preprocessor:e,perSeriesAligner:i}))},value:null!==(t=a.preprocessor)&&void 0!==t?t:i.mG.None,options:s})})},_=e=>{const t=null==e?void 0:e.metricKind,a=null==e?void 0:e.valueType;return(0,r.useMemo)((()=>{if(!t||t===i.lH.GAUGE||a===i.$h.DISTRIBUTION)return[D];const e=[D,{label:"Rate",value:i.mG.Rate,description:"Data points are aligned and converted to a rate per time series"}];return t===i.lH.CUMULATIVE?[...e,{label:"Delta",value:i.mG.Delta,description:"Data points are aligned by their delta (difference) per time series"}]:e}),[t,a])};function $(e){let{refId:t,query:a,labels:l,datasource:r,onChange:o,onMetricTypeChange:i,customMetaData:s,variableOptionGroup:u}=e;return(0,p.jsx)(S,{refId:t,projectName:a.projectName,metricType:a.metricType,templateVariableOptions:u.options,datasource:r,onChange:i,onProjectChange:o,query:a,children:e=>(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(C,{labels:l,filters:a.filters,onChange:e=>o(Object.assign({},a,{filters:e})),variableOptionGroup:u}),(0,p.jsxs)(n.EditorRow,{children:[(0,p.jsx)(U,{metricDescriptor:e,query:a,onChange:o}),(0,p.jsx)(E,{refId:t,labels:Object.keys(l),query:a,onChange:o,variableOptionGroup:u,metricDescriptor:e}),(0,p.jsx)(b,{refId:t,datasource:r,templateVariableOptions:u.options,query:a,customMetaData:s,onChange:o}),(0,p.jsx)(m.B,{refId:t,value:a.aliasBy,onChange:e=>{o(Object.assign({},a,{aliasBy:e}))}})]})]})})}const R=r.memo($),M={labels:{}};function V(e){let{refId:t,query:a,datasource:l,onChange:u,onRunQuery:c,customMetaData:d,variableOptionGroup:m}=e;const[v,g]=(0,r.useState)(M),{projectName:b,metricType:f,groupBys:y,editorMode:I,crossSeriesReducer:E}=a;(0,r.useEffect)((()=>{b&&f&&l.getLabels(f,t,b).then((e=>g((t=>Object.assign({},t,{labels:e})))))}),[l,y,f,b,t,E]);const j=(0,r.useCallback)((e=>{u(Object.assign({},a,e)),c()}),[u,c,a]),T=(0,r.useCallback)((e=>{let{valueType:t,metricKind:l,type:r}=e;const n=l===i.lH.GAUGE||t===i.$h.DISTRIBUTION?i.mG.None:i.mG.Rate,{perSeriesAligner:s}=(0,o.ID)(t,l,v.perSeriesAligner,n);j(Object.assign({},a,{perSeriesAligner:s,metricType:r,valueType:t,metricKind:l,preprocessor:n}))}),[j,a,v]);return(0,p.jsxs)(n.EditorRows,{children:[I===i.je.Visual&&(0,p.jsx)(R,{refId:t,labels:v.labels,variableOptionGroup:m,customMetaData:d,onMetricTypeChange:T,onChange:j,datasource:l,query:a}),I===i.je.MQL&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(s.a,{onChange:e=>u(Object.assign({},a,{query:e})),onRunQuery:c,query:a.query}),(0,p.jsx)(h,{onChange:e=>u(Object.assign({},a,{graphPeriod:e})),graphPeriod:a.graphPeriod,refId:t,variableOptionGroup:m})]})]})}const P=r.memo(V)},24717:(e,t,a)=>{"use strict";a.d(t,{$:()=>o});var l=a(68404),r=a(3490),n=a(45916);function o(e){let{inputId:t,templateVariableOptions:a,onChange:o,current:i,disabled:s,aligmentPeriods:u}=e;const c=(0,l.useMemo)((()=>u.map((e=>Object.assign({},e,{label:e.text})))),[u]),d=(0,l.useMemo)((()=>c.filter((e=>!e.hidden))),[c]);return(0,n.jsx)(r.Select,{width:"auto",onChange:e=>{let{value:t}=e;return o(t)},value:[...c,...a].find((e=>e.value===i)),options:[{label:"Template Variables",options:a},{label:"Aggregations",expanded:!0,options:d}],placeholder:"Select Period",inputId:t,disabled:s,allowCustomValue:!0})}},94448:(e,t,a)=>{"use strict";a.d(t,{I:()=>i});var l=a(68404),r=a(8072),n=a(3490),o=a(45916);function i(e){let{refId:t,projectName:a,datasource:i,onChange:s,templateVariableOptions:u}=e;const[c,d]=(0,l.useState)([]);(0,l.useEffect)((()=>{i.getProjects().then((e=>d(e)))}),[i]);const p=(0,l.useMemo)((()=>[c,{label:"Template Variables",options:u},...c]),[c,u]);return(0,o.jsx)(r.EditorField,{label:"Project",children:(0,o.jsx)(n.Select,{width:"auto",allowCustomValue:!0,formatCreateLabel:e=>`Use project: ${e}`,onChange:e=>{let{value:t}=e;return s(t)},options:p,value:{value:a,label:a},placeholder:"Select Project",inputId:`${t}-project`})})}},54834:(e,t,a)=>{"use strict";a.d(t,{a:()=>n});a(68404);var l=a(3490),r=a(45916);function n(e){let{query:t,onChange:a,onRunQuery:n}=e;return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(l.TextArea,{name:"Query",className:"slate-query-field",value:t,rows:10,placeholder:"Enter a Cloud Monitoring MQL query (Run with Shift+Enter)",onBlur:n,onChange:e=>a(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&(e.shiftKey||e.ctrlKey)&&(e.preventDefault(),n())}})})}},80425:(e,t,a)=>{"use strict";a.d(t,{a1:()=>g,wi:()=>m});var l,r=a(68404),n=a(2986),o=a(25576),i=a(3490),s=a(22002),u=a(49224),c=a(45916);const d=e=>{let{refId:t,onChange:a,graphPeriod:r,variableOptionGroup:n}=e;return(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)(u.x5,{label:"Graph period",htmlFor:`${t}-graph-period`,tooltip:(0,c.jsxs)(c.Fragment,{children:["Set ",l||(l=(0,c.jsx)("code",{children:"graph_period"}))," which forces a preferred period between points. Automatically set to the current interval if left blank."]}),children:[(0,c.jsx)(i.Switch,{"data-testid":`${t}-switch-graph-period`,value:"disabled"!==r,onChange:e=>a(e.currentTarget.checked?"":"disabled")}),(0,c.jsx)(u.$d,{inputId:`${t}-graph-period`,templateVariableOptions:n.options,current:r,onChange:a,selectWidth:s.Lh,disabled:"disabled"===r,aligmentPeriods:s.Ry})]})})};var p=a(54834);const h={labels:{}},m=e=>({editorMode:o.je.Visual,projectName:e.getDefaultProject(),metricType:"",metricKind:o.lH.GAUGE,valueType:"",crossSeriesReducer:"REDUCE_MEAN",alignmentPeriod:"cloud-monitoring-auto",perSeriesAligner:o.CS.ALIGN_MEAN,groupBys:[],filters:[],aliasBy:"",query:"",preprocessor:o.mG.None});function v(e){let{refId:t,query:a,datasource:l,onChange:i,onRunQuery:s,customMetaData:m,variableOptionGroup:v}=e;const[g,b]=(0,r.useState)(h),{projectName:f,metricType:y,groupBys:I,editorMode:E,crossSeriesReducer:j}=a;(0,r.useEffect)((()=>{f&&y&&l.getLabels(y,t,f).then((e=>b((t=>Object.assign({},t,{labels:e})))))}),[l,I,y,f,t,j]);const T=(0,r.useCallback)((e=>{i(Object.assign({},a,e)),s()}),[i,s,a]),x=(0,r.useCallback)((e=>{let{valueType:t,metricKind:l,type:r}=e;const i=l===o.lH.GAUGE||t===o.$h.DISTRIBUTION?o.mG.None:o.mG.Rate,{perSeriesAligner:s}=(0,n.ID)(t,l,g.perSeriesAligner,i);T(Object.assign({},a,{perSeriesAligner:s,metricType:r,valueType:t,metricKind:l,preprocessor:i}))}),[T,a,g]);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(u.IK,{refId:t,templateVariableOptions:v.options,projectName:f,datasource:l,onChange:e=>{T(Object.assign({},a,{projectName:e}))}}),E===o.je.Visual&&(0,c.jsx)(u.sL,{refId:t,labels:g.labels,variableOptionGroup:v,customMetaData:m,onMetricTypeChange:x,onChange:T,datasource:l,query:a}),E===o.je.MQL&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(p.a,{onChange:e=>i(Object.assign({},a,{query:e})),onRunQuery:s,query:a.query}),(0,c.jsx)(d,{onChange:e=>i(Object.assign({},a,{graphPeriod:e})),graphPeriod:a.graphPeriod,refId:t,variableOptionGroup:v})]}),(0,c.jsx)(u.BQ,{refId:t,value:a.aliasBy,onChange:e=>{T(Object.assign({},a,{aliasBy:e}))}})]})}const g=r.memo(v)},59137:(e,t,a)=>{"use strict";a.d(t,{W:()=>A});var l,r=a(36636),n=a(68404),o=a(43215),i=a(8072),s=a(90923),u=a(3490),c=a(22002),d=a(25576),p=a(54919),h=a(45916);const m=[{label:"Builder",value:d.je.Visual},{label:"MQL",value:d.je.MQL}],v=e=>{const{query:t,metricQuery:a,sloQuery:r,onChange:n,onRunQuery:o}=e,{queryType:s}=t,{editorMode:p}=a;return(0,h.jsxs)(i.EditorHeader,{children:[(0,h.jsx)(i.InlineSelect,{label:"Query type",options:c.XI,value:s,onChange:e=>{let{value:a}=e;n(Object.assign({},t,{sloQuery:r,queryType:a})),o()}}),l||(l=(0,h.jsx)(i.FlexItem,{grow:1})),s!==d.xL.SLO&&(0,h.jsx)(u.RadioButtonGroup,{size:"sm",options:m,value:p||d.je.Visual,onChange:e=>{n(Object.assign({},t,{metricQuery:Object.assign({},a,{editorMode:e})}))}})]})};var g=a(2986),b=a(88292);const f=e=>{let{refId:t,current:a,templateVariableOptions:l,onChange:r}=e;const n=c.yy.map((e=>Object.assign({},e,{label:e.text})));a&&!n.find((e=>e.value===a))&&n.push({label:a,text:a,value:a,hidden:!1});const o=n.filter((e=>!e.hidden));return(0,h.jsx)(i.EditorField,{label:"Lookback period",htmlFor:`${t}-lookback-period`,children:(0,h.jsx)(u.Select,{inputId:`${t}-lookback-period`,width:"auto",allowCustomValue:!0,value:[...n,...l].find((e=>e.value===a)),options:[{label:"Template Variables",options:l},{label:"Predefined periods",expanded:!0,options:o}],onChange:e=>{let{value:t}=e;return r(t)}})})};var y=a(24717),I=a(94448);const E=e=>{let{refId:t,query:a,templateVariableOptions:l,onChange:r,datasource:o}=e;const[s,c]=(0,n.useState)([]),{projectName:d,serviceId:p}=a;return(0,n.useEffect)((()=>{d&&p&&o.getServiceLevelObjectives(d,p).then((e=>{c([{label:"Template Variables",options:l},...e])}))}),[o,d,p,l]),(0,h.jsx)(i.EditorField,{label:"SLO",children:(0,h.jsx)(u.Select,{inputId:`${t}-slo`,width:"auto",allowCustomValue:!0,value:(null==a?void 0:a.sloId)&&{value:null==a?void 0:a.sloId,label:(null==a?void 0:a.sloName)||(null==a?void 0:a.sloId)},placeholder:"Select SLO",options:s,onChange:async e=>{let{value:t="",label:l=""}=e;const n=(await o.getServiceLevelObjectives(d,p)).find((e=>{let{value:a}=e;return a===o.templateSrv.replace(t)}));r(Object.assign({},a,{sloId:t,sloName:l,goal:null==n?void 0:n.goal}))}})})},j=e=>{let{refId:t,query:a,templateVariableOptions:l,onChange:r,datasource:n}=e;return(0,h.jsx)(i.EditorField,{label:"Selector",htmlFor:`${t}-slo-selector`,children:(0,h.jsx)(u.Select,{inputId:`${t}-slo-selector`,width:"auto",allowCustomValue:!0,value:[...c.IR,...l].find((e=>{var t;return null!==(t=e.value===(null==a?void 0:a.selectorName))&&void 0!==t?t:""})),options:[{label:"Template Variables",options:l},...c.IR],onChange:e=>{let{value:t}=e;return r(Object.assign({},a,{selectorName:null!=t?t:""}))}})})},T=e=>{let{refId:t,query:a,templateVariableOptions:l,onChange:r,datasource:o}=e;const[s,c]=(0,n.useState)([]),{projectName:d}=a;return(0,n.useEffect)((()=>{d&&o.getSLOServices(d).then((e=>{c([{label:"Template Variables",options:l},...e])}))}),[o,d,l]),(0,h.jsx)(i.EditorField,{label:"Service",children:(0,h.jsx)(u.Select,{inputId:`${t}-slo-service`,width:"auto",allowCustomValue:!0,value:(null==a?void 0:a.serviceId)&&{value:null==a?void 0:a.serviceId,label:(null==a?void 0:a.serviceName)||(null==a?void 0:a.serviceId)},placeholder:"Select service",options:s,onChange:e=>{let{value:t="",label:l=""}=e;return r(Object.assign({},a,{serviceId:t,serviceName:l,sloId:""}))}})})};function x(e){let{refId:t,query:a,datasource:l,onChange:r,variableOptionGroup:o,customMetaData:s}=e;const u=(0,n.useMemo)((()=>(0,g.kU)(s,l)),[s,l]);return(0,h.jsx)(h.Fragment,{children:(0,h.jsxs)(i.EditorRow,{children:[(0,h.jsx)(I.I,{refId:t,templateVariableOptions:o.options,projectName:a.projectName,datasource:l,onChange:e=>r(Object.assign({},a,{projectName:e}))}),(0,h.jsx)(T,{refId:t,datasource:l,templateVariableOptions:o.options,query:a,onChange:r}),(0,h.jsx)(E,{refId:t,datasource:l,templateVariableOptions:o.options,query:a,onChange:r}),(0,h.jsx)(j,{refId:t,datasource:l,templateVariableOptions:o.options,query:a,onChange:r}),a.selectorName===c.Fh&&(0,h.jsx)(f,{refId:t,onChange:e=>r(Object.assign({},a,{lookbackPeriod:e})),current:a.lookbackPeriod,templateVariableOptions:o.options}),(0,h.jsx)(i.EditorFieldGroup,{children:(0,h.jsx)(i.EditorField,{label:"Alignment period",tooltip:u,children:(0,h.jsx)(y.$,{inputId:`${t}-alignment-period`,templateVariableOptions:o.options,current:a.alignmentPeriod,onChange:e=>r(Object.assign({},a,{alignmentPeriod:e})),aligmentPeriods:c.dD})})}),(0,h.jsx)(b.B,{refId:t,value:a.aliasBy,onChange:e=>r(Object.assign({},a,{aliasBy:e}))})]})})}var O=a(80425),C=a(37622),N=a(49224);const L=["hide","refId","datasource","key","queryType","maxLines","metric"];class A extends n.PureComponent{async UNSAFE_componentWillMount(){const{datasource:e,query:t}=this.props;if(!this.props.query.hasOwnProperty("metricQuery")){const e=function(e,t){if(null==e)return{};var a,l,r={},n=Object.keys(e);for(l=0;l<n.length;l++)a=n[l],t.indexOf(a)>=0||(r[a]=e[a]);return r}(this.props.query,L);this.props.query.metricQuery=e}this.props.query.hasOwnProperty("queryType")||(this.props.query.queryType=d.xL.METRICS),await e.ensureGCEDefaultProject(),t.metricQuery.projectName||(this.props.query.metricQuery.projectName=e.getDefaultProject())}onQueryChange(e,t){this.props.onChange(Object.assign({},this.props.query,{[e]:t})),this.props.onRunQuery()}render(){var e,t,a;const{datasource:l,query:n,onRunQuery:m,onChange:g}=this.props,b=Object.assign({},(0,O.wi)(l),n.metricQuery),f=Object.assign({},(0,C.w)(l),n.sloQuery),y=n.queryType||d.xL.METRICS,I=null!==(e=this.props.data)&&void 0!==e&&e.series.length?null===(t=this.props.data)||void 0===t?void 0:t.series[0].meta:{},E=null!==(a=null==I?void 0:I.custom)&&void 0!==a?a:{},j={label:"Template Variables",expanded:!1,options:l.getVariables().map(o.toOption)};return s.config.featureToggles.cloudMonitoringExperimentalUI?(0,h.jsxs)(i.EditorRows,{children:[(0,h.jsx)(v,{query:n,metricQuery:b,sloQuery:f,onChange:g,onRunQuery:m}),y===d.xL.METRICS&&(0,h.jsx)(p.a1,{refId:n.refId,variableOptionGroup:j,customMetaData:E,onChange:e=>{this.props.onChange(Object.assign({},this.props.query,{metricQuery:e}))},onRunQuery:m,datasource:l,query:b}),y===d.xL.SLO&&(0,h.jsx)(x,{refId:n.refId,variableOptionGroup:j,customMetaData:E,onChange:e=>this.onQueryChange("sloQuery",e),onRunQuery:m,datasource:l,query:f})]}):(0,h.jsxs)(i.EditorRows,{children:[(0,h.jsx)(N.x5,{label:"Query type",fillComponent:n.queryType!==d.xL.SLO&&(0,h.jsx)(u.Button,{variant:"secondary",className:r.css`
                  margin-left: auto;
                `,icon:"edit",onClick:()=>this.onQueryChange("metricQuery",Object.assign({},b,{editorMode:b.editorMode===d.je.MQL?d.je.Visual:d.je.MQL})),children:b.editorMode===d.je.MQL?"Switch to builder":"Edit MQL"}),htmlFor:`${n.refId}-query-type`,children:(0,h.jsx)(u.Select,{width:c.Lh,value:y,options:c.XI,onChange:e=>{let{value:t}=e;g(Object.assign({},n,{sloQuery:f,queryType:t})),m()},inputId:`${n.refId}-query-type`})}),y===d.xL.METRICS&&(0,h.jsx)(N.a1,{refId:n.refId,variableOptionGroup:j,customMetaData:E,onChange:e=>{this.props.onChange(Object.assign({},this.props.query,{metricQuery:e}))},onRunQuery:m,datasource:l,query:b}),y===d.xL.SLO&&(0,h.jsx)(N.D6,{refId:n.refId,variableOptionGroup:j,customMetaData:E,onChange:e=>this.onQueryChange("sloQuery",e),onRunQuery:m,datasource:l,query:f})]})}}},37622:(e,t,a)=>{"use strict";a.d(t,{D:()=>m,w:()=>h});var l=a(68404),r=a(49224),n=a(22002),o=a(25576),i=a(3490),s=a(45916);const u=e=>{let{refId:t,current:a,templateVariableOptions:l,onChange:o}=e;const u=n.yy.map((e=>Object.assign({},e,{label:e.text})));a&&!u.find((e=>e.value===a))&&u.push({label:a,text:a,value:a,hidden:!1});const c=u.filter((e=>!e.hidden));return(0,s.jsx)(r.x5,{label:"Lookback period",htmlFor:`${t}-lookback-period`,children:(0,s.jsx)(i.Select,{inputId:`${t}-lookback-period`,width:n.Lh,allowCustomValue:!0,value:[...u,...l].find((e=>e.value===a)),options:[{label:"Template Variables",options:l},{label:"Predefined periods",expanded:!0,options:c}],onChange:e=>{let{value:t}=e;return o(t)}})})},c=e=>{let{refId:t,query:a,templateVariableOptions:o,onChange:u,datasource:c}=e;const[d,p]=(0,l.useState)([]),{projectName:h}=a;return(0,l.useEffect)((()=>{h&&c.getSLOServices(h).then((e=>{p([{label:"Template Variables",options:o},...e])}))}),[c,h,o]),(0,s.jsx)(r.x5,{label:"Service",htmlFor:`${t}-slo-service`,children:(0,s.jsx)(i.Select,{inputId:`${t}-slo-service`,width:n.Lh,allowCustomValue:!0,value:(null==a?void 0:a.serviceId)&&{value:null==a?void 0:a.serviceId,label:(null==a?void 0:a.serviceName)||(null==a?void 0:a.serviceId)},placeholder:"Select service",options:d,onChange:e=>{let{value:t="",label:l=""}=e;return u(Object.assign({},a,{serviceId:t,serviceName:l,sloId:""}))}})})},d=e=>{let{refId:t,query:a,templateVariableOptions:o,onChange:u,datasource:c}=e;const[d,p]=(0,l.useState)([]),{projectName:h,serviceId:m}=a;return(0,l.useEffect)((()=>{h&&m&&c.getServiceLevelObjectives(h,m).then((e=>{p([{label:"Template Variables",options:o},...e])}))}),[c,h,m,o]),(0,s.jsx)(r.x5,{label:"SLO",htmlFor:`${t}-slo`,children:(0,s.jsx)(i.Select,{inputId:`${t}-slo`,width:n.Lh,allowCustomValue:!0,value:(null==a?void 0:a.sloId)&&{value:null==a?void 0:a.sloId,label:(null==a?void 0:a.sloName)||(null==a?void 0:a.sloId)},placeholder:"Select SLO",options:d,onChange:async e=>{let{value:t="",label:l=""}=e;const r=(await c.getServiceLevelObjectives(h,m)).find((e=>{let{value:a}=e;return a===c.templateSrv.replace(t)}));u(Object.assign({},a,{sloId:t,sloName:l,goal:null==r?void 0:r.goal}))}})})},p=e=>{let{refId:t,query:a,templateVariableOptions:l,onChange:o,datasource:u}=e;return(0,s.jsx)(r.x5,{label:"Selector",htmlFor:`${t}-slo-selector`,children:(0,s.jsx)(i.Select,{inputId:`${t}-slo-selector`,width:n.Lh,allowCustomValue:!0,value:[...n.IR,...l].find((e=>{var t;return null!==(t=e.value===(null==a?void 0:a.selectorName))&&void 0!==t?t:""})),options:[{label:"Template Variables",options:l},...n.IR],onChange:e=>{let{value:t}=e;return o(Object.assign({},a,{selectorName:null!=t?t:""}))}})})},h=e=>({projectName:e.getDefaultProject(),alignmentPeriod:"cloud-monitoring-auto",perSeriesAligner:o.CS.ALIGN_MEAN,aliasBy:"",selectorName:"select_slo_health",serviceId:"",serviceName:"",sloId:"",sloName:"",lookbackPeriod:""});function m(e){let{refId:t,query:a,datasource:l,onChange:o,variableOptionGroup:i,customMetaData:h}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.IK,{refId:t,templateVariableOptions:i.options,projectName:a.projectName,datasource:l,onChange:e=>o(Object.assign({},a,{projectName:e}))}),(0,s.jsx)(c,{refId:t,datasource:l,templateVariableOptions:i.options,query:a,onChange:o}),(0,s.jsx)(d,{refId:t,datasource:l,templateVariableOptions:i.options,query:a,onChange:o}),(0,s.jsx)(p,{refId:t,datasource:l,templateVariableOptions:i.options,query:a,onChange:o}),a.selectorName===n.Fh&&(0,s.jsx)(u,{refId:t,onChange:e=>o(Object.assign({},a,{lookbackPeriod:e})),current:a.lookbackPeriod,templateVariableOptions:i.options}),(0,s.jsxs)(r.x5,{label:"Alignment period",htmlFor:`${t}-alignment-period`,children:[(0,s.jsx)(r.$d,{inputId:`${t}-alignment-period`,templateVariableOptions:i.options,selectWidth:n.Lh,current:a.alignmentPeriod,onChange:e=>o(Object.assign({},a,{alignmentPeriod:e})),aligmentPeriods:n.dD}),(0,s.jsx)(r.nS,{datasource:l,customMetaData:h})]}),(0,s.jsx)(r.BQ,{refId:t,value:a.aliasBy,onChange:e=>o(Object.assign({},a,{aliasBy:e}))})]})}},49224:(e,t,a)=>{"use strict";a.d(t,{Pe:()=>L,BQ:()=>N,v2:()=>m,XY:()=>O,nS:()=>C,zI:()=>x,X9:()=>h,pj:()=>j,a1:()=>G.a1,C3:()=>c,$d:()=>w,Av:()=>H,IK:()=>i,EC:()=>V,x5:()=>M,D6:()=>D.D,Th:()=>R,sL:()=>k});var l=a(68404),r=a(3490),n=a(22002),o=a(45916);function i(e){let{refId:t,projectName:a,datasource:i,onChange:s,templateVariableOptions:u}=e;const[c,d]=(0,l.useState)([]);(0,l.useEffect)((()=>{i.getProjects().then((e=>d(e)))}),[i]);const p=(0,l.useMemo)((()=>[c,{label:"Template Variables",options:u},...c]),[c,u]);return(0,o.jsx)(M,{label:"Project",htmlFor:`${t}-project`,children:(0,o.jsx)(r.Select,{width:n.Lh,allowCustomValue:!0,formatCreateLabel:e=>`Use project: ${e}`,onChange:e=>{let{value:t}=e;return s(t)},options:p,value:{value:a,label:a},placeholder:"Select Project",inputId:`${t}-project`})})}var s=a(36636),u=a(82897);function c(e){const[t,a]=(0,l.useState)({metricDescriptors:[],metrics:[],services:[],service:"",metric:"",projectName:null}),i=(0,r.useTheme2)(),s=(0,r.getSelectStyles)(i),c=(0,r.useStyles2)(d),{services:p,service:h,metrics:m,metricDescriptors:v}=t,{metricType:g,templateVariableOptions:b,projectName:f,templateSrv:y,datasource:I,onChange:E,children:j}=e,T=(0,l.useCallback)(((e,t)=>e.find((e=>e.type===y.replace(t)))),[y]);(0,l.useEffect)((()=>{(async()=>{if(f){const e=await I.getMetricTypes(f),t=O(e);a((a=>Object.assign({},a,{metricDescriptors:e,services:t})))}})()}),[I,f,c,s.optionDescription]),(0,l.useEffect)((()=>{const e=(e=>{const t=T(e,g);if(!t)return[];return e.filter((e=>e.service===t.service)).map((e=>({service:e.service,value:e.type,label:e.displayName,component:function(){return(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:c,children:e.type}),(0,o.jsx)("div",{className:s.optionDescription,children:e.description})]})}})))})(v),t=e.length>0?e[0].service:"",l=T(v,g);a((a=>Object.assign({},a,{metricDescriptor:l,metrics:e,service:t})))}),[v,T,g,c,s.optionDescription]);const x=function(e){let{value:l}=e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=T(t.metricDescriptors,l);a(Object.assign({},t,{metricDescriptor:n},r)),E(Object.assign({},n,{type:l}))},O=e=>{const t=e.map((e=>({value:e.service,label:(0,u.startCase)(e.serviceShortName)})));return t.length>0?(0,u.uniqBy)(t,(e=>e.value)):[]};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(M,{children:[(0,o.jsx)(V,{labelWidth:n.XC,label:"Service",htmlFor:`${e.refId}-service`,children:(0,o.jsx)(r.Select,{width:n.Lh,onChange:e=>{let{value:l}=e;const r=v.filter((e=>e.service===y.replace(l))).map((e=>({service:e.service,value:e.type,label:e.displayName,description:e.description})));r.length>0&&!r.some((e=>e.value===y.replace(g)))?x(r[0],{service:l,metrics:r}):a(Object.assign({},t,{service:l,metrics:r}))},value:[...p,...b].find((e=>e.value===h)),options:[{label:"Template Variables",options:b},...p],placeholder:"Select Services",inputId:`${e.refId}-service`})}),(0,o.jsx)(V,{label:"Metric name",labelWidth:n.qN,htmlFor:`${e.refId}-select-metric`,children:(0,o.jsx)(r.Select,{width:n.Lh,onChange:x,value:[...m,...b].find((e=>e.value===g)),options:[{label:"Template Variables",options:b},...m],placeholder:"Select Metric",inputId:`${e.refId}-select-metric`})})]}),j(t.metricDescriptor)]})}const d=e=>s.css`
  label: grafana-select-option-description;
  font-weight: normal;
  font-style: italic;
  color: ${e.colors.text.secondary};
`;var p=a(2986);const h=e=>{var t,a;let{refId:i,labels:s=[],query:u,onChange:c,variableOptionGroup:d,metricDescriptor:h}=e;const m=(0,l.useMemo)((()=>[d,...(0,p.gY)([...s,...n.$e])]),[s,d]);return(0,o.jsxs)(M,{label:"Group by",tooltip:"You can reduce the amount of data returned for a metric by combining different time series. To combine multiple time series, you can specify a grouping and a function. Grouping is done on the basis of labels. The grouping function is used to combine the time series in the group into a single time series.",htmlFor:`${i}-group-by`,children:[(0,o.jsx)(r.MultiSelect,{inputId:`${i}-group-by`,width:n.d7,placeholder:"Choose label",options:m,value:null!==(t=u.groupBys)&&void 0!==t?t:[],onChange:e=>{c(Object.assign({},u,{groupBys:e.map((e=>e.value))}))}}),(0,o.jsx)(L,{metricDescriptor:h,templateVariableOptions:d.options,crossSeriesReducer:u.crossSeriesReducer,groupBys:null!==(a=u.groupBys)&&void 0!==a?a:[],onChange:e=>c(Object.assign({},u,{crossSeriesReducer:e})),refId:i})]})},m=e=>{let{refId:t,templateVariableOptions:a,onChange:l,query:r,customMetaData:i,datasource:s}=e;return(0,o.jsxs)(M,{label:"Alignment function",tooltip:"The process of alignment consists of collecting all data points received in a fixed length of time, applying a function to combine those data points, and assigning a timestamp to the result.",fillComponent:(0,o.jsx)(C,{datasource:s,customMetaData:i}),htmlFor:`${t}-alignment-function`,children:[(0,o.jsx)(O,{inputId:`${t}-alignment-function`,templateVariableOptions:a,query:r,onChange:l}),(0,o.jsx)(V,{label:"Alignment period",htmlFor:`${t}-alignment-period`,children:(0,o.jsx)(w,{inputId:`${t}-alignment-period`,selectWidth:n.Lh,templateVariableOptions:a,current:r.alignmentPeriod,onChange:e=>l(Object.assign({},r,{alignmentPeriod:e})),aligmentPeriods:n.dD})})]})};var v=a(43215);const g=["value","isOpen","invalid"],b=["value"];function f(e,t){if(null==e)return{};var a,l,r={},n=Object.keys(e);for(l=0;l<n.length;l++)a=n[l],t.indexOf(a)>=0||(r[a]=e[a]);return r}const y=["=","!=","=~","!=~"],I=l.forwardRef(((e,t)=>{let a=f(e,g);return(0,o.jsx)(r.Button,Object.assign({},a,{ref:t,variant:"secondary",icon:"plus","aria-label":"Add filter"}))}));I.displayName="FilterButton";const E=l.forwardRef(((e,t)=>{let{value:a}=e,l=f(e,b);return(0,o.jsx)(r.Button,Object.assign({},l,{ref:t,variant:"secondary",children:(0,o.jsx)("span",{className:"query-segment-operator",children:null==a?void 0:a.label})}))}));E.displayName="OperatorButton";const j=e=>{var t;let{labels:a={},filters:i,onChange:s,variableOptionGroup:c}=e;const d=(0,l.useMemo)((()=>(0,p.mi)(i)),[i]),h=(0,l.useMemo)((()=>[c,...(0,p.gY)(Object.keys(a))]),[a,c]),m=(0,l.useCallback)((e=>{const t=(0,u.flatten)(e.map((e=>{let{key:t,operator:a,value:l,condition:r}=e;return[t,a,l,r]})));return t.slice(0,t.length-1)}),[]),g=()=>(0,o.jsx)(r.Select,{allowCustomValue:!0,options:[c,...(0,p.gY)(Object.keys(a))],onChange:e=>{let{value:t=""}=e;return s(m([...d,{key:t,operator:"=",condition:"AND",value:""}]))},menuPlacement:"bottom",renderControl:I});return(0,o.jsx)(M,{label:"Filter",tooltip:"To reduce the amount of data charted, apply a filter. A filter has three components: a label, a comparison, and a value. The comparison can be an equality, inequality, or regular expression.",noFillEnd:d.length>1,children:(0,o.jsxs)(r.VerticalGroup,{spacing:"xs",width:"auto",children:[d.map(((e,l)=>{let{key:i,operator:u,value:p,condition:b}=e;h.some((e=>e.options?h.some((e=>e.label===i)):e.label===i))||h.push({label:i,value:i});const f=a.hasOwnProperty(i)?[c,...a[i].map(v.toOption)]:[c];return f.some((e=>e.label===p))||f.push({label:p,value:p}),(0,o.jsxs)(r.HorizontalGroup,{spacing:"xs",width:"auto",children:[(0,o.jsx)(r.Select,{"aria-label":"Filter label key",width:n.Lh,allowCustomValue:!0,formatCreateLabel:e=>`Use label key: ${e}`,value:i,options:h,onChange:e=>{let{value:t=""}=e;s(m(d.map(((e,a)=>a===l?{key:t,operator:u,condition:b,value:""}:e))))}}),(0,o.jsx)(r.Select,{value:u,options:y.map(v.toOption),onChange:e=>{let{value:t="="}=e;return s(m(d.map(((e,a)=>a===l?Object.assign({},e,{operator:t}):e))))},menuPlacement:"bottom",renderControl:E}),(0,o.jsx)(r.Select,{"aria-label":"Filter label value",width:n.Lh,formatCreateLabel:e=>`Use label value: ${e}`,allowCustomValue:!0,value:p,placeholder:"add filter value",options:f,onChange:e=>{let{value:t=""}=e;return s(m(d.map(((e,a)=>a===l?Object.assign({},e,{value:t}):e))))}}),(0,o.jsx)(r.Button,{variant:"secondary",size:"md",icon:"trash-alt","aria-label":"Remove",onClick:()=>s(m(d.filter(((e,t)=>t!==l))))}),l+1===d.length&&Object.values(d).every((e=>{let{value:t}=e;return t}))&&(t||(t=(0,o.jsx)(g,{})))]},l)})),!d.length&&(0,o.jsx)(g,{})]})})};var T;const x=()=>T||(T=(0,o.jsx)("div",{className:"gf-form grafana-info-box alert-info",children:(0,o.jsxs)("div",{children:[(0,o.jsx)("h5",{children:"Annotation Query Format"}),(0,o.jsxs)("p",{children:["An annotation is an event that is overlaid on top of graphs. Annotation rendering is expensive so it is important to limit the number of rows returned."," "]}),(0,o.jsx)("p",{children:"The Title and Text fields support templating and can use data returned from the query. For example, the Title field could have the following text:"}),(0,o.jsxs)("code",{children:["{{metric.type}}"," has value: ","{{metric.value}}"]}),(0,o.jsxs)("p",{children:["Example Result: ",(0,o.jsx)("code",{children:"monitoring.googleapis.com/uptime_check/http_status has this value: 502"})]}),(0,o.jsx)("label",{children:"Patterns:"}),(0,o.jsxs)("p",{children:[(0,o.jsx)("code",{children:"{{metric.value}}"})," = value of the metric/point"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("code",{children:"{{metric.type}}"})," = metric type e.g. compute.googleapis.com/instance/cpu/usage_time"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("code",{children:"{{metric.name}}"})," = name part of metric e.g. instance/cpu/usage_time"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("code",{children:"{{metric.service}}"})," = service part of metric e.g. compute"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("code",{children:"{{metric.label.label_name}}"})," = Metric label metadata e.g. metric.label.instance_name"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("code",{children:"{{resource.label.label_name}}"})," = Resource label metadata e.g. resource.label.zone"]})]})})),O=e=>{let{inputId:t,query:a,templateVariableOptions:i,onChange:s}=e;const{valueType:u,metricKind:c,perSeriesAligner:d,preprocessor:h}=a,{perSeriesAligner:m,alignOptions:v}=(0,l.useMemo)((()=>(0,p.ID)(u,c,d,h)),[u,c,d,h]);return(0,o.jsx)(r.Select,{width:n.Lh,onChange:e=>{let{value:t}=e;return s(Object.assign({},a,{perSeriesAligner:t}))},value:[...v,...i].find((e=>e.value===m)),options:[{label:"Template Variables",options:i},{label:"Alignment options",expanded:!0,options:v}],placeholder:"Select Alignment",inputId:t})},C=e=>{let{customMetaData:t,datasource:a}=e;const{perSeriesAligner:r,alignmentPeriod:i}=t,s=(0,l.useMemo)((()=>{var e;if(!i||!r)return"";const t=n.Eu.find((e=>e.value===a.templateSrv.replace(r))),l=parseInt(null!=i?i:"".replace(/[^0-9]/g,""),10);return`${v.rangeUtil.secondsToHms(l)} interval (${null!==(e=null==t?void 0:t.text)&&void 0!==e?e:""})`}),[a,r,i]);return(0,o.jsx)("label",{children:s})},N=e=>{let{refId:t,value:a="",onChange:i}=e;const[s,c]=(0,l.useState)(null!=a?a:""),d=(0,u.debounce)(i,1e3);return i=e=>{c(e.target.value),d(e.target.value)},(0,o.jsx)(M,{label:"Alias by",htmlFor:`${t}-alias-by`,children:(0,o.jsx)(r.Input,{id:`${t}-alias-by`,width:n.d7,value:s,onChange:i})})},L=e=>{const t=A(e),a=S(t,e);return(0,o.jsx)(V,{labelWidth:18,label:"Group by function","data-testid":"cloud-monitoring-aggregation",htmlFor:`${e.refId}-group-by-function`,children:(0,o.jsx)(r.Select,{width:16,onChange:t=>{let{value:a}=t;return e.onChange(a)},value:a,options:[{label:"Template Variables",options:e.templateVariableOptions},{label:"Aggregations",expanded:!0,options:t}],placeholder:"Select Reducer",inputId:`${e.refId}-group-by-function`})})},A=e=>{let{metricDescriptor:t}=e;const a=null==t?void 0:t.valueType,r=null==t?void 0:t.metricKind;return(0,l.useMemo)((()=>a&&r?(0,p.A_)(a,r).map((e=>Object.assign({},e,{label:e.text}))):[]),[a,r])},S=(e,t)=>(0,l.useMemo)((()=>[...e,...t.templateVariableOptions].find((e=>e.value===t.crossSeriesReducer))),[e,t.crossSeriesReducer,t.templateVariableOptions]);var G=a(80425),D=a(37622);a(54834);const U=["children","label","tooltip","fillComponent","noFillEnd","labelWidth","htmlFor"],_=["children","label","tooltip","labelWidth"];function $(e,t){if(null==e)return{};var a,l,r={},n=Object.keys(e);for(l=0;l<n.length;l++)a=n[l],t.indexOf(a)>=0||(r[a]=e[a]);return r}const R=e=>{let{label:t,onChange:a,value:l,options:n,allowCustomValue:i=!1}=e;return(0,o.jsx)(r.InlineField,{label:t,labelWidth:20,children:(0,o.jsx)(r.Select,{width:25,allowCustomValue:i,value:l,onChange:e=>{let{value:t}=e;return a(t)},options:n})})},M=e=>{let{children:t,label:a,tooltip:l,fillComponent:i,noFillEnd:u=!1,labelWidth:c=n.XC,htmlFor:d}=e,p=$(e,U);return(0,o.jsxs)("div",Object.assign({className:"gf-form"},p,{children:[a&&(0,o.jsx)(r.InlineLabel,{width:c,tooltip:l,htmlFor:d,children:a}),(0,o.jsx)("div",{className:s.css`
          margin-right: 4px;
        `,children:(0,o.jsx)(r.HorizontalGroup,{spacing:"xs",width:"auto",children:t})}),(0,o.jsx)("div",{className:"gf-form--grow",children:u||(0,o.jsx)("div",{className:"gf-form-label gf-form-label--grow",children:i})})]}))},V=e=>{let{children:t,label:a,tooltip:l,labelWidth:i=n.qN}=e,s=$(e,_);return(0,o.jsxs)(o.Fragment,{children:[a&&(0,o.jsx)(r.InlineLabel,Object.assign({width:i,tooltip:l},s,{children:a})),t]})};function P(e){let{refId:t,query:a,labels:l,datasource:r,onChange:n,onMetricTypeChange:i,customMetaData:s,variableOptionGroup:u}=e;return(0,o.jsx)(c,{refId:t,templateSrv:r.templateSrv,projectName:a.projectName,metricType:a.metricType,templateVariableOptions:u.options,datasource:r,onChange:i,children:e=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(j,{labels:l,filters:a.filters,onChange:e=>n(Object.assign({},a,{filters:e})),variableOptionGroup:u}),(0,o.jsx)(H,{metricDescriptor:e,query:a,onChange:n}),(0,o.jsx)(h,{refId:t,labels:Object.keys(l),query:a,onChange:n,variableOptionGroup:u,metricDescriptor:e}),(0,o.jsx)(m,{refId:t,datasource:r,templateVariableOptions:u.options,query:a,customMetaData:s,onChange:n})]})})}const k=l.memo(P);function w(e){let{inputId:t,templateVariableOptions:a,onChange:n,current:i,selectWidth:s,disabled:u,aligmentPeriods:c}=e;const d=(0,l.useMemo)((()=>c.map((e=>Object.assign({},e,{label:e.text})))),[c]),p=(0,l.useMemo)((()=>d.filter((e=>!e.hidden))),[d]);return(0,o.jsx)(r.Select,{width:s,onChange:e=>{let{value:t}=e;return n(t)},value:[...d,...a].find((e=>e.value===i)),options:[{label:"Template Variables",options:a},{label:"Aggregations",expanded:!0,options:p}],placeholder:"Select Period",inputId:t,disabled:u,allowCustomValue:!0})}var B=a(25576);const F={label:"None",value:B.mG.None},H=e=>{var t;let{query:a,metricDescriptor:l,onChange:n}=e;const i=q(l);return(0,o.jsx)(M,{label:"Pre-processing",tooltip:"Preprocessing options are displayed when the selected metric has a metric kind of delta or cumulative. The specific options available are determined by the metic's value type. If you select 'Rate', data points are aligned and converted to a rate per time series. If you select 'Delta', data points are aligned by their delta (difference) per time series",children:(0,o.jsx)(r.RadioButtonGroup,{onChange:e=>{const{valueType:t,metricKind:l,perSeriesAligner:r}=a,{perSeriesAligner:o}=(0,p.ID)(t,l,r,e);n(Object.assign({},a,{preprocessor:e,perSeriesAligner:o}))},value:null!==(t=a.preprocessor)&&void 0!==t?t:B.mG.None,options:i})})},q=e=>{const t=null==e?void 0:e.metricKind,a=null==e?void 0:e.valueType;return(0,l.useMemo)((()=>{if(!t||t===B.lH.GAUGE||a===B.$h.DISTRIBUTION)return[F];const e=[F,{label:"Rate",value:B.mG.Rate,description:"Data points are aligned and converted to a rate per time series"}];return t===B.lH.CUMULATIVE?[...e,{label:"Delta",value:B.mG.Delta,description:"Data points are aligned by their delta (difference) per time series"}]:e}),[t,a])}},22002:(e,t,a)=>{"use strict";a.d(t,{$e:()=>m,Eu:()=>u,Fh:()=>v,IR:()=>g,Lh:()=>s,Ry:()=>p,XC:()=>o,XI:()=>b,d7:()=>n,dD:()=>d,lx:()=>c,qN:()=>i,yy:()=>h});var l=a(28153),r=a(25576);const n=71,o=19,i=14,s=28,u=(l.GoogleAuthType.JWT,l.GoogleAuthType.GCE,[{text:"none",value:"ALIGN_NONE",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY,r.$h.DISTRIBUTION,r.$h.STRING,r.$h.VALUE_TYPE_UNSPECIFIED,r.$h.BOOL],metricKinds:[r.lH.GAUGE]},{text:"delta",value:"ALIGN_DELTA",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY,r.$h.DISTRIBUTION],metricKinds:[r.lH.CUMULATIVE,r.lH.DELTA]},{text:"rate",value:"ALIGN_RATE",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY],metricKinds:[r.lH.CUMULATIVE,r.lH.DELTA]},{text:"interpolate",value:"ALIGN_INTERPOLATE",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY],metricKinds:[r.lH.GAUGE]},{text:"next older",value:"ALIGN_NEXT_OLDER",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY,r.$h.DISTRIBUTION,r.$h.STRING,r.$h.VALUE_TYPE_UNSPECIFIED,r.$h.BOOL],metricKinds:[r.lH.GAUGE]},{text:"min",value:"ALIGN_MIN",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY],metricKinds:[r.lH.GAUGE,r.lH.DELTA]},{text:"max",value:"ALIGN_MAX",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY],metricKinds:[r.lH.GAUGE,r.lH.DELTA]},{text:"mean",value:"ALIGN_MEAN",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY],metricKinds:[r.lH.GAUGE,r.lH.DELTA]},{text:"count",value:"ALIGN_COUNT",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY,r.$h.BOOL],metricKinds:[r.lH.GAUGE,r.lH.DELTA]},{text:"sum",value:"ALIGN_SUM",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY,r.$h.DISTRIBUTION],metricKinds:[r.lH.GAUGE,r.lH.DELTA]},{text:"stddev",value:"ALIGN_STDDEV",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY],metricKinds:[r.lH.GAUGE,r.lH.DELTA]},{text:"count true",value:"ALIGN_COUNT_TRUE",valueTypes:[r.$h.BOOL],metricKinds:[r.lH.GAUGE]},{text:"count false",value:"ALIGN_COUNT_FALSE",valueTypes:[r.$h.BOOL],metricKinds:[r.lH.GAUGE]},{text:"fraction true",value:"ALIGN_FRACTION_TRUE",valueTypes:[r.$h.BOOL],metricKinds:[r.lH.GAUGE]},{text:"percentile 99",value:"ALIGN_PERCENTILE_99",valueTypes:[r.$h.DISTRIBUTION],metricKinds:[r.lH.GAUGE,r.lH.DELTA]},{text:"percentile 95",value:"ALIGN_PERCENTILE_95",valueTypes:[r.$h.DISTRIBUTION],metricKinds:[r.lH.GAUGE,r.lH.DELTA]},{text:"percentile 50",value:"ALIGN_PERCENTILE_50",valueTypes:[r.$h.DISTRIBUTION],metricKinds:[r.lH.GAUGE,r.lH.DELTA]},{text:"percentile 05",value:"ALIGN_PERCENTILE_05",valueTypes:[r.$h.DISTRIBUTION],metricKinds:[r.lH.GAUGE,r.lH.DELTA]},{text:"percent change",value:"ALIGN_PERCENT_CHANGE",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY],metricKinds:[r.lH.GAUGE,r.lH.DELTA]}]),c=[{text:"none",value:"REDUCE_NONE",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY,r.$h.DISTRIBUTION,r.$h.BOOL,r.$h.STRING],metricKinds:[r.lH.GAUGE,r.lH.DELTA,r.lH.CUMULATIVE,r.lH.METRIC_KIND_UNSPECIFIED]},{text:"mean",value:"REDUCE_MEAN",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY,r.$h.DISTRIBUTION],metricKinds:[r.lH.GAUGE,r.lH.DELTA,r.lH.CUMULATIVE]},{text:"min",value:"REDUCE_MIN",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY],metricKinds:[r.lH.GAUGE,r.lH.DELTA,r.lH.CUMULATIVE,r.lH.METRIC_KIND_UNSPECIFIED]},{text:"max",value:"REDUCE_MAX",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY],metricKinds:[r.lH.GAUGE,r.lH.DELTA,r.lH.CUMULATIVE,r.lH.METRIC_KIND_UNSPECIFIED]},{text:"sum",value:"REDUCE_SUM",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY,r.$h.DISTRIBUTION],metricKinds:[r.lH.GAUGE,r.lH.DELTA,r.lH.CUMULATIVE,r.lH.METRIC_KIND_UNSPECIFIED]},{text:"std. dev.",value:"REDUCE_STDDEV",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY,r.$h.DISTRIBUTION],metricKinds:[r.lH.GAUGE,r.lH.DELTA,r.lH.CUMULATIVE,r.lH.METRIC_KIND_UNSPECIFIED]},{text:"count",value:"REDUCE_COUNT",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY,r.$h.DISTRIBUTION,r.$h.BOOL,r.$h.STRING],metricKinds:[r.lH.GAUGE,r.lH.DELTA,r.lH.CUMULATIVE]},{text:"count true",value:"REDUCE_COUNT_TRUE",valueTypes:[r.$h.BOOL],metricKinds:[r.lH.GAUGE,r.lH.DELTA]},{text:"count false",value:"REDUCE_COUNT_FALSE",valueTypes:[r.$h.BOOL],metricKinds:[r.lH.GAUGE,r.lH.DELTA]},{text:"99th percentile",value:"REDUCE_PERCENTILE_99",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY,r.$h.DISTRIBUTION],metricKinds:[r.lH.GAUGE,r.lH.DELTA,r.lH.CUMULATIVE]},{text:"95th percentile",value:"REDUCE_PERCENTILE_95",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY,r.$h.DISTRIBUTION],metricKinds:[r.lH.GAUGE,r.lH.DELTA,r.lH.CUMULATIVE]},{text:"50th percentile",value:"REDUCE_PERCENTILE_50",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY,r.$h.DISTRIBUTION],metricKinds:[r.lH.GAUGE,r.lH.DELTA,r.lH.CUMULATIVE]},{text:"5th percentile",value:"REDUCE_PERCENTILE_05",valueTypes:[r.$h.INT64,r.$h.DOUBLE,r.$h.MONEY,r.$h.DISTRIBUTION],metricKinds:[r.lH.GAUGE,r.lH.DELTA,r.lH.CUMULATIVE]}],d=[{text:"grafana auto",value:"grafana-auto"},{text:"stackdriver auto",value:"stackdriver-auto",hidden:!0},{text:"cloud monitoring auto",value:"cloud-monitoring-auto"},{text:"1m",value:"+60s"},{text:"2m",value:"+120s"},{text:"5m",value:"+300s"},{text:"10m",value:"+600s"},{text:"30m",value:"+1800s"},{text:"1h",value:"+3600s"},{text:"3h",value:"+7200s"},{text:"6h",value:"+21600s"},{text:"1d",value:"+86400s"},{text:"3d",value:"+259200s"},{text:"1w",value:"+604800s"}],p=[{text:"auto",value:"auto"},{text:"1m",value:"1m"},{text:"2m",value:"2m"},{text:"5m",value:"5m"},{text:"10m",value:"10m"},{text:"30m",value:"30m"},{text:"1h",value:"1h"},{text:"3h",value:"3h"},{text:"6h",value:"6h"},{text:"1d",value:"1d"},{text:"3d",value:"3d"},{text:"1w",value:"1w"}],h=[{text:"1m",value:"1m"},{text:"2m",value:"2m"},{text:"5m",value:"5m"},{text:"10m",value:"10m"},{text:"30m",value:"30m"},{text:"1h",value:"1h"},{text:"3h",value:"3h"},{text:"6h",value:"6h"},{text:"24h",value:"24h"},{text:"72h",value:"72h"}],m=["metadata.system_labels.cloud_account","metadata.system_labels.name","metadata.system_labels.region","metadata.system_labels.state","metadata.system_labels.instance_group","metadata.system_labels.node_name","metadata.system_labels.service_name","metadata.system_labels.top_level_controller_type","metadata.system_labels.top_level_controller_name","metadata.system_labels.container_image"],v="select_slo_burn_rate",g=[{label:"SLI Value",value:"select_slo_health"},{label:"SLO Compliance",value:"select_slo_compliance"},{label:"SLO Error Budget Remaining",value:"select_slo_budget_fraction"},{label:"SLO Burn Rate",value:v}],b=[{label:"Metrics",value:r.xL.METRICS},{label:"Service Level Objectives (SLO)",value:r.xL.SLO}]},2986:(e,t,a)=>{"use strict";a.d(t,{A_:()=>p,FL:()=>c,ID:()=>m,Qd:()=>h,Qf:()=>u,gY:()=>v,kU:()=>b,mi:()=>g,oU:()=>d,qA:()=>s});var l=a(82897),r=a(43215),n=a(90923),o=a(22002),i=a(25576);const s=e=>(0,l.uniqBy)(e,"service"),u=(e,t)=>e.filter((e=>e.service===t)),c=(e,t,a,l)=>{const r=u(e,l).map((e=>({value:e.type,name:e.displayName}))),n=r.some((e=>e.value===a)),o=r.length?r[0].value:"";return{metricTypes:r,selectedMetricType:n?t:o}},d=(e,t,a)=>(a&&a===i.mG.Rate&&(t=i.lH.GAUGE),e?o.Eu.filter((a=>-1!==a.valueTypes.indexOf(e)&&-1!==a.metricKinds.indexOf(t))):[]),p=(e,t)=>t?o.lx.filter((a=>-1!==a.valueTypes.indexOf(e)&&-1!==a.metricKinds.indexOf(t))):[],h=async(e,t,a)=>{const l=await e.getLabels(t,"handleLabelKeysQuery",a);return[...Object.keys(l),...o.$e]},m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.$h.DOUBLE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.lH.GAUGE,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.CS.ALIGN_MEAN,l=arguments.length>3?arguments[3]:void 0;const r=(0,n.getTemplateSrv)(),o=d(e,t,l).map((e=>Object.assign({},e,{label:e.text})));return o.some((e=>e.value===r.replace(a)))||(a=o.length>0?o[0].value:i.CS.ALIGN_MEAN),{alignOptions:o,perSeriesAligner:a}},v=e=>{const t=e.reduce(((e,t)=>{const a=t.split(".").map(l.startCase),r=(2===a.length?a:(0,l.initial)(a)).join(" "),n={value:t,label:t};return e[r]?e[r]=[...e[r],n]:e[r]=[n],e}),{});return Object.entries(t).map((e=>{let[t,a]=e;return{label:t,options:a,expanded:!0}}),[])},g=e=>(0,l.chunk)(e,4).map((e=>{let[t,a,l,r="AND"]=e;return{key:t,operator:a,value:l,condition:r}})),b=(e,t)=>{var a;const{perSeriesAligner:l,alignmentPeriod:n}=e;if(!n||!l)return"";const i=o.Eu.find((e=>e.value===t.templateSrv.replace(l))),s=parseInt(n,10);return`${r.rangeUtil.secondsToHms(s)} interval (${null!==(a=null==i?void 0:i.text)&&void 0!==a?a:""})`}},25576:(e,t,a)=>{"use strict";a.d(t,{$h:()=>u,Bp:()=>r,CS:()=>c,je:()=>o,lH:()=>s,mG:()=>i,xL:()=>n});var l=a(28153);l.GoogleAuthType.JWT,l.GoogleAuthType.GCE;let r,n,o,i,s,u,c;!function(e){e.Projects="projects",e.Services="services",e.DefaultProject="defaultProject",e.MetricTypes="metricTypes",e.LabelKeys="labelKeys",e.LabelValues="labelValues",e.ResourceTypes="resourceTypes",e.Aggregations="aggregations",e.Aligners="aligners",e.AlignmentPeriods="alignmentPeriods",e.Selectors="selectors",e.SLOServices="sloServices",e.SLO="slo"}(r||(r={})),function(e){e.METRICS="metrics",e.SLO="slo"}(n||(n={})),function(e){e.Visual="visual",e.MQL="mql"}(o||(o={})),function(e){e.None="none",e.Rate="rate",e.Delta="delta"}(i||(i={})),function(e){e.METRIC_KIND_UNSPECIFIED="METRIC_KIND_UNSPECIFIED",e.GAUGE="GAUGE",e.DELTA="DELTA",e.CUMULATIVE="CUMULATIVE"}(s||(s={})),function(e){e.VALUE_TYPE_UNSPECIFIED="VALUE_TYPE_UNSPECIFIED",e.BOOL="BOOL",e.INT64="INT64",e.DOUBLE="DOUBLE",e.STRING="STRING",e.DISTRIBUTION="DISTRIBUTION",e.MONEY="MONEY"}(u||(u={})),function(e){e.ALIGN_DELTA="ALIGN_DELTA",e.ALIGN_RATE="ALIGN_RATE",e.ALIGN_INTERPOLATE="ALIGN_INTERPOLATE",e.ALIGN_NEXT_OLDER="ALIGN_NEXT_OLDER",e.ALIGN_MIN="ALIGN_MIN",e.ALIGN_MAX="ALIGN_MAX",e.ALIGN_MEAN="ALIGN_MEAN",e.ALIGN_COUNT="ALIGN_COUNT",e.ALIGN_SUM="ALIGN_SUM",e.ALIGN_STDDEV="ALIGN_STDDEV",e.ALIGN_COUNT_TRUE="ALIGN_COUNT_TRUE",e.ALIGN_COUNT_FALSE="ALIGN_COUNT_FALSE",e.ALIGN_FRACTION_TRUE="ALIGN_FRACTION_TRUE",e.ALIGN_PERCENTILE_99="ALIGN_PERCENTILE_99",e.ALIGN_PERCENTILE_95="ALIGN_PERCENTILE_95",e.ALIGN_PERCENTILE_50="ALIGN_PERCENTILE_50",e.ALIGN_PERCENTILE_05="ALIGN_PERCENTILE_05",e.ALIGN_PERCENT_CHANGE="ALIGN_PERCENT_CHANGE",e.ALIGN_NONE="ALIGN_NONE"}(c||(c={}))},15925:(e,t,a)=>{var l=a(43215),r=a(3490),n=a(68404),o=a(82897);var i=function(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}(n),s=function(){return s=Object.assign||function(e){for(var t,a=1,l=arguments.length;a<l;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},s.apply(this,arguments)};function u(e,t){var a="function"==typeof Symbol&&e[Symbol.iterator];if(!a)return e;var l,r,n=a.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(l=n.next()).done;)o.push(l.value)}catch(e){r={error:e}}finally{try{l&&!l.done&&(a=n.return)&&a.call(n)}finally{if(r)throw r.error}}return o}var c,d=["private_key","token_uri","client_email","project_id"],p=function(e){var t=e.onChange,a=u(n.useState(),2),l=a[0],o=a[1],s=u(n.useState(null),2),c=s[0],d=s[1],p=r.useTheme2(),m=n.useCallback((function(e){o(null),d(!0)}),[d]),v=n.useCallback((function(e){d(null),o(null)}),[d]),g=n.useCallback((function(e){if(""!==e.trim()){var a=void 0;try{a=JSON.parse(e)}catch(e){o("Invalid JWT token")}var l=h(a);l.isValid?t({privateKey:a.private_key,tokenUri:a.token_uri,clientEmail:a.client_email,projectId:a.project_id}):o(l.error)}}),[o,t]);return i.default.createElement(i.default.Fragment,null,i.default.createElement(r.Field,{label:"JWT token",invalid:Boolean(l),description:c?"Paste JWT token below":"Upload or paste Google JWT token",error:l},i.default.createElement(i.default.Fragment,null,!0!==c&&i.default.createElement("div",{"data-testid":"Configuration drop zone"},i.default.createElement(r.FileDropzone,{options:{multiple:!1,accept:"application/json"},readAs:"readAsText",onLoad:function(e){g(e),d(!1)}},i.default.createElement("p",{style:{margin:0,fontSize:""+p.typography.h4.fontSize,textAlign:"center"}},"Drop the Google JWT file here",i.default.createElement("br",null),i.default.createElement("br",null),i.default.createElement(r.LinkButton,{fill:"outline"},"Click to browse files")))),c&&i.default.createElement(r.TextArea,{"data-testid":"Configuration text area",autoFocus:!0,invalid:Boolean(l),placeholder:"Paste Google JWT token here",onBlur:function(e){return g(e.currentTarget.value)},rows:12}))),!c&&i.default.createElement(r.Field,null,i.default.createElement(r.Button,{"data-testid":"Paste JWT button",type:"button",fill:"outline",style:{color:""+p.colors.primary.text},onClick:m},"Paste JWT Token")),c&&l&&i.default.createElement(r.Field,null,i.default.createElement(r.Button,{type:"button",fill:"outline",style:{color:""+p.colors.primary.text},onClick:v},"Upload JWT Token")))},h=function(e){if(!o.isObject(e))return{isValid:!1,error:"Invalid JWT token"};var t=d.filter((function(t){return!e[t]}));return t.length>0?{isValid:!1,error:"Missing keys: "+t.join(", ")}:{isValid:!0}},m=function(e){var t=e.options,a=e.onReset,l=e.onChange;return i.default.createElement("div",{"data-testid":"JWT form"},i.default.createElement(r.Field,{label:"Project ID"},i.default.createElement(r.Input,{id:"defaultProject",width:60,value:t.defaultProject||"",onChange:l("defaultProject")})),i.default.createElement(r.Field,{label:"Client email"},i.default.createElement(r.Input,{width:60,id:"clientEmail",value:t.clientEmail||"",onChange:l("clientEmail")})),i.default.createElement(r.Field,{label:"Token URI"},i.default.createElement(r.Input,{width:60,id:"tokenUri",value:t.tokenUri||"",onChange:l("tokenUri")})),i.default.createElement(r.Field,{label:"Private key",disabled:!0},i.default.createElement(r.Input,{width:60,id:"privateKey",readOnly:!0,placeholder:"Private key configured",addonAfter:i.default.createElement(r.Tooltip,{content:"Click to clear the uploaded JWT token and upload a new one"},i.default.createElement(r.Button,{"data-testid":"Reset JWT button",icon:"sync",size:"xs",onClick:function(){return a(null)},fill:"outline"},"Reset token"))})))};t.GoogleAuthType=void 0,(c=t.GoogleAuthType||(t.GoogleAuthType={})).JWT="jwt",c.GCE="gce";var v=[{label:"Google JWT File",value:t.GoogleAuthType.JWT,ariaLabel:"JWT button"},{label:"GCE Default Service Account",value:t.GoogleAuthType.GCE,ariaLabel:"GCE button"}];t.ConnectionConfig=function(e){var a=e.options,n=e.onOptionsChange,o=a.jsonData,u=a.secureJsonFields,c=a.secureJsonData;o.authenticationType||(o.authenticationType=t.GoogleAuthType.JWT);var d=o.authenticationType===t.GoogleAuthType.JWT||void 0===o.authenticationType,h=Boolean(u&&u.privateKey&&o.clientEmail&&o.defaultProject&&o.tokenUri);return i.default.createElement(i.default.Fragment,null,i.default.createElement(r.FieldSet,{label:"Authentication"},i.default.createElement(r.Field,{label:"Authentication type"},i.default.createElement(r.RadioButtonGroup,{options:v,value:o.authenticationType||t.GoogleAuthType.JWT,onChange:function(e){n(s(s({},a),{jsonData:s(s({},a.jsonData),{authenticationType:e})}))}}))),d&&i.default.createElement(r.FieldSet,{label:"JWT Key Details"},h?i.default.createElement(m,{options:a.jsonData,onReset:function(e){var t=s({},c),l=e?s(s({},a.jsonData),e):s({},a.jsonData);delete l.clientEmail,delete l.defaultProject,delete l.tokenUri,delete t.privateKey,n(s(s({},a),{secureJsonData:t,jsonData:l}))},onChange:function(t){return l.onUpdateDatasourceJsonDataOption(e,t)}}):i.default.createElement(p,{onChange:function(e){n(s(s({},a),{secureJsonFields:s(s({},u),{privateKey:!0}),secureJsonData:s(s({},c),{privateKey:e.privateKey}),jsonData:s(s({},o),{clientEmail:e.clientEmail,defaultProject:e.projectId,tokenUri:e.tokenUri})}))}})," "),i.default.createElement("div",{className:"grafana-info-box",style:{marginTop:"16px"},"data-testid":"Configuration help box"},i.default.createElement("p",null,"Don’t know how to get a service account key file or create a service account? Read more"," ",i.default.createElement("a",{className:"external-link",target:"_blank",rel:"noopener noreferrer",href:"https://grafana.com/docs/grafana/latest/datasources/google-cloud-monitoring/google-authentication/"},"in the documentation."))),!d&&i.default.createElement(r.Alert,{title:"",severity:"info"},"Verify GCE default service account by clicking Save & Test"))}},28153:(e,t,a)=>{"use strict";e.exports=a(15925)}}]);
//# sourceMappingURL=9137.d7fb8ff029fa51328905.js.map