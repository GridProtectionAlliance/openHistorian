{"version":3,"file":"HistoryPage.cc4c8f0247a15b09cd01.js","mappings":"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","sources":["webpack://grafana/./public/app/features/alerting/unified/components/CollapseToggle.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rules/central-state-history/HistoryErrorMessage.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rules/central-state-history/utils.ts","webpack://grafana/./public/app/features/alerting/unified/components/rules/central-state-history/EventDetails.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rules/central-state-history/useRuleHistoryRecords.ts","webpack://grafana/./public/app/features/alerting/unified/components/rules/central-state-history/EventListSceneObject.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rules/central-state-history/CentralHistoryRuntimeDataSource.ts","webpack://grafana/./public/app/features/alerting/unified/components/rules/central-state-history/CentralAlertHistoryScene.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rules/central-state-history/CentralAlertHistoryPage.tsx"],"sourcesContent":["import { HTMLAttributes } from 'react';\n\nimport { IconSize, Button } from '@grafana/ui';\n\ninterface Props extends HTMLAttributes<HTMLButtonElement> {\n  isCollapsed: boolean;\n  onToggle: (isCollapsed: boolean) => void;\n  // Todo: this should be made compulsory for a11y purposes\n  idControlled?: string;\n  size?: IconSize;\n  className?: string;\n  text?: string;\n}\n\nexport const CollapseToggle = ({\n  isCollapsed,\n  onToggle,\n  idControlled,\n  className,\n  text,\n  size = 'xl',\n  ...restOfProps\n}: Props) => {\n  return (\n    <Button\n      type=\"button\"\n      fill=\"text\"\n      variant=\"secondary\"\n      aria-expanded={!isCollapsed}\n      aria-controls={idControlled}\n      className={className}\n      icon={isCollapsed ? 'angle-right' : 'angle-down'}\n      onClick={() => onToggle(!isCollapsed)}\n      {...restOfProps}\n    >\n      {text}\n    </Button>\n  );\n};\n","import { isFetchError } from '@grafana/runtime';\nimport { Alert } from '@grafana/ui';\nimport { EntityNotFound } from 'app/core/components/PageNotFound/EntityNotFound';\nimport { t } from 'app/core/internationalization';\n\nimport { stringifyErrorLike } from '../../../utils/misc';\n\nexport interface HistoryErrorMessageProps {\n  error: unknown;\n}\n\nexport function HistoryErrorMessage({ error }: HistoryErrorMessageProps) {\n  if (isFetchError(error) && error.status === 404) {\n    return <EntityNotFound entity=\"History\" />;\n  }\n  const title = t('alerting.central-alert-history.error', 'Something went wrong loading the alert state history');\n  const errorStr = stringifyErrorLike(error);\n\n  return <Alert title={title}>{errorStr}</Alert>;\n}\n","import { groupBy } from 'lodash';\n\nimport {\n  DataFrame,\n  Field as DataFrameField,\n  DataFrameJSON,\n  Field,\n  FieldType,\n  GrafanaTheme2,\n  MappingType,\n  ThresholdsMode,\n  getDisplayProcessor,\n} from '@grafana/data';\nimport { fieldIndexComparer } from '@grafana/data/src/field/fieldComparers';\nimport { mapStateWithReasonToBaseState } from 'app/types/unified-alerting-dto';\n\nimport { labelsMatchMatchers } from '../../../utils/alertmanager';\nimport { parsePromQLStyleMatcherLooseSafe } from '../../../utils/matchers';\nimport { LogRecord } from '../state-history/common';\nimport { isLine, isNumbers } from '../state-history/useRuleHistoryRecords';\n\nimport { LABELS_FILTER, STATE_FILTER_FROM, STATE_FILTER_TO, StateFilterValues } from './CentralAlertHistoryScene';\n\nconst GROUPING_INTERVAL = 10 * 1000; // 10 seconds\nconst QUERY_PARAM_PREFIX = 'var-'; // Prefix used by Grafana to sync variables in the URL\n\nconst emptyFilters = {\n  stateTo: 'all',\n  stateFrom: 'all',\n};\n\n/*\n * This function is used to convert the history response to a DataFrame list and filter the data by labels and states\n * The response is a list of log records, each log record has a timestamp and a line.\n * We group all records by alert instance (unique set of labels) and create a DataFrame for each group (instance).\n * This allows us to be able to filter by labels and states in the groupDataFramesByTime function.\n */\nexport function historyResultToDataFrame({ data }: DataFrameJSON, filters = emptyFilters): DataFrame[] {\n  const { stateTo, stateFrom } = filters;\n\n  // Extract timestamps and lines from the response\n  const [tsValues = [], lines = []] = data?.values ?? [];\n  const timestamps = isNumbers(tsValues) ? tsValues : [];\n\n  // Filter log records by state and create a list of log records with the timestamp and line\n  const logRecords = timestamps.reduce<LogRecord[]>((acc, timestamp: number, index: number) => {\n    const line = lines[index];\n    if (!isLine(line)) {\n      return acc;\n    }\n\n    // we have to filter out by state at that point , because we are going to group by timestamp and these states are going to be lost\n    const baseStateTo = mapStateWithReasonToBaseState(line.current);\n    const baseStateFrom = mapStateWithReasonToBaseState(line.previous);\n    const stateToMatch = stateTo !== StateFilterValues.all ? stateTo === baseStateTo : true;\n    const stateFromMatch = stateFrom !== StateFilterValues.all ? stateFrom === baseStateFrom : true;\n\n    // filter by state\n    if (stateToMatch && stateFromMatch) {\n      acc.push({ timestamp, line });\n    }\n\n    return acc;\n  }, []);\n\n  // Group log records by alert instance\n  const logRecordsByInstance = groupBy(logRecords, (record: LogRecord) => {\n    return JSON.stringify(record.line.labels);\n  });\n\n  // Convert each group of log records to a DataFrame\n  const dataFrames: DataFrame[] = Object.entries(logRecordsByInstance).map<DataFrame>(([key, records]) => {\n    // key is the stringified labels\n    return logRecordsToDataFrame(key, records);\n  });\n\n  // Group DataFrames by time and filter by labels\n  return groupDataFramesByTimeAndFilterByLabels(dataFrames);\n}\n\n// Scenes sync variables in the URL adding a prefix to the variable name.\nexport function getLabelsFilterInQueryParams() {\n  const queryParams = new URLSearchParams(window.location.search);\n  return queryParams.get(`${QUERY_PARAM_PREFIX}${LABELS_FILTER}`) ?? '';\n}\n\nexport function getStateFilterToInQueryParams() {\n  const queryParams = new URLSearchParams(window.location.search);\n  return queryParams.get(`${QUERY_PARAM_PREFIX}${STATE_FILTER_TO}`) ?? StateFilterValues.all;\n}\n\nexport function getStateFilterFromInQueryParams() {\n  const queryParams = new URLSearchParams(window.location.search);\n  return queryParams.get(`${QUERY_PARAM_PREFIX}${STATE_FILTER_FROM}`) ?? StateFilterValues.all;\n}\n\n/*\n * This function groups the data frames by time and filters them by labels.\n * The interval is set to 10 seconds.\n * */\nfunction groupDataFramesByTimeAndFilterByLabels(dataFrames: DataFrame[]): DataFrame[] {\n  // Filter data frames by labels. This is used to filter out the data frames that do not match the query.\n  const labelsFilterValue = getLabelsFilterInQueryParams();\n  const dataframesFiltered = dataFrames.filter((frame) => {\n    const labels = JSON.parse(frame.name ?? ''); // in name we store the labels stringified\n\n    const matchers = Boolean(labelsFilterValue) ? parsePromQLStyleMatcherLooseSafe(labelsFilterValue) : [];\n    return labelsMatchMatchers(labels, matchers);\n  });\n  // Extract time fields from filtered data frames\n  const timeFieldList = dataframesFiltered.flatMap((frame) => frame.fields.find((field) => field.name === 'time'));\n\n  // Group time fields by interval\n  const groupedTimeFields = groupBy(\n    timeFieldList?.flatMap((tf) => tf?.values),\n    (time: number) => Math.floor(time / GROUPING_INTERVAL) * GROUPING_INTERVAL\n  );\n\n  // Create new time field with grouped time values\n  const newTimeField: Field = {\n    name: 'time',\n    type: FieldType.time,\n    values: Object.keys(groupedTimeFields).map(Number),\n    config: { displayName: 'Time', custom: { fillOpacity: 100 } },\n  };\n\n  // Create count field with count of records in each group\n  const countField: Field = {\n    name: 'value',\n    type: FieldType.number,\n    values: Object.values(groupedTimeFields).map((group) => group.length),\n    config: {},\n  };\n\n  // Return new DataFrame with time and count fields\n  return [\n    {\n      fields: [newTimeField, countField],\n      length: newTimeField.values.length,\n    },\n  ];\n}\n\n/*\n * This function is used to convert the log records to a DataFrame.\n * The DataFrame has two fields: time and value.\n * The time field is the timestamp of the log record.\n * The value field is always 1.\n * */\nfunction logRecordsToDataFrame(instanceLabels: string, records: LogRecord[]): DataFrame {\n  const timeField: DataFrameField = {\n    name: 'time',\n    type: FieldType.time,\n    values: [...records.map((record) => record.timestamp)],\n    config: { displayName: 'Time', custom: { fillOpacity: 100 } },\n  };\n\n  // Sort time field values\n  const timeIndex = timeField.values.map((_, index) => index);\n  timeIndex.sort(fieldIndexComparer(timeField));\n\n  // Create DataFrame with time and value fields\n  const frame: DataFrame = {\n    fields: [\n      {\n        ...timeField,\n        values: timeField.values.map((_, i) => timeField.values[timeIndex[i]]),\n      },\n      {\n        name: instanceLabels,\n        type: FieldType.number,\n        values: timeField.values.map((record) => 1),\n        config: {},\n      },\n    ],\n    length: timeField.values.length,\n    name: instanceLabels,\n  };\n\n  return frame;\n}\n\n/*\n * This function is used to convert the log records to a DataFrame.\n * The DataFrame has two fields: time and value.\n * The time field is the timestamp of the log record.\n * The value field is the state of the log record.\n * The state is converted to a string and color is assigned based on the state.\n * The state can be Alerting, Pending, Normal, or NoData.\n *\n * */\nexport function logRecordsToDataFrameForState(records: LogRecord[], theme: GrafanaTheme2): DataFrame {\n  const timeField: DataFrameField = {\n    name: 'time',\n    type: FieldType.time,\n    values: [...records.map((record) => record.timestamp), Date.now()],\n    config: { displayName: 'Time', custom: { fillOpacity: 100 } },\n  };\n\n  // Sort time field values\n  const timeIndex = timeField.values.map((_, index) => index);\n  timeIndex.sort(fieldIndexComparer(timeField));\n\n  const stateValues = [...records.map((record) => record.line.current), records.at(-1)?.line.current];\n\n  // Create DataFrame with time and value fields\n  const frame: DataFrame = {\n    fields: [\n      {\n        ...timeField,\n        values: timeField.values.map((_, i) => timeField.values[timeIndex[i]]),\n      },\n      {\n        name: 'State',\n        type: FieldType.string,\n        values: stateValues.map((_, i) => stateValues[timeIndex[i]]),\n        config: {\n          displayName: 'State',\n          color: { mode: 'thresholds' },\n          custom: { fillOpacity: 100 },\n          mappings: [\n            {\n              type: MappingType.ValueToText,\n              options: {\n                Alerting: {\n                  color: theme.colors.error.main,\n                },\n                Pending: {\n                  color: theme.colors.warning.main,\n                },\n                Normal: {\n                  color: theme.colors.success.main,\n                },\n                NoData: {\n                  color: theme.colors.info.main,\n                },\n              },\n            },\n          ],\n          thresholds: {\n            mode: ThresholdsMode.Absolute,\n            steps: [],\n          },\n        },\n      },\n    ],\n    length: timeField.values.length,\n    name: '',\n  };\n  frame.fields.forEach((field) => {\n    field.display = getDisplayProcessor({ field, theme });\n  });\n\n  return frame;\n}\n","import { css } from '@emotion/css';\nimport { capitalize, groupBy } from 'lodash';\nimport { useEffect, useMemo } from 'react';\n\nimport { DataFrame, DataFrameJSON, GrafanaTheme2, TimeRange } from '@grafana/data';\nimport { Icon, Stack, Text, useStyles2, useTheme2 } from '@grafana/ui';\nimport { Trans, t } from 'app/core/internationalization';\nimport { CombinedRule } from 'app/types/unified-alerting';\n\nimport { trackUseCentralHistoryExpandRow } from '../../../Analytics';\nimport { stateHistoryApi } from '../../../api/stateHistoryApi';\nimport { useCombinedRule } from '../../../hooks/useCombinedRule';\nimport { labelsMatchMatchers } from '../../../utils/alertmanager';\nimport { parsePromQLStyleMatcherLooseSafe } from '../../../utils/matchers';\nimport { parse } from '../../../utils/rule-id';\nimport { MetaText } from '../../MetaText';\nimport { AnnotationValue } from '../../rule-viewer/tabs/Details';\nimport { LogTimelineViewer } from '../state-history/LogTimelineViewer';\nimport { useFrameSubset } from '../state-history/LokiStateHistory';\nimport { LogRecord } from '../state-history/common';\nimport { isLine, isNumbers } from '../state-history/useRuleHistoryRecords';\n\nimport { EventState, FilterType, LIMIT_EVENTS } from './EventListSceneObject';\nimport { HistoryErrorMessage } from './HistoryErrorMessage';\nimport { logRecordsToDataFrameForState } from './utils';\n\ninterface EventDetailsProps {\n  record: LogRecord;\n  addFilter: (key: string, value: string, type: FilterType) => void;\n  timeRange: TimeRange;\n}\nexport function EventDetails({ record, addFilter, timeRange }: EventDetailsProps) {\n  // track the usage of the expand row\n  useEffect(() => {\n    trackUseCentralHistoryExpandRow();\n  }, []);\n\n  // get the rule from the ruleUID\n  const ruleUID = record.line?.ruleUID ?? '';\n  const labelsInInstance = record.line?.labels;\n  const identifier = useMemo(() => {\n    return parse(ruleUID, true);\n  }, [ruleUID]);\n  const { error, loading, result: rule } = useCombinedRule({ ruleIdentifier: identifier, limitAlerts: 0 }); // we limit the alerts to 0 as we only need the rule\n\n  if (error) {\n    return (\n      <Text>\n        <Trans i18nKey=\"alerting.central-alert-history.details.error\">Error loading rule for this event.</Trans>\n      </Text>\n    );\n  }\n  if (loading) {\n    return (\n      <Text>\n        <Trans i18nKey=\"alerting.central-alert-history.details.loading\">Loading...</Trans>\n      </Text>\n    );\n  }\n\n  if (!rule) {\n    return (\n      <Text>\n        <Trans i18nKey=\"alerting.central-alert-history.details.not-found\">Rule not found for this event.</Trans>\n      </Text>\n    );\n  }\n\n  return (\n    <Stack direction=\"column\" gap={0.5}>\n      <Stack direction={'row'} gap={6}>\n        <StateTransition record={record} addFilter={addFilter} />\n        <ValueInTransition record={record} />\n      </Stack>\n      <Annotations rule={rule} />\n      <StateVisualization ruleUID={ruleUID} timeRange={timeRange} labels={labelsInInstance ?? {}} />\n    </Stack>\n  );\n}\n\nfunction useRuleHistoryRecordsForTheInstance(labelsForTheInstance: string, stateHistory?: DataFrameJSON) {\n  const theme = useTheme2();\n\n  return useMemo(() => {\n    // merge timestamp with \"line\"\n    const tsValues = stateHistory?.data?.values[0] ?? [];\n    const timestamps: number[] = isNumbers(tsValues) ? tsValues : [];\n    const lines = stateHistory?.data?.values[1] ?? [];\n\n    const logRecords = timestamps.reduce((acc: LogRecord[], timestamp: number, index: number) => {\n      const line = lines[index];\n      // values property can be undefined for some instance states (e.g. NoData)\n      if (isLine(line)) {\n        acc.push({ timestamp, line });\n      }\n\n      return acc;\n    }, []);\n\n    // group all records by alert instance (unique set of labels)\n    const logRecordsByInstance = groupBy(logRecords, (record: LogRecord) => {\n      return JSON.stringify(record.line.labels);\n    });\n\n    // filter by instance labels\n    const filterMatchers = parsePromQLStyleMatcherLooseSafe(labelsForTheInstance);\n    const filteredGroupedLines = Object.entries(logRecordsByInstance).filter(([key]) => {\n      const labels = JSON.parse(key);\n      return labelsMatchMatchers(labels, filterMatchers);\n    });\n    // Convert each group of log records to a DataFrame\n    const dataFrames: DataFrame[] = Object.values(filteredGroupedLines).map<DataFrame>((records) => {\n      // first element is the linstance labels, the second is the records list\n      return logRecordsToDataFrameForState(records[1], theme);\n    });\n    return {\n      dataFrames,\n    };\n  }, [stateHistory, labelsForTheInstance, theme]);\n}\n\ninterface StateVisualizationProps {\n  ruleUID: string;\n  timeRange: TimeRange;\n  labels: Record<string, string>;\n}\n\n/**\n * This component fetches the state history for the given ruleUID and time range, and displays the number of transitions and a State TimelineChart.\n * Fetching the state history for the alert rule uid, and labels,\n * makes the result to be more accurate, as it might be that we are not showing all the state transitions in the log records.\n * @param ruleUID\n * @param timeRange\n * @param labels\n * @returns\n */\nfunction StateVisualization({ ruleUID, timeRange, labels }: StateVisualizationProps) {\n  const { useGetRuleHistoryQuery } = stateHistoryApi;\n\n  const {\n    currentData: stateHistory,\n    isLoading,\n    isError,\n    error,\n  } = useGetRuleHistoryQuery(\n    {\n      ruleUid: ruleUID,\n      from: timeRange.from.unix(),\n      to: timeRange.to.unix(),\n      limit: LIMIT_EVENTS,\n    },\n    {\n      refetchOnFocus: true,\n      refetchOnReconnect: true,\n    }\n  );\n\n  const { dataFrames } = useRuleHistoryRecordsForTheInstance(\n    labels\n      ? Object.entries(labels)\n          .map(([key, value]) => `${key}=${value}`)\n          .join(',')\n      : '',\n    stateHistory\n  );\n\n  const { frameSubset, frameTimeRange } = useFrameSubset(dataFrames);\n\n  if (isLoading) {\n    return (\n      <div>\n        <Trans i18nKey=\"alerting.central-alert-history.details.loading\">Loading...</Trans>\n      </div>\n    );\n  }\n  if (isError) {\n    return <HistoryErrorMessage error={error} />;\n  }\n  if (!frameSubset || frameSubset.length === 0) {\n    return null;\n  }\n\n  const numberOfTransitions = dataFrames[0]?.fields[0]?.values?.length - 1 ?? 0; // we subtract 1 as the first value is the initial state\n\n  return (\n    <>\n      <NumberTransitions transitions={ruleUID ? numberOfTransitions : 0} />\n      <LogTimelineViewer frames={frameSubset} timeRange={frameTimeRange} />\n    </>\n  );\n}\n\ninterface StateTransitionProps {\n  record: LogRecord;\n  addFilter: (key: string, value: string, type: FilterType) => void;\n}\nfunction StateTransition({ record, addFilter }: StateTransitionProps) {\n  return (\n    <Stack gap={0.5} direction={'column'}>\n      <Text variant=\"body\" weight=\"light\" color=\"secondary\">\n        <Trans i18nKey=\"alerting.central-alert-history.details.state-transitions\">State transition</Trans>\n      </Text>\n      <Stack gap={0.5} direction={'row'} alignItems=\"center\">\n        <EventState state={record.line.previous} showLabel addFilter={addFilter} type=\"from\" />\n        <Icon name=\"arrow-right\" size=\"lg\" />\n        <EventState state={record.line.current} showLabel addFilter={addFilter} type=\"to\" />\n      </Stack>\n    </Stack>\n  );\n}\n\ninterface AnnotationsProps {\n  rule: CombinedRule;\n}\nconst Annotations = ({ rule }: AnnotationsProps) => {\n  const styles = useStyles2(getStyles);\n  const annotations = rule.annotations;\n  if (!annotations || Object.keys(annotations).length === 0) {\n    return null;\n  }\n  return (\n    <>\n      <div className={styles.metadataWrapper}>\n        {Object.entries(annotations).map(([name, value]) => {\n          const capitalizedName = capitalize(name);\n          return (\n            <MetaText direction=\"column\" key={capitalizedName}>\n              {capitalizedName}\n              <AnnotationValue value={value} />\n            </MetaText>\n          );\n        })}\n      </div>\n    </>\n  );\n};\ninterface ValueInTransitionProps {\n  record: LogRecord;\n}\nfunction ValueInTransition({ record }: ValueInTransitionProps) {\n  const values = record?.line?.values\n    ? JSON.stringify(record.line.values)\n    : t('alerting.central-alert-history.details.no-values', 'No values');\n  return (\n    <Stack gap={0.5} direction={'column'}>\n      <Text variant=\"body\" weight=\"light\" color=\"secondary\">\n        <Trans i18nKey=\"alerting.central-alert-history.details.value-in-transition\">Value in transition</Trans>\n      </Text>\n      <Stack gap={0.5} direction={'row'} alignItems=\"center\">\n        <Text variant=\"body\" weight=\"light\">\n          {values}\n        </Text>\n      </Stack>\n    </Stack>\n  );\n}\ninterface NumberTransitionsProps {\n  transitions: number;\n}\nfunction NumberTransitions({ transitions }: NumberTransitionsProps) {\n  const styles = useStyles2(getStyles);\n  return (\n    <div className={styles.transitionsNumber}>\n      <Text variant=\"body\" weight=\"bold\" color=\"secondary\">\n        <Trans i18nKey=\"alerting.central-alert-history.details.number-transitions\">\n          State transitions for selected period:\n        </Trans>\n      </Text>\n      <Text variant=\"body\" weight=\"light\">\n        {transitions}\n      </Text>\n    </div>\n  );\n}\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    metadataWrapper: css({\n      display: 'grid',\n      gridTemplateColumns: 'auto auto',\n      rowGap: theme.spacing(3),\n      columnGap: theme.spacing(12),\n    }),\n    transitionsNumber: css({\n      display: 'flex',\n      flexDirection: 'row',\n      gap: theme.spacing(0.5),\n      alignItems: 'center',\n      marginTop: theme.spacing(1.5),\n    }),\n  };\n};\n","import { useMemo } from 'react';\n\nimport { DataFrameJSON } from '@grafana/data';\nimport { mapStateWithReasonToBaseState } from 'app/types/unified-alerting-dto';\n\nimport { labelsMatchMatchers } from '../../../utils/alertmanager';\nimport { parsePromQLStyleMatcherLooseSafe } from '../../../utils/matchers';\nimport { LogRecord } from '../state-history/common';\nimport { isLine, isNumbers } from '../state-history/useRuleHistoryRecords';\n\nimport { StateFilterValues } from './CentralAlertHistoryScene';\n\nconst emptyFilters = {\n  labels: '',\n  stateFrom: 'all',\n  stateTo: 'all',\n};\n\n/**\n * This hook filters the history records based on the label, stateTo and stateFrom filters.\n * @param filterInLabel\n * @param filterInStateTo\n * @param filterInStateFrom\n * @param stateHistory the original history records\n * @returns the filtered history records\n */\nexport function useRuleHistoryRecords(stateHistory?: DataFrameJSON, filters = emptyFilters) {\n  return useMemo(() => ruleHistoryToRecords(stateHistory, filters), [filters, stateHistory]);\n}\n\nexport function ruleHistoryToRecords(stateHistory?: DataFrameJSON, filters = emptyFilters) {\n  const { labels, stateFrom, stateTo } = filters;\n\n  if (!stateHistory?.data) {\n    return { historyRecords: [] };\n  }\n\n  const filterMatchers = labels ? parsePromQLStyleMatcherLooseSafe(labels) : [];\n\n  const [tsValues, lines] = stateHistory.data.values;\n  const timestamps = isNumbers(tsValues) ? tsValues : [];\n\n  // merge timestamp with \"line\"\n  const logRecords = timestamps.reduce((acc: LogRecord[], timestamp: number, index: number) => {\n    const line = lines[index];\n    if (!isLine(line)) {\n      return acc;\n    }\n    // values property can be undefined for some instance states (e.g. NoData)\n    const filterMatch = line.labels && labelsMatchMatchers(line.labels, filterMatchers);\n    const baseStateTo = mapStateWithReasonToBaseState(line.current);\n    const baseStateFrom = mapStateWithReasonToBaseState(line.previous);\n    const stateToMatch = stateTo !== StateFilterValues.all ? stateTo === baseStateTo : true;\n    const stateFromMatch = stateFrom !== StateFilterValues.all ? stateFrom === baseStateFrom : true;\n    if (filterMatch && stateToMatch && stateFromMatch) {\n      acc.push({ timestamp, line });\n    }\n\n    return acc;\n  }, []);\n\n  return {\n    historyRecords: logRecords,\n  };\n}\n","import { css, cx } from '@emotion/css';\nimport { ReactElement, useState } from 'react';\nimport { useLocation } from 'react-router';\nimport { useMeasure } from 'react-use';\n\nimport { GrafanaTheme2, IconName, TimeRange } from '@grafana/data';\nimport {\n  CustomVariable,\n  SceneComponentProps,\n  SceneObjectBase,\n  TextBoxVariable,\n  VariableValue,\n  sceneGraph,\n} from '@grafana/scenes';\nimport { Alert, Icon, LoadingBar, Pagination, Stack, Text, Tooltip, useStyles2, withErrorBoundary } from '@grafana/ui';\nimport { Trans, t } from 'app/core/internationalization';\nimport {\n  GrafanaAlertStateWithReason,\n  isAlertStateWithReason,\n  isGrafanaAlertState,\n  mapStateWithReasonToBaseState,\n  mapStateWithReasonToReason,\n} from 'app/types/unified-alerting-dto';\n\nimport { trackUseCentralHistoryFilterByClicking, trackUseCentralHistoryMaxEventsReached } from '../../../Analytics';\nimport { stateHistoryApi } from '../../../api/stateHistoryApi';\nimport { usePagination } from '../../../hooks/usePagination';\nimport { combineMatcherStrings } from '../../../utils/alertmanager';\nimport { GRAFANA_RULES_SOURCE_NAME } from '../../../utils/datasource';\nimport { createRelativeUrl } from '../../../utils/url';\nimport { AlertLabels } from '../../AlertLabels';\nimport { CollapseToggle } from '../../CollapseToggle';\nimport { LogRecord } from '../state-history/common';\n\nimport { LABELS_FILTER, STATE_FILTER_FROM, STATE_FILTER_TO } from './CentralAlertHistoryScene';\nimport { EventDetails } from './EventDetails';\nimport { HistoryErrorMessage } from './HistoryErrorMessage';\nimport { useRuleHistoryRecords } from './useRuleHistoryRecords';\n\nexport const LIMIT_EVENTS = 5000; // limit is hard-capped at 5000 at the BE level.\nconst PAGE_SIZE = 100;\n\n/**\n *\n * This component displays a list of history events.\n * It fetches the events from the history api and displays them in a list.\n * The list is filtered by the labels in the filter variable and by the time range variable in the scene graph.\n */\ninterface HistoryEventsListProps {\n  timeRange: TimeRange;\n  valueInLabelFilter: VariableValue;\n  valueInStateToFilter: VariableValue;\n  valueInStateFromFilter: VariableValue;\n  addFilter: (key: string, value: string, type: FilterType) => void;\n}\nexport const HistoryEventsList = ({\n  timeRange,\n  valueInLabelFilter,\n  valueInStateToFilter,\n  valueInStateFromFilter,\n  addFilter,\n}: HistoryEventsListProps) => {\n  const from = timeRange?.from.unix();\n  const to = timeRange?.to.unix();\n\n  const {\n    data: stateHistory,\n    isLoading,\n    isError,\n    error,\n  } = stateHistoryApi.endpoints.getRuleHistory.useQuery({\n    from: from,\n    to: to,\n    limit: LIMIT_EVENTS,\n  });\n\n  const { historyRecords: historyRecordsNotSorted } = useRuleHistoryRecords(stateHistory, {\n    labels: valueInLabelFilter.toString(),\n    stateFrom: valueInStateFromFilter.toString(),\n    stateTo: valueInStateToFilter.toString(),\n  });\n\n  const historyRecords = historyRecordsNotSorted.sort((a, b) => b.timestamp - a.timestamp);\n\n  if (isError) {\n    return <HistoryErrorMessage error={error} />;\n  }\n\n  const maximumEventsReached = !isLoading && stateHistory?.data?.values?.[0]?.length === LIMIT_EVENTS;\n  if (maximumEventsReached) {\n    trackUseCentralHistoryMaxEventsReached({ from, to });\n  }\n\n  return (\n    <>\n      {maximumEventsReached && (\n        <Alert\n          severity=\"warning\"\n          title={t('alerting.central-alert-history.too-many-events.title', 'Unable to display all events')}\n        >\n          {t(\n            'alerting.central-alert-history.too-many-events.text',\n            'The selected time period has too many events to display. Diplaying the latest 5000 events. Try using a shorter time period.'\n          )}\n        </Alert>\n      )}\n      <LoadingIndicator visible={isLoading} />\n      <HistoryLogEvents logRecords={historyRecords} addFilter={addFilter} timeRange={timeRange} />\n    </>\n  );\n};\n\n// todo: this function has been copied from RuleList.v2.tsx, should be moved to a shared location\nconst LoadingIndicator = ({ visible = false }) => {\n  const [measureRef, { width }] = useMeasure<HTMLDivElement>();\n  return <div ref={measureRef}>{visible && <LoadingBar width={width} data-testid=\"loading-bar\" />}</div>;\n};\n\ninterface HistoryLogEventsProps {\n  logRecords: LogRecord[];\n  addFilter: (key: string, value: string, type: FilterType) => void;\n  timeRange: TimeRange;\n}\nfunction HistoryLogEvents({ logRecords, addFilter, timeRange }: HistoryLogEventsProps) {\n  const { page, pageItems, numberOfPages, onPageChange } = usePagination(logRecords, 1, PAGE_SIZE);\n  return (\n    <Stack direction=\"column\" gap={0}>\n      <ListHeader />\n      <ul>\n        {pageItems.map((record) => {\n          return (\n            <EventRow\n              key={record.timestamp + (record.line.fingerprint ?? '')}\n              record={record}\n              addFilter={addFilter}\n              timeRange={timeRange}\n            />\n          );\n        })}\n      </ul>\n      {/* This paginations improves the performance considerably , making the page load faster */}\n      <Pagination currentPage={page} numberOfPages={numberOfPages} onNavigate={onPageChange} hideWhenSinglePage />\n    </Stack>\n  );\n}\n\nfunction ListHeader() {\n  const styles = useStyles2(getStyles);\n  return (\n    <div className={styles.headerWrapper}>\n      <div className={styles.mainHeader}>\n        <div className={styles.timeCol}>\n          <Text variant=\"body\">\n            <Trans i18nKey=\"alerting.central-alert-history.details.header.timestamp\">Timestamp</Trans>\n          </Text>\n        </div>\n        <div className={styles.transitionCol}>\n          <Text variant=\"body\">\n            <Trans i18nKey=\"alerting.central-alert-history.details.header.state\">State</Trans>\n          </Text>\n        </div>\n        <div className={styles.alertNameCol}>\n          <Text variant=\"body\">\n            <Trans i18nKey=\"alerting.central-alert-history.details.header.alert-rule\">Alert rule</Trans>\n          </Text>\n        </div>\n        <div className={styles.labelsCol}>\n          <Text variant=\"body\">\n            <Trans i18nKey=\"alerting.central-alert-history.details.header.instance\">Instance</Trans>\n          </Text>\n        </div>\n      </div>\n    </div>\n  );\n}\n\ninterface EventRowProps {\n  record: LogRecord;\n  addFilter: (key: string, value: string, type: FilterType) => void;\n  timeRange: TimeRange;\n}\nfunction EventRow({ record, addFilter, timeRange }: EventRowProps) {\n  const styles = useStyles2(getStyles);\n  const [isCollapsed, setIsCollapsed] = useState(true);\n  function onLabelClick(label: string, value: string) {\n    addFilter(label, value, 'label');\n  }\n\n  return (\n    <Stack direction=\"column\" gap={0}>\n      <div\n        className={cx(styles.header, isCollapsed ? styles.collapsedHeader : styles.notCollapsedHeader)}\n        data-testid=\"event-row-header\"\n      >\n        <CollapseToggle\n          size=\"sm\"\n          className={styles.collapseToggle}\n          isCollapsed={isCollapsed}\n          onToggle={setIsCollapsed}\n        />\n        <Stack gap={0.5} direction={'row'} alignItems={'center'}>\n          <div className={styles.timeCol}>\n            <Timestamp time={record.timestamp} />\n          </div>\n          <div className={styles.transitionCol}>\n            <EventTransition previous={record.line.previous} current={record.line.current} addFilter={addFilter} />\n          </div>\n          <div className={styles.alertNameCol}>\n            {record.line.labels ? <AlertRuleName labels={record.line.labels} ruleUID={record.line.ruleUID} /> : null}\n          </div>\n          <div className={styles.labelsCol}>\n            <AlertLabels labels={record.line.labels ?? {}} size=\"xs\" onClick={onLabelClick} />\n          </div>\n        </Stack>\n      </div>\n      {!isCollapsed && (\n        <div className={styles.expandedRow}>\n          <EventDetails record={record} addFilter={addFilter} timeRange={timeRange} />\n        </div>\n      )}\n    </Stack>\n  );\n}\n\ninterface AlertRuleNameProps {\n  labels: Record<string, string>;\n  ruleUID?: string;\n}\nfunction AlertRuleName({ labels, ruleUID }: AlertRuleNameProps) {\n  const styles = useStyles2(getStyles);\n  const { pathname, search } = useLocation();\n  const returnTo = `${pathname}${search}`;\n  const alertRuleName = labels.alertname;\n  if (!ruleUID) {\n    return (\n      <Text>\n        <Trans i18nKey=\"alerting.central-alert-history.details.unknown-rule\">Unknown</Trans>\n      </Text>\n    );\n  }\n  const ruleViewUrl = createRelativeUrl(`/alerting/${GRAFANA_RULES_SOURCE_NAME}/${ruleUID}/view`, {\n    tab: 'history',\n    returnTo,\n  });\n  return (\n    <Tooltip content={alertRuleName ?? ''}>\n      <a href={ruleViewUrl} className={styles.alertName}>\n        {alertRuleName}\n      </a>\n    </Tooltip>\n  );\n}\n\ninterface EventTransitionProps {\n  previous: GrafanaAlertStateWithReason;\n  current: GrafanaAlertStateWithReason;\n  addFilter: (key: string, value: string, type: FilterType) => void;\n}\nfunction EventTransition({ previous, current, addFilter }: EventTransitionProps) {\n  return (\n    <Stack gap={0.5} direction={'row'}>\n      <EventState state={previous} addFilter={addFilter} type=\"from\" />\n      <Icon name=\"arrow-right\" size=\"lg\" />\n      <EventState state={current} addFilter={addFilter} type=\"to\" />\n    </Stack>\n  );\n}\n\ninterface StateIconProps {\n  iconName: IconName;\n  iconColor: string;\n  tooltipContent: string;\n  labelText: ReactElement;\n  showLabel: boolean;\n}\nconst StateIcon = ({ iconName, iconColor, tooltipContent, labelText, showLabel }: StateIconProps) => (\n  <Tooltip content={tooltipContent} placement=\"top\">\n    <Stack gap={0.5} direction={'row'} alignItems=\"center\">\n      <Icon name={iconName} size=\"md\" className={iconColor} />\n      {showLabel && (\n        <Text variant=\"body\" weight=\"light\">\n          {labelText}\n        </Text>\n      )}\n    </Stack>\n  </Tooltip>\n);\n\ninterface EventStateProps {\n  state: GrafanaAlertStateWithReason;\n  showLabel?: boolean;\n  addFilter: (key: string, value: string, type: FilterType) => void;\n  type: 'from' | 'to';\n}\nexport function EventState({ state, showLabel = false, addFilter, type }: EventStateProps) {\n  const styles = useStyles2(getStyles);\n  const toolTip = t('alerting.central-alert-history.details.no-recognized-state', 'No recognized state');\n  if (!isGrafanaAlertState(state) && !isAlertStateWithReason(state)) {\n    return (\n      <StateIcon\n        iconName=\"exclamation-triangle\"\n        tooltipContent={toolTip}\n        labelText={<Trans i18nKey=\"alerting.central-alert-history.details.unknown-event-state\">Unknown</Trans>}\n        showLabel={showLabel}\n        iconColor={styles.warningColor}\n      />\n    );\n  }\n  const baseState = mapStateWithReasonToBaseState(state);\n  const reason = mapStateWithReasonToReason(state);\n  interface StateConfig {\n    iconName: IconName;\n    iconColor: string;\n    tooltipContent: string;\n    labelText: ReactElement;\n  }\n  interface StateConfigMap {\n    [key: string]: StateConfig;\n  }\n  const stateConfig: StateConfigMap = {\n    Normal: {\n      iconName: 'check-circle',\n      iconColor: Boolean(reason) ? styles.warningColor : styles.normalColor,\n      tooltipContent: Boolean(reason) ? `Normal (${reason})` : 'Normal',\n      labelText: <Trans i18nKey=\"alerting.central-alert-history.details.state.normal\">Normal</Trans>,\n    },\n    Alerting: {\n      iconName: 'exclamation-circle',\n      iconColor: styles.alertingColor,\n      tooltipContent: 'Alerting',\n      labelText: <Trans i18nKey=\"alerting.central-alert-history.details.state.alerting\">Alerting</Trans>,\n    },\n    NoData: {\n      iconName: 'exclamation-triangle',\n      iconColor: styles.warningColor,\n      tooltipContent: 'Insufficient data',\n      labelText: <Trans i18nKey=\"alerting.central-alert-history.details.state.no-data\">No data</Trans>,\n    },\n    Error: {\n      iconName: 'exclamation-circle',\n      tooltipContent: 'Error',\n      iconColor: styles.warningColor,\n      labelText: <Trans i18nKey=\"alerting.central-alert-history.details.state.error\">Error</Trans>,\n    },\n    Pending: {\n      iconName: 'circle',\n      iconColor: styles.warningColor,\n      tooltipContent: Boolean(reason) ? `Pending (${reason})` : 'Pending',\n      labelText: <Trans i18nKey=\"alerting.central-alert-history.details.state.pending\">Pending</Trans>,\n    },\n  };\n  function onStateClick() {\n    addFilter('state', baseState, type === 'from' ? 'stateFrom' : 'stateTo');\n  }\n\n  const config = stateConfig[baseState] || { iconName: 'exclamation-triangle', tooltipContent: 'Unknown State' };\n  return (\n    <div\n      onClick={onStateClick}\n      onKeyDown={(e) => {\n        if (e.key === 'Enter' || e.key === ' ') {\n          onStateClick();\n        }\n      }}\n      className={styles.state}\n      role=\"button\"\n      tabIndex={0}\n    >\n      <StateIcon {...config} showLabel={showLabel} />\n    </div>\n  );\n}\n\ninterface TimestampProps {\n  time: number; // epoch timestamp\n}\n\nconst Timestamp = ({ time }: TimestampProps) => {\n  const dateTime = new Date(time);\n  const formattedDate = dateTime.toLocaleString('en-US', {\n    month: 'long',\n    day: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit',\n    second: '2-digit',\n    hour12: false,\n  });\n\n  return (\n    <Text variant=\"body\" weight=\"light\">\n      {formattedDate}\n    </Text>\n  );\n};\n\nexport default withErrorBoundary(HistoryEventsList, { style: 'page' });\n\nexport const getStyles = (theme: GrafanaTheme2) => {\n  return {\n    header: css({\n      display: 'flex',\n      flexDirection: 'row',\n      alignItems: 'center',\n      padding: `${theme.spacing(1)} ${theme.spacing(1)} ${theme.spacing(1)} 0`,\n      flexWrap: 'nowrap',\n      '&:hover': {\n        backgroundColor: theme.components.table.rowHoverBackground,\n      },\n    }),\n    collapsedHeader: css({\n      borderBottom: `1px solid ${theme.colors.border.weak}`,\n    }),\n    notCollapsedHeader: css({\n      borderBottom: 'none',\n    }),\n\n    collapseToggle: css({\n      background: 'none',\n      border: 'none',\n      marginTop: `-${theme.spacing(1)}`,\n      marginBottom: `-${theme.spacing(1)}`,\n\n      svg: {\n        marginBottom: 0,\n      },\n    }),\n    normalColor: css({\n      fill: theme.colors.success.text,\n    }),\n    warningColor: css({\n      fill: theme.colors.warning.text,\n    }),\n    alertingColor: css({\n      fill: theme.colors.error.text,\n    }),\n    timeCol: css({\n      width: '150px',\n    }),\n    transitionCol: css({\n      width: '80px',\n    }),\n    alertNameCol: css({\n      width: '300px',\n    }),\n    labelsCol: css({\n      display: 'flex',\n      overflow: 'hidden',\n      alignItems: 'center',\n      paddingRight: theme.spacing(2),\n      flex: 1,\n    }),\n    alertName: css({\n      whiteSpace: 'nowrap',\n      cursor: 'pointer',\n      overflow: 'hidden',\n      textOverflow: 'ellipsis',\n      display: 'block',\n      color: theme.colors.text.link,\n    }),\n    expandedRow: css({\n      padding: theme.spacing(2),\n      marginLeft: theme.spacing(2),\n      borderLeft: `1px solid ${theme.colors.border.weak}`,\n    }),\n    colorIcon: css({\n      color: theme.colors.primary.text,\n      '&:hover': {\n        opacity: 0.8,\n      },\n    }),\n    state: css({\n      '&:hover': {\n        opacity: 0.8,\n        cursor: 'pointer',\n      },\n    }),\n    headerWrapper: css({\n      borderBottom: `1px solid ${theme.colors.border.weak}`,\n    }),\n    mainHeader: css({\n      display: 'flex',\n      flexDirection: 'row',\n      alignItems: 'center',\n      flexWrap: 'nowrap',\n      marginLeft: '30px',\n      padding: `${theme.spacing(1)} ${theme.spacing(1)} ${theme.spacing(1)} 0`,\n      gap: theme.spacing(0.5),\n    }),\n  };\n};\n\n/**\n * This is a scene object that displays a list of history events.\n */\n\nexport class HistoryEventsListObject extends SceneObjectBase {\n  public static Component = HistoryEventsListObjectRenderer;\n  public constructor() {\n    super({});\n  }\n}\n\nexport type FilterType = 'label' | 'stateFrom' | 'stateTo';\n\nexport function HistoryEventsListObjectRenderer({ model }: SceneComponentProps<HistoryEventsListObject>) {\n  const { value: timeRange } = sceneGraph.getTimeRange(model).useState(); // get time range from scene graph\n  // eslint-disable-next-line\n  const labelsFiltersVariable = sceneGraph.lookupVariable(LABELS_FILTER, model)! as TextBoxVariable;\n  // eslint-disable-next-line\n  const stateToFilterVariable = sceneGraph.lookupVariable(STATE_FILTER_TO, model)! as CustomVariable;\n  // eslint-disable-next-line\n  const stateFromFilterVariable = sceneGraph.lookupVariable(STATE_FILTER_FROM, model)! as CustomVariable;\n\n  const valueInfilterTextBox: VariableValue = labelsFiltersVariable.getValue();\n  const valueInStateToFilter = stateToFilterVariable.getValue();\n  const valueInStateFromFilter = stateFromFilterVariable.getValue();\n\n  const addFilter = (key: string, value: string, type: FilterType) => {\n    const newFilterToAdd = `${key}=${value}`;\n    trackUseCentralHistoryFilterByClicking({ type, key, value });\n    if (type === 'stateTo') {\n      stateToFilterVariable.changeValueTo(value);\n    }\n    if (type === 'stateFrom') {\n      stateFromFilterVariable.changeValueTo(value);\n    }\n    const finalFilter = combineMatcherStrings(valueInfilterTextBox.toString(), newFilterToAdd);\n    if (type === 'label') {\n      labelsFiltersVariable.setValue(finalFilter);\n    }\n  };\n\n  return (\n    <HistoryEventsList\n      timeRange={timeRange}\n      valueInLabelFilter={valueInfilterTextBox}\n      addFilter={addFilter}\n      valueInStateToFilter={valueInStateToFilter}\n      valueInStateFromFilter={valueInStateFromFilter}\n    />\n  );\n}\n","import { useEffect, useMemo } from 'react';\n\nimport { DataQuery, DataQueryRequest, DataQueryResponse, TestDataSourceResponse } from '@grafana/data';\nimport { RuntimeDataSource, sceneUtils } from '@grafana/scenes';\nimport { getTimeSrv } from 'app/features/dashboard/services/TimeSrv';\nimport { dispatch } from 'app/store/store';\n\nimport { stateHistoryApi } from '../../../api/stateHistoryApi';\nimport { DataSourceInformation } from '../../../home/Insights';\n\nimport { LIMIT_EVENTS } from './EventListSceneObject';\nimport { getStateFilterFromInQueryParams, getStateFilterToInQueryParams, historyResultToDataFrame } from './utils';\n\nconst historyDataSourceUid = '__history_api_ds_uid__';\nconst historyDataSourcePluginId = '__history_api_ds_pluginId__';\n\nexport const alertStateHistoryDatasource: DataSourceInformation = {\n  type: historyDataSourcePluginId,\n  uid: historyDataSourceUid,\n  settings: undefined,\n};\n\nexport function useRegisterHistoryRuntimeDataSource() {\n  // we need to memoize the datasource so it is not registered multiple times for each render\n  const ds = useMemo(() => new HistoryAPIDatasource(historyDataSourceUid, historyDataSourcePluginId), []);\n  useEffect(() => {\n    try {\n      // avoid showing error when the datasource is already registered\n      sceneUtils.registerRuntimeDataSource({ dataSource: ds });\n    } catch (e) {}\n  }, [ds]);\n}\n\n/**\n * This class is a runtime datasource that fetches the events from the history api.\n * The events are grouped by alert instance and then converted to a DataFrame list.\n * The DataFrame list is then grouped by time.\n * This allows us to filter the events by labels.\n * The result is a timeseries panel that shows the events for the selected time range and filtered by labels.\n */\nclass HistoryAPIDatasource extends RuntimeDataSource {\n  constructor(pluginId: string, uid: string) {\n    super(uid, pluginId);\n  }\n\n  async query(request: DataQueryRequest<DataQuery>): Promise<DataQueryResponse> {\n    const from = request.range.from.unix();\n    const to = request.range.to.unix();\n\n    // Get the labels and states filters from the URL\n    const stateTo = getStateFilterToInQueryParams();\n    const stateFrom = getStateFilterFromInQueryParams();\n\n    const historyResult = await getHistory(from, to);\n\n    return {\n      data: historyResultToDataFrame(historyResult, { stateTo, stateFrom }),\n    };\n  }\n\n  testDatasource(): Promise<TestDataSourceResponse> {\n    return Promise.resolve({ status: 'success', message: 'Data source is working', title: 'Success' });\n  }\n}\n\n/**\n * Fetch the history events from the history api.\n * @param from the start time\n * @param to the end time\n * @returns the history events only filtered by time\n */\nexport const getHistory = (from: number, to: number) => {\n  return dispatch(\n    stateHistoryApi.endpoints.getRuleHistory.initiate(\n      {\n        from: from,\n        to: to,\n        limit: LIMIT_EVENTS,\n      },\n      {\n        forceRefetch: Boolean(getTimeSrv().getAutoRefreshInteval().interval), // force refetch in case we are using the refresh option\n      }\n    )\n  ).unwrap();\n};\n","import { css } from '@emotion/css';\nimport { useEffect } from 'react';\n\nimport { GrafanaTheme2, VariableHide } from '@grafana/data';\nimport {\n  CustomVariable,\n  EmbeddedScene,\n  PanelBuilders,\n  SceneControlsSpacer,\n  SceneFlexItem,\n  SceneFlexLayout,\n  SceneQueryRunner,\n  SceneReactObject,\n  SceneRefreshPicker,\n  SceneTimePicker,\n  SceneTimeRange,\n  SceneVariableSet,\n  TextBoxVariable,\n  VariableValueSelectors,\n  useUrlSync,\n} from '@grafana/scenes';\nimport { GraphDrawStyle, VisibilityMode } from '@grafana/schema/dist/esm/index';\nimport {\n  Button,\n  GraphGradientMode,\n  Icon,\n  LegendDisplayMode,\n  LineInterpolation,\n  ScaleDistribution,\n  StackingMode,\n  Text,\n  Tooltip,\n  TooltipDisplayMode,\n  useStyles2,\n} from '@grafana/ui';\nimport { Trans } from 'app/core/internationalization';\n\nimport { LogMessages, logInfo } from '../../../Analytics';\nimport { DataSourceInformation } from '../../../home/Insights';\n\nimport { alertStateHistoryDatasource, useRegisterHistoryRuntimeDataSource } from './CentralHistoryRuntimeDataSource';\nimport { HistoryEventsListObject } from './EventListSceneObject';\n\nexport const LABELS_FILTER = 'labelsFilter';\nexport const STATE_FILTER_TO = 'stateFilterTo';\nexport const STATE_FILTER_FROM = 'stateFilterFrom';\n/**\n *\n * This scene shows the history of the alert state changes.\n * It shows a timeseries panel with the alert state changes and a list of the events.\n * The events in the panel are fetched from the history api, through a runtime datasource.\n * The events in the list are fetched direclty from the history api.\n * Main scene renders two children scene objects, one for the timeseries panel and one for the list of events.\n * Both share time range and filter variable from the parent scene.\n */\n\nexport const StateFilterValues = {\n  all: 'all',\n  firing: 'Alerting',\n  normal: 'Normal',\n  pending: 'Pending',\n} as const;\n\nexport const CentralAlertHistoryScene = () => {\n  //track the loading of the central alert state history\n  useEffect(() => {\n    logInfo(LogMessages.loadedCentralAlertStateHistory);\n  }, []);\n\n  // create the variables for the filters\n  // textbox variable for filtering by labels\n  const labelsFilterVariable = new TextBoxVariable({\n    name: LABELS_FILTER,\n    label: 'Labels: ',\n  });\n  //custom variable for filtering by the current state\n  const transitionsToFilterVariable = new CustomVariable({\n    name: STATE_FILTER_TO,\n    value: StateFilterValues.all,\n    label: 'End state:',\n    hide: VariableHide.dontHide,\n    query: `All : ${StateFilterValues.all}, To Firing : ${StateFilterValues.firing},To Normal : ${StateFilterValues.normal},To Pending : ${StateFilterValues.pending}`,\n  });\n  //custom variable for filtering by the previous state\n  const transitionsFromFilterVariable = new CustomVariable({\n    name: STATE_FILTER_FROM,\n    value: StateFilterValues.all,\n    label: 'Start state:',\n    hide: VariableHide.dontHide,\n    query: `All : ${StateFilterValues.all}, From Firing : ${StateFilterValues.firing},From Normal : ${StateFilterValues.normal},From Pending : ${StateFilterValues.pending}`,\n  });\n\n  useRegisterHistoryRuntimeDataSource(); // register the runtime datasource for the history api.\n\n  const scene = new EmbeddedScene({\n    controls: [\n      new SceneReactObject({\n        component: LabelFilter,\n      }),\n      new SceneReactObject({\n        component: FilterInfo,\n      }),\n      new VariableValueSelectors({}),\n      new SceneReactObject({\n        component: ClearFilterButton,\n        props: {\n          labelsFilterVariable,\n          transitionsToFilterVariable,\n          transitionsFromFilterVariable,\n        },\n      }),\n      new SceneControlsSpacer(),\n      new SceneTimePicker({}),\n      new SceneRefreshPicker({}),\n    ],\n    // use default time range as from 1 hour ago to now, as the limit of the history api is 5000 events,\n    // and using a wider time range might lead to showing gaps in the events list and the chart.\n    $timeRange: new SceneTimeRange({\n      from: 'now-1h',\n      to: 'now',\n    }),\n    $variables: new SceneVariableSet({\n      variables: [labelsFilterVariable, transitionsFromFilterVariable, transitionsToFilterVariable],\n    }),\n    body: new SceneFlexLayout({\n      direction: 'column',\n      children: [\n        new SceneFlexItem({\n          ySizing: 'content',\n          body: getEventsSceneObject(alertStateHistoryDatasource),\n        }),\n        new SceneFlexItem({\n          body: new HistoryEventsListObject(),\n        }),\n      ],\n    }),\n  });\n  // we need to call this to sync the url with the scene state\n  const isUrlSyncInitialized = useUrlSync(scene);\n\n  if (!isUrlSyncInitialized) {\n    return null;\n  }\n\n  return <scene.Component model={scene} />;\n};\n/**\n * Creates a SceneFlexItem with a timeseries panel that shows the events.\n * The query uses a runtime datasource that fetches the events from the history api.\n * @param alertStateHistoryDataSource the datasource information for the runtime datasource\n */\nfunction getEventsSceneObject(alertStateHistoryDataSource: DataSourceInformation) {\n  return new EmbeddedScene({\n    controls: [],\n    body: new SceneFlexLayout({\n      direction: 'column',\n      children: [\n        new SceneFlexItem({\n          ySizing: 'content',\n          body: new SceneFlexLayout({\n            children: [getEventsScenesFlexItem(alertStateHistoryDataSource)],\n          }),\n        }),\n      ],\n    }),\n  });\n}\n\n/**\n * Creates a SceneQueryRunner with the datasource information for the runtime datasource.\n * @param datasource the datasource information for the runtime datasource\n * @returns the SceneQueryRunner\n */\nfunction getSceneQuery(datasource: DataSourceInformation) {\n  const query = new SceneQueryRunner({\n    datasource: datasource,\n    queries: [\n      {\n        refId: 'A',\n        expr: '',\n        queryType: 'range',\n        step: '10s',\n      },\n    ],\n  });\n  return query;\n}\n/**\n * This function creates a SceneFlexItem with a timeseries panel that shows the events.\n * The query uses a runtime datasource that fetches the events from the history api.\n */\nexport function getEventsScenesFlexItem(datasource: DataSourceInformation) {\n  return new SceneFlexItem({\n    minHeight: 300,\n    body: PanelBuilders.timeseries()\n      .setTitle('Alert Events')\n      .setDescription(\n        'Each alert event represents an alert instance that changed its state at a particular point in time. The history of the data is displayed over a period of time.'\n      )\n      .setData(getSceneQuery(datasource))\n      .setColor({ mode: 'continuous-BlPu' })\n      .setCustomFieldConfig('fillOpacity', 100)\n      .setCustomFieldConfig('drawStyle', GraphDrawStyle.Bars)\n      .setCustomFieldConfig('lineInterpolation', LineInterpolation.Linear)\n      .setCustomFieldConfig('lineWidth', 1)\n      .setCustomFieldConfig('barAlignment', 0)\n      .setCustomFieldConfig('spanNulls', false)\n      .setCustomFieldConfig('insertNulls', false)\n      .setCustomFieldConfig('showPoints', VisibilityMode.Auto)\n      .setCustomFieldConfig('pointSize', 5)\n      .setCustomFieldConfig('stacking', { mode: StackingMode.None, group: 'A' })\n      .setCustomFieldConfig('gradientMode', GraphGradientMode.Hue)\n      .setCustomFieldConfig('scaleDistribution', { type: ScaleDistribution.Linear })\n      .setOption('legend', { showLegend: false, displayMode: LegendDisplayMode.Hidden })\n      .setOption('tooltip', { mode: TooltipDisplayMode.Single })\n\n      .setNoValue('No events found')\n      .build(),\n  });\n}\n/*\n * This component shows a button to clear the filters.\n * It is shown when the filters are active.\n * props:\n * labelsFilterVariable: the textbox variable for filtering by labels\n * transitionsToFilterVariable: the custom variable for filtering by the current state\n * transitionsFromFilterVariable: the custom variable for filtering by the previous state\n */\n\nfunction ClearFilterButton({\n  labelsFilterVariable,\n  transitionsToFilterVariable,\n  transitionsFromFilterVariable,\n}: {\n  labelsFilterVariable: TextBoxVariable;\n  transitionsToFilterVariable: CustomVariable;\n  transitionsFromFilterVariable: CustomVariable;\n}) {\n  // get the current values of the filters\n  const valueInLabelsFilter = labelsFilterVariable.getValue();\n  //todo: use parsePromQLStyleMatcherLooseSafe to validate the label filter and check the lenghtof the result\n  const valueInTransitionsFilter = transitionsToFilterVariable.getValue();\n  const valueInTransitionsFromFilter = transitionsFromFilterVariable.getValue();\n  // if no filter is active, return null\n  if (\n    !valueInLabelsFilter &&\n    valueInTransitionsFilter === StateFilterValues.all &&\n    valueInTransitionsFromFilter === StateFilterValues.all\n  ) {\n    return null;\n  }\n  const onClearFilter = () => {\n    labelsFilterVariable.setValue('');\n    transitionsToFilterVariable.changeValueTo(StateFilterValues.all);\n    transitionsFromFilterVariable.changeValueTo(StateFilterValues.all);\n  };\n  return (\n    <Tooltip content=\"Clear filter\">\n      <Button variant={'secondary'} icon=\"times\" onClick={onClearFilter}>\n        <Trans i18nKey=\"alerting.central-alert-history.filter.clear\">Clear filters</Trans>\n      </Button>\n    </Tooltip>\n  );\n}\n\nconst LabelFilter = () => {\n  const styles = useStyles2(getStyles);\n  return (\n    <div className={styles.filterLabelContainer}>\n      <Text variant=\"body\" weight=\"light\" color=\"secondary\">\n        <Trans i18nKey=\"alerting.central-alert-history.filterBy\">Filter by:</Trans>\n      </Text>\n    </div>\n  );\n};\n\nconst FilterInfo = () => {\n  const styles = useStyles2(getStyles);\n  return (\n    <div className={styles.filterInfoContainer}>\n      <Tooltip\n        content={\n          <div>\n            <Trans i18nKey=\"alerting.central-alert-history.filter.info.label1\">\n              Filter events using label querying without spaces, ex:\n            </Trans>\n            <pre>{`{severity=\"critical\", instance=~\"cluster-us-.+\"}`}</pre>\n            <Trans i18nKey=\"alerting.central-alert-history.filter.info.label2\">Invalid use of spaces:</Trans>\n            <pre>{`{severity= \"critical\"}`}</pre>\n            <pre>{`{severity =\"critical\"}`}</pre>\n            <Trans i18nKey=\"alerting.central-alert-history.filter.info.label3\">Valid use of spaces:</Trans>\n            <pre>{`{severity=\" critical\"}`}</pre>\n            <Trans i18nKey=\"alerting.central-alert-history.filter.info.label4\">\n              Filter alerts using label querying without braces, ex:\n            </Trans>\n            <pre>{`severity=\"critical\", instance=~\"cluster-us-.+\"`}</pre>\n          </div>\n        }\n      >\n        <Icon name=\"info-circle\" size=\"sm\" />\n      </Tooltip>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    filterInfoContainer: css({\n      padding: '0',\n      alignSelf: 'center',\n      marginRight: theme.spacing(-1),\n    }),\n    filterLabelContainer: css({\n      padding: '0',\n      alignSelf: 'center',\n    }),\n  };\n};\n","import { withErrorBoundary } from '@grafana/ui';\n\nimport { AlertingPageWrapper } from '../../AlertingPageWrapper';\n\nimport { CentralAlertHistoryScene } from './CentralAlertHistoryScene';\n\nconst HistoryPage = () => {\n  return (\n    <AlertingPageWrapper navId=\"alerts-history\" isLoading={false}>\n      <CentralAlertHistoryScene />\n    </AlertingPageWrapper>\n  );\n};\nexport default withErrorBoundary(HistoryPage, { style: 'page' });\n"],"names":["CollapseToggle","isCollapsed","onToggle","idControlled","className","text","size","restOfProps","HistoryErrorMessage","error","EntityNotFound","title","errorStr","Alert","GROUPING_INTERVAL","QUERY_PARAM_PREFIX","emptyFilters","historyResultToDataFrame","data","filters","stateTo","stateFrom","tsValues","lines","logRecords","acc","timestamp","index","line","baseStateTo","baseStateFrom","stateToMatch","StateFilterValues","stateFromMatch","logRecordsByInstance","record","dataFrames","key","records","logRecordsToDataFrame","groupDataFramesByTimeAndFilterByLabels","getLabelsFilterInQueryParams","LABELS_FILTER","getStateFilterToInQueryParams","STATE_FILTER_TO","getStateFilterFromInQueryParams","STATE_FILTER_FROM","labelsFilterValue","timeFieldList","frame","labels","matchers","field","groupedTimeFields","tf","time","newTimeField","countField","group","instanceLabels","timeField","timeIndex","_","i","logRecordsToDataFrameForState","theme","stateValues","EventDetails","addFilter","timeRange","ruleUID","labelsInInstance","identifier","loading","rule","useCombinedRule","Text","Stack","StateTransition","ValueInTransition","Annotations","StateVisualization","useRuleHistoryRecordsForTheInstance","labelsForTheInstance","stateHistory","timestamps","filterMatchers","filteredGroupedLines","useGetRuleHistoryQuery","stateHistoryApi","isLoading","isError","LIMIT_EVENTS","value","frameSubset","frameTimeRange","numberOfTransitions","NumberTransitions","LogTimelineViewer","EventState","Icon","styles","getStyles","annotations","name","capitalizedName","MetaText","values","transitions","ruleHistoryToRecords","filterMatch","PAGE_SIZE","HistoryEventsList","valueInLabelFilter","valueInStateToFilter","valueInStateFromFilter","from","to","historyRecordsNotSorted","historyRecords","a","b","maximumEventsReached","LoadingIndicator","HistoryLogEvents","visible","measureRef","width","useMeasure","LoadingBar","page","pageItems","numberOfPages","onPageChange","usePagination","ListHeader","EventRow","Pagination","setIsCollapsed","onLabelClick","label","Timestamp","EventTransition","AlertRuleName","AlertLabels","pathname","search","returnTo","alertRuleName","ruleViewUrl","Tooltip","previous","current","StateIcon","iconName","iconColor","tooltipContent","labelText","showLabel","state","type","toolTip","baseState","reason","stateConfig","onStateClick","config","e","formattedDate","HistoryEventsListObject","HistoryEventsListObjectRenderer","model","labelsFiltersVariable","stateToFilterVariable","stateFromFilterVariable","valueInfilterTextBox","newFilterToAdd","finalFilter","historyDataSourceUid","historyDataSourcePluginId","alertStateHistoryDatasource","useRegisterHistoryRuntimeDataSource","ds","HistoryAPIDatasource","pluginId","uid","request","historyResult","getHistory","CentralAlertHistoryScene","labelsFilterVariable","transitionsToFilterVariable","transitionsFromFilterVariable","scene","LabelFilter","FilterInfo","ClearFilterButton","getEventsSceneObject","alertStateHistoryDataSource","getEventsScenesFlexItem","getSceneQuery","datasource","valueInLabelsFilter","valueInTransitionsFilter","valueInTransitionsFromFilter","onClearFilter","Button","HistoryPage","AlertingPageWrapper"],"sourceRoot":""}