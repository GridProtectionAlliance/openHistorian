"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1743],{89062:(ne,C,a)=>{a.d(C,{y:()=>S});var e=a(74848),l=a(96540),u=a(41053),y=a(10096),j=a(31678),v=a(37425),x=a(85927);const S=({basicRole:c,roles:L,userId:b,orgId:p,onBasicRoleChange:E,roleOptions:M,disabled:V,basicRoleDisabled:Y,basicRoleDisabledMessage:I,apply:T=!1,onApplyRoles:N,pendingRoles:f,maxWidth:Z,width:X,isLoading:k})=>{const[{loading:_,value:K=L||[]},D]=(0,u.A)(async()=>{try{if(L)return L;if(T&&f?.length)return f;if(y.TP.hasPermission(j.AccessControlAction.ActionUserRolesList)&&b>0)return await(0,x.Xh)(b,p)}catch{console.error("Error loading options")}return[]},[p,b,f,L]);(0,l.useEffect)(()=>{p&&D()},[D,p]);const $=async F=>{T?N&&N(F,b,p):(await(0,x.eA)(F,b,p),await D())},z=y.TP.hasPermission(j.AccessControlAction.ActionUserRolesAdd)&&y.TP.hasPermission(j.AccessControlAction.ActionUserRolesRemove);return(0,e.jsx)(v.n,{appliedRoles:K,basicRole:c,onRolesChange:$,onBasicRoleChange:E,roleOptions:M,isLoading:_||k,disabled:V,basicRoleDisabled:Y,basicRoleDisabledMessage:I,showBasicRole:!0,apply:T,canUpdateRoles:z,maxWidth:Z,width:X})}},5133:(ne,C,a)=>{a.d(C,{r:()=>v});var e=a(74848),l=a(62625),u=a(90182);const j=Object.values(l.X).filter(x=>x!==l.X.None).map(x=>({label:x,value:x}));function v({value:x,onChange:S,"aria-label":c,inputId:L,autoFocus:b,...p}){return(0,e.jsx)(u.l6,{inputId:L,value:x,options:j,onChange:E=>S(E.value??l.X.None),placeholder:"Choose role...","aria-label":c,autoFocus:b,...p})}},21807:(ne,C,a)=>{a.r(C),a.d(C,{default:()=>js});var e=a(74848),l=a(32196),u=a(96540),y=a(13544),j=a(32264),v=a(40675),x=a(40845),S=a(63021),c=a(8484),L=a(16233),b=a(72254),p=a(21780),E=a(31678),M=a(71468),V=a(36663),Y=a(42418),I=a(10096),T=a(69546),N=a(10534),f=a(55852),Z=a(47259);const X={revokeInvite:Z.eb},k=(0,M.connect)(null,X);class _ extends u.PureComponent{render(){const{invitee:n,revokeInvite:t}=this.props;return(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:n.email}),(0,e.jsx)("td",{children:n.name}),(0,e.jsxs)("td",{className:"text-right",children:[(0,e.jsx)(N.b,{icon:"copy",variant:"secondary",size:"sm",getText:()=>n.url,children:"Copy Invite"}),"\xA0"]}),(0,e.jsx)("td",{children:(0,e.jsx)(f.$n,{variant:"destructive",size:"sm",icon:"times",onClick:()=>t(n.code),"aria-label":"Revoke Invite"})})]})}}const K=k(_);class D extends u.PureComponent{render(){const{invitees:n}=this.props;return(0,e.jsxs)("table",{className:"filter-table form-inline",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:"Email"}),(0,e.jsx)("th",{children:"Name"}),(0,e.jsx)("th",{}),(0,e.jsx)("th",{style:{width:"34px"}})]})}),(0,e.jsx)("tbody",{"data-testid":"InviteesTable-body",children:n.map((t,o)=>(0,e.jsx)(K,{invitee:t},`${t.id}-${o}`))})]})}}var $=a(25508),z=a(40823);const{selectAll:F,selectById:Ae,selectTotal:oe}=z.Tp,ie=(s,n)=>n,le=(0,$.Mz)([F,ie],(s,n)=>{const t=new RegExp(n,"i");return s.filter(g=>t.test(g.name)||t.test(g.email))});var te=a(14186),W=a(67647),Q=a(94354),q=a(2913),ce=a(2543),H=a(17172),i=a(80714),m=a(87617);function O(){return async(s,n)=>{try{s((0,m.Cj)());const{perPage:t,page:o,searchQuery:g,sort:h}=n().users,P=await(0,H.AI)().get("/api/org/users/search",(0,i.F)({perpage:t,page:o,query:g,sort:h}));if(I.TP.licensedAccessControlEnabled()&&I.TP.hasPermission(E.AccessControlAction.ActionUserRolesList)){s((0,m.dJ)());const d=I.TP.user.orgId,U=P?.orgUsers.map(A=>A.userId),r=await(0,H.AI)().post("/api/access-control/users/roles/search",{userIds:U,orgId:d});P.orgUsers.forEach(A=>{A.roles=r?r[A.userId]||[]:[]}),s((0,m.jE)())}s((0,m.Y_)(P))}catch{(0,m.g4)()}}}const de=(0,ce.debounce)(s=>s(O()),300);function w(s){return async n=>{await(0,H.AI)().patch(`/api/org/users/${s.userId}`,{role:s.role}),n(O())}}function ge(s){return async n=>{await(0,H.AI)().delete(`/api/org/users/${s}`),n(O())}}function he(s){return async n=>{n((0,m.EC)(s)),n(O())}}function Be({sortBy:s}){const n=s.length?`${s[0].id}-${s[0].desc?"desc":"asc"}`:void 0;return async t=>{t((0,m.$u)(n)),t(O())}}function Se(s){return async n=>{n((0,m.t_)(s)),de(n)}}const Ne=s=>{const n=new RegExp(s.searchQuery,"i");return s.users.filter(t=>n.test(t.login)||n.test(t.email)||n.test(t.name))},ue=s=>s.searchQuery;function Ke(s){return{searchQuery:ue(s.users),pendingInvitesCount:oe(s.invites),externalUserMngLinkName:s.users.externalUserMngLinkName,externalUserMngLinkUrl:s.users.externalUserMngLinkUrl}}const We={changeSearchQuery:Se},$e=(0,M.connect)(Ke,We)(({externalUserMngLinkName:s,externalUserMngLinkUrl:n,searchQuery:t,pendingInvitesCount:o,changeSearchQuery:g,onShowInvites:h,showInvites:P})=>{const d=[{label:"Users",value:"users"},{label:`Pending Invites (${o})`,value:"invites"}],r=I.TP.hasPermission(E.AccessControlAction.OrgUsersAdd)&&!(q.Ay.disableLoginForm&&q.Ay.externalUserMngInfo);return(0,e.jsxs)("div",{className:"page-action-bar","data-testid":"users-action-bar",children:[(0,e.jsx)(te.I,{grow:!0,children:(0,e.jsx)(W.Z,{value:t,onChange:g,placeholder:"Search user by login, email or name"})}),o>0&&(0,e.jsx)("div",{style:{marginLeft:"1rem"},children:(0,e.jsx)(Q.z,{value:P?"invites":"users",options:d,onChange:h})}),r&&(0,e.jsx)(f.z9,{href:"org/users/invite",children:"Invite"}),n&&(0,e.jsx)(f.z9,{href:n,target:"_blank",rel:"noopener",children:s})]})});function ze(s){const n=ue(s.users);return{users:Ne(s.users),searchQuery:ue(s.users),page:s.users.page,totalPages:s.users.totalPages,perPage:s.users.perPage,invitees:le(s.invites,n),externalUserMngInfo:s.users.externalUserMngInfo,isLoading:s.users.isLoading,rolesLoading:s.users.rolesLoading}}const Fe={loadUsers:O,fetchInvitees:Z.G7,changePage:he,changeSort:Be,updateUser:w,removeUser:ge},me=(0,M.connect)(ze,Fe)(({users:s,page:n,totalPages:t,invitees:o,externalUserMngInfo:g,isLoading:h,rolesLoading:P,loadUsers:d,fetchInvitees:U,changePage:r,updateUser:A,removeUser:ae,changeSort:J})=>{const[B,je]=(0,u.useState)(!1),Re=g?(0,V.G)(g):"";(0,u.useEffect)(()=>{d(),U()},[U,d]);const As=(pe,Ds)=>{A({...Ds,role:pe})},bs=pe=>ae(pe.userId),fs=()=>{je(!B)},ys=()=>{d()},Us=()=>B?(0,e.jsx)(D,{invitees:o}):(0,e.jsx)(T.b,{users:s,orgId:I.TP.user.orgId,rolesLoading:P,onRoleChange:As,onRemoveUser:bs,onUserRolesChange:ys,fetchData:J,changePage:r,page:n,totalPages:t});return(0,e.jsxs)(p.YW.Contents,{isLoading:!h,children:[(0,e.jsx)($e,{onShowInvites:fs,showInvites:B}),Re&&(0,e.jsx)(Y.F,{severity:"info",title:"",children:(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:Re}})}),h&&Us()]})});function Is(){return jsx(Page,{navId:"users",children:jsx(me,{})})}var Qe=a(69529),be=a(12942),we=a(72109),G=a(67061),ee=a(56034),re=a(14578),fe=a(94753),ye=a(78369),Ue=a(48840),De=a(19384),Ge=a(46334),Le=a(90613);const Ye=({units:s,icon:n})=>s?.length?s.length>1?(0,e.jsx)(ee.m,{placement:"top",content:(0,e.jsx)(G.B,{direction:"column",children:s?.map(t=>(0,e.jsx)("span",{children:t.name},t.name))}),children:(0,e.jsx)(xe,{icon:n,children:s.length})}):(0,e.jsx)(xe,{icon:n,children:s[0].name}):null,xe=(0,u.forwardRef)(({children:s,icon:n},t)=>(0,e.jsxs)(Le.a,{ref:t,display:"flex",alignItems:"center",marginRight:1,children:[(0,e.jsx)(re.I,{name:n})," ",(0,e.jsx)(Le.a,{marginLeft:1,children:s})]}));xe.displayName="TooltipContent";const Ze=({users:s,showPaging:n,totalPages:t,onChangePage:o,currentPage:g,fetchData:h})=>{const P=(0,u.useMemo)(()=>s.some(r=>r.licensedRole),[s]),d=(0,u.useMemo)(()=>s.some(r=>r.orgs),[s]),U=(0,u.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:r}})=>r&&(0,e.jsx)(be.e,{src:r,alt:"User avatar"})},{id:"login",header:"Login",cell:({row:{original:r}})=>(0,e.jsx)(we.Y,{color:"primary",inline:!1,href:`/admin/users/edit/${r.id}`,title:"Edit user",children:r.login}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:r}})=>r,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:r}})=>r,sortType:"string"},...d?[{id:"orgs",header:"Belongs to",cell:({cell:{value:r,row:A}})=>(0,e.jsxs)(G.B,{alignItems:"center",children:[(0,e.jsx)(Ye,{units:r,icon:"building"}),A.original.isAdmin&&(0,e.jsx)(ee.m,{placement:"top",content:"Grafana Admin",children:(0,e.jsx)(re.I,{name:"shield"})})]})}]:[],...P?[{id:"licensedRole",header:"Licensed role",cell:({cell:{value:r}})=>r==="None"?(0,e.jsxs)(fe.E,{color:"disabled",children:["Not assigned"," ",(0,e.jsx)(ee.m,{placement:"top",content:"A licensed role will be assigned when this user signs in",children:(0,e.jsx)(re.I,{name:"question-circle"})})]}):r}]:[],{id:"lastSeenAtAge",header:"Last active",headerTooltip:{content:"Time since user was seen using Grafana",iconName:"question-circle"},cell:({cell:{value:r}})=>(0,e.jsx)(e.Fragment,{children:r&&(0,e.jsx)(e.Fragment,{children:r==="10 years"?(0,e.jsx)(fe.E,{color:"disabled",children:"Never"}):r})}),sortType:(r,A)=>new Date(r.original.lastSeenAt).getTime()-new Date(A.original.lastSeenAt).getTime()},{id:"authLabels",header:"Origin",cell:({cell:{value:r}})=>(0,e.jsx)(e.Fragment,{children:Array.isArray(r)&&r.length>0&&(0,e.jsx)(Ge.E,{label:r[0],removeIcon:!1,count:0})})},{id:"isDisabled",header:"",cell:({cell:{value:r}})=>(0,e.jsx)(e.Fragment,{children:r&&(0,e.jsx)(ye.v,{colorIndex:9,name:"Disabled"})})},{id:"edit",header:"",cell:({row:{original:r}})=>(0,e.jsx)(f.z9,{variant:"secondary",size:"sm",icon:"pen",href:`admin/users/edit/${r.id}`,"aria-label":`Edit user ${r.name}`,tooltip:"Edit user"})}],[P,d]);return(0,e.jsxs)(G.B,{direction:"column",gap:2,children:[(0,e.jsx)(Ue.j,{columns:U,data:s,getRowId:r=>String(r.id),fetchData:h}),n&&(0,e.jsx)(G.B,{justifyContent:"flex-end",children:(0,e.jsx)(De.d,{numberOfPages:t,currentPage:g,onNavigate:o})})]})};var R=a(57334);const Ee=[],Ms=s=>{Ee.push(s)},Xe=y.Tp.pages.UserListPage.UserListAdminPage,He={fetchUsers:R.hU,changeQuery:R.nM,changePage:R.yd,changeFilter:R.$u,changeSort:R.Vk},Je=s=>({users:s.userListAdmin.users,query:s.userListAdmin.query,showPaging:s.userListAdmin.showPaging,totalPages:s.userListAdmin.totalPages,page:s.userListAdmin.page,filters:s.userListAdmin.filters,isLoading:s.userListAdmin.isLoading}),Te=(0,M.connect)(Je,He)(({fetchUsers:s,query:n,changeQuery:t,users:o,showPaging:g,changeFilter:h,filters:P,totalPages:d,page:U,changePage:r,changeSort:A,isLoading:ae})=>{const J=(0,x.of)(Ve);return(0,u.useEffect)(()=>{s()},[s]),(0,e.jsxs)(p.YW.Contents,{children:[(0,e.jsx)("div",{className:J.actionBar,"data-testid":Xe.container,children:(0,e.jsxs)("div",{className:J.row,children:[(0,e.jsx)(W.Z,{placeholder:"Search user by login, email, or name.",autoFocus:!0,value:n,onChange:t}),(0,e.jsx)(Q.z,{options:[{label:"All users",value:!1},{label:"Active last 30 days",value:!0}],onChange:B=>h({name:"activeLast30Days",value:B}),value:P.find(B=>B.name==="activeLast30Days")?.value,className:J.filter}),Ee.map((B,je)=>(0,e.jsx)(B,{filters:P,onChange:h,className:J.filter},je)),I.TP.hasPermission(E.AccessControlAction.UsersCreate)&&(0,e.jsx)(f.z9,{href:"admin/users/create",variant:"primary",children:"New user"})]})}),!ae&&o.length===0?(0,e.jsx)(Qe.p,{message:(0,c.t)("users.empty-state.message","No users found"),variant:"not-found"}):(0,e.jsx)(Ze,{users:o,showPaging:g,totalPages:d,onChangePage:r,currentPage:U,fetchData:A})]})});function Bs(){return jsx(Page,{navId:"global-users",children:jsx(Te,{})})}const Ve=s=>({filter:(0,l.css)({margin:s.spacing(0,1),[s.breakpoints.down("sm")]:{margin:0}}),actionBar:(0,l.css)({marginBottom:s.spacing(2),display:"flex",alignItems:"flex-start",gap:s.spacing(2),[s.breakpoints.down("sm")]:{flexWrap:"wrap"}}),row:(0,l.css)({display:"flex",alignItems:"flex-start",textAlign:"left",marginBottom:s.spacing(.5),flexGrow:1,[s.breakpoints.down("sm")]:{flexWrap:"wrap",gap:s.spacing(2),width:"100%"}})}),Ss=null;var ke=a(39938),_e=a(23088);const qe=s=>{if(!s.includes(" "))return{browser:s,computer:""};const n=s.split(" ");return{browser:n[0],computer:n[1]}},Ce=(s,n)=>s.length>n?s.substring(0,n)+"...":s,es=({value:s})=>{const n=qe(s);return(0,e.jsx)(ee.m,{theme:"info-alt",content:s,placement:"top-end",interactive:!0,children:(0,e.jsxs)("span",{children:[Ce(n.browser,10),Ce(n.computer,10)]})})},ss=({devices:s,showPaging:n,totalPages:t,onChangePage:o,currentPage:g,fetchData:h})=>{const P=(0,u.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:d}})=>d&&(0,e.jsx)(be.e,{src:d,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:d}})=>"Anonymous"},{id:"userAgent",header:"User Agent",cell:({cell:{value:d}})=>(0,e.jsx)(es,{value:d}),sortType:"string"},{id:"updatedAt",header:"Last active",cell:({cell:{value:d}})=>d,sortType:(d,U)=>new Date(d.original.updatedAt).getTime()-new Date(U.original.updatedAt).getTime()},{id:"clientIp",header:"Origin IP (address)",cell:({cell:{value:d}})=>d&&(0,e.jsx)(ke.E,{text:d,color:"orange"})}],[]);return(0,e.jsxs)(G.B,{direction:"column",gap:2,children:[(0,e.jsx)(Ue.j,{columns:P,data:s,getRowId:d=>d.deviceId,fetchData:h}),n&&(0,e.jsx)(G.B,{justifyContent:"flex-end",children:(0,e.jsx)(De.d,{numberOfPages:t,currentPage:g,onNavigate:o})}),s.length===0&&(0,e.jsx)(_e.Z,{children:(0,e.jsx)("span",{children:"No anonymous users found."})})]})},as={fetchUsersAnonymousDevices:R.xq,changeAnonUserSort:R.A5,changeAnonPage:R.is,changeAnonQuery:R.Bc},ns=s=>({devices:s.userListAnonymousDevices.devices,query:s.userListAnonymousDevices.query,showPaging:s.userListAnonymousDevices.showPaging,totalPages:s.userListAnonymousDevices.totalPages,page:s.userListAnonymousDevices.page,filters:s.userListAnonymousDevices.filters}),ts=y.Tp.pages.UserListPage.UserListAdminPage,Ie=(0,M.connect)(ns,as)(({devices:s,fetchUsersAnonymousDevices:n,query:t,changeAnonQuery:o,filters:g,showPaging:h,totalPages:P,page:d,changeAnonPage:U,changeAnonUserSort:r})=>{const A=(0,x.of)(rs);return(0,u.useEffect)(()=>{n()},[n]),(0,e.jsxs)(p.YW.Contents,{children:[(0,e.jsx)("div",{className:A.actionBar,"data-testid":ts.container,children:(0,e.jsxs)("div",{className:A.row,children:[(0,e.jsx)(W.Z,{placeholder:"Search devices by IP address.",autoFocus:!0,value:t,onChange:o}),(0,e.jsx)(Q.z,{options:[{label:"Active last 30 days",value:!0}],value:g.find(ae=>ae.name==="activeLast30Days")?.value,className:A.filter})]})}),(0,e.jsx)(ss,{devices:s,showPaging:h,totalPages:P,onChangePage:U,currentPage:d,fetchData:r})]})});function Ws(){return jsx(Page,{navId:"anonymous-users",children:jsx(Ie,{})})}const rs=s=>({filter:(0,l.css)({margin:s.spacing(0,1),[s.breakpoints.down("sm")]:{margin:0}}),actionBar:(0,l.css)({marginBottom:s.spacing(2),display:"flex",alignItems:"flex-start",gap:s.spacing(2),[s.breakpoints.down("sm")]:{flexWrap:"wrap"}}),row:(0,l.css)({display:"flex",alignItems:"flex-start",textAlign:"left",marginBottom:s.spacing(.5),flexGrow:1,[s.breakpoints.down("sm")]:{flexWrap:"wrap",gap:s.spacing(2),width:"100%"}})}),$s=null;var ve=a(72686),Pe=a(37390),os=a(39558),Me=a(71678);const is=y.Tp.pages.UserListPage.UsersListPublicDashboardsPage.DashboardsListModal,ls=({email:s,onDismiss:n})=>{const t=(0,x.of)(ds),{data:o,isLoading:g}=(0,ve.kd)(s);return(0,e.jsx)(Pe.a,{className:t.modal,isOpen:!0,title:j.$.featureToggles.newDashboardSharingComponent?(0,c.t)("public-dashboard-users-access-list.modal.shared-dashboard-modal-title","Shared dashboards"):(0,c.t)("public-dashboard-users-access-list.modal.dashboard-modal-title","Public dashboards"),onDismiss:n,children:g?(0,e.jsx)("div",{className:t.loading,children:(0,e.jsx)(os._,{text:(0,c.t)("public-dashboard-users-access-list.dashboard-modal.loading-text","Loading...")})}):o?.map(h=>(0,e.jsxs)("div",{className:t.listItem,"data-testid":is.listItem(h.dashboardUid),children:[(0,e.jsx)("p",{className:t.dashboardTitle,children:h.dashboardTitle}),(0,e.jsxs)("div",{className:t.urlsContainer,children:[(0,e.jsx)("a",{rel:"noreferrer",target:"_blank",className:(0,l.cx)("external-link",t.url),href:(0,b.mL)(h.publicDashboardAccessToken),onClick:n,children:j.$.featureToggles.newDashboardSharingComponent?(0,e.jsx)(c.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.external-link",children:"External link"}):(0,e.jsx)(c.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.public-dashboard-link",children:"Public dashboard URL"})}),(0,e.jsx)("span",{className:t.urlsDivider,children:"\u2022"}),(0,e.jsx)("a",{className:(0,l.cx)("external-link",t.url),href:(0,b.gN)(h.dashboardUid,h.slug),onClick:n,children:j.$.featureToggles.newDashboardSharingComponent?(0,e.jsx)(c.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.sharing-setting",children:"Sharing settings"}):(0,e.jsx)(c.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.public-dashboard-setting",children:"Public dashboard settings"})})]}),(0,e.jsx)("hr",{className:t.divider})]},h.dashboardUid))})},cs=({email:s})=>{const n=(0,c.t)("public-dashboard-users-access-list.dashboard-modal.open-dashboard-list-text","Open dashboards list");return(0,e.jsx)(Me.$s,{children:({showModal:t,hideModal:o})=>(0,e.jsx)(f.$n,{variant:"secondary",size:"sm",icon:"question-circle",title:n,"aria-label":n,onClick:()=>t(ls,{email:s,onDismiss:o})})})},ds=s=>({modal:(0,l.css)`
    width: 590px;
  `,loading:(0,l.css)`
    display: flex;
    justify-content: center;
  `,listItem:(0,l.css)`
    display: flex;
    flex-direction: column;
    gap: ${s.spacing(.5)};
  `,divider:(0,l.css)`
    margin: ${s.spacing(1.5,0)};
    color: ${s.colors.text.secondary};
  `,urlsContainer:(0,l.css)`
    display: flex;
    gap: ${s.spacing(.5)};

    ${s.breakpoints.down("sm")} {
      flex-direction: column;
    }
  `,urlsDivider:(0,l.css)`
    color: ${s.colors.text.secondary};
    ${s.breakpoints.down("sm")} {
      display: none;
    }
  `,dashboardTitle:(0,l.css)`
    font-size: ${s.typography.body.fontSize};
    font-weight: ${s.typography.fontWeightBold};
    margin-bottom: 0;
  `,url:(0,l.css)`
    font-size: ${s.typography.body.fontSize};
  `}),gs=({user:s,hideModal:n})=>{const[t]=(0,ve.g9)(),o=(0,x.of)(us),g=()=>{t({email:s.email}),n()};return(0,e.jsxs)(Pe.a,{className:o.modal,isOpen:!0,title:(0,c.t)("public-dashboard-users-access-list.delete-user-modal.revoke-access-title","Revoke access"),onDismiss:n,children:[(0,e.jsx)("p",{className:o.description,children:(0,e.jsxs)(c.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.revoke-user-access-modal-desc-line1",children:["Are you sure you want to revoke access for ",{email:s.email},"?"]})}),(0,e.jsx)("p",{className:o.description,children:j.$.featureToggles.newDashboardSharingComponent?(0,e.jsxs)(c.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-shared-dashboards-modal.revoke-user-access-modal-desc-line2",shouldUnescape:!0,children:["This action will immediately revoke ",{email:s.email},"'s access to all shared dashboards."]}):(0,e.jsxs)(c.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.revoke-user-access-modal-desc-line2",shouldUnescape:!0,children:["This action will immediately revoke ",{email:s.email},"'s access to all public dashboards."]})}),(0,e.jsxs)(Pe.a.ButtonRow,{children:[(0,e.jsx)(f.$n,{type:"button",variant:"secondary",onClick:n,fill:"outline",children:(0,e.jsx)(c.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.delete-user-cancel-button",children:"Cancel"})}),(0,e.jsx)(f.$n,{type:"button",variant:"destructive",onClick:g,children:(0,e.jsx)(c.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.delete-user-revoke-access-button",children:"Revoke access"})})]})]})},hs=({user:s})=>{const n=(0,c.t)("public-dashboard-users-access-list.delete-user-modal.delete-user-button-text","Delete user");return(0,e.jsx)(Me.$s,{children:({showModal:t,hideModal:o})=>(0,e.jsx)(f.$n,{size:"sm",variant:"destructive",onClick:()=>t(gs,{user:s,hideModal:o}),icon:"times","aria-label":n,title:n})})},us=s=>({modal:(0,l.css)({width:"500px"}),description:(0,l.css)({fontSize:s.typography.body.fontSize,margin:0})}),ms=y.Tp.pages.UserListPage.publicDashboards,xs=()=>{const{data:s,isLoading:n}=(0,ve.AK)();return(0,e.jsx)(p.YW.Contents,{isLoading:n,children:(0,e.jsxs)("table",{className:"filter-table form-inline","data-testid":ms.container,children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(c.x6,{i18nKey:"public-dashboard-users-access-list.table-header.email-label",children:"Email"})}),(0,e.jsxs)("th",{children:[(0,e.jsx)("span",{children:(0,e.jsx)(c.x6,{i18nKey:"public-dashboard-users-access-list.table-header.activated-label",children:"Activated"})}),(0,e.jsx)(ee.m,{placement:"top",content:(0,c.t)("public-dashboard-users-access-list.table-header.activated-tooltip","Earliest time user has been an active user to a dashboard"),children:(0,e.jsx)(re.I,{name:"info-circle"})})]}),(0,e.jsx)("th",{children:(0,e.jsx)(c.x6,{i18nKey:"public-dashboard-users-access-list.table-header.last-active-label",children:"Last active"})}),(0,e.jsx)("th",{children:(0,e.jsx)(c.x6,{i18nKey:"public-dashboard-users-access-list.table-header.origin-label",children:"Origin"})}),(0,e.jsx)("th",{children:(0,e.jsx)(c.x6,{i18nKey:"public-dashboard-users-access-list.table-header.role-label",children:"Role"})}),(0,e.jsx)("th",{})]})}),(0,e.jsx)("tbody",{children:s?.map(t=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"max-width-10",children:(0,e.jsx)("span",{className:"ellipsis",title:t.email,children:t.email})}),(0,e.jsx)("td",{className:"max-width-10",children:t.firstSeenAtAge}),(0,e.jsx)("td",{className:"max-width-10",children:t.lastSeenAtAge}),(0,e.jsx)("td",{className:"max-width-10",children:(0,e.jsxs)(G.B,{gap:2,children:[(0,e.jsxs)("span",{children:[t.totalDashboards," dashboard(s)"]}),(0,e.jsx)(cs,{email:t.email})]})}),(0,e.jsx)("td",{className:"max-width-10",children:(0,e.jsx)(ye.v,{name:"Viewer",colorIndex:19})}),(0,e.jsx)("td",{className:"text-right",children:(0,e.jsx)(hs,{user:t})})]},t.email))})]})})};var vs=(s=>(s.ADMIN="admin",s.ORG="org",s.PUBLIC_DASHBOARDS="public-dashboards",s.ANON="anon",s))(vs||{});const se=y.Tp.pages.UserListPage,Oe=({view:s,setView:n})=>(0,e.jsx)(v.o,{label:j.$.featureToggles.newDashboardSharingComponent?(0,c.t)("users-access-list.tabs.shared-dashboard-users-tab-title","Shared dashboard users"):(0,c.t)("users-access-list.tabs.public-dashboard-users-tab-title","Public dashboard users"),active:s==="public-dashboards",onChangeTab:()=>n("public-dashboards"),"data-testid":se.tabs.publicDashboardsUsers}),Ps={admin:(0,e.jsx)(Te,{}),org:(0,e.jsx)(me,{}),"public-dashboards":(0,e.jsx)(xs,{}),anon:(0,e.jsx)(Ie,{})};function js(){const s=(0,x.of)(ps),n=L.TP.hasPermission(E.AccessControlAction.UsersRead),t=L.TP.hasPermission(E.AccessControlAction.OrgUsersRead),[o,g]=(0,u.useState)(()=>n?"admin":t?"org":null),h=t&&n;return(0,e.jsxs)(p.YW,{navId:"global-users",children:[h?(0,e.jsxs)(S.U,{className:s.tabsMargin,children:[(0,e.jsx)(v.o,{label:"All users",active:o==="admin",onChangeTab:()=>g("admin"),"data-testid":se.tabs.allUsers}),(0,e.jsx)(v.o,{label:"Organization users",active:o==="org",onChangeTab:()=>g("org"),"data-testid":se.tabs.orgUsers}),j.$.anonymousEnabled&&(0,e.jsx)(v.o,{label:"Anonymous devices",active:o==="anon",onChangeTab:()=>g("anon"),"data-testid":se.tabs.anonUserDevices}),(0,b.AY)()&&(0,e.jsx)(Oe,{view:o,setView:g})]}):(0,b.AY)()&&(0,e.jsxs)(S.U,{className:s.tabsMargin,children:[(0,e.jsx)(v.o,{label:"Users",active:o==="org",onChangeTab:()=>g("org"),"data-testid":se.tabs.users}),(0,e.jsx)(Oe,{view:o,setView:g})]}),o?Ps[o]:(0,e.jsx)(me,{})]})}const ps=s=>({tabsMargin:(0,l.css)({marginBottom:s.spacing(3)})})},69546:(ne,C,a)=>{a.d(C,{b:()=>_});var e=a(74848),l=a(96540),u=a(13544),y=a(12942),j=a(94753),v=a(90613),x=a(56034),S=a(14578),c=a(78369),L=a(55852),b=a(67061),p=a(48840),E=a(19384),M=a(96374),V=a(89062),Y=a(85927),I=a(46334),T=a(10096),N=a(31678),f=a(5133);const Z=`This user's role is not editable because it is synchronized from your auth provider.
Refer to the Grafana authentication docs for details.`,X=K=>{const D=K?.isExternallySynced;return!T.TP.hasPermissionInMetadata(N.AccessControlAction.OrgUsersWrite,K)||D},k=u.Tp.pages.UserListPage.UsersListPage,_=({users:K,orgId:D,onRoleChange:$,onUserRolesChange:z,onRemoveUser:F,fetchData:Ae,changePage:oe,page:ie,totalPages:le,rolesLoading:te})=>{const[W,Q]=(0,l.useState)(null),[q,ce]=(0,l.useState)([]);(0,l.useEffect)(()=>{async function i(){try{if(T.TP.hasPermission(N.AccessControlAction.ActionRolesList)){let m=await(0,Y.RL)(D);ce(m)}}catch{console.error("Error loading options")}}T.TP.licensedAccessControlEnabled()&&i()},[D]);const H=(0,l.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:i}})=>i&&(0,e.jsx)(y.e,{src:i,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:i}})=>(0,e.jsx)("div",{children:i}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:i}})=>i,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:i}})=>i,sortType:"string"},{id:"lastSeenAtAge",header:"Last active",cell:({cell:{value:i}})=>(0,e.jsx)(e.Fragment,{children:i&&(0,e.jsx)(e.Fragment,{children:i==="10 years"?(0,e.jsx)(j.E,{color:"disabled",children:"Never"}):i})}),sortType:(i,m)=>new Date(i.original.lastSeenAt).getTime()-new Date(m.original.lastSeenAt).getTime()},{id:"role",header:"Role",cell:({cell:{value:i},row:{original:m}})=>{const O=X(m),de=async(w,ge,he)=>{await(0,Y.eA)(w,ge,he),z&&z()};return T.TP.licensedAccessControlEnabled()?(0,e.jsx)(V.y,{userId:m.userId,roles:m.roles,apply:!0,onApplyRoles:de,isLoading:te,orgId:D,roleOptions:q,basicRole:i,onBasicRoleChange:w=>$(w,m),basicRoleDisabled:O,basicRoleDisabledMessage:Z,width:40}):(0,e.jsx)(f.r,{"aria-label":"Role",value:i,disabled:O,onChange:w=>$(w,m)})}},{id:"info",header:"",cell:({row:{original:i}})=>X(i)&&(0,e.jsx)(v.a,{display:"flex",alignItems:"center",marginLeft:1,children:(0,e.jsx)(x.m,{interactive:!0,content:(0,e.jsxs)("div",{children:["This user's role is not editable because it is synchronized from your auth provider. Refer to the\xA0",(0,e.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/administration/user-management/manage-org-users/#change-a-users-organization-permissions",rel:"noreferrer",target:"_blank",children:"Grafana authentication docs"}),"\xA0for details."]}),children:(0,e.jsx)(S.I,{name:"question-circle"})})})},{id:"authLabels",header:"Origin",cell:({cell:{value:i}})=>(0,e.jsx)(e.Fragment,{children:Array.isArray(i)&&i.length>0&&(0,e.jsx)(I.E,{label:i[0],removeIcon:!1,count:0})})},{id:"isDisabled",header:"",cell:({cell:{value:i}})=>(0,e.jsx)(e.Fragment,{children:i&&(0,e.jsx)(c.v,{colorIndex:9,name:"Disabled"})})},{id:"delete",header:"",cell:({row:{original:i}})=>T.TP.hasPermissionInMetadata(N.AccessControlAction.OrgUsersRemove,i)&&(0,e.jsx)(L.$n,{size:"sm",variant:"destructive",onClick:()=>{Q(i)},icon:"times","aria-label":`Delete user ${i.name}`})}],[te,D,q,z,$]);return(0,e.jsxs)(b.B,{direction:"column",gap:2,"data-testid":k.container,children:[(0,e.jsx)(p.j,{columns:H,data:K,getRowId:i=>String(i.userId),fetchData:Ae}),(0,e.jsx)(b.B,{justifyContent:"flex-end",children:(0,e.jsx)(E.d,{onNavigate:oe,currentPage:ie,numberOfPages:le,hideWhenSinglePage:!0})}),!!W&&(0,e.jsx)(M.u,{body:`Are you sure you want to delete user ${W?.login}?`,confirmText:"Delete",title:"Delete",onDismiss:()=>{Q(null)},isOpen:!0,onConfirm:()=>{W&&(F(W),Q(null))}})]})}},23088:(ne,C,a)=>{a.d(C,{Z:()=>y});var e=a(74848),l=a(32196),u=a(40845);const y=({children:v})=>{const x=(0,u.of)(j);return(0,e.jsx)("div",{className:x.container,children:v})},j=v=>({container:(0,l.css)({backgroundColor:v.colors.background.secondary,color:v.colors.text.secondary,padding:v.spacing(4),textAlign:"center"})})}}]);

//# sourceMappingURL=UserListPage.f184594c8b7ac2f7f149.js.map