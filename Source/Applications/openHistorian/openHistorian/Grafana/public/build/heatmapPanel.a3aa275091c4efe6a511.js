"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6987],{81952:(e,t,a)=>{a.d(t,{q:()=>r});var l=a(36636),n=a(68404),i=a(3490),o=a(45916);const r=e=>{let{colorPalette:t,min:a,max:l,display:r,hoverValue:u,useStopsPercentage:c}=e;const[m,p]=(0,n.useState)([]),[h,v]=(0,n.useState)({isShown:!1,value:0}),[f,g]=(0,n.useState)(null),x=(0,i.useTheme2)(),y=d(x,m);(0,n.useEffect)((()=>{p(s({colorArray:t,stops:10,useStopsPercentage:c}))}),[t,c]);return(0,n.useEffect)((()=>{g(null==u?null:function(e){if(e>1)return 100;if(e<0)return 0;return 100*e}((u-a)/(l-a)))}),[u,a,l]),(0,o.jsxs)("div",{className:y.scaleWrapper,onMouseMove:e=>{const t=e.nativeEvent.offsetX,n=e.target.offsetWidth,i=Math.floor(100*t/n+1),o=Math.floor((l-a)*i/100+a);v({isShown:!0,value:o}),g(i)},onMouseLeave:()=>{v({isShown:!1,value:0})},children:[(0,o.jsx)("div",{className:y.scaleGradient,children:r&&(h.isShown||void 0!==u)&&(0,o.jsx)("div",{className:y.followerContainer,children:(0,o.jsx)("div",{className:y.follower,style:{left:`${f}%`}})})}),r&&(0,o.jsxs)("div",{className:y.followerContainer,children:[(0,o.jsxs)("div",{className:y.legendValues,children:[(0,o.jsx)("span",{children:r(a)}),(0,o.jsx)("span",{children:r(l)})]}),null!=f&&(h.isShown||void 0!==u)&&(0,o.jsx)("span",{className:y.hoverValue,style:{left:`${f}%`},children:r(null!=u?u:h.value)})]})]})},s=e=>{let{colorArray:t,stops:a,useStopsPercentage:l=!0}=e;const n=t.length;if(l&&n<=20){const e=1/n*100;let a=0;const l=[];for(const n of t)a>0?l.push(`${n} ${a}%`):l.push(n),a+=e,l.push(`${n} ${a}%`);return l}const i=t[n-1],o=Math.ceil(n/a),r=new Set;for(let e=0;e<n;e+=o)r.add(t[e]);return r.add(i),[...r]};const d=(e,t)=>({scaleWrapper:l.css`
    width: 100%;
    font-size: 11px;
    opacity: 1;
  `,scaleGradient:l.css`
    background: linear-gradient(90deg, ${t.join()});
    height: 10px;
    pointer-events: none;
  `,legendValues:l.css`
    display: flex;
    justify-content: space-between;
    pointer-events: none;
  `,hoverValue:l.css`
    position: absolute;
    margin-top: -14px;
    padding: 3px 15px;
    background: ${e.colors.background.primary};
    transform: translateX(-50%);
  `,followerContainer:l.css`
    position: relative;
    pointer-events: none;
    white-space: nowrap;
  `,follower:l.css`
    position: absolute;
    height: 14px;
    width: 14px;
    border-radius: 50%;
    transform: translateX(-50%) translateY(-50%);
    border: 2px solid ${e.colors.text.primary};
    margin-top: 5px;
  `})},90991:(e,t,a)=>{a.r(t),a.d(t,{plugin:()=>W});var l=a(68404),n=a(43215),i=a(90923),o=a(97024),r=a(95533),s=a(81952),d=a(2798),u=a(49423),c=a(15908),m=a(36636),p=a(3490),h=a(6347),v=a(22305),f=a(95716),g=a(45916);const x=e=>2===e.hover.seriesIdx?(0,g.jsx)(f.H,{data:e.data.exemplars,rowIndex:e.hover.dataIdx}):(0,g.jsx)(y,Object.assign({},e)),y=e=>{var t,a,i,o,r,s;let{data:d,hover:m,showHistogram:h}=e;const x=m.dataIdx,y=null===(t=d.heatmap)||void 0===t?void 0:t.fields[0],b=null===(a=d.heatmap)||void 0===a?void 0:a.fields[1],w=null===(i=d.heatmap)||void 0===i?void 0:i.fields[2],k=e=>{if(null!=y&&y.display)return(0,n.formattedValueToString)(y.display(e));if((null==y?void 0:y.type)===n.FieldType.time){const t="YYYY-MM-DD HH:mm:ss",a=(0,v.h4)().getCurrent();return null==a?void 0:a.formatDate(e,t)}return`${e}`},S=null==y?void 0:y.values.toArray(),D=null==b?void 0:b.values.toArray(),V=null==w?void 0:w.values.toArray(),C=null!==(o=(0,u.d8)(d.heatmap).yOrdinalDisplay)&&void 0!==o?o:D,B=null!=b&&b.display?e=>(0,n.formattedValueToString)(b.display(e)):e=>`${e}`,M=null!==(r=x%d.yBucketCount)&&void 0!==r?r:0,L=d.yLayout===c.D.le?M-1:M,A=d.yLayout===c.D.le?M:M+1,j=null==C?void 0:C[L],O=null==C?void 0:C[A],P=null==S?void 0:S[x],R=P+d.xBucketSize,E=null==V?void 0:V[x],T=null===(s=d.heatmap)||void 0===s?void 0:s.fields.filter((e=>{var t,a;return!Boolean(null===(t=e.config.custom)||void 0===t||null===(a=t.hideFrom)||void 0===a?void 0:a.tooltip)})),H=[],F=new Set;for(const e of null!=T?T:[])if(e.getLinks){const t=e.values.get(x),a=e.display?e.display(t):{text:`${t}`,numeric:+t};e.getLinks({calculatedValue:a,valueRowIndex:x}).forEach((e=>{const t=`${e.title}/${e.href}`;F.has(t)||(H.push(e),F.add(t))}))}let I=(0,l.useRef)(null),N=Math.round(150*devicePixelRatio),G=Math.round(50*devicePixelRatio);(0,l.useEffect)((()=>{if(h){var e;let t=null===(e=I.current)||void 0===e?void 0:e.getContext("2d");if(t&&S&&D&&V){let e=x;for(;S[e--]===S[x];);e++;let a=e+d.yBucketCount,l=0,n=e;for(;n<a;){let e=V[n];l=Math.max(l,e),n++}let i=new Path2D,o=new Path2D;n=e;let r=0;for(;n<a;){let e=V[n];if(e>0){let t=e/l,a=r/(d.yBucketCount+1);(n===x?i:o).rect(Math.round(N*a),Math.round(G*(1-t)),Math.round(N/d.yBucketCount),Math.round(G*t))}n++,r++}t.clearRect(0,0,N,G),t.fillStyle="#ffffff80",t.fill(o),t.fillStyle="#ff000080",t.fill(i)}}}),[x]);const[z]=(0,l.useState)((()=>{var e,t;return(null===(e=d.heatmap)||void 0===e||null===(t=e.meta)||void 0===t?void 0:t.type)===n.DataFrameType.HeatmapCells&&!(0,u.qJ)(d.heatmap)}));if(z)return(0,g.jsx)("div",{children:(0,g.jsx)(f.H,{data:d.heatmap,rowIndex:x})});return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{children:k(P)}),(0,g.jsx)("div",{children:k(R)})]}),h&&(0,g.jsx)("canvas",{width:N,height:G,ref:I,style:{width:N+"px",height:G+"px"}}),(0,g.jsxs)("div",{children:[d.yLayout===c.D.unknown?(0,g.jsx)("div",{children:B(j)}):(0,g.jsxs)("div",{children:["Bucket: ",B(j)," - ",B(O)]}),(0,g.jsxs)("div",{children:[(0,n.getFieldDisplayName)(w,d.heatmap),": ",d.display(E)]})]}),H.length>0&&(0,g.jsx)(p.VerticalGroup,{children:H.map(((e,t)=>(0,g.jsx)(p.LinkButton,{icon:"external-link-alt",target:e.target,href:e.href,onClick:e.onClick,fill:"text",style:{width:"100%"},children:e.title},t)))})]})};var b=a(55860),w=a(39256);function k(e){const{disp:t,each:a,gap:l=1,hideLE:n=-1/0,hideGE:i=1/0,xAlign:o=1,yAlign:r=1,ySizeDivisor:s=1}=e,d=devicePixelRatio,u=l>=4?Math.round:e=>e,c=Math.round(l*d);return(e,l)=>(b.Z.orient(e,l,((d,m,p,h,v,f,g,x,y,b,w,k,S,D,V)=>{var C;let B=e.data[l];const M=B[0],L=B[1],A=B[2],j=M.length;let O,P,R=t.fill.values(e,l),E=null!==(C=t.fill.index)&&void 0!==C?C:[...new Set(R)],T=E.map((e=>new Path2D)),H=j-L.lastIndexOf(L[0]),F=j/H,I=L[1]-L[0]||v.max-v.min,N=M[H]-M[0];O=3===h.distr?Math.abs(f(M[0]*h.log,h,b,x)-f(M[0],h,b,x)):Math.abs(f(N,h,b,x)-f(0,h,b,x)),P=3===v.distr?Math.abs(g(L[0]*v.log,v,w,y)-g(L[0],v,w,y))/s:Math.abs(g(I,v,w,y)-g(0,v,w,y))/s,O=Math.max(1,u(O-c)),P=Math.max(1,u(P-c));let G=-1===o?-O:0===o?-O/2:0,z=1===r?-P:0===r?-P/2:0,Y=L.slice(0,H).map((e=>u(g(e,v,w,y)+z))),$=Array.from({length:F},((e,t)=>u(f(M[t*H],h,b,x)+G)));for(let t=0;t<j;t++)if(A[t]>n&&A[t]<i){let l=$[~~(t/H)],n=Y[t%H];D(T[R[t]],l,n,O,P),a(e,1,t,l,n,O,P)}return e.ctx.save(),e.ctx.rect(e.bbox.left,e.bbox.top,e.bbox.width,e.bbox.height),e.ctx.clip(),T.forEach(((t,a)=>{e.ctx.fillStyle=E[a],e.ctx.fill(t)})),e.ctx.restore(),null})),null)}function S(e,t){return(a,l)=>(b.Z.orient(a,l,((n,i,o,r,s,d,u,c,m,p,h,v,f,g,x)=>{[i,o]=o;let y=new Path2D,b=[y],w=[null!=t?t:"rgba(255,0,255,0.7)"];for(let t=0;t<i.length;t++){let n=o[t];n-=.5,n+=.5*(2*Math.round(Math.random())-1)*Math.random();let v=d(i[t],r,p,c),f=u(n,s,h,m),x=8,b=8;g(y,v-x/2,f-b/2,x,b),e.each(a,l,t,v-x/2,f-b/2,x,b)}a.ctx.save(),a.ctx.rect(a.bbox.left,a.bbox.top,a.bbox.width,a.bbox.height),a.ctx.clip(),b.forEach(((e,t)=>{a.ctx.fillStyle=w[t],a.ctx.fill(e)})),a.ctx.restore()})),null)}function D(e){const{disp:t,each:a,gap:l=1,hideLE:n=-1/0,hideGE:i=1/0}=e,o=devicePixelRatio,r=l>=4?Math.round:e=>e,s=Math.round(l*o);return(e,l)=>(b.Z.orient(e,l,((o,d,u,c,m,p,h,v,f,g,x,y,b,w,k)=>{var S;let D=e.data[l];const V=D[0],C=D[1],B=D[2],M=D[3],L=V.length;let A=t.fill.values(e,l),j=null!==(S=t.fill.index)&&void 0!==S?S:[...new Set(A)],O=j.map((e=>new Path2D)),P=new Map,R=new Map;for(let e=0;e<V.length;e++){let t=V[e],a=C[e],l=B[e];P.has(t)||P.set(t,r(p(t,c,g,v))),R.has(a)||R.set(a,r(h(a,m,x,f))),R.has(l)||R.set(l,r(h(l,m,x,f)))}let E=P.get(V.find((e=>e!==V[0])))-P.get(V[0]);for(let t=0;t<L;t++){if(M[t]<=n||M[t]>=i)continue;let l=V[t],o=C[t],r=B[t],d=P.get(l),u=R.get(o),c=E,m=u-R.get(r);c=Math.max(1,c-s),m=Math.max(1,m-s);let p=d,h=u;w(O[A[t]],p,h,c,m),a(e,1,t,p,h,c,m)}e.ctx.save(),e.ctx.rect(e.bbox.left,e.bbox.top,e.bbox.width,e.bbox.height),e.ctx.clip(),O.forEach(((t,a)=>{e.ctx.fillStyle=j[a],e.ctx.fill(t)})),e.ctx.restore()})),null)}const V=function(e,t,a){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1/0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;if(null==t){t=1/0;for(let a=0;a<e.length;a++)e[a]>l&&e[a]<n&&(t=Math.min(t,e[a]))}if(null==a){a=-1/0;for(let t=0;t<e.length;t++)e[t]>l&&e[t]<n&&(a=Math.max(a,e[t]))}return[t,a]},C=(e,t,a,l)=>{let n=Math.max(l-a,1),i=t.length,o=Array(e.length);for(let t=0;t<e.length;t++)o[t]=e[t]<a?0:e[t]>l?i-1:Math.min(i-1,Math.floor(i*(e[t]-a)/n));return o};function B(e,t,a){var l,i,o,r;let s=e.series;if(null==s||!s.length)return{};const d=null===(l=e.annotations)||void 0===l?void 0:l.find((e=>"exemplar"===e.name));var c;if(t.calculate)return L((0,u.xf)(s,null!==(c=t.calculation)&&void 0!==c?c:{}),d,t,a);let m;for(const e of s)switch(null===(i=e.meta)||void 0===i?void 0:i.type){case n.DataFrameType.HeatmapCells:return(0,u.qJ)(e)?L(e,d,t,a):M(e,d,t,a);case n.DataFrameType.HeatmapRows:m=e}return m||(m=s.length>1?(0,n.outerJoinDataFrames)({frames:s}):s[0]),L((0,u.Cj)(Object.assign({unit:null===(o=t.yAxis)||void 0===o?void 0:o.unit,decimals:null===(r=t.yAxis)||void 0===r?void 0:r.decimals},t.rowsFrame,{frame:m})),d,t,a)}const M=(e,t,a,l)=>{var i,o,r;if((null===(i=e.meta)||void 0===i?void 0:i.type)!==n.DataFrameType.HeatmapCells||(0,u.qJ)(e))return{warning:"Expected sparse heatmap format",heatmap:e};A(e.fields[1],a.yAxis,l);const s=A(e.fields[3],a.cellValues,l);let[d,c]=V(e.fields[3].values.toArray(),a.color.min,a.color.max,null===(o=a.filterValues)||void 0===o?void 0:o.le,null===(r=a.filterValues)||void 0===r?void 0:r.ge);return{heatmap:e,minValue:d,maxValue:c,exemplars:t,display:e=>(0,n.formattedValueToString)(s(e))}},L=(e,t,a,l)=>{var i,o,r;if((null===(i=e.meta)||void 0===i?void 0:i.type)!==n.DataFrameType.HeatmapCells)return{warning:"Expected heatmap scanlines format",heatmap:e};if(e.fields.length<2||e.length<2)return{heatmap:e};const s=(0,u.d8)(e);let d,m,p;for(const t of e.fields)switch(t.name){case"y":m=t.name;case"yMin":case"yMax":m||(m=t.name),null==s.yOrdinalDisplay&&A(t,a.yAxis,l);break;case"x":case"xMin":case"xMax":d=t.name;break;default:t.type!==n.FieldType.number||p||(p=t)}if(!m)return{warning:"Missing Y field",heatmap:e};if(!m)return{warning:"Missing X field",heatmap:e};if(!p)return{warning:"Missing value field",heatmap:e};const h=A(p,a.cellValues,l),v=e.fields[0].values.toArray(),f=e.fields[1].values.toArray(),g=v.length;let x=g-f.lastIndexOf(f[0]),y=g/x,b=f[1]-f[0],w=v[x]-v[0],[k,S]=V(p.values.toArray(),a.color.min,a.color.max,null===(o=a.filterValues)||void 0===o?void 0:o.le,null===(r=a.filterValues)||void 0===r?void 0:r.ge);return{heatmap:e,exemplars:null!=t&&t.length?t:void 0,xBucketSize:w,yBucketSize:b,xBucketCount:y,yBucketCount:x,minValue:k,maxValue:S,xLayout:"xMax"===d?c.D.le:"xMin"===d?c.D.ge:c.D.unknown,yLayout:"yMax"===m?c.D.le:"yMin"===m?c.D.ge:c.D.unknown,display:e=>(0,n.formattedValueToString)(h(e))}};function A(e,t,a){var l;if(null!=t&&null!==(l=t.unit)&&void 0!==l&&l.length||null!=(null==t?void 0:t.decimals)){const{unit:a,decimals:l}=t;e.display=void 0,e.config=Object.assign({},e.config),null!=a&&a.length&&(e.config.unit=a),null!=l&&(e.config.decimals=l)}return e.display||(e.display=(0,n.getDisplayProcessor)({field:e,theme:a})),e.display}var j=a(24314),O=a(96586),P=a(35008),R=a.n(P);Object.freeze([1,0]);let E,T;!function(e){e.Opacity="opacity",e.Scheme="scheme"}(E||(E={})),function(e){e.Linear="linear",e.Exponential="exponential"}(T||(T={}));const H={calculate:!1,color:{mode:E.Scheme,scheme:"Oranges",fill:"dark-orange",scale:T.Exponential,reverse:!1,exponent:.5,steps:64},rowsFrame:{layout:c.D.auto},yAxis:{axisPlacement:o.LB.Left},cellValues:{},showValue:o.Jp.Auto,tooltip:{show:!0,yHistogram:!1},legend:{show:!0},exemplars:{color:"rgba(255,0,255,0.7)"},filterValues:{le:1e-9},cellGap:1},F=[{name:"BrBG",invert:"always"},{name:"PiYG",invert:"always"},{name:"PRGn",invert:"always"},{name:"PuOr",invert:"always"},{name:"RdBu",invert:"always"},{name:"RdGy",invert:"always"},{name:"RdYlBu",invert:"always"},{name:"RdYlGn",invert:"always"},{name:"Spectral",invert:"always"},{name:"Blues",invert:"dark"},{name:"Greens",invert:"dark"},{name:"Greys",invert:"dark"},{name:"Oranges",invert:"dark"},{name:"Purples",invert:"dark"},{name:"Reds",invert:"dark"},{name:"Turbo",invert:"light"},{name:"Cividis",invert:"light"},{name:"Viridis",invert:"light"},{name:"Magma",invert:"light"},{name:"Inferno",invert:"light"},{name:"Plasma",invert:"light"},{name:"Warm",invert:"light"},{name:"Cool",invert:"light"},{name:"Cubehelix",invert:"light",name2:"CubehelixDefault"},{name:"BuGn",invert:"dark"},{name:"BuPu",invert:"dark"},{name:"GnBu",invert:"dark"},{name:"OrRd",invert:"dark"},{name:"PuBuGn",invert:"dark"},{name:"PuBu",invert:"dark"},{name:"PuRd",invert:"dark"},{name:"RdPu",invert:"dark"},{name:"YlGnBu",invert:"dark"},{name:"YlGn",invert:"dark"},{name:"YlOrBr",invert:"dark"},{name:"YlOrRd",invert:"dark"},{name:"Rainbow",invert:"always"},{name:"Sinebow",invert:"always"}],I=F.find((e=>"Spectral"===e.name));function N(e,t){var a;const l=Object.assign({},H.color,e),n=[],i=(null!==(a=l.steps)&&void 0!==a?a:128)-1;if(e.mode===E.Opacity){const a=R()(t.visualization.getColorByName(e.fill)).toPercentageRgb(),o=l.scale===T.Exponential?j.scalePow().exponent(l.exponent).domain([0,1]).range([0,1]):j.scaleLinear().domain([0,1]).range([0,1]);for(let e=0;e<=i;e++)a.a=o(e/i),n.push(R()(a).toString("hex8"))}else{var o,r;const a=null!==(o=F.find((e=>e.name===l.scheme)))&&void 0!==o?o:I;let s="interpolate"+(null!==(r=a.name2)&&void 0!==r?r:a.name);const d=O[s];for(let e=0;e<=i;e++){let t=d(e/i),a=0===t.indexOf("rgb")?"#"+[...t.matchAll(/\d+/g)].map((e=>(+e[0]).toString(16).padStart(2,"0"))).join(""):t;n.push(a)}(e.reverse||"always"===a.invert||"dark"===a.invert&&t.isDark||"light"===a.invert&&t.isLight)&&n.reverse()}return n}const G=e=>({colorScaleWrapper:m.css`
    margin-left: 25px;
    padding: 10px 0;
    max-width: 300px;
  `}),z=["bucketFrame"];const Y=(e,t,a,l)=>{if("heatmap"===t&&a.angular){const{fieldConfig:t,options:n}=function(e){var t,a,l,n,i,r;const s={defaults:{},overrides:[]},d="tsbuckets"!==e.dataFormat,u=Object.assign({},H.calculation),m=Object.assign({logBase:1},e.yAxis);d&&(e.xBucketSize?u.xBuckets={mode:c.k.Size,value:`${e.xBucketSize}`}:e.xBucketNumber&&(u.xBuckets={mode:c.k.Count,value:`${e.xBucketNumber}`}),e.yBucketSize?u.yBuckets={mode:c.k.Size,value:`${e.yBucketSize}`}:e.xBucketNumber&&(u.yBuckets={mode:c.k.Count,value:`${e.yBucketNumber}`}),m.logBase>1&&(u.yBuckets={mode:c.k.Count,value:+m.splitFactor>0?`${m.splitFactor}`:void 0,scale:{type:o.wf.Log,log:m.logBase}}));const p=_(null===(t=e.cards)||void 0===t?void 0:t.cardPadding,2),h={calculate:d,calculation:u,color:Object.assign({},H.color,{steps:128}),cellGap:p||1,cellRadius:_(null===(a=e.cards)||void 0===a?void 0:a.cardRound),yAxis:{axisPlacement:!1===m.show?o.LB.Hidden:o.LB.Left,reverse:Boolean(e.reverseYBuckets),axisWidth:_(m.width),min:m.min,max:m.max,unit:m.format,decimals:m.decimals},cellValues:{decimals:_(e.tooltipDecimals)},rowsFrame:{layout:$(e.yBucketBound)},legend:{show:Boolean(null===(l=e.legend)||void 0===l?void 0:l.show)},showValue:o.Jp.Never,tooltip:{show:Boolean(null===(n=e.tooltip)||void 0===n?void 0:n.show),yHistogram:Boolean(null===(i=e.tooltip)||void 0===i?void 0:i.showHistogram)},exemplars:Object.assign({},H.exemplars)};e.hideZeroBuckets&&(h.filterValues=Object.assign({},H.filterValues));const v=null!==(r=e.color)&&void 0!==r?r:{};switch(null==v?void 0:v.mode){case"spectrum":{h.color.mode=E.Scheme;const e=v.colorScheme;let t=F.find((t=>t.name===e));t||(t=F.find((t=>e.indexOf(t.name)>=0))),h.color.scheme=t?t.name:H.color.scheme;break}case"opacity":h.color.mode=E.Opacity,h.color.scale=v.scale}h.color.fill=v.cardColor,h.color.min=v.min,h.color.max=v.max,"number"==typeof v.min&&"number"==typeof v.max&&v.min>v.max&&(h.color.min=v.max,h.color.max=v.min,h.color.reverse=!0);return{fieldConfig:s,options:h}}(Object.assign({},a.angular,{fieldConfig:l}));return e.fieldConfig=t,n}if("heatmap-new"===t){const t=e.options,{bucketFrame:a}=t,l=function(e,t){if(null==e)return{};var a,l,n={},i=Object.keys(e);for(l=0;l<i.length;l++)a=i[l],t.indexOf(a)>=0||(n[a]=e[a]);return n}(t,z);return a?Object.assign({},l,{rowsFrame:a}):e.options}return{}};function $(e){switch(e){case"upper":return c.D.ge;case"lower":return c.D.le;case"middle":return c.D.unknown}return c.D.auto}function _(e,t){if(null==e||""===e)return t;const a=+e;return isNaN(a)?t:a}const W=new n.PanelPlugin((e=>{let{data:t,id:a,timeRange:r,timeZone:d,width:m,height:v,options:f,fieldConfig:y,eventBus:V,onChangeTimeRange:M,replaceVariables:L}=e;const A=(0,p.useTheme2)(),j=(0,p.useStyles2)(G),{sync:O}=(0,p.usePanelContext)();let P=(0,l.useRef)(r);P.current=r;const R=(0,l.useMemo)((()=>{try{return B(t,f,A)}catch(e){return{warning:`${e}`}}}),[t,f,A]),E=(0,l.useMemo)((()=>{var e,t;let a=[],l=[];const n=(0,u.d8)(R.heatmap);if(null!==(e=R.exemplars)&&void 0!==e&&e.length&&n.yMatchWithLabel){var i;a=null===(i=R.exemplars)||void 0===i?void 0:i.fields[0].values.toArray();if(null!=n.yOrdinalDisplay){var o;l=(null===(o=R.exemplars)||void 0===o?void 0:o.fields.find((e=>e.name===n.yMatchWithLabel)).values.toArray()).map((e=>{var t;return null===(t=n.yOrdinalLabel)||void 0===t?void 0:t.indexOf(e)}))}else{var r;l=null===(r=R.exemplars)||void 0===r?void 0:r.fields[1].values.toArray()}}return[null,null===(t=R.heatmap)||void 0===t?void 0:t.fields.map((e=>e.values.toArray())),[a,l]]}),[R.heatmap,R.exemplars]),T=(0,l.useMemo)((()=>N(f.color,A)),[f.color,A]),[H,F]=(0,l.useState)(void 0),[I,z]=(0,l.useState)(!1),Y=(0,l.useRef)(!1),$=()=>{Y.current=!Y.current,z(Y.current)},_=(0,l.useCallback)((e=>{F(null!=e?e:void 0)}),[f,t.structureRev]),W=(0,l.useRef)(R);W.current=R;const q=(0,l.useMemo)((()=>{var e,t,a,l,i,r,s,m,h,v;const g=null===(e=W.current)||void 0===e||null===(t=e.heatmap)||void 0===t||null===(a=t.fields[1].config)||void 0===a||null===(l=a.custom)||void 0===l?void 0:l.scaleDistribution;return function(e){var t,a,l,i,r,s,d,m,h,v,f,g,x,y,V,B;const{dataRef:M,theme:L,eventBus:A,onhover:j,onclick:O,onzoom:P,isToolTipOpen:R,timeZone:E,getTimeRange:T,palette:H,cellGap:F,hideLE:I,hideGE:N,yAxisConfig:G,ySizeDivisor:z,sync:Y}=e,$="x",_="time",W=devicePixelRatio;let q=null===(t=M.current)||void 0===t||null===(a=t.heatmap)||void 0===a||null===(l=a.meta)||void 0===l?void 0:l.type;const U=L.visualization.getColorByName(e.exemplarColor);let J,Z,K,X=new p.UPlotConfigBuilder(E);X.addHook("init",(e=>{e.root.querySelectorAll(".u-cursor-pt").forEach((e=>{Object.assign(e.style,{borderRadius:"0",border:"1px solid white",background:"transparent"})})),O&&e.over.addEventListener("mouseup",(t=>{e.cursor.drag._x||e.cursor.drag._y||O(t)}),!0)})),P&&X.addHook("setSelect",(e=>{P({xMin:e.posToVal(e.select.left,$),xMax:e.posToVal(e.select.left+e.select.width,$)}),e.setSelect({left:0,top:0,width:0,height:0},!1)})),X.addHook("setData",(e=>{let{min:t,max:a}=e.scales.x,l=T().from.valueOf(),n=T().to.valueOf();t===l&&a===n||queueMicrotask((()=>{e.setScale($,{min:l,max:n})}))})),X.addHook("syncRect",((e,t)=>{K=t}));const Q={point:{[_]:null},data:null===(i=M.current)||void 0===i?void 0:i.heatmap},ee=new n.DataHoverEvent(Q);let te;j&&X.addHook("setLegend",(e=>{if(null!=e.cursor.idxs)for(let t=0;t<e.cursor.idxs.length;t++){const a=e.cursor.idxs[t];if(null!=a){const{left:l,top:n}=e.cursor;return Q.rowIndex=a,Q.point.time=e.posToVal(l,$),A.publish(ee),void(R.current||(te&&(clearTimeout(te),te=0),j({seriesIdx:t,dataIdx:a,pageX:K.left+l,pageY:K.top+n})))}}R.current||te||(te=setTimeout((()=>{j(null),Q.rowIndex=void 0,Q.point.time=null,A.publish(ee)}),100))})),X.addHook("drawClear",(e=>{J=J||new w.lW(0,0,e.bbox.width,e.bbox.height),J.clear(),e.series.forEach(((e,t)=>{t>0&&(e._paths=null)}))})),X.setMode(2),X.addScale({scaleKey:$,isTime:!0,orientation:o.wN.Horizontal,direction:o.bQ.Right,range:()=>[T().from.valueOf(),T().to.valueOf()]}),X.addAxis({scaleKey:$,placement:o.LB.Bottom,isTime:!0,theme:L});const ae=null===(r=M.current)||void 0===r||null===(s=r.heatmap)||void 0===s?void 0:s.fields[1];if(!ae)return X;const le=null===(d=ae.config)||void 0===d?void 0:d.custom,ne=null!==(m=null==le?void 0:le.scaleDistribution)&&void 0!==m?m:{type:o.wf.Linear},ie=Boolean(G.reverse),oe=q===n.DataFrameType.HeatmapCells&&!(0,u.qJ)(null===(h=M.current)||void 0===h?void 0:h.heatmap),re=ne.type!==o.wf.Linear||oe,se=null!=(0,u.d8)(null===(v=M.current)||void 0===v?void 0:v.heatmap).yOrdinalDisplay,de="y_"+(Math.random()+1).toString(36).substring(7);X.addScale({scaleKey:de,isTime:!1,orientation:o.wN.Vertical,direction:ie?o.bQ.Down:o.bQ.Up,distribution:re?o.wf.Log:o.wf.Linear,log:null!==(f=ne.log)&&void 0!==f?f:2,range:oe?(e,t,a)=>{var l;let i,o;if([i,o]=re?b.Z.rangeLog(t,a,null!==(l=ne.log)&&void 0!==l?l:2,!0):[t,a],re&&!se){let t=e.scales[de].log,a=2===t?Math.log2:Math.log10,{min:l,max:r}=G;if(null!=l&&l>0){let e=a(l);i=t**(0,n.incrRoundDn)(e,1)}if(null!=r&&r>0){let e=a(r);o=t**(0,n.incrRoundUp)(e,1)}}return[i,o]}:(e,t,a)=>{let l=t,i=a,{min:o,max:r}=G;if(re){var s,d;let u=e.scales[de].log,m=!1,p=!1,h=2===u?Math.log2:Math.log10;if(1!==z){let e=h(t),o=h(a);Number.isInteger(e)||(l=u**(0,n.incrRoundDn)(e,1),m=!0),Number.isInteger(o)||(i=u**(0,n.incrRoundUp)(o,1),p=!0)}if((null===(s=M.current)||void 0===s?void 0:s.yLayout)===c.D.le?m||(l/=u):(null===(d=M.current)||void 0===d?void 0:d.yLayout)===c.D.ge?p||(i*=u):(l/=u/2,i*=u/2),!se){if(null!=o&&o>0){let e=h(o);l=u**(0,n.incrRoundDn)(e,1)}if(null!=r&&r>0){let e=h(r);i=u**(0,n.incrRoundUp)(e,1)}}}else{var u;let e=null===(u=M.current)||void 0===u?void 0:u.yBucketSize;var m,p;0===e&&(e=1),e&&((null===(m=M.current)||void 0===m?void 0:m.yLayout)===c.D.le?l-=e:(null===(p=M.current)||void 0===p?void 0:p.yLayout)===c.D.ge?i+=e:(l-=e/2,i+=e/2)),se||(l=null!=o?o:l,i=null!=r?r:i)}return[l,i]}});const ue=null!==(g=ae.display)&&void 0!==g?g:(0,n.getValueFormat)("short");X.addAxis({scaleKey:de,show:G.axisPlacement!==o.LB.Hidden,placement:G.axisPlacement||o.LB.Left,size:G.axisWidth||null,label:G.axisLabel,theme:L,formatValue:(e,t)=>{var a;return(0,n.formattedValueToString)(ue(e,null!==(a=ae.config.decimals)&&void 0!==a?a:t))},splits:se?e=>{var t,a;const l=(0,u.d8)(null===(t=M.current)||void 0===t?void 0:t.heatmap);if(!l.yOrdinalDisplay)return[0,1];let n=l.yOrdinalDisplay.map(((e,t)=>t));switch(null===(a=M.current)||void 0===a?void 0:a.yLayout){case c.D.le:n.unshift(-1);break;case c.D.ge:n.push(n.length)}if(e.height<60)n=[n[0],n[n.length-1]];else for(;n.length>3&&(e.height-15)/n.length<10;)n=n.filter(((e,t)=>t%2==0));return n}:void 0,values:se?(e,t)=>{var a;const l=(0,u.d8)(null===(a=M.current)||void 0===a?void 0:a.heatmap);return l.yOrdinalDisplay?t.map((e=>{var t,a;return e<0?null!==(t=l.yMinDisplay)&&void 0!==t?t:"":null!==(a=l.yOrdinalDisplay[e])&&void 0!==a?a:""})):t}:void 0});const ce=oe?D:k;X.addSeries({facets:[{scale:$,auto:!0,sorted:1},{scale:de,auto:!0}],pathBuilder:ce({each:(e,t,a,l,n,i,o)=>{J.add({x:l-e.bbox.left,y:n-e.bbox.top,w:i,h:o,sidx:t,didx:a})},gap:F,hideLE:I,hideGE:N,xAlign:(null===(x=M.current)||void 0===x?void 0:x.xLayout)===c.D.le?-1:(null===(y=M.current)||void 0===y?void 0:y.xLayout)===c.D.ge?1:0,yAlign:((null===(V=M.current)||void 0===V?void 0:V.yLayout)===c.D.le?-1:(null===(B=M.current)||void 0===B?void 0:B.yLayout)===c.D.ge?1:0)*(ie?-1:1),ySizeDivisor:z,disp:{fill:{values:(e,t)=>{var a,l;let n=oe?3:2;return C(e.data[t][n],H,null===(a=M.current)||void 0===a?void 0:a.minValue,null===(l=M.current)||void 0===l?void 0:l.maxValue)},index:H}}}),theme:L,scaleKey:""}),X.addSeries({facets:[{scale:$,auto:!0,sorted:1},{scale:de,auto:!0}],pathBuilder:S({each:(e,t,a,l,n,i,o)=>{J.add({x:l-e.bbox.left,y:n-e.bbox.top,w:i,h:o,sidx:t,didx:a})}},U),theme:L,scaleKey:""});const me={drag:{x:!0,y:!1,setScale:!1},dataIdx:(e,t)=>{if(1===t){Z=null;let t=e.cursor.left*W,a=e.cursor.top*W;J.get(t,a,1,1,(e=>{(0,w.Pn)(t,a,e.x,e.y,e.x+e.w,e.y+e.h)&&(Z=e)}))}return Z&&t===Z.sidx?Z.didx:null},points:{fill:"rgba(255,255,255, 0.3)",bbox:(e,t)=>{let a=Z&&t===Z.sidx;return{left:a?Z.x/W:-10,top:a?Z.y/W:-10,width:a?Z.w/W:0,height:a?Z.h/W:0}}}};return Y&&Y()!==n.DashboardCursorSync.Off&&(me.sync={key:"__global_",scales:[$,de],filters:{pub:(e,t,a,l,i,o,r)=>(a<0?(Q.point.time=null,A.publish(new n.DataHoverClearEvent)):(Q.point.time=t.posToVal(a,$),A.publish(ee)),!0)}},X.setSync()),X.setCursor(me),X}({dataRef:W,theme:A,eventBus:V,onhover:_,onclick:f.tooltip.show?$:null,onzoom:e=>{e.xMax-e.xMin>1&&M({from:e.xMin,to:e.xMax})},isToolTipOpen:Y,timeZone:d,getTimeRange:()=>P.current,sync:O,palette:T,cellGap:f.cellGap,hideLE:null===(i=f.filterValues)||void 0===i?void 0:i.le,hideGE:null===(r=f.filterValues)||void 0===r?void 0:r.ge,exemplarColor:null!==(s=null===(m=f.exemplars)||void 0===m?void 0:m.color)&&void 0!==s?s:"rgba(255,0,255,0.7)",yAxisConfig:f.yAxis,ySizeDivisor:(null==g?void 0:g.type)===p.ScaleDistribution.Log?+((null===(h=f.calculation)||void 0===h||null===(v=h.yBuckets)||void 0===v?void 0:v.value)||1):1})}),[f,t.structureRev]);return R.warning||!R.heatmap?(0,g.jsx)(i.PanelDataErrorView,{panelId:a,fieldConfig:y,data:t,needsNumberField:!0,message:R.warning}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(p.VizLayout,{width:m,height:v,legend:(()=>{var e,t,a,l;if(!R.heatmap||!f.legend.show)return null;let i=(null===(e=W.current)||void 0===e||null===(t=e.heatmap)||void 0===t||null===(a=t.meta)||void 0===a?void 0:a.type)===n.DataFrameType.HeatmapCells&&!(0,u.qJ)(null===(l=W.current)||void 0===l?void 0:l.heatmap)?3:2;const o=R.heatmap.fields[i];let r;return H&&R.heatmap.fields&&1===H.seriesIdx&&(r=o.values.get(H.dataIdx)),(0,g.jsx)(p.VizLayout.Legend,{placement:"bottom",maxHeight:"20%",children:(0,g.jsx)("div",{className:j.colorScaleWrapper,children:(0,g.jsx)(s.q,{hoverValue:r,colorPalette:T,min:W.current.minValue,max:W.current.maxValue,display:R.display})})})})(),children:(e,t)=>(0,g.jsx)(p.UPlotChart,{config:q,data:E,width:e,height:t,timeRange:r})}),(0,g.jsx)(p.Portal,{children:H&&f.tooltip.show&&(0,g.jsxs)(p.VizTooltipContainer,{position:{x:H.pageX,y:H.pageY},offset:{x:10,y:10},allowPointerEvents:Y.current,children:[I&&(0,g.jsx)("div",{style:{width:"100%",display:"flex",justifyContent:"flex-end"},children:(0,g.jsx)(h.P,{onClick:()=>{Y.current=!1,z(!1),_(null)},style:{position:"relative",top:"auto",right:"auto",marginRight:0}})}),(0,g.jsx)(x,{data:R,hover:H,showHistogram:f.tooltip.yHistogram})]})})]})})).useFieldConfig({disableStandardOptions:Object.values(n.FieldConfigProperty).filter((e=>e!==n.FieldConfigProperty.Links)),useCustomConfig:e=>{e.addCustomEditor({id:"scaleDistribution",path:"scaleDistribution",name:"Y axis scale",category:["Heatmap"],editor:r.ScaleDistributionEditor,override:r.ScaleDistributionEditor,defaultValue:{type:o.wf.Linear},shouldApply:e=>e.type===n.FieldType.number,process:n.identityOverrideProcessor,hideFromDefaults:!0}),(0,r.addHideFrom)(e)}}).setPanelChangeHandler(Y).setMigrationHandler((e=>0===Object.keys(e.options).length?Y(e,"heatmap",{angular:e},e.fieldConfig):e.options)).setPanelOptions(((e,t)=>{var a,l,n,r;const m=null!==(a=t.options)&&void 0!==a?a:H;let p=!1;try{const e=B({series:t.data},m,i.config.theme2);p=null!=(0,u.d8)(e.heatmap).yOrdinalDisplay}catch{}let h=["Heatmap"];var v,f,x;(e.addRadio({path:"calculate",name:"Calculate from data",defaultValue:H.calculate,category:h,settings:{options:[{label:"Yes",value:!0},{label:"No",value:!1}]}}),m.calculate&&(0,d.J)("calculation.",e,m.calculation,h),h=["Y Axis"],e.addRadio({path:"yAxis.axisPlacement",name:"Placement",defaultValue:null!==(l=H.yAxis.axisPlacement)&&void 0!==l?l:o.LB.Left,category:h,settings:{options:[{label:"Left",value:o.LB.Left},{label:"Right",value:o.LB.Right},{label:"Hidden",value:o.LB.Hidden}]}}).addUnitPicker({category:h,path:"yAxis.unit",name:"Unit",defaultValue:void 0,settings:{isClearable:!0}}).addNumberInput({category:h,path:"yAxis.decimals",name:"Decimals",settings:{placeholder:"Auto"}}),p||e.addNumberInput({path:"yAxis.min",name:"Min value",settings:{placeholder:"Auto"},category:h}).addTextInput({path:"yAxis.max",name:"Max value",settings:{placeholder:"Auto"},category:h}),e.addNumberInput({path:"yAxis.axisWidth",name:"Axis width",defaultValue:H.yAxis.axisWidth,settings:{placeholder:"Auto",min:5},category:h}).addTextInput({path:"yAxis.axisLabel",name:"Axis label",defaultValue:H.yAxis.axisLabel,settings:{placeholder:"Auto"},category:h}),m.calculate)||e.addRadio({path:"rowsFrame.layout",name:"Tick alignment",defaultValue:null!==(v=null===(f=H.rowsFrame)||void 0===f?void 0:f.layout)&&void 0!==v?v:c.D.auto,category:h,settings:{options:[{label:"Auto",value:c.D.auto},{label:"Top (LE)",value:c.D.le},{label:"Middle",value:c.D.unknown},{label:"Bottom (GE)",value:c.D.ge}]}});(e.addBooleanSwitch({path:"yAxis.reverse",name:"Reverse",defaultValue:!0===H.yAxis.reverse,category:h}),h=["Colors"],e.addRadio({path:"color.mode",name:"Mode",defaultValue:H.color.mode,category:h,settings:{options:[{label:"Scheme",value:E.Scheme},{label:"Opacity",value:E.Opacity}]}}),e.addColorPicker({path:"color.fill",name:"Color",defaultValue:H.color.fill,category:h,showIf:e=>e.color.mode===E.Opacity}),e.addRadio({path:"color.scale",name:"Scale",defaultValue:H.color.scale,category:h,settings:{options:[{label:"Exponential",value:T.Exponential},{label:"Linear",value:T.Linear}]},showIf:e=>e.color.mode===E.Opacity}),e.addSliderInput({path:"color.exponent",name:"Exponent",defaultValue:H.color.exponent,category:h,settings:{min:.1,max:2,step:.1},showIf:e=>e.color.mode===E.Opacity&&e.color.scale===T.Exponential}),e.addSelect({path:"color.scheme",name:"Scheme",description:"",defaultValue:H.color.scheme,category:h,settings:{options:F.map((e=>({value:e.name,label:e.name})))},showIf:e=>e.color.mode!==E.Opacity}),e.addSliderInput({path:"color.steps",name:"Steps",defaultValue:H.color.steps,category:h,settings:{min:2,max:128,step:1}}).addBooleanSwitch({path:"color.reverse",name:"Reverse",defaultValue:H.color.reverse,category:h}).addCustomEditor({id:"__scale__",path:"__scale__",name:"",category:h,editor:()=>{const e=N(m.color,i.config.theme2);return(0,g.jsx)("div",{children:(0,g.jsx)(s.q,{colorPalette:e,min:1,max:100})})}}),e.addNumberInput({path:"color.min",name:"Start color scale from value",defaultValue:H.color.min,settings:{placeholder:"Auto (min)"},category:h}).addNumberInput({path:"color.max",name:"End color scale at value",defaultValue:H.color.max,settings:{placeholder:"Auto (max)"},category:h}),h=["Cell display"],m.calculate)||e.addTextInput({path:"rowsFrame.value",name:"Value name",defaultValue:null===(x=H.rowsFrame)||void 0===x?void 0:x.value,settings:{placeholder:"Value"},category:h});e.addUnitPicker({category:h,path:"cellValues.unit",name:"Unit",defaultValue:void 0,settings:{isClearable:!0}}).addNumberInput({category:h,path:"cellValues.decimals",name:"Decimals",settings:{placeholder:"Auto"}}),e.addSliderInput({name:"Cell gap",path:"cellGap",defaultValue:H.cellGap,category:h,settings:{min:0,max:25}}).addNumberInput({path:"filterValues.le",name:"Hide cells with values <=",defaultValue:null===(n=H.filterValues)||void 0===n?void 0:n.le,settings:{placeholder:"None"},category:h}).addNumberInput({path:"filterValues.ge",name:"Hide cells with values >=",defaultValue:null===(r=H.filterValues)||void 0===r?void 0:r.ge,settings:{placeholder:"None"},category:h}),h=["Tooltip"],e.addBooleanSwitch({path:"tooltip.show",name:"Show tooltip",defaultValue:H.tooltip.show,category:h}),e.addBooleanSwitch({path:"tooltip.yHistogram",name:"Show histogram (Y axis)",defaultValue:H.tooltip.yHistogram,category:h,showIf:e=>e.tooltip.show}),h=["Legend"],e.addBooleanSwitch({path:"legend.show",name:"Show legend",defaultValue:H.legend.show,category:h}),h=["Exemplars"],e.addColorPicker({path:"exemplars.color",name:"Color",defaultValue:H.exemplars.color,category:h})})).setSuggestionsSupplier(new class{getSuggestionsForData(e){var t;const{dataSummary:a}=e;if(null===(t=e.data)||void 0===t||!t.series||!a.hasData||a.timeFieldCount<1||a.numberFieldCount<2||a.numberFieldCount>10)return;const l=B(e.data,H,i.config.theme2);l&&!l.warning&&e.getListAppender({name:"",pluginId:"heatmap",options:{},fieldConfig:{defaults:{custom:{}},overrides:[]}})}})}}]);
//# sourceMappingURL=heatmapPanel.a3aa275091c4efe6a511.js.map