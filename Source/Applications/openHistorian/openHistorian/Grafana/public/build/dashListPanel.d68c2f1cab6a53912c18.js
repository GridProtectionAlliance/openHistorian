"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8995],{72739:(le,b,a)=>{a.r(b),a.d(b,{plugin:()=>te});var n=a(74848),C=a(65158),L=a(79924),N=a(36607),x=a(31678),E=a(2543),D=a(96540),R=a(76885),F=a(80997),H=a(6709),$=a(40845),z=a(29158),A=a(40276),O=a(82467),Q=a(2913),G=a(10096),K=a(16021),w=a(91219),k=a(28215),p=a(27677),J=a(62301),W=a(14792),X=a(80484),m=a(32196);const Y=e=>({dashlistSectionHeader:(0,m.css)({padding:e.spacing(.25,1),marginRight:e.spacing(1)}),dashlistSection:(0,m.css)({marginBottom:e.spacing(2),paddingTop:e.spacing(.5)}),dashlistLink:(0,m.css)({display:"flex",cursor:"pointer",borderBottom:`1px solid ${e.colors.border.weak}`,margin:e.spacing(1),padding:e.spacing(1),alignItems:"center","&:hover":{a:{color:e.colors.text.link,textDecoration:"underline"}}}),dashlistFolder:(0,m.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,lineHeight:e.typography.body.lineHeight}),dashlistTitle:(0,m.css)({"&::after":{position:"absolute",content:'""',left:0,top:0,bottom:0,right:0}}),dashlistLinkBody:(0,m.css)({flexGrow:1}),dashlistItem:(0,m.css)({position:"relative",listStyle:"none"})});async function Z(e,r){let u=Promise.resolve([]);if(e.showStarred){const t={limit:e.maxItems,starred:"true"};u=(0,p.AI)().search(t)}let l=Promise.resolve([]),i=[];if(e.showRecentlyViewed){let t=await J.A.getDashboardOpened();i=(0,E.take)(t,e.maxItems),l=(0,p.AI)().search({dashboardUIDs:i,limit:e.maxItems})}let y=Promise.resolve([]);if(e.showSearch){const t=e.folderUID===""?"general":e.folderUID,g={limit:e.maxItems,query:r(e.query,{},"text"),folderUIDs:t,tag:e.tags.map(S=>r(S,{},"text")),type:"dash-db"};y=(0,p.AI)().search(g)}const[V,T,P]=await Promise.all([u,y,l]);let h=new Map;for(const t of i){const g=P.find(S=>S.uid===t);g&&h.set(t,{...g,isRecent:!0})}return T.forEach(t=>{t.uid&&(h.has(t.uid)?h.get(t.uid).isSearchResult=!0:h.set(t.uid,{...t,isSearchResult:!0}))}),V.forEach(t=>{t.uid&&(h.has(t.uid)?h.get(t.uid).isStarred=!0:h.set(t.uid,{...t,isStarred:!0}))}),h}function q(e){const[r,u]=(0,D.useState)(new Map),l=(0,x.useDispatch)(),i=(0,x.useSelector)(d=>d.navIndex);(0,D.useEffect)(()=>{Z(e.options,e.replaceVariables).then(d=>{u(d)})},[e.options,e.replaceVariables,e.renderCounter]);const y=async(d,s)=>{const{uid:o,title:v,url:j}=s;d.preventDefault(),d.stopPropagation();const U=await(0,W.UA)().starDashboard(s.uid,s.isStarred),B=new Map(r);B.set(s?.uid??"",{...s,isStarred:U}),u(B),l((0,w.ci)({id:o??"",title:v,url:j,isStarred:U}));const I=i.starred;if(U)I.children?.push({id:w.L1+o,text:v,url:j??"",parentItem:I});else{l((0,k.Im)(w.L1+o));const M=I.children?.findIndex(ne=>ne.id===w.L1+o);M&&I.children?.splice(M,1)}l((0,O.Vz)(I))},[V,T,P]=(0,D.useMemo)(()=>{const d=[...r.values()];return[d.filter(s=>s.isStarred).sort((s,o)=>s.title.localeCompare(o.title)),d.filter(s=>s.isRecent),d.filter(s=>s.isSearchResult).sort((s,o)=>s.title.localeCompare(o.title))]},[r]),{showStarred:h,showRecentlyViewed:t,showHeadings:g,showFolderNames:S,showSearch:re}=e.options,oe=[{header:"Starred dashboards",dashboards:V,show:h},{header:"Recently viewed dashboards",dashboards:T,show:t},{header:"Search",dashboards:P,show:re}],f=(0,$.of)(Y),de=_(e),ie=d=>(0,n.jsx)("ul",{children:d.map(s=>{let o=s.url;return o=R.kM.appendQueryToUrl(o,de),o=(0,Q.zj)().disableSanitizeHtml?o:F.sQ.sanitizeUrl(o),(0,n.jsx)("li",{className:f.dashlistItem,children:(0,n.jsxs)("div",{className:f.dashlistLink,children:[(0,n.jsxs)("div",{className:f.dashlistLinkBody,children:[(0,n.jsx)("a",{className:f.dashlistTitle,href:o,children:s.title}),S&&s.folderTitle&&(0,n.jsx)("div",{className:f.dashlistFolder,children:s.folderTitle})]}),(0,n.jsx)(z.K,{tooltip:s.isStarred?`Unmark "${s.title}" as favorite`:`Mark "${s.title}" as favorite`,name:s.isStarred?"favorite":"star",iconType:s.isStarred?"mono":"default",onClick:v=>y(v,s)})]})},`dash-${s.uid}`)})});return(0,n.jsx)(A.E,{autoHeightMin:"100%",autoHeightMax:"100%",children:oe.map(({show:d,header:s,dashboards:o},v)=>d&&(0,n.jsxs)("div",{className:f.dashlistSection,children:[g&&(0,n.jsx)("h6",{className:f.dashlistSectionHeader,children:s}),ie(o)]},`dash-group-${v}`))})}function _(e){(0,K.u)(G.lE,X.og);let r={};return e.options.keepTime&&(r[`$${H.c.keepTime}`]=!0),e.options.includeVars&&(r[`$${H.c.includeVars}`]=!0),e.replaceVariables(R.kM.toUrlParams(r))}var ee=a(17172);async function se(e){return e===0?"":(await(0,ee.AI)().get(`/api/folders/id/${e}`,void 0,void 0,{showErrorAlert:!1})).uid}async function ae(e){const r={...e.options,showStarred:e.options.showStarred??e.starred,showRecentlyViewed:e.options.showRecentlyViewed??e.recent,showSearch:e.options.showSearch??e.search,showHeadings:e.options.showHeadings??e.headings,maxItems:e.options.maxItems??e.limit,query:e.options.query??e.query,folderId:e.options.folderId??e.folderId,tags:e.options.tags??e.tags};if(parseFloat(e.pluginVersion||"6.1")<6.3&&["starred","recent","search","headings","limit","query","folderId"].forEach(i=>delete e[i]),r.folderId!==void 0){const l=r.folderId;try{const i=await se(l);r.folderUID=i,delete r.folderId}catch(i){console.warn("Dashlist: Error migrating folder ID to UID",i)}}return r}const c={includeVars:!1,keepTime:!1,maxItems:10,query:"",showFolderNames:!0,showHeadings:!0,showRecentlyViewed:!1,showSearch:!1,showStarred:!0,tags:[]},te=new C.m(q).setPanelOptions(e=>{e.addBooleanSwitch({path:"keepTime",name:"Include current time range",defaultValue:c.keepTime}).addBooleanSwitch({path:"includeVars",name:"Include current template variable values",defaultValue:c.includeVars}).addBooleanSwitch({path:"showStarred",name:"Starred",defaultValue:c.showStarred}).addBooleanSwitch({path:"showRecentlyViewed",name:"Recently viewed",defaultValue:c.showRecentlyViewed}).addBooleanSwitch({path:"showSearch",name:"Search",defaultValue:c.showSearch}).addBooleanSwitch({path:"showHeadings",name:"Show headings",defaultValue:c.showHeadings}).addBooleanSwitch({path:"showFolderNames",name:"Show folder names",defaultValue:c.showFolderNames}).addNumberInput({path:"maxItems",name:"Max items",defaultValue:c.maxItems}).addTextInput({path:"query",name:"Query",defaultValue:c.query}).addCustomEditor({path:"folderUID",name:"Folder",id:"folderUID",defaultValue:void 0,editor:function({value:u,onChange:l}){return(0,n.jsx)(N.d,{clearable:!0,permission:x.PermissionLevelString.View,value:u,onChange:i=>l(i)})}}).addCustomEditor({id:"tags",path:"tags",name:"Tags",description:"",defaultValue:c.tags,editor(r){return(0,n.jsx)(L.u,{tags:r.value,onChange:r.onChange})}})}).setMigrationHandler(ae)}}]);

//# sourceMappingURL=dashListPanel.d68c2f1cab6a53912c18.js.map