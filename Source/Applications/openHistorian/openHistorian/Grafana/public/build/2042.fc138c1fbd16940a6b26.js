"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2042],{82042:(ke,J,n)=>{n.r(J),n.d(J,{CreateAlertButton:()=>ne,default:()=>Ve});var e=n(74848),g=n(32196),E=n(96540),le=n(54148),ie=n(41053),oe=n(10940),ce=n(49185),de=n(76885),ue=n(66602),R=n(40845),b=n(55852),me=n(57514),ge=n(31678),F=n(25027),L=n(19073),xe=n(9518),X=n(14285),Z=n(61410),K=n(26627),ve=n(55740),S=n(57220),B=n(78742),he=n(37959),je=n(5598),pe=n(45058),fe=n(75648),ye=n(67381),Re=n(92467),P=n(2543),Ie=n(42941),z=n(18461),$=n(23662),Ce=n(55127),D=n.n(Ce),m=n(67061),f=n(72109),M=n(83122),v=n(38138),N=n(94753),Ee=n(42418),h=n(94822),Q=n(75214),y=n(55196),Y=n(90141),k=n(26058),be=n(56034),G=n(14578),Be=n(39890);function q({state:s,health:r,recording:o=!1,isPaused:i=!1}){const l={[h.cF.Inactive]:"check-circle",[h.cF.Pending]:"circle",[h.cF.Firing]:"exclamation-circle"},j={[h.cF.Inactive]:"success",[h.cF.Pending]:"warning",[h.cF.Firing]:"error"},t={[h.cF.Inactive]:"Normal",[h.cF.Pending]:"Pending",[h.cF.Firing]:"Firing"};let a=s?l[s]:"circle",x=s?j[s]:"secondary",u=s?t[s]:"unknown";return o&&(a="record-audio",x="success",u="Recording"),r==="nodata"&&(a="exclamation-triangle",x="warning",u="Insufficient data"),(0,Be.lf)(r)&&(a="times-circle",x="error",u="Failed to evaluate rule"),i&&(a="pause-circle",x="warning",u="Paused"),(0,e.jsx)(be.m,{content:u,placement:"right",children:(0,e.jsx)("div",{children:(0,e.jsx)(N.E,{color:x,children:(0,e.jsx)(G.I,{name:a,size:"lg"})})})})}var Ne=n(13064);const _=s=>{const{name:r,summary:o,state:i,health:l,error:j,href:t,isProvisioned:a,lastEvaluation:x,evaluationInterval:u,isPaused:p=!1,instancesCount:A=0,contactPoint:I,labels:W}=s,U=(0,R.of)(O);return(0,e.jsx)("li",{className:U.alertListItemContainer,role:"treeitem","aria-selected":"false",children:(0,e.jsxs)(m.B,{direction:"row",alignItems:"start",gap:1,wrap:"nowrap",children:[(0,e.jsx)(q,{state:i,health:l,isPaused:p}),(0,e.jsxs)(m.B,{direction:"column",gap:.5,flex:"1",children:[(0,e.jsx)("div",{children:(0,e.jsxs)(m.B,{direction:"column",gap:0,children:[(0,e.jsx)(m.B,{direction:"row",alignItems:"start",children:(0,e.jsx)(f.Y,{href:t,inline:!1,children:r})}),(0,e.jsx)(ee,{content:o,error:j})]})}),(0,e.jsx)("div",{children:(0,e.jsxs)(m.B,{direction:"row",gap:1,children:[!p&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(se,{lastEvaluation:x,evaluationInterval:u,state:i}),(0,e.jsx)(y.P,{icon:"layers-alt",children:(0,e.jsx)(f.Y,{href:t+"?tab=instances",variant:"bodySmall",color:"primary",inline:!1,children:D()("instance",A,!0)})})]}),!(0,P.isEmpty)(W)&&(0,e.jsx)(y.P,{icon:"tag-alt",children:(0,e.jsx)(f.Y,{href:t,variant:"bodySmall",color:"primary",inline:!1,children:D()("label",(0,Q.rm)(W),!0)})}),I&&!p&&(0,e.jsxs)(y.P,{icon:"at",children:["Delivered to"," ",(0,e.jsx)(f.Y,{href:(0,B.bg)(I,S.hY),variant:"bodySmall",color:"primary",inline:!1,children:I})]})]})})]}),(0,e.jsxs)(m.B,{direction:"row",alignItems:"center",gap:1,wrap:"nowrap",children:[(0,e.jsx)(b.$n,{variant:"secondary",size:"sm",icon:"pen",type:"button",disabled:a,children:"Edit"}),(0,e.jsx)(M.m,{overlay:(0,e.jsxs)(v.W,{children:[(0,e.jsx)(v.W.Item,{label:"Silence",icon:"bell-slash"}),(0,e.jsx)(v.W.Divider,{}),(0,e.jsx)(v.W.Item,{label:"Export",disabled:a,icon:"download-alt"}),(0,e.jsx)(v.W.Item,{label:"Delete",disabled:a,icon:"trash-alt",destructive:!0})]}),children:(0,e.jsx)(Y.A,{})})]})]})})};function ee({content:s,error:r}){return r?(0,e.jsx)(N.E,{variant:"bodySmall",color:"error",weight:"light",truncate:!0,children:r}):s?(0,e.jsx)(N.E,{variant:"bodySmall",color:"secondary",children:s}):null}const Ae=({name:s,error:r,state:o,health:i,isProvisioned:l,href:j,labels:t,lastEvaluation:a,evaluationInterval:x})=>{const u=(0,R.of)(O);return(0,e.jsx)("li",{className:u.alertListItemContainer,role:"treeitem","aria-selected":"false",children:(0,e.jsx)(m.B,{direction:"row",alignItems:"center",gap:1,children:(0,e.jsxs)(m.B,{direction:"row",alignItems:"start",gap:1,flex:"1",children:[(0,e.jsx)(q,{health:i,recording:!0}),(0,e.jsxs)(m.B,{direction:"column",gap:.5,children:[(0,e.jsxs)(m.B,{direction:"column",gap:0,children:[(0,e.jsx)(m.B,{direction:"row",alignItems:"start",children:(0,e.jsx)(f.Y,{href:j,variant:"body",weight:"bold",inline:!1,children:s})}),(0,e.jsx)(ee,{error:r})]}),(0,e.jsx)("div",{children:(0,e.jsxs)(m.B,{direction:"row",gap:1,children:[(0,e.jsx)(se,{lastEvaluation:a,evaluationInterval:x,state:o}),!(0,P.isEmpty)(t)&&(0,e.jsx)(y.P,{icon:"tag-alt",children:(0,e.jsx)(f.Y,{variant:"bodySmall",color:"primary",href:j,inline:!1,children:D()("label",(0,Q.rm)(t),!0)})})]})})]}),(0,e.jsx)(k.h,{}),(0,e.jsx)(b.$n,{variant:"secondary",size:"sm",icon:"pen",type:"button",disabled:l,"data-testid":"edit-rule-action",children:"Edit"}),(0,e.jsx)(M.m,{overlay:(0,e.jsxs)(v.W,{children:[(0,e.jsx)(v.W.Item,{label:"Export",disabled:l,icon:"download-alt"}),(0,e.jsx)(v.W.Item,{label:"Delete",disabled:l,icon:"trash-alt",destructive:!0})]}),children:(0,e.jsx)(Y.A,{})})]})})})};function se({lastEvaluation:s,evaluationInterval:r,state:o}){const i=(0,Ne.C)(s,r);return o===h.cF.Firing&&i?(0,e.jsxs)(y.P,{icon:"clock-nine",children:["Firing for ",(0,e.jsx)(N.E,{color:"primary",children:"2m 34s"}),i&&(0,e.jsxs)(e.Fragment,{children:["\xB7 next evaluation in ",i.humanized]})]}):i?(0,e.jsxs)(y.P,{icon:"clock-nine",children:["Next evaluation ",i.humanized]}):null}const Fe=({rule:s})=>{const r=(0,R.of)(O),o={namespace:s.namespace.name,group:s.group.name,name:s.name};return(0,F.vV)(new Error("unknown rule type"),o),(0,e.jsx)(Ee.F,{title:"Unknown rule type",className:r.resetMargin,children:(0,e.jsxs)("details",{children:[(0,e.jsx)("summary",{children:"Rule definition"}),(0,e.jsx)("pre",{children:(0,e.jsx)("code",{children:JSON.stringify(s.rulerRule,null,2)})})]})})},O=s=>({alertListItemContainer:(0,g.css)({position:"relative",listStyle:"none",background:s.colors.background.primary,borderBottom:`solid 1px ${s.colors.border.weak}`,padding:s.spacing(1,1,1,1.5)}),resetMargin:(0,g.css)({margin:0})});var Le=n(39938);const Se=({name:s,provenance:r,interval:o,onToggle:i,isOpen:l=!1,children:j})=>{const t=(0,R.of)(Pe),a=!!r;return(0,e.jsxs)(m.B,{direction:"column",role:"treeitem","aria-expanded":l,"aria-selected":"false",gap:0,children:[(0,e.jsx)("div",{className:t.headerWrapper,children:(0,e.jsxs)(m.B,{direction:"row",alignItems:"center",gap:1,children:[(0,e.jsx)("button",{className:(0,g.cx)(t.hiddenButton,t.largerClickTarget),type:"button",onClick:i,children:(0,e.jsxs)(m.B,{alignItems:"center",gap:.5,children:[(0,e.jsx)(G.I,{name:l?"angle-down":"angle-right"}),(0,e.jsx)(N.E,{truncate:!0,variant:"body",children:s})]})}),a&&(0,e.jsx)(Le.E,{color:"purple",text:"Provisioned"}),(0,e.jsx)(k.h,{}),o&&(0,e.jsx)(y.P,{icon:"history",children:o}),(0,e.jsx)(b.$n,{size:"sm",icon:"pen",variant:"secondary",disabled:a,"data-testid":"edit-group-action",children:"Edit"}),(0,e.jsx)(M.m,{overlay:(0,e.jsxs)(v.W,{children:[(0,e.jsx)(v.W.Item,{label:"Re-order rules",icon:"flip",disabled:a}),(0,e.jsx)(v.W.Divider,{}),(0,e.jsx)(v.W.Item,{label:"Export",icon:"download-alt"}),(0,e.jsx)(v.W.Item,{label:"Delete",icon:"trash-alt",destructive:!0,disabled:a})]}),children:(0,e.jsx)(Y.A,{size:"sm"})})]})}),l&&(0,e.jsx)("div",{role:"group",children:j})]})},Pe=s=>({headerWrapper:(0,g.css)({padding:`${s.spacing(1)} ${s.spacing(1)}`,background:s.colors.background.secondary,border:"none",borderBottom:`solid 1px ${s.colors.border.weak}`,borderTopLeftRadius:s.shape.radius.default,borderTopRightRadius:s.shape.radius.default}),hiddenButton:(0,g.css)({border:"none",background:"transparent"}),largerClickTarget:(0,g.css)({padding:s.spacing(.5),margin:`-${s.spacing(.5)}`})}),$e=Se,We=({group:s,rulesSource:r})=>{const[o,i]=(0,Ie.A)(!1);return(0,e.jsx)($e,{name:s.name,interval:s.interval,isOpen:o,onToggle:i,children:s.rules.map((l,j)=>{const{rulerRule:t,promRule:a,annotations:x}=l;if(!t)return null;const u=(0,$.Z8)(a);if((0,$.$y)(t))return(0,e.jsx)(_,{state:u?a?.state:void 0,health:a?.health,error:a?.lastError,name:t.alert,labels:t.labels,lastEvaluation:a?.lastEvaluation,evaluationInterval:s.interval,instancesCount:u?(0,P.size)(a.alerts):void 0,href:(0,B.w$)(r,l),summary:x?.summary},(0,z.Ns)(t));if((0,$.i7)(t))return(0,e.jsx)(Ae,{name:t.record,health:a?.health,error:a?.lastError,lastEvaluation:a?.lastEvaluation,evaluationInterval:s.interval,labels:t.labels,href:(0,B.w$)(r,l)},(0,z.Ns)(t));if((0,$.lT)(t)){const p=t.grafana_alert.notification_settings?.receiver;return(0,e.jsx)(_,{name:t.grafana_alert.title,state:u?a?.state:void 0,health:a?.health,error:a?.lastError,labels:t.labels,isPaused:t.grafana_alert.is_paused,lastEvaluation:a?.lastEvaluation,evaluationInterval:s.interval,instancesCount:u?(0,P.size)(a.alerts):void 0,href:(0,B.w$)(r,l),summary:l.annotations?.summary,isProvisioned:!!t.grafana_alert.provenance,contactPoint:p},t.grafana_alert.uid)}return(0,e.jsx)(Fe,{rule:l},(0,z.Ns)(t))})})};var Te=n(96636);const ze=({children:s,name:r,href:o,application:i})=>{const l=(0,R.of)(Me);return(0,e.jsxs)("li",{className:l.namespaceWrapper,role:"treeitem","aria-selected":"false",children:[(0,e.jsx)("div",{className:l.namespaceTitle,children:(0,e.jsxs)(m.B,{alignItems:"center",gap:1,children:[(0,e.jsx)(De,{application:i}),o?(0,e.jsx)(Te.d,{title:"Alert rules",component:(0,e.jsx)(f.Y,{href:o,inline:!1,children:r})}):r]})}),s&&(0,e.jsx)("ul",{role:"group",className:l.groupItemsWrapper,children:s})]})},De=({application:s})=>{switch(s){case h.N1.Prometheus:return(0,e.jsx)("img",{width:16,height:16,src:"public/app/plugins/datasource/prometheus/img/prometheus_logo.svg",alt:"Prometheus"});case h.N1.Mimir:return(0,e.jsx)("img",{width:16,height:16,src:"public/app/plugins/datasource/prometheus/img/mimir_logo.svg",alt:"Mimir"});case"loki":return(0,e.jsx)("img",{width:16,height:16,src:"public/app/plugins/datasource/loki/img/loki_icon.svg",alt:"Loki"});case"grafana":default:return(0,e.jsx)(G.I,{name:"folder"})}},Me=s=>({groupItemsWrapper:(0,g.css)({position:"relative",borderRadius:s.shape.radius.default,border:`solid 1px ${s.colors.border.weak}`,borderBottom:"none",marginLeft:s.spacing(3),"&:before":{content:"''",position:"absolute",height:"100%",borderLeft:`solid 1px ${s.colors.border.weak}`,marginTop:0,marginLeft:`-${s.spacing(2.5)}`}}),namespaceWrapper:(0,g.css)({display:"flex",flexDirection:"column",gap:s.spacing(1)}),namespaceTitle:(0,g.css)({padding:`${s.spacing(1)} ${s.spacing(1.5)}`,background:s.colors.background.secondary,border:`solid 1px ${s.colors.border.weak}`,borderRadius:s.shape.radius.default})}),Ye=ze,Ge=fe.Ys+1,Oe=(0,ue.Xc)(()=>{const s=(0,ge.useDispatch)(),r=(0,R.of)(He),o=(0,E.useMemo)(S.gR,[]),[i,l]=(0,E.useState)(!1),j=(0,E.useCallback)(()=>l(!1),[]),{filterState:t,hasActiveFilters:a}=(0,X.dI)(),x=(0,Z.$)(d=>d.promRules),u=(0,Z.$)(d=>d.rulerRules),p=o.some(d=>x[d]?.loading||u[d]?.loading),A=Object.entries(x),I=Object.entries(u),W=A.every(([d,c])=>c.dispatched&&(c?.result!==void 0||c?.error!==void 0)),U=I.every(([d,c])=>c.dispatched&&(c?.result!==void 0||c?.error!==void 0)),we=A.every(([d,c])=>c.dispatched&&c?.result?.length===0),Je=I.every(([d,c])=>Object.entries(c?.result??{}).every(([re,C])=>C?.length===0)&&c.dispatched),T=a?void 0:Ge,[qe,Xe]=(0,ie.A)(async()=>{p||await s((0,K.yo)(!1,{limitAlerts:T}))},[p,T,s]);(0,E.useEffect)(()=>{(0,F.Sq)().catch(()=>{})},[]),(0,E.useEffect)(()=>{s((0,K.yo)(!1,{limitAlerts:T}))},[s,T]),(0,oe.A)(Xe,ve.HH);const ae=W&&we&&A.length>0&&Je&&U,H=!ae,Ze=(0,xe.dy)(),te=(0,X.i7)(Ze,t),Ke=te.sort((d,c)=>d.name.localeCompare(c.name));return(0,e.jsxs)(he.d,{navId:"alert-list",isLoading:!1,actions:H&&(0,e.jsx)(ne,{}),children:[(0,e.jsx)(ye.o,{}),(0,e.jsx)(je.A,{onClear:j}),H&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:r.break}),(0,e.jsx)("div",{className:r.buttonsContainer,children:(0,e.jsxs)("div",{className:r.statsContainer,children:[a&&(0,e.jsx)(b.$n,{className:r.expandAllButton,icon:i?"angle-double-up":"angle-double-down",variant:"secondary",onClick:()=>l(!i),children:i?"Collapse all":"Expand all"}),(0,e.jsx)(Re.M_,{namespaces:te})]})})]}),ae&&(0,e.jsx)(pe.w,{}),H&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ue,{visible:p}),(0,e.jsx)("ul",{className:r.rulesTree,role:"tree","aria-label":"List of alert rules",children:Ke.map(d=>{const{rulesSource:c,uid:V}=d,w=(0,S.Vr)(c),re=w==="grafana"&&V?(0,B.c$)(V,d.name):void 0;return(0,e.jsx)(Ye,{href:re,name:d.name,application:w,children:d.groups.sort((C,Qe)=>C.name.localeCompare(Qe.name)).map(C=>(0,e.jsx)(We,{group:C,rulesSource:c},C.name))},(0,S.v8)(c)+d.name)})})]})]})},{style:"page"}),Ue=({visible:s=!1})=>{const[r,{width:o}]=(0,ce.A)();return(0,e.jsx)("div",{ref:r,children:s&&(0,e.jsx)(me.G,{width:o})})},He=s=>({rulesTree:(0,g.css)({display:"flex",flexDirection:"column",gap:s.spacing(1)}),break:(0,g.css)({width:"100%",height:0,marginBottom:s.spacing(2),borderBottom:`solid 1px ${s.colors.border.medium}`}),buttonsContainer:(0,g.css)({marginBottom:s.spacing(2),display:"flex",justifyContent:"space-between"}),statsContainer:(0,g.css)({display:"flex",flexDirection:"row",alignItems:"center"}),expandAllButton:(0,g.css)({marginRight:s.spacing(1)})}),Ve=Oe;function ne(){const[s,r]=(0,L.Ej)(L.RY.CreateAlertRule),[o,i]=(0,L.Ej)(L.RY.CreateExternalAlertRule),l=(0,le.zy)();return s&&r||o&&i?(0,e.jsx)(b.z9,{href:de.kM.renderUrl("alerting/new/alerting",{returnTo:l.pathname+l.search}),icon:"plus",onClick:()=>(0,F.fH)(F.le.alertRuleFromScratch),children:"New alert rule"}):null}}}]);

//# sourceMappingURL=2042.fc138c1fbd16940a6b26.js.map