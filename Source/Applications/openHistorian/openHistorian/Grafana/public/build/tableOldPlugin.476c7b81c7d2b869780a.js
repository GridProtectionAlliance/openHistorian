"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8777],{4244:(O,E,i)=>{i.d(E,{b:()=>f});var D=i(95344),S=i(76885),l=i(39601);const y={http:80,https:443,ftp:21};class f{constructor(){this.absUrl=this.wrapInDeprecationWarning(this.absUrl),this.hash=this.wrapInDeprecationWarning(this.hash),this.host=this.wrapInDeprecationWarning(this.host),this.path=this.wrapInDeprecationWarning(this.path),this.port=this.wrapInDeprecationWarning(this.port,"window.location"),this.protocol=this.wrapInDeprecationWarning(this.protocol,"window.location"),this.replace=this.wrapInDeprecationWarning(this.replace),this.search=this.wrapInDeprecationWarning(this.search),this.state=this.wrapInDeprecationWarning(this.state),this.url=this.wrapInDeprecationWarning(this.url)}wrapInDeprecationWarning(p,C){let M=this;return function(){return(0,D.l)("$location",p.name,C||"locationService"),p.apply(M,arguments)}}absUrl(){return`${window.location.origin}${this.url()}`}hash(p){if((0,l.Lc)("AngularLocationWrapper",!1,"Angular compat layer: hash"),p)throw new Error("AngularLocationWrapper method not implemented.");return l.Ny.getLocation().hash.slice(1)}host(){return new URL(window.location.href).hostname}path(p){(0,l.Lc)("AngularLocationWrapper",!1,"Angular compat layer: path");const C=l.Ny.getLocation();if(p!=null){let M=String(p);M=M.startsWith("/")?M:`/${M}`;const r=new URL(`${window.location.origin}${M}`);return l.Ny.push({pathname:r.pathname,search:r.search.length>0?r.search:C.search,hash:r.hash.length>0?r.hash:C.hash}),this}return p===null?(l.Ny.push("/"),this):C.pathname}port(){const p=new URL(window.location.href);return parseInt(p.port,10)||y[p.protocol]||null}protocol(){return new URL(window.location.href).protocol.slice(0,-1)}replace(){throw new Error("AngularLocationWrapper method not implemented.")}search(p,C){if((0,l.Lc)("AngularLocationWrapper",!1,"Angular compat layer: search"),!p)return l.Ny.getSearchObject();if(p&&arguments.length>1)return l.Ny.partial({[p]:C}),this;if(p){let M;typeof p=="object"?M={...p}:M=(0,l.SE)(p);for(const u in M)(M[u]===null||M[u]===void 0)&&delete M[u];const r=S.kM.renderUrl(l.Ny.getLocation().pathname,M);l.Ny.push(r)}return this}state(p){throw(0,l.Lc)("AngularLocationWrapper",!1,"Angular compat layer: state"),new Error("AngularLocationWrapper method not implemented.")}url(p){if((0,l.Lc)("AngularLocationWrapper",!1,"Angular compat layer: url"),p!==void 0)return p.startsWith("#")?l.Ny.push({...l.Ny.getLocation(),hash:p}):p.startsWith("?")?l.Ny.push({...l.Ny.getLocation(),search:p}):p.trim().length===0?l.Ny.push("/"):l.Ny.push(p),l.Ny;const C=l.Ny.getLocation();return`${C.pathname}${C.search}${C.hash}`}}},75519:(O,E,i)=>{i.d(E,{F:()=>C});var D=i(2543),S=i.n(D),l=i(39070),y=i(14236),f=i(26272),P=i(70225),p=i(19752);class C extends P.y{constructor(r,u){super(r,u),this.skipDataOnInit=!1,this.dataList=[],this.useDataFrames=!1,this.panelDataObserver={next:m=>{if(this.panelData=m,m.state===l.Gu.Error&&(this.loading=!1,this.processDataError(m.error)),m.state===l.Gu.Loading){this.loading=!0,this.angularDirtyCheck();return}if(m.request){const{timeInfo:R}=m.request;R&&(this.timeInfo=R)}if(m.timeRange&&(this.range=m.timeRange),this.useDataFrames)this.handleDataFrames(m.series);else{const R=m.series.map(L=>(0,y.w3)(L));this.handleQueryResult({data:R})}this.angularDirtyCheck()}},this.contextSrv=u.get("contextSrv"),this.datasourceSrv=u.get("datasourceSrv"),this.timeSrv=u.get("timeSrv"),this.templateSrv=u.get("templateSrv"),this.panel.datasource=this.panel.datasource||null,this.events.on(f.ee.refresh,this.onMetricsPanelRefresh.bind(this)),this.events.on(f.ee.panelTeardown,this.onPanelTearDown.bind(this)),this.events.on(f.ee.componentDidMount,this.onMetricsPanelMounted.bind(this))}onMetricsPanelMounted(){const r=this.panel.getQueryRunner();this.querySubscription=r.getData({withTransforms:!0,withFieldConfig:!0}).subscribe(this.panelDataObserver)}onPanelTearDown(){this.querySubscription&&(this.querySubscription.unsubscribe(),this.querySubscription=null)}onMetricsPanelRefresh(){if(!this.otherPanelInFullscreenMode()){if(this.panel.snapshotData){this.updateTimeRange();let r=this.panel.snapshotData;return(0,D.isArray)(r)||(r=r.data),this.panelData={state:l.Gu.Done,series:r,timeRange:this.range},this.$timeout(()=>{this.events.emit(f.ee.dataSnapshotLoad,r)})}return delete this.error,this.loading=!0,this.datasourceSrv.get(this.panel.datasource,this.panel.scopedVars).then(this.issueQueries.bind(this)).catch(r=>{this.processDataError(r)})}}processDataError(r){if(r.cancelled){console.log("Panel request cancelled",r);return}this.error=r.message||"Request Error",r.data&&(r.data.message?this.error=r.data.message:r.data.error&&(this.error=r.data.error)),this.angularDirtyCheck()}angularDirtyCheck(){this.$scope.$root.$$phase||this.$scope.$digest()}updateTimeRange(r){this.datasource=r||this.datasource,this.range=this.timeSrv.timeRange();const u=(0,p.nk)(this.panel,this.range);this.timeInfo=u.timeInfo,this.range=u.timeRange}issueQueries(r){this.updateTimeRange(r),this.datasource=r;const u=this.panel;return u.getQueryRunner().run({datasource:u.datasource,queries:u.targets,panelId:u.id,dashboardUID:this.dashboard.uid,timezone:this.dashboard.getTimezone(),timeInfo:this.timeInfo,timeRange:this.range,maxDataPoints:u.maxDataPoints||this.width,minInterval:u.interval,scopedVars:u.scopedVars,cacheTimeout:u.cacheTimeout,queryCachingTTL:u.queryCachingTTL,transformations:u.transformations})}handleDataFrames(r){this.loading=!1,this.dashboard&&this.dashboard.snapshot&&(this.panel.snapshotData=r.map(u=>(0,y.Kl)(u)));try{this.events.emit(f.ee.dataFramesReceived,r)}catch(u){this.processDataError(u)}}handleQueryResult(r){this.loading=!1,this.dashboard.snapshot&&(this.panel.snapshotData=r.data),(!r||!r.data)&&(console.log("Data source query result invalid, missing data field:",r),r={data:[]});try{this.events.emit(f.ee.dataReceived,r.data)}catch(u){this.processDataError(u)}}}},70225:(O,E,i)=>{i.d(E,{y:()=>C});var D=i(2543),S=i.n(D),l=i(18226),y=i(26272),f=i(4244),P=i(2913),p=i(10096);class C{constructor(r,u){this.pluginName="",this.pluginId="",this.editModeInitiated=!1,this.loading=!1,this.onPluginTypeChange=R=>{},this.panel=this.panel??r.$parent.panel,this.dashboard=this.dashboard??r.$parent.dashboard,this.$injector=u,this.$scope=r,this.$timeout=u.get("$timeout"),this.editorTabs=[],this.$location=new f.b,this.events=new l.o,this.timing={};const m=P.Ay.panels[this.panel.type];m&&(this.pluginId=m.id,this.pluginName=m.name),r.$on(y.ee.componentDidMount.name,()=>this.panelDidMount())}panelDidMount(){this.events.emit(y.ee.componentDidMount),this.events.emit(y.ee.initialized),this.dashboard.panelInitialized(this.panel)}renderingCompleted(){p.Ef.renderingCompleted()}refresh(){this.panel.refresh()}publishAppEvent(r,u){this.$scope.$root.appEvent(r,u)}initEditMode(){this.editModeInitiated||(this.editModeInitiated=!0,this.events.emit(y.ee.editModeInitialized))}addEditorTab(r,u,m,R){const L={title:r,directiveFn:u,icon:R};(0,D.isString)(u)&&(L.directiveFn=()=>({templateUrl:u})),m?this.editorTabs.splice(m,0,L):this.editorTabs.push(L)}getExtendedMenu(){const r=[];return this.events.emit(y.ee.initPanelActions,r),r}async getAdditionalMenuItems(){return[]}otherPanelInFullscreenMode(){return this.dashboard.otherPanelInFullscreen(this.panel)}render(r){this.events.emit(y.ee.render,r)}}},59559:(O,E,i)=>{i.d(E,{a:()=>l});var D=i(2543),S=i.n(D);class l{constructor(f,P){this.$scope=f,this.$injector=P,this.panelCtrl=this.panelCtrl??f.ctrl.panelCtrl,this.target=this.target??f.ctrl.target,this.datasource=this.datasource??f.ctrl.datasource,this.panel=this.panelCtrl?.panel??f.ctrl.panelCtrl.panel,this.isLastQuery=(0,D.indexOf)(this.panel.targets,this.target)===this.panel.targets.length-1}refresh(){this.panelCtrl.refresh()}}},78491:(O,E,i)=>{i.r(E),i.d(E,{TablePanelCtrl:()=>V,plugin:()=>_});var D=i(34796),S=i.n(D),l=i(2543),y=i(26272),f=i(14236),P=i(65158),p=i(2913),C=i(26260),M=i(5808),r=i(99140),u=i(83195);class m{static{this.alignTypesEnum=[{text:"auto",value:""},{text:"left",value:"left"},{text:"center",value:"center"},{text:"right",value:"right"}]}static{this.$inject=["$scope"]}constructor(e){e.editor=this,this.activeStyleIndex=0,this.panelCtrl=e.ctrl,this.panel=this.panelCtrl.panel,this.unitFormats=(0,u.Ke)(),this.colorModes=[{text:"Disabled",value:null},{text:"Cell",value:"cell"},{text:"Value",value:"value"},{text:"Row",value:"row"}],this.columnTypes=[{text:"Number",value:"number"},{text:"String",value:"string"},{text:"Date",value:"date"},{text:"Hidden",value:"hidden"}],this.fontSizes=["80%","90%","100%","110%","120%","130%","150%","160%","180%","200%","220%","250%"],this.dateFormats=[{text:"YYYY-MM-DD HH:mm:ss",value:"YYYY-MM-DD HH:mm:ss"},{text:"YYYY-MM-DD HH:mm:ss.SSS",value:"YYYY-MM-DD HH:mm:ss.SSS"},{text:"MM/DD/YY h:mm:ss a",value:"MM/DD/YY h:mm:ss a"},{text:"MMMM D, YYYY LT",value:"MMMM D, YYYY LT"},{text:"YYYY-MM-DD",value:"YYYY-MM-DD"}],this.mappingTypes=[{text:"Value to text",value:1},{text:"Range to text",value:2}],this.alignTypes=m.alignTypesEnum,this.getColumnNames=()=>this.panelCtrl.table?(0,l.map)(this.panelCtrl.table.columns,t=>t.text):[],this.onColorChange=this.onColorChange.bind(this)}render(){this.panelCtrl.render()}setUnitFormat(e){return t=>{e.unit=t,this.panelCtrl.render()}}addColumnStyle(){const e={unit:"short",type:"number",alias:"",decimals:2,colors:["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],colorMode:null,pattern:"",dateFormat:"YYYY-MM-DD HH:mm:ss",thresholds:[],mappingType:1,align:"auto"},t=this.panel.styles,s=t.length;let n=s;s>0&&t[s-1].pattern==="/.*/"&&(n=s-1),t.splice(n,0,e),this.activeStyleIndex=n}removeColumnStyle(e){this.panel.styles=(0,l.without)(this.panel.styles,e)}invertColorOrder(e){const t=this.panel.styles[e].colors,s=t[0];t[0]=t[2],t[2]=s,this.panelCtrl.render()}onColorChange(e,t){return s=>{e.colors[t]=s,this.render()}}addValueMap(e){e.valueMaps||(e.valueMaps=[]),e.valueMaps.push({value:"",text:""}),this.panelCtrl.render()}removeValueMap(e,t){e.valueMaps.splice(t,1),this.panelCtrl.render()}addRangeMap(e){e.rangeMaps||(e.rangeMaps=[]),e.rangeMaps.push({from:"",to:"",text:""}),this.panelCtrl.render()}removeRangeMap(e,t){e.rangeMaps.splice(t,1),this.panelCtrl.render()}}function R(){"use strict";return{restrict:"E",scope:!0,templateUrl:"public/app/plugins/panel/table-old/column_options.html",controller:m}}var L=i(91950),Q=i(31140),z=i(78827);const I={},N=h=>Array.isArray(h)?h.reduce((e,t)=>t.datapoints?e.concat(t):e,[]):h.datapoints?[h]:[],H=h=>Array.isArray(h)?h.reduce((e,t)=>t.columns?e.concat(t):e,[]):h.columns?[h]:[];I.timeseries_to_rows={description:"Time series to rows",getColumns:()=>[],transform:(h,e,t)=>{t.columns=[{text:"Time",type:"date"},{text:"Metric"},{text:"Value"}];const s=N(h);for(let n=0;n<s.length;n++){const a=s[n];for(let o=0;o<a.datapoints.length;o++){const c=a.datapoints[o];t.rows.push([c[1],a.target,c[0]])}}}},I.timeseries_to_columns={description:"Time series to columns",getColumns:()=>[],transform:(h,e,t)=>{t.columns.push({text:"Time",type:"date"});const s={},n=N(h);for(let a=0;a<n.length;a++){const o=n[a];t.columns.push({text:o.target});for(let c=0;c<o.datapoints.length;c++){const d=o.datapoints[c],b=d[1].toString();s[b]||(s[b]={time:d[1]}),s[b][a]=d[0]}}for(const a in s){const o=s[a],c=[o.time];for(let d=0;d<n.length;d++){const b=o[d];c.push(b)}t.rows.push(c)}}},I.timeseries_aggregations={description:"Time series aggregations",getColumns:()=>[{text:"Avg",value:"avg"},{text:"Min",value:"min"},{text:"Max",value:"max"},{text:"Total",value:"total"},{text:"Current",value:"current"},{text:"Count",value:"count"}],transform:(h,e,t)=>{let s,n;for(t.columns.push({text:"Metric"}),s=0;s<e.columns.length;s++)t.columns.push({text:e.columns[s].text});const a=N(h);for(s=0;s<a.length;s++){const o=new Q.A({datapoints:a[s].datapoints,alias:a[s].target});o.getFlotPairs("connected");const c=[o.alias];for(n=0;n<e.columns.length;n++)c.push(o.stats[e.columns[n].value]);t.rows.push(c)}}},I.annotations={description:"Annotations",getColumns:()=>[],transform:(h,e,t)=>{if(t.columns.push({text:"Time",type:"date"}),t.columns.push({text:"Title"}),t.columns.push({text:"Text"}),t.columns.push({text:"Tags"}),!(!h||!h.annotations||h.annotations.length===0))for(let s=0;s<h.annotations.length;s++){const n=h.annotations[s];t.rows.push([n.time,n.title,n.text,n.tags])}}},I.table={description:"Table",getColumns:h=>{if(!h||h.length===0)return[];if(h.length===1)return[...h[0].columns];const e=H(h),t={};return e.reduce((n,a)=>(a.columns.forEach(o=>{const{text:c}=o;t[c]===void 0&&(t[c]=n.length,n.push(o))}),n),[])},transform:(h,e,t)=>{if(!h||h.length===0)return;const s=H(h),n=(0,l.findIndex)(s,a=>"columns"in a&&"rows"in a);if(n<0)throw{message:`Result of query #${String.fromCharCode(65+n)} is not in table format, try using another transform.`};(0,L.f)(t,...s)}},I.json={description:"JSON Data",getColumns:h=>{if(!h||h.length===0)return[];const e={};for(let t=0;t<h.length;t++){const s=h[t];if(s.type!=="docs")continue;const n=Math.min(s.datapoints.length,100);for(let a=0;a<n;a++){const o=s.datapoints[a],c=(0,z.default)(o,{});for(const d in c)e[d]=!0}}return(0,l.map)(e,(t,s)=>({text:s,value:s}))},transform:(h,e,t)=>{let s,n,a;for(const o of e.columns){const c={text:o.text};h.length>0&&h[0].filterable&&(c.filterable=!0),t.columns.push(c)}for(t.columns.length===0&&t.columns.push({text:"JSON"}),s=0;s<h.length;s++){const o=h[s];for(n=0;n<o.datapoints.length;n++){const c=o.datapoints[n],d=[];if((0,l.isObject)(c)&&e.columns.length>0){const b=(0,z.default)(c);for(a=0;a<e.columns.length;a++)d.push(b[e.columns[a].value])}else d.push(JSON.stringify(c));t.rows.push(d)}}}};function k(h,e){const t=new L.A;if(!h||h.length===0)return t;const s=I[e.transform];if(!s)throw{message:"Transformer "+e.transform+" not found"};return s.transform(h,e,t),t}class Z{constructor(e,t){this.uiSegmentSrv=t,this.canSetColumns=!1,this.columnsHelpMessage="",e.editor=this,this.panelCtrl=e.ctrl,this.panel=this.panelCtrl.panel,this.transformers=I,this.fontSizes=["80%","90%","100%","110%","120%","130%","150%","160%","180%","200%","220%","250%"],this.addColumnSegment=t.newPlusButton(),this.updateTransformHints()}static{this.$inject=["$scope","uiSegmentSrv"]}updateTransformHints(){switch(this.canSetColumns=!1,this.columnsHelpMessage="",this.panel.transform){case"timeseries_aggregations":{this.canSetColumns=!0;break}case"json":{this.canSetColumns=!0;break}case"table":this.columnsHelpMessage="Columns and their order are determined by the data query"}}getColumnOptions(){if(!this.panelCtrl.dataRaw)return Promise.resolve([]);const e=this.transformers[this.panel.transform].getColumns(this.panelCtrl.dataRaw),t=(0,l.map)(e,s=>this.uiSegmentSrv.newSegment({value:s.text}));return Promise.resolve(t)}addColumn(){const e=I[this.panel.transform].getColumns(this.panelCtrl.dataRaw),t=(0,l.find)(e,{text:this.addColumnSegment.value});t&&(this.panel.columns.push(t),this.render());const s=this.uiSegmentSrv.newPlusButton();this.addColumnSegment.html=s.html,this.addColumnSegment.value=s.value}transformChanged(){this.panel.columns=[],this.panel.transform==="annotations"?this.panelCtrl.refresh():(this.panel.transform==="timeseries_aggregations"&&this.panel.columns.push({text:"Avg",value:"avg"}),this.updateTransformHints(),this.render())}render(){this.panelCtrl.render()}removeColumn(e){this.panel.columns=(0,l.without)(this.panel.columns,e),this.panelCtrl.render()}}function J(){"use strict";return{restrict:"E",scope:!0,templateUrl:"public/app/plugins/panel/table-old/editor.html",controller:Z}}var W=i(54479),F=i(80997),K=i(72724),G=i(72574);class X{constructor(e,t,s,n,a=(0,G.w)(),o){this.panel=e,this.table=t,this.timeZone=s,this.sanitize=n,this.templateSrv=a,this.theme=o,this.formatters=[],this.colorState={},this.initColumns()}setTable(e){this.table=e,this.initColumns()}initColumns(){this.formatters=[],this.colorState={};for(let e=0;e<this.table.columns.length;e++){const t=this.table.columns[e];t.title=t.text;for(let s=0;s<this.panel.styles.length;s++){const n=this.panel.styles[s],a=(0,W.AP)(n.pattern)?n.pattern:(0,W.jD)((0,W.xb)(n.pattern)),o=(0,W.dO)(a);if(t.text.match(o)){t.style=n,n.alias&&(t.title=F.sQ.escapeHtml(t.text.replace(o,n.alias)));break}}this.formatters[e]=this.createColumnFormatter(t)}}getColorForValue(e,t){if(!t.thresholds||!t.colors)return null;for(let s=t.thresholds.length;s>0;s--)if(e>=t.thresholds[s-1])return this.theme.visualization.getColorByName(t.colors[s]);return this.theme.visualization.getColorByName((0,l.first)(t.colors))}defaultCellFormatter(e,t){return e==null||e===void 0?"":((0,l.isArray)(e)&&(e=e.join(", ")),t&&t.sanitize?this.sanitize(e):(0,l.escape)(e))}createColumnFormatter(e){if(!e.style)return this.defaultCellFormatter;if(e.style.type==="hidden")return t=>{};if(e.style.type==="date")return t=>t==null?"-":((0,l.isArray)(t)&&(t=t[0]),(0,l.isString)(t)&&!isNaN(t)&&t.length>12&&(t=parseInt(t,10)),e.style.dateFormat?(0,K.LE)(t,{format:e.style.dateFormat,timeZone:this.timeZone}):(0,K.M7)(t,{timeZone:this.timeZone}));if(e.style.type==="string")return t=>{(0,l.isArray)(t)&&(t=t.join(", "));const s=e.style.mappingType||0;if(s===1&&e.style.valueMaps)for(let n=0;n<e.style.valueMaps.length;n++){const a=e.style.valueMaps[n];if(t===null){if(a.value==="null")return a.text;continue}if(!(0,l.isString)(t)&&Number(a.value)===Number(t)||a.value===t)return this.setColorState(t,e.style),this.defaultCellFormatter(a.text,e.style)}if(s===2&&e.style.rangeMaps)for(let n=0;n<e.style.rangeMaps.length;n++){const a=e.style.rangeMaps[n];if(t===null){if(a.from==="null"&&a.to==="null")return a.text;continue}if(Number(a.from)<=Number(t)&&Number(a.to)>=Number(t))return this.setColorState(t,e.style),this.defaultCellFormatter(a.text,e.style)}return t==null?"-":(this.setColorState(t,e.style),this.defaultCellFormatter(t,e.style))};if(e.style.type==="number"){const t=(0,u.j_)(e.unit||e.style.unit);return s=>s==null?"-":isNaN(s)||(0,l.isArray)(s)?this.defaultCellFormatter(s,e.style):(this.setColorState(s,e.style),(0,u.cN)(t(s,e.style.decimals,null)))}return t=>this.defaultCellFormatter(t,e.style)}setColorState(e,t){if(!t.colorMode||e==null||(0,l.isArray)(e))return;const s=Number(e);isNaN(s)||(this.colorState[t.colorMode]=this.getColorForValue(s,t))}renderRowVariables(e){const t={};let s;const n=this.table.rows[e];for(let a=0;a<n.length;a++)s=`__cell_${a}`,t[s]={value:n[a],text:n[a]?n[a].toString():""};return t}formatColumnValue(e,t){const s=this.formatters[e];return s?s(t):t}renderCell(e,t,s,n=!1){s=this.formatColumnValue(e,s);const a=this.table.columns[e],o=[];let c="";const d=[];let b="";this.colorState.cell?(o.push("background-color:"+this.colorState.cell),d.push("table-panel-color-cell"),this.colorState.cell=null):this.colorState.value&&(o.push("color:"+this.colorState.value),this.colorState.value=null);let g="";if(n&&(g='<div class="table-panel-width-hack">'+this.table.columns[e].title+"</div>"),s===void 0?(o.push("display:none"),a.hidden=!0):a.hidden=!1,a.hidden===!0)return"";if(a.style&&a.style.preserveFormat&&d.push("table-panel-cell-pre"),a.style&&a.style.align){const T=(0,l.find)(m.alignTypesEnum,["text",a.style.align]);T&&T.value&&o.push(`text-align:${T.value}`)}if(o.length&&(c=' style="'+o.join(";")+'"'),a.style&&a.style.link){const T=this.renderRowVariables(t);T.__cell={value:s,text:s?s.toString():""};const w=this.templateSrv.replace(a.style.linkUrl,T,encodeURIComponent),$=F.sQ.sanitizeUrl(w),U=F.sQ.escapeHtml(this.templateSrv.replace(a.style.linkTooltip,T)),v=a.style.linkTargetBlank?"_blank":"";d.push("table-panel-cell-link"),g+=`<a href="${$}" target="${v}" data-link-tooltip data-original-title="${U}" data-placement="right"${c}>`,g+=`${s}`,g+="</a>"}else g+=s;return a.filterable&&(d.push("table-panel-cell-filterable"),g+=`<a class="table-panel-filter-link" data-link-tooltip data-original-title="Filter out value" data-placement="bottom"
           data-row="${t}" data-column="${e}" data-operator="!=">`,g+='<i class="fa fa-search-minus"></i>',g+="</a>",g+=`<a class="table-panel-filter-link" data-link-tooltip data-original-title="Filter for value" data-placement="bottom"
           data-row="${t}" data-column="${e}" data-operator="=">`,g+='<i class="fa fa-search-plus"></i>',g+="</a>"),d.length&&(b=' class="'+d.join(" ")+'"'),g="<td"+b+c+">"+g+"</td>",g}render(e){const t=this.panel.pageSize||100,s=e*t,n=Math.min(s+t,this.table.rows.length);let a="";for(let o=s;o<n;o++){const c=this.table.rows[o];let d="",b="";const g=[];let T="";for(let w=0;w<this.table.columns.length;w++)d+=this.renderCell(w,o,c[w],o===s);this.colorState.row&&(b=' style="background-color:'+this.colorState.row+'"',g.push("table-panel-color-row"),this.colorState.row=null),g.length&&(T=' class="'+g.join(" ")+'"'),a+="<tr "+T+b+">"+d+"</tr>"}return a}render_values(){const e=[],t=this.table.columns.filter(s=>!s.hidden);for(let s=0;s<this.table.rows.length;s++){const n=this.table.rows[s],a=[];for(let o=0;o<this.table.columns.length;o++)this.table.columns[o].hidden||a.push(this.formatColumnValue(o,n[o]));e.push(a)}return{columns:t,rows:e}}}class V extends M.MetricsPanelCtrl{constructor(e,t,s,n){super(e,t),this.annotationsSrv=s,this.$sanitize=n,this.panelDefaults={targets:[{}],transform:"timeseries_to_columns",pageSize:null,showHeader:!0,styles:[{type:"date",pattern:"Time",alias:"Time",dateFormat:"YYYY-MM-DD HH:mm:ss",align:"auto"},{unit:"short",type:"number",alias:"",decimals:2,colors:["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],colorMode:null,pattern:"/.*/",thresholds:[],align:"right"}],columns:[],fontSize:"100%",sort:{col:0,desc:!0}},this.pageIndex=0,this.panel.styles===void 0&&(this.panel.styles=this.panel.columns,this.panel.columns=this.panel.fields,delete this.panel.columns,delete this.panel.fields),(0,l.defaults)(this.panel,this.panelDefaults),this.panelHasRowColorMode=!!this.panel.styles.find(a=>a.colorMode==="row"),this.panelHasLinks=!!this.panel.styles.find(a=>a.link),this.events.on(y.ee.dataReceived,this.onDataReceived.bind(this)),this.events.on(y.ee.dataSnapshotLoad,this.onDataReceived.bind(this)),this.events.on(y.ee.editModeInitialized,this.onInitEditMode.bind(this))}static{this.templateUrl="module.html"}static{this.$inject=["$scope","$injector","annotationsSrv","$sanitize"]}onInitEditMode(){this.addEditorTab("Options",J,2),this.addEditorTab("Column Styles",R,3)}migrateToPanel(e){this.onPluginTypeChange(p.Ay.panels[e])}issueQueries(e){return this.pageIndex=0,this.panel.transform==="annotations"?this.annotationsSrv.getAnnotations({dashboard:this.dashboard,panel:this.panel,range:this.range}).then(t=>{this.loading=!1,this.dataRaw=t,this.pageIndex=0,this.render()}):super.issueQueries(e)}onDataReceived(e){this.dataRaw=e,this.pageIndex=0,this.dataRaw&&this.dataRaw.length&&((0,f.pH)(this.dataRaw[0])?this.panel.transform="table":this.dataRaw[0].type==="docs"?this.panel.transform="json":(this.panel.transform==="table"||this.panel.transform==="json")&&(this.panel.transform="timeseries_to_rows")),this.render()}render(){return this.table=k(this.dataRaw,this.panel),this.table.sort(this.panel.sort),this.renderer=new X(this.panel,this.table,this.dashboard.getTimezone(),this.$sanitize,this.templateSrv,p.Ay.theme2),super.render(this.table)}toggleColumnSort(e,t){this.table.columns[this.panel.sort.col]&&(this.table.columns[this.panel.sort.col].sort=!1),this.panel.sort.col===t?this.panel.sort.desc?this.panel.sort.desc=!1:this.panel.sort.col=null:(this.panel.sort.col=t,this.panel.sort.desc=!0),this.render()}link(e,t,s,n){let a;const o=n.panel;let c=0;function d(){let v=n.height;return c>1&&(v-=26),v-31+"px"}function b(v){n.renderer.setTable(a),v.empty(),v.html(n.renderer.render(n.pageIndex))}function g(v){const x=S()(v.currentTarget);n.pageIndex=parseInt(x.text(),10)-1,w()}function T(v){v.empty();const x=o.pageSize||100;if(c=Math.ceil(a.rows.length/x),c===1)return;const A=Math.max(n.pageIndex-3,0),B=Math.min(c,A+9),j=S()("<ul></ul>");for(let Y=A;Y<B;Y++){const q=Y===n.pageIndex?"active":"",tt=S()('<li><a class="table-panel-page-link pointer '+q+'">'+(Y+1)+"</a></li>");j.append(tt)}v.append(j)}function w(){const v=t.parents(".panel-content"),x=t.find(".table-panel-scroll"),A=t.find("tbody"),B=t.find(".table-panel-footer");t.css({"font-size":o.fontSize}),v.addClass("table-panel-content"),b(A),T(B),x.css({"max-height":d()})}t.tooltip({selector:"[data-link-tooltip]"});function $(v){const x=S()(v.currentTarget).data(),A={datasource:o.datasource,key:a.columns[x.column].text,value:a.rows[x.row][x.column],operator:x.operator};(0,r.JD)((0,C.z_)(A))}t.on("click",".table-panel-page-link",g),t.on("click",".table-panel-filter-link",$);const U=e.$on("$destroy",()=>{t.off("click",".table-panel-page-link"),t.off("click",".table-panel-filter-link"),U()});n.events.on(y.ee.render,v=>{a=v||a,a&&w(),n.renderingCompleted()})}}const _=new P.m(null);_.angularPanelCtrl=V,_.setNoPadding()},5808:(O,E,i)=>{i.r(E),i.d(E,{MetricsPanelCtrl:()=>p,PanelCtrl:()=>P,QueryCtrl:()=>C,loadPluginCss:()=>S.PL});var D=i(92341),S=i(89191),l=i(75519),y=i(70225),f=i(59559);const P=(0,D.Y)(y.y),p=(0,D.Y)(l.F),C=(0,D.Y)(f.a)}}]);

//# sourceMappingURL=tableOldPlugin.476c7b81c7d2b869780a.js.map