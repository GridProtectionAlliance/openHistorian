"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3648],{39408:(N,S,t)=>{t.d(S,{l:()=>b});var T=t(89667),n=t(17172);async function b(){return(0,n.AI)().get("api/live/list").then(I=>{const Q=I.channels??[],y={},j=Q.map(g=>{if(g.data){const v=new Set,R=(0,T.or)(g.data);for(const p of R.fields)v.add(p.name);y[g.channel]=Array.from(v).map(p=>({value:p,label:p}))}return{value:g.channel,label:g.channel+" ["+g.minute_rate+" msg/min]"}});return{channelFields:y,channels:j}})}},62391:(N,S,t)=>{t.r(S),t.d(S,{plugin:()=>q});var T=t(40187),n=t(74848),b=t(32196),I=t(55127),Q=t.n(I),y=t(96540),j=t(65879),g=t(89667),v=t(83195),R=t(14110),p=t(32264),V=t(19347),m=t(14186),x=t(90182),$=t(67061),L=t(10354),A=t(42418),F=t(39268),B=t(76892),D=t(37270),z=t(40845),O=t(2913),E=t(40489),P=t(39408),h=t(68706),U=t(32372);function M({value:f,onChange:r}){const[e,s]=(0,y.useState)(""),[a,l]=(0,y.useState)(f.query??"");(0,y.useEffect)(()=>{s(JSON.stringify({...{query:"*",location:"",ds_uid:"",sort:"",tags:[],kind:[],explain:!1,facet:[{field:"kind"},{field:"tags"}],from:0,limit:20},...f},null,2))},[f]);const o=()=>{a!==f.query&&r({...f,query:a})},i=c=>{c.key==="Enter"&&o()},d=c=>{try{const u=JSON.parse(c);r(u),l(u.query??"")}catch(u){console.log("UNABLE TO parse search",c,u)}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(F.C,{children:(0,n.jsx)(m.I,{label:"Query",grow:!0,labelWidth:12,children:(0,n.jsx)(L.p,{placeholder:"Everything",value:a,onChange:c=>l(c.currentTarget.value),onKeyDown:i,onBlur:o,spellCheck:!1})})}),(0,n.jsx)(U.B,{height:300,language:"json",value:e,onBlur:d,onSave:d,showMiniMap:!1,showLineNumbers:!0})]})}const C=12;class K extends y.PureComponent{constructor(r){super(r),this.state={channels:[],channelFields:{}},this.queryTypes=[{label:"Random Walk",value:h.nj.RandomWalk,description:"Random signal within the selected time range"},{label:"Live Measurements",value:h.nj.LiveMeasurements,description:"Stream real-time measurements from Grafana"},{label:"List public files",value:h.nj.List,description:"Show directory listings for public resources"}],this.onQueryTypeChange=e=>{const{onChange:s,query:a,onRunQuery:l}=this.props;s({...a,queryType:e.value}),l(),this.loadChannelInfo()},this.onChannelChange=e=>{const{onChange:s,query:a,onRunQuery:l}=this.props;s({...a,channel:e?.value}),l()},this.onFieldNamesChange=e=>{const{onChange:s,query:a,onRunQuery:l}=this.props;let o=[];if(Array.isArray(e)?o=e.map(i=>i.value):e.value&&(o=[e.value]),o.length===1&&!a.filter?.fields?.length&&a.channel){const d=(this.state.channelFields[a.channel]??[]).find(c=>c.value==="time"||c.value==="Time");d&&d.value&&d.value!==o[0]&&(o=[d.value,...o])}s({...a,filter:{...a.filter,fields:o}}),l()},this.checkAndUpdateValue=(e,s)=>{const{onChange:a,query:l,onRunQuery:o}=this.props;if(e==="buffer"){let i;if(s)try{i=j.intervalToSeconds(s)*1e3}catch(d){console.warn("ERROR",d)}a({...l,buffer:i})}else a({...l,[e]:s});o()},this.handleEnterKey=e=>{e.key==="Enter"&&this.checkAndUpdateValue("buffer",e.currentTarget.value)},this.handleBlur=e=>{this.checkAndUpdateValue("buffer",e.currentTarget.value)},this.onFolderChanged=e=>{const{onChange:s,query:a,onRunQuery:l}=this.props;s({...a,path:e?.value}),l()},this.fileListRenderer=(e,s)=>null,this.onFileDrop=(e,s,a)=>{E.vI(e).subscribe(l=>{const o=[];l.dataFrames.forEach(i=>{const d=(0,g.Nw)(i);o.push(d)}),this.props.onChange({...this.props.query,file:{name:l.file.name,size:l.file.size},queryType:h.nj.Snapshot,snapshot:o}),this.props.onRunQuery(),(0,R.rR)("grafana_datasource_drop_files",{number_of_files:s.length+e.length,accepted_files:e.map(i=>({type:i.type,size:i.size})),rejected_files:s.map(i=>({type:i.file.type,size:i.file.size}))})})},this.onSearchChange=e=>{const{query:s,onChange:a,onRunQuery:l}=this.props;a({...s,search:e}),l()},this.onSearchNextChange=e=>{const{query:s,onChange:a,onRunQuery:l}=this.props;a({...s,searchNext:e}),l()},p.$.featureToggles.panelTitleSearch&&O.yn&&this.queryTypes.push({label:"Search",value:h.nj.Search,description:"Search for grafana resources"}),p.$.featureToggles.unifiedStorageSearch&&this.queryTypes.push({label:"Search (experimental)",value:h.nj.SearchNext,description:"Search for grafana resources"}),p.$.featureToggles.editPanelCSVDragAndDrop&&this.queryTypes.push({label:"Spreadsheet or snapshot",value:h.nj.Snapshot,description:"Query an uploaded spreadsheet or a snapshot"})}loadChannelInfo(){(0,P.l)().then(r=>{this.setState(r)})}loadFolderInfo(){const r={targets:[{queryType:h.nj.List,refId:"A"}]};(0,V.l)().get("-- Grafana --").then(e=>{e.query(r).subscribe({next:a=>{if(a.data.length){const o=a.data[0].fields[0].values.map(i=>({value:i,label:i}));this.setState({folders:o})}}})})}componentDidMount(){this.loadChannelInfo()}renderMeasurementsQuery(){let{channel:r,filter:e,buffer:s}=this.props.query,{channels:a,channelFields:l}=this.state,o=a.find(u=>u.value===r);r&&!o&&(o={value:r,label:r,description:`Connected to ${r}`},a=[o,...a]);const i=new Set,d=r?l[r]??[]:[];if(e?.fields)for(const u of e.fields)i.has(u)||(d.push({value:u,label:`${u} (not loaded)`,description:"Configured, but not found in the query results"}),i.add(u));let c="";return s&&(c=j.secondsToHms(s/1e3)),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m.I,{label:"Channel",grow:!0,labelWidth:C,children:(0,n.jsx)(x.l6,{options:a,value:o||"",onChange:this.onChannelChange,allowCustomValue:!0,backspaceRemovesValue:!0,placeholder:"Select measurements channel",isClearable:!0,noOptionsMessage:"Enter channel name",formatCreateLabel:u=>`Connect to: ${u}`})}),r&&(0,n.jsxs)($.B,{direction:"row",gap:0,children:[(0,n.jsx)(m.I,{label:"Fields",grow:!0,labelWidth:C,children:(0,n.jsx)(x.l6,{options:d,value:e?.fields||[],onChange:this.onFieldNamesChange,allowCustomValue:!0,backspaceRemovesValue:!0,placeholder:"All fields",isClearable:!0,noOptionsMessage:"Unable to list all fields",formatCreateLabel:u=>`Field: ${u}`,isSearchable:!0,isMulti:!0})}),(0,n.jsx)(m.I,{label:"Buffer",children:(0,n.jsx)(L.p,{placeholder:"Auto",width:12,defaultValue:c,onKeyDown:this.handleEnterKey,onBlur:this.handleBlur,spellCheck:!1})})]}),(0,n.jsx)(A.F,{title:"Grafana Live - Measurements",severity:"info",children:"This supports real-time event streams in Grafana core. This feature is under heavy development. Expect the interfaces and structures to change as this becomes more production ready."})]})}renderListPublicFiles(){let{path:r}=this.props.query,{folders:e}=this.state;e||(e=[],this.loadFolderInfo());const s=e.find(a=>a.value===r);return r&&!s&&(e=[...e,{value:r,label:r}]),(0,n.jsx)(F.C,{children:(0,n.jsx)(m.I,{label:"Path",grow:!0,labelWidth:C,children:(0,n.jsx)(x.l6,{options:e,value:s||"",onChange:this.onFolderChanged,allowCustomValue:!0,backspaceRemovesValue:!0,placeholder:"Select folder",isClearable:!0,formatCreateLabel:a=>`Folder: ${a}`})})})}renderSnapshotQuery(){const{query:r,theme:e}=this.props,s=r.file,a=W(e),l=(0,v.j_)("decbytes")(s?s.size:0);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(F.C,{children:(0,n.jsx)(m.I,{label:"Snapshot",grow:!0,labelWidth:C,children:(0,n.jsx)(B.c,{children:Q()("frame",r.snapshot?.length??0,!0)})})}),p.$.featureToggles.editPanelCSVDragAndDrop&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(D.gH,{readAs:"readAsArrayBuffer",fileListRenderer:this.fileListRenderer,options:{onDrop:this.onFileDrop,maxSize:E.o2,multiple:!1,accept:E.ZF},children:(0,n.jsx)(D.wI,{primaryText:this.props?.query?.file?"Replace file":"Drop file here or click to upload"})}),s&&(0,n.jsxs)("div",{className:a.file,children:[(0,n.jsx)("span",{children:s?.name}),(0,n.jsx)("span",{children:(0,n.jsx)("span",{children:(0,v.cN)(l)})})]})]})]})}render(){const r={...h.uJ,...this.props.query},{queryType:e}=r;let s=this.queryTypes;return e===h.nj.Snapshot&&!p.$.featureToggles.editPanelCSVDragAndDrop&&(s=[...this.queryTypes,{label:"Snapshot",value:e}]),(0,n.jsxs)(n.Fragment,{children:[e===h.nj.Search&&(0,n.jsx)(A.F,{title:"Grafana Search",severity:"info",children:"Using this datasource to call the new search system is experimental, and subject to change at any time without notice."}),(0,n.jsx)(F.C,{children:(0,n.jsx)(m.I,{label:"Query type",grow:!0,labelWidth:C,children:(0,n.jsx)(x.l6,{options:s,value:s.find(a=>a.value===e)||s[0],onChange:this.onQueryTypeChange})})}),e===h.nj.LiveMeasurements&&this.renderMeasurementsQuery(),e===h.nj.List&&this.renderListPublicFiles(),e===h.nj.Snapshot&&this.renderSnapshotQuery(),e===h.nj.Search&&(0,n.jsx)(M,{value:r.search??{},onChange:this.onSearchChange}),e===h.nj.SearchNext&&(0,n.jsx)(M,{value:r.searchNext??{},onChange:this.onSearchNextChange})]})}}const J=(0,z.cV)(K);function W(f){return{file:(0,b.css)`
      width: 100%;
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
      padding: ${f.spacing(2)};
      border: 1px dashed ${f.colors.border.medium};
      background-color: ${f.colors.background.secondary};
      margin-top: ${f.spacing(1)};
    `}}var G=t(90183);const q=new T.tD(G.i).setQueryEditor(J)}}]);

//# sourceMappingURL=grafanaPlugin.abd290ae5943e08a7661.js.map