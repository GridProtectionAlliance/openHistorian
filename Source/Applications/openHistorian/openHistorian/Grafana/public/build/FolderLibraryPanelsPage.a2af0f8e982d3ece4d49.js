"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5804],{15111:(x,C,a)=>{a.r(C),a.d(C,{BrowseFolderLibraryPanelsPage:()=>c,default:()=>g});var e=a(74848),h=a(96540),o=a(54148),s=a(21780),P=a(9134),u=a(71101),n=a(16678),O=a(24643),t=a(55314);function c(){const{uid:r=""}=(0,o.g)(),{data:l}=(0,t.kH)(r),[_,M]=(0,h.useState)(void 0),[f]=(0,t.iB)(),d=(0,h.useMemo)(()=>{if(!l)return;const D=(0,u.R4)(l),E=(0,u.pq)(l.uid),i=D.children?.find(v=>v.id===E);return i&&(i.active=!0),D},[l]),m=r?async D=>{if(l){const E=await f({...l,title:D});if("error"in E)throw E.error}}:void 0;return(0,e.jsx)(s.YW,{navId:"dashboards/browse",pageNav:d,onEditTitle:m,actions:(0,e.jsx)(e.Fragment,{children:l&&(0,e.jsx)(P.m,{folder:l})}),children:(0,e.jsxs)(s.YW.Contents,{children:[(0,e.jsx)(n.j,{onClick:M,currentFolderUID:r,showSecondaryActions:!0,showSort:!0,showPanelFilter:!0}),_?(0,e.jsx)(O.F,{onDismiss:()=>M(void 0),libraryPanel:_}):null]})})}const g=c},18241:(x,C,a)=>{a.d(C,{T:()=>r});var e=a(74848),h=a(96540),o=a(14110),s=a(32264),P=a(96374),u=a(94753),n=a(68402),O=a(42418),t=a(8484),c=a(55314),g=a(43907);const r=({onConfirm:l,onDismiss:_,selectedItems:M,...f})=>{const{data:d}=(0,c.G2)(M),m=!!(d&&(d.alertRule||d.libraryPanel)),[D,E]=(0,h.useState)(!1),i=async()=>{(0,o.rR)("grafana_manage_dashboards_delete_clicked",{item_counts:{dashboard:Object.keys(M.dashboard).length,folder:Object.keys(M.folder).length},source:"browse_dashboards",restore_enabled:s.$.featureToggles.dashboardRestoreUI}),E(!0);try{await l(),E(!1),_()}catch{E(!1)}};return(0,e.jsx)(P.u,{body:(0,e.jsxs)(e.Fragment,{children:[s.$.featureToggles.dashboardRestore&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(u.E,{element:"p",children:(0,e.jsx)(t.x6,{i18nKey:"browse-dashboards.action.delete-modal-restore-dashboards-text",children:"This action will delete the selected folders immediately but the selected dashboards will be marked for deletion in 30 days. Your organization administrator can restore the dashboards anytime before the 30 days expire. Folders cannot be restored."})}),(0,e.jsx)(n.$,{v:2})]}),(0,e.jsx)(u.E,{element:"p",children:(0,e.jsx)(t.x6,{i18nKey:"browse-dashboards.action.delete-modal-text",children:"This action will delete the following content:"})}),(0,e.jsx)(g.x,{selectedItems:M}),(0,e.jsx)(n.$,{v:2})]}),description:(0,e.jsx)(e.Fragment,{children:m?(0,e.jsx)(O.F,{severity:"warning",title:(0,t.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder"),children:(0,e.jsx)(t.x6,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text",children:"One or more folders contain library panels or alert rules. Delete these first in order to proceed."})}):null}),confirmationText:(0,t.t)("browse-dashboards.action.confirmation-text","Delete"),confirmText:D?(0,t.t)("browse-dashboards.action.deleting","Deleting..."):(0,t.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:_,onConfirm:i,title:(0,t.t)("browse-dashboards.action.delete-modal-title","Delete"),...f,disabled:m})}},51887:(x,C,a)=>{a.d(C,{J:()=>r});var e=a(74848),h=a(96540),o=a(37390),s=a(42418),P=a(94753),u=a(68402),n=a(88575),O=a(55852),t=a(36607),c=a(8484),g=a(43907);const r=({onConfirm:l,onDismiss:_,selectedItems:M,...f})=>{const[d,m]=(0,h.useState)(),[D,E]=(0,h.useState)(!1),i=Object.keys(M.folder).filter(I=>M.folder[I]),v=async()=>{if(d!==void 0){E(!0);try{await l(d),E(!1),_()}catch{E(!1)}}};return(0,e.jsxs)(o.a,{title:(0,c.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:_,...f,children:[i.length>0&&(0,e.jsx)(s.F,{severity:"info",title:(0,c.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),(0,e.jsx)(P.E,{element:"p",children:(0,e.jsx)(c.x6,{i18nKey:"browse-dashboards.action.move-modal-text",children:"This action will move the following content:"})}),(0,e.jsx)(g.x,{selectedItems:M}),(0,e.jsx)(u.$,{v:3}),(0,e.jsx)(n.D,{label:(0,c.t)("browse-dashboards.action.move-modal-field-label","Folder name"),children:(0,e.jsx)(t.d,{value:d,excludeUIDs:i,onChange:m})}),(0,e.jsxs)(o.a.ButtonRow,{children:[(0,e.jsx)(O.$n,{onClick:_,variant:"secondary",fill:"outline",children:(0,e.jsx)(c.x6,{i18nKey:"browse-dashboards.action.cancel-button",children:"Cancel"})}),(0,e.jsx)(O.$n,{disabled:d===void 0||D,onClick:v,variant:"primary",children:D?(0,c.t)("browse-dashboards.action.moving","Moving..."):(0,c.t)("browse-dashboards.action.move-button","Move")})]})]})}},9134:(x,C,a)=>{a.d(C,{m:()=>E});var e=a(74848),h=a(96540),o=a(32264),s=a(14110),P=a(39601),u=a(38138),n=a(64539),O=a(83122),t=a(55852),c=a(14578),g=a(87978),r=a(5108),l=a(10096),_=a(8484),M=a(28444),f=a(55314),d=a(49904),m=a(18241),D=a(51887);function E({folder:i}){const[v,I]=(0,h.useState)(!1),[b,B]=(0,h.useState)(!1),[K]=(0,f.aF)(),[T]=(0,f.Ko)(),{canEditFolders:W,canDeleteFolders:A,canViewPermissions:R,canSetPermissions:y}=(0,d.N)(i),U=o.$.featureToggles.nestedFolders&&W,j=async L=>{await K({folder:i,destinationUID:L}),(0,s.rR)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},p=async()=>{await T(i),(0,s.rR)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:L}=i,z=L&&L.length?L[L.length-1].url:"/dashboards";P.Ny.push(z)},F=()=>{l.lE.publish(new M.S8({component:D.J,props:{selectedItems:{folder:{[i.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:j}}))},S=()=>{l.lE.publish(new M.S8({component:m.T,props:{selectedItems:{folder:{[i.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:p}}))},$=(0,_.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),w=(0,_.t)("browse-dashboards.folder-actions-button.move","Move"),N=(0,_.t)("browse-dashboards.folder-actions-button.delete","Delete"),V=(0,e.jsxs)(u.W,{children:[R&&(0,e.jsx)(n.D,{onClick:()=>B(!0),label:$}),U&&(0,e.jsx)(n.D,{onClick:F,label:w}),A&&(0,e.jsx)(n.D,{destructive:!0,onClick:S,label:N})]});return!R&&!U&&!A?null:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(O.m,{overlay:V,onVisibleChange:I,children:(0,e.jsxs)(t.$n,{variant:"secondary",children:[(0,e.jsx)(_.x6,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions",children:"Folder actions"}),(0,e.jsx)(c.I,{name:v?"angle-up":"angle-down"})]})}),b&&(0,e.jsx)(g._,{title:(0,_.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:i.title,onClose:()=>B(!1),size:"md",children:(0,e.jsx)(r.x,{resource:"folders",resourceId:i.uid,canSetPermissions:y})})]})}},49904:(x,C,a)=>{a.d(C,{N:()=>u});var e=a(32264),h=a(10096),o=a(31678);function s(n,O){return O?h.TP.hasPermissionInMetadata(n,O):h.TP.hasPermission(n)}function P(n){return n&&n.uid!=="general"&&!e.$.featureToggles.nestedFolders?!1:e.$.featureToggles.accessActionSets?s(o.AccessControlAction.FoldersCreate,n):!n||n.uid==="general"?s(o.AccessControlAction.FoldersCreate):s(o.AccessControlAction.FoldersCreate)&&s(o.AccessControlAction.FoldersWrite,n)}function u(n){const O=s(o.AccessControlAction.DashboardsCreate,n),t=P(n),c=s(o.AccessControlAction.FoldersDelete,n),g=s(o.AccessControlAction.DashboardsWrite,n),r=s(o.AccessControlAction.FoldersWrite,n),l=s(o.AccessControlAction.FoldersPermissionsWrite,n),_=s(o.AccessControlAction.FoldersPermissionsRead,n);return{canCreateDashboards:O,canCreateFolders:t,canDeleteFolders:c,canEditDashboards:g,canEditFolders:r,canSetPermissions:l,canViewPermissions:_}}},24643:(x,C,a)=>{a.d(C,{F:()=>_});var e=a(74848),h=a(32196),o=a(76459),s=a.n(o),P=a(96540),u=a(76885),n=a(39601),O=a(40845),t=a(37390),c=a(90182),g=a(55852),r=a(8484),l=a(57767);function _({libraryPanel:d,onDismiss:m}){const D=(0,O.of)(f),[E,i]=(0,P.useState)(!1),[v,I]=(0,P.useState)(0),[b,B]=(0,P.useState)(void 0);(0,P.useEffect)(()=>{(async()=>{const R=await(0,l.GN)(d.uid);I(R.length)})()},[d.uid]);const K=(0,P.useCallback)(A=>M(d.uid,A,i),[d.uid]),T=(0,P.useMemo)(()=>s()(K,300,{leading:!0}),[K]),W=A=>{A.preventDefault(),n.Ny.push(u.kM.renderUrl(`/d/${b?.value?.uid}`,{}))};return(0,e.jsxs)(t.a,{title:(0,r.t)("library-panels.modal.title","View panel in dashboard"),onDismiss:m,onClickBackdrop:m,isOpen:!0,children:[(0,e.jsxs)("div",{className:D.container,children:[v===0?(0,e.jsx)("span",{children:(0,e.jsx)(r.x6,{i18nKey:"library-panels.modal.panel-not-linked",children:"Panel is not linked to a dashboard. Add the panel to a dashboard and retry."})}):null,v>0?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{children:(0,e.jsxs)(r.x6,{i18nKey:"library-panels.modal.body",count:v,children:["This panel is being used in ",{count:v}," dashboard. Please choose which dashboard to view the panel in:"]})}),(0,e.jsx)(c.DW,{isClearable:!0,isLoading:E,defaultOptions:!0,loadOptions:T,onChange:B,placeholder:(0,r.t)("library-panels.modal.select-placeholder","Start typing to search for dashboard"),noOptionsMessage:(0,r.t)("library-panels.modal.select-no-options-message","No dashboards found")})]}):null]}),(0,e.jsxs)(t.a.ButtonRow,{children:[(0,e.jsx)(g.$n,{variant:"secondary",onClick:m,fill:"outline",children:(0,e.jsx)(r.x6,{i18nKey:"library-panels.modal.button-cancel",children:"Cancel"})}),(0,e.jsx)(g.$n,{onClick:W,disabled:!b,children:b?(0,r.t)("library-panels.modal.button-view-panel1","View panel in {{label}}...",{label:b?.label}):(0,r.t)("library-panels.modal.button-view-panel2","View panel in dashboard...")})]})]})}async function M(d,m,D){D(!0);const i=(await(0,l.xV)(d)).filter(v=>v.title.toLowerCase().includes(m.toLowerCase())).map(v=>({label:v.title,value:v}));return D(!1),i}function f(d){return{container:(0,h.css)``}}}}]);

//# sourceMappingURL=FolderLibraryPanelsPage.a2af0f8e982d3ece4d49.js.map