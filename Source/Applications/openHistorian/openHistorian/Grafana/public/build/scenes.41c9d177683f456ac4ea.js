"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[207],{54531:(e,t,n)=>{n.r(t),n.d(t,{SceneListPage:()=>l,default:()=>c});n(68404);var i=n(8072),s=n(3490),a=n(69371),r=n(62889),o=n(45916);const l=e=>{let{}=e;const t=(0,r.F)();return(0,o.jsx)(a.T,{navId:"scenes",children:(0,o.jsx)(a.T.Contents,{children:(0,o.jsx)(i.Stack,{direction:"column",children:t.map((e=>(0,o.jsx)(s.Card,{href:`/scenes/${e.state.title}`,children:(0,o.jsx)(s.Card.Heading,{children:e.state.title})},e.state.title)))})})})},c=l},11471:(e,t,n)=>{n.r(t),n.d(t,{ScenePage:()=>r,default:()=>o});n(68404);var i,s=n(62889),a=n(45916);const r=e=>{const t=(0,s.H)(e.match.params.name);return t?(0,a.jsx)(t.Component,{model:t}):i||(i=(0,a.jsx)("h2",{children:"Scene not found"}))},o=r},62889:(e,t,n)=>{n.d(t,{H:()=>pe,F:()=>he});var i=n(43215),s=n(68404),a=n(90923),r=n(3490),o=n(47496),l=n(69371),c=n(52373),d=n(72646),u=n(4203),h=n(34110),g=n(36636),p=n(45916);function f(e){let{model:t,children:n}=e;const i=(0,r.useStyles2)(m),s=t.getSceneEditor(),{hoverObject:a,selectedObject:o}=s.useState();let l=i.wrapper;return(null==a?void 0:a.ref)===t&&(l+=" "+i.hover),(null==o?void 0:o.ref)===t&&(l+=" "+i.selected),(0,p.jsx)("div",{style:{},className:l,onMouseEnter:()=>s.onMouseEnterObject(t),onMouseLeave:()=>s.onMouseLeaveObject(t),onClick:e=>{e.stopPropagation(),s.onSelectObject(t)},children:n})}const m=e=>({wrapper:(0,g.css)({display:"flex",flexGrow:1,padding:8,border:`1px dashed ${e.colors.primary.main}`,cursor:"pointer"}),hover:(0,g.css)({border:`1px solid ${e.colors.primary.border}`}),selected:(0,g.css)({border:`1px solid ${e.colors.error.border}`})});function v(e){var t;let{model:n,isEditing:i}=e;const a=null!==(t=n.constructor.Component)&&void 0!==t?t:b,r=(0,p.jsx)(a,{model:n,isEditing:i});return(0,s.useEffect)((()=>(n.isActive||n.activate(),()=>{n.isActive&&n.deactivate()})),[n]),i?(0,p.jsx)(f,{model:n,children:r}):r}function b(e){return null}class w extends i.BusEventWithPayload{}var x,j,y;function S(e){return void 0!==e.useState}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}y="scene-object-state-change",(j="type")in(x=w)?Object.defineProperty(x,j,{value:y,enumerable:!0,configurable:!0,writable:!0}):x[j]=y;class O{constructor(e){C(this,"subject",new d.x),C(this,"state",void 0),C(this,"parent",void 0),C(this,"subs",new u.w0),C(this,"isActive",void 0),C(this,"events",new i.EventBusSrv),e.key||(e.key=(0,h.Z)()),this.state=e,this.subject.next(e),this.setParent()}get Component(){return v}get Editor(){var e;return null!==(e=this.constructor.Editor)&&void 0!==e?e:()=>null}setParent(){for(const e of Object.values(this.state))if(S(e)&&(e.parent=this),Array.isArray(e))for(const t of e)S(t)&&(t.parent=this)}subscribe(e){return this.subject.subscribe(e)}setState(e){const t=this.state;this.state=Object.assign({},this.state,e),this.setParent(),this.subject.next(this.state),this.getRoot().events.publish(new w({prevState:t,newState:this.state,partialUpdate:e,changedObject:this}))}getRoot(){return this.parent?this.parent.getRoot():this}activate(){this.isActive=!0;const{$data:e}=this.state;e&&!e.isActive&&e.activate()}deactivate(){this.isActive=!1;const{$data:e}=this.state;e&&e.isActive&&e.deactivate(),this.subs.unsubscribe(),this.subs=new u.w0}useState(){return function(e){const t=(0,r.useForceUpdate)();return(0,s.useEffect)((()=>{const n=e.subject.subscribe(t);return()=>n.unsubscribe()}),[e,t]),e.state}(this)}getTimeRange(){const{$timeRange:e}=this.state;if(e)return e;if(this.parent)return this.parent.getTimeRange();throw new Error("No time range found in scene tree")}getData(){const{$data:e}=this.state;if(e)return e;if(this.parent)return this.parent.getData();throw new Error("No data found in scene tree")}getSceneEditor(){const{$editor:e}=this.state;if(e)return e;if(this.parent)return this.parent.getSceneEditor();throw new Error("No editor found in scene tree")}clone(e){const t=Object.assign({},this.state);for(const e in t){const n=t[e];n instanceof O&&(t[e]=n.clone())}if("children"in this.state){const e=[];for(const t of this.state.children)e.push(t.clone());t.children=e}return Object.assign(t,e),new this.constructor(t)}}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class I{constructor(e){R(this,"locationListenerUnsub",void 0),R(this,"stateChangeSub",void 0),R(this,"onLocationUpdate",(e=>{})),R(this,"onStateChanged",(e=>{let{payload:t}=e;const n=t.changedObject;if("getUrlState"in n){const e=n.getUrlState();a.locationService.partial(e,!0)}})),this.stateChangeSub=e.events.subscribe(w,this.onStateChanged),this.locationListenerUnsub=a.locationService.getHistory().listen(this.onLocationUpdate)}cleanUp(){this.stateChangeSub.unsubscribe(),this.locationListenerUnsub()}}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class T extends O{constructor(){super(...arguments),E(this,"urlSyncManager",void 0)}activate(){super.activate(),this.urlSyncManager=new I(this)}deactivate(){super.deactivate(),this.urlSyncManager.cleanUp()}}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}E(T,"Component",(function(e){let{model:t}=e;const{title:n,layout:i,actions:s=[],isEditing:d,$editor:u}=t.useState(),h=(null!=s?s:[]).map((e=>(0,p.jsx)(e.Component,{model:e},e.state.key)));u&&h.push((0,p.jsx)(r.ToolbarButton,{icon:"cog",variant:d?"primary":"default",onClick:()=>t.setState({isEditing:!t.state.isEditing})}));const g=a.config.featureToggles.topnav?(0,p.jsx)(o.A,{pageNav:{text:n},actions:h}):(0,p.jsx)(r.PageToolbar,{title:n,children:h});return(0,p.jsx)(l.T,{navId:"scenes",layout:c.Q.Dashboard,toolbar:g,children:(0,p.jsxs)("div",{style:{flexGrow:1,display:"flex",gap:"8px",overflow:"auto"},children:[(0,p.jsx)(i.Component,{model:i,isEditing:d}),u&&(0,p.jsx)(u.Component,{model:u,isEditing:d})]})})}));class P extends O{}function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}k(P,"Editor",(function(e){let{model:t}=e;const{fontSize:n}=t.useState();return(0,p.jsx)(r.Field,{label:"Font size",children:(0,p.jsx)(r.Input,{type:"number",defaultValue:n,onBlur:e=>t.setState({fontSize:parseInt(e.currentTarget.value,10)})})})})),k(P,"Component",(e=>{let{model:t}=e;const{text:n,fontSize:i=20,align:s="left"}=t.useState(),a={fontSize:i,display:"flex",flexGrow:1,alignItems:"center",padding:16,justifyContent:s};return(0,p.jsx)("div",{style:a,children:n})}));class $ extends O{toggleDirection(){this.setState({direction:"row"===this.state.direction?"column":"row"})}}function z(e){let{item:t,direction:n,isEditing:i}=e;const{size:s}=t.useState();return(0,p.jsx)("div",{style:M(n,s),children:(0,p.jsx)(t.Component,{model:t,isEditing:i})})}function M(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{xSizing:n="fill",ySizing:i="fill"}=t,s={display:"flex",flexDirection:e,minWidth:t.minWidth,minHeight:t.minHeight};return"column"===e?(t.height?s.height=t.height:s.flexGrow="fill"===i?1:0,t.width?s.width=t.width:s.alignSelf="fill"===n?"stretch":"flex-start"):(t.height?s.height=t.height:s.alignSelf="fill"===i?"stretch":"flex-start",t.width?s.width=t.width:s.flexGrow="fill"===n?1:0),s}D($,"Component",(function(e){let{model:t,isEditing:n}=e;const{direction:i="row",children:s}=t.useState();return(0,p.jsx)("div",{style:{flexGrow:1,flexDirection:i,display:"flex",gap:"8px"},children:s.map((e=>(0,p.jsx)(z,{item:e,direction:i,isEditing:n},e.state.key)))})})),D($,"Editor",(function(e){let{model:t}=e;const{direction:n="row"}=t.useState();return(0,p.jsx)(r.Field,{label:"Direction",children:(0,p.jsx)(r.RadioButtonGroup,{options:[{icon:"arrow-right",value:"row"},{icon:"arrow-down",value:"column"}],value:n,onChange:e=>t.setState({direction:e})})})}));class N extends O{}class F extends O{activate(){super.activate(),this.subs.add(this.getData().subscribe({next:e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.state)===i.LoadingState.Done&&this.performRepeat(e.data)}}))}performRepeat(e){const t=this.state.layout.state.children[0],n=[];for(const i of e.series){const s=t.clone({key:`${n.length}`,$data:new N({data:Object.assign({},e,{series:[i]})})});n.push(s)}this.state.layout.setState({children:n})}}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(F,"Component",(e=>{let{model:t,isEditing:n}=e;const{layout:i}=t.useState();return(0,p.jsx)(i.Component,{model:i,isEditing:n})}));var U=n(43961);class q extends O{}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(q,"Component",(function(e){let{model:t}=e;const{hidePicker:n}=t.useState(),i=t.getTimeRange(),s=i.useState();if(n)return null;return(0,p.jsxs)(r.ToolbarButtonRow,{children:[(0,p.jsx)(U.a,{value:s,onChange:i.onTimeRangeChange,timeZone:"browser",fiscalYearStartMonth:0,onMoveBackward:()=>{},onMoveForward:()=>{},onZoom:()=>{},onChangeTimeZone:()=>{},onChangeFiscalYearStartMonth:()=>{}}),(0,p.jsx)(r.RefreshPicker,{onRefresh:i.onRefresh,onIntervalChanged:i.onIntervalChanged})]})}));A(class extends O{},"Component",(e=>{let{model:t}=e;const n=t.useState();return(0,p.jsx)(r.ToolbarButton,{onClick:n.onClick,icon:n.icon})}));class _ extends O{}A(_,"Component",(e=>{let{model:t}=e;const n=t.useState();return(0,p.jsx)(r.Input,{defaultValue:n.value,width:8,onBlur:e=>{t.state.onChange(parseInt(e.currentTarget.value,10))}})}));var B=n(87723);function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class G extends O{constructor(){super(...arguments),L(this,"onSetTimeRange",(e=>{this.getTimeRange().setState({raw:{from:(0,i.toUtc)(e.from),to:(0,i.toUtc)(e.to)},from:(0,i.toUtc)(e.from),to:(0,i.toUtc)(e.to)})}))}}function H(e){let{model:t}=e;const{title:n,pluginId:i,options:s,fieldConfig:o}=t.useState(),{data:l}=t.getData().useState();return(0,p.jsx)(B.Z,{children:e=>{let{width:c,height:d}=e;return c<3||d<3?null:(0,p.jsx)(r.PanelChrome,{title:n,width:c,height:d,children:(e,n)=>(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(a.PanelRenderer,{title:"Raw data",pluginId:i,width:e,height:n,data:l,options:s,fieldConfig:o,onOptionsChange:()=>{},onChangeTimeRange:t.onSetTimeRange})})})}})}function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}L(G,"Component",H),L(G,"Editor",(function(e){let{model:t}=e;const{title:n}=t.useState();return(0,p.jsx)(r.Field,{label:"Title",children:(0,p.jsx)(r.Input,{defaultValue:n,onBlur:e=>t.setState({title:e.currentTarget.value})})})})),H.displayName="ScenePanelRenderer";class V extends O{constructor(){super(...arguments),W(this,"onTimeRangeChange",(e=>{this.setState(e)})),W(this,"onRefresh",(()=>{this.setState(Object.assign({},this.state))})),W(this,"onIntervalChanged",(e=>{}))}getUrlState(){return{from:this.state.raw.from,to:this.state.raw.to}}updateFromUrl(e){}}var Q,Z=n(37812);function Y(e){let{model:t}=e;return(0,p.jsx)(Z.u,{id:"props",title:"Properties",forceOpen:1,children:(0,p.jsx)(t.Editor,{model:t},t.state.key)})}function J(e){let{node:t,selectedObject:n}=e;const i=(0,r.useStyles2)(K),s=t.useState();let a=[];for(const e of Object.keys(s)){const t=s[e];S(t)&&a.push(t)}if("children"in s)for(const e of s.children)a.push(e);const o=t.constructor.name,l=n===t;return(0,p.jsxs)("div",{className:i.node,children:[(0,p.jsxs)("div",{className:i.header,onClick:()=>t.getSceneEditor().onSelectObject(t),children:[(0,p.jsx)("div",{className:i.icon,children:a.length>0&&(Q||(Q=(0,p.jsx)(r.Icon,{name:"angle-down",size:"sm"})))}),(0,p.jsx)("div",{className:(0,g.cx)(i.name,l&&i.selected),children:o})]}),a.length>0&&(0,p.jsx)("div",{className:i.children,children:a.map((e=>(0,p.jsx)(J,{node:e,selectedObject:n},e.state.key)))})]})}const K=e=>({node:(0,g.css)({display:"flex",flexGrow:0,cursor:"pointer",flexDirection:"column",padding:"2px 4px"}),header:(0,g.css)({display:"flex",fontWeight:500}),name:(0,g.css)({}),selected:(0,g.css)({color:e.colors.error.text}),icon:(0,g.css)({width:e.spacing(3),color:e.colors.text.secondary}),children:(0,g.css)({display:"flex",flexDirection:"column",paddingLeft:8})});class X extends O{get Component(){return ee}onMouseEnterObject(e){this.setState({hoverObject:{ref:e}})}onMouseLeaveObject(e){e.parent?this.setState({hoverObject:{ref:e.parent}}):this.setState({hoverObject:void 0})}onSelectObject(e){this.setState({selectedObject:{ref:e}})}}function ee(e){let{model:t,isEditing:n}=e;const{selectedObject:i}=t.useState(),s=(0,r.useStyles2)(te);return n?(0,p.jsxs)("div",{className:s.container,children:[(0,p.jsx)("div",{className:s.tree,children:(0,p.jsx)(J,{node:t.parent,selectedObject:null==i?void 0:i.ref})}),i&&(0,p.jsx)(Y,{model:i.ref})]}):null}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(X,"Component",ee);const te=e=>({container:(0,g.css)({display:"flex",flexGrow:0,border:`1px solid ${e.colors.border.weak}`,background:e.colors.background.primary,width:e.spacing(40),cursor:"pointer",flexDirection:"column"}),tree:(0,g.css)({padding:e.spacing(.25,1)})});var ne=n(82897),ie=n(67436),se=n(78338),ae=n(392);class re extends O{constructor(){super(...arguments),function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(this,"querySub",void 0)}activate(){super.activate();const e=this.getTimeRange();this.subs.add(e.subscribe({next:e=>{this.runWithTimeRange(e)}})),this.state.data||this.runQueries()}deactivate(){super.deactivate(),this.querySub&&(this.querySub.unsubscribe(),this.querySub=void 0)}runQueries(){const e=this.getTimeRange();this.runWithTimeRange(e.state)}async runWithTimeRange(e){const t=(0,ne.cloneDeep)(this.state.queries),n={app:i.CoreApp.Dashboard,requestId:(0,se.t)(),timezone:"browser",panelId:1,dashboardId:1,range:e,interval:"1s",intervalMs:1e3,targets:(0,ne.cloneDeep)(this.state.queries),maxDataPoints:500,scopedVars:{},startTime:Date.now()};try{var s;const a=await async function(e,t){if(e&&e.query)return e;return await(0,ie.ak)().get(e,t)}(t[0].datasource,n.scopedVars);n.targets=n.targets.map((e=>(e.datasource||(e.datasource=a.getRef()),e)));const r=a.interval,o=i.rangeUtil.calculateInterval(e,null!==(s=n.maxDataPoints)&&void 0!==s?s:1e3,r);n.scopedVars=Object.assign({},n.scopedVars,{__interval:{text:o.interval,value:o.interval},__interval_ms:{text:o.intervalMs.toString(),value:o.intervalMs}}),n.interval=o.interval,n.intervalMs=o.intervalMs,this.querySub=(0,ae.v7)(a,n).subscribe({next:e=>{console.log("set data",e,e.state),this.setState({data:e})}})}catch(e){console.error("PanelQueryRunner Error",e)}}}function oe(){const e=new re({queries:[{refId:"A",datasource:{uid:"gdev-testdata",type:"testdata"},seriesCount:2,alias:"__server_names",scenarioId:"random_walk"}]});return new T({title:"Panel repeater test",layout:new F({layout:new $({direction:"column",children:[new $({size:{minHeight:200},children:[new G({pluginId:"timeseries",title:"Title",options:{legend:{displayMode:"hidden"}}}),new G({size:{width:300},pluginId:"stat",fieldConfig:{defaults:{displayName:"Last"},overrides:[]},options:{graphMode:"none"}})]})]})}),$editor:new X({}),$timeRange:new V((0,i.getDefaultTimeRange)()),$data:e,actions:[new _({value:"2",onChange:t=>{e.setState({queries:[Object.assign({},e.state.queries[0],{seriesCount:t})]}),e.runQueries()}}),new q({})]})}var le=n(8072);function ce(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class de extends O{constructor(){super(...arguments),ce(this,"onToggle",(()=>{this.setState({isCollapsed:!this.state.isCollapsed,size:Object.assign({},this.state.size,{ySizing:this.state.isCollapsed?"fill":"content"})})})),ce(this,"onRemove",(()=>{const e=this.parent;"children"in e.state&&e.setState({children:e.state.children.filter((e=>e!==this))})}))}}ce(de,"Component",(function(e){let{model:t,isEditing:n}=e;const{title:i,isCollapsed:s,canCollapse:a,canRemove:o,layout:l,actions:c}=t.useState(),d=(0,r.useStyles2)(ue),u=(null!=c?c:[]).map((e=>(0,p.jsx)(e.Component,{model:e},e.state.key)));o&&u.push((0,p.jsx)(r.ToolbarButton,{icon:"times",variant:"default",onClick:t.onRemove,"aria-label":"Remove scene"},"remove-button"));return(0,p.jsxs)("div",{className:d.row,children:[(0,p.jsxs)("div",{className:d.rowHeader,children:[(0,p.jsxs)(le.Stack,{gap:0,children:[(0,p.jsx)("div",{className:d.title,role:"heading",children:i}),a&&(0,p.jsx)("div",{className:d.toggle,children:(0,p.jsx)(r.Button,{size:"sm",icon:s?"angle-down":"angle-up",fill:"text",variant:"secondary","aria-label":s?"Expand scene":"Collapse scene",onClick:t.onToggle})})]}),(0,p.jsx)("div",{className:d.actions,children:u})]}),!s&&(0,p.jsx)(l.Component,{model:l,isEditing:n})]})}));const ue=e=>({row:(0,g.css)({display:"flex",flexDirection:"column",flexGrow:1,gap:e.spacing(1),cursor:"pointer"}),toggle:(0,g.css)({}),title:(0,g.css)({fontSize:e.typography.h5.fontSize}),rowHeader:(0,g.css)({display:"flex",alignItems:"center",gap:e.spacing(2)}),actions:(0,g.css)({display:"flex",alignItems:"center",gap:e.spacing(1),justifyContent:"flex-end",flexGrow:1})});function he(){return[new T({title:"Flex layout test",layout:new $({direction:"row",children:[new G({pluginId:"timeseries",title:"Dynamic height and width",size:{minWidth:"70%"}}),new $({direction:"column",children:[new G({pluginId:"timeseries",title:"Fill height"}),new G({pluginId:"timeseries",title:"Fill height"}),new P({text:"Size to content",fontSize:20,size:{ySizing:"content"},align:"center"}),new G({pluginId:"timeseries",title:"Fixed height",size:{height:300}})]})]}),$editor:new X({}),$timeRange:new V((0,i.getDefaultTimeRange)()),$data:new re({queries:[{refId:"A",datasource:{uid:"gdev-testdata",type:"testdata"},scenarioId:"random_walk"}]}),actions:[new q({})]}),oe(),new T({title:"Nested Scene demo",layout:new $({direction:"column",children:[new G({key:"3",pluginId:"timeseries",title:"Panel 3"}),(e="Inner scene",new de({title:e,canRemove:!0,layout:new $({direction:"row",children:[new G({key:"3",pluginId:"timeseries",title:"Data"})]}),$timeRange:new V((0,i.getDefaultTimeRange)()),$data:new re({queries:[{refId:"A",datasource:{uid:"gdev-testdata",type:"testdata"},scenarioId:"random_walk"}]}),actions:[new q({})]}))]}),$timeRange:new V((0,i.getDefaultTimeRange)()),$data:new re({queries:[{refId:"A",datasource:{uid:"gdev-testdata",type:"testdata"},scenarioId:"random_walk"}]}),actions:[new q({})]}),new T({title:"Scene with rows",layout:new $({direction:"column",children:[new de({title:"Overview",canCollapse:!0,layout:new $({direction:"row",children:[new G({pluginId:"timeseries",title:"Fill height"}),new G({pluginId:"timeseries",title:"Fill height"})]})}),new de({title:"More server details",canCollapse:!0,layout:new $({direction:"row",children:[new G({pluginId:"timeseries",title:"Fill height"}),new G({pluginId:"timeseries",title:"Fill height"})]})})]}),$editor:new X({}),$timeRange:new V((0,i.getDefaultTimeRange)()),$data:new re({queries:[{refId:"A",datasource:{uid:"gdev-testdata",type:"testdata"},scenarioId:"random_walk"}]}),actions:[new q({})]})];var e}const ge={};function pe(e){if(ge[e])return ge[e];const t=he().find((t=>t.state.title===e));return t&&(ge[e]=t),t}}}]);
//# sourceMappingURL=scenes.41c9d177683f456ac4ea.js.map