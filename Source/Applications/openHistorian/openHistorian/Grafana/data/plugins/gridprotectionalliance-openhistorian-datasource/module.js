(()=>{"use strict";var e={606:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(559),l=n.n(a),r=n(476),o=n.n(r)()(l());o.push([e.id,".dark-box {\n  background-color: rgba(32, 34, 38); \n  padding: 8px; \n  border-radius: 4px;\n  border-color: 1px darkgray;\n}\n\n.dark-box .switch {\n  background-color: blue; /* Change the background color */\n}\n\n.dark-box .switch::before {\n  background-color: white; /* Change the color of the switch thumb */\n}\n\n.dark-button {\n  background-color: rgb(34,37,43); \n  color: rgb(199,204,220); \n}","",{version:3,sources:["webpack://./css/config-editor.css"],names:[],mappings:"AAAA;EACE,kCAAkC;EAClC,YAAY;EACZ,kBAAkB;EAClB,0BAA0B;AAC5B;;AAEA;EACE,sBAAsB,EAAE,gCAAgC;AAC1D;;AAEA;EACE,uBAAuB,EAAE,yCAAyC;AACpE;;AAEA;EACE,+BAA+B;EAC/B,uBAAuB;AACzB",sourcesContent:[".dark-box {\n  background-color: rgba(32, 34, 38); \n  padding: 8px; \n  border-radius: 4px;\n  border-color: 1px darkgray;\n}\n\n.dark-box .switch {\n  background-color: blue; /* Change the background color */\n}\n\n.dark-box .switch::before {\n  background-color: white; /* Change the color of the switch thumb */\n}\n\n.dark-button {\n  background-color: rgb(34,37,43); \n  color: rgb(199,204,220); \n}"],sourceRoot:""}]);const i=o},413:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(559),l=n.n(a),r=n(476),o=n.n(r)()(l());o.push([e.id,".dark-box {\n    background-color: rgba(17, 18, 23);\n    padding: 6px;\n    border-radius: 2px;\n    border: 1px solid darkgray;\n    display: flex;\n    align-items: center;\n}\n  \n.dark-box span {\n    margin: 0;\n    padding: 2px; \n}\n\n.auto-width {\n    width: auto;\n}\n  \n  ","",{version:3,sources:["webpack://./css/query-editor.css"],names:[],mappings:"AAAA;IACI,kCAAkC;IAClC,YAAY;IACZ,kBAAkB;IAClB,0BAA0B;IAC1B,aAAa;IACb,mBAAmB;AACvB;;AAEA;IACI,SAAS;IACT,YAAY;AAChB;;AAEA;IACI,WAAW;AACf",sourcesContent:[".dark-box {\n    background-color: rgba(17, 18, 23);\n    padding: 6px;\n    border-radius: 2px;\n    border: 1px solid darkgray;\n    display: flex;\n    align-items: center;\n}\n  \n.dark-box span {\n    margin: 0;\n    padding: 2px; \n}\n\n.auto-width {\n    width: auto;\n}\n  \n  "],sourceRoot:""}]);const i=o},476:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",a=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),a&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),a&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,a,l,r){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(a)for(var i=0;i<this.length;i++){var u=this[i][0];null!=u&&(o[u]=!0)}for(var s=0;s<e.length;s++){var d=[].concat(e[s]);a&&o[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),l&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=l):d[4]="".concat(l)),t.push(d))}},t}},559:e=>{e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var a=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),r="/*# ".concat(l," */");return[t].concat([r]).join("\n")}return[t].join("\n")}},892:e=>{var t=[];function n(e){for(var n=-1,a=0;a<t.length;a++)if(t[a].identifier===e){n=a;break}return n}function a(e,a){for(var r={},o=[],i=0;i<e.length;i++){var u=e[i],s=a.base?u[0]+a.base:u[0],d=r[s]||0,c="".concat(s," ").concat(d);r[s]=d+1;var p=n(c),m={css:u[1],media:u[2],sourceMap:u[3],supports:u[4],layer:u[5]};if(-1!==p)t[p].references++,t[p].updater(m);else{var v=l(m,a);a.byIndex=i,t.splice(i,0,{identifier:c,updater:v,references:1})}o.push(c)}return o}function l(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,l){var r=a(e=e||[],l=l||{});return function(e){e=e||[];for(var o=0;o<r.length;o++){var i=n(r[o]);t[i].references--}for(var u=a(e,l),s=0;s<r.length;s++){var d=n(r[s]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=u}}},311:e=>{var t={};e.exports=function(e,n){var a=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(n)}},60:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},192:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},760:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var a="";n.supports&&(a+="@supports (".concat(n.supports,") {")),n.media&&(a+="@media ".concat(n.media," {"));var l=void 0!==n.layer;l&&(a+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),a+=n.css,l&&(a+="}"),n.media&&(a+="}"),n.supports&&(a+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(a,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},865:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(a){var l=t[a];if(void 0!==l)return l.exports;var r=t[a]={id:a,exports:{}};return e[a](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nc=void 0;var a={};(()=>{n.r(a),n.d(a,{plugin:()=>oe});const e=require("@grafana/data"),t=require("@grafana/runtime"),l=[{label:"Query Wizard",value:"Elements"},{label:"Text Editor",value:"Text"}],r={"Select All":{Value:!1,Order:-1,Flag:0},Normal:{Value:!1,Order:0,Flag:0},BadData:{Value:!1,Order:1,Flag:1},SuspectData:{Value:!1,Order:2,Flag:2},OverRangeError:{Value:!1,Order:3,Flag:4},UnderRangeError:{Value:!1,Order:4,Flag:8},AlarmHigh:{Value:!1,Order:5,Flag:16},AlarmLow:{Value:!1,Order:6,Flag:32},WarningHigh:{Value:!1,Order:7,Flag:64},WarningLow:{Value:!1,Order:8,Flag:128},FlatlineAlarm:{Value:!1,Order:9,Flag:256},ComparisonAlarm:{Value:!1,Order:10,Flag:512},ROCAlarm:{Value:!1,Order:11,Flag:1024},ReceivedAsBad:{Value:!1,Order:12,Flag:2048},CalculatedValue:{Value:!1,Order:13,Flag:4096},CalculationError:{Value:!1,Order:14,Flag:8192},CalculationWarning:{Value:!1,Order:15,Flag:16384},ReservedQualityFlag:{Value:!1,Order:16,Flag:32768},BadTime:{Value:!1,Order:17,Flag:65536},SuspectTime:{Value:!1,Order:18,Flag:1<<17},LateTimeAlarm:{Value:!1,Order:19,Flag:1<<18},FutureTimeAlarm:{Value:!1,Order:20,Flag:1<<19},UpSampled:{Value:!1,Order:21,Flag:1<<20},DownSampled:{Value:!1,Order:22,Flag:1<<21},DiscardedValue:{Value:!1,Order:23,Flag:1<<22},ReservedTimeFlag:{Value:!1,Order:24,Flag:1<<23},UserDefinedFlag1:{Value:!1,Order:25,Flag:1<<24},UserDefinedFlag2:{Value:!1,Order:26,Flag:1<<25},UserDefinedFlag3:{Value:!1,Order:27,Flag:1<<26},UserDefinedFlag4:{Value:!1,Order:28,Flag:1<<27},UserDefinedFlag5:{Value:!1,Order:29,Flag:1<<28},SystemError:{Value:!1,Order:30,Flag:1<<29},SystemWarning:{Value:!1,Order:31,Flag:1<<30},MeasurementError:{Value:!1,Order:32,Flag:1<<31}},o=require("react");var i=n.n(o);const u=require("@grafana/ui");var s=n(892),d=n.n(s),c=n(760),p=n.n(c),m=n(311),v=n.n(m),y=n(192),g=n.n(y),b=n(60),f=n.n(b),h=n(865),E=n.n(h),F=n(413),T={};function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){S(e,t,n[t])}))}return e}function I(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function A({query:e,onChange:t}){return i().useEffect((()=>{"Annotations"!==e.queryType&&t(I(O({},e),{queryType:"Annotations"}))}),[e,t]),i().createElement(u.FieldSet,{style:{display:"flex",flexDirection:"column"}},i().createElement(u.InlineField,{label:"Query",labelWidth:"auto",grow:!0,shrink:!0},i().createElement(u.TextArea,{value:e.queryText,onChange:n=>t(I(O({},e),{queryText:n.target.value})),rows:5,width:150})))}function x(e,t,n,a,l,r,o){try{var i=e[r](o),u=i.value}catch(e){return void n(e)}i.done?t(u):Promise.resolve(u).then(a,l)}function C(e){return function(){var t=this,n=arguments;return new Promise((function(a,l){var r=e.apply(t,n);function o(e){x(r,a,l,o,i,"next",e)}function i(e){x(r,a,l,o,i,"throw",e)}o(void 0)}))}}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}T.styleTagTransform=E(),T.setAttributes=g(),T.insert=v().bind(null,"head"),T.domAPI=p(),T.insertStyleElement=f(),d()(F.Z,T),F.Z&&F.Z.locals&&F.Z.locals;class D extends e.DataSourceApi{metricFindQuery(e,n){var a=this;return C((function*(){var n,l;if(void 0!==e.tableName&&void 0!==e.fieldNames)return 0===e.tableName.length&&(e.tableName="ActiveMeasurements",0!==e.fieldNames.length&&"*"!==e.fieldNames[0]||(e.fieldNames=["PointTag"])),0===e.fieldNames.length&&(e.fieldNames=["*"]),(yield(0,t.getBackendSrv)().post(a.url+"/Search",{dataTypeIndex:-1,expression:`SELECT DISTINCT ${e.fieldNames} FROM ${e.tableName} ${null===(l=null===(n=e.condition)||void 0===n?void 0:n.length)||void 0===l||l?"":` WHERE ${e.condition}`}`})).map((e=>({text:e})))}))()}calculateFlags(){let e=0;for(const[t,n]of Object.entries(this.flags))"Select All"!==t&&"Normal"!==t&&!0===n&&(e^=r[t].Flag);return e}targetToString(e){return void 0===e?"":"Elements"===e.queryType||void 0===e.queryType?this.parsedQueryToString(e.parsedQuery):"Text"===e.queryType?e.queryText:""}functionToString(e){const t=e.Parameters.map((e=>e.type.type.includes("IAsyncEnumerable")?this.parsedQueryToString(e.value):e.value.toString())).join(",");return`${e.Function}(${t})`}parsedQueryToString(e){if(void 0===e)return"";const t=[];return void 0!==e.Elements&&t.push(e.Elements.join(";")),void 0!==e.Filters&&t.push(e.Filters.map((e=>{var t;return`FILTER ${""===e.NumberMode?"":`${e.NumberMode} ${e.Number}`} ${e.Table}${(null===(t=e.Condition)||void 0===t?void 0:t.length)>0?` WHERE ${e.Condition}`:""}`})).join(";")),void 0!==e.Functions&&t.push(e.Functions.map((e=>this.functionToString(e))).join(";")),t.filter((e=>e.length>0)).join(";")}buildQueryParameters(e){const n=this.calculateFlags();var a;const l=null!==(a=this.flags.Normal)&&void 0!==a&&a,r=e.targets.filter((e=>{var t;return!(null!==(t=e.hide)&&void 0!==t&&t)&&"Annotations"!==e.queryType})).map((n=>{var a,l,r,o;const i=[];void 0!==n.metadataOptions&&n.metadataOptions.forEach((e=>{var t;void 0!==i.find((t=>t.tableName===e.Table))?null===(t=i.find((t=>t.tableName===e.Table)))||void 0===t||t.fieldNames.push(e.FieldName):i.push({tableName:e.Table,fieldNames:[e.FieldName]})}));let u=(0,t.getTemplateSrv)().replace(this.targetToString(n),e.scopedVars);var s,d,c,p,m,v,y,g;return null!==(s=null===(a=n.commandLevel)||void 0===a?void 0:a.DropEmpty)&&void 0!==s&&s&&(u=`${u}; dropEmptySeries`),null!==(d=null===(l=n.commandLevel)||void 0===l?void 0:l.IncludePeaks)&&void 0!==d&&d&&(u=`${u}; includePeaks`),null!==(c=null===(r=n.commandLevel)||void 0===r?void 0:r.FullResolution)&&void 0!==c&&c&&(u=`${u}; fullResolutionQuery`),null!==(p=null===(o=n.commandLevel)||void 0===o?void 0:o.RadialDistribution)&&void 0!==p&&p&&(u=`${u}; radialDistribution={radius=${null!==(y=null===(m=n.commandLevel)||void 0===m?void 0:m.Radius)&&void 0!==y?y:1.5}; zoom=${null!==(g=null===(v=n.commandLevel)||void 0===v?void 0:v.Zoom)&&void 0!==g?g:2}}`),{refID:n.refId,target:u,metadataSelections:i}}));var o;return{dataTypeIndex:this.valueTypeIndex,range:{from:e.range.from.toISOString(),to:e.range.to.toISOString()},interval:e.interval,targets:r,adhocFilters:[],excludedFlags:n,excludeNormalFlags:l,maxDataPoints:null!==(o=e.maxDataPoints)&&void 0!==o?o:1e3}}query(n){var a=this;return C((function*(){const l=n.targets[0],r=n.targets.map((e=>e.metadataOptions)).flat(),o=n.targets.some((e=>"Annotations"!==e.queryType)),i=n.targets.some((e=>"Annotations"===e.queryType));let u=[],s={},d=[];if(o){let o=a.buildQueryParameters(n),i=yield(0,t.getBackendSrv)().post(a.url+"/query",o);const s=a.timeSeriesDefinitions,c=new Map,p=i.map((t=>{var o;t.syntaxError&&d.push(t.syntaxError);const i=Object.keys(t.metadata);var u;if(null!==(u=null===(o=n.targets.find((e=>e.refId===t.refID)))||void 0===o?void 0:o.transpose)&&void 0!==u&&u){const n={};return c.has(t.refID)||c.set(t.refID,new e.MutableDataFrame({refId:t.refID,name:t.refID,fields:s.map(((t,n)=>({name:t,type:n<s.length-1?e.FieldType.number:e.FieldType.time})))})),t.datapoints.length>0?s.forEach(((e,a)=>{n[e]=t.datapoints[0][a]})):s.forEach(((e,t)=>{n[e]=NaN})),i.forEach((a=>{c.get(t.refID).fields.map((e=>e.name)).includes(a)||c.get(t.refID).addField({name:a,type:e.FieldType.other}),n[a]=t.metadata[a]})),void c.get(t.refID).add(n)}{const n=new e.MutableDataFrame({refId:l.refId,fields:i.concat(s).map(((t,n)=>{var l,o;return{name:t,type:n<i.length?a.metaDataDataType(null!==(o=null===(l=r.find((e=>e.FieldName===i[n]||`${e.Table}.${e.FieldName}`===i[n])))||void 0===l?void 0:l.Type)&&void 0!==o?o:""):n<i.length+s.length-1?e.FieldType.number:e.FieldType.time}}))});return n.refId=t.refID,n.name=t.target,t.datapoints.forEach((e=>{const a={};s.forEach(((t,n)=>{a[t]=e[n]})),i.forEach((e=>{a[e]=t.metadata[e]})),n.add(a)})),n}}));u=p.concat([...c.values()]).filter((e=>void 0!==e))}return i&&u.push(yield a.queryAnnotations(n)),d.length>0&&(s={message:d.join("\n\n")}),{data:u,error:s}}))()}testDatasource(){var e=this;return C((function*(){return yield(0,t.getBackendSrv)().get(e.url+"/").then((()=>({status:"success",message:"Data source is working",title:"Success"})),(()=>({status:"error",message:"Data source is not working",title:"Error"})))}))()}metaDataDataType(t){return"Int16"===t||"Int32"===t||"Int64"===t||"UInt16"===t||"UInt32"===t||"UInt64"===t||"IntPtr"===t||"UIntPtr"===t?e.FieldType.number:"Boolean"===t?e.FieldType.boolean:"Byte"===t||"SByte"===t||"Char"===t||"Decimal"===t||"Double"===t||"Single"===t?e.FieldType.number:"String"===t||"Guid"===t?e.FieldType.string:e.FieldType.other}queryAnnotations(n){var a=this;return C((function*(){const l=n.targets.map((e=>(0,t.getTemplateSrv)().replace(e.queryText,n.scopedVars))).join(";"),r={range:n.range,annotationQuery:l,rangeRaw:n.rangeRaw},o=yield(0,t.getBackendSrv)().post(a.url+"/annotations",r);if(o.length>500)throw Error(`There are ${o.length} annotations. Grafana can not display more than 500.`);const i=new e.MutableDataFrame({refId:n.targets[0].refId,fields:[{name:"time",type:e.FieldType.time},{name:"timeEnd",type:e.FieldType.time},{name:"title",type:e.FieldType.string},{name:"text",type:e.FieldType.string},{name:"tags",type:e.FieldType.string}]});return o.forEach((e=>{i.add({time:e.time,timeEnd:e.endTime,title:e.title,text:e.text,tags:e.tags})})),i}))()}constructor(e){var t;super(e),w(this,"url",void 0),w(this,"flags",void 0),w(this,"valueTypeIndex",void 0),w(this,"valueTypeName",void 0),w(this,"timeSeriesDefinitions",void 0),w(this,"metadataTableName",void 0),this.annotations={QueryEditor:A},this.url=e.jsonData.http.url||"",this.flags=e.jsonData.flags||{},this.valueTypeIndex=parseInt(e.jsonData.valueTypeIndex||"0",10),this.valueTypeName=e.jsonData.valueTypeName||"",this.timeSeriesDefinitions=null!==(t=e.jsonData.timeSeriesDefinitions)&&void 0!==t?t:[""],this.metadataTableName=e.jsonData.metadataTableName||""}}var j=n(606),k={};function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){P(e,t,n[t])}))}return e}function N(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}k.styleTagTransform=E(),k.setAttributes=g(),k.insert=v().bind(null,"head"),k.domAPI=p(),k.insertStyleElement=f(),d()(j.Z,k),j.Z&&j.Z.locals&&j.Z.locals;const R=require("lodash");var B=n.n(R);function L(e,t,n,a,l,r,o){try{var i=e[r](o),u=i.value}catch(e){return void n(e)}i.done?t(u):Promise.resolve(u).then(a,l)}function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){M(e,t,n[t])}))}return e}function Q(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const W=e=>{var n,a,l,r;const[o,u]=i().useState(null!==(r=null===(n=e.query.parsedQuery)||void 0===n?void 0:n.Elements)&&void 0!==r?r:[]);var s;const[d,c]=i().useState(null!==(s=null===(a=e.query.parsedQuery)||void 0===a?void 0:a.Functions)&&void 0!==s?s:[]),[p,m]=i().useState([]),[v,y]=i().useState([]);var g;const[b,f]=i().useState(null!==(g=null===(l=e.query.parsedQuery)||void 0===l?void 0:l.Filters)&&void 0!==g?g:[]);return i().useEffect((()=>{var n;null===(n=e.includeFunctions)||void 0===n||n?(0,t.getBackendSrv)().post(e.datasource.url+"/GetValueTypeFunctions",{dataTypeIndex:e.datasource.valueTypeIndex,expression:""}).then((e=>{m(e)})):m([])}),[e.datasource.url,e.includeFunctions,e.datasource.valueTypeIndex]),i().useEffect((()=>{(0,t.getBackendSrv)().post(e.datasource.url+"/GetValueTypeTables",{dataTypeIndex:e.datasource.valueTypeIndex,expression:""}).then((e=>{y(e)}))}),[e.datasource.url,e.datasource.valueTypeIndex]),i().createElement("div",{style:{width:"100%"}},i().createElement($,{datasource:e.datasource,elements:o,update:function(t,n,a){u(t),void 0!==n&&c((e=>{var t;let a=B().clone(e);var l;return a.push({Function:n,Parameters:null!==(l=null===(t=p.find((e=>e.name===n)))||void 0===t?void 0:t.parameters.map((e=>({type:e,value:e.type.includes("IAsyncEnumerable")?{Elements:[],Functions:[],Filters:[]}:e.default}))))&&void 0!==l?l:[]}),a}));const l=V({},e.query);void 0===l.parsedQuery&&(l.parsedQuery={Elements:[],Functions:[],Filters:[]}),l.parsedQuery.Elements=t,a&&(l.parsedQuery.Filters.push({Table:e.datasource.metadataTableName,Condition:"",Number:10,NumberMode:"TOP"}),f(l.parsedQuery.Filters)),e.onChange(l)},availableFunctions:p}),null==d?void 0:d.map(((t,n)=>i().createElement(Z,{key:t.Function,update:t=>function(t,n){const a=V({},e.query);void 0===a.parsedQuery&&(a.parsedQuery={Elements:[],Functions:[],Filters:[]}),void 0===t?a.parsedQuery.Functions.splice(n,1):a.parsedQuery.Functions[n]=t,c(a.parsedQuery.Functions),e.onChange(a)}(t,n),func:t,availableFunctions:p,availableTables:v,datasource:e.datasource}))),null==b?void 0:b.map(((t,n)=>i().createElement(U,{key:n,availableTables:v,update:t=>function(t,n){const a=V({},e.query);void 0===a.parsedQuery&&(a.parsedQuery={Elements:[],Functions:[],Filters:[]}),void 0===t?a.parsedQuery.Filters.splice(n,1):a.parsedQuery.Filters[n]=t,f(a.parsedQuery.Filters),e.onChange(a)}(t,n),filter:t}))))},$=e=>{const n=i().useMemo((()=>e.elements.map((e=>({value:e,label:e})))),[e.elements]),a=(l=function*(n){const a=(yield(0,t.getBackendSrv)().post(e.datasource.url+"/Search",{dataTypeIndex:e.datasource.valueTypeIndex,expression:n})).map((e=>({value:e,label:e})));return"filter".includes(n.toLocaleLowerCase())&&a.push({value:"FILTER",label:"FILTER"}),e.availableFunctions.filter((e=>{var t,a;return e.name.toLocaleLowerCase().includes(n.toLocaleLowerCase())||null!==(a=null===(t=e.aliases)||void 0===t?void 0:t.some((e=>e.toLocaleLowerCase().includes(n.toLocaleLowerCase()))))&&void 0!==a&&a})).forEach((e=>{a.push({label:e.name,value:"fx-"+e.name})})),a},r=function(){var e=this,t=arguments;return new Promise((function(n,a){var r=l.apply(e,t);function o(e){L(r,n,a,o,i,"next",e)}function i(e){L(r,n,a,o,i,"throw",e)}o(void 0)}))},function(e){return r.apply(this,arguments)});var l,r;return i().createElement(u.InlineFieldRow,null,i().createElement(u.InlineField,{label:"Query",labelWidth:"auto"},i().createElement(u.AsyncMultiSelect,{loadOptions:a,defaultOptions:!0,value:n,onChange:t=>{const n=t.map((e=>e.value));let a=n.includes("FILTER");const l=n.filter((e=>e.startsWith("fx-")));let r;l.length>0&&(r=l[0].substring(3)),e.update(n.filter((e=>"FILTER"!==e&&!e.startsWith("fx-"))),r,a)},isSearchable:!0})),i().createElement(u.Button,{size:"sm",variant:"secondary",fill:"solid",icon:"plus-circle",style:{marginTop:4,marginLeft:5},onClick:()=>e.update(n.map((e=>e.value)),void 0,!0)},"Filter"),i().createElement(u.Button,{size:"sm",variant:"secondary",fill:"solid",icon:"plus-circle",style:{marginTop:4,marginLeft:5},onClick:()=>{var t;return e.update(n.map((e=>e.value)),null===(t=e.availableFunctions.find((()=>!0)))||void 0===t?void 0:t.name,!1)}},"Function"))},U=e=>{const t=i().useMemo((()=>e.availableTables.map((e=>({label:e,value:e})))),[e.availableTables]),n=i().useMemo((()=>""===e.filter.Table?[]:[{value:e.filter.Table,label:e.filter.Table}]),[e.filter.Table]);return i().createElement(u.FieldSet,null,i().createElement(u.InlineFieldRow,null,i().createElement(u.IconButton,{name:"trash-alt",size:"xl",iconType:"default",variant:"destructive",style:{marginTop:4,marginRight:0},onClick:()=>e.update(void 0)}),i().createElement(u.InlineField,{label:i().createElement(u.InlineLabel,{style:{flexShrink:1}},i().createElement(u.IconButton,{name:"filter",size:"md",iconType:"default",variant:"secondary",style:{marginLeft:-2}}),"FILTER"),labelWidth:"auto"},i().createElement(u.Select,{value:e.filter.NumberMode,options:[{label:"TOP",value:"TOP"},{label:"ALL",value:""}],onChange:function(t){e.update(Q(V({},e.filter),{NumberMode:t.value}))}})),""!==e.filter.NumberMode?i().createElement(u.Input,{type:"number",min:0,max:99999,value:e.filter.Number,onChange:function(t){const n=t.target.value;e.update(Q(V({},e.filter),{Number:parseInt(n,10)}))},width:10}):null,i().createElement(u.InlineField,{label:"",labelWidth:1,transparent:!0,style:{marginLeft:-16}},i().createElement(u.Select,{value:n,options:t,isLoading:0===t.length,onChange:function(t){var n;e.update(Q(V({},e.filter),{Table:null!==(n=t.value)&&void 0!==n?n:""}))},isSearchable:!0,width:"auto"}))),i().createElement(u.InlineFieldRow,null,i().createElement(u.InlineField,{label:"WHERE",grow:!0},i().createElement(u.Input,{value:e.filter.Condition,onChange:function(t){e.update(Q(V({},e.filter),{Condition:t.target.value}))},placeholder:"SignalType = 'FREQ'"}))))},Z=e=>{const[t,n]=i().useState(!0),a=i().useMemo((()=>{var t;return null!==(t=e.availableFunctions.find((t=>t.name===e.func.Function)))&&void 0!==t?t:e.availableFunctions[0]}),[e.func,e.availableFunctions]),l=i().useMemo((()=>e.availableFunctions.map((e=>({value:e.name,label:e.name})))),[e.availableFunctions]);return i().createElement(u.Collapse,{collapsible:!0,label:i().createElement(u.InlineFieldRow,null,i().createElement(u.IconButton,{name:"trash-alt",size:"xl",iconType:"default",variant:"destructive",style:{marginTop:4,marginRight:6},onClick:()=>e.update(void 0)}),i().createElement("span",{style:{marginTop:5,marginRight:4,fontSize:"small"}},"ƒ(x)"),i().createElement(u.Select,{value:e.func.Function,options:l,onChange:function(t){const a=e.availableFunctions.find((e=>e.name===t.value));if(null===a)return;var l;const r=null!==(l=null==a?void 0:a.parameters.map((e=>({type:e,value:e.type.includes("IAsyncEnumerable")?{Elements:[],Functions:[],Filters:[]}:e.default}))))&&void 0!==l?l:[];var o;e.update({Function:null!==(o=t.value)&&void 0!==o?o:"AbsoluteValue",Parameters:r}),n(!0)},isSearchable:!0,tabSelectsValue:!0,width:"auto"}),i().createElement("div",{style:{marginTop:5,marginLeft:10}},z(a)," ",null==a?void 0:a.returnType.toLowerCase(),H(a)," function",_(a),".")),isOpen:t,onToggle:()=>n((e=>!e))},i().createElement("p",null,null==a?void 0:a.description),i().createElement("ul",null,e.func.Parameters.map(((t,n)=>i().createElement("li",{key:t.type.name},i().createElement(G,{update:t=>function(t,n){const a=B().cloneDeep(e.func);a.Parameters[n]=t,e.update(a)}(t,n),param:t,availableFunctions:e.availableFunctions,availableTables:e.availableTables,datasource:e.datasource}))))))},G=e=>{var t,n,a,l,r,o,s,d,c,p,m,v,y,g,b,f,h,E,F,T,S,O;function I(t){e.update({type:e.param.type,value:t.target.value})}function A(t){e.update({type:e.param.type,value:t.value})}return i().createElement(u.Card,null,i().createElement(u.Card.Heading,null,e.param.type.name," (",e.param.type.required?"required":"optional",")"),i().createElement(u.Card.Description,null,i().createElement(i().Fragment,null,i().createElement("p",null,e.param.type.description," (",e.param.type.type,!e.param.type.required&&(null===(t=e.param.type.default)||void 0===t?void 0:t.length)>0?`: default = ${e.param.type.default}`:"",")"),e.param.type.type.includes("IAsyncEnumerable")?i().createElement(i().Fragment,null,i().createElement($,{datasource:e.datasource,elements:null!==(f=null===(n=null===(a=e.param)||void 0===a?void 0:a.value)||void 0===n?void 0:n.Elements)&&void 0!==f?f:[],update:function(t,n,a){let l=B().cloneDeep(e.param);if(void 0===l&&(l={type:e.param.type,value:{Elements:[],Functions:[],Filters:[]}}),void 0!==n){var r;const t=e.availableFunctions.find((e=>e.name===n));if(null===t)return;var o;const a=null!==(o=null==t?void 0:t.parameters.map((e=>({type:e,value:e.type.includes("IAsyncEnumerable")?{Elements:[],Functions:[],Filters:[]}:e.default}))))&&void 0!==o?o:[];null===(r=l.value)||void 0===r||r.Functions.push({Function:n,Parameters:a})}var i;l.value.Elements=t,a&&(null===(i=l.value)||void 0===i||i.Filters.push({Table:e.datasource.metadataTableName,Condition:"",Number:10,NumberMode:"TOP"})),e.update(l)},availableFunctions:e.availableFunctions}),null===(r=null===(o=e.param)||void 0===o?void 0:o.value)||void 0===r||null===(l=r.Functions)||void 0===l?void 0:l.map(((t,n)=>i().createElement(Z,{key:t.Function,update:t=>function(t,n){let a=B().cloneDeep(e.param);var l;void 0===a&&(a={type:e.param.type,value:{Elements:[],Functions:[],Filters:[]}}),void 0===t?null===(l=a.value)||void 0===l||l.Functions.splice(n,1):a.value.Functions[n]=t,e.update(a)}(t,n),func:t,availableFunctions:e.availableFunctions,availableTables:e.availableTables,datasource:e.datasource}))),null===(d=null===(c=e.param)||void 0===c?void 0:c.value)||void 0===d||null===(s=d.Filters)||void 0===s?void 0:s.map(((t,n)=>i().createElement(U,{key:n,availableTables:e.availableTables,update:t=>function(t,n){let a=B().cloneDeep(e.param);var l;void 0===a&&(a={type:e.param.type,value:{Elements:[],Functions:[],Filters:[]}}),void 0===t?null===(l=a.value)||void 0===l||l.Filters.splice(n,1):a.value.Filters[n]=t,e.update(a)}(t,n),filter:t})))):null,"Double"===e.param.type.type?i().createElement(u.Input,{type:"number",value:null!==(h=null===(p=e.param)||void 0===p?void 0:p.value)&&void 0!==h?h:"1.0",onChange:I,width:20}):null,"String"===e.param.type.type?i().createElement(u.Input,{type:"text",value:null!==(E=null===(m=e.param)||void 0===m?void 0:m.value)&&void 0!==E?E:"",onChange:I,width:20}):null,"Int32"===e.param.type.type?i().createElement(u.Input,{type:"number",min:0,max:99999,value:null!==(F=null===(v=e.param)||void 0===v?void 0:v.value)&&void 0!==F?F:"1",onChange:I,width:20}):null,"AngleUnit"===e.param.type.type?i().createElement(u.Select,{value:null!==(T=null===(y=e.param)||void 0===y?void 0:y.value)&&void 0!==T?T:"Degrees",options:[{value:"Radians",label:"Radians"},{value:"Degrees",label:"Degrees"},{value:"Grads",label:"Grads"},{value:"ArcMinutes",label:"ArcMinutes"},{value:"ArcSeconds",label:"ArcSeconds"},{value:"AngularMil",label:"AngularMil"}],onChange:A,isSearchable:!0}):null,"TargetTimeUnit"===e.param.type.type?i().createElement(u.Select,{value:null!==(S=null===(g=e.param)||void 0===g?void 0:g.value)&&void 0!==S?S:"Seconds",options:[{value:"Seconds",label:"Seconds"},{value:"Nanoseconds",label:"Nanoseconds"},{value:"Microseconds",label:"Microseconds"},{value:"Milliseconds",label:"Milliseconds"},{value:"Minutes",label:"Minutes"},{value:"Hours",label:"Hours"},{value:"Days",label:"Days"},{value:"Weeks",label:"Weeks"},{value:"Ke",label:"Ke (traditional Chinese)"},{value:"Ticks",label:"Ticks"},{value:"PlanckTime",label:"PlanckTime"},{value:"AtomicUnitsOfTime",label:"AtomicUnitsOfTime"}],onChange:A,isSearchable:!0}):null,"Boolean"===e.param.type.type?i().createElement(u.Select,{value:null!==(O=null===(b=e.param)||void 0===b?void 0:b.value)&&void 0!==O?O:"1",options:[{value:"1",label:"True"},{value:"0",label:"False"}],onChange:A,isSearchable:!0}):null)))},z=e=>{var t;return"BuiltIn"===(null!==(t=null==e?void 0:e.category)&&void 0!==t?t:"BuiltIn")?"Built-in":"Custom"},H=e=>{var t;const n=null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"";return n.startsWith("Slice")?" slice":n.startsWith("Set")?" set":""},_=e=>{var t;const n=null!==(t=null==e?void 0:e.allowedGroupOperations.split(",").map((e=>e.trim())))&&void 0!==t?t:[];var a;let l=null!==(a=null==e?void 0:e.publishedGroupOperations.split(",").map((e=>e.trim())))&&void 0!==a?a:[];if(0===l.length)return"";const r=new Set(n);var o;let i=null!==(o=null==e?void 0:e.name)&&void 0!==o?o:"";l.every((e=>r.has(e)))||(i=n[0],l=n);const u=new Set(l),s=[];let d=!1;if(i.startsWith("Slice")?(u.has("None")&&(d=!0),u.has("Set")&&s.push("set")):i.startsWith("Set")?(u.has("None")&&(d=!0),u.has("Slice")&&s.push("slice")):(u.has("Slice")&&s.push("slice"),u.has("Set")&&s.push("set")),!d&&0===s.length)return"";const c=[];return d&&c.push("standard non-grouped"),s.length>0&&(c.length>0&&c.push(" and "),c.push(s.join(" and ")),c.push(" group"),s.length>1&&c.push("ed")),c.push(" operation"),(d?1:0)+s.length>1&&c.push("s"),`, also supports ${c.join("")}`},Y=e=>{var n;const[a,l]=i().useState([]);return i().useEffect((()=>{(0,t.getBackendSrv)().post(e.datasource.url+"/GetValueTypeTables",{dataTypeIndex:e.datasource.valueTypeIndex,expression:""}).then((e=>{var t;l(null!==(t=null==e?void 0:e.map((e=>({value:e,label:e}))))&&void 0!==t?t:[])}))}),[e.datasource.valueTypeIndex,e.datasource.url]),i().createElement(u.FieldSet,null,null===(n=e.query)||void 0===n?void 0:n.map(((t,n)=>i().createElement(J,{Field:t,key:n,Remove:()=>(t=>{let n=[...e.query];n.splice(t,1),e.onChange(n)})(n),Update:t=>((t,n)=>{let a=[...e.query];a[n]=t,e.onChange(a)})(t,n),TableOptions:a,Datasource:e.datasource}))),i().createElement(u.InlineFieldRow,null,i().createElement(u.InlineField,null,i().createElement(u.Button,{size:"md",icon:"plus-circle",variant:"secondary",onClick:()=>(void 0===e.query&&e.onChange([{Table:e.datasource.metadataTableName,FieldName:"",Type:""}]),void e.onChange([...e.query,{Table:e.datasource.metadataTableName,FieldName:"",Type:""}]))},"Add Metadata"))))},J=e=>{var n,a,l,r,o,s,d;const[c,p]=i().useState([]),m=i().useMemo((()=>c.map((e=>({value:e.FieldName,label:e.FieldName})))),[c]);var v,y,g;return i().useEffect((()=>{p([]),void 0!==e.Field.Table&&(0,t.getBackendSrv)().post(e.Datasource.url+"/GetValueTypeTableFields",{dataTypeIndex:e.Datasource.valueTypeIndex,expression:e.Field.Table}).then((t=>{var n;return p(null!==(n=null==t?void 0:t.map((t=>({FieldName:t.name,Table:e.Field.Table,Type:t.type}))))&&void 0!==n?n:[])}))}),[e.Field.Table,e.Datasource.url,e.Datasource.valueTypeIndex]),i().createElement(u.InlineFieldRow,null,i().createElement(u.InlineField,{label:"Table",labelWidth:12},i().createElement(u.Select,{value:e.Field.Table,options:e.TableOptions,onChange:t=>{var n;e.Update({Table:null!==(n=t.value)&&void 0!==n?n:"",FieldName:"",Type:""})},isLoading:0===e.TableOptions.length,invalid:0===(null!==(v=null===(a=e.Field)||void 0===a||null===(n=a.Table)||void 0===n?void 0:n.length)&&void 0!==v?v:0)})),i().createElement(u.InlineField,{label:"Field",labelWidth:12},i().createElement(u.Select,{value:null===(l=e.Field)||void 0===l?void 0:l.FieldName,options:m,onChange:t=>{const n=c.find((e=>e.FieldName===t.value));void 0!==n&&e.Update(n)},isLoading:0===m.length,invalid:0===(null!==(y=null===(o=e.Field)||void 0===o||null===(r=o.FieldName)||void 0===r?void 0:r.length)&&void 0!==y?y:0),disabled:0===(null!==(g=null===(d=e.Field)||void 0===d||null===(s=d.Table)||void 0===s?void 0:s.length)&&void 0!==g?g:0)})),i().createElement(u.InlineField,null,i().createElement(u.IconButton,{name:"trash-alt",size:"xl",iconType:"default",variant:"destructive",style:{marginTop:4,marginLeft:4},onClick:()=>e.Remove()})))},K=e=>i().createElement(u.FieldSet,null,i().createElement(u.InlineField,{label:"Query Editor",labelWidth:12,grow:!0,shrink:!0},i().createElement(u.TextArea,{value:e.query,onChange:t=>e.onChange(t.target.value),rows:10,width:150}))),X=e=>{var t,n,a,l,r,o,s;const d=e=>null!=e?e:{DropEmpty:!1,IncludePeaks:!1,FullResolution:!1,RadialDistribution:!1,Radius:1.5,Zoom:2},c=(t,n)=>{let a=d(e.query);a[n]=!a[n],e.onChange(a)};var p,m,v,y,g,b,f;return i().createElement(u.FieldSet,null,i().createElement(u.InlineFieldRow,null,i().createElement(u.InlineField,{label:"Drop Empty Series",labelWidth:24,tooltip:"Requests that series that return no data be removed from the the visualization targets"},i().createElement(u.InlineSwitch,{disabled:!1,value:null!==(p=null===(t=e.query)||void 0===t?void 0:t.DropEmpty)&&void 0!==p&&p,onChange:e=>c(0,"DropEmpty")})),i().createElement(u.InlineField,{label:"Include Peaks",labelWidth:24,tooltip:"Requests that decimated data from query source include both minimum and maximum interval peaks, note that this can reduce query performance."},i().createElement(u.InlineSwitch,{disabled:!1,value:null!==(m=null===(n=e.query)||void 0===n?void 0:n.IncludePeaks)&&void 0!==m&&m,onChange:e=>c(0,"IncludePeaks")}))),i().createElement(u.InlineFieldRow,null,i().createElement(u.InlineField,{label:"Full Resolution Data",labelWidth:24,tooltip:"Requests that query source return full resolution data, note that this can reduce query and/or visualization performance."},i().createElement(u.InlineSwitch,{disabled:!1,value:null!==(v=null===(a=e.query)||void 0===a?void 0:a.FullResolution)&&void 0!==v&&v,onChange:e=>c(0,"FullResolution")})),i().createElement(u.InlineField,{label:"Radial Geo Distribution",labelWidth:24,tooltip:"Requests that overlapping geo-coordinates, i.e., longitude and latitude, when included as selected as metadata, be distributed radially."},i().createElement(u.InlineSwitch,{disabled:!1,value:null!==(y=null===(l=e.query)||void 0===l?void 0:l.RadialDistribution)&&void 0!==y&&y,onChange:e=>c(0,"RadialDistribution")}))),null!==(g=null===(r=e.query)||void 0===r?void 0:r.RadialDistribution)&&void 0!==g&&g?i().createElement(u.InlineFieldRow,null,i().createElement(u.InlineField,{label:"Radius"},i().createElement(u.Input,{type:"number",value:(null!==(b=null===(o=e.query)||void 0===o?void 0:o.Radius)&&void 0!==b?b:1.5).toString(),onChange:function(t){let n=d(e.query);console.log(t),n.Radius=parseFloat(t.target.value.toString()),e.onChange(n)}})),i().createElement(u.InlineField,{label:"Zoom"},i().createElement(u.Input,{type:"number",value:(null!==(f=null===(s=e.query)||void 0===s?void 0:s.Zoom)&&void 0!==f?f:2).toString(),onChange:function(t){let n=d(e.query);console.log(t),n.Zoom=parseFloat(t.target.value.toString()),e.onChange(n)}}))):null)};function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){ee(e,t,n[t])}))}return e}function ne(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){ae(e,t,n[t])}))}return e}function re(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const oe=new e.DataSourcePlugin(D).setConfigEditor((function(e){const{onOptionsChange:n,options:a}=e,[l,o]=i().useState([]),s=i().useMemo((()=>l.map((e=>({value:e.index.toString(),label:e.name})))),[l]),d=i().useMemo((()=>{var e,t,n;return null!==(n=null==a||null===(t=a.jsonData)||void 0===t||null===(e=t.http)||void 0===e?void 0:e.url)&&void 0!==n?n:""}),[a]),[c,p]=i().useState(!0);i().useEffect((()=>{0!==d.length&&(0,t.getBackendSrv)().post(d+"/GetValueTypes",{}).then((e=>o(e))).catch((e=>console.error("Error fetching data source types:",e)))}),[]),i().useEffect((()=>{s.length<1||void 0!==a.jsonData.valueTypeIndex||v(s[0])}),[s,a.jsonData]);const m=e=>{const t=e.target,{name:l,checked:o}=t;let i={};if("Select All"===l){const e=!a.jsonData.flags||!a.jsonData.flags["Select All"];i=Object.keys(r).reduce(((t,n)=>(t[n]=e,t)),{})}else i=N(q({},a.jsonData.flags),{[l]:o}),o||(i["Select All"]=!1);const u=N(q({},a.jsonData),{flags:i});n(N(q({},a),{jsonData:u}))},v=e=>{var t,r;const o=(null!==(r=e.value)&&void 0!==r?r:"0").toString(),i=l.find((e=>e.index.toString()===o));var u,s,d;const c=N(q({},a.jsonData),{valueTypeIndex:o,valueTypeName:null!==(u=null==i?void 0:i.name)&&void 0!==u?u:"",timeSeriesDefinitions:null!==(s=null==i||null===(t=i.timeSeriesDefinition)||void 0===t?void 0:t.split(","))&&void 0!==s?s:[""],metadataTableName:null!==(d=null==i?void 0:i.metadataTableName)&&void 0!==d?d:""});n(N(q({},a),{jsonData:c}))};var y;return i().createElement(u.FieldSet,{onBlur:()=>{0!==d.length&&(0,t.getBackendSrv)().post(d+"/GetValueTypes",{}).then((e=>o(e))).catch((e=>console.error("Error fetching data source types:",e)))}},i().createElement(u.DataSourceHttpSettings,{defaultUrl:"../api/grafana",dataSourceConfig:a.jsonData.http?a.jsonData.http:a,showAccessOptions:!0,onChange:e=>{0===d.length&&c&&(p(!1),e.url="../api/grafana");const t=N(q({},a.jsonData),{flags:a.jsonData.flags||{},http:e});n(N(q({},a),{jsonData:t}))}}),i().createElement(u.FieldSet,null,i().createElement("h3",{className:"page-heading"},"Excluded Data Flags",i().createElement(u.Tooltip,{content:"Mark flags which you want excluded"},i().createElement("span",{style:{cursor:"help"}}," 🛈"))),i().createElement(u.InlineFieldRow,null,Object.keys(r).map(((e,t)=>i().createElement(u.InlineField,{key:t,label:e,labelWidth:16},i().createElement("div",{className:"dark-box"},i().createElement(u.Switch,{name:e,disabled:!1,value:!(!a.jsonData.flags||!a.jsonData.flags[e])&&a.jsonData.flags[e],onChange:m}))))))),i().createElement(u.FieldSet,null,i().createElement("h3",{className:"page-heading"},"Data Source Type",i().createElement(u.Tooltip,{content:"Determines the type of data that is being queried"},i().createElement("span",{style:{cursor:"help"}}," 🛈"))),i().createElement(u.FieldSet,null,i().createElement(u.InlineFieldRow,null,i().createElement(u.InlineField,{label:"Data Type",labelWidth:24},i().createElement(u.Select,{value:a.jsonData.valueTypeIndex,options:s,onChange:v,isLoading:0===s.length,invalid:void 0===a.jsonData.valueTypeIndex})))),i().createElement(u.Card,null,i().createElement(u.Card.Heading,null,a.jsonData.valueTypeName),i().createElement(u.Card.Description,null,i().createElement("p",null,"This type includes the following elements: "),i().createElement(u.TagList,{className:"pull-left",tags:null!==(y=a.jsonData.timeSeriesDefinitions)&&void 0!==y?y:[""]})))))})).setQueryEditor((function({query:e,onChange:t,datasource:n,onRunQuery:a}){const r=i().useMemo((()=>{var t;return null!==(t=e.queryType)&&void 0!==t?t:"Elements"}),[e]),[o,s]=i().useState(void 0),d=e=>{var t,a,l,r;let o=n.targetToString(e);var i,u,s,d,c,p,m,v;return null!==(i=null===(t=e.commandLevel)||void 0===t?void 0:t.DropEmpty)&&void 0!==i&&i&&(o=`${o}; dropEmptySeries`),null!==(u=null===(a=e.commandLevel)||void 0===a?void 0:a.IncludePeaks)&&void 0!==u&&u&&(o=`${o}; includePeaks`),null!==(s=null===(l=e.commandLevel)||void 0===l?void 0:l.FullResolution)&&void 0!==s&&s&&(o=`${o}; fullResolutionQuery`),null!==(d=null===(r=e.commandLevel)||void 0===r?void 0:r.RadialDistribution)&&void 0!==d&&d&&(o=`${o}; radialDistribution={radius=${null!==(m=null===(c=e.commandLevel)||void 0===c?void 0:c.Radius)&&void 0!==m?m:1.5}; zoom=${null!==(v=null===(p=e.commandLevel)||void 0===p?void 0:p.Zoom)&&void 0!==v?v:2}}`),o},c=e=>{t(e),a()};var p;return i().createElement(u.FieldSet,{style:{display:"flex",flexDirection:"column"},onBlur:()=>{a()}},i().createElement(u.FieldSet,{style:{marginBottom:0}},i().createElement("h3",{className:"page-heading",style:{marginTop:16}},"General Settings"),i().createElement(u.FieldSet,{style:{marginBottom:16}},i().createElement("table",null,i().createElement("tr",null,i().createElement("td",null,i().createElement(u.InlineFieldRow,null,i().createElement(u.InlineField,{label:"Data Selection Mode",labelWidth:24},i().createElement(u.Select,{options:l,value:r,onChange:n=>{var a;const l=null!==(a=n.value)&&void 0!==a?a:"Elements";var r,o,i;"Elements"!==(null!==(r=null==e?void 0:e.queryType)&&void 0!==r?r:"Elements")||"Text"!==l?t(ne(te({},e),{queryType:l})):0===(null!==(i=null===(o=e.queryText)||void 0===o?void 0:o.length)&&void 0!==i?i:0)||d(e).replace(/\s+/g,"").toLowerCase()===e.queryText.replace(/\s+/g,"").toLowerCase()?t(ne(te({},e),{queryText:d(e),queryType:l})):s(d(e))},allowCustomValue:!1})),"Elements"===r?i().createElement(u.IconButton,{name:"question-circle",size:"lg",iconType:"default",variant:"secondary",style:{marginTop:4,marginRight:0},tooltip:i().createElement("div",null,i().createElement("p",{style:{marginBottom:8}},"Current Query Expression:"),i().createElement("p",null,i().createElement("em",null,d(e))))}):null,i().createElement(u.InlineField,{label:"Transpose Query Results",labelWidth:24,style:{marginLeft:16}},i().createElement(u.InlineSwitch,{value:null!==(p=e.transpose)&&void 0!==p&&p,onChange:t=>{var n;return c(ne(te({},e),{transpose:!(null!==(n=e.transpose)&&void 0!==n&&n)}))},showLabel:!0}))))),i().createElement("tr",{style:{height:16}},i().createElement("td",null)),i().createElement("tr",null,i().createElement("td",null,"Elements"===r?i().createElement(X,{query:e.commandLevel,onChange:t=>c(ne(te({},e),{commandLevel:t}))}):null))))),i().createElement(u.FieldSet,{style:{marginBottom:16}},i().createElement("h3",{className:"page-heading"},"Metadata"),i().createElement(Y,{datasource:n,onChange:t=>c(ne(te({},e),{metadataOptions:t})),query:e.metadataOptions})),i().createElement(u.FieldSet,null,i().createElement("h3",{className:"page-heading"},"Data Selection"),"Text"===e.queryType?i().createElement(K,{onChange:n=>{return a=ne(te({},e),{queryText:n}),void t(a);var a},query:e.queryText}):null,"Elements"===e.queryType||void 0===e.queryType?i().createElement(W,{onChange:t=>c(ne(te({},e),{queryText:t.queryText,parsedQuery:t.parsedQuery})),query:e,datasource:n}):null),i().createElement(u.ConfirmModal,{isOpen:void 0!==o,title:"Replace Existing Text Query",body:"Text mode has existing, distinct query expression text. Do you want replace the existing text query expression with the one that was built here?",confirmText:"Confirm",icon:"exclamation-triangle",onConfirm:()=>{t(ne(te({},e),{queryText:null!=o?o:"",queryType:"Text"})),s(void 0)},onDismiss:()=>{s(void 0),t(ne(te({},e),{queryType:"Text"}))}}))})).setVariableQueryEditor((function(e){var n,a,l,r,o,s,d,c,p;const[m,v]=i().useState([]),[y,g]=i().useState([]),[b,f]=i().useState(!0),{onChange:h,query:E}=e;var F,T,S;return i().useEffect((()=>{b&&!E.tableName&&h(re(le({},E),{tableName:"ActiveMeasurements",fieldNames:["PointTag"]})),f(!1)}),[b,h,E]),i().useEffect((()=>{(0,t.getBackendSrv)().post(e.datasource.url+"/GetValueTypeTables",{dataTypeIndex:-1,expression:""}).then((e=>{v(e.map((e=>({value:e,label:e}))))}))}),[e.datasource.url,E.tableName]),i().useEffect((()=>{E.tableName&&(0,t.getBackendSrv)().post(e.datasource.url+"/GetValueTypeTableFields",{dataTypeIndex:-1,expression:E.tableName}).then((e=>{g(e.map((e=>({value:e.name,label:e.name}))))}))}),[e.datasource.url,E.tableName]),i().createElement(u.FieldSet,{style:{display:"flex",flexDirection:"column"}},i().createElement(u.FieldSet,null,i().createElement(u.InlineFieldRow,null,i().createElement(u.InlineField,{label:"Select",labelWidth:12},i().createElement(u.MultiSelect,{value:null===(n=e.query)||void 0===n?void 0:n.fieldNames,options:y,isLoading:0===y.length,onChange:function(t){let n=t.map((e=>{var t,n;return null!==(n=null===(t=e.value)||void 0===t?void 0:t.toString())&&void 0!==n?n:""}));"ActiveMeasurements"===e.query.tableName&&0===n.length&&(n=["*"]),e.onChange(re(le({},e.query),{fieldNames:n}))},isSearchable:!0,invalid:0===(null!==(F=null===(l=e.query)||void 0===l||null===(a=l.fieldNames)||void 0===a?void 0:a.length)&&void 0!==F?F:0),disabled:0===(null!==(T=null===(o=e.query)||void 0===o||null===(r=o.tableName)||void 0===r?void 0:r.length)&&void 0!==T?T:0)})),i().createElement(u.InlineField,{label:"FROM",labelWidth:12},i().createElement(u.Select,{value:null===(s=e.query)||void 0===s?void 0:s.tableName,options:m,isLoading:0===m.length,onChange:function(t){let n=e.query.fieldNames;var a;"ActiveMeasurements"===t.value?n.includes("PointTag")||(n=["PointTag"]):n=["*"],e.onChange(re(le({},e.query),{tableName:null!==(a=t.value)&&void 0!==a?a:"",fieldNames:n}))},isSearchable:!0,invalid:0===(null!==(S=null===(c=e.query)||void 0===c||null===(d=c.tableName)||void 0===d?void 0:d.length)&&void 0!==S?S:0)}))),i().createElement(u.InlineFieldRow,null,i().createElement(u.InlineField,{label:"WHERE",labelWidth:12},i().createElement(u.Input,{value:null===(p=e.query)||void 0===p?void 0:p.condition,onChange:function(t){e.onChange(re(le({},e.query),{condition:t.target.value}))}})))))}))})();var l=exports;for(var r in a)l[r]=a[r];a.__esModule&&Object.defineProperty(l,"__esModule",{value:!0})})();
//# sourceMappingURL=module.js.map