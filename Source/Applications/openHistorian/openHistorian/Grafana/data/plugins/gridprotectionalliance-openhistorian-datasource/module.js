define(["@grafana/data","@grafana/runtime","react","@grafana/ui","lodash"],((e,t,a,n,l)=>(()=>{"use strict";var r={124:(e,t,a)=>{a.d(t,{A:()=>o});var n=a(942),l=a.n(n),r=a(278),i=a.n(r)()(l());i.push([e.id,".dark-box {\n  background-color: rgba(32, 34, 38); \n  padding: 8px; \n  border-radius: 4px;\n  border-color: 1px darkgray;\n}\n\n.dark-box .switch {\n  background-color: blue; /* Change the background color */\n}\n\n.dark-box .switch::before {\n  background-color: white; /* Change the color of the switch thumb */\n}\n\n.dark-button {\n  background-color: rgb(34,37,43); \n  color: rgb(199,204,220); \n}","",{version:3,sources:["webpack://./css/config-editor.css"],names:[],mappings:"AAAA;EACE,kCAAkC;EAClC,YAAY;EACZ,kBAAkB;EAClB,0BAA0B;AAC5B;;AAEA;EACE,sBAAsB,EAAE,gCAAgC;AAC1D;;AAEA;EACE,uBAAuB,EAAE,yCAAyC;AACpE;;AAEA;EACE,+BAA+B;EAC/B,uBAAuB;AACzB",sourcesContent:[".dark-box {\n  background-color: rgba(32, 34, 38); \n  padding: 8px; \n  border-radius: 4px;\n  border-color: 1px darkgray;\n}\n\n.dark-box .switch {\n  background-color: blue; /* Change the background color */\n}\n\n.dark-box .switch::before {\n  background-color: white; /* Change the color of the switch thumb */\n}\n\n.dark-button {\n  background-color: rgb(34,37,43); \n  color: rgb(199,204,220); \n}"],sourceRoot:""}]);const o=i},636:(e,t,a)=>{a.d(t,{A:()=>o});var n=a(942),l=a.n(n),r=a(278),i=a.n(r)()(l());i.push([e.id,".dark-box {\n    background-color: rgba(17, 18, 23);\n    padding: 6px;\n    border-radius: 2px;\n    border: 1px solid darkgray;\n    display: flex;\n    align-items: center;\n}\n  \n.dark-box span {\n    margin: 0;\n    padding: 2px; \n}\n\n.auto-width {\n    width: auto;\n}\n  \n  ","",{version:3,sources:["webpack://./css/query-editor.css"],names:[],mappings:"AAAA;IACI,kCAAkC;IAClC,YAAY;IACZ,kBAAkB;IAClB,0BAA0B;IAC1B,aAAa;IACb,mBAAmB;AACvB;;AAEA;IACI,SAAS;IACT,YAAY;AAChB;;AAEA;IACI,WAAW;AACf",sourcesContent:[".dark-box {\n    background-color: rgba(17, 18, 23);\n    padding: 6px;\n    border-radius: 2px;\n    border: 1px solid darkgray;\n    display: flex;\n    align-items: center;\n}\n  \n.dark-box span {\n    margin: 0;\n    padding: 2px; \n}\n\n.auto-width {\n    width: auto;\n}\n  \n  "],sourceRoot:""}]);const o=i},278:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var a="",n=void 0!==t[5];return t[4]&&(a+="@supports (".concat(t[4],") {")),t[2]&&(a+="@media ".concat(t[2]," {")),n&&(a+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),a+=e(t),n&&(a+="}"),t[2]&&(a+="}"),t[4]&&(a+="}"),a})).join("")},t.i=function(e,a,n,l,r){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(n)for(var o=0;o<this.length;o++){var u=this[o][0];null!=u&&(i[u]=!0)}for(var s=0;s<e.length;s++){var d=[].concat(e[s]);n&&i[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),a&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=a):d[2]=a),l&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=l):d[4]="".concat(l)),t.push(d))}},t}},942:e=>{e.exports=function(e){var t=e[1],a=e[3];if(!a)return t;if("function"==typeof btoa){var n=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(n),r="/*# ".concat(l," */");return[t].concat([r]).join("\n")}return[t].join("\n")}},292:e=>{var t=[];function a(e){for(var a=-1,n=0;n<t.length;n++)if(t[n].identifier===e){a=n;break}return a}function n(e,n){for(var r={},i=[],o=0;o<e.length;o++){var u=e[o],s=n.base?u[0]+n.base:u[0],d=r[s]||0,c="".concat(s," ").concat(d);r[s]=d+1;var m=a(c),p={css:u[1],media:u[2],sourceMap:u[3],supports:u[4],layer:u[5]};if(-1!==m)t[m].references++,t[m].updater(p);else{var v=l(p,n);n.byIndex=o,t.splice(o,0,{identifier:c,updater:v,references:1})}i.push(c)}return i}function l(e,t){var a=t.domAPI(t);return a.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;a.update(e=t)}else a.remove()}}e.exports=function(e,l){var r=n(e=e||[],l=l||{});return function(e){e=e||[];for(var i=0;i<r.length;i++){var o=a(r[i]);t[o].references--}for(var u=n(e,l),s=0;s<r.length;s++){var d=a(r[s]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=u}}},383:e=>{var t={};e.exports=function(e,a){var n=function(e){if(void 0===t[e]){var a=document.querySelector(e);if(window.HTMLIFrameElement&&a instanceof window.HTMLIFrameElement)try{a=a.contentDocument.head}catch(e){a=null}t[e]=a}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(a)}},88:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},884:(e,t,a)=>{e.exports=function(e){var t=a.nc;t&&e.setAttribute("nonce",t)}},893:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(a){!function(e,t,a){var n="";a.supports&&(n+="@supports (".concat(a.supports,") {")),a.media&&(n+="@media ".concat(a.media," {"));var l=void 0!==a.layer;l&&(n+="@layer".concat(a.layer.length>0?" ".concat(a.layer):""," {")),n+=a.css,l&&(n+="}"),a.media&&(n+="}"),a.supports&&(n+="}");var r=a.sourceMap;r&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,a)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},997:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},781:t=>{t.exports=e},531:e=>{e.exports=t},7:e=>{e.exports=n},241:e=>{e.exports=l},959:e=>{e.exports=a}},i={};function o(e){var t=i[e];if(void 0!==t)return t.exports;var a=i[e]={id:e,exports:{}};return r[e](a,a.exports,o),a.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nc=void 0;var u={};return(()=>{o.r(u),o.d(u,{plugin:()=>oe});var e=o(781),t=o(531);const a=[{label:"Query Wizard",value:"Elements"},{label:"Text Editor",value:"Text"}],n={"Select All":{Value:!1,Order:-1,Flag:0},Normal:{Value:!1,Order:0,Flag:0},BadData:{Value:!1,Order:1,Flag:1},SuspectData:{Value:!1,Order:2,Flag:2},OverRangeError:{Value:!1,Order:3,Flag:4},UnderRangeError:{Value:!1,Order:4,Flag:8},AlarmHigh:{Value:!1,Order:5,Flag:16},AlarmLow:{Value:!1,Order:6,Flag:32},WarningHigh:{Value:!1,Order:7,Flag:64},WarningLow:{Value:!1,Order:8,Flag:128},FlatlineAlarm:{Value:!1,Order:9,Flag:256},ComparisonAlarm:{Value:!1,Order:10,Flag:512},ROCAlarm:{Value:!1,Order:11,Flag:1024},ReceivedAsBad:{Value:!1,Order:12,Flag:2048},CalculatedValue:{Value:!1,Order:13,Flag:4096},CalculationError:{Value:!1,Order:14,Flag:8192},CalculationWarning:{Value:!1,Order:15,Flag:16384},ReservedQualityFlag:{Value:!1,Order:16,Flag:32768},BadTime:{Value:!1,Order:17,Flag:65536},SuspectTime:{Value:!1,Order:18,Flag:1<<17},LateTimeAlarm:{Value:!1,Order:19,Flag:1<<18},FutureTimeAlarm:{Value:!1,Order:20,Flag:1<<19},UpSampled:{Value:!1,Order:21,Flag:1<<20},DownSampled:{Value:!1,Order:22,Flag:1<<21},DiscardedValue:{Value:!1,Order:23,Flag:1<<22},ReservedTimeFlag:{Value:!1,Order:24,Flag:1<<23},UserDefinedFlag1:{Value:!1,Order:25,Flag:1<<24},UserDefinedFlag2:{Value:!1,Order:26,Flag:1<<25},UserDefinedFlag3:{Value:!1,Order:27,Flag:1<<26},UserDefinedFlag4:{Value:!1,Order:28,Flag:1<<27},UserDefinedFlag5:{Value:!1,Order:29,Flag:1<<28},SystemError:{Value:!1,Order:30,Flag:1<<29},SystemWarning:{Value:!1,Order:31,Flag:1<<30},MeasurementError:{Value:!1,Order:32,Flag:1<<31}};var l=o(959),r=o.n(l),i=o(7),s=o(292),d=o.n(s),c=o(893),m=o.n(c),p=o(383),v=o.n(p),y=o(884),g=o.n(y),b=o(88),f=o.n(b),h=o(997),E=o.n(h),F=o(636),T={};function S(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function O(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){S(e,t,a[t])}))}return e}function A(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a.push.apply(a,n)}return a}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}function I({query:e,onChange:t}){return r().useEffect((()=>{"Annotations"!==e.queryType&&t(A(O({},e),{queryType:"Annotations"}))}),[e,t]),r().createElement(i.FieldSet,{style:{display:"flex",flexDirection:"column"}},r().createElement(i.InlineField,{label:"Query",labelWidth:"auto",grow:!0,shrink:!0},r().createElement(i.TextArea,{value:e.queryText,onChange:a=>t(A(O({},e),{queryText:a.target.value})),rows:5,width:150})))}function x(e,t,a,n,l,r,i){try{var o=e[r](i),u=o.value}catch(e){return void a(e)}o.done?t(u):Promise.resolve(u).then(n,l)}function C(e){return function(){var t=this,a=arguments;return new Promise((function(n,l){var r=e.apply(t,a);function i(e){x(r,n,l,i,o,"next",e)}function o(e){x(r,n,l,i,o,"throw",e)}i(void 0)}))}}function w(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}T.styleTagTransform=E(),T.setAttributes=g(),T.insert=v().bind(null,"head"),T.domAPI=m(),T.insertStyleElement=f(),d()(F.A,T),F.A&&F.A.locals&&F.A.locals;class D extends e.DataSourceApi{metricFindQuery(e,a){var n=this;return C((function*(){var a,l;if(void 0!==e.tableName&&void 0!==e.fieldNames)return 0===e.tableName.length&&(e.tableName="ActiveMeasurements",0!==e.fieldNames.length&&"*"!==e.fieldNames[0]||(e.fieldNames=["PointTag"])),0===e.fieldNames.length&&(e.fieldNames=["*"]),(yield(0,t.getBackendSrv)().post(n.url+"/Search",{dataTypeIndex:-1,expression:`SELECT DISTINCT ${e.fieldNames} FROM ${e.tableName} ${null===(l=null===(a=e.condition)||void 0===a?void 0:a.length)||void 0===l||l?"":` WHERE ${e.condition}`}`})).map((e=>({text:e})))}))()}calculateFlags(){let e=0;for(const[t,a]of Object.entries(this.flags))"Select All"!==t&&"Normal"!==t&&!0===a&&(e^=n[t].Flag);return e}targetToString(e){return void 0===e?"":"Elements"===e.queryType||void 0===e.queryType?this.parsedQueryToString(e.parsedQuery):"Text"===e.queryType?e.queryText:""}functionToString(e){const t=e.Parameters.map((e=>e.type.type.includes("IAsyncEnumerable")?this.parsedQueryToString(e.value):e.value.toString())).join(",");return`${e.Function}(${t})`}parsedQueryToString(e){if(void 0===e)return"";const t=[];return void 0!==e.Elements&&t.push(e.Elements.join(";")),void 0!==e.Filters&&t.push(e.Filters.map((e=>{var t;return`FILTER ${""===e.NumberMode?"":`${e.NumberMode} ${e.Number}`} ${e.Table}${(null===(t=e.Condition)||void 0===t?void 0:t.length)>0?` WHERE ${e.Condition}`:""}`})).join(";")),void 0!==e.Functions&&t.push(e.Functions.map((e=>this.functionToString(e))).join(";")),t.filter((e=>e.length>0)).join(";")}buildQueryParameters(e){const a=this.calculateFlags();var n;const l=null!==(n=this.flags.Normal)&&void 0!==n&&n,r=e.targets.filter((e=>{var t;return!(null!==(t=e.hide)&&void 0!==t&&t)&&"Annotations"!==e.queryType})).map((a=>{var n,l,r,i;const o=[];void 0!==a.metadataOptions&&a.metadataOptions.forEach((e=>{var t;void 0!==o.find((t=>t.tableName===e.Table))?null===(t=o.find((t=>t.tableName===e.Table)))||void 0===t||t.fieldNames.push(e.FieldName):o.push({tableName:e.Table,fieldNames:[e.FieldName]})}));let u=(0,t.getTemplateSrv)().replace(this.targetToString(a),e.scopedVars);var s,d,c,m,p,v,y,g;return null!==(s=null===(n=a.commandLevel)||void 0===n?void 0:n.DropEmpty)&&void 0!==s&&s&&(u=`${u}; dropEmptySeries`),null!==(d=null===(l=a.commandLevel)||void 0===l?void 0:l.IncludePeaks)&&void 0!==d&&d&&(u=`${u}; includePeaks`),null!==(c=null===(r=a.commandLevel)||void 0===r?void 0:r.FullResolution)&&void 0!==c&&c&&(u=`${u}; fullResolutionQuery`),null!==(m=null===(i=a.commandLevel)||void 0===i?void 0:i.RadialDistribution)&&void 0!==m&&m&&(u=`${u}; radialDistribution={radius=${null!==(y=null===(p=a.commandLevel)||void 0===p?void 0:p.Radius)&&void 0!==y?y:1.5}; zoom=${null!==(g=null===(v=a.commandLevel)||void 0===v?void 0:v.Zoom)&&void 0!==g?g:2}}`),{refID:a.refId,target:u,metadataSelections:o}}));var i;return{dataTypeIndex:this.valueTypeIndex,range:{from:e.range.from.toISOString(),to:e.range.to.toISOString()},interval:e.interval,targets:r,adhocFilters:[],excludedFlags:a,excludeNormalFlags:l,maxDataPoints:null!==(i=e.maxDataPoints)&&void 0!==i?i:1e3}}query(a){var n=this;return C((function*(){const l=a.targets[0],r=a.targets.map((e=>e.metadataOptions)).flat(),i=a.targets.some((e=>"Annotations"!==e.queryType)),o=a.targets.some((e=>"Annotations"===e.queryType));let u=[],s={},d=[];if(i){let i=n.buildQueryParameters(a),o=yield(0,t.getBackendSrv)().post(n.url+"/query",i);const s=n.timeSeriesDefinitions,c=new Map;u=o.map((t=>{var i;t.syntaxError&&d.push(t.syntaxError);const o=Object.keys(t.metadata);var u;if(null!==(u=null===(i=a.targets.find((e=>e.refId===t.refID)))||void 0===i?void 0:i.transpose)&&void 0!==u&&u){const a={};return c.has(t.refID)||c.set(t.refID,new e.MutableDataFrame({refId:t.refID,name:t.refID,fields:s.map(((t,a)=>({name:t,type:a<s.length-1?e.FieldType.number:e.FieldType.time})))})),t.datapoints.length>0?s.forEach(((e,n)=>{a[e]=t.datapoints[0][n]})):s.forEach(((e,t)=>{a[e]=NaN})),o.forEach((n=>{c.get(t.refID).fields.map((e=>e.name)).includes(n)||c.get(t.refID).addField({name:n,type:e.FieldType.other}),a[n]=t.metadata[n]})),void c.get(t.refID).add(a)}{const a=new e.MutableDataFrame({refId:l.refId,fields:o.concat(s).map(((t,a)=>{var l,i;return{name:t,type:a<o.length?n.metaDataDataType(null!==(i=null===(l=r.find((e=>e.FieldName===o[a]||`${e.Table}.${e.FieldName}`===o[a])))||void 0===l?void 0:l.Type)&&void 0!==i?i:""):a<o.length+s.length-1?e.FieldType.number:e.FieldType.time}}))});return a.refId=t.refID,a.name=t.target,t.datapoints.forEach((e=>{const n={};s.forEach(((t,a)=>{n[t]=e[a]})),o.forEach((e=>{n[e]=t.metadata[e]})),a.add(n)})),a}})).concat([...c.values()]).filter((e=>void 0!==e))}return o&&u.push(yield n.queryAnnotations(a)),d.length>0&&(s={message:d.join("\n\n")}),{data:u,error:s}}))()}testDatasource(){var e=this;return C((function*(){return yield(0,t.getBackendSrv)().get(e.url+"/").then((()=>({status:"success",message:"Data source is working",title:"Success"})),(()=>({status:"error",message:"Data source is not working",title:"Error"})))}))()}metaDataDataType(t){return"Int16"===t||"Int32"===t||"Int64"===t||"UInt16"===t||"UInt32"===t||"UInt64"===t||"IntPtr"===t||"UIntPtr"===t?e.FieldType.number:"Boolean"===t?e.FieldType.boolean:"Byte"===t||"SByte"===t||"Char"===t||"Decimal"===t||"Double"===t||"Single"===t?e.FieldType.number:"String"===t||"Guid"===t?e.FieldType.string:e.FieldType.other}queryAnnotations(a){var n=this;return C((function*(){const l=a.targets.map((e=>(0,t.getTemplateSrv)().replace(e.queryText,a.scopedVars))).join(";"),r={range:a.range,annotationQuery:l,rangeRaw:a.rangeRaw},i=yield(0,t.getBackendSrv)().post(n.url+"/annotations",r);if(i.length>500)throw Error(`There are ${i.length} annotations. Grafana can not display more than 500.`);const o=new e.MutableDataFrame({refId:a.targets[0].refId,fields:[{name:"time",type:e.FieldType.time},{name:"timeEnd",type:e.FieldType.time},{name:"title",type:e.FieldType.string},{name:"text",type:e.FieldType.string},{name:"tags",type:e.FieldType.string}]});return i.forEach((e=>{o.add({time:e.time,timeEnd:e.endTime,title:e.title,text:e.text,tags:e.tags})})),o}))()}constructor(e){var t;super(e),w(this,"url",void 0),w(this,"flags",void 0),w(this,"valueTypeIndex",void 0),w(this,"valueTypeName",void 0),w(this,"timeSeriesDefinitions",void 0),w(this,"metadataTableName",void 0),this.annotations={QueryEditor:I},this.url=e.url||"",this.flags=e.jsonData.flags||{},this.valueTypeIndex=parseInt(e.jsonData.valueTypeIndex||"0",10),this.valueTypeName=e.jsonData.valueTypeName||"",this.timeSeriesDefinitions=null!==(t=e.jsonData.timeSeriesDefinitions)&&void 0!==t?t:[""],this.metadataTableName=e.jsonData.metadataTableName||""}}var j=o(124),k={};function P(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function N(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){P(e,t,a[t])}))}return e}function q(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a.push.apply(a,n)}return a}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}k.styleTagTransform=E(),k.setAttributes=g(),k.insert=v().bind(null,"head"),k.domAPI=m(),k.insertStyleElement=f(),d()(j.A,k),j.A&&j.A.locals&&j.A.locals;const R=[{name:"MeasurementValue",index:0,timeSeriesDefinition:"Value, Time",metadataTableName:"ActiveMeasurements"},{name:"PhasorValue",index:1,timeSeriesDefinition:"Magnitude, Angle, Time",metadataTableName:"PhasorValues"}];var B=o(241),L=o.n(B);function M(e,t,a,n,l,r,i){try{var o=e[r](i),u=o.value}catch(e){return void a(e)}o.done?t(u):Promise.resolve(u).then(n,l)}function V(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Q(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){V(e,t,a[t])}))}return e}function W(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a.push.apply(a,n)}return a}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}const $=e=>{var a,n,l,i;const[o,u]=r().useState(null!==(i=null===(a=e.query.parsedQuery)||void 0===a?void 0:a.Elements)&&void 0!==i?i:[]);var s;const[d,c]=r().useState(null!==(s=null===(n=e.query.parsedQuery)||void 0===n?void 0:n.Functions)&&void 0!==s?s:[]),[m,p]=r().useState([]),[v,y]=r().useState([]);var g;const[b,f]=r().useState(null!==(g=null===(l=e.query.parsedQuery)||void 0===l?void 0:l.Filters)&&void 0!==g?g:[]);return r().useEffect((()=>{var a;null===(a=e.includeFunctions)||void 0===a||a?(0,t.getBackendSrv)().post(e.datasource.url+"/GetValueTypeFunctions",{dataTypeIndex:e.datasource.valueTypeIndex,expression:""}).then((e=>{p(e)})):p([])}),[e.datasource.url,e.includeFunctions,e.datasource.valueTypeIndex]),r().useEffect((()=>{(0,t.getBackendSrv)().post(e.datasource.url+"/GetValueTypeTables",{dataTypeIndex:e.datasource.valueTypeIndex,expression:""}).then((e=>{y(e)}))}),[e.datasource.url,e.datasource.valueTypeIndex]),r().createElement("div",{style:{width:"100%"}},r().createElement(U,{datasource:e.datasource,elements:o,update:function(t,a,n){u(t),void 0!==a&&c((e=>{var t;let n=L().clone(e);var l;return n.push({Function:a,Parameters:null!==(l=null===(t=m.find((e=>e.name===a)))||void 0===t?void 0:t.parameters.map((e=>({type:e,value:e.type.includes("IAsyncEnumerable")?{Elements:[],Functions:[],Filters:[]}:e.default}))))&&void 0!==l?l:[]}),n}));const l=Q({},e.query);void 0===l.parsedQuery&&(l.parsedQuery={Elements:[],Functions:[],Filters:[]}),l.parsedQuery.Elements=t,n&&(l.parsedQuery.Filters.push({Table:e.datasource.metadataTableName,Condition:"",Number:10,NumberMode:"TOP"}),f(l.parsedQuery.Filters)),e.onChange(l)},availableFunctions:m}),null==d?void 0:d.map(((t,a)=>r().createElement(z,{key:t.Function,update:t=>function(t,a){const n=Q({},e.query);void 0===n.parsedQuery&&(n.parsedQuery={Elements:[],Functions:[],Filters:[]}),void 0===t?n.parsedQuery.Functions.splice(a,1):n.parsedQuery.Functions[a]=t,c(n.parsedQuery.Functions),e.onChange(n)}(t,a),func:t,availableFunctions:m,availableTables:v,datasource:e.datasource}))),null==b?void 0:b.map(((t,a)=>r().createElement(G,{key:a,availableTables:v,update:t=>function(t,a){const n=Q({},e.query);void 0===n.parsedQuery&&(n.parsedQuery={Elements:[],Functions:[],Filters:[]}),void 0===t?n.parsedQuery.Filters.splice(a,1):n.parsedQuery.Filters[a]=t,f(n.parsedQuery.Filters),e.onChange(n)}(t,a),filter:t}))))},U=e=>{const a=r().useMemo((()=>e.elements.map((e=>({value:e,label:e})))),[e.elements]),n=(l=function*(a){const n=(yield(0,t.getBackendSrv)().post(e.datasource.url+"/Search",{dataTypeIndex:e.datasource.valueTypeIndex,expression:a})).map((e=>({value:e,label:e})));return"filter".includes(a.toLocaleLowerCase())&&n.push({value:"FILTER",label:"FILTER"}),e.availableFunctions.filter((e=>{var t,n;return e.name.toLocaleLowerCase().includes(a.toLocaleLowerCase())||null!==(n=null===(t=e.aliases)||void 0===t?void 0:t.some((e=>e.toLocaleLowerCase().includes(a.toLocaleLowerCase()))))&&void 0!==n&&n})).forEach((e=>{n.push({label:e.name,value:"fx-"+e.name})})),n},o=function(){var e=this,t=arguments;return new Promise((function(a,n){var r=l.apply(e,t);function i(e){M(r,a,n,i,o,"next",e)}function o(e){M(r,a,n,i,o,"throw",e)}i(void 0)}))},function(e){return o.apply(this,arguments)});var l,o;return r().createElement(i.InlineFieldRow,null,r().createElement(i.InlineField,{label:"Query",labelWidth:"auto"},r().createElement(i.AsyncMultiSelect,{loadOptions:n,defaultOptions:!0,value:a,onChange:t=>{const a=t.map((e=>e.value));let n=a.includes("FILTER");const l=a.filter((e=>e.startsWith("fx-")));let r;l.length>0&&(r=l[0].substring(3)),e.update(a.filter((e=>"FILTER"!==e&&!e.startsWith("fx-"))),r,n)},isSearchable:!0})),r().createElement(i.Button,{size:"sm",variant:"secondary",fill:"solid",icon:"plus-circle",style:{marginTop:4,marginLeft:5},onClick:()=>e.update(a.map((e=>e.value)),void 0,!0)},"Filter"),r().createElement(i.Button,{size:"sm",variant:"secondary",fill:"solid",icon:"plus-circle",style:{marginTop:4,marginLeft:5},onClick:()=>{var t;return e.update(a.map((e=>e.value)),null===(t=e.availableFunctions.find((()=>!0)))||void 0===t?void 0:t.name,!1)}},"Function"))},G=e=>{const t=r().useMemo((()=>e.availableTables.map((e=>({label:e,value:e})))),[e.availableTables]),a=r().useMemo((()=>""===e.filter.Table?[]:[{value:e.filter.Table,label:e.filter.Table}]),[e.filter.Table]);return r().createElement(i.FieldSet,null,r().createElement(i.InlineFieldRow,null,r().createElement(i.IconButton,{name:"trash-alt",size:"xl",iconType:"default",variant:"destructive",style:{marginTop:4,marginRight:0},onClick:()=>e.update(void 0)}),r().createElement(i.InlineField,{label:r().createElement(i.InlineLabel,{style:{flexShrink:1}},r().createElement(i.IconButton,{name:"filter",size:"md",iconType:"default",variant:"secondary",style:{marginLeft:-2}}),"FILTER"),labelWidth:"auto"},r().createElement(i.Select,{value:e.filter.NumberMode,options:[{label:"TOP",value:"TOP"},{label:"ALL",value:""}],onChange:function(t){e.update(W(Q({},e.filter),{NumberMode:t.value}))}})),""!==e.filter.NumberMode?r().createElement(i.Input,{type:"number",min:0,max:99999,value:e.filter.Number,onChange:function(t){const a=t.target.value;e.update(W(Q({},e.filter),{Number:parseInt(a,10)}))},width:10}):null,r().createElement(i.InlineField,{label:"",labelWidth:1,transparent:!0,style:{marginLeft:-16}},r().createElement(i.Select,{value:a,options:t,isLoading:0===t.length,onChange:function(t){var a;e.update(W(Q({},e.filter),{Table:null!==(a=t.value)&&void 0!==a?a:""}))},isSearchable:!0,width:"auto"}))),r().createElement(i.InlineFieldRow,null,r().createElement(i.InlineField,{label:"WHERE",grow:!0},r().createElement(i.Input,{value:e.filter.Condition,onChange:function(t){e.update(W(Q({},e.filter),{Condition:t.target.value}))},placeholder:"SignalType = 'FREQ'"}))))},z=e=>{const[t,a]=r().useState(!0),n=r().useMemo((()=>{var t;return null!==(t=e.availableFunctions.find((t=>t.name===e.func.Function)))&&void 0!==t?t:e.availableFunctions[0]}),[e.func,e.availableFunctions]),l=r().useMemo((()=>e.availableFunctions.map((e=>({value:e.name,label:e.name})))),[e.availableFunctions]);return r().createElement(i.Collapse,{collapsible:!0,label:r().createElement(i.InlineFieldRow,null,r().createElement(i.IconButton,{name:"trash-alt",size:"xl",iconType:"default",variant:"destructive",style:{marginTop:4,marginRight:6},onClick:()=>e.update(void 0)}),r().createElement("span",{style:{marginTop:5,marginRight:4,fontSize:"small"}},"ƒ(x)"),r().createElement(i.Select,{value:e.func.Function,options:l,onChange:function(t){const n=e.availableFunctions.find((e=>e.name===t.value));if(null===n)return;var l;const r=null!==(l=null==n?void 0:n.parameters.map((e=>({type:e,value:e.type.includes("IAsyncEnumerable")?{Elements:[],Functions:[],Filters:[]}:e.default}))))&&void 0!==l?l:[];var i;e.update({Function:null!==(i=t.value)&&void 0!==i?i:"AbsoluteValue",Parameters:r}),a(!0)},isSearchable:!0,tabSelectsValue:!0,width:"auto"}),r().createElement("div",{style:{marginTop:5,marginLeft:10}},Z(n)," ",null==n?void 0:n.returnType.toLowerCase(),Y(n)," function",_(n),".")),isOpen:t,onToggle:()=>a((e=>!e))},r().createElement("p",null,null==n?void 0:n.description),r().createElement("ul",null,e.func.Parameters.map(((t,a)=>r().createElement("li",{key:t.type.name},r().createElement(H,{update:t=>function(t,a){const n=L().cloneDeep(e.func);n.Parameters[a]=t,e.update(n)}(t,a),param:t,availableFunctions:e.availableFunctions,availableTables:e.availableTables,datasource:e.datasource}))))))},H=e=>{var t,a,n,l,o,u,s,d,c,m,p,v,y,g,b,f,h,E,F,T,S,O;function A(t){e.update({type:e.param.type,value:t.target.value})}function I(t){e.update({type:e.param.type,value:t.value})}return r().createElement(i.Card,null,r().createElement(i.Card.Heading,null,e.param.type.name," (",e.param.type.required?"required":"optional",")"),r().createElement(i.Card.Description,null,r().createElement(r().Fragment,null,r().createElement("p",null,e.param.type.description," (",e.param.type.type,!e.param.type.required&&(null===(t=e.param.type.default)||void 0===t?void 0:t.length)>0?`: default = ${e.param.type.default}`:"",")"),e.param.type.type.includes("IAsyncEnumerable")?r().createElement(r().Fragment,null,r().createElement(U,{datasource:e.datasource,elements:null!==(f=null===(n=e.param)||void 0===n||null===(a=n.value)||void 0===a?void 0:a.Elements)&&void 0!==f?f:[],update:function(t,a,n){let l=L().cloneDeep(e.param);if(void 0===l&&(l={type:e.param.type,value:{Elements:[],Functions:[],Filters:[]}}),void 0!==a){var r;const t=e.availableFunctions.find((e=>e.name===a));if(null===t)return;var i;const n=null!==(i=null==t?void 0:t.parameters.map((e=>({type:e,value:e.type.includes("IAsyncEnumerable")?{Elements:[],Functions:[],Filters:[]}:e.default}))))&&void 0!==i?i:[];null===(r=l.value)||void 0===r||r.Functions.push({Function:a,Parameters:n})}var o;l.value.Elements=t,n&&(null===(o=l.value)||void 0===o||o.Filters.push({Table:e.datasource.metadataTableName,Condition:"",Number:10,NumberMode:"TOP"})),e.update(l)},availableFunctions:e.availableFunctions}),null===(u=e.param)||void 0===u||null===(o=u.value)||void 0===o||null===(l=o.Functions)||void 0===l?void 0:l.map(((t,a)=>r().createElement(z,{key:t.Function,update:t=>function(t,a){let n=L().cloneDeep(e.param);var l;void 0===n&&(n={type:e.param.type,value:{Elements:[],Functions:[],Filters:[]}}),void 0===t?null===(l=n.value)||void 0===l||l.Functions.splice(a,1):n.value.Functions[a]=t,e.update(n)}(t,a),func:t,availableFunctions:e.availableFunctions,availableTables:e.availableTables,datasource:e.datasource}))),null===(c=e.param)||void 0===c||null===(d=c.value)||void 0===d||null===(s=d.Filters)||void 0===s?void 0:s.map(((t,a)=>r().createElement(G,{key:a,availableTables:e.availableTables,update:t=>function(t,a){let n=L().cloneDeep(e.param);var l;void 0===n&&(n={type:e.param.type,value:{Elements:[],Functions:[],Filters:[]}}),void 0===t?null===(l=n.value)||void 0===l||l.Filters.splice(a,1):n.value.Filters[a]=t,e.update(n)}(t,a),filter:t})))):null,"Double"===e.param.type.type?r().createElement(i.Input,{type:"number",value:null!==(h=null===(m=e.param)||void 0===m?void 0:m.value)&&void 0!==h?h:"1.0",onChange:A,width:20}):null,"String"===e.param.type.type?r().createElement(i.Input,{type:"text",value:null!==(E=null===(p=e.param)||void 0===p?void 0:p.value)&&void 0!==E?E:"",onChange:A,width:20}):null,"Int32"===e.param.type.type?r().createElement(i.Input,{type:"number",min:0,max:99999,value:null!==(F=null===(v=e.param)||void 0===v?void 0:v.value)&&void 0!==F?F:"1",onChange:A,width:20}):null,"AngleUnit"===e.param.type.type?r().createElement(i.Select,{value:null!==(T=null===(y=e.param)||void 0===y?void 0:y.value)&&void 0!==T?T:"Degrees",options:[{value:"Radians",label:"Radians"},{value:"Degrees",label:"Degrees"},{value:"Grads",label:"Grads"},{value:"ArcMinutes",label:"ArcMinutes"},{value:"ArcSeconds",label:"ArcSeconds"},{value:"AngularMil",label:"AngularMil"}],onChange:I,isSearchable:!0}):null,"TargetTimeUnit"===e.param.type.type?r().createElement(i.Select,{value:null!==(S=null===(g=e.param)||void 0===g?void 0:g.value)&&void 0!==S?S:"Seconds",options:[{value:"Seconds",label:"Seconds"},{value:"Nanoseconds",label:"Nanoseconds"},{value:"Microseconds",label:"Microseconds"},{value:"Milliseconds",label:"Milliseconds"},{value:"Minutes",label:"Minutes"},{value:"Hours",label:"Hours"},{value:"Days",label:"Days"},{value:"Weeks",label:"Weeks"},{value:"Ke",label:"Ke (traditional Chinese)"},{value:"Ticks",label:"Ticks"},{value:"PlanckTime",label:"PlanckTime"},{value:"AtomicUnitsOfTime",label:"AtomicUnitsOfTime"}],onChange:I,isSearchable:!0}):null,"Boolean"===e.param.type.type?r().createElement(i.Select,{value:null!==(O=null===(b=e.param)||void 0===b?void 0:b.value)&&void 0!==O?O:"1",options:[{value:"1",label:"True"},{value:"0",label:"False"}],onChange:I,isSearchable:!0}):null)))},Z=e=>{var t;return"BuiltIn"===(null!==(t=null==e?void 0:e.category)&&void 0!==t?t:"BuiltIn")?"Built-in":"Custom"},Y=e=>{var t;const a=null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"";return a.startsWith("Slice")?" slice":a.startsWith("Set")?" set":""},_=e=>{var t;const a=null!==(t=null==e?void 0:e.allowedGroupOperations.split(",").map((e=>e.trim())))&&void 0!==t?t:[];var n;let l=null!==(n=null==e?void 0:e.publishedGroupOperations.split(",").map((e=>e.trim())))&&void 0!==n?n:[];if(0===l.length)return"";const r=new Set(a);var i;let o=null!==(i=null==e?void 0:e.name)&&void 0!==i?i:"";l.every((e=>r.has(e)))||(o=a[0],l=a);const u=new Set(l),s=[];let d=!1;if(o.startsWith("Slice")?(u.has("None")&&(d=!0),u.has("Set")&&s.push("set")):o.startsWith("Set")?(u.has("None")&&(d=!0),u.has("Slice")&&s.push("slice")):(u.has("Slice")&&s.push("slice"),u.has("Set")&&s.push("set")),!d&&0===s.length)return"";const c=[];return d&&c.push("standard non-grouped"),s.length>0&&(c.length>0&&c.push(" and "),c.push(s.join(" and ")),c.push(" group"),s.length>1&&c.push("ed")),c.push(" operation"),(d?1:0)+s.length>1&&c.push("s"),`, also supports ${c.join("")}`},J=e=>{var a;const[n,l]=r().useState([]);return r().useEffect((()=>{(0,t.getBackendSrv)().post(e.datasource.url+"/GetValueTypeTables",{dataTypeIndex:e.datasource.valueTypeIndex,expression:""}).then((e=>{var t;l(null!==(t=null==e?void 0:e.map((e=>({value:e,label:e}))))&&void 0!==t?t:[])}))}),[e.datasource.valueTypeIndex,e.datasource.url]),r().createElement(i.FieldSet,null,null===(a=e.query)||void 0===a?void 0:a.map(((t,a)=>r().createElement(K,{Field:t,key:a,Remove:()=>(t=>{let a=[...e.query];a.splice(t,1),e.onChange(a)})(a),Update:t=>((t,a)=>{let n=[...e.query];n[a]=t,e.onChange(n)})(t,a),TableOptions:n,Datasource:e.datasource}))),r().createElement(i.InlineFieldRow,null,r().createElement(i.InlineField,null,r().createElement(i.Button,{size:"md",icon:"plus-circle",variant:"secondary",onClick:()=>(void 0===e.query&&e.onChange([{Table:e.datasource.metadataTableName,FieldName:"",Type:""}]),void e.onChange([...e.query,{Table:e.datasource.metadataTableName,FieldName:"",Type:""}]))},"Add Metadata"))))},K=e=>{var a,n,l,o,u,s,d;const[c,m]=r().useState([]),p=r().useMemo((()=>c.map((e=>({value:e.FieldName,label:e.FieldName})))),[c]);var v,y,g;return r().useEffect((()=>{m([]),void 0!==e.Field.Table&&(0,t.getBackendSrv)().post(e.Datasource.url+"/GetValueTypeTableFields",{dataTypeIndex:e.Datasource.valueTypeIndex,expression:e.Field.Table}).then((t=>{var a;return m(null!==(a=null==t?void 0:t.map((t=>({FieldName:t.name,Table:e.Field.Table,Type:t.type}))))&&void 0!==a?a:[])}))}),[e.Field.Table,e.Datasource.url,e.Datasource.valueTypeIndex]),r().createElement(i.InlineFieldRow,null,r().createElement(i.InlineField,{label:"Table",labelWidth:12},r().createElement(i.Select,{value:e.Field.Table,options:e.TableOptions,onChange:t=>{var a;e.Update({Table:null!==(a=t.value)&&void 0!==a?a:"",FieldName:"",Type:""})},isLoading:0===e.TableOptions.length,invalid:0===(null!==(v=null===(n=e.Field)||void 0===n||null===(a=n.Table)||void 0===a?void 0:a.length)&&void 0!==v?v:0)})),r().createElement(i.InlineField,{label:"Field",labelWidth:12},r().createElement(i.Select,{value:null===(l=e.Field)||void 0===l?void 0:l.FieldName,options:p,onChange:t=>{const a=c.find((e=>e.FieldName===t.value));void 0!==a&&e.Update(a)},isLoading:0===p.length,invalid:0===(null!==(y=null===(u=e.Field)||void 0===u||null===(o=u.FieldName)||void 0===o?void 0:o.length)&&void 0!==y?y:0),disabled:0===(null!==(g=null===(d=e.Field)||void 0===d||null===(s=d.Table)||void 0===s?void 0:s.length)&&void 0!==g?g:0)})),r().createElement(i.InlineField,null,r().createElement(i.IconButton,{name:"trash-alt",size:"xl",iconType:"default",variant:"destructive",style:{marginTop:4,marginLeft:4},onClick:()=>e.Remove()})))},X=e=>r().createElement(i.FieldSet,null,r().createElement(i.InlineField,{label:"Query Editor",labelWidth:12,grow:!0,shrink:!0},r().createElement(i.TextArea,{value:e.query,onChange:t=>e.onChange(t.target.value),rows:10,width:150}))),ee=e=>{var t,a,n,l,o,u,s;const d=e=>null!=e?e:{DropEmpty:!1,IncludePeaks:!1,FullResolution:!1,RadialDistribution:!1,Radius:1.5,Zoom:2},c=(t,a)=>{let n=d(e.query);n[a]=!n[a],e.onChange(n)};var m,p,v,y,g,b,f;return r().createElement(i.FieldSet,null,r().createElement(i.InlineFieldRow,null,r().createElement(i.InlineField,{label:"Drop Empty Series",labelWidth:24,tooltip:"Requests that series that return no data be removed from the the visualization targets"},r().createElement(i.InlineSwitch,{disabled:!1,value:null!==(m=null===(t=e.query)||void 0===t?void 0:t.DropEmpty)&&void 0!==m&&m,onChange:e=>c(0,"DropEmpty")})),r().createElement(i.InlineField,{label:"Include Peaks",labelWidth:24,tooltip:"Requests that decimated data from query source include both minimum and maximum interval peaks, note that this can reduce query performance."},r().createElement(i.InlineSwitch,{disabled:!1,value:null!==(p=null===(a=e.query)||void 0===a?void 0:a.IncludePeaks)&&void 0!==p&&p,onChange:e=>c(0,"IncludePeaks")}))),r().createElement(i.InlineFieldRow,null,r().createElement(i.InlineField,{label:"Full Resolution Data",labelWidth:24,tooltip:"Requests that query source return full resolution data, note that this can reduce query and/or visualization performance."},r().createElement(i.InlineSwitch,{disabled:!1,value:null!==(v=null===(n=e.query)||void 0===n?void 0:n.FullResolution)&&void 0!==v&&v,onChange:e=>c(0,"FullResolution")})),r().createElement(i.InlineField,{label:"Radial Geo Distribution",labelWidth:24,tooltip:"Requests that overlapping geo-coordinates, i.e., longitude and latitude, when included as selected as metadata, be distributed radially."},r().createElement(i.InlineSwitch,{disabled:!1,value:null!==(y=null===(l=e.query)||void 0===l?void 0:l.RadialDistribution)&&void 0!==y&&y,onChange:e=>c(0,"RadialDistribution")}))),null!==(g=null===(o=e.query)||void 0===o?void 0:o.RadialDistribution)&&void 0!==g&&g?r().createElement(i.InlineFieldRow,null,r().createElement(i.InlineField,{label:"Radius"},r().createElement(i.Input,{type:"number",value:(null!==(b=null===(u=e.query)||void 0===u?void 0:u.Radius)&&void 0!==b?b:1.5).toString(),onChange:function(t){let a=d(e.query);a.Radius=parseFloat(t.target.value.toString()),e.onChange(a)}})),r().createElement(i.InlineField,{label:"Zoom"},r().createElement(i.Input,{type:"number",value:(null!==(f=null===(s=e.query)||void 0===s?void 0:s.Zoom)&&void 0!==f?f:2).toString(),onChange:function(t){let a=d(e.query);a.Zoom=parseFloat(t.target.value.toString()),e.onChange(a)}}))):null)};function te(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ae(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){te(e,t,a[t])}))}return e}function ne(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a.push.apply(a,n)}return a}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}function le(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function re(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){le(e,t,a[t])}))}return e}function ie(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a.push.apply(a,n)}return a}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}const oe=new e.DataSourcePlugin(D).setConfigEditor((function(e){const{onOptionsChange:a,options:l}=e,[o,u]=r().useState([]),s=r().useMemo((()=>o.map((e=>({value:e.index.toString(),label:e.name})))),[o]),d=r().useMemo((()=>{var e;return null!==(e=l.url)&&void 0!==e?e:""}),[l]),[c,m]=r().useState(!0);r().useEffect((()=>{0!==d.length&&(0,t.getBackendSrv)().post(d+"/GetValueTypes",{}).then((e=>u(e))).catch((e=>console.error("Error fetching data source types:",e)))}),[]),r().useEffect((()=>{s.length<1||void 0!==l.jsonData.valueTypeIndex||v(s[0])}),[s,l.jsonData]);const p=e=>{const t=e.target,{name:r,checked:i}=t;let o={};if("Select All"===r){const e=!l.jsonData.flags||!l.jsonData.flags["Select All"];o=Object.keys(n).reduce(((t,a)=>(t[a]=e,t)),{})}else o=q(N({},l.jsonData.flags),{[r]:i}),i||(o["Select All"]=!1);const u=q(N({},l.jsonData),{flags:o});a(q(N({},l),{jsonData:u}))},v=e=>{var t,n;const r=(null!==(n=e.value)&&void 0!==n?n:"0").toString(),i=o.find((e=>e.index.toString()===r));var u,s,d;const c=q(N({},l.jsonData),{valueTypeIndex:r,valueTypeName:null!==(u=null==i?void 0:i.name)&&void 0!==u?u:"",timeSeriesDefinitions:null!==(s=null==i||null===(t=i.timeSeriesDefinition)||void 0===t?void 0:t.split(","))&&void 0!==s?s:[""],metadataTableName:null!==(d=null==i?void 0:i.metadataTableName)&&void 0!==d?d:""});a(q(N({},l),{jsonData:c}))};var y;return r().createElement(i.FieldSet,{onBlur:()=>{0!==d.length&&(0,t.getBackendSrv)().post(d+"/GetValueTypes",{}).then((e=>u(e))).catch((e=>{console.error("Error fetching data source types:",e),u(R)}))}},r().createElement(i.DataSourceHttpSettings,{defaultUrl:"../api/grafana",dataSourceConfig:l,showAccessOptions:!0,onChange:e=>{0===d.length&&c&&(m(!1),e.url="../api/grafana"),a(e)}}),r().createElement(i.FieldSet,null,r().createElement("h3",{className:"page-heading"},"Excluded Data Flags",r().createElement(i.Tooltip,{content:"Mark flags which you want excluded"},r().createElement("span",{style:{cursor:"help"}}," 🛈"))),r().createElement(i.InlineFieldRow,null,Object.keys(n).map(((e,t)=>r().createElement(i.InlineField,{key:t,label:e,labelWidth:16},r().createElement("div",{className:"dark-box"},r().createElement(i.Switch,{name:e,disabled:!1,value:!(!l.jsonData.flags||!l.jsonData.flags[e])&&l.jsonData.flags[e],onChange:p}))))))),r().createElement(i.FieldSet,null,r().createElement("h3",{className:"page-heading"},"Data Source Type",r().createElement(i.Tooltip,{content:"Determines the type of data that is being queried"},r().createElement("span",{style:{cursor:"help"}}," 🛈"))),r().createElement(i.FieldSet,null,r().createElement(i.InlineFieldRow,null,r().createElement(i.InlineField,{label:"Data Type",labelWidth:24},r().createElement(i.Select,{value:l.jsonData.valueTypeIndex,options:s,onChange:v,isLoading:0===s.length,invalid:void 0===l.jsonData.valueTypeIndex})))),r().createElement(i.Card,null,r().createElement(i.Card.Heading,null,l.jsonData.valueTypeName),r().createElement(i.Card.Description,null,r().createElement("p",null,"This type includes the following elements: "),r().createElement(i.TagList,{className:"pull-left",tags:null!==(y=l.jsonData.timeSeriesDefinitions)&&void 0!==y?y:[""]})))))})).setQueryEditor((function({query:e,onChange:t,datasource:n,onRunQuery:l}){const o=r().useMemo((()=>{var t;return null!==(t=e.queryType)&&void 0!==t?t:"Elements"}),[e]),[u,s]=r().useState(void 0),d=e=>{var t,a,l,r;let i=n.targetToString(e);var o,u,s,d,c,m,p,v;return null!==(o=null===(t=e.commandLevel)||void 0===t?void 0:t.DropEmpty)&&void 0!==o&&o&&(i=`${i}; dropEmptySeries`),null!==(u=null===(a=e.commandLevel)||void 0===a?void 0:a.IncludePeaks)&&void 0!==u&&u&&(i=`${i}; includePeaks`),null!==(s=null===(l=e.commandLevel)||void 0===l?void 0:l.FullResolution)&&void 0!==s&&s&&(i=`${i}; fullResolutionQuery`),null!==(d=null===(r=e.commandLevel)||void 0===r?void 0:r.RadialDistribution)&&void 0!==d&&d&&(i=`${i}; radialDistribution={radius=${null!==(p=null===(c=e.commandLevel)||void 0===c?void 0:c.Radius)&&void 0!==p?p:1.5}; zoom=${null!==(v=null===(m=e.commandLevel)||void 0===m?void 0:m.Zoom)&&void 0!==v?v:2}}`),i},c=e=>{t(e),l()};var m;return r().createElement(i.FieldSet,{style:{display:"flex",flexDirection:"column"},onBlur:()=>{l()}},r().createElement(i.FieldSet,{style:{marginBottom:0}},r().createElement("h3",{className:"page-heading",style:{marginTop:16}},"General Settings"),r().createElement(i.FieldSet,{style:{marginBottom:16}},r().createElement("table",null,r().createElement("tr",null,r().createElement("td",null,r().createElement(i.InlineFieldRow,null,r().createElement(i.InlineField,{label:"Data Selection Mode",labelWidth:24},r().createElement(i.Select,{options:a,value:o,onChange:a=>{var n;const l=null!==(n=a.value)&&void 0!==n?n:"Elements";var r,i,o;"Elements"!==(null!==(r=null==e?void 0:e.queryType)&&void 0!==r?r:"Elements")||"Text"!==l?t(ne(ae({},e),{queryType:l})):0===(null!==(o=null===(i=e.queryText)||void 0===i?void 0:i.length)&&void 0!==o?o:0)||d(e).replace(/\s+/g,"").toLowerCase()===e.queryText.replace(/\s+/g,"").toLowerCase()?t(ne(ae({},e),{queryText:d(e),queryType:l})):s(d(e))},allowCustomValue:!1})),"Elements"===o?r().createElement(i.IconButton,{name:"question-circle",size:"lg",iconType:"default",variant:"secondary",style:{marginTop:4,marginRight:0},tooltip:r().createElement("div",null,r().createElement("p",{style:{marginBottom:8}},"Current Query Expression:"),r().createElement("p",null,r().createElement("em",null,d(e))))}):null,r().createElement(i.InlineField,{label:"Transpose Query Results",labelWidth:24,style:{marginLeft:16}},r().createElement(i.InlineSwitch,{value:null!==(m=e.transpose)&&void 0!==m&&m,onChange:t=>{var a;return c(ne(ae({},e),{transpose:!(null!==(a=e.transpose)&&void 0!==a&&a)}))},showLabel:!0}))))),r().createElement("tr",{style:{height:16}},r().createElement("td",null)),r().createElement("tr",null,r().createElement("td",null,"Elements"===o?r().createElement(ee,{query:e.commandLevel,onChange:t=>c(ne(ae({},e),{commandLevel:t}))}):null))))),r().createElement(i.FieldSet,{style:{marginBottom:16}},r().createElement("h3",{className:"page-heading"},"Metadata"),r().createElement(J,{datasource:n,onChange:t=>c(ne(ae({},e),{metadataOptions:t})),query:e.metadataOptions})),r().createElement(i.FieldSet,null,r().createElement("h3",{className:"page-heading"},"Data Selection"),"Text"===e.queryType?r().createElement(X,{onChange:a=>{return n=ne(ae({},e),{queryText:a}),void t(n);var n},query:e.queryText}):null,"Elements"===e.queryType||void 0===e.queryType?r().createElement($,{onChange:t=>c(ne(ae({},e),{queryText:t.queryText,parsedQuery:t.parsedQuery})),query:e,datasource:n}):null),r().createElement(i.ConfirmModal,{isOpen:void 0!==u,title:"Replace Existing Text Query",body:"Text mode has existing, distinct query expression text. Do you want replace the existing text query expression with the one that was built here?",confirmText:"Confirm",icon:"exclamation-triangle",onConfirm:()=>{t(ne(ae({},e),{queryText:null!=u?u:"",queryType:"Text"})),s(void 0)},onDismiss:()=>{s(void 0),t(ne(ae({},e),{queryType:"Text"}))}}))})).setVariableQueryEditor((function(e){var a,n,l,o,u,s,d,c,m;const[p,v]=r().useState([]),[y,g]=r().useState([]),[b,f]=r().useState(!0),{onChange:h,query:E}=e;var F,T,S;return r().useEffect((()=>{b&&!E.tableName&&h(ie(re({},E),{tableName:"ActiveMeasurements",fieldNames:["PointTag"]})),f(!1)}),[b,h,E]),r().useEffect((()=>{(0,t.getBackendSrv)().post(e.datasource.url+"/GetValueTypeTables",{dataTypeIndex:-1,expression:""}).then((e=>{v(e.map((e=>({value:e,label:e}))))}))}),[e.datasource.url,E.tableName]),r().useEffect((()=>{E.tableName&&(0,t.getBackendSrv)().post(e.datasource.url+"/GetValueTypeTableFields",{dataTypeIndex:-1,expression:E.tableName}).then((e=>{g(e.map((e=>({value:e.name,label:e.name}))))}))}),[e.datasource.url,E.tableName]),r().createElement(i.FieldSet,{style:{display:"flex",flexDirection:"column"}},r().createElement(i.FieldSet,null,r().createElement(i.InlineFieldRow,null,r().createElement(i.InlineField,{label:"Select",labelWidth:12},r().createElement(i.MultiSelect,{value:null===(a=e.query)||void 0===a?void 0:a.fieldNames,options:y,isLoading:0===y.length,onChange:function(t){let a=t.map((e=>{var t,a;return null!==(a=null===(t=e.value)||void 0===t?void 0:t.toString())&&void 0!==a?a:""}));"ActiveMeasurements"===e.query.tableName&&0===a.length&&(a=["*"]),e.onChange(ie(re({},e.query),{fieldNames:a}))},isSearchable:!0,invalid:0===(null!==(F=null===(l=e.query)||void 0===l||null===(n=l.fieldNames)||void 0===n?void 0:n.length)&&void 0!==F?F:0),disabled:0===(null!==(T=null===(u=e.query)||void 0===u||null===(o=u.tableName)||void 0===o?void 0:o.length)&&void 0!==T?T:0)})),r().createElement(i.InlineField,{label:"FROM",labelWidth:12},r().createElement(i.Select,{value:null===(s=e.query)||void 0===s?void 0:s.tableName,options:p,isLoading:0===p.length,onChange:function(t){let a=e.query.fieldNames;var n;"ActiveMeasurements"===t.value?a.includes("PointTag")||(a=["PointTag"]):a=["*"],e.onChange(ie(re({},e.query),{tableName:null!==(n=t.value)&&void 0!==n?n:"",fieldNames:a}))},isSearchable:!0,invalid:0===(null!==(S=null===(c=e.query)||void 0===c||null===(d=c.tableName)||void 0===d?void 0:d.length)&&void 0!==S?S:0)}))),r().createElement(i.InlineFieldRow,null,r().createElement(i.InlineField,{label:"WHERE",labelWidth:12},r().createElement(i.Input,{value:null===(m=e.query)||void 0===m?void 0:m.condition,onChange:function(t){e.onChange(ie(re({},e.query),{condition:t.target.value}))}})))))}))})(),u})()));
//# sourceMappingURL=module.js.map