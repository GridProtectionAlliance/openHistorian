"use strict";WebSAGE.g_vega_num=0,WebSAGE.SetIniExtended=function(e,t,a){var n;function i(e){void 0!==e.data[0].name?a.vgTableName[0]=e.data[0].name:a.vgTableName[0]="table";var t,n=vega.parse(e);WebSAGE.g_vega_num++,a.vgId="vega_"+WebSAGE.g_vega_num,$("#VEGACHARTS").append("<div id='"+a.vgId+"'><div>"),a.vw=new vega.View(n,{renderer:"svg"}).initialize().run(),a.vw.runAfter((function(){a.vw.toSVG().then((function(e){void 0!==a.vgFormat&&void 0!==a.vw._model&&(a.vw._model._defs.data[0].format=a.vgFormat);var n="layer1",i=SVGDoc.getElementById("base");i&&(n=i.attributes["inkscape:current-layer"].value),(t=d3.select(SVGDoc)).select("#vg_"+a.id).remove(),"g"==a.parentNode.nodeName?a.vg=t.select("#"+a.parentNode.id).append("g").html(e):a.vg=t.select("#"+n).append("g").html(e),a.vg._groups[0][0].id="vg_"+a.id,a.vg._groups[0][0].setAttributeNS(null,"transform",(a.getAttributeNS(null,"transform")||"")+" translate("+a.getAttributeNS(null,"x")+" "+a.getAttributeNS(null,"y")+")  scale("+a.getAttributeNS(null,"width")/(a.vw._width||100)+" "+a.getAttributeNS(null,"height")/(a.vw._height||100)+") "),a.inittransform=a.vg._groups[0][0].getAttributeNS(null,"transform"),a.vgInitData=JSON.parse(JSON.stringify(a.vw._runtime.data[a.vgTableName[0]].values.value))}))}))}switch(e[t].tag){case"#arc":WebSAGE.addPointToList(e[t].src),a._d3arc_tag=e[t].src;var r=e[t].prompt.split(",");a._d3arc_min=parseFloat(r[0]||0),a._d3arc_max=parseFloat(r[1]||100),a._d3arc_innerRadius=parseFloat(r[2]||0),a._d3arc_duration=parseFloat(r[3]||750);var S=d3.arc().innerRadius(a._d3arc_innerRadius).outerRadius(100).startAngle(0).endAngle(0),s=window.d3.select(a.parentNode).append("path").style("fill","red").attr("d",S);a._d3arc=s,a._d3arc.datum({oldAngle:0}),s._groups[0][0].style.cssText=a.style.cssText;var g=a.getBBox();s._groups[0][0].setAttributeNS(null,"transform",a.getAttributeNS(null,"transform")||" translate( "+(g.x+g.width/2)+","+(g.y+g.height/2)+" )  scale( "+g.width/200+","+g.height/200+" ) "),a.style.display="none";break;case"#vega-lite":{for(a.vgTableName=[],a.style.display="none",a.pnts=e[t].src.split(","),n=0;n<a.pnts.length;n++)WebSAGE.addPointToList(a.pnts[n]);function d(e){var t;if("object"==typeof e)(t=vegaLite.compile(e).spec).width=t.width||100,t.height=t.height||100;else{var n=JSON.parse(e);(t=vegaLite.compile(n).spec).width=t.width||n.width||100,t.height=t.height||n.height||100}void 0!==t.data[0].format&&(a.vgFormat=t.data[0].format,t.data[0].format={}),i(t)}0==e[t].prompt.indexOf("{")?d(e[t].prompt):$.get(e[t].prompt+"?"+(new Date).getTime(),d)}break;case"#vega":case"#vega3":case"#vega4":case"#vega5":a.vgTableName=[],a.style.display="none";var p=e[t].src.split("|");if(p.length>1){var l=p[1].split(",");0==l.length?a.timespan=a.width.baseVal.value:a.timespan=l[0]}else a.timespan=a.width.baseVal.value;for(a.pnts=p[0].split(","),n=0;n<a.pnts.length;n++)WebSAGE.addPointToList(a.pnts[n]);if(0==e[t].prompt.indexOf("{")){var o=JSON.parse(e[t].prompt);o.width=o.width||100,o.height=o.height||100,i(o)}else $.get(e[t].prompt+"?"+(new Date).getTime(),(function(e){var t;(t="object"==typeof e?e:JSON.parse(e)).width=t.width||100,t.height=t.height||100,i(t)}));break;case"#vega-json":case"#vega3-json":case"#vega4-json":case"#vega5-json":{function b(e){var t;i(t="object"==typeof e?e:JSON.parse(e)),t.data.length>0&&void 0!==t.data[0].url&&void 0!==t.data[0].update_period&&setInterval((function(){$.get(t.data[0].url,(function(e){"string"==typeof e?a.vw.change(t.data[0].name,vega.changeset().remove((function(e){return!0})).insert(JSON.parse(e))).run():a.vw.change(t.data[0].name,vega.changeset().remove((function(e){return!0})).insert(e)).run(),a.vw.runAfter((function(){a.vw.toSVG().then((function(e){a.vg.html(e)}))}))}))}),1e3*t.data[0].update_period),t.data.length>1&&void 0!==t.data[1].url&&void 0!==t.data[1].update_period&&setInterval((function(){$.get(t.data[1].url,(function(e){"string"==typeof e?a.vw.change(t.data[1].name,vega.changeset().remove((function(e){return!0})).insert(JSON.parse(e))).run():a.vw.change(t.data[1].name,vega.changeset().remove((function(e){return!0})).insert(e)).run(),a.vw.runAfter((function(){a.vw.toSVG().then((function(e){a.vg.html(e)}))}))}))}),1e3*t.data[1].update_period)}a.vgTableName=[],a.style.display="none",0==e[t].prompt.indexOf("{")?b(e[t].prompt):$.get(e[t].prompt+"?"+(new Date).getTime(),b)}}},WebSAGE.SetExeExtended=function(e){var t,a,n;switch(WebSAGE.InkSage[e].tag){case"#arc":var i=(WebSAGE.valueResolveCoded(WebSAGE.InkSage[e].parent._d3arc_tag,WebSAGE.InkSage[e].parent)-WebSAGE.InkSage[e].parent._d3arc_min)/(WebSAGE.InkSage[e].parent._d3arc_max-WebSAGE.InkSage[e].parent._d3arc_min),r=d3.arc().innerRadius(WebSAGE.InkSage[e].parent._d3arc_innerRadius).outerRadius(100).startAngle(0);WebSAGE.InkSage[e].parent._d3arc.transition().duration(WebSAGE.InkSage[e].parent._d3arc_duration).attrTween("d",(n=2*i*Math.PI,function(e){var t=d3.interpolate(e.oldAngle,n);return function(a){return e.endAngle=t(a),r(e)}})).on("end",(function(){WebSAGE.InkSage[e].parent._d3arc.datum({oldAngle:2*i*Math.PI})}));break;case"#vega":void 0!==WebSAGE.InkSage[e].parent.vw&&void 0!==WebSAGE.InkSage[e].parent.vgInitData&&""!=WebSAGE.InkSage[e].parent.vgInitData&&(WebSAGE.InkSage[e].parent.vw.data(WebSAGE.InkSage[e].parent.vgTableName[0]).remove((function(e){return!0})),a=JSON.parse(JSON.stringify(WebSAGE.InkSage[e].parent.vgInitData)));var S=new Date,s=0;WebSAGE.InkSage[e].parent.hasOwnProperty("vgInitData")&&$.each(WebSAGE.InkSage[e].parent.vgInitData,(function(n,i){$.each(i,(function(i,r){try{if("string"==typeof r){if(r.indexOf("HIS#")>=0){s++;var g=WebSAGE.InkSage[e].parent.pnts[r.split("#")[1]-1];if(1===s&&(a=[]),WebSAGE.InkSage[e].hasOwnProperty("valores")&&void 0!==WebSAGE.InkSage[e].valores[g]){for(t=0;t<WebSAGE.InkSage[e].valores[g].length;t++)a.push({pnt:""+g,x:WebSAGE.InkSage[e].datas[g][t],y:WebSAGE.InkSage[e].valores[g][t]});WebSAGE.InkSage[e].valores[g].push(V[g]),WebSAGE.InkSage[e].datas[g].push(S.getTime());for(var p=WebSAGE.InkSage[e].valores[g].length-1;p>=0;p--)(S.getTime()-WebSAGE.InkSage[e].datas[g][p])/1e3>60*WebSAGE.InkSage[e].parent.timespan&&(WebSAGE.InkSage[e].valores[g].splice(p,1),WebSAGE.InkSage[e].datas[g].splice(p,1))}else{var l=(new Date).getTime()-60*WebSAGE.InkSage[e].parent.timespan*1e3;if(WebSAGE.InkSage[e].parent.hasOwnProperty("histCalls")||(WebSAGE.InkSage[e].parent.histCalls=[]),!WebSAGE.InkSage[e].parent.histCalls.hasOwnProperty(g)){var o='$.getScript( WebSAGE.g_timePntServer + "?P='+g+"&U="+l/1e3+"&F=S&B=histdata("+e+","+g+');histdata" );';WebSAGE.g_timeshift=WebSAGE.g_timeshift+2e3,setTimeout(o,WebSAGE.g_timeshift),WebSAGE.InkSage[e].parent.histCalls[g]=!0}}}if(r.indexOf("PNT#")>=0)WebSAGE.InkSage[e].parent.pnts.length>r.split("#")[1]-1&&"????"!==(d=WebSAGE.valueResolveCoded(WebSAGE.InkSage[e].parent.pnts[r.split("#")[1]-1],WebSAGE.InkSage[e].parent))?a[n][i]=d:a.splice(-1,1);else if(r.indexOf("TAG#")>=0){var d;WebSAGE.InkSage[e].parent.pnts.length>r.split("#")[1]-1?"????"!==(d=WebSAGE.valueResolveCoded(WebSAGE.InkSage[e].parent.pnts[r.split("#")[1]-1],WebSAGE.InkSage[e].parent))&&(a[n][i]=WebSAGE.InkSage[e].parent.pnts[r.split("#")[1]-1]):a.splice(-1,1)}else r.indexOf("FLG#")>=0?WebSAGE.InkSage[e].parent.pnts.length>r.split("#")[1]-1&&(a[n][i]=WebSAGE.getFlags(WebSAGE.InkSage[e].parent.pnts[r.split("#")[1]-1])):r.indexOf("FLR#")>=0?WebSAGE.InkSage[e].parent.pnts.length>r.split("#")[1]-1&&(a[n][i]=128&WebSAGE.getFlags(WebSAGE.InkSage[e].parent.pnts[r.split("#")[1]-1])?1:0):r.indexOf("LMI#")>=0?WebSAGE.InkSage[e].parent.pnts.length>r.split("#")[1]-1&&(a[n][i]=WebSAGE.getInfLim(WebSAGE.InkSage[e].parent.pnts[r.split("#")[1]-1])):r.indexOf("LMS#")>=0?WebSAGE.InkSage[e].parent.pnts.length>r.split("#")[1]-1&&(a[n][i]=WebSAGE.getSupLim(WebSAGE.InkSage[e].parent.pnts[r.split("#")[1]-1])):r.indexOf("DCR#")>=0?WebSAGE.InkSage[e].parent.pnts.length>r.split("#")[1]-1&&(a[n][i]=WebSAGE.getDescription(WebSAGE.InkSage[e].parent.pnts[r.split("#")[1]-1])):r.indexOf("BAY#")>=0?WebSAGE.InkSage[e].parent.pnts.length>r.split("#")[1]-1&&(a[n][i]=WebSAGE.getBay(WebSAGE.InkSage[e].parent.pnts[r.split("#")[1]-1])):r.indexOf("SUB#")>=0&&WebSAGE.InkSage[e].parent.pnts.length>r.split("#")[1]-1&&(a[n][i]=WebSAGE.getSubstation(WebSAGE.InkSage[e].parent.pnts[r.split("#")[1]-1]))}}catch(e){}}))})),void 0!==WebSAGE.InkSage[e].parent.vw&&(WebSAGE.InkSage[e].parent.vw.data(WebSAGE.InkSage[e].parent.vgTableName[0]).insert(a),WebSAGE.InkSage[e].parent.vw.update(),WebSAGE.InkSage[e].parent.vg.html($("#"+WebSAGE.InkSage[e].parent.vgId+" .vega")[0].childNodes[0].childNodes[0].innerHTML));break;case"#vega-lite":case"#vega3":case"#vega4":void 0!==WebSAGE.InkSage[e].parent.vw&&void 0!==WebSAGE.InkSage[e].parent.vgInitData&&""!=WebSAGE.InkSage[e].parent.vgInitData&&(a=JSON.parse(JSON.stringify(WebSAGE.InkSage[e].parent.vgInitData))),S=new Date,s=0,WebSAGE.InkSage[e].parent.hasOwnProperty("vgInitData")&&$.each(WebSAGE.InkSage[e].parent.vgInitData,(function(n,i){$.each(i,(function(i,r){try{if("string"==typeof r){if(r.indexOf("HIS#")>=0){s++;var g=WebSAGE.InkSage[e].parent.pnts[r.split("#")[1]-1];if(1===s&&(a=[]),WebSAGE.InkSage[e].hasOwnProperty("valores")&&void 0!==WebSAGE.InkSage[e].valores[g]){for(t=0;t<WebSAGE.InkSage[e].valores[g].length;t++)a.push({pnt:""+g,x:WebSAGE.InkSage[e].datas[g][t],y:WebSAGE.InkSage[e].valores[g][t]});WebSAGE.InkSage[e].valores[g].push(V[g]),WebSAGE.InkSage[e].datas[g].push(S.getTime());for(var p=WebSAGE.InkSage[e].valores[g].length-1;p>=0;p--){var l=(S.getTime()-WebSAGE.InkSage[e].datas[g][p])/1e3;WebSAGE.InkSage[e].parent.timespan>0?l>60*WebSAGE.InkSage[e].parent.timespan&&(WebSAGE.InkSage[e].valores[g].splice(p,1),WebSAGE.InkSage[e].datas[g].splice(p,1)):WebSAGE.InkSage[e].datas[g][p]>WebSAGE.InkSage[e].parent.datafim&&(WebSAGE.InkSage[e].valores.forEach((function(e,t,a){a[t]=[]})),WebSAGE.InkSage[e].datas.forEach((function(e,t,a){a[t]=[]})),WebSAGE.InkSage[e].parent.dataini=(new Date).getTime()-(new Date).getTime()%(1e3*Math.abs(60*WebSAGE.InkSage[e].parent.timespan))+60*(new Date).getTimezoneOffset()*1e3%(1e3*Math.abs(60*WebSAGE.InkSage[e].parent.timespan)),WebSAGE.InkSage[e].parent.datafim=WebSAGE.InkSage[e].parent.dataini+Math.abs(60*WebSAGE.InkSage[e].parent.timespan*1e3))}}else{WebSAGE.InkSage[e].parent.timespan<0&&(WebSAGE.InkSage[e].parent.dataini=(new Date).getTime()-(new Date).getTime()%(1e3*Math.abs(60*WebSAGE.InkSage[e].parent.timespan))+60*(new Date).getTimezoneOffset()*1e3%(1e3*Math.abs(60*WebSAGE.InkSage[e].parent.timespan)),WebSAGE.InkSage[e].parent.datafim=WebSAGE.InkSage[e].parent.dataini+Math.abs(60*WebSAGE.InkSage[e].parent.timespan*1e3));var o=WebSAGE.InkSage[e].parent.dataini;if(WebSAGE.InkSage[e].parent.hasOwnProperty("histCalls")||(WebSAGE.InkSage[e].parent.histCalls=[]),!WebSAGE.InkSage[e].parent.histCalls.hasOwnProperty(g)){var d='$.getScript( WebSAGE.g_timePntServer + "?P='+g+"&U="+o/1e3+"&F=S&B=histdata("+e+","+g+');histdata" );';WebSAGE.g_timeshift=WebSAGE.g_timeshift+2e3,setTimeout(d,WebSAGE.g_timeshift),WebSAGE.InkSage[e].parent.histCalls[g]=!0}}}if(r.indexOf("PNT#")>=0)WebSAGE.InkSage[e].parent.pnts.length>r.split("#")[1]-1&&"????"!==(b=WebSAGE.valueResolveCoded(WebSAGE.InkSage[e].parent.pnts[r.split("#")[1]-1],WebSAGE.InkSage[e].parent))?a[n][i]=b:a.splice(-1,1);else if(r.indexOf("TAG#")>=0){var b;WebSAGE.InkSage[e].parent.pnts.length>r.split("#")[1]-1?"????"!==(b=WebSAGE.valueResolveCoded(WebSAGE.InkSage[e].parent.pnts[r.split("#")[1]-1],WebSAGE.InkSage[e].parent))&&(a[n][i]=WebSAGE.InkSage[e].parent.pnts[r.split("#")[1]-1]):a.splice(-1,1)}else r.indexOf("FLG#")>=0?WebSAGE.InkSage[e].parent.pnts.length>r.split("#")[1]-1&&(a[n][i]=WebSAGE.getFlags(WebSAGE.InkSage[e].parent.pnts[r.split("#")[1]-1])):r.indexOf("FLR#")>=0?WebSAGE.InkSage[e].parent.pnts.length>r.split("#")[1]-1&&(a[n][i]=128&WebSAGE.getFlags(WebSAGE.InkSage[e].parent.pnts[r.split("#")[1]-1])?1:0):r.indexOf("LMI#")>=0?WebSAGE.InkSage[e].parent.pnts.length>r.split("#")[1]-1&&(a[n][i]=WebSAGE.getInfLim(WebSAGE.InkSage[e].parent.pnts[r.split("#")[1]-1])):r.indexOf("LMS#")>=0?WebSAGE.InkSage[e].parent.pnts.length>r.split("#")[1]-1&&(a[n][i]=WebSAGE.getSupLim(WebSAGE.InkSage[e].parent.pnts[r.split("#")[1]-1])):r.indexOf("DCR#")>=0?WebSAGE.InkSage[e].parent.pnts.length>r.split("#")[1]-1&&(a[n][i]=WebSAGE.getDescription(WebSAGE.InkSage[e].parent.pnts[r.split("#")[1]-1])):r.indexOf("BAY#")>=0?WebSAGE.InkSage[e].parent.pnts.length>r.split("#")[1]-1&&(a[n][i]=WebSAGE.getBay(WebSAGE.InkSage[e].parent.pnts[r.split("#")[1]-1])):r.indexOf("SUB#")>=0&&WebSAGE.InkSage[e].parent.pnts.length>r.split("#")[1]-1&&(a[n][i]=WebSAGE.getSubstation(WebSAGE.InkSage[e].parent.pnts[r.split("#")[1]-1]))}}catch(e){}}))})),void 0!==WebSAGE.InkSage[e].parent.vw&&(WebSAGE.InkSage[e].parent.vw.change(WebSAGE.InkSage[e].parent.vgTableName[0],vega.changeset().remove((function(e){return!0})).insert(a)).run(),WebSAGE.InkSage[e].parent.vw.runAfter((function(){WebSAGE.InkSage[e].parent.vw.toSVG().then((function(t){WebSAGE.InkSage[e].parent.vg.html(t)}))})))}},WebSAGE.alternate=function(e,t,a){WebSAGE.idalt1=t,WebSAGE.idalt2=a,window.setTimeout((function(e){window.WebSAGE.flipOut(e)}),500,a),window.setInterval((function e(t,a){var n=e.ida||t;e.ida=e.idb||a,e.idb=n,window.WebSAGE.flipOut(e.idb),window.WebSAGE.flipIn(e.ida)}),e,t,a)},WebSAGE.flipOut=function(e){var t=window.SVGDoc.getElementById(e);null!==t&&(void 0===t.inittransform&&(null===t.getAttributeNS(null,"transform")?t.inittransform="":t.inittransform=t.getAttributeNS(null,"transform")),window.d3.select(t).transition().duration(1250).attr("transform","translate( "+t.getBBox().x+",0) "+t.inittransform+" scale(0, 1)"))},WebSAGE.flipIn=function(e){var t=window.SVGDoc.getElementById(e);null!==t&&(void 0===t.inittransform&&(null===t.getAttributeNS(null,"transform")?t.inittransform="":t.inittransform=t.getAttributeNS(null,"transform")),window.d3.select(t).transition().duration(1250).attr("transform",t.inittransform+" scale(1, 1)"))};