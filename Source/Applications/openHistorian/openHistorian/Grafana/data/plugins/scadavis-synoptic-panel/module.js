define(["@grafana/data","react","@grafana/ui"],((e,t,o)=>(()=>{"use strict";var a={305:t=>{t.exports=e},388:e=>{e.exports=o},650:e=>{e.exports=t}},s={};function n(e){var t=s[e];if(void 0!==t)return t.exports;var o=s[e]={exports:{}};return a[e](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{n.r(i),n.d(i,{plugin:()=>m});var e=n(305),t=n(650),o=n.n(t);function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}class s{guidGenerator(){const e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}createElementFromHTML(e){const t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild}loadURL(e){if(this.svgobj=null,this.readyfordata=!1,this.svgurl=e,""!==this.svgurl&&0===this.loadingSVG){this.loadingSVG=1;const e=new XMLHttpRequest;e.open("GET",this.svgurl);let t=this;e.onload=function(){var o,a;200===e.status&&(t.loadingSVG=0,t.componentloaded?null===(a=t.iframe)||void 0===a||null===(o=a.contentWindow)||void 0===o||o.postMessage(e.responseText,t.domain):t.svgobj=e.responseText)},e.onreadystatechange=function(o){4===e.readyState&&(200===e.status||(t.loadingSVG=0,this.onerror?t.onerror(e.statusText):console.warn("SCADAvis.io API: error loading SVG URL. "+e.statusText)))},e.send()}}resetData(){this.npt=0,this.npts={},this.vals={},this.qualifs={},this.descriptions={};const e={data:{type:"resetData"}};this.readyfordata?window.postMessage(e,this.domain):this.resetobj=e}refreshDisplay(e){let t=this;return new Promise((function(o,a){t.readyfordata?t.resolveFunction?a(new Error("Ongoing display refresh!")):(t.resolveFunction=o,t.rejectFunction=a,t.updateValues(e)):a(new Error("Not ready for data!"))}))}updateValues(e){var t,o;if(!this.readyfordata)return null;let a=this;"object"==typeof e&&null!==e&&Object.keys(e).map((function(t,o){let s;t in a.npts?s=a.npts[t]:(s=++a.npt,a.npts[t]=s),a.vals[t]=e[t],a.qualifs[t]=0}));const s={data:{type:"tags",tags:[],handle:++this.updateHandle}};return Object.keys(this.npts).map((function(e,t){s.data.tags[t]={},s.data.tags[t].path=e,s.data.tags[t].value=a.vals[e],s.data.tags[t].quality=!(128&a.qualifs[e]),"number"==typeof a.vals[e]?s.data.tags[t].type="float":"boolean"==typeof a.vals[e]?s.data.tags[t].type="bool":s.data.tags[t].type="string",s.data.tags[t].parameters={Value:{TagClientItem:a.npts[e],Alarmed:256==(256&a.qualifs[e]),Desc:a.descriptions[e]}}})),null===(o=this.iframe)||void 0===o||null===(t=o.contentWindow)||void 0===t||t.postMessage(s,this.domain),s.handle}setValue(e,t,o,a,s){if(""===e||null==e)return this.readyfordata;let n;if(o=o||!1,a=a||!1,s=s||e,e in this.npts?n=this.npts[e]:(n=++this.npt,this.npts[e]=n),this.vals[e]=t,this.qualifs[e]=(o?128:0)|(a?256:0),this.descriptions[e]=s,this.readyfordata){var i,l;const o={data:{type:"tags",tags:[],handle:++this.updateHandle}};o.data.tags[0]={},o.data.tags[0].path=e,o.data.tags[0].value=t,o.data.tags[0].quality=!(128&this.qualifs[e]),o.data.tags[0].type="number"==typeof t?"float":"boolean"==typeof t?"bool":"string",o.data.tags[0].parameters={Value:{TagClientItem:n,Alarmed:256==(256&this.qualifs[e]),Desc:this.descriptions[e]}},null===(l=this.iframe)||void 0===l||null===(i=l.contentWindow)||void 0===i||i.postMessage(o,this.domain)}return this.readyfordata}storeValue(e,t,o,a,s){if(""===e||null==e)return this.readyfordata;let n;return o=o||!1,a=a||!1,s=s||e,e in this.npts?n=this.npts[e]:(n=++this.npt,this.npts[e]=n),this.vals[e]=t,this.qualifs[e]=(o?128:0)|(a?256:0),this.descriptions[e]=s,this.readyfordata}getValue(e){return e in this.vals?this.vals[e]:null}getApiKey(){return this.apikey}getVersion(){return this.version}getIframe(){return this.iframe}getComponentState(){return!1===this.componentloaded?0:!1===this.readyfordata?1:2}getComponentVersion(){return this.version}getTagsList(){return this.tagsList}moveBy(e,t,o){const a={data:{type:"moveBy",dx:e=e||0,dy:t=t||0,animate:o=o||!1}};var s,n;this.readyfordata?null===(n=this.iframe)||void 0===n||null===(s=n.contentWindow)||void 0===s||s.postMessage(a,this.domain):this.moveobj=a}zoomTo(e,t,o){const a={data:{type:"zoomTo",zoomLevel:e=e||1.1,target:t,animate:o=o||!1}};var s,n;this.readyfordata?null===(n=this.iframe)||void 0===n||null===(s=n.contentWindow)||void 0===s||s.postMessage(a,this.domain):this.zoomobj=a}zoomToOriginal(e){const t={data:{type:"zoomToOriginal",animate:e=e||!1}};var o,a;this.readyfordata&&(null===(a=this.iframe)||void 0===a||null===(o=a.contentWindow)||void 0===o||o.postMessage(t,this.domain))}enableTools(e,t){(void 0===e||e)&&(e=!0),void 0===t&&(t=!1);const o={data:{type:"enableTools",panEnabled:e,zoomEnabled:t}};var a,s;this.readyfordata?null===(s=this.iframe)||void 0===s||null===(a=s.contentWindow)||void 0===a||a.postMessage(o,this.domain):this.enabletoolsobj=o}enableMouse(e,t){(void 0===e||e)&&(e=!0),(void 0===t||t)&&(t=!0);const o={data:{type:"enableMouse",panEnabled:e,zoomEnabled:t}};var a,s;this.readyfordata?null===(s=this.iframe)||void 0===s||null===(a=s.contentWindow)||void 0===a||a.postMessage(o,this.domain):this.enablemouseobj=o}setMouseWheel(e,t){(void 0===e||e)&&(e=!0),(void 0===t||t)&&(t=!0);const o={data:{type:"setMouseWheel",directionBackOut:e,blockEventPropagation:t}};var a,s;this.readyfordata?null===(s=this.iframe)||void 0===s||null===(a=s.contentWindow)||void 0===a||a.postMessage(o,this.domain):this.mousewheelobj=o}enableKeyboard(e){(void 0===e||e)&&(e=!0);const t={data:{type:"enableKeyboard",keyEnabled:e}};var o,a;this.readyfordata?null===(a=this.iframe)||void 0===a||null===(o=a.contentWindow)||void 0===o||o.postMessage(t,this.domain):this.enablekeyboardobj=t}enableAlarmFlash(e){(void 0===e||e)&&(e=!0);const t={data:{type:"enableAlarmFlash",alarmFlashEnabled:e}};var o,a;this.componentloaded?null===(a=this.iframe)||void 0===a||null===(o=a.contentWindow)||void 0===o||o.postMessage(t,this.domain):this.enableflashobj=t}hideWatermark(){const e={data:{type:"hideWatermark"}};var t,o;this.readyfordata?null===(o=this.iframe)||void 0===o||null===(t=o.contentWindow)||void 0===t||t.postMessage(e,this.domain):this.hidewatermarkobj=e}setColor(e,t){const o={data:{type:"setColor",colorNumber:e,colorCode:t}};var a,s;this.componentloaded?null===(s=this.iframe)||void 0===s||null===(a=s.contentWindow)||void 0===a||a.postMessage(o,this.domain):this.setcolorobj.push(o)}setColors(e){const t={data:{type:"setColors",colorsTable:e}};var o,a;this.componentloaded?null===(a=this.iframe)||void 0===a||null===(o=a.contentWindow)||void 0===o||o.postMessage(t,this.domain):this.setcolorsobj=t}on(e,t){let o=!1;switch(e){case"loaded":this.loaded=t,o=!0;break;case"ready":this.onready=t,o=!0;break;case"error":this.onerror=t,o=!0;break;case"click":this.onclick=t,o=!0}return o}constructor(e,t,o){var s,n,i;a(this,"version","2.0.7t"),a(this,"iframe",null),a(this,"componentloaded",!1),a(this,"readyfordata",!1),a(this,"domain","*"),a(this,"rtdata",{data:{type:"tags",tags:[]}}),a(this,"npts",{}),a(this,"vals",{}),a(this,"qualifs",{}),a(this,"descriptions",{}),a(this,"npt",0),a(this,"svgobj",null),a(this,"zoomobj",null),a(this,"moveobj",null),a(this,"enabletoolsobj",null),a(this,"enablekeyboardobj",null),a(this,"enableflashobj",null),a(this,"hidewatermarkobj",null),a(this,"setcolorobj",[]),a(this,"setcolorsobj",null),a(this,"resetobj",null),a(this,"tagsList",""),a(this,"onready",null),a(this,"onerror",null),a(this,"onclick",null),a(this,"loadingSVG",0),a(this,"updateHandle",0),a(this,"resolveFunction",null),a(this,"rejectFunction",null),a(this,"container",null),a(this,"apikey",null),a(this,"iframeparams",null),a(this,"svgurl",null),a(this,"colorsTable",null),a(this,"enablemouseobj",null),a(this,"mousewheelobj",null),a(this,"loaded",null),a(this,"aux",!1),a(this,"panelContainerResizeObserver",void 0);const l=this;let r,d,u=' scrolling="no" ';"object"==typeof e?(this.container=e.container||"",this.apikey=e.apikey||"",this.iframeparams=e.iframeparams||'frameborder="0" height="250" width="250"',this.svgurl=e.svgurl||"",this.colorsTable=e.colorsTable||null):(this.container=e||"",this.apikey="",this.iframeparams=t||'frameborder="0" height="250" width="250"',this.svgurl=o||"",this.colorsTable=null),this.iframe=null,this.componentloaded=!1,this.readyfordata=!1,this.domain="*",this.rtdata={data:{type:"tags",tags:[]}},this.npts={},this.vals={},this.qualifs={},this.descriptions={},this.npt=0,this.svgobj=null,this.zoomobj=null,this.moveobj=null,this.enabletoolsobj=null,this.enablekeyboardobj=null,this.enableflashobj=null,this.hidewatermarkobj=null,this.setcolorobj=[],this.setcolorsobj=null,this.resetobj=null,this.tagsList="",this.onready=null,this.onerror=null,this.onclick=null,this.loadingSVG=0,this.updateHandle=0,this.resolveFunction=null,this.rejectFunction=null,r=this.guidGenerator(),"string"==typeof this.container&&(0===this.container.trim().length?this.container=document.body:(this.container=document.getElementById(this.container),null===this.container&&(this.container=document.body))),this.iframeparams.indexOf("scrolling")>=0&&(u="");const h=(null===(s=grafanaBootData)||void 0===s?void 0:s.appSubUrl)||(null===(i=grafanaBootData)||void 0===i||null===(n=i.settings)||void 0===n?void 0:n.appSubUrl)||"";d='<iframe id="'+r+'" sandbox="allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox" '+this.iframeparams+u+` src="${h}/public/plugins/scadavis-synoptic-panel/synoptic/synoptic.html"></iframe>`,void 0!==this.container.innerHTML?this.container.appendChild(this.createElementFromHTML(d)):this.container.insertAdjacentHTML("afterend",d),this.iframe=document.getElementById(r),this.componentloaded=!1,this.readyfordata=!1,this.colorsTable&&this.setColors(this.colorsTable),""!==this.svgurl&&this.loadURL(this.svgurl),window.addEventListener("message",(function(e){if(e.source===l.iframe.contentWindow){if("object"==typeof e.data&&void 0!==e.data.data.type&&"updated"===e.data.data.type&&e.data.data.handle===l.updateHandle)return e.data.data.error?l.rejectFunction&&l.rejectFunction(new Error(e.data.data.error)):l.resolveFunction&&l.resolveFunction(),l.resolveFunction=null,void(l.rejectFunction=null);if("object"==typeof e.data&&void 0!==e.data.data.type&&"loaded"===e.data.data.type){if(l.componentloaded=!0,l.setcolorobj.length>0){for(let t=0;t<l.setcolorobj.length;t++)e.source.postMessage(l.setcolorobj[t],e.origin);l.setcolorobj=[]}return null!==l.setcolorsobj&&(e.source.postMessage(l.setcolorsobj,e.origin),l.setcolorsobj=null),null!==l.enableflashobj&&(e.source.postMessage(l.enableflashobj,e.origin),l.enableflashobj=null),void(null!==l.svgobj?e.source.postMessage(l.svgobj,e.origin):""!==l.svgurl&&l.loadURL(l.svgurl))}if("object"==typeof e.data&&void 0!==e.data.data.type&&"ready"===e.data.data.type)return l.readyfordata=!0,l.tagsList=e.data.data.attributes.tagsList,l.rtdata.data.tags.length&&l.updateValues(),l.zoomobj&&(e.source.postMessage(l.zoomobj,e.origin),l.zoomobj=null),l.moveobj&&(e.source.postMessage(l.moveobj,e.origin),l.moveobj=null),l.enabletoolsobj&&(e.source.postMessage(l.enabletoolsobj,e.origin),l.enabletoolsobj=null),l.enablemouseobj&&(e.source.postMessage(l.enablemouseobj,e.origin),l.enablemouseobj=null),l.mousewheelobj&&(e.source.postMessage(l.mousewheelobj,e.origin),l.mousewheelobj=null),l.enablekeyboardobj&&(e.source.postMessage(l.enablekeyboardobj,e.origin),l.enablekeyboardobj=null),l.hidewatermarkobj&&(e.source.postMessage(l.hidewatermarkobj,e.origin),l.hidewatermarkobj=null),l.resetobj&&(e.source.postMessage(l.resetobj,e.origin),l.resetobj=null),void(l.onready&&l.onready());if("object"==typeof e.data&&void 0!==e.data.data.type&&"click"===e.data.data.type)return void(l.onclick&&l.onclick(e.data.data.attributes.event,e.data.data.attributes.tag))}}))}}const l=[],r=[];function d(e,t){var o,a;t.zoomToOriginal(),t.moveBy(-e.moveByX,-e.moveByY);const s=null===(a=t.getIframe())||void 0===a||null===(o=a.parentElement)||void 0===o?void 0:o.parentElement;if(s&&s.clientWidth>0&&s.clientHeight>0){const o=t.getIframe();o&&(o.width=""+(s.clientWidth-5),o.height=""+(s.clientHeight-5)),e.autoResize?t.zoomTo(e.zoomLevel*(s.clientWidth<s.clientHeight?s.clientWidth/250:s.clientHeight/250)):t.zoomTo(e.zoomLevel)}else t.zoomTo(e.zoomLevel)}function u(e,t,o,a){const s=document.querySelectorAll("[id='"+r[o].svId+"']"),n=t.getIframe();for(let o=0;n&&o<s.length;o++)s[o].firstChild!==n&&(s[o].appendChild(n),t.on("ready",(()=>{var o;t.enableMouse(e.enableMousePan,e.enableMouseWheelZoom),t.enableTools(e.showZoomPan,e.showZoomPan),t.zoomToOriginal(),t.moveBy(-e.moveByX,-e.moveByY);const s=null===(o=n.parentElement)||void 0===o?void 0:o.parentElement;s&&(t.panelContainerResizeObserver=new ResizeObserver((o=>{for(const a of o)a.contentRect&&d(e,t)})),t.panelContainerResizeObserver.observe(s)),s&&s.clientWidth>0&&s.clientHeight>0?(n.width=""+(s.clientWidth-5),n.height=""+(s.clientHeight-5),e.autoResize?t.zoomTo(e.zoomLevel*(s.clientWidth<s.clientHeight?s.clientWidth/250:s.clientHeight/250)):t.zoomTo(e.zoomLevel)):t.zoomTo(e.zoomLevel),t.updateValues(a)})));JSON.stringify(r[o].lastOptions)!==JSON.stringify(e)&&(d(e,l[o]),r[o].lastOptions=Object.assign(e)),t.updateValues(a)}var h=n(388);const c=({onChange:e})=>o().createElement(h.FileUpload,{accept:".svg",onFileUpload:t=>{var o,a;const s=t.target;if((null===(o=s)||void 0===o?void 0:o.files)&&(null===(a=s)||void 0===a?void 0:a.files.length)>0){var n;const t=null===(n=s)||void 0===n?void 0:n.files[0];if("image/svg+xml"===t.type){const o=new FileReader;o.onload=function(){e(o.result)},o.readAsDataURL(t)}}}},"Upload SVG file"),m=new e.PanelPlugin((({options:e,data:a,width:n,height:i,onOptionsChange:h})=>{var c;const m=(0,t.useMemo)((()=>({})),[]);let p=0;for(let e=0;e<a.series.length;e++){const t=a.series[e];for(let e=0;e<t.fields.length;e++){const o=t.fields[e];if("number"===o.type&&0!==o.values.length&&(p++,m["@"+p]=o.values[o.values.length-1],o.name)){const e=o.values;e.buffer?(m["@"+p]=e.buffer[e.buffer.length-1],m[o.name]=e.buffer[e.buffer.length-1]):(m["@"+p]=e[o.values.length-1],m[o.name]=o.values[e.length-1])}}}const v=(null===(c=a.request)||void 0===c?void 0:c.panelId)||-1,g=!(v in l)||!document.getElementById(l[v].container.id);if(g){var b,f;let t={svgUrl:"",zoomLevel:-1,moveByX:-999999,moveByY:-999999,autoResize:!1,showZoomPan:!1,enableMousePan:!1,enableMouseWheelZoom:!1};var y,j;v in r&&(t=r[v].lastOptions,r[v].dashboardUID===(null===(j=a)||void 0===j||null===(y=j.request)||void 0===y?void 0:y.dashboardUID)&&(e.svgUrl=t.svgUrl));const s="scadavis_"+"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)));r[v]={svId:s,svReactElem:o().createElement("div",{id:s}),dashboardUID:null===(f=a)||void 0===f||null===(b=f.request)||void 0===b?void 0:b.dashboardUID,lastOptions:t}}if(!g&&e.svgUrl===r[v].lastOptions.svgUrl){const t=l[v];u(e,t,v,m)}if(!g&&e.svgUrl!==r[v].lastOptions.svgUrl){var w;null===(w=l[v].getIframe())||void 0===w||w.remove();const t=new s({container:r[v].svId,iframeparams:`frameborder="0" height="${i}" width="${n}"`,svgurl:e.svgUrl});if(t){l[v]=t;const e=t.getIframe();var z;e&&(null===(z=document.getElementById(l[v].container.id))||void 0===z||z.appendChild(e))}r[v].lastOptions=Object.assign(e),u(e,t,v,m)}return(0,t.useEffect)((()=>{if(!(v in l)||!document.getElementById(l[v].container.id)){const t=new s({container:r[v].svId,iframeparams:`frameborder="0" height="${i}" width="${n}"`,svgurl:e.svgUrl});l[v]=t,r[v].lastOptions=Object.assign(e),t&&t.on("ready",(()=>{var o,a;t.enableMouse(e.enableMousePan,e.enableMouseWheelZoom),t.enableTools(e.showZoomPan,e.showZoomPan),t.moveBy(-e.moveByX,-e.moveByY);const s=null===(a=t.getIframe())||void 0===a||null===(o=a.parentElement)||void 0===o?void 0:o.parentElement;s&&s.clientWidth>0&&s.clientHeight>0&&(t.panelContainerResizeObserver=new ResizeObserver((o=>{for(const a of o)a.contentRect&&d(e,t)})),t.panelContainerResizeObserver.observe(s),e.autoResize?t.zoomTo(e.zoomLevel*(s.clientWidth<s.clientHeight?s.clientWidth/250:s.clientHeight/250)):t.zoomTo(e.zoomLevel)),t.updateValues(m)}))}}),[e,m,v,i,n]),r[v].svReactElem})).setPanelOptions((e=>e.addTextInput({path:"svgUrl",name:"SVG URL",description:"Enter SVG URL",defaultValue:"https://raw.githubusercontent.com/riclolsen/displayfiles/master/helloworld.svg"}).addCustomEditor({id:"svgFileId",path:"svgUrl",name:"Upload local SVG file",editor:c,defaultValue:"https://raw.githubusercontent.com/riclolsen/displayfiles/master/helloworld.svg"}).addSliderInput({path:"zoomLevel",name:"SVG zoom level",description:"Enter value <1 to shrink SVG view or >1 to grow it",defaultValue:1,settings:{min:.1,max:3,step:.1}}).addSliderInput({path:"moveByX",name:"Horizontal offset",description:"Enter value <0 to move left or >0 to move right",defaultValue:0,settings:{min:-1e3,max:1e3,step:1}}).addSliderInput({path:"moveByY",name:"Vertical offset",description:"Enter value <0 to move up or >0 to move down",defaultValue:0,settings:{min:-1e3,max:1e3,step:1}}).addBooleanSwitch({path:"autoResize",name:"Auto resize",description:"Bind SVG view size to panel size",defaultValue:!1}).addBooleanSwitch({path:"showZoomPan",name:"Show zoom/pan tool",description:"Toolbar over SVG top-left corner with zoom/pan buttons",defaultValue:!1}).addBooleanSwitch({path:"enableMousePan",name:"Enable mouse pan",description:"Pan the SVG view with mouse drag",defaultValue:!1}).addBooleanSwitch({path:"enableMouseWheelZoom",name:"Enable mouse wheel zoom",description:"Zoom the SVG view with mouse wheel roll",defaultValue:!1})))})(),i})()));
//# sourceMappingURL=module.js.map