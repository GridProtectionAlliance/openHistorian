"use strict";(self.webpackChunk_grafana_ui=self.webpackChunk_grafana_ui||[]).push([[5140],{"../grafana-data/src/text/sanitize.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{G$:function(){return sanitizeTextPanelContent},sQ:function(){return textUtil}});var _braintree_sanitize_url__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/@braintree/sanitize-url/dist/index.js"),dompurify__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/dompurify/dist/purify.js"),dompurify__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(dompurify__WEBPACK_IMPORTED_MODULE_1__),xss__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/xss/lib/index.js");function _define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var XSSWL=Object.keys(xss__WEBPACK_IMPORTED_MODULE_2__.whiteList).reduce((function(acc,element){var _xss_whiteList_element;return acc[element]=null===(_xss_whiteList_element=xss__WEBPACK_IMPORTED_MODULE_2__.whiteList[element])||void 0===_xss_whiteList_element?void 0:_xss_whiteList_element.concat(["class","style"]),acc}),{});XSSWL.iframe=["src","width","height"];var sanitizeTextPanelWhitelist=new xss__WEBPACK_IMPORTED_MODULE_2__.FilterXSS({onTagAttr:function onTagAttr(tag,name,value,isWhiteAttr){if("iframe"===tag)return isWhiteAttr?" ".concat(name,'="').concat(xss__WEBPACK_IMPORTED_MODULE_2__.escapeAttrValue(sanitizeUrl(value)),'" sandbox credentialless referrerpolicy=no-referrer'):""},whiteList:XSSWL,css:{whiteList:function _object_spread_props(target,source){return source=null!=source?source:{},Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})),target}(function _object_spread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter((function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable})))),ownKeys.forEach((function(key){_define_property(target,key,source[key])}))}return target}({},xss__WEBPACK_IMPORTED_MODULE_2__.getDefaultCSSWhiteList()),{"flex-direction":!0,"flex-wrap":!0,"flex-basis":!0,"flex-grow":!0,"flex-shrink":!0,"flex-flow":!0,gap:!0,order:!0,"justify-content":!0,"justify-items":!0,"justify-self":!0,"align-items":!0,"align-content":!0,"align-self":!0})}});function sanitizeTextPanelContent(unsanitizedString){try{return sanitizeTextPanelWhitelist.process(unsanitizedString)}catch(error){return console.error("String could not be sanitized",unsanitizedString),"Text string could not be sanitized"}}function sanitizeUrl(url){return(0,_braintree_sanitize_url__WEBPACK_IMPORTED_MODULE_0__.J)(url)}function escapeHtml(str){return String(str).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")}var textUtil={escapeHtml:escapeHtml,hasAnsiCodes:function hasAnsiCodes(input){return/\u001b\[\d{1,2}m/.test(input)},sanitize:function sanitize(unsanitizedString){try{return dompurify__WEBPACK_IMPORTED_MODULE_1___default().sanitize(unsanitizedString,{USE_PROFILES:{html:!0},FORBID_TAGS:["form","input"]})}catch(error){return console.error("String could not be sanitized",unsanitizedString),escapeHtml(unsanitizedString)}},sanitizeTextPanelContent:sanitizeTextPanelContent,sanitizeUrl:sanitizeUrl,sanitizeSVGContent:function sanitizeSVGContent(unsanitizedString){return dompurify__WEBPACK_IMPORTED_MODULE_1___default().sanitize(unsanitizedString,{USE_PROFILES:{svg:!0,svgFilters:!0}})},sanitizeTrustedTypes:function sanitizeTrustedTypes(unsanitizedString){return dompurify__WEBPACK_IMPORTED_MODULE_1___default().sanitize(unsanitizedString,{RETURN_TRUSTED_TYPE:!0})},sanitizeTrustedTypesRSS:function sanitizeTrustedTypesRSS(unsanitizedString){return dompurify__WEBPACK_IMPORTED_MODULE_1___default().sanitize(unsanitizedString,{RETURN_TRUSTED_TYPE:!0,ADD_ATTR:["xmlns:atom","version","property","content"],ADD_TAGS:["rss","meta","channel","title","link","description","atom:link","item","pubDate","guid"],PARSER_MEDIA_TYPE:"application/xhtml+xml"})}}},"./src/components/QueryField/QueryField.story.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Basic:function(){return Basic},default:function(){return QueryField_story}});var CompletionItemKind,jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js"),emotion_css_esm=__webpack_require__("../../node_modules/@emotion/css/dist/emotion-css.esm.js"),classnames=__webpack_require__("../../node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),lodash=__webpack_require__("../../node_modules/lodash/lodash.js"),react=__webpack_require__("../../node_modules/react/index.js"),slate_plain_serializer_es=__webpack_require__("../../node_modules/slate-plain-serializer/lib/slate-plain-serializer.es.js"),slate_react_es=__webpack_require__("../../node_modules/slate-react/lib/slate-react.es.js"),selectors=__webpack_require__("../grafana-e2e-selectors/src/selectors/index.ts"),react_dom=__webpack_require__("../../node_modules/react-dom/index.js"),index_esm=__webpack_require__("../../node_modules/react-window/dist/index.esm.js"),context=__webpack_require__("../grafana-data/src/themes/context.tsx");!function(CompletionItemKind){CompletionItemKind.GroupTitle="GroupTitle"}(CompletionItemKind||(CompletionItemKind={}));var lib=__webpack_require__("../../node_modules/calculate-size/lib/index.js"),flattenGroupItems=function(groupedItems){return groupedItems.reduce((function(all,param){var items=param.items,label=param.label;return all.push({label:label,kind:CompletionItemKind.GroupTitle}),items.reduce((function(all,item){return all.push(item),all}),all)}),[])},calculateLongestLabel=function(allItems){return allItems.reduce((function(longest,current){return longest.length<current.label.length?current.label:longest}),"")},calculateListSizes=function(theme,allItems,longestLabel){var size=(0,lib.A)(longestLabel,{font:theme.typography.fontFamilyMonospace,fontSize:theme.typography.bodySmall.fontSize,fontWeight:"normal"}),listWidth=calculateListWidth(size.width,theme),itemHeight=calculateItemHeight(size.height,theme);return{listWidth:listWidth,listHeight:calculateListHeight(itemHeight,allItems),itemHeight:itemHeight}},calculateItemHeight=function(longestLabelHeight,theme){return longestLabelHeight+2*theme.spacing.gridSize},calculateListWidth=function(longestLabelWidth,theme){var verticalPadding=3*theme.spacing.gridSize;return Math.min(Math.max(longestLabelWidth+verticalPadding,200),800)},calculateListHeight=function(itemHeight,allItems){var totalHeight=Math.min(allItems.length,10)*itemHeight;return Math.max(totalHeight,100)},marked_esm=__webpack_require__("../../node_modules/marked/lib/marked.esm.js"),src=__webpack_require__("../../node_modules/marked-mangle/src/index.js"),sanitize=__webpack_require__("../grafana-data/src/text/sanitize.ts");function _define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _object_spread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter((function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable})))),ownKeys.forEach((function(key){_define_property(target,key,source[key])}))}return target}function _object_spread_props(target,source){return source=null!=source?source:{},Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})),target}var hasInitialized=!1,markdownOptions={pedantic:!1,gfm:!0,breaks:!1};var ThemeContext=__webpack_require__("./src/themes/ThemeContext.tsx"),TypeaheadInfo=function(param){var item=param.item,height=param.height,visible=item&&!!item.documentation,label=item?item.label:"",documentation=function renderMarkdown(str,options){hasInitialized||(marked_esm.xI.use((0,src.z)()),marked_esm.xI.setOptions(_object_spread({},markdownOptions)),hasInitialized=!0);var opts=void 0;(null==options?void 0:options.breaks)&&(opts=_object_spread_props(_object_spread({},markdownOptions),{breaks:!0}));var html=(0,marked_esm.xI)(str||"",opts);if("string"!=typeof html)throw new Error("Failed to process markdown synchronously.");return(null==options?void 0:options.noSanitize)?html:(0,sanitize.G$)(html)}(null==item?void 0:item.documentation),styles=function(theme,height,visible){return{typeaheadItem:(0,emotion_css_esm.AH)({label:"type-ahead-item",zIndex:11,padding:theme.spacing(1,1,1,2),border:theme.colors.border.medium,overflowY:"scroll",overflowX:"hidden",outline:"none",background:theme.colors.background.secondary,color:theme.colors.text.secondary,boxShadow:"0 0 20px ".concat(theme.v1.colors.dropdownShadow),visibility:!0===visible?"visible":"hidden",width:"250px",minHeight:"".concat(height+parseInt(theme.spacing(.25),10),"px"),position:"relative",wordBreak:"break-word"})}}((0,ThemeContext.$j)(),height,visible);return(0,jsx_runtime.jsxs)("div",{className:(0,emotion_css_esm.cx)([styles.typeaheadItem]),children:[(0,jsx_runtime.jsx)("b",{children:label}),(0,jsx_runtime.jsx)("hr",{}),(0,jsx_runtime.jsx)("div",{dangerouslySetInnerHTML:{__html:documentation}})]})};try{TypeaheadInfo.displayName="TypeaheadInfo",TypeaheadInfo.__docgenInfo={description:"",displayName:"TypeaheadInfo",props:{item:{defaultValue:null,description:"",name:"item",required:!0,type:{name:"CompletionItem"}},height:{defaultValue:null,description:"",name:"height",required:!0,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Typeahead/TypeaheadInfo.tsx#TypeaheadInfo"]={docgenInfo:TypeaheadInfo.__docgenInfo,name:"TypeaheadInfo",path:"src/components/Typeahead/TypeaheadInfo.tsx#TypeaheadInfo"})}catch(__react_docgen_typescript_loader_error){}var main=__webpack_require__("../../node_modules/react-highlight-words/dist/main.js"),main_default=__webpack_require__.n(main);var PartialHighlighter=function(props){var highlightParts=props.highlightParts,text=props.text,highlightClassName=props.highlightClassName;if(!(null==highlightParts?void 0:highlightParts.length))return null;for(var children=[],indices=function getStartIndices(parts,length){var indices=[];return parts.forEach((function(part){indices.push(part.start,part.end+1)})),0!==indices[0]&&indices.unshift(0),indices[indices.length-1]!==length&&indices.push(length),indices}(highlightParts,text.length),highlighted=0===highlightParts[0].start,i=1;i<indices.length;i++){var start=indices[i-1],end=indices[i];children.push((0,react.createElement)(highlighted?"mark":"span",{key:i-1,className:highlighted?highlightClassName:void 0},text.substring(start,end))),highlighted=!highlighted}return(0,jsx_runtime.jsx)("div",{children:children})};try{PartialHighlighter.displayName="PartialHighlighter",PartialHighlighter.__docgenInfo={description:"",displayName:"PartialHighlighter",props:{text:{defaultValue:null,description:"",name:"text",required:!0,type:{name:"string"}},highlightParts:{defaultValue:null,description:"",name:"highlightParts",required:!0,type:{name:"HighlightPart[]"}},highlightClassName:{defaultValue:null,description:"",name:"highlightClassName",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Typeahead/PartialHighlighter.tsx#PartialHighlighter"]={docgenInfo:PartialHighlighter.__docgenInfo,name:"PartialHighlighter",path:"src/components/Typeahead/PartialHighlighter.tsx#PartialHighlighter"})}catch(__react_docgen_typescript_loader_error){}var TypeaheadItem_getStyles=function(theme){return{typeaheadItem:(0,emotion_css_esm.AH)((obj={border:"none",background:"none",textAlign:"left",label:"type-ahead-item",height:"auto",fontFamily:theme.typography.fontFamilyMonospace,padding:theme.spacing(1,1,1,2),fontSize:theme.typography.bodySmall.fontSize,textOverflow:"ellipsis",overflow:"hidden",zIndex:11,display:"block",whiteSpace:"nowrap",cursor:"pointer"},key=theme.transitions.handleMotion("no-preference","reduce"),value={transition:"color 0.3s cubic-bezier(0.645, 0.045, 0.355, 1), border-color 0.3s cubic-bezier(0.645, 0.045, 0.355, 1), background 0.3s cubic-bezier(0.645, 0.045, 0.355, 1), padding 0.15s cubic-bezier(0.645, 0.045, 0.355, 1)"},key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj)),typeaheadItemSelected:(0,emotion_css_esm.AH)({label:"type-ahead-item-selected",backgroundColor:theme.colors.background.secondary}),typeaheadItemMatch:(0,emotion_css_esm.AH)({label:"type-ahead-item-match",color:theme.v1.palette.yellow,borderBottom:"1px solid ".concat(theme.v1.palette.yellow),padding:"inherit",background:"inherit"}),typeaheadItemGroupTitle:(0,emotion_css_esm.AH)({label:"type-ahead-item-group-title",color:theme.colors.text.secondary,fontSize:theme.typography.bodySmall.fontSize,lineHeight:theme.typography.body.lineHeight,padding:theme.spacing(1)})};var obj,key,value},TypeaheadItem=function(props){var styles=(0,ThemeContext.of)(TypeaheadItem_getStyles),isSelected=props.isSelected,item=props.item,prefix=props.prefix,style=props.style,onMouseEnter=props.onMouseEnter,onMouseLeave=props.onMouseLeave,onClickItem=props.onClickItem,className=isSelected?(0,emotion_css_esm.cx)([styles.typeaheadItem,styles.typeaheadItemSelected]):(0,emotion_css_esm.cx)([styles.typeaheadItem]),highlightClassName=(0,emotion_css_esm.cx)([styles.typeaheadItemMatch]),itemGroupTitleClassName=(0,emotion_css_esm.cx)([styles.typeaheadItemGroupTitle]),label=item.label||"";return item.kind===CompletionItemKind.GroupTitle?(0,jsx_runtime.jsx)("li",{className:itemGroupTitleClassName,style:style,children:(0,jsx_runtime.jsx)("span",{children:label})}):(0,jsx_runtime.jsx)("li",{role:"none",children:(0,jsx_runtime.jsx)("button",{role:"menuitem",className:className,style:style,onMouseDown:onClickItem,onMouseEnter:onMouseEnter,onMouseLeave:onMouseLeave,type:"button",children:void 0!==item.highlightParts?(0,jsx_runtime.jsx)(PartialHighlighter,{text:label,highlightClassName:highlightClassName,highlightParts:item.highlightParts}):(0,jsx_runtime.jsx)(main_default(),{textToHighlight:label,searchWords:[null!=prefix?prefix:""],autoEscape:!0,highlightClassName:highlightClassName})})})};try{TypeaheadItem.displayName="TypeaheadItem",TypeaheadItem.__docgenInfo={description:"",displayName:"TypeaheadItem",props:{isSelected:{defaultValue:null,description:"",name:"isSelected",required:!0,type:{name:"boolean"}},item:{defaultValue:null,description:"",name:"item",required:!0,type:{name:"CompletionItem"}},style:{defaultValue:null,description:"",name:"style",required:!0,type:{name:"CSSProperties"}},prefix:{defaultValue:null,description:"",name:"prefix",required:!1,type:{name:"string"}},onClickItem:{defaultValue:null,description:"",name:"onClickItem",required:!1,type:{name:"((event: MouseEvent<Element, MouseEvent>) => void)"}},onMouseEnter:{defaultValue:null,description:"",name:"onMouseEnter",required:!1,type:{name:"(() => void)"}},onMouseLeave:{defaultValue:null,description:"",name:"onMouseLeave",required:!1,type:{name:"(() => void)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Typeahead/TypeaheadItem.tsx#TypeaheadItem"]={docgenInfo:TypeaheadItem.__docgenInfo,name:"TypeaheadItem",path:"src/components/Typeahead/TypeaheadItem.tsx#TypeaheadItem"})}catch(__react_docgen_typescript_loader_error){}function _assert_this_initialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _class_call_check(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _create_class(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}function Typeahead_define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _get_prototype_of(o){return _get_prototype_of=Object.setPrototypeOf?Object.getPrototypeOf:function getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},_get_prototype_of(o)}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_set_prototype_of(subClass,superClass)}function _possible_constructor_return(self,call){return!call||"object"!==function _type_of(obj){return obj&&"undefined"!=typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj}(call)&&"function"!=typeof call?_assert_this_initialized(self):call}function _set_prototype_of(o,p){return _set_prototype_of=Object.setPrototypeOf||function setPrototypeOf(o,p){return o.__proto__=p,o},_set_prototype_of(o,p)}function _create_super(Derived){var hasNativeReflectConstruct=function _is_native_reflect_construct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=_get_prototype_of(Derived);if(hasNativeReflectConstruct){var NewTarget=_get_prototype_of(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possible_constructor_return(this,result)}}var modulo=function(a,n){return a-n*Math.floor(a/n)},Typeahead=function(PureComponent){_inherits(Typeahead,PureComponent);var _super=_create_super(Typeahead);function Typeahead(){var _this;return _class_call_check(this,Typeahead),Typeahead_define_property(_assert_this_initialized(_this=_super.apply(this,arguments)),"context",void 0),Typeahead_define_property(_assert_this_initialized(_this),"listRef",(0,react.createRef)()),Typeahead_define_property(_assert_this_initialized(_this),"state",{hoveredItem:null,typeaheadIndex:null,allItems:[],listWidth:-1,listHeight:-1,itemHeight:-1}),Typeahead_define_property(_assert_this_initialized(_this),"componentDidMount",(function(){_this.props.menuRef&&_this.props.menuRef(_assert_this_initialized(_this)),document.addEventListener("selectionchange",_this.handleSelectionChange);var allItems=flattenGroupItems(_this.props.groupedItems),longestLabel=calculateLongestLabel(allItems),_calculateListSizes=calculateListSizes(_this.context,allItems,longestLabel),listWidth=_calculateListSizes.listWidth,listHeight=_calculateListSizes.listHeight,itemHeight=_calculateListSizes.itemHeight;_this.setState({listWidth:listWidth,listHeight:listHeight,itemHeight:itemHeight,allItems:allItems})})),Typeahead_define_property(_assert_this_initialized(_this),"componentWillUnmount",(function(){document.removeEventListener("selectionchange",_this.handleSelectionChange)})),Typeahead_define_property(_assert_this_initialized(_this),"handleSelectionChange",(function(){_this.forceUpdate()})),Typeahead_define_property(_assert_this_initialized(_this),"componentDidUpdate",(function(prevProps,prevState){if(null!==_this.state.typeaheadIndex&&prevState.typeaheadIndex!==_this.state.typeaheadIndex&&_this.listRef&&_this.listRef.current){if(1===_this.state.typeaheadIndex)return void _this.listRef.current.scrollToItem(0);_this.listRef.current.scrollToItem(_this.state.typeaheadIndex)}if(!1===(0,lodash.isEqual)(prevProps.groupedItems,_this.props.groupedItems)){var allItems=flattenGroupItems(_this.props.groupedItems),longestLabel=calculateLongestLabel(allItems),_calculateListSizes=calculateListSizes(_this.context,allItems,longestLabel),listWidth=_calculateListSizes.listWidth,listHeight=_calculateListSizes.listHeight,itemHeight=_calculateListSizes.itemHeight;_this.setState({listWidth:listWidth,listHeight:listHeight,itemHeight:itemHeight,allItems:allItems,typeaheadIndex:null})}})),Typeahead_define_property(_assert_this_initialized(_this),"onMouseEnter",(function(index){_this.setState({hoveredItem:index})})),Typeahead_define_property(_assert_this_initialized(_this),"onMouseLeave",(function(){_this.setState({hoveredItem:null})})),Typeahead_define_property(_assert_this_initialized(_this),"moveMenuIndex",(function(moveAmount){var itemCount=_this.state.allItems.length;if(itemCount){var typeaheadIndex=_this.state.typeaheadIndex||0,newTypeaheadIndex=modulo(typeaheadIndex+moveAmount,itemCount);return _this.state.allItems[newTypeaheadIndex].kind===CompletionItemKind.GroupTitle&&(newTypeaheadIndex=modulo(newTypeaheadIndex+moveAmount,itemCount)),void _this.setState({typeaheadIndex:newTypeaheadIndex})}})),Typeahead_define_property(_assert_this_initialized(_this),"insertSuggestion",(function(){_this.props.onSelectSuggestion&&null!==_this.state.typeaheadIndex&&_this.props.onSelectSuggestion(_this.state.allItems[_this.state.typeaheadIndex])})),_this}return _create_class(Typeahead,[{key:"menuPosition",get:function get(){if(!window.getSelection)return"";var selection=window.getSelection(),node=selection&&selection.anchorNode;if(node&&node.parentElement){var rect=node.parentElement.getBoundingClientRect(),scrollX=window.scrollX,scrollY=window.scrollY;return"position: absolute; display: flex; top: ".concat(rect.top+scrollY+rect.height+6,"px; left: ").concat(rect.left+scrollX-2,"px")}return""}},{key:"render",value:function render(){var _this=this,_this_props=this.props,prefix=_this_props.prefix,_this_props_isOpen=_this_props.isOpen,isOpen=void 0!==_this_props_isOpen&&_this_props_isOpen,origin=_this_props.origin,_this_state=this.state,allItems=_this_state.allItems,listWidth=_this_state.listWidth,listHeight=_this_state.listHeight,itemHeight=_this_state.itemHeight,hoveredItem=_this_state.hoveredItem,typeaheadIndex=_this_state.typeaheadIndex,styles=Typeahead_getStyles(this.context),showDocumentation=hoveredItem||typeaheadIndex,documentationItem=allItems[hoveredItem||(typeaheadIndex||0)];return(0,jsx_runtime.jsxs)(Portal,{origin:origin,isOpen:isOpen,style:this.menuPosition,children:[(0,jsx_runtime.jsx)("ul",{role:"menu",className:styles.typeahead,"data-testid":"typeahead",children:(0,jsx_runtime.jsx)(index_esm.Y1,{ref:this.listRef,itemCount:allItems.length,itemSize:itemHeight,itemKey:function(index){var item=allItems&&allItems[index];return item?"".concat(index,"-").concat(item.label):"".concat(index)},width:listWidth,height:listHeight,children:function(param){var index=param.index,style=param.style,item=allItems&&allItems[index];return item?(0,jsx_runtime.jsx)(TypeaheadItem,{onClickItem:function(){return _this.props.onSelectSuggestion?_this.props.onSelectSuggestion(item):{}},isSelected:null!==typeaheadIndex&&allItems[typeaheadIndex]===item,item:item,prefix:prefix,style:style,onMouseEnter:function(){return _this.onMouseEnter(index)},onMouseLeave:_this.onMouseLeave}):null}})}),showDocumentation&&(0,jsx_runtime.jsx)(TypeaheadInfo,{height:listHeight,item:documentationItem})]})}}]),Typeahead}(react.PureComponent);Typeahead_define_property(Typeahead,"contextType",context.D);var Portal=function(PureComponent){_inherits(Portal,PureComponent);var _super=_create_super(Portal);function Portal(props){var _this;_class_call_check(this,Portal),Typeahead_define_property(_assert_this_initialized(_this=_super.call(this,props)),"node",void 0);var _props_index=props.index,index=void 0===_props_index?0:_props_index,_props_origin=props.origin,origin=void 0===_props_origin?"query":_props_origin,style=props.style;return _this.node=document.createElement("div"),_this.node.setAttribute("style",style),_this.node.classList.add("slate-typeahead-".concat(origin,"-").concat(index)),document.body.appendChild(_this.node),_this}return _create_class(Portal,[{key:"componentWillUnmount",value:function componentWillUnmount(){document.body.removeChild(this.node)}},{key:"render",value:function render(){return this.props.isOpen?(this.node.setAttribute("style",this.props.style),this.node.classList.add("slate-typeahead--open"),react_dom.createPortal(this.props.children,this.node)):(this.node.classList.remove("slate-typeahead--open"),null)}}]),Portal}(react.PureComponent),Typeahead_getStyles=function(theme){return{typeahead:(0,emotion_css_esm.AH)({position:"relative",zIndex:theme.zIndex.typeahead,borderRadius:theme.shape.radius.default,border:"1px solid ".concat(theme.components.panel.borderColor),maxHeight:"66vh",overflowY:"scroll",overflowX:"hidden",outline:"none",listStyle:"none",background:theme.components.panel.background,color:theme.colors.text.primary,boxShadow:theme.shadows.z2,strong:{color:theme.v1.palette.yellow}})}};try{Typeahead.displayName="Typeahead",Typeahead.__docgenInfo={description:"",displayName:"Typeahead",props:{origin:{defaultValue:null,description:"",name:"origin",required:!0,type:{name:"string"}},groupedItems:{defaultValue:null,description:"",name:"groupedItems",required:!0,type:{name:"CompletionItemGroup[]"}},prefix:{defaultValue:null,description:"",name:"prefix",required:!1,type:{name:"string"}},menuRef:{defaultValue:null,description:"",name:"menuRef",required:!1,type:{name:"((el: Typeahead) => void)"}},onSelectSuggestion:{defaultValue:null,description:"",name:"onSelectSuggestion",required:!1,type:{name:"((suggestion: CompletionItem) => void)"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Typeahead/Typeahead.tsx#Typeahead"]={docgenInfo:Typeahead.__docgenInfo,name:"Typeahead",path:"src/components/Typeahead/Typeahead.tsx#Typeahead"})}catch(__react_docgen_typescript_loader_error){}try{contextType.displayName="Typeahead.contextType",contextType.__docgenInfo={description:"Context lets components pass information deep down without explicitly\npassing props.\n\nCreated from {@link createContext}",displayName:"Typeahead.contextType",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Typeahead/Typeahead.tsx#Typeahead.contextType"]={docgenInfo:Typeahead.contextType.__docgenInfo,name:"Typeahead.contextType",path:"src/components/Typeahead/Typeahead.tsx#Typeahead.contextType"})}catch(__react_docgen_typescript_loader_error){}var SearchFunctionType,slate_es=__webpack_require__("../../node_modules/slate/lib/slate.es.js"),SCHEMA={document:{nodes:[{match:[{type:"paragraph"},{type:"code_block"},{type:"code_line"}]}]},inlines:{}},makeFragment=function(text,syntax){var lines=text.split("\n").map((function(line){return slate_es.eB.create({type:"code_line",nodes:[slate_es.EY.create(line)]})})),block=slate_es.eB.create({data:{syntax:syntax},type:"code_block",nodes:lines});return slate_es.yo.create({nodes:[block]})},makeValue=function(text,syntax){var fragment=makeFragment(text,syntax);return slate_es.WT.create({document:fragment})};function searchFunctions_define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}!function(SearchFunctionType){SearchFunctionType.Word="Word",SearchFunctionType.Prefix="Prefix",SearchFunctionType.Fuzzy="Fuzzy"}(SearchFunctionType||(SearchFunctionType={}));var _obj,SearchFunctionMap=(searchFunctions_define_property(_obj={},"Word",(function(items,text){return items.filter((function(c){return(c.filterText||c.label).includes(text)}))})),searchFunctions_define_property(_obj,"Prefix",(function(items,text){return items.filter((function(c){return(c.filterText||c.label).startsWith(text)}))})),searchFunctions_define_property(_obj,"Fuzzy",(function(items,text){return text=text.toLowerCase(),items.filter((function(item){var _fuzzyMatch=function fuzzyMatch(stack,needle){var distance=0,searchIndex=stack.indexOf(needle);needle=needle.replace(/\s/g,"");var ranges=[];if(-1!==searchIndex)return{distance:0,found:!0,ranges:[{start:searchIndex,end:searchIndex+needle.length-1}]};var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=needle[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var letter=_step.value,letterIndex=stack.indexOf(letter,searchIndex);if(-1===letterIndex)return{distance:1/0,ranges:[],found:!1};if(-1!==searchIndex&&(distance+=letterIndex-searchIndex),searchIndex=letterIndex+1,0===ranges.length)ranges.push({start:letterIndex,end:letterIndex});else{var lastRange=(0,lodash.last)(ranges);letterIndex===lastRange.end+1?lastRange.end++:ranges.push({start:letterIndex,end:letterIndex})}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return{distance:distance,ranges:ranges,found:!0}}(item.label.toLowerCase(),text),distance=_fuzzyMatch.distance,ranges=_fuzzyMatch.ranges;return!!_fuzzyMatch.found&&(item.sortValue=distance,item.highlightParts=ranges,!0)}))})),_obj);function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function suggestions_define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function suggestions_object_spread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter((function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable})))),ownKeys.forEach((function(key){suggestions_define_property(target,key,source[key])}))}return target}function suggestions_object_spread_props(target,source){return source=null!=source?source:{},Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):function suggestions_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})),target}function _ts_generator(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}function SuggestionsPlugin(param){var typeaheadRef,onTypeahead=param.onTypeahead,cleanText=param.cleanText,onWillApplySuggestion=param.onWillApplySuggestion,portalOrigin=param.portalOrigin,state={groupedItems:[],typeaheadPrefix:"",typeaheadContext:"",typeaheadText:""},handleTypeaheadDebounced=(0,lodash.debounce)(handleTypeahead,250),setState=function(update){state=suggestions_object_spread({},state,update)};return{onBlur:function(event,editor,next){return state=suggestions_object_spread_props(suggestions_object_spread({},state),{groupedItems:[]}),next()},onClick:function(event,editor,next){return state=suggestions_object_spread_props(suggestions_object_spread({},state),{groupedItems:[]}),next()},onKeyDown:function(event,editor,next){var hasSuggestions=state.groupedItems.length;switch(event.key){case"Escape":if(hasSuggestions)return event.preventDefault(),state=suggestions_object_spread_props(suggestions_object_spread({},state),{groupedItems:[]}),editor.insertText("");break;case"ArrowDown":case"ArrowUp":if(hasSuggestions)return event.preventDefault(),void typeaheadRef.moveMenuIndex("ArrowDown"===event.key?1:-1);break;case"Enter":if(!event.shiftKey&&!event.ctrlKey&&hasSuggestions)return event.preventDefault(),typeaheadRef.insertSuggestion();break;case"Tab":if(hasSuggestions)return event.preventDefault(),typeaheadRef.insertSuggestion();break;default:1===event.key.length&&handleTypeaheadDebounced(editor,setState,onTypeahead,cleanText)}return next()},commands:{selectSuggestion:function(editor,suggestion){var suggestions=state.groupedItems;if(!suggestions||!suggestions.length)return editor;var ed=editor.applyTypeahead(suggestion);return handleTypeaheadDebounced(editor,setState,onTypeahead,cleanText),ed},applyTypeahead:function(editor,suggestion){var suggestionText=suggestion.insertText||suggestion.label,preserveSuffix="function"===suggestion.kind,move=suggestion.move||0,moveForward=move>0?move:0,moveBackward=move<0?-move:0,typeaheadPrefix=state.typeaheadPrefix,typeaheadText=state.typeaheadText,typeaheadContext=state.typeaheadContext;onWillApplySuggestion&&(suggestionText=onWillApplySuggestion(suggestionText,{groupedItems:state.groupedItems,typeaheadContext:typeaheadContext,typeaheadPrefix:typeaheadPrefix,typeaheadText:typeaheadText}));var _getNumCharsToDelete=function getNumCharsToDelete(suggestionText,typeaheadPrefix,typeaheadText,preserveSuffix,deleteBackwards,cleanText){var backward=deleteBackwards||typeaheadPrefix.length,text=cleanText?cleanText(typeaheadText):typeaheadText,offset=typeaheadText.indexOf(typeaheadPrefix),suffixLength=offset>-1?text.length-offset-typeaheadPrefix.length:text.length-typeaheadPrefix.length,midWord=Boolean(typeaheadPrefix&&suffixLength>0||suggestionText===typeaheadText),forward=midWord&&!preserveSuffix?suffixLength+offset:0;return{forward:forward,backward:backward}}(suggestionText,typeaheadPrefix,typeaheadText,preserveSuffix,suggestion.deleteBackwards,cleanText),forward=_getNumCharsToDelete.forward,backward=_getNumCharsToDelete.backward;if(suggestionText.match(/\n/)){var fragment=makeFragment(suggestionText);return editor.deleteBackward(backward).deleteForward(forward).insertFragment(fragment).focus(),editor}return state=suggestions_object_spread_props(suggestions_object_spread({},state),{groupedItems:[]}),editor.snapshotSelection().deleteBackward(backward).deleteForward(forward).insertText(suggestionText).moveForward(moveForward).moveBackward(moveBackward).focus(),editor}},renderEditor:function renderEditor(props,editor,next){if(editor.value.selection.isExpanded)return next();var children=next();return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[children,(0,jsx_runtime.jsx)(Typeahead,{menuRef:function(menu){return typeaheadRef=menu},origin:portalOrigin,prefix:state.typeaheadPrefix,isOpen:!!state.groupedItems.length,groupedItems:state.groupedItems,onSelectSuggestion:editor.selectSuggestion})]})}}}var _ref,handleTypeahead=(_ref=function _async_to_generator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}((function(editor,onStateChange,onTypeahead,cleanText){var value,selection,parentBlock,selectionStartOffset,decorations,filteredDecorations,labelKeyDec,labelKey,wrapperClasses,text,prefix,labelValueMatch,_ref,suggestions,context,filteredSuggestions;return _ts_generator(this,(function(_state){switch(_state.label){case 0:return onTypeahead?(value=editor.value,selection=value.selection,parentBlock=value.document.getClosestBlock(value.focusBlock.key),selectionStartOffset=value.selection.start.offset-1,decorations=parentBlock&&parentBlock.getDecorations(editor),filteredDecorations=decorations?decorations.filter((function(decoration){return decoration.start.offset<=selectionStartOffset&&decoration.end.offset>selectionStartOffset&&"prism-token"===decoration.type})).toArray():[],labelKeyDec=decorations&&decorations.filter((function(decoration){return decoration.end.offset<=selectionStartOffset&&"prism-token"===decoration.type&&decoration.data.get("className").includes("label-key")})).last(),labelKey=labelKeyDec&&value.focusText.text.slice(labelKeyDec.start.offset,labelKeyDec.end.offset),wrapperClasses=filteredDecorations.map((function(decoration){return decoration.data.get("className")})).join(" ").split(" ").filter((function(className){return className.length})),text=value.focusText.text,prefix=text.slice(0,selection.focus.offset),filteredDecorations.length&&(text=value.focusText.text.slice(filteredDecorations[0].start.offset,filteredDecorations[0].end.offset),prefix=value.focusText.text.slice(filteredDecorations[0].start.offset,selection.focus.offset)),(labelValueMatch=prefix.match(/(?:!?=~?"?|")(.*)/))?prefix=labelValueMatch[1]:cleanText&&(prefix=cleanText(prefix)),[4,onTypeahead({prefix:prefix,text:text,value:value,wrapperClasses:wrapperClasses,labelKey:labelKey||void 0,editor:editor})]):[2];case 1:return _ref=_state.sent(),suggestions=_ref.suggestions,context=_ref.context,filteredSuggestions=suggestions.map((function(group){if(!group.items)return group;var searchFunctionType=group.searchFunctionType||(group.prefixMatch?SearchFunctionType.Prefix:SearchFunctionType.Word),searchFunction=SearchFunctionMap[searchFunctionType],newGroup=suggestions_object_spread({},group);return prefix&&(group.skipFilter||(newGroup.items=newGroup.items.filter((function(c){return(c.filterText||c.label).length>=prefix.length})),newGroup.items=searchFunction(newGroup.items,prefix)),newGroup.items=newGroup.items.filter((function(c){var _c_filterText;return!(c.insertText===prefix||(null!==(_c_filterText=c.filterText)&&void 0!==_c_filterText?_c_filterText:c.label)===prefix)}))),group.skipSort||(newGroup.items=(0,lodash.sortBy)(newGroup.items,(function(item){return void 0===item.sortText?void 0!==item.sortValue?item.sortValue:item.label:item.sortText||item.label}))),newGroup})).filter((function(gr){return gr.items&&gr.items.length})),onStateChange({groupedItems:filteredSuggestions,typeaheadPrefix:prefix,typeaheadContext:context,typeaheadText:text}),editor.blur().focus(),[2]}}))})),function handleTypeahead(editor,onStateChange,onTypeahead,cleanText){return _ref.apply(this,arguments)});try{SuggestionsPlugin.displayName="SuggestionsPlugin",SuggestionsPlugin.__docgenInfo={description:"",displayName:"SuggestionsPlugin",props:{onTypeahead:{defaultValue:null,description:"",name:"onTypeahead",required:!1,type:{name:"((typeahead: TypeaheadInput) => Promise<TypeaheadOutput>)"}},cleanText:{defaultValue:null,description:"",name:"cleanText",required:!1,type:{name:"((text: string) => string)"}},onWillApplySuggestion:{defaultValue:null,description:"",name:"onWillApplySuggestion",required:!1,type:{name:"((suggestion: string, state: SuggestionsState) => string)"}},portalOrigin:{defaultValue:null,description:"",name:"portalOrigin",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/slate-plugins/suggestions.tsx#SuggestionsPlugin"]={docgenInfo:SuggestionsPlugin.__docgenInfo,name:"SuggestionsPlugin",path:"src/slate-plugins/suggestions.tsx#SuggestionsPlugin"})}catch(__react_docgen_typescript_loader_error){}var is_hotkey_lib=__webpack_require__("../../node_modules/is-hotkey/lib/index.js"),isSelectLineHotkey=(0,is_hotkey_lib.Sn)("mod+l");var isIndentLeftHotkey=(0,is_hotkey_lib.Sn)("mod+["),isShiftTabHotkey=(0,is_hotkey_lib.Sn)("shift+tab"),isIndentRightHotkey=(0,is_hotkey_lib.Sn)("mod+]"),handleIndent=function(editor,indentDirection){var curSelection=editor.value.selection,selectedBlocks=editor.value.document.getLeafBlocksAtRange(curSelection).toArray();if("left"===indentDirection){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=selectedBlocks[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var block=_step.value,blockWhitespace=block.text.length-block.text.trimLeft().length,textKey=block.getFirstText().key,rangeProperties={anchor:{key:textKey,offset:blockWhitespace,path:[]},focus:{key:textKey,offset:blockWhitespace,path:[]}};editor.deleteBackwardAtRange(slate_es.Q6.create(rangeProperties),Math.min(2,blockWhitespace))}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}else{var textBeforeCaret=editor.value.startText.text.slice(0,curSelection.start.offset),isWhiteSpace=/^\s*$/.test(textBeforeCaret),_iteratorNormalCompletion1=!0,_didIteratorError1=!1,_iteratorError1=void 0;try{for(var _step1,_iterator1=selectedBlocks[Symbol.iterator]();!(_iteratorNormalCompletion1=(_step1=_iterator1.next()).done);_iteratorNormalCompletion1=!0){var block1=_step1.value;editor.insertTextByKey(block1.getFirstText().key,0,"  ")}}catch(err){_didIteratorError1=!0,_iteratorError1=err}finally{try{_iteratorNormalCompletion1||null==_iterator1.return||_iterator1.return()}finally{if(_didIteratorError1)throw _iteratorError1}}isWhiteSpace&&editor.moveStartBackward(2)}};function IndentationPlugin(){return{onKeyDown:function onKeyDown(event,editor,next){if(isIndentLeftHotkey(event)||isShiftTabHotkey(event))event.preventDefault(),handleIndent(editor,"left");else if(isIndentRightHotkey(event))event.preventDefault(),handleIndent(editor,"right");else{if("Tab"!==event.key)return next();!function(event,editor,next){var _editor_value=editor.value,startBlock=_editor_value.startBlock,endBlock=_editor_value.endBlock,_editor_value_selection=_editor_value.selection,_editor_value_selection_start=_editor_value_selection.start,startOffset=_editor_value_selection_start.offset,startKey=_editor_value_selection_start.key,_editor_value_selection_end=_editor_value_selection.end,endOffset=_editor_value_selection_end.offset,endKey=_editor_value_selection_end.key;if(""!==slate_plain_serializer_es.A.serialize(editor.value)){event.preventDefault();var first=startBlock.getFirstText();first&&0===startOffset&&startKey===first.key&&endOffset===first.text.length&&endKey===first.key||!startBlock.equals(endBlock)?handleIndent(editor,"right"):editor.insertText("  ")}}(event,editor)}return!0}}}function clipboard_define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function clipboard_object_spread_props(target,source){return source=null!=source?source:{},Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):function clipboard_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})),target}var removeBom=function(str){return null==str?void 0:str.replace(/[\uFEFF]/g,"")};function ClipboardPlugin(){var clipboardPlugin={onCopy:function onCopy(event,editor,next){event.preventDefault();var _editor_value=editor.value,document=_editor_value.document,selection=_editor_value.selection,startOffset=selection.start.offset,endOffset=selection.end.offset,selectedBlocks=document.getLeafBlocksAtRange(selection).toArray().map((function(block){return block.text})),copiedText=removeBom(function(textBlocks,startOffset,endOffset){if(textBlocks.length){var excludingLastLineLength=textBlocks.slice(0,-1).join("").length+textBlocks.length-1;return textBlocks.join("\n").slice(startOffset,excludingLastLineLength+endOffset)}}(selectedBlocks,startOffset,endOffset));return copiedText&&event.clipboardData&&event.clipboardData.setData("Text",copiedText),!0},onPaste:function onPaste(event,editor,next){if(event.preventDefault(),event.clipboardData){var pastedValue=removeBom(event.clipboardData.getData("Text")),lines=null==pastedValue?void 0:pastedValue.split("\n");if(lines&&lines.length){editor.insertText(lines[0]);var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=lines.slice(1)[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var line=_step.value;editor.splitBlock().insertText(line)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}}return!0}};return clipboard_object_spread_props(function clipboard_object_spread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter((function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable})))),ownKeys.forEach((function(key){clipboard_define_property(target,key,source[key])}))}return target}({},clipboardPlugin),{onCut:function onCut(event,editor,next){return clipboardPlugin.onCopy(event,editor,next),editor.deleteAtRange(editor.value.selection),!0}})}var mixins=__webpack_require__("./src/themes/mixins.ts");function _array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function QueryField_assert_this_initialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function QueryField_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function QueryField_define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function QueryField_get_prototype_of(o){return QueryField_get_prototype_of=Object.setPrototypeOf?Object.getPrototypeOf:function getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},QueryField_get_prototype_of(o)}function QueryField_possible_constructor_return(self,call){return!call||"object"!==function QueryField_type_of(obj){return obj&&"undefined"!=typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj}(call)&&"function"!=typeof call?QueryField_assert_this_initialized(self):call}function QueryField_set_prototype_of(o,p){return QueryField_set_prototype_of=Object.setPrototypeOf||function setPrototypeOf(o,p){return o.__proto__=p,o},QueryField_set_prototype_of(o,p)}function _to_consumable_array(arr){return function _array_without_holes(arr){if(Array.isArray(arr))return _array_like_to_array(arr)}(arr)||function _iterable_to_array(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function _unsupported_iterable_to_array(o,minLen){if(!o)return;if("string"==typeof o)return _array_like_to_array(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array(o,minLen)}(arr)||function _non_iterable_spread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function QueryField_create_super(Derived){var hasNativeReflectConstruct=function QueryField_is_native_reflect_construct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=QueryField_get_prototype_of(Derived);if(hasNativeReflectConstruct){var NewTarget=QueryField_get_prototype_of(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return QueryField_possible_constructor_return(this,result)}}var UnThemedQueryField=function(PureComponent){!function QueryField_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&QueryField_set_prototype_of(subClass,superClass)}(UnThemedQueryField,PureComponent);var _super=QueryField_create_super(UnThemedQueryField);function UnThemedQueryField(props){var _this;!function QueryField_class_call_check(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,UnThemedQueryField),QueryField_define_property(QueryField_assert_this_initialized(_this=_super.call(this,props)),"plugins",void 0),QueryField_define_property(QueryField_assert_this_initialized(_this),"runOnChangeDebounced",void 0),QueryField_define_property(QueryField_assert_this_initialized(_this),"lastExecutedValue",null),QueryField_define_property(QueryField_assert_this_initialized(_this),"mounted",!1),QueryField_define_property(QueryField_assert_this_initialized(_this),"editor",null),QueryField_define_property(QueryField_assert_this_initialized(_this),"onChange",(function(value,runQuery){var documentChanged=value.document!==_this.state.value.document,prevValue=_this.state.value;_this.props.onRichValueChange&&_this.props.onRichValueChange(value),_this.setState({value:value},(function(){if(documentChanged){var textChanged=slate_plain_serializer_es.A.serialize(prevValue)!==slate_plain_serializer_es.A.serialize(value);textChanged&&runQuery&&_this.runOnChangeAndRunQuery(),textChanged&&!runQuery&&_this.runOnChangeDebounced()}}))})),QueryField_define_property(QueryField_assert_this_initialized(_this),"runOnChange",(function(){var onChange=_this.props.onChange,value=slate_plain_serializer_es.A.serialize(_this.state.value);onChange&&onChange(_this.cleanText(value))})),QueryField_define_property(QueryField_assert_this_initialized(_this),"runOnRunQuery",(function(){var onRunQuery=_this.props.onRunQuery;onRunQuery&&(onRunQuery(),_this.lastExecutedValue=_this.state.value)})),QueryField_define_property(QueryField_assert_this_initialized(_this),"runOnChangeAndRunQuery",(function(){_this.runOnChange(),_this.runOnRunQuery()})),QueryField_define_property(QueryField_assert_this_initialized(_this),"handleBlur",(function(_,editor,next){var onBlur=_this.props.onBlur;onBlur?onBlur():(_this.lastExecutedValue?slate_plain_serializer_es.A.serialize(_this.lastExecutedValue):"")!==slate_plain_serializer_es.A.serialize(editor.value)&&_this.runOnChangeAndRunQuery();return next()})),_this.runOnChangeDebounced=(0,lodash.debounce)(_this.runOnChange,500);var param,handler,onTypeahead=props.onTypeahead,cleanText=props.cleanText,portalOrigin=props.portalOrigin,onWillApplySuggestion=props.onWillApplySuggestion;return _this.plugins=[SuggestionsPlugin({onTypeahead:onTypeahead,cleanText:cleanText,portalOrigin:portalOrigin,onWillApplySuggestion:onWillApplySuggestion}),(param={handler:_this.runOnChangeAndRunQuery},handler=param.handler,{onKeyDown:function onKeyDown(event,editor,next){return handler&&"Enter"===event.key&&(event.shiftKey||event.ctrlKey)?(event.preventDefault(),handler(event),editor):next()}}),{onKeyDown:function onKeyDown(event,editor,next){var value=editor.value;if(value.selection.isExpanded)return next();if("Enter"===event.key){event.preventDefault();var indent=function getIndent(text){var offset=text.length-text.trimLeft().length;if(offset){for(var indent=text[0];--offset;)indent+=text[0];return indent}return""}(value.startBlock.text);return editor.splitBlock().insertText(indent).focus()}return next()}},{onKeyDown:function onKeyDown(event,editor,next){var value=editor.value;if(value.selection.isExpanded)return next();if("k"===event.key&&event.ctrlKey){event.preventDefault();var text=value.anchorText.text,offset=value.selection.anchor.offset,forward=text.length-offset;return editor.deleteForward(forward),!0}return next()}},{onKeyDown:function onKeyDown(event,editor,next){if(!isSelectLineHotkey(event))return next();event.preventDefault();var _editor_value=editor.value,focusBlock=_editor_value.focusBlock,document=_editor_value.document;return editor.moveAnchorToStartOfBlock(),document.getNextBlock(focusBlock.key)?editor.moveFocusToStartOfNextBlock():editor.moveFocusToEndOfText(),!0}},IndentationPlugin(),ClipboardPlugin()].concat(_to_consumable_array(props.additionalPlugins||[])).filter((function(p){return p})),_this.state={suggestions:[],typeaheadContext:null,typeaheadPrefix:"",typeaheadText:"",value:makeValue(props.query||"",props.syntax)},_this}return function QueryField_create_class(Constructor,protoProps,staticProps){return protoProps&&QueryField_defineProperties(Constructor.prototype,protoProps),staticProps&&QueryField_defineProperties(Constructor,staticProps),Constructor}(UnThemedQueryField,[{key:"componentDidMount",value:function componentDidMount(){this.mounted=!0}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.mounted=!1}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps,prevState){var _this_props=this.props,query=_this_props.query,syntax=_this_props.syntax,syntaxLoaded=_this_props.syntaxLoaded;if(!prevProps.syntaxLoaded&&syntaxLoaded&&this.editor){var editor=this.editor.insertText(" ").deleteBackward(1);this.onChange(editor.value,!0)}var value=this.state.value;query!==prevProps.query&&query!==slate_plain_serializer_es.A.serialize(value)&&this.setState({value:makeValue(query||"",syntax)})}},{key:"cleanText",value:function cleanText(text){return text.replace(/[\r]/g,"")}},{key:"render",value:function render(){var _this=this,_this_props=this.props,disabled=_this_props.disabled,theme=_this_props.theme,wrapperClassName=classnames_default()("slate-query-field__wrapper",{"slate-query-field__wrapper--disabled":disabled}),styles=QueryField_getStyles(theme);return(0,jsx_runtime.jsx)("div",{className:(0,emotion_css_esm.cx)(wrapperClassName,styles.wrapper),children:(0,jsx_runtime.jsx)("div",{className:"slate-query-field","data-testid":selectors.Tp.components.QueryField.container,children:(0,jsx_runtime.jsx)(slate_react_es.KE,{ref:function(editor){return _this.editor=editor},schema:SCHEMA,autoCorrect:!1,readOnly:this.props.disabled,onBlur:this.handleBlur,onClick:this.props.onClick,onChange:function(change){_this.onChange(change.value,!1)},placeholder:this.props.placeholder,plugins:this.plugins,spellCheck:!1,value:this.state.value})})})}}]),UnThemedQueryField}(react.PureComponent);QueryField_define_property(UnThemedQueryField,"defaultProps",{onBlur:function(){}});var QueryField=(0,ThemeContext.cV)(UnThemedQueryField),QueryField_getStyles=function(theme){var focusStyles=(0,mixins.Hi)(theme);return{wrapper:(0,emotion_css_esm.AH)({"&:focus-within":focusStyles})}};try{UnThemedQueryField.displayName="UnThemedQueryField",UnThemedQueryField.__docgenInfo={description:"Renders an editor field.\nPass initial value as initialQuery and listen to changes in props.onValueChanged.\nThis component can only process strings. Internally it uses Slate Value.\nImplement props.onTypeahead to use suggestions, see PromQueryField.tsx as an example.",displayName:"UnThemedQueryField",props:{additionalPlugins:{defaultValue:null,description:"",name:"additionalPlugins",required:!1,type:{name:"Plugin<Editor>[]"}},cleanText:{defaultValue:null,description:"",name:"cleanText",required:!1,type:{name:"((text: string) => string)"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean"}},query:{defaultValue:null,description:"",name:"query",required:!1,type:{name:"string | null"}},onRunQuery:{defaultValue:null,description:"",name:"onRunQuery",required:!1,type:{name:"(() => void)"}},onBlur:{defaultValue:{value:"() => {}"},description:"",name:"onBlur",required:!1,type:{name:"(() => void)"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"((value: string) => void)"}},onRichValueChange:{defaultValue:null,description:"",name:"onRichValueChange",required:!1,type:{name:"((value: Value) => void)"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"EventHook<MouseEvent<Element, MouseEvent>>"}},onTypeahead:{defaultValue:null,description:"",name:"onTypeahead",required:!1,type:{name:"((typeahead: TypeaheadInput) => Promise<TypeaheadOutput>)"}},onWillApplySuggestion:{defaultValue:null,description:"",name:"onWillApplySuggestion",required:!1,type:{name:"((suggestion: string, state: SuggestionsState) => string)"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},portalOrigin:{defaultValue:null,description:"",name:"portalOrigin",required:!0,type:{name:"string"}},syntax:{defaultValue:null,description:"",name:"syntax",required:!1,type:{name:"string"}},syntaxLoaded:{defaultValue:null,description:"",name:"syntaxLoaded",required:!1,type:{name:"boolean"}},theme:{defaultValue:null,description:"",name:"theme",required:!0,type:{name:"GrafanaTheme2"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/QueryField/QueryField.tsx#UnThemedQueryField"]={docgenInfo:UnThemedQueryField.__docgenInfo,name:"UnThemedQueryField",path:"src/components/QueryField/QueryField.tsx#UnThemedQueryField"})}catch(__react_docgen_typescript_loader_error){}try{QueryField.displayName="QueryField",QueryField.__docgenInfo={description:"",displayName:"QueryField",props:{onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"((value: string) => void)"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"EventHook<MouseEvent<Element, MouseEvent>>"}},onBlur:{defaultValue:null,description:"",name:"onBlur",required:!1,type:{name:"(() => void)"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},additionalPlugins:{defaultValue:null,description:"",name:"additionalPlugins",required:!1,type:{name:"Plugin<Editor>[]"}},cleanText:{defaultValue:null,description:"",name:"cleanText",required:!1,type:{name:"((text: string) => string)"}},query:{defaultValue:null,description:"",name:"query",required:!1,type:{name:"string | null"}},onRunQuery:{defaultValue:null,description:"",name:"onRunQuery",required:!1,type:{name:"(() => void)"}},onRichValueChange:{defaultValue:null,description:"",name:"onRichValueChange",required:!1,type:{name:"((value: Value) => void)"}},onTypeahead:{defaultValue:null,description:"",name:"onTypeahead",required:!1,type:{name:"((typeahead: TypeaheadInput) => Promise<TypeaheadOutput>)"}},onWillApplySuggestion:{defaultValue:null,description:"",name:"onWillApplySuggestion",required:!1,type:{name:"((suggestion: string, state: SuggestionsState) => string)"}},portalOrigin:{defaultValue:null,description:"",name:"portalOrigin",required:!0,type:{name:"string"}},syntax:{defaultValue:null,description:"",name:"syntax",required:!1,type:{name:"string"}},syntaxLoaded:{defaultValue:null,description:"",name:"syntaxLoaded",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/QueryField/QueryField.tsx#QueryField"]={docgenInfo:QueryField.__docgenInfo,name:"QueryField",path:"src/components/QueryField/QueryField.tsx#QueryField"})}catch(__react_docgen_typescript_loader_error){}function QueryField_story_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function QueryField_story_define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function QueryField_story_ts_generator(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}var meta={title:"Data Source/QueryField",component:QueryField,parameters:{controls:{exclude:["onTypeahead","onChange","onBlur","onClick","onRunQuery","onRichValueChange","onWillApplySuggestion","portalOrigin","additionalPlugins","cleanText","syntax","syntaxLoaded"]}},argTypes:{query:{control:"text"}}},Basic=function(args){return(0,jsx_runtime.jsx)(QueryField,function QueryField_story_object_spread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter((function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable})))),ownKeys.forEach((function(key){QueryField_story_define_property(target,key,source[key])}))}return target}({},args))};Basic.args={onTypeahead:function(){var _ref=function QueryField_story_async_to_generator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){QueryField_story_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){QueryField_story_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}((function(_input){return QueryField_story_ts_generator(this,(function(_state){return[2,{suggestions:[]}]}))}));return function(_input){return _ref.apply(this,arguments)}}(),query:"Query text",placeholder:"Placeholder text",disabled:!1};var QueryField_story=meta;Basic.parameters={...Basic.parameters,docs:{...Basic.parameters?.docs,source:{originalSource:"(args: Omit<QueryFieldProps, 'theme'>) => <QueryField {...args} />",...Basic.parameters?.docs?.source}}}}}]);