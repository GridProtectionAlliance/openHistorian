"use strict";(self.webpackChunk_grafana_ui=self.webpackChunk_grafana_ui||[]).push([[4608],{"../grafana-data/src/transformations/fieldReducer.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{AS:function(){return fieldReducers},Nw:function(){return reduceField},gy:function(){return ReducerID}});var ReducerID,lodash__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/lodash/lodash.js"),_types_data__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../grafana-data/src/types/data.ts"),_types_dataFrame__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../grafana-data/src/types/dataFrame.ts"),_utils_Registry__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../grafana-data/src/utils/Registry.ts");function _array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _object_spread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter((function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable})))),ownKeys.forEach((function(key){_define_property(target,key,source[key])}))}return target}function _to_consumable_array(arr){return function _array_without_holes(arr){if(Array.isArray(arr))return _array_like_to_array(arr)}(arr)||function _iterable_to_array(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function _unsupported_iterable_to_array(o,minLen){if(!o)return;if("string"==typeof o)return _array_like_to_array(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array(o,minLen)}(arr)||function _non_iterable_spread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function reduceField(options){var _field_state,field=options.field,reducers=options.reducers;if(!field||!reducers||reducers.length<1)return{};if(null===(_field_state=field.state)||void 0===_field_state?void 0:_field_state.calcs){var missing=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=reducers[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var s=_step.value;field.state.calcs.hasOwnProperty(s)||missing.push(s)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}if(missing.length<1)return _object_spread({},field.state.calcs)}field.state||(field.state={});var queue=fieldReducers.list(reducers),data=field.values;if(data&&data.length<1){var calcs=_object_spread({},field.state.calcs),_iteratorNormalCompletion1=!0,_didIteratorError1=!1,_iteratorError1=void 0;try{for(var _step1,_iterator1=queue[Symbol.iterator]();!(_iteratorNormalCompletion1=(_step1=_iterator1.next()).done);_iteratorNormalCompletion1=!0){var reducer=_step1.value;calcs[reducer.id]=null!==reducer.emptyInputResult?reducer.emptyInputResult:null}}catch(err){_didIteratorError1=!0,_iteratorError1=err}finally{try{_iteratorNormalCompletion1||null==_iterator1.return||_iterator1.return()}finally{if(_didIteratorError1)throw _iteratorError1}}return field.state.calcs=calcs}var _field_config_nullValueMode=field.config.nullValueMode,nullValueMode=void 0===_field_config_nullValueMode?_types_data__WEBPACK_IMPORTED_MODULE_1__.UW.Ignore:_field_config_nullValueMode,ignoreNulls=nullValueMode===_types_data__WEBPACK_IMPORTED_MODULE_1__.UW.Ignore,nullAsZero=nullValueMode===_types_data__WEBPACK_IMPORTED_MODULE_1__.UW.AsZero;if(1===queue.length&&queue[0].reduce){var values=queue[0].reduce(field,ignoreNulls,nullAsZero);return field.state.calcs=_object_spread({},field.state.calcs,values),values}var values1=function doStandardCalcs(field,ignoreNulls,nullAsZero){var calcs=_object_spread({},defaultCalcs),data=field.values;if(!data)return calcs;for(var isNumberField=field.type===_types_dataFrame__WEBPACK_IMPORTED_MODULE_3__.PU.number||field.type===_types_dataFrame__WEBPACK_IMPORTED_MODULE_3__.PU.time,i=0;i<data.length;i++){var currentValue=data[i];if(0===i&&(calcs.first=currentValue),calcs.last=currentValue,null==currentValue){if(ignoreNulls)continue;nullAsZero&&(currentValue=0)}if(calcs.count++,null!=currentValue&&!Number.isNaN(currentValue)){var isFirst=null===calcs.firstNotNull;if(isFirst&&(calcs.firstNotNull=currentValue),isNumberField){if(calcs.sum+=currentValue,calcs.allIsNull=!1,calcs.nonNullCount++,!isFirst){var step=currentValue-calcs.lastNotNull;calcs.step>step&&(calcs.step=step),calcs.lastNotNull>currentValue?(calcs.previousDeltaUp=!1,i===data.length-1&&(calcs.delta+=currentValue)):(calcs.previousDeltaUp?calcs.delta+=step:calcs.delta+=currentValue,calcs.previousDeltaUp=!0)}currentValue>calcs.max&&(calcs.max=currentValue),currentValue<calcs.min&&(calcs.min=currentValue),currentValue<calcs.logmin&&currentValue>0&&(calcs.logmin=currentValue)}0!==currentValue&&(calcs.allIsZero=!1),calcs.lastNotNull=currentValue}}calcs.max===-Number.MAX_VALUE&&(calcs.max=null);calcs.min===Number.MAX_VALUE&&(calcs.min=null);calcs.step===Number.MAX_VALUE&&(calcs.step=null);calcs.nonNullCount>0&&(calcs.mean=calcs.sum/calcs.nonNullCount);calcs.allIsNull&&(calcs.allIsZero=!1);null!==calcs.max&&null!==calcs.min&&(calcs.range=calcs.max-calcs.min);(0,lodash__WEBPACK_IMPORTED_MODULE_0__.isNumber)(calcs.firstNotNull)&&(0,lodash__WEBPACK_IMPORTED_MODULE_0__.isNumber)(calcs.lastNotNull)&&(calcs.diff=calcs.lastNotNull-calcs.firstNotNull);(0,lodash__WEBPACK_IMPORTED_MODULE_0__.isNumber)(calcs.firstNotNull)&&(0,lodash__WEBPACK_IMPORTED_MODULE_0__.isNumber)(calcs.diff)&&(calcs.diffperc=calcs.diff/calcs.firstNotNull*100);return calcs}(field,ignoreNulls,nullAsZero),_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=queue[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var reducer1=_step2.value;!values1.hasOwnProperty(reducer1.id)&&reducer1.reduce&&(values1=_object_spread({},values1,reducer1.reduce(field,ignoreNulls,nullAsZero)))}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorNormalCompletion2||null==_iterator2.return||_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}return field.state.calcs=_object_spread({},field.state.calcs,values1),values1}!function(ReducerID){ReducerID.sum="sum",ReducerID.max="max",ReducerID.min="min",ReducerID.logmin="logmin",ReducerID.mean="mean",ReducerID.variance="variance",ReducerID.stdDev="stdDev",ReducerID.last="last",ReducerID.median="median",ReducerID.first="first",ReducerID.count="count",ReducerID.range="range",ReducerID.diff="diff",ReducerID.diffperc="diffperc",ReducerID.delta="delta",ReducerID.step="step",ReducerID.firstNotNull="firstNotNull",ReducerID.lastNotNull="lastNotNull",ReducerID.changeCount="changeCount",ReducerID.distinctCount="distinctCount",ReducerID.allIsZero="allIsZero",ReducerID.allIsNull="allIsNull",ReducerID.allValues="allValues",ReducerID.uniqueValues="uniqueValues",ReducerID.p1="p1",ReducerID.p2="p2",ReducerID.p3="p3",ReducerID.p4="p4",ReducerID.p5="p5",ReducerID.p6="p6",ReducerID.p7="p7",ReducerID.p8="p8",ReducerID.p9="p9",ReducerID.p10="p10",ReducerID.p11="p11",ReducerID.p12="p12",ReducerID.p13="p13",ReducerID.p14="p14",ReducerID.p15="p15",ReducerID.p16="p16",ReducerID.p17="p17",ReducerID.p18="p18",ReducerID.p19="p19",ReducerID.p20="p20",ReducerID.p21="p21",ReducerID.p22="p22",ReducerID.p23="p23",ReducerID.p24="p24",ReducerID.p25="p25",ReducerID.p26="p26",ReducerID.p27="p27",ReducerID.p28="p28",ReducerID.p29="p29",ReducerID.p30="p30",ReducerID.p31="p31",ReducerID.p32="p32",ReducerID.p33="p33",ReducerID.p34="p34",ReducerID.p35="p35",ReducerID.p36="p36",ReducerID.p37="p37",ReducerID.p38="p38",ReducerID.p39="p39",ReducerID.p40="p40",ReducerID.p41="p41",ReducerID.p42="p42",ReducerID.p43="p43",ReducerID.p44="p44",ReducerID.p45="p45",ReducerID.p46="p46",ReducerID.p47="p47",ReducerID.p48="p48",ReducerID.p49="p49",ReducerID.p50="p50",ReducerID.p51="p51",ReducerID.p52="p52",ReducerID.p53="p53",ReducerID.p54="p54",ReducerID.p55="p55",ReducerID.p56="p56",ReducerID.p57="p57",ReducerID.p58="p58",ReducerID.p59="p59",ReducerID.p60="p60",ReducerID.p61="p61",ReducerID.p62="p62",ReducerID.p63="p63",ReducerID.p64="p64",ReducerID.p65="p65",ReducerID.p66="p66",ReducerID.p67="p67",ReducerID.p68="p68",ReducerID.p69="p69",ReducerID.p70="p70",ReducerID.p71="p71",ReducerID.p72="p72",ReducerID.p73="p73",ReducerID.p74="p74",ReducerID.p75="p75",ReducerID.p76="p76",ReducerID.p77="p77",ReducerID.p78="p78",ReducerID.p79="p79",ReducerID.p80="p80",ReducerID.p81="p81",ReducerID.p82="p82",ReducerID.p83="p83",ReducerID.p84="p84",ReducerID.p85="p85",ReducerID.p86="p86",ReducerID.p87="p87",ReducerID.p88="p88",ReducerID.p89="p89",ReducerID.p90="p90",ReducerID.p91="p91",ReducerID.p92="p92",ReducerID.p93="p93",ReducerID.p94="p94",ReducerID.p95="p95",ReducerID.p96="p96",ReducerID.p97="p97",ReducerID.p98="p98",ReducerID.p99="p99"}(ReducerID||(ReducerID={}));var fieldReducers=new _utils_Registry__WEBPACK_IMPORTED_MODULE_2__.O((function(){return[{id:"lastNotNull",name:"Last *",description:"Last non-null value (also excludes NaNs)",standard:!0,aliasIds:["current"],reduce:calculateLastNotNull,preservesUnits:!0},{id:"last",name:"Last",description:"Last value",standard:!0,reduce:calculateLast,preservesUnits:!0},{id:"firstNotNull",name:"First *",description:"First non-null value (also excludes NaNs)",standard:!0,reduce:calculateFirstNotNull,preservesUnits:!0},{id:"first",name:"First",description:"First Value",standard:!0,reduce:calculateFirst,preservesUnits:!0},{id:"min",name:"Min",description:"Minimum Value",standard:!0,preservesUnits:!0},{id:"max",name:"Max",description:"Maximum Value",standard:!0,preservesUnits:!0},{id:"mean",name:"Mean",description:"Average Value",standard:!0,aliasIds:["avg"],preservesUnits:!0},{id:"median",name:"Median",description:"Median Value",standard:!0,aliasIds:["median"],preservesUnits:!0},{id:"variance",name:"Variance",description:"Variance of all values in a field",standard:!1,reduce:calculateStdDev,preservesUnits:!0},{id:"stdDev",name:"StdDev",description:"Standard deviation of all values in a field",standard:!1,reduce:calculateStdDev,preservesUnits:!0},{id:"sum",name:"Total",description:"The sum of all values",emptyInputResult:0,standard:!0,aliasIds:["total"],preservesUnits:!0},{id:"count",name:"Count",description:"Number of values in response",emptyInputResult:0,standard:!0,preservesUnits:!1},{id:"range",name:"Range",description:"Difference between minimum and maximum values",standard:!0,preservesUnits:!0},{id:"delta",name:"Delta",description:"Cumulative change in value",standard:!0,preservesUnits:!0},{id:"step",name:"Step",description:"Minimum interval between values",standard:!0,preservesUnits:!0},{id:"diff",name:"Difference",description:"Difference between first and last values",standard:!0,preservesUnits:!0},{id:"logmin",name:"Min (above zero)",description:"Used for log min scale",standard:!0,preservesUnits:!0},{id:"allIsZero",name:"All Zeros",description:"All values are zero",emptyInputResult:!1,standard:!0,preservesUnits:!0},{id:"allIsNull",name:"All Nulls",description:"All values are null",emptyInputResult:!0,standard:!0,preservesUnits:!1},{id:"changeCount",name:"Change Count",description:"Number of times the value changes",standard:!1,reduce:calculateChangeCount,preservesUnits:!1},{id:"distinctCount",name:"Distinct Count",description:"Number of distinct values",standard:!1,reduce:calculateDistinctCount,preservesUnits:!1},{id:"diffperc",name:"Difference percent",description:"Percentage difference between first and last values",standard:!0,preservesUnits:!1},{id:"allValues",name:"All values",description:"Returns an array with all values",standard:!1,reduce:function(field){return{allValues:_to_consumable_array(field.values)}},preservesUnits:!1},{id:"uniqueValues",name:"All unique values",description:"Returns an array with all unique values",standard:!1,reduce:function(field){return{uniqueValues:_to_consumable_array(new Set(field.values))}},preservesUnits:!1}].concat(_to_consumable_array(buildPercentileReducers()))})),buildPercentileReducers=function(){var percentiles=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_to_consumable_array(Array.from({length:99},(function(_,i){return i+1}))),percentileReducers=[],nth=function(n){return n>3&&n<21?"th":n%10==1?"st":n%10==2?"nd":n%10==3?"rd":"th"};return percentiles.forEach((function(p){var percentile=p/100,id="p".concat(p),name="".concat(p).concat(nth(p)," %"),description="".concat(p).concat(nth(p)," percentile value");percentileReducers.push({id:id,name:name,description:description,standard:!1,reduce:function(field,ignoreNulls,nullAsZero){return _define_property({},id,function calculatePercentile(field,percentile,ignoreNulls,nullAsZero){var data=field.values;ignoreNulls&&(data=data.filter((function(value){return null!==value})));nullAsZero&&(data=data.map((function(value){return null===value?0:value})));var sorted=data.slice().sort((function(a,b){return a-b})),index=Math.round((sorted.length-1)*percentile);return sorted[index]}(field,percentile,ignoreNulls,nullAsZero))},preservesUnits:!0})})),percentileReducers},defaultCalcs={sum:0,max:-Number.MAX_VALUE,min:Number.MAX_VALUE,logmin:Number.MAX_VALUE,mean:null,last:null,first:null,lastNotNull:null,firstNotNull:null,count:0,nonNullCount:0,allIsNull:!0,allIsZero:!0,range:null,diff:null,delta:0,step:Number.MAX_VALUE,diffperc:0,previousDeltaUp:!0};function calculateFirst(field,ignoreNulls,nullAsZero){return{first:field.values[0]}}function calculateFirstNotNull(field,ignoreNulls,nullAsZero){for(var data=field.values,idx=0;idx<data.length;idx++){var v=data[idx];if(null!=v&&!Number.isNaN(v))return{firstNotNull:v}}return{firstNotNull:null}}function calculateLast(field,ignoreNulls,nullAsZero){var data=field.values;return{last:data[data.length-1]}}function calculateLastNotNull(field,ignoreNulls,nullAsZero){for(var data=field.values,idx=data.length-1;idx>=0;){var v=data[idx--];if(null!=v&&!Number.isNaN(v))return{lastNotNull:v}}return{lastNotNull:null}}function calculateStdDev(field,ignoreNulls,nullAsZero){if(field.type!==_types_dataFrame__WEBPACK_IMPORTED_MODULE_3__.PU.number&&field.type!==_types_dataFrame__WEBPACK_IMPORTED_MODULE_3__.PU.time)return{variance:0,stdDev:0};for(var squareSum=0,runningMean=0,runningNonNullCount=0,data=field.values,i=0;i<data.length;i++){var currentValue=data[i];if(null!=currentValue){squareSum+=(currentValue-runningMean)*(currentValue-(runningMean+=(currentValue-runningMean)/++runningNonNullCount))}}if(runningNonNullCount>0){var variance=squareSum/runningNonNullCount;return{variance:variance,stdDev:Math.sqrt(variance)}}return{variance:0,stdDev:0}}function calculateChangeCount(field,ignoreNulls,nullAsZero){for(var data=field.values,count=0,first=!0,last=null,i=0;i<data.length;i++){var currentValue=data[i];if(null===currentValue){if(ignoreNulls)continue;nullAsZero&&(currentValue=0)}first||last===currentValue||count++,first=!1,last=currentValue}return{changeCount:count}}function calculateDistinctCount(field,ignoreNulls,nullAsZero){for(var data=field.values,distinct=new Set,i=0;i<data.length;i++){var currentValue=data[i];if(null===currentValue){if(ignoreNulls)continue;nullAsZero&&(currentValue=0)}distinct.add(currentValue)}return{distinctCount:distinct.size}}},"../grafana-data/src/types/data.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var LoadingState;__webpack_require__.d(__webpack_exports__,{Gu:function(){return LoadingState},UW:function(){return NullValueMode},zz:function(){return isTruthy}}),function(LoadingState){LoadingState.NotStarted="NotStarted",LoadingState.Loading="Loading",LoadingState.Streaming="Streaming",LoadingState.Done="Done",LoadingState.Error="Error"}(LoadingState||(LoadingState={}));var NullValueMode;!function(NullValueMode){NullValueMode.Null="null",NullValueMode.Ignore="connected",NullValueMode.AsZero="null as zero"}(NullValueMode||(NullValueMode={}));var isTruthy=function(value){return Boolean(value)}}}]);