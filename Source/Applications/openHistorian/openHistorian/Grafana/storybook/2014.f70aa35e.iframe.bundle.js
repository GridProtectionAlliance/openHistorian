"use strict";(self.webpackChunk_grafana_ui=self.webpackChunk_grafana_ui||[]).push([[2014],{"../grafana-data/src/field/displayProcessor.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{J:function(){return getDisplayProcessor}});var lodash=__webpack_require__("../../node_modules/lodash/lodash.js"),moment_wrapper=__webpack_require__("../grafana-data/src/datetime/moment_wrapper.ts"),parser=__webpack_require__("../grafana-data/src/datetime/parser.ts"),dataFrame=__webpack_require__("../grafana-data/src/types/dataFrame.ts");function anyToNumber(value){return"number"==typeof value?value:""===value||null==value||Array.isArray(value)?NaN:"boolean"==typeof value?value?1:0:(0,lodash.toNumber)(value)}var valueMapping_MappingType,valueMapping_SpecialValueMatch,LegacyMappingType,string=__webpack_require__("../grafana-data/src/text/string.ts");function _define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _object_spread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter((function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable})))),ownKeys.forEach((function(key){_define_property(target,key,source[key])}))}return target}!function(MappingType){MappingType.ValueToText="value",MappingType.RangeToText="range",MappingType.RegexToText="regex",MappingType.SpecialValue="special"}(valueMapping_MappingType||(valueMapping_MappingType={})),function(SpecialValueMatch){SpecialValueMatch.True="true",SpecialValueMatch.False="false",SpecialValueMatch.Null="null",SpecialValueMatch.NaN="nan",SpecialValueMatch.NullAndNaN="null+nan",SpecialValueMatch.Empty="empty"}(valueMapping_SpecialValueMatch||(valueMapping_SpecialValueMatch={})),function(LegacyMappingType){LegacyMappingType[LegacyMappingType.ValueToText=1]="ValueToText",LegacyMappingType[LegacyMappingType.RangeToText=2]="RangeToText"}(LegacyMappingType||(LegacyMappingType={}));var valueFormats=__webpack_require__("../grafana-data/src/valueFormats/valueFormats.ts"),scale=__webpack_require__("../grafana-data/src/field/scale.ts"),timeFormats={dateTimeAsIso:!0,dateTimeAsIsoNoDateIfToday:!0,dateTimeAsUS:!0,dateTimeAsUSNoDateIfToday:!0,dateTimeAsLocal:!0,dateTimeAsLocalNoDateIfToday:!0,dateTimeFromNow:!0};function getDisplayProcessor(options){if(!options||(0,lodash.isEmpty)(options)||!options.field)return toStringProcessor;var _field_config,field=options.field,config=null!==(_field_config=field.config)&&void 0!==_field_config?_field_config:{},palette=options.theme.visualization.palette,unit=config.unit,hasDateUnit=unit&&(timeFormats[unit]||unit.startsWith("time:")),showMs=!1;if(field.type!==dataFrame.PU.time||hasDateUnit)field.type===dataFrame.PU.boolean?(0,valueFormats.j9)(unit)||(unit="bool"):unit||field.type!==dataFrame.PU.string||(unit="string");else if(unit="dateTimeAsSystem",hasDateUnit=!0,field.values&&field.values.length>1){var start=field.values[0],end=field.values[field.values.length-1];"string"==typeof start?(start=(0,parser.b)(start).unix(),end=(0,parser.b)(end).unix()):(start/=1e3,end/=1e3),showMs=Math.abs(end-start)<60}var hasCurrencyUnit=null==unit?void 0:unit.startsWith("currency"),hasBoolUnit=(0,valueFormats.j9)(unit),isNumType=field.type===dataFrame.PU.number,canTrimTrailingDecimalZeros=!hasDateUnit&&!hasCurrencyUnit&&!hasBoolUnit&&!("locale"===unit)&&isNumType&&null==config.decimals,formatFunc=(0,valueFormats.j_)(unit||"none"),scaleFunc=(0,scale.jc)(field,options.theme);return function(value,adjacentDecimals){var mappings=config.mappings,isStringUnit="string"===unit;hasDateUnit&&"string"==typeof value&&(value=(0,moment_wrapper.yT)(value).valueOf());var text,prefix,suffix,color,icon,percent,numeric=isStringUnit?NaN:anyToNumber(value);if(mappings&&mappings.length>0){var mappingResult=function getValueMappingResult(valueMappings,value){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=valueMappings[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var vm=_step.value;switch(vm.type){case valueMapping_MappingType.ValueToText:if(null==value)continue;var result=vm.options[value];if(result)return result;break;case valueMapping_MappingType.RangeToText:if(null==value)continue;var valueAsNumber=parseFloat(value);if(isNaN(valueAsNumber))continue;if(!isNaN(vm.options.from)&&valueAsNumber<vm.options.from)continue;if(!isNaN(vm.options.to)&&valueAsNumber>vm.options.to)continue;return vm.options.result;case valueMapping_MappingType.RegexToText:if(null==value)continue;if("string"!=typeof value)continue;var regex=(0,string.dO)(vm.options.pattern);if(value.match(regex)){var res=_object_spread({},vm.options.result);return null!=res.text&&(res.text=value.replace(regex,vm.options.result.text||"")),res}case valueMapping_MappingType.SpecialValue:switch(vm.options.match){case valueMapping_SpecialValueMatch.Null:if(null==value)return vm.options.result;break;case valueMapping_SpecialValueMatch.NaN:if("number"==typeof value&&isNaN(value))return vm.options.result;break;case valueMapping_SpecialValueMatch.NullAndNaN:if("number"==typeof value&&isNaN(value)||null==value)return vm.options.result;break;case valueMapping_SpecialValueMatch.True:if(!0===value||"true"===value)return vm.options.result;break;case valueMapping_SpecialValueMatch.False:if(!1===value||"false"===value)return vm.options.result;break;case valueMapping_SpecialValueMatch.Empty:if(""===value)return vm.options.result}}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return null}(mappings,value);mappingResult&&(null!=mappingResult.text&&(text=mappingResult.text),null!=mappingResult.color&&(color=options.theme.visualization.getColorByName(mappingResult.color)),null!=mappingResult.icon&&(icon=mappingResult.icon))}else if(field.type===dataFrame.PU.enum){if(null==value)return{text:"",numeric:NaN};var enumIndex=+value;if(config&&config.type&&config.type.enum){var _config_type_enum=config.type.enum,enumText=_config_type_enum.text,enumColor=_config_type_enum.color;if(text=enumText?enumText[enumIndex]:"".concat(value),null==(color=enumColor?enumColor[enumIndex]:void 0)){var namedColor=palette[enumIndex%palette.length];color=options.theme.visualization.getColorByName(namedColor)}}}if(!Number.isNaN(numeric)){var v;if(null==text&&!(0,lodash.isBoolean)(value))canTrimTrailingDecimalZeros&&null!=adjacentDecimals?(v=formatFunc(numeric,adjacentDecimals,null,options.timeZone,showMs)).text=+v.text+"":v=formatFunc(numeric,config.decimals,null,options.timeZone,showMs),text=v.text,suffix=v.suffix,prefix=v.prefix;if(null==color){var scaleResult=scaleFunc(numeric);color=scaleResult.color,percent=scaleResult.percent}}if(null==text&&(0,lodash.isArray)(value)&&(text=(0,lodash.join)(value,", ")),null==text&&((text=(0,lodash.toString)(value))||(text=config.noValue?config.noValue:"")),!color){var scaleResult1=scaleFunc(-1/0);color=scaleResult1.color,percent=scaleResult1.percent}var display={text:text,numeric:numeric,prefix:prefix,suffix:suffix,color:color};return null!=icon&&(display.icon=icon),null!=percent&&(display.percent=percent),display}}function toStringProcessor(value){return{text:(0,lodash.toString)(value),numeric:anyToNumber(value)}}},"../grafana-data/src/field/scale.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{AP:function(){return getMinMaxAndDelta},jc:function(){return getScaleCalculator},xg:function(){return getFieldConfigWithMinMax}});var lodash__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/lodash/lodash.js"),_transformations_fieldReducer__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../grafana-data/src/transformations/fieldReducer.ts"),_types_dataFrame__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../grafana-data/src/types/dataFrame.ts"),_fieldColor__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../grafana-data/src/field/fieldColor.ts"),_thresholds__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../grafana-data/src/field/thresholds.ts");function _define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _object_spread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter((function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable})))),ownKeys.forEach((function(key){_define_property(target,key,source[key])}))}return target}function getScaleCalculator(field,theme){var _field_state;if(field.type===_types_dataFrame__WEBPACK_IMPORTED_MODULE_1__.PU.boolean)return function getBooleanScaleCalculator(field,theme){var trueValue={color:theme.visualization.getColorByName("green"),percent:1,threshold:void 0},falseValue={color:theme.visualization.getColorByName("red"),percent:0,threshold:void 0},mode=(0,_fieldColor__WEBPACK_IMPORTED_MODULE_2__.Qi)(field);if(mode.isContinuous&&mode.getColors){var colors=mode.getColors(theme);trueValue.color=colors[colors.length-1],falseValue.color=colors[0]}return function(value){return Boolean(value)?trueValue:falseValue}}(field,theme);var _field_state_range,getColor=(0,_fieldColor__WEBPACK_IMPORTED_MODULE_2__.Qi)(field).getCalculator(field,theme),info=null!==(_field_state_range=null===(_field_state=field.state)||void 0===_field_state?void 0:_field_state.range)&&void 0!==_field_state_range?_field_state_range:getMinMaxAndDelta(field);return function(value){var percent=0;value!==-1/0&&(percent=(value-info.min)/info.delta,Number.isNaN(percent)&&(percent=0));var threshold=(0,_thresholds__WEBPACK_IMPORTED_MODULE_3__.k5)(field,value,percent);return{percent:percent,threshold:threshold,color:getColor(value,percent,threshold)}}}function getMinMaxAndDelta(field){if(field.type!==_types_dataFrame__WEBPACK_IMPORTED_MODULE_1__.PU.number)return{min:0,max:100,delta:100};var min=field.config.min,max=field.config.max;if(!(0,lodash__WEBPACK_IMPORTED_MODULE_0__.isNumber)(min)||!(0,lodash__WEBPACK_IMPORTED_MODULE_0__.isNumber)(max))if(field.values&&field.values.length){var stats=(0,_transformations_fieldReducer__WEBPACK_IMPORTED_MODULE_4__.Nw)({field:field,reducers:[_transformations_fieldReducer__WEBPACK_IMPORTED_MODULE_4__.gy.min,_transformations_fieldReducer__WEBPACK_IMPORTED_MODULE_4__.gy.max]});(0,lodash__WEBPACK_IMPORTED_MODULE_0__.isNumber)(min)||(min=stats[_transformations_fieldReducer__WEBPACK_IMPORTED_MODULE_4__.gy.min]),(0,lodash__WEBPACK_IMPORTED_MODULE_0__.isNumber)(max)||(max=stats[_transformations_fieldReducer__WEBPACK_IMPORTED_MODULE_4__.gy.max])}else min=0,max=100;return{min:min,max:max,delta:max-min}}function getFieldConfigWithMinMax(field,local){var _field_state,config=field.config,min=config.min,max=config.max;return(0,lodash__WEBPACK_IMPORTED_MODULE_0__.isNumber)(min)&&(0,lodash__WEBPACK_IMPORTED_MODULE_0__.isNumber)(max)?config:local||!(null===(_field_state=field.state)||void 0===_field_state?void 0:_field_state.range)?_object_spread({},config,getMinMaxAndDelta(field)):_object_spread({},config,field.state.range)}},"./src/components/FormattedValueDisplay/FormattedValueDisplay.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{i:function(){return FormattedValueDisplay}});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/jsx-runtime.js");function _define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _object_spread_props(target,source){return source=null!=source?source:{},Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})),target}function _object_without_properties(source,excluded){if(null==source)return{};var key,i,target=function _object_without_properties_loose(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}(source,excluded);if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],excluded.indexOf(key)>=0||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}return target}var FormattedValueDisplay=function(_param){var _value_prefix,_value_suffix,suffixStyle,value=_param.value,className=_param.className,style=_param.style,htmlProps=_object_without_properties(_param,["value","className","style"]),hasPrefix=(null!==(_value_prefix=value.prefix)&&void 0!==_value_prefix?_value_prefix:"").length>0,hasSuffix=(null!==(_value_suffix=value.suffix)&&void 0!==_value_suffix?_value_suffix:"").length>0;if(style&&style.fontSize&&"number"==typeof style.fontSize){var fontSize=style.fontSize,reductionFactor=function fontSizeReductionFactor(fontSize){return fontSize<20?.9:fontSize<26?.8:.6}(fontSize);suffixStyle={fontSize:fontSize*reductionFactor}}return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",_object_spread_props(function _object_spread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter((function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable})))),ownKeys.forEach((function(key){_define_property(target,key,source[key])}))}return target}({className:className,style:style},htmlProps),{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{children:[hasPrefix&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{children:value.prefix}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{children:value.text}),hasSuffix&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{style:suffixStyle,children:value.suffix})]})}))};FormattedValueDisplay.displayName="FormattedDisplayValue";try{FormattedValueDisplay.displayName="FormattedDisplayValue",FormattedValueDisplay.__docgenInfo={description:"",displayName:"FormattedDisplayValue",props:{value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"FormattedValue"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/FormattedValueDisplay/FormattedValueDisplay.tsx#FormattedDisplayValue"]={docgenInfo:FormattedDisplayValue.__docgenInfo,name:"FormattedDisplayValue",path:"src/components/FormattedValueDisplay/FormattedValueDisplay.tsx#FormattedDisplayValue"})}catch(__react_docgen_typescript_loader_error){}},"./src/utils/measureText.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var _context;__webpack_require__.d(__webpack_exports__,{Vr:function(){return calculateFontSize},Yc:function(){return getCanvasContext},kD:function(){return measureText}});var cache=new Map,cacheLimit=500,ctxFontStyle="";function getCanvasContext(){return _context||(_context=document.createElement("canvas").getContext("2d")),_context}function measureText(text,fontSize){var fontStyle="".concat(arguments.length>2&&void 0!==arguments[2]?arguments[2]:400," ").concat(fontSize,"px 'Inter'"),cacheKey=text+fontStyle,fromCache=cache.get(cacheKey);if(fromCache)return fromCache;var context=getCanvasContext();ctxFontStyle!==fontStyle&&(context.font=ctxFontStyle=fontStyle);var metrics=context.measureText(text);return cache.size===cacheLimit&&cache.clear(),cache.set(cacheKey,metrics),metrics}function calculateFontSize(text,width,height,lineHeight,maxSize,fontWeight){var fontSizeBasedOnWidth=width/(measureText(text,14,fontWeight).width+2)*14,fontSizeBasedOnHeight=height/lineHeight,optimalSize=Math.min(fontSizeBasedOnHeight,fontSizeBasedOnWidth);return Math.min(optimalSize,null!=maxSize?maxSize:optimalSize)}}}]);